import{s as Vt,x as ee,j as Di}from"./lit-element-uhisBW42.js";import{n as B,r as ze,t as Mi}from"./state-729Pchtv.js";import{D as Gt,a as ft,c as Fi,m as Ai,w as zt,g as ki,i as Kt,T as fe,s as jt,l as w,O as Ie,b as Vi,C as G,R as Gi,u as I,d as he,B as zi,e as Ki,f as _e,E as p,h as ji,P as Ut,j as me,k as Re,V as Ui,n as Z,o as Oe,p as rt,q as Ht,t as ne,v as Ee,x as re,y as R,z as Hi,M as ot,W as Bi,A as ce,F as oe,H as Wi,I as Bt,J as Wt,K as pe,L as $i,N as Ne,Q as $t,S as _t,U as Zi,X as k,Y as H,Z as De,_ as mt,$ as L,a0 as Yi,a1 as Ce,a2 as pt,a3 as yt,a4 as vt,a5 as z,a6 as qi,a7 as tt,a8 as Xi,a9 as Ji,aa as Qi,G as $,ab as Zt,ac as en,ad as tn,ae as nn,af as sn,ag as rn,ah as on,ai as Yt,aj as qt,ak as Me,al as an,am as ln,an as hn,ao as cn,ap as dn,aq as Xt,ar as un,as as ye,at as Ke,au as Et,av as N,aw as He,ax as j,ay as te,az as Fe,aA as U,aB as Jt,aC as gn,aD as Qt,aE as Ae,aF as fn,aG as ei,aH as _n,aI as de,aJ as Ct,aK as mn,aL as ti,aM as ii,aN as bt,aO as ni,aP as pn,aQ as si,aR as yn,aS as vn,aT as ri,aU as je,aV as En,aW as Cn,aX as oi,aY as it,aZ as bn,a_ as wn,a$ as xn,b0 as Tn,b1 as Pn,b2 as Sn,b3 as Ln,b4 as In,b5 as Rn,b6 as On,b7 as Nn,b8 as Dn,b9 as Mn,ba as Fn,bb as An,bc as kn,bd as wt,be as xt,bf as Vn,bg as ai,bh as Gn,bi as ke,bj as zn,bk as Kn,bl as jn,bm as Un,bn as Hn,bo as Bn}from"./proj4-wH500JqA.js";class Wn extends Gt{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){ft()}calculateMatrices2D(e){const t=e.viewState,i=e.coordinateToPixelTransform,n=e.pixelToCoordinateTransform;Fi(i,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),Ai(n,i)}forEachFeatureAtCoordinate(e,t,i,n,s,o,a,l){let h;const c=t.viewState;function d(C,P,F,q){return s.call(o,P,C?F:null,q)}const u=c.projection,g=zt(e.slice(),u),f=[[0,0]];if(u.canWrapX()&&n){const C=u.getExtent(),P=ki(C);f.push([-P,0],[P,0])}const _=t.layerStatesArray,y=_.length,v=[],E=[];for(let C=0;C<f.length;C++)for(let P=y-1;P>=0;--P){const F=_[P],q=F.layer;if(q.hasRenderer()&&Kt(F,c)&&a.call(l,q)){const dt=q.getRenderer(),ut=q.getSource();if(dt&&ut){const gt=ut.getWrapX()?g:e,Ni=d.bind(null,F.managed);E[0]=gt[0]+f[C][0],E[1]=gt[1]+f[C][1],h=dt.forEachFeatureAtCoordinate(E,t,i,Ni,v)}if(h)return h}}if(v.length===0)return;const x=1/v.length;return v.forEach((C,P)=>C.distanceSq+=P*x),v.sort((C,P)=>C.distanceSq-P.distanceSq),v.some(C=>h=C.callback(C.feature,C.layer,C.geometry)),h}hasFeatureAtCoordinate(e,t,i,n,s,o){return this.forEachFeatureAtCoordinate(e,t,i,n,fe,this,s,o)!==void 0}getMap(){return this.map_}renderFrame(e){ft()}scheduleExpireIconCache(e){jt.canExpireCache()&&e.postRenderFunctions.push($n)}}function $n(r,e){jt.expire()}const Zn=Wn;class Yn extends Zn{constructor(e){super(e),this.fontChangeListenerKey_=w(Vi,Ie.PROPERTYCHANGE,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=G+" ol-layers";const i=e.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const i=this.getMap();if(i.hasListener(e)){const n=new Gi(e,void 0,t);i.dispatchEvent(n)}}disposeInternal(){I(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(he.PRECOMPOSE,e);const t=e.layerStatesArray.sort(function(a,l){return a.zIndex-l.zIndex});t.some(a=>a.layer instanceof zi&&a.layer.getDeclutter())&&(e.declutter={});const n=e.viewState;this.children_.length=0;const s=[];let o=null;for(let a=0,l=t.length;a<l;++a){const h=t[a];e.layerIndex=a;const c=h.layer,d=c.getSourceState();if(!Kt(h,n)||d!="ready"&&d!="undefined"){c.unrender();continue}const u=c.render(e,o);u&&(u!==o&&(this.children_.push(u),o=u),s.push(h))}this.declutter(e,s),Ki(this.element_,this.children_),this.dispatchRenderEvent(he.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}declutter(e,t){for(let i=t.length-1;i>=0;--i){const n=t[i],s=n.layer;s.getDeclutter()&&s.renderDeclutter(e,n)}t.forEach(i=>i.layer.renderDeferred(e))}}const qn=Yn;class Xn extends _e{constructor(e,t,i){super(e),this.map=t,this.frameState=i!==void 0?i:null}}const X=Xn;class Jn extends X{constructor(e,t,i,n,s,o){super(e,t,s),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=n!==void 0?n:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const K=Jn,m={SINGLECLICK:"singleclick",CLICK:p.CLICK,DBLCLICK:p.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},V={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class Qn extends ji{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=w(i,V.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=w(i,V.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(p.TOUCHMOVE,this.boundHandleTouchMove_,Ut?{passive:!1}:!1)}emulateClick_(e){let t=new K(m.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new K(m.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new K(m.SINGLECLICK,this.map_,e);this.dispatchEvent(i)},250)}updateActivePointers_(e){const t=e,i=t.pointerId;if(t.type==m.POINTERUP||t.type==m.POINTERCANCEL){delete this.trackedTouches_[i];for(const n in this.trackedTouches_)if(this.trackedTouches_[n].target!==t.target){delete this.trackedTouches_[n];break}}else(t.type==m.POINTERDOWN||t.type==m.POINTERMOVE)&&(this.trackedTouches_[i]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new K(m.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(I),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new K(m.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(w(i,m.POINTERMOVE,this.handlePointerMove_,this),w(i,m.POINTERUP,this.handlePointerUp_,this),w(this.element_,m.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(w(this.element_.getRootNode(),m.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new K(m.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new K(m.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(I(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(p.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(I(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(I),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const es=Qn,A={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},T={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"};class ts extends me{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){Re(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&Re(this.element);for(let t=0,i=this.listenerKeys.length;t<i;++t)I(this.listenerKeys[t]);this.listenerKeys.length=0,this.map_=e,e&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==Ui&&this.listenerKeys.push(w(e,A.POSTRENDER,this.render,this)),e.render())}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}const D=ts;class is extends D{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const t=e.className!==void 0?e.className:"ol-attribution",i=e.tipLabel!==void 0?e.tipLabel:"Attributions",n=e.expandClassName!==void 0?e.expandClassName:t+"-expand",s=e.collapseLabel!==void 0?e.collapseLabel:"›",o=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=o):this.collapseLabel_=s;const a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=n):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(p.CLICK,this.handleClick_.bind(this),!1);const h=t+" "+G+" "+Z+(this.collapsed_&&this.collapsible_?" "+Oe:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=Array.from(new Set(this.getMap().getAllLayers().flatMap(n=>n.getAttributions(e)))),i=!this.getMap().getAllLayers().some(n=>n.getSource()&&n.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(i),t}updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=this.collectSourceAttributions_(e),i=t.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!rt(t,this.renderedAttributions_)){Ht(this.ulElement_);for(let n=0,s=t.length;n<s;++n){const o=document.createElement("li");o.innerHTML=t[n],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Oe),this.collapsed_?ne(this.collapseLabel_,this.label_):ne(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}const li=is;class ns extends D{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",i=e.label!==void 0?e.label:"⇧",n=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=n,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(n));const s=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=s,o.appendChild(this.label_),o.addEventListener(p.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+G+" "+Z,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Ee)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const i=t.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:re}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const i=t.viewState.rotation;if(i!=this.rotation_){const n="rotate("+i+"rad)";if(this.autoHide_){const s=this.element.classList.contains(Ee);!s&&i===0?this.element.classList.add(Ee):s&&i!==0&&this.element.classList.remove(Ee)}this.label_.style.transform=n}this.rotation_=i}}const hi=ns;class ss extends D{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",i=e.delta!==void 0?e.delta:1,n=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",s=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",o=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"–",l=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",h=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=n,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(p.CLICK,this.handleClick_.bind(this,i),!1);const d=document.createElement("button");d.className=s,d.setAttribute("type","button"),d.title=h,d.appendChild(typeof a=="string"?document.createTextNode(a):a),d.addEventListener(p.CLICK,this.handleClick_.bind(this,-i),!1);const u=t+" "+G+" "+Z,g=this.element;g.className=u,g.appendChild(c),g.appendChild(d),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const i=this.getMap().getView();if(!i)return;const n=i.getZoom();if(n!==void 0){const s=i.getConstrainedZoom(n+e);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:s,duration:this.duration_,easing:re})):i.setZoom(s)}}}const ci=ss;function di(r){r=r||{};const e=new R;return(r.zoom!==void 0?r.zoom:!0)&&e.push(new ci(r.zoomOptions)),(r.rotate!==void 0?r.rotate:!0)&&e.push(new hi(r.rotateOptions)),(r.attribution!==void 0?r.attribution:!0)&&e.push(new li(r.attributionOptions)),e}const nt={ACTIVE:"active"};class rs extends me{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(nt.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(nt.ACTIVE,e)}setMap(e){this.map_=e}}function os(r,e,t){const i=r.getCenterInternal();if(i){const n=[i[0]+e[0],i[1]+e[1]];r.animateInternal({duration:t!==void 0?t:250,easing:Hi,center:r.getConstrainedCenter(n)})}}function at(r,e,t,i){const n=r.getZoom();if(n===void 0)return;const s=r.getConstrainedZoom(n+e),o=r.getResolutionForZoom(s);r.getAnimating()&&r.cancelAnimations(),r.animate({resolution:o,anchor:t,duration:i!==void 0?i:250,easing:re})}const ve=rs;class as extends ve{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==m.DBLCLICK){const i=e.originalEvent,n=e.map,s=e.coordinate,o=i.shiftKey?-this.delta_:this.delta_,a=n.getView();at(a,o,s,this.duration_),i.preventDefault(),t=!0}return!t}}const ls=as;class hs extends ve{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==m.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==m.POINTERUP){const i=this.handleUpEvent(e);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(e.type==m.POINTERDOWN){const i=this.handleDownEvent(e);this.handlingDownUpSequence=i,t=this.stopDown(i)}else e.type==m.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function lt(r){const e=r.length;let t=0,i=0;for(let n=0;n<e;n++)t+=r[n].clientX,i+=r[n].clientY;return{clientX:t/e,clientY:i/e}}const Y=hs;function st(r){const e=arguments;return function(t){let i=!0;for(let n=0,s=e.length;n<s&&(i=i&&e[n](t),!!i);++n);return i}}const cs=function(r){const e=r.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},ds=function(r){const e=r.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},us=function(r){const e=r.map.getTargetElement(),t=r.map.getOwnerDocument().activeElement;return e.contains(t)},ui=function(r){return r.map.getTargetElement().hasAttribute("tabindex")?us(r):!0},Ve=fe,gi=function(r){const e=r.originalEvent;return e.button==0&&!(Bi&&ot&&e.ctrlKey)},gs=oe,fs=function(r){return r.type==m.SINGLECLICK},ht=function(r){const e=r.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Tt=function(r){const e=r.originalEvent;return!e.altKey&&(ot?e.metaKey:e.ctrlKey)&&!e.shiftKey},_s=function(r){const e=r.originalEvent;return ot?e.metaKey:e.ctrlKey},fi=function(r){const e=r.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},_i=function(r){const e=r.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},Be=function(r){const e=r.originalEvent;return ce(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.pointerType=="mouse"},mi=function(r){const e=r.originalEvent;return ce(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.isPrimary&&e.button===0};class ms extends Y{constructor(e){super({stopDown:oe}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:st(ht,mi);this.condition_=e.onFocusOnly?st(ui,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const i=this.targetPointers,n=t.getEventPixel(lt(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(n[0],n[1]),this.lastCentroid){const s=[this.lastCentroid[0]-n[0],n[1]-this.lastCentroid[1]],a=e.map.getView();Wi(s,a.getResolution()),Bt(s,a.getRotation()),a.adjustCenterInternal(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=n,this.lastPointersCount_=i.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,i=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const n=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),o=i.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),l=t.getCoordinateFromPixelInternal([a[0]-n*Math.cos(s),a[1]-n*Math.sin(s)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:re})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const i=e.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}const ue=ms;class ps extends Y{constructor(e){e=e||{},super({stopDown:oe}),this.condition_=e.condition?e.condition:ds,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!Be(e))return;const t=e.map,i=t.getView();if(i.getConstraints().rotation===Wt)return;const n=t.getSize(),s=e.pixel,o=Math.atan2(n[1]/2-s[1],s[0]-n[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;i.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(e){return Be(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return Be(e)&&gi(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}const ys=ps;class vs extends Gt{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,i="px",n=this.element_.style;n.left=Math.min(e[0],t[0])+i,n.top=Math.min(e[1],t[1])+i,n.width=Math.abs(t[0]-e[0])+i,n.height=Math.abs(t[1]-e[1])+i}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const e=this.startPixel_,t=this.endPixel_,n=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new pe([n])}getGeometry(){return this.geometry_}}const Es=vs,be={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class We extends _e{constructor(e,t,i){super(e),this.coordinate=t,this.mapBrowserEvent=i}}class Cs extends Y{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.box_=new Es(e.className||"ol-dragbox"),this.minArea_=e.minArea!==void 0?e.minArea:64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition?e.condition:gi,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,i){const n=i[0]-t[0],s=i[1]-t[1];return n*n+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new We(be.BOXDRAG,e.coordinate,e))}handleUpEvent(e){this.box_.setMap(null);const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new We(t?be.BOXEND:be.BOXCANCEL,e.coordinate,e)),!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new We(be.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}}const bs=Cs;class ws extends bs{constructor(e){e=e||{};const t=e.condition?e.condition:fi;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const i=this.getMap().getView();let n=this.getGeometry();if(this.out_){const s=i.rotatedExtentForGeometry(n),o=i.getResolutionForExtentInternal(s),a=i.getResolution()/o;n=n.clone(),n.scale(a*a)}i.fitInternal(n,{duration:this.duration_,easing:re})}}const xs=ws,W={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class Ts extends ve{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return ht(t)&&_i(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==p.KEYDOWN){const i=e.originalEvent,n=i.key;if(this.condition_(e)&&(n==W.DOWN||n==W.LEFT||n==W.RIGHT||n==W.UP)){const o=e.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,h=0;n==W.DOWN?h=-a:n==W.LEFT?l=-a:n==W.RIGHT?l=a:h=a;const c=[l,h];Bt(c,o.getRotation()),os(o,c,this.duration_),i.preventDefault(),t=!0}}return!t}}const Ps=Ts;class Ss extends ve{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!_s(t)&&_i(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==p.KEYDOWN||e.type==p.KEYPRESS){const i=e.originalEvent,n=i.key;if(this.condition_(e)&&(n==="+"||n==="-")){const s=e.map,o=n==="+"?this.delta_:-this.delta_,a=s.getView();at(a,o,void 0,this.duration_),i.preventDefault(),t=!0}}return!t}}const Ls=Ss;class Is{constructor(e,t,i){this.decay_=e,this.minVelocity_=t,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let i=t-3;for(;i>0&&this.points_[i+2]>e;)i-=3;const n=this.points_[t+2]-this.points_[i+2];if(n<1e3/60)return!1;const s=this.points_[t]-this.points_[i],o=this.points_[t+1]-this.points_[i+1];return this.angle_=Math.atan2(o,s),this.initialVelocity_=Math.sqrt(s*s+o*o)/n,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const Rs=Is;class Os extends ve{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:Ve;this.condition_=e.onFocusOnly?st(ui,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(e){if(!this.condition_(e)||e.type!==p.WHEEL)return!0;const i=e.map,n=e.originalEvent;n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate);let s;if(e.type==p.WHEEL&&(s=n.deltaY,$i&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=$t),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)),s===0)return!1;this.lastDelta_=s;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel");const a=i.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=s;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),l),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let i=-Ne(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),at(t,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}const Ge=Os;class Ns extends Y{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=oe),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const i=this.targetPointers[0],n=this.targetPointers[1],s=Math.atan2(n.clientY-i.clientY,n.clientX-i.clientX);if(this.lastAngle_!==void 0){const l=s-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=l}this.lastAngle_=s;const o=e.map,a=o.getView();a.getConstraints().rotation!==Wt&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(lt(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}const Ds=Ns;class Ms extends Y{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=oe),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const i=this.targetPointers[0],n=this.targetPointers[1],s=i.clientX-n.clientX,o=i.clientY-n.clientY,a=Math.sqrt(s*s+o*o);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const l=e.map,h=l.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(lt(this.targetPointers))),l.render(),h.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const i=e.map.getView(),n=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,n),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}const Fs=Ms;function As(r){r=r||{};const e=new R,t=new Rs(-.005,.05,100);return(r.altShiftDragRotate!==void 0?r.altShiftDragRotate:!0)&&e.push(new ys),(r.doubleClickZoom!==void 0?r.doubleClickZoom:!0)&&e.push(new ls({delta:r.zoomDelta,duration:r.zoomDuration})),(r.dragPan!==void 0?r.dragPan:!0)&&e.push(new ue({onFocusOnly:r.onFocusOnly,kinetic:t})),(r.pinchRotate!==void 0?r.pinchRotate:!0)&&e.push(new Ds),(r.pinchZoom!==void 0?r.pinchZoom:!0)&&e.push(new Fs({duration:r.zoomDuration})),(r.keyboard!==void 0?r.keyboard:!0)&&(e.push(new Ps),e.push(new Ls({delta:r.zoomDelta,duration:r.zoomDuration}))),(r.mouseWheelZoom!==void 0?r.mouseWheelZoom:!0)&&e.push(new Ge({onFocusOnly:r.onFocusOnly,duration:r.zoomDuration})),(r.shiftDragZoom!==void 0?r.shiftDragZoom:!0)&&e.push(new xs({duration:r.zoomDuration})),e}function pi(r){if(r instanceof Zt){r.setMapInternal(null);return}r instanceof $&&r.getLayers().forEach(pi)}function yi(r,e){if(r instanceof Zt){r.setMapInternal(e);return}if(r instanceof $){const t=r.getLayers().getArray();for(let i=0,n=t.length;i<n;++i)yi(t[i],e)}}class ks extends me{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=Vs(e);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:$t,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=_t(),this.pixelToCoordinateTransform_=_t(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||di(),this.interactions=t.interactions||As({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new Zi(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(T.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(T.VIEW,this.handleViewChanged_),this.addChangeListener(T.SIZE,this.handleSizeChanged_),this.addChangeListener(T.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const i=this;e.view&&!(e.view instanceof k)&&e.view.then(function(n){i.setView(new k(n))}),this.controls.addEventListener(H.ADD,n=>{n.element.setMap(this)}),this.controls.addEventListener(H.REMOVE,n=>{n.element.setMap(null)}),this.interactions.addEventListener(H.ADD,n=>{n.element.setMap(this)}),this.interactions.addEventListener(H.REMOVE,n=>{n.element.setMap(null)}),this.overlays_.addEventListener(H.ADD,n=>{this.addOverlayInternal_(n.element)}),this.overlays_.addEventListener(H.REMOVE,n=>{const s=n.element.getId();s!==void 0&&delete this.overlayIdIndex_[s.toString()],n.element.setMap(null)}),this.controls.forEach(n=>{n.setMap(this)}),this.interactions.forEach(n=>{n.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){yi(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,i){if(!this.frameState_||!this.renderer_)return;const n=this.getCoordinateFromPixelInternal(e);i=i!==void 0?i:{};const s=i.hitTolerance!==void 0?i.hitTolerance:0,o=i.layerFilter!==void 0?i.layerFilter:fe,a=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,s,a,t,null,o,null)}getFeaturesAtPixel(e,t){const i=[];return this.forEachFeatureAtPixel(e,function(n){i.push(n)},t),i}getAllLayers(){const e=[];function t(i){i.forEach(function(n){n instanceof $?t(n.getLayers()):e.push(n)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const n=t.layerFilter!==void 0?t.layerFilter:fe,s=t.hitTolerance!==void 0?t.hitTolerance:0,o=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,s,o,n,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const i=this.viewport_.getBoundingClientRect(),n=this.getSize(),s=i.width/n[0],o=i.height/n[1],a="changedTouches"in e?e.changedTouches[0]:e;return[(a.clientX-i.left)/s,(a.clientY-i.top)/o]}getTarget(){return this.get(T.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return De(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?mt(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(T.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof R){t.setLayers(e);return}const i=t.getLayers();i.clear(),i.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const n=e[t];if(!n.visible)continue;const s=n.layer.getRenderer();if(s&&!s.ready)return!0;const o=n.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(e){const t=L(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?mt(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(T.SIZE)}getView(){return this.get(T.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,i,n){return Yi(this.frameState_,e,t,i,n)}handleBrowserEvent(e,t){t=t||e.type;const i=new K(t,this,e);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,i=t.type;if(i===V.POINTERDOWN||i===p.WHEEL||i===p.KEYDOWN){const n=this.getOwnerDocument(),s=this.viewport_.getRootNode?this.viewport_.getRootNode():n,o=t.target;if(this.overlayContainerStopEvent_.contains(o)||!(s===n?n.documentElement:s).contains(o))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const n=this.getInteractions().getArray().slice();for(let s=n.length-1;s>=0;s--){const o=n[s];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let n=this.maxTilesLoading_,s=n;if(e){const o=e.viewHints;if(o[Ce.ANIMATING]||o[Ce.INTERACTING]){const a=Date.now()-e.time>8;n=a?0:8,s=a?0:2}}t.getTilesLoading()<n&&(t.reprioritize(),t.loadMoreTiles(n,s))}e&&this.renderer_&&!e.animate&&(this.renderComplete_===!0?(this.hasListener(he.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(he.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new X(A.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new X(A.LOADSTART,this,e))));const i=this.postRenderFunctions_;for(let n=0,s=i.length;n<s;++n)i[n](this,e);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,n=this.targetChangeHandlerKeys_.length;i<n;++i)I(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(p.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(p.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,Re(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host),this.setSize(void 0)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new qn(this)),this.mapBrowserEventHandler_=new es(this,this.moveTolerance_);for(const s in m)this.mapBrowserEventHandler_.addEventListener(m[s],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(p.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(p.WHEEL,this.boundHandleBrowserEvent_,Ut?{passive:!1}:!1);const i=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[w(i,p.KEYDOWN,this.handleBrowserEvent,this),w(i,p.KEYPRESS,this.handleBrowserEvent,this)];const n=t.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.observe(n.host),this.resizeObserver_.observe(t)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(I(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(I(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=w(e,Ie.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=w(e,p.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(I),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new pt("addlayer",e)),this.layerGroupPropertyListenerKeys_=[w(e,Ie.PROPERTYCHANGE,this.render,this),w(e,p.CHANGE,this.render,this),w(e,"addlayer",this.handleLayerAdd_,this),w(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const n=e[t].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){pi(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),i=this.getView(),n=this.frameState_;let s=null;if(t!==void 0&&yt(t)&&i&&i.isDef()){const o=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=i.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:vt(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:z(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;s.nextExtent=vt(a.nextCenter,a.nextResolution,l,t)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),n&&(!this.previousExtent_||!qi(this.previousExtent_)&&!tt(s.extent,this.previousExtent_))&&(this.dispatchEvent(new X(A.MOVESTART,this,n)),this.previousExtent_=Xi(this.previousExtent_)),this.previousExtent_&&!s.viewHints[Ce.ANIMATING]&&!s.viewHints[Ce.INTERACTING]&&!tt(s.extent,this.previousExtent_)&&(this.dispatchEvent(new X(A.MOVEEND,this,s)),Ji(s.extent,this.previousExtent_))),this.dispatchEvent(new X(A.POSTRENDER,this,s)),this.renderComplete_=this.hasListener(A.LOADSTART)||this.hasListener(A.LOADEND)||this.hasListener(he.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new pt("removelayer",t)),this.set(T.LAYERGROUP,e)}setSize(e){this.set(T.SIZE,e)}setTarget(e){this.set(T.TARGET,e)}setView(e){if(!e||e instanceof k){this.set(T.VIEW,e);return}this.set(T.VIEW,new k);const t=this;e.then(function(i){t.setView(new k(i))})}updateSize(){const e=this.getTargetElement();let t;if(e){const n=getComputedStyle(e),s=e.offsetWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)-parseFloat(n.borderRightWidth),o=e.offsetHeight-parseFloat(n.borderTopWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)-parseFloat(n.borderBottomWidth);!isNaN(s)&&!isNaN(o)&&(t=[s,o],!yt(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&Qi("No map visible because the map container's width or height are 0."))}const i=this.getSize();t&&(!i||!rt(t,i))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){const t=this.getView();t&&t.setViewportSize(e)}}function Vs(r){let e=null;r.keyboardEventTarget!==void 0&&(e=typeof r.keyboardEventTarget=="string"?document.getElementById(r.keyboardEventTarget):r.keyboardEventTarget);const t={},i=r.layers&&typeof r.layers.getLayers=="function"?r.layers:new $({layers:r.layers});t[T.LAYERGROUP]=i,t[T.TARGET]=r.target,t[T.VIEW]=r.view instanceof k?r.view:new k;let n;r.controls!==void 0&&(Array.isArray(r.controls)?n=new R(r.controls.slice()):(ce(typeof r.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),n=r.controls));let s;r.interactions!==void 0&&(Array.isArray(r.interactions)?s=new R(r.interactions.slice()):(ce(typeof r.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),s=r.interactions));let o;return r.overlays!==void 0?Array.isArray(r.overlays)?o=new R(r.overlays.slice()):(ce(typeof r.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=r.overlays):o=new R,{controls:n,interactions:s,keyboardEventTarget:e,overlays:o,values:t}}const vi=ks,Gs=':root,:host{--ol-background-color: white;--ol-accent-background-color: #F5F5F5;--ol-subtle-background-color: rgba(128, 128, 128, .25);--ol-partial-background-color: rgba(255, 255, 255, .75);--ol-foreground-color: #333333;--ol-subtle-foreground-color: #666666;--ol-brand-color: #00AAFF}.ol-box{box-sizing:border-box;border-radius:2px;border:1.5px solid var(--ol-background-color);background-color:var(--ol-partial-background-color)}.ol-mouse-position{top:8px;right:8px;position:absolute}.ol-scale-line{background:var(--ol-partial-background-color);border-radius:4px;bottom:8px;left:8px;padding:2px;position:absolute}.ol-scale-line-inner{border:1px solid var(--ol-subtle-foreground-color);border-top:none;color:var(--ol-foreground-color);font-size:10px;text-align:center;margin:1px;will-change:contents,width;transition:all .25s}.ol-scale-bar{position:absolute;bottom:8px;left:8px}.ol-scale-bar-inner{display:flex}.ol-scale-step-marker{width:1px;height:15px;background-color:var(--ol-foreground-color);float:right;z-index:10}.ol-scale-step-text{position:absolute;bottom:-5px;font-size:10px;z-index:11;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-text{position:absolute;font-size:12px;text-align:center;bottom:25px;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-singlebar{position:relative;height:10px;z-index:9;box-sizing:border-box;border:1px solid var(--ol-foreground-color)}.ol-scale-singlebar-even{background-color:var(--ol-subtle-foreground-color)}.ol-scale-singlebar-odd{background-color:var(--ol-background-color)}.ol-unsupported{display:none}.ol-viewport,.ol-unselectable{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent}.ol-viewport canvas{all:unset;overflow:hidden}.ol-viewport{touch-action:pan-x pan-y}.ol-selectable{-webkit-touch-callout:default;-webkit-user-select:text;-moz-user-select:text;user-select:text}.ol-grabbing{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.ol-grab{cursor:move;cursor:-webkit-grab;cursor:-moz-grab;cursor:grab}.ol-control{position:absolute;background-color:var(--ol-subtle-background-color);border-radius:4px}.ol-zoom{top:.5em;left:.5em}.ol-rotate{top:.5em;right:.5em;transition:opacity .25s linear,visibility 0s linear}.ol-rotate.ol-hidden{opacity:0;visibility:hidden;transition:opacity .25s linear,visibility 0s linear .25s}.ol-zoom-extent{top:4.643em;left:.5em}.ol-full-screen{right:.5em;top:.5em}.ol-control button{display:block;margin:1px;padding:0;color:var(--ol-subtle-foreground-color);font-weight:700;text-decoration:none;font-size:inherit;text-align:center;height:1.375em;width:1.375em;line-height:.4em;background-color:var(--ol-background-color);border:none;border-radius:2px}.ol-control button::-moz-focus-inner{border:none;padding:0}.ol-zoom-extent button{line-height:1.4em}.ol-compass{display:block;font-weight:400;will-change:transform}.ol-touch .ol-control button{font-size:1.5em}.ol-touch .ol-zoom-extent{top:5.5em}.ol-control button:hover,.ol-control button:focus{text-decoration:none;outline:1px solid var(--ol-subtle-foreground-color);color:var(--ol-foreground-color)}.ol-zoom .ol-zoom-in{border-radius:2px 2px 0 0}.ol-zoom .ol-zoom-out{border-radius:0 0 2px 2px}.ol-attribution{text-align:right;bottom:.5em;right:.5em;max-width:calc(100% - 1.3em);display:flex;flex-flow:row-reverse;align-items:center}.ol-attribution a{color:var(--ol-subtle-foreground-color);text-decoration:none}.ol-attribution ul{margin:0;padding:1px .5em;color:var(--ol-foreground-color);text-shadow:0 0 2px var(--ol-background-color);font-size:12px}.ol-attribution li{display:inline;list-style:none}.ol-attribution li:not(:last-child):after{content:" "}.ol-attribution img{max-height:2em;max-width:inherit;vertical-align:middle}.ol-attribution button{flex-shrink:0}.ol-attribution.ol-collapsed ul{display:none}.ol-attribution:not(.ol-collapsed){background:var(--ol-partial-background-color)}.ol-attribution.ol-uncollapsible{bottom:0;right:0;border-radius:4px 0 0}.ol-attribution.ol-uncollapsible img{margin-top:-.2em;max-height:1.6em}.ol-attribution.ol-uncollapsible button{display:none}.ol-zoomslider{top:4.5em;left:.5em;height:200px}.ol-zoomslider button{position:relative;height:10px}.ol-touch .ol-zoomslider{top:5.5em}.ol-overviewmap{left:.5em;bottom:.5em}.ol-overviewmap.ol-uncollapsible{bottom:0;left:0;border-radius:0 4px 0 0}.ol-overviewmap .ol-overviewmap-map,.ol-overviewmap button{display:block}.ol-overviewmap .ol-overviewmap-map{border:1px solid var(--ol-subtle-foreground-color);height:150px;width:150px}.ol-overviewmap:not(.ol-collapsed) button{bottom:0;left:0;position:absolute}.ol-overviewmap.ol-collapsed .ol-overviewmap-map,.ol-overviewmap.ol-uncollapsible button{display:none}.ol-overviewmap:not(.ol-collapsed){background:var(--ol-subtle-background-color)}.ol-overviewmap-box{border:1.5px dotted var(--ol-subtle-foreground-color)}.ol-overviewmap .ol-overviewmap-box:hover{cursor:move}',zs=".geolocation{top:65px;left:.5em}.ol-touch .geolocation{top:80px}";class Ue extends en{constructor(e,t,i){super(),i!==void 0&&t===void 0?this.setFlatCoordinates(i,e):(t=t||0,this.setCenterAndRadius(e,t,i))}clone(){const e=new Ue(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){const s=this.flatCoordinates,o=e-s[0],a=t-s[1],l=o*o+a*a;if(l<n){if(l===0)for(let h=0;h<this.stride;++h)i[h]=s[h];else{const h=this.getRadius()/Math.sqrt(l);i[0]=s[0]+h*o,i[1]=s[1]+h*a;for(let c=2;c<this.stride;++c)i[c]=s[c]}return i.length=this.stride,l}return n}containsXY(e,t){const i=this.flatCoordinates,n=e-i[0],s=t-i[1];return n*n+s*s<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,i=t[this.stride]-t[0];return tn(t[0]-i,t[1]-i,t[0]+i,t[1]+i,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(nn(e,t)){const i=this.getCenter();return e[0]<=i[0]&&e[2]>=i[0]||e[1]<=i[1]&&e[3]>=i[1]?!0:sn(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],n=e.slice();n[t]=n[0]+i;for(let s=1;s<t;++s)n[t+s]=e[s];this.setFlatCoordinates(this.layout,n),this.changed()}setCenterAndRadius(e,t,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const n=this.flatCoordinates;let s=rn(n,0,e,this.stride);n[s++]=n[0]+t;for(let o=1,a=this.stride;o<a;++o)n[s++]=n[o];n.length=s,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const i=this.getCenter(),n=this.getStride();this.setCenter(on(i,0,i.length,n,e,t,i)),this.changed()}}Ue.prototype.transform;const Ks=Ue,b={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},js={ERROR:"error"};class Us extends _e{constructor(e){super(js.ERROR),this.code=e.code,this.message=e.message}}class Hs extends me{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=Yt,this.watchId_=void 0,this.addChangeListener(b.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(b.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=qt(Me("EPSG:4326"),e),this.position_&&this.set(b.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const t=e.coords;this.set(b.ACCURACY,t.accuracy),this.set(b.ALTITUDE,t.altitude===null?void 0:t.altitude),this.set(b.ALTITUDE_ACCURACY,t.altitudeAccuracy===null?void 0:t.altitudeAccuracy),this.set(b.HEADING,t.heading===null?void 0:an(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const i=this.transform_(this.position_);this.set(b.POSITION,i.slice()),this.set(b.SPEED,t.speed===null?void 0:t.speed);const n=ln(this.position_,t.accuracy);n.applyTransform(this.transform_),this.set(b.ACCURACY_GEOMETRY,n),this.changed()}positionError_(e){this.dispatchEvent(new Us(e))}getAccuracy(){return this.get(b.ACCURACY)}getAccuracyGeometry(){return this.get(b.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(b.ALTITUDE)}getAltitudeAccuracy(){return this.get(b.ALTITUDE_ACCURACY)}getHeading(){return this.get(b.HEADING)}getPosition(){return this.get(b.POSITION)}getProjection(){return this.get(b.PROJECTION)}getSpeed(){return this.get(b.SPEED)}getTracking(){return this.get(b.TRACKING)}getTrackingOptions(){return this.get(b.TRACKING_OPTIONS)}setProjection(e){this.set(b.PROJECTION,Me(e))}setTracking(e){this.set(b.TRACKING,e)}setTrackingOptions(e){this.set(b.TRACKING_OPTIONS,e)}}const Bs=Hs,S={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class Ws extends me{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+hn,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(S.ELEMENT,this.handleElementChanged),this.addChangeListener(S.MAP,this.handleMapChanged),this.addChangeListener(S.OFFSET,this.handleOffsetChanged),this.addChangeListener(S.POSITION,this.handlePositionChanged),this.addChangeListener(S.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(S.ELEMENT)}getId(){return this.id}getMap(){return this.get(S.MAP)||null}getOffset(){return this.get(S.OFFSET)}getPosition(){return this.get(S.POSITION)}getPositioning(){return this.get(S.POSITIONING)}handleElementChanged(){Ht(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(Re(this.element),I(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=w(e,A.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(S.ELEMENT,e)}setMap(e){this.set(S.MAP,e)}setOffset(e){this.set(S.OFFSET,e)}setPosition(e){this.set(S.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(S.POSITION))return;const i=this.getRect(t.getTargetElement(),t.getSize()),n=this.getElement(),s=this.getRect(n,[cn(n),dn(n)]);e=e||{};const o=e.margin===void 0?20:e.margin;if(!Xt(i,s)){const a=s[0]-i[0],l=i[2]-s[2],h=s[1]-i[1],c=i[3]-s[3],d=[0,0];if(a<0?d[0]=a-o:l<0&&(d[0]=Math.abs(l)+o),h<0?d[1]=h-o:c<0&&(d[1]=Math.abs(c)+o),d[0]!==0||d[1]!==0){const u=t.getView().getCenterInternal(),g=t.getPixelFromCoordinateInternal(u);if(!g)return;const f=[g[0]+d[0],g[1]+d[1]],_=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(f),duration:_.duration,easing:_.easing})}}}getRect(e,t){const i=e.getBoundingClientRect(),n=i.left+window.pageXOffset,s=i.top+window.pageYOffset;return[n,s,n+t[0],s+t[1]]}setPositioning(e){this.set(S.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const i=e.getPixelFromCoordinate(t),n=e.getSize();this.updateRenderedPosition(i,n)}updateRenderedPosition(e,t){const i=this.element.style,n=this.getOffset(),s=this.getPositioning();this.setVisible(!0);const o=Math.round(e[0]+n[0])+"px",a=Math.round(e[1]+n[1])+"px";let l="0%",h="0%";s=="bottom-right"||s=="center-right"||s=="top-right"?l="-100%":(s=="bottom-center"||s=="center-center"||s=="top-center")&&(l="-50%"),s=="bottom-left"||s=="bottom-center"||s=="bottom-right"?h="-100%":(s=="center-left"||s=="center-center"||s=="center-right")&&(h="-50%");const c=`translate(${l}, ${h}) translate(${o}, ${a})`;this.rendered.transform_!=c&&(this.rendered.transform_=c,i.transform=c)}getOptions(){return this.options}}const Ei=Ws,Pt=0,ge=1,St=[0,0,0,0],ie=[],$e={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class Ze extends _e{constructor(e,t,i){super(e),this.features=t,this.mapBrowserEvent=i}}class $s extends Y{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:mi,this.defaultDeleteCondition_=function(i){return cs(i)&&fs(i)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Ve,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new un,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new ye({source:new Ke({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:Ys(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new R(this.source_.getFeatures()),this.source_.addEventListener(Et.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Et.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(H.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(H.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const n=this.SEGMENT_WRITERS_[t.getType()];n&&n(e,t)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),e.addEventListener(p.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new R;const i=this.featuresBeingModified_.getArray();for(let n=0,s=t.length;n<s;++n){const o=t[n];for(let a=0,l=o.length;a<l;++a){const h=o[a].feature;h&&!i.includes(h)&&this.featuresBeingModified_.push(h)}}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Ze($e.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(p.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,i=[];t.forEach(function(n){e===n.feature&&i.push(n)});for(let n=i.length-1;n>=0;--n){const s=i[n];for(let o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===s&&this.dragSegments_.splice(o,1);t.remove(s)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const i=t.getCoordinates(),n={feature:e,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),n)}writeMultiPointGeometry_(e,t){const i=t.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n],a={feature:e,geometry:t,depth:[n],index:n,segment:[o,o]};this.rBush_.insert(t.getExtent(),a)}}writeLineStringGeometry_(e,t){const i=t.getCoordinates();for(let n=0,s=i.length-1;n<s;++n){const o=i.slice(n,n+2),a={feature:e,geometry:t,index:n,segment:o};this.rBush_.insert(N(o),a)}}writeMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n];for(let a=0,l=o.length-1;a<l;++a){const h=o.slice(a,a+2),c={feature:e,geometry:t,depth:[n],index:a,segment:h};this.rBush_.insert(N(h),c)}}}writePolygonGeometry_(e,t){const i=t.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n];for(let a=0,l=o.length-1;a<l;++a){const h=o.slice(a,a+2),c={feature:e,geometry:t,depth:[n],index:a,segment:h};this.rBush_.insert(N(h),c)}}}writeMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n];for(let a=0,l=o.length;a<l;++a){const h=o[a];for(let c=0,d=h.length-1;c<d;++c){const u=h.slice(c,c+2),g={feature:e,geometry:t,depth:[a,n],index:c,segment:u};this.rBush_.insert(N(u),g)}}}}writeCircleGeometry_(e,t){const i=t.getCenter(),n={feature:e,geometry:t,index:Pt,segment:[i,i]},s={feature:e,geometry:t,index:ge,segment:[i,i]},o=[n,s];n.featureSegments=o,s.featureSegments=o,this.rBush_.insert(He(i),n);let a=t;this.rBush_.insert(a.getExtent(),s)}writeGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let n=0;n<i.length;++n){const s=i[n],o=this.SEGMENT_WRITERS_[s.getType()];o(e,s)}}createOrUpdateVertexFeature_(e,t,i){let n=this.vertexFeature_;return n?n.getGeometry().setCoordinates(e):(n=new j(new te(e)),this.vertexFeature_=n,this.overlay_.getSource().addFeature(n)),n.set("features",t),n.set("geometries",i),n}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==m.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=m.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==m.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],n=[];for(let s=0,o=this.dragSegments_.length;s<o;++s){const a=this.dragSegments_[s],l=a[0],h=l.feature;i.includes(h)||i.push(h);const c=l.geometry;n.includes(c)||n.push(c);const d=l.depth;let u;const g=l.segment,f=a[1];for(;t.length<c.getStride();)t.push(g[f][t.length]);switch(c.getType()){case"Point":u=t,g[0]=t,g[1]=t;break;case"MultiPoint":u=c.getCoordinates(),u[l.index]=t,g[0]=t,g[1]=t;break;case"LineString":u=c.getCoordinates(),u[l.index+f]=t,g[f]=t;break;case"MultiLineString":u=c.getCoordinates(),u[d[0]][l.index+f]=t,g[f]=t;break;case"Polygon":u=c.getCoordinates(),u[d[0]][l.index+f]=t,g[f]=t;break;case"MultiPolygon":u=c.getCoordinates(),u[d[1]][d[0]][l.index+f]=t,g[f]=t;break;case"Circle":if(g[0]=t,g[1]=t,l.index===Pt)this.changingFeature_=!0,c.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let _=Fe(L(c.getCenter()),L(t));c.setRadius(_),this.changingFeature_=!1}break}u&&this.setGeometryCoordinates_(c,u)}this.createOrUpdateVertexFeature_(t,i,n)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const i=this.vertexFeature_;if(i){e.map.getView().getProjection();const n=[],s=i.getGeometry().getCoordinates(),o=N([s]),a=this.rBush_.getInExtent(o),l={};a.sort(Zs);for(let h=0,c=a.length;h<c;++h){const d=a[h],u=d.segment;let g=z(d.geometry);const f=d.depth;if(f&&(g+="-"+f.join("-")),l[g]||(l[g]=new Array(2)),d.geometry.getType()==="Circle"&&d.index===ge){const _=It(t,d);U(_,s)&&!l[g][0]&&(this.dragSegments_.push([d,0]),l[g][0]=d);continue}if(U(u[0],s)&&!l[g][0]){this.dragSegments_.push([d,0]),l[g][0]=d;continue}if(U(u[1],s)&&!l[g][1]){if(l[g][0]&&l[g][0].index===0){let _=d.geometry.getCoordinates();switch(d.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":_=_[f[1]];case"Polygon":if(d.index!==_[f[0]].length-2)continue;break}}this.dragSegments_.push([d,1]),l[g][1]=d;continue}z(u)in this.vertexSegments_&&!l[g][0]&&!l[g][1]&&this.insertVertexCondition_(e)&&n.push(d)}n.length&&this.willModifyFeatures_(e,[n]);for(let h=n.length-1;h>=0;--h)this.insertVertex_(n[h],s)}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const i=this.dragSegments_[t][0],n=i.geometry;if(n.getType()==="Circle"){const s=n.getCenter(),o=i.featureSegments[0],a=i.featureSegments[1];o.segment[0]=s,o.segment[1]=s,a.segment[0]=s,a.segment[1]=s,this.rBush_.update(He(s),o);let l=n;this.rBush_.update(l.getExtent(),a)}else this.rBush_.update(N(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new Ze($e.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)}handlePointerAtPixel_(e,t,i){const n=i||t.getCoordinateFromPixel(e);t.getView().getProjection();const s=function(l,h){return Lt(n,l)-Lt(n,h)};let o,a;if(this.hitDetection_){const l=typeof this.hitDetection_=="object"?h=>h===this.hitDetection_:void 0;t.forEachFeatureAtPixel(e,(h,c,d)=>{d&&d.getType()==="Point"&&(d=new te(De(d.getCoordinates())));const u=d||h.getGeometry();if(h instanceof j&&this.features_.getArray().includes(h)){a=u;const g=h.getGeometry().getFlatCoordinates().slice(0,2);o=[{feature:h,geometry:a,segment:[g,g]}]}return!0},{layerFilter:l})}if(!o){const l=Jt(He(n,St)),h=t.getView().getResolution()*this.pixelTolerance_,c=gn(Qt(l,h,St));o=this.rBush_.getInExtent(c)}if(o&&o.length>0){const l=o.sort(s)[0],h=l.segment;let c=It(n,l);const d=t.getPixelFromCoordinate(c);let u=Fe(e,d);if(a||u<=this.pixelTolerance_){const g={};if(g[z(h)]=!0,this.snapToPointer_||(this.delta_[0]=c[0]-n[0],this.delta_[1]=c[1]-n[1]),l.geometry.getType()==="Circle"&&l.index===ge)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(c,[l.feature],[l.geometry]);else{const f=t.getPixelFromCoordinate(h[0]),_=t.getPixelFromCoordinate(h[1]),y=Ae(d,f),v=Ae(d,_);u=Math.sqrt(Math.min(y,v)),this.snappedToVertex_=u<=this.pixelTolerance_,this.snappedToVertex_&&(c=y>v?h[1]:h[0]),this.createOrUpdateVertexFeature_(c,[l.feature],[l.geometry]);const E={};E[z(l.geometry)]=!0;for(let x=1,C=o.length;x<C;++x){const P=o[x].segment;if(U(h[0],P[0])&&U(h[1],P[1])||U(h[0],P[1])&&U(h[1],P[0])){const F=z(o[x].geometry);F in E||(E[F]=!0,g[z(P)]=!0)}else break}}this.vertexSegments_=g;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const i=e.segment,n=e.feature,s=e.geometry,o=e.depth,a=e.index;let l;for(;t.length<s.getStride();)t.push(0);switch(s.getType()){case"MultiLineString":l=s.getCoordinates(),l[o[0]].splice(a+1,0,t);break;case"Polygon":l=s.getCoordinates(),l[o[0]].splice(a+1,0,t);break;case"MultiPolygon":l=s.getCoordinates(),l[o[1]][o[0]].splice(a+1,0,t);break;case"LineString":l=s.getCoordinates(),l.splice(a+1,0,t);break;default:return}this.setGeometryCoordinates_(s,l);const h=this.rBush_;h.remove(e),this.updateSegmentIndices_(s,a,o,1);const c={segment:[i[0],t],feature:n,geometry:s,depth:o,index:a};h.insert(N(c.segment),c),this.dragSegments_.push([c,1]);const d={segment:[t,i[1]],feature:n,geometry:s,depth:o,index:a+1};h.insert(N(d.segment),d),this.dragSegments_.push([d,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=m.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Ze($e.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const e=this.dragSegments_,t={};let i=!1,n,s,o,a,l,h,c,d,u,g,f;for(l=e.length-1;l>=0;--l)o=e[l],g=o[0],f=z(g.feature),g.depth&&(f+="-"+g.depth.join("-")),f in t||(t[f]={}),o[1]===0?(t[f].right=g,t[f].index=g.index):o[1]==1&&(t[f].left=g,t[f].index=g.index+1);for(f in t){switch(u=t[f].right,c=t[f].left,h=t[f].index,d=h-1,c!==void 0?g=c:g=u,d<0&&(d=0),a=g.geometry,s=a.getCoordinates(),n=s,i=!1,a.getType()){case"MultiLineString":s[g.depth[0]].length>2&&(s[g.depth[0]].splice(h,1),i=!0);break;case"LineString":s.length>2&&(s.splice(h,1),i=!0);break;case"MultiPolygon":n=n[g.depth[1]];case"Polygon":n=n[g.depth[0]],n.length>4&&(h==n.length-1&&(h=0),n.splice(h,1),i=!0,h===0&&(n.pop(),n.push(n[0]),d=n.length-1));break}if(i){this.setGeometryCoordinates_(a,s);const _=[];if(c!==void 0&&(this.rBush_.remove(c),_.push(c.segment[0])),u!==void 0&&(this.rBush_.remove(u),_.push(u.segment[1])),c!==void 0&&u!==void 0){const y={depth:g.depth,feature:g.feature,geometry:g.geometry,index:d,segment:_};this.rBush_.insert(N(y.segment),y)}this.updateSegmentIndices_(a,h,g.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return i}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,i,n){this.rBush_.forEachInExtent(e.getExtent(),function(s){s.geometry===e&&(i===void 0||s.depth===void 0||rt(s.depth,i))&&s.index>t&&(s.index+=n)})}}function Zs(r,e){return r.index-e.index}function Lt(r,e,t){const i=e.geometry;if(i.getType()==="Circle"){let s=i;if(e.index===ge){const o=Ae(s.getCenter(),L(r)),a=Math.sqrt(o)-s.getRadius();return a*a}}const n=L(r);return ie[0]=L(e.segment[0]),ie[1]=L(e.segment[1]),_n(n,ie)}function It(r,e,t){const i=e.geometry;if(i.getType()==="Circle"&&e.index===ge)return De(i.getClosestPoint(L(r)));const n=L(r);return ie[0]=L(e.segment[0]),ie[1]=L(e.segment[1]),De(fn(n,ie))}function Ys(){const r=ei();return function(e,t){return r.Point}}const qs=$s,we={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class xe extends _e{constructor(e,t){super(e),this.feature=t}}function Xs(r,e){const t=[];for(let i=0;i<e.length;++i){const s=e[i].getGeometry();Ci(r,s,t)}return t}function Te(r,e){return ri(r[0],r[1],e[0],e[1])}function J(r,e){const t=r.length;return e<0?r[e+t]:e>=t?r[e-t]:r[e]}function Pe(r,e,t){let i,n;e<t?(i=e,n=t):(i=t,n=e);const s=Math.ceil(i),o=Math.floor(n);if(s>o){const l=Q(r,i),h=Q(r,n);return Te(l,h)}let a=0;if(i<s){const l=Q(r,i),h=J(r,s);a+=Te(l,h)}if(o<n){const l=J(r,o),h=Q(r,n);a+=Te(l,h)}for(let l=s;l<o-1;++l){const h=J(r,l),c=J(r,l+1);a+=Te(h,c)}return a}function Ci(r,e,t){if(e instanceof de){Se(r,e.getCoordinates(),!1,t);return}if(e instanceof ti){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n)Se(r,i[n],!1,t);return}if(e instanceof pe){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n)Se(r,i[n],!0,t);return}if(e instanceof ii){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n];for(let a=0,l=o.length;a<l;++a)Se(r,o[a],!0,t)}return}if(e instanceof yn){const i=e.getGeometries();for(let n=0;n<i.length;++n)Ci(r,i[n],t);return}}const Ye={index:-1,endIndex:NaN};function Js(r,e,t,i){const n=r[0],s=r[1];let o=1/0,a=-1,l=NaN;for(let d=0;d<e.targets.length;++d){const u=e.targets[d],g=u.coordinates;let f=1/0,_;for(let y=0;y<g.length-1;++y){const v=g[y],E=g[y+1],x=bi(n,s,v,E);x.squaredDistance<f&&(f=x.squaredDistance,_=y+x.along)}f<o&&(o=f,u.ring&&e.targetIndex===d&&(u.endIndex>u.startIndex?_<u.startIndex&&(_+=g.length):u.endIndex<u.startIndex&&_>u.startIndex&&(_-=g.length)),l=_,a=d)}const h=e.targets[a];let c=h.ring;if(e.targetIndex===a&&c){const d=Q(h.coordinates,l),u=t.getPixelFromCoordinate(d);Fe(u,e.startPx)>i&&(c=!1)}if(c){const d=h.coordinates,u=d.length,g=h.startIndex,f=l;if(g<f){const _=Pe(d,g,f);Pe(d,g,f-u)<_&&(l-=u)}else{const _=Pe(d,g,f);Pe(d,g,f+u)<_&&(l+=u)}}return Ye.index=a,Ye.endIndex=l,Ye}function Se(r,e,t,i){const n=r[0],s=r[1];for(let o=0,a=e.length-1;o<a;++o){const l=e[o],h=e[o+1],c=bi(n,s,l,h);if(c.squaredDistance===0){const d=o+c.along;i.push({coordinates:e,ring:t,startIndex:d,endIndex:d});return}}}const qe={along:0,squaredDistance:0};function bi(r,e,t,i){const n=t[0],s=t[1],o=i[0],a=i[1],l=o-n,h=a-s;let c=0,d=n,u=s;return(l!==0||h!==0)&&(c=Ne(((r-n)*l+(e-s)*h)/(l*l+h*h),0,1),d+=l*c,u+=h*c),qe.along=c,qe.squaredDistance=vn(ri(r,e,d,u),10),qe}function Q(r,e){const t=r.length;let i=Math.floor(e);const n=e-i;i>=t?i-=t:i<0&&(i+=t);let s=i+1;s>=t&&(s-=t);const o=r[i],a=o[0],l=o[1],h=r[s],c=h[0]-a,d=h[1]-l;return[a+c*n,l+d*n]}class Qs extends Y{constructor(e){const t=e;t.stopDown||(t.stopDown=oe),super(t),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=ir(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:fe,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let i=e.geometryFunction;if(!i){const n=this.mode_;if(n==="Circle")i=function(s,o,a){const l=o||new Ks([NaN,NaN]),h=L(s[0]),c=Ae(h,L(s[s.length-1]));return l.setCenterAndRadius(h,Math.sqrt(c),this.geometryLayout_),l};else{let s;n==="Point"?s=te:n==="LineString"?s=de:n==="Polygon"&&(s=pe),i=function(o,a,l){return a?n==="Polygon"?o[0].length?a.setCoordinates([o[0].concat([o[0][0]])],this.geometryLayout_):a.setCoordinates([],this.geometryLayout_):a.setCoordinates(o,this.geometryLayout_):a=new s(o,this.geometryLayout_),a}}}this.geometryFunction_=i,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new ye({source:new Ke({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:er(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:ht,this.freehandCondition_,e.freehand?this.freehandCondition_=Ve:this.freehandCondition_=e.freehandCondition?e.freehandCondition:fi,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(nt.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=Ve:t=e:t=gs,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===p.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===m.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&e.type===m.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===m.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),i=!1):this.freehand_&&e.type===m.POINTERDOWN?i=!1:t&&this.getPointerCount()<2?(i=e.type===m.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===m.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===m.DBLCLICK&&(i=!1),super.handleEvent(e)&&i}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new K(m.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),i=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),n=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),s=N([i,n]),o=this.traceSource_.getFeaturesInExtent(s);if(o.length===0)return;const a=Xs(e.coordinate,o);a.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:a,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex,n=e.startIndex<=t;i===n?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const n=Math.ceil(e);let s=Math.floor(t);s===t&&(s-=1),i=s-n+1}else{const n=Math.floor(e);let s=Math.ceil(t);s===t&&(s+=1),i=n-s+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(e,t,i){if(t===i)return;const n=[];if(t<i){const s=Math.ceil(t);let o=Math.floor(i);o===i&&(o-=1);for(let a=s;a<=o;++a)n.push(J(e.coordinates,a))}else{const s=Math.floor(t);let o=Math.ceil(i);o===i&&(o+=1);for(let a=s;a>=o;--a)n.push(J(e.coordinates,a))}n.length&&this.appendCoordinates(n)}updateTrace_(e){const t=this.traceState_;if(!t.active||t.targetIndex===-1&&Fe(t.startPx,e.pixel)<this.snapTolerance_)return;const i=Js(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==i.index){if(t.targetIndex!==-1){const l=t.targets[t.targetIndex];this.removeTracedCoordinates_(l.startIndex,l.endIndex)}const a=t.targets[i.index];this.addTracedCoordinates_(a,a.startIndex,i.endIndex)}else{const a=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(a,i.endIndex)}t.targetIndex=i.index;const n=t.targets[t.targetIndex];n.endIndex=i.endIndex;const s=Q(n.coordinates,n.endIndex),o=this.getMap().getPixelFromCoordinate(s);e.coordinate=s,e.pixel=[Math.round(o[0]),Math.round(o[1])]}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const i=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const n=!this.finishCoordinate_;n&&this.startDrawing_(e.coordinate),!n&&this.freehand_?this.finishDrawing():!this.freehand_&&(!n||this.mode_==="Point")&&(this.atFinish_(e.pixel,i)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,i=e.pixel,n=t[0]-i[0],s=t[1]-i[1],o=n*n+s*s;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let i=!1;if(this.sketchFeature_){let n=!1,s=[this.finishCoordinate_];const o=this.mode_;if(o==="Point")i=!0;else if(o==="Circle")i=this.sketchCoords_.length===2;else if(o==="LineString")n=!t&&this.sketchCoords_.length>this.minPoints_;else if(o==="Polygon"){const a=this.sketchCoords_;n=a[0].length>this.minPoints_,s=[a[0][0],a[0][a[0].length-2]],t?s=[a[0][0]]:s=[a[0][0],a[0][a[0].length-2]]}if(n){const a=this.getMap();for(let l=0,h=s.length;l<h;l++){const c=s[l],d=a.getPixelFromCoordinate(c),u=e[0]-d[0],g=e[1]-d[1],f=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(u*u+g*g)<=f,i){this.finishCoordinate_=c;break}}}}return i}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new j(new te(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new j);const t=e.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),i.changed()):(i=new de(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(e){const t=this.getMap().getView().getProjection(),i=Ct(this.geometryLayout_);for(;e.length<i;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new j(new de(this.sketchLineCoords_)));const n=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new j,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(n),this.updateSketchFeatures_(),this.dispatchEvent(new xe(we.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),i=this.sketchFeature_.getGeometry(),n=t.getView().getProjection(),s=Ct(this.geometryLayout_);let o,a;for(;e.length<s;)e.push(0);this.mode_==="Point"?a=this.sketchCoords_:this.mode_==="Polygon"?(o=this.sketchCoords_[0],a=o[o.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(o=this.sketchCoords_,a=o[o.length-1]),a[0]=e[0],a[1]=e[1],this.geometryFunction_(this.sketchCoords_,i,n),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),i.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let n,s;const o=this.mode_;return o==="LineString"||o==="Circle"?(this.finishCoordinate_=e.slice(),s=this.sketchCoords_,s.length>=this.maxPoints_&&(this.freehand_?s.pop():n=!0),s.push(e.slice()),this.geometryFunction_(s,t,i)):o==="Polygon"&&(s=this.sketchCoords_[0],s.length>=this.maxPoints_&&(this.freehand_?s.pop():n=!0),s.push(e.slice()),n&&(this.finishCoordinate_=s[0]),this.geometryFunction_(this.sketchCoords_,t,i)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),n?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),n=this.mode_;for(let s=0;s<e;++s){let o;if(n==="LineString"||n==="Circle"){if(o=this.sketchCoords_,o.splice(-2,1),o.length>=2){this.finishCoordinate_=o[o.length-2].slice();const a=this.finishCoordinate_.slice();o[o.length-1]=a,this.createOrUpdateSketchPoint_(a)}this.geometryFunction_(o,t,i),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(n==="Polygon"){o=this.sketchCoords_[0],o.splice(-2,1);const a=this.sketchLine_.getGeometry();if(o.length>=2){const l=o[o.length-2].slice();o[o.length-1]=l,this.createOrUpdateSketchPoint_(l)}a.setCoordinates(o),this.geometryFunction_(this.sketchCoords_,t,i)}if(o.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_;const i=e.getGeometry(),n=this.getMap().getView().getProjection();return this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,i,n)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,i,n),t=i.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new mn([t])):this.type_==="MultiLineString"?e.setGeometry(new ti([t])):this.type_==="MultiPolygon"&&e.setGeometry(new ii([t])),this.dispatchEvent(new xe(we.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new xe(we.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,i=!this.sketchFeature_;i&&this.startDrawing_(e[0]);let n;if(t==="LineString"||t==="Circle")n=this.sketchCoords_;else if(t==="Polygon")n=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;i&&n.shift(),n.pop();for(let o=0;o<e.length;o++)this.addToDrawing_(e[o]);const s=e[e.length-1];this.sketchFeature_=this.addToDrawing_(s),this.modifyDrawing_(s)}extend(e){const i=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=i.getCoordinates();const n=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=n.slice(),this.sketchCoords_.push(n.slice()),this.sketchPoint_=new j(new te(n)),this.updateSketchFeatures_(),this.dispatchEvent(new xe(we.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function er(){const r=ei();return function(e,t){return r[e.getGeometry().getType()]}}function tr(){return function(r,e,t){const i=N([r[0],r[r.length-1]].map(function(s){return L(s)})),n=[[bt(i),ni(i),pn(i),si(i),bt(i)]];return e?e.setCoordinates(n):e=new pe(n),e}}function ir(r){switch(r){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+r)}}const nr=Qs,ct={dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"};function Rt(r,e,t,i){const n=new CustomEvent(e,{detail:{originalEvent:t,geoJSON:i}});r.dispatchEvent(n)}function wi(r,e,t,i=!1,n=!1){const s=i?[r.feature]:r.features;n&&e.getSource().clear();const o=e.getSource().getFeatures();if(!e.get("multipleFeatures")&&(o.length||s.length>1))return console.error("Multiple features detected!");s.forEach(h=>{const c=h.getGeometry();if(c instanceof de){const u=wn(c,{radius:6378137,projection:"EPSG:3857"});h.set("measure",u)}else if(c instanceof pe){const u=xn(c,{radius:6378137,projection:"EPSG:3857"});h.set("measure",u)}const d=z(h);h.set("id",d),h.setId(d)}),!i&&s.length&&(e.getSource().addFeatures(s),t.map.getView().fit(e.getSource().getExtent(),{duration:750}));const a=new je,l=JSON.parse(a.writeFeatures(s,ct));(i||n)&&Rt(t,"drawend",r,l),Rt(t,"addfeatures",r,l)}function sr(r,e,t,i=!1){try{const n=rr(r);if(!n){console.error("Unsupported format or invalid data");return}const s=n.readFeatures(r,ct);wi({features:s},e,t,!1,i)}catch(n){console.error("Error parsing data:",n)}}function rr(r){return or(r)?new je:ar(r)?new En({extractStyles:!1}):lr(r)?new Cn:null}function or(r){try{const e=JSON.parse(r);return e.type==="FeatureCollection"||e.type==="Feature"}catch{return!1}}function ar(r){return r.includes("<kml")&&r.includes("</kml>")}function lr(r){try{const e=JSON.parse(r);return e.type==="Topology"&&e.objects}catch{return!1}}async function hr(r){return oi(it),await bn(r)}function cr(r,e){it.defs(r,e),oi(it)}function dr(r,e,t){const i=Object.assign({},t);if(r.interactions[i.id])throw Error(`Interaction with id: ${i.id} already exists.`);i.modify=typeof i.modify=="boolean"?i.modify:!0;const n=e.getSource();i.type==="Box"&&(i.geometryFunction=tr(),i.type="Circle");const s=new nr({...i,source:n});i.active===!1&&s.setActive(!1),s.on("drawend",l=>{e.get("isDrawingEnabled")&&wi(l,e,r,!0)}),r.map.addInteraction(s),r.interactions[i.id]=s;const o=new qs({source:n});o.setActive(i.modify),r.map.addInteraction(o),r.interactions[`${i.id}_modify`]=o;const a=()=>{r.getLayerById(e.get("id"))||(r.removeInteraction(i.id),r.removeInteraction(`${i.id}_modify`),r.map.getLayerGroup().un("change",a))};r.map.getLayerGroup().on("change",a)}class xi extends Vt{constructor(){super(...arguments),this.templates={},this._renderedTemplates={}}setBindingSyntax(e,t){this._startExpression=e,this._endExpression=t;const i=this.escapeRegex(this._startExpression),n=this.escapeRegex(this._endExpression);this._expression=new RegExp(`${i}\\s*([$\\w\\.,'"\\s()\\[\\]]+)\\s*${n}`,"g")}hasTemplate(e){return this.templates&&!!this.templates[e]}renderTemplate(e,t,i){if(!this.hasTemplate(e))return null;i=i||e;const n=ee` <slot name=${i}></slot> `,s={[e]:{...t}};if(this._renderedTemplates.hasOwnProperty(i)){const{slot:a}=this._renderedTemplates[i];this.contains(a)&&this.removeChild(a)}const o=document.createElement("div");return o.slot=i,o.dataset.generated="template",this._renderTemplate(o,this.templates[e],s),this.appendChild(o),this._renderedTemplates[i]={context:s,slot:o},n}getTemplates(){const e={};for(let t=0;t<this.children.length;t++){const i=this.children[t];if(i.nodeName==="RENDER-TEMPLATE"){const n=i;n.dataset.type?e[n.dataset.type]=n:e.default=n,n.templateOrder=t}}return e}_renderTemplate(e,t,i){let n;if(t&&t.childNodes.length){const s=t.cloneNode(!0);n=this.renderNode(s,e,i)}n&&e.appendChild(n)}expandExpressionsAsString(e,t){return e.replace(this.expression,(i,n)=>{const s=this.evalInContext(n||this.trimExpression(i),t);return s?typeof s=="object"?JSON.stringify(s):s.toString():""})}get expression(){return this._expression||this.setBindingSyntax("{{","}}"),this._expression}escapeRegex(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}evalInContext(e,t){t={...t};const i=new Function("with(this) { return "+e+";}");let n;try{n=i.call(t)}catch{}return n}trimExpression(e){return e=e.trim(),e.startsWith(this._startExpression)&&e.endsWith(this._endExpression)&&(e=e.substr(this._startExpression.length,e.length-this._startExpression.length-this._endExpression.length),e=e.trim()),e}renderNode(e,t,i){if(e.nodeName==="#text")return e.textContent=this.expandExpressionsAsString(e.textContent,i),e;if(e.nodeName==="TEMPLATE")return e.$parentTemplateContext=i,e;for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];this.renderNode(s,t,i)}return e}firstUpdated(){this.templates=this.getTemplates()}}var ur=Object.defineProperty,gr=Object.getOwnPropertyDescriptor,fr=(r,e,t,i)=>{for(var n=i>1?void 0:i?gr(e,t):e,s=r.length-1,o;s>=0;s--)(o=r[s])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&ur(e,t,n),n};class Ti extends xi{constructor(){super(),this.propertyTransform=(e,t)=>e}renderContent(e){Di(this.hasTemplate("properties")?ee`${this.renderTemplate("properties",e.getProperties(),"tooltip-1")}`:ee` <style>
              ul {
                margin: 0;
                padding: 15px 15px 15px 30px;
                background: #0008;
                border-radius: 15px;
                color: white;
                max-width: 250px;
                font-size: small;
              }
              span {
                font-weight: bold;
              }
            </style>
            <ul>
              ${Object.entries(e.getProperties()).map(([t,i])=>this.propertyTransform({key:t,value:i},e)).filter(t=>t).map(({key:t,value:i})=>ee`<li><span>${t}</span>: ${i}</li>`)}
            </ul>`,this.shadowRoot)}}fr([B()],Ti.prototype,"propertyTransform",2);customElements.define("eox-map-tooltip",Ti);class _r{constructor(e,t,i){var u,g;this.eoxMap=e,this.selectLayer=t,this.options=i,this.active=i.active||t.getVisible(),this.panIn=i.panIn||!1;const n=this.eoxMap.map.getOverlayById("eox-map-tooltip");let s;this.selectedFids=[],n?(this.tooltip=n.getElement(),s=n):(this.tooltip=this.eoxMap.querySelector("eox-map-tooltip")||((u=i.overlay)==null?void 0:u.element),this.tooltip&&(s=new Ei({element:this.tooltip,position:void 0,offset:[0,0],positioning:"top-left",className:"eox-map-tooltip",id:"eox-map-tooltip",...i.overlay}),this.eoxMap.map.addOverlay(s)));const o=()=>{s&&i.condition==="pointermove"&&s.setPosition(void 0)};e.map.on("change:target",f=>{var _,y;(_=f.oldValue)==null||_.removeEventListener("pointerleave",o),(y=f.target.getTargetElement())==null||y.addEventListener("pointerleave",o)}),(g=e.map.getTargetElement())==null||g.addEventListener("pointerleave",o);let a;if(this.options.layer)a=this.options.layer;else{const f=this.selectLayer.get("_jsonDefinition");a={...f,style:i.style,properties:{id:this.selectLayer.get("id")+"_select"},source:{type:f.type}}}a.renderMode="vector",delete a.interactions,this.selectStyleLayer=se(e,a),this.selectStyleLayer.setSource(this.selectLayer.getSource()),this.selectStyleLayer.setMap(this.eoxMap.map);const l=this.selectStyleLayer.getStyleFunction();this.selectStyleLayer.setStyle((f,_)=>this.selectedFids.length&&this.selectedFids.includes(this.getId(f))?l(f,_):null);const h=f=>{this.panIn&&this.eoxMap.map.getView().fit(f.getGeometry().getExtent(),{duration:750})},c=f=>{if(!this.active)return;const _=this.eoxMap.map.getView().getZoom();f.dragging||!this.active||_<this.selectLayer.getMinZoom()||_>this.selectLayer.getMaxZoom()||this.selectLayer.getFeatures(f.pixel).then(y=>{const v=y.length?y[0]:null,E=v?[this.getId(v)]:[],x=this.selectedFids[0]!==E[0];if(this.selectedFids=E,x&&(this.selectStyleLayer.changed(),v&&h(v)),s){const P=f.pixel[0]>this.eoxMap.offsetWidth/2?"right":"left",F=f.pixel[1]>this.eoxMap.offsetHeight/2?"bottom":"top";s.setPositioning(`${F}-${P}`),s.setPosition(v?f.coordinate:null),v&&this.tooltip.renderContent&&this.tooltip.renderContent(v)}const C=new CustomEvent("select",{detail:{id:i.id,originalEvent:f,feature:v}});this.eoxMap.dispatchEvent(C)})};this.eoxMap.map.on(i.condition||"click",c),this.selectLayer.on("change:opacity",()=>{this.selectStyleLayer.setOpacity(this.selectLayer.getOpacity())}),this.selectLayer.on("change:visible",()=>{const f=this.selectLayer.getVisible();this.selectStyleLayer.setVisible(f),this.setActive(f)}),this.changeSourceListener=()=>{this.selectStyleLayer.setSource(this.selectLayer.getSource())},this.selectLayer.on("change:source",this.changeSourceListener),this.removeListener=()=>{},this.eoxMap.map.getLayers().on("remove",this.removeListener);const d=()=>{e.getLayerById(t.get("id"))||(e.selectInteractions[i.id].remove(),e.map.getLayerGroup().un("change",d))};e.map.getLayerGroup().on("change",d)}setActive(e){this.active=e}highlightById(e){this.selectedFids=e,this.selectStyleLayer.changed()}remove(){this.selectStyleLayer.setMap(null),delete this.eoxMap.selectInteractions[this.options.id],this.selectLayer.un("change:source",this.changeSourceListener),this.eoxMap.map.getLayers().un("remove",this.removeListener)}getId(e){if(this.options.idProperty)return e.get(this.options.idProperty);if(e.getId()!==void 0)return e.getId();if(e.get("id")!==void 0)return e.get("id");throw Error("No feature id found. Please provide which feature property should be taken instead using idProperty.")}}function mr(r,e,t){if(r.interactions[t.id])throw Error(`Interaction with id: ${t.id} already exists.`);return r.selectInteractions[t.id]=new _r(r,e,t),r.selectInteractions[t.id]}const pr={GeoJSON:je,MVT:Pn},yr={Group:$,Image:Sn,Tile:Ln,Vector:ye,VectorTile:In},vr={ImageWMS:Rn,OSM:On,Tile:Nn,TileWMS:Dn,Vector:Ke,VectorTile:Mn,WMTS:Fn,XYZ:An};function se(r,e,t=!0){var h,c;e=JSON.parse(JSON.stringify(e));const i={...pr,...window.eoxMapAdvancedOlFormats},n={...yr,...window.eoxMapAdvancedOlLayers},s={...vr,...window.eoxMapAdvancedOlSources},o=n[e.type],a=s[(h=e.source)==null?void 0:h.type];if(!o)throw window.eoxMapAdvancedOlLayers?new Error(`Layer type ${e.type} not supported!`):new Error(`Layer type ${e.type} not created! Forgot to import advanced layers & sources plugin from @eox/map/dist/eox-map-advanced-layers-and-sources.js?`);if(e.source&&!a)throw window.eoxMapAdvancedOlSources?new Error(`Source type ${e.source.type} not supported!`):new Error(`Source type ${e.source.type} not created! Forgot to import advanced layers & sources plugin from @eox/map/dist/eox-map-advanced-layers-and-sources.js?`);const l=new o({...e,...e.source&&{source:new a({...e.source,...e.source.format&&{format:new i[e.source.format]},...e.source.tileGrid&&{tileGrid:Tn({...e.source.tileGrid})}})},...e.type==="Group"&&{layers:[]},...e.properties,style:void 0});if(l.set("_jsonDefinition",e,!0),e.type==="Group"){const d=e.layers.reverse().map(u=>se(r,u));d.forEach(u=>u.set("_group",l,!0)),l.setLayers(new R(d))}if(e.style&&l.setStyle(e.style),t&&((c=e.interactions)!=null&&c.length))for(let d=0,u=e.interactions.length;d<u;d++){const g=e.interactions[d];Pi(r,l,g)}return Li(l,e),l}function Pi(r,e,t){t.type==="draw"?dr(r,e,t.options):t.type==="select"&&mr(r,e,t.options)}function Si(r,e,t){var s,o,a,l;const i=t.get("_jsonDefinition");if(e.type!==i.type||((s=e.source)==null?void 0:s.type)!==((o=i.source)==null?void 0:o.type))throw new Error("Layers are not compatible to be updated");const n=se(r,e,!1);if(JSON.stringify(e.source)!==JSON.stringify(i.source)&&t.setSource(n.getSource()),["Vector","VectorTile"].includes(e.type)&&JSON.stringify(e.style)!==JSON.stringify(i.style)&&t.setStyle(n.getStyle()),JSON.stringify(e.properties)!==JSON.stringify(i.properties)&&t.setProperties(e.properties),e.visible!==i.visible&&t.setVisible(e.visible),e.opacity!==i.opacity&&t.setOpacity(e.opacity),JSON.stringify(e.interactions)!==JSON.stringify(i.interactions)&&((a=i.interactions)==null||a.forEach(h=>{const c=e.interactions.find(d=>d.type===h.type);c?c.type==="draw"?(r.interactions[c.options.id].setActive(c.options.active),r.interactions[`${c.options.id}_modify`].setActive(c.options.modify)):r.selectInteractions[c.options.id].setActive(c.options.active):r.removeInteraction(h.options.id)}),(l=e.interactions)==null||l.forEach(h=>{i.interactions.find(d=>d.type===h.type)||Pi(r,t,h)})),e.type==="Group"){const h=e.layers.map(d=>{var u;return(u=d.properties)==null?void 0:u.id}),c=t.getLayers();c.forEach(d=>{h.includes(d.get("id"))||c.remove(d)}),e.layers.forEach(d=>{const u=d.properties.id;if(c.getArray().map(g=>g.get("id")).includes(u))Si(r,d,r.getLayerById(u));else{const g=se(r,d);c.push(g)}}),c.getArray().sort((d,u)=>h.indexOf(d.get("id"))-h.indexOf(u.get("id"))),c.changed()}return Li(t,e),t}const Er=(r,e)=>e?[...e].reverse().map(t=>se(r,t)):[];function Li(r,e){r.on("change:opacity",()=>{e.opacity=r.getOpacity()}),r.on("change:visible",()=>{e.visible=r.getVisible()}),r.on("change:zIndex",()=>{e.zIndex=r.getZIndex()}),r.on("propertychange",t=>{t.key!=="map"&&(e.properties[t.key]=t.target.get(t.key))})}function Xe(r,e){return Ii(r.map.getLayers().getArray()).find(i=>i.get("id")===e)}function Ii(r){const e=[];e.push(...r);let t=e.filter(i=>i instanceof $);for(;t.length;){const i=[];for(let n=0,s=t.length;n<s;n++){const o=t[n].getLayers().getArray();e.push(...o),i.push(...o.filter(a=>a instanceof $))}t=i}return e}function Cr(r){if(r){const e=r;return!U(e,[0,0])&&e[0]>=-180&&e[0]<=180&&e[1]>=-90&&e[1]<=90?kn(e):e}return[0,0]}const Ot=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange"],Nt={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class br extends D{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.on,this.once,this.un,this.keys_=e.keys!==void 0?e.keys:!1,this.source_=e.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=e.className!==void 0?e.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=e.activeClassName!==void 0?e.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=e.inactiveClassName!==void 0?e.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const t=e.label!==void 0?e.label:"⤢";this.labelNode_=typeof t=="string"?document.createTextNode(t):t;const i=e.labelActive!==void 0?e.labelActive:"×";this.labelActiveNode_=typeof i=="string"?document.createTextNode(i):i;const n=e.tipLabel?e.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=n,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(p.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${G} ${Z}`,this.element.appendChild(this.button_)}handleClick_(e){e.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const e=this.getMap();if(!e)return;const t=e.getOwnerDocument();if(Dt(t))if(Mt(t))xr(t);else{let i;this.source_?i=typeof this.source_=="string"?t.getElementById(this.source_):this.source_:i=e.getTargetElement(),this.keys_?wr(i):Ri(i)}}handleFullScreenChange_(){const e=this.getMap();if(!e)return;const t=this.isInFullscreen_;this.isInFullscreen_=Mt(e.getOwnerDocument()),t!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(ne(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(Nt.ENTERFULLSCREEN)):(ne(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(Nt.LEAVEFULLSCREEN)),e.updateSize())}setClassName_(e,t){t?(e.classList.remove(...this.inactiveClassName_),e.classList.add(...this.activeClassName_)):(e.classList.remove(...this.activeClassName_),e.classList.add(...this.inactiveClassName_))}setMap(e){const t=this.getMap();t&&t.removeChangeListener(T.TARGET,this.boundHandleMapTargetChange_),super.setMap(e),this.handleMapTargetChange_(),e&&e.addChangeListener(T.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const e=this.documentListeners_;for(let i=0,n=e.length;i<n;++i)I(e[i]);e.length=0;const t=this.getMap();if(t){const i=t.getOwnerDocument();Dt(i)?this.element.classList.remove(wt):this.element.classList.add(wt);for(let n=0,s=Ot.length;n<s;++n)e.push(w(i,Ot[n],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function Dt(r){const e=r.body;return!!(e.webkitRequestFullscreen||e.requestFullscreen&&r.fullscreenEnabled)}function Mt(r){return!!(r.webkitIsFullScreen||r.fullscreenElement)}function Ri(r){r.requestFullscreen?r.requestFullscreen():r.webkitRequestFullscreen&&r.webkitRequestFullscreen()}function wr(r){r.webkitRequestFullscreen?r.webkitRequestFullscreen():Ri(r)}function xr(r){r.exitFullscreen?r.exitFullscreen():r.webkitExitFullscreen&&r.webkitExitFullscreen()}const Tr=br,Je="projection",Ft="coordinateFormat";class Pr extends D{constructor(e){e=e||{};const t=document.createElement("div");t.className=e.className!==void 0?e.className:"ol-mouse-position",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un,this.addChangeListener(Je,this.handleProjectionChanged_),e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat),e.projection&&this.setProjection(e.projection),this.renderOnMouseOut_=e.placeholder!==void 0,this.placeholder_=this.renderOnMouseOut_?e.placeholder:"&#160;",this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=e.wrapX!==!1}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(Ft)}getProjection(){return this.get(Je)}handleMouseMove(e){const t=this.getMap();this.updateHTML_(t.getEventPixel(e))}handleMouseOut(e){this.updateHTML_(null)}setMap(e){if(super.setMap(e),e){const t=e.getViewport();this.listenerKeys.push(w(t,V.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(w(t,V.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(e){this.set(Ft,e)}setProjection(e){this.set(Je,Me(e))}updateHTML_(e){let t=this.placeholder_;if(e&&this.mapProjection_){if(!this.transform_){const s=this.getProjection();s?this.transform_=qt(this.mapProjection_,s):this.transform_=Yt}const n=this.getMap().getCoordinateFromPixelInternal(e);if(n){if(this.transform_(n,n),this.wrapX_){const o=this.getProjection()||this.mapProjection_;zt(n,o)}const s=this.getCoordinateFormat();s?t=s(n):t=n.toString()}}(!this.renderedHTML_||t!==this.renderedHTML_)&&(this.element.innerHTML=t,this.renderedHTML_=t)}render(e){const t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}}const Sr=Pr,Qe=.75,Le=.1;class Lr extends D{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=e.rotateWithView!==void 0?e.rotateWithView:!1,this.viewExtent_=void 0;const t=e.className!==void 0?e.className:"ol-overviewmap",i=e.tipLabel!==void 0?e.tipLabel:"Overview map",n=e.collapseLabel!==void 0?e.collapseLabel:"‹";typeof n=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=n):this.collapseLabel_=n;const s=e.label!==void 0?e.label:"›";typeof s=="string"?(this.label_=document.createElement("span"),this.label_.textContent=s):this.label_=s;const o=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,a=document.createElement("button");a.setAttribute("type","button"),a.title=i,a.appendChild(o),a.addEventListener(p.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const l=new vi({view:e.view,controls:new R,interactions:new R});this.ovmap_=l,e.layers&&e.layers.forEach(function(E){l.addLayer(E)});const h=document.createElement("div");h.className="ol-overviewmap-box",h.style.boxSizing="border-box",this.boxOverlay_=new Ei({position:[0,0],positioning:"center-center",element:h}),this.ovmap_.addOverlay(this.boxOverlay_);const c=t+" "+G+" "+Z+(this.collapsed_&&this.collapsible_?" "+Oe:"")+(this.collapsible_?"":" ol-uncollapsible"),d=this.element;d.className=c,d.appendChild(this.ovmapDiv_),d.appendChild(a);const u=this,g=this.boxOverlay_,f=this.boxOverlay_.getElement(),_=function(E){return{clientX:E.clientX,clientY:E.clientY}},y=function(E){const x=_(E),C=l.getEventCoordinateInternal(x);g.setPosition(C)},v=function(E){const x=l.getEventCoordinateInternal(E);u.getMap().getView().setCenterInternal(x),window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",v)};f.addEventListener("mousedown",function(){window.addEventListener("mousemove",y),window.addEventListener("mouseup",v)})}setMap(e){const t=this.getMap();if(e!==t){if(t){const i=t.getView();i&&this.unbindView_(i),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(w(e,Ie.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const i=e.getView();i&&(this.bindView_(i),i.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===T.VIEW){const t=e.oldValue;t&&this.unbindView_(t);const i=this.getMap().getView();this.bindView_(i)}else!this.ovmap_.isRendered()&&(e.key===T.TARGET||e.key===T.SIZE)&&this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const t=new k({projection:e.getProjection()});this.ovmap_.setView(t)}e.addChangeListener(xt.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_()}unbindView_(e){e.removeChangeListener(xt.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const i=e.getSize(),s=e.getView().calculateExtentInternal(i);if(this.viewExtent_&&tt(s,this.viewExtent_))return;this.viewExtent_=s;const o=t.getSize(),l=t.getView().calculateExtentInternal(o),h=t.getPixelFromCoordinateInternal(si(s)),c=t.getPixelFromCoordinateInternal(ni(s)),d=Math.abs(h[0]-c[0]),u=Math.abs(h[1]-c[1]),g=o[0],f=o[1];d<g*Le||u<f*Le||d>g*Qe||u>f*Qe?this.resetExtent_():Xt(l,s)||this.recenter_()}resetExtent_(){const e=this.getMap(),t=this.ovmap_,i=e.getSize(),s=e.getView().calculateExtentInternal(i),o=t.getView(),a=Math.log(Qe/Le)/Math.LN2,l=1/(Math.pow(2,a/2)*Le);Vn(s,l),o.fitInternal(ai(s))}recenter_(){const e=this.getMap(),t=this.ovmap_,i=e.getView();t.getView().setCenterInternal(i.getCenterInternal())}updateBox_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const i=e.getSize(),n=e.getView(),s=t.getView(),o=this.rotateWithView_?0:-n.getRotation(),a=this.boxOverlay_,l=this.boxOverlay_.getElement(),h=n.getCenterInternal(),c=n.getResolution(),d=s.getResolution(),u=i[0]*c/d,g=i[1]*c/d;if(a.setPosition(h),l){l.style.width=u+"px",l.style.height=g+"px";const f="rotate("+o+"rad)";l.style.transform=f}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=Gn(this.ovmap_,A.POSTRENDER,function(e){delete this.ovmapPostrenderKey_,this.updateBox_()},this))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(Oe),this.collapsed_?ne(this.collapseLabel_,this.label_):ne(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered()){this.viewExtent_=void 0,e.render();return}e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){!this.collapsible_||this.collapsed_===e||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}}const Ir=Lr,et="units",Rr=[1,2,5],ae=25.4/.28;class Or extends D{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const i=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" "+G,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(et,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(et)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(et,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,i=e.projection,n=this.getUnits(),s=n=="degrees"?"degrees":"m";let o=ke(i,e.resolution,t,s);const a=this.minWidth_*(this.dpi_||ae)/ae,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||ae)/ae:void 0;let h=a*o,c="";if(n=="degrees"){const x=zn.degrees;h*=x,h<x/60?(c="″",o*=3600):h<x?(c="′",o*=60):c="°"}else if(n=="imperial")h<.9144?(c="in",o/=.0254):h<1609.344?(c="ft",o/=.3048):(c="mi",o/=1609.344);else if(n=="nautical")o/=1852,c="NM";else if(n=="metric")h<1e-6?(c="nm",o*=1e9):h<.001?(c="μm",o*=1e6):h<1?(c="mm",o*=1e3):h<1e3?c="m":(c="km",o/=1e3);else if(n=="us")h<.9144?(c="in",o*=39.37):h<1609.344?(c="ft",o/=.30480061):(c="mi",o/=1609.3472);else throw new Error("Invalid units");let d=3*Math.floor(Math.log(a*o)/Math.log(10)),u,g,f,_,y,v;for(;;){f=Math.floor(d/3);const x=Math.pow(10,f);if(u=Rr[(d%3+3)%3]*x,g=Math.round(u/o),isNaN(g)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&g>=l){u=_,g=y,f=v;break}else if(g>=a)break;_=u,y=g,v=f,++d}const E=this.scaleBar_?this.createScaleBar(g,u,c):u.toFixed(f<0?-f:0)+" "+c;this.renderedHTML_!=E&&(this.innerElement_.innerHTML=E,this.renderedHTML_=E),this.renderedWidth_!=g&&(this.innerElement_.style.width=g+"px",this.renderedWidth_=g),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,i){const n=this.getScaleForResolution(),s=n<1?Math.round(1/n).toLocaleString()+" : 1":"1 : "+Math.round(n).toLocaleString(),o=this.scaleBarSteps_,a=e/o,l=[this.createMarker("absolute")];for(let c=0;c<o;++c){const d=c%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${d}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(c%2===0||o===2?this.createStepText(c,e,!1,t,i):"")+"</div>")}return l.push(this.createStepText(o,e,!0,t,i)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+s+"</div>":"")+l.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,i,n,s){const a=(e===0?0:Math.round(n/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+s),l=e===0?-3:t/this.scaleBarSteps_*-1,h=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${l}px;text-align: ${e===0?"left":"center"};min-width: ${h}px;left: ${i?t+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const e=ke(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||ae,i=1e3/25.4;return e*i*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}const Nr=Or,le={VERTICAL:0,HORIZONTAL:1};class Dr extends D{constructor(e){e=e||{},super({target:e.target,element:document.createElement("div"),render:e.render}),this.dragListenerKeys_=[],this.currentResolution_=void 0,this.direction_=le.VERTICAL,this.dragging_,this.heightLimit_=0,this.widthLimit_=0,this.startX_,this.startY_,this.thumbSize_=null,this.sliderInitialized_=!1,this.duration_=e.duration!==void 0?e.duration:200;const t=e.className!==void 0?e.className:"ol-zoomslider",i=document.createElement("button");i.setAttribute("type","button"),i.className=t+"-thumb "+G;const n=this.element;n.className=t+" "+G+" "+Z,n.appendChild(i),n.addEventListener(V.POINTERDOWN,this.handleDraggerStart_.bind(this),!1),n.addEventListener(V.POINTERMOVE,this.handleDraggerDrag_.bind(this),!1),n.addEventListener(V.POINTERUP,this.handleDraggerEnd_.bind(this),!1),n.addEventListener(p.CLICK,this.handleContainerClick_.bind(this),!1),i.addEventListener(p.CLICK,Kn,!1)}setMap(e){super.setMap(e),e&&e.render()}initSlider_(){const e=this.element;let t=e.offsetWidth,i=e.offsetHeight;if(t===0&&i===0)return this.sliderInitialized_=!1;const n=getComputedStyle(e);t-=parseFloat(n.paddingRight)+parseFloat(n.paddingLeft),i-=parseFloat(n.paddingTop)+parseFloat(n.paddingBottom);const s=e.firstElementChild,o=getComputedStyle(s),a=s.offsetWidth+parseFloat(o.marginRight)+parseFloat(o.marginLeft),l=s.offsetHeight+parseFloat(o.marginTop)+parseFloat(o.marginBottom);return this.thumbSize_=[a,l],t>i?(this.direction_=le.HORIZONTAL,this.widthLimit_=t-a):(this.direction_=le.VERTICAL,this.heightLimit_=i-l),this.sliderInitialized_=!0}handleContainerClick_(e){const t=this.getMap().getView(),i=this.getRelativePosition_(e.offsetX-this.thumbSize_[0]/2,e.offsetY-this.thumbSize_[1]/2),n=this.getResolutionForPosition_(i),s=t.getConstrainedZoom(t.getZoomForResolution(n));t.animateInternal({zoom:s,duration:this.duration_,easing:re})}handleDraggerStart_(e){if(!this.dragging_&&e.target===this.element.firstElementChild){const t=this.element.firstElementChild;if(this.getMap().getView().beginInteraction(),this.startX_=e.clientX-parseFloat(t.style.left),this.startY_=e.clientY-parseFloat(t.style.top),this.dragging_=!0,this.dragListenerKeys_.length===0){const i=this.handleDraggerDrag_,n=this.handleDraggerEnd_,s=this.getMap().getOwnerDocument();this.dragListenerKeys_.push(w(s,V.POINTERMOVE,i,this),w(s,V.POINTERUP,n,this))}}}handleDraggerDrag_(e){if(this.dragging_){const t=e.clientX-this.startX_,i=e.clientY-this.startY_,n=this.getRelativePosition_(t,i);this.currentResolution_=this.getResolutionForPosition_(n),this.getMap().getView().setResolution(this.currentResolution_)}}handleDraggerEnd_(e){this.dragging_&&(this.getMap().getView().endInteraction(),this.dragging_=!1,this.startX_=void 0,this.startY_=void 0,this.dragListenerKeys_.forEach(I),this.dragListenerKeys_.length=0)}setThumbPosition_(e){const t=this.getPositionForResolution_(e),i=this.element.firstElementChild;this.direction_==le.HORIZONTAL?i.style.left=this.widthLimit_*t+"px":i.style.top=this.heightLimit_*t+"px"}getRelativePosition_(e,t){let i;return this.direction_===le.HORIZONTAL?i=e/this.widthLimit_:i=t/this.heightLimit_,Ne(i,0,1)}getResolutionForPosition_(e){return this.getMap().getView().getResolutionForValueFunction()(1-e)}getPositionForResolution_(e){const t=this.getMap().getView().getValueForResolutionFunction();return Ne(1-t(e),0,1)}render(e){if(!e.frameState||!this.sliderInitialized_&&!this.initSlider_())return;const t=e.frameState.viewState.resolution;this.currentResolution_=t,this.setThumbPosition_(t)}}const Mr=Dr;class Fr extends D{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.extent=e.extent?e.extent:null;const t=e.className!==void 0?e.className:"ol-zoom-extent",i=e.label!==void 0?e.label:"E",n=e.tipLabel!==void 0?e.tipLabel:"Fit to extent",s=document.createElement("button");s.setAttribute("type","button"),s.title=n,s.appendChild(typeof i=="string"?document.createTextNode(i):i),s.addEventListener(p.CLICK,this.handleClick_.bind(this),!1);const o=t+" "+G+" "+Z,a=this.element;a.className=o,a.appendChild(s)}handleClick_(e){e.preventDefault(),this.handleZoomToExtent()}handleZoomToExtent(){const t=this.getMap().getView(),i=this.extent?Jt(this.extent,t.getProjection()):t.getProjection().getExtent();t.fitInternal(ai(i))}}const Ar=Fr,kr=Object.freeze(Object.defineProperty({__proto__:null,Attribution:li,Control:D,FullScreen:Tr,MousePosition:Sr,OverviewMap:Ir,Rotate:hi,ScaleLine:Nr,Zoom:ci,ZoomSlider:Mr,ZoomToExtent:Ar,defaults:di},Symbol.toStringTag,{value:"Module"}));class Vr extends D{constructor(e){const t=e||{},i=document.createElement("div");i.className="geolocation ol-unselectable ol-control";const n=document.createElement("button");if(t.buttonIcon){const s=document.createElement("img");s.src=t.buttonIcon,s.style.height="100%",s.style.width="100%",s.style.position="absolute",s.style.pointerEvents="none",i.appendChild(s)}else n.innerHTML="&#6816";i.appendChild(n),super({element:i}),this._centerWhenReady=t.centerWhenReady,this._highAccuracy=t.highAccuracy,this._trackAccuracy=t.trackAccuracy,this._trackHeading=t.trackHeading,this._positionFeature=new j({geometry:new te([0,0]),heading:0}),this._source=new Ke({features:[this._positionFeature]}),this._trackAccuracy&&(this._accuracyFeature=new j,this._accuracyFeature.setStyle(new jn({fill:new Un({color:"rgba(0, 0, 0, 0.2)"}),stroke:new Hn({width:2,color:"rgba(0, 0, 0, 0.7)"})})),this._source.addFeature(this._accuracyFeature)),this._layer=new ye({source:this._source}),t.style&&this._layer.setStyle(t.style),n.addEventListener("click",this.centerOnPosition.bind(this),!1)}setMap(e){e&&(this._geolocation=new Bs({tracking:!0,trackingOptions:{enableHighAccuracy:this._highAccuracy},projection:e.getView().getProjection()}),this._centerWhenReady&&this._geolocation.once("change:position",t=>{e.getView().setCenter(t.target.getPosition())}),this._geolocation.on("error",function(t){console.log(t)}),this._geolocation.on("change:accuracyGeometry",()=>{this._trackAccuracy&&this._accuracyFeature.setGeometry(this._geolocation.getAccuracyGeometry())}),this._geolocation.on("change:heading",t=>{this._trackHeading&&this._highAccuracy&&this._positionFeature.set("heading",t.target.getHeading())}),this._geolocation.on("change:position",()=>{const t=this._geolocation.getPosition();this._positionFeature.getGeometry().setCoordinates(t||null)}),this._geolocation.on("change:accuracyGeometry",()=>{this._trackAccuracy&&this._accuracyFeature&&this._accuracyFeature.setGeometry(this._geolocation.getAccuracyGeometry())})),this._layer.setMap(e),super.setMap(e)}getElement(){return this.element}centerOnPosition(){this.getMap().getView().setCenter(this._geolocation.getPosition())}}const Gr={...kr,Geolocation:Vr};function zr(r,e,t,i){e&&e[t]?JSON.stringify(e[t])!==JSON.stringify(i)&&(r.removeControl(t),At(r,t,i)):At(r,t,i)}function At(r,e,t){const i=Object.assign({},t);t&&t.layers&&(i.layers=Er(r,t.layers));const n=new Gr[e](i);r.map.addControl(n),r.mapControls[e]=n}var Kr=Object.defineProperty,jr=Object.getOwnPropertyDescriptor,Ur=(r,e,t,i)=>{for(var n=i>1?void 0:i?jr(e,t):e,s=r.length-1,o;s>=0;s--)(o=r[s])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Kr(e,t,n),n};class Oi extends xi{constructor(){super(...arguments),this.value=50}render(){return ee`
      <style>
        :host {
          display: block;
        }
        /* Inspired by https://www.codehim.com/html5-css3/html-css-image-comparison-slider/ */
        .eox-map-compare {
          --thumb-bgc: #fff;
          --thumb-w: 0.2rem;

          position: relative;
        }
        .eox-map-compare::after {
          content: "";
          display: block;
          padding-bottom: 50%;
        }
        .eox-map-compare__first,
        .eox-map-compare__second {
          height: 100%;
          object-fit: cover;
          position: absolute;
          top: 0;
          width: 100%;
        }
        .eox-map-compare__first {
          clip-path: polygon(
            0% 0%,
            ${this.value}% 0%,
            ${this.value}% 100%,
            0% 100%
          );
        }
        .eox-map-compare__second {
          clip-path: polygon(
            100% 0%,
            ${this.value}% 0%,
            ${this.value}% 100%,
            100% 100%
          );
        }
        .eox-map-compare__range {
          background-color: transparent;
          box-sizing: border-box;
          font-family: inherit;
          height: 100%;
          margin: 0;
          outline: none;
          position: absolute;
          top: 0;
          width: 100%;
          pointer-events: none;
        }
        .eox-map-compare__range::-moz-range-thumb {
          background-color: var(--thumb-bgc);
          cursor: ew-resize;
          height: 100%;
          width: var(--thumb-w);
          pointer-events: all;
          box-shadow: 0 0 5px black;
          clip-path: inset(0 -5px 0 -5px);
        }
        .eox-map-compare__range::-webkit-slider-thumb {
          background-color: var(--thumb-bgc);
          cursor: ew-resize;
          height: 100%;
          width: var(--thumb-w);
          pointer-events: all;
          position: relative;
          box-shadow: 0 0 5px black;
          -webkit-clip-path: inset(0 -5px 0 -5px);
          clip-path: inset(0 -5px 0 -5px);
        }
        .eox-map-compare__range::-moz-range-track {
          background: transparent;
          background-size: 100%;
          box-sizing: border-box;
        }
        .eox-map-compare__range::-webkit-slider-runnable-track {
          background: transparent;
          background-size: 100%;
          box-sizing: border-box;
          height: 100%;
        }
        .eox-map-compare__range,
        .eox-map-compare__range::-webkit-slider-runnable-track,
        .eox-map-compare__range::-webkit-slider-thumb {
          -webkit-appearance: none;
          appearance: none;
        }
      </style>
      <div class="eox-map-compare">
        <div class="eox-map-compare__first">
          <slot name="first"></slot>
        </div>
        <div class="eox-map-compare__second">
          <slot name="second"></slot>
        </div>
        <input
          type="range"
          class="eox-map-compare__range"
          min="0"
          max="100"
          value=${this.value}
          @input=${e=>this.value=parseInt(e.target.value)}
        />
      </div>
    `}}Ur([B()],Oi.prototype,"value",2);customElements.define("eox-map-compare",Oi);function Hr(r,e,t=.001){let i=!0;for(let n=r.length-1;n>=0;--n)if(!Br(r[n],e[n],t)){i=!1;break}return i}function Br(r,e,t=.001){return Math.abs(r-e)<t}function kt(r,e=!1){e?(r.addInteraction(new Ge({condition:Tt})),"ontouchstart"in window||navigator.maxTouchPoints>0?r.addInteraction(new ue({condition:function(i){return this.getPointerCount()===2||Tt(i)}})):r.addInteraction(new ue)):(r.addInteraction(new Ge),r.addInteraction(new ue))}function Wr(r){r.getInteractions().getArray().forEach(e=>{(e instanceof Ge||e instanceof ue)&&r.removeInteraction(e)})}var $r=Object.defineProperty,Zr=Object.getOwnPropertyDescriptor,M=(r,e,t,i)=>{for(var n=i>1?void 0:i?Zr(e,t):e,s=r.length-1,o;s>=0;s--)(o=r[s])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&$r(e,t,n),n};let O=class extends Vt{constructor(){super(...arguments),this._center=[0,0],this.zoom=0,this.map=new vi({controls:[],layers:[],view:new k({center:[0,0],zoom:0,projection:this.projection})}),this.interactions={},this.selectInteractions={},this.mapControls={},this.addOrUpdateLayer=r=>{var n;r.interactions||(r.interactions=[]);const e=(n=r.properties)==null?void 0:n.id,t=e?Xe(this,e):!1;let i;return t?(Si(this,r,t),i=t):(i=se(this,r),this.map.addLayer(i)),i},this.removeInteraction=r=>{this.map.removeInteraction(this.interactions[r]),delete this.interactions[r],this.interactions[`${r}_modify`]&&(this.map.removeInteraction(this.interactions[`${r}_modify`]),delete this.interactions[`${r}_modify`])},this.removeSelect=r=>{this.selectInteractions[r].remove(),delete this.selectInteractions[r]},this.removeControl=r=>{this.map.removeControl(this.mapControls[r]),delete this.mapControls[r]},this.getLayerById=r=>Xe(this,r),this.parseFeature=r=>new je().writeFeaturesObject(r,ct),this.parseTextToFeature=(r,e,t=!1)=>{sr(r,e,this,t)},this.registerProjectionFromCode=hr,this.registerProjection=cr,this.getFlatLayersArray=Ii}set center(r){const e=(r==null?void 0:r.length)&&Hr(r,this.map.getView().getCenter());if(r&&!e)if(!this.projection||this.projection==="EPSG:3857"){const t=Cr(r);this.map.getView().setCenter(t),this._center=t}else this.map.getView().setCenter(r),this._center=r}get center(){return this._center}set controls(r){const e=this._controls,t=r;if(e){const i=Object.keys(e),n=Object.keys(t);for(let s=0,o=i.length;s<o;s++){const a=i[s];n.includes(a)||this.removeControl(a)}}if(t){const i=Object.keys(r);for(let n=0,s=i.length;n<s;n++){const o=i[n];zr(this,e,o,r[o])}}this._controls=t}get controls(){return this._controls}set layers(r){const e=this._layers,t=JSON.parse(JSON.stringify(r)).reverse();e&&e.forEach(n=>{var s,o;if(!((s=n.properties)!=null&&s.id)||!t.find(a=>a.properties.id===n.properties.id)){const a=Xe(this,(o=n.properties)==null?void 0:o.id);this.map.removeLayer(a)}}),t.forEach(n=>{this.addOrUpdateLayer(n)});const i=t.map(n=>{var s;return(s=n.properties)==null?void 0:s.id});this.map.getLayers().getArray().sort((n,s)=>i.indexOf(n.get("id"))-i.indexOf(s.get("id"))),this._layers=t}get layers(){return this._layers}set preventScroll(r){r?(Wr(this.map),kt(this.map,!0)):kt(this.map),this._preventScroll=r}get preventScroll(){return this._preventScroll}set config(r){var e,t,i;this._config=r,this.zoom=(e=r==null?void 0:r.view)==null?void 0:e.zoom,this.projection=((t=r==null?void 0:r.view)==null?void 0:t.projection)||"EPSG:3857",this.center=(i=r.view)==null?void 0:i.center,this.layers=r==null?void 0:r.layers,this.controls=r==null?void 0:r.controls,this.preventScroll===void 0&&(this.preventScroll=r==null?void 0:r.preventScroll)}get config(){return this._config}get projection(){return this._projection}set projection(r){const e=this.map.getView();if(r&&r!==e.getProjection().getCode()){const t=Bn(e.getCenter(),e.getProjection().getCode(),r),i=Me(r),n=e.getResolution(),s=e.getProjection().getMetersPerUnit(),o=i.getMetersPerUnit(),a=ke(e.getProjection(),1/s,e.getCenter(),"m")*s,l=ke(i,1/o,t,"m")*o,h=n*a/l,c=new k({zoom:e.getZoom(),center:t,resolution:h,rotation:e.getRotation(),projection:r});["change:center","change:resolution","change:rotation","propertychange"].forEach(u=>{const g=e.getListeners(u);if(g!=null&&g.length)for(let f=g.length-1;f>=0;f--){const _=g[f];e.un(u,_),c.on(u,_)}}),this.map.setView(c),this.getFlatLayersArray(this.map.getLayers().getArray()).filter(u=>u instanceof ye).forEach(u=>u.getSource().refresh()),this._projection=r,this.center=t}}render(){return ee`
      <style>
        ${`
      :host {
        display: block;
      }
      .eox-map-tooltip {
        pointer-events: none !important;
      }
    `}
        ${Gs}
        ${zs}
      </style>
      <div style="width: 100%; height: 100%"></div>
      <slot></slot>
    `}buffer(r,e){return Qt(r,e)}firstUpdated(){if(this.sync){const r=document.querySelector(this.sync);r&&this.map.setView(r.map.getView())}this.map.once("change:target",r=>{r.target.getView().setCenter(this.center)}),this.map.setTarget(this.renderRoot.querySelector("div")),this.map.on("loadend",()=>{this.dispatchEvent(new CustomEvent("loadend",{detail:this.map}))})}updated(r){r.has("zoom")&&this.map.getView().setZoom(this.zoom||0)}};M([B({attribute:!1,type:Array})],O.prototype,"layers",1);M([B({attribute:"prevent-scroll",type:Boolean})],O.prototype,"preventScroll",1);M([B({attribute:!1,type:Object})],O.prototype,"config",1);M([B({attribute:"projection",type:String})],O.prototype,"projection",1);M([B({attribute:!1,type:Number})],O.prototype,"zoom",2);M([B()],O.prototype,"sync",2);M([ze()],O.prototype,"map",2);M([ze()],O.prototype,"interactions",2);M([ze()],O.prototype,"selectInteractions",2);M([ze()],O.prototype,"mapControls",2);O=M([Mi("eox-map")],O);export{xi as T};
