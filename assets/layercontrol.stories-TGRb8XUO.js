var L3=Object.defineProperty;var P3=(s,t,e)=>t in s?L3(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var ls=(s,t,e)=>(P3(s,typeof t!="symbol"?t+"":t,e),e),b1=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var Ti=(s,t,e)=>(b1(s,t,"read from private field"),e?e.call(s):t.get(s)),Ae=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},Pd=(s,t,e,i)=>(b1(s,t,"write to private field"),i?i.call(s,e):t.set(s,e),e);var Ss=(s,t,e)=>(b1(s,t,"access private method"),e);import{_ as kl}from"./iframe-e2n9tP5e.js";import{x as Qt,T as ao,w as Bf,s as xa}from"./lit-element-uhisBW42.js";import{e as O3,i as F3,t as tc,n as Fn}from"./when-fh6s5Pmf.js";import{_ as vA,c as k3}from"./index-EJ4ljtJk.js";import{f as N3,m as D3}from"./directive-helpers-qkjFCehB.js";import{o as $3}from"./unsafe-html-rU-ujVzY.js";import{o as Pm}from"./map-K4dZiwsf.js";import{b as j3}from"./button--cdmXcoW.js";import{r as G3,c as bA,s as z3}from"./slider-MCblB636.js";var B3=Object.defineProperty,U3=(s,t,e)=>t in s?B3(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,Bb=(s,t,e)=>(U3(s,typeof t!="symbol"?t+"":t,e),e);let V3=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}};const Eo=V3,Ub={PROPERTYCHANGE:"propertychange"};let H3=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};const Vb=H3;function W3(s,t,e){let i,r;e=e||la;let n=0,o=s.length,a=!1;for(;n<o;)i=n+(o-n>>1),r=+e(s[i],t),r<0?n=i+1:(o=i,a=!r);return a?n:~n}function la(s,t){return s>t?1:s<t?-1:0}function X3(s,t){return s<t?1:s>t?-1:0}function G_(s,t,e){if(s[0]<=t)return 0;const i=s.length;if(t<=s[i-1])return i-1;if(typeof e=="function"){for(let r=1;r<i;++r){const n=s[r];if(n===t)return r;if(n<t)return e(t,s[r-1],n)>0?r-1:r}return i-1}if(e>0){for(let r=1;r<i;++r)if(s[r]<t)return r-1;return i-1}if(e<0){for(let r=1;r<i;++r)if(s[r]<=t)return r;return i-1}for(let r=1;r<i;++r){if(s[r]==t)return r;if(s[r]<t)return s[r-1]-t<t-s[r]?r-1:r}return i-1}function q3(s,t,e){for(;t<e;){const i=s[t];s[t]=s[e],s[e]=i,++t,--e}}function Se(s,t){const e=Array.isArray(t)?t:[t],i=e.length;for(let r=0;r<i;r++)s[s.length]=e[r]}function $h(s,t){const e=s.length;if(e!==t.length)return!1;for(let i=0;i<e;i++)if(s[i]!==t[i])return!1;return!0}function Y3(s,t,e){const i=t||la;return s.every(function(r,n){if(n===0)return!0;const o=i(s[n-1],r);return!(o>0||e&&o===0)})}function Z3(){return!0}function $p(){}function wA(s){let t=!1,e,i,r;return function(){const n=Array.prototype.slice.call(arguments);return(!t||this!==r||!$h(n,i))&&(t=!0,r=this,i=n,e=s.apply(this,arguments)),e}}function EA(s){function t(){let e;try{e=s()}catch(i){return Promise.reject(i)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function ed(s){for(const t in s)delete s[t]}function ha(s){let t;for(t in s)return!1;return!t}let K3=class extends Vb{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),r=i[t]||(i[t]=[]);r.includes(e)||r.push(e)}dispatchEvent(t){const e=typeof t=="string",i=e?t:t.type,r=this.listeners_&&this.listeners_[i];if(!r)return;const n=e?new Eo(t):t;n.target||(n.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});i in o||(o[i]=0,a[i]=0),++o[i];let l;for(let h=0,c=r.length;h<c;++h)if("handleEvent"in r[h]?l=r[h].handleEvent(n):l=r[h].call(this,n),l===!1||n.propagationStopped){l=!1;break}if(--o[i]===0){let h=a[i];for(delete a[i];h--;)this.removeEventListener(i,$p);delete o[i]}return l}disposeInternal(){this.listeners_&&ed(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const i=this.listeners_[t];if(!i)return;const r=i.indexOf(e);r!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[r]=$p,++this.pendingRemovals_[t]):(i.splice(r,1),i.length===0&&delete this.listeners_[t]))}};const Dg=K3,fe={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function Ai(s,t,e,i,r){if(i&&i!==s&&(e=e.bind(i)),r){const o=e;e=function(){s.removeEventListener(t,e),o.apply(this,arguments)}}const n={target:s,type:t,listener:e};return s.addEventListener(t,e),n}function jp(s,t,e,i){return Ai(s,t,e,i,!0)}function cs(s){s&&s.target&&(s.target.removeEventListener(s.type,s.listener),ed(s))}let z_=class extends Dg{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(fe.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,r=new Array(i);for(let n=0;n<i;++n)r[n]=Ai(this,t[n],e);return r}return Ai(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const r=t.length;i=new Array(r);for(let n=0;n<r;++n)i[n]=jp(this,t[n],e)}else i=jp(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)J3(i);else if(Array.isArray(t))for(let r=0,n=t.length;r<n;++r)this.removeEventListener(t[r],e);else this.removeEventListener(t,e)}};z_.prototype.on;z_.prototype.once;z_.prototype.un;function J3(s){if(Array.isArray(s))for(let t=0,e=s.length;t<e;++t)cs(s[t]);else cs(s)}const SA=z_;function Lt(){throw new Error("Unimplemented abstract method.")}let Q3=0;function xt(s){return s.ol_uid||(s.ol_uid=String(++Q3))}let H2=class extends Eo{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}},t5=class extends SA{constructor(t){super(),this.on,this.once,this.un,xt(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let i;i=`change:${t}`,this.hasListener(i)&&this.dispatchEvent(new H2(i,t,e)),i=Ub.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new H2(i,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const r=this.values_||(this.values_={});if(i)r[t]=e;else{const n=r[t];r[t]=e,n!==e&&this.notify(t,n)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],ha(this.values_)&&(this.values_=null),e||this.notify(t,i)}}};const jh=t5;function ge(s,t){if(!s)throw new Error(t)}let e5=class CA extends jh{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new CA(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(cs(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=Ai(t,fe.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?i5(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}};function i5(s){if(typeof s=="function")return s;let t;return Array.isArray(s)?t=s:(ge(typeof s.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[s]),function(){return t}}const Ls=e5,Hb=new Array(6);function Ki(){return[1,0,0,1,0,0]}function Qx(s){return $g(s,1,0,0,1,0,0)}function id(s,t){const e=s[0],i=s[1],r=s[2],n=s[3],o=s[4],a=s[5],l=t[0],h=t[1],c=t[2],u=t[3],d=t[4],p=t[5];return s[0]=e*l+r*h,s[1]=i*l+n*h,s[2]=e*c+r*u,s[3]=i*c+n*u,s[4]=e*d+r*p+o,s[5]=i*d+n*p+a,s}function $g(s,t,e,i,r,n,o){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s[4]=n,s[5]=o,s}function s5(s,t){return s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[4]=t[4],s[5]=t[5],s}function Ii(s,t){const e=t[0],i=t[1];return t[0]=s[0]*e+s[2]*i+s[4],t[1]=s[1]*e+s[3]*i+s[5],t}function r5(s,t){const e=Math.cos(t),i=Math.sin(t);return id(s,$g(Hb,e,i,-i,e,0,0))}function cp(s,t,e){return id(s,$g(Hb,t,0,0,e,0,0))}function n5(s,t,e){return $g(s,t,0,0,e,0,0)}function Wb(s,t,e){return id(s,$g(Hb,1,0,0,1,t,e))}function Xr(s,t,e,i,r,n,o,a){const l=Math.sin(n),h=Math.cos(n);return s[0]=i*h,s[1]=r*l,s[2]=-i*l,s[3]=r*h,s[4]=o*i*h-a*i*l+t,s[5]=o*r*l+a*r*h+e,s}function B_(s,t){const e=o5(t);ge(e!==0,"Transformation matrix cannot be inverted");const i=t[0],r=t[1],n=t[2],o=t[3],a=t[4],l=t[5];return s[0]=o/e,s[1]=-r/e,s[2]=-n/e,s[3]=i/e,s[4]=(n*l-o*a)/e,s[5]=-(i*l-r*a)/e,s}function o5(s){return s[0]*s[3]-s[1]*s[2]}const W2=[1e6,1e6,1e6,1e6,2,2];function Xb(s){return"matrix("+s.map((t,e)=>Math.round(t*W2[e])/W2[e]).join(", ")+")"}const fs={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Cu(s){const t=Ys();for(let e=0,i=s.length;e<i;++e)up(t,s[e]);return t}function a5(s,t,e){const i=Math.min.apply(null,s),r=Math.min.apply(null,t),n=Math.max.apply(null,s),o=Math.max.apply(null,t);return $n(i,r,n,o,e)}function ln(s,t,e){return e?(e[0]=s[0]-t,e[1]=s[1]-t,e[2]=s[2]+t,e[3]=s[3]+t,e):[s[0]-t,s[1]-t,s[2]+t,s[3]+t]}function l5(s,t){return t?(t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t):s.slice()}function Gh(s,t,e){let i,r;return t<s[0]?i=s[0]-t:s[2]<t?i=t-s[2]:i=0,e<s[1]?r=s[1]-e:s[3]<e?r=e-s[3]:r=0,i*i+r*r}function Hr(s,t){return qb(s,t[0],t[1])}function rr(s,t){return s[0]<=t[0]&&t[2]<=s[2]&&s[1]<=t[1]&&t[3]<=s[3]}function qb(s,t,e){return s[0]<=t&&t<=s[2]&&s[1]<=e&&e<=s[3]}function tv(s,t){const e=s[0],i=s[1],r=s[2],n=s[3],o=t[0],a=t[1];let l=fs.UNKNOWN;return o<e?l=l|fs.LEFT:o>r&&(l=l|fs.RIGHT),a<i?l=l|fs.BELOW:a>n&&(l=l|fs.ABOVE),l===fs.UNKNOWN&&(l=fs.INTERSECTING),l}function Ys(){return[1/0,1/0,-1/0,-1/0]}function $n(s,t,e,i,r){return r?(r[0]=s,r[1]=t,r[2]=e,r[3]=i,r):[s,t,e,i]}function jg(s){return $n(1/0,1/0,-1/0,-1/0,s)}function Yb(s,t){const e=s[0],i=s[1];return $n(e,i,e,i,t)}function Zb(s,t,e,i,r){const n=jg(r);return RA(n,s,t,e,i)}function ca(s,t){return s[0]==t[0]&&s[2]==t[2]&&s[1]==t[1]&&s[3]==t[3]}function h5(s,t,e){return Math.abs(s[0]-t[0])<e&&Math.abs(s[2]-t[2])<e&&Math.abs(s[1]-t[1])<e&&Math.abs(s[3]-t[3])<e}function TA(s,t){return t[0]<s[0]&&(s[0]=t[0]),t[2]>s[2]&&(s[2]=t[2]),t[1]<s[1]&&(s[1]=t[1]),t[3]>s[3]&&(s[3]=t[3]),s}function up(s,t){t[0]<s[0]&&(s[0]=t[0]),t[0]>s[2]&&(s[2]=t[0]),t[1]<s[1]&&(s[1]=t[1]),t[1]>s[3]&&(s[3]=t[1])}function RA(s,t,e,i,r){for(;e<i;e+=r)c5(s,t[e],t[e+1]);return s}function c5(s,t,e){s[0]=Math.min(s[0],t),s[1]=Math.min(s[1],e),s[2]=Math.max(s[2],t),s[3]=Math.max(s[3],e)}function MA(s,t){let e;return e=t(U_(s)),e||(e=t(V_(s)),e)||(e=t(H_(s)),e)||(e=t(va(s)),e)?e:!1}function Gp(s){let t=0;return ba(s)||(t=Kt(s)*ci(s)),t}function U_(s){return[s[0],s[1]]}function V_(s){return[s[2],s[1]]}function vs(s){return[(s[0]+s[2])/2,(s[1]+s[3])/2]}function u5(s,t){let e;if(t==="bottom-left")e=U_(s);else if(t==="bottom-right")e=V_(s);else if(t==="top-left")e=va(s);else if(t==="top-right")e=H_(s);else throw new Error("Invalid corner");return e}function Kb(s,t,e,i,r){const[n,o,a,l,h,c,u,d]=ev(s,t,e,i);return $n(Math.min(n,a,h,u),Math.min(o,l,c,d),Math.max(n,a,h,u),Math.max(o,l,c,d),r)}function ev(s,t,e,i){const r=t*i[0]/2,n=t*i[1]/2,o=Math.cos(e),a=Math.sin(e),l=r*o,h=r*a,c=n*o,u=n*a,d=s[0],p=s[1];return[d-l+u,p-h-c,d-l-u,p-h+c,d+l-u,p+h+c,d+l+u,p+h-c,d-l+u,p-h-c]}function ci(s){return s[3]-s[1]}function us(s,t,e){const i=e||Ys();return li(s,t)?(s[0]>t[0]?i[0]=s[0]:i[0]=t[0],s[1]>t[1]?i[1]=s[1]:i[1]=t[1],s[2]<t[2]?i[2]=s[2]:i[2]=t[2],s[3]<t[3]?i[3]=s[3]:i[3]=t[3]):jg(i),i}function va(s){return[s[0],s[3]]}function H_(s){return[s[2],s[3]]}function Kt(s){return s[2]-s[0]}function li(s,t){return s[0]<=t[2]&&s[2]>=t[0]&&s[1]<=t[3]&&s[3]>=t[1]}function ba(s){return s[2]<s[0]||s[3]<s[1]}function d5(s,t){return t?(t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t):s}function IA(s,t){const e=(s[2]-s[0])/2*(t-1),i=(s[3]-s[1])/2*(t-1);s[0]-=e,s[2]+=e,s[1]-=i,s[3]+=i}function p5(s,t,e){let i=!1;const r=tv(s,t),n=tv(s,e);if(r===fs.INTERSECTING||n===fs.INTERSECTING)i=!0;else{const o=s[0],a=s[1],l=s[2],h=s[3],c=t[0],u=t[1],d=e[0],p=e[1],g=(p-u)/(d-c);let f,m;n&fs.ABOVE&&!(r&fs.ABOVE)&&(f=d-(p-h)/g,i=f>=o&&f<=l),!i&&n&fs.RIGHT&&!(r&fs.RIGHT)&&(m=p-(d-l)*g,i=m>=a&&m<=h),!i&&n&fs.BELOW&&!(r&fs.BELOW)&&(f=d-(p-a)/g,i=f>=o&&f<=l),!i&&n&fs.LEFT&&!(r&fs.LEFT)&&(m=p-(d-o)*g,i=m>=a&&m<=h)}return i}function Tu(s,t,e,i){if(ba(s))return jg(e);let r=[];if(i>1){const a=s[2]-s[0],l=s[3]-s[1];for(let h=0;h<i;++h)r.push(s[0]+a*h/i,s[1],s[2],s[1]+l*h/i,s[2]-a*h/i,s[3],s[0],s[3]-l*h/i)}else r=[s[0],s[1],s[2],s[1],s[2],s[3],s[0],s[3]];t(r,r,2);const n=[],o=[];for(let a=0,l=r.length;a<l;a+=2)n.push(r[a]),o.push(r[a+1]);return a5(n,o,e)}function Jb(s,t){const e=t.getExtent(),i=vs(s);if(t.canWrapX()&&(i[0]<e[0]||i[0]>=e[2])){const r=Kt(e),n=Math.floor((i[0]-e[0])/r)*r;s[0]-=n,s[2]-=n}return s}function g5(s,t){if(t.canWrapX()){const e=t.getExtent();if(!isFinite(s[0])||!isFinite(s[2]))return[[e[0],s[1],e[2],s[3]]];Jb(s,t);const i=Kt(e);if(Kt(s)>i)return[[e[0],s[1],e[2],s[3]]];if(s[0]<e[0])return[[s[0]+i,s[1],e[2],s[3]],[e[0],s[1],s[2],s[3]]];if(s[2]>e[2])return[[s[0],s[1],e[2],s[3]],[e[0],s[1],s[2]-i,s[3]]]}return[s]}const f5={9001:"m",9002:"ft",9003:"us-ft",9101:"radians",9102:"degrees"};function X2(s){return f5[s]}const zp={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let m5=class{constructor(s){this.code_=s.code,this.units_=s.units,this.extent_=s.extent!==void 0?s.extent:null,this.worldExtent_=s.worldExtent!==void 0?s.worldExtent:null,this.axisOrientation_=s.axisOrientation!==void 0?s.axisOrientation:"enu",this.global_=s.global!==void 0?s.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=s.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=s.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||zp[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(s){this.global_=s,this.canWrapX_=!!(s&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(s){this.defaultTileGrid_=s}setExtent(s){this.extent_=s,this.canWrapX_=!!(this.global_&&s)}setWorldExtent(s){this.worldExtent_=s}setGetPointResolution(s){this.getPointResolutionFunc_=s}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const Ru=m5,Gg=6378137,Vc=Math.PI*Gg,_5=[-Vc,-Vc,Vc,Vc],y5=[-180,-85,180,85],Uf=Gg*Math.log(Math.tan(Math.PI/2));let ec=class extends Ru{constructor(t){super({code:t,units:"m",extent:_5,global:!0,worldExtent:y5,getPointResolution:function(e,i){return e/Math.cosh(i[1]/Gg)}})}};const q2=[new ec("EPSG:3857"),new ec("EPSG:102100"),new ec("EPSG:102113"),new ec("EPSG:900913"),new ec("http://www.opengis.net/def/crs/EPSG/0/3857"),new ec("http://www.opengis.net/gml/srs/epsg.xml#3857")];function x5(s,t,e){const i=s.length;e=e>1?e:2,t===void 0&&(e>2?t=s.slice():t=new Array(i));for(let r=0;r<i;r+=e){t[r]=Vc*s[r]/180;let n=Gg*Math.log(Math.tan(Math.PI*(+s[r+1]+90)/360));n>Uf?n=Uf:n<-Uf&&(n=-Uf),t[r+1]=n}return t}function v5(s,t,e){const i=s.length;e=e>1?e:2,t===void 0&&(e>2?t=s.slice():t=new Array(i));for(let r=0;r<i;r+=e)t[r]=180*s[r]/Vc,t[r+1]=360*Math.atan(Math.exp(s[r+1]/Gg))/Math.PI-90;return t}const b5=6378137,Y2=[-180,-90,180,90],w5=Math.PI*b5/180;let ql=class extends Ru{constructor(t,e){super({code:t,units:"degrees",extent:Y2,axisOrientation:e,global:!0,metersPerUnit:w5,worldExtent:Y2})}};const Z2=[new ql("CRS:84"),new ql("EPSG:4326","neu"),new ql("urn:ogc:def:crs:OGC:1.3:CRS84"),new ql("urn:ogc:def:crs:OGC:2:84"),new ql("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new ql("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new ql("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let iv={};function E5(s){return iv[s]||iv[s.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function S5(s,t){iv[s]=t}let nu={};function Mu(s,t,e){const i=s.getCode(),r=t.getCode();i in nu||(nu[i]={}),nu[i][r]=e}function AA(s,t){let e;return s in nu&&t in nu[s]&&(e=nu[s][t]),e}function Jt(s,t,e){return Math.min(Math.max(s,t),e)}function LA(s,t,e,i,r,n){const o=r-e,a=n-i;if(o!==0||a!==0){const l=((s-e)*o+(t-i)*a)/(o*o+a*a);l>1?(e=r,i=n):l>0&&(e+=o*l,i+=a*l)}return yh(s,t,e,i)}function yh(s,t,e,i){const r=e-s,n=i-t;return r*r+n*n}function C5(s){const t=s.length;for(let i=0;i<t;i++){let r=i,n=Math.abs(s[i][i]);for(let a=i+1;a<t;a++){const l=Math.abs(s[a][i]);l>n&&(n=l,r=a)}if(n===0)return null;const o=s[r];s[r]=s[i],s[i]=o;for(let a=i+1;a<t;a++){const l=-s[a][i]/s[i][i];for(let h=i;h<t+1;h++)i==h?s[a][h]=0:s[a][h]+=l*s[i][h]}}const e=new Array(t);for(let i=t-1;i>=0;i--){e[i]=s[i][t]/s[i][i];for(let r=i-1;r>=0;r--)s[r][t]-=s[r][i]*e[i]}return e}function dp(s){return s*Math.PI/180}function Ko(s,t){const e=s%t;return e*t<0?e+t:e}function jr(s,t,e){return s+e*(t-s)}function zg(s,t){const e=Math.pow(10,t);return Math.round(s*e)/e}function Qm(s,t){return Math.round(zg(s,t))}function Hc(s,t){return Math.floor(zg(s,t))}function nl(s,t){return Math.ceil(zg(s,t))}function oh(s,t,e){const i=e!==void 0?s.toFixed(e):""+s;let r=i.indexOf(".");return r=r===-1?i.length:r,r>t?i:new Array(1+t-r).join("0")+i}function Qb(s,t){const e=(""+s).split("."),i=(""+t).split(".");for(let r=0;r<Math.max(e.length,i.length);r++){const n=parseInt(e[r]||"0",10),o=parseInt(i[r]||"0",10);if(n>o)return 1;if(o>n)return-1}return 0}function PA(s,t){return s[0]+=+t[0],s[1]+=+t[1],s}function K2(s,t,e){const i=Ko(t+180,360)-180,r=Math.abs(3600*i),n=e||0;let o=Math.floor(r/3600),a=Math.floor((r-o*3600)/60),l=zg(r-o*3600-a*60,n);l>=60&&(l=0,a+=1),a>=60&&(a=0,o+=1);let h=o+"°";return(a!==0||l!==0)&&(h+=" "+oh(a,2)+"′"),l!==0&&(h+=" "+oh(l,2,n)+"″"),i!==0&&(h+=" "+s.charAt(i<0?1:0)),h}function t0(s,t){let e=!0;for(let i=s.length-1;i>=0;--i)if(s[i]!=t[i]){e=!1;break}return e}function T5(s,t){const e=Math.cos(t),i=Math.sin(t),r=s[0]*e-s[1]*i,n=s[1]*e+s[0]*i;return s[0]=r,s[1]=n,s}function R5(s,t){return s[0]*=t,s[1]*=t,s}function OA(s,t){if(t.canWrapX()){const e=Kt(t.getExtent()),i=FA(s,t,e);i&&(s[0]-=i*e)}return s}function FA(s,t,e){const i=t.getExtent();let r=0;return t.canWrapX()&&(s[0]<i[0]||s[0]>i[2])&&(e=e||Kt(i),r=Math.floor((s[0]-i[0])/e)),r}const M5=63710088e-1;function J2(s,t,e){e=e||M5;const i=dp(s[1]),r=dp(t[1]),n=(r-i)/2,o=dp(t[0]-s[0])/2,a=Math.sin(n)*Math.sin(n)+Math.sin(o)*Math.sin(o)*Math.cos(i)*Math.cos(r);return 2*e*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function I5(...s){console.warn(...s)}function e0(...s){console.error(...s)}let sv=!0;function A5(s){sv=!(s===void 0||s)}function tw(s,t){if(t!==void 0){for(let e=0,i=s.length;e<i;++e)t[e]=s[e];t=t}else t=s.slice();return t}function kA(s,t){if(t!==void 0&&s!==t){for(let e=0,i=s.length;e<i;++e)t[e]=s[e];s=t}return s}function NA(s){S5(s.getCode(),s),Mu(s,s,tw)}function L5(s){s.forEach(NA)}function ct(s){return typeof s=="string"?E5(s):s||null}function Q2(s,t,e,i){s=ct(s);let r;const n=s.getPointResolutionFunc();if(n){if(r=n(t,e),i&&i!==s.getUnits()){const o=s.getMetersPerUnit();o&&(r=r*o/zp[i])}}else{const o=s.getUnits();if(o=="degrees"&&!i||i=="degrees")r=t;else{const a=zh(s,ct("EPSG:4326"));if(a===kA&&o!=="degrees")r=t*s.getMetersPerUnit();else{let h=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];h=a(h,h,2);const c=J2(h.slice(0,2),h.slice(2,4)),u=J2(h.slice(4,6),h.slice(6,8));r=(c+u)/2}const l=i?zp[i]:s.getMetersPerUnit();l!==void 0&&(r/=l)}}return r}function rv(s){L5(s),s.forEach(function(t){s.forEach(function(e){t!==e&&Mu(t,e,tw)})})}function P5(s,t,e,i){s.forEach(function(r){t.forEach(function(n){Mu(r,n,e),Mu(n,r,i)})})}function ew(s,t){return s?typeof s=="string"?ct(s):s:ct(t)}function tC(s){return function(t,e,i){const r=t.length;i=i!==void 0?i:2,e=e!==void 0?e:new Array(r);for(let n=0;n<r;n+=i){const o=s(t.slice(n,n+i)),a=o.length;for(let l=0,h=i;l<h;++l)e[n+l]=l>=a?t[n+l]:o[l]}return e}}function O5(s,t,e,i){const r=ct(s),n=ct(t);Mu(r,n,tC(e)),Mu(n,r,tC(i))}function Rs(s,t){if(s===t)return!0;const e=s.getUnits()===t.getUnits();return(s.getCode()===t.getCode()||zh(s,t)===tw)&&e}function zh(s,t){const e=s.getCode(),i=t.getCode();let r=AA(e,i);return r||(r=kA),r}function go(s,t){const e=ct(s),i=ct(t);return zh(e,i)}function iw(s,t,e){return go(t,e)(s,void 0,s.length)}function sw(s,t,e,i){const r=go(t,e);return Tu(s,r,void 0,i)}let F5=null;function k5(){return F5}function nv(s,t){return s}function ja(s,t){return sv&&!t0(s,[0,0])&&s[0]>=-180&&s[0]<=180&&s[1]>=-90&&s[1]<=90&&(sv=!1,I5("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),s}function W_(s,t){return s}function Ln(s,t){return s}function eC(s,t,e){return function(i){let r,n;if(s.canWrapX()){const o=s.getExtent(),a=Kt(o);i=i.slice(0),n=FA(i,s,a),n&&(i[0]=i[0]-n*a),i[0]=Jt(i[0],o[0],o[2]),i[1]=Jt(i[1],o[1],o[3]),r=e(i)}else r=e(i);return n&&t.canWrapX()&&(r[0]+=n*Kt(t.getExtent())),r}}function N5(){rv(q2),rv(Z2),P5(Z2,q2,x5,v5)}N5();function bl(s,t,e,i,r,n){n=n||[];let o=0;for(let a=t;a<e;a+=i){const l=s[a],h=s[a+1];n[o++]=r[0]*l+r[2]*h+r[4],n[o++]=r[1]*l+r[3]*h+r[5]}return n&&n.length!=o&&(n.length=o),n}function DA(s,t,e,i,r,n,o){o=o||[];const a=Math.cos(r),l=Math.sin(r),h=n[0],c=n[1];let u=0;for(let d=t;d<e;d+=i){const p=s[d]-h,g=s[d+1]-c;o[u++]=h+p*a-g*l,o[u++]=c+p*l+g*a;for(let f=d+2;f<d+i;++f)o[u++]=s[f]}return o&&o.length!=u&&(o.length=u),o}function D5(s,t,e,i,r,n,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=t;u<e;u+=i){const d=s[u]-l,p=s[u+1]-h;a[c++]=l+r*d,a[c++]=h+n*p;for(let g=u+2;g<u+i;++g)a[c++]=s[g]}return a&&a.length!=c&&(a.length=c),a}function $5(s,t,e,i,r,n,o){o=o||[];let a=0;for(let l=t;l<e;l+=i){o[a++]=s[l]+r,o[a++]=s[l+1]+n;for(let h=l+2;h<l+i;++h)o[a++]=s[h]}return o&&o.length!=a&&(o.length=a),o}const iC=Ki();class j5 extends jh{constructor(){super(),this.extent_=Ys(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=wA((t,e,i)=>{if(!i)return this.getSimplifiedGeometry(e);const r=this.clone();return r.applyTransform(i),r.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return Lt()}closestPointXY(t,e,i,r){return Lt()}containsXY(t,e){const i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return Lt()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&jg(e),this.extentRevision_=this.getRevision()}return d5(this.extent_,t)}rotate(t,e){Lt()}scale(t,e,i){Lt()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return Lt()}getType(){return Lt()}applyTransform(t){Lt()}intersectsExtent(t){return Lt()}translate(t,e){Lt()}transform(t,e){const i=ct(t),r=i.getUnits()=="tile-pixels"?function(n,o,a){const l=i.getExtent(),h=i.getWorldExtent(),c=ci(h)/ci(l);return Xr(iC,h[0],h[3],c,-c,0,0,0),bl(n,0,n.length,a,iC,o),go(i,e)(n,o,a)}:go(i,e);return this.applyTransform(r),this}}const rw=j5;class G5 extends rw{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return Zb(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return Lt()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=ov(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){Lt()}setLayout(t,e,i){let r;if(t)r=ov(t);else{for(let n=0;n<i;++n){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}r=e.length,t=Bh(r)}this.layout=t,this.stride=r}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const r=this.getStride();DA(i,0,i.length,r,t,e,i),this.changed()}}scale(t,e,i){e===void 0&&(e=t),i||(i=vs(this.getExtent()));const r=this.getFlatCoordinates();if(r){const n=this.getStride();D5(r,0,r.length,n,t,e,i,r),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const r=this.getStride();$5(i,0,i.length,r,t,e,i),this.changed()}}}function Bh(s){let t;return s==2?t="XY":s==3?t="XYZ":s==4&&(t="XYZM"),t}function ov(s){let t;return s=="XY"?t=2:s=="XYZ"||s=="XYM"?t=3:s=="XYZM"&&(t=4),t}function z5(s,t,e){const i=s.getFlatCoordinates();if(!i)return null;const r=s.getStride();return bl(i,0,i.length,r,t,e)}const ua=G5;function B5(s,t,e,i){for(let r=0,n=e.length;r<n;++r)s[t++]=e[r];return t}function Bg(s,t,e,i){for(let r=0,n=e.length;r<n;++r){const o=e[r];for(let a=0;a<i;++a)s[t++]=o[a]}return t}function Ug(s,t,e,i,r){r=r||[];let n=0;for(let o=0,a=e.length;o<a;++o){const l=Bg(s,t,e[o],i);r[n++]=l,t=l}return r.length=n,r}function $A(s,t,e,i,r){r=r||[];let n=0;for(let o=0,a=e.length;o<a;++o){const l=Ug(s,t,e[o],i,r[n]);l.length===0&&(l[0]=t),r[n++]=l,t=l[l.length-1]}return r.length=n,r}let U5=class av extends rw{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(cs),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,i=t.length;e<i;++e)this.changeEventsKeys_.push(Ai(t[e],fe.CHANGE,this.changed,this))}clone(){const t=new av(w1(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,i,r){if(r<Gh(this.getExtent(),t,e))return r;const n=this.geometries_;for(let o=0,a=n.length;o<a;++o)r=n[o].closestPointXY(t,e,i,r);return r}containsXY(t,e){const i=this.geometries_;for(let r=0,n=i.length;r<n;++r)if(i[r].containsXY(t,e))return!0;return!1}computeExtent(t){jg(t);const e=this.geometries_;for(let i=0,r=e.length;i<r;++i)TA(t,e[i].getExtent());return t}getGeometries(){return w1(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let i=0,r=e.length;i<r;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],i=this.geometries_;let r=!1;for(let n=0,o=i.length;n<o;++n){const a=i[n],l=a.getSimplifiedGeometry(t);e.push(l),l!==a&&(r=!0)}return r?new av(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let i=0,r=e.length;i<r;++i)if(e[i].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const i=this.geometries_;for(let r=0,n=i.length;r<n;++r)i[r].rotate(t,e);this.changed()}scale(t,e,i){i||(i=vs(this.getExtent()));const r=this.geometries_;for(let n=0,o=r.length;n<o;++n)r[n].scale(t,e,i);this.changed()}setGeometries(t){this.setGeometriesArray(w1(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let i=0,r=e.length;i<r;++i)e[i].applyTransform(t);this.changed()}translate(t,e){const i=this.geometries_;for(let r=0,n=i.length;r<n;++r)i[r].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}};function w1(s){return s.map(t=>t.clone())}const Xs=U5;function sC(s,t,e,i,r,n,o){const a=s[t],l=s[t+1],h=s[e]-a,c=s[e+1]-l;let u;if(h===0&&c===0)u=t;else{const d=((r-a)*h+(n-l)*c)/(h*h+c*c);if(d>1)u=e;else if(d>0){for(let p=0;p<i;++p)o[p]=jr(s[t+p],s[e+p],d);o.length=i;return}else u=t}for(let d=0;d<i;++d)o[d]=s[u+d];o.length=i}function nw(s,t,e,i,r){let n=s[t],o=s[t+1];for(t+=i;t<e;t+=i){const a=s[t],l=s[t+1],h=yh(n,o,a,l);h>r&&(r=h),n=a,o=l}return r}function ow(s,t,e,i,r){for(let n=0,o=e.length;n<o;++n){const a=e[n];r=nw(s,t,a,i,r),t=a}return r}function V5(s,t,e,i,r){for(let n=0,o=e.length;n<o;++n){const a=e[n];r=ow(s,t,a,i,r),t=a[a.length-1]}return r}function aw(s,t,e,i,r,n,o,a,l,h,c){if(t==e)return h;let u,d;if(r===0){if(d=yh(o,a,s[t],s[t+1]),d<h){for(u=0;u<i;++u)l[u]=s[t+u];return l.length=i,d}return h}c=c||[NaN,NaN];let p=t+i;for(;p<e;)if(sC(s,p-i,p,i,o,a,c),d=yh(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<i;++u)l[u]=c[u];l.length=i,p+=i}else p+=i*Math.max((Math.sqrt(d)-Math.sqrt(h))/r|0,1);if(n&&(sC(s,e-i,t,i,o,a,c),d=yh(o,a,c[0],c[1]),d<h)){for(h=d,u=0;u<i;++u)l[u]=c[u];l.length=i}return h}function lw(s,t,e,i,r,n,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const p=e[u];h=aw(s,t,p,i,r,n,o,a,l,h,c),t=p}return h}function H5(s,t,e,i,r,n,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const p=e[u];h=lw(s,t,p,i,r,n,o,a,l,h,c),t=p[p.length-1]}return h}function X_(s,t,e,i,r,n,o){const a=(e-t)/i;if(a<3){for(;t<e;t+=i)n[o++]=s[t],n[o++]=s[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[t,e-i];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let p=0;const g=s[d],f=s[d+1],m=s[u],_=s[u+1];for(let y=d+i;y<u;y+=i){const v=s[y],b=s[y+1],E=LA(v,b,g,f,m,_);E>p&&(c=y,p=E)}p>r&&(l[(c-t)/i]=1,d+i<c&&h.push(d,c),c+i<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(n[o++]=s[t+u*i],n[o++]=s[t+u*i+1]);return o}function jA(s,t,e,i,r,n,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=X_(s,t,c,i,r,n,o),a.push(o),t=c}return o}function ih(s,t){return t*Math.round(s/t)}function W5(s,t,e,i,r,n,o){if(t==e)return o;let a=ih(s[t],r),l=ih(s[t+1],r);t+=i,n[o++]=a,n[o++]=l;let h,c;do if(h=ih(s[t],r),c=ih(s[t+1],r),t+=i,t==e)return n[o++]=h,n[o++]=c,o;while(h==a&&c==l);for(;t<e;){const u=ih(s[t],r),d=ih(s[t+1],r);if(t+=i,u==h&&d==c)continue;const p=h-a,g=c-l,f=u-a,m=d-l;if(p*m==g*f&&(p<0&&f<p||p==f||p>0&&f>p)&&(g<0&&m<g||g==m||g>0&&m>g)){h=u,c=d;continue}n[o++]=h,n[o++]=c,a=h,l=c,h=u,c=d}return n[o++]=h,n[o++]=c,o}function hw(s,t,e,i,r,n,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=W5(s,t,c,i,r,n,o),a.push(o),t=c}return o}function X5(s,t,e,i,r,n,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l],u=[];o=hw(s,t,c,i,r,n,o,u),a.push(u),t=c[c.length-1]}return o}function qo(s,t,e,i,r){r=r!==void 0?r:[];let n=0;for(let o=t;o<e;o+=i)r[n++]=s.slice(o,o+i);return r.length=n,r}function Bp(s,t,e,i,r){r=r!==void 0?r:[];let n=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];r[n++]=qo(s,t,l,i,r[n]),t=l}return r.length=n,r}function lv(s,t,e,i,r){r=r!==void 0?r:[];let n=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];r[n++]=l.length===1&&l[0]===t?[]:Bp(s,t,l,i,r[n]),t=l[l.length-1]}return r.length=n,r}function GA(s,t,e,i){let r=0,n=s[e-i],o=s[e-i+1];for(;t<e;t+=i){const a=s[t],l=s[t+1];r+=o*a-n*l,n=a,o=l}return r/2}function zA(s,t,e,i){let r=0;for(let n=0,o=e.length;n<o;++n){const a=e[n];r+=GA(s,t,a,i),t=a}return r}function q5(s,t,e,i){let r=0;for(let n=0,o=e.length;n<o;++n){const a=e[n];r+=zA(s,t,a,i),t=a[a.length-1]}return r}let Y5=class hv extends ua{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new hv(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,r){return r<Gh(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(nw(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),aw(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,r))}getArea(){return GA(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return qo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=X_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new hv(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Bg(this.flatCoordinates,0,t,this.stride),this.changed()}};const Up=Y5;function BA(s,t,e,i,r){let n;for(t+=i;t<e;t+=i)if(n=r(s.slice(t-i,t),s.slice(t,t+i)),n)return n;return!1}function i0(s,t,e,i,r,n,o){let a,l;const h=(e-t)/i;if(h===1)a=t;else if(h===2)a=t,l=r;else if(h!==0){let c=s[t],u=s[t+1],d=0;const p=[0];for(let m=t+i;m<e;m+=i){const _=s[m],y=s[m+1];d+=Math.sqrt((_-c)*(_-c)+(y-u)*(y-u)),p.push(d),c=_,u=y}const g=r*d,f=W3(p,g);f<0?(l=(g-p[-f-2])/(p[-f-1]-p[-f-2]),a=t+(-f-2)*i):a=t+f*i}o=o>1?o:2,n=n||new Array(o);for(let c=0;c<o;++c)n[c]=a===void 0?NaN:l===void 0?s[a+c]:jr(s[a+c],s[a+i+c],l);return n}function cv(s,t,e,i,r,n){if(e==t)return null;let o;if(r<s[t+i-1])return n?(o=s.slice(t,t+i),o[i-1]=r,o):null;if(s[e-1]<r)return n?(o=s.slice(e-i,e),o[i-1]=r,o):null;if(r==s[t+i-1])return s.slice(t,t+i);let a=t/i,l=e/i;for(;a<l;){const d=a+l>>1;r<s[(d+1)*i-1]?l=d:a=d+1}const h=s[a*i-1];if(r==h)return s.slice((a-1)*i,(a-1)*i+i);const c=s[(a+1)*i-1],u=(r-h)/(c-h);o=[];for(let d=0;d<i-1;++d)o.push(jr(s[(a-1)*i+d],s[a*i+d],u));return o.push(r),o}function Z5(s,t,e,i,r,n,o){if(o)return cv(s,t,e[e.length-1],i,r,n);let a;if(r<s[i-1])return n?(a=s.slice(0,i),a[i-1]=r,a):null;if(s[s.length-1]<r)return n?(a=s.slice(s.length-i),a[i-1]=r,a):null;for(let l=0,h=e.length;l<h;++l){const c=e[l];if(t!=c){if(r<s[t+i-1])return null;if(r<=s[c-1])return cv(s,t,c,i,r,!1);t=c}}return null}function K5(s,t,e,i,r){return!MA(r,function(n){return!ah(s,t,e,i,n[0],n[1])})}function ah(s,t,e,i,r,n){let o=0,a=s[e-i],l=s[e-i+1];for(;t<e;t+=i){const h=s[t],c=s[t+1];l<=n?c>n&&(h-a)*(n-l)-(r-a)*(c-l)>0&&o++:c<=n&&(h-a)*(n-l)-(r-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function cw(s,t,e,i,r,n){if(e.length===0||!ah(s,t,e[0],i,r,n))return!1;for(let o=1,a=e.length;o<a;++o)if(ah(s,e[o-1],e[o],i,r,n))return!1;return!0}function J5(s,t,e,i,r,n){if(e.length===0)return!1;for(let o=0,a=e.length;o<a;++o){const l=e[o];if(cw(s,t,l,i,r,n))return!0;t=l[l.length-1]}return!1}function q_(s,t,e,i,r){const n=RA(Ys(),s,t,e,i);return li(r,n)?rr(r,n)||n[0]>=r[0]&&n[2]<=r[2]||n[1]>=r[1]&&n[3]<=r[3]?!0:BA(s,t,e,i,function(o,a){return p5(r,o,a)}):!1}function Q5(s,t,e,i,r){for(let n=0,o=e.length;n<o;++n){if(q_(s,t,e[n],i,r))return!0;t=e[n]}return!1}function UA(s,t,e,i,r){return!!(q_(s,t,e,i,r)||ah(s,t,e,i,r[0],r[1])||ah(s,t,e,i,r[0],r[3])||ah(s,t,e,i,r[2],r[1])||ah(s,t,e,i,r[2],r[3]))}function VA(s,t,e,i,r){if(!UA(s,t,e[0],i,r))return!1;if(e.length===1)return!0;for(let n=1,o=e.length;n<o;++n)if(K5(s,e[n-1],e[n],i,r)&&!q_(s,e[n-1],e[n],i,r))return!1;return!0}function tj(s,t,e,i,r){for(let n=0,o=e.length;n<o;++n){const a=e[n];if(VA(s,t,a,i,r))return!0;t=a[a.length-1]}return!1}function HA(s,t,e,i){let r=s[t],n=s[t+1],o=0;for(let a=t+i;a<e;a+=i){const l=s[a],h=s[a+1];o+=Math.sqrt((l-r)*(l-r)+(h-n)*(h-n)),r=l,n=h}return o}let ej=class uv extends ua{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){Se(this.flatCoordinates,t),this.changed()}clone(){const t=new uv(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,r){return r<Gh(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(nw(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),aw(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,r))}forEachSegment(t){return BA(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,cv(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return qo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return i0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return HA(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=X_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new uv(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return q_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Bg(this.flatCoordinates,0,t,this.stride),this.changed()}};const Ps=ej;let ij=class dv extends ua{constructor(t,e,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&i)this.setFlatCoordinates(e,t),this.ends_=i;else{const r=t,n=[],o=[];for(let l=0,h=r.length;l<h;++l){const c=r[l];Se(n,c.getFlatCoordinates()),o.push(n.length)}const a=r.length===0?this.getLayout():r[0].getLayout();this.setFlatCoordinates(a,n),this.ends_=o}}appendLineString(t){Se(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new dv(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,r){return r<Gh(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ow(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),lw(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,r))}getCoordinateAtM(t,e,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,i=i!==void 0?i:!1,Z5(this.flatCoordinates,0,this.ends_,this.stride,t,e,i))}getCoordinates(){return Bp(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new Ps(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,i=this.layout,r=[];let n=0;for(let o=0,a=e.length;o<a;++o){const l=e[o],h=new Ps(t.slice(n,l),i);r.push(h),n=l}return r}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let i=0;const r=this.ends_,n=this.stride;for(let o=0,a=r.length;o<a;++o){const l=r[o],h=i0(e,i,l,n,.5);Se(t,h),i=l}return t}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=jA(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new dv(e,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(t){return Q5(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Ug(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}};const Bn=ij;let sj=class WA extends ua{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new WA(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,r){const n=this.flatCoordinates,o=yh(t,e,n[0],n[1]);if(o<r){const a=this.stride;for(let l=0;l<a;++l)i[l]=n[l];return i.length=a,o}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return Yb(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return qb(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=B5(this.flatCoordinates,0,t,this.stride),this.changed()}};const xs=sj;let rj=class XA extends ua{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){Se(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new XA(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,r){if(r<Gh(this.getExtent(),t,e))return r;const n=this.flatCoordinates,o=this.stride;for(let a=0,l=n.length;a<l;a+=o){const h=yh(t,e,n[a],n[a+1]);if(h<r){r=h;for(let c=0;c<o;++c)i[c]=n[a+c];i.length=o}}return r}getCoordinates(){return qo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new xs(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,i=this.stride,r=[];for(let n=0,o=t.length;n<o;n+=i){const a=new xs(t.slice(n,n+i),e);r.push(a)}return r}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,i=this.stride;for(let r=0,n=e.length;r<n;r+=i){const o=e[r],a=e[r+1];if(qb(t,o,a))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Bg(this.flatCoordinates,0,t,this.stride),this.changed()}};const wa=rj;function uw(s,t,e,i,r,n,o){let a,l,h,c,u,d,p;const g=r[n+1],f=[];for(let y=0,v=e.length;y<v;++y){const b=e[y];for(c=s[b-i],d=s[b-i+1],a=t;a<b;a+=i)u=s[a],p=s[a+1],(g<=d&&p<=g||d<=g&&g<=p)&&(h=(g-d)/(p-d)*(u-c)+c,f.push(h)),c=u,d=p}let m=NaN,_=-1/0;for(f.sort(la),c=f[0],a=1,l=f.length;a<l;++a){u=f[a];const y=Math.abs(u-c);y>_&&(h=(c+u)/2,cw(s,t,e,i,h,g)&&(m=h,_=y)),c=u}return isNaN(m)&&(m=r[n]),o?(o.push(m,g,_),o):[m,g,_]}function qA(s,t,e,i,r){let n=[];for(let o=0,a=e.length;o<a;++o){const l=e[o];n=uw(s,t,l,i,r,2*o,n),t=l[l.length-1]}return n}function nj(s,t,e,i){for(;t<e-i;){for(let r=0;r<i;++r){const n=s[t+r];s[t+r]=s[e-i+r],s[e-i+r]=n}t+=i,e-=i}}function Y_(s,t,e,i){let r=0,n=s[e-i],o=s[e-i+1];for(;t<e;t+=i){const a=s[t],l=s[t+1];r+=(a-n)*(l+o),n=a,o=l}return r===0?void 0:r>0}function dw(s,t,e,i,r){r=r!==void 0?r:!1;for(let n=0,o=e.length;n<o;++n){const a=e[n],l=Y_(s,t,a,i);if(n===0){if(r&&l||!r&&!l)return!1}else if(r&&!l||!r&&l)return!1;t=a}return!0}function YA(s,t,e,i,r){for(let n=0,o=e.length;n<o;++n){const a=e[n];if(!dw(s,t,a,i,r))return!1;a.length&&(t=a[a.length-1])}return!0}function s0(s,t,e,i,r){r=r!==void 0?r:!1;for(let n=0,o=e.length;n<o;++n){const a=e[n],l=Y_(s,t,a,i);(n===0?r&&l||!r&&!l:r&&!l||!r&&l)&&nj(s,t,a,i),t=a}return t}function pv(s,t,e,i,r){for(let n=0,o=e.length;n<o;++n)t=s0(s,t,e[n],i,r);return t}function ZA(s,t){const e=[];let i=0,r=0,n;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=Y_(s,i,l,2);if(n===void 0&&(n=h),h===n)e.push(t.slice(r,o+1));else{if(e.length===0)continue;e[e.length-1].push(t[r])}r=o+1,i=l}return e}let KA=class gv extends ua{constructor(t,e,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&i?(this.setFlatCoordinates(e,t),this.ends_=i):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?Se(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new gv(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,r){return r<Gh(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ow(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),lw(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,r))}containsXY(t,e){return cw(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return zA(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),s0(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Bp(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=vs(this.getExtent());this.flatInteriorPoint_=uw(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new xs(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new Up(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,i=this.ends_,r=[];let n=0;for(let o=0,a=i.length;o<a;++o){const l=i[o],h=new Up(e.slice(n,l),t);r.push(h),n=l}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;dw(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=s0(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=hw(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new gv(e,"XY",i)}getType(){return"Polygon"}intersectsExtent(t){return VA(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Ug(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}};const gn=KA;function rC(s){if(ba(s))throw new Error("Cannot create polygon from empty extent");const t=s[0],e=s[1],i=s[2],r=s[3],n=[t,e,t,r,i,r,i,e,t,e];return new KA(n,"XY",[n.length])}function JA(s,t,e,i){const r=[];let n=Ys();for(let o=0,a=e.length;o<a;++o){const l=e[o];n=Zb(s,t,l[0],i),r.push((n[0]+n[2])/2,(n[1]+n[3])/2),t=l[l.length-1]}return r}let oj=class fv extends ua{constructor(t,e,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){const r=t,n=[],o=[];for(let a=0,l=r.length;a<l;++a){const h=r[a],c=n.length,u=h.getEnds();for(let d=0,p=u.length;d<p;++d)u[d]+=c;Se(n,h.getFlatCoordinates()),o.push(u)}e=r.length===0?this.getLayout():r[0].getLayout(),t=n,i=o}e!==void 0&&i?(this.setFlatCoordinates(e,t),this.endss_=i):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;Se(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let r=0,n=e.length;r<n;++r)e[r]+=i}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let r=0;r<t;++r)e[r]=this.endss_[r].slice();const i=new fv(this.flatCoordinates.slice(),this.layout,e);return i.applyProperties(this),i}closestPointXY(t,e,i,r){return r<Gh(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(V5(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),H5(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,r))}containsXY(t,e){return J5(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return q5(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),pv(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,lv(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=JA(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=qA(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new wa(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;YA(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=pv(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=X5(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new fv(e,"XY",i)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const n=this.endss_[t-1];e=n[n.length-1]}const i=this.endss_[t].slice(),r=i[i.length-1];if(e!==0)for(let n=0,o=i.length;n<o;++n)i[n]-=e;return new gn(this.flatCoordinates.slice(e,r),this.layout,i)}getPolygons(){const t=this.layout,e=this.flatCoordinates,i=this.endss_,r=[];let n=0;for(let o=0,a=i.length;o<a;++o){const l=i[o].slice(),h=l[l.length-1];if(n!==0)for(let u=0,d=l.length;u<d;++u)l[u]-=n;const c=new gn(e.slice(n,h),t,l);r.push(c),n=h}return r}getType(){return"MultiPolygon"}intersectsExtent(t){return tj(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=$A(this.flatCoordinates,0,t,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const r=i[i.length-1];this.flatCoordinates.length=r.length===0?0:r[r.length-1]}this.changed()}};const Ea=oj,nC=Ki();let mv=class _v{constructor(t,e,i,r,n,o){this.styleFunction,this.extent_,this.id_=o,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=n,this.squaredTolerance_,this.stride_=r,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?Yb(this.flatCoordinates_):Zb(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=vs(this.getExtent());this.flatInteriorPoints_=uw(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=ZA(this.flatCoordinates_,this.ends_),e=JA(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=qA(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=i0(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const i=this.ends_;for(let r=0,n=i.length;r<n;++r){const o=i[r],a=i0(t,e,o,2,.5);Se(this.flatMidpoints_,a),e=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=ct(t);const e=t.getExtent(),i=t.getWorldExtent();if(e&&i){const r=ci(i)/ci(e);Xr(nC,i[0],i[3],r,-r,0,0,0),bl(this.flatCoordinates_,0,this.flatCoordinates_.length,2,nC,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var t;return new _v(this.type_,this.flatCoordinates_.slice(),(t=this.ends_)==null?void 0:t.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=wA((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const i=this.simplifiedGeometry_.getFlatCoordinates();let r;switch(this.type_){case"LineString":i.length=X_(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,i,0),r=[i.length];break;case"MultiLineString":r=[],i.length=jA(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,i,0,r);break;case"Polygon":r=[],i.length=hw(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),i,0,r);break}return r&&(this.simplifiedGeometry_=new _v(this.type_,i,r,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}};mv.prototype.getFlatCoordinates=mv.prototype.getOrientedFlatCoordinates;const Cn=mv;let aj=class{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=Ls,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let i=e.dataProjection?ct(e.dataProjection):this.readProjection(t);e.extent&&i&&i.getUnits()==="tile-pixels"&&(i=ct(i),i.setWorldExtent(e.extent)),e={dataProjection:i,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return Lt()}readFeature(t,e){return Lt()}readFeatures(t,e){return Lt()}readGeometry(t,e){return Lt()}readProjection(t){return Lt()}writeFeature(t,e){return Lt()}writeFeatures(t,e){return Lt()}writeGeometry(t,e){return Lt()}};const Vg=aj;function vi(s,t,e){const i=e?ct(e.featureProjection):null,r=e?ct(e.dataProjection):null;let n=s;if(i&&r&&!Rs(i,r)){t&&(n=s.clone());const o=t?i:r,a=t?r:i;o.getUnits()==="tile-pixels"?n.transform(o,a):n.applyTransform(go(o,a))}if(t&&e&&e.decimals!==void 0){const o=Math.pow(10,e.decimals),a=function(l){for(let h=0,c=l.length;h<c;++h)l[h]=Math.round(l[h]*o)/o;return l};n===s&&(n=s.clone()),n.applyTransform(a)}return n}function pw(s,t){const e=t?ct(t.featureProjection):null,i=t?ct(t.dataProjection):null;return e&&i&&!Rs(e,i)?sw(s,i,e):s}const lj={Point:xs,LineString:Ps,Polygon:gn,MultiPoint:wa,MultiLineString:Bn,MultiPolygon:Ea};function hj(s,t,e){return Array.isArray(t[0])?(YA(s,0,t,e)||(s=s.slice(),pv(s,0,t,e)),s):(dw(s,0,t,e)||(s=s.slice(),s0(s,0,t,e)),s)}function QA(s,t){var e;const i=s.geometry;if(!i)return[];if(Array.isArray(i))return i.map(o=>QA({...s,geometry:o})).flat();const r=i.type==="MultiPolygon"?"Polygon":i.type;if(r==="GeometryCollection"||r==="Circle")throw new Error("Unsupported geometry type: "+r);const n=i.layout.length;return vi(new Cn(r,r==="Polygon"?hj(i.flatCoordinates,i.ends,n):i.flatCoordinates,(e=i.ends)==null?void 0:e.flat(),n,s.properties||{},s.id).enableSimplifyTransformed(),!1,t)}function gw(s,t){if(!s)return null;if(Array.isArray(s)){const i=s.map(r=>gw(r,t));return new Xs(i)}const e=lj[s.type];return vi(new e(s.flatCoordinates,s.layout,s.ends),!1,t)}let cj=class extends Vg{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(Vf(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(Vf(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return Lt()}readFeaturesFromObject(t,e){return Lt()}readGeometry(t,e){return this.readGeometryFromObject(Vf(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return Lt()}readProjection(t){return this.readProjectionFromObject(Vf(t))}readProjectionFromObject(t){return Lt()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return Lt()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return Lt()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return Lt()}};function Vf(s){return typeof s=="string"?JSON.parse(s)||null:s!==null?s:null}const fw=cj,uj={Point:fj,LineString:mj,Polygon:vj,MultiPoint:yj,MultiLineString:_j,MultiPolygon:xj},dj={Point:bj,LineString:wj,Polygon:Ej,MultiPoint:Cj,MultiLineString:Sj,MultiPolygon:Tj};let pj=class extends fw{constructor(t){t=t||{},super(),this.geometryName_=t.geometryName}readFeatureFromObject(t,e,i){const r=t,n=oC(r.geometry,e),o=new Ls;if(this.geometryName_&&o.setGeometryName(this.geometryName_),o.setGeometry(n),r.attributes){o.setProperties(r.attributes,!0);const a=r.attributes[i];a!==void 0&&o.setId(a)}return o}readFeaturesFromObject(t,e){if(e=e||{},t.features){const i=t,r=[],n=i.features;for(let o=0,a=n.length;o<a;++o)r.push(this.readFeatureFromObject(n[o],e,t.objectIdFieldName));return r}return[this.readFeatureFromObject(t,e)]}readGeometryFromObject(t,e){return oC(t,e)}readProjectionFromObject(t){if(t.spatialReference&&t.spatialReference.wkid!==void 0){const e=t.spatialReference.wkid;return ct("EPSG:"+e)}return null}writeGeometryObject(t,e){return aC(t,this.adaptOptions(e))}writeFeatureObject(t,e){e=this.adaptOptions(e);const i={};if(!t.hasProperties())return i.attributes={},i;const r=t.getProperties(),n=t.getGeometry();if(n){i.geometry=aC(n,e);const o=e&&(e.dataProjection||e.featureProjection);o&&(i.geometry.spatialReference={wkid:Number(ct(o).getCode().split(":").pop())}),delete r[t.getGeometryName()]}return ha(r)?i.attributes={}:i.attributes=r,i}writeFeaturesObject(t,e){e=this.adaptOptions(e);const i=[];for(let r=0,n=t.length;r<n;++r)i.push(this.writeFeatureObject(t[r],e));return{features:i}}};function oC(s,t){if(!s)return null;let e;if(typeof s.x=="number"&&typeof s.y=="number")e="Point";else if(s.points)e="MultiPoint";else if(s.paths)s.paths.length===1?e="LineString":e="MultiLineString";else if(s.rings){const r=s,n=sd(r),o=gj(r.rings,n);o.length===1?(e="Polygon",s=Object.assign({},s,{rings:o[0]})):(e="MultiPolygon",s=Object.assign({},s,{rings:o}))}const i=uj[e];return vi(i(s),!1,t)}function gj(s,t){const e=[],i=[],r=[];let n,o;for(n=0,o=s.length;n<o;++n)e.length=0,Bg(e,0,s[n],t.length),Y_(e,0,e.length,t.length)?i.push([s[n]]):r.push(s[n]);for(;r.length;){const a=r.shift();let l=!1;for(n=i.length-1;n>=0;n--){const h=i[n][0];if(rr(new Up(h).getExtent(),new Up(a).getExtent())){i[n].push(a),l=!0;break}}l||i.push([a.reverse()])}return i}function fj(s){let t;return s.m!==void 0&&s.z!==void 0?t=new xs([s.x,s.y,s.z,s.m],"XYZM"):s.z!==void 0?t=new xs([s.x,s.y,s.z],"XYZ"):s.m!==void 0?t=new xs([s.x,s.y,s.m],"XYM"):t=new xs([s.x,s.y]),t}function mj(s){const t=sd(s);return new Ps(s.paths[0],t)}function _j(s){const t=sd(s);return new Bn(s.paths,t)}function sd(s){let t="XY";return s.hasZ===!0&&s.hasM===!0?t="XYZM":s.hasZ===!0?t="XYZ":s.hasM===!0&&(t="XYM"),t}function yj(s){const t=sd(s);return new wa(s.points,t)}function xj(s){const t=sd(s);return new Ea(s.rings,t)}function vj(s){const t=sd(s);return new gn(s.rings,t)}function bj(s,t){const e=s.getCoordinates();let i;const r=s.getLayout();if(r==="XYZ")i={x:e[0],y:e[1],z:e[2]};else if(r==="XYM")i={x:e[0],y:e[1],m:e[2]};else if(r==="XYZM")i={x:e[0],y:e[1],z:e[2],m:e[3]};else if(r==="XY")i={x:e[0],y:e[1]};else throw new Error("Invalid geometry layout");return i}function Hg(s){const t=s.getLayout();return{hasZ:t==="XYZ"||t==="XYZM",hasM:t==="XYM"||t==="XYZM"}}function wj(s,t){const e=Hg(s);return{hasZ:e.hasZ,hasM:e.hasM,paths:[s.getCoordinates()]}}function Ej(s,t){const e=Hg(s);return{hasZ:e.hasZ,hasM:e.hasM,rings:s.getCoordinates(!1)}}function Sj(s,t){const e=Hg(s);return{hasZ:e.hasZ,hasM:e.hasM,paths:s.getCoordinates()}}function Cj(s,t){const e=Hg(s);return{hasZ:e.hasZ,hasM:e.hasM,points:s.getCoordinates()}}function Tj(s,t){const e=Hg(s),i=s.getCoordinates(!1),r=[];for(let n=0;n<i.length;n++)for(let o=i[n].length-1;o>=0;o--)r.push(i[n][o]);return{hasZ:e.hasZ,hasM:e.hasM,rings:r}}function aC(s,t){const e=dj[s.getType()];return e(vi(s,!0,t),t)}const Rj=pj;let Mj=class extends fw{constructor(t){t=t||{},super(),this.dataProjection=ct(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=ct(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let i=null;t.type==="Feature"?i=t:i={type:"Feature",geometry:t,properties:null};const r=mw(i.geometry);if(this.featureClass===Cn)return QA({geometry:r,id:i.id,properties:i.properties},e);const n=new Ls;return this.geometryName_?n.setGeometryName(this.geometryName_):this.extractGeometryName_&&i.geometry_name&&n.setGeometryName(i.geometry_name),n.setGeometry(gw(r,e)),"id"in i&&n.setId(i.id),i.properties&&n.setProperties(i.properties,!0),n}readFeaturesFromObject(t,e){const i=t;let r=null;if(i.type==="FeatureCollection"){const n=t;r=[];const o=n.features;for(let a=0,l=o.length;a<l;++a){const h=this.readFeatureFromObject(o[a],e);h&&r.push(h)}}else r=[this.readFeatureFromObject(t,e)];return r.flat()}readGeometryFromObject(t,e){return Ij(t,e)}readProjectionFromObject(t){const e=t.crs;let i;if(e)if(e.type=="name")i=ct(e.properties.name);else if(e.type==="EPSG")i=ct("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else i=this.dataProjection;return i}writeFeatureObject(t,e){e=this.adaptOptions(e);const i={type:"Feature",geometry:null,properties:null},r=t.getId();if(r!==void 0&&(i.id=r),!t.hasProperties())return i;const n=t.getProperties(),o=t.getGeometry();return o&&(i.geometry=yv(o,e),delete n[t.getGeometryName()]),ha(n)||(i.properties=n),i}writeFeaturesObject(t,e){e=this.adaptOptions(e);const i=[];for(let r=0,n=t.length;r<n;++r)i.push(this.writeFeatureObject(t[r],e));return{type:"FeatureCollection",features:i}}writeGeometryObject(t,e){return yv(t,this.adaptOptions(e))}};function mw(s,t){if(!s)return null;let e;switch(s.type){case"Point":{e=Lj(s);break}case"LineString":{e=Pj(s);break}case"Polygon":{e=Nj(s);break}case"MultiPoint":{e=Fj(s);break}case"MultiLineString":{e=Oj(s);break}case"MultiPolygon":{e=kj(s);break}case"GeometryCollection":{e=Aj(s);break}default:throw new Error("Unsupported GeoJSON type: "+s.type)}return e}function Ij(s,t){const e=mw(s);return gw(e,t)}function Aj(s,t){return s.geometries.map(function(e){return mw(e)})}function Lj(s){const t=s.coordinates;return{type:"Point",flatCoordinates:t,layout:Bh(t.length)}}function Pj(s){var t;const e=s.coordinates,i=e.flat();return{type:"LineString",flatCoordinates:i,ends:[i.length],layout:Bh(((t=e[0])==null?void 0:t.length)||2)}}function Oj(s){var t,e;const i=s.coordinates,r=((e=(t=i[0])==null?void 0:t[0])==null?void 0:e.length)||2,n=[],o=Ug(n,0,i,r);return{type:"MultiLineString",flatCoordinates:n,ends:o,layout:Bh(r)}}function Fj(s){var t;const e=s.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:Bh(((t=e[0])==null?void 0:t.length)||2)}}function kj(s){var t,e;const i=s.coordinates,r=[],n=((e=(t=i[0])==null?void 0:t[0])==null?void 0:e[0].length)||2,o=$A(r,0,i,n);return{type:"MultiPolygon",flatCoordinates:r,ends:o,layout:Bh(n)}}function Nj(s){var t,e;const i=s.coordinates,r=[],n=(e=(t=i[0])==null?void 0:t[0])==null?void 0:e.length,o=Ug(r,0,i,n);return{type:"Polygon",flatCoordinates:r,ends:o,layout:Bh(n)}}function yv(s,t){s=vi(s,!0,t);const e=s.getType();let i;switch(e){case"Point":{i=Bj(s);break}case"LineString":{i=$j(s);break}case"Polygon":{i=Uj(s,t);break}case"MultiPoint":{i=Gj(s);break}case"MultiLineString":{i=jj(s);break}case"MultiPolygon":{i=zj(s,t);break}case"GeometryCollection":{i=Dj(s,t);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return i}function Dj(s,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:s.getGeometriesArray().map(function(e){return yv(e,t)})}}function $j(s,t){return{type:"LineString",coordinates:s.getCoordinates()}}function jj(s,t){return{type:"MultiLineString",coordinates:s.getCoordinates()}}function Gj(s,t){return{type:"MultiPoint",coordinates:s.getCoordinates()}}function zj(s,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:s.getCoordinates(e)}}function Bj(s,t){return{type:"Point",coordinates:s.getCoordinates()}}function Uj(s,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:s.getCoordinates(e)}}const tL=Mj,Ch="http://www.w3.org/2001/XMLSchema-instance";function Ht(s,t){return rd().createElementNS(s,t)}function hr(s,t){return eL(s,t,[]).join("")}function eL(s,t,e){if(s.nodeType==Node.CDATA_SECTION_NODE||s.nodeType==Node.TEXT_NODE)t?e.push(String(s.nodeValue).replace(/(\r\n|\r|\n)/g,"")):e.push(s.nodeValue);else{let i;for(i=s.firstChild;i;i=i.nextSibling)eL(i,t,e)}return e}function rn(s){return"documentElement"in s}function Vj(s,t,e){return s.getAttributeNS(t,e)||""}function nn(s){return new DOMParser().parseFromString(s,"application/xml")}function r0(s,t){return function(e,i){const r=s.call(t!==void 0?t:this,e,i);if(r!==void 0){const n=i[i.length-1];Se(n,r)}}}function vt(s,t){return function(e,i){const r=s.call(t!==void 0?t:this,e,i);r!==void 0&&i[i.length-1].push(r)}}function At(s,t){return function(e,i){const r=s.call(t!==void 0?t:this,e,i);r!==void 0&&(i[i.length-1]=r)}}function ai(s,t,e){return function(i,r){const n=s.call(e!==void 0?e:this,i,r);if(n!==void 0){const o=r[r.length-1],a=t!==void 0?t:i.localName;let l;a in o?l=o[a]:(l=[],o[a]=l),l.push(n)}}}function F(s,t,e){return function(i,r){const n=s.call(e!==void 0?e:this,i,r);if(n!==void 0){const o=r[r.length-1],a=t!==void 0?t:i.localName;o[a]=n}}}function D(s,t){return function(e,i,r){s.call(t!==void 0?t:this,e,i,r),r[r.length-1].node.appendChild(e)}}function iL(s,t){let e,i;return function(r,n,o){if(e===void 0){e={};const a={};a[r.localName]=s,e[r.namespaceURI]=a,i=Fi(r.localName)}sL(e,i,n,o)}}function Fi(s,t){return function(e,i,r){const n=i[i.length-1].node;let o=s;o===void 0&&(o=r);const a=t!==void 0?t:n.namespaceURI;return Ht(a,o)}}const bs=Fi();function Mr(s,t){const e=t.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=s[t[r]];return i}function q(s,t,e){e=e!==void 0?e:{};let i,r;for(i=0,r=s.length;i<r;++i)e[s[i]]=t;return e}function Rr(s,t,e,i){let r;for(r=t.firstElementChild;r;r=r.nextElementSibling){const n=s[r.namespaceURI];if(n!==void 0){const o=n[r.localName];o!==void 0&&o.call(i,r,e)}}}function Z(s,t,e,i,r){return i.push(s),Rr(t,e,i,r),i.pop()}function sL(s,t,e,i,r,n){const o=(r!==void 0?r:e).length;let a,l;for(let h=0;h<o;++h)a=e[h],a!==void 0&&(l=t.call(n!==void 0?n:this,a,i,r!==void 0?r[h]:void 0),l!==void 0&&s[l.namespaceURI][l.localName].call(n,l,a,i))}function zt(s,t,e,i,r,n,o){return r.push(s),sL(t,e,i,r,n,o),r.pop()}let E1;function Hj(){return E1===void 0&&typeof XMLSerializer<"u"&&(E1=new XMLSerializer),E1}let S1;function rd(){return S1===void 0&&typeof document<"u"&&(S1=document.implementation.createDocument("","",null)),S1}let Wj=class extends Vg{constructor(){super(),this.xmlSerializer_=Hj()}getType(){return"xml"}readFeature(t,e){if(!t)return null;if(typeof t=="string"){const i=nn(t);return this.readFeatureFromDocument(i,e)}return rn(t)?this.readFeatureFromDocument(t,e):this.readFeatureFromNode(t,e)}readFeatureFromDocument(t,e){const i=this.readFeaturesFromDocument(t,e);return i.length>0?i[0]:null}readFeatureFromNode(t,e){return null}readFeatures(t,e){if(!t)return[];if(typeof t=="string"){const i=nn(t);return this.readFeaturesFromDocument(i,e)}return rn(t)?this.readFeaturesFromDocument(t,e):this.readFeaturesFromNode(t,e)}readFeaturesFromDocument(t,e){const i=[];for(let r=t.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&Se(i,this.readFeaturesFromNode(r,e));return i}readFeaturesFromNode(t,e){return Lt()}readGeometry(t,e){if(!t)return null;if(typeof t=="string"){const i=nn(t);return this.readGeometryFromDocument(i,e)}return rn(t)?this.readGeometryFromDocument(t,e):this.readGeometryFromNode(t,e)}readGeometryFromDocument(t,e){return null}readGeometryFromNode(t,e){return null}readProjection(t){if(!t)return null;if(typeof t=="string"){const e=nn(t);return this.readProjectionFromDocument(e)}return rn(t)?this.readProjectionFromDocument(t):this.readProjectionFromNode(t)}readProjectionFromDocument(t){return this.dataProjection}readProjectionFromNode(t){return this.dataProjection}writeFeature(t,e){const i=this.writeFeatureNode(t,e);return this.xmlSerializer_.serializeToString(i)}writeFeatureNode(t,e){return null}writeFeatures(t,e){const i=this.writeFeaturesNode(t,e);return this.xmlSerializer_.serializeToString(i)}writeFeaturesNode(t,e){return null}writeGeometry(t,e){const i=this.writeGeometryNode(t,e);return this.xmlSerializer_.serializeToString(i)}writeGeometryNode(t,e){return null}};const Wg=Wj,Jo="http://www.opengis.net/gml",Xj=/^\s*$/;class Bi extends Wg{constructor(t){super(),t=t||{},this.featureType=t.featureType,this.featureNS=t.featureNS,this.srsName=t.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:vt(this.readFeaturesInternal),featureMembers:At(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(t,e){const i=t.localName;let r=null;if(i=="FeatureCollection")r=Z([],this.FEATURE_COLLECTION_PARSERS,t,e,this);else if(i=="featureMembers"||i=="featureMember"||i=="member"){const n=e[0];let o=n.featureType,a=n.featureNS;const l="p",h="p0";if(!o&&t.childNodes){o=[],a={};for(let d=0,p=t.childNodes.length;d<p;++d){const g=t.childNodes[d];if(g.nodeType===1){const f=g.nodeName.split(":").pop();if(!o.includes(f)){let m="",_=0;const y=g.namespaceURI;for(const v in a){if(a[v]===y){m=v;break}++_}m||(m=l+_,a[m]=y),o.push(m+":"+f)}}}i!="featureMember"&&(n.featureType=o,n.featureNS=a)}if(typeof a=="string"){const d=a;a={},a[h]=d}const c={},u=Array.isArray(o)?o:[o];for(const d in a){const p={};for(let g=0,f=u.length;g<f;++g)(u[g].includes(":")?u[g].split(":")[0]:h)===d&&(p[u[g].split(":").pop()]=i=="featureMembers"?vt(this.readFeatureElement,this):At(this.readFeatureElement,this));c[a[d]]=p}i=="featureMember"||i=="member"?r=Z(void 0,c,t,e):r=Z([],c,t,e)}return r===null&&(r=[]),r}readGeometryOrExtent(t,e){const i=e[0];return i.srsName=t.firstElementChild.getAttribute("srsName"),i.srsDimension=t.firstElementChild.getAttribute("srsDimension"),Z(null,this.GEOMETRY_PARSERS,t,e,this)}readExtentElement(t,e){const i=e[0],r=this.readGeometryOrExtent(t,e);return r?pw(r,i):void 0}readGeometryElement(t,e){const i=e[0],r=this.readGeometryOrExtent(t,e);return r?vi(r,!1,i):void 0}readFeatureElementInternal(t,e,i){let r;const n={};for(let l=t.firstElementChild;l;l=l.nextElementSibling){let h;const c=l.localName;l.childNodes.length===0||l.childNodes.length===1&&(l.firstChild.nodeType===3||l.firstChild.nodeType===4)?(h=hr(l,!1),Xj.test(h)&&(h=void 0)):(i&&(h=c==="boundedBy"?this.readExtentElement(l,e):this.readGeometryElement(l,e)),h?c!=="boundedBy"&&(r=c):h=this.readFeatureElementInternal(l,e,!1));const u=l.attributes.length;if(u>0&&!(h instanceof rw)){h={_content_:h};for(let d=0;d<u;d++){const p=l.attributes[d].name;h[p]=l.attributes[d].value}}n[c]?(n[c]instanceof Array||(n[c]=[n[c]]),n[c].push(h)):n[c]=h}if(!i)return n;const o=new Ls(n);r&&o.setGeometryName(r);const a=t.getAttribute("fid")||Vj(t,this.namespace,"id");return a&&o.setId(a),o}readFeatureElement(t,e){return this.readFeatureElementInternal(t,e,!0)}readPoint(t,e){const i=this.readFlatCoordinatesFromNode(t,e);if(i)return new xs(i,"XYZ")}readMultiPoint(t,e){const i=Z([],this.MULTIPOINT_PARSERS,t,e,this);if(i)return new wa(i)}readMultiLineString(t,e){const i=Z([],this.MULTILINESTRING_PARSERS,t,e,this);if(i)return new Bn(i)}readMultiPolygon(t,e){const i=Z([],this.MULTIPOLYGON_PARSERS,t,e,this);if(i)return new Ea(i)}pointMemberParser(t,e){Rr(this.POINTMEMBER_PARSERS,t,e,this)}lineStringMemberParser(t,e){Rr(this.LINESTRINGMEMBER_PARSERS,t,e,this)}polygonMemberParser(t,e){Rr(this.POLYGONMEMBER_PARSERS,t,e,this)}readLineString(t,e){const i=this.readFlatCoordinatesFromNode(t,e);if(i)return new Ps(i,"XYZ")}readFlatLinearRing(t,e){const i=Z(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this);if(i)return i}readLinearRing(t,e){const i=this.readFlatCoordinatesFromNode(t,e);if(i)return new Up(i,"XYZ")}readPolygon(t,e){const i=Z([null],this.FLAT_LINEAR_RINGS_PARSERS,t,e,this);if(i&&i[0]){const r=i[0],n=[r.length];let o,a;for(o=1,a=i.length;o<a;++o)Se(r,i[o]),n.push(r.length);return new gn(r,"XYZ",n)}}readFlatCoordinatesFromNode(t,e){return Z(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this)}readGeometryFromNode(t,e){return this.readGeometryElement(t,[this.getReadOptions(t,e||{})])||null}readFeaturesFromNode(t,e){const i={featureType:this.featureType,featureNS:this.featureNS};return i&&Object.assign(i,this.getReadOptions(t,e)),this.readFeaturesInternal(t,[i])||[]}readProjectionFromNode(t){return ct(this.srsName?this.srsName:t.firstElementChild.getAttribute("srsName"))}}Bi.prototype.namespace=Jo;Bi.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};Bi.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};Bi.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};Bi.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:vt(Bi.prototype.pointMemberParser),pointMembers:vt(Bi.prototype.pointMemberParser)}};Bi.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:vt(Bi.prototype.lineStringMemberParser),lineStringMembers:vt(Bi.prototype.lineStringMemberParser)}};Bi.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:vt(Bi.prototype.polygonMemberParser),polygonMembers:vt(Bi.prototype.polygonMemberParser)}};Bi.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:vt(Bi.prototype.readFlatCoordinatesFromNode)}};Bi.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:vt(Bi.prototype.readLineString)}};Bi.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:vt(Bi.prototype.readPolygon)}};Bi.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:At(Bi.prototype.readFlatLinearRing)}};const le=Bi;function Tl(s){const t=hr(s,!1);return xh(t)}function xh(s){const t=/^\s*(true|1)|(false|0)\s*$/.exec(s);if(t)return t[1]!==void 0||!1}function Z_(s){const t=hr(s,!1),e=Date.parse(t);return isNaN(e)?void 0:e/1e3}function pe(s){const t=hr(s,!1);return Uo(t)}function Uo(s){const t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(s);if(t)return parseFloat(t[1])}function Gi(s){const t=hr(s,!1);return Yo(t)}function Yo(s){const t=/^\s*(\d+)\s*$/.exec(s);if(t)return parseInt(t[1],10)}function Q(s){return hr(s,!1).trim()}function Iu(s,t){Dt(s,t?"1":"0")}function qj(s,t){s.appendChild(rd().createCDATASection(t))}function Yj(s,t){const e=new Date(t*1e3),i=e.getUTCFullYear()+"-"+oh(e.getUTCMonth()+1,2)+"-"+oh(e.getUTCDate(),2)+"T"+oh(e.getUTCHours(),2)+":"+oh(e.getUTCMinutes(),2)+":"+oh(e.getUTCSeconds(),2)+"Z";s.appendChild(rd().createTextNode(i))}function vr(s,t){const e=t.toPrecision();s.appendChild(rd().createTextNode(e))}function n0(s,t){const e=t.toString();s.appendChild(rd().createTextNode(e))}function Dt(s,t){s.appendChild(rd().createTextNode(t))}const Zj=Jo+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",Kj={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};let Ee=class extends le{constructor(t){t=t||{},super(t),this.FEATURE_COLLECTION_PARSERS[Jo].featureMember=vt(this.readFeaturesInternal),this.schemaLocation=t.schemaLocation?t.schemaLocation:Zj}readFlatCoordinates(t,e){const i=hr(t,!1).replace(/^\s*|\s*$/g,""),r=e[0].srsName;let n="enu";if(r){const l=ct(r);l&&(n=l.getAxisOrientation())}const o=i.trim().split(/\s+/),a=[];for(let l=0,h=o.length;l<h;l++){const c=o[l].split(/,+/),u=parseFloat(c[0]),d=parseFloat(c[1]),p=c.length===3?parseFloat(c[2]):0;n.substr(0,2)==="en"?a.push(u,d,p):a.push(d,u,p)}return a}readBox(t,e){const i=Z([null],this.BOX_PARSERS_,t,e,this);return $n(i[1][0],i[1][1],i[1][3],i[1][4])}innerBoundaryIsParser(t,e){const i=Z(void 0,this.RING_PARSERS,t,e,this);i&&e[e.length-1].push(i)}outerBoundaryIsParser(t,e){const i=Z(void 0,this.RING_PARSERS,t,e,this);if(i){const r=e[e.length-1];r[0]=i}}GEOMETRY_NODE_FACTORY_(t,e,i){const r=e[e.length-1],n=r.multiSurface,o=r.surface,a=r.multiCurve;return Array.isArray(t)?i="Envelope":(i=t.getType(),i==="MultiPolygon"&&n===!0?i="MultiSurface":i==="Polygon"&&o===!0?i="Surface":i==="MultiLineString"&&a===!0&&(i="MultiCurve")),Ht("http://www.opengis.net/gml",i)}writeFeatureElement(t,e,i){const r=e.getId();r&&t.setAttribute("fid",r);const n=i[i.length-1],o=n.featureNS,a=e.getGeometryName();n.serializers||(n.serializers={},n.serializers[o]={});const l=[],h=[];if(e.hasProperties()){const u=e.getProperties();for(const d in u){const p=u[d];p!==null&&(l.push(d),h.push(p),d==a||typeof p.getSimplifiedGeometry=="function"?d in n.serializers[o]||(n.serializers[o][d]=D(this.writeGeometryElement,this)):d in n.serializers[o]||(n.serializers[o][d]=D(Dt)))}}const c=Object.assign({},n);c.node=t,zt(c,n.serializers,Fi(void 0,o),h,i,l)}writeCurveOrLineString(t,e,i){const r=i[i.length-1].srsName;if(t.nodeName!=="LineStringSegment"&&r&&t.setAttribute("srsName",r),t.nodeName==="LineString"||t.nodeName==="LineStringSegment"){const n=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(n),this.writeCoordinates_(n,e,i)}else if(t.nodeName==="Curve"){const n=Ht(t.namespaceURI,"segments");t.appendChild(n),this.writeCurveSegments_(n,e,i)}}writeLineStringOrCurveMember(t,e,i){const r=this.GEOMETRY_NODE_FACTORY_(e,i);r&&(t.appendChild(r),this.writeCurveOrLineString(r,e,i))}writeMultiCurveOrLineString(t,e,i){const r=i[i.length-1],n=r.hasZ,o=r.srsName,a=r.curve;o&&t.setAttribute("srsName",o);const l=e.getLineStrings();zt({node:t,hasZ:n,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeGeometryElement(t,e,i){const r=i[i.length-1],n=Object.assign({},r);n.node=t;let o;Array.isArray(e)?o=pw(e,r):o=vi(e,!0,r),zt(n,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],i,void 0,this)}createCoordinatesNode_(t){const e=Ht(t,"coordinates");return e.setAttribute("decimal","."),e.setAttribute("cs",","),e.setAttribute("ts"," "),e}writeCoordinates_(t,e,i){const r=i[i.length-1],n=r.hasZ,o=r.srsName,a=e.getCoordinates(),l=a.length,h=new Array(l);for(let c=0;c<l;++c){const u=a[c];h[c]=this.getCoords_(u,o,n)}Dt(t,h.join(" "))}writeCurveSegments_(t,e,i){const r=Ht(t.namespaceURI,"LineStringSegment");t.appendChild(r),this.writeCurveOrLineString(r,e,i)}writeSurfaceOrPolygon(t,e,i){const r=i[i.length-1],n=r.hasZ,o=r.srsName;if(t.nodeName!=="PolygonPatch"&&o&&t.setAttribute("srsName",o),t.nodeName==="Polygon"||t.nodeName==="PolygonPatch"){const a=e.getLinearRings();zt({node:t,hasZ:n,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,i,void 0,this)}else if(t.nodeName==="Surface"){const a=Ht(t.namespaceURI,"patches");t.appendChild(a),this.writeSurfacePatches_(a,e,i)}}RING_NODE_FACTORY_(t,e,i){const r=e[e.length-1],n=r.node,o=r.exteriorWritten;return o===void 0&&(r.exteriorWritten=!0),Ht(n.namespaceURI,o!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(t,e,i){const r=Ht(t.namespaceURI,"PolygonPatch");t.appendChild(r),this.writeSurfaceOrPolygon(r,e,i)}writeRing(t,e,i){const r=Ht(t.namespaceURI,"LinearRing");t.appendChild(r),this.writeLinearRing(r,e,i)}getCoords_(t,e,i){let r="enu";e&&(r=ct(e).getAxisOrientation());let n=r.substr(0,2)==="en"?t[0]+","+t[1]:t[1]+","+t[0];if(i){const o=t[2]||0;n+=","+o}return n}writePoint(t,e,i){const r=i[i.length-1],n=r.hasZ,o=r.srsName;o&&t.setAttribute("srsName",o);const a=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(a);const l=e.getCoordinates(),h=this.getCoords_(l,o,n);Dt(a,h)}writeMultiPoint(t,e,i){const r=i[i.length-1],n=r.hasZ,o=r.srsName;o&&t.setAttribute("srsName",o);const a=e.getPoints();zt({node:t,hasZ:n,srsName:o},this.POINTMEMBER_SERIALIZERS,Fi("pointMember"),a,i,void 0,this)}writePointMember(t,e,i){const r=Ht(t.namespaceURI,"Point");t.appendChild(r),this.writePoint(r,e,i)}writeLinearRing(t,e,i){const r=i[i.length-1].srsName;r&&t.setAttribute("srsName",r);const n=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(n),this.writeCoordinates_(n,e,i)}writeMultiSurfaceOrPolygon(t,e,i){const r=i[i.length-1],n=r.hasZ,o=r.srsName,a=r.surface;o&&t.setAttribute("srsName",o);const l=e.getPolygons();zt({node:t,hasZ:n,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeSurfaceOrPolygonMember(t,e,i){const r=this.GEOMETRY_NODE_FACTORY_(e,i);r&&(t.appendChild(r),this.writeSurfaceOrPolygon(r,e,i))}writeEnvelope(t,e,i){const r=i[i.length-1].srsName;r&&t.setAttribute("srsName",r);const n=["lowerCorner","upperCorner"],o=[e[0]+" "+e[1],e[2]+" "+e[3]];zt({node:t},this.ENVELOPE_SERIALIZERS,bs,o,i,n,this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(t,e,i){const r=e[e.length-1].node;return Ht("http://www.opengis.net/gml",Kj[r.nodeName])}};Ee.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:At(Ee.prototype.readFlatCoordinates)}};Ee.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:Ee.prototype.innerBoundaryIsParser,outerBoundaryIs:Ee.prototype.outerBoundaryIsParser}};Ee.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:vt(Ee.prototype.readFlatCoordinates)}};Ee.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:At(le.prototype.readPoint),MultiPoint:At(le.prototype.readMultiPoint),LineString:At(le.prototype.readLineString),MultiLineString:At(le.prototype.readMultiLineString),LinearRing:At(le.prototype.readLinearRing),Polygon:At(le.prototype.readPolygon),MultiPolygon:At(le.prototype.readMultiPolygon),Box:At(Ee.prototype.readBox)}};Ee.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:D(Ee.prototype.writeCurveOrLineString),MultiCurve:D(Ee.prototype.writeMultiCurveOrLineString),Point:D(Ee.prototype.writePoint),MultiPoint:D(Ee.prototype.writeMultiPoint),LineString:D(Ee.prototype.writeCurveOrLineString),MultiLineString:D(Ee.prototype.writeMultiCurveOrLineString),LinearRing:D(Ee.prototype.writeLinearRing),Polygon:D(Ee.prototype.writeSurfaceOrPolygon),MultiPolygon:D(Ee.prototype.writeMultiSurfaceOrPolygon),Surface:D(Ee.prototype.writeSurfaceOrPolygon),MultiSurface:D(Ee.prototype.writeMultiSurfaceOrPolygon),Envelope:D(Ee.prototype.writeEnvelope)}};Ee.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:D(Ee.prototype.writeLineStringOrCurveMember),curveMember:D(Ee.prototype.writeLineStringOrCurveMember)}};Ee.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:D(Ee.prototype.writeRing),innerBoundaryIs:D(Ee.prototype.writeRing)}};Ee.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:D(Ee.prototype.writePointMember)}};Ee.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:D(Ee.prototype.writeSurfaceOrPolygonMember),polygonMember:D(Ee.prototype.writeSurfaceOrPolygonMember)}};Ee.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:D(Dt),upperCorner:D(Dt)}};const nd=Ee,Jj=Jo+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",Qj={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};let bt=class extends le{constructor(t){t=t||{},super(t),this.surface_=t.surface!==void 0?t.surface:!1,this.curve_=t.curve!==void 0?t.curve:!1,this.multiCurve_=t.multiCurve!==void 0?t.multiCurve:!0,this.multiSurface_=t.multiSurface!==void 0?t.multiSurface:!0,this.schemaLocation=t.schemaLocation?t.schemaLocation:Jj,this.hasZ=t.hasZ!==void 0?t.hasZ:!1}readMultiCurve(t,e){const i=Z([],this.MULTICURVE_PARSERS,t,e,this);if(i)return new Bn(i)}readFlatCurveRing(t,e){const i=Z([],this.MULTICURVE_PARSERS,t,e,this),r=[];for(let n=0,o=i.length;n<o;++n)Se(r,i[n].getFlatCoordinates());return r}readMultiSurface(t,e){const i=Z([],this.MULTISURFACE_PARSERS,t,e,this);if(i)return new Ea(i)}curveMemberParser(t,e){Rr(this.CURVEMEMBER_PARSERS,t,e,this)}surfaceMemberParser(t,e){Rr(this.SURFACEMEMBER_PARSERS,t,e,this)}readPatch(t,e){return Z([null],this.PATCHES_PARSERS,t,e,this)}readSegment(t,e){return Z([],this.SEGMENTS_PARSERS,t,e,this)}readPolygonPatch(t,e){return Z([null],this.FLAT_LINEAR_RINGS_PARSERS,t,e,this)}readLineStringSegment(t,e){return Z([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this)}interiorParser(t,e){const i=Z(void 0,this.RING_PARSERS,t,e,this);i&&e[e.length-1].push(i)}exteriorParser(t,e){const i=Z(void 0,this.RING_PARSERS,t,e,this);if(i){const r=e[e.length-1];r[0]=i}}readSurface(t,e){const i=Z([null],this.SURFACE_PARSERS,t,e,this);if(i&&i[0]){const r=i[0],n=[r.length];let o,a;for(o=1,a=i.length;o<a;++o)Se(r,i[o]),n.push(r.length);return new gn(r,"XYZ",n)}}readCurve(t,e){const i=Z([null],this.CURVE_PARSERS,t,e,this);if(i)return new Ps(i,"XYZ")}readEnvelope(t,e){const i=Z([null],this.ENVELOPE_PARSERS,t,e,this);return $n(i[1][0],i[1][1],i[2][0],i[2][1])}readFlatPos(t,e){let i=hr(t,!1);const r=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,n=[];let o;for(;o=r.exec(i);)n.push(parseFloat(o[1])),i=i.substr(o[0].length);if(i!=="")return;const a=e[0].srsName;let l="enu";if(a&&(l=ct(a).getAxisOrientation()),l==="neu"){let c,u;for(c=0,u=n.length;c<u;c+=3){const d=n[c],p=n[c+1];n[c]=p,n[c+1]=d}}const h=n.length;if(h==2&&n.push(0),h!==0)return n}readFlatPosList(t,e){const i=hr(t,!1).replace(/^\s*|\s*$/g,""),r=e[0],n=r.srsName,o=r.srsDimension;let a="enu";n&&(a=ct(n).getAxisOrientation());const l=i.split(/\s+/);let h=2;t.getAttribute("srsDimension")?h=Yo(t.getAttribute("srsDimension")):t.getAttribute("dimension")?h=Yo(t.getAttribute("dimension")):t.parentNode.getAttribute("srsDimension")?h=Yo(t.parentNode.getAttribute("srsDimension")):o&&(h=Yo(o));let c,u,d;const p=[];for(let g=0,f=l.length;g<f;g+=h)c=parseFloat(l[g]),u=parseFloat(l[g+1]),d=h===3?parseFloat(l[g+2]):0,a.substr(0,2)==="en"?p.push(c,u,d):p.push(u,c,d);return p}writePos_(t,e,i){const r=i[i.length-1],n=r.hasZ,o=n?"3":"2";t.setAttribute("srsDimension",o);const a=r.srsName;let l="enu";a&&(l=ct(a).getAxisOrientation());const h=e.getCoordinates();let c;if(l.substr(0,2)==="en"?c=h[0]+" "+h[1]:c=h[1]+" "+h[0],n){const u=h[2]||0;c+=" "+u}Dt(t,c)}getCoords_(t,e,i){let r="enu";e&&(r=ct(e).getAxisOrientation());let n=r.substr(0,2)==="en"?t[0]+" "+t[1]:t[1]+" "+t[0];if(i){const o=t[2]||0;n+=" "+o}return n}writePosList_(t,e,i){const r=i[i.length-1],n=r.hasZ,o=n?"3":"2";t.setAttribute("srsDimension",o);const a=r.srsName,l=e.getCoordinates(),h=l.length,c=new Array(h);let u;for(let d=0;d<h;++d)u=l[d],c[d]=this.getCoords_(u,a,n);Dt(t,c.join(" "))}writePoint(t,e,i){const r=i[i.length-1].srsName;r&&t.setAttribute("srsName",r);const n=Ht(t.namespaceURI,"pos");t.appendChild(n),this.writePos_(n,e,i)}writeEnvelope(t,e,i){const r=i[i.length-1].srsName;r&&t.setAttribute("srsName",r);const n=["lowerCorner","upperCorner"],o=[e[0]+" "+e[1],e[2]+" "+e[3]];zt({node:t},this.ENVELOPE_SERIALIZERS,bs,o,i,n,this)}writeLinearRing(t,e,i){const r=i[i.length-1].srsName;r&&t.setAttribute("srsName",r);const n=Ht(t.namespaceURI,"posList");t.appendChild(n),this.writePosList_(n,e,i)}RING_NODE_FACTORY_(t,e,i){const r=e[e.length-1],n=r.node,o=r.exteriorWritten;return o===void 0&&(r.exteriorWritten=!0),Ht(n.namespaceURI,o!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(t,e,i){const r=i[i.length-1],n=r.hasZ,o=r.srsName;if(t.nodeName!=="PolygonPatch"&&o&&t.setAttribute("srsName",o),t.nodeName==="Polygon"||t.nodeName==="PolygonPatch"){const a=e.getLinearRings();zt({node:t,hasZ:n,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,i,void 0,this)}else if(t.nodeName==="Surface"){const a=Ht(t.namespaceURI,"patches");t.appendChild(a),this.writeSurfacePatches_(a,e,i)}}writeCurveOrLineString(t,e,i){const r=i[i.length-1].srsName;if(t.nodeName!=="LineStringSegment"&&r&&t.setAttribute("srsName",r),t.nodeName==="LineString"||t.nodeName==="LineStringSegment"){const n=Ht(t.namespaceURI,"posList");t.appendChild(n),this.writePosList_(n,e,i)}else if(t.nodeName==="Curve"){const n=Ht(t.namespaceURI,"segments");t.appendChild(n),this.writeCurveSegments_(n,e,i)}}writeMultiSurfaceOrPolygon(t,e,i){const r=i[i.length-1],n=r.hasZ,o=r.srsName,a=r.surface;o&&t.setAttribute("srsName",o);const l=e.getPolygons();zt({node:t,hasZ:n,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeMultiPoint(t,e,i){const r=i[i.length-1],n=r.srsName,o=r.hasZ;n&&t.setAttribute("srsName",n);const a=e.getPoints();zt({node:t,hasZ:o,srsName:n},this.POINTMEMBER_SERIALIZERS,Fi("pointMember"),a,i,void 0,this)}writeMultiCurveOrLineString(t,e,i){const r=i[i.length-1],n=r.hasZ,o=r.srsName,a=r.curve;o&&t.setAttribute("srsName",o);const l=e.getLineStrings();zt({node:t,hasZ:n,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeRing(t,e,i){const r=Ht(t.namespaceURI,"LinearRing");t.appendChild(r),this.writeLinearRing(r,e,i)}writeSurfaceOrPolygonMember(t,e,i){const r=this.GEOMETRY_NODE_FACTORY_(e,i);r&&(t.appendChild(r),this.writeSurfaceOrPolygon(r,e,i))}writePointMember(t,e,i){const r=Ht(t.namespaceURI,"Point");t.appendChild(r),this.writePoint(r,e,i)}writeLineStringOrCurveMember(t,e,i){const r=this.GEOMETRY_NODE_FACTORY_(e,i);r&&(t.appendChild(r),this.writeCurveOrLineString(r,e,i))}writeSurfacePatches_(t,e,i){const r=Ht(t.namespaceURI,"PolygonPatch");t.appendChild(r),this.writeSurfaceOrPolygon(r,e,i)}writeCurveSegments_(t,e,i){const r=Ht(t.namespaceURI,"LineStringSegment");t.appendChild(r),this.writeCurveOrLineString(r,e,i)}writeGeometryElement(t,e,i){const r=i[i.length-1],n=Object.assign({},r);n.node=t;let o;Array.isArray(e)?o=pw(e,r):o=vi(e,!0,r),zt(n,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],i,void 0,this)}writeFeatureElement(t,e,i){const r=e.getId();r&&t.setAttribute("fid",r);const n=i[i.length-1],o=n.featureNS,a=e.getGeometryName();n.serializers||(n.serializers={},n.serializers[o]={});const l=[],h=[];if(e.hasProperties()){const u=e.getProperties();for(const d in u){const p=u[d];p!==null&&(l.push(d),h.push(p),d==a||typeof p.getSimplifiedGeometry=="function"?d in n.serializers[o]||(n.serializers[o][d]=D(this.writeGeometryElement,this)):d in n.serializers[o]||(n.serializers[o][d]=D(Dt)))}}const c=Object.assign({},n);c.node=t,zt(c,n.serializers,Fi(void 0,o),h,i,l)}writeFeatureMembers_(t,e,i){const r=i[i.length-1],n=r.featureType,o=r.featureNS,a={};a[o]={},a[o][n]=D(this.writeFeatureElement,this);const l=Object.assign({},r);l.node=t,zt(l,a,Fi(n,o),e,i)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(t,e,i){const r=e[e.length-1].node;return Ht(this.namespace,Qj[r.nodeName])}GEOMETRY_NODE_FACTORY_(t,e,i){const r=e[e.length-1],n=r.multiSurface,o=r.surface,a=r.curve,l=r.multiCurve;return Array.isArray(t)?i="Envelope":(i=t.getType(),i==="MultiPolygon"&&n===!0?i="MultiSurface":i==="Polygon"&&o===!0?i="Surface":i==="LineString"&&a===!0?i="Curve":i==="MultiLineString"&&l===!0&&(i="MultiCurve")),Ht(this.namespace,i)}writeGeometryNode(t,e){e=this.adaptOptions(e);const i=Ht(this.namespace,"geom"),r={node:i,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return e&&Object.assign(r,e),this.writeGeometryElement(i,t,[r]),i}writeFeaturesNode(t,e){e=this.adaptOptions(e);const i=Ht(this.namespace,"featureMembers");i.setAttributeNS(Ch,"xsi:schemaLocation",this.schemaLocation);const r={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return e&&Object.assign(r,e),this.writeFeatureMembers_(i,t,[r]),i}};bt.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:At(bt.prototype.readFlatPos),posList:At(bt.prototype.readFlatPosList),coordinates:At(nd.prototype.readFlatCoordinates)}};bt.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:bt.prototype.interiorParser,exterior:bt.prototype.exteriorParser}};bt.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:At(le.prototype.readPoint),MultiPoint:At(le.prototype.readMultiPoint),LineString:At(le.prototype.readLineString),MultiLineString:At(le.prototype.readMultiLineString),LinearRing:At(le.prototype.readLinearRing),Polygon:At(le.prototype.readPolygon),MultiPolygon:At(le.prototype.readMultiPolygon),Surface:At(bt.prototype.readSurface),MultiSurface:At(bt.prototype.readMultiSurface),Curve:At(bt.prototype.readCurve),MultiCurve:At(bt.prototype.readMultiCurve),Envelope:At(bt.prototype.readEnvelope)}};bt.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:vt(bt.prototype.curveMemberParser),curveMembers:vt(bt.prototype.curveMemberParser)}};bt.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:vt(bt.prototype.surfaceMemberParser),surfaceMembers:vt(bt.prototype.surfaceMemberParser)}};bt.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:vt(le.prototype.readLineString),Curve:vt(bt.prototype.readCurve)}};bt.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:vt(le.prototype.readPolygon),Surface:vt(bt.prototype.readSurface)}};bt.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:At(bt.prototype.readPatch)}};bt.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:At(bt.prototype.readSegment)}};bt.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:vt(bt.prototype.readFlatPosList),upperCorner:vt(bt.prototype.readFlatPosList)}};bt.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:At(bt.prototype.readPolygonPatch)}};bt.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:r0(bt.prototype.readLineStringSegment)}};le.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:At(le.prototype.readFlatLinearRing),Ring:At(bt.prototype.readFlatCurveRing)}};bt.prototype.writeFeatures;bt.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:D(bt.prototype.writeRing),interior:D(bt.prototype.writeRing)}};bt.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:D(Dt),upperCorner:D(Dt)}};bt.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:D(bt.prototype.writeSurfaceOrPolygonMember),polygonMember:D(bt.prototype.writeSurfaceOrPolygonMember)}};bt.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:D(bt.prototype.writePointMember)}};bt.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:D(bt.prototype.writeLineStringOrCurveMember),curveMember:D(bt.prototype.writeLineStringOrCurveMember)}};bt.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:D(bt.prototype.writeCurveOrLineString),MultiCurve:D(bt.prototype.writeMultiCurveOrLineString),Point:D(bt.prototype.writePoint),MultiPoint:D(bt.prototype.writeMultiPoint),LineString:D(bt.prototype.writeCurveOrLineString),MultiLineString:D(bt.prototype.writeMultiCurveOrLineString),LinearRing:D(bt.prototype.writeLinearRing),Polygon:D(bt.prototype.writeSurfaceOrPolygon),MultiPolygon:D(bt.prototype.writeMultiSurfaceOrPolygon),Surface:D(bt.prototype.writeSurfaceOrPolygon),MultiSurface:D(bt.prototype.writeMultiSurfaceOrPolygon),Envelope:D(bt.prototype.writeEnvelope)}};const oe=bt,_w=oe;_w.prototype.writeFeatures;_w.prototype.writeFeaturesNode;const tG=_w,yi=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],eG="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",iG={rte:rL,trk:nL,wpt:oL},sG=q(yi,{rte:vt(rL),trk:vt(nL),wpt:vt(oL)}),rG=q(yi,{text:F(Q,"linkText"),type:F(Q,"linkType")}),nG=q(yi,{name:F(Q),email:PG,link:Xg}),oG=q(yi,{name:F(Q),desc:F(Q),author:F(IG),copyright:F(AG),link:Xg,time:F(Z_),keywords:F(Q),bounds:LG,extensions:K_}),aG=q(yi,{year:F(Gi),license:F(Q)}),lG=q(yi,{rte:D(NG),trk:D(DG),wpt:D(jG)});class hG extends Wg{constructor(t){super(),t=t||{},this.dataProjection=ct("EPSG:4326"),this.readExtensions_=t.readExtensions}handleReadExtensions_(t){t||(t=[]);for(let e=0,i=t.length;e<i;++e){const r=t[e];if(this.readExtensions_){const n=r.get("extensionsNode_")||null;this.readExtensions_(r,n)}r.set("extensionsNode_",void 0)}}readMetadata(t){return t?typeof t=="string"?this.readMetadataFromDocument(nn(t)):rn(t)?this.readMetadataFromDocument(t):this.readMetadataFromNode(t):null}readMetadataFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType===Node.ELEMENT_NODE){const i=this.readMetadataFromNode(e);if(i)return i}return null}readMetadataFromNode(t){if(!yi.includes(t.namespaceURI))return null;for(let e=t.firstElementChild;e;e=e.nextElementSibling)if(yi.includes(e.namespaceURI)&&e.localName==="metadata")return Z({},oG,e,[]);return null}readFeatureFromNode(t,e){if(!yi.includes(t.namespaceURI))return null;const i=iG[t.localName];if(!i)return null;const r=i(t,[this.getReadOptions(t,e)]);return r?(this.handleReadExtensions_([r]),r):null}readFeaturesFromNode(t,e){if(!yi.includes(t.namespaceURI))return[];if(t.localName=="gpx"){const i=Z([],sG,t,[this.getReadOptions(t,e)]);return i?(this.handleReadExtensions_(i),i):[]}return[]}writeFeaturesNode(t,e){e=this.adaptOptions(e);const i=Ht("http://www.topografix.com/GPX/1/1","gpx"),r="http://www.w3.org/2000/xmlns/";return i.setAttributeNS(r,"xmlns:xsi",Ch),i.setAttributeNS(Ch,"xsi:schemaLocation",eG),i.setAttribute("version","1.1"),i.setAttribute("creator","OpenLayers"),zt({node:i},lG,MG,t,[e]),i}}const cG=q(yi,{name:F(Q),cmt:F(Q),desc:F(Q),src:F(Q),link:Xg,number:F(Gi),extensions:K_,type:F(Q),rtept:OG}),uG=q(yi,{ele:F(pe),time:F(Z_)}),dG=q(yi,{name:F(Q),cmt:F(Q),desc:F(Q),src:F(Q),link:Xg,number:F(Gi),type:F(Q),extensions:K_,trkseg:kG}),pG=q(yi,{trkpt:FG}),gG=q(yi,{ele:F(pe),time:F(Z_)}),fG=q(yi,{ele:F(pe),time:F(Z_),magvar:F(pe),geoidheight:F(pe),name:F(Q),cmt:F(Q),desc:F(Q),src:F(Q),link:Xg,sym:F(Q),type:F(Q),fix:F(Q),sat:F(Gi),hdop:F(pe),vdop:F(pe),pdop:F(pe),ageofdgpsdata:F(pe),dgpsid:F(Gi),extensions:K_}),mG=["text","type"],_G=q(yi,{text:D(Dt),type:D(Dt)}),yG=q(yi,["name","cmt","desc","src","link","number","type","rtept"]),xG=q(yi,{name:D(Dt),cmt:D(Dt),desc:D(Dt),src:D(Dt),link:D(vw),number:D(n0),type:D(Dt),rtept:iL(D(bw))}),vG=q(yi,["ele","time"]),bG=q(yi,["name","cmt","desc","src","link","number","type","trkseg"]),wG=q(yi,{name:D(Dt),cmt:D(Dt),desc:D(Dt),src:D(Dt),link:D(vw),number:D(n0),type:D(Dt),trkseg:iL(D($G))}),EG=Fi("trkpt"),SG=q(yi,{trkpt:D(bw)}),CG=q(yi,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),TG=q(yi,{ele:D(vr),time:D(Yj),magvar:D(vr),geoidheight:D(vr),name:D(Dt),cmt:D(Dt),desc:D(Dt),src:D(Dt),link:D(vw),sym:D(Dt),type:D(Dt),fix:D(Dt),sat:D(n0),hdop:D(vr),vdop:D(vr),pdop:D(vr),ageofdgpsdata:D(vr),dgpsid:D(n0)}),RG={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function MG(s,t,e){const i=s.getGeometry();if(i){const r=RG[i.getType()];if(r){const n=t[t.length-1].node;return Ht(n.namespaceURI,r)}}}function yw(s,t,e,i){return s.push(parseFloat(e.getAttribute("lon")),parseFloat(e.getAttribute("lat"))),"ele"in i?(s.push(i.ele),delete i.ele,t.hasZ=!0):s.push(0),"time"in i?(s.push(i.time),delete i.time,t.hasM=!0):s.push(0),s}function xw(s,t,e){let i="XY",r=2;if(s.hasZ&&s.hasM?(i="XYZM",r=4):s.hasZ?(i="XYZ",r=3):s.hasM&&(i="XYM",r=3),r!==4){for(let n=0,o=t.length/4;n<o;n++)t[n*r]=t[n*4],t[n*r+1]=t[n*4+1],s.hasZ&&(t[n*r+2]=t[n*4+2]),s.hasM&&(t[n*r+2]=t[n*4+3]);if(t.length=t.length/4*r,e)for(let n=0,o=e.length;n<o;n++)e[n]=e[n]/4*r}return i}function IG(s,t){const e=Z({},nG,s,t);if(e)return e}function AG(s,t){const e=Z({},aG,s,t);if(e){const i=s.getAttribute("author");return i!==null&&(e.author=i),e}}function LG(s,t){const e=t[t.length-1],i=s.getAttribute("minlat"),r=s.getAttribute("minlon"),n=s.getAttribute("maxlat"),o=s.getAttribute("maxlon");r!==null&&i!==null&&o!==null&&n!==null&&(e.bounds=[[parseFloat(r),parseFloat(i)],[parseFloat(o),parseFloat(n)]])}function PG(s,t){const e=t[t.length-1],i=s.getAttribute("id"),r=s.getAttribute("domain");i!==null&&r!==null&&(e.email=`${i}@${r}`)}function Xg(s,t){const e=t[t.length-1],i=s.getAttribute("href");i!==null&&(e.link=i),Rr(rG,s,t)}function K_(s,t){const e=t[t.length-1];e.extensionsNode_=s}function OG(s,t){const e=Z({},uG,s,t);if(e){const i=t[t.length-1],r=i.flatCoordinates,n=i.layoutOptions;yw(r,n,s,e)}}function FG(s,t){const e=Z({},gG,s,t);if(e){const i=t[t.length-1],r=i.flatCoordinates,n=i.layoutOptions;yw(r,n,s,e)}}function kG(s,t){const e=t[t.length-1];Rr(pG,s,t);const i=e.flatCoordinates;e.ends.push(i.length)}function rL(s,t){const e=t[0],i=Z({flatCoordinates:[],layoutOptions:{}},cG,s,t);if(!i)return;const r=i.flatCoordinates;delete i.flatCoordinates;const n=i.layoutOptions;delete i.layoutOptions;const o=xw(n,r),a=new Ps(r,o);vi(a,!1,e);const l=new Ls(a);return l.setProperties(i,!0),l}function nL(s,t){const e=t[0],i=Z({flatCoordinates:[],ends:[],layoutOptions:{}},dG,s,t);if(!i)return;const r=i.flatCoordinates;delete i.flatCoordinates;const n=i.ends;delete i.ends;const o=i.layoutOptions;delete i.layoutOptions;const a=xw(o,r,n),l=new Bn(r,a,n);vi(l,!1,e);const h=new Ls(l);return h.setProperties(i,!0),h}function oL(s,t){const e=t[0],i=Z({},fG,s,t);if(!i)return;const r={},n=yw([],r,s,i),o=xw(r,n),a=new xs(n,o);vi(a,!1,e);const l=new Ls(a);return l.setProperties(i,!0),l}function vw(s,t,e){s.setAttribute("href",t);const i=e[e.length-1].properties,r=[i.linkText,i.linkType];zt({node:s},_G,bs,r,e,mG)}function bw(s,t,e){const i=e[e.length-1],r=i.node.namespaceURI,n=i.properties;switch(s.setAttributeNS(null,"lat",String(t[1])),s.setAttributeNS(null,"lon",String(t[0])),i.geometryLayout){case"XYZM":t[3]!==0&&(n.time=t[3]);case"XYZ":t[2]!==0&&(n.ele=t[2]);break;case"XYM":t[2]!==0&&(n.time=t[2]);break}const o=s.nodeName=="rtept"?vG[r]:CG[r],a=Mr(n,o);zt({node:s,properties:n},TG,bs,a,e,o)}function NG(s,t,e){const i=e[0],r=t.getProperties(),n={node:s};n.properties=r;const o=t.getGeometry();if(o.getType()=="LineString"){const c=vi(o,!0,i);n.geometryLayout=c.getLayout(),r.rtept=c.getCoordinates()}const a=e[e.length-1].node,l=yG[a.namespaceURI],h=Mr(r,l);zt(n,xG,bs,h,e,l)}function DG(s,t,e){const i=e[0],r=t.getProperties(),n={node:s};n.properties=r;const o=t.getGeometry();if(o.getType()=="MultiLineString"){const c=vi(o,!0,i);r.trkseg=c.getLineStrings()}const a=e[e.length-1].node,l=bG[a.namespaceURI],h=Mr(r,l);zt(n,wG,bs,h,e,l)}function $G(s,t,e){const i={node:s};i.geometryLayout=t.getLayout(),i.properties={},zt(i,SG,EG,t.getCoordinates(),e)}function jG(s,t,e){const i=e[0],r=e[e.length-1];r.properties=t.getProperties();const n=t.getGeometry();if(n.getType()=="Point"){const o=vi(n,!0,i);r.geometryLayout=o.getLayout(),bw(s,o.getCoordinates(),e)}}const GG=hG;class zG extends Vg{constructor(){super()}getType(){return"text"}readFeature(t,e){return this.readFeatureFromText(Hf(t),this.adaptOptions(e))}readFeatureFromText(t,e){return Lt()}readFeatures(t,e){return this.readFeaturesFromText(Hf(t),this.adaptOptions(e))}readFeaturesFromText(t,e){return Lt()}readGeometry(t,e){return this.readGeometryFromText(Hf(t),this.adaptOptions(e))}readGeometryFromText(t,e){return Lt()}readProjection(t){return this.readProjectionFromText(Hf(t))}readProjectionFromText(t){return this.dataProjection}writeFeature(t,e){return this.writeFeatureText(t,this.adaptOptions(e))}writeFeatureText(t,e){return Lt()}writeFeatures(t,e){return this.writeFeaturesText(t,this.adaptOptions(e))}writeFeaturesText(t,e){return Lt()}writeGeometry(t,e){return this.writeGeometryText(t,this.adaptOptions(e))}writeGeometryText(t,e){return Lt()}}function Hf(s){return typeof s=="string"?s:""}const ww=zG,BG=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,UG=/^H.([A-Z]{3}).*?:(.*)/,VG=/^HFDTE(\d{2})(\d{2})(\d{2})/,HG=/\r\n|\r|\n/;class WG extends ww{constructor(t){super(),t=t||{},this.dataProjection=ct("EPSG:4326"),this.altitudeMode_=t.altitudeMode?t.altitudeMode:"none"}readFeatureFromText(t,e){const i=this.altitudeMode_,r=t.split(HG),n={},o=[];let a=2e3,l=0,h=1,c=-1,u,d;for(u=0,d=r.length;u<d;++u){const m=r[u];let _;if(m.charAt(0)=="B"){if(_=BG.exec(m),_){const y=parseInt(_[1],10),v=parseInt(_[2],10),b=parseInt(_[3],10);let E=parseInt(_[4],10)+parseInt(_[5],10)/6e4;_[6]=="S"&&(E=-E);let S=parseInt(_[7],10)+parseInt(_[8],10)/6e4;if(_[9]=="W"&&(S=-S),o.push(S,E),i!="none"){let R;i=="gps"?R=parseInt(_[11],10):i=="barometric"?R=parseInt(_[12],10):R=0,o.push(R)}let T=Date.UTC(a,l,h,y,v,b);T<c&&(T=Date.UTC(a,l,h+1,y,v,b)),o.push(T/1e3),c=T}}else m.charAt(0)=="H"&&(_=VG.exec(m),_?(h=parseInt(_[1],10),l=parseInt(_[2],10)-1,a=2e3+parseInt(_[3],10)):(_=UG.exec(m),_&&(n[_[1]]=_[2].trim())))}if(o.length===0)return null;const p=i=="none"?"XYM":"XYZM",g=new Ps(o,p),f=new Ls(vi(g,!1,e));return f.setProperties(n,!0),f}readFeaturesFromText(t,e){const i=this.readFeatureFromText(t,e);return i?[i]:[]}}const XG=WG,is={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"},Th={};Th[is.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}};Th[is.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}};Th[is.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}};Th.none={none:{supports:[],formats:[],qualities:[]}};const qG=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,lC=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,YG=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function ZG(s){let t=s.getComplianceLevelSupportedFeatures();return t===void 0&&(t=Th[is.VERSION1].level0),{url:s.imageInfo["@id"]===void 0?void 0:s.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:t.supports,formats:[...t.formats,s.imageInfo.formats===void 0?[]:s.imageInfo.formats],qualities:[...t.qualities,s.imageInfo.qualities===void 0?[]:s.imageInfo.qualities],resolutions:s.imageInfo.scale_factors,tileSize:s.imageInfo.tile_width!==void 0?s.imageInfo.tile_height!==void 0?[s.imageInfo.tile_width,s.imageInfo.tile_height]:[s.imageInfo.tile_width,s.imageInfo.tile_width]:s.imageInfo.tile_height!=null?[s.imageInfo.tile_height,s.imageInfo.tile_height]:void 0}}function KG(s){const t=s.getComplianceLevelSupportedFeatures(),e=Array.isArray(s.imageInfo.profile)&&s.imageInfo.profile.length>1,i=e&&s.imageInfo.profile[1].supports?s.imageInfo.profile[1].supports:[],r=e&&s.imageInfo.profile[1].formats?s.imageInfo.profile[1].formats:[],n=e&&s.imageInfo.profile[1].qualities?s.imageInfo.profile[1].qualities:[];return{url:s.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:s.imageInfo.sizes===void 0?void 0:s.imageInfo.sizes.map(function(o){return[o.width,o.height]}),tileSize:s.imageInfo.tiles===void 0?void 0:[s.imageInfo.tiles.map(function(o){return o.width})[0],s.imageInfo.tiles.map(function(o){return o.height===void 0?o.width:o.height})[0]],resolutions:s.imageInfo.tiles===void 0?void 0:s.imageInfo.tiles.map(function(o){return o.scaleFactors})[0],supports:[...t.supports,...i],formats:[...t.formats,...r],qualities:[...t.qualities,...n]}}function JG(s){const t=s.getComplianceLevelSupportedFeatures(),e=s.imageInfo.extraFormats===void 0?t.formats:[...t.formats,...s.imageInfo.extraFormats],i=s.imageInfo.preferredFormats!==void 0&&Array.isArray(s.imageInfo.preferredFormats)&&s.imageInfo.preferredFormats.length>0?s.imageInfo.preferredFormats.filter(function(r){return["jpg","png","gif"].includes(r)}).reduce(function(r,n){return r===void 0&&e.includes(n)?n:r},void 0):void 0;return{url:s.imageInfo.id,sizes:s.imageInfo.sizes===void 0?void 0:s.imageInfo.sizes.map(function(r){return[r.width,r.height]}),tileSize:s.imageInfo.tiles===void 0?void 0:[s.imageInfo.tiles.map(function(r){return r.width})[0],s.imageInfo.tiles.map(function(r){return r.height})[0]],resolutions:s.imageInfo.tiles===void 0?void 0:s.imageInfo.tiles.map(function(r){return r.scaleFactors})[0],supports:s.imageInfo.extraFeatures===void 0?t.supports:[...t.supports,...s.imageInfo.extraFeatures],formats:e,qualities:s.imageInfo.extraQualities===void 0?t.qualities:[...t.qualities,...s.imageInfo.extraQualities],preferredFormat:i}}const J_={};J_[is.VERSION1]=ZG;J_[is.VERSION2]=KG;J_[is.VERSION3]=JG;class QG{constructor(t){this.setImageInfo(t)}setImageInfo(t){typeof t=="string"?this.imageInfo=JSON.parse(t):this.imageInfo=t}getImageApiVersion(){if(this.imageInfo===void 0)return;let t=this.imageInfo["@context"]||"ol-no-context";typeof t=="string"&&(t=[t]);for(let e=0;e<t.length;e++)switch(t[e]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return is.VERSION1;case"http://iiif.io/api/image/2/context.json":return is.VERSION2;case"http://iiif.io/api/image/3/context.json":return is.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(is.VERSION1)&&this.imageInfo.identifier)return is.VERSION1;break}ge(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(t){if(!(this.imageInfo===void 0||this.imageInfo.profile===void 0))switch(t===void 0&&(t=this.getImageApiVersion()),t){case is.VERSION1:if(qG.test(this.imageInfo.profile))return this.imageInfo.profile;break;case is.VERSION3:if(YG.test(this.imageInfo.profile))return this.imageInfo.profile;break;case is.VERSION2:if(typeof this.imageInfo.profile=="string"&&lC.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&typeof this.imageInfo.profile[0]=="string"&&lC.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0];break}}getComplianceLevelFromProfile(t){const e=this.getComplianceLevelEntryFromProfile(t);if(e===void 0)return;const i=e.match(/level[0-2](?:\.json)?$/g);return Array.isArray(i)?i[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(this.imageInfo===void 0)return;const t=this.getImageApiVersion(),e=this.getComplianceLevelFromProfile(t);return e===void 0?Th.none.none:Th[t][e]}getTileSourceOptions(t){const e=t||{},i=this.getImageApiVersion();if(i===void 0)return;const r=i===void 0?void 0:J_[i](this);if(r!==void 0)return{url:r.url,version:i,size:[this.imageInfo.width,this.imageInfo.height],sizes:r.sizes,format:e.format!==void 0&&r.formats.includes(e.format)?e.format:r.preferredFormat!==void 0?r.preferredFormat:"jpg",supports:r.supports,quality:e.quality&&r.qualities.includes(e.quality)?e.quality:r.qualities.includes("native")?"native":"default",resolutions:Array.isArray(r.resolutions)?r.resolutions.sort(function(n,o){return o-n}):void 0,tileSize:r.tileSize}}}const t4=QG,dt={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},Vp={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var Ms={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};Ms.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};Ms.max=Ms.whitepoint[2].D65;Ms.rgb=function(s,t){t=t||Ms.whitepoint[2].E;var e=s[0]/t[0],i=s[1]/t[1],r=s[2]/t[2],n,o,a;return n=e*3.240969941904521+i*-1.537383177570093+r*-.498610760293,o=e*-.96924363628087+i*1.87596750150772+r*.041555057407175,a=e*.055630079696993+i*-.20397695888897+r*1.056971514242878,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:n=n*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,n=Math.min(Math.max(0,n),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[n*255,o*255,a*255]};Vp.xyz=function(s,t){var e=s[0]/255,i=s[1]/255,r=s[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;var n=e*.41239079926595+i*.35758433938387+r*.18048078840183,o=e*.21263900587151+i*.71516867876775+r*.072192315360733,a=e*.019330818715591+i*.11919477979462+r*.95053215224966;return t=t||Ms.whitepoint[2].E,[n*t[0],o*t[1],a*t[2]]};const Ew={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(s,t,e){var i,r,n,o,a,l,h,c,u,d,p,g,f;if(n=s[0],o=s[1],a=s[2],n===0)return[0,0,0];var m=.0011070564598794539;return t=t||"D65",e=e||2,u=Ms.whitepoint[e][t][0],d=Ms.whitepoint[e][t][1],p=Ms.whitepoint[e][t][2],g=4*u/(u+15*d+3*p),f=9*d/(u+15*d+3*p),i=o/(13*n)+g||0,r=a/(13*n)+f||0,h=n>8?d*Math.pow((n+16)/116,3):d*n*m,l=h*9*i/(4*r)||0,c=h*(12-3*i-20*r)/(4*r)||0,[l,h,c]}};Ms.luv=function(s,t,e){var i,r,n,o,a,l,h,c,u,d,p,g,f,m=.008856451679035631,_=903.2962962962961;t=t||"D65",e=e||2,u=Ms.whitepoint[e][t][0],d=Ms.whitepoint[e][t][1],p=Ms.whitepoint[e][t][2],g=4*u/(u+15*d+3*p),f=9*d/(u+15*d+3*p),l=s[0],h=s[1],c=s[2],i=4*l/(l+15*h+3*c)||0,r=9*h/(l+15*h+3*c)||0;var y=h/d;return n=y<=m?_*y:116*Math.pow(y,1/3)-16,o=13*n*(i-g),a=13*n*(r-f),[n,o,a]};var aL={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(s){var t=s[0],e=s[1],i=s[2],r,n,o;return o=i/360*2*Math.PI,r=e*Math.cos(o),n=e*Math.sin(o),[t,r,n]},xyz:function(s){return Ew.xyz(aL.luv(s))}};Ew.lchuv=function(s){var t=s[0],e=s[1],i=s[2],r=Math.sqrt(e*e+i*i),n=Math.atan2(i,e),o=n*360/2/Math.PI;return o<0&&(o+=360),[t,r,o]};Ms.lchuv=function(s){return Ew.lchuv(Ms.luv(s))};var vh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function od(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var e4={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};const hC=od(e4);var cC={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function i4(s){var t,e,i,r=[],n=1,o;if(typeof s=="number")return{space:"rgb",values:[s>>>16,(s&65280)>>>8,s&255],alpha:1};if(typeof s=="number")return{space:"rgb",values:[s>>>16,(s&65280)>>>8,s&255],alpha:1};if(s=String(s).toLowerCase(),hC[s])r=hC[s].slice(),o="rgb";else if(s==="transparent")n=0,o="rgb",r=[0,0,0];else if(s[0]==="#"){var a=s.slice(1),l=a.length,h=l<=4;n=1,h?(r=[parseInt(a[0]+a[0],16),parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16)],l===4&&(n=parseInt(a[3]+a[3],16)/255)):(r=[parseInt(a[0]+a[1],16),parseInt(a[2]+a[3],16),parseInt(a[4]+a[5],16)],l===8&&(n=parseInt(a[6]+a[7],16)/255)),r[0]||(r[0]=0),r[1]||(r[1]=0),r[2]||(r[2]=0),o="rgb"}else if(i=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(s)){var c=i[1];o=c.replace(/a$/,"");var u=o==="cmyk"?4:o==="gray"?1:3;r=i[2].trim().split(/\s*[,\/]\s*|\s+/),o==="color"&&(o=r.shift()),r=r.map(function(d,p){if(d[d.length-1]==="%")return d=parseFloat(d)/100,p===3?d:o==="rgb"?d*255:o[0]==="h"||o[0]==="l"&&!p?d*100:o==="lab"?d*125:o==="lch"?p<2?d*150:d*360:o[0]==="o"&&!p?d:o==="oklab"?d*.4:o==="oklch"?p<2?d*.4:d*360:d;if(o[p]==="h"||p===2&&o[o.length-1]==="h"){if(cC[d]!==void 0)return cC[d];if(d.endsWith("deg"))return parseFloat(d);if(d.endsWith("turn"))return parseFloat(d)*360;if(d.endsWith("grad"))return parseFloat(d)*360/400;if(d.endsWith("rad"))return parseFloat(d)*180/Math.PI}return d==="none"?0:parseFloat(d)}),n=r.length>u?r.pop():1}else/[0-9](?:\s|\/|,)/.test(s)&&(r=s.match(/([0-9]+)/g).map(function(d){return parseFloat(d)}),o=((e=(t=s.match(/([a-z])/ig))==null?void 0:t.join(""))==null?void 0:e.toLowerCase())||"rgb");return{space:o,values:r,alpha:n}}const C1={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(s){var t=s[0]/360,e=s[1]/100,i=s[2]/100,r,n,o,a,l,h=0;if(e===0)return l=i*255,[l,l,l];for(n=i<.5?i*(1+e):i+e-i*e,r=2*i-n,a=[0,0,0];h<3;)o=t+1/3*-(h-1),o<0?o++:o>1&&o--,l=6*o<1?r+(n-r)*6*o:2*o<1?n:3*o<2?r+(n-r)*(2/3-o)*6:r,a[h++]=l*255;return a}};Vp.hsl=function(s){var t=s[0]/255,e=s[1]/255,i=s[2]/255,r=Math.min(t,e,i),n=Math.max(t,e,i),o=n-r,a,l,h;return n===r?a=0:t===n?a=(e-i)/o:e===n?a=2+(i-t)/o:i===n&&(a=4+(t-e)/o),a=Math.min(a*60,360),a<0&&(a+=360),h=(r+n)/2,n===r?l=0:h<=.5?l=o/(n+r):l=o/(2-n-r),[a,l*100,h*100]};function s4(s){Array.isArray(s)&&s.raw&&(s=String.raw(...arguments)),s instanceof Number&&(s=+s);var t,e=i4(s);if(!e.space)return[];const i=e.space[0]==="h"?C1.min:Vp.min,r=e.space[0]==="h"?C1.max:Vp.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],i[0]),r[0]),t[1]=Math.min(Math.max(e.values[1],i[1]),r[1]),t[2]=Math.min(Math.max(e.values[2],i[2]),r[2]),e.space[0]==="h"&&(t=C1.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}function r4(s){return typeof s=="string"?s:hL(s)}const n4=1024,Od={};let T1=0;function o4(s){if(s.length===4)return s;const t=s.slice();return t[3]=1,t}function uC(s){const t=Ms.lchuv(Vp.xyz(s));return t[3]=s[3],t}function a4(s){const t=Ms.rgb(aL.xyz(s));return t[3]=s[3],t}function Sw(s){if(Od.hasOwnProperty(s))return Od[s];if(T1>=n4){let e=0;for(const i in Od)e++&3||(delete Od[i],--T1)}const t=s4(s);if(t.length!==4)throw new Error('Failed to parse "'+s+'" as color');for(const e of t)if(isNaN(e))throw new Error('Failed to parse "'+s+'" as color');return lL(t),Od[s]=t,++T1,t}function jn(s){return Array.isArray(s)?s:Sw(s)}function lL(s){return s[0]=Jt(s[0]+.5|0,0,255),s[1]=Jt(s[1]+.5|0,0,255),s[2]=Jt(s[2]+.5|0,0,255),s[3]=Jt(s[3],0,1),s}function hL(s){let t=s[0];t!=(t|0)&&(t=t+.5|0);let e=s[1];e!=(e|0)&&(e=e+.5|0);let i=s[2];i!=(i|0)&&(i=i+.5|0);const r=s[3]===void 0?1:Math.round(s[3]*1e3)/1e3;return"rgba("+t+","+e+","+i+","+r+")"}function l4(s){try{return Sw(s),!0}catch{return!1}}const Rl=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"";Rl.includes("firefox");const h4=Rl.includes("safari")&&!Rl.includes("chrom"),c4=h4&&(Rl.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Rl));Rl.includes("webkit")&&Rl.includes("edge");Rl.includes("macintosh");const cL=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Cw=typeof Image<"u"&&Image.prototype.decode,u4=typeof createImageBitmap=="function";(function(){let s=!1;try{const t=Object.defineProperty({},"passive",{get:function(){s=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return s})();function ui(s,t,e,i){let r;return e&&e.length?r=e.shift():cL?r=new OffscreenCanvas(s||300,t||300):r=document.createElement("canvas"),s&&(r.width=s),t&&(r.height=t),r.getContext("2d",i)}let R1;function xv(){return R1||(R1=ui(1,1)),R1}function Rh(s){const t=s.canvas;t.width=1,t.height=1,s.clearRect(0,0,1,1)}let d4=class extends Dg{constructor(t,e,i,r){super(),this.extent=t,this.pixelRatio_=i,this.resolution=e,this.state=typeof r=="function"?dt.IDLE:r,this.image_=null,this.loader=typeof r=="function"?r:null}changed(){this.dispatchEvent(fe.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==dt.IDLE&&this.loader){this.state=dt.LOADING,this.changed();const t=this.getResolution(),e=Array.isArray(t)?t[0]:t;EA(()=>this.loader(this.getExtent(),e,this.getPixelRatio())).then(i=>{"image"in i&&(this.image_=i.image),"extent"in i&&(this.extent=i.extent),"resolution"in i&&(this.resolution=i.resolution),"pixelRatio"in i&&(this.pixelRatio_=i.pixelRatio),(i instanceof HTMLImageElement||i instanceof ImageBitmap||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement)&&(this.image_=i),this.state=dt.LOADED}).catch(i=>{this.state=dt.ERROR,console.error(i)}).finally(()=>this.changed())}}setImage(t){this.image_=t}setResolution(t){this.resolution=t}};function p4(s,t,e){const i=s;let r=!0,n=!1,o=!1;const a=[jp(i,fe.LOAD,function(){o=!0,n||t()})];return i.src&&Cw?(n=!0,i.decode().then(function(){r&&t()}).catch(function(l){r&&(o?t():e())})):a.push(jp(i,fe.ERROR,e)),function(){r=!1,a.forEach(cs)}}function g4(s,t){return new Promise((e,i)=>{function r(){o(),e(s)}function n(){o(),i(new Error("Image load error"))}function o(){s.removeEventListener("load",r),s.removeEventListener("error",n)}s.addEventListener("load",r),s.addEventListener("error",n),t&&(s.src=t)})}function uL(s,t){return t&&(s.src=t),s.src&&Cw?new Promise((e,i)=>s.decode().then(()=>e(s)).catch(r=>s.complete&&s.width?e(s):i(r))):g4(s)}function Nl(s,t){return t&&(s.src=t),s.src&&Cw&&u4?s.decode().then(()=>createImageBitmap(s)).catch(e=>{if(s.complete&&s.width)return s;throw e}):uL(s)}const Q_=d4;let f4=class{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const i=this.cache_[e];!(t++&3)&&!i.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,i){const r=M1(t,e,i);return r in this.cache_?this.cache_[r]:null}getPattern(t,e,i){const r=M1(t,e,i);return r in this.patternCache_?this.patternCache_[r]:null}set(t,e,i,r,n){const o=M1(t,e,i),a=o in this.cache_;this.cache_[o]=r,n&&(r.getImageState()===dt.IDLE&&r.load(),r.getImageState()===dt.LOADING?r.ready().then(()=>{this.patternCache_[o]=xv().createPattern(r.getImage(1),"repeat")}):this.patternCache_[o]=xv().createPattern(r.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}};function M1(s,t,e){const i=e?jn(e):"null";return t+":"+s+":"+i}const ol=new f4;let Fd=null,m4=class extends Dg{constructor(t,e,i,r,n){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=i,this.canvas_={},this.color_=n,this.imageState_=r===void 0?dt.IDLE:r,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===dt.LOADED){Fd||(Fd=ui(1,1,void 0,{willReadFrequently:!0})),Fd.drawImage(this.image_,0,0);try{Fd.getImageData(0,0,1,1),this.tainted_=!1}catch{Fd=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(fe.CHANGE)}handleImageError_(){this.imageState_=dt.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=dt.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=ui(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===dt.IDLE){this.image_||this.initializeImage_(),this.imageState_=dt.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&uL(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==dt.LOADED)return;const e=this.image_,i=document.createElement("canvas");i.width=Math.ceil(e.width*t),i.height=Math.ceil(e.height*t);const r=i.getContext("2d");r.scale(t,t),r.drawImage(e,0,0),r.globalCompositeOperation="multiply",r.fillStyle=r4(this.color_),r.fillRect(0,0,i.width/t,i.height/t),r.globalCompositeOperation="destination-in",r.drawImage(e,0,0),this.canvas_[t]=i}ready(){return this.ready_||(this.ready_=new Promise(t=>{this.imageState_===dt.LOADED||this.imageState_===dt.ERROR?t():this.addEventListener(fe.CHANGE,function e(){(this.imageState_===dt.LOADED||this.imageState_===dt.ERROR)&&(this.removeEventListener(fe.CHANGE,e),t())})})),this.ready_}};function Tw(s,t,e,i,r,n){let o=t===void 0?void 0:ol.get(t,e,r);return o||(o=new m4(s,s instanceof HTMLImageElement?s.src||void 0:t,e,i,r),ol.set(t,e,r,o,n)),n&&o&&!ol.getPattern(t,e,r)&&ol.set(t,e,r,o,n),o}let _4=class dL{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new dL({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=Tw(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===dt.IDLE&&e.load(),e.getImageState()===dt.LOADING&&(this.patternImage_=e)}this.color_=t}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}};const da=_4;function pL(s,t,e){return e===void 0&&(e=[0,0]),e[0]=s[0]*t+.5|0,e[1]=s[1]*t+.5|0,e}function xi(s,t){return Array.isArray(s)?s:(t===void 0?t=[s,s]:(t[0]=s,t[1]=s),t)}let y4=class gL{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=xi(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new gL({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return Lt()}getImage(t){return Lt()}getHitDetectionImage(){return Lt()}getPixelRatio(t){return 1}getImageState(){return Lt()}getImageSize(){return Lt()}getOrigin(){return Lt()}getSize(){return Lt()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=xi(t)}listenImageChange(t){Lt()}load(){Lt()}unlistenImageChange(t){Lt()}ready(){return Promise.resolve()}};const fL=y4;function dC(s,t,e,i){return e!==void 0&&i!==void 0?[e/s,i/t]:e!==void 0?e/s:i!==void 0?i/t:1}let x4=class mL extends fL{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,i=t.rotation!==void 0?t.rotation:0,r=t.scale!==void 0?t.scale:1,n=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:i,scale:r,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:n,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const o=t.img!==void 0?t.img:null;let a=t.src;ge(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||xt(o)),ge(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),ge(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=dt.IDLE:o!==void 0&&(o instanceof HTMLImageElement?o.complete?l=o.src?dt.LOADED:dt.IDLE:l=dt.LOADING:l=dt.LOADED),this.color_=t.color!==void 0?jn(t.color):null,this.iconImage_=Tw(o,a,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,t.width!==void 0||t.height!==void 0){let h,c;if(t.size)[h,c]=t.size;else{const u=this.getImage(1);if(u.width&&u.height)h=u.width,c=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=t;const d=()=>{if(this.unlistenImageChange(d),!this.initialOptions_)return;const p=this.iconImage_.getSize();this.setScale(dC(p[0],p[1],t.width,t.height))};this.listenImageChange(d);return}}h!==void 0&&this.setScale(dC(h,c,t.width,t.height))}}clone(){let t,e,i;return this.initialOptions_?(e=this.initialOptions_.width,i=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new mL({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const r=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!r)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=r[0]),this.anchorYUnits_=="fraction"&&(t[1]*=r[1])}if(this.anchorOrigin_!="top-left"){if(!r)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+r[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+r[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=i[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==dt.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==dt.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(fe.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(fe.CHANGE,t)}ready(){return this.iconImage_.ready()}};const ty=x4;let v4=class _L{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new _L({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}};const fo=v4;function io(s){return s?Array.isArray(s)?hL(s):typeof s=="object"&&"src"in s?b4(s):s:null}function b4(s){if(!s.offset||!s.size)return ol.getPattern(s.src,"anonymous",s.color);const t=s.src+":"+s.offset,e=ol.getPattern(t,void 0,s.color);if(e)return e;const i=ol.get(s.src,"anonymous",null);if(i.getImageState()!==dt.LOADED)return null;const r=ui(s.size[0],s.size[1]);return r.drawImage(i.getImage(1),s.offset[0],s.offset[1],s.size[0],s.size[1],0,0,s.size[0],s.size[1]),Tw(r.canvas,t,void 0,dt.LOADED,s.color,!0),ol.getPattern(t,void 0,s.color)}const w4=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),pC=["style","variant","weight","size","lineHeight","family"],yL=function(s){const t=s.match(w4);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,r=pC.length;i<r;++i){const n=t[i+1];n!==void 0&&(e[pC[i]]=n)}return e.families=e.family.split(/,\s?/),e},xL="10px sans-serif",br="#000",Au="round",Qo=[],ta=0,Lu="round",Hp=10,Wp="#000",Xp="center",o0="middle",lh=[0,0,0,0],qp=1,Ga=new jh;let vc=null,vv;const bv={},E4=function(){const s="32px ",t=["monospace","serif"],e=t.length,i="wmytzilWMYTZIL@#/&?$%10";let r,n;function o(l,h,c){let u=!0;for(let d=0;d<e;++d){const p=t[d];if(n=a0(l+" "+h+" "+s+p,i),c!=p){const g=a0(l+" "+h+" "+s+c+","+p,i);u=u&&g!=n}}return!!u}function a(){let l=!0;const h=Ga.getKeys();for(let c=0,u=h.length;c<u;++c){const d=h[c];Ga.get(d)<100&&(o.apply(this,d.split(`
`))?(ed(bv),vc=null,vv=void 0,Ga.set(d,100)):(Ga.set(d,Ga.get(d)+1,!0),l=!1))}l&&(clearInterval(r),r=void 0)}return function(l){const h=yL(l);if(!h)return;const c=h.families;for(let u=0,d=c.length;u<d;++u){const p=c[u],g=h.style+`
`+h.weight+`
`+p;Ga.get(g)===void 0&&(Ga.set(g,100,!0),o(h.style,h.weight,p)||(Ga.set(g,0,!0),r===void 0&&(r=setInterval(a,32))))}}}(),S4=function(){let s;return function(t){let e=bv[t];if(e==null){if(cL){const i=yL(t),r=vL(t,"Žg");e=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent)}else s||(s=document.createElement("div"),s.innerHTML="M",s.style.minHeight="0",s.style.maxHeight="none",s.style.height="auto",s.style.padding="0",s.style.border="none",s.style.position="absolute",s.style.display="block",s.style.left="-99999px"),s.style.font=t,document.body.appendChild(s),e=s.offsetHeight,document.body.removeChild(s);bv[t]=e}return e}}();function vL(s,t){return vc||(vc=ui(1,1)),s!=vv&&(vc.font=s,vv=vc.font),vc.measureText(t)}function a0(s,t){return vL(s,t).width}function gC(s,t,e){if(t in e)return e[t];const i=t.split(`
`).reduce((r,n)=>Math.max(r,a0(s,n)),0);return e[t]=i,i}function C4(s,t){const e=[],i=[],r=[];let n=0,o=0,a=0,l=0;for(let h=0,c=t.length;h<=c;h+=2){const u=t[h];if(u===`
`||h===c){n=Math.max(n,o),r.push(o),o=0,a+=l;continue}const d=t[h+1]||s.font,p=a0(d,u);e.push(p),o+=p;const g=S4(d);i.push(g),l=Math.max(l,g)}return{width:n,height:a,widths:e,heights:i,lineWidths:r}}function T4(s,t,e,i,r,n,o,a,l,h,c){s.save(),e!==1&&(s.globalAlpha===void 0?s.globalAlpha=u=>u.globalAlpha*=e:s.globalAlpha*=e),t&&s.transform.apply(s,t),i.contextInstructions?(s.translate(l,h),s.scale(c[0],c[1]),R4(i,s)):c[0]<0||c[1]<0?(s.translate(l,h),s.scale(c[0],c[1]),s.drawImage(i,r,n,o,a,0,0,o,a)):s.drawImage(i,r,n,o,a,l,h,o*c[0],a*c[1]),s.restore()}function R4(s,t){const e=s.contextInstructions;for(let i=0,r=e.length;i<r;i+=2)Array.isArray(e[i+1])?t[e[i]].apply(t,e[i+1]):t[e[i]]=e[i+1]}let M4=class bL extends fL{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?dt.LOADING:dt.LOADED,this.imageState_===dt.LOADING&&this.ready().then(()=>this.imageState_=dt.LOADED),this.render()}clone(){const t=this.getScale(),e=new bL({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let e=this.canvases_[t];if(!e){const i=this.renderOptions_,r=ui(i.size*t,i.size*t);this.draw_(i,r,t),e=r.canvas,this.canvases_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let r=this.radius_,n=this.radius2_===void 0?r:this.radius2_;if(r<n){const b=r;r=n,n=b}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=n*Math.sin(a),h=Math.sqrt(n*n-l*l),c=r-h,u=Math.sqrt(l*l+c*c),d=u/l;if(t==="miter"&&d<=i)return d*e;const p=e/2/d,g=e/2*(c/u),f=Math.sqrt((r+p)*(r+p)+g*g)-r;if(this.radius2_===void 0||t==="bevel")return f*2;const m=r*Math.sin(a),_=Math.sqrt(r*r-m*m),y=n-_,v=Math.sqrt(m*m+y*y)/m;if(v<=i){const b=v*e/2-n-r;return 2*Math.max(f,b)}return f*2}createRenderOptions(){let t=Au,e=Lu,i=0,r=null,n=0,o,a=0;this.stroke_&&(o=io(this.stroke_.getColor()??Wp),a=this.stroke_.getWidth()??qp,r=this.stroke_.getLineDash(),n=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??Lu,t=this.stroke_.getLineCap()??Au,i=this.stroke_.getMiterLimit()??Hp);const l=this.calculateLineJoinSize_(e,a,i),h=Math.max(this.radius_,this.radius2_||0),c=Math.ceil(2*h+l);return{strokeStyle:o,strokeWidth:a,size:c,lineCap:t,lineDash:r,lineDashOffset:n,lineJoin:e,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let r=this.fill_.getColor();r===null&&(r=br),e.fillStyle=io(r),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let i=this.fill_.getColor(),r=0;typeof i=="string"&&(i=jn(i)),i===null?r=1:Array.isArray(i)&&(r=i.length===4?i[3]:1),r===0&&(e=ui(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const i=this.radius_;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const r=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(e*=2);const n=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let a=0;a<e;a++){const l=n+a*o,h=a%2===0?i:r;t.lineTo(h*Math.cos(l),h*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=br,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}};const wL=M4;let I4=class EL extends wL{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new EL({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}};const SL=I4;let CL=class TL{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=fC,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new TL({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=fC,this.geometry_=t}setZIndex(t){this.zIndex_=t}};function A4(s){let t;if(typeof s=="function")t=s;else{let e;Array.isArray(s)?e=s:(ge(typeof s.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[s]),t=function(){return e}}return t}let I1=null;function L4(s,t){if(!I1){const e=new da({color:"rgba(255,255,255,0.4)"}),i=new fo({color:"#3399CC",width:1.25});I1=[new CL({image:new SL({fill:e,stroke:i,radius:5}),fill:e,stroke:i})]}return I1}function fC(s){return s.getGeometry()}const lr=CL,P4="#333";let O4=class RL{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=xi(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new da({color:P4}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new RL({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=xi(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}};const Yp=O4,Sa=["http://www.google.com/kml/ext/2.2"],wt=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],F4="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",mC={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},k4=q(wt,{ExtendedData:BL,Region:UL,MultiGeometry:F(jL,"geometry"),LineString:F(DL,"geometry"),LinearRing:F($L,"geometry"),Point:F(GL,"geometry"),Polygon:F(zL,"geometry"),Style:F(Iw),StyleMap:yz,address:F(Q),description:F(Q),name:F(Q),open:F(Tl),phoneNumber:F(Q),styleUrl:F(PL),visibility:F(Tl)},q(Sa,{MultiTrack:F(nz,"geometry"),Track:F(NL,"geometry")})),N4=q(wt,{ExtendedData:BL,Region:UL,Link:Az,address:F(Q),description:F(Q),name:F(Q),open:F(Tl),phoneNumber:F(Q),visibility:F(Tl)}),D4=q(wt,{href:F(LL)}),$4=q(wt,{Altitude:F(pe),Longitude:F(pe),Latitude:F(pe),Tilt:F(pe),AltitudeMode:F(Q),Heading:F(pe),Roll:F(pe)}),ML=q(wt,{LatLonAltBox:Ez,Lod:Cz}),j4=q(wt,["Document","Placemark"]),G4=q(wt,{Document:D($z),Placemark:D(WL)});let ou,Om=null,wv,pp,gp,fp,l0,Ev=null,Rw,Sv=null,Cv,hh=null,_C=null,Tv=null;function h0(s){return 32/Math.min(s[0],s[1])}function z4(){ou=[255,255,255,1],Om=new da({color:ou}),wv=[20,2],pp="pixels",gp="pixels",fp=[64,64],l0="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",Ev=new ty({anchor:wv,anchorOrigin:"bottom-left",anchorXUnits:pp,anchorYUnits:gp,crossOrigin:"anonymous",rotation:0,scale:h0(fp),size:fp,src:l0}),Rw="NO_IMAGE",Sv=new fo({color:ou,width:1}),Cv=new fo({color:[51,51,51,1],width:2}),hh=new Yp({font:"bold 16px Helvetica",fill:Om,stroke:Cv,scale:.8}),_C=new lr({fill:Om,image:Ev,text:hh,stroke:Sv,zIndex:0}),Tv=[_C]}let Wf;function B4(s){return s}let U4=class extends Wg{constructor(t){super(),t=t||{},Tv||z4(),this.dataProjection=ct("EPSG:4326"),this.defaultStyle_=t.defaultStyle?t.defaultStyle:Tv,this.extractStyles_=t.extractStyles!==void 0?t.extractStyles:!0,this.writeStyles_=t.writeStyles!==void 0?t.writeStyles:!0,this.sharedStyles_={},this.showPointNames_=t.showPointNames!==void 0?t.showPointNames:!0,this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",this.iconUrlFunction_=t.iconUrlFunction?t.iconUrlFunction:B4,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(t,e){const i=q(wt,{Document:r0(this.readDocumentOrFolder_,this),Folder:r0(this.readDocumentOrFolder_,this),Placemark:vt(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),r=Z([],i,t,e,this);if(r)return r}readPlacemark_(t,e){const i=Z({geometry:null},k4,t,e,this);if(!i)return;const r=new Ls,n=t.getAttribute("id");n!==null&&r.setId(n);const o=e[0],a=i.geometry;if(a&&vi(a,!1,o),r.setGeometry(a),delete i.geometry,this.extractStyles_){const l=i.Style,h=i.styleUrl,c=H4(l,h,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);r.setStyle(c)}return delete i.Style,r.setProperties(i,!0),r}readSharedStyle_(t,e){const i=t.getAttribute("id");if(i!==null){const r=Iw.call(this,t,e);if(r){let n,o=t.baseURI;(!o||o=="about:blank")&&(o=window.location.href),o?n=new URL("#"+i,o).href:n="#"+i,this.sharedStyles_[n]=r}}}readSharedStyleMap_(t,e){const i=t.getAttribute("id");if(i===null)return;const r=FL.call(this,t,e);if(!r)return;let n,o=t.baseURI;(!o||o=="about:blank")&&(o=window.location.href),o?n=new URL("#"+i,o).href:n="#"+i,this.sharedStyles_[n]=r}readFeatureFromNode(t,e){return wt.includes(t.namespaceURI)&&this.readPlacemark_(t,[this.getReadOptions(t,e)])||null}readFeaturesFromNode(t,e){if(!wt.includes(t.namespaceURI))return[];let i;const r=t.localName;if(r=="Document"||r=="Folder")return i=this.readDocumentOrFolder_(t,[this.getReadOptions(t,e)]),i||[];if(r=="Placemark"){const n=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return n?[n]:[]}if(r=="kml"){i=[];for(let n=t.firstElementChild;n;n=n.nextElementSibling){const o=this.readFeaturesFromNode(n,e);o&&Se(i,o)}return i}return[]}readName(t){if(t){if(typeof t=="string"){const e=nn(t);return this.readNameFromDocument(e)}return rn(t)?this.readNameFromDocument(t):this.readNameFromNode(t)}}readNameFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE){const i=this.readNameFromNode(e);if(i)return i}}readNameFromNode(t){for(let e=t.firstElementChild;e;e=e.nextElementSibling)if(wt.includes(e.namespaceURI)&&e.localName=="name")return Q(e);for(let e=t.firstElementChild;e;e=e.nextElementSibling){const i=e.localName;if(wt.includes(e.namespaceURI)&&(i=="Document"||i=="Folder"||i=="Placemark"||i=="kml")){const r=this.readNameFromNode(e);if(r)return r}}}readNetworkLinks(t){const e=[];if(typeof t=="string"){const i=nn(t);Se(e,this.readNetworkLinksFromDocument(i))}else rn(t)?Se(e,this.readNetworkLinksFromDocument(t)):Se(e,this.readNetworkLinksFromNode(t));return e}readNetworkLinksFromDocument(t){const e=[];for(let i=t.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&Se(e,this.readNetworkLinksFromNode(i));return e}readNetworkLinksFromNode(t){const e=[];for(let i=t.firstElementChild;i;i=i.nextElementSibling)if(wt.includes(i.namespaceURI)&&i.localName=="NetworkLink"){const r=Z({},N4,i,[]);e.push(r)}for(let i=t.firstElementChild;i;i=i.nextElementSibling){const r=i.localName;wt.includes(i.namespaceURI)&&(r=="Document"||r=="Folder"||r=="kml")&&Se(e,this.readNetworkLinksFromNode(i))}return e}readRegion(t){const e=[];if(typeof t=="string"){const i=nn(t);Se(e,this.readRegionFromDocument(i))}else rn(t)?Se(e,this.readRegionFromDocument(t)):Se(e,this.readRegionFromNode(t));return e}readRegionFromDocument(t){const e=[];for(let i=t.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&Se(e,this.readRegionFromNode(i));return e}readRegionFromNode(t){const e=[];for(let i=t.firstElementChild;i;i=i.nextElementSibling)if(wt.includes(i.namespaceURI)&&i.localName=="Region"){const r=Z({},ML,i,[]);e.push(r)}for(let i=t.firstElementChild;i;i=i.nextElementSibling){const r=i.localName;wt.includes(i.namespaceURI)&&(r=="Document"||r=="Folder"||r=="kml")&&Se(e,this.readRegionFromNode(i))}return e}readCamera(t){const e=[];if(typeof t=="string"){const i=nn(t);Se(e,this.readCameraFromDocument(i))}else rn(t)?Se(e,this.readCameraFromDocument(t)):Se(e,this.readCameraFromNode(t));return e}readCameraFromDocument(t){const e=[];for(let i=t.firstChild;i;i=i.nextSibling)i.nodeType===Node.ELEMENT_NODE&&Se(e,this.readCameraFromNode(i));return e}readCameraFromNode(t){const e=[];for(let i=t.firstElementChild;i;i=i.nextElementSibling)if(wt.includes(i.namespaceURI)&&i.localName==="Camera"){const r=Z({},$4,i,[]);e.push(r)}for(let i=t.firstElementChild;i;i=i.nextElementSibling){const r=i.localName;wt.includes(i.namespaceURI)&&(r==="Document"||r==="Folder"||r==="Placemark"||r==="kml")&&Se(e,this.readCameraFromNode(i))}return e}writeFeaturesNode(t,e){e=this.adaptOptions(e);const i=Ht(wt[4],"kml"),r="http://www.w3.org/2000/xmlns/";i.setAttributeNS(r,"xmlns:gx",Sa[0]),i.setAttributeNS(r,"xmlns:xsi",Ch),i.setAttributeNS(Ch,"xsi:schemaLocation",F4);const n={node:i},o={};t.length>1?o.Document=t:t.length==1&&(o.Placemark=t[0]);const a=j4[i.namespaceURI],l=Mr(o,a);return zt(n,G4,bs,l,[e],a,this),i}};function V4(s,t){const e=[0,0];let i="start";const r=s.getImage();if(r){const o=r.getSize();if(o&&o.length==2){const a=r.getScaleArray(),l=r.getAnchor();e[0]=a[0]*(o[0]-l[0]),e[1]=a[1]*(o[1]/2-l[1]),i="left"}}let n=s.getText();return n?(n=n.clone(),n.setFont(n.getFont()||hh.getFont()),n.setScale(n.getScale()||hh.getScale()),n.setFill(n.getFill()||hh.getFill()),n.setStroke(n.getStroke()||Cv)):n=hh.clone(),n.setText(t),n.setOffsetX(e[0]),n.setOffsetY(e[1]),n.setTextAlign(i),new lr({image:r,text:n})}function H4(s,t,e,i,r){return function(n,o){let a=r,l="",h=[];if(a){const u=n.getGeometry();if(u)if(u instanceof Xs)h=u.getGeometriesArrayRecursive().filter(function(d){const p=d.getType();return p==="Point"||p==="MultiPoint"}),a=h.length>0;else{const d=u.getType();a=d==="Point"||d==="MultiPoint"}}a&&(l=n.get("name"),a=a&&!!l,a&&/&[^&]+;/.test(l)&&(Wf||(Wf=document.createElement("textarea")),Wf.innerHTML=l,l=Wf.value));let c=e;if(s?c=s:t&&(c=IL(t,e,i)),a){const u=V4(c[0],l);if(h.length>0){u.setGeometry(new Xs(h));const d=new lr({geometry:c[0].getGeometry(),image:null,fill:c[0].getFill(),stroke:c[0].getStroke(),text:null});return[u,d].concat(c.slice(1))}return u}return c}}function IL(s,t,e){return Array.isArray(s)?s:typeof s=="string"?IL(e[s],t,e):t}function ey(s){const t=hr(s,!1),e=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(t);if(e){const i=e[1];return[parseInt(i.substr(6,2),16),parseInt(i.substr(4,2),16),parseInt(i.substr(2,2),16),parseInt(i.substr(0,2),16)/255]}}function AL(s){let t=hr(s,!1);const e=[];t=t.replace(/\s*,\s*/g,",");const i=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;let r;for(;r=i.exec(t);){const n=parseFloat(r[1]),o=parseFloat(r[2]),a=r[3]?parseFloat(r[3]):0;e.push(n,o,a),t=t.substr(r[0].length)}if(t==="")return e}function LL(s){const t=hr(s,!1).trim();let e=s.baseURI;return(!e||e=="about:blank")&&(e=window.location.href),e?new URL(t,e).href:t}function PL(s){const t=hr(s,!1).trim().replace(/^(?!.*#)/,"#");let e=s.baseURI;return(!e||e=="about:blank")&&(e=window.location.href),e?new URL(t,e).href:t}function W4(s){const t=s.getAttribute("xunits"),e=s.getAttribute("yunits");let i;return t!=="insetPixels"?e!=="insetPixels"?i="bottom-left":i="top-left":e!=="insetPixels"?i="bottom-right":i="top-right",{x:parseFloat(s.getAttribute("x")),xunits:mC[t],y:parseFloat(s.getAttribute("y")),yunits:mC[e],origin:i}}function OL(s){return pe(s)}const X4=q(wt,{Pair:_z});function FL(s,t){return Z(void 0,X4,s,t,this)}const q4=q(wt,{Icon:F(lz),color:F(ey),heading:F(pe),hotSpot:F(W4),scale:F(OL)});function Y4(s,t){const e=Z({},q4,s,t);if(!e)return;const i=t[t.length-1],r="Icon"in e?e.Icon:{},n=!("Icon"in e)||Object.keys(r).length>0;let o;const a=r.href;a?o=a:n&&(o=l0);let l,h,c,u="bottom-left";const d=e.hotSpot;d?(l=[d.x,d.y],h=d.xunits,c=d.yunits,u=d.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(o)&&(o.includes("pushpin")?(l=wv,h=pp,c=gp):o.includes("arrow-reverse")?(l=[54,42],h=pp,c=gp):o.includes("paddle")&&(l=[32,1],h=pp,c=gp));let p;const g=r.x,f=r.y;g!==void 0&&f!==void 0&&(p=[g,f]);let m;const _=r.w,y=r.h;_!==void 0&&y!==void 0&&(m=[_,y]);let v;const b=e.heading;b!==void 0&&(v=dp(b));const E=e.scale,S=e.color;if(n){o==l0&&(m=fp);const T=new ty({anchor:l,anchorOrigin:u,anchorXUnits:h,anchorYUnits:c,crossOrigin:this.crossOrigin_,offset:p,offsetOrigin:"bottom-left",rotation:v,scale:E,size:m,src:this.iconUrlFunction_(o),color:S}),R=T.getScaleArray()[0],M=T.getSize();if(M===null){const A=T.getImageState();if(A===dt.IDLE||A===dt.LOADING){const O=function(){const N=T.getImageState();if(!(N===dt.IDLE||N===dt.LOADING)){const x=T.getSize();if(x&&x.length==2){const w=h0(x);T.setScale(R*w)}T.unlistenImageChange(O)}};T.listenImageChange(O),A===dt.IDLE&&T.load()}}else if(M.length==2){const A=h0(M);T.setScale(R*A)}i.imageStyle=T}else i.imageStyle=Rw}const Z4=q(wt,{color:F(ey),scale:F(OL)});function K4(s,t){const e=Z({},Z4,s,t);if(!e)return;const i=t[t.length-1],r=new Yp({fill:new da({color:"color"in e?e.color:ou}),scale:e.scale});i.textStyle=r}const J4=q(wt,{color:F(ey),width:F(pe)});function Q4(s,t){const e=Z({},J4,s,t);if(!e)return;const i=t[t.length-1],r=new fo({color:"color"in e?e.color:ou,width:"width"in e?e.width:1});i.strokeStyle=r}const tz=q(wt,{color:F(ey),fill:F(Tl),outline:F(Tl)});function ez(s,t){const e=Z({},tz,s,t);if(!e)return;const i=t[t.length-1],r=new da({color:"color"in e?e.color:ou});i.fillStyle=r;const n=e.fill;n!==void 0&&(i.fill=n);const o=e.outline;o!==void 0&&(i.outline=o)}const iz=q(wt,{coordinates:At(AL)});function kL(s,t){return Z(null,iz,s,t)}function sz(s,t){const e=t[t.length-1].coordinates,i=hr(s,!1),r=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(i);if(r){const n=parseFloat(r[1]),o=parseFloat(r[2]),a=parseFloat(r[3]);e.push([n,o,a])}else e.push([])}const rz=q(Sa,{Track:vt(NL)});function nz(s,t){const e=Z([],rz,s,t);if(e)return new Bn(e)}const oz=q(wt,{when:Lz},q(Sa,{coord:sz}));function NL(s,t){const e=Z({coordinates:[],whens:[]},oz,s,t);if(!e)return;const i=[],r=e.coordinates,n=e.whens;for(let o=0,a=Math.min(r.length,n.length);o<a;++o)r[o].length==3&&i.push(r[o][0],r[o][1],r[o][2],n[o]);return new Ps(i,"XYZM")}const az=q(wt,{href:F(LL)},q(Sa,{x:F(pe),y:F(pe),w:F(pe),h:F(pe)}));function lz(s,t){return Z({},az,s,t)||null}const hz=q(wt,{coordinates:At(AL)});function Mw(s,t){return Z(null,hz,s,t)}const iy=q(wt,{extrude:F(Tl),tessellate:F(Tl),altitudeMode:F(Q)});function DL(s,t){const e=Z({},iy,s,t),i=Mw(s,t);if(i){const r=new Ps(i,"XYZ");return r.setProperties(e,!0),r}}function $L(s,t){const e=Z({},iy,s,t),i=Mw(s,t);if(i){const r=new gn(i,"XYZ",[i.length]);return r.setProperties(e,!0),r}}const cz=q(wt,{LineString:vt(DL),LinearRing:vt($L),MultiGeometry:vt(jL),Point:vt(GL),Polygon:vt(zL)});function jL(s,t){const e=Z([],cz,s,t);if(!e)return null;if(e.length===0)return new Xs(e);let i,r=!0;const n=e[0].getType();let o;for(let a=1,l=e.length;a<l;++a)if(o=e[a],o.getType()!=n){r=!1;break}if(r){let a,l;if(n=="Point"){const h=e[0];a=h.getLayout(),l=h.getFlatCoordinates();for(let c=1,u=e.length;c<u;++c)o=e[c],Se(l,o.getFlatCoordinates());i=new wa(l,a),A1(i,e)}else if(n=="LineString")i=new Bn(e),A1(i,e);else if(n=="Polygon")i=new Ea(e),A1(i,e);else if(n=="GeometryCollection")i=new Xs(e);else throw new Error("Unknown geometry type found")}else i=new Xs(e);return i}function GL(s,t){const e=Z({},iy,s,t),i=Mw(s,t);if(i){const r=new xs(i,"XYZ");return r.setProperties(e,!0),r}}const uz=q(wt,{innerBoundaryIs:Rz,outerBoundaryIs:Iz});function zL(s,t){const e=Z({},iy,s,t),i=Z([null],uz,s,t);if(i&&i[0]){const r=i[0],n=[r.length];for(let a=1,l=i.length;a<l;++a)Se(r,i[a]),n.push(r.length);const o=new gn(r,"XYZ",n);return o.setProperties(e,!0),o}}const dz=q(wt,{IconStyle:Y4,LabelStyle:K4,LineStyle:Q4,PolyStyle:ez});function Iw(s,t){const e=Z({},dz,s,t,this);if(!e)return null;let i="fillStyle"in e?e.fillStyle:Om;const r=e.fill;r!==void 0&&!r&&(i=null);let n;"imageStyle"in e?e.imageStyle!=Rw&&(n=e.imageStyle):n=Ev;const o="textStyle"in e?e.textStyle:hh,a="strokeStyle"in e?e.strokeStyle:Sv,l=e.outline;return l!==void 0&&!l?[new lr({geometry:function(h){const c=h.getGeometry(),u=c.getType();if(u==="GeometryCollection"){const d=c;return new Xs(d.getGeometriesArrayRecursive().filter(function(p){const g=p.getType();return g!=="Polygon"&&g!=="MultiPolygon"}))}if(u!=="Polygon"&&u!=="MultiPolygon")return c},fill:i,image:n,stroke:a,text:o,zIndex:void 0}),new lr({geometry:function(h){const c=h.getGeometry(),u=c.getType();if(u==="GeometryCollection"){const d=c;return new Xs(d.getGeometriesArrayRecursive().filter(function(p){const g=p.getType();return g==="Polygon"||g==="MultiPolygon"}))}if(u==="Polygon"||u==="MultiPolygon")return c},fill:i,stroke:null,zIndex:void 0})]:[new lr({fill:i,image:n,stroke:a,text:o,zIndex:void 0})]}function A1(s,t){const e=t.length,i=new Array(t.length),r=new Array(t.length),n=new Array(t.length);let o,a,l;o=!1,a=!1,l=!1;for(let h=0;h<e;++h){const c=t[h];i[h]=c.get("extrude"),r[h]=c.get("tessellate"),n[h]=c.get("altitudeMode"),o=o||i[h]!==void 0,a=a||r[h]!==void 0,l=l||n[h]}o&&s.set("extrude",i),a&&s.set("tessellate",r),l&&s.set("altitudeMode",n)}const pz=q(wt,{displayName:F(Q),value:F(Q)});function gz(s,t){const e=s.getAttribute("name");Rr(pz,s,t);const i=t[t.length-1];e&&i.displayName?i[e]={value:i.value,displayName:i.displayName,toString:function(){return i.value}}:e!==null?i[e]=i.value:i.displayName!==null&&(i[i.displayName]=i.value),delete i.value}const fz=q(wt,{Data:gz,SchemaData:vz});function BL(s,t){Rr(fz,s,t)}function UL(s,t){Rr(ML,s,t)}const mz=q(wt,{Style:F(Iw),key:F(Q),styleUrl:F(PL)});function _z(s,t){const e=Z({},mz,s,t,this);if(!e)return;const i=e.key;if(i&&i=="normal"){const r=e.styleUrl;r&&(t[t.length-1]=r);const n=e.Style;n&&(t[t.length-1]=n)}}function yz(s,t){const e=FL.call(this,s,t);if(!e)return;const i=t[t.length-1];if(Array.isArray(e))i.Style=e;else if(typeof e=="string")i.styleUrl=e;else throw new Error("`styleMapValue` has an unknown type")}const xz=q(wt,{SimpleData:bz});function vz(s,t){Rr(xz,s,t)}function bz(s,t){const e=s.getAttribute("name");if(e!==null){const i=Q(s),r=t[t.length-1];r[e]=i}}const wz=q(wt,{altitudeMode:F(Q),minAltitude:F(pe),maxAltitude:F(pe),north:F(pe),south:F(pe),east:F(pe),west:F(pe)});function Ez(s,t){const e=Z({},wz,s,t);if(!e)return;const i=t[t.length-1],r=[parseFloat(e.west),parseFloat(e.south),parseFloat(e.east),parseFloat(e.north)];i.extent=r,i.altitudeMode=e.altitudeMode,i.minAltitude=parseFloat(e.minAltitude),i.maxAltitude=parseFloat(e.maxAltitude)}const Sz=q(wt,{minLodPixels:F(pe),maxLodPixels:F(pe),minFadeExtent:F(pe),maxFadeExtent:F(pe)});function Cz(s,t){const e=Z({},Sz,s,t);if(!e)return;const i=t[t.length-1];i.minLodPixels=parseFloat(e.minLodPixels),i.maxLodPixels=parseFloat(e.maxLodPixels),i.minFadeExtent=parseFloat(e.minFadeExtent),i.maxFadeExtent=parseFloat(e.maxFadeExtent)}const Tz=q(wt,{LinearRing:vt(kL)});function Rz(s,t){const e=Z([],Tz,s,t);e.length>0&&t[t.length-1].push(...e)}const Mz=q(wt,{LinearRing:At(kL)});function Iz(s,t){const e=Z(void 0,Mz,s,t);if(e){const i=t[t.length-1];i[0]=e}}function Az(s,t){Rr(D4,s,t)}function Lz(s,t){const e=t[t.length-1].whens,i=hr(s,!1),r=Date.parse(i);e.push(isNaN(r)?0:r)}function sy(s,t){const e=jn(t),i=[(e.length==4?e[3]:1)*255,e[2],e[1],e[0]];for(let r=0;r<4;++r){const n=Math.floor(i[r]).toString(16);i[r]=n.length==1?"0"+n:n}Dt(s,i.join(""))}function Pz(s,t,e){const i=e[e.length-1],r=i.layout,n=i.stride;let o;if(r=="XY"||r=="XYM")o=2;else if(r=="XYZ"||r=="XYZM")o=3;else throw new Error("Invalid geometry layout");const a=t.length;let l="";if(a>0){l+=t[0];for(let h=1;h<o;++h)l+=","+t[h];for(let h=n;h<a;h+=n){l+=" "+t[h];for(let c=1;c<o;++c)l+=","+t[h+c]}}Dt(s,l)}const Fm=q(wt,{Data:D(Oz),value:D(kz),displayName:D(Fz)});function Oz(s,t,e){s.setAttribute("name",t.name);const i={node:s},r=t.value;typeof r=="object"?(r!==null&&r.displayName&&zt(i,Fm,bs,[r.displayName],e,["displayName"]),r!==null&&r.value&&zt(i,Fm,bs,[r.value],e,["value"])):zt(i,Fm,bs,[r],e,["value"])}function Fz(s,t){qj(s,t)}function kz(s,t){Dt(s,t)}const Nz=q(wt,{Placemark:D(WL)}),Dz=function(s,t,e){const i=t[t.length-1].node;return Ht(i.namespaceURI,"Placemark")};function $z(s,t,e){zt({node:s},Nz,Dz,t,e,void 0,this)}const jz=Fi("Data");function Gz(s,t,e){const i={node:s},r=t.names,n=t.values,o=r.length;for(let a=0;a<o;a++)zt(i,Fm,jz,[{name:r[a],value:n[a]}],e)}const yC=q(wt,["href"],q(Sa,["x","y","w","h"])),xC=q(wt,{href:D(Dt)},q(Sa,{x:D(vr),y:D(vr),w:D(vr),h:D(vr)})),zz=function(s,t,e){return Ht(Sa[0],"gx:"+e)};function Bz(s,t,e){const i={node:s},r=e[e.length-1].node;let n=yC[r.namespaceURI],o=Mr(t,n);zt(i,xC,bs,o,e,n),n=yC[Sa[0]],o=Mr(t,n),zt(i,xC,zz,o,e,n)}const Uz=q(wt,["scale","heading","Icon","color","hotSpot"]),Vz=q(wt,{Icon:D(Bz),color:D(sy),heading:D(vr),hotSpot:D(_B),scale:D(qL)});function Hz(s,t,e){const i={node:s},r={},n=t.getSrc(),o=t.getSize(),a=t.getImageSize(),l={href:n};if(o){l.w=o[0],l.h=o[1];const m=t.getAnchor(),_=t.getOrigin();if(_&&a&&_[0]!==0&&_[1]!==o[1]&&(l.x=_[0],l.y=a[1]-(_[1]+o[1])),m&&(m[0]!==o[0]/2||m[1]!==o[1]/2)){const y={x:m[0],xunits:"pixels",y:o[1]-m[1],yunits:"pixels"};r.hotSpot=y}}r.Icon=l;let h=t.getScaleArray()[0],c=o;if(c===null&&(c=fp),c.length==2){const m=h0(c);h=h/m}h!==1&&(r.scale=h);const u=t.getRotation();u!==0&&(r.heading=u);const d=t.getColor();d&&(r.color=d);const p=e[e.length-1].node,g=Uz[p.namespaceURI],f=Mr(r,g);zt(i,Vz,bs,f,e,g)}const Wz=q(wt,["color","scale"]),Xz=q(wt,{color:D(sy),scale:D(qL)});function qz(s,t,e){const i={node:s},r={},n=t.getFill();n&&(r.color=n.getColor());const o=t.getScale();o&&o!==1&&(r.scale=o);const a=e[e.length-1].node,l=Wz[a.namespaceURI],h=Mr(r,l);zt(i,Xz,bs,h,e,l)}const Yz=q(wt,["color","width"]),Zz=q(wt,{color:D(sy),width:D(vr)});function Kz(s,t,e){const i={node:s},r={color:t.getColor(),width:Number(t.getWidth())||1},n=e[e.length-1].node,o=Yz[n.namespaceURI],a=Mr(r,o);zt(i,Zz,bs,a,e,o)}const Jz={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},VL=function(s,t,e){if(s){const i=t[t.length-1].node;return Ht(i.namespaceURI,Jz[s.getType()])}},Qz=Fi("Point"),tB=Fi("LineString"),eB=Fi("LinearRing"),iB=Fi("Polygon"),sB=q(wt,{LineString:D(au),Point:D(au),Polygon:D(XL),GeometryCollection:D(HL)});function HL(s,t,e){const i={node:s},r=t.getType();let n=[],o;if(r==="GeometryCollection")t.getGeometriesArrayRecursive().forEach(function(a){const l=a.getType();if(l==="MultiPoint")n=n.concat(a.getPoints());else if(l==="MultiLineString")n=n.concat(a.getLineStrings());else if(l==="MultiPolygon")n=n.concat(a.getPolygons());else if(l==="Point"||l==="LineString"||l==="Polygon")n.push(a);else throw new Error("Unknown geometry type")}),o=VL;else if(r==="MultiPoint")n=t.getPoints(),o=Qz;else if(r==="MultiLineString")n=t.getLineStrings(),o=tB;else if(r==="MultiPolygon")n=t.getPolygons(),o=iB;else throw new Error("Unknown geometry type");zt(i,sB,o,n,e)}const rB=q(wt,{LinearRing:D(au)});function vC(s,t,e){zt({node:s},rB,eB,[t],e)}const L1=q(wt,{ExtendedData:D(Gz),MultiGeometry:D(HL),LineString:D(au),LinearRing:D(au),Point:D(au),Polygon:D(XL),Style:D(mB),address:D(Dt),description:D(Dt),name:D(Dt),open:D(Iu),phoneNumber:D(Dt),styleUrl:D(Dt),visibility:D(Iu)}),nB=q(wt,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),oB=Fi("ExtendedData");function WL(s,t,e){const i={node:s};t.getId()&&s.setAttribute("id",t.getId());const r=t.getProperties(),n={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};n[t.getGeometryName()]=1;const o=Object.keys(r||{}).sort().filter(function(p){return!n[p]}),a=t.getStyleFunction();if(a){const p=a(t,0);if(p){const g=Array.isArray(p)?p:[p];let f=g;if(t.getGeometry()&&(f=g.filter(function(m){const _=m.getGeometryFunction()(t);if(_){const y=_.getType();return y==="GeometryCollection"?_.getGeometriesArrayRecursive().filter(function(v){const b=v.getType();return b==="Point"||b==="MultiPoint"}).length:y==="Point"||y==="MultiPoint"}})),this.writeStyles_){let m=g,_=g;t.getGeometry()&&(m=g.filter(function(y){const v=y.getGeometryFunction()(t);if(v){const b=v.getType();return b==="GeometryCollection"?v.getGeometriesArrayRecursive().filter(function(E){const S=E.getType();return S==="LineString"||S==="MultiLineString"}).length:b==="LineString"||b==="MultiLineString"}}),_=g.filter(function(y){const v=y.getGeometryFunction()(t);if(v){const b=v.getType();return b==="GeometryCollection"?v.getGeometriesArrayRecursive().filter(function(E){const S=E.getType();return S==="Polygon"||S==="MultiPolygon"}).length:b==="Polygon"||b==="MultiPolygon"}})),r.Style={pointStyles:f,lineStyles:m,polyStyles:_}}if(f.length&&r.name===void 0){const m=f[0].getText();m&&(r.name=m.getText())}}}const l=e[e.length-1].node,h=nB[l.namespaceURI],c=Mr(r,h);if(zt(i,L1,bs,c,e,h),o.length>0){const p=Mr(r,o);zt(i,L1,oB,[{names:o,values:p}],e)}const u=e[0];let d=t.getGeometry();d&&(d=vi(d,!0,u)),zt(i,L1,VL,[d],e)}const aB=q(wt,["extrude","tessellate","altitudeMode","coordinates"]),lB=q(wt,{extrude:D(Iu),tessellate:D(Iu),altitudeMode:D(Dt),coordinates:D(Pz)});function au(s,t,e){const i=t.getFlatCoordinates(),r={node:s};r.layout=t.getLayout(),r.stride=t.getStride();const n=t.getProperties();n.coordinates=i;const o=e[e.length-1].node,a=aB[o.namespaceURI],l=Mr(n,a);zt(r,lB,bs,l,e,a)}const hB=q(wt,["color","fill","outline"]),bC=q(wt,{outerBoundaryIs:D(vC),innerBoundaryIs:D(vC)}),cB=Fi("innerBoundaryIs"),uB=Fi("outerBoundaryIs");function XL(s,t,e){const i=t.getLinearRings(),r=i.shift(),n={node:s};zt(n,bC,cB,i,e),zt(n,bC,uB,[r],e)}const dB=q(wt,{color:D(sy),fill:D(Iu),outline:D(Iu)});function pB(s,t,e){const i={node:s},r=t.getFill(),n=t.getStroke(),o={color:r?r.getColor():void 0,fill:r?void 0:!1,outline:n?void 0:!1},a=e[e.length-1].node,l=hB[a.namespaceURI],h=Mr(o,l);zt(i,dB,bs,h,e,l)}function qL(s,t){vr(s,Math.round(t*1e6)/1e6)}const gB=q(wt,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),fB=q(wt,{IconStyle:D(Hz),LabelStyle:D(qz),LineStyle:D(Kz),PolyStyle:D(pB)});function mB(s,t,e){const i={node:s},r={};if(t.pointStyles.length){const l=t.pointStyles[0].getText();l&&(r.LabelStyle=l);const h=t.pointStyles[0].getImage();h&&typeof h.getSrc=="function"&&(r.IconStyle=h)}if(t.lineStyles.length){const l=t.lineStyles[0].getStroke();l&&(r.LineStyle=l)}if(t.polyStyles.length){const l=t.polyStyles[0].getStroke();l&&!r.LineStyle&&(r.LineStyle=l),r.PolyStyle=t.polyStyles[0]}const n=e[e.length-1].node,o=gB[n.namespaceURI],a=Mr(r,o);zt(i,fB,bs,a,e,o)}function _B(s,t){s.setAttribute("x",String(t.x)),s.setAttribute("y",String(t.y)),s.setAttribute("xunits",t.xunits),s.setAttribute("yunits",t.yunits)}const yB=U4;var Aw={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Aw.read=function(s,t,e,i,r){var n,o,a=r*8-i-1,l=(1<<a)-1,h=l>>1,c=-7,u=e?r-1:0,d=e?-1:1,p=s[t+u];for(u+=d,n=p&(1<<-c)-1,p>>=-c,c+=a;c>0;n=n*256+s[t+u],u+=d,c-=8);for(o=n&(1<<-c)-1,n>>=-c,c+=i;c>0;o=o*256+s[t+u],u+=d,c-=8);if(n===0)n=1-h;else{if(n===l)return o?NaN:(p?-1:1)*(1/0);o=o+Math.pow(2,i),n=n-h}return(p?-1:1)*o*Math.pow(2,n-i)};Aw.write=function(s,t,e,i,r,n){var o,a,l,h=n*8-r-1,c=(1<<h)-1,u=c>>1,d=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:n-1,g=i?1:-1,f=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+u>=1?t+=d/l:t+=d*Math.pow(2,1-u),t*l>=2&&(o++,l/=2),o+u>=c?(a=0,o=c):o+u>=1?(a=(t*l-1)*Math.pow(2,r),o=o+u):(a=t*Math.pow(2,u-1)*Math.pow(2,r),o=0));r>=8;s[e+p]=a&255,p+=g,a/=256,r-=8);for(o=o<<r|a,h+=r;h>0;s[e+p]=o&255,p+=g,o/=256,h-=8);s[e+p-g]|=f*128};var xB=$e,Xf=Aw;function $e(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}$e.Varint=0;$e.Fixed64=1;$e.Bytes=2;$e.Fixed32=5;var Rv=65536*65536,wC=1/Rv,vB=12,YL=typeof TextDecoder>"u"?null:new TextDecoder("utf8");$e.prototype={destroy:function(){this.buf=null},readFields:function(s,t,e){for(e=e||this.length;this.pos<e;){var i=this.readVarint(),r=i>>3,n=this.pos;this.type=i&7,s(r,t,this),this.pos===n&&this.skip(i)}return t},readMessage:function(s,t){return this.readFields(s,t,this.readVarint()+this.pos)},readFixed32:function(){var s=qf(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=SC(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=qf(this.buf,this.pos)+qf(this.buf,this.pos+4)*Rv;return this.pos+=8,s},readSFixed64:function(){var s=qf(this.buf,this.pos)+SC(this.buf,this.pos+4)*Rv;return this.pos+=8,s},readFloat:function(){var s=Xf.read(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=Xf.read(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var t=this.buf,e,i;return i=t[this.pos++],e=i&127,i<128||(i=t[this.pos++],e|=(i&127)<<7,i<128)||(i=t[this.pos++],e|=(i&127)<<14,i<128)||(i=t[this.pos++],e|=(i&127)<<21,i<128)?e:(i=t[this.pos],e|=(i&15)<<28,bB(e,s,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2===1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,t=this.pos;return this.pos=s,s-t>=vB&&YL?NB(this.buf,t,s):kB(this.buf,t,s)},readBytes:function(){var s=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,s);return this.pos=s,t},readPackedVarint:function(s,t){if(this.type!==$e.Bytes)return s.push(this.readVarint(t));var e=Oo(this);for(s=s||[];this.pos<e;)s.push(this.readVarint(t));return s},readPackedSVarint:function(s){if(this.type!==$e.Bytes)return s.push(this.readSVarint());var t=Oo(this);for(s=s||[];this.pos<t;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==$e.Bytes)return s.push(this.readBoolean());var t=Oo(this);for(s=s||[];this.pos<t;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==$e.Bytes)return s.push(this.readFloat());var t=Oo(this);for(s=s||[];this.pos<t;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==$e.Bytes)return s.push(this.readDouble());var t=Oo(this);for(s=s||[];this.pos<t;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==$e.Bytes)return s.push(this.readFixed32());var t=Oo(this);for(s=s||[];this.pos<t;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==$e.Bytes)return s.push(this.readSFixed32());var t=Oo(this);for(s=s||[];this.pos<t;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==$e.Bytes)return s.push(this.readFixed64());var t=Oo(this);for(s=s||[];this.pos<t;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==$e.Bytes)return s.push(this.readSFixed64());var t=Oo(this);for(s=s||[];this.pos<t;)s.push(this.readSFixed64());return s},skip:function(s){var t=s&7;if(t===$e.Varint)for(;this.buf[this.pos++]>127;);else if(t===$e.Bytes)this.pos=this.readVarint()+this.pos;else if(t===$e.Fixed32)this.pos+=4;else if(t===$e.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+t)},writeTag:function(s,t){this.writeVarint(s<<3|t)},realloc:function(s){for(var t=this.length||16;t<this.pos+s;)t*=2;if(t!==this.length){var e=new Uint8Array(t);e.set(this.buf),this.buf=e,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),ic(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),ic(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),ic(this.buf,s&-1,this.pos),ic(this.buf,Math.floor(s*wC),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),ic(this.buf,s&-1,this.pos),ic(this.buf,Math.floor(s*wC),this.pos+4),this.pos+=8},writeVarint:function(s){if(s=+s||0,s>268435455||s<0){EB(s,this);return}this.realloc(4),this.buf[this.pos++]=s&127|(s>127?128:0),!(s<=127)&&(this.buf[this.pos++]=(s>>>=7)&127|(s>127?128:0),!(s<=127)&&(this.buf[this.pos++]=(s>>>=7)&127|(s>127?128:0),!(s<=127)&&(this.buf[this.pos++]=s>>>7&127)))},writeSVarint:function(s){this.writeVarint(s<0?-s*2-1:s*2)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(s.length*4),this.pos++;var t=this.pos;this.pos=DB(this.buf,s,this.pos);var e=this.pos-t;e>=128&&EC(t,e,this),this.pos=t-1,this.writeVarint(e),this.pos+=e},writeFloat:function(s){this.realloc(4),Xf.write(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Xf.write(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var t=s.length;this.writeVarint(t),this.realloc(t);for(var e=0;e<t;e++)this.buf[this.pos++]=s[e]},writeRawMessage:function(s,t){this.pos++;var e=this.pos;s(t,this);var i=this.pos-e;i>=128&&EC(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeMessage:function(s,t,e){this.writeTag(s,$e.Bytes),this.writeRawMessage(t,e)},writePackedVarint:function(s,t){t.length&&this.writeMessage(s,TB,t)},writePackedSVarint:function(s,t){t.length&&this.writeMessage(s,RB,t)},writePackedBoolean:function(s,t){t.length&&this.writeMessage(s,AB,t)},writePackedFloat:function(s,t){t.length&&this.writeMessage(s,MB,t)},writePackedDouble:function(s,t){t.length&&this.writeMessage(s,IB,t)},writePackedFixed32:function(s,t){t.length&&this.writeMessage(s,LB,t)},writePackedSFixed32:function(s,t){t.length&&this.writeMessage(s,PB,t)},writePackedFixed64:function(s,t){t.length&&this.writeMessage(s,OB,t)},writePackedSFixed64:function(s,t){t.length&&this.writeMessage(s,FB,t)},writeBytesField:function(s,t){this.writeTag(s,$e.Bytes),this.writeBytes(t)},writeFixed32Field:function(s,t){this.writeTag(s,$e.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(s,t){this.writeTag(s,$e.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(s,t){this.writeTag(s,$e.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(s,t){this.writeTag(s,$e.Fixed64),this.writeSFixed64(t)},writeVarintField:function(s,t){this.writeTag(s,$e.Varint),this.writeVarint(t)},writeSVarintField:function(s,t){this.writeTag(s,$e.Varint),this.writeSVarint(t)},writeStringField:function(s,t){this.writeTag(s,$e.Bytes),this.writeString(t)},writeFloatField:function(s,t){this.writeTag(s,$e.Fixed32),this.writeFloat(t)},writeDoubleField:function(s,t){this.writeTag(s,$e.Fixed64),this.writeDouble(t)},writeBooleanField:function(s,t){this.writeVarintField(s,!!t)}};function bB(s,t,e){var i=e.buf,r,n;if(n=i[e.pos++],r=(n&112)>>4,n<128||(n=i[e.pos++],r|=(n&127)<<3,n<128)||(n=i[e.pos++],r|=(n&127)<<10,n<128)||(n=i[e.pos++],r|=(n&127)<<17,n<128)||(n=i[e.pos++],r|=(n&127)<<24,n<128)||(n=i[e.pos++],r|=(n&1)<<31,n<128))return wB(s,r,t);throw new Error("Expected varint not more than 10 bytes")}function Oo(s){return s.type===$e.Bytes?s.readVarint()+s.pos:s.pos+1}function wB(s,t,e){return e?t*4294967296+(s>>>0):(t>>>0)*4294967296+(s>>>0)}function EB(s,t){var e,i;if(s>=0?(e=s%4294967296|0,i=s/4294967296|0):(e=~(-s%4294967296),i=~(-s/4294967296),e^4294967295?e=e+1|0:(e=0,i=i+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),SB(e,i,t),CB(i,t)}function SB(s,t,e){e.buf[e.pos++]=s&127|128,s>>>=7,e.buf[e.pos++]=s&127|128,s>>>=7,e.buf[e.pos++]=s&127|128,s>>>=7,e.buf[e.pos++]=s&127|128,s>>>=7,e.buf[e.pos]=s&127}function CB(s,t){var e=(s&7)<<4;t.buf[t.pos++]|=e|((s>>>=3)?128:0),s&&(t.buf[t.pos++]=s&127|((s>>>=7)?128:0),s&&(t.buf[t.pos++]=s&127|((s>>>=7)?128:0),s&&(t.buf[t.pos++]=s&127|((s>>>=7)?128:0),s&&(t.buf[t.pos++]=s&127|((s>>>=7)?128:0),s&&(t.buf[t.pos++]=s&127)))))}function EC(s,t,e){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));e.realloc(i);for(var r=e.pos-1;r>=s;r--)e.buf[r+i]=e.buf[r]}function TB(s,t){for(var e=0;e<s.length;e++)t.writeVarint(s[e])}function RB(s,t){for(var e=0;e<s.length;e++)t.writeSVarint(s[e])}function MB(s,t){for(var e=0;e<s.length;e++)t.writeFloat(s[e])}function IB(s,t){for(var e=0;e<s.length;e++)t.writeDouble(s[e])}function AB(s,t){for(var e=0;e<s.length;e++)t.writeBoolean(s[e])}function LB(s,t){for(var e=0;e<s.length;e++)t.writeFixed32(s[e])}function PB(s,t){for(var e=0;e<s.length;e++)t.writeSFixed32(s[e])}function OB(s,t){for(var e=0;e<s.length;e++)t.writeFixed64(s[e])}function FB(s,t){for(var e=0;e<s.length;e++)t.writeSFixed64(s[e])}function qf(s,t){return(s[t]|s[t+1]<<8|s[t+2]<<16)+s[t+3]*16777216}function ic(s,t,e){s[e]=t,s[e+1]=t>>>8,s[e+2]=t>>>16,s[e+3]=t>>>24}function SC(s,t){return(s[t]|s[t+1]<<8|s[t+2]<<16)+(s[t+3]<<24)}function kB(s,t,e){for(var i="",r=t;r<e;){var n=s[r],o=null,a=n>239?4:n>223?3:n>191?2:1;if(r+a>e)break;var l,h,c;a===1?n<128&&(o=n):a===2?(l=s[r+1],(l&192)===128&&(o=(n&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=s[r+1],h=s[r+2],(l&192)===128&&(h&192)===128&&(o=(n&15)<<12|(l&63)<<6|h&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=s[r+1],h=s[r+2],c=s[r+3],(l&192)===128&&(h&192)===128&&(c&192)===128&&(o=(n&15)<<18|(l&63)<<12|(h&63)<<6|c&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,i+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),i+=String.fromCharCode(o),r+=a}return i}function NB(s,t,e){return YL.decode(s.subarray(t,e))}function DB(s,t,e){for(var i=0,r,n;i<t.length;i++){if(r=t.charCodeAt(i),r>55295&&r<57344)if(n)if(r<56320){s[e++]=239,s[e++]=191,s[e++]=189,n=r;continue}else r=n-55296<<10|r-56320|65536,n=null;else{r>56319||i+1===t.length?(s[e++]=239,s[e++]=191,s[e++]=189):n=r;continue}else n&&(s[e++]=239,s[e++]=191,s[e++]=189,n=null);r<128?s[e++]=r:(r<2048?s[e++]=r>>6|192:(r<65536?s[e++]=r>>12|224:(s[e++]=r>>18|240,s[e++]=r>>12&63|128),s[e++]=r>>6&63|128),s[e++]=r&63|128)}return e}const $B=od(xB);class jB extends Vg{constructor(t){super(),t=t||{},this.dataProjection=new Ru({code:"",units:"tile-pixels"}),this.featureClass_=t.featureClass?t.featureClass:Cn,this.geometryName_=t.geometryName,this.layerName_=t.layerName?t.layerName:"layer",this.layers_=t.layers?t.layers:null,this.idProperty_=t.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(t,e,i,r){t.pos=e.geometry;const n=t.readVarint()+t.pos;let o=1,a=0,l=0,h=0,c=0,u=0;for(;t.pos<n;){if(!a){const d=t.readVarint();o=d&7,a=d>>3}if(a--,o===1||o===2)l+=t.readSVarint(),h+=t.readSVarint(),o===1&&c>u&&(r.push(c),u=c),i.push(l,h),c+=2;else if(o===7)c>u&&(i.push(i[u],i[u+1]),c+=2);else throw new Error("Invalid command found in the PBF")}c>u&&(r.push(c),u=c)}createFeature_(t,e,i){const r=e.type;if(r===0)return null;let n;const o=e.properties;let a;this.idProperty_?(a=o[this.idProperty_],delete o[this.idProperty_]):a=e.id,o[this.layerName_]=e.layer.name;const l=[],h=[];this.readRawGeometry_(t,e,l,h);const c=VB(r,h.length);if(this.featureClass_===Cn)n=new this.featureClass_(c,l,h,2,o,a),n.transform(i.dataProjection);else{let u;if(c=="Polygon"){const g=ZA(l,h);u=g.length>1?new Ea(l,"XY",g):new gn(l,"XY",h)}else u=c==="Point"?new xs(l,"XY"):c==="LineString"?new Ps(l,"XY"):c==="MultiPoint"?new wa(l,"XY"):c==="MultiLineString"?new Bn(l,"XY",h):null;const d=this.featureClass_;n=new d,this.geometryName_&&n.setGeometryName(this.geometryName_);const p=vi(u,!1,i);n.setGeometry(p),a!==void 0&&n.setId(a),n.setProperties(o,!0)}return n}getType(){return"arraybuffer"}readFeatures(t,e){const i=this.layers_;e=this.adaptOptions(e);const r=ct(e.dataProjection);r.setWorldExtent(e.extent),e.dataProjection=r;const n=new $B(t),o=n.readFields(GB,{}),a=[];for(const l in o){if(i&&!i.includes(l))continue;const h=o[l],c=h?[0,0,h.extent,h.extent]:null;r.setExtent(c);for(let u=0,d=h.length;u<d;++u){const p=UB(n,h,u),g=this.createFeature_(n,p,e);g!==null&&a.push(g)}}return a}readProjection(t){return this.dataProjection}setLayers(t){this.layers_=t}}function GB(s,t,e){if(s===3){const i={keys:[],values:[],features:[]},r=e.readVarint()+e.pos;e.readFields(zB,i,r),i.length=i.features.length,i.length&&(t[i.name]=i)}}function zB(s,t,e){if(s===15)t.version=e.readVarint();else if(s===1)t.name=e.readString();else if(s===5)t.extent=e.readVarint();else if(s===2)t.features.push(e.pos);else if(s===3)t.keys.push(e.readString());else if(s===4){let i=null;const r=e.readVarint()+e.pos;for(;e.pos<r;)s=e.readVarint()>>3,i=s===1?e.readString():s===2?e.readFloat():s===3?e.readDouble():s===4?e.readVarint64():s===5?e.readVarint():s===6?e.readSVarint():s===7?e.readBoolean():null;t.values.push(i)}}function BB(s,t,e){if(s==1)t.id=e.readVarint();else if(s==2){const i=e.readVarint()+e.pos;for(;e.pos<i;){const r=t.layer.keys[e.readVarint()],n=t.layer.values[e.readVarint()];t.properties[r]=n}}else s==3?t.type=e.readVarint():s==4&&(t.geometry=e.pos)}function UB(s,t,e){s.pos=t.features[e];const i=s.readVarint()+s.pos,r={layer:t,type:0,properties:{}};return s.readFields(BB,r,i),r}function VB(s,t){let e;return s===1?e=t===1?"Point":"MultiPoint":s===2?e=t===1?"LineString":"MultiLineString":s===3&&(e="Polygon"),e}const ZL=jB;class HB{read(t){if(!t)return null;if(typeof t=="string"){const e=nn(t);return this.readFromDocument(e)}return rn(t)?this.readFromDocument(t):this.readFromNode(t)}readFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null}readFromNode(t){Lt()}}const Lw=HB,WB="http://www.w3.org/1999/xlink";function ad(s){return s.getAttributeNS(WB,"href")}const Ir=[null,"http://www.opengis.net/ows/1.1"],XB=q(Ir,{ServiceIdentification:F(y6),ServiceProvider:F(v6),OperationsMetadata:F(m6)});class qB extends Lw{constructor(){super()}readFromNode(t){return Z({},XB,t,[])||null}}const YB=q(Ir,{DeliveryPoint:F(Q),City:F(Q),AdministrativeArea:F(Q),PostalCode:F(Q),Country:F(Q),ElectronicMailAddress:F(Q)}),ZB=q(Ir,{Value:ai(b6)}),KB=q(Ir,{AllowedValues:F(h6)}),JB=q(Ir,{Phone:F(_6),Address:F(l6)}),QB=q(Ir,{HTTP:F(g6)}),t6=q(Ir,{Get:ai(p6),Post:void 0}),e6=q(Ir,{DCP:F(d6)}),i6=q(Ir,{Operation:f6}),s6=q(Ir,{Voice:F(Q),Facsimile:F(Q)}),r6=q(Ir,{Constraint:ai(c6)}),n6=q(Ir,{IndividualName:F(Q),PositionName:F(Q),ContactInfo:F(u6)}),o6=q(Ir,{Abstract:F(Q),AccessConstraints:F(Q),Fees:F(Q),Title:F(Q),ServiceTypeVersion:F(Q),ServiceType:F(Q)}),a6=q(Ir,{ProviderName:F(Q),ProviderSite:F(ad),ServiceContact:F(x6)});function l6(s,t){return Z({},YB,s,t)}function h6(s,t){return Z({},ZB,s,t)}function c6(s,t){const e=s.getAttribute("name");if(e)return Z({name:e},KB,s,t)}function u6(s,t){return Z({},JB,s,t)}function d6(s,t){return Z({},QB,s,t)}function p6(s,t){const e=ad(s);if(e)return Z({href:e},r6,s,t)}function g6(s,t){return Z({},t6,s,t)}function f6(s,t){const e=s.getAttribute("name"),i=Z({},e6,s,t);if(!i)return;const r=t[t.length-1];r[e]=i}function m6(s,t){return Z({},i6,s,t)}function _6(s,t){return Z({},s6,s,t)}function y6(s,t){return Z({},o6,s,t)}function x6(s,t){return Z({},n6,s,t)}function v6(s,t){return Z({},a6,s,t)}function b6(s,t){return Q(s)}const KL=qB;function CC(s,t,e,i,r,n){r!==void 0?(r=r,n=n!==void 0?n:0):(r=[],n=0);let o=t;for(;o<e;){const a=s[o++];r[n++]=s[o++],r[n++]=a;for(let l=2;l<i;++l)r[n++]=s[o++]}return r.length=n,r}class w6 extends ww{constructor(t){super(),t=t||{},this.dataProjection=ct("EPSG:4326"),this.factor_=t.factor?t.factor:1e5,this.geometryLayout_=t.geometryLayout?t.geometryLayout:"XY"}readFeatureFromText(t,e){const i=this.readGeometryFromText(t,e);return new Ls(i)}readFeaturesFromText(t,e){return[this.readFeatureFromText(t,e)]}readGeometryFromText(t,e){const i=ov(this.geometryLayout_),r=S6(t,i,this.factor_);CC(r,0,r.length,i,r);const n=qo(r,0,r.length,i),o=new Ps(n,this.geometryLayout_);return vi(o,!1,this.adaptOptions(e))}writeFeatureText(t,e){const i=t.getGeometry();if(i)return this.writeGeometryText(i,e);throw new Error("Expected `feature` to have a geometry")}writeFeaturesText(t,e){return this.writeFeatureText(t[0],e)}writeGeometryText(t,e){t=vi(t,!0,this.adaptOptions(e));const i=t.getFlatCoordinates(),r=t.getStride();return CC(i,0,i.length,r,i),E6(i,r,this.factor_)}}function E6(s,t,e){e=e||1e5;let i;const r=new Array(t);for(i=0;i<t;++i)r[i]=0;for(let n=0,o=s.length;n<o;)for(i=0;i<t;++i,++n){const a=s[n],l=a-r[i];r[i]=a,s[n]=l}return C6(s,e)}function S6(s,t,e){e=e||1e5;let i;const r=new Array(t);for(i=0;i<t;++i)r[i]=0;const n=T6(s,e);for(let o=0,a=n.length;o<a;)for(i=0;i<t;++i,++o)r[i]+=n[o],n[o]=r[i];return n}function C6(s,t){t=t||1e5;for(let e=0,i=s.length;e<i;++e)s[e]=Math.round(s[e]*t);return R6(s)}function T6(s,t){t=t||1e5;const e=M6(s);for(let i=0,r=e.length;i<r;++i)e[i]/=t;return e}function R6(s){for(let t=0,e=s.length;t<e;++t){const i=s[t];s[t]=i<0?~(i<<1):i<<1}return I6(s)}function M6(s){const t=A6(s);for(let e=0,i=t.length;e<i;++e){const r=t[e];t[e]=r&1?~(r>>1):r>>1}return t}function I6(s){let t="";for(let e=0,i=s.length;e<i;++e)t+=L6(s[e]);return t}function A6(s){const t=[];let e=0,i=0;for(let r=0,n=s.length;r<n;++r){const o=s.charCodeAt(r)-63;e|=(o&31)<<i,o<32?(t.push(e),e=0,i=0):i+=5}return t}function L6(s){let t,e="";for(;s>=32;)t=(32|s&31)+63,e+=String.fromCharCode(t),s>>=5;return t=s+63,e+=String.fromCharCode(t),e}const P6=w6;class O6 extends fw{constructor(t){super(),t=t||{},this.layerName_=t.layerName,this.layers_=t.layers?t.layers:null,this.dataProjection=ct(t.dataProjection?t.dataProjection:"EPSG:4326")}readFeaturesFromObject(t,e){if(t.type=="Topology"){const i=t;let r,n=null,o=null;i.transform&&(r=i.transform,n=r.scale,o=r.translate);const a=i.arcs;r&&B6(a,n,o);const l=[],h=i.objects,c=this.layerName_;let u;for(const d in h)this.layers_&&!this.layers_.includes(d)||(h[d].type==="GeometryCollection"?(u=h[d],l.push.apply(l,z6(u,a,n,o,c,d,e))):(u=h[d],l.push(JL(u,a,n,o,c,d,e))));return l}return[]}readProjectionFromObject(t){return this.dataProjection}}const F6={Point:k6,LineString:D6,Polygon:j6,MultiPoint:N6,MultiLineString:$6,MultiPolygon:G6};function ry(s,t){const e=[];let i;for(let r=0,n=s.length;r<n;++r)if(i=s[r],r>0&&e.pop(),i>=0){const o=t[i];for(let a=0,l=o.length;a<l;++a)e.push(o[a].slice(0))}else{const o=t[~i];for(let a=o.length-1;a>=0;--a)e.push(o[a].slice(0))}return e}function k6(s,t,e){const i=s.coordinates;return t&&e&&Pw(i,t,e),new xs(i)}function N6(s,t,e){const i=s.coordinates;if(t&&e)for(let r=0,n=i.length;r<n;++r)Pw(i[r],t,e);return new wa(i)}function D6(s,t){const e=ry(s.arcs,t);return new Ps(e)}function $6(s,t){const e=[];for(let i=0,r=s.arcs.length;i<r;++i)e[i]=ry(s.arcs[i],t);return new Bn(e)}function j6(s,t){const e=[];for(let i=0,r=s.arcs.length;i<r;++i)e[i]=ry(s.arcs[i],t);return new gn(e)}function G6(s,t){const e=[];for(let i=0,r=s.arcs.length;i<r;++i){const n=s.arcs[i],o=[];for(let a=0,l=n.length;a<l;++a)o[a]=ry(n[a],t);e[i]=o}return new Ea(e)}function z6(s,t,e,i,r,n,o){const a=s.geometries,l=[];for(let h=0,c=a.length;h<c;++h)l[h]=JL(a[h],t,e,i,r,n,o);return l}function JL(s,t,e,i,r,n,o){let a=null;const l=s.type;if(l){const u=F6[l];l==="Point"||l==="MultiPoint"?a=u(s,e,i):a=u(s,t),a=vi(a,!1,o)}const h=new Ls({geometry:a});s.id!==void 0&&h.setId(s.id);let c=s.properties;return r&&(c||(c={}),c[r]=n),c&&h.setProperties(c,!0),h}function B6(s,t,e){for(let i=0,r=s.length;i<r;++i)U6(s[i],t,e)}function U6(s,t,e){let i=0,r=0;for(let n=0,o=s.length;n<o;++n){const a=s[n];i+=a[0],r+=a[1],a[0]=i,a[1]=r,Pw(a,t,e)}}function Pw(s,t,e){s[0]=s[0]*t[0]+e[0],s[1]=s[1]*t[1]+e[1]}const V6=O6;class Ne extends oe{constructor(t){t=t||{},super(t),this.schemaLocation=t.schemaLocation?t.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(t,e,i){const r=i[i.length-1];i[i.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},r),super.writeGeometryElement(t,e,i)}}Ne.prototype.namespace="http://www.opengis.net/gml/3.2";Ne.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:At(oe.prototype.readFlatPos),posList:At(oe.prototype.readFlatPosList),coordinates:At(nd.prototype.readFlatCoordinates)}};Ne.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:oe.prototype.interiorParser,exterior:oe.prototype.exteriorParser}};Ne.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:At(le.prototype.readPoint),MultiPoint:At(le.prototype.readMultiPoint),LineString:At(le.prototype.readLineString),MultiLineString:At(le.prototype.readMultiLineString),LinearRing:At(le.prototype.readLinearRing),Polygon:At(le.prototype.readPolygon),MultiPolygon:At(le.prototype.readMultiPolygon),Surface:At(Ne.prototype.readSurface),MultiSurface:At(oe.prototype.readMultiSurface),Curve:At(Ne.prototype.readCurve),MultiCurve:At(oe.prototype.readMultiCurve),Envelope:At(Ne.prototype.readEnvelope)}};Ne.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:vt(oe.prototype.curveMemberParser),curveMembers:vt(oe.prototype.curveMemberParser)}};Ne.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:vt(oe.prototype.surfaceMemberParser),surfaceMembers:vt(oe.prototype.surfaceMemberParser)}};Ne.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:vt(le.prototype.readLineString),Curve:vt(oe.prototype.readCurve)}};Ne.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:vt(le.prototype.readPolygon),Surface:vt(oe.prototype.readSurface)}};Ne.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:At(oe.prototype.readPatch)}};Ne.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:At(oe.prototype.readSegment)}};Ne.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:vt(oe.prototype.readFlatPosList),upperCorner:vt(oe.prototype.readFlatPosList)}};Ne.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:At(oe.prototype.readPolygonPatch)}};Ne.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:r0(oe.prototype.readLineStringSegment)}};Ne.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:vt(le.prototype.pointMemberParser),pointMembers:vt(le.prototype.pointMemberParser)}};Ne.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:vt(le.prototype.lineStringMemberParser),lineStringMembers:vt(le.prototype.lineStringMemberParser)}};Ne.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:vt(le.prototype.polygonMemberParser),polygonMembers:vt(le.prototype.polygonMemberParser)}};Ne.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:vt(le.prototype.readFlatCoordinatesFromNode)}};Ne.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:vt(le.prototype.readLineString)}};Ne.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:vt(le.prototype.readPolygon)}};Ne.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:At(le.prototype.readFlatLinearRing),Ring:At(Ne.prototype.readFlatCurveRing)}};Ne.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:D(oe.prototype.writeRing),interior:D(oe.prototype.writeRing)}};Ne.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:D(Dt),upperCorner:D(Dt)}};Ne.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:D(oe.prototype.writeSurfaceOrPolygonMember),polygonMember:D(oe.prototype.writeSurfaceOrPolygonMember)}};Ne.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:D(oe.prototype.writePointMember)}};Ne.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:D(oe.prototype.writeLineStringOrCurveMember),curveMember:D(oe.prototype.writeLineStringOrCurveMember)}};Ne.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:D(oe.prototype.writeCurveOrLineString),MultiCurve:D(oe.prototype.writeMultiCurveOrLineString),Point:D(Ne.prototype.writePoint),MultiPoint:D(oe.prototype.writeMultiPoint),LineString:D(oe.prototype.writeCurveOrLineString),MultiLineString:D(oe.prototype.writeMultiCurveOrLineString),LinearRing:D(oe.prototype.writeLinearRing),Polygon:D(oe.prototype.writeSurfaceOrPolygon),MultiPolygon:D(oe.prototype.writeMultiSurfaceOrPolygon),Surface:D(oe.prototype.writeSurfaceOrPolygon),MultiSurface:D(oe.prototype.writeMultiSurfaceOrPolygon),Envelope:D(oe.prototype.writeEnvelope)}};const Ow=Ne;class H6{constructor(t){this.tagName_=t}getTagName(){return this.tagName_}}const QL=H6;class W6 extends QL{constructor(t,e){super(t),this.conditions=e,ge(this.conditions.length>=2,"At least 2 conditions are required")}}const X6=W6;class q6 extends X6{constructor(t){super("And",Array.prototype.slice.call(arguments))}}const Y6=q6;class Z6 extends QL{constructor(t,e,i){if(super("BBOX"),this.geometryName=t,this.extent=e,e.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=i}}const K6=Z6;function J6(s){const t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(Y6,t))}function Q6(s,t,e){return new K6(s,t,e)}const TC={"http://www.opengis.net/gml":{boundedBy:F(le.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:vt(le.prototype.readFeaturesInternal)}},tU={"http://www.opengis.net/wfs":{totalInserted:F(Gi),totalUpdated:F(Gi),totalDeleted:F(Gi)},"http://www.opengis.net/wfs/2.0":{totalInserted:F(Gi),totalUpdated:F(Gi),totalDeleted:F(Gi)}},eU={"http://www.opengis.net/wfs":{TransactionSummary:F(MC,"transactionSummary"),InsertResults:F(AC,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:F(MC,"transactionSummary"),InsertResults:F(AC,"insertIds")}},iU={"http://www.opengis.net/wfs":{PropertyName:D(Dt)},"http://www.opengis.net/wfs/2.0":{PropertyName:D(Dt)}},tP={"http://www.opengis.net/wfs":{Insert:D(LC),Update:D(OC),Delete:D(PC),Property:D(FC),Native:D(kC)},"http://www.opengis.net/wfs/2.0":{Insert:D(LC),Update:D(OC),Delete:D(PC),Property:D(FC),Native:D(kC)}},eP="feature",Fw="http://www.w3.org/2000/xmlns/",kw={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},Mv={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},Nw={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},RC={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},Dw={"2.0.0":Ow,"1.1.0":oe,"1.0.0":nd},sU="1.1.0";class rU extends Wg{constructor(t){super(),t=t||{},this.version_=t.version?t.version:sU,this.featureType_=t.featureType,this.featureNS_=t.featureNS,this.gmlFormat_=t.gmlFormat?t.gmlFormat:new Dw[this.version_],this.schemaLocation_=t.schemaLocation?t.schemaLocation:RC[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(t){this.featureType_=t}readFeaturesFromNode(t,e){const i={node:t};Object.assign(i,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(i,this.getReadOptions(t,e||{}));const r=[i];let n;this.version_==="2.0.0"?n=TC:n=this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let o=Z([],n,t,r,this.gmlFormat_);return o||(o=[]),o}readTransactionResponse(t){if(t){if(typeof t=="string"){const e=nn(t);return this.readTransactionResponseFromDocument(e)}return rn(t)?this.readTransactionResponseFromDocument(t):this.readTransactionResponseFromNode(t)}}readFeatureCollectionMetadata(t){if(t){if(typeof t=="string"){const e=nn(t);return this.readFeatureCollectionMetadataFromDocument(e)}return rn(t)?this.readFeatureCollectionMetadataFromDocument(t):this.readFeatureCollectionMetadataFromNode(t)}}readFeatureCollectionMetadataFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(e)}readFeatureCollectionMetadataFromNode(t){const e={},i=Yo(t.getAttribute("numberOfFeatures"));return e.numberOfFeatures=i,Z(e,TC,t,[],this.gmlFormat_)}readTransactionResponseFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(e)}readTransactionResponseFromNode(t){return Z({},eU,t,[])}writeGetFeature(t){const e=Ht(Mv[this.version_],"GetFeature");e.setAttribute("service","WFS"),e.setAttribute("version",this.version_),t.handle&&e.setAttribute("handle",t.handle),t.outputFormat&&e.setAttribute("outputFormat",t.outputFormat),t.maxFeatures!==void 0&&e.setAttribute("maxFeatures",String(t.maxFeatures)),t.resultType&&e.setAttribute("resultType",t.resultType),t.startIndex!==void 0&&e.setAttribute("startIndex",String(t.startIndex)),t.count!==void 0&&e.setAttribute("count",String(t.count)),t.viewParams!==void 0&&e.setAttribute("viewParams",t.viewParams),e.setAttributeNS(Ch,"xsi:schemaLocation",this.schemaLocation_);const i={node:e};if(Object.assign(i,{version:this.version_,srsName:t.srsName,featureNS:t.featureNS?t.featureNS:this.featureNS_,featurePrefix:t.featurePrefix,propertyNames:t.propertyNames?t.propertyNames:[]}),ge(Array.isArray(t.featureTypes),"`options.featureTypes` must be an Array"),typeof t.featureTypes[0]=="string"){let r=t.filter;t.bbox&&(ge(t.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),r=this.combineBboxAndFilter(t.geometryName,t.bbox,t.srsName,r)),Object.assign(i,{geometryName:t.geometryName,filter:r}),HC(e,t.featureTypes,[i])}else t.featureTypes.forEach(r=>{const n=this.combineBboxAndFilter(r.geometryName,r.bbox,t.srsName,t.filter);Object.assign(i,{geometryName:r.geometryName,filter:n}),HC(e,[r.name],[i])});return e}combineBboxAndFilter(t,e,i,r){const n=Q6(t,e,i);return r?J6(r,n):n}writeTransaction(t,e,i,r){const n=[],o=r.version?r.version:this.version_,a=Ht(Mv[o],"Transaction");a.setAttribute("service","WFS"),a.setAttribute("version",o);let l;r&&(l=r.gmlOptions?r.gmlOptions:{},r.handle&&a.setAttribute("handle",r.handle)),a.setAttributeNS(Ch,"xsi:schemaLocation",RC[o]);const h=nU(a,l,o,r);return t&&Yf("Insert",t,n,h),e&&Yf("Update",e,n,h),i&&Yf("Delete",i,n,h),r.nativeElements&&Yf("Native",r.nativeElements,n,h),a}readProjectionFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(e);return null}readProjectionFromNode(t){if(t.firstElementChild&&t.firstElementChild.firstElementChild){t=t.firstElementChild.firstElementChild;for(let e=t.firstElementChild;e;e=e.nextElementSibling)if(!(e.childNodes.length===0||e.childNodes.length===1&&e.firstChild.nodeType===3)){const i=[{}];return this.gmlFormat_.readGeometryElement(e,i),ct(i.pop().srsName)}}return null}}function nU(s,t,e,i){const r=i.featurePrefix?i.featurePrefix:eP;let n;return e==="1.0.0"?n=2:e==="1.1.0"?n=3:e==="2.0.0"&&(n=3.2),Object.assign({node:s},{version:e,featureNS:i.featureNS,featureType:i.featureType,featurePrefix:r,gmlVersion:n,hasZ:i.hasZ,srsName:i.srsName},t)}function Yf(s,t,e,i){zt(i,tP,Fi(s),t,e)}function MC(s,t){return Z({},tU,s,t)}const oU={"http://www.opengis.net/ogc":{FeatureId:vt(function(s,t){return s.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:vt(function(s,t){return s.getAttribute("fid")})}};function IC(s,t){Rr(oU,s,t)}const aU={"http://www.opengis.net/wfs":{Feature:IC},"http://www.opengis.net/wfs/2.0":{Feature:IC}};function AC(s,t){return Z([],aU,s,t)}function LC(s,t,e){const i=e[e.length-1],r=i.featureType,n=i.featureNS,o=i.gmlVersion,a=Ht(n,r);s.appendChild(a),o===2?nd.prototype.writeFeatureElement(a,t,e):o===3?oe.prototype.writeFeatureElement(a,t,e):Ow.prototype.writeFeatureElement(a,t,e)}function iP(s,t,e){const i=e[e.length-1].version,r=kw[i],n=Ht(r,"Filter"),o=Ht(r,"FeatureId");n.appendChild(o),o.setAttribute("fid",t),s.appendChild(n)}function $w(s,t){s=s||eP;const e=s+":";return t.startsWith(e)?t:e+t}function PC(s,t,e){const i=e[e.length-1];ge(t.getId()!==void 0,"Features must have an id set");const r=i.featureType,n=i.featurePrefix,o=i.featureNS,a=$w(n,r);s.setAttribute("typeName",a),s.setAttributeNS(Fw,"xmlns:"+n,o);const l=t.getId();l!==void 0&&iP(s,l,e)}function OC(s,t,e){const i=e[e.length-1];ge(t.getId()!==void 0,"Features must have an id set");const r=i.version,n=i.featureType,o=i.featurePrefix,a=i.featureNS,l=$w(o,n),h=t.getGeometryName();s.setAttribute("typeName",l),s.setAttributeNS(Fw,"xmlns:"+o,a);const c=t.getId();if(c!==void 0){const u=t.getKeys(),d=[];for(let p=0,g=u.length;p<g;p++){const f=t.get(u[p]);if(f!==void 0){let m=u[p];f&&typeof f.getSimplifiedGeometry=="function"&&(m=h),d.push({name:m,value:f})}}zt({version:r,gmlVersion:i.gmlVersion,node:s,hasZ:i.hasZ,srsName:i.srsName},tP,Fi("Property"),d,e),iP(s,c,e)}}function FC(s,t,e){const i=e[e.length-1],r=i.version,n=Mv[r],o=Ht(n,r==="2.0.0"?"ValueReference":"Name"),a=i.gmlVersion;if(s.appendChild(o),Dt(o,t.name),t.value!==void 0&&t.value!==null){const l=Ht(n,"Value");s.appendChild(l),t.value&&typeof t.value.getSimplifiedGeometry=="function"?a===2?nd.prototype.writeGeometryElement(l,t.value,e):a===3?oe.prototype.writeGeometryElement(l,t.value,e):Ow.prototype.writeGeometryElement(l,t.value,e):Dt(l,t.value)}}function kC(s,t,e){t.vendorId&&s.setAttribute("vendorId",t.vendorId),t.safeToIgnore!==void 0&&s.setAttribute("safeToIgnore",String(t.safeToIgnore)),t.value!==void 0&&Dt(s,t.value)}const ny={"http://www.opengis.net/wfs":{Query:D(NC)},"http://www.opengis.net/wfs/2.0":{Query:D(NC)},"http://www.opengis.net/ogc":{During:D(jC),And:D(Zf),Or:D(Zf),Not:D(GC),BBOX:D(DC),Contains:D(Ka),Intersects:D(Ka),Within:D(Ka),DWithin:D($C),PropertyIsEqualTo:D(Jr),PropertyIsNotEqualTo:D(Jr),PropertyIsLessThan:D(Jr),PropertyIsLessThanOrEqualTo:D(Jr),PropertyIsGreaterThan:D(Jr),PropertyIsGreaterThanOrEqualTo:D(Jr),PropertyIsNull:D(zC),PropertyIsBetween:D(BC),PropertyIsLike:D(UC)},"http://www.opengis.net/fes/2.0":{During:D(jC),And:D(Zf),Or:D(Zf),Not:D(GC),BBOX:D(DC),Contains:D(Ka),Disjoint:D(Ka),Intersects:D(Ka),ResourceId:D(hU),Within:D(Ka),DWithin:D($C),PropertyIsEqualTo:D(Jr),PropertyIsNotEqualTo:D(Jr),PropertyIsLessThan:D(Jr),PropertyIsLessThanOrEqualTo:D(Jr),PropertyIsGreaterThan:D(Jr),PropertyIsGreaterThanOrEqualTo:D(Jr),PropertyIsNull:D(zC),PropertyIsBetween:D(BC),PropertyIsLike:D(UC)}};function NC(s,t,e){const i=e[e.length-1],r=i.version,n=i.featurePrefix,o=i.featureNS,a=i.propertyNames,l=i.srsName;let h;n?h=$w(n,t):h=t;let c;r==="2.0.0"?c="typeNames":c="typeName",s.setAttribute(c,h),l&&s.setAttribute("srsName",l),o&&s.setAttributeNS(Fw,"xmlns:"+n,o);const u=Object.assign({},i);u.node=s,zt(u,iU,Fi("PropertyName"),a,e);const d=i.filter;if(d){const p=Ht(oy(r),"Filter");s.appendChild(p),lU(p,d,e)}}function lU(s,t,e){const i=e[e.length-1],r={node:s};Object.assign(r,{context:i}),zt(r,ny,Fi(t.getTagName()),[t],e)}function DC(s,t,e){const i=e[e.length-1],r=i.context.version;i.srsName=t.srsName;const n=Dw[r];ld(r,s,t.geometryName),n.prototype.writeGeometryElement(s,t.extent,e)}function hU(s,t,e){s.setAttribute("rid",t.rid)}function Ka(s,t,e){const i=e[e.length-1],r=i.context.version;i.srsName=t.srsName;const n=Dw[r];ld(r,s,t.geometryName),n.prototype.writeGeometryElement(s,t.geometry,e)}function $C(s,t,e){const i=e[e.length-1].context.version;Ka(s,t,e);const r=Ht(oy(i),"Distance");Dt(r,t.distance.toString()),i==="2.0.0"?r.setAttribute("uom",t.unit):r.setAttribute("units",t.unit),s.appendChild(r)}function jC(s,t,e){const i=e[e.length-1].context.version;c0(Nw[i],"ValueReference",s,t.propertyName);const r=Ht(Jo,"TimePeriod");s.appendChild(r);const n=Ht(Jo,"begin");r.appendChild(n),VC(n,t.begin);const o=Ht(Jo,"end");r.appendChild(o),VC(o,t.end)}function Zf(s,t,e){const i=e[e.length-1].context,r={node:s};Object.assign(r,{context:i});const n=t.conditions;for(let o=0,a=n.length;o<a;++o){const l=n[o];zt(r,ny,Fi(l.getTagName()),[l],e)}}function GC(s,t,e){const i=e[e.length-1].context,r={node:s};Object.assign(r,{context:i});const n=t.condition;zt(r,ny,Fi(n.getTagName()),[n],e)}function Jr(s,t,e){const i=e[e.length-1].context.version;t.matchCase!==void 0&&s.setAttribute("matchCase",t.matchCase.toString()),ld(i,s,t.propertyName),u0(i,s,""+t.expression)}function zC(s,t,e){const i=e[e.length-1].context.version;ld(i,s,t.propertyName)}function BC(s,t,e){const i=e[e.length-1].context.version,r=oy(i);ld(i,s,t.propertyName);const n=Ht(r,"LowerBoundary");s.appendChild(n),u0(i,n,""+t.lowerBoundary);const o=Ht(r,"UpperBoundary");s.appendChild(o),u0(i,o,""+t.upperBoundary)}function UC(s,t,e){const i=e[e.length-1].context.version;s.setAttribute("wildCard",t.wildCard),s.setAttribute("singleChar",t.singleChar),s.setAttribute("escapeChar",t.escapeChar),t.matchCase!==void 0&&s.setAttribute("matchCase",t.matchCase.toString()),ld(i,s,t.propertyName),u0(i,s,""+t.pattern)}function c0(s,t,e,i){const r=Ht(s,t);Dt(r,i),e.appendChild(r)}function u0(s,t,e){c0(oy(s),"Literal",t,e)}function ld(s,t,e){s==="2.0.0"?c0(Nw[s],"ValueReference",t,e):c0(kw[s],"PropertyName",t,e)}function VC(s,t){const e=Ht(Jo,"TimeInstant");s.appendChild(e);const i=Ht(Jo,"timePosition");e.appendChild(i),Dt(i,t)}function HC(s,t,e){const i=e[e.length-1],r=Object.assign({},i);r.node=s,zt(r,ny,Fi("Query"),t,e)}function oy(s){let t;return s==="2.0.0"?t=Nw[s]:t=kw[s],t}const cU=rU,We={POINT:1,LINE_STRING:2,POLYGON:3,MULTI_POINT:4,MULTI_LINE_STRING:5,MULTI_POLYGON:6,GEOMETRY_COLLECTION:7,POLYHEDRAL_SURFACE:15,TIN:16,TRIANGLE:17};let WC=class{constructor(t){this.view_=t,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_="XY"}readUint8(){return this.view_.getUint8(this.pos_++)}readUint32(t){return this.view_.getUint32((this.pos_+=4)-4,t!==void 0?t:this.isLittleEndian_)}readDouble(t){return this.view_.getFloat64((this.pos_+=8)-8,t!==void 0?t:this.isLittleEndian_)}readPoint(){const t=[];return t.push(this.readDouble()),t.push(this.readDouble()),this.hasZ_&&t.push(this.readDouble()),this.hasM_&&t.push(this.readDouble()),t}readLineString(){const t=this.readUint32(),e=[];for(let i=0;i<t;i++)e.push(this.readPoint());return e}readPolygon(){const t=this.readUint32(),e=[];for(let i=0;i<t;i++)e.push(this.readLineString());return e}readWkbHeader(t){const e=this.readUint8()>0,i=this.readUint32(e),r=Math.floor((i&268435455)/1e3),n=!!(i&2147483648)||r===1||r===3,o=!!(i&1073741824)||r===2||r===3,a=!!(i&536870912),l=(i&268435455)%1e3,h=["XY",n?"Z":"",o?"M":""].join(""),c=a?this.readUint32(e):null;if(t!==void 0&&t!==l)throw new Error("Unexpected WKB geometry type "+l);if(this.initialized_){if(this.isLittleEndian_!==e)throw new Error("Inconsistent endian");if(this.layout_!==h)throw new Error("Inconsistent geometry layout");if(c&&this.srid_!==c)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=e,this.hasZ_=n,this.hasM_=o,this.layout_=h,this.srid_=c,this.initialized_=!0;return l}readWkbPayload(t){switch(t){case We.POINT:return this.readPoint();case We.LINE_STRING:return this.readLineString();case We.POLYGON:case We.TRIANGLE:return this.readPolygon();case We.MULTI_POINT:return this.readMultiPoint();case We.MULTI_LINE_STRING:return this.readMultiLineString();case We.MULTI_POLYGON:case We.POLYHEDRAL_SURFACE:case We.TIN:return this.readMultiPolygon();case We.GEOMETRY_COLLECTION:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+t+" is found")}}readWkbBlock(t){return this.readWkbPayload(this.readWkbHeader(t))}readWkbCollection(t,e){const i=this.readUint32(),r=[];for(let n=0;n<i;n++){const o=t.call(this,e);o&&r.push(o)}return r}readMultiPoint(){return this.readWkbCollection(this.readWkbBlock,We.POINT)}readMultiLineString(){return this.readWkbCollection(this.readWkbBlock,We.LINE_STRING)}readMultiPolygon(){return this.readWkbCollection(this.readWkbBlock,We.POLYGON)}readGeometryCollection(){return this.readWkbCollection(this.readGeometry)}readGeometry(){const t=this.readWkbHeader(),e=this.readWkbPayload(t);switch(t){case We.POINT:return new xs(e,this.layout_);case We.LINE_STRING:return new Ps(e,this.layout_);case We.POLYGON:case We.TRIANGLE:return new gn(e,this.layout_);case We.MULTI_POINT:return new wa(e,this.layout_);case We.MULTI_LINE_STRING:return new Bn(e,this.layout_);case We.MULTI_POLYGON:case We.POLYHEDRAL_SURFACE:case We.TIN:return new Ea(e,this.layout_);case We.GEOMETRY_COLLECTION:return new Xs(e);default:return null}}getSrid(){return this.srid_}};class uU{constructor(t){t=t||{},this.layout_=t.layout,this.isLittleEndian_=t.littleEndian!==!1,this.isEWKB_=t.ewkb!==!1,this.writeQueue_=[],this.nodata_=Object.assign({X:0,Y:0,Z:0,M:0},t.nodata)}writeUint8(t){this.writeQueue_.push([1,t])}writeUint32(t){this.writeQueue_.push([4,t])}writeDouble(t){this.writeQueue_.push([8,t])}writePoint(t,e){const i=Object.assign.apply(null,e.split("").map((r,n)=>({[r]:t[n]})));for(const r of this.layout_)this.writeDouble(r in i?i[r]:this.nodata_[r])}writeLineString(t,e){this.writeUint32(t.length);for(let i=0;i<t.length;i++)this.writePoint(t[i],e)}writePolygon(t,e){this.writeUint32(t.length);for(let i=0;i<t.length;i++)this.writeLineString(t[i],e)}writeWkbHeader(t,e){t%=1e3,this.layout_.includes("Z")&&(t+=this.isEWKB_?2147483648:1e3),this.layout_.includes("M")&&(t+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(e)&&(t|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(t),this.isEWKB_&&Number.isInteger(e)&&this.writeUint32(e)}writeMultiPoint(t,e){this.writeUint32(t.length);for(let i=0;i<t.length;i++)this.writeWkbHeader(1),this.writePoint(t[i],e)}writeMultiLineString(t,e){this.writeUint32(t.length);for(let i=0;i<t.length;i++)this.writeWkbHeader(2),this.writeLineString(t[i],e)}writeMultiPolygon(t,e){this.writeUint32(t.length);for(let i=0;i<t.length;i++)this.writeWkbHeader(3),this.writePolygon(t[i],e)}writeGeometryCollection(t){this.writeUint32(t.length);for(let e=0;e<t.length;e++)this.writeGeometry(t[e])}findMinimumLayout(t,e="XYZM"){const i=(r,n)=>r===n?r:r==="XYZM"?n:n==="XYZM"?r:"XY";if(t instanceof ua)return i(t.getLayout(),e);if(t instanceof Xs){const r=t.getGeometriesArray();for(let n=0;n<r.length&&e!=="XY";n++)e=this.findMinimumLayout(r[n],e)}return e}writeGeometry(t,e){const i={Point:We.POINT,LineString:We.LINE_STRING,Polygon:We.POLYGON,MultiPoint:We.MULTI_POINT,MultiLineString:We.MULTI_LINE_STRING,MultiPolygon:We.MULTI_POLYGON,GeometryCollection:We.GEOMETRY_COLLECTION},r=t.getType(),n=i[r];if(!n)throw new Error("GeometryType "+r+" is not supported");this.layout_||(this.layout_=this.findMinimumLayout(t)),this.writeWkbHeader(n,e),t instanceof ua?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[r].call(this,t.getCoordinates(),t.getLayout()):t instanceof Xs&&this.writeGeometryCollection(t.getGeometriesArray())}getBuffer(){const t=this.writeQueue_.reduce((n,o)=>n+o[0],0),e=new ArrayBuffer(t),i=new DataView(e);let r=0;return this.writeQueue_.forEach(n=>{switch(n[0]){case 1:i.setUint8(r,n[1]);break;case 4:i.setUint32(r,n[1],this.isLittleEndian_);break;case 8:i.setFloat64(r,n[1],this.isLittleEndian_);break}r+=n[0]}),e}}class dU extends Vg{constructor(t){super(),t=t||{},this.splitCollection=!!t.splitCollection,this.viewCache_=null,this.hex_=t.hex!==!1,this.littleEndian_=t.littleEndian!==!1,this.ewkb_=t.ewkb!==!1,this.layout_=t.geometryLayout,this.nodataZ_=t.nodataZ||0,this.nodataM_=t.nodataM||0,this.srid_=t.srid}getType(){return this.hex_?"text":"arraybuffer"}readFeature(t,e){return new Ls({geometry:this.readGeometry(t,e)})}readFeatures(t,e){let i=[];const r=this.readGeometry(t,e);return this.splitCollection&&r instanceof Xs?i=r.getGeometriesArray():i=[r],i.map(n=>new Ls({geometry:n}))}readGeometry(t,e){const i=XC(t);if(!i)return null;const r=new WC(i).readGeometry();return this.viewCache_=i,e=this.getReadOptions(t,e),this.viewCache_=null,vi(r,!1,e)}readProjection(t){const e=this.viewCache_||XC(t);if(!e)return;const i=new WC(e);return i.readWkbHeader(),i.getSrid()&&ct("EPSG:"+i.getSrid())||void 0}writeFeature(t,e){return this.writeGeometry(t.getGeometry(),e)}writeFeatures(t,e){return this.writeGeometry(new Xs(t.map(i=>i.getGeometry())),e)}writeGeometry(t,e){e=this.adaptOptions(e);const i=new uU({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}});let r=Number.isInteger(this.srid_)?Number(this.srid_):null;if(this.srid_!==!1&&!Number.isInteger(this.srid_)){const o=e.dataProjection&&ct(e.dataProjection);if(o){const a=o.getCode();a.startsWith("EPSG:")&&(r=Number(a.substring(5)))}}i.writeGeometry(vi(t,!0,e),r);const n=i.getBuffer();return this.hex_?pU(n):n}}function pU(s){const t=new Uint8Array(s);return Array.from(t.values()).map(e=>(e<16?"0":"")+Number(e).toString(16).toUpperCase()).join("")}function gU(s){const t=new Uint8Array(s.length/2);for(let e=0;e<s.length/2;e++)t[e]=parseInt(s.substr(e*2,2),16);return new DataView(t.buffer)}function XC(s){return typeof s=="string"?gU(s):ArrayBuffer.isView(s)?s instanceof DataView?s:new DataView(s.buffer,s.byteOffset,s.byteLength):s instanceof ArrayBuffer?new DataView(s):null}const fU=dU,mU={POINT:xs,LINESTRING:Ps,POLYGON:gn,MULTIPOINT:wa,MULTILINESTRING:Bn,MULTIPOLYGON:Ea},sP="EMPTY",rP="Z",nP="M",_U="ZM",je={START:0,TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6},yU={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class xU{constructor(t){this.wkt=t,this.index_=-1}isAlpha_(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"}isNumeric_(t,e){return e=e!==void 0?e:!1,t>="0"&&t<="9"||t=="."&&!e}isWhiteSpace_(t){return t==" "||t=="	"||t=="\r"||t==`
`}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const t=this.nextChar_(),e=this.index_;let i=t,r;if(t=="(")r=je.LEFT_PAREN;else if(t==",")r=je.COMMA;else if(t==")")r=je.RIGHT_PAREN;else if(this.isNumeric_(t)||t=="-")r=je.NUMBER,i=this.readNumber_();else if(this.isAlpha_(t))r=je.TEXT,i=this.readText_();else{if(this.isWhiteSpace_(t))return this.nextToken();if(t==="")r=je.EOF;else throw new Error("Unexpected character: "+t)}return{position:e,value:i,type:r}}readNumber_(){let t;const e=this.index_;let i=!1,r=!1;do t=="."?i=!0:(t=="e"||t=="E")&&(r=!0),t=this.nextChar_();while(this.isNumeric_(t,i)||!r&&(t=="e"||t=="E")||r&&(t=="-"||t=="+"));return parseFloat(this.wkt.substring(e,this.index_--))}readText_(){let t;const e=this.index_;do t=this.nextChar_();while(this.isAlpha_(t));return this.wkt.substring(e,this.index_--).toUpperCase()}}let vU=class{constructor(s){this.lexer_=s,this.token_={position:0,type:je.START},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(s){return this.token_.type==s}match(s){const t=this.isTokenType(s);return t&&this.consume_(),t}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let s="XY";const t=this.token_;if(this.isTokenType(je.TEXT)){const e=t.value;e===rP?s="XYZ":e===nP?s="XYM":e===_U&&(s="XYZM"),s!=="XY"&&this.consume_()}return s}parseGeometryCollectionText_(){if(this.match(je.LEFT_PAREN)){const s=[];do s.push(this.parseGeometry_());while(this.match(je.COMMA));if(this.match(je.RIGHT_PAREN))return s}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(je.LEFT_PAREN)){const s=this.parsePoint_();if(this.match(je.RIGHT_PAREN))return s}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(je.LEFT_PAREN)){const s=this.parsePointList_();if(this.match(je.RIGHT_PAREN))return s}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(je.LEFT_PAREN)){const s=this.parseLineStringTextList_();if(this.match(je.RIGHT_PAREN))return s}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(je.LEFT_PAREN)){let s;if(this.token_.type==je.LEFT_PAREN?s=this.parsePointTextList_():s=this.parsePointList_(),this.match(je.RIGHT_PAREN))return s}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(je.LEFT_PAREN)){const s=this.parseLineStringTextList_();if(this.match(je.RIGHT_PAREN))return s}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(je.LEFT_PAREN)){const s=this.parsePolygonTextList_();if(this.match(je.RIGHT_PAREN))return s}throw new Error(this.formatErrorMessage_())}parsePoint_(){const s=[],t=this.layout_.length;for(let e=0;e<t;++e){const i=this.token_;if(this.match(je.NUMBER))s.push(i.value);else break}if(s.length==t)return s;throw new Error(this.formatErrorMessage_())}parsePointList_(){const s=[this.parsePoint_()];for(;this.match(je.COMMA);)s.push(this.parsePoint_());return s}parsePointTextList_(){const s=[this.parsePointText_()];for(;this.match(je.COMMA);)s.push(this.parsePointText_());return s}parseLineStringTextList_(){const s=[this.parseLineStringText_()];for(;this.match(je.COMMA);)s.push(this.parseLineStringText_());return s}parsePolygonTextList_(){const s=[this.parsePolygonText_()];for(;this.match(je.COMMA);)s.push(this.parsePolygonText_());return s}isEmptyGeometry_(){const s=this.isTokenType(je.TEXT)&&this.token_.value==sP;return s&&this.consume_(),s}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const s=this.token_;if(this.match(je.TEXT)){const t=s.value;this.layout_=this.parseGeometryLayout_();const e=this.isEmptyGeometry_();if(t=="GEOMETRYCOLLECTION"){if(e)return new Xs([]);const n=this.parseGeometryCollectionText_();return new Xs(n)}const i=mU[t];if(!i)throw new Error("Invalid geometry type: "+t);let r;if(e)t=="POINT"?r=[NaN,NaN]:r=[];else switch(t){case"POINT":{r=this.parsePointText_();break}case"LINESTRING":{r=this.parseLineStringText_();break}case"POLYGON":{r=this.parsePolygonText_();break}case"MULTIPOINT":{r=this.parseMultiPointText_();break}case"MULTILINESTRING":{r=this.parseMultiLineStringText_();break}case"MULTIPOLYGON":{r=this.parseMultiPolygonText_();break}}return new i(r,this.layout_)}throw new Error(this.formatErrorMessage_())}};class bU extends ww{constructor(t){super(),t=t||{},this.splitCollection_=t.splitCollection!==void 0?t.splitCollection:!1}parse_(t){const e=new xU(t);return new vU(e).parse()}readFeatureFromText(t,e){const i=this.readGeometryFromText(t,e),r=new Ls;return r.setGeometry(i),r}readFeaturesFromText(t,e){let i=[];const r=this.readGeometryFromText(t,e);this.splitCollection_&&r.getType()=="GeometryCollection"?i=r.getGeometriesArray():i=[r];const n=[];for(let o=0,a=i.length;o<a;++o){const l=new Ls;l.setGeometry(i[o]),n.push(l)}return n}readGeometryFromText(t,e){const i=this.parse_(t);return vi(i,!1,e)}writeFeatureText(t,e){const i=t.getGeometry();return i?this.writeGeometryText(i,e):""}writeFeaturesText(t,e){if(t.length==1)return this.writeFeatureText(t[0],e);const i=[];for(let n=0,o=t.length;n<o;++n)i.push(t[n].getGeometry());const r=new Xs(i);return this.writeGeometryText(r,e)}writeGeometryText(t,e){return lP(vi(t,!0,e))}}function oP(s){const t=s.getCoordinates();return t.length===0?"":t.join(" ")}function wU(s){const t=[],e=s.getPoints();for(let i=0,r=e.length;i<r;++i)t.push("("+oP(e[i])+")");return t.join(",")}function EU(s){const t=[],e=s.getGeometries();for(let i=0,r=e.length;i<r;++i)t.push(lP(e[i]));return t.join(",")}function jw(s){const t=s.getCoordinates(),e=[];for(let i=0,r=t.length;i<r;++i)e.push(t[i].join(" "));return e.join(",")}function SU(s){const t=[],e=s.getLineStrings();for(let i=0,r=e.length;i<r;++i)t.push("("+jw(e[i])+")");return t.join(",")}function aP(s){const t=[],e=s.getLinearRings();for(let i=0,r=e.length;i<r;++i)t.push("("+jw(e[i])+")");return t.join(",")}function CU(s){const t=[],e=s.getPolygons();for(let i=0,r=e.length;i<r;++i)t.push("("+aP(e[i])+")");return t.join(",")}function TU(s){const t=s.getLayout();let e="";return(t==="XYZ"||t==="XYZM")&&(e+=rP),(t==="XYM"||t==="XYZM")&&(e+=nP),e}const RU={Point:oP,LineString:jw,Polygon:aP,MultiPoint:wU,MultiLineString:SU,MultiPolygon:CU,GeometryCollection:EU};function lP(s){const t=s.getType(),e=RU[t],i=e(s);let r=yU[t];if(typeof s.getFlatCoordinates=="function"){const n=TU(s);n.length>0&&(r+=" "+n)}return i.length===0?r+" "+sP:r+"("+i+")"}const MU=bU,Os=[null,"http://www.opengis.net/wms"],IU=q(Os,{Service:F(ZU),Capability:F(YU)}),AU=q(Os,{Request:F(s8),Exception:F(t8),Layer:F(e8)});class LU extends Lw{constructor(){super(),this.version=void 0}readFromNode(t){return this.version=t.getAttribute("version").trim(),Z({version:this.version},IU,t,[])||null}}const PU=q(Os,{Name:F(Q),Title:F(Q),Abstract:F(Q),KeywordList:F(dP),OnlineResource:F(ad),ContactInformation:F(KU),Fees:F(Q),AccessConstraints:F(Q),LayerLimit:F(Gi),MaxWidth:F(Gi),MaxHeight:F(Gi)}),OU=q(Os,{ContactPersonPrimary:F(JU),ContactPosition:F(Q),ContactAddress:F(QU),ContactVoiceTelephone:F(Q),ContactFacsimileTelephone:F(Q),ContactElectronicMailAddress:F(Q)}),FU=q(Os,{ContactPerson:F(Q),ContactOrganization:F(Q)}),kU=q(Os,{AddressType:F(Q),Address:F(Q),City:F(Q),StateOrProvince:F(Q),PostCode:F(Q),Country:F(Q)}),NU=q(Os,{Format:vt(Q)}),hP=q(Os,{Name:F(Q),Title:F(Q),Abstract:F(Q),KeywordList:F(dP),CRS:ai(Q),EX_GeographicBoundingBox:F(qU),BoundingBox:ai(XU),Dimension:ai(i8),Attribution:F(WU),AuthorityURL:ai(o8),Identifier:ai(Q),MetadataURL:ai(a8),DataURL:ai(pa),FeatureListURL:ai(pa),Style:ai(l8),MinScaleDenominator:F(pe),MaxScaleDenominator:F(pe),Layer:ai(cP)}),DU=q(Os,{Title:F(Q),OnlineResource:F(ad),LogoURL:F(uP)}),$U=q(Os,{westBoundLongitude:F(pe),eastBoundLongitude:F(pe),southBoundLatitude:F(pe),northBoundLatitude:F(pe)}),jU=q(Os,{GetCapabilities:F(P1),GetMap:F(P1),GetFeatureInfo:F(P1)}),GU=q(Os,{Format:ai(Q),DCPType:ai(r8)}),zU=q(Os,{HTTP:F(n8)}),BU=q(Os,{Get:F(pa),Post:F(pa)}),UU=q(Os,{Name:F(Q),Title:F(Q),Abstract:F(Q),LegendURL:ai(uP),StyleSheetURL:F(pa),StyleURL:F(pa)}),VU=q(Os,{Format:F(Q),OnlineResource:F(ad)}),HU=q(Os,{Keyword:vt(Q)});function WU(s,t){return Z({},DU,s,t)}function XU(s,t){const e=[Uo(s.getAttribute("minx")),Uo(s.getAttribute("miny")),Uo(s.getAttribute("maxx")),Uo(s.getAttribute("maxy"))],i=[Uo(s.getAttribute("resx")),Uo(s.getAttribute("resy"))];return{crs:s.getAttribute("CRS"),extent:e,res:i}}function qU(s,t){const e=Z({},$U,s,t);if(!e)return;const i=e.westBoundLongitude,r=e.southBoundLatitude,n=e.eastBoundLongitude,o=e.northBoundLatitude;if(!(i===void 0||r===void 0||n===void 0||o===void 0))return[i,r,n,o]}function YU(s,t){return Z({},AU,s,t)}function ZU(s,t){return Z({},PU,s,t)}function KU(s,t){return Z({},OU,s,t)}function JU(s,t){return Z({},FU,s,t)}function QU(s,t){return Z({},kU,s,t)}function t8(s,t){return Z([],NU,s,t)}function e8(s,t){const e=Z({},hP,s,t);return e.Layer===void 0?Object.assign(e,cP(s,t)):e}function cP(s,t){const e=t[t.length-1],i=Z({},hP,s,t);if(!i)return;let r=xh(s.getAttribute("queryable"));r===void 0&&(r=e.queryable),i.queryable=r!==void 0?r:!1;let n=Yo(s.getAttribute("cascaded"));n===void 0&&(n=e.cascaded),i.cascaded=n;let o=xh(s.getAttribute("opaque"));o===void 0&&(o=e.opaque),i.opaque=o!==void 0?o:!1;let a=xh(s.getAttribute("noSubsets"));a===void 0&&(a=e.noSubsets),i.noSubsets=a!==void 0?a:!1;let l=Uo(s.getAttribute("fixedWidth"));l||(l=e.fixedWidth),i.fixedWidth=l;let h=Uo(s.getAttribute("fixedHeight"));return h||(h=e.fixedHeight),i.fixedHeight=h,["Style","CRS","AuthorityURL"].forEach(function(c){if(c in e){const u=i[c]||[];i[c]=u.concat(e[c])}}),["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"].forEach(function(c){if(!(c in i)){const u=e[c];i[c]=u}}),i}function i8(s,t){return{name:s.getAttribute("name"),units:s.getAttribute("units"),unitSymbol:s.getAttribute("unitSymbol"),default:s.getAttribute("default"),multipleValues:xh(s.getAttribute("multipleValues")),nearestValue:xh(s.getAttribute("nearestValue")),current:xh(s.getAttribute("current")),values:Q(s)}}function pa(s,t){return Z({},VU,s,t)}function s8(s,t){return Z({},jU,s,t)}function r8(s,t){return Z({},zU,s,t)}function n8(s,t){return Z({},BU,s,t)}function P1(s,t){return Z({},GU,s,t)}function uP(s,t){const e=pa(s,t);if(e){const i=[Yo(s.getAttribute("width")),Yo(s.getAttribute("height"))];return e.size=i,e}}function o8(s,t){const e=pa(s,t);if(e)return e.name=s.getAttribute("name"),e}function a8(s,t){const e=pa(s,t);if(e)return e.type=s.getAttribute("type"),e}function l8(s,t){return Z({},UU,s,t)}function dP(s,t){return Z([],HU,s,t)}const h8=LU,c8="_feature",u8="_layer";class d8 extends Wg{constructor(t){super(),t=t||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new nd,this.layers_=t.layers?t.layers:null}getLayers(){return this.layers_}setLayers(t){this.layers_=t}readFeatures_(t,e){t.setAttribute("namespaceURI",this.featureNS_);const i=t.localName;let r=[];if(t.childNodes.length===0)return r;if(i=="msGMLOutput")for(let n=0,o=t.childNodes.length;n<o;n++){const a=t.childNodes[n];if(a.nodeType!==Node.ELEMENT_NODE)continue;const l=a,h=e[0],c=u8,u=l.localName.replace(c,"");if(this.layers_&&!this.layers_.includes(u))continue;const d=u+c8;h.featureType=d,h.featureNS=this.featureNS_;const p={};p[d]=vt(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const g=q([h.featureNS,null],p);l.setAttribute("namespaceURI",this.featureNS_);const f=Z([],g,l,e,this.gmlFormat_);f&&Se(r,f)}if(i=="FeatureCollection"){const n=Z([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,t,[{}],this.gmlFormat_);n&&(r=n)}return r}readFeaturesFromNode(t,e){const i={};return e&&Object.assign(i,this.getReadOptions(t,e)),this.readFeatures_(t,[i])}}const p8=d8,So=[null,"http://www.opengis.net/wmts/1.0"],hd=[null,"http://www.opengis.net/ows/1.1"],g8=q(So,{Contents:F(C8)});class f8 extends Lw{constructor(){super(),this.owsParser_=new KL}readFromNode(t){let e=t.getAttribute("version");e&&(e=e.trim());let i=this.owsParser_.readFromNode(t);return i?(i.version=e,i=Z(i,g8,t,[]),i||null):null}}const m8=q(So,{Layer:ai(T8),TileMatrixSet:ai(R8)}),_8=q(So,{Style:ai(M8),Format:ai(Q),TileMatrixSetLink:ai(I8),Dimension:ai(A8),ResourceURL:ai(L8)},q(hd,{Title:F(Q),Abstract:F(Q),WGS84BoundingBox:F(gP),BoundingBox:ai(P8),Identifier:F(Q)})),y8=q(So,{LegendURL:ai(O8)},q(hd,{Title:F(Q),Identifier:F(Q)})),x8=q(So,{TileMatrixSet:F(Q),TileMatrixSetLimits:F(k8)}),v8=q(So,{TileMatrixLimits:vt(N8)}),b8=q(So,{TileMatrix:F(Q),MinTileRow:F(Gi),MaxTileRow:F(Gi),MinTileCol:F(Gi),MaxTileCol:F(Gi)}),w8=q(So,{Default:F(Q),Value:ai(Q)},q(hd,{Identifier:F(Q)})),pP=q(hd,{LowerCorner:vt(Iv),UpperCorner:vt(Iv)}),E8=q(So,{WellKnownScaleSet:F(Q),TileMatrix:ai(F8)},q(hd,{SupportedCRS:F(Q),Identifier:F(Q),BoundingBox:F(gP)})),S8=q(So,{TopLeftCorner:F(Iv),ScaleDenominator:F(pe),TileWidth:F(Gi),TileHeight:F(Gi),MatrixWidth:F(Gi),MatrixHeight:F(Gi)},q(hd,{Identifier:F(Q)}));function C8(s,t){return Z({},m8,s,t)}function T8(s,t){return Z({},_8,s,t)}function R8(s,t){return Z({},E8,s,t)}function M8(s,t){const e=Z({},y8,s,t);if(!e)return;const i=s.getAttribute("isDefault")==="true";return e.isDefault=i,e}function I8(s,t){return Z({},x8,s,t)}function A8(s,t){return Z({},w8,s,t)}function L8(s,t){const e=s.getAttribute("format"),i=s.getAttribute("template"),r=s.getAttribute("resourceType"),n={};return e&&(n.format=e),i&&(n.template=i),r&&(n.resourceType=r),n}function gP(s,t){const e=Z([],pP,s,t);if(e.length==2)return Cu(e)}function P8(s,t){const e=s.getAttribute("crs"),i=Z([],pP,s,t);if(i.length==2)return{extent:Cu(i),crs:e}}function O8(s,t){const e={};return e.format=s.getAttribute("format"),e.href=ad(s),e}function Iv(s,t){const e=Q(s).split(/\s+/);if(!e||e.length!=2)return;const i=+e[0],r=+e[1];if(!(isNaN(i)||isNaN(r)))return[i,r]}function F8(s,t){return Z({},S8,s,t)}function k8(s,t){return Z([],v8,s,t)}function N8(s,t){return Z({},b8,s,t)}const fP=f8,D8=Object.freeze(Object.defineProperty({__proto__:null,EsriJSON:Rj,GML:tG,GPX:GG,GeoJSON:tL,IGC:XG,IIIFInfo:t4,KML:yB,MVT:ZL,OWS:KL,Polyline:P6,TopoJSON:V6,WFS:cU,WKB:fU,WKT:MU,WMSCapabilities:h8,WMSGetFeatureInfo:p8,WMTSCapabilities:fP},Symbol.toStringTag,{value:"Module"}));window.eoxMapAdvancedOlFormats=D8;const al={ADD:"add",REMOVE:"remove"},qC={LENGTH:"length"};let Kf=class extends Eo{constructor(t,e,i){super(t),this.element=e,this.index=i}},$8=class extends jh{constructor(s,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=s||[],this.unique_)for(let e=0,i=this.array_.length;e<i;++e)this.assertUnique_(this.array_[e],e);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(s){for(let t=0,e=s.length;t<e;++t)this.push(s[t]);return this}forEach(s){const t=this.array_;for(let e=0,i=t.length;e<i;++e)s(t[e],e,t)}getArray(){return this.array_}item(s){return this.array_[s]}getLength(){return this.get(qC.LENGTH)}insertAt(s,t){if(s<0||s>this.getLength())throw new Error("Index out of bounds: "+s);this.unique_&&this.assertUnique_(t),this.array_.splice(s,0,t),this.updateLength_(),this.dispatchEvent(new Kf(al.ADD,t,s))}pop(){return this.removeAt(this.getLength()-1)}push(s){this.unique_&&this.assertUnique_(s);const t=this.getLength();return this.insertAt(t,s),this.getLength()}remove(s){const t=this.array_;for(let e=0,i=t.length;e<i;++e)if(t[e]===s)return this.removeAt(e)}removeAt(s){if(s<0||s>=this.getLength())return;const t=this.array_[s];return this.array_.splice(s,1),this.updateLength_(),this.dispatchEvent(new Kf(al.REMOVE,t,s)),t}setAt(s,t){const e=this.getLength();if(s>=e){this.insertAt(s,t);return}if(s<0)throw new Error("Index out of bounds: "+s);this.unique_&&this.assertUnique_(t,s);const i=this.array_[s];this.array_[s]=t,this.dispatchEvent(new Kf(al.REMOVE,i,s)),this.dispatchEvent(new Kf(al.ADD,t,s))}updateLength_(){this.set(qC.LENGTH,this.array_.length)}assertUnique_(s,t){for(let e=0,i=this.array_.length;e<i;++e)if(this.array_[e]===s&&e!==t)throw new Error("Duplicate item added to a unique collection")}};const d0=$8,wr={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},ze={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class j8 extends jh{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[ze.OPACITY]=t.opacity!==void 0?t.opacity:1,ge(typeof e[ze.OPACITY]=="number","Layer opacity must be a number"),e[ze.VISIBLE]=t.visible!==void 0?t.visible:!0,e[ze.Z_INDEX]=t.zIndex,e[ze.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[ze.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[ze.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[ze.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},i=this.getZIndex();return e.opacity=Jt(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=i===void 0&&!e.managed?1/0:i,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return Lt()}getLayerStatesArray(t){return Lt()}getExtent(){return this.get(ze.EXTENT)}getMaxResolution(){return this.get(ze.MAX_RESOLUTION)}getMinResolution(){return this.get(ze.MIN_RESOLUTION)}getMinZoom(){return this.get(ze.MIN_ZOOM)}getMaxZoom(){return this.get(ze.MAX_ZOOM)}getOpacity(){return this.get(ze.OPACITY)}getSourceState(){return Lt()}getVisible(){return this.get(ze.VISIBLE)}getZIndex(){return this.get(ze.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(ze.EXTENT,t)}setMaxResolution(t){this.set(ze.MAX_RESOLUTION,t)}setMinResolution(t){this.set(ze.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(ze.MAX_ZOOM,t)}setMinZoom(t){this.set(ze.MIN_ZOOM,t)}setOpacity(t){ge(typeof t=="number","Layer opacity must be a number"),this.set(ze.OPACITY,t)}setVisible(t){this.set(ze.VISIBLE,t)}setZIndex(t){this.set(ze.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const mP=j8,Ei={ANIMATING:0,INTERACTING:1},vn={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},_P=42,Pu=256;function YC(s,t,e){return function(i,r,n,o,a){if(!i)return;if(!r&&!t)return i;const l=t?0:n[0]*r,h=t?0:n[1]*r,c=a?a[0]:0,u=a?a[1]:0;let d=s[0]+l/2+c,p=s[2]-l/2+c,g=s[1]+h/2+u,f=s[3]-h/2+u;d>p&&(d=(p+d)/2,p=d),g>f&&(g=(f+g)/2,f=g);let m=Jt(i[0],d,p),_=Jt(i[1],g,f);if(o&&e&&r){const y=30*r;m+=-y*Math.log(1+Math.max(0,d-i[0])/y)+y*Math.log(1+Math.max(0,i[0]-p)/y),_+=-y*Math.log(1+Math.max(0,g-i[1])/y)+y*Math.log(1+Math.max(0,i[1]-f)/y)}return[m,_]}}function G8(s){return s}function Gw(s,t,e,i){const r=Kt(t)/e[0],n=ci(t)/e[1];return i?Math.min(s,Math.max(r,n)):Math.min(s,Math.min(r,n))}function zw(s,t,e){let i=Math.min(s,t);const r=50;return i*=Math.log(1+r*Math.max(0,s/t-1))/r+1,e&&(i=Math.max(i,e),i/=Math.log(1+r*Math.max(0,e/s-1))/r+1),Jt(i,e/2,t*2)}function z8(s,t,e,i){return t=t!==void 0?t:!0,function(r,n,o,a){if(r!==void 0){const l=s[0],h=s[s.length-1],c=e?Gw(l,e,o,i):l;if(a)return t?zw(r,c,h):Jt(r,h,c);const u=Math.min(c,r),d=Math.floor(G_(s,u,n));return s[d]>c&&d<s.length-1?s[d+1]:s[d]}}}function B8(s,t,e,i,r,n){return i=i!==void 0?i:!0,e=e!==void 0?e:0,function(o,a,l,h){if(o!==void 0){const c=r?Gw(t,r,l,n):t;if(h)return i?zw(o,c,e):Jt(o,e,c);const u=1e-9,d=Math.ceil(Math.log(t/c)/Math.log(s)-u),p=-a*(.5-u)+.5,g=Math.min(c,o),f=Math.floor(Math.log(t/g)/Math.log(s)+p),m=Math.max(d,f),_=t/Math.pow(s,m);return Jt(_,e,c)}}}function ZC(s,t,e,i,r){return e=e!==void 0?e:!0,function(n,o,a,l){if(n!==void 0){const h=i?Gw(s,i,a,r):s;return!e||!l?Jt(n,t,h):zw(n,h,t)}}}function U8(s){if(s!==void 0)return 0}function KC(s){if(s!==void 0)return s}function V8(s){const t=2*Math.PI/s;return function(e,i){if(i)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function H8(s){const t=s===void 0?dp(5):s;return function(e,i){return i||e===void 0?e:Math.abs(e)<=t?0:e}}function yP(s){return Math.pow(s,3)}function W8(s){return 1-yP(1-s)}function X8(s){return 3*s*s-2*s*s*s}const O1=0;class q8 extends jh{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=ew(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&A5(),t.center&&(t.center=ja(t.center,this.projection_)),t.extent&&(t.extent=Ln(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const a in vn)delete e[a];this.setProperties(e,!0);const i=Z8(t);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=i.minZoom;const r=Y8(t),n=i.constraint,o=K8(t);this.constraints_={center:r,resolution:n,rotation:o},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const i=this.getCenterInternal();if(i){const r=t||[0,0,0,0];e=e||[0,0,0,0];const n=this.getResolution(),o=n/2*(r[3]-e[3]+e[1]-r[1]),a=n/2*(r[0]-e[0]+e[2]-r[2]);this.setCenterInternal([i[0]+o,i[1]-a])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let i=0;i<e.length;++i){let r=arguments[i];r.center&&(r=Object.assign({},r),r.center=ja(r.center,this.getProjection())),r.anchor&&(r=Object.assign({},r),r.anchor=ja(r.anchor,this.getProjection())),e[i]=r}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,i;e>1&&typeof arguments[e-1]=="function"&&(i=arguments[e-1],--e);let r=0;for(;r<e&&!this.isDef();++r){const c=arguments[r];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(r===e){i&&Jf(i,!0);return}let n=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;r<e;++r){const c=arguments[r],u={start:n,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||X8,callback:i};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const d=Ko(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}J8(u)?u.complete=!0:n+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(Ei.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Ei.ANIMATING]>0}getInteracting(){return this.hints_[Ei.INTERACTING]>0}cancelAnimations(){this.setHint(Ei.ANIMATING,-this.hints_[Ei.ANIMATING]);let t;for(let e=0,i=this.animations_.length;e<i;++e){const r=this.animations_[e];if(r[0].callback&&Jf(r[0].callback,!1),!t)for(let n=0,o=r.length;n<o;++n){const a=r[n];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let i=this.animations_.length-1;i>=0;--i){const r=this.animations_[i];let n=!0;for(let o=0,a=r.length;o<a;++o){const l=r[o];if(l.complete)continue;const h=t-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):n=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],p=l.sourceCenter[1],g=l.targetCenter[0],f=l.targetCenter[1];this.nextCenter_=l.targetCenter;const m=d+u*(g-d),_=p+u*(f-p);this.targetCenter_=[m,_]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const p=this.getViewportSize_(this.getRotation()),g=this.constraints_.resolution(d,0,p,!0);this.targetCenter_=this.calculateCenterZoom(g,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?Ko(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const p=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(p,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(n){this.animations_[i]=null,this.setHint(Ei.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=r[0].callback;o&&Jf(o,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let i;const r=this.getCenterInternal();return r!==void 0&&(i=[r[0]-e[0],r[1]-e[1]],T5(i,t-this.getRotation()),PA(i,e)),i}calculateCenterZoom(t,e){let i;const r=this.getCenterInternal(),n=this.getResolution();if(r!==void 0&&n!==void 0){const o=e[0]-t*(e[0]-r[0])/n,a=e[1]-t*(e[1]-r[1])/n;i=[o,a]}return i}getViewportSize_(t){const e=this.viewportSize_;if(t){const i=e[0],r=e[1];return[Math.abs(i*Math.cos(t))+Math.abs(r*Math.sin(t)),Math.abs(i*Math.sin(t))+Math.abs(r*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&nv(t,this.getProjection())}getCenterInternal(){return this.get(vn.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return W_(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();ge(e,"The view center is not defined");const i=this.getResolution();ge(i!==void 0,"The view resolution is not defined");const r=this.getRotation();return ge(r!==void 0,"The view rotation is not defined"),Kb(e,i,r,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(vn.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(Ln(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const i=Kt(t)/e[0],r=ci(t)/e[1];return Math.max(i,r)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,r=Math.log(e/i)/Math.log(t);return function(n){return e/Math.pow(t,n*r)}}getRotation(){return this.get(vn.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,n=Math.log(i/r)/e;return function(o){return Math.log(i/o)/e/n}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const i=this.padding_;return i&&(e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),i=this.getRotation();let r=this.getCenterInternal();const n=this.padding_;if(n){const o=this.getViewportSizeMinusPadding_();r=F1(r,this.getViewportSize_(),[o[0]/2+n[3],o[1]/2+n[0]],e,i)}return{center:r.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,i,r;if(this.resolutions_){const n=G_(this.resolutions_,t,1);e=n,i=this.resolutions_[n],n==this.resolutions_.length-1?r=2:r=i/this.resolutions_[n+1]}else i=this.maxResolution_,r=this.zoomFactor_;return e+Math.log(i/t)/Math.log(r)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=Jt(Math.floor(t),0,this.resolutions_.length-2),i=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(i,Jt(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let i;if(ge(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){ge(!ba(t),"Cannot fit empty extent provided as `geometry`");const r=Ln(t,this.getProjection());i=rC(r)}else if(t.getType()==="Circle"){const r=Ln(t.getExtent(),this.getProjection());i=rC(r),i.rotate(this.getRotation(),vs(r))}else i=t;this.fitInternal(i,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),i=Math.cos(e),r=Math.sin(-e),n=t.getFlatCoordinates(),o=t.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=n.length;u<d;u+=o){const p=n[u]*i-n[u+1]*r,g=n[u]*r+n[u+1]*i;a=Math.min(a,p),l=Math.min(l,g),h=Math.max(h,p),c=Math.max(c,g)}return[a,l,h,c]}fitInternal(t,e){e=e||{};let i=e.size;i||(i=this.getViewportSizeMinusPadding_());const r=e.padding!==void 0?e.padding:[0,0,0,0],n=e.nearest!==void 0?e.nearest:!1;let o;e.minResolution!==void 0?o=e.minResolution:e.maxZoom!==void 0?o=this.getResolutionForZoom(e.maxZoom):o=0;const a=this.rotatedExtentForGeometry(t);let l=this.getResolutionForExtentInternal(a,[i[0]-r[1]-r[3],i[1]-r[0]-r[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,n?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=vs(a);d[0]+=(r[1]-r[3])/2*l,d[1]+=(r[0]-r[2])/2*l;const p=d[0]*u-d[1]*c,g=d[1]*u+d[0]*c,f=this.getConstrainedCenter([p,g],l),m=e.callback?e.callback:$p;e.duration!==void 0?this.animateInternal({resolution:l,center:f,duration:e.duration,easing:e.easing},m):(this.targetResolution_=l,this.targetCenter_=f,this.applyTargetState_(!1,!0),Jf(m,!0))}centerOn(t,e,i){this.centerOnInternal(ja(t,this.getProjection()),e,i)}centerOnInternal(t,e,i){this.setCenterInternal(F1(t,e,i,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,i,r){let n;const o=this.padding_;if(o&&t){const a=this.getViewportSizeMinusPadding_(-i),l=F1(t,r,[a[0]/2+o[3],a[1]/2+o[0]],e,i);n=[t[0]-l[0],t[1]-l[1]]}return n}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=nv(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&ja(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const i=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),n=this.constraints_.resolution(this.targetResolution_*t,0,r,i);e&&(this.targetCenter_=this.calculateCenterZoom(n,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=ja(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const i=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(r,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&ja(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const i=this.getAnimating()||this.getInteracting()||e,r=this.constraints_.rotation(this.targetRotation_,i),n=this.getViewportSize_(r),o=this.constraints_.resolution(this.targetResolution_,0,n,i),a=this.constraints_.center(this.targetCenter_,o,n,i,this.calculateCenterShift(this.targetCenter_,o,r,n));this.get(vn.ROTATION)!==r&&this.set(vn.ROTATION,r),this.get(vn.RESOLUTION)!==o&&(this.set(vn.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(vn.CENTER)||!t0(this.get(vn.CENTER),a))&&this.set(vn.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,i){t=t!==void 0?t:200;const r=e||0,n=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(n),a=this.constraints_.resolution(this.targetResolution_,r,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,n,o));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=n,this.targetCenter_=l,this.applyTargetState_();return}i=i||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==n||!this.getCenterInternal()||!t0(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:n,center:l,resolution:a,duration:t,easing:W8,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Ei.INTERACTING,1)}endInteraction(t,e,i){i=i&&ja(i,this.getProjection()),this.endInteractionInternal(t,e,i)}endInteractionInternal(t,e,i){this.getInteracting()&&(this.setHint(Ei.INTERACTING,-1),this.resolveConstraints(t,e,i))}getConstrainedCenter(t,e){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)}getConstrainedZoom(t,e){const i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i,e))}getConstrainedResolution(t,e){e=e||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,i)}}function Jf(s,t){setTimeout(function(){s(t)},0)}function Y8(s){if(s.extent!==void 0){const e=s.smoothExtentConstraint!==void 0?s.smoothExtentConstraint:!0;return YC(s.extent,s.constrainOnlyCenter,e)}const t=ew(s.projection,"EPSG:3857");if(s.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,YC(e,!1,!1)}return G8}function Z8(s){let t,e,i,r=s.minZoom!==void 0?s.minZoom:O1,n=s.maxZoom!==void 0?s.maxZoom:28;const o=s.zoomFactor!==void 0?s.zoomFactor:2,a=s.multiWorld!==void 0?s.multiWorld:!1,l=s.smoothResolutionConstraint!==void 0?s.smoothResolutionConstraint:!0,h=s.showFullExtent!==void 0?s.showFullExtent:!1,c=ew(s.projection,"EPSG:3857"),u=c.getExtent();let d=s.constrainOnlyCenter,p=s.extent;if(!a&&!p&&c.isGlobal()&&(d=!1,p=u),s.resolutions!==void 0){const g=s.resolutions;e=g[r],i=g[n]!==void 0?g[n]:g[g.length-1],s.constrainResolution?t=z8(g,l,!d&&p,h):t=ZC(e,i,l,!d&&p,h)}else{const g=(u?Math.max(Kt(u),ci(u)):360*zp.degrees/c.getMetersPerUnit())/Pu/Math.pow(2,O1),f=g/Math.pow(2,28-O1);e=s.maxResolution,e!==void 0?r=0:e=g/Math.pow(o,r),i=s.minResolution,i===void 0&&(s.maxZoom!==void 0?s.maxResolution!==void 0?i=e/Math.pow(o,n):i=g/Math.pow(o,n):i=f),n=r+Math.floor(Math.log(e/i)/Math.log(o)),i=e/Math.pow(o,n-r),s.constrainResolution?t=B8(o,e,i,l,!d&&p,h):t=ZC(e,i,l,!d&&p,h)}return{constraint:t,maxResolution:e,minResolution:i,minZoom:r,zoomFactor:o}}function K8(s){if(s.enableRotation===void 0||s.enableRotation){const t=s.constrainRotation;return t===void 0||t===!0?H8():t===!1?KC:typeof t=="number"?V8(t):KC}return U8}function J8(s){return!(s.sourceCenter&&s.targetCenter&&!t0(s.sourceCenter,s.targetCenter)||s.sourceResolution!==s.targetResolution||s.sourceRotation!==s.targetRotation)}function F1(s,t,e,i,r){const n=Math.cos(-r);let o=Math.sin(-r),a=s[0]*n-s[1]*o,l=s[1]*n+s[0]*o;a+=(t[0]/2-e[0])*i,l+=(e[1]-t[1]/2)*i,o=-o;const h=a*n-l*o,c=l*n+a*o;return[h,c]}const JC=q8;class Q8 extends mP{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(ze.SOURCE,this.handleSourcePropertyChange_);const i=t.source?t.source:null;this.setSource(i)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(ze.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(cs(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=Ai(t,fe.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const i=this.getMapInternal();!t&&i&&(t=i.getView()),t instanceof JC?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&i&&(e.layerStatesArray=i.getLayerGroup().getLayerStatesArray());let r;e.layerStatesArray?r=e.layerStatesArray.find(o=>o.layer===this):r=this.getLayerState();const n=this.getExtent();return tV(r,e.viewState)&&(!n||li(n,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];let e;const i=this.getSource();if(i&&(e=i.getAttributions()),!e)return[];const r=t instanceof JC?t.getViewStateAndExtent():t;let n=e(r);return Array.isArray(n)||(n=[n]),n}render(t,e){const i=this.getRenderer();return i.prepareFrame(t)?(this.rendered=!0,i.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(ze.MAP,t)}getMapInternal(){return this.get(ze.MAP)}setMap(t){this.mapPrecomposeKey_&&(cs(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(cs(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=Ai(t,wr.PRECOMPOSE,function(e){const i=e.frameState.layerStatesArray,r=this.getLayerState(!1);ge(!i.some(function(n){return n.layer===r.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),i.push(r)},this),this.mapRenderKey_=Ai(this,fe.CHANGE,t.render,t),this.changed())}setSource(t){this.set(ze.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function tV(s,t){if(!s.visible)return!1;const e=t.resolution;if(e<s.minResolution||e>=s.maxResolution)return!1;const i=t.zoom;return i>s.minZoom&&i<=s.maxZoom}const qg=Q8;function eV(s,t,e,i,r){xP(s,t,e||0,i||s.length-1,r||iV)}function xP(s,t,e,i,r){for(;i>e;){if(i-e>600){var n=i-e+1,o=t-e+1,a=Math.log(n),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(n-l)/n)*(o-n/2<0?-1:1),c=Math.max(e,Math.floor(t-o*l/n+h)),u=Math.min(i,Math.floor(t+(n-o)*l/n+h));xP(s,t,c,u,r)}var d=s[t],p=e,g=i;for(kd(s,e,t),r(s[i],d)>0&&kd(s,e,i);p<g;){for(kd(s,p,g),p++,g--;r(s[p],d)<0;)p++;for(;r(s[g],d)>0;)g--}r(s[e],d)===0?kd(s,e,g):(g++,kd(s,g,i)),g<=t&&(e=g+1),t<=g&&(i=g-1)}}function kd(s,t,e){var i=s[t];s[t]=s[e],s[e]=i}function iV(s,t){return s<t?-1:s>t?1:0}let Bw=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const i=[];if(!tm(t,e))return i;const r=this.toBBox,n=[];for(;e;){for(let o=0;o<e.children.length;o++){const a=e.children[o],l=e.leaf?r(a):a;tm(t,l)&&(e.leaf?i.push(a):N1(t,l)?this._all(a,i):n.push(a))}e=n.pop()}return i}collides(t){let e=this.data;if(!tm(t,e))return!1;const i=[];for(;e;){for(let r=0;r<e.children.length;r++){const n=e.children[r],o=e.leaf?this.toBBox(n):n;if(tm(t,o)){if(e.leaf||N1(t,o))return!0;i.push(n)}}e=i.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let i=0;i<t.length;i++)this.insert(t[i]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const i=this.data;this.data=e,e=i}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=bc([]),this}remove(t,e){if(!t)return this;let i=this.data;const r=this.toBBox(t),n=[],o=[];let a,l,h;for(;i||n.length;){if(i||(i=n.pop(),l=n[n.length-1],a=o.pop(),h=!0),i.leaf){const c=sV(t,i.children,e);if(c!==-1)return i.children.splice(c,1),n.push(i),this._condense(n),this}!h&&!i.leaf&&N1(i,r)?(n.push(i),o.push(a),a=0,l=i,i=i.children[0]):l?(a++,i=l.children[a],h=!1):i=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const i=[];for(;t;)t.leaf?e.push(...t.children):i.push(...t.children),t=i.pop();return e}_build(t,e,i,r){const n=i-e+1;let o=this._maxEntries,a;if(n<=o)return a=bc(t.slice(e,i+1)),sc(a,this.toBBox),a;r||(r=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,r-1))),a=bc([]),a.leaf=!1,a.height=r;const l=Math.ceil(n/o),h=l*Math.ceil(Math.sqrt(o));QC(t,e,i,h,this.compareMinX);for(let c=e;c<=i;c+=h){const u=Math.min(c+h-1,i);QC(t,c,u,l,this.compareMinY);for(let d=c;d<=u;d+=l){const p=Math.min(d+l-1,u);a.children.push(this._build(t,d,p,r-1))}}return sc(a,this.toBBox),a}_chooseSubtree(t,e,i,r){for(;r.push(e),!(e.leaf||r.length-1===i);){let n=1/0,o=1/0,a;for(let l=0;l<e.children.length;l++){const h=e.children[l],c=k1(h),u=oV(t,h)-c;u<o?(o=u,n=c<n?c:n,a=h):u===o&&c<n&&(n=c,a=h)}e=a||e.children[0]}return e}_insert(t,e,i){const r=i?t:this.toBBox(t),n=[],o=this._chooseSubtree(r,this.data,e,n);for(o.children.push(t),Zd(o,r);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(r,n,e)}_split(t,e){const i=t[e],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);const o=this._chooseSplitIndex(i,n,r),a=bc(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,sc(i,this.toBBox),sc(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)}_splitRoot(t,e){this.data=bc([t,e]),this.data.height=t.height+1,this.data.leaf=!1,sc(this.data,this.toBBox)}_chooseSplitIndex(t,e,i){let r,n=1/0,o=1/0;for(let a=e;a<=i-e;a++){const l=Yd(t,0,a,this.toBBox),h=Yd(t,a,i,this.toBBox),c=aV(l,h),u=k1(l)+k1(h);c<n?(n=c,r=a,o=u<o?u:o):c===n&&u<o&&(o=u,r=a)}return r||i-e}_chooseSplitAxis(t,e,i){const r=t.leaf?this.compareMinX:rV,n=t.leaf?this.compareMinY:nV,o=this._allDistMargin(t,e,i,r),a=this._allDistMargin(t,e,i,n);o<a&&t.children.sort(r)}_allDistMargin(t,e,i,r){t.children.sort(r);const n=this.toBBox,o=Yd(t,0,e,n),a=Yd(t,i-e,i,n);let l=Qf(o)+Qf(a);for(let h=e;h<i-e;h++){const c=t.children[h];Zd(o,t.leaf?n(c):c),l+=Qf(o)}for(let h=i-e-1;h>=e;h--){const c=t.children[h];Zd(a,t.leaf?n(c):c),l+=Qf(a)}return l}_adjustParentBBoxes(t,e,i){for(let r=i;r>=0;r--)Zd(e[r],t)}_condense(t){for(let e=t.length-1,i;e>=0;e--)t[e].children.length===0?e>0?(i=t[e-1].children,i.splice(i.indexOf(t[e]),1)):this.clear():sc(t[e],this.toBBox)}};function sV(s,t,e){if(!e)return t.indexOf(s);for(let i=0;i<t.length;i++)if(e(s,t[i]))return i;return-1}function sc(s,t){Yd(s,0,s.children.length,t,s)}function Yd(s,t,e,i,r){r||(r=bc(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let n=t;n<e;n++){const o=s.children[n];Zd(r,s.leaf?i(o):o)}return r}function Zd(s,t){return s.minX=Math.min(s.minX,t.minX),s.minY=Math.min(s.minY,t.minY),s.maxX=Math.max(s.maxX,t.maxX),s.maxY=Math.max(s.maxY,t.maxY),s}function rV(s,t){return s.minX-t.minX}function nV(s,t){return s.minY-t.minY}function k1(s){return(s.maxX-s.minX)*(s.maxY-s.minY)}function Qf(s){return s.maxX-s.minX+(s.maxY-s.minY)}function oV(s,t){return(Math.max(t.maxX,s.maxX)-Math.min(t.minX,s.minX))*(Math.max(t.maxY,s.maxY)-Math.min(t.minY,s.minY))}function aV(s,t){const e=Math.max(s.minX,t.minX),i=Math.max(s.minY,t.minY),r=Math.min(s.maxX,t.maxX),n=Math.min(s.maxY,t.maxY);return Math.max(0,r-e)*Math.max(0,n-i)}function N1(s,t){return s.minX<=t.minX&&s.minY<=t.minY&&t.maxX<=s.maxX&&t.maxY<=s.maxY}function tm(s,t){return t.minX<=s.maxX&&t.minY<=s.maxY&&t.maxX>=s.minX&&t.maxY>=s.minY}function bc(s){return{children:s,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function QC(s,t,e,i,r){const n=[t,e];for(;n.length;){if(e=n.pop(),t=n.pop(),e-t<=i)continue;const o=t+Math.ceil((e-t)/i/2)*i;eV(s,o,t,e,r),n.push(t,o,o,e)}}let cd=0;const Uh=0,mi=1<<cd++,st=1<<cd++,Is=1<<cd++,ei=1<<cd++,Ji=1<<cd++,zs=Math.pow(2,cd)-1,vP={[mi]:"boolean",[st]:"number",[Is]:"string",[ei]:"color",[Ji]:"number[]"},lV=Object.keys(vP).map(Number).sort(la);function ds(s){const t=[];for(const e of lV)hV(s,e)&&t.push(vP[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function hV(s,t){return(s&t)===t}function kn(s,t){return!!(s&t)}function Yg(s,t){return s===t}let ll=class{constructor(t,e){this.type=t,this.value=e}},bP=class{constructor(t,e,...i){this.type=t,this.operator=e,this.args=i}};function Uw(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,style:{}}}function cV(s){switch(s){case"string":return Is;case"color":return ei;case"number":return st;case"boolean":return mi;case"number[]":return Ji;default:throw new Error(`Unrecognized type hint: ${s}`)}}function Ue(s,t,e){switch(typeof s){case"boolean":return new ll(mi,s);case"number":return new ll(st,s);case"string":{let r=Is;return l4(s)&&(r|=ei),Yg(r&e,Uh)||(r&=e),new ll(r,s)}}if(!Array.isArray(s))throw new Error("Expression must be an array or a primitive value");if(s.length===0)throw new Error("Empty expression");if(typeof s[0]=="string")return wV(s,t,e);for(const r of s)if(typeof r!="number")throw new Error("Expected an array of numbers");let i=Ji;return(s.length===3||s.length===4)&&(i|=ei),e&&(i&=e),new ll(i,s)}const V={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette"},uV={[V.Get]:ee(([s,t])=>t!==void 0?cV(t.value):zs,ue(1,2),dV),[V.Var]:ee(([s])=>s.type,ue(1,1),pV),[V.Id]:ee(st|Is,Nd,gV),[V.Concat]:ee(Is,ue(2,1/0),Le(zs)),[V.GeometryType]:ee(Is,Nd,fV),[V.Resolution]:ee(st,Nd),[V.Zoom]:ee(st,Nd),[V.Time]:ee(st,Nd),[V.Any]:ee(mi,ue(2,1/0),Le(mi)),[V.All]:ee(mi,ue(2,1/0),Le(mi)),[V.Not]:ee(mi,ue(1,1),Le(mi)),[V.Equal]:ee(mi,ue(2,2),Le(zs),za),[V.NotEqual]:ee(mi,ue(2,2),Le(zs),za),[V.GreaterThan]:ee(mi,ue(2,2),Le(zs),za),[V.GreaterThanOrEqualTo]:ee(mi,ue(2,2),Le(zs),za),[V.LessThan]:ee(mi,ue(2,2),Le(zs),za),[V.LessThanOrEqualTo]:ee(mi,ue(2,2),Le(zs),za),[V.Multiply]:ee(s=>{let t=st|ei;for(let e=0;e<s.length;e++)t&=s[e].type;return t},ue(2,1/0),Le(st|ei),za),[V.Coalesce]:ee(s=>{let t=zs;for(let e=1;e<s.length;e+=2)t&=s[e].type;return t&=s[s.length-1].type,t},ue(2,1/0),Le(zs),za),[V.Divide]:ee(st,ue(2,2),Le(st)),[V.Add]:ee(st,ue(2,1/0),Le(st)),[V.Subtract]:ee(st,ue(2,2),Le(st)),[V.Clamp]:ee(st,ue(3,3),Le(st)),[V.Mod]:ee(st,ue(2,2),Le(st)),[V.Pow]:ee(st,ue(2,2),Le(st)),[V.Abs]:ee(st,ue(1,1),Le(st)),[V.Floor]:ee(st,ue(1,1),Le(st)),[V.Ceil]:ee(st,ue(1,1),Le(st)),[V.Round]:ee(st,ue(1,1),Le(st)),[V.Sin]:ee(st,ue(1,1),Le(st)),[V.Cos]:ee(st,ue(1,1),Le(st)),[V.Atan]:ee(st,ue(1,2),Le(st)),[V.Sqrt]:ee(st,ue(1,1),Le(st)),[V.Match]:ee(s=>{let t=zs;for(let e=2;e<s.length;e+=2)t&=s[e].type;return t&=s[s.length-1].type,t},ue(4,1/0),tT,_V),[V.Between]:ee(mi,ue(3,3),Le(st)),[V.Interpolate]:ee(s=>{let t=ei|st;for(let e=3;e<s.length;e+=2)t&=s[e].type;return t},ue(6,1/0),tT,yV),[V.Case]:ee(s=>{let t=zs;for(let e=1;e<s.length;e+=2)t&=s[e].type;return t&=s[s.length-1].type,t},ue(3,1/0),mV,xV),[V.In]:ee(mi,ue(2,2),vV),[V.Number]:ee(st,ue(1,1/0),Le(zs)),[V.String]:ee(Is,ue(1,1/0),Le(zs)),[V.Array]:ee(s=>s.length===3||s.length===4?Ji|ei:Ji,ue(1,1/0),Le(st)),[V.Color]:ee(ei,ue(1,4),Le(st)),[V.Band]:ee(st,ue(1,3),Le(st)),[V.Palette]:ee(ei,ue(2,2),bV)};function dV(s,t){const e=Ue(s[1],t);if(!(e instanceof ll))throw new Error("Expected a literal argument for get operation");if(typeof e.value!="string")throw new Error("Expected a string argument for get operation");if(t.properties.add(e.value),s.length===3){const i=Ue(s[2],t);return[e,i]}return[e]}function pV(s,t,e,i){const r=s[1];if(typeof r!="string")throw new Error("Expected a string argument for var operation");if(t.variables.add(r),!("variables"in t.style)||t.style.variables[r]===void 0)return[new ll(zs,r)];const n=t.style.variables[r],o=Ue(n,t);if(o.value=r,i&&!kn(i,o.type))throw new Error(`The variable ${r} has type ${ds(o.type)} but the following type was expected: ${ds(i)}`);return[o]}function gV(s,t){t.featureId=!0}function fV(s,t){t.geometryType=!0}function Nd(s,t){const e=s[0];if(s.length!==1)throw new Error(`Expected no arguments for ${e} operation`);return[]}function ue(s,t){return function(e,i){const r=e[0],n=e.length-1;if(s===t){if(n!==s){const o=s===1?"":"s";throw new Error(`Expected ${s} argument${o} for ${r}, got ${n}`)}}else if(n<s||n>t){const o=t===1/0?`${s} or more`:`${s} to ${t}`;throw new Error(`Expected ${o} arguments for ${r}, got ${n}`)}}}function Le(s){return function(t,e){const i=t[0],r=t.length-1,n=new Array(r);for(let o=0;o<r;++o){const a=Ue(t[o+1],e);if(!kn(s,a.type)){const l=ds(s),h=ds(a.type);throw new Error(`Unexpected type for argument ${o} of ${i} operation, got ${l} but expected ${h}`)}a.type&=s,n[o]=a}return n}}function za(s,t,e){const i=s[0],r=s.length-1;let n=zs;for(let a=0;a<e.length;++a)n&=e[a].type;if(n===Uh)throw new Error(`No common type could be found for arguments of ${i} operation`);const o=new Array(r);for(let a=0;a<r;++a)o[a]=Ue(s[a+1],t,n);return o}function mV(s,t){const e=s[0],i=s.length-1;if(i%2===0)throw new Error(`An odd amount of arguments was expected for operation ${e}, got ${JSON.stringify(i)} instead`)}function tT(s,t){const e=s[0],i=s.length-1;if(i%2===1)throw new Error(`An even amount of arguments was expected for operation ${e}, got ${JSON.stringify(i)} instead`)}function _V(s,t,e,i){const r=s.length-1;let n=Ue(s[1],t).type;const o=Ue(s[s.length-1],t);let a=i!==void 0?i&o.type:o.type;const l=new Array(r-2);for(let c=0;c<r-2;c+=2){const u=Ue(s[c+2],t),d=Ue(s[c+3],t);n&=u.type,a&=d.type,l[c]=u,l[c+1]=d}const h=Is|st|mi;if(!kn(h,n))throw new Error(`Expected an input of type ${ds(h)} for the interpolate operation, got ${ds(n)} instead`);if(Yg(a,Uh))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(s));for(let c=0;c<r-2;c+=2){const u=Ue(s[c+2],t,n),d=Ue(s[c+3],t,a);l[c]=u,l[c+1]=d}return[Ue(s[1],t,n),...l,Ue(s[s.length-1],t,a)]}function yV(s,t,e,i){const r=s[1];let n;switch(r[0]){case"linear":n=1;break;case"exponential":if(n=r[1],typeof n!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(n)} instead`);break;default:n=null}if(!n)throw new Error(`Invalid interpolation type: ${JSON.stringify(r)}`);n=Ue(n,t);let o=Ue(s[2],t);if(!kn(st,o.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${ds(o.type)} instead`);o=Ue(s[2],t,st);const a=new Array(s.length-3);for(let l=0;l<a.length;l+=2){let h=Ue(s[l+3],t);if(!kn(st,h.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${ds(h.type)} at position ${l+2} instead`);let c=Ue(s[l+4],t);if(!kn(st|ei,c.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${ds(c.type)} at position ${l+3} instead`);h=Ue(s[l+3],t,st),c=Ue(s[l+4],t,st|ei),a[l]=h,a[l+1]=c}return[n,o,...a]}function xV(s,t,e,i){const r=Ue(s[s.length-1],t);let n=i!==void 0?i&r.type:r.type;const o=new Array(s.length-1);for(let a=0;a<o.length-1;a+=2){const l=Ue(s[a+1],t),h=Ue(s[a+2],t);if(!kn(mi,l.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${ds(l.type)} at position ${a} instead`);n&=h.type,o[a]=l,o[a+1]=h}if(Yg(n,Uh))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(s));for(let a=0;a<o.length-1;a+=2)o[a+1]=Ue(s[a+2],t,n);return o[o.length-1]=Ue(s[s.length-1],t,n),o}function vV(s,t){let e=s[2];if(!Array.isArray(e))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof e[0]=="string"){if(e[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(e[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');e=e[1]}let i=Is|st;const r=new Array(e.length);for(let n=0;n<r.length;n++){const o=Ue(e[n],t);i&=o.type,r[n]=o}if(Yg(i,Uh))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(s));return[Ue(s[1],t,i),...r]}function bV(s,t){const e=Ue(s[1],t,st);if(e.type!==st)throw new Error(`The first argument of palette must be an number, got ${ds(e.type)} instead`);const i=s[2];if(!Array.isArray(i))throw new Error("The second argument of palette must be an array");const r=new Array(i.length);for(let n=0;n<r.length;n++){const o=Ue(i[n],t,ei);if(!(o instanceof ll))throw new Error(`The palette color at index ${n} must be a literal value`);if(!kn(o.type,ei))throw new Error(`The palette color at index ${n} should be of type color, got ${ds(o.type)} instead`);r[n]=o}return[e,...r]}function ee(s,...t){return function(e,i,r){const n=e[0];let o=[];for(let l=0;l<t.length;l++)o=t[l](e,i,o,r)||o;let a=typeof s=="function"?s(o):s;if(r!==void 0){if(!kn(a,r))throw new Error(`The following expression was expected to return ${ds(r)}, but returns ${ds(a)} instead: ${JSON.stringify(e)}`);a&=r}if(a===Uh)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(e)}`);return new bP(a,n,...o)}}function wV(s,t,e){const i=s[0],r=uV[i];if(!r)throw new Error(`Unknown operator: ${i}`);return r(s,t,e)}function Vw(s){if(!s)return"";const t=s.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return Vw(s.getGeometries()[0]);default:return""}}function wP(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function Ca(s,t,e){const i=Ue(s,e);if(!kn(t,i.type)){const r=ds(t),n=ds(i.type);throw new Error(`Expected expression to be of type ${r}, got ${n}`)}return mo(i)}function mo(s,t){if(s instanceof ll){if(s.type===ei&&typeof s.value=="string"){const i=Sw(s.value);return function(){return i}}return function(){return s.value}}const e=s.operator;switch(e){case V.Number:case V.String:case V.Coalesce:return EV(s);case V.Get:case V.Var:return SV(s);case V.Id:return i=>i.featureId;case V.GeometryType:return i=>i.geometryType;case V.Concat:{const i=s.args.map(r=>mo(r));return r=>"".concat(...i.map(n=>n(r).toString()))}case V.Resolution:return i=>i.resolution;case V.Any:case V.All:case V.Not:return TV(s);case V.Equal:case V.NotEqual:case V.LessThan:case V.LessThanOrEqualTo:case V.GreaterThan:case V.GreaterThanOrEqualTo:return CV(s);case V.Multiply:case V.Divide:case V.Add:case V.Subtract:case V.Clamp:case V.Mod:case V.Pow:case V.Abs:case V.Floor:case V.Ceil:case V.Round:case V.Sin:case V.Cos:case V.Atan:case V.Sqrt:return RV(s);case V.Case:return MV(s);case V.Match:return IV(s);case V.Interpolate:return AV(s);default:throw new Error(`Unsupported operator ${e}`)}}function EV(s,t){const e=s.operator,i=s.args.length,r=new Array(i);for(let n=0;n<i;++n)r[n]=mo(s.args[n]);switch(e){case V.Coalesce:return n=>{for(let o=0;o<i;++o){const a=r[o](n);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case V.Number:case V.String:return n=>{for(let o=0;o<i;++o){const a=r[o](n);if(typeof a===e)return a}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function SV(s,t){const e=s.args[0].value;switch(s.operator){case V.Get:return i=>i.properties[e];case V.Var:return i=>i.variables[e];default:throw new Error(`Unsupported accessor operator ${s.operator}`)}}function CV(s,t){const e=s.operator,i=mo(s.args[0]),r=mo(s.args[1]);switch(e){case V.Equal:return n=>i(n)===r(n);case V.NotEqual:return n=>i(n)!==r(n);case V.LessThan:return n=>i(n)<r(n);case V.LessThanOrEqualTo:return n=>i(n)<=r(n);case V.GreaterThan:return n=>i(n)>r(n);case V.GreaterThanOrEqualTo:return n=>i(n)>=r(n);default:throw new Error(`Unsupported comparison operator ${e}`)}}function TV(s,t){const e=s.operator,i=s.args.length,r=new Array(i);for(let n=0;n<i;++n)r[n]=mo(s.args[n]);switch(e){case V.Any:return n=>{for(let o=0;o<i;++o)if(r[o](n))return!0;return!1};case V.All:return n=>{for(let o=0;o<i;++o)if(!r[o](n))return!1;return!0};case V.Not:return n=>!r[0](n);default:throw new Error(`Unsupported logical operator ${e}`)}}function RV(s,t){const e=s.operator,i=s.args.length,r=new Array(i);for(let n=0;n<i;++n)r[n]=mo(s.args[n]);switch(e){case V.Multiply:return n=>{let o=1;for(let a=0;a<i;++a)o*=r[a](n);return o};case V.Divide:return n=>r[0](n)/r[1](n);case V.Add:return n=>{let o=0;for(let a=0;a<i;++a)o+=r[a](n);return o};case V.Subtract:return n=>r[0](n)-r[1](n);case V.Clamp:return n=>{const o=r[0](n),a=r[1](n);if(o<a)return a;const l=r[2](n);return o>l?l:o};case V.Mod:return n=>r[0](n)%r[1](n);case V.Pow:return n=>Math.pow(r[0](n),r[1](n));case V.Abs:return n=>Math.abs(r[0](n));case V.Floor:return n=>Math.floor(r[0](n));case V.Ceil:return n=>Math.ceil(r[0](n));case V.Round:return n=>Math.round(r[0](n));case V.Sin:return n=>Math.sin(r[0](n));case V.Cos:return n=>Math.cos(r[0](n));case V.Atan:return i===2?n=>Math.atan2(r[0](n),r[1](n)):n=>Math.atan(r[0](n));case V.Sqrt:return n=>Math.sqrt(r[0](n));default:throw new Error(`Unsupported numeric operator ${e}`)}}function MV(s,t){const e=s.args.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=mo(s.args[r]);return r=>{for(let n=0;n<e-1;n+=2)if(i[n](r))return i[n+1](r);return i[e-1](r)}}function IV(s,t){const e=s.args.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=mo(s.args[r]);return r=>{const n=i[0](r);for(let o=1;o<e;o+=2)if(n===i[o](r))return i[o+1](r);return i[e-1](r)}}function AV(s,t){const e=s.args.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=mo(s.args[r]);return r=>{const n=i[0](r),o=i[1](r);let a,l;for(let h=2;h<e;h+=2){const c=i[h](r);let u=i[h+1](r);const d=Array.isArray(u);if(d&&(u=o4(u)),c>=o)return h===2?u:d?LV(n,o,a,l,c,u):Kd(n,o,a,l,c,u);a=c,l=u}return l}}function Kd(s,t,e,i,r,n){const o=r-e;if(o===0)return i;const a=t-e,l=s===1?a/o:(Math.pow(s,a)-1)/(Math.pow(s,o)-1);return i+l*(n-i)}function LV(s,t,e,i,r,n){if(r-e===0)return i;const o=uC(i),a=uC(n);let l=a[2]-o[2];l>180?l-=360:l<-180&&(l+=360);const h=[Kd(s,t,e,o[0],r,a[0]),Kd(s,t,e,o[1],r,a[1]),o[2]+Kd(s,t,e,0,r,l),Kd(s,t,e,i[3],r,n[3])];return lL(a4(h))}function PV(s){return!0}function OV(s){const t=Uw(),e=FV(s,t),i=wP();return function(r,n){if(i.properties=r.getPropertiesInternal(),i.resolution=n,t.featureId){const o=r.getId();o!==void 0?i.featureId=o:i.featureId=null}return t.geometryType&&(i.geometryType=Vw(r.getGeometry())),e(i)}}function eT(s){const t=Uw(),e=s.length,i=new Array(e);for(let o=0;o<e;++o)i[o]=Av(s[o],t);const r=wP(),n=new Array(e);return function(o,a){if(r.properties=o.getPropertiesInternal(),r.resolution=a,t.featureId){const h=o.getId();h!==void 0?r.featureId=h:r.featureId=null}let l=0;for(let h=0;h<e;++h){const c=i[h](r);c&&(n[l]=c,l+=1)}return n.length=l,n}}function FV(s,t){const e=s.length,i=new Array(e);for(let r=0;r<e;++r){const n=s[r],o="filter"in n?Ca(n.filter,mi,t):PV;let a;if(Array.isArray(n.style)){const l=n.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=Av(n.style[h],t)}else a=[Av(n.style,t)];i[r]={filter:o,styles:a}}return function(r){const n=[];let o=!1;for(let a=0;a<e;++a){const l=i[a].filter;if(l(r)&&!(s[a].else&&o)){o=!0;for(const h of i[a].styles){const c=h(r);c&&n.push(c)}}}return n}}function Av(s,t){const e=Zp(s,"",t),i=Kp(s,"",t),r=kV(s,t),n=NV(s,t),o=Sr(s,"z-index",t);if(!e&&!i&&!r&&!n&&!ha(s))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(s));const a=new lr;return function(l){let h=!0;if(e){const c=e(l);c&&(h=!1),a.setFill(c)}if(i){const c=i(l);c&&(h=!1),a.setStroke(c)}if(r){const c=r(l);c&&(h=!1),a.setText(c)}if(n){const c=n(l);c&&(h=!1),a.setImage(c)}return o&&a.setZIndex(o(l)),h?null:a}}function Zp(s,t,e){let i;if(t+"fill-pattern-src"in s?i=GV(s,t+"fill-",e):i=Hw(s,t+"fill-color",e),!i)return null;const r=new da;return function(n){const o=i(n);return o==="none"?null:(r.setColor(o),r)}}function Kp(s,t,e){const i=Sr(s,t+"stroke-width",e),r=Hw(s,t+"stroke-color",e);if(!i&&!r)return null;const n=Vo(s,t+"stroke-line-cap",e),o=Vo(s,t+"stroke-line-join",e),a=EP(s,t+"stroke-line-dash",e),l=Sr(s,t+"stroke-line-dash-offset",e),h=Sr(s,t+"stroke-miter-limit",e),c=new fo;return function(u){if(r){const d=r(u);if(d==="none")return null;c.setColor(d)}if(i&&c.setWidth(i(u)),n){const d=n(u);if(d!=="butt"&&d!=="round"&&d!=="square")throw new Error("Expected butt, round, or square line cap");c.setLineCap(d)}if(o){const d=o(u);if(d!=="bevel"&&d!=="round"&&d!=="miter")throw new Error("Expected bevel, round, or miter line join");c.setLineJoin(d)}return a&&c.setLineDash(a(u)),l&&c.setLineDashOffset(l(u)),h&&c.setMiterLimit(h(u)),c}}function kV(s,t){const e="text-",i=Vo(s,e+"value",t);if(!i)return null;const r=Zp(s,e,t),n=Zp(s,e+"background-",t),o=Kp(s,e,t),a=Kp(s,e+"background-",t),l=Vo(s,e+"font",t),h=Sr(s,e+"max-angle",t),c=Sr(s,e+"offset-x",t),u=Sr(s,e+"offset-y",t),d=Jp(s,e+"overflow",t),p=Vo(s,e+"placement",t),g=Sr(s,e+"repeat",t),f=ay(s,e+"scale",t),m=Jp(s,e+"rotate-with-view",t),_=Sr(s,e+"rotation",t),y=Vo(s,e+"align",t),v=Vo(s,e+"justify",t),b=Vo(s,e+"baseline",t),E=EP(s,e+"padding",t),S=ly(s,e+"declutter-mode"),T=new Yp({declutterMode:S});return function(R){if(T.setText(i(R)),r&&T.setFill(r(R)),n&&T.setBackgroundFill(n(R)),o&&T.setStroke(o(R)),a&&T.setBackgroundStroke(a(R)),l&&T.setFont(l(R)),h&&T.setMaxAngle(h(R)),c&&T.setOffsetX(c(R)),u&&T.setOffsetY(u(R)),d&&T.setOverflow(d(R)),p){const M=p(R);if(M!=="point"&&M!=="line")throw new Error("Expected point or line for text-placement");T.setPlacement(M)}if(g&&T.setRepeat(g(R)),f&&T.setScale(f(R)),m&&T.setRotateWithView(m(R)),_&&T.setRotation(_(R)),y){const M=y(R);if(M!=="left"&&M!=="center"&&M!=="right"&&M!=="end"&&M!=="start")throw new Error("Expected left, right, center, start, or end for text-align");T.setTextAlign(M)}if(v){const M=v(R);if(M!=="left"&&M!=="right"&&M!=="center")throw new Error("Expected left, right, or center for text-justify");T.setJustify(M)}if(b){const M=b(R);if(M!=="bottom"&&M!=="top"&&M!=="middle"&&M!=="alphabetic"&&M!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");T.setTextBaseline(M)}return E&&T.setPadding(E(R)),T}}function NV(s,t){return"icon-src"in s?DV(s,t):"shape-points"in s?$V(s,t):"circle-radius"in s?jV(s,t):null}function DV(s,t){const e="icon-",i=e+"src",r=SP(s[i],i),n=p0(s,e+"anchor",t),o=ay(s,e+"scale",t),a=Sr(s,e+"opacity",t),l=p0(s,e+"displacement",t),h=Sr(s,e+"rotation",t),c=Jp(s,e+"rotate-with-view",t),u=sT(s,e+"anchor-origin"),d=rT(s,e+"anchor-x-units"),p=rT(s,e+"anchor-y-units"),g=VV(s,e+"color"),f=BV(s,e+"cross-origin"),m=UV(s,e+"offset"),_=sT(s,e+"offset-origin"),y=g0(s,e+"width"),v=g0(s,e+"height"),b=zV(s,e+"size"),E=ly(s,e+"declutter-mode"),S=new ty({src:r,anchorOrigin:u,anchorXUnits:d,anchorYUnits:p,color:g,crossOrigin:f,offset:m,offsetOrigin:_,height:v,width:y,size:b,declutterMode:E});return function(T){return a&&S.setOpacity(a(T)),l&&S.setDisplacement(l(T)),h&&S.setRotation(h(T)),c&&S.setRotateWithView(c(T)),o&&S.setScale(o(T)),n&&S.setAnchor(n(T)),S}}function $V(s,t){const e="shape-",i=e+"points",r=e+"radius",n=Lv(s[i],i),o=Lv(s[r],r),a=Zp(s,e,t),l=Kp(s,e,t),h=ay(s,e+"scale",t),c=p0(s,e+"displacement",t),u=Sr(s,e+"rotation",t),d=Jp(s,e+"rotate-with-view",t),p=g0(s,e+"radius2"),g=g0(s,e+"angle"),f=ly(s,e+"declutter-mode"),m=new wL({points:n,radius:o,radius2:p,angle:g,declutterMode:f});return function(_){return a&&m.setFill(a(_)),l&&m.setStroke(l(_)),c&&m.setDisplacement(c(_)),u&&m.setRotation(u(_)),d&&m.setRotateWithView(d(_)),h&&m.setScale(h(_)),m}}function jV(s,t){const e="circle-",i=Zp(s,e,t),r=Kp(s,e,t),n=Sr(s,e+"radius",t),o=ay(s,e+"scale",t),a=p0(s,e+"displacement",t),l=Sr(s,e+"rotation",t),h=Jp(s,e+"rotate-with-view",t),c=ly(s,e+"declutter-mode"),u=new SL({radius:5,declutterMode:c});return function(d){return n&&u.setRadius(n(d)),i&&u.setFill(i(d)),r&&u.setStroke(r(d)),a&&u.setDisplacement(a(d)),l&&u.setRotation(l(d)),h&&u.setRotateWithView(h(d)),o&&u.setScale(o(d)),u}}function Sr(s,t,e){if(!(t in s))return;const i=Ca(s[t],st,e);return function(r){return Lv(i(r),t)}}function Vo(s,t,e){if(!(t in s))return null;const i=Ca(s[t],Is,e);return function(r){return SP(i(r),t)}}function GV(s,t,e){const i=Vo(s,t+"pattern-src",e),r=iT(s,t+"pattern-offset",e),n=iT(s,t+"pattern-size",e),o=Hw(s,t+"color",e);return function(a){return{src:i(a),offset:r&&r(a),size:n&&n(a),color:o&&o(a)}}}function Jp(s,t,e){if(!(t in s))return null;const i=Ca(s[t],mi,e);return function(r){const n=i(r);if(typeof n!="boolean")throw new Error(`Expected a boolean for ${t}`);return n}}function Hw(s,t,e){if(!(t in s))return null;const i=Ca(s[t],ei|Is,e);return function(r){return CP(i(r),t)}}function EP(s,t,e){if(!(t in s))return null;const i=Ca(s[t],Ji,e);return function(r){return Zg(i(r),t)}}function p0(s,t,e){if(!(t in s))return null;const i=Ca(s[t],Ji,e);return function(r){const n=Zg(i(r),t);if(n.length!==2)throw new Error(`Expected two numbers for ${t}`);return n}}function iT(s,t,e){if(!(t in s))return null;const i=Ca(s[t],Ji,e);return function(r){return TP(i(r),t)}}function ay(s,t,e){if(!(t in s))return null;const i=Ca(s[t],Ji|st,e);return function(r){return HV(i(r),t)}}function g0(s,t){const e=s[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function zV(s,t){const e=s[t];if(e!==void 0){if(typeof e=="number")return xi(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function BV(s,t){const e=s[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function sT(s,t){const e=s[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function rT(s,t){const e=s[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function UV(s,t){const e=s[t];if(e!==void 0)return Zg(e,t)}function ly(s,t){const e=s[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function VV(s,t){const e=s[t];if(e!==void 0)return CP(e,t)}function Zg(s,t){if(!Array.isArray(s))throw new Error(`Expected an array for ${t}`);const e=s.length;for(let i=0;i<e;++i)if(typeof s[i]!="number")throw new Error(`Expected an array of numbers for ${t}`);return s}function SP(s,t){if(typeof s!="string")throw new Error(`Expected a string for ${t}`);return s}function Lv(s,t){if(typeof s!="number")throw new Error(`Expected a number for ${t}`);return s}function CP(s,t){if(typeof s=="string")return s;const e=Zg(s,t),i=e.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function TP(s,t){const e=Zg(s,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function HV(s,t){return typeof s=="number"?s:TP(s,t)}const nT={RENDER_ORDER:"renderOrder"};let WV=class extends qg{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(nT.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const i=this.getDeclutter();i in t.declutter||(t.declutter[i]=new Bw(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(nT.RENDER_ORDER,t)}setStyle(t){this.style_=XV(t),this.styleFunction_=t===null?void 0:A4(this.style_),this.changed()}};function XV(s){if(s===void 0)return L4;if(!s)return null;if(typeof s=="function"||s instanceof lr)return s;if(!Array.isArray(s))return eT([s]);if(s.length===0)return[];const t=s.length,e=s[0];if(e instanceof lr){const i=new Array(t);for(let r=0;r<t;++r){const n=s[r];if(!(n instanceof lr))throw new Error("Expected a list of style instances");i[r]=n}return i}if("style"in e){const i=new Array(t);for(let r=0;r<t;++r){const n=s[r];if(!("style"in n))throw new Error("Expected a list of rules with a style property");i[r]=n}return OV(i)}return eT(s)}const Kg=WV,Jg={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},em=[Jg.FILL],hl=[Jg.STROKE],ch=[Jg.BEGIN_PATH],oT=[Jg.CLOSE_PATH],jt=Jg;let qV=class{drawCustom(t,e,i,r,n){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,i){}drawFeature(t,e,i){}drawGeometryCollection(t,e,i){}drawLineString(t,e,i){}drawMultiLineString(t,e,i){}drawMultiPoint(t,e,i){}drawMultiPolygon(t,e,i){}drawPoint(t,e,i){}drawPolygon(t,e,i){}drawText(t,e,i){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}};const RP=qV;let YV=class extends RP{constructor(t,e,i,r){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=r,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(i){return i*e})}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),r=this.tmpCoordinate_,n=this.coordinates;let o=n.length;for(let a=0,l=t.length;a<l;a+=e)r[0]=t[a],r[1]=t[a+1],Hr(i,r)&&(n[o++]=r[0],n[o++]=r[1]);return o}appendFlatLineCoordinates(t,e,i,r,n,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(e+=r);let c=t[e],u=t[e+1];const d=this.tmpCoordinate_;let p=!0,g,f,m;for(g=e+r;g<i;g+=r)d[0]=t[g],d[1]=t[g+1],m=tv(h,d),m!==f?(p&&(a[l++]=c,a[l++]=u,p=!1),a[l++]=d[0],a[l++]=d[1]):m===fs.INTERSECTING?(a[l++]=d[0],a[l++]=d[1],p=!1):p=!0,c=d[0],u=d[1],f=m;return(n&&p||g===e+r)&&(a[l++]=c,a[l++]=u),l}drawCustomCoordinates_(t,e,i,r,n){for(let o=0,a=i.length;o<a;++o){const l=i[o],h=this.appendFlatLineCoordinates(t,e,l,r,!1,!1);n.push(h),e=l}return e}drawCustom(t,e,i,r,n){this.beginGeometry(t,e,n);const o=t.getType(),a=t.getStride(),l=this.coordinates.length;let h,c,u,d,p;switch(o){case"MultiPolygon":h=t.getOrientedFlatCoordinates(),d=[];const g=t.getEndss();p=0;for(let f=0,m=g.length;f<m;++f){const _=[];p=this.drawCustomCoordinates_(h,p,g[f],a,_),d.push(_)}this.instructions.push([jt.CUSTOM,l,d,t,i,lv,n]),this.hitDetectionInstructions.push([jt.CUSTOM,l,d,t,r||i,lv,n]);break;case"Polygon":case"MultiLineString":u=[],h=o=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),p=this.drawCustomCoordinates_(h,0,t.getEnds(),a,u),this.instructions.push([jt.CUSTOM,l,u,t,i,Bp,n]),this.hitDetectionInstructions.push([jt.CUSTOM,l,u,t,r||i,Bp,n]);break;case"LineString":case"Circle":h=t.getFlatCoordinates(),c=this.appendFlatLineCoordinates(h,0,h.length,a,!1,!1),this.instructions.push([jt.CUSTOM,l,c,t,i,qo,n]),this.hitDetectionInstructions.push([jt.CUSTOM,l,c,t,r||i,qo,n]);break;case"MultiPoint":h=t.getFlatCoordinates(),c=this.appendFlatPointCoordinates(h,a),c>l&&(this.instructions.push([jt.CUSTOM,l,c,t,i,qo,n]),this.hitDetectionInstructions.push([jt.CUSTOM,l,c,t,r||i,qo,n]));break;case"Point":h=t.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),c=this.coordinates.length,this.instructions.push([jt.CUSTOM,l,c,t,i,void 0,n]),this.hitDetectionInstructions.push([jt.CUSTOM,l,c,t,r||i,void 0,n]);break}this.endGeometry(e)}beginGeometry(t,e,i){this.beginGeometryInstruction1_=[jt.BEGIN_GEOMETRY,e,0,t,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[jt.BEGIN_GEOMETRY,e,0,t,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const i=t.length;let r,n,o=-1;for(e=0;e<i;++e)r=t[e],n=r[0],n==jt.END_GEOMETRY?o=e:n==jt.BEGIN_GEOMETRY&&(r[2]=e,q3(this.hitDetectionInstructions,o,e),o=-1)}setFillStrokeStyle(t,e){const i=this.state;if(t){const r=t.getColor();i.fillPatternScale=r&&typeof r=="object"&&"src"in r?this.pixelRatio:1,i.fillStyle=io(r||br)}else i.fillStyle=void 0;if(e){const r=e.getColor();i.strokeStyle=io(r||Wp);const n=e.getLineCap();i.lineCap=n!==void 0?n:Au;const o=e.getLineDash();i.lineDash=o?o.slice():Qo;const a=e.getLineDashOffset();i.lineDashOffset=a||ta;const l=e.getLineJoin();i.lineJoin=l!==void 0?l:Lu;const h=e.getWidth();i.lineWidth=h!==void 0?h:qp;const c=e.getMiterLimit();i.miterLimit=c!==void 0?c:Hp,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){const e=t.fillStyle,i=[jt.SET_FILL_STYLE,e];return typeof e!="string"&&i.push(t.fillPatternScale),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[jt.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;(typeof i!="string"||t.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,r=t.lineCap,n=t.lineDash,o=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=r||n!=t.currentLineDash&&!$h(t.currentLineDash,n)||t.currentLineDashOffset!=o||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=h)&&(i!==void 0&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=r,t.currentLineDash=n,t.currentLineDashOffset=o,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[jt.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=l5(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;ln(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}};const Qg=YV;let ZV=class extends Qg{constructor(t,e,i,r){super(t,e,i,r),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,i){if(!this.image_||this.maxExtent&&!Hr(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,i);const r=t.getFlatCoordinates(),n=t.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(r,n);this.instructions.push([jt.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([jt.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,i){if(!this.image_)return;this.beginGeometry(t,e,i);const r=t.getFlatCoordinates(),n=[];for(let l=0,h=r.length;l<h;l+=t.getStride())(!this.maxExtent||Hr(this.maxExtent,r.slice(l,l+2)))&&n.push(r[l],r[l+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(n,2);this.instructions.push([jt.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([jt.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),r=t.getSize(),n=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=r[1],this.opacity_=t.getOpacity(),this.originX_=n[0],this.originY_=n[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=r[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}};const KV=ZV;let JV=class extends Qg{constructor(t,e,i,r){super(t,e,i,r)}drawFlatCoordinates_(t,e,i,r){const n=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,i,r,!1,!1),a=[jt.MOVE_TO_LINE_TO,n,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),i}drawLineString(t,e,i){const r=this.state,n=r.strokeStyle,o=r.lineWidth;if(n===void 0||o===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([jt.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Qo,ta],ch);const a=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(hl),this.endGeometry(e)}drawMultiLineString(t,e,i){const r=this.state,n=r.strokeStyle,o=r.lineWidth;if(n===void 0||o===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([jt.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Qo,ta],ch);const a=t.getEnds(),l=t.getFlatCoordinates(),h=t.getStride();let c=0;for(let u=0,d=a.length;u<d;++u)c=this.drawFlatCoordinates_(l,c,a[u],h);this.hitDetectionInstructions.push(hl),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(hl),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(hl),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(ch)}};const QV=JV;let t9=class extends Qg{constructor(t,e,i,r){super(t,e,i,r)}drawFlatCoordinatess_(t,e,i,r){const n=this.state,o=n.fillStyle!==void 0,a=n.strokeStyle!==void 0,l=i.length;this.instructions.push(ch),this.hitDetectionInstructions.push(ch);for(let h=0;h<l;++h){const c=i[h],u=this.coordinates.length,d=this.appendFlatLineCoordinates(t,e,c,r,!0,!a),p=[jt.MOVE_TO_LINE_TO,u,d];this.instructions.push(p),this.hitDetectionInstructions.push(p),a&&(this.instructions.push(oT),this.hitDetectionInstructions.push(oT)),e=c}return o&&(this.instructions.push(em),this.hitDetectionInstructions.push(em)),a&&(this.instructions.push(hl),this.hitDetectionInstructions.push(hl)),e}drawCircle(t,e,i){const r=this.state,n=r.fillStyle,o=r.strokeStyle;if(n===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([jt.SET_FILL_STYLE,br]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([jt.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Qo,ta]);const a=t.getFlatCoordinates(),l=t.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const c=[jt.CIRCLE,h];this.instructions.push(ch,c),this.hitDetectionInstructions.push(ch,c),r.fillStyle!==void 0&&(this.instructions.push(em),this.hitDetectionInstructions.push(em)),r.strokeStyle!==void 0&&(this.instructions.push(hl),this.hitDetectionInstructions.push(hl)),this.endGeometry(e)}drawPolygon(t,e,i){const r=this.state,n=r.fillStyle,o=r.strokeStyle;if(n===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([jt.SET_FILL_STYLE,br]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([jt.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Qo,ta]);const a=t.getEnds(),l=t.getOrientedFlatCoordinates(),h=t.getStride();this.drawFlatCoordinatess_(l,0,a,h),this.endGeometry(e)}drawMultiPolygon(t,e,i){const r=this.state,n=r.fillStyle,o=r.strokeStyle;if(n===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([jt.SET_FILL_STYLE,br]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([jt.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Qo,ta]);const a=t.getEndss(),l=t.getOrientedFlatCoordinates(),h=t.getStride();let c=0;for(let u=0,d=a.length;u<d;++u)c=this.drawFlatCoordinatess_(l,c,a[u],h);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let i=0,r=e.length;i<r;++i)e[i]=ih(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}};const aT=t9;function e9(s,t,e,i,r){const n=[];let o=e,a=0,l=t.slice(e,2);for(;a<s&&o+r<i;){const[h,c]=l.slice(-2),u=t[o+r],d=t[o+r+1],p=Math.sqrt((u-h)*(u-h)+(d-c)*(d-c));if(a+=p,a>=s){const g=(s-a+p)/p,f=jr(h,u,g),m=jr(c,d,g);l.push(f,m),n.push(l),l=[f,m],a==s&&(o+=r),a=0}else if(a<s)l.push(t[o+r],t[o+r+1]),o+=r;else{const g=p-a,f=jr(h,u,g/p),m=jr(c,d,g/p);l.push(f,m),n.push(l),l=[f,m],a=0,o+=r}}return a>0&&n.push(l),n}function i9(s,t,e,i,r){let n=e,o=e,a=0,l=0,h=e,c,u,d,p,g,f,m,_,y,v;for(u=e;u<i;u+=r){const b=t[u],E=t[u+1];g!==void 0&&(y=b-g,v=E-f,p=Math.sqrt(y*y+v*v),m!==void 0&&(l+=d,c=Math.acos((m*y+_*v)/(d*p)),c>s&&(l>a&&(a=l,n=h,o=u),l=0,h=u-r)),d=p,m=y,_=v),g=b,f=E}return l+=p,l>a?[h,u]:[n,o]}const f0={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};let s9=class extends Qg{constructor(t,e,i,r){super(t,e,i,r),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[br]={fillStyle:br},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,i){const r=this.textFillState_,n=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!r&&!n)return;const a=this.coordinates;let l=a.length;const h=t.getType();let c=null,u=t.getStride();if(o.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!li(this.maxExtent,t.getExtent()))return;let d;if(c=t.getFlatCoordinates(),h=="LineString")d=[c.length];else if(h=="MultiLineString")d=t.getEnds();else if(h=="Polygon")d=t.getEnds().slice(0,1);else if(h=="MultiPolygon"){const m=t.getEndss();d=[];for(let _=0,y=m.length;_<y;++_)d.push(m[_][0])}this.beginGeometry(t,e,i);const p=o.repeat,g=p?void 0:o.textAlign;let f=0;for(let m=0,_=d.length;m<_;++m){let y;p?y=e9(p*this.resolution,c,f,d[m],u):y=[c.slice(f,d[m])];for(let v=0,b=y.length;v<b;++v){const E=y[v];let S=0,T=E.length;if(g==null){const M=i9(o.maxAngle,E,0,E.length,2);S=M[0],T=M[1]}for(let M=S;M<T;M+=u)a.push(E[M],E[M+1]);const R=a.length;f=d[m],this.drawChars_(l,R),l=R}}this.endGeometry(e)}else{let d=o.overflow?null:[];switch(h){case"Point":case"MultiPoint":c=t.getFlatCoordinates();break;case"LineString":c=t.getFlatMidpoint();break;case"Circle":c=t.getCenter();break;case"MultiLineString":c=t.getFlatMidpoints(),u=2;break;case"Polygon":c=t.getFlatInteriorPoint(),o.overflow||d.push(c[2]/this.resolution),u=3;break;case"MultiPolygon":const y=t.getFlatInteriorPoints();c=[];for(let v=0,b=y.length;v<b;v+=3)o.overflow||d.push(y[v+2]/this.resolution),c.push(y[v],y[v+1]);if(c.length===0)return;u=2;break}const p=this.appendFlatPointCoordinates(c,u);if(p===l)return;if(d&&(p-l)/2!==c.length/u){let y=l/2;d=d.filter((v,b)=>{const E=a[(y+b)*2]===c[b*u]&&a[(y+b)*2+1]===c[b*u+1];return E||--y,E})}this.saveTextStates_(),(o.backgroundFill||o.backgroundStroke)&&(this.setFillStrokeStyle(o.backgroundFill,o.backgroundStroke),o.backgroundFill&&this.updateFillStyle(this.state,this.createFill),o.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e,i);let g=o.padding;if(g!=lh&&(o.scale[0]<0||o.scale[1]<0)){let y=o.padding[0],v=o.padding[1],b=o.padding[2],E=o.padding[3];o.scale[0]<0&&(v=-v,E=-E),o.scale[1]<0&&(y=-y,b=-b),g=[y,v,b,E]}const f=this.pixelRatio;this.instructions.push([jt.DRAW_IMAGE,l,p,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,g==lh?lh:g.map(function(y){return y*f}),!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]);const m=1/f,_=this.state.fillStyle;o.backgroundFill&&(this.state.fillStyle=br,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([jt.DRAW_IMAGE,l,p,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[m,m],NaN,this.declutterMode_,this.declutterImageWithText_,g,!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?br:this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]),o.backgroundFill&&(this.state.fillStyle=_,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,r=this.strokeKey_;t&&(r in this.strokeStates||(this.strokeStates[r]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const n=this.textKey_;n in this.textStates||(this.textStates[n]={font:e.font,textAlign:e.textAlign||Xp,justify:e.justify,textBaseline:e.textBaseline||o0,scale:e.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,r=this.textState_,n=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=f0[r.textBaseline],c=this.textOffsetY_*l,u=this.text_,d=i?i.lineWidth*Math.abs(r.scale[0])/2:0;this.instructions.push([jt.DRAW_CHARS,t,e,h,r.overflow,a,r.maxAngle,l,c,n,d*l,u,o,1,this.declutterMode_]),this.hitDetectionInstructions.push([jt.DRAW_CHARS,t,e,h,r.overflow,a&&br,r.maxAngle,l,c,n,d*l,u,o,1/l,this.declutterMode_])}setTextStyle(t,e){let i,r,n;if(!t)this.text_="";else{const o=t.getFill();o?(r=this.textFillState_,r||(r={},this.textFillState_=r),r.fillStyle=io(o.getColor()||br)):(r=null,this.textFillState_=r);const a=t.getStroke();if(!a)n=null,this.textStrokeState_=n;else{n=this.textStrokeState_,n||(n={},this.textStrokeState_=n);const g=a.getLineDash(),f=a.getLineDashOffset(),m=a.getWidth(),_=a.getMiterLimit();n.lineCap=a.getLineCap()||Au,n.lineDash=g?g.slice():Qo,n.lineDashOffset=f===void 0?ta:f,n.lineJoin=a.getLineJoin()||Lu,n.lineWidth=m===void 0?qp:m,n.miterLimit=_===void 0?Hp:_,n.strokeStyle=io(a.getColor()||Wp)}i=this.textState_;const l=t.getFont()||xL;E4(l);const h=t.getScaleArray();i.overflow=t.getOverflow(),i.font=l,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.repeat=t.getRepeat(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||o0,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||lh,i.scale=h===void 0?[1,1]:h;const c=t.getOffsetX(),u=t.getOffsetY(),d=t.getRotateWithView(),p=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=c===void 0?0:c,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=d===void 0?!1:d,this.textRotation_=p===void 0?0:p,this.strokeKey_=n?(typeof n.strokeStyle=="string"?n.strokeStyle:xt(n.strokeStyle))+n.lineCap+n.lineDashOffset+"|"+n.lineWidth+n.lineJoin+n.miterLimit+"["+n.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=r&&r.fillStyle?typeof r.fillStyle=="string"?r.fillStyle:"|"+xt(r.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}};const r9={Circle:aT,Default:Qg,Image:KV,LineString:QV,Polygon:aT,Text:s9};let n9=class{constructor(t,e,i,r){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=r,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const r in i){const n=i[r].finish();t[e][r]=n}}return t}getBuilder(t,e){const i=t!==void 0?t.toString():"0";let r=this.buildersByZIndex_[i];r===void 0&&(r={},this.buildersByZIndex_[i]=r);let n=r[e];if(n===void 0){const o=r9[e];n=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),r[e]=n}return n}};const MP=n9;let o9=class extends SA{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return Lt()}getData(t){return null}prepareFrame(t){return Lt()}renderFrame(t,e){return Lt()}loadedTileCallback(t,e,i){t[e]||(t[e]={}),t[e][i.tileCoord.toString()]=i}createLoadedTileFinder(t,e,i){return(r,n)=>{const o=this.loadedTileCallback.bind(this,i,r);return t.forEachLoadedTile(e,r,n,o)}}forEachFeatureAtCoordinate(t,e,i,r,n){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===dt.LOADED||e.getState()===dt.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=dt.LOADED&&e!=dt.ERROR&&t.addEventListener(fe.CHANGE,this.boundHandleImageChange_),e==dt.IDLE&&(t.load(),e=t.getState()),e==dt.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}};const IP=o9;let a9=class extends Eo{constructor(t,e,i,r){super(t),this.inversePixelTransform=e,this.frameState=i,this.context=r}};const km=a9;let l9=class{constructor(){Bb(this,"pushMethodArgs_",(...t)=>(this.instructions_[this.zIndex+this.offset_].push(t),this)),this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(CanvasRenderingContext2D.prototype,{get:(t,e)=>{if(typeof xv()[e]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e),this.pushMethodArgs_},set:(t,e,i)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e,i),!0)})}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let i=0,r=e.length;i<r;i+=2){const n=e[i],o=e[i+1];if(typeof t[n]=="function")t[n](...o);else{if(typeof o=="function"){t[n]=o(t);continue}t[n]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}};const Ww=l9,lT=[];let wc=null;function h9(){wc=ui(1,1,void 0,{willReadFrequently:!0})}let c9=class extends IP{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=Ki(),this.pixelTransform=Ki(),this.inversePixelTransform=Ki(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,i){wc||h9(),wc.clearRect(0,0,1,1);let r;try{wc.drawImage(t,e,i,1,1,0,0,1,1),r=wc.getImageData(0,0,1,1).data}catch{return wc=null,null}return r}getBackground(t){let e=this.getLayer().getBackground();return typeof e=="function"&&(e=e(t.viewState.resolution)),e||void 0}useContainer(t,e,i){const r=this.getLayer().getClassName();let n,o;if(t&&t.className===r&&(!i||t&&t.style.backgroundColor&&$h(jn(t.style.backgroundColor),jn(i)))){const a=t.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===e?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){n=document.createElement("div"),n.className=r;let a=n.style;a.position="absolute",a.width="100%",a.height="100%",o=ui();const l=o.canvas;n.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=n,this.context=o}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){const r=va(i),n=H_(i),o=V_(i),a=U_(i);Ii(e.coordinateToPixelTransform,r),Ii(e.coordinateToPixelTransform,n),Ii(e.coordinateToPixelTransform,o),Ii(e.coordinateToPixelTransform,a);const l=this.inversePixelTransform;Ii(l,r),Ii(l,n),Ii(l,o),Ii(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}dispatchRenderEvent_(t,e,i){const r=this.getLayer();if(r.hasListener(t)){const n=new km(t,this.inversePixelTransform,i,e);r.dispatchEvent(n)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(wr.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(wr.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new Ww),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(wr.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(wr.POSTRENDER,this.context,t))}getRenderTransform(t,e,i,r,n,o,a){const l=n/2,h=o/2,c=r/e,u=-c,d=-t[0]+a,p=-t[1];return Xr(this.tempTransform,l,h,c,u,-i,d,p)}disposeInternal(){delete this.frameState,super.disposeInternal()}};const Xw=c9;function u9(s,t,e,i,r,n,o,a,l,h,c,u){let d=s[t],p=s[t+1],g=0,f=0,m=0,_=0;function y(){g=d,f=p,t+=i,d=s[t],p=s[t+1],_+=m,m=Math.sqrt((d-g)*(d-g)+(p-f)*(p-f))}do y();while(t<e-i&&_+m<n);let v=m===0?0:(n-_)/m;const b=jr(g,d,v),E=jr(f,p,v),S=t-i,T=_,R=n+a*l(h,r,c);for(;t<e-i&&_+m<R;)y();v=m===0?0:(R-_)/m;const M=jr(g,d,v),A=jr(f,p,v);let O;if(u){const I=[b,E,M,A];DA(I,0,4,2,u,I,I),O=I[0]>I[2]}else O=b>M;const N=Math.PI,x=[],w=S+i===t;t=S,m=0,_=T,d=s[t],p=s[t+1];let C;if(w){y(),C=Math.atan2(p-f,d-g),O&&(C+=C>0?-N:N);const I=(M+b)/2,L=(A+E)/2;return x[0]=[I,L,(R-n)/2,C,r],x}r=r.replace(/\n/g," ");for(let I=0,L=r.length;I<L;){y();let j=Math.atan2(p-f,d-g);if(O&&(j+=j>0?-N:N),C!==void 0){let k=j-C;if(k+=k>N?-2*N:k<-N?2*N:0,Math.abs(k)>o)return null}C=j;const z=I;let B=0;for(;I<L;++I){const k=O?L-I-1:I,it=a*l(h,r[k],c);if(t+i<e&&_+m<n+B+it/2)break;B+=it}if(I===z)continue;const H=O?r.substring(L-z,L-I):r.substring(z,I);v=m===0?0:(n+B/2-_)/m;const Y=jr(g,d,v),at=jr(f,p,v);x.push([Y,at,B/2,j,H]),n+=B}return x}const rc=Ys(),Ba=[],Fo=[],ko=[],Ua=[];function hT(s){return s[3].declutterBox}const cT=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function D1(s,t){return t==="start"?t=cT.test(s)?"right":"left":t==="end"&&(t=cT.test(s)?"left":"right"),f0[t]}function d9(s,t,e){return e>0&&s.push(`
`,""),s.push(t,""),s}let p9=class{constructor(t,e,i,r,n){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=r.instructions,this.coordinates=r.coordinates,this.coordinateCache_={},this.renderedTransform_=Ki(),this.hitDetectionInstructions=r.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=r.fillStates||{},this.strokeStates=r.strokeStates||{},this.textStates=r.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=n?new Ww:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,i,r){const n=t+e+i+r;if(this.labels_[n])return this.labels_[n];const o=r?this.strokeStates[r]:null,a=i?this.fillStates[i]:null,l=this.textStates[e],h=this.pixelRatio,c=[l.scale[0]*h,l.scale[1]*h],u=Array.isArray(t),d=l.justify?f0[l.justify]:D1(Array.isArray(t)?t[0]:t,l.textAlign||Xp),p=r&&o.lineWidth?o.lineWidth:0,g=u?t:t.split(`
`).reduce(d9,[]),{width:f,height:m,widths:_,heights:y,lineWidths:v}=C4(l,g),b=f+p,E=[],S=(b+2)*c[0],T=(m+p)*c[1],R={width:S<0?Math.floor(S):Math.ceil(S),height:T<0?Math.floor(T):Math.ceil(T),contextInstructions:E};(c[0]!=1||c[1]!=1)&&E.push("scale",c),r&&(E.push("strokeStyle",o.strokeStyle),E.push("lineWidth",p),E.push("lineCap",o.lineCap),E.push("lineJoin",o.lineJoin),E.push("miterLimit",o.miterLimit),E.push("setLineDash",[o.lineDash]),E.push("lineDashOffset",o.lineDashOffset)),i&&E.push("fillStyle",a.fillStyle),E.push("textBaseline","middle"),E.push("textAlign","center");const M=.5-d;let A=d*b+M*p;const O=[],N=[];let x=0,w=0,C=0,I=0,L;for(let j=0,z=g.length;j<z;j+=2){const B=g[j];if(B===`
`){w+=x,x=0,A=d*b+M*p,++I;continue}const H=g[j+1]||l.font;H!==L&&(r&&O.push("font",H),i&&N.push("font",H),L=H),x=Math.max(x,y[C]);const Y=[B,A+M*_[C]+d*(_[C]-v[I]),.5*(p+x)+w];A+=_[C],r&&O.push("strokeText",Y),i&&N.push("fillText",Y),++C}return Array.prototype.push.apply(E,O),Array.prototype.push.apply(E,N),this.labels_[n]=R,R}replayTextBackground_(t,e,i,r,n,o,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,r),t.lineTo.apply(t,n),t.lineTo.apply(t,e),o&&(this.alignAndScaleFill_=o[2],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,r,n,o,a,l,h,c,u,d,p,g,f,m){a*=d[0],l*=d[1];let _=i-a,y=r-l;const v=n+h>t?t-h:n,b=o+c>e?e-c:o,E=g[3]+v*d[0]+g[1],S=g[0]+b*d[1]+g[2],T=_-g[3],R=y-g[0];(f||u!==0)&&(Ba[0]=T,Ua[0]=T,Ba[1]=R,Fo[1]=R,Fo[0]=T+E,ko[0]=Fo[0],ko[1]=R+S,Ua[1]=ko[1]);let M;return u!==0?(M=Xr(Ki(),i,r,1,1,u,-i,-r),Ii(M,Ba),Ii(M,Fo),Ii(M,ko),Ii(M,Ua),$n(Math.min(Ba[0],Fo[0],ko[0],Ua[0]),Math.min(Ba[1],Fo[1],ko[1],Ua[1]),Math.max(Ba[0],Fo[0],ko[0],Ua[0]),Math.max(Ba[1],Fo[1],ko[1],Ua[1]),rc)):$n(Math.min(T,T+E),Math.min(R,R+S),Math.max(T,T+E),Math.max(R,R+S),rc),p&&(_=Math.round(_),y=Math.round(y)),{drawImageX:_,drawImageY:y,drawImageW:v,drawImageH:b,originX:h,originY:c,declutterBox:{minX:rc[0],minY:rc[1],maxX:rc[2],maxY:rc[3],value:m},canvasTransform:M,scale:d}}replayImageOrLabel_(t,e,i,r,n,o,a){const l=!!(o||a),h=r.declutterBox,c=a?a[2]*r.scale[0]/2:0;return h.minX-c<=e[0]&&h.maxX+c>=0&&h.minY-c<=e[1]&&h.maxY+c>=0&&(l&&this.replayTextBackground_(t,Ba,Fo,ko,Ua,o,a),T4(t,r.canvasTransform,n,i,r.originX,r.originY,r.drawImageW,r.drawImageH,r.drawImageX,r.drawImageY,r.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const i=Ii(this.renderedTransform_,[0,0]),r=512*this.pixelRatio;t.save(),t.translate(i[0]%r,i[1]%r),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,r){const n=this.textStates[e],o=this.createLabel(t,e,r,i),a=this.strokeStates[i],l=this.pixelRatio,h=D1(Array.isArray(t)?t[0]:t,n.textAlign||Xp),c=f0[n.textBaseline||o0],u=a&&a.lineWidth?a.lineWidth:0,d=o.width/l-2*n.scale[0],p=h*d+2*(.5-h)*u,g=c*o.height/l+2*(.5-c)*u;return{label:o,anchorX:p,anchorY:g}}execute_(t,e,i,r,n,o,a,l){const h=this.zIndexContext_;let c;this.pixelCoordinates_&&$h(i,this.renderedTransform_)?c=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),c=bl(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),s5(this.renderedTransform_,i));let u=0;const d=r.length;let p=0,g,f,m,_,y,v,b,E,S,T,R,M,A,O=0,N=0,x=null,w=null;const C=this.coordinateCache_,I=this.viewRotation_,L=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,j={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:I},z=this.instructions!=r||this.overlaps?0:200;let B,H,Y,at;for(;u<d;){const k=r[u];switch(k[0]){case jt.BEGIN_GEOMETRY:B=k[1],at=k[3],B.getGeometry()?a!==void 0&&!li(a,at.getExtent())?u=k[2]+1:++u:u=k[2],h&&(h.zIndex=k[4]);break;case jt.BEGIN_PATH:O>z&&(this.fill_(t),O=0),N>z&&(t.stroke(),N=0),!O&&!N&&(t.beginPath(),y=NaN,v=NaN),++u;break;case jt.CIRCLE:p=k[1];const it=c[p],nt=c[p+1],ht=c[p+2],Pt=c[p+3],Ct=ht-it,ft=Pt-nt,me=Math.sqrt(Ct*Ct+ft*ft);t.moveTo(it+me,nt),t.arc(it,nt,me,0,2*Math.PI,!0),++u;break;case jt.CLOSE_PATH:t.closePath(),++u;break;case jt.CUSTOM:p=k[1],g=k[2];const pi=k[3],he=k[4],ts=k[5];j.geometry=pi,j.feature=B,u in C||(C[u]=[]);const ve=C[u];ts?ts(c,p,g,2,ve):(ve[0]=c[p],ve[1]=c[p+1],ve.length=2),h&&(h.zIndex=k[6]),he(ve,j),++u;break;case jt.DRAW_IMAGE:p=k[1],g=k[2],S=k[3],f=k[4],m=k[5];let ns=k[6];const _n=k[7],Mo=k[8],Lr=k[9],yn=k[10];let Je=k[11];const gi=k[12];let bi=k[13];_=k[14]||"declutter";const fi=k[15];if(!S&&k.length>=20){T=k[19],R=k[20],M=k[21],A=k[22];const ni=this.drawLabelWithPointPlacement_(T,R,M,A);S=ni.label,k[3]=S;const ki=k[23];f=(ni.anchorX-ki)*this.pixelRatio,k[4]=f;const ri=k[24];m=(ni.anchorY-ri)*this.pixelRatio,k[5]=m,ns=S.height,k[6]=ns,bi=S.width,k[13]=bi}let Js;k.length>25&&(Js=k[25]);let Qs,os,Ui;k.length>17?(Qs=k[16],os=k[17],Ui=k[18]):(Qs=lh,os=!1,Ui=!1),yn&&L?Je+=I:!yn&&!L&&(Je-=I);let Io=0;for(;p<g;p+=2){if(Js&&Js[Io++]<bi/this.pixelRatio)continue;const ni=this.calculateImageOrLabelDimensions_(S.width,S.height,c[p],c[p+1],bi,ns,f,m,Mo,Lr,Je,gi,n,Qs,os||Ui,B),ki=[t,e,S,ni,_n,os?x:null,Ui?w:null];if(l){let ri,Ci,oi;if(fi){const Bt=g-p;if(!fi[Bt]){fi[Bt]={args:ki,declutterMode:_};continue}const Me=fi[Bt];ri=Me.args,Ci=Me.declutterMode,delete fi[Bt],oi=hT(ri)}let Ni,Vi;if(ri&&(Ci!=="declutter"||!l.collides(oi))&&(Ni=!0),(_!=="declutter"||!l.collides(ni.declutterBox))&&(Vi=!0),Ci==="declutter"&&_==="declutter"){const Bt=Ni&&Vi;Ni=Bt,Vi=Bt}Ni&&(Ci!=="none"&&l.insert(oi),this.replayImageOrLabel_.apply(this,ri)),Vi&&(_!=="none"&&l.insert(ni.declutterBox),this.replayImageOrLabel_.apply(this,ki))}else this.replayImageOrLabel_.apply(this,ki)}++u;break;case jt.DRAW_CHARS:const Re=k[1],zl=k[2],Ao=k[3],Td=k[4];A=k[5];const Rd=k[6],Bl=k[7],Ul=k[8];M=k[9];const Lo=k[10];T=k[11],R=k[12];const Vl=[k[13],k[13]];_=k[14]||"declutter";const Po=this.textStates[R],Pr=Po.font,Or=[Po.scale[0]*Bl,Po.scale[1]*Bl];let Ds;Pr in this.widths_?Ds=this.widths_[Pr]:(Ds={},this.widths_[Pr]=Ds);const Hl=HA(c,Re,zl,2),Da=Math.abs(Or[0])*gC(Pr,T,Ds);if(Td||Da<=Hl){const ni=this.textStates[R].textAlign,ki=(Hl-Da)*D1(T,ni),ri=u9(c,Re,zl,2,T,ki,Rd,Math.abs(Or[0]),gC,Pr,Ds,L?0:this.viewRotation_);t:if(ri){const Ci=[];let oi,Ni,Vi,Bt,Me;if(M)for(oi=0,Ni=ri.length;oi<Ni;++oi){Me=ri[oi],Vi=Me[4],Bt=this.createLabel(Vi,R,"",M),f=Me[2]+(Or[0]<0?-Lo:Lo),m=Ao*Bt.height+(.5-Ao)*2*Lo*Or[1]/Or[0]-Ul;const Di=this.calculateImageOrLabelDimensions_(Bt.width,Bt.height,Me[0],Me[1],Bt.width,Bt.height,f,m,0,0,Me[3],Vl,!1,lh,!1,B);if(l&&_==="declutter"&&l.collides(Di.declutterBox))break t;Ci.push([t,e,Bt,Di,1,null,null])}if(A)for(oi=0,Ni=ri.length;oi<Ni;++oi){Me=ri[oi],Vi=Me[4],Bt=this.createLabel(Vi,R,A,""),f=Me[2],m=Ao*Bt.height-Ul;const Di=this.calculateImageOrLabelDimensions_(Bt.width,Bt.height,Me[0],Me[1],Bt.width,Bt.height,f,m,0,0,Me[3],Vl,!1,lh,!1,B);if(l&&_==="declutter"&&l.collides(Di.declutterBox))break t;Ci.push([t,e,Bt,Di,1,null,null])}l&&_!=="none"&&l.load(Ci.map(hT));for(let Di=0,Md=Ci.length;Di<Md;++Di)this.replayImageOrLabel_.apply(this,Ci[Di])}}++u;break;case jt.END_GEOMETRY:if(o!==void 0){B=k[1];const ni=o(B,at);if(ni)return ni}++u;break;case jt.FILL:z?O++:this.fill_(t),++u;break;case jt.MOVE_TO_LINE_TO:for(p=k[1],g=k[2],H=c[p],Y=c[p+1],b=H+.5|0,E=Y+.5|0,(b!==y||E!==v)&&(t.moveTo(H,Y),y=b,v=E),p+=2;p<g;p+=2)H=c[p],Y=c[p+1],b=H+.5|0,E=Y+.5|0,(p==g-2||b!==y||E!==v)&&(t.lineTo(H,Y),y=b,v=E);++u;break;case jt.SET_FILL_STYLE:x=k,this.alignAndScaleFill_=k[2],O&&(this.fill_(t),O=0,N&&(t.stroke(),N=0)),t.fillStyle=k[1],++u;break;case jt.SET_STROKE_STYLE:w=k,N&&(t.stroke(),N=0),this.setStrokeStyle_(t,k),++u;break;case jt.STROKE:z?N++:t.stroke(),++u;break;default:++u;break}}O&&this.fill_(t),N&&t.stroke()}execute(t,e,i,r,n,o){this.viewRotation_=r,this.execute_(t,e,i,this.instructions,n,void 0,void 0,o)}executeHitDetection(t,e,i,r,n){return this.viewRotation_=i,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,r,n)}};const g9=p9,mp=["Polygon","Circle","LineString","Image","Text","Default"],m0=["Image","Text"],f9=mp.filter(s=>!m0.includes(s));class m9{constructor(t,e,i,r,n,o,a){this.maxExtent_=t,this.overlaps_=r,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Ki(),this.renderedContext_=null,this.deferredZIndexContexts_=[],this.createExecutors_(n,a)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t,e){for(const i in t){let r=this.executorsByZIndex_[i];r===void 0&&(r={},this.executorsByZIndex_[i]=r);const n=t[i];for(const o in n){const a=n[o];r[o]=new g9(this.resolution_,this.pixelRatio_,this.overlaps_,a,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let r=0,n=t.length;r<n;++r)if(t[r]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,r,n,o){r=Math.round(r);const a=r*2+1,l=Xr(this.hitDetectionTransform_,r+.5,r+.5,1/e,-1/e,-i,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=ui(a,a,void 0,{willReadFrequently:!0}));const c=this.hitDetectionContext_;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):h||c.clearRect(0,0,a,a);let u;this.renderBuffer_!==void 0&&(u=Ys(),up(u,t),ln(u,e*(this.renderBuffer_+r),u));const d=_9(r);let p;function g(E,S){const T=c.getImageData(0,0,a,a).data;for(let R=0,M=d.length;R<M;R++)if(T[d[R]]>0){if(!o||p!=="Image"&&p!=="Text"||o.includes(E)){const A=(d[R]-3)/4,O=r-A%a,N=r-(A/a|0),x=n(E,S,O*O+N*N);if(x)return x}c.clearRect(0,0,a,a);break}}const f=Object.keys(this.executorsByZIndex_).map(Number);f.sort(la);let m,_,y,v,b;for(m=f.length-1;m>=0;--m){const E=f[m].toString();for(y=this.executorsByZIndex_[E],_=mp.length-1;_>=0;--_)if(p=mp[_],v=y[p],v!==void 0&&(b=v.executeHitDetection(c,l,i,g,u),b))return b}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],r=e[1],n=e[2],o=e[3],a=[i,r,i,o,n,o,n,r];return bl(a,0,8,2,t,a),a}isEmpty(){return ha(this.executorsByZIndex_)}execute(t,e,i,r,n,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(la),o=o||mp;let h,c,u,d,p,g;for(a&&l.reverse(),h=0,c=l.length;h<c;++h){const f=l[h].toString();for(p=this.executorsByZIndex_[f],u=0,d=o.length;u<d;++u){const m=o[u];if(g=p[m],g!==void 0){const _=a===null?void 0:g.getZIndexContext(),y=_?_.getContext():t,v=this.maxExtent_&&m!=="Image"&&m!=="Text";if(v&&(y.save(),this.clip(y,i)),g.execute(y,e,i,r,n,a),v&&y.restore(),_){_.offset();const b=l[h];this.deferredZIndexContexts_[b]||(this.deferredZIndexContexts_[b]=[]),this.deferredZIndexContexts_[b].push(_)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){this.deferredZIndexContexts_.forEach(t=>{t.forEach(e=>{e.draw(this.renderedContext_),e.clear()})})}}const $1={};function _9(s){if($1[s]!==void 0)return $1[s];const t=s*2+1,e=s*s,i=new Array(e+1);for(let n=0;n<=s;++n)for(let o=0;o<=s;++o){const a=n*n+o*o;if(a>e)break;let l=i[a];l||(l=[],i[a]=l),l.push(((s+n)*t+(s+o))*4+3),n>0&&l.push(((s-n)*t+(s+o))*4+3),o>0&&(l.push(((s+n)*t+(s-o))*4+3),n>0&&l.push(((s-n)*t+(s-o))*4+3))}const r=[];for(let n=0,o=i.length;n<o;++n)i[n]&&r.push(...i[n]);return $1[s]=r,r}const AP=m9;class y9 extends RP{constructor(t,e,i,r,n,o,a){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=r,this.transformRotation_=r?zg(Math.atan2(r[1],r[0]),10):0,this.viewRotation_=n,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Ki()}drawImages_(t,e,i,r){if(!this.image_)return;const n=bl(t,e,i,r,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,u=n.length;c<u;c+=2){const d=n[c]-this.imageAnchorX_,p=n[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const g=d+this.imageAnchorX_,f=p+this.imageAnchorY_;Xr(a,g,f,1,1,h,-g,-f),o.save(),o.transform.apply(o,a),o.translate(g,f),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,p,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(t,e,i,r){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const n=bl(t,e,i,r,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);e<i;e+=r){const l=n[e]+this.textOffsetX_,h=n[e+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(t,e,i,r,n){const o=this.context_,a=bl(t,e,i,r,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;n&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return n&&o.closePath(),i}drawRings_(t,e,i,r){for(let n=0,o=i.length;n<o;++n)e=this.moveToLineTo_(t,e,i[n],r,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!li(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=z5(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],r=e[3]-e[1],n=Math.sqrt(i*i+r*r),o=this.context_;o.beginPath(),o.arc(e[0],e[1],n,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,r=e.length;i<r;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!li(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(li(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,r=t.getFlatCoordinates();let n=0;const o=t.getEnds(),a=t.getStride();i.beginPath();for(let l=0,h=o.length;l<h;++l)n=this.moveToLineTo_(r,n,o[l],a,!1);i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!li(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!li(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let r=0;const n=t.getEndss(),o=t.getStride();e.beginPath();for(let a=0,l=n.length;a<l;++a){const h=n[a];r=this.drawRings_(i,r,h,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),$h(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,r=t.textAlign?t.textAlign:Xp;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=r&&(i.textAlign=r,e.textAlign=r),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=r,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:r,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const i=t.getColor();this.fillState_={fillStyle:io(i||br)}}if(!e)this.strokeState_=null;else{const i=e.getColor(),r=e.getLineCap(),n=e.getLineDash(),o=e.getLineDashOffset(),a=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit(),c=n||Qo;this.strokeState_={lineCap:r!==void 0?r:Au,lineDash:this.pixelRatio_===1?c:c.map(u=>u*this.pixelRatio_),lineDashOffset:(o||ta)*this.pixelRatio_,lineJoin:a!==void 0?a:Lu,lineWidth:(l!==void 0?l:qp)*this.pixelRatio_,miterLimit:h!==void 0?h:Hp,strokeStyle:io(i||Wp)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const i=t.getPixelRatio(this.pixelRatio_),r=t.getAnchor(),n=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*i,this.imageAnchorY_=r[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=n[0],this.imageOriginY_=n[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const p=e.getColor();this.textFillState_={fillStyle:io(p||br)}}const i=t.getStroke();if(!i)this.textStrokeState_=null;else{const p=i.getColor(),g=i.getLineCap(),f=i.getLineDash(),m=i.getLineDashOffset(),_=i.getLineJoin(),y=i.getWidth(),v=i.getMiterLimit();this.textStrokeState_={lineCap:g!==void 0?g:Au,lineDash:f||Qo,lineDashOffset:m||ta,lineJoin:_!==void 0?_:Lu,lineWidth:y!==void 0?y:qp,miterLimit:v!==void 0?v:Hp,strokeStyle:io(p||Wp)}}const r=t.getFont(),n=t.getOffsetX(),o=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),h=t.getScaleArray(),c=t.getText(),u=t.getTextAlign(),d=t.getTextBaseline();this.textState_={font:r!==void 0?r:xL,textAlign:u!==void 0?u:Xp,textBaseline:d!==void 0?d:o0},this.text_=c!==void 0?Array.isArray(c)?c.reduce((p,g,f)=>p+=f%2?" ":g,""):c:"",this.textOffsetX_=n!==void 0?this.pixelRatio_*n:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const LP=y9,zr=.5;function PP(s,t,e,i,r,n,o,a,l){const h=l?W_(r):r,c=s[0]*zr,u=s[1]*zr,d=ui(c,u);d.imageSmoothingEnabled=!1;const p=d.canvas,g=new LP(d,zr,r,null,o,a,l?zh(k5(),l):null),f=e.length,m=Math.floor((256*256*256-1)/f),_={};for(let v=1;v<=f;++v){const b=e[v-1],E=b.getStyleFunction()||i;if(!E)continue;let S=E(b,n);if(!S)continue;Array.isArray(S)||(S=[S]);const T=(v*m).toString(16).padStart(7,"#00000");for(let R=0,M=S.length;R<M;++R){const A=S[R],O=A.getGeometryFunction()(b);if(!O||!li(h,O.getExtent()))continue;const N=A.clone(),x=N.getFill();x&&x.setColor(T);const w=N.getStroke();w&&(w.setColor(T),w.setLineDash(null)),N.setText(void 0);const C=A.getImage();if(C){const z=C.getImageSize();if(!z)continue;const B=ui(z[0],z[1],void 0,{alpha:!1}),H=B.canvas;B.fillStyle=T,B.fillRect(0,0,H.width,H.height),N.setImage(new ty({img:H,anchor:C.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:C.getOrigin(),opacity:1,size:C.getSize(),scale:C.getScale(),rotation:C.getRotation(),rotateWithView:C.getRotateWithView()}))}const I=N.getZIndex()||0;let L=_[I];L||(L={},_[I]=L,L.Polygon=[],L.Circle=[],L.LineString=[],L.Point=[]);const j=O.getType();if(j==="GeometryCollection"){const z=O.getGeometriesArrayRecursive();for(let B=0,H=z.length;B<H;++B){const Y=z[B];L[Y.getType().replace("Multi","")].push(Y,N)}}else L[j.replace("Multi","")].push(O,N)}}const y=Object.keys(_).map(Number).sort(la);for(let v=0,b=y.length;v<b;++v){const E=_[y[v]];for(const S in E){const T=E[S];for(let R=0,M=T.length;R<M;R+=2){g.setStyle(T[R+1]);for(let A=0,O=t.length;A<O;++A)g.setTransform(t[A]),g.drawGeometry(T[R])}}}return d.getImageData(0,0,p.width,p.height)}function OP(s,t,e){const i=[];if(e){const r=Math.floor(Math.round(s[0])*zr),n=Math.floor(Math.round(s[1])*zr),o=(Jt(r,0,e.width-1)+Jt(n,0,e.height-1)*e.width)*4,a=e.data[o],l=e.data[o+1],h=e.data[o+2]+256*(l+256*a),c=Math.floor((256*256*256-1)/t.length);h&&h%c===0&&i.push(t[h/c-1])}return i}const x9=.5,FP={Point:R9,LineString:S9,Polygon:I9,MultiPoint:M9,MultiLineString:C9,MultiPolygon:T9,GeometryCollection:E9,Circle:b9};function v9(s,t){return parseInt(xt(s),10)-parseInt(xt(t),10)}function _0(s,t){const e=kP(s,t);return e*e}function kP(s,t){return x9*s/t}function b9(s,t,e,i){const r=e.getFill(),n=e.getStroke();if(r||n){const a=s.getBuilder(e.getZIndex(),"Circle");a.setFillStrokeStyle(r,n),a.drawCircle(t,i)}const o=e.getText();if(o&&o.getText()){const a=s.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i)}}function y0(s,t,e,i,r,n,o,a){const l=[],h=e.getImage();if(h){let d=!0;const p=h.getImageState();p==dt.LOADED||p==dt.ERROR?d=!1:p==dt.IDLE&&h.load(),d&&l.push(h.ready())}const c=e.getFill();c&&c.loading()&&l.push(c.ready());const u=l.length>0;return u&&Promise.all(l).then(()=>r(null)),w9(s,t,e,i,n,o,a),u}function w9(s,t,e,i,r,n,o){const a=e.getGeometryFunction()(t);if(!a)return;const l=a.simplifyTransformed(i,r);if(e.getRenderer())NP(s,l,e,t,o);else{const h=FP[l.getType()];h(s,l,e,t,o,n)}}function NP(s,t,e,i,r){if(t.getType()=="GeometryCollection"){const n=t.getGeometries();for(let o=0,a=n.length;o<a;++o)NP(s,n[o],e,i,r);return}s.getBuilder(e.getZIndex(),"Default").drawCustom(t,i,e.getRenderer(),e.getHitDetectionRenderer(),r)}function E9(s,t,e,i,r,n){const o=t.getGeometriesArray();let a,l;for(a=0,l=o.length;a<l;++a){const h=FP[o[a].getType()];h(s,o[a],e,i,r,n)}}function S9(s,t,e,i,r){const n=e.getStroke();if(n){const a=s.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,n),a.drawLineString(t,i,r)}const o=e.getText();if(o&&o.getText()){const a=s.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i,r)}}function C9(s,t,e,i,r){const n=e.getStroke();if(n){const a=s.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,n),a.drawMultiLineString(t,i,r)}const o=e.getText();if(o&&o.getText()){const a=s.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i,r)}}function T9(s,t,e,i,r){const n=e.getFill(),o=e.getStroke();if(o||n){const l=s.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(n,o),l.drawMultiPolygon(t,i,r)}const a=e.getText();if(a&&a.getText()){const l=s.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i,r)}}function R9(s,t,e,i,r,n){const o=e.getImage(),a=e.getText(),l=a&&a.getText(),h=n&&o&&l?{}:void 0;if(o){if(o.getImageState()!=dt.LOADED)return;const c=s.getBuilder(e.getZIndex(),"Image");c.setImageStyle(o,h),c.drawPoint(t,i,r)}if(l){const c=s.getBuilder(e.getZIndex(),"Text");c.setTextStyle(a,h),c.drawText(t,i,r)}}function M9(s,t,e,i,r,n){const o=e.getImage(),a=o&&o.getOpacity()!==0,l=e.getText(),h=l&&l.getText(),c=n&&a&&h?{}:void 0;if(a){if(o.getImageState()!=dt.LOADED)return;const u=s.getBuilder(e.getZIndex(),"Image");u.setImageStyle(o,c),u.drawMultiPoint(t,i,r)}if(h){const u=s.getBuilder(e.getZIndex(),"Text");u.setTextStyle(l,c),u.drawText(t,i,r)}}function I9(s,t,e,i,r){const n=e.getFill(),o=e.getStroke();if(n||o){const l=s.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(n,o),l.drawPolygon(t,i,r)}const a=e.getText();if(a&&a.getText()){const l=s.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i,r)}}class A9 extends Xw{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Ys(),this.wrappedRenderedExtent_=Ys(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(t,e,i){const r=e.extent,n=e.viewState,o=n.center,a=n.resolution,l=n.projection,h=n.rotation,c=l.getExtent(),u=this.getLayer().getSource(),d=this.getLayer().getDeclutter(),p=e.pixelRatio,g=e.viewHints,f=!(g[Ei.ANIMATING]||g[Ei.INTERACTING]),m=this.compositionContext_,_=Math.round(e.size[0]*p),y=Math.round(e.size[1]*p),v=u.getWrapX()&&l.canWrapX(),b=v?Kt(c):null,E=v?Math.ceil((r[2]-c[2])/b)+1:1;let S=v?Math.floor((r[0]-c[0])/b):0;do{const T=this.getRenderTransform(o,a,h,p,_,y,S*b);t.execute(m,[m.canvas.width,m.canvas.height],T,h,f,i===void 0?mp:i?m0:f9,i?d&&e.declutter[d]:void 0)}while(++S<E)}setupCompositionContext_(){if(this.opacity_!==1){const t=ui(this.context.canvas.width,this.context.canvas.height,lT);this.compositionContext_=t}else this.compositionContext_=this.context}releaseCompositionContext_(){if(this.opacity_!==1){const t=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=t,Rh(this.compositionContext_),lT.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(t){this.getLayer().getDeclutter()&&(this.setupCompositionContext_(),this.renderWorlds(this.replayGroup_,t,!0),this.releaseCompositionContext_())}renderDeferredInternal(t){this.replayGroup_.renderDeferred()}renderFrame(t,e){const i=t.pixelRatio,r=t.layerStatesArray[t.layerIndex];n5(this.pixelTransform,1/i,1/i),B_(this.inversePixelTransform,this.pixelTransform);const n=Xb(this.pixelTransform);this.useContainer(e,n,this.getBackground(t));const o=this.context,a=o.canvas,l=this.replayGroup_;let h=l&&!l.isEmpty();if(!h&&!(this.getLayer().hasListener(wr.PRERENDER)||this.getLayer().hasListener(wr.POSTRENDER)))return null;const c=Math.round(t.size[0]*i),u=Math.round(t.size[1]*i);a.width!=c||a.height!=u?(a.width=c,a.height=u,a.style.transform!==n&&(a.style.transform=n)):this.containerReused||o.clearRect(0,0,c,u),this.preRender(o,t);const d=t.viewState;d.projection,this.opacity_=r.opacity,this.setupCompositionContext_();let p=!1;if(h&&r.extent&&this.clipping){const g=Ln(r.extent);h=li(g,t.extent),p=h&&!rr(g,t.extent),p&&this.clipUnrotated(this.compositionContext_,t,g)}return h&&this.renderWorlds(l,t,this.getLayer().getDeclutter()?!1:void 0),p&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,t),this.renderedRotation_!==d.rotation&&(this.renderedRotation_=d.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(t){return new Promise(e=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=[this.context.canvas.width,this.context.canvas.height];Ii(this.pixelTransform,i);const r=this.renderedCenter_,n=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],u=i[0]*zr,d=i[1]*zr;c.push(this.getRenderTransform(r,n,o,zr,u,d,0).slice());const p=h.getSource(),g=a.getExtent();if(p.getWrapX()&&a.canWrapX()&&!rr(g,l)){let f=l[0];const m=Kt(g);let _=0,y;for(;f<g[0];)--_,y=m*_,c.push(this.getRenderTransform(r,n,o,zr,u,d,y).slice()),f+=m;for(_=0,f=l[2];f>g[2];)++_,y=m*_,c.push(this.getRenderTransform(r,n,o,zr,u,d,y).slice()),f-=m}this.hitDetectionImageData_=PP(i,c,this.renderedFeatures_,h.getStyleFunction(),l,n,o,_0(n,this.renderedPixelRatio_),null)}e(OP(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,i,r,n){if(!this.replayGroup_)return;const o=e.viewState.resolution,a=e.viewState.rotation,l=this.getLayer(),h={},c=function(g,f,m){const _=xt(g),y=h[_];if(y){if(y!==!0&&m<y.distanceSq){if(m===0)return h[_]=!0,n.splice(n.lastIndexOf(y),1),r(g,l,f);y.geometry=f,y.distanceSq=m}}else{if(m===0)return h[_]=!0,r(g,l,f);n.push(h[_]={feature:g,layer:l,geometry:f,distanceSq:m,callback:r})}};let u;const d=[this.replayGroup_],p=this.getLayer().getDeclutter();return d.some(g=>u=g.forEachFeatureAtCoordinate(t,o,a,i,c,p&&e.declutter[p]?e.declutter[p].all().map(f=>f.value):null)),u}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const r=t.viewHints[Ei.ANIMATING],n=t.viewHints[Ei.INTERACTING],o=e.getUpdateWhileAnimating(),a=e.getUpdateWhileInteracting();if(this.ready&&!o&&r||!a&&n)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=t.extent,h=t.viewState,c=h.projection,u=h.resolution,d=t.pixelRatio,p=e.getRevision(),g=e.getRenderBuffer();let f=e.getRenderOrder();f===void 0&&(f=v9);const m=h.center.slice(),_=ln(l,g*u),y=_.slice(),v=[_.slice()],b=c.getExtent();if(i.getWrapX()&&c.canWrapX()&&!rr(b,t.extent)){const w=Kt(b),C=Math.max(Kt(_)/2,w);_[0]=b[0]-C,_[2]=b[2]+C,OA(m,c);const I=Jb(v[0],c);I[0]<b[0]&&I[2]<b[2]?v.push([I[0]+w,I[1],I[2]+w,I[3]]):I[0]>b[0]&&I[2]>b[2]&&v.push([I[0]-w,I[1],I[2]-w,I[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==p&&this.renderedRenderOrder_==f&&rr(this.wrappedRenderedExtent_,_))return $h(this.renderedExtent_,y)||(this.hitDetectionImageData_=null,this.renderedExtent_=y),this.renderedCenter_=m,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const E=new MP(kP(u,d),_,u,d);let S;for(let w=0,C=v.length;w<C;++w)i.loadFeatures(v[w],u,c);const T=_0(u,d);let R=!0;const M=(w,C)=>{let I;const L=w.getStyleFunction()||e.getStyleFunction();if(L&&(I=L(w,u)),I){const j=this.renderFeature(w,T,I,E,S,this.getLayer().getDeclutter(),C);R=R&&!j}},A=W_(_),O=i.getFeaturesInExtent(A);f&&O.sort(f);for(let w=0,C=O.length;w<C;++w)M(O[w],w);this.renderedFeatures_=O,this.ready=R;const N=E.finish(),x=new AP(_,u,d,i.getOverlaps(),N,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=u,this.renderedRevision_=p,this.renderedRenderOrder_=f,this.renderedExtent_=y,this.wrappedRenderedExtent_=_,this.renderedCenter_=m,this.renderedProjection_=c,this.renderedPixelRatio_=d,this.replayGroup_=x,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,r,n,o,a){if(!i)return!1;let l=!1;if(Array.isArray(i))for(let h=0,c=i.length;h<c;++h)l=y0(r,t,i[h],e,this.boundHandleStyleImageChange_,n,o,a)||l;else l=y0(r,t,i,e,this.boundHandleStyleImageChange_,n,o,a);return l}}const DP=A9;class L9 extends Kg{constructor(t){super(t)}createRenderer(){return new DP(this)}}const qw=L9;class P9{constructor(t){this.rbush_=new Bw(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[xt(e)]=i}load(t,e){const i=new Array(e.length);for(let r=0,n=e.length;r<n;r++){const o=t[r],a=e[r],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};i[r]=l,this.items_[xt(a)]=l}this.rbush_.load(i)}remove(t){const e=xt(t),i=this.items_[e];return delete this.items_[e],this.rbush_.remove(i)!==null}update(t,e){const i=this.items_[xt(e)],r=[i.minX,i.minY,i.maxX,i.maxY];ca(r,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(i){return i.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let r=0,n=t.length;r<n;r++)if(i=e(t[r]),i)return i;return i}isEmpty(){return ha(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return $n(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}const uT=P9;class O9 extends jh{constructor(t){super(),this.projection=ct(t.projection),this.attributions_=dT(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(i,r){e.viewResolver=i,e.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=dT(t),this.changed()}setState(t){this.state_=t,this.changed()}}function dT(s){return s?Array.isArray(s)?function(t){return s}:typeof s=="function"?s:function(t){return[s]}:null}const ud=O9,er={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function F9(s,t){return[[-1/0,-1/0,1/0,1/0]]}let k9=!1;function $P(s,t,e,i,r,n,o){const a=new XMLHttpRequest;a.open("GET",typeof s=="function"?s(e,i,r):s,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=k9,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=t.getType();let c;h=="json"?c=JSON.parse(a.responseText):h=="text"?c=a.responseText:h=="xml"?(c=a.responseXML,c||(c=new DOMParser().parseFromString(a.responseText,"application/xml"))):h=="arraybuffer"&&(c=a.response),c?n(t.readFeatures(c,{extent:e,featureProjection:r}),t.readProjection(c)):o()}else o()},a.onerror=o,a.send()}function pT(s,t){return function(e,i,r,n,o){const a=this;$P(s,t,e,i,r,function(l,h){a.addFeatures(l),n!==void 0&&n(l)},o||$p)}}let Va=class extends Eo{constructor(t,e,i){super(t),this.feature=e,this.features=i}};class N9 extends ud{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=$p,this.format_=t.format,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(ge(this.format_,"`format` must be set when `url` is set"),this.loader_=pT(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:F9;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new uT:null,this.loadedExtentsRtree_=new uT,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,r;Array.isArray(t.features)?r=t.features:t.features&&(i=t.features,r=i.getArray()),!e&&i===void 0&&(i=new d0(r)),r!==void 0&&this.addFeaturesInternal(r),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=xt(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const r=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(r,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Va(er.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof Cn||(this.featureChangeKeys_[t]=[Ai(e,fe.CHANGE,this.handleFeatureChange_,this),Ai(e,Ub.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let i=!0;if(e.getId()!==void 0){const r=String(e.getId());if(!(r in this.idIndex_))this.idIndex_[r]=e;else if(e instanceof Cn){const n=this.idIndex_[r];n instanceof Cn?Array.isArray(n)?n.push(e):this.idIndex_[r]=[n,e]:i=!1}else i=!1}return i&&(ge(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],r=[];for(let n=0,o=t.length;n<o;n++){const a=t[n],l=xt(a);this.addToIndex_(l,a)&&i.push(a)}for(let n=0,o=i.length;n<o;n++){const a=i[n],l=xt(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const c=h.getExtent();e.push(c),r.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(e,r),this.hasListener(er.ADDFEATURE))for(let n=0,o=i.length;n<o;n++)this.dispatchEvent(new Va(er.ADDFEATURE,i[n]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(er.ADDFEATURE,function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener(er.REMOVEFEATURE,function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener(al.ADD,i=>{e||(e=!0,this.addFeature(i.element),e=!1)}),t.addEventListener(al.REMOVE,i=>{e||(e=!0,this.removeFeature(i.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(cs);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const i=r=>{this.removeFeatureInternal(r)};this.featuresRtree_.forEach(i);for(const r in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[r])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new Va(er.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const i=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(i,function(r){const n=r.getGeometry();if(n instanceof Cn||n.intersectsCoordinate(t))return e(r)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(i){const r=i.getGeometry();if(r instanceof Cn||r.intersectsExtent(t)){const n=e(i);if(n)return n}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),ha(this.nullGeometryFeatures_)||Se(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(i){e.push(i)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const i=g5(t,e);return[].concat(...i.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],r=t[1];let n=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return e=e||Z3,this.featuresRtree_.forEachInExtent(l,function(h){if(e(h)){const c=h.getGeometry(),u=a;if(a=c instanceof Cn?0:c.closestPointXY(i,r,o,a),a<u){n=h;const d=Math.sqrt(a);l[0]=i-d,l[1]=r-d,l[2]=i+d,l[3]=r+d}}}),n}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=xt(e),r=e.getGeometry();if(!r)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);else{const o=r.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(o,e)):this.featuresRtree_&&this.featuresRtree_.update(o,e)}const n=e.getId();if(n!==void 0){const o=n.toString();this.idIndex_[o]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[o]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new Va(er.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:xt(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&ha(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,i){const r=this.loadedExtentsRtree_,n=this.strategy_(t,e,i);for(let o=0,a=n.length;o<a;++o){const l=n[o];r.forEachInExtent(l,function(h){return rr(h.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Va(er.FEATURESLOADSTART)),this.loader_.call(this,l,e,i,h=>{--this.loadingExtentsCount_,this.dispatchEvent(new Va(er.FEATURESLOADEND,void 0,h))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Va(er.FEATURESLOADERROR))}),r.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let i;e.forEachInExtent(t,function(r){if(ca(r.extent,t))return i=r,!0}),i&&e.remove(i)}removeFeature(t){if(!t)return;const e=xt(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=xt(t),i=this.featureChangeKeys_[e];if(!i)return;i.forEach(cs),delete this.featureChangeKeys_[e];const r=t.getId();return r!==void 0&&delete this.idIndex_[r.toString()],delete this.uidIndex_[e],this.dispatchEvent(new Va(er.REMOVEFEATURE,t)),t}removeFromIdIndex_(t){let e=!1;for(const i in this.idIndex_){const r=this.idIndex_[i];if(t instanceof Cn&&Array.isArray(r)&&r.includes(t))r.splice(r.indexOf(t),1);else if(this.idIndex_[i]===t){delete this.idIndex_[i],e=!0;break}}return e}setLoader(t){this.loader_=t}setUrl(t){ge(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(pT(t,this.format_))}}const hy=N9;function D9(s){if(!(s.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const t=s.inversePixelTransform[0],e=s.inversePixelTransform[1],i=Math.sqrt(t*t+e*e),r=s.frameState,n=id(s.inversePixelTransform.slice(),r.coordinateToPixelTransform),o=_0(r.viewState.resolution,i);let a;return new LP(s.context,i,r.extent,n,r.viewState.rotation,o,a)}function jP(s,t,e){const i=[];let r=s(0),n=s(1),o=t(r),a=t(n);const l=[n,r],h=[a,o],c=[1,0],u={};let d=1e5,p,g,f,m,_,y;for(;--d>0&&c.length>0;)f=c.pop(),r=l.pop(),o=h.pop(),y=f.toString(),y in u||(i.push(o[0],o[1]),u[y]=!0),m=c.pop(),n=l.pop(),a=h.pop(),_=(f+m)/2,p=s(_),g=t(p),LA(g[0],g[1],o[0],o[1],a[0],a[1])<e?(i.push(a[0],a[1]),y=m.toString(),u[y]=!0):(c.push(m,_,_,f),h.push(a,g,g,o),l.push(n,p,p,r));return i}function $9(s,t,e,i,r){const n=ct("EPSG:4326");return jP(function(o){return[s,t+(e-t)*o]},go(n,i),r)}function j9(s,t,e,i,r){const n=ct("EPSG:4326");return jP(function(o){return[t+(e-t)*o,s]},go(n,i),r)}const G9=new fo({color:"rgba(0,0,0,0.2)"}),z9=[90,45,30,20,10,5,2,1,30/60,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600];class B9 extends qw{constructor(t){t=t||{};const e=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},t);delete e.maxLines,delete e.strokeStyle,delete e.targetSize,delete e.showLabels,delete e.lonLabelFormatter,delete e.latLabelFormatter,delete e.lonLabelPosition,delete e.latLabelPosition,delete e.lonLabelStyle,delete e.latLabelStyle,delete e.intervals,super(e),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=t.targetSize!==void 0?t.targetSize:100,this.maxLines_=t.maxLines!==void 0?t.maxLines:100,this.meridians_=[],this.parallels_=[],this.strokeStyle_=t.strokeStyle!==void 0?t.strokeStyle:G9,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,t.showLabels&&(this.lonLabelFormatter_=t.lonLabelFormatter==null?K2.bind(this,"EW"):t.lonLabelFormatter,this.latLabelFormatter_=t.latLabelFormatter==null?K2.bind(this,"NS"):t.latLabelFormatter,this.lonLabelPosition_=t.lonLabelPosition==null?0:t.lonLabelPosition,this.latLabelPosition_=t.latLabelPosition==null?1:t.latLabelPosition,this.lonLabelStyleBase_=new lr({text:t.lonLabelStyle!==void 0?t.lonLabelStyle.clone():new Yp({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new da({color:"rgba(0,0,0,1)"}),stroke:new fo({color:"rgba(255,255,255,1)",width:3})})}),this.lonLabelStyle_=i=>{const r=i.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(r),this.lonLabelStyleBase_},this.latLabelStyleBase_=new lr({text:t.latLabelStyle!==void 0?t.latLabelStyle.clone():new Yp({font:"12px Calibri,sans-serif",textAlign:"right",fill:new da({color:"rgba(0,0,0,1)"}),stroke:new fo({color:"rgba(255,255,255,1)",width:3})})}),this.latLabelStyle_=i=>{const r=i.get("graticule_label");return this.latLabelStyleBase_.getText().setText(r),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(wr.POSTRENDER,this.drawLabels_.bind(this))),this.intervals_=t.intervals!==void 0?t.intervals:z9,this.setSource(new hy({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new d0,overlaps:!1,useSpatialIndex:!1,wrapX:t.wrapX})),this.featurePool_=[],this.lineStyle_=new lr({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(t,e){let i=t.slice();return this.projection_&&this.getSource().getWrapX()&&Jb(i,this.projection_),this.loadedExtent_&&(h5(this.loadedExtent_,i,e)?i=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[i]}loaderFunction(t,e,i){this.loadedExtent_=t;const r=this.getSource(),n=this.getExtent()||[-1/0,-1/0,1/0,1/0],o=us(n,t);if(this.renderedExtent_&&ca(this.renderedExtent_,o)&&this.renderedResolution_===e||(this.renderedExtent_=o,this.renderedResolution_=e,ba(o)))return;const a=vs(o),l=e*e/4;(!this.projection_||!Rs(this.projection_,i))&&this.updateProjectionInfo_(i),this.createGraticule_(o,a,e,l);let h=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(h+=this.meridians_.length),this.parallelsLabels_&&(h+=this.parallels_.length);let c;for(;h>this.featurePool_.length;)c=new Ls,this.featurePool_.push(c);const u=r.getFeaturesCollection();u.clear();let d=0,p,g;for(p=0,g=this.meridians_.length;p<g;++p)c=this.featurePool_[d++],c.setGeometry(this.meridians_[p]),c.setStyle(this.lineStyle_),u.push(c);for(p=0,g=this.parallels_.length;p<g;++p)c=this.featurePool_[d++],c.setGeometry(this.parallels_[p]),c.setStyle(this.lineStyle_),u.push(c)}addMeridian_(t,e,i,r,n,o){const a=this.getMeridian_(t,e,i,r,o);if(li(a.getExtent(),n)){if(this.meridiansLabels_){const l=this.lonLabelFormatter_(t);o in this.meridiansLabels_?this.meridiansLabels_[o].text=l:this.meridiansLabels_[o]={geom:new xs([]),text:l}}this.meridians_[o++]=a}return o}addParallel_(t,e,i,r,n,o){const a=this.getParallel_(t,e,i,r,o);if(li(a.getExtent(),n)){if(this.parallelsLabels_){const l=this.latLabelFormatter_(t);o in this.parallelsLabels_?this.parallelsLabels_[o].text=l:this.parallelsLabels_[o]={geom:new xs([]),text:l}}this.parallels_[o++]=a}return o}drawLabels_(t){const e=t.frameState.viewState.rotation,i=t.frameState.viewState.resolution,r=t.frameState.size,n=t.frameState.extent,o=vs(n);let a=n;if(e){const g=r[0]*i,f=r[1]*i;a=[o[0]-g/2,o[1]-f/2,o[0]+g/2,o[1]+f/2]}let l=0,h=0,c=this.latLabelPosition_<.5;const u=this.projection_.getExtent(),d=Kt(u);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!rr(u,n)){l=Math.floor((n[0]-u[0])/d),h=Math.ceil((n[2]-u[2])/d);const g=Math.abs(e)>Math.PI/2;c=c!==g}const p=D9(t);for(let g=l;g<=h;++g){let f=this.meridians_.length+this.parallels_.length,m,_,y,v;if(this.meridiansLabels_)for(_=0,y=this.meridiansLabels_.length;_<y;++_){const b=this.meridians_[_];if(!e&&g===0)v=this.getMeridianPoint_(b,n,_);else{const E=b.clone();E.translate(g*d,0),E.rotate(-e,o),v=this.getMeridianPoint_(E,a,_),v.rotate(e,o)}m=this.featurePool_[f++],m.setGeometry(v),m.set("graticule_label",this.meridiansLabels_[_].text),p.drawFeature(m,this.lonLabelStyle_(m))}if(this.parallelsLabels_&&(g===l&&c||g===h&&!c))for(_=0,y=this.parallels_.length;_<y;++_){const b=this.parallels_[_];if(!e&&g===0)v=this.getParallelPoint_(b,n,_);else{const E=b.clone();E.translate(g*d,0),E.rotate(-e,o),v=this.getParallelPoint_(E,a,_),v.rotate(e,o)}m=this.featurePool_[f++],m.setGeometry(v),m.set("graticule_label",this.parallelsLabels_[_].text),p.drawFeature(m,this.latLabelStyle_(m))}}}createGraticule_(t,e,i,r){const n=this.getInterval_(i);if(n==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}let o=!1;const a=this.projection_.getExtent(),l=Kt(a);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!rr(a,t)&&(Kt(t)>=l?(t[0]=a[0],t[2]=a[2]):o=!0);const h=[Jt(e[0],this.minX_,this.maxX_),Jt(e[1],this.minY_,this.maxY_)],c=this.toLonLatTransform_(h);isNaN(c[1])&&(c[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let u=Jt(c[0],this.minLon_,this.maxLon_),d=Jt(c[1],this.minLat_,this.maxLat_);const p=this.maxLines_;let g,f,m,_,y=t;o||(y=[Jt(t[0],this.minX_,this.maxX_),Jt(t[1],this.minY_,this.maxY_),Jt(t[2],this.minX_,this.maxX_),Jt(t[3],this.minY_,this.maxY_)]);const v=Tu(y,this.toLonLatTransform_,void 0,8);let b=v[3],E=v[2],S=v[1],T=v[0];if(o||(Hr(y,this.bottomLeft_)&&(T=this.minLon_,S=this.minLat_),Hr(y,this.bottomRight_)&&(E=this.maxLon_,S=this.minLat_),Hr(y,this.topLeft_)&&(T=this.minLon_,b=this.maxLat_),Hr(y,this.topRight_)&&(E=this.maxLon_,b=this.maxLat_),b=Jt(b,d,this.maxLat_),E=Jt(E,u,this.maxLon_),S=Jt(S,this.minLat_,d),T=Jt(T,this.minLon_,u)),u=Math.floor(u/n)*n,_=Jt(u,this.minLon_,this.maxLon_),f=this.addMeridian_(_,S,b,r,t,0),g=0,o)for(;(_-=n)>=T&&g++<p;)f=this.addMeridian_(_,S,b,r,t,f);else for(;_!=this.minLon_&&g++<p;)_=Math.max(_-n,this.minLon_),f=this.addMeridian_(_,S,b,r,t,f);if(_=Jt(u,this.minLon_,this.maxLon_),g=0,o)for(;(_+=n)<=E&&g++<p;)f=this.addMeridian_(_,S,b,r,t,f);else for(;_!=this.maxLon_&&g++<p;)_=Math.min(_+n,this.maxLon_),f=this.addMeridian_(_,S,b,r,t,f);for(this.meridians_.length=f,this.meridiansLabels_&&(this.meridiansLabels_.length=f),d=Math.floor(d/n)*n,m=Jt(d,this.minLat_,this.maxLat_),f=this.addParallel_(m,T,E,r,t,0),g=0;m!=this.minLat_&&g++<p;)m=Math.max(m-n,this.minLat_),f=this.addParallel_(m,T,E,r,t,f);for(m=Jt(d,this.minLat_,this.maxLat_),g=0;m!=this.maxLat_&&g++<p;)m=Math.min(m+n,this.maxLat_),f=this.addParallel_(m,T,E,r,t,f);this.parallels_.length=f,this.parallelsLabels_&&(this.parallelsLabels_.length=f)}getInterval_(t){const e=this.projectionCenterLonLat_[0],i=this.projectionCenterLonLat_[1];let r=-1;const n=Math.pow(this.targetSize_*t,2),o=[],a=[];for(let l=0,h=this.intervals_.length;l<h;++l){const c=Jt(this.intervals_[l]/2,0,90),u=Jt(i,-90+c,90-c);if(o[0]=e-c,o[1]=u-c,a[0]=e+c,a[1]=u+c,this.fromLonLatTransform_(o,o),this.fromLonLatTransform_(a,a),Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2)<=n)break;r=this.intervals_[l]}return r}getMeridian_(t,e,i,r,n){const o=$9(t,e,i,this.projection_,r);let a=this.meridians_[n];return a?(a.setFlatCoordinates("XY",o),a.changed()):(a=new Ps(o,"XY"),this.meridians_[n]=a),a}getMeridianPoint_(t,e,i){const r=t.getFlatCoordinates();let n=1,o=r.length-1;r[n]>r[o]&&(n=o,o=1);const a=Math.max(e[1],r[n]),l=Math.min(e[3],r[o]),h=Jt(e[1]+Math.abs(e[1]-e[3])*this.lonLabelPosition_,a,l),c=[r[n-1]+(r[o-1]-r[n-1])*(h-r[n])/(r[o]-r[n]),h],u=this.meridiansLabels_[i].geom;return u.setCoordinates(c),u}getMeridians(){return this.meridians_}getParallel_(t,e,i,r,n){const o=j9(t,e,i,this.projection_,r);let a=this.parallels_[n];return a?(a.setFlatCoordinates("XY",o),a.changed()):a=new Ps(o,"XY"),a}getParallelPoint_(t,e,i){const r=t.getFlatCoordinates();let n=0,o=r.length-2;r[n]>r[o]&&(n=o,o=0);const a=Math.max(e[0],r[n]),l=Math.min(e[2],r[o]),h=Jt(e[0]+Math.abs(e[0]-e[2])*this.latLabelPosition_,a,l),c=r[n+1]+(r[o+1]-r[n+1])*(h-r[n])/(r[o]-r[n]),u=[h,c],d=this.parallelsLabels_[i].geom;return d.setCoordinates(u),d}getParallels(){return this.parallels_}updateProjectionInfo_(t){const e=ct("EPSG:4326"),i=t.getWorldExtent();this.maxLat_=i[3],this.maxLon_=i[2],this.minLat_=i[1],this.minLon_=i[0];const r=go(t,e);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=r;else{const o=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(a,l,h){h=h||2;const c=r(a,l,h);for(let u=0,d=c.length;u<d;u+=h)c[u]<o&&(c[u]+=360);return c}}this.fromLonLatTransform_=go(e,t);const n=Tu([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=n[0],this.maxX_=n[2],this.minY_=n[1],this.maxY_=n[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(vs(t.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=t}}const U9=B9;let nc=class extends Eo{constructor(t,e){super(t),this.layer=e}};const j1={LAYERS:"layers"};class Yw extends mP{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let i=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(j1.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new d0(i.slice(),{unique:!0}):ge(typeof i.getArray=="function","Expected `layers` to be an array or a `Collection`"):i=new d0(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(cs),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(Ai(t,al.ADD,this.handleLayersAdd_,this),Ai(t,al.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(cs);ed(this.listenerKeys_);const e=t.getArray();for(let i=0,r=e.length;i<r;i++){const n=e[i];this.registerLayerListeners_(n),this.dispatchEvent(new nc("addlayer",n))}this.changed()}registerLayerListeners_(t){const e=[Ai(t,Ub.PROPERTYCHANGE,this.handleLayerChange_,this),Ai(t,fe.CHANGE,this.handleLayerChange_,this)];t instanceof Yw&&e.push(Ai(t,"addlayer",this.handleLayerGroupAdd_,this),Ai(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[xt(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new nc("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new nc("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new nc("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,i=xt(e);this.listenerKeys_[i].forEach(cs),delete this.listenerKeys_[i],this.dispatchEvent(new nc("removelayer",e)),this.changed()}getLayers(){return this.get(j1.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const i=e.getArray();for(let r=0,n=i.length;r<n;++r)this.dispatchEvent(new nc("removelayer",i[r]))}this.set(j1.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],i=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});const r=this.getLayerState();let n=r.zIndex;!t&&r.zIndex===void 0&&(n=0);for(let o=i,a=e.length;o<a;o++){const l=e[o];l.opacity*=r.opacity,l.visible=l.visible&&r.visible,l.maxResolution=Math.min(l.maxResolution,r.maxResolution),l.minResolution=Math.max(l.minResolution,r.minResolution),l.minZoom=Math.max(l.minZoom,r.minZoom),l.maxZoom=Math.min(l.maxZoom,r.maxZoom),r.extent!==void 0&&(l.extent!==void 0?l.extent=us(l.extent,r.extent):l.extent=r.extent),l.zIndex===void 0&&(l.zIndex=n)}return e}getSourceState(){return"ready"}}const GP=Yw,cy=34962,uy=34963,V9=35040,Zw=35044,Pv=35048,H9=5121,W9=5123,X9=5125,zP=5126,gT=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function q9(s,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!c4},t);const e=gT.length;for(let i=0;i<e;++i)try{const r=s.getContext(gT[i],t);if(r)return r}catch{}return null}const Y9={STATIC_DRAW:Zw,STREAM_DRAW:V9,DYNAMIC_DRAW:Pv};class Z9{constructor(t,e){this.array_=null,this.type_=t,ge(t===cy||t===uy,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=e!==void 0?e:Y9.STATIC_DRAW}ofSize(t){return this.array_=new(G1(this.type_))(t),this}fromArray(t){return this.array_=G1(this.type_).from(t),this}fromArrayBuffer(t){return this.array_=new(G1(this.type_))(t),this}getType(){return this.type_}getArray(){return this.array_}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function G1(s){switch(s){case cy:return Float32Array;case uy:return Uint32Array;default:return Float32Array}}const x0=Z9,im={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},K9=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,J9=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class Q9{constructor(t){this.gl_=t.webGlContext;const e=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=e.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=e.createFramebuffer(),this.depthBuffer_=e.createRenderbuffer();const i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,t.vertexShader||K9),e.compileShader(i);const r=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(r,t.fragmentShader||J9),e.compileShader(r),this.renderTargetProgram_=e.createProgram(),e.attachShader(this.renderTargetProgram_,i),e.attachShader(this.renderTargetProgram_,r),e.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=e.createBuffer();const n=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];e.bindBuffer(e.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW),this.renderTargetAttribLocation_=e.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(o=>{this.uniforms_.push({value:t.uniforms[o],location:e.getUniformLocation(this.renderTargetProgram_,o)})})}getGL(){return this.gl_}init(t){const e=this.getGL(),i=[e.drawingBufferWidth*this.scaleRatio_,e.drawingBufferHeight*this.scaleRatio_];if(e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer()),e.bindRenderbuffer(e.RENDERBUFFER,this.getDepthBuffer()),e.viewport(0,0,i[0],i[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==i[0]||this.renderTargetTextureSize_[1]!==i[1]){this.renderTargetTextureSize_=i;const r=0,n=e.RGBA,o=0,a=e.RGBA,l=e.UNSIGNED_BYTE,h=null;e.bindTexture(e.TEXTURE_2D,this.renderTargetTexture_),e.texImage2D(e.TEXTURE_2D,r,n,i[0],i[1],o,a,l,h),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.renderTargetTexture_,0),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,i[0],i[1]),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthBuffer_)}}apply(t,e,i,r){const n=this.getGL(),o=t.size;if(n.bindFramebuffer(n.FRAMEBUFFER,e?e.getFrameBuffer():null),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.renderTargetTexture_),!e){const l=xt(n.canvas);if(!t.renderTargets[l]){const h=n.getContextAttributes();h&&h.preserveDrawingBuffer&&(n.clearColor(0,0,0,0),n.clearDepth(1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT)),t.renderTargets[l]=!0}}n.disable(n.DEPTH_TEST),n.enable(n.BLEND),n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),n.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),n.bindBuffer(n.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),n.useProgram(this.renderTargetProgram_),n.enableVertexAttribArray(this.renderTargetAttribLocation_),n.vertexAttribPointer(this.renderTargetAttribLocation_,2,n.FLOAT,!1,0,0),n.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),n.uniform1i(this.renderTargetTextureLocation_,0);const a=t.layerStatesArray[t.layerIndex].opacity;n.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(t),i&&i(n,t),n.drawArrays(n.TRIANGLES,0,6),r&&r(n,t)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(t){const e=this.getGL();let i,r=1;this.uniforms_.forEach(function(n){if(i=typeof n.value=="function"?n.value(t):n.value,i instanceof HTMLCanvasElement||i instanceof ImageData)n.texture||(n.texture=e.createTexture()),e.activeTexture(e[`TEXTURE${r}`]),e.bindTexture(e.TEXTURE_2D,n.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),i instanceof ImageData?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,i.width,i.height,0,e.UNSIGNED_BYTE,new Uint8Array(i.data)):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i),e.uniform1i(n.location,r++);else if(Array.isArray(i))switch(i.length){case 2:e.uniform2f(n.location,i[0],i[1]);return;case 3:e.uniform3f(n.location,i[0],i[1],i[2]);return;case 4:e.uniform4f(n.location,i[0],i[1],i[2],i[3]);return;default:return}else typeof i=="number"&&e.uniform1f(n.location,i)})}}const fT=Q9;function BP(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function UP(s,t){return s[0]=t[0],s[1]=t[1],s[4]=t[2],s[5]=t[3],s[12]=t[4],s[13]=t[5],s}const Go={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},Qn={UNSIGNED_BYTE:H9,UNSIGNED_SHORT:W9,UNSIGNED_INT:X9,FLOAT:zP},v0={};function mT(s){return"shared/"+s}let _T=0;function tH(){const s="unique/"+_T;return _T+=1,s}function eH(s){let t=v0[s];if(!t){const e=document.createElement("canvas");e.width=1,e.height=1,e.style.position="absolute",e.style.left="0",t={users:0,context:q9(e)},v0[s]=t}return t.users+=1,t.context}function iH(s){const t=v0[s];if(!t||(t.users-=1,t.users>0))return;const e=t.context,i=e.getExtension("WEBGL_lose_context");i&&i.loseContext();const r=e.canvas;r.width=1,r.height=1,delete v0[s]}class sH extends Vb{constructor(t){super(),t=t||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=t.canvasCacheKey?mT(t.canvasCacheKey):tH(),this.gl_=eH(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const e=this.gl_.canvas;e.addEventListener(im.LOST,this.boundHandleWebGLContextLost_),e.addEventListener(im.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=Ki(),this.offsetScaleMatrix_=Ki(),this.tmpMat4_=BP(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],t.uniforms&&this.setUniforms(t.uniforms),this.postProcessPasses_=t.postProcesses?t.postProcesses.map(i=>new fT({webGlContext:this.gl_,scaleRatio:i.scaleRatio,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,uniforms:i.uniforms})):[new fT({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(t){this.uniforms_=[],this.addUniforms(t)}addUniforms(t){for(const e in t)this.uniforms_.push({name:e,value:t[e]})}canvasCacheKeyMatches(t){return this.canvasCacheKey_===mT(t)}getExtension(t){if(t in this.extensionCache_)return this.extensionCache_[t];const e=this.gl_.getExtension(t);return this.extensionCache_[t]=e,e}bindBuffer(t){const e=this.gl_,i=xt(t);let r=this.bufferCache_[i];if(!r){const n=e.createBuffer();r={buffer:t,webGlBuffer:n},this.bufferCache_[i]=r}e.bindBuffer(t.getType(),r.webGlBuffer)}flushBufferData(t){const e=this.gl_;this.bindBuffer(t),e.bufferData(t.getType(),t.getArray(),t.getUsage())}deleteBuffer(t){const e=this.gl_,i=xt(t),r=this.bufferCache_[i];r&&!e.isContextLost()&&e.deleteBuffer(r.webGlBuffer),delete this.bufferCache_[i]}disposeInternal(){const t=this.gl_.canvas;t.removeEventListener(im.LOST,this.boundHandleWebGLContextLost_),t.removeEventListener(im.RESTORED,this.boundHandleWebGLContextRestored_),iH(this.canvasCacheKey_),delete this.gl_}prepareDraw(t,e,i){const r=this.gl_,n=this.getCanvas(),o=t.size,a=t.pixelRatio;(n.width!==o[0]*a||n.height!==o[1]*a)&&(n.width=o[0]*a,n.height=o[1]*a,n.style.width=o[0]+"px",n.style.height=o[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(t);r.bindTexture(r.TEXTURE_2D,null),r.clearColor(0,0,0,0),r.depthRange(0,1),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,e?r.ZERO:r.ONE_MINUS_SRC_ALPHA),i?(r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL)):r.disable(r.DEPTH_TEST)}bindTexture(t,e,i){const r=this.gl_;r.activeTexture(r.TEXTURE0+e),r.bindTexture(r.TEXTURE_2D,t),r.uniform1i(this.getUniformLocation(i),e)}prepareDrawToRenderTarget(t,e,i,r){const n=this.gl_,o=e.getSize();n.bindFramebuffer(n.FRAMEBUFFER,e.getFramebuffer()),n.bindRenderbuffer(n.RENDERBUFFER,e.getDepthbuffer()),n.viewport(0,0,o[0],o[1]),n.bindTexture(n.TEXTURE_2D,e.getTexture()),n.clearColor(0,0,0,0),n.depthRange(0,1),n.clearDepth(1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,i?n.ZERO:n.ONE_MINUS_SRC_ALPHA),r?(n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL)):n.disable(n.DEPTH_TEST)}drawElements(t,e){const i=this.gl_;this.getExtension("OES_element_index_uint");const r=i.UNSIGNED_INT,n=4,o=e-t,a=t*n;i.drawElements(i.TRIANGLES,o,r,a)}finalizeDraw(t,e,i){for(let r=0,n=this.postProcessPasses_.length;r<n;r++)r===n-1?this.postProcessPasses_[r].apply(t,null,e,i):this.postProcessPasses_[r].apply(t,this.postProcessPasses_[r+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(t){const e=t.size,i=t.viewState.rotation,r=t.pixelRatio;this.setUniformFloatValue(Go.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(Go.ZOOM,t.viewState.zoom),this.setUniformFloatValue(Go.RESOLUTION,t.viewState.resolution),this.setUniformFloatValue(Go.PIXEL_RATIO,r),this.setUniformFloatVec2(Go.VIEWPORT_SIZE_PX,[e[0],e[1]]),this.setUniformFloatValue(Go.ROTATION,i)}applyHitDetectionUniform(t){const e=this.getUniformLocation(Go.HIT_DETECTION);this.getGL().uniform1i(e,t?1:0),t&&this.setUniformFloatValue(Go.PIXEL_RATIO,.5)}applyUniforms(t){const e=this.gl_;let i,r=0;this.uniforms_.forEach(n=>{if(i=typeof n.value=="function"?n.value(t):n.value,i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof ImageData||i instanceof WebGLTexture){i instanceof WebGLTexture&&!n.texture?(n.prevValue=void 0,n.texture=i):n.texture||(n.prevValue=void 0,n.texture=e.createTexture()),this.bindTexture(n.texture,r,n.name),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const o=!(i instanceof HTMLImageElement)||i.complete;!(i instanceof WebGLTexture)&&o&&n.prevValue!==i&&(n.prevValue=i,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i)),r++}else if(Array.isArray(i)&&i.length===6)this.setUniformMatrixValue(n.name,UP(this.tmpMat4_,i));else if(Array.isArray(i)&&i.length<=4)switch(i.length){case 2:e.uniform2f(this.getUniformLocation(n.name),i[0],i[1]);return;case 3:e.uniform3f(this.getUniformLocation(n.name),i[0],i[1],i[2]);return;case 4:e.uniform4f(this.getUniformLocation(n.name),i[0],i[1],i[2],i[3]);return;default:return}else typeof i=="number"&&e.uniform1f(this.getUniformLocation(n.name),i)})}useProgram(t,e){this.gl_.useProgram(t),this.currentProgram_=t,this.applyFrameState(e),this.applyUniforms(e)}compileShader(t,e){const i=this.gl_,r=i.createShader(e);return i.shaderSource(r,t),i.compileShader(r),r}getProgram(t,e){const i=this.gl_,r=this.compileShader(t,i.FRAGMENT_SHADER),n=this.compileShader(e,i.VERTEX_SHADER),o=i.createProgram();if(i.attachShader(o,r),i.attachShader(o,n),i.linkProgram(o),!i.getShaderParameter(r,i.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${i.getShaderInfoLog(r)}`;throw new Error(a)}if(i.deleteShader(r),!i.getShaderParameter(n,i.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${i.getShaderInfoLog(n)}`;throw new Error(a)}if(i.deleteShader(n),!i.getProgramParameter(o,i.LINK_STATUS)){const a=`GL program linking failed: ${i.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(t){const e=xt(this.currentProgram_);return this.uniformLocationsByProgram_[e]===void 0&&(this.uniformLocationsByProgram_[e]={}),this.uniformLocationsByProgram_[e][t]===void 0&&(this.uniformLocationsByProgram_[e][t]=this.gl_.getUniformLocation(this.currentProgram_,t)),this.uniformLocationsByProgram_[e][t]}getAttributeLocation(t){const e=xt(this.currentProgram_);return this.attribLocationsByProgram_[e]===void 0&&(this.attribLocationsByProgram_[e]={}),this.attribLocationsByProgram_[e][t]===void 0&&(this.attribLocationsByProgram_[e][t]=this.gl_.getAttribLocation(this.currentProgram_,t)),this.attribLocationsByProgram_[e][t]}makeProjectionTransform(t,e){const i=t.size,r=t.viewState.rotation,n=t.viewState.resolution,o=t.viewState.center;return Xr(e,0,0,2/(n*i[0]),2/(n*i[1]),-r,-o[0],-o[1]),e}setUniformFloatValue(t,e){this.gl_.uniform1f(this.getUniformLocation(t),e)}setUniformFloatVec2(t,e){this.gl_.uniform2fv(this.getUniformLocation(t),e)}setUniformFloatVec4(t,e){this.gl_.uniform4fv(this.getUniformLocation(t),e)}setUniformMatrixValue(t,e){this.gl_.uniformMatrix4fv(this.getUniformLocation(t),!1,e)}enableAttributeArray_(t,e,i,r,n){const o=this.getAttributeLocation(t);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,e,i,!1,r,n))}enableAttributes(t){const e=rH(t);let i=0;for(let r=0;r<t.length;r++){const n=t[r];this.enableAttributeArray_(n.name,n.size,n.type||zP,e,i),i+=n.size*VP(n.type)}}handleWebGLContextLost(t){ed(this.bufferCache_),this.currentProgram_=null,t.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(t,e,i){const r=this.gl_;i=i||r.createTexture();const n=0,o=r.RGBA,a=0,l=r.RGBA,h=r.UNSIGNED_BYTE;return r.bindTexture(r.TEXTURE_2D,i),e?r.texImage2D(r.TEXTURE_2D,n,o,l,h,e):r.texImage2D(r.TEXTURE_2D,n,o,t[0],t[1],a,l,h,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),i}}function rH(s){let t=0;for(let e=0;e<s.length;e++){const i=s[e];t+=i.size*VP(i.type)}return t}function VP(s){switch(s){case Qn.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Qn.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Qn.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case Qn.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}let nH=class HP extends IP{constructor(t,e){super(t),e=e||{},this.inversePixelTransform_=Ki(),this.pixelContext_=null,this.postProcesses_=e.postProcesses,this.uniforms_=e.uniforms,this.helper,t.addChangeListener(ze.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(t,e){const i=this.getLayer();if(i.hasListener(wr.PRECOMPOSE)){const r=new km(wr.PRECOMPOSE,void 0,e,t);i.dispatchEvent(r)}}dispatchPostComposeEvent(t,e){const i=this.getLayer();if(i.hasListener(wr.POSTCOMPOSE)){const r=new km(wr.POSTCOMPOSE,void 0,e,t);i.dispatchEvent(r)}}reset(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(t){if(this.getLayer().getRenderSource()){let e=!0,i=-1,r;for(let o=0,a=t.layerStatesArray.length;o<a;o++){const l=t.layerStatesArray[o].layer,h=l.getRenderer();if(!(h instanceof HP)){e=!0;continue}const c=l.getClassName();if((e||c!==r)&&(i+=1,e=!1),r=c,h===this)break}const n="map/"+t.mapId+"/group/"+i;(!this.helper||!this.helper.canvasCacheKeyMatches(n)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new sH({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:n}),r&&(this.helper.getCanvas().className=r),this.afterHelperCreated())}return this.prepareFrameInternal(t)}afterHelperCreated(){}prepareFrameInternal(t){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(t,e,i){const r=this.getLayer();if(r.hasListener(t)){Xr(this.inversePixelTransform_,0,0,i.pixelRatio,-i.pixelRatio,0,0,-i.size[1]);const n=new km(t,this.inversePixelTransform_,i,e);r.dispatchEvent(n)}}preRender(t,e){this.dispatchRenderEvent_(wr.PRERENDER,t,e)}postRender(t,e){this.dispatchRenderEvent_(wr.POSTRENDER,t,e)}};const WP=nH,Xn=new Uint8Array(4);class oH{constructor(t,e){this.helper_=t;const i=t.getGL();this.texture_=i.createTexture(),this.framebuffer_=i.createFramebuffer(),this.depthbuffer_=i.createRenderbuffer(),this.size_=e||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(t){$h(t,this.size_)||(this.size_[0]=t[0],this.size_[1]=t[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const t=this.size_,e=this.helper_.getGL();e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.readPixels(0,0,t[0],t[1],e.RGBA,e.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(t,e){if(t<0||e<0||t>this.size_[0]||e>=this.size_[1])return Xn[0]=0,Xn[1]=0,Xn[2]=0,Xn[3]=0,Xn;this.readAll();const i=Math.floor(t)+(this.size_[1]-Math.floor(e)-1)*this.size_[0];return Xn[0]=this.data_[i*4],Xn[1]=this.data_[i*4+1],Xn[2]=this.data_[i*4+2],Xn[3]=this.data_[i*4+3],Xn}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const t=this.size_,e=this.helper_.getGL();this.texture_=this.helper_.createTexture(t,null,this.texture_),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.viewport(0,0,t[0],t[1]),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture_,0),e.bindRenderbuffer(e.RENDERBUFFER,this.depthbuffer_),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t[0],t[1]),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(t[0]*t[1]*4)}}const aH=oH,yT={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};var XP={exports:{}};XP.exports=dy;XP.exports.default=dy;function dy(s,t,e){e=e||2;var i=t&&t.length,r=i?t[0]*e:s.length,n=qP(s,0,r,e,!0),o=[];if(!n||n.next===n.prev)return o;var a,l,h,c,u,d,p;if(i&&(n=dH(s,t,n,e)),s.length>80*e){a=h=s[0],l=c=s[1];for(var g=e;g<r;g+=e)u=s[g],d=s[g+1],u<a&&(a=u),d<l&&(l=d),u>h&&(h=u),d>c&&(c=d);p=Math.max(h-a,c-l),p=p!==0?32767/p:0}return Qp(n,o,e,a,l,p,0),o}function qP(s,t,e,i,r){var n,o;if(r===kv(s,t,e,i)>0)for(n=t;n<e;n+=i)o=xT(n,s[n],s[n+1],o);else for(n=e-i;n>=t;n-=i)o=xT(n,s[n],s[n+1],o);return o&&py(o,o.next)&&(eg(o),o=o.next),o}function Mh(s,t){if(!s)return s;t||(t=s);var e=s,i;do if(i=!1,!e.steiner&&(py(e,e.next)||Pi(e.prev,e,e.next)===0)){if(eg(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function Qp(s,t,e,i,r,n,o){if(s){!o&&n&&_H(s,i,r,n);for(var a=s,l,h;s.prev!==s.next;){if(l=s.prev,h=s.next,n?hH(s,i,r,n):lH(s)){t.push(l.i/e|0),t.push(s.i/e|0),t.push(h.i/e|0),eg(s),s=h.next,a=h.next;continue}if(s=h,s===a){o?o===1?(s=cH(Mh(s),t,e),Qp(s,t,e,i,r,n,2)):o===2&&uH(s,t,e,i,r,n):Qp(Mh(s),t,e,i,r,n,1);break}}}}function lH(s){var t=s.prev,e=s,i=s.next;if(Pi(t,e,i)>=0)return!1;for(var r=t.x,n=e.x,o=i.x,a=t.y,l=e.y,h=i.y,c=r<n?r<o?r:o:n<o?n:o,u=a<l?a<h?a:h:l<h?l:h,d=r>n?r>o?r:o:n>o?n:o,p=a>l?a>h?a:h:l>h?l:h,g=i.next;g!==t;){if(g.x>=c&&g.x<=d&&g.y>=u&&g.y<=p&&Wc(r,a,n,l,o,h,g.x,g.y)&&Pi(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function hH(s,t,e,i){var r=s.prev,n=s,o=s.next;if(Pi(r,n,o)>=0)return!1;for(var a=r.x,l=n.x,h=o.x,c=r.y,u=n.y,d=o.y,p=a<l?a<h?a:h:l<h?l:h,g=c<u?c<d?c:d:u<d?u:d,f=a>l?a>h?a:h:l>h?l:h,m=c>u?c>d?c:d:u>d?u:d,_=Ov(p,g,t,e,i),y=Ov(f,m,t,e,i),v=s.prevZ,b=s.nextZ;v&&v.z>=_&&b&&b.z<=y;){if(v.x>=p&&v.x<=f&&v.y>=g&&v.y<=m&&v!==r&&v!==o&&Wc(a,c,l,u,h,d,v.x,v.y)&&Pi(v.prev,v,v.next)>=0||(v=v.prevZ,b.x>=p&&b.x<=f&&b.y>=g&&b.y<=m&&b!==r&&b!==o&&Wc(a,c,l,u,h,d,b.x,b.y)&&Pi(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;v&&v.z>=_;){if(v.x>=p&&v.x<=f&&v.y>=g&&v.y<=m&&v!==r&&v!==o&&Wc(a,c,l,u,h,d,v.x,v.y)&&Pi(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;b&&b.z<=y;){if(b.x>=p&&b.x<=f&&b.y>=g&&b.y<=m&&b!==r&&b!==o&&Wc(a,c,l,u,h,d,b.x,b.y)&&Pi(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function cH(s,t,e){var i=s;do{var r=i.prev,n=i.next.next;!py(r,n)&&YP(r,i,i.next,n)&&tg(r,n)&&tg(n,r)&&(t.push(r.i/e|0),t.push(i.i/e|0),t.push(n.i/e|0),eg(i),eg(i.next),i=s=n),i=i.next}while(i!==s);return Mh(i)}function uH(s,t,e,i,r,n){var o=s;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&vH(o,a)){var l=ZP(o,a);o=Mh(o,o.next),l=Mh(l,l.next),Qp(o,t,e,i,r,n,0),Qp(l,t,e,i,r,n,0);return}a=a.next}o=o.next}while(o!==s)}function dH(s,t,e,i){var r=[],n,o,a,l,h;for(n=0,o=t.length;n<o;n++)a=t[n]*i,l=n<o-1?t[n+1]*i:s.length,h=qP(s,a,l,i,!1),h===h.next&&(h.steiner=!0),r.push(xH(h));for(r.sort(pH),n=0;n<r.length;n++)e=gH(r[n],e);return e}function pH(s,t){return s.x-t.x}function gH(s,t){var e=fH(s,t);if(!e)return t;var i=ZP(e,s);return Mh(i,i.next),Mh(e,e.next)}function fH(s,t){var e=t,i=s.x,r=s.y,n=-1/0,o;do{if(r<=e.y&&r>=e.next.y&&e.next.y!==e.y){var a=e.x+(r-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=i&&a>n&&(n=a,o=e.x<e.next.x?e:e.next,a===i))return o}e=e.next}while(e!==t);if(!o)return null;var l=o,h=o.x,c=o.y,u=1/0,d;e=o;do i>=e.x&&e.x>=h&&i!==e.x&&Wc(r<c?i:n,r,h,c,r<c?n:i,r,e.x,e.y)&&(d=Math.abs(r-e.y)/(i-e.x),tg(e,s)&&(d<u||d===u&&(e.x>o.x||e.x===o.x&&mH(o,e)))&&(o=e,u=d)),e=e.next;while(e!==l);return o}function mH(s,t){return Pi(s.prev,s,t.prev)<0&&Pi(t.next,s,s.next)<0}function _H(s,t,e,i){var r=s;do r.z===0&&(r.z=Ov(r.x,r.y,t,e,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==s);r.prevZ.nextZ=null,r.prevZ=null,yH(r)}function yH(s){var t,e,i,r,n,o,a,l,h=1;do{for(e=s,s=null,n=null,o=0;e;){for(o++,i=e,a=0,t=0;t<h&&(a++,i=i.nextZ,!!i);t++);for(l=h;a>0||l>0&&i;)a!==0&&(l===0||!i||e.z<=i.z)?(r=e,e=e.nextZ,a--):(r=i,i=i.nextZ,l--),n?n.nextZ=r:s=r,r.prevZ=n,n=r;e=i}n.nextZ=null,h*=2}while(o>1);return s}function Ov(s,t,e,i,r){return s=(s-e)*r|0,t=(t-i)*r|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,s|t<<1}function xH(s){var t=s,e=s;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==s);return e}function Wc(s,t,e,i,r,n,o,a){return(r-o)*(t-a)>=(s-o)*(n-a)&&(s-o)*(i-a)>=(e-o)*(t-a)&&(e-o)*(n-a)>=(r-o)*(i-a)}function vH(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!bH(s,t)&&(tg(s,t)&&tg(t,s)&&wH(s,t)&&(Pi(s.prev,s,t.prev)||Pi(s,t.prev,t))||py(s,t)&&Pi(s.prev,s,s.next)>0&&Pi(t.prev,t,t.next)>0)}function Pi(s,t,e){return(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y)}function py(s,t){return s.x===t.x&&s.y===t.y}function YP(s,t,e,i){var r=rm(Pi(s,t,e)),n=rm(Pi(s,t,i)),o=rm(Pi(e,i,s)),a=rm(Pi(e,i,t));return!!(r!==n&&o!==a||r===0&&sm(s,e,t)||n===0&&sm(s,i,t)||o===0&&sm(e,s,i)||a===0&&sm(e,t,i))}function sm(s,t,e){return t.x<=Math.max(s.x,e.x)&&t.x>=Math.min(s.x,e.x)&&t.y<=Math.max(s.y,e.y)&&t.y>=Math.min(s.y,e.y)}function rm(s){return s>0?1:s<0?-1:0}function bH(s,t){var e=s;do{if(e.i!==s.i&&e.next.i!==s.i&&e.i!==t.i&&e.next.i!==t.i&&YP(e,e.next,s,t))return!0;e=e.next}while(e!==s);return!1}function tg(s,t){return Pi(s.prev,s,s.next)<0?Pi(s,t,s.next)>=0&&Pi(s,s.prev,t)>=0:Pi(s,t,s.prev)<0||Pi(s,s.next,t)<0}function wH(s,t){var e=s,i=!1,r=(s.x+t.x)/2,n=(s.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&r<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==s);return i}function ZP(s,t){var e=new Fv(s.i,s.x,s.y),i=new Fv(t.i,t.x,t.y),r=s.next,n=t.prev;return s.next=t,t.prev=s,e.next=r,r.prev=e,i.next=e,e.prev=i,n.next=i,i.prev=n,i}function xT(s,t,e,i){var r=new Fv(s,t,e);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function eg(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Fv(s,t,e){this.i=s,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}dy.deviation=function(s,t,e,i){var r=t&&t.length,n=r?t[0]*e:s.length,o=Math.abs(kv(s,0,n,e));if(r)for(var a=0,l=t.length;a<l;a++){var h=t[a]*e,c=a<l-1?t[a+1]*e:s.length;o-=Math.abs(kv(s,h,c,e))}var u=0;for(a=0;a<i.length;a+=3){var d=i[a]*e,p=i[a+1]*e,g=i[a+2]*e;u+=Math.abs((s[d]-s[g])*(s[p+1]-s[d+1])-(s[d]-s[p])*(s[g+1]-s[d+1]))}return o===0&&u===0?0:Math.abs((u-o)/o)};function kv(s,t,e,i){for(var r=0,n=t,o=e-i;n<e;n+=i)r+=(s[o]-s[n])*(s[n+1]+s[o+1]),o=n;return r}dy.flatten=function(s){for(var t=s[0][0].length,e={vertices:[],holes:[],dimensions:t},i=0,r=0;r<s.length;r++){for(var n=0;n<s[r].length;n++)for(var o=0;o<t;o++)e.vertices.push(s[r][n][o]);r>0&&(i+=s[r-1].length,e.holes.push(i))}return e};const vT=.985;function EH(s,t){t=t||[];const e=256,i=e-1;return t[0]=Math.floor(s/e/e/e)/i,t[1]=Math.floor(s/e/e)%e/i,t[2]=Math.floor(s/e)%e/i,t[3]=s%e/i,t}function SH(s){let t=0;const e=256,i=e-1;return t+=Math.round(s[0]*e*e*e*i),t+=Math.round(s[1]*e*e*i),t+=Math.round(s[2]*e*i),t+=Math.round(s[3]*i),t}function CH(){const s='const e="GENERATE_POLYGON_BUFFERS",t="GENERATE_POINT_BUFFERS",n="GENERATE_LINE_STRING_BUFFERS";function r(e,t){const n=t[0],r=t[1];return t[0]=e[0]*n+e[2]*r+e[4],t[1]=e[1]*n+e[3]*r+e[5],t}function x(e,t){const n=(r=t)[0]*r[3]-r[1]*r[2];var r;!function(e,t){if(!e)throw new Error(t)}(0!==n,"Transformation matrix cannot be inverted");const x=t[0],i=t[1],u=t[2],o=t[3],f=t[4],s=t[5];return e[0]=o/n,e[1]=-i/n,e[2]=-u/n,e[3]=x/n,e[4]=(u*s-o*f)/n,e[5]=-(x*s-i*f)/n,e}function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}new Array(6);var u={exports:{}};function o(e,t,n){n=n||2;var r,x,i,u,o,s,l,v=t&&t.length,h=v?t[0]*n:e.length,c=f(e,0,h,n,!0),g=[];if(!c||c.next===c.prev)return g;if(v&&(c=function(e,t,n,r){var x,i,u,o=[];for(x=0,i=t.length;x<i;x++)(u=f(e,t[x]*r,x<i-1?t[x+1]*r:e.length,r,!1))===u.next&&(u.steiner=!0),o.push(d(u));for(o.sort(p),x=0;x<o.length;x++)n=y(o[x],n);return n}(e,t,c,n)),e.length>80*n){r=i=e[0],x=u=e[1];for(var b=n;b<h;b+=n)(o=e[b])<r&&(r=o),(s=e[b+1])<x&&(x=s),o>i&&(i=o),s>u&&(u=s);l=0!==(l=Math.max(i-r,u-x))?32767/l:0}return a(c,g,n,r,x,l,0),g}function f(e,t,n,r,x){var i,u;if(x===O(e,t,n,r)>0)for(i=t;i<n;i+=r)u=P(i,e[i],e[i+1],u);else for(i=n-r;i>=t;i-=r)u=P(i,e[i],e[i+1],u);return u&&m(u,u.next)&&(B(u),u=u.next),u}function s(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==w(r.prev,r,r.next))r=r.next;else{if(B(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function a(e,t,n,r,x,i,u){if(e){!u&&i&&function(e,t,n,r){var x=e;do{0===x.z&&(x.z=b(x.x,x.y,t,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==e);x.prevZ.nextZ=null,x.prevZ=null,function(e){var t,n,r,x,i,u,o,f,s=1;do{for(n=e,e=null,i=null,u=0;n;){for(u++,r=n,o=0,t=0;t<s&&(o++,r=r.nextZ);t++);for(f=s;o>0||f>0&&r;)0!==o&&(0===f||!r||n.z<=r.z)?(x=n,n=n.nextZ,o--):(x=r,r=r.nextZ,f--),i?i.nextZ=x:e=x,x.prevZ=i,i=x;n=r}i.nextZ=null,s*=2}while(u>1)}(x)}(e,r,x,i);for(var o,f,p=e;e.prev!==e.next;)if(o=e.prev,f=e.next,i?v(e,r,x,i):l(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(f.i/n|0),B(e),e=f.next,p=f.next;else if((e=f)===p){u?1===u?a(e=h(s(e),t,n),t,n,r,x,i,2):2===u&&c(e,t,n,r,x,i):a(s(e),t,n,r,x,i,1);break}}}function l(e){var t=e.prev,n=e,r=e.next;if(w(t,n,r)>=0)return!1;for(var x=t.x,i=n.x,u=r.x,o=t.y,f=n.y,s=r.y,a=x<i?x<u?x:u:i<u?i:u,l=o<f?o<s?o:s:f<s?f:s,v=x>i?x>u?x:u:i>u?i:u,h=o>f?o>s?o:s:f>s?f:s,c=r.next;c!==t;){if(c.x>=a&&c.x<=v&&c.y>=l&&c.y<=h&&M(x,o,i,f,u,s,c.x,c.y)&&w(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function v(e,t,n,r){var x=e.prev,i=e,u=e.next;if(w(x,i,u)>=0)return!1;for(var o=x.x,f=i.x,s=u.x,a=x.y,l=i.y,v=u.y,h=o<f?o<s?o:s:f<s?f:s,c=a<l?a<v?a:v:l<v?l:v,p=o>f?o>s?o:s:f>s?f:s,y=a>l?a>v?a:v:l>v?l:v,g=b(h,c,t,n,r),d=b(p,y,t,n,r),Z=e.prevZ,m=e.nextZ;Z&&Z.z>=g&&m&&m.z<=d;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;if(Z=Z.prevZ,m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;Z&&Z.z>=g;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;m&&m.z<=d;){if(m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function h(e,t,n){var r=e;do{var x=r.prev,i=r.next.next;!m(x,i)&&A(x,r,r.next,i)&&z(x,i)&&z(i,x)&&(t.push(x.i/n|0),t.push(r.i/n|0),t.push(i.i/n|0),B(r),B(r.next),r=e=i),r=r.next}while(r!==e);return s(r)}function c(e,t,n,r,x,i){var u=e;do{for(var o=u.next.next;o!==u.prev;){if(u.i!==o.i&&Z(u,o)){var f=F(u,o);return u=s(u,u.next),f=s(f,f.next),a(u,t,n,r,x,i,0),void a(f,t,n,r,x,i,0)}o=o.next}u=u.next}while(u!==e)}function p(e,t){return e.x-t.x}function y(e,t){var n=function(e,t){var n,r=t,x=e.x,i=e.y,u=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var o=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=x&&o>u&&(u=o,n=r.x<r.next.x?r:r.next,o===x))return n}r=r.next}while(r!==t);if(!n)return null;var f,s=n,a=n.x,l=n.y,v=1/0;r=n;do{x>=r.x&&r.x>=a&&x!==r.x&&M(i<l?x:u,i,a,l,i<l?u:x,i,r.x,r.y)&&(f=Math.abs(i-r.y)/(x-r.x),z(r,e)&&(f<v||f===v&&(r.x>n.x||r.x===n.x&&g(n,r)))&&(n=r,v=f)),r=r.next}while(r!==s);return n}(e,t);if(!n)return t;var r=F(n,e);return s(r,r.next),s(n,n.next)}function g(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function b(e,t,n,r,x){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function d(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function M(e,t,n,r,x,i,u,o){return(x-u)*(t-o)>=(e-u)*(i-o)&&(e-u)*(r-o)>=(n-u)*(t-o)&&(n-u)*(i-o)>=(x-u)*(r-o)}function Z(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&A(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(z(e,t)&&z(t,e)&&function(e,t){var n=e,r=!1,x=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!=n.next.y>i&&n.next.y!==n.y&&x<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||m(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function A(e,t,n,r){var x=I(w(e,t,n)),i=I(w(e,t,r)),u=I(w(n,r,e)),o=I(w(n,r,t));return x!==i&&u!==o||(!(0!==x||!E(e,n,t))||(!(0!==i||!E(e,r,t))||(!(0!==u||!E(n,e,r))||!(0!==o||!E(n,t,r)))))}function E(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function I(e){return e>0?1:e<0?-1:0}function z(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function F(e,t){var n=new _(e.i,e.x,e.y),r=new _(t.i,t.x,t.y),x=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=x,x.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function P(e,t,n,r){var x=new _(e,t,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function B(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function _(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(e,t,n,r){for(var x=0,i=t,u=n-r;i<n;i+=r)x+=(e[u]-e[i])*(e[i+1]+e[u+1]),u=i;return x}u.exports=o,u.exports.default=o,o.deviation=function(e,t,n,r){var x=t&&t.length,i=x?t[0]*n:e.length,u=Math.abs(O(e,0,i,n));if(x)for(var o=0,f=t.length;o<f;o++){var s=t[o]*n,a=o<f-1?t[o+1]*n:e.length;u-=Math.abs(O(e,s,a,n))}var l=0;for(o=0;o<r.length;o+=3){var v=r[o]*n,h=r[o+1]*n,c=r[o+2]*n;l+=Math.abs((e[v]-e[c])*(e[h+1]-e[v+1])-(e[v]-e[h])*(e[c+1]-e[v+1]))}return 0===u&&0===l?0:Math.abs((l-u)/u)},o.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,x=0;x<e.length;x++){for(var i=0;i<e[x].length;i++)for(var u=0;u<t;u++)n.vertices.push(e[x][i][u]);x>0&&(r+=e[x-1].length,n.holes.push(r))}return n};var N=i(u.exports);const R=[],S={vertexPosition:0,indexPosition:0};function T(e,t,n,r,x){e[t+0]=n,e[t+1]=r,e[t+2]=x}function U(e,t,n,r,x,i){const u=3+x,o=e[t+0],f=e[t+1],s=R;s.length=x;for(let n=0;n<s.length;n++)s[n]=e[t+2+n];let a=i?i.vertexPosition:0,l=i?i.indexPosition:0;const v=a/u;return T(n,a,o,f,0),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,1),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,2),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,3),s.length&&n.set(s,a+3),a+=u,r[l++]=v,r[l++]=v+1,r[l++]=v+3,r[l++]=v+1,r[l++]=v+2,r[l++]=v+3,S.vertexPosition=a,S.indexPosition=l,S}function k(e,t,n,x,i,u,o,f,s,a,l){const v=8+f.length,h=u.length/v,c=[e[t+0],e[t+1]],p=[e[n],e[n+1]],y=r(s,[...c]),g=r(s,[...p]);function b(e,t,n){const r=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),x=[(t[0]-e[0])/r,(t[1]-e[1])/r],i=[-x[1],x[0]],u=Math.sqrt((n[0]-e[0])*(n[0]-e[0])+(n[1]-e[1])*(n[1]-e[1])),o=[(n[0]-e[0])/u,(n[1]-e[1])/u],f=0===r||0===u?0:Math.acos((s=o[0]*x[0]+o[1]*x[1],a=-1,l=1,Math.min(Math.max(s,a),l)));var s,a,l;return o[0]*i[0]+o[1]*i[1]>0?f:2*Math.PI-f}let d=-1,M=-1,Z=l;const w=null!==i;if(null!==x){d=b(y,g,r(s,[...[e[x],e[x+1]]])),Math.cos(d)<=.985&&(Z+=Math.tan((d-Math.PI)/2))}if(w){M=b(g,y,r(s,[...[e[i],e[i+1]]])),Math.cos(M)<=.985&&(Z+=Math.tan((Math.PI-M)/2))}function m(e,t){return 0===t?1e4*e:Math.sign(t)*(1e4*e+Math.abs(t))}return u.push(c[0],c[1],p[0],p[1],d,M,a,m(0,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(1,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(2,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(3,l)),u.push(...f),o.push(h,h+1,h+2,h+1,h+3,h+2),{length:a+Math.sqrt((g[0]-y[0])*(g[0]-y[0])+(g[1]-y[1])*(g[1]-y[1])),angle:Z}}function G(e,t,n,r,x){const i=2+x;let u=t;const o=e.slice(u,u+x);u+=x;const f=e[u++];let s=0;const a=new Array(f-1);for(let t=0;t<f;t++)s+=e[u++],t<f-1&&(a[t]=s);const l=e.slice(u,u+2*s),v=N(l,a,2);for(let e=0;e<v.length;e++)r.push(v[e]+n.length/i);for(let e=0;e<l.length;e+=2)n.push(l[e],l[e+1],...o);return u+2*s}const j=self;j.onmessage=r=>{const i=r.data;switch(i.type){case t:{const e=3,t=2,n=i.customAttributesSize,r=t+n,x=new Float32Array(i.renderInstructions),u=x.length/r,o=4*u*(n+e),f=new Uint32Array(6*u),s=new Float32Array(o);let a;for(let e=0;e<x.length;e+=r)a=U(x,e,s,f,n,a);const l=Object.assign({vertexBuffer:s.buffer,indexBuffer:f.buffer,renderInstructions:x.buffer},i);j.postMessage(l,[s.buffer,f.buffer,x.buffer]);break}case n:{const e=[],t=[],n=i.customAttributesSize,r=2,u=new Float32Array(i.renderInstructions);let o=0;const f=[1,0,0,1,0,0];let s,a;for(x(f,i.renderInstructionsTransform);o<u.length;){a=Array.from(u.slice(o,o+n)),o+=n,s=u[o++];const x=o,i=o+(s-1)*r,l=u[x]===u[i]&&u[x+1]===u[i+1];let v=0,h=0;for(let n=0;n<s-1;n++){let c=null;n>0?c=o+(n-1)*r:l&&(c=i-r);let p=null;n<s-2?p=o+(n+2)*r:l&&(p=x+r);const y=k(u,o+n*r,o+(n+1)*r,c,p,e,t,a,f,v,h);v=y.length,h=y.angle}o+=s*r}const l=Uint32Array.from(t),v=Float32Array.from(e),h=Object.assign({vertexBuffer:v.buffer,indexBuffer:l.buffer,renderInstructions:u.buffer},i);j.postMessage(h,[v.buffer,l.buffer,u.buffer]);break}case e:{const e=[],t=[],n=i.customAttributesSize,r=new Float32Array(i.renderInstructions);let x=0;for(;x<r.length;)x=G(r,x,e,t,n);const u=Uint32Array.from(t),o=Float32Array.from(e),f=Object.assign({vertexBuffer:o.buffer,indexBuffer:u.buffer,renderInstructions:r.buffer},i);j.postMessage(f,[o.buffer,u.buffer,r.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(s,"binary").toString("base64"):URL.createObjectURL(new Blob([s],{type:"application/javascript"})))}function TH(s,t){const e=s.viewState.projection,i=t.getSource().getWrapX()&&e.canWrapX(),r=e.getExtent(),n=s.extent,o=i?Kt(r):null,a=i?Math.ceil((n[2]-r[2])/o)+1:1;return[i?Math.floor((n[0]-r[0])/o):0,a,o]}class RH extends WP{constructor(t,e){const i=e.uniforms||{},r=Ki();i[Go.PROJECTION_MATRIX]=r,super(t,{uniforms:i,postProcesses:e.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new x0(cy,Pv),this.indicesBuffer_=new x0(uy,Pv),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.program_,this.hitDetectionEnabled_=e.hitDetectionEnabled??!0;const n=e.attributes?e.attributes.map(function(a){return{name:"a_prop_"+a.name,size:1,type:Qn.FLOAT}}):[];this.attributes=[{name:"a_position",size:2,type:Qn.FLOAT},{name:"a_index",size:1,type:Qn.FLOAT}],this.hitDetectionEnabled_&&(this.attributes.push({name:"a_prop_hitColor",size:4,type:Qn.FLOAT}),this.attributes.push({name:"a_featureUid",size:1,type:Qn.FLOAT})),this.attributes.push(...n),this.customAttributes=e.attributes?e.attributes:[],this.previousExtent_=Ys(),this.currentTransform_=r,this.renderTransform_=Ki(),this.invertRenderTransform_=Ki(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=CH(),this.worker_.addEventListener("message",a=>{const l=a.data;if(l.type===yT.GENERATE_POINT_BUFFERS){const h=l.projectionTransform;this.verticesBuffer_.fromArrayBuffer(l.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.fromArrayBuffer(l.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=h,B_(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(a.data.renderInstructions),l.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const o=this.getLayer().getSource();this.sourceListenKeys_=[Ai(o,er.ADDFEATURE,this.handleSourceFeatureAdded_,this),Ai(o,er.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),Ai(o,er.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),Ai(o,er.CLEAR,this.handleSourceFeatureClear_,this)],o.forEachFeature(a=>{this.featureCache_[xt(a)]={feature:a,properties:a.getProperties(),geometry:a.getGeometry()},this.featureCount_++})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new aH(this.helper))}handleSourceFeatureAdded_(t){const e=t.feature;this.featureCache_[xt(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(t){const e=t.feature;this.featureCache_[xt(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()}}handleSourceFeatureDelete_(t){const e=t.feature;delete this.featureCache_[xt(e)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(t){const e=this.helper.getGL();this.preRender(e,t);const[i,r,n]=TH(t,this.getLayer());return this.renderWorlds(t,!1,i,r,n),this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(t,!0,i,r,n),this.hitRenderTarget_.clearCachedData()),this.postRender(e,t),this.helper.getCanvas()}prepareFrameInternal(t){const e=this.getLayer(),i=e.getSource(),r=t.viewState,n=!t.viewHints[Ei.ANIMATING]&&!t.viewHints[Ei.INTERACTING],o=!ca(this.previousExtent_,t.extent),a=this.sourceRevision_<i.getRevision();if(a&&(this.sourceRevision_=i.getRevision()),n&&(o||a)){const l=r.projection,h=r.resolution,c=e instanceof Kg?e.getRenderBuffer():0,u=ln(t.extent,c*h);i.loadFeatures(u,h,l),this.rebuildBuffers_(t),this.previousExtent_=t.extent.slice()}return this.helper.useProgram(this.program_,t),this.helper.prepareDraw(t),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(t){const e=Ki();this.helper.makeProjectionTransform(t,e);const i=(this.hitDetectionEnabled_?7:2)+this.customAttributes.length,r=i*this.featureCount_;(!this.renderInstructions_||this.renderInstructions_.length!==r)&&(this.renderInstructions_=new Float32Array(r));let n,o;const a=[],l=[];let h=-1;for(const u in this.featureCache_)if(n=this.featureCache_[u],o=n.geometry,!(!o||o.getType()!=="Point")){if(a[0]=o.getFlatCoordinates()[0],a[1]=o.getFlatCoordinates()[1],Ii(e,a),this.renderInstructions_[++h]=a[0],this.renderInstructions_[++h]=a[1],this.hitDetectionEnabled_){const d=EH(h+5,l);this.renderInstructions_[++h]=d[0],this.renderInstructions_[++h]=d[1],this.renderInstructions_[++h]=d[2],this.renderInstructions_[++h]=d[3],this.renderInstructions_[++h]=Number(u)}for(let d=0;d<this.customAttributes.length;d++){const p=this.customAttributes[d].callback(n.feature,n.properties);this.renderInstructions_[++h]=p}}const c={id:++this.lastSentId,type:yT.GENERATE_POINT_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesSize:i-2};c.projectionTransform=e,this.ready=!1,this.worker_.postMessage(c,[this.renderInstructions_.buffer]),this.renderInstructions_=null}forEachFeatureAtCoordinate(t,e,i,r,n){if(ge(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const o=Ii(e.coordinateToPixelTransform,t.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],h=SH(l),c=this.renderInstructions_[h],u=Math.floor(c).toString(),d=this.getLayer().getSource().getFeatureByUid(u);if(d)return r(d,this.getLayer(),null)}renderWorlds(t,e,i,r,n){let o=i;this.helper.useProgram(this.program_,t),e&&(this.hitRenderTarget_.setSize([Math.floor(t.size[0]/2),Math.floor(t.size[1]/2)]),this.helper.prepareDrawToRenderTarget(t,this.hitRenderTarget_,!0)),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes);do{this.helper.makeProjectionTransform(t,this.currentTransform_),Wb(this.currentTransform_,o*n,0),id(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(t),this.helper.applyHitDetectionUniform(e);const a=this.indicesBuffer_.getSize();this.helper.drawElements(0,a)}while(++o<r)}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach(function(t){cs(t)}),this.sourceListenKeys_=null,super.disposeInternal()}renderDeclutter(){}}const KP=RH;class MH{constructor(t,e){this.name=t,this.data=e,this.texture_=null}getTexture(t){if(!this.texture_){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=e}return this.texture_}}const IH=MH,Kw=.5,X={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};let AH=class extends Dg{constructor(s,t,e){super(),e=e||{},this.tileCoord=s,this.state=t,this.interimTile=null,this.key="",this.transition_=e.transition===void 0?250:e.transition,this.transitionStarts_={},this.interpolate=!!e.interpolate}changed(){this.dispatchEvent(fe.CHANGE)}release(){this.state===X.ERROR&&this.setState(X.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let s=this.interimTile;if(!s)return this;do{if(s.getState()==X.LOADED)return this.transition_=0,s;s=s.interimTile}while(s);return this}refreshInterimChain(){let s=this.interimTile;if(!s)return;let t=this;do{if(s.getState()==X.LOADED){s.interimTile=null;break}s.getState()==X.LOADING?t=s:s.getState()==X.IDLE?t.interimTile=s.interimTile:t=s,s=t.interimTile}while(s)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(s){if(this.state!==X.ERROR&&this.state>s)throw new Error("Tile load sequence violation");this.state=s,this.changed()}load(){Lt()}getAlpha(s,t){if(!this.transition_)return 1;let e=this.transitionStarts_[s];if(!e)e=t,this.transitionStarts_[s]=e;else if(e===-1)return 1;const i=t-e+1e3/60;return i>=this.transition_?1:yP(i/this.transition_)}inTransition(s){return this.transition_?this.transitionStarts_[s]!==-1:!1}endTransition(s){this.transition_&&(this.transitionStarts_[s]=-1)}};const dd=AH;function b0(s){return s instanceof Image||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageBitmap?s:null}function Nv(s){return s instanceof Uint8Array||s instanceof Uint8ClampedArray||s instanceof Float32Array||s instanceof DataView?s:null}let oc=null;function LH(s){oc||(oc=ui(s.width,s.height,void 0,{willReadFrequently:!0}));const t=oc.canvas,e=s.width;t.width!==e&&(t.width=e);const i=s.height;return t.height!==i&&(t.height=i),oc.clearRect(0,0,e,i),oc.drawImage(s,0,0),oc.getImageData(0,0,e,i).data}const PH=[256,256];let OH=class extends dd{constructor(s){const t=X.IDLE;super(s.tileCoord,t,{transition:s.transition,interpolate:s.interpolate}),this.loader_=s.loader,this.data_=null,this.error_=null,this.size_=s.size||null}getSize(){if(this.size_)return this.size_;const s=b0(this.data_);return s?[s.width,s.height]:PH}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==X.IDLE&&this.state!==X.ERROR)return;this.state=X.LOADING,this.changed();const s=this;this.loader_().then(function(t){s.data_=t,s.state=X.LOADED,s.changed()}).catch(function(t){s.error_=t,s.state=X.ERROR,s.changed()})}};const Jw=OH,FH=10,bT=.25;class kH{constructor(t,e,i,r,n,o){this.sourceProj_=t,this.targetProj_=e;let a={};const l=go(this.targetProj_,this.sourceProj_);this.transformInv_=function(y){const v=y[0]+"/"+y[1];return a[v]||(a[v]=l(y)),a[v]},this.maxSourceExtent_=r,this.errorThresholdSquared_=n*n,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&Kt(r)>=Kt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Kt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Kt(this.targetProj_.getExtent()):null;const h=va(i),c=H_(i),u=V_(i),d=U_(i),p=this.transformInv_(h),g=this.transformInv_(c),f=this.transformInv_(u),m=this.transformInv_(d),_=FH+(o?Math.max(0,Math.ceil(Math.log2(Gp(i)/(o*o*256*256)))):0);if(this.addQuad_(h,c,u,d,p,g,f,m,_),this.wrapsXInSource_){let y=1/0;this.triangles_.forEach(function(v,b,E){y=Math.min(y,v.source[0][0],v.source[1][0],v.source[2][0])}),this.triangles_.forEach(v=>{if(Math.max(v.source[0][0],v.source[1][0],v.source[2][0])-y>this.sourceWorldWidth_/2){const b=[[v.source[0][0],v.source[0][1]],[v.source[1][0],v.source[1][1]],[v.source[2][0],v.source[2][1]]];b[0][0]-y>this.sourceWorldWidth_/2&&(b[0][0]-=this.sourceWorldWidth_),b[1][0]-y>this.sourceWorldWidth_/2&&(b[1][0]-=this.sourceWorldWidth_),b[2][0]-y>this.sourceWorldWidth_/2&&(b[2][0]-=this.sourceWorldWidth_);const E=Math.min(b[0][0],b[1][0],b[2][0]);Math.max(b[0][0],b[1][0],b[2][0])-E<this.sourceWorldWidth_/2&&(v.source=b)}})}a={}}addTriangle_(t,e,i,r,n,o){this.triangles_.push({source:[r,n,o],target:[t,e,i]})}addQuad_(t,e,i,r,n,o,a,l,h){const c=Cu([n,o,a,l]),u=this.sourceWorldWidth_?Kt(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,p=this.sourceProj_.canWrapX()&&u>.5&&u<1;let g=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const m=Cu([t,e,i,r]);g=Kt(m)/this.targetWorldWidth_>bT||g}!p&&this.sourceProj_.isGlobal()&&u&&(g=u>bT||g)}if(!g&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!li(c,this.maxSourceExtent_))return;let f=0;if(!g&&(!isFinite(n[0])||!isFinite(n[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)g=!0;else if(f=(!isFinite(n[0])||!isFinite(n[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),f!=1&&f!=2&&f!=4&&f!=8)return}if(h>0){if(!g){const m=[(t[0]+i[0])/2,(t[1]+i[1])/2],_=this.transformInv_(m);let y;p?y=(Ko(n[0],d)+Ko(a[0],d))/2-Ko(_[0],d):y=(n[0]+a[0])/2-_[0];const v=(n[1]+a[1])/2-_[1];g=y*y+v*v>this.errorThresholdSquared_}if(g){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const m=[(e[0]+i[0])/2,(e[1]+i[1])/2],_=this.transformInv_(m),y=[(r[0]+t[0])/2,(r[1]+t[1])/2],v=this.transformInv_(y);this.addQuad_(t,e,m,y,n,o,_,v,h-1),this.addQuad_(y,m,i,r,v,_,a,l,h-1)}else{const m=[(t[0]+e[0])/2,(t[1]+e[1])/2],_=this.transformInv_(m),y=[(i[0]+r[0])/2,(i[1]+r[1])/2],v=this.transformInv_(y);this.addQuad_(t,m,y,r,n,_,v,l,h-1),this.addQuad_(m,e,i,y,_,o,a,v,h-1)}return}}if(p){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}f&11||this.addTriangle_(t,i,r,n,a,l),f&14||this.addTriangle_(t,i,e,n,a,o),f&&(f&13||this.addTriangle_(e,r,t,o,l,n),f&7||this.addTriangle_(e,r,i,o,l,a))}calculateSourceExtent(){const t=Ys();return this.triangles_.forEach(function(e,i,r){const n=e.source;up(t,n[0]),up(t,n[1]),up(t,n[2])}),t}getTriangles(){return this.triangles_}}const Qw=kH;let z1;const ea=[];function wT(s,t,e,i,r){s.beginPath(),s.moveTo(0,0),s.lineTo(t,e),s.lineTo(i,r),s.closePath(),s.save(),s.clip(),s.fillRect(0,0,Math.max(t,i)+1,Math.max(e,r)),s.restore()}function B1(s,t){return Math.abs(s[t*4]-210)>2||Math.abs(s[t*4+3]-.75*255)>2}function NH(){if(z1===void 0){const s=ui(6,6,ea);s.globalCompositeOperation="lighter",s.fillStyle="rgba(210, 0, 0, 0.75)",wT(s,4,5,4,0),wT(s,4,5,0,5);const t=s.getImageData(0,0,3,3).data;z1=B1(t,0)||B1(t,4)||B1(t,8),Rh(s),ea.push(s.canvas)}return z1}function ig(s,t,e,i){const r=iw(e,t,s);let n=Q2(t,i,e);const o=t.getMetersPerUnit();o!==void 0&&(n*=o);const a=s.getMetersPerUnit();a!==void 0&&(n/=a);const l=s.getExtent();if(!l||Hr(l,r)){const h=Q2(s,n,r)/n;isFinite(h)&&h>0&&(n/=h)}return n}function JP(s,t,e,i){const r=vs(e);let n=ig(s,t,r,i);return(!isFinite(n)||n<=0)&&MA(e,function(o){return n=ig(s,t,o,i),isFinite(n)&&n>0}),n}function tE(s,t,e,i,r,n,o,a,l,h,c,u,d,p){const g=ui(Math.round(e*s),Math.round(e*t),ea);if(u||(g.imageSmoothingEnabled=!1),l.length===0)return g.canvas;g.scale(e,e);function f(E){return Math.round(E*e)/e}g.globalCompositeOperation="lighter";const m=Ys();l.forEach(function(E,S,T){TA(m,E.extent)});let _;const y=e/i,v=(u?1:1+Math.pow(2,-24))/y;if(!d||l.length!==1||h!==0){if(_=ui(Math.round(Kt(m)*y),Math.round(ci(m)*y),ea),u||(_.imageSmoothingEnabled=!1),r&&p){const E=(r[0]-m[0])*y,S=-(r[3]-m[3])*y,T=Kt(r)*y,R=ci(r)*y;_.rect(E,S,T,R),_.clip()}l.forEach(function(E,S,T){const R=(E.extent[0]-m[0])*y,M=-(E.extent[3]-m[3])*y,A=Kt(E.extent)*y,O=ci(E.extent)*y;E.image.width>0&&E.image.height>0&&_.drawImage(E.image,h,h,E.image.width-2*h,E.image.height-2*h,u?R:Math.round(R),u?M:Math.round(M),u?A:Math.round(R+A)-Math.round(R),u?O:Math.round(M+O)-Math.round(M))})}const b=va(o);return a.getTriangles().forEach(function(E,S,T){const R=E.source,M=E.target;let A=R[0][0],O=R[0][1],N=R[1][0],x=R[1][1],w=R[2][0],C=R[2][1];const I=f((M[0][0]-b[0])/n),L=f(-(M[0][1]-b[1])/n),j=f((M[1][0]-b[0])/n),z=f(-(M[1][1]-b[1])/n),B=f((M[2][0]-b[0])/n),H=f(-(M[2][1]-b[1])/n),Y=A,at=O;A=0,O=0,N-=Y,x-=at,w-=Y,C-=at;const k=[[N,x,0,0,j-I],[w,C,0,0,B-I],[0,0,N,x,z-L],[0,0,w,C,H-L]],it=C5(k);if(!it)return;if(g.save(),g.beginPath(),NH()||!u){g.moveTo(j,z);const ht=4,Pt=I-j,Ct=L-z;for(let ft=0;ft<ht;ft++)g.lineTo(j+f((ft+1)*Pt/ht),z+f(ft*Ct/(ht-1))),ft!=ht-1&&g.lineTo(j+f((ft+1)*Pt/ht),z+f((ft+1)*Ct/(ht-1)));g.lineTo(B,H)}else g.moveTo(j,z),g.lineTo(I,L),g.lineTo(B,H);g.clip(),g.transform(it[0],it[2],it[1],it[3],I,L),g.translate(m[0]-Y,m[3]-at);let nt;if(_)nt=_.canvas,g.scale(v,-v);else{const ht=l[0],Pt=ht.extent;nt=ht.image,g.scale(Kt(Pt)/nt.width,-ci(Pt)/nt.height)}g.drawImage(nt,0,0),g.restore()}),_&&(Rh(_),ea.push(_.canvas)),c&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,a.getTriangles().forEach(function(E,S,T){const R=E.target,M=(R[0][0]-b[0])/n,A=-(R[0][1]-b[1])/n,O=(R[1][0]-b[0])/n,N=-(R[1][1]-b[1])/n,x=(R[2][0]-b[0])/n,w=-(R[2][1]-b[1])/n;g.beginPath(),g.moveTo(O,N),g.lineTo(M,A),g.lineTo(x,w),g.closePath(),g.stroke()}),g.restore()),g.canvas}class DH extends Jw{constructor(t){super({tileCoord:t.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:t.interpolate,transition:t.transition}),this.pixelRatio_=t.pixelRatio,this.gutter_=t.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=t.sourceTileGrid,this.targetTileGrid_=t.targetTileGrid,this.wrappedTileCoord_=t.wrappedTileCoord||t.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const e=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),i=this.targetTileGrid_.getExtent();let r=this.sourceTileGrid_.getExtent();const n=i?us(e,i):e;if(Gp(n)===0){this.state=X.EMPTY;return}const o=t.sourceProj,a=o.getExtent();a&&(r?r=us(r,a):r=a);const l=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),h=t.targetProj,c=JP(o,h,n,l);if(!isFinite(c)||c<=0){this.state=X.EMPTY;return}const u=t.errorThreshold!==void 0?t.errorThreshold:Kw;if(this.triangulation_=new Qw(o,h,n,r,c*u,l),this.triangulation_.getTriangles().length===0){this.state=X.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(c);let d=this.triangulation_.calculateSourceExtent();if(r&&(o.canWrapX()?(d[1]=Jt(d[1],r[1],r[3]),d[3]=Jt(d[3],r[1],r[3])):d=us(d,r)),!Gp(d))this.state=X.EMPTY;else{const p=this.sourceTileGrid_.getTileRangeForExtentAndZ(d,this.sourceZ_),g=t.getTileFunction;for(let f=p.minX;f<=p.maxX;f++)for(let m=p.minY;m<=p.maxY;m++){const _=g(this.sourceZ_,f,m,this.pixelRatio_);_&&this.sourceTiles_.push(_)}this.sourceTiles_.length===0&&(this.state=X.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{if(!e||e.getState()!==X.LOADED)return;const i=e.getSize(),r=this.gutter_;let n;const o=Nv(e.getData());o?n=o:n=LH(b0(e.getData()));const a=[i[0]+2*r,i[1]+2*r],l=n instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,u=new c(n.buffer),d=c.BYTES_PER_ELEMENT,p=d*u.length/h,g=u.byteLength/a[1],f=Math.floor(g/d/a[0]),m=h*f;let _=u;if(u.length!==m){_=new c(m);let y=0,v=0;const b=a[0]*f;for(let E=0;E<a[1];++E){for(let S=0;S<b;++S)_[y++]=u[v+S];v+=g/d}}t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),data:new Uint8Array(_.buffer),dataType:c,bytesPerPixel:p,pixelSize:a})}),this.sourceTiles_.length=0,t.length===0)this.state=X.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),r=typeof i=="number"?i:i[0],n=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let h,c;const u=t[0].bytesPerPixel,d=Math.ceil(u/3);for(let p=d-1;p>=0;--p){const g=[];for(let b=0,E=t.length;b<E;++b){const S=t[b],T=S.data,R=S.pixelSize,M=R[0],A=R[1],O=ui(M,A,ea),N=O.createImageData(M,A),x=N.data;let w=p*3;for(let C=0,I=x.length;C<I;C+=4)x[C]=T[w],x[C+1]=T[w+1],x[C+2]=T[w+2],x[C+3]=255,w+=u;O.putImageData(N,0,0),g.push({extent:S.extent,image:O.canvas})}const f=tE(r,n,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,g,this.gutter_,!1,!1,!1,!0);for(let b=0,E=g.length;b<E;++b){const S=g[b].image.getContext("2d");Rh(S),ea.push(S.canvas)}const m=f.getContext("2d"),_=m.getImageData(0,0,f.width,f.height);Rh(m),ea.push(f),h||(c=new Uint8Array(u*_.width*_.height),h=new t[0].dataType(c.buffer));const y=_.data;let v=p*3;for(let b=0,E=y.length;b<E;b+=4)y[b+3]===255?(c[v]=y[b],c[v+1]=y[b+1],c[v+2]=y[b+2]):(c[v]=0,c[v+1]=0,c[v+2]=0),v+=u}this.reprojData_=h,this.reprojSize_=[Math.round(r*this.pixelRatio_),Math.round(n*this.pixelRatio_)],this.state=X.LOADED}this.changed()}load(){if(this.state!==X.IDLE&&this.state!==X.ERROR)return;this.state=X.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(e=>{const i=e.getState();if(i!==X.IDLE&&i!==X.LOADING)return;t++;const r=Ai(e,fe.CHANGE,function(){const n=e.getState();(n==X.LOADED||n==X.ERROR||n==X.EMPTY)&&(cs(r),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e){e.getState()==X.IDLE&&e.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(cs),this.sourcesListenerKeys_=null}}const eE=DH;class $H extends dd{constructor(t,e,i,r,n,o,a,l,h,c,u,d){super(n,X.IDLE,d),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=r,this.wrappedTileCoord_=o||n,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const p=r.getTileCoordExtent(this.wrappedTileCoord_),g=this.targetTileGrid_.getExtent();let f=this.sourceTileGrid_.getExtent();const m=g?us(p,g):p;if(Gp(m)===0){this.state=X.EMPTY;return}const _=t.getExtent();_&&(f?f=us(f,_):f=_);const y=r.getResolution(this.wrappedTileCoord_[0]),v=JP(t,i,m,y);if(!isFinite(v)||v<=0){this.state=X.EMPTY;return}const b=c!==void 0?c:Kw;if(this.triangulation_=new Qw(t,i,m,f,v*b,y),this.triangulation_.getTriangles().length===0){this.state=X.EMPTY;return}this.sourceZ_=e.getZForResolution(v);let E=this.triangulation_.calculateSourceExtent();if(f&&(t.canWrapX()?(E[1]=Jt(E[1],f[1],f[3]),E[3]=Jt(E[3],f[1],f[3])):E=us(E,f)),!Gp(E))this.state=X.EMPTY;else{const S=e.getTileRangeForExtentAndZ(E,this.sourceZ_);for(let T=S.minX;T<=S.maxX;T++)for(let R=S.minY;R<=S.maxY;R++){const M=h(this.sourceZ_,T,R,a);M&&this.sourceTiles_.push(M)}this.sourceTiles_.length===0&&(this.state=X.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{e&&e.getState()==X.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}),this.sourceTiles_.length=0,t.length===0)this.state=X.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),r=typeof i=="number"?i:i[0],n=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=tE(r,n,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=X.LOADED}this.changed()}load(){if(this.state==X.IDLE){this.state=X.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(e=>{const i=e.getState();if(i==X.IDLE||i==X.LOADING){t++;const r=Ai(e,fe.CHANGE,function(n){const o=e.getState();(o==X.LOADED||o==X.ERROR||o==X.EMPTY)&&(cs(r),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,i,r){e.getState()==X.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(cs),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Rh(this.canvas_.getContext("2d")),ea.push(this.canvas_),this.canvas_=null),super.release()}}const Ou=$H;class jH extends dd{constructor(t,e,i,r,n,o){super(t,e,o),this.crossOrigin_=r,this.src_=i,this.key=i,this.image_=new Image,r!==null&&(this.image_.crossOrigin=r),this.unlisten_=null,this.tileLoadFunction_=n}getImage(){return this.image_}setImage(t){this.image_=t,this.state=X.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=X.ERROR,this.unlistenImage_(),this.image_=GH(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=X.LOADED:this.state=X.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==X.ERROR&&(this.state=X.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==X.IDLE&&(this.state=X.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=p4(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function GH(){const s=ui(1,1);return s.fillStyle="rgba(0,0,0,0)",s.fillRect(0,0,1,1),s.canvas}const tf=jH;class zH extends Dg{constructor(t){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=t.gutter||0,this.helper_=t.helper,this.loaded=!1,this.ready=!1}setTile(t){if(t!==this.tile)if(this.tile&&this.tile.removeEventListener(fe.CHANGE,this.handleTileChange_),this.tile=t,this.loaded=t.getState()===X.LOADED,this.loaded)this.uploadTile();else{if(t instanceof tf){const e=t.getImage();e instanceof Image&&!e.crossOrigin&&(e.crossOrigin="anonymous")}t.addEventListener(fe.CHANGE,this.handleTileChange_)}}uploadTile(){Lt()}setReady(){this.ready=!0,this.dispatchEvent(fe.CHANGE)}handleTileChange_(){this.tile.getState()===X.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(fe.CHANGE,this.handleTileChange_)}}const BH=zH;function QP(s,t,e){const i=e?s.LINEAR:s.NEAREST;s.bindTexture(s.TEXTURE_2D,t),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,i),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,i)}function UH(s,t,e,i){QP(s,t,i),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,e)}function ET(s,t,e,i,r,n){const o=s.getGL();let a,l;e instanceof Float32Array?(a=o.FLOAT,s.getExtension("OES_texture_float"),l=s.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),QP(o,t,n&&l);const h=e.byteLength/i[1];let c=1;h%8===0?c=8:h%4===0?c=4:h%2===0&&(c=2);let u;switch(r){case 1:{u=o.LUMINANCE;break}case 2:{u=o.LUMINANCE_ALPHA;break}case 3:{u=o.RGB;break}case 4:{u=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${r}`)}const d=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,c),o.texImage2D(o.TEXTURE_2D,0,u,i[0],i[1],0,u,a,e),o.pixelStorei(o.UNPACK_ALIGNMENT,d)}let Ec=null;function VH(){Ec=ui(1,1,void 0,{willReadFrequently:!0})}class HH extends BH{constructor(t){super(t),this.textures=[],this.renderSize_=xi(t.grid.getTileSize(t.tile.tileCoord[0])),this.bandCount=NaN;const e=new x0(cy,Zw);e.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(e),this.coords=e,this.setTile(t.tile)}uploadTile(){const t=this.helper_,e=t.getGL(),i=this.tile;this.textures.length=0;let r;i instanceof tf||i instanceof Ou?r=i.getImage():r=i.getData();const n=b0(r);if(n){const y=e.createTexture();this.textures.push(y),this.bandCount=4,UH(e,y,n,i.interpolate),this.setReady();return}r=Nv(r);const o=i.getSize(),a=[o[0]+2*this.gutter_,o[1]+2*this.gutter_],l=r instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,u=c.BYTES_PER_ELEMENT,d=r.byteLength/a[1];this.bandCount=Math.floor(d/u/a[0]);const p=Math.ceil(this.bandCount/4);if(p===1){const y=e.createTexture();this.textures.push(y),ET(t,y,r,a,this.bandCount,i.interpolate),this.setReady();return}const g=new Array(p);for(let y=0;y<p;++y){const v=e.createTexture();this.textures.push(v);const b=y<p-1?4:(this.bandCount-1)%4+1;g[y]=new c(h*b)}let f=0,m=0;const _=a[0]*this.bandCount;for(let y=0;y<a[1];++y){for(let v=0;v<_;++v){const b=r[m+v],E=Math.floor(f/this.bandCount),S=v%this.bandCount,T=Math.floor(S/4),R=g[T],M=R.length/h,A=S%4;R[E*M+A]=b,++f}m+=d/u}for(let y=0;y<p;++y){const v=this.textures[y],b=g[y],E=b.length/h;ET(t,v,b,a,E,i.interpolate)}this.setReady()}disposeInternal(){const t=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let e=0;e<this.textures.length;++e)t.deleteTexture(this.textures[e]);this.tile.removeEventListener(fe.CHANGE,this.handleTileChange_)}getImagePixelData_(t,e,i){const r=this.gutter_,n=this.renderSize_[0],o=this.renderSize_[1];Ec||VH(),Ec.clearRect(0,0,1,1);const a=t.width,l=t.height,h=a-2*r,c=l-2*r,u=r+Math.floor(h*(e/n)),d=r+Math.floor(c*(i/o));let p;try{Ec.drawImage(t,u,d,1,1,0,0,1,1),p=Ec.getImageData(0,0,1,1).data}catch{return Ec=null,null}return p}getArrayPixelData_(t,e,i,r){const n=this.gutter_,o=this.renderSize_[0],a=this.renderSize_[1],l=e[0],h=e[1],c=l+2*n,u=h+2*n,d=n+Math.floor(l*(i/o)),p=n+Math.floor(h*(r/a));if(t instanceof DataView){const f=t.byteLength/(c*u),m=f*(p*c+d),_=t.buffer.slice(m,m+f);return new DataView(_)}const g=this.bandCount*(p*c+d);return t.slice(g,g+this.bandCount)}getPixelData(t,e){if(!this.loaded)return null;if(this.tile instanceof Jw){const i=this.tile.getData(),r=Nv(i);if(r){const n=this.tile.getSize();return this.getArrayPixelData_(r,n,t,e)}return this.getImagePixelData_(b0(i),t,e)}return this.getImagePixelData_(this.tile.getImage(),t,e)}}const WH=HH;class XH{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const i=this.entries_[t];return ge(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(t){const e=this.entries_[t];return ge(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.key_;return t}getValues(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){var e;return(e=this.entries_[t])==null?void 0:e.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){ge(!(t in this.entries_),"Tried to set a value for a key that is used already");const i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}setSize(t){this.highWaterMark=t}}const iE=XH;let tO=class{constructor(t,e,i,r){this.minX=t,this.maxX=e,this.minY=i,this.maxY=r}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}};function ac(s,t,e,i,r){return r!==void 0?(r.minX=s,r.maxX=t,r.minY=e,r.maxY=i,r):new tO(s,t,e,i)}const sE=tO;function sg(s,t,e,i){return i!==void 0?(i[0]=s,i[1]=t,i[2]=e,i):[s,t,e]}function _o(s,t,e){return s+"/"+t+"/"+e}function tl(s){return _o(s[0],s[1],s[2])}function qH(s){const[t,e,i]=s.substring(s.lastIndexOf("/")+1,s.length).split(",").map(Number);return _o(t,e,i)}function eO(s){return s.split("/").map(Number)}function rE(s){return(s[1]<<s[0])+s[2]}function YH(s,t){const e=s[0],i=s[1],r=s[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const n=t.getFullTileRange(e);return n?n.containsXY(i,r):!0}const ZH={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},KH={};function ST(s){return 1/(s+2)}function JH(){return{tileIds:new Set,representationsByZ:{}}}function CT(s,t){return s.tileIds.has(xt(t))}function TT(s,t,e){const i=s.representationsByZ;e in i||(i[e]=new Set),i[e].add(t),s.tileIds.add(xt(t.tile))}function U1(s,t){const e=s.layerStatesArray[s.layerIndex];e.extent&&(t=us(t,Ln(e.extent,s.viewState.projection)));const i=e.layer.getRenderSource();if(!i.getWrapX()){const r=i.getTileGridForProjection(s.viewState.projection).getExtent();r&&(t=us(t,r))}return t}function Dv(s,t){return`${s.getKey()},${tl(t)}`}class QH extends WP{constructor(t,e){super(t,{uniforms:e.uniforms,postProcesses:e.postProcesses}),this.renderComplete=!1,this.tileTransform_=Ki(),this.tempMat4=BP(),this.tempTileRange_=new sE(0,0,0,0),this.tempTileCoord_=sg(0,0,0),this.tempSize_=[0,0];const i=e.cacheSize!==void 0?e.cacheSize:512;this.tileRepresentationCache=new iE(i),this.frameState=null,this.projection_=void 0}reset(t){super.reset({uniforms:t.uniforms})}isDrawableTile_(t){const e=this.getLayer(),i=t.getState(),r=e.getUseInterimTilesOnError();return i==X.LOADED||i==X.EMPTY||i==X.ERROR&&!r}prepareFrameInternal(t){this.projection_?t.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=t.viewState.projection):this.projection_=t.viewState.projection;const e=this.getLayer().getRenderSource();return!e||ba(U1(t,t.extent))?!1:e.getState()==="ready"}createTileRepresentation(t){return Lt()}enqueueTiles(t,e,i,r,n){const o=t.viewState,a=this.getLayer(),l=a.getRenderSource(),h=l.getTileGridForProjection(o.projection),c=l.getGutterForProjection(o.projection),u=xt(l);u in t.wantedTiles||(t.wantedTiles[u]={});const d=t.wantedTiles[u],p=this.tileRepresentationCache,g=a.getMapInternal(),f=Math.max(i-n,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),g?g.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),l.zDirection));for(let m=i;m>=f;--m){const _=h.getTileRangeForExtentAndZ(e,m,this.tempTileRange_),y=h.getResolution(m);for(let v=_.minX;v<=_.maxX;++v)for(let b=_.minY;b<=_.maxY;++b){const E=sg(m,v,b,this.tempTileCoord_),S=Dv(l,E);let T,R;if(p.containsKey(S)&&(T=p.get(S),R=T.tile),(!T||T.tile.key!==l.getKey())&&(R=l.getTile(m,v,b,t.pixelRatio,o.projection)),CT(r,R))continue;if(!T)T=this.createTileRepresentation({tile:R,grid:h,helper:this.helper,gutter:c}),p.set(S,T);else if(this.isDrawableTile_(R))T.setTile(R);else{const A=R.getInterimTile();T.setTile(A)}TT(r,T,m);const M=R.getKey();d[M]=!0,R.getState()===X.IDLE&&(t.tileQueue.isKeyQueued(M)||t.tileQueue.enqueue([R,u,h.getTileCoordCenter(E),y]))}}}beforeTilesRender(t,e){this.helper.prepareDraw(this.frameState,!e,!0)}beforeTilesMaskRender(t){return!1}renderTile(t,e,i,r,n,o,a,l,h,c,u){}renderTileMask(t,e,i,r){}drawTile_(t,e,i,r,n,o,a){if(!e.ready)return;const l=e.tile.tileCoord,h=tl(l),c=h in o?o[h]:1,u=a.getResolution(i),d=xi(a.getTileSize(i),this.tempSize_),p=a.getOrigin(i),g=a.getTileCoordExtent(l),f=c<1?-1:ST(i);c<1&&(t.animate=!0);const m=t.viewState,_=m.center[0],y=m.center[1],v=d[0]+2*r,b=d[1]+2*r,E=v/b,S=(_-p[0])/(d[0]*u),T=(p[1]-y)/(d[1]*u),R=m.resolution/u,M=l[1],A=l[2];Qx(this.tileTransform_),cp(this.tileTransform_,2/(t.size[0]*R/v),-2/(t.size[1]*R/v)),r5(this.tileTransform_,m.rotation),cp(this.tileTransform_,1,1/E),Wb(this.tileTransform_,(d[0]*(M-S)-r)/v,(d[1]*(A-T)-r)/b),this.renderTile(e,this.tileTransform_,t,n,u,d,p,g,f,r,c)}renderFrame(t){this.frameState=t,this.renderComplete=!0;const e=this.helper.getGL();this.preRender(e,t);const i=t.viewState,r=this.getLayer(),n=r.getRenderSource(),o=n.getTileGridForProjection(i.projection),a=n.getGutterForProjection(i.projection),l=U1(t,t.extent),h=o.getZForResolution(i.resolution,n.zDirection),c=JH(),u=r.getPreload();if(t.nextExtent){const E=o.getZForResolution(i.nextResolution,n.zDirection),S=U1(t,t.nextExtent);this.enqueueTiles(t,S,E,c,u)}this.enqueueTiles(t,l,h,c,0),u>0&&setTimeout(()=>{this.enqueueTiles(t,l,h-1,c,u-1)},0);const d={},p=xt(this),g=t.time;let f=!1;for(const E of c.representationsByZ[h]){const S=E.tile;if((S instanceof Ou||S instanceof eE)&&S.getState()===X.EMPTY)continue;const T=S.tileCoord;if(E.ready){const M=S.getAlpha(p,g);if(M===1){S.endTransition(p);continue}f=!0;const A=tl(T);d[A]=M}if(this.renderComplete=!1,this.findAltTiles_(o,T,h+1,c))continue;const R=o.getMinZoom();for(let M=h-1;M>=R&&!this.findAltTiles_(o,T,M,c);--M);}const m=c.representationsByZ,_=Object.keys(m).map(Number).sort(X3);if(this.beforeTilesMaskRender(t))for(let E=0,S=_.length;E<S;++E){const T=_[E];for(const R of m[T]){const M=R.tile.tileCoord;if(tl(M)in d)continue;const A=o.getTileCoordExtent(M);this.renderTileMask(R,T,A,ST(T))}}this.beforeTilesRender(t,f);for(let E=0,S=_.length;E<S;++E){const T=_[E];for(const R of m[T]){const M=R.tile.tileCoord;tl(M)in d||this.drawTile_(t,R,T,a,l,d,o)}}for(const E of m[h]){const S=E.tile.tileCoord;tl(S)in d&&this.drawTile_(t,E,h,a,l,d,o)}this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const y=this.helper.getCanvas(),v=this.tileRepresentationCache;for(;v.canExpireCache();)v.pop().dispose();const b=function(E,S){n.updateCacheSize(.1,S.viewState.projection),n.expireCache(S.viewState.projection,KH)};return t.postRenderFunctions.push(b),this.postRender(e,t),y}findAltTiles_(t,e,i,r){const n=t.getTileRangeForTileCoordAndZ(e,i,this.tempTileRange_);if(!n)return!1;let o=!0;const a=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let h=n.minX;h<=n.maxX;++h)for(let c=n.minY;c<=n.maxY;++c){const u=Dv(l,[i,h,c]);let d=!1;if(a.containsKey(u)){const p=a.get(u);p.ready&&!CT(r,p.tile)&&(TT(r,p,i),d=!0)}d||(o=!1)}return o}clearCache(){const t=this.tileRepresentationCache;t.forEach(e=>e.dispose()),t.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const t7=QH,re={...ZH,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},Nm={TEXTURE_COORD:"a_textureCoord"},e7=[{name:Nm.TEXTURE_COORD,size:2,type:Qn.FLOAT}];class i7 extends t7{constructor(t,e){super(t,e),this.program_,this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.indices_=new x0(uy,Zw),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=e.paletteTextures||[]}reset(t){super.reset(t),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.paletteTextures_=t.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(t){return new WH(t)}beforeTilesRender(t,e){super.beforeTilesRender(t,e),this.helper.useProgram(this.program_,t)}renderTile(t,e,i,r,n,o,a,l,h,c,u){const d=this.helper.getGL();this.helper.bindBuffer(t.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(e7);let p=0;for(;p<t.textures.length;){const E=`${re.TILE_TEXTURE_ARRAY}[${p}]`;this.helper.bindTexture(t.textures[p],p,E),++p}for(let E=0;E<this.paletteTextures_.length;++E){const S=this.paletteTextures_[E],T=S.getTexture(d);this.helper.bindTexture(T,p,S.name),++p}const g=i.viewState,f=o[0]+2*c,m=o[1]+2*c,_=t.tile.tileCoord,y=_[1],v=_[2];this.helper.setUniformMatrixValue(re.TILE_TRANSFORM,UP(this.tempMat4,e)),this.helper.setUniformFloatValue(re.TRANSITION_ALPHA,u),this.helper.setUniformFloatValue(re.DEPTH,h);let b=r;c>0&&(b=l,us(b,r,b)),this.helper.setUniformFloatVec4(re.RENDER_EXTENT,b),this.helper.setUniformFloatValue(re.RESOLUTION,g.resolution),this.helper.setUniformFloatValue(re.ZOOM,g.zoom),this.helper.setUniformFloatValue(re.TEXTURE_PIXEL_WIDTH,f),this.helper.setUniformFloatValue(re.TEXTURE_PIXEL_HEIGHT,m),this.helper.setUniformFloatValue(re.TEXTURE_RESOLUTION,n),this.helper.setUniformFloatValue(re.TEXTURE_ORIGIN_X,a[0]+y*o[0]*n-c*n),this.helper.setUniformFloatValue(re.TEXTURE_ORIGIN_Y,a[1]-v*o[1]*n+c*n),this.helper.drawElements(0,this.indices_.getSize())}getData(t){if(!this.helper.getGL())return null;const e=this.frameState;if(!e)return null;const i=this.getLayer(),r=Ii(e.pixelToCoordinateTransform,t.slice()),n=e.viewState,o=i.getExtent();if(o&&!Hr(Ln(o,n.projection),r))return null;const a=i.getSources(Cu([r]),n.resolution);let l,h,c;for(l=a.length-1;l>=0;--l)if(h=a[l],h.getState()==="ready"){if(c=h.getTileGridForProjection(n.projection),h.getWrapX())break;const d=c.getExtent();if(!d||Hr(d,r))break}if(l<0)return null;const u=this.tileRepresentationCache;for(let d=c.getZForResolution(n.resolution);d>=c.getMinZoom();--d){const p=c.getTileCoordForCoordAndZ(r,d),g=Dv(h,p);if(!u.containsKey(g))continue;const f=u.get(g),m=f.tile;if((m instanceof Ou||m instanceof eE)&&m.getState()===X.EMPTY)return null;if(!f.loaded)continue;const _=c.getOrigin(d),y=xi(c.getTileSize(d)),v=c.getResolution(d),b=(r[0]-_[0])/v-p[1]*y[0],E=(_[1]-r[1])/v-p[2]*y[1];return f.getPixelData(b,E)}return null}disposeInternal(){const t=this.helper;t&&(t.getGL().deleteProgram(this.program_),delete this.program_,t.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_}}const s7=i7;function r7(s,t){return`operator_${s}_${Object.keys(t.functions).length}`}function bh(s){const t=s.toString();return t.includes(".")?t:t+".0"}function nE(s){if(s.length<2||s.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${s.length}(${s.map(bh).join(", ")})`}function Dm(s){const t=jn(s),e=t.length>3?t[3]:1;return nE([t[0]/255*e,t[1]/255*e,t[2]/255*e,e])}const V1={};let n7=0;function w0(s){return s in V1||(V1[s]=n7++),V1[s]}function Ho(s){return bh(w0(s))}function oE(s){return"u_var_"+s}function o7(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{}}}const H1="getBandValue",iO="u_paletteTextures";function a7(s,t,e,i){const r=Ue(s,e,t);if(Yg(r.type,Uh))throw new Error("No matching type was found");if(!kn(t,r.type)){const n=ds(t),o=ds(r.type);throw new Error(`Expected expression to be of type ${n}, got ${o}`)}return aE(r,t,i)}function Pe(s){return(t,e,i)=>{const r=e.args.length,n=new Array(r);for(let o=0;o<r;++o)n[o]=aE(e.args[o],i,t);return s(n,t)}}const l7={[V.Get]:(s,t)=>{const e=t.args[0].value;return e in s.properties||(s.properties[e]={name:e,type:t.type}),(s.inFragmentShader?"v_prop_":"a_prop_")+e},[V.GeometryType]:(s,t,e)=>{const i="geometryType";return i in s.properties||(s.properties[i]={name:i,type:Is,evaluator:r=>Vw(r.getGeometry())}),(s.inFragmentShader?"v_prop_":"a_prop_")+i},[V.Var]:(s,t)=>{const e=t.args[0].value;return e in s.variables||(s.variables[e]={name:e,type:t.type}),oE(e)},[V.Resolution]:()=>"u_resolution",[V.Zoom]:()=>"u_zoom",[V.Time]:()=>"u_time",[V.Any]:Pe(s=>`(${s.join(" || ")})`),[V.All]:Pe(s=>`(${s.join(" && ")})`),[V.Not]:Pe(([s])=>`(!${s})`),[V.Equal]:Pe(([s,t])=>`(${s} == ${t})`),[V.NotEqual]:Pe(([s,t])=>`(${s} != ${t})`),[V.GreaterThan]:Pe(([s,t])=>`(${s} > ${t})`),[V.GreaterThanOrEqualTo]:Pe(([s,t])=>`(${s} >= ${t})`),[V.LessThan]:Pe(([s,t])=>`(${s} < ${t})`),[V.LessThanOrEqualTo]:Pe(([s,t])=>`(${s} <= ${t})`),[V.Multiply]:Pe(s=>`(${s.join(" * ")})`),[V.Divide]:Pe(([s,t])=>`(${s} / ${t})`),[V.Add]:Pe(s=>`(${s.join(" + ")})`),[V.Subtract]:Pe(([s,t])=>`(${s} - ${t})`),[V.Clamp]:Pe(([s,t,e])=>`clamp(${s}, ${t}, ${e})`),[V.Mod]:Pe(([s,t])=>`mod(${s}, ${t})`),[V.Pow]:Pe(([s,t])=>`pow(${s}, ${t})`),[V.Abs]:Pe(([s])=>`abs(${s})`),[V.Floor]:Pe(([s])=>`floor(${s})`),[V.Ceil]:Pe(([s])=>`ceil(${s})`),[V.Round]:Pe(([s])=>`floor(${s} + 0.5)`),[V.Sin]:Pe(([s])=>`sin(${s})`),[V.Cos]:Pe(([s])=>`cos(${s})`),[V.Atan]:Pe(([s,t])=>t!==void 0?`atan(${s}, ${t})`:`atan(${s})`),[V.Sqrt]:Pe(([s])=>`sqrt(${s})`),[V.Match]:Pe(s=>{const t=s[0],e=s[s.length-1];let i=null;for(let r=s.length-3;r>=1;r-=2){const n=s[r],o=s[r+1];i=`(${t} == ${n} ? ${o} : ${i||e})`}return i}),[V.Between]:Pe(([s,t,e])=>`(${s} >= ${t} && ${s} <= ${e})`),[V.Interpolate]:Pe(([s,t,...e])=>{let i="";for(let r=0;r<e.length-2;r+=2){const n=e[r],o=i||e[r+1],a=e[r+2],l=e[r+3];let h;s===bh(1)?h=`(${t} - ${n}) / (${a} - ${n})`:h=`(pow(${s}, (${t} - ${n})) - 1.0) / (pow(${s}, (${a} - ${n})) - 1.0)`,i=`mix(${o}, ${l}, clamp(${h}, 0.0, 1.0))`}return i}),[V.Case]:Pe(s=>{const t=s[s.length-1];let e=null;for(let i=s.length-3;i>=0;i-=2){const r=s[i],n=s[i+1];e=`(${r} ? ${n} : ${e||t})`}return e}),[V.In]:Pe(([s,...t],e)=>{const i=r7("in",e),r=[];for(let n=0;n<t.length;n+=1)r.push(`  if (inputValue == ${t[n]}) { return true; }`);return e.functions[i]=`bool ${i}(float inputValue) {
${r.join(`
`)}
  return false;
}`,`${i}(${s})`}),[V.Array]:Pe(s=>`vec${s.length}(${s.join(", ")})`),[V.Color]:Pe(s=>{if(s.length===1)return`vec4(vec3(${s[0]} / 255.0), 1.0)`;if(s.length===2)return`(${s[1]} * vec4(vec3(${s[0]} / 255.0), 1.0))`;const t=s.slice(0,3).map(e=>`${e} / 255.0`);return s.length===3?`vec4(${t.join(", ")}, 1.0)`:`(${s[3]} * vec4(${t.join(", ")}, 1.0))`}),[V.Band]:Pe(([s,t,e],i)=>{if(!(H1 in i.functions)){let r="";const n=i.bandCount||1;for(let o=0;o<n;o++){const a=Math.floor(o/4);let l=o%4;o===n-1&&l===1&&(l=3);const h=`${re.TILE_TEXTURE_ARRAY}[${a}]`;r+=`  if (band == ${o+1}.0) {
    return texture2D(${h}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}i.functions[H1]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${re.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${re.TEXTURE_PIXEL_HEIGHT};
${r}
}`}return`${H1}(${s}, ${t??"0.0"}, ${e??"0.0"})`}),[V.Palette]:(s,t)=>{const[e,...i]=t.args,r=i.length,n=new Uint8Array(r*4);for(let h=0;h<i.length;h++){const c=i[h].value,u=jn(c),d=h*4;n[d]=u[0],n[d+1]=u[1],n[d+2]=u[2],n[d+3]=u[3]*255}s.paletteTextures||(s.paletteTextures=[]);const o=`${iO}[${s.paletteTextures.length}]`,a=new IH(o,n);s.paletteTextures.push(a);const l=aE(e,st,s);return`texture2D(${o}, vec2((${l} + 0.5) / ${r}.0, 0.5))`}};function aE(s,t,e){if(s instanceof bP){const i=l7[s.operator];if(i===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(s.operator)}`);return i(e,s,t)}if((s.type&st)>0)return bh(s.value);if((s.type&mi)>0)return s.value.toString();if((s.type&Is)>0)return Ho(s.value.toString());if((s.type&ei)>0)return Dm(s.value);if((s.type&Ji)>0)return nE(s.value);throw new Error(`Unexpected expression ${s.value} (expected type ${ds(t)})`)}function h7(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}const lc=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;

// this used to produce an alpha-premultiplied color from a texture
vec4 samplePremultiplied(sampler2D sampler, vec2 texCoord) {
  vec4 color = texture2D(sampler, texCoord);
  return vec4(color.rgb * color.a, color.a);
}
`,hc=h7();let sO=class{constructor(){this.uniforms_=[],this.attributes_=[],this.varyings_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${bh(hc["circle-radius"])} + ${bh(hc["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=Dm(hc["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=bh(hc["stroke-width"]),this.strokeColorExpression_=Dm(hc["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=Ho("round"),this.strokeJoinExpression_=Ho("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.hasFill_=!1,this.fillColorExpression_=Dm(hc["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(t){return this.uniforms_.push(t),this}addAttribute(t){return this.attributes_.push(t),this}addVarying(t,e,i){return this.varyings_.push({name:t,type:e,expression:i}),this}setSymbolSizeExpression(t){return this.hasSymbol_=!0,this.symbolSizeExpression_=t,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(t){return this.symbolRotationExpression_=t,this}setSymbolOffsetExpression(t){return this.symbolOffsetExpression_=t,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(t){return this.hasSymbol_=!0,this.symbolColorExpression_=t,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(t){return this.texCoordExpression_=t,this}setFragmentDiscardExpression(t){return this.discardExpression_=t,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(t){return this.symbolRotateWithView_=t,this}setStrokeWidthExpression(t){return this.hasStroke_=!0,this.strokeWidthExpression_=t,this}setStrokeColorExpression(t){return this.hasStroke_=!0,this.strokeColorExpression_=t,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(t){return this.strokeOffsetExpression_=t,this}setStrokeCapExpression(t){return this.strokeCapExpression_=t,this}setStrokeJoinExpression(t){return this.strokeJoinExpression_=t,this}setStrokeMiterLimitExpression(t){return this.strokeMiterLimitExpression_=t,this}setStrokeDistanceFieldExpression(t){return this.strokeDistanceFieldExpression_=t,this}setFillColorExpression(t){return this.hasFill_=!0,this.fillColorExpression_=t,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(t){this.vertexShaderFunctions_.includes(t)||this.vertexShaderFunctions_.push(t)}addFragmentShaderFunction(t){this.fragmentShaderFunctions_.includes(t)||this.fragmentShaderFunctions_.push(t)}getSymbolVertexShader(){return this.hasSymbol_?`${lc}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(t){return"attribute "+t+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_prop_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx;
  if (a_index == 0.0) {
    offsetPx -= halfSizePx;
  } else if (a_index == 1.0) {
    offsetPx += halfSizePx * vec2(1., -1.);
  } else if (a_index == 2.0) {
    offsetPx += halfSizePx;
  } else {
    offsetPx += halfSizePx * vec2(-1., 1.);
  }
  float angle = ${this.symbolRotationExpression_};
  ${this.symbolRotateWithView_?"angle += u_rotation;":""}
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;
  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;
  v_texCoord = vec2(u, v);
  v_prop_hitColor = a_prop_hitColor;
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y); 
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.varyings_.map(function(t){return"  "+t.name+" = "+t.expression+";"}).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${lc}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_prop_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${lc}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute float a_parameters;
attribute float a_distance;
attribute vec2 a_joinAngles;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(t){return"attribute "+t+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_prop_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float vertexNumber = floor(abs(a_parameters) / 10000. + 0.5);
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)
  float angleTangentSum = fract(abs(a_parameters) / 10000.) * 10000. * sign(a_parameters);

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);
  
  // compute current vertex position
  float normalDir = vertexNumber < 0.5 || (vertexNumber > 1.5 && vertexNumber < 2.5) ? 1.0 : -1.0;
  float tangentDir = vertexNumber < 1.5 ? 1.0 : -1.0;
  float angle = vertexNumber < 1.5 ? v_angleStart : v_angleEnd;
  vec2 joinDirection;
  vec2 positionPx = vertexNumber < 1.5 ? segmentStartPx : segmentEndPx;
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${vT} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStart = segmentStartPx;
  v_segmentEnd = segmentEndPx;
  v_width = lineWidth;
  v_prop_hitColor = a_prop_hitColor;
  v_distanceOffsetPx = a_distance / u_resolution - (lineOffsetPx * angleTangentSum);
${this.varyings_.map(function(t){return"  "+t.name+" = "+t.expression+";"}).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${lc}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_prop_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${vT}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${Ho("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${Ho("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${Ho("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${Ho("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

void main(void) {
  vec2 currentPoint = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPoint);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }

  float segmentLength = length(v_segmentEnd - v_segmentStart);
  vec2 segmentTangent = (v_segmentEnd - v_segmentStart) / segmentLength;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPoint = currentPoint - v_segmentStart;
  float currentLengthPx = max(0., min(dot(segmentTangent, startToPoint), segmentLength)) + v_distanceOffsetPx; 
  float currentRadiusPx = abs(dot(segmentNormal, startToPoint));
  float currentRadiusRatio = dot(segmentNormal, startToPoint) * 2. / v_width;
  vec4 color = ${this.strokeColorExpression_} * u_globalAlpha;
  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPoint, v_segmentStart, v_segmentEnd, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPoint, v_segmentEnd, v_segmentStart, v_width, v_angleEnd, capType, joinType);
  float distance = max(
    segmentDistanceField(currentPoint, v_segmentStart, v_segmentEnd, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distance = max(distance, ${this.strokeDistanceFieldExpression_});
  gl_FragColor = color * smoothstep(0.5, -0.5, distance);
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${lc}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
attribute vec2 a_position;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(t){return"attribute "+t+";"}).join(`
`)}
varying vec4 v_prop_hitColor;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_prop_hitColor = a_prop_hitColor;
${this.varyings_.map(function(t){return"  "+t.name+" = "+t.expression+";"}).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${lc}
${this.uniforms_.map(function(t){return"uniform "+t+";"}).join(`
`)}
varying vec4 v_prop_hitColor;
${this.varyings_.map(function(t){return"varying "+t.type+" "+t.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_} * u_globalAlpha;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}};const bn={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},c7=["#00f","#0ff","#0f0","#ff0","#f00"];class u7 extends Kg{constructor(t){t=t||{};const e=Object.assign({},t);delete e.gradient,delete e.radius,delete e.blur,delete e.weight,super(e),this.gradient_=null,this.addChangeListener(bn.GRADIENT,this.handleGradientChanged_),this.setGradient(t.gradient?t.gradient:c7),this.setBlur(t.blur!==void 0?t.blur:15),this.setRadius(t.radius!==void 0?t.radius:8);const i=t.weight?t.weight:"weight";typeof i=="string"?this.weightFunction_=function(r){return r.get(i)}:this.weightFunction_=i,this.setRenderOrder(null)}getBlur(){return this.get(bn.BLUR)}getGradient(){return this.get(bn.GRADIENT)}getRadius(){return this.get(bn.RADIUS)}handleGradientChanged_(){this.gradient_=d7(this.getGradient())}setBlur(t){this.set(bn.BLUR,t)}setGradient(t){this.set(bn.GRADIENT,t)}setRadius(t){this.set(bn.RADIUS,t)}createRenderer(){const t=new sO().addAttribute("float a_prop_weight").addVarying("v_prop_weight","float","a_prop_weight").addUniform("float u_size").addUniform("float u_blurSlope").setSymbolSizeExpression("vec2(u_size)").setSymbolColorExpression("vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * u_blurSlope) * v_prop_weight)");return new KP(this,{className:this.getClassName(),attributes:[{name:"weight",callback:e=>{const i=this.weightFunction_(e);return i!==void 0?Jt(i,0,1):1}}],uniforms:{u_size:()=>(this.get(bn.RADIUS)+this.get(bn.BLUR))*2,u_blurSlope:()=>this.get(bn.RADIUS)/Math.max(1,this.get(bn.BLUR))},hitDetectionEnabled:!0,vertexShader:t.getSymbolVertexShader(),fragmentShader:t.getSymbolFragmentShader(),postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}renderDeclutter(){}}function d7(s){const t=ui(1,256),e=t.createLinearGradient(0,0,1,256),i=1/(s.length-1);for(let r=0,n=s.length;r<n;++r)e.addColorStop(r*i,s[r]);return t.fillStyle=e,t.fillRect(0,0,1,256),t.canvas}const p7=u7;class g7 extends qg{constructor(t){t=t||{},super(t)}}const f7=g7;class m7 extends Xw{constructor(t){super(t),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(t){const e=t.layerStatesArray[t.layerIndex],i=t.pixelRatio,r=t.viewState,n=r.resolution,o=this.getLayer().getSource(),a=t.viewHints;let l=t.extent;if(e.extent!==void 0&&(l=us(l,Ln(e.extent,r.projection))),!a[Ei.ANIMATING]&&!a[Ei.INTERACTING]&&!ba(l))if(o){const h=r.projection,c=o.getImage(l,n,i,h);c&&(this.loadImage(c)?this.image_=c:c.getState()===dt.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),r=Ii(e.pixelToCoordinateTransform,t.slice()),n=i.getExtent();if(n&&!Hr(n,r))return null;const o=this.image_.getExtent(),a=this.image_.getImage(),l=Kt(o),h=Math.floor(a.width*((r[0]-o[0])/l));if(h<0||h>=a.width)return null;const c=ci(o),u=Math.floor(a.height*((o[3]-r[1])/c));return u<0||u>=a.height?null:this.getImageData(a,h,u)}renderFrame(t,e){const i=this.image_,r=i.getExtent(),n=i.getResolution(),[o,a]=Array.isArray(n)?n:[n,n],l=i.getPixelRatio(),h=t.layerStatesArray[t.layerIndex],c=t.pixelRatio,u=t.viewState,d=u.center,p=u.resolution,g=c*o/(p*l),f=c*a/(p*l),m=t.extent,_=u.resolution,y=u.rotation,v=Math.round(Kt(m)/_*c),b=Math.round(ci(m)/_*c);Xr(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/c,1/c,y,-v/2,-b/2),B_(this.inversePixelTransform,this.pixelTransform);const E=Xb(this.pixelTransform);this.useContainer(e,E,this.getBackground(t));const S=this.getRenderContext(t),T=this.context.canvas;T.width!=v||T.height!=b?(T.width=v,T.height=b):this.containerReused||S.clearRect(0,0,v,b);let R=!1,M=!0;if(h.extent){const w=Ln(h.extent,u.projection);M=li(w,t.extent),R=M&&!rr(w,t.extent),R&&this.clipUnrotated(S,t,w)}const A=i.getImage(),O=Xr(this.tempTransform,v/2,b/2,g,f,0,l*(r[0]-d[0])/o,l*(d[1]-r[3])/a);this.renderedResolution=a*c/l;const N=A.width*O[0],x=A.height*O[3];if(this.getLayer().getSource().getInterpolate()||(S.imageSmoothingEnabled=!1),this.preRender(S,t),M&&N>=.5&&x>=.5){const w=O[4],C=O[5],I=h.opacity;I!==1&&(S.save(),S.globalAlpha=I),S.drawImage(A,0,0,+A.width,+A.height,w,C,N,x),I!==1&&S.restore()}return this.postRender(this.context,t),R&&S.restore(),S.imageSmoothingEnabled=!0,E!==T.style.transform&&(T.style.transform=E),this.container}}const rO=m7;class _7 extends f7{constructor(t){super(t)}createRenderer(){return new rO(this)}getData(t){return super.getData(t)}}const lE=_7,cl={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class y7 extends qg{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getPreload(){return this.get(cl.PRELOAD)}setPreload(t){this.set(cl.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(cl.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(cl.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}const nO=y7;class x7 extends Xw{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=Ys(),this.tmpTileRange_=new sE(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),i=t.getState(),r=e.getUseInterimTilesOnError();return i==X.LOADED||i==X.EMPTY||i==X.ERROR&&!r}getTile(t,e,i,r){const n=r.pixelRatio,o=r.viewState.projection,a=this.getLayer();let l=a.getSource().getTile(t,e,i,n,o);return l.getState()==X.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(l)||(l=l.getInterimTile()),l}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),r=Ii(e.pixelToCoordinateTransform,t.slice()),n=i.getExtent();if(n&&!Hr(n,r))return null;const o=e.pixelRatio,a=e.viewState.projection,l=e.viewState,h=i.getRenderSource(),c=h.getTileGridForProjection(l.projection),u=h.getTilePixelRatio(e.pixelRatio);for(let d=c.getZForResolution(l.resolution);d>=c.getMinZoom();--d){const p=c.getTileCoordForCoordAndZ(r,d),g=h.getTile(d,p[1],p[2],o,a);if(!(g instanceof tf||g instanceof Ou)||g instanceof Ou&&g.getState()===X.EMPTY)return null;if(g.getState()!==X.LOADED)continue;const f=c.getOrigin(d),m=xi(c.getTileSize(d)),_=c.getResolution(d),y=Math.floor(u*((r[0]-f[0])/_-p[1]*m[0])),v=Math.floor(u*((f[1]-r[1])/_-p[2]*m[1])),b=Math.round(u*h.getGutterForProjection(l.projection));return this.getImageData(g.getImage(),y+b,v+b)}return null}loadedTileCallback(t,e,i){return this.isDrawableTile(i)?super.loadedTileCallback(t,e,i):!1}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex],r=t.viewState,n=r.projection,o=r.resolution,a=r.center,l=r.rotation,h=t.pixelRatio,c=this.getLayer(),u=c.getSource(),d=u.getRevision(),p=u.getTileGridForProjection(n),g=p.getZForResolution(o,u.zDirection),f=p.getResolution(g);let m=t.extent;const _=t.viewState.resolution,y=u.getTilePixelRatio(h),v=Math.round(Kt(m)/_*h),b=Math.round(ci(m)/_*h),E=i.extent&&Ln(i.extent);E&&(m=us(m,Ln(i.extent)));const S=f*v/2/y,T=f*b/2/y,R=[a[0]-S,a[1]-T,a[0]+S,a[1]+T],M=p.getTileRangeForExtentAndZ(m,g),A={};A[g]={};const O=this.createLoadedTileFinder(u,n,A),N=this.tmpExtent,x=this.tmpTileRange_;this.newTiles_=!1;const w=l?ev(r.center,_,l,t.size):void 0;for(let at=M.minX;at<=M.maxX;++at)for(let k=M.minY;k<=M.maxY;++k){if(l&&!p.tileCoordIntersectsViewport([g,at,k],w))continue;const it=this.getTile(g,at,k,t);if(this.isDrawableTile(it)){const Pt=xt(this);if(it.getState()==X.LOADED){A[g][it.tileCoord.toString()]=it;let Ct=it.inTransition(Pt);Ct&&i.opacity!==1&&(it.endTransition(Pt),Ct=!1),!this.newTiles_&&(Ct||!this.renderedTiles.includes(it))&&(this.newTiles_=!0)}if(it.getAlpha(Pt,t.time)===1)continue}const nt=p.getTileCoordChildTileRange(it.tileCoord,x,N);let ht=!1;nt&&(ht=O(g+1,nt)),ht||p.forEachTileCoordParentTileRange(it.tileCoord,O,x,N)}const C=f/o*h/y;Xr(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/h,1/h,l,-v/2,-b/2);const I=Xb(this.pixelTransform);this.useContainer(e,I,this.getBackground(t));const L=this.getRenderContext(t),j=this.context.canvas;B_(this.inversePixelTransform,this.pixelTransform),Xr(this.tempTransform,v/2,b/2,C,C,0,-v/2,-b/2),j.width!=v||j.height!=b?(j.width=v,j.height=b):this.containerReused||L.clearRect(0,0,v,b),E&&this.clipUnrotated(L,t,E),u.getInterpolate()||(L.imageSmoothingEnabled=!1),this.preRender(L,t),this.renderedTiles.length=0;let z=Object.keys(A).map(Number);z.sort(la);let B,H,Y;i.opacity===1&&(!this.containerReused||u.getOpaque(t.viewState.projection))?z=z.reverse():(B=[],H=[]);for(let at=z.length-1;at>=0;--at){const k=z[at],it=u.getTilePixelSize(k,h,n),nt=p.getResolution(k)/f,ht=it[0]*nt*C,Pt=it[1]*nt*C,Ct=p.getTileCoordForCoordAndZ(va(R),k),ft=p.getTileCoordExtent(Ct),me=Ii(this.tempTransform,[y*(ft[0]-R[0])/f,y*(R[3]-ft[3])/f]),pi=y*u.getGutterForProjection(n),he=A[k];for(const ts in he){const ve=he[ts],ns=ve.tileCoord,_n=Ct[1]-ns[1],Mo=Math.round(me[0]-(_n-1)*ht),Lr=Ct[2]-ns[2],yn=Math.round(me[1]-(Lr-1)*Pt),Je=Math.round(me[0]-_n*ht),gi=Math.round(me[1]-Lr*Pt),bi=Mo-Je,fi=yn-gi,Js=g===k,Qs=Js&&ve.getAlpha(xt(this),t.time)!==1;let os=!1;if(!Qs)if(B){Y=[Je,gi,Je+bi,gi,Je+bi,gi+fi,Je,gi+fi];for(let Ui=0,Io=B.length;Ui<Io;++Ui)if(g!==k&&k<H[Ui]){const Re=B[Ui];li([Je,gi,Je+bi,gi+fi],[Re[0],Re[3],Re[4],Re[7]])&&(os||(L.save(),os=!0),L.beginPath(),L.moveTo(Y[0],Y[1]),L.lineTo(Y[2],Y[3]),L.lineTo(Y[4],Y[5]),L.lineTo(Y[6],Y[7]),L.moveTo(Re[6],Re[7]),L.lineTo(Re[4],Re[5]),L.lineTo(Re[2],Re[3]),L.lineTo(Re[0],Re[1]),L.clip())}B.push(Y),H.push(k)}else L.clearRect(Je,gi,bi,fi);this.drawTileImage(ve,t,Je,gi,bi,fi,pi,Js),B&&!Qs?(os&&L.restore(),this.renderedTiles.unshift(ve)):this.renderedTiles.push(ve),this.updateUsedTiles(t.usedTiles,u,ve)}}return this.renderedRevision=d,this.renderedResolution=f,this.extentChanged=!this.renderedExtent_||!ca(this.renderedExtent_,R),this.renderedExtent_=R,this.renderedPixelRatio=h,this.renderedProjection=n,this.manageTilePyramid(t,u,p,h,n,m,g,c.getPreload()),this.scheduleExpireCache(t,u),this.postRender(this.context,t),i.extent&&L.restore(),L.imageSmoothingEnabled=!0,I!==j.style.transform&&(j.style.transform=I),this.container}drawTileImage(t,e,i,r,n,o,a,l){const h=this.getTileImage(t);if(!h)return;const c=this.getRenderContext(e),u=xt(this),d=e.layerStatesArray[e.layerIndex],p=d.opacity*(l?t.getAlpha(u,e.time):1),g=p!==c.globalAlpha;g&&(c.save(),c.globalAlpha=p),c.drawImage(h,a,a,h.width-2*a,h.height-2*a,i,r,n,o),g&&c.restore(),p!==d.opacity?e.animate=!0:l&&t.endTransition(u)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const i=(function(r,n,o){const a=xt(r);a in o.usedTiles&&r.expireCache(o.viewState.projection,o.usedTiles[a])}).bind(null,e);t.postRenderFunctions.push(i)}}updateUsedTiles(t,e,i){const r=xt(e);r in t||(t[r]={}),t[r][i.getKey()]=!0}manageTilePyramid(t,e,i,r,n,o,a,l,h){const c=xt(e);c in t.wantedTiles||(t.wantedTiles[c]={});const u=t.wantedTiles[c],d=t.tileQueue,p=i.getMinZoom(),g=t.viewState.rotation,f=g?ev(t.viewState.center,t.viewState.resolution,g,t.size):void 0;let m=0,_,y,v,b,E,S;for(S=p;S<=a;++S)for(y=i.getTileRangeForExtentAndZ(o,S,y),v=i.getResolution(S),b=y.minX;b<=y.maxX;++b)for(E=y.minY;E<=y.maxY;++E)g&&!i.tileCoordIntersectsViewport([S,b,E],f)||(a-S<=l?(++m,_=e.getTile(S,b,E,r,n),_.getState()==X.IDLE&&(u[_.getKey()]=!0,d.isKeyQueued(_.getKey())||d.enqueue([_,c,i.getTileCoordCenter(_.tileCoord),v])),h!==void 0&&h(_)):e.useTile(S,b,E,n));e.updateCacheSize(m,n)}}const oO=x7;class v7 extends nO{constructor(t){super(t)}createRenderer(){return new oO(this)}}const E0=v7;class b7 extends Q_{constructor(t,e,i,r,n){const o=n!==void 0?dt.IDLE:dt.LOADED;super(t,e,i,o),this.loader_=n!==void 0?n:null,this.canvas_=r,this.error_=null}getError(){return this.error_}handleLoad_(t){t?(this.error_=t,this.state=dt.ERROR):this.state=dt.LOADED,this.changed()}load(){this.state==dt.IDLE&&(this.state=dt.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}const hE=b7;function S0(s){return Array.isArray(s)?Math.min(...s):s}class w7 extends rO{constructor(t){super(t),this.vectorRenderer_=new DP(t),this.layerImageRatio_=t.getImageRatio(),this.coordinateToVectorPixelTransform_=Ki(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(t){if(!this.vectorRenderer_)return Promise.resolve([]);const e=Ii(this.coordinateToVectorPixelTransform_,Ii(this.renderedPixelToCoordinateTransform_,t.slice()));return this.vectorRenderer_.getFeatures(e)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(t){const e=t.pixelRatio,i=t.viewState,r=i.resolution,n=t.viewHints,o=this.vectorRenderer_;let a=t.extent;this.layerImageRatio_!==1&&(a=a.slice(0),IA(a,this.layerImageRatio_));const l=Kt(a)/r,h=ci(a)/r;if(!n[Ei.ANIMATING]&&!n[Ei.INTERACTING]&&!ba(a)){o.useContainer(null,null);const c=o.context,u=t.layerStatesArray[t.layerIndex],d=Object.assign({},u,{opacity:1}),p=Object.assign({},t,{extent:a,size:[l,h],viewState:Object.assign({},t.viewState,{rotation:0}),layerStatesArray:[d],layerIndex:0,declutter:null}),g=this.getLayer().getDeclutter();g&&(p.declutter={[g]:new Bw(9)});let f=!0;const m=new hE(a,r,e,c.canvas,function(_){o.prepareFrame(p)&&o.replayGroupChanged&&(o.clipping=!1,o.renderFrame(p,null)&&(o.renderDeclutter(p),o.renderDeferred(p),f=!1),_())});m.addEventListener(fe.CHANGE,()=>{if(m.getState()!==dt.LOADED)return;this.image_=f?null:m;const _=m.getPixelRatio(),y=S0(m.getResolution())*e/_;this.renderedResolution=y,this.coordinateToVectorPixelTransform_=Xr(this.coordinateToVectorPixelTransform_,l/2,h/2,1/y,-1/y,0,-i.center[0],-i.center[1])}),m.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice()),!!this.image_}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(t,e,i,r,n){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(t,e,i,r,n):super.forEachFeatureAtCoordinate(t,e,i,r,n)}}const E7=w7;class S7 extends Kg{constructor(t){t=t||{};const e=Object.assign({},t);delete e.imageRatio,super(e),this.imageRatio_=t.imageRatio!==void 0?t.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new E7(this)}}const C7=S7,T7={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},RT={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class R7 extends oO{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=Ki(),this.tileClipContexts_=null}prepareTile(t,e,i){let r;const n=t.getState();return(n===X.LOADED||n===X.ERROR)&&(this.updateExecutorGroup_(t,e,i),this.tileImageNeedsRender_(t)&&(r=!0)),r}getTile(t,e,i,r){const n=r.pixelRatio,o=r.viewState,a=o.resolution,l=o.projection,h=this.getLayer(),c=h.getSource().getTile(t,e,i,n,l),u=r.viewHints,d=!(u[Ei.ANIMATING]||u[Ei.INTERACTING]);return(d||!c.wantedResolution)&&(c.wantedResolution=a),this.prepareTile(c,n,l)&&(d||Date.now()-r.time<8)&&h.getRenderMode()!=="vector"&&this.renderTileImage_(c,r),super.getTile(t,e,i,r)}isDrawableTile(t){const e=this.getLayer();return super.isDrawableTile(t)&&(e.getRenderMode()==="vector"?xt(e)in t.executorGroups:t.hasContext(e))}getTileImage(t){return t.getImage(this.getLayer())}prepareFrame(t){const e=this.getLayer().getRevision();return this.renderedLayerRevision_!==e&&(this.renderedLayerRevision_=e,this.renderedTiles.length=0),super.prepareFrame(t)}updateExecutorGroup_(t,e,i){var r;const n=this.getLayer(),o=n.getRevision(),a=n.getRenderOrder()||null,l=t.wantedResolution,h=t.getReplayState(n);if(!h.dirty&&h.renderedResolution===l&&h.renderedRevision==o&&h.renderedRenderOrder==a)return;const c=n.getSource(),u=!!n.getDeclutter(),d=c.getTileGrid(),p=c.getTileGridForProjection(i).getTileCoordExtent(t.wrappedTileCoord),g=c.getSourceTiles(e,i,t),f=xt(n);delete t.hitDetectionImageData[f],t.executorGroups[f]=[],h.dirty=!1;for(let m=0,_=g.length;m<_;++m){const y=g[m];if(y.getState()!=X.LOADED)continue;const v=y.tileCoord,b=d.getTileCoordExtent(v),E=us(p,b),S=ln(E,n.getRenderBuffer()*l,this.tmpExtent),T=ca(b,E)?null:S,R=new MP(0,E,l,e),M=_0(l,e),A=function(C,I){let L;const j=C.getStyleFunction()||n.getStyleFunction();if(j&&(L=j(C,l)),L){const z=this.renderFeature(C,M,L,R,u,I);h.dirty=h.dirty||z}},O=y.getFeatures();a&&a!==h.renderedRenderOrder&&O.sort(a);for(let C=0,I=O.length;C<I;++C){const L=O[C];(!T||li(T,L.getGeometry().getExtent()))&&A.call(this,L,C)}const N=R.finish(),x=n.getRenderMode()!=="vector"&&u&&g.length===1?null:E,w=new AP(x,l,e,c.getOverlaps(),N,n.getRenderBuffer(),!!((r=this.frameState)!=null&&r.declutter));t.executorGroups[f].push(w)}h.renderedRevision=o,h.renderedRenderOrder=a,h.renderedResolution=l}forEachFeatureAtCoordinate(t,e,i,r,n){const o=e.viewState.resolution,a=e.viewState.rotation;i=i??0;const l=this.getLayer(),h=l.getSource().getTileGridForProjection(e.viewState.projection),c=Cu([t]);ln(c,o*i,c);const u={},d=function(f,m,_){let y=f.getId();y===void 0&&(y=xt(f));const v=u[y];if(v){if(v!==!0&&_<v.distanceSq){if(_===0)return u[y]=!0,n.splice(n.lastIndexOf(v),1),r(f,l,m);v.geometry=m,v.distanceSq=_}}else{if(_===0)return u[y]=!0,r(f,l,m);n.push(u[y]={feature:f,layer:l,geometry:m,distanceSq:_,callback:r})}},p=this.renderedTiles;let g;for(let f=0,m=p.length;!g&&f<m;++f){const _=p[f],y=h.getTileCoordExtent(_.wrappedTileCoord);if(!li(y,c))continue;const v=xt(l),b=[_.executorGroups[v]],E=l.getDeclutter();b.some(S=>{const T=E?e.declutter[E].all().map(R=>R.value):null;for(let R=0,M=S.length;R<M;++R)if(g=S[R].forEachFeatureAtCoordinate(t,o,a,i,d,T),g)return!0})}return g}getFeatures(t){return new Promise((e,i)=>{const r=this.getLayer(),n=xt(r),o=r.getSource(),a=this.renderedProjection,l=a.getExtent(),h=this.renderedResolution,c=o.getTileGridForProjection(a),u=Ii(this.renderedPixelToCoordinateTransform_,t.slice()),d=c.getTileCoordForCoordAndResolution(u,h);let p;for(let v=0,b=this.renderedTiles.length;v<b;++v)if(d.toString()===this.renderedTiles[v].tileCoord.toString()){if(p=this.renderedTiles[v],p.getState()===X.LOADED){const E=c.getTileCoordExtent(p.tileCoord);o.getWrapX()&&a.canWrapX()&&!rr(l,E)&&OA(u,a);break}p=void 0}if(!p||p.loadingSourceTiles>0){e([]);return}const g=c.getTileCoordExtent(p.wrappedTileCoord),f=va(g),m=[(u[0]-f[0])/h,(f[1]-u[1])/h],_=p.getSourceTiles().reduce(function(v,b){return v.concat(b.getFeatures())},[]);let y=p.hitDetectionImageData[n];if(!y){const v=xi(c.getTileSize(c.getZForResolution(h,o.zDirection))),b=this.renderedRotation_,E=[this.getRenderTransform(c.getTileCoordCenter(p.wrappedTileCoord),h,0,zr,v[0]*zr,v[1]*zr,0)];y=PP(v,E,_,r.getStyleFunction(),c.getTileCoordExtent(p.wrappedTileCoord),p.getReplayState(r).renderedResolution,b),p.hitDetectionImageData[n]=y}e(OP(m,_,y))})}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.renderedLayerRevision_!==void 0&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}renderDeclutter(t,e){const i=this.context,r=i.globalAlpha;i.globalAlpha=e.opacity;const n=t.viewHints,o=!(n[Ei.ANIMATING]||n[Ei.INTERACTING]),a=this.renderedTiles;for(let l=0,h=a.length;l<h;++l){const c=a[l],u=c.executorGroups[xt(this.getLayer())],d=this.getLayer().getDeclutter();if(u)for(let p=u.length-1;p>=0;--p)u[p].execute(this.context,[this.context.canvas.width,this.context.canvas.height],this.getTileRenderTransform(c,t),t.viewState.rotation,o,m0,d?t.declutter[d]:void 0)}i.globalAlpha=r}renderDeferredInternal(t){const e=this.renderedTiles.reduce((r,n,o)=>(n.executorGroups[xt(this.getLayer())].forEach(a=>r.push({executorGroup:a,index:o})),r),[]),i=e.map(({executorGroup:r})=>r.getDeferredZIndexContexts());i.map(r=>Object.keys(r)).flat().sort(la).map(Number).forEach(r=>{i.forEach((n,o)=>{n[r]&&n[r].forEach(a=>{const{executorGroup:l,index:h}=e[o],c=l.getRenderedContext(),u=c.globalAlpha;c.globalAlpha=this.renderedOpacity_;const d=this.tileClipContexts_[h];d&&d.draw(c),a.draw(c),d&&c.restore(),c.globalAlpha=u,a.clear()})})})}getTileRenderTransform(t,e){const i=e.pixelRatio,r=e.viewState,n=r.center,o=r.resolution,a=r.rotation,l=e.size,h=Math.round(l[0]*i),c=Math.round(l[1]*i),u=this.getLayer().getSource().getTileGridForProjection(e.viewState.projection),d=t.tileCoord,p=u.getTileCoordExtent(t.wrappedTileCoord),g=u.getTileCoordExtent(d,this.tmpExtent)[0]-p[0];return id(cp(this.inversePixelTransform.slice(),1/i,1/i),this.getRenderTransform(n,o,a,i,h,c,g))}postRender(t,e){const i=e.viewHints,r=!(i[Ei.ANIMATING]||i[Ei.INTERACTING]);this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice(),this.renderedRotation_=e.viewState.rotation,this.renderedOpacity_=e.layerStatesArray[e.layerIndex].opacity;const n=this.getLayer(),o=n.getRenderMode(),a=t.globalAlpha;t.globalAlpha=this.renderedOpacity_;const l=n.getDeclutter(),h=l?RT[o].filter(v=>!m0.includes(v)):RT[o],c=e.viewState,u=c.rotation,d=n.getSource(),p=d.getTileGridForProjection(c.projection).getZForResolution(c.resolution,d.zDirection),g=this.renderedTiles,f=[],m=[],_=[];let y=!0;for(let v=g.length-1;v>=0;--v){const b=g[v];y=y&&!b.getReplayState(n).dirty;const E=b.executorGroups[xt(n)].filter(N=>N.hasExecutors(h));if(E.length===0)continue;const S=this.getTileRenderTransform(b,e),T=b.tileCoord[0];let R=!1;const M=E[0].getClipCoords(S);let A=t,O;if(M){l&&(O=new Ww,A=O.getContext());for(let N=0,x=f.length;N<x;++N)if(p!==T&&T<m[N]){const w=f[N];li([M[0],M[3],M[4],M[7]],[w[0],w[3],w[4],w[7]])&&(R||(A.save(),R=!0),A.beginPath(),A.moveTo(M[0],M[1]),A.lineTo(M[2],M[3]),A.lineTo(M[4],M[5]),A.lineTo(M[6],M[7]),A.moveTo(w[6],w[7]),A.lineTo(w[4],w[5]),A.lineTo(w[2],w[3]),A.lineTo(w[0],w[1]),A.clip())}f.push(M),m.push(T)}for(let N=0,x=E.length;N<x;++N)E[N].execute(t,[t.canvas.width,t.canvas.height],S,u,r,h);R&&(A===t?A.restore():_[v]=O)}t.globalAlpha=a,this.ready=y,this.tileClipContexts_=_,super.postRender(t,e)}renderFeature(t,e,i,r,n,o){if(!i)return!1;let a=!1;if(Array.isArray(i))for(let l=0,h=i.length;l<h;++l)a=y0(r,t,i[l],e,this.boundHandleStyleImageChange_,void 0,n,o)||a;else a=y0(r,t,i,e,this.boundHandleStyleImageChange_,void 0,n,o);return a}tileImageNeedsRender_(t){const e=this.getLayer();if(e.getRenderMode()==="vector")return!1;const i=t.getReplayState(e),r=e.getRevision(),n=t.wantedResolution;return i.renderedTileResolution!==n||i.renderedTileRevision!==r}renderTileImage_(t,e){const i=this.getLayer(),r=t.getReplayState(i),n=i.getRevision(),o=t.executorGroups[xt(i)];r.renderedTileRevision=n;const a=t.wrappedTileCoord,l=a[0],h=i.getSource();let c=e.pixelRatio;const u=e.viewState.projection,d=h.getTileGridForProjection(u),p=d.getResolution(t.tileCoord[0]),g=e.pixelRatio/t.wantedResolution*p,f=d.getResolution(l),m=t.getContext(i);c=Math.round(Math.max(c,g/c));const _=h.getTilePixelSize(l,c,u);m.canvas.width=_[0],m.canvas.height=_[1];const y=c/g;if(y!==1){const S=Qx(this.tmpTransform_);cp(S,y,y),m.setTransform.apply(m,S)}const v=d.getTileCoordExtent(a,this.tmpExtent),b=g/f,E=Qx(this.tmpTransform_);cp(E,b,-b),Wb(E,-v[0],-v[3]);for(let S=0,T=o.length;S<T;++S)o[S].execute(m,[m.canvas.width*y,m.canvas.height*y],E,0,!0,T7[i.getRenderMode()],null);r.renderedTileResolution=t.wantedResolution}}const M7=R7;class I7 extends Kg{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un;const i=t.renderMode||"hybrid";ge(i=="hybrid"||i=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=i,this.setPreload(t.preload?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new M7(this)}getFeatures(t){return super.getFeatures(t)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(cl.PRELOAD)}getUseInterimTilesOnError(){return this.get(cl.USE_INTERIM_TILES_ON_ERROR)}setPreload(t){this.set(cl.PRELOAD,t)}setUseInterimTilesOnError(t){this.set(cl.USE_INTERIM_TILES_ON_ERROR,t)}}const aO=I7;function Wt(s,t,e){const i=Uw();return i.style=s.style,a7(t,e,i,s)}function MT(s){const t=jn(s),e=t[0]*256,i=t[1],r=t[2]*256,n=Math.round(t[3]*255);return[e+i,r+n]}const A7=`vec4 unpackColor(vec2 packedColor) {
  return fract(packedColor[1] / 256.0) * vec4(
    fract(floor(packedColor[0] / 256.0) / 256.0),
    fract(packedColor[0] / 256.0),
    fract(floor(packedColor[1] / 256.0) / 256.0),
    1.0
  );
}`;function lO(s){return s===ei?2:s===Ji?4:1}function W1(s){const t=lO(s);return t>1?`vec${t}`:"float"}function C0(s){return(JSON.stringify(s).split("").reduce((t,e)=>(t<<5)-t+e.charCodeAt(0),0)>>>0).toString()}function cE(s,t,e,i){if(`${i}radius`in s&&i!=="icon-"){let r=Wt(e,s[`${i}radius`],st);if(`${i}radius2`in s){const n=Wt(e,s[`${i}radius2`],st);r=`max(${r}, ${n})`}`${i}stroke-width`in s&&(r=`(${r} + ${Wt(e,s[`${i}stroke-width`],st)} * 0.5)`),t.setSymbolSizeExpression(`vec2(${r} * 2. + 0.5)`)}if(`${i}scale`in s){const r=Wt(e,s[`${i}scale`],st|Ji);t.setSymbolSizeExpression(`${t.getSymbolSizeExpression()} * ${r}`)}`${i}displacement`in s&&t.setSymbolOffsetExpression(Wt(e,s[`${i}displacement`],Ji)),`${i}rotation`in s&&t.setSymbolRotationExpression(Wt(e,s[`${i}rotation`],st)),`${i}rotate-with-view`in s&&t.setSymbolRotateWithView(!!s[`${i}rotate-with-view`])}function hO(s,t,e,i,r){let n="vec4(0.)";if(t!==null&&(n=t),e!==null&&i!==null){const l=`smoothstep(-${i} + 0.63, -${i} - 0.58, ${s})`;n=`mix(${e}, ${n}, ${l})`}const o=`(1.0 - smoothstep(-0.63, 0.58, ${s}))`;let a=`${n} * ${o}`;return r!==null&&(a=`${a} * ${r}`),a}function uE(s,t,e,i,r){const n=new Image;let o;return n.crossOrigin=s[`${i}cross-origin`]===void 0?"anonymous":s[`${i}cross-origin`],n.src=s[`${i}src`],n.complete&&n.width&&n.height?o=nE([n.width,n.height]):(e[`u_texture${r}_size`]=()=>n.complete?[n.width,n.height]:[0,0],t.addUniform(`vec2 u_texture${r}_size`),o=`u_texture${r}_size`),e[`u_texture${r}`]=n,t.addUniform(`sampler2D u_texture${r}`),o}function dE(s,t,e,i,r){let n=Wt(e,s[`${t}offset`],Ji);if(`${t}offset-origin`in s)switch(s[`${t}offset-origin`]){case"top-right":n=`vec2(${i}.x, 0.) + ${r} * vec2(-1., 0.) + ${n} * vec2(-1., 1.)`;break;case"bottom-left":n=`vec2(0., ${i}.y) + ${r} * vec2(0., -1.) + ${n} * vec2(1., -1.)`;break;case"bottom-right":n=`${i} - ${r} - ${n}`;break}return n}function L7(s,t,e,i,r){r.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,cE(s,t,i,"circle-");let n=null;"circle-opacity"in s&&(n=Wt(r,s["circle-opacity"],st));let o="coordsPx";"circle-scale"in s&&(o=`coordsPx / ${Wt(r,s["circle-scale"],st|Ji)}`);let a=null;"circle-fill-color"in s&&(a=Wt(r,s["circle-fill-color"],ei));let l=null;"circle-stroke-color"in s&&(l=Wt(r,s["circle-stroke-color"],ei));let h=Wt(r,s["circle-radius"],st),c=null;"circle-stroke-width"in s&&(c=Wt(r,s["circle-stroke-width"],st),h=`(${h} + ${c} * 0.5)`);const u=`circleDistanceField(${o}, ${h})`,d=hO(u,a,l,c,n);t.setSymbolColorExpression(d)}function P7(s,t,e,i,r){r.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,r.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,r.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,cE(s,t,i,"shape-");let n=null;"shape-opacity"in s&&(n=Wt(r,s["shape-opacity"],st));let o="coordsPx";"shape-scale"in s&&(o=`coordsPx / ${Wt(r,s["shape-scale"],st|Ji)}`);let a=null;"shape-fill-color"in s&&(a=Wt(r,s["shape-fill-color"],ei));let l=null;"shape-stroke-color"in s&&(l=Wt(r,s["shape-stroke-color"],ei));let h=null;"shape-stroke-width"in s&&(h=Wt(r,s["shape-stroke-width"],st));const c=Wt(r,s["shape-points"],st);let u="0.";"shape-angle"in s&&(u=Wt(r,s["shape-angle"],st));let d,p=Wt(r,s["shape-radius"],st);if(h!==null&&(p=`${p} + ${h} * 0.5`),"shape-radius2"in s){let f=Wt(r,s["shape-radius2"],st);h!==null&&(f=`${f} + ${h} * 0.5`),d=`starDistanceField(${o}, ${c}, ${p}, ${f}, ${u})`}else d=`regularDistanceField(${o}, ${c}, ${p}, ${u})`;const g=hO(d,a,l,h,n);t.setSymbolColorExpression(g)}function O7(s,t,e,i,r){let n="vec4(1.0)";"icon-color"in s&&(n=Wt(r,s["icon-color"],ei)),"icon-opacity"in s&&(n=`${n} * ${Wt(r,s["icon-opacity"],st)}`);const o=C0(s["icon-src"]),a=uE(s,t,e,"icon-",o);if(t.setSymbolColorExpression(`${n} * samplePremultiplied(u_texture${o}, v_texCoord)`).setSymbolSizeExpression(a),"icon-width"in s&&"icon-height"in s&&t.setSymbolSizeExpression(`vec2(${Wt(i,s["icon-width"],st)}, ${Wt(i,s["icon-height"],st)})`),"icon-offset"in s&&"icon-size"in s){const l=Wt(i,s["icon-size"],Ji),h=t.getSymbolSizeExpression();t.setSymbolSizeExpression(l);const c=dE(s,"icon-",i,"v_quadSizePx",l);t.setTextureCoordinateExpression(`(vec4((${c}).xyxy) + vec4(0., 0., ${l})) / (${h}).xyxy`)}if(cE(s,t,i,"icon-"),"icon-anchor"in s){const l=Wt(i,s["icon-anchor"],Ji);let h="1.0";"icon-scale"in s&&(h=Wt(i,s["icon-scale"],st|Ji));let c;s["icon-anchor-x-units"]==="pixels"&&s["icon-anchor-y-units"]==="pixels"?c=`${l} * ${h}`:s["icon-anchor-x-units"]==="pixels"?c=`${l} * vec2(vec2(${h}).x, v_quadSizePx.y)`:s["icon-anchor-y-units"]==="pixels"?c=`${l} * vec2(v_quadSizePx.x, vec2(${h}).x)`:c=`${l} * v_quadSizePx`;let u=`v_quadSizePx * vec2(0.5, -0.5) + ${c} * vec2(-1., 1.)`;if("icon-anchor-origin"in s)switch(s["icon-anchor-origin"]){case"top-right":u=`v_quadSizePx * -0.5 + ${c}`;break;case"bottom-left":u=`v_quadSizePx * 0.5 - ${c}`;break;case"bottom-right":u=`v_quadSizePx * vec2(-0.5, 0.5) + ${c} * vec2(1., -1.)`;break}t.setSymbolOffsetExpression(`${t.getSymbolOffsetExpression()} + ${u}`)}}function F7(s,t,e,i,r){if("stroke-color"in s&&t.setStrokeColorExpression(Wt(r,s["stroke-color"],ei)),"stroke-pattern-src"in s){const n=C0(s["stroke-pattern-src"]),o=uE(s,t,e,"stroke-pattern-",n);let a=o,l="vec2(0.)";"stroke-pattern-offset"in s&&"stroke-pattern-size"in s&&(a=Wt(r,s["stroke-pattern-size"],Ji),l=dE(s,"stroke-pattern-",r,o,a));let h="0.";"stroke-pattern-spacing"in s&&(h=Wt(r,s["stroke-pattern-spacing"],st)),r.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = currentLengthPx * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return samplePremultiplied(texture, texCoord);
}`;const c=`u_texture${n}`;let u="1.";"stroke-color"in s&&(u=t.getStrokeColorExpression()),t.setStrokeColorExpression(`${u} * sampleStrokePattern(${c}, ${o}, ${l}, ${a}, ${h}, currentLengthPx, currentRadiusRatio, v_width)`)}if("stroke-width"in s&&t.setStrokeWidthExpression(Wt(i,s["stroke-width"],st)),"stroke-offset"in s&&t.setStrokeOffsetExpression(Wt(i,s["stroke-offset"],st)),"stroke-line-cap"in s&&t.setStrokeCapExpression(Wt(i,s["stroke-line-cap"],Is)),"stroke-line-join"in s&&t.setStrokeJoinExpression(Wt(i,s["stroke-line-join"],Is)),"stroke-miter-limit"in s&&t.setStrokeMiterLimitExpression(Wt(i,s["stroke-miter-limit"],st)),"stroke-line-dash"in s){r.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${Ho("square")}) {
    distanceSegment -= v_width * 0.5;
  } else if (capType == ${Ho("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - v_width * 0.5);
  }
  return distanceSegment;
}`;let n=s["stroke-line-dash"].map(d=>Wt(r,d,st));n.length%2===1&&(n=[...n,...n]);let o="0.";"stroke-line-dash-offset"in s&&(o=Wt(i,s["stroke-line-dash-offset"],st));const a=`dashDistanceField_${C0(s["stroke-line-dash"])}`,l=n.map((d,p)=>`float dashLength${p} = ${d};`),h=n.map((d,p)=>`dashLength${p}`).join(" + ");let c="0.",u=`getSingleDashDistance(distance, radius, ${c}, dashLength0, totalDashLength, capType)`;for(let d=2;d<n.length;d+=2)c=`${c} + dashLength${d-2} + dashLength${d-1}`,u=`min(${u}, getSingleDashDistance(distance, radius, ${c}, dashLength${d}, totalDashLength, capType))`;r.functions[a]=`float ${a}(float distance, float radius, float capType) {
  ${l.join(`
  `)}
  float totalDashLength = ${h};
  return ${u};
}`,t.setStrokeDistanceFieldExpression(`${a}(currentLengthPx + ${o}, currentRadiusPx, capType)`)}}function k7(s,t,e,i,r){if("fill-color"in s&&t.setFillColorExpression(Wt(r,s["fill-color"],ei)),"fill-pattern-src"in s){const n=C0(s["fill-pattern-src"]),o=uE(s,t,e,"fill-pattern-",n);let a=o,l="vec2(0.)";"fill-pattern-offset"in s&&"fill-pattern-size"in s&&(a=Wt(r,s["fill-pattern-size"],Ji),l=dE(s,"fill-pattern-",r,o,a)),r.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return samplePremultiplied(texture, (samplePos + textureOffset) / textureSize);
}`;const h=`u_texture${n}`;let c="1.";"fill-color"in s&&(c=t.getFillColorExpression()),t.setFillColorExpression(`${c} * sampleFillPattern(${h}, ${o}, ${l}, ${a}, pxOrigin, pxPos)`)}}function N7(s){const t={inFragmentShader:!1,properties:{},variables:{},functions:{},style:s},e={inFragmentShader:!0,variables:t.variables,properties:{},functions:{},style:s},i=new sO,r={};if("icon-src"in s?O7(s,i,r,t,e):"shape-points"in s?P7(s,i,r,t,e):"circle-radius"in s&&L7(s,i,r,t,e),F7(s,i,r,t,e),k7(s,i,r,t,e),s.filter){const o=Wt(e,s.filter,mi);i.setFragmentDiscardExpression(`!${o}`)}Object.keys(e.variables).forEach(function(o){const a=e.variables[o],l=oE(a.name);i.addUniform(`${W1(a.type)} ${l}`);let h;a.type===Is?h=()=>w0(s.variables[a.name]):a.type===ei?h=()=>MT([...jn(s.variables[a.name]||"#eee")]):a.type===mi?h=()=>s.variables[a.name]?1:0:h=()=>s.variables[a.name],r[l]=h}),Object.keys(e.properties).forEach(function(o){const a=e.properties[o];t.properties[o]||(t.properties[o]=a);let l=W1(a.type),h=`a_prop_${a.name}`;a.type===ei&&(l="vec4",h=`unpackColor(${h})`,i.addVertexShaderFunction(A7)),i.addVarying(`v_prop_${a.name}`,l,h)}),Object.keys(t.properties).forEach(function(o){const a=t.properties[o];i.addAttribute(`${W1(a.type)} a_prop_${a.name}`)});const n=Object.keys(t.properties).map(function(o){const a=t.properties[o];let l;return a.evaluator?l=a.evaluator:a.type===Is?l=h=>w0(h.get(a.name)):a.type===ei?l=h=>MT([...jn(h.get(a.name)||"#eee")]):a.type===mi?l=h=>h.get(a.name)?1:0:l=h=>h.get(a.name),{name:a.name,size:lO(a.type),callback:l}});for(const o in t.functions)i.addVertexShaderFunction(t.functions[o]);for(const o in e.functions)i.addFragmentShaderFunction(e.functions[o]);return{builder:i,attributes:n.reduce((o,a)=>({...o,[a.name]:{callback:a.callback,size:a.size}}),{}),uniforms:r}}class D7 extends qg{constructor(t){const e=Object.assign({},t);super(e),this.parseResult_=N7(t.style),this.styleVariables_=t.style.variables||{},this.hitDetectionDisabled_=!!t.disableHitDetection}createRenderer(){const t=Object.keys(this.parseResult_.attributes).map(e=>({name:e,...this.parseResult_.attributes[e]}));return new KP(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitDetectionEnabled:!this.hitDetectionDisabled_,uniforms:this.parseResult_.uniforms,attributes:t})}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}}const $7=D7;function IT(s,t){const e=`
    attribute vec2 ${Nm.TEXTURE_COORD};
    uniform mat4 ${re.TILE_TRANSFORM};
    uniform float ${re.TEXTURE_PIXEL_WIDTH};
    uniform float ${re.TEXTURE_PIXEL_HEIGHT};
    uniform float ${re.TEXTURE_RESOLUTION};
    uniform float ${re.TEXTURE_ORIGIN_X};
    uniform float ${re.TEXTURE_ORIGIN_Y};
    uniform float ${re.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${Nm.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${re.TEXTURE_ORIGIN_X} + ${re.TEXTURE_RESOLUTION} * ${re.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${re.TEXTURE_ORIGIN_Y} - ${re.TEXTURE_RESOLUTION} * ${re.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${re.TILE_TRANSFORM} * vec4(${Nm.TEXTURE_COORD}, ${re.DEPTH}, 1.0);
    }
  `,i={...o7(),inFragmentShader:!0,bandCount:t,style:s},r=[];if(s.color!==void 0){const u=Wt(i,s.color,ei);r.push(`color = ${u};`)}if(s.contrast!==void 0){const u=Wt(i,s.contrast,st);r.push(`color.rgb = clamp((${u} + 1.0) * color.rgb - (${u} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(s.exposure!==void 0){const u=Wt(i,s.exposure,st);r.push(`color.rgb = clamp((${u} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(s.saturation!==void 0){const u=Wt(i,s.saturation,st);r.push(`
      float saturation = ${u} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(s.gamma!==void 0){const u=Wt(i,s.gamma,st);r.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${u}));`)}if(s.brightness!==void 0){const u=Wt(i,s.brightness,st);r.push(`color.rgb = clamp(color.rgb + ${u}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const n={},o=Object.keys(i.variables).length;if(o>1&&!s.variables)throw new Error(`Missing variables in style (expected ${i.variables})`);for(let u=0;u<o;++u){const d=i.variables[Object.keys(i.variables)[u]];if(!(d.name in s.variables))throw new Error(`Missing '${d.name}' in style variables`);const p=oE(d.name);n[p]=function(){let g=s.variables[d.name];return typeof g=="string"&&(g=w0(g)),g!==void 0?g:-9999999}}const a=Object.keys(n).map(function(u){return`uniform float ${u};`}),l=Math.ceil(t/4);a.push(`uniform sampler2D ${re.TILE_TEXTURE_ARRAY}[${l}];`),i.paletteTextures&&a.push(`uniform sampler2D ${iO}[${i.paletteTextures.length}];`);const h=Object.keys(i.functions).map(function(u){return i.functions[u]}),c=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${re.RENDER_EXTENT};
    uniform float ${re.TRANSITION_ALPHA};
    uniform float ${re.TEXTURE_PIXEL_WIDTH};
    uniform float ${re.TEXTURE_PIXEL_HEIGHT};
    uniform float ${re.RESOLUTION};
    uniform float ${re.ZOOM};

    ${a.join(`
`)}

    ${h.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${re.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${re.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${re.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${re.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${re.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${r.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${re.TRANSITION_ALPHA};
    }`;return{vertexShader:e,fragmentShader:c,uniforms:n,paletteTextures:i.paletteTextures}}let cO=class extends nO{constructor(t){t=t?Object.assign({},t):{};const e=t.style||{};delete t.style;const i=t.cacheSize;delete t.cacheSize,super(t),this.sources_=t.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=e,this.cacheSize_=i,this.styleVariables_=this.style_.variables||{},this.addChangeListener(ze.SOURCE,this.handleSourceUpdate_)}getSources(t,e){const i=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(t,e):this.sources_:i?[i]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const t=this.getRenderSource();return t?t.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const t=Number.MAX_SAFE_INTEGER,e=this.getSources([-t,-t,t,t],t);return e&&e.length&&"bandCount"in e[0]?e[0].bandCount:4}createRenderer(){const t=IT(this.style_,this.getSourceBandCount_());return new s7(this,{vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,cacheSize:this.cacheSize_,paletteTextures:t.paletteTextures})}renderSources(t,e){const i=this.getRenderer();let r;for(let n=0,o=e.length;n<o;++n)this.renderedSource_=e[n],i.prepareFrame(t)&&(r=i.renderFrame(t));return r}render(t,e){this.rendered=!0;const i=t.viewState,r=this.getSources(t.extent,i.resolution);let n=!0;for(let a=0,l=r.length;a<l;++a){const h=r[a],c=h.getState();if(c=="loading"){const u=()=>{h.getState()=="ready"&&(h.removeEventListener("change",u),this.changed())};h.addEventListener("change",u)}n=n&&c=="ready"}const o=this.renderSources(t,r);if(this.getRenderer().renderComplete&&n)return this.renderedResolution_=i.resolution,o;if(this.renderedResolution_>.5*i.resolution){const a=this.getSources(t.extent,this.renderedResolution_).filter(l=>!r.includes(l));if(a.length>0)return this.renderSources(t,a)}return o}setStyle(t){this.styleVariables_=t.variables||{},this.style_=t;const e=IT(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,paletteTextures:e.paletteTextures}),this.changed()}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}};cO.prototype.dispose;const $v=cO,j7=Object.freeze(Object.defineProperty({__proto__:null,Graticule:U9,Group:GP,Heatmap:p7,Image:lE,Layer:qg,Tile:E0,Vector:qw,VectorImage:C7,VectorTile:aO,WebGLPoints:$7,WebGLTile:$v},Symbol.toStringTag,{value:"Module"}));var sr=(s,t,e)=>new Promise((i,r)=>{var n=l=>{try{a(e.next(l))}catch(h){r(h)}},o=l=>{try{a(e.throw(l))}catch(h){r(h)}},a=l=>l.done?i(l.value):Promise.resolve(l.value).then(n,o);a((e=e.apply(s,t)).next())}),Br=Uint8Array,Xc=Uint16Array,G7=Int32Array,uO=new Br([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),dO=new Br([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),z7=new Br([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),pO=function(s,t){for(var e=new Xc(31),i=0;i<31;++i)e[i]=t+=1<<s[i-1];for(var r=new G7(e[30]),i=1;i<30;++i)for(var n=e[i];n<e[i+1];++n)r[n]=n-e[i]<<5|i;return{b:e,r}},gO=pO(uO,2),fO=gO.b,B7=gO.r;fO[28]=258,B7[258]=28;var U7=pO(dO,0),V7=U7.b,jv=new Xc(32768);for(Ve=0;Ve<32768;++Ve)No=(Ve&43690)>>1|(Ve&21845)<<1,No=(No&52428)>>2|(No&13107)<<2,No=(No&61680)>>4|(No&3855)<<4,jv[Ve]=((No&65280)>>8|(No&255)<<8)>>1;var No,Ve,_p=function(s,t,e){for(var i=s.length,r=0,n=new Xc(t);r<i;++r)s[r]&&++n[s[r]-1];var o=new Xc(t);for(r=1;r<t;++r)o[r]=o[r-1]+n[r-1]<<1;var a;if(e){a=new Xc(1<<t);var l=15-t;for(r=0;r<i;++r)if(s[r])for(var h=r<<4|s[r],c=t-s[r],u=o[s[r]-1]++<<c,d=u|(1<<c)-1;u<=d;++u)a[jv[u]>>l]=h}else for(a=new Xc(i),r=0;r<i;++r)s[r]&&(a[r]=jv[o[s[r]-1]++]>>15-s[r]);return a},ef=new Br(288);for(Ve=0;Ve<144;++Ve)ef[Ve]=8;var Ve;for(Ve=144;Ve<256;++Ve)ef[Ve]=9;var Ve;for(Ve=256;Ve<280;++Ve)ef[Ve]=7;var Ve;for(Ve=280;Ve<288;++Ve)ef[Ve]=8;var Ve,mO=new Br(32);for(Ve=0;Ve<32;++Ve)mO[Ve]=5;var Ve,H7=_p(ef,9,1),W7=_p(mO,5,1),X1=function(s){for(var t=s[0],e=1;e<s.length;++e)s[e]>t&&(t=s[e]);return t},wn=function(s,t,e){var i=t/8|0;return(s[i]|s[i+1]<<8)>>(t&7)&e},q1=function(s,t){var e=t/8|0;return(s[e]|s[e+1]<<8|s[e+2]<<16)>>(t&7)},X7=function(s){return(s+7)/8|0},q7=function(s,t,e){(t==null||t<0)&&(t=0),(e==null||e>s.length)&&(e=s.length);var i=new Br(e-t);return i.set(s.subarray(t,e)),i},Y7=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],$r=function(s,t,e){var i=new Error(t||Y7[s]);if(i.code=s,Error.captureStackTrace&&Error.captureStackTrace(i,$r),!e)throw i;return i},pE=function(s,t,e,i){var r=s.length,n=i?i.length:0;if(!r||t.f&&!t.l)return e||new Br(0);var o=!e||t.i!=2,a=t.i;e||(e=new Br(r*3));var l=function(ft){var me=e.length;if(ft>me){var pi=new Br(Math.max(me*2,ft));pi.set(e),e=pi}},h=t.f||0,c=t.p||0,u=t.b||0,d=t.l,p=t.d,g=t.m,f=t.n,m=r*8;do{if(!d){h=wn(s,c,1);var _=wn(s,c+1,3);if(c+=3,_)if(_==1)d=H7,p=W7,g=9,f=5;else if(_==2){var y=wn(s,c,31)+257,v=wn(s,c+10,15)+4,b=y+wn(s,c+5,31)+1;c+=14;for(var E=new Br(b),S=new Br(19),T=0;T<v;++T)S[z7[T]]=wn(s,c+T*3,7);c+=v*3;for(var R=X1(S),M=(1<<R)-1,A=_p(S,R,1),T=0;T<b;){var O=A[wn(s,c,M)];c+=O&15;var N=O>>4;if(N<16)E[T++]=N;else{var x=0,w=0;for(N==16?(w=3+wn(s,c,3),c+=2,x=E[T-1]):N==17?(w=3+wn(s,c,7),c+=3):N==18&&(w=11+wn(s,c,127),c+=7);w--;)E[T++]=x}}var C=E.subarray(0,y),I=E.subarray(y);g=X1(C),f=X1(I),d=_p(C,g,1),p=_p(I,f,1)}else $r(1);else{var N=X7(c)+4,L=s[N-4]|s[N-3]<<8,j=N+L;if(j>r){a&&$r(0);break}o&&l(u+L),e.set(s.subarray(N,j),u),t.b=u+=L,t.p=c=j*8,t.f=h;continue}if(c>m){a&&$r(0);break}}o&&l(u+131072);for(var z=(1<<g)-1,B=(1<<f)-1,H=c;;H=c){var x=d[q1(s,c)&z],Y=x>>4;if(c+=x&15,c>m){a&&$r(0);break}if(x||$r(2),Y<256)e[u++]=Y;else if(Y==256){H=c,d=null;break}else{var at=Y-254;if(Y>264){var T=Y-257,k=uO[T];at=wn(s,c,(1<<k)-1)+fO[T],c+=k}var it=p[q1(s,c)&B],nt=it>>4;it||$r(3),c+=it&15;var I=V7[nt];if(nt>3){var k=dO[nt];I+=q1(s,c)&(1<<k)-1,c+=k}if(c>m){a&&$r(0);break}o&&l(u+131072);var ht=u+at;if(u<I){var Pt=n-I,Ct=Math.min(I,ht);for(Pt+u<0&&$r(3);u<Ct;++u)e[u]=i[Pt+u]}for(;u<ht;u+=4)e[u]=e[u-I],e[u+1]=e[u+1-I],e[u+2]=e[u+2-I],e[u+3]=e[u+3-I];u=ht}}t.l=d,t.p=H,t.b=u,t.f=h,d&&(h=1,t.m=g,t.d=p,t.n=f)}while(!h);return u==e.length?e:q7(e,0,u)},Z7=new Br(0),K7=function(s){(s[0]!=31||s[1]!=139||s[2]!=8)&&$r(6,"invalid gzip data");var t=s[3],e=10;t&4&&(e+=(s[10]|s[11]<<8)+2);for(var i=(t>>3&1)+(t>>4&1);i>0;i-=!s[e++]);return e+(t&2)},J7=function(s){var t=s.length;return(s[t-4]|s[t-3]<<8|s[t-2]<<16|s[t-1]<<24)>>>0},Q7=function(s,t){return((s[0]&15)!=8||s[0]>>4>7||(s[0]<<8|s[1])%31)&&$r(6,"invalid zlib data"),(s[1]>>5&1)==+!t&&$r(6,"invalid zlib data: "+(s[1]&32?"need":"unexpected")+" dictionary"),(s[1]>>3&4)+2};function tW(s,t){return pE(s,{i:2},t&&t.out,t&&t.dictionary)}function eW(s,t){var e=K7(s);return e+8>s.length&&$r(6,"invalid gzip data"),pE(s.subarray(e,-8),{i:2},t&&t.out||new Br(J7(s)),t&&t.dictionary)}function iW(s,t){return pE(s.subarray(Q7(s,t&&t.dictionary),-4),{i:2},t&&t.out,t&&t.dictionary)}function Gv(s,t){return s[0]==31&&s[1]==139&&s[2]==8?eW(s,t):(s[0]&15)!=8||s[0]>>4>7||(s[0]<<8|s[1])%31?tW(s,t):iW(s,t)}var sW=typeof TextDecoder<"u"&&new TextDecoder,rW=0;try{sW.decode(Z7,{stream:!0}),rW=1}catch{}var _O=(s,t)=>s*Math.pow(2,t),Dd=(s,t)=>Math.floor(s/Math.pow(2,t)),T0=(s,t)=>_O(s.getUint16(t+1,!0),8)+s.getUint8(t),yO=(s,t)=>_O(s.getUint32(t+2,!0),16)+s.getUint16(t,!0),nW=(s,t,e,i,r)=>{if(s!=i.getUint8(r))return s-i.getUint8(r);const n=T0(i,r+1);if(t!=n)return t-n;const o=T0(i,r+4);return e!=o?e-o:0},oW=(s,t,e,i)=>{const r=xO(s,t|128,e,i);return r?{z:t,x:e,y:i,offset:r[0],length:r[1],is_dir:!0}:null},AT=(s,t,e,i)=>{const r=xO(s,t,e,i);return r?{z:t,x:e,y:i,offset:r[0],length:r[1],is_dir:!1}:null},xO=(s,t,e,i)=>{let r=0,n=s.byteLength/17-1;for(;r<=n;){const o=n+r>>1,a=nW(t,e,i,s,o*17);if(a>0)r=o+1;else if(a<0)n=o-1;else return[yO(s,o*17+7),s.getUint32(o*17+13,!0)]}return null},aW=(s,t)=>s.is_dir&&!t.is_dir?1:!s.is_dir&&t.is_dir?-1:s.z!==t.z?s.z-t.z:s.x!==t.x?s.x-t.x:s.y-t.y,vO=(s,t)=>{const e=s.getUint8(t*17);return{z:e&127,x:T0(s,t*17+1),y:T0(s,t*17+4),offset:yO(s,t*17+7),length:s.getUint32(t*17+13,!0),is_dir:e>>7===1}},LT=s=>{const t=[],e=new DataView(s);for(let i=0;i<e.byteLength/17;i++)t.push(vO(e,i));return lW(t)},lW=s=>{s.sort(aW);const t=new ArrayBuffer(17*s.length),e=new Uint8Array(t);for(let i=0;i<s.length;i++){const r=s[i];let n=r.z;r.is_dir&&(n=n|128),e[i*17]=n,e[i*17+1]=r.x&255,e[i*17+2]=r.x>>8&255,e[i*17+3]=r.x>>16&255,e[i*17+4]=r.y&255,e[i*17+5]=r.y>>8&255,e[i*17+6]=r.y>>16&255,e[i*17+7]=r.offset&255,e[i*17+8]=Dd(r.offset,8)&255,e[i*17+9]=Dd(r.offset,16)&255,e[i*17+10]=Dd(r.offset,24)&255,e[i*17+11]=Dd(r.offset,32)&255,e[i*17+12]=Dd(r.offset,48)&255,e[i*17+13]=r.length&255,e[i*17+14]=r.length>>8&255,e[i*17+15]=r.length>>16&255,e[i*17+16]=r.length>>24&255}return t},hW=(s,t)=>{if(s.byteLength<17)return null;const e=s.byteLength/17,i=vO(s,e-1);if(i.is_dir){const r=i.z,n=t.z-r,o=Math.trunc(t.x/(1<<n)),a=Math.trunc(t.y/(1<<n));return{z:r,x:o,y:a}}return null};function cW(s){return sr(this,null,function*(){const t=yield s.getBytes(0,512e3),e=new DataView(t.data),i=e.getUint32(4,!0),r=e.getUint16(8,!0),n=new TextDecoder("utf-8"),o=JSON.parse(n.decode(new DataView(t.data,10,i)));let a=0;o.compression==="gzip"&&(a=2);let l=0;"minzoom"in o&&(l=+o.minzoom);let h=0;"maxzoom"in o&&(h=+o.maxzoom);let c=0,u=0,d=0,p=-180,g=-85,f=180,m=85;if(o.bounds){const _=o.bounds.split(",");p=+_[0],g=+_[1],f=+_[2],m=+_[3]}if(o.center){const _=o.center.split(",");c=+_[0],u=+_[1],d=+_[2]}return{specVersion:e.getUint16(2,!0),rootDirectoryOffset:10+i,rootDirectoryLength:r*17,jsonMetadataOffset:10,jsonMetadataLength:i,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:l,maxZoom:h,minLon:p,minLat:g,maxLon:f,maxLat:m,centerZoom:d,centerLon:c,centerLat:u,etag:t.etag}})}function uW(s,t,e,i,r,n,o){return sr(this,null,function*(){let a=yield e.getArrayBuffer(t,s.rootDirectoryOffset,s.rootDirectoryLength,s);s.specVersion===1&&(a=LT(a));const l=AT(new DataView(a),i,r,n);if(l){let c=(yield t.getBytes(l.offset,l.length,o)).data;const u=new DataView(c);return u.getUint8(0)==31&&u.getUint8(1)==139&&(c=Gv(new Uint8Array(c))),{data:c}}const h=hW(new DataView(a),{z:i,x:r,y:n});if(h){const c=oW(new DataView(a),h.z,h.x,h.y);if(c){let u=yield e.getArrayBuffer(t,c.offset,c.length,s);s.specVersion===1&&(u=LT(u));const d=AT(new DataView(u),i,r,n);if(d){let p=(yield t.getBytes(d.offset,d.length,o)).data;const g=new DataView(p);return g.getUint8(0)==31&&g.getUint8(1)==139&&(p=Gv(new Uint8Array(p))),{data:p}}}}})}var bO={getHeader:cW,getZxy:uW};function dW(s,t){return(t>>>0)*4294967296+(s>>>0)}function pW(s,t){const e=t.buf;let i,r;if(r=e[t.pos++],i=(r&112)>>4,r<128||(r=e[t.pos++],i|=(r&127)<<3,r<128)||(r=e[t.pos++],i|=(r&127)<<10,r<128)||(r=e[t.pos++],i|=(r&127)<<17,r<128)||(r=e[t.pos++],i|=(r&127)<<24,r<128)||(r=e[t.pos++],i|=(r&1)<<31,r<128))return dW(s,i);throw new Error("Expected varint not more than 10 bytes")}function $d(s){const t=s.buf;let e,i;return i=t[s.pos++],e=i&127,i<128||(i=t[s.pos++],e|=(i&127)<<7,i<128)||(i=t[s.pos++],e|=(i&127)<<14,i<128)||(i=t[s.pos++],e|=(i&127)<<21,i<128)?e:(i=t[s.pos],e|=(i&15)<<28,pW(e,s))}function gW(s,t,e,i){if(i==0){e==1&&(t[0]=s-1-t[0],t[1]=s-1-t[1]);const r=t[0];t[0]=t[1],t[1]=r}}var fW=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function mW(s,t,e){if(s>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(t>Math.pow(2,s)-1||e>Math.pow(2,s)-1)throw Error("tile x/y outside zoom level bounds");const i=fW[s],r=Math.pow(2,s);let n=0,o=0,a=0;const l=[t,e];let h=r/2;for(;h>0;)n=(l[0]&h)>0?1:0,o=(l[1]&h)>0?1:0,a+=h*h*(3*n^o),gW(h,l,n,o),h=h/2;return i+a}function wO(s,t){return sr(this,null,function*(){if(t===1||t===0)return s;if(t===2){if(typeof globalThis.DecompressionStream>"u")return Gv(new Uint8Array(s));{let e=new Response(s).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(e).arrayBuffer()}}else throw Error("Compression method not supported")})}var Sc=(s=>(s[s.Unknown=0]="Unknown",s[s.Mvt=1]="Mvt",s[s.Png=2]="Png",s[s.Jpeg=3]="Jpeg",s[s.Webp=4]="Webp",s[s.Avif=5]="Avif",s))(Sc||{}),_W=127;function yW(s,t){let e=0,i=s.length-1;for(;e<=i;){const r=i+e>>1,n=t-s[r].tileId;if(n>0)e=r+1;else if(n<0)i=r-1;else return s[r]}return i>=0&&(s[i].runLength===0||t-s[i].tileId<s[i].runLength)?s[i]:null}var xW=class{constructor(s,t=new Headers){this.url=s,this.customHeaders=t}getKey(){return this.url}setHeaders(s){this.customHeaders=s}getBytes(s,t,e){return sr(this,null,function*(){let i;e||(i=new AbortController,e=i.signal);const r=new Headers(this.customHeaders);r.set("Range","bytes="+s+"-"+(s+t-1));let n=yield fetch(this.url,{signal:e,headers:r});if(n.status===416&&s===0){const a=n.headers.get("Content-Range");if(!a||!a.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const l=+a.substr(8);n=yield fetch(this.url,{signal:e,headers:{Range:"bytes=0-"+(l-1)}})}if(n.status>=300)throw Error("Bad response code: "+n.status);const o=n.headers.get("Content-Length");if(n.status===200&&(!o||+o>t))throw i&&i.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield n.arrayBuffer(),etag:n.headers.get("ETag")||void 0,cacheControl:n.headers.get("Cache-Control")||void 0,expires:n.headers.get("Expires")||void 0}})}};function En(s,t){const e=s.getUint32(t+4,!0),i=s.getUint32(t+0,!0);return e*Math.pow(2,32)+i}function vW(s,t){const e=new DataView(s),i=e.getUint8(7);if(i>3)throw Error(`Archive is spec version ${i} but this library supports up to spec version 3`);return{specVersion:i,rootDirectoryOffset:En(e,8),rootDirectoryLength:En(e,16),jsonMetadataOffset:En(e,24),jsonMetadataLength:En(e,32),leafDirectoryOffset:En(e,40),leafDirectoryLength:En(e,48),tileDataOffset:En(e,56),tileDataLength:En(e,64),numAddressedTiles:En(e,72),numTileEntries:En(e,80),numTileContents:En(e,88),clustered:e.getUint8(96)===1,internalCompression:e.getUint8(97),tileCompression:e.getUint8(98),tileType:e.getUint8(99),minZoom:e.getUint8(100),maxZoom:e.getUint8(101),minLon:e.getInt32(102,!0)/1e7,minLat:e.getInt32(106,!0)/1e7,maxLon:e.getInt32(110,!0)/1e7,maxLat:e.getInt32(114,!0)/1e7,centerZoom:e.getUint8(118),centerLon:e.getInt32(119,!0)/1e7,centerLat:e.getInt32(123,!0)/1e7,etag:t}}function EO(s){const t={buf:new Uint8Array(s),pos:0},e=$d(t),i=[];let r=0;for(let n=0;n<e;n++){const o=$d(t);i.push({tileId:r+o,offset:0,length:0,runLength:1}),r+=o}for(let n=0;n<e;n++)i[n].runLength=$d(t);for(let n=0;n<e;n++)i[n].length=$d(t);for(let n=0;n<e;n++){const o=$d(t);o===0&&n>0?i[n].offset=i[n-1].offset+i[n-1].length:i[n].offset=o-1}return i}function bW(s){const t=new DataView(s);return t.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):t.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var qc=class extends Error{};function wW(s,t,e,i){return sr(this,null,function*(){const r=yield s.getBytes(0,16384);if(new DataView(r.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(bW(r.data)<3)return[yield bO.getHeader(s)];const n=r.data.slice(0,_W);let o=r.etag;i&&r.etag!=i&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+s.getKey()),o=void 0);const a=vW(n,o);if(e){const l=r.data.slice(a.rootDirectoryOffset,a.rootDirectoryOffset+a.rootDirectoryLength),h=s.getKey()+"|"+(a.etag||"")+"|"+a.rootDirectoryOffset+"|"+a.rootDirectoryLength,c=EO(yield t(l,a.internalCompression));return[a,[h,c.length,c]]}return[a,void 0]})}function EW(s,t,e,i,r){return sr(this,null,function*(){const n=yield s.getBytes(e,i);if(r.etag&&r.etag!==n.etag)throw new qc(n.etag);const o=yield t(n.data,r.internalCompression),a=EO(o);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var SW=class{constructor(s=100,t=!0,e=wO){this.cache=new Map,this.maxCacheEntries=s,this.counter=1,this.prefetch=t,this.decompress=e}getHeader(s,t){return sr(this,null,function*(){const e=s.getKey();if(this.cache.has(e))return this.cache.get(e).lastUsed=this.counter++,yield this.cache.get(e).data;const i=new Promise((r,n)=>{wW(s,this.decompress,this.prefetch,t).then(o=>{o[1]&&this.cache.set(o[1][0],{lastUsed:this.counter++,data:Promise.resolve(o[1][2])}),r(o[0]),this.prune()}).catch(o=>{n(o)})});return this.cache.set(e,{lastUsed:this.counter++,data:i}),i})}getDirectory(s,t,e,i){return sr(this,null,function*(){const r=s.getKey()+"|"+(i.etag||"")+"|"+t+"|"+e;if(this.cache.has(r))return this.cache.get(r).lastUsed=this.counter++,yield this.cache.get(r).data;const n=new Promise((o,a)=>{EW(s,this.decompress,t,e,i).then(l=>{o(l),this.prune()}).catch(l=>{a(l)})});return this.cache.set(r,{lastUsed:this.counter++,data:n}),n})}getArrayBuffer(s,t,e,i){return sr(this,null,function*(){const r=s.getKey()+"|"+(i.etag||"")+"|"+t+"|"+e;if(this.cache.has(r))return this.cache.get(r).lastUsed=this.counter++,yield this.cache.get(r).data;const n=new Promise((o,a)=>{s.getBytes(t,e).then(l=>{if(i.etag&&i.etag!==l.etag)throw new qc(l.etag);o(l.data),this.cache.has(r),this.prune()}).catch(l=>{a(l)})});return this.cache.set(r,{lastUsed:this.counter++,data:n}),n})}prune(){if(this.cache.size>=this.maxCacheEntries){let s=1/0,t;this.cache.forEach((e,i)=>{e.lastUsed<s&&(s=e.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(s,t){return sr(this,null,function*(){this.cache.delete(s.getKey()),yield this.getHeader(s,t)})}},gE=class{constructor(t,e,i){typeof t=="string"?this.source=new xW(t):this.source=t,i?this.decompress=i:this.decompress=wO,e?this.cache=e:this.cache=new SW}getHeader(){return sr(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(t,e,i,r){return sr(this,null,function*(){const n=mW(t,e,i),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return bO.getZxy(o,this.source,this.cache,t,e,i,r);if(t<o.minZoom||t>o.maxZoom)return;let a=o.rootDirectoryOffset,l=o.rootDirectoryLength;for(let h=0;h<=3;h++){const c=yield this.cache.getDirectory(this.source,a,l,o),u=yW(c,n);if(u)if(u.runLength>0){const d=yield this.source.getBytes(o.tileDataOffset+u.offset,u.length,r);if(o.etag&&o.etag!==d.etag)throw new qc(d.etag);return{data:yield this.decompress(d.data,o.tileCompression),cacheControl:d.cacheControl,expires:d.expires}}else a=o.leafDirectoryOffset+u.offset,l=u.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(t,e,i,r){return sr(this,null,function*(){try{return yield this.getZxyAttempt(t,e,i,r)}catch(n){if(n instanceof qc)return this.cache.invalidate(this.source,n.message),yield this.getZxyAttempt(t,e,i,r);throw n}})}getMetadataAttempt(){return sr(this,null,function*(){const t=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(t.jsonMetadataOffset,t.jsonMetadataLength);if(t.etag&&t.etag!==e.etag)throw new qc(e.etag);const i=yield this.decompress(e.data,t.internalCompression),r=new TextDecoder("utf-8");return JSON.parse(r.decode(i))})}getMetadata(){return sr(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(t){if(t instanceof qc)return this.cache.invalidate(this.source,t.message),yield this.getMetadataAttempt();throw t}})}};class CW extends Eo{constructor(t){super(fe.ERROR),this.error=t}}class TW extends iE{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const t=this.peekFirstKey(),e=eO(t)[0];this.forEach(i=>{i.tileCoord[0]!==e&&(this.remove(tl(i.tileCoord)),i.release())})}}const gy=TW,lu={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},cc=[0,0,0],Ha=5;class RW{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,ge(Y3(this.resolutions_,(r,n)=>n-r,!0),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let r=0,n=this.resolutions_.length-1;r<n;++r)if(!e)e=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,ge(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=t.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=va(i)),ge(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,ge(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:Pu,ge(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((r,n)=>{const o=new sE(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,n);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const r=this.getTileRangeForExtentAndZ(t,e);for(let n=r.minX,o=r.maxX;n<=o;++n)for(let a=r.minY,l=r.maxY;a<=l;++a)i([e,n,a])}forEachTileCoordParentTileRange(t,e,i,r){let n,o,a,l=null,h=t[0]-1;for(this.zoomFactor_===2?(o=t[1],a=t[2]):l=this.getTileCoordExtent(t,r);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),n=ac(o,o,a,a,i)):n=this.getTileRangeForExtentAndZ(l,h,i),e(h,n))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const n=t[1]*2,o=t[2]*2;return ac(n,n+1,o,o+1,e)}const r=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const r=t[0],n=t[1],o=t[2];if(e===r)return ac(n,o,n,o,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,e-r),h=Math.floor(n*l),c=Math.floor(o*l);if(e<r)return ac(h,h,c,c,i);const u=Math.floor(l*(n+1))-1,d=Math.floor(l*(o+1))-1;return ac(h,u,c,d,i)}const a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e,i)}getTileRangeForExtentAndZ(t,e,i){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,cc);const r=cc[1],n=cc[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,cc);const o=cc[1],a=cc[2];return ac(r,o,n,a,i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),r=xi(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*r[0]*i,e[1]-(t[2]+.5)*r[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),r=this.getResolution(t[0]),n=xi(this.getTileSize(t[0]),this.tmpSize_),o=i[0]+t[1]*n[0]*r,a=i[1]-(t[2]+1)*n[1]*r,l=o+n[0]*r,h=a+n[1]*r;return $n(o,a,l,h,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,r,n){const o=this.getZForResolution(i),a=i/this.getResolution(o),l=this.getOrigin(o),h=xi(this.getTileSize(o),this.tmpSize_);let c=a*(t-l[0])/i/h[0],u=a*(l[1]-e)/i/h[1];return r?(c=nl(c,Ha)-1,u=nl(u,Ha)-1):(c=Hc(c,Ha),u=Hc(u,Ha)),sg(o,c,u,n)}getTileCoordForXYAndZ_(t,e,i,r,n){const o=this.getOrigin(i),a=this.getResolution(i),l=xi(this.getTileSize(i),this.tmpSize_);let h=(t-o[0])/a/l[0],c=(o[1]-e)/a/l[1];return r?(h=nl(h,Ha)-1,c=nl(c,Ha)-1):(h=Hc(h,Ha),c=Hc(c,Ha)),sg(i,h,c,n)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const i=G_(this.resolutions_,t,e||0);return Jt(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return UA(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let r=this.minZoom;r<e;++r)i[r]=this.getTileRangeForExtentAndZ(t,r);this.fullTileRanges_=i}}const Dl=RW;class MW extends Dl{constructor(t){super({extent:t.extent,origin:t.origin,origins:t.origins,resolutions:t.resolutions,tileSize:t.tileSize,tileSizes:t.tileSizes,sizes:t.sizes}),this.matrixIds_=t.matrixIds}getMatrixId(t){return this.matrixIds_[t]}getMatrixIds(){return this.matrixIds_}}function IW(s,t,e){const i=[],r=[],n=[],o=[],a=[];e=e!==void 0?e:[];const l="SupportedCRS",h="TileMatrix",c="Identifier",u="ScaleDenominator",d="TopLeftCorner",p="TileWidth",g="TileHeight",f=s[l],m=ct(f),_=m.getMetersPerUnit(),y=m.getAxisOrientation().substr(0,2)=="ne";return s[h].sort(function(v,b){return b[u]-v[u]}),s[h].forEach(function(v){let b;if(e.length>0?b=e.find(function(E){return v[c]==E[h]?!0:v[c].includes(":")?!1:s[c]+":"+v[c]===E[h]}):b=!0,b){r.push(v[c]);const E=v[u]*28e-5/_,S=v[p],T=v[g];y?n.push([v[d][1],v[d][0]]):n.push(v[d]),i.push(E),o.push(S==T?S:[S,T]),a.push([v.MatrixWidth,v.MatrixHeight])}}),new MW({extent:t,origins:n,resolutions:i,matrixIds:r,tileSizes:o,sizes:a})}function fE(s){let t=s.getDefaultTileGrid();return t||(t=PW(s),s.setDefaultTileGrid(t)),t}function AW(s,t,e){const i=t[0],r=s.getTileCoordCenter(t),n=Ta(e);if(!Hr(n,r)){const o=Kt(n),a=Math.ceil((n[0]-r[0])/o);return r[0]+=o*a,s.getTileCoordForCoordAndZ(r,i)}return t}function LW(s,t,e,i){i=i!==void 0?i:"top-left";const r=SO(s,t,e);return new Dl({extent:s,origin:u5(s,i),resolutions:r,tileSize:e})}function Vh(s){const t=s||{},e=t.extent||ct("EPSG:3857").getExtent(),i={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:SO(e,t.maxZoom,t.tileSize,t.maxResolution)};return new Dl(i)}function SO(s,t,e,i){t=t!==void 0?t:_P,e=xi(e!==void 0?e:Pu);const r=ci(s),n=Kt(s);i=i>0?i:Math.max(n/e[0],r/e[1]);const o=t+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=i/Math.pow(2,l);return a}function PW(s,t,e,i){const r=Ta(s);return LW(r,t,e,i)}function Ta(s){s=ct(s);let t=s.getExtent();if(!t){const e=180*zp.degrees/s.getMetersPerUnit();t=$n(-e,-e,e,e)}return t}class OW extends ud{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=t.opaque!==void 0?t.opaque:!1,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&xi(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tileCache=new gy(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const i=this.getTileCacheForProjection(t);i&&i.expireCache(e)}forEachLoadedTile(t,e,i,r){const n=this.getTileCacheForProjection(t);if(!n)return!1;let o=!0,a,l,h;for(let c=i.minX;c<=i.maxX;++c)for(let u=i.minY;u<=i.maxY;++u)l=_o(e,c,u),h=!1,n.containsKey(l)&&(a=n.get(l),h=a.getState()===X.LOADED,h&&(h=r(a)!==!1)),h||(o=!1);return o}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,i,r,n){return Lt()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:fE(t)}getTileCacheForProjection(t){const e=this.getProjection();return ge(e===null||Rs(e,t),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const r=this.getTileGridForProjection(i),n=this.getTilePixelRatio(e),o=xi(r.getTileSize(t),this.tmpSize);return n==1?o:pL(o,n,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=e!==void 0?e:this.getProjection();const i=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=AW(i,t,e)),YH(t,i)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const i=this.getTileCacheForProjection(e);t>i.highWaterMark&&(i.highWaterMark=t)}useTile(t,e,i,r){}}let CO=class extends Eo{constructor(t,e){super(t),this.tile=e}};const sf=OW;class FW extends sf{constructor(t){const e=t.projection===void 0?"EPSG:3857":t.projection;let i=t.tileGrid;i===void 0&&e&&(i=Vh({extent:Ta(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize})),super({cacheSize:.1,attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:e,tileGrid:i,opaque:t.opaque,state:t.state,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate}),this.gutter_=t.gutter!==void 0?t.gutter:0,this.tileSize_=t.tileSize?xi(t.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=t.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=t.bandCount===void 0?4:t.bandCount,this.tileGridForProjection_={},this.tileCacheForProjection_={}}setTileSizes(t){this.tileSizes_=t}getTileSize(t){if(this.tileSizes_)return this.tileSizes_[t];if(this.tileSize_)return this.tileSize_;const e=this.getTileGrid();return e?xi(e.getTileSize(t)):[256,256]}getGutterForProjection(t){const e=this.getProjection();return!e||Rs(e,t)?this.gutter_:0}setLoader(t){this.loader_=t}getReprojTile_(t,e,i,r,n){const o=this.getTileCacheForProjection(r),a=_o(t,e,i);if(o.containsKey(a)){const m=o.get(a);if(m&&m.key==this.getKey())return m}const l=this.getTileGrid(),h=Math.max.apply(null,l.getResolutions().map((m,_)=>{const y=xi(l.getTileSize(_)),v=this.getTileSize(_);return Math.max(v[0]/y[0],v[1]/y[1])})),c=this.getTileGridForProjection(n),u=this.getTileGridForProjection(r),d=[t,e,i],p=this.getTileCoordForTileUrlFunction(d,r),g=Object.assign({sourceProj:n,sourceTileGrid:c,targetProj:r,targetTileGrid:u,tileCoord:d,wrappedTileCoord:p,pixelRatio:h,gutter:this.getGutterForProjection(n),getTileFunction:(m,_,y,v)=>this.getTile(m,_,y,v,n)},this.tileOptions),f=new eE(g);return f.key=this.getKey(),f}getTile(t,e,i,r,n){const o=this.getProjection();if(o&&n&&!Rs(o,n))return this.getReprojTile_(t,e,i,n,o);const a=this.getTileSize(t),l=_o(t,e,i);if(this.tileCache.containsKey(l))return this.tileCache.get(l);const h=this.loader_;function c(){return EA(function(){return h(t,e,i)})}const u=Object.assign({tileCoord:[t,e,i],loader:c,size:a},this.tileOptions),d=new Jw(u);return d.key=this.getKey(),d.addEventListener(fe.CHANGE,this.handleTileChange_),this.tileCache.set(l,d),d}handleTileChange_(t){const e=t.target,i=xt(e),r=e.getState();let n;r==X.LOADING?(this.tileLoadingKeys_[i]=!0,n=lu.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],n=r==X.ERROR?lu.TILELOADERROR:r==X.LOADED?lu.TILELOADEND:void 0),n&&this.dispatchEvent(new CO(n,e))}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||Rs(e,t)))return this.tileGrid;const i=xt(t);return i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=fE(t)),this.tileGridForProjection_[i]}setTileGridForProjection(t,e){const i=ct(t);if(i){const r=xt(i);r in this.tileGridForProjection_||(this.tileGridForProjection_[r]=e)}}getTileCacheForProjection(t){const e=this.getProjection();if(!e||Rs(e,t))return this.tileCache;const i=xt(t);return i in this.tileCacheForProjection_||(this.tileCacheForProjection_[i]=new gy(.1)),this.tileCacheForProjection_[i]}expireCache(t,e){const i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(const r in this.tileCacheForProjection_){const n=this.tileCacheForProjection_[r];n.expireCache(n==i?e:{})}}clear(){super.clear();for(const t in this.tileCacheForProjection_)this.tileCacheForProjection_[t].clear()}}const mE=FW;function Fs(s){return(t,...e)=>kW(s,t,e)}function pd(s,t){return Fs(TO(s,t).get)}const{apply:kW,construct:e_t,defineProperty:i_t,get:s_t,getOwnPropertyDescriptor:TO,getPrototypeOf:_E,has:r_t,ownKeys:NW,set:n_t,setPrototypeOf:o_t}=Reflect,{iterator:rf,species:a_t,toStringTag:DW,for:l_t}=Symbol,$W=Object,{create:yE,defineProperty:jW,freeze:h_t,is:c_t}=$W,GW=Array,zW=GW.prototype,RO=zW[rf],BW=Fs(RO),MO=ArrayBuffer,UW=MO.prototype;pd(UW,"byteLength");const PT=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;PT&&pd(PT.prototype,"byteLength");const IO=_E(Uint8Array);IO.from;const cr=IO.prototype;cr[rf];Fs(cr.keys);Fs(cr.values);Fs(cr.entries);Fs(cr.set);Fs(cr.reverse);Fs(cr.fill);Fs(cr.copyWithin);Fs(cr.sort);Fs(cr.slice);Fs(cr.subarray);pd(cr,"buffer");pd(cr,"byteOffset");pd(cr,"length");pd(cr,DW);const VW=Uint8Array,AO=Uint16Array,xE=Uint32Array,HW=Float32Array,rg=_E([][rf]()),LO=Fs(rg.next),WW=Fs(function*(){}().next),XW=_E(rg),qW=DataView.prototype,YW=Fs(qW.getUint16),vE=WeakMap,PO=vE.prototype,OO=Fs(PO.get),ZW=Fs(PO.set),FO=new vE,KW=yE(null,{next:{value:function(){const s=OO(FO,this);return LO(s)}},[rf]:{value:function(){return this}}});function JW(s){if(s[rf]===RO&&rg.next===LO)return s;const t=yE(KW);return ZW(FO,t,BW(s)),t}const QW=new vE,tX=yE(XW,{next:{value:function(){const s=OO(QW,this);return WW(s)},writable:!0,configurable:!0}});for(const s of NW(rg))s!=="next"&&jW(tX,s,TO(rg,s));const kO=new MO(4),eX=new HW(kO),iX=new xE(kO),qn=new AO(512),Yn=new VW(512);for(let s=0;s<256;++s){const t=s-127;t<-27?(qn[s]=0,qn[s|256]=32768,Yn[s]=24,Yn[s|256]=24):t<-14?(qn[s]=1024>>-t-14,qn[s|256]=1024>>-t-14|32768,Yn[s]=-t-1,Yn[s|256]=-t-1):t<=15?(qn[s]=t+15<<10,qn[s|256]=t+15<<10|32768,Yn[s]=13,Yn[s|256]=13):t<128?(qn[s]=31744,qn[s|256]=64512,Yn[s]=24,Yn[s|256]=24):(qn[s]=31744,qn[s|256]=64512,Yn[s]=13,Yn[s|256]=13)}const bE=new xE(2048);for(let s=1;s<1024;++s){let t=s<<13,e=0;for(;!(t&8388608);)t<<=1,e-=8388608;t&=-8388609,e+=947912704,bE[s]=t|e}for(let s=1024;s<2048;++s)bE[s]=939524096+(s-1024<<13);const gd=new xE(64);for(let s=1;s<31;++s)gd[s]=s<<23;gd[31]=1199570944;gd[32]=2147483648;for(let s=33;s<63;++s)gd[s]=2147483648+(s-32<<23);gd[63]=3347054592;const NO=new AO(64);for(let s=1;s<64;++s)s!==32&&(NO[s]=1024);function sX(s){const t=s>>10;return iX[0]=bE[NO[t]+(s&1023)]+gd[t],eX[0]}function DO(s,t,...e){return sX(YW(s,t,...JW(e)))}var wE={exports:{}};function $O(s,t,e){const i=e&&e.debug||!1;i&&console.log("[xml-utils] getting "+t+" in "+s);const r=typeof s=="object"?s.outer:s,n=r.slice(0,r.indexOf(">")+1),o=['"',"'"];for(let a=0;a<o.length;a++){const l=o[a],h=t+"\\="+l+"([^"+l+"]*)"+l;i&&console.log("[xml-utils] pattern:",h);const c=new RegExp(h).exec(n);if(i&&console.log("[xml-utils] match:",c),c)return c[1]}}wE.exports=$O;wE.exports.default=$O;var rX=wE.exports;const Y1=od(rX);var EE={exports:{}},SE={exports:{}},CE={exports:{}};function jO(s,t,e){const i=new RegExp(t).exec(s.slice(e));return i?e+i.index:-1}CE.exports=jO;CE.exports.default=jO;var nX=CE.exports,TE={exports:{}};function GO(s,t,e){const i=new RegExp(t).exec(s.slice(e));return i?e+i.index+i[0].length-1:-1}TE.exports=GO;TE.exports.default=GO;var oX=TE.exports,RE={exports:{}};function zO(s,t){const e=new RegExp(t,"g"),i=s.match(e);return i?i.length:0}RE.exports=zO;RE.exports.default=zO;var aX=RE.exports;const lX=nX,Z1=oX,OT=aX;function BO(s,t,e){const i=e&&e.debug||!1,r=!(e&&typeof e.nested===!1),n=e&&e.startIndex||0;i&&console.log("[xml-utils] starting findTagByName with",t," and ",e);const o=lX(s,`<${t}[ 
>/]`,n);if(i&&console.log("[xml-utils] start:",o),o===-1)return;const a=s.slice(o+t.length);let l=Z1(a,"^[^<]*[ /]>",0);const h=l!==-1&&a[l-1]==="/";if(i&&console.log("[xml-utils] selfClosing:",h),h===!1)if(r){let p=0,g=1,f=0;for(;(l=Z1(a,"[ /]"+t+">",p))!==-1;){const m=a.substring(p,l+1);if(g+=OT(m,"<"+t+`[ 
	>]`),f+=OT(m,"</"+t+">"),f>=g)break;p=l}}else l=Z1(a,"[ /]"+t+">",0);const c=o+t.length+l+1;if(i&&console.log("[xml-utils] end:",c),c===-1)return;const u=s.slice(o,c);let d;return h?d=null:d=u.slice(u.indexOf(">")+1,u.lastIndexOf("<")),{inner:d,outer:u,start:o,end:c}}SE.exports=BO;SE.exports.default=BO;var hX=SE.exports;const cX=hX;function UO(s,t,e){const i=[],r=e&&e.debug||!1,n=e&&typeof e.nested=="boolean"?e.nested:!0;let o=e&&e.startIndex||0,a;for(;a=cX(s,t,{debug:r,startIndex:o});)n?o=a.start+1+t.length:o=a.end,i.push(a);return r&&console.log("findTagsByName found",i.length,"tags"),i}EE.exports=UO;EE.exports.default=UO;var uX=EE.exports;const dX=od(uX),yp={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},Kn={};for(const s in yp)yp.hasOwnProperty(s)&&(Kn[yp[s]]=parseInt(s,10));const pX=[Kn.BitsPerSample,Kn.ExtraSamples,Kn.SampleFormat,Kn.StripByteCounts,Kn.StripOffsets,Kn.StripRowCounts,Kn.TileByteCounts,Kn.TileOffsets,Kn.SubIFDs],K1={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},ne={};for(const s in K1)K1.hasOwnProperty(s)&&(ne[K1[s]]=parseInt(s,10));const fr={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},gX={Unspecified:0,Assocalpha:1,Unassalpha:2},u_t={Version:0,AddCompression:1},d_t={None:0,Deflate:1,Zstandard:2},fX={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function mX(s,t){const{width:e,height:i}=s,r=new Uint8Array(e*i*3);let n;for(let o=0,a=0;o<s.length;++o,a+=3)n=256-s[o]/t*256,r[a]=n,r[a+1]=n,r[a+2]=n;return r}function _X(s,t){const{width:e,height:i}=s,r=new Uint8Array(e*i*3);let n;for(let o=0,a=0;o<s.length;++o,a+=3)n=s[o]/t*256,r[a]=n,r[a+1]=n,r[a+2]=n;return r}function yX(s,t){const{width:e,height:i}=s,r=new Uint8Array(e*i*3),n=t.length/3,o=t.length/3*2;for(let a=0,l=0;a<s.length;++a,l+=3){const h=s[a];r[l]=t[h]/65536*256,r[l+1]=t[h+n]/65536*256,r[l+2]=t[h+o]/65536*256}return r}function xX(s){const{width:t,height:e}=s,i=new Uint8Array(t*e*3);for(let r=0,n=0;r<s.length;r+=4,n+=3){const o=s[r],a=s[r+1],l=s[r+2],h=s[r+3];i[n]=255*((255-o)/256)*((255-h)/256),i[n+1]=255*((255-a)/256)*((255-h)/256),i[n+2]=255*((255-l)/256)*((255-h)/256)}return i}function vX(s){const{width:t,height:e}=s,i=new Uint8ClampedArray(t*e*3);for(let r=0,n=0;r<s.length;r+=3,n+=3){const o=s[r],a=s[r+1],l=s[r+2];i[n]=o+1.402*(l-128),i[n+1]=o-.34414*(a-128)-.71414*(l-128),i[n+2]=o+1.772*(a-128)}return i}const bX=.95047,wX=1,EX=1.08883;function SX(s){const{width:t,height:e}=s,i=new Uint8Array(t*e*3);for(let r=0,n=0;r<s.length;r+=3,n+=3){const o=s[r+0],a=s[r+1]<<24>>24,l=s[r+2]<<24>>24;let h=(o+16)/116,c=a/500+h,u=h-l/200,d,p,g;c=bX*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),h=wX*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),u=EX*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),d=c*3.2406+h*-1.5372+u*-.4986,p=c*-.9689+h*1.8758+u*.0415,g=c*.0557+h*-.204+u*1.057,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,i[n]=Math.max(0,Math.min(1,d))*255,i[n+1]=Math.max(0,Math.min(1,p))*255,i[n+2]=Math.max(0,Math.min(1,g))*255}return i}const VO=new Map;function $l(s,t){Array.isArray(s)||(s=[s]),s.forEach(e=>VO.set(e,t))}async function HO(s){const t=VO.get(s.Compression);if(!t)throw new Error(`Unknown compression method identifier: ${s.Compression}`);const e=await t();return new e(s)}$l([void 0,1],()=>kl(()=>import("./raw-_eObXrMO-oXDaFVpk.js"),__vite__mapDeps([0,1]),import.meta.url).then(s=>s.default));$l(5,()=>kl(()=>import("./lzw-5BnjP5Zu-0J7qsfmy.js"),__vite__mapDeps([2,1]),import.meta.url).then(s=>s.default));$l(6,()=>{throw new Error("old style JPEG compression is not supported.")});$l(7,()=>kl(()=>import("./jpeg-cL5qbLGO-7dbkD1kf.js"),__vite__mapDeps([3,1]),import.meta.url).then(s=>s.default));$l([8,32946],()=>kl(()=>import("./deflate-vcCR2g03-wnJcwXgQ.js"),__vite__mapDeps([4,5,1]),import.meta.url).then(s=>s.default));$l(32773,()=>kl(()=>import("./packbits-QLsyzNt2-ZLc6Jich.js"),__vite__mapDeps([6,1]),import.meta.url).then(s=>s.default));$l(34887,()=>kl(()=>import("./lerc-9qQlmsx0-loZIUmm3.js"),__vite__mapDeps([7,5,1,8,9,10,11,12,13,14,15,16,17]),import.meta.url).then(async s=>(await s.zstd.init(),s)).then(s=>s.default));$l(50001,()=>kl(()=>import("./webimage-Hf-HYtMO-GVd5WROI.js"),__vite__mapDeps([18,1]),import.meta.url).then(s=>s.default));function fy(s,t,e,i=1){return new(Object.getPrototypeOf(s)).constructor(t*e*i)}function CX(s,t,e,i,r){const n=t/i,o=e/r;return s.map(a=>{const l=fy(a,i,r);for(let h=0;h<r;++h){const c=Math.min(Math.round(o*h),e-1);for(let u=0;u<i;++u){const d=Math.min(Math.round(n*u),t-1),p=a[c*t+d];l[h*i+u]=p}}return l})}function hu(s,t,e){return(1-e)*s+e*t}function TX(s,t,e,i,r){const n=t/i,o=e/r;return s.map(a=>{const l=fy(a,i,r);for(let h=0;h<r;++h){const c=o*h,u=Math.floor(c),d=Math.min(Math.ceil(c),e-1);for(let p=0;p<i;++p){const g=n*p,f=g%1,m=Math.floor(g),_=Math.min(Math.ceil(g),t-1),y=a[u*t+m],v=a[u*t+_],b=a[d*t+m],E=a[d*t+_],S=hu(hu(y,v,f),hu(b,E,f),c%1);l[h*i+p]=S}}return l})}function RX(s,t,e,i,r,n="nearest"){switch(n.toLowerCase()){case"nearest":return CX(s,t,e,i,r);case"bilinear":case"linear":return TX(s,t,e,i,r);default:throw new Error(`Unsupported resampling method: '${n}'`)}}function MX(s,t,e,i,r,n){const o=t/i,a=e/r,l=fy(s,i,r,n);for(let h=0;h<r;++h){const c=Math.min(Math.round(a*h),e-1);for(let u=0;u<i;++u){const d=Math.min(Math.round(o*u),t-1);for(let p=0;p<n;++p){const g=s[c*t*n+d*n+p];l[h*i*n+u*n+p]=g}}}return l}function IX(s,t,e,i,r,n){const o=t/i,a=e/r,l=fy(s,i,r,n);for(let h=0;h<r;++h){const c=a*h,u=Math.floor(c),d=Math.min(Math.ceil(c),e-1);for(let p=0;p<i;++p){const g=o*p,f=g%1,m=Math.floor(g),_=Math.min(Math.ceil(g),t-1);for(let y=0;y<n;++y){const v=s[u*t*n+m*n+y],b=s[u*t*n+_*n+y],E=s[d*t*n+m*n+y],S=s[d*t*n+_*n+y],T=hu(hu(v,b,f),hu(E,S,f),c%1);l[h*i*n+p*n+y]=T}}}return l}function AX(s,t,e,i,r,n,o="nearest"){switch(o.toLowerCase()){case"nearest":return MX(s,t,e,i,r,n);case"bilinear":case"linear":return IX(s,t,e,i,r,n);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function LX(s,t,e){let i=0;for(let r=t;r<e;++r)i+=s[r];return i}function zv(s,t,e){switch(s){case 1:if(t<=8)return new Uint8Array(e);if(t<=16)return new Uint16Array(e);if(t<=32)return new Uint32Array(e);break;case 2:if(t===8)return new Int8Array(e);if(t===16)return new Int16Array(e);if(t===32)return new Int32Array(e);break;case 3:switch(t){case 16:case 32:return new Float32Array(e);case 64:return new Float64Array(e)}break}throw Error("Unsupported data format/bitsPerSample")}function PX(s,t){return(s===1||s===2)&&t<=32&&t%8===0?!1:!(s===3&&(t===16||t===32||t===64))}function OX(s,t,e,i,r,n,o){const a=new DataView(s),l=e===2?o*n:o*n*i,h=e===2?1:i,c=zv(t,r,l),u=parseInt("1".repeat(r),2);if(t===1){let d;e===1?d=i*r:d=r;let p=n*d;p&7&&(p=p+7&-8);for(let g=0;g<o;++g){const f=g*p;for(let m=0;m<n;++m){const _=f+m*h*r;for(let y=0;y<h;++y){const v=_+y*r,b=(g*n+m)*h+y,E=Math.floor(v/8),S=v%8;if(S+r<=8)c[b]=a.getUint8(E)>>8-r-S&u;else if(S+r<=16)c[b]=a.getUint16(E)>>16-r-S&u;else if(S+r<=24){const T=a.getUint16(E)<<8|a.getUint8(E+2);c[b]=T>>24-r-S&u}else c[b]=a.getUint32(E)>>32-r-S&u}}}}return c.buffer}class FX{constructor(t,e,i,r,n,o){this.fileDirectory=t,this.geoKeys=e,this.dataView=i,this.littleEndian=r,this.tiles=n?{}:null,this.isTiled=!t.StripOffsets;const a=t.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(t){return this.isTiled||(t+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-t*this.getTileHeight()}getBytesPerPixel(){let t=0;for(let e=0;e<this.fileDirectory.BitsPerSample.length;++e)t+=this.getSampleByteSize(e);return t}getSampleByteSize(t){if(t>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${t} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[t]/8)}getReaderForSample(t){const e=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1,i=this.fileDirectory.BitsPerSample[t];switch(e){case 1:if(i<=8)return DataView.prototype.getUint8;if(i<=16)return DataView.prototype.getUint16;if(i<=32)return DataView.prototype.getUint32;break;case 2:if(i<=8)return DataView.prototype.getInt8;if(i<=16)return DataView.prototype.getInt16;if(i<=32)return DataView.prototype.getInt32;break;case 3:switch(i){case 16:return function(r,n){return DO(this,r,n)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(t=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1}getBitsPerSample(t=0){return this.fileDirectory.BitsPerSample[t]}getArrayForSample(t,e){const i=this.getSampleFormat(t),r=this.getBitsPerSample(t);return zv(i,r,e)}async getTileOrStrip(t,e,i,r,n){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:h}=this;this.planarConfiguration===1?l=e*o+t:this.planarConfiguration===2&&(l=i*o*a+e*o+t);let c,u;this.isTiled?(c=this.fileDirectory.TileOffsets[l],u=this.fileDirectory.TileByteCounts[l]):(c=this.fileDirectory.StripOffsets[l],u=this.fileDirectory.StripByteCounts[l]);const d=(await this.source.fetch([{offset:c,length:u}],n))[0];let p;return h===null||!h[l]?(p=(async()=>{let g=await r.decode(this.fileDirectory,d);const f=this.getSampleFormat(),m=this.getBitsPerSample();return PX(f,m)&&(g=OX(g,f,this.planarConfiguration,this.getSamplesPerPixel(),m,this.getTileWidth(),this.getBlockHeight(e))),g})(),h!==null&&(h[l]=p)):p=h[l],{x:t,y:e,sample:i,data:await p}}async _readRaster(t,e,i,r,n,o,a,l,h){const c=this.getTileWidth(),u=this.getTileHeight(),d=this.getWidth(),p=this.getHeight(),g=Math.max(Math.floor(t[0]/c),0),f=Math.min(Math.ceil(t[2]/c),Math.ceil(d/c)),m=Math.max(Math.floor(t[1]/u),0),_=Math.min(Math.ceil(t[3]/u),Math.ceil(p/u)),y=t[2]-t[0];let v=this.getBytesPerPixel();const b=[],E=[];for(let R=0;R<e.length;++R)this.planarConfiguration===1?b.push(LX(this.fileDirectory.BitsPerSample,0,e[R])/8):b.push(0),E.push(this.getReaderForSample(e[R]));const S=[],{littleEndian:T}=this;for(let R=m;R<_;++R)for(let M=g;M<f;++M){let A;this.planarConfiguration===1&&(A=this.getTileOrStrip(M,R,0,n,h));for(let O=0;O<e.length;++O){const N=O,x=e[O];this.planarConfiguration===2&&(v=this.getSampleByteSize(x),A=this.getTileOrStrip(M,R,x,n,h));const w=A.then(C=>{const I=C.data,L=new DataView(I),j=this.getBlockHeight(C.y),z=C.y*u,B=C.x*c,H=z+j,Y=(C.x+1)*c,at=E[N],k=Math.min(j,j-(H-t[3]),p-z),it=Math.min(c,c-(Y-t[2]),d-B);for(let nt=Math.max(0,t[1]-z);nt<k;++nt)for(let ht=Math.max(0,t[0]-B);ht<it;++ht){const Pt=(nt*c+ht)*v,Ct=at.call(L,Pt+b[N],T);let ft;r?(ft=(nt+z-t[1])*y*e.length+(ht+B-t[0])*e.length+N,i[ft]=Ct):(ft=(nt+z-t[1])*y+ht+B-t[0],i[N][ft]=Ct)}});S.push(w)}}if(await Promise.all(S),o&&t[2]-t[0]!==o||a&&t[3]-t[1]!==a){let R;return r?R=AX(i,t[2]-t[0],t[3]-t[1],o,a,e.length,l):R=RX(i,t[2]-t[0],t[3]-t[1],o,a,l),R.width=o,R.height=a,R}return i.width=o||t[2]-t[0],i.height=a||t[3]-t[1],i}async readRasters({window:t,samples:e=[],interleave:i,pool:r=null,width:n,height:o,resampleMethod:a,fillValue:l,signal:h}={}){const c=t||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const u=c[2]-c[0],d=c[3]-c[1],p=u*d,g=this.getSamplesPerPixel();if(!e||!e.length)for(let _=0;_<g;++_)e.push(_);else for(let _=0;_<e.length;++_)if(e[_]>=g)return Promise.reject(new RangeError(`Invalid sample index '${e[_]}'.`));let f;if(i){const _=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,y=Math.max.apply(null,this.fileDirectory.BitsPerSample);f=zv(_,y,p*e.length),l&&f.fill(l)}else{f=[];for(let _=0;_<e.length;++_){const y=this.getArrayForSample(e[_],p);Array.isArray(l)&&_<l.length?y.fill(l[_]):l&&!Array.isArray(l)&&y.fill(l),f.push(y)}}const m=r||await HO(this.fileDirectory);return await this._readRaster(c,e,f,i,m,n,o,a,h)}async readRGB({window:t,interleave:e=!0,pool:i=null,width:r,height:n,resampleMethod:o,enableAlpha:a=!1,signal:l}={}){const h=t||[0,0,this.getWidth(),this.getHeight()];if(h[0]>h[2]||h[1]>h[3])throw new Error("Invalid subsets");const c=this.fileDirectory.PhotometricInterpretation;if(c===fr.RGB){let _=[0,1,2];if(this.fileDirectory.ExtraSamples!==gX.Unspecified&&a){_=[];for(let y=0;y<this.fileDirectory.BitsPerSample.length;y+=1)_.push(y)}return this.readRasters({window:t,interleave:e,samples:_,pool:i,width:r,height:n,resampleMethod:o,signal:l})}let u;switch(c){case fr.WhiteIsZero:case fr.BlackIsZero:case fr.Palette:u=[0];break;case fr.CMYK:u=[0,1,2,3];break;case fr.YCbCr:case fr.CIELab:u=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const d={window:h,interleave:!0,samples:u,pool:i,width:r,height:n,resampleMethod:o,signal:l},{fileDirectory:p}=this,g=await this.readRasters(d),f=2**this.fileDirectory.BitsPerSample[0];let m;switch(c){case fr.WhiteIsZero:m=mX(g,f);break;case fr.BlackIsZero:m=_X(g,f);break;case fr.Palette:m=yX(g,p.ColorMap);break;case fr.CMYK:m=xX(g);break;case fr.YCbCr:m=vX(g);break;case fr.CIELab:m=SX(g);break;default:throw new Error("Unsupported photometric interpretation.")}if(!e){const _=new Uint8Array(m.length/3),y=new Uint8Array(m.length/3),v=new Uint8Array(m.length/3);for(let b=0,E=0;b<m.length;b+=3,++E)_[E]=m[b],y[E]=m[b+1],v[E]=m[b+2];m=[_,y,v]}return m.width=g.width,m.height=g.height,m}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const t=[];for(let e=0;e<this.fileDirectory.ModelTiepoint.length;e+=6)t.push({i:this.fileDirectory.ModelTiepoint[e],j:this.fileDirectory.ModelTiepoint[e+1],k:this.fileDirectory.ModelTiepoint[e+2],x:this.fileDirectory.ModelTiepoint[e+3],y:this.fileDirectory.ModelTiepoint[e+4],z:this.fileDirectory.ModelTiepoint[e+5]});return t}getGDALMetadata(t=null){const e={};if(!this.fileDirectory.GDAL_METADATA)return null;const i=this.fileDirectory.GDAL_METADATA;let r=dX(i,"Item");t===null?r=r.filter(n=>Y1(n,"sample")===void 0):r=r.filter(n=>Number(Y1(n,"sample"))===t);for(let n=0;n<r.length;++n){const o=r[n];e[Y1(o,"name")]=o.inner}return e}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const t=this.fileDirectory.GDAL_NODATA;return Number(t.substring(0,t.length-1))}getOrigin(){const t=this.fileDirectory.ModelTiepoint,e=this.fileDirectory.ModelTransformation;if(t&&t.length===6)return[t[3],t[4],t[5]];if(e)return[e[3],e[7],e[11]];throw new Error("The image does not have an affine transformation.")}getResolution(t=null){const e=this.fileDirectory.ModelPixelScale,i=this.fileDirectory.ModelTransformation;if(e)return[e[0],-e[1],e[2]];if(i)return[i[0],-i[5],i[10]];if(t){const[r,n,o]=t.getResolution();return[r*t.getWidth()/this.getWidth(),n*t.getHeight()/this.getHeight(),o*t.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(){const t=this.getHeight(),e=this.getWidth();if(this.fileDirectory.ModelTransformation){const[i,r,n,o,a,l,h,c]=this.fileDirectory.ModelTransformation,u=[[0,0],[0,t],[e,0],[e,t]].map(([g,f])=>[o+i*g+r*f,c+a*g+l*f]),d=u.map(g=>g[0]),p=u.map(g=>g[1]);return[Math.min(...d),Math.min(...p),Math.max(...d),Math.max(...p)]}else{const i=this.getOrigin(),r=this.getResolution(),n=i[0],o=i[1],a=n+r[0]*this.getWidth(),l=o+r[1]*this.getHeight();return[Math.min(n,a),Math.min(o,l),Math.max(n,a),Math.max(o,l)]}}}const WO=FX;class kX{constructor(t){this._dataView=new DataView(t)}get buffer(){return this._dataView.buffer}getUint64(t,e){const i=this.getUint32(t,e),r=this.getUint32(t+4,e);let n;if(e){if(n=i+2**32*r,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}if(n=2**32*i+r,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}getInt64(t,e){let i=0;const r=(this._dataView.getUint8(t+(e?7:0))&128)>0;let n=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(t+(e?o:7-o));r&&(n?a!==0&&(a=~(a-1)&255,n=!1):a=~a&255),i+=a*256**o}return r&&(i=-i),i}getUint8(t,e){return this._dataView.getUint8(t,e)}getInt8(t,e){return this._dataView.getInt8(t,e)}getUint16(t,e){return this._dataView.getUint16(t,e)}getInt16(t,e){return this._dataView.getInt16(t,e)}getUint32(t,e){return this._dataView.getUint32(t,e)}getInt32(t,e){return this._dataView.getInt32(t,e)}getFloat16(t,e){return DO(this._dataView,t,e)}getFloat32(t,e){return this._dataView.getFloat32(t,e)}getFloat64(t,e){return this._dataView.getFloat64(t,e)}}class NX{constructor(t,e,i,r){this._dataView=new DataView(t),this._sliceOffset=e,this._littleEndian=i,this._bigTiff=r}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(t,e){return this.sliceOffset<=t&&this.sliceTop>=t+e}readUint8(t){return this._dataView.getUint8(t-this._sliceOffset,this._littleEndian)}readInt8(t){return this._dataView.getInt8(t-this._sliceOffset,this._littleEndian)}readUint16(t){return this._dataView.getUint16(t-this._sliceOffset,this._littleEndian)}readInt16(t){return this._dataView.getInt16(t-this._sliceOffset,this._littleEndian)}readUint32(t){return this._dataView.getUint32(t-this._sliceOffset,this._littleEndian)}readInt32(t){return this._dataView.getInt32(t-this._sliceOffset,this._littleEndian)}readFloat32(t){return this._dataView.getFloat32(t-this._sliceOffset,this._littleEndian)}readFloat64(t){return this._dataView.getFloat64(t-this._sliceOffset,this._littleEndian)}readUint64(t){const e=this.readUint32(t),i=this.readUint32(t+4);let r;if(this._littleEndian){if(r=e+2**32*i,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}if(r=2**32*e+i,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}readInt64(t){let e=0;const i=(this._dataView.getUint8(t+(this._littleEndian?7:0))&128)>0;let r=!0;for(let n=0;n<8;n++){let o=this._dataView.getUint8(t+(this._littleEndian?n:7-n));i&&(r?o!==0&&(o=~(o-1)&255,r=!1):o=~o&255),e+=o*256**n}return i&&(e=-e),e}readOffset(t){return this._bigTiff?this.readUint64(t):this.readUint32(t)}}const DX=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class $X{constructor(t=DX,e){this.workers=null,this._awaitingDecoder=null,this.size=t,this.messageId=0,t&&(this._awaitingDecoder=e?Promise.resolve(e):new Promise(i=>{kl(()=>import("./decoder-00rTu5yO-N9Evg126.js"),__vite__mapDeps([19,8,9,10,11,12,13,14,15,16,17]),import.meta.url).then(r=>{i(r.create)})}),this._awaitingDecoder.then(i=>{this._awaitingDecoder=null,this.workers=[];for(let r=0;r<t;r++)this.workers.push({worker:i(),idle:!0})}))}async decode(t,e){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?HO(t).then(i=>i.decode(t,e)):new Promise(i=>{const r=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];r.idle=!1;const n=this.messageId++,o=a=>{a.data.id===n&&(r.idle=!0,i(a.data.decoded),r.worker.removeEventListener("message",o))};r.worker.addEventListener("message",o),r.worker.postMessage({fileDirectory:t,buffer:e,id:n},[e])})}destroy(){this.workers&&(this.workers.forEach(t=>{t.worker.terminate()}),this.workers=null)}}const jX=$X,FT=`\r
\r
`;function XO(s){if(typeof Object.fromEntries<"u")return Object.fromEntries(s);const t={};for(const[e,i]of s)t[e.toLowerCase()]=i;return t}function GX(s){const t=s.split(`\r
`).map(e=>{const i=e.split(":").map(r=>r.trim());return i[0]=i[0].toLowerCase(),i});return XO(t)}function zX(s){const[t,...e]=s.split(";").map(r=>r.trim()),i=e.map(r=>r.split("="));return{type:t,params:XO(i)}}function Bv(s){let t,e,i;return s&&([,t,e,i]=s.match(/bytes (\d+)-(\d+)\/(\d+)/),t=parseInt(t,10),e=parseInt(e,10),i=parseInt(i,10)),{start:t,end:e,total:i}}function BX(s,t){let e=null;const i=new TextDecoder("ascii"),r=[],n=`--${t}`,o=`${n}--`;for(let a=0;a<10;++a)i.decode(new Uint8Array(s,a,n.length))===n&&(e=a);if(e===null)throw new Error("Could not find initial boundary");for(;e<s.byteLength;){const a=i.decode(new Uint8Array(s,e,Math.min(n.length+1024,s.byteLength-e)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(n))throw new Error("Part does not start with boundary");const l=a.substr(n.length+2);if(l.length===0)break;const h=l.indexOf(FT),c=GX(l.substr(0,h)),{start:u,end:d,total:p}=Bv(c["content-range"]),g=e+n.length+h+FT.length,f=parseInt(d,10)+1-parseInt(u,10);r.push({headers:c,data:s.slice(g,g+f),offset:u,length:f,fileSize:p}),e=g+f+4}return r}let ME=class{async fetch(t,e=void 0){return Promise.all(t.map(i=>this.fetchSlice(i,e)))}async fetchSlice(t){throw new Error(`fetching of slice ${t} not possible, not implemented`)}get fileSize(){return null}async close(){}};class UX extends Map{constructor(t={}){if(super(),!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof t.maxAge=="number"&&t.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=t.maxSize,this.maxAge=t.maxAge||Number.POSITIVE_INFINITY,this.onEviction=t.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(t){if(typeof this.onEviction=="function")for(const[e,i]of t)this.onEviction(e,i.value)}_deleteIfExpired(t,e){return typeof e.expiry=="number"&&e.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(t,e.value),this.delete(t)):!1}_getOrDeleteIfExpired(t,e){if(this._deleteIfExpired(t,e)===!1)return e.value}_getItemValue(t,e){return e.expiry?this._getOrDeleteIfExpired(t,e):e.value}_peek(t,e){const i=e.get(t);return this._getItemValue(t,i)}_set(t,e){this.cache.set(t,e),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(t,e){this.oldCache.delete(t),this._set(t,e)}*_entriesAscending(){for(const t of this.oldCache){const[e,i]=t;this.cache.has(e)||this._deleteIfExpired(e,i)===!1&&(yield t)}for(const t of this.cache){const[e,i]=t;this._deleteIfExpired(e,i)===!1&&(yield t)}}get(t){if(this.cache.has(t)){const e=this.cache.get(t);return this._getItemValue(t,e)}if(this.oldCache.has(t)){const e=this.oldCache.get(t);if(this._deleteIfExpired(t,e)===!1)return this._moveToRecent(t,e),e.value}}set(t,e,{maxAge:i=this.maxAge}={}){const r=typeof i=="number"&&i!==Number.POSITIVE_INFINITY?Date.now()+i:void 0;return this.cache.has(t)?this.cache.set(t,{value:e,expiry:r}):this._set(t,{value:e,expiry:r}),this}has(t){return this.cache.has(t)?!this._deleteIfExpired(t,this.cache.get(t)):this.oldCache.has(t)?!this._deleteIfExpired(t,this.oldCache.get(t)):!1}peek(t){if(this.cache.has(t))return this._peek(t,this.cache);if(this.oldCache.has(t))return this._peek(t,this.oldCache)}delete(t){const e=this.cache.delete(t);return e&&this._size--,this.oldCache.delete(t)||e}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(t){if(!(t&&t>0))throw new TypeError("`maxSize` must be a number greater than 0");const e=[...this._entriesAscending()],i=e.length-t;i<0?(this.cache=new Map(e),this.oldCache=new Map,this._size=e.length):(i>0&&this._emitEvictions(e.slice(0,i)),this.oldCache=new Map(e.slice(i)),this.cache=new Map,this._size=0),this.maxSize=t}*keys(){for(const[t]of this)yield t}*values(){for(const[,t]of this)yield t}*[Symbol.iterator](){for(const t of this.cache){const[e,i]=t;this._deleteIfExpired(e,i)===!1&&(yield[e,i.value])}for(const t of this.oldCache){const[e,i]=t;this.cache.has(e)||this._deleteIfExpired(e,i)===!1&&(yield[e,i.value])}}*entriesDescending(){let t=[...this.cache];for(let e=t.length-1;e>=0;--e){const i=t[e],[r,n]=i;this._deleteIfExpired(r,n)===!1&&(yield[r,n.value])}t=[...this.oldCache];for(let e=t.length-1;e>=0;--e){const i=t[e],[r,n]=i;this.cache.has(r)||this._deleteIfExpired(r,n)===!1&&(yield[r,n.value])}}*entriesAscending(){for(const[t,e]of this._entriesAscending())yield[t,e.value]}get size(){if(!this._size)return this.oldCache.size;let t=0;for(const e of this.oldCache.keys())this.cache.has(e)||t++;return Math.min(this._size+t,this.maxSize)}entries(){return this.entriesAscending()}forEach(t,e=this){for(const[i,r]of this.entriesAscending())t.call(e,r,i,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function VX(s){return new Promise(t=>setTimeout(t,s))}function HX(s,t){const e=Array.isArray(s)?s:Array.from(s),i=Array.isArray(t)?t:Array.from(t);return e.map((r,n)=>[r,i[n]])}let R0=class qO extends Error{constructor(t){super(t),Error.captureStackTrace&&Error.captureStackTrace(this,qO),this.name="AbortError"}};class WX extends Error{constructor(t,e){super(e),this.errors=t,this.message=e,this.name="AggregateError"}}const XX=WX;class qX{constructor(t,e,i=null){this.offset=t,this.length=e,this.data=i}get top(){return this.offset+this.length}}let kT=class{constructor(t,e,i){this.offset=t,this.length=e,this.blockIds=i}};class YX extends ME{constructor(t,{blockSize:e=65536,cacheSize:i=100}={}){super(),this.source=t,this.blockSize=e,this.blockCache=new UX({maxSize:i,onEviction:(r,n)=>{this.evictedBlocks.set(r,n)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(t,e){const i=[],r=[],n=[];this.evictedBlocks.clear();for(const{offset:d,length:p}of t){let g=d+p;const{fileSize:f}=this;f!==null&&(g=Math.min(g,f));const m=Math.floor(d/this.blockSize)*this.blockSize;for(let _=m;_<g;_+=this.blockSize){const y=Math.floor(_/this.blockSize);!this.blockCache.has(y)&&!this.blockRequests.has(y)&&(this.blockIdsToFetch.add(y),r.push(y)),this.blockRequests.has(y)&&i.push(this.blockRequests.get(y)),n.push(y)}}await VX(),this.fetchBlocks(e);const o=[];for(const d of r)this.blockRequests.has(d)&&o.push(this.blockRequests.get(d));await Promise.allSettled(i),await Promise.allSettled(o);const a=[],l=n.filter(d=>this.abortedBlockIds.has(d)||!this.blockCache.has(d));if(l.forEach(d=>this.blockIdsToFetch.add(d)),l.length>0&&e&&!e.aborted){this.fetchBlocks(null);for(const d of l){const p=this.blockRequests.get(d);if(!p)throw new Error(`Block ${d} is not in the block requests`);a.push(p)}await Promise.allSettled(a)}if(e&&e.aborted)throw new R0("Request was aborted");const h=n.map(d=>this.blockCache.get(d)||this.evictedBlocks.get(d)),c=h.filter(d=>!d);if(c.length)throw new XX(c,"Request failed");const u=new Map(HX(n,h));return this.readSliceData(t,u)}fetchBlocks(t){if(this.blockIdsToFetch.size>0){const e=this.groupBlocks(this.blockIdsToFetch),i=this.source.fetch(e,t);for(let r=0;r<e.length;++r){const n=e[r];for(const o of n.blockIds)this.blockRequests.set(o,(async()=>{try{const a=(await i)[r],l=o*this.blockSize,h=l-a.offset,c=Math.min(h+this.blockSize,a.data.byteLength),u=a.data.slice(h,c),d=new qX(l,u.byteLength,u,o);this.blockCache.set(o,d),this.abortedBlockIds.delete(o)}catch(a){if(a.name==="AbortError")a.signal=t,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw a}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(t){const e=Array.from(t).sort((o,a)=>o-a);if(e.length===0)return[];let i=[],r=null;const n=[];for(const o of e)r===null||r+1===o?(i.push(o),r=o):(n.push(new kT(i[0]*this.blockSize,i.length*this.blockSize,i)),i=[o],r=o);return n.push(new kT(i[0]*this.blockSize,i.length*this.blockSize,i)),n}readSliceData(t,e){return t.map(i=>{let r=i.offset+i.length;this.fileSize!==null&&(r=Math.min(this.fileSize,r));const n=Math.floor(i.offset/this.blockSize),o=Math.floor(r/this.blockSize),a=new ArrayBuffer(i.length),l=new Uint8Array(a);for(let h=n;h<=o;++h){const c=e.get(h),u=c.offset-i.offset,d=c.top-r;let p=0,g=0,f;u<0?p=-u:u>0&&(g=u),d<0?f=c.length-p:f=r-c.offset-p;const m=new Uint8Array(c.data,p,f);l.set(m,g)}return a})}}let IE=class{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(t){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}},AE=class{constructor(t){this.url=t}async request({headers:t,credentials:e,signal:i}={}){throw new Error("request is not implemented")}};class ZX extends IE{constructor(t){super(),this.response=t}get status(){return this.response.status}getHeader(t){return this.response.headers.get(t)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class KX extends AE{constructor(t,e){super(t),this.credentials=e}async request({headers:t,credentials:e,signal:i}={}){const r=await fetch(this.url,{headers:t,credentials:e,signal:i});return new ZX(r)}}class JX extends IE{constructor(t,e){super(),this.xhr=t,this.data=e}get status(){return this.xhr.status}getHeader(t){return this.xhr.getResponseHeader(t)}async getData(){return this.data}}class QX extends AE{constructRequest(t,e){return new Promise((i,r)=>{const n=new XMLHttpRequest;n.open("GET",this.url),n.responseType="arraybuffer";for(const[o,a]of Object.entries(t))n.setRequestHeader(o,a);n.onload=()=>{const o=n.response;i(new JX(n,o))},n.onerror=r,n.onabort=()=>r(new R0("Request aborted")),n.send(),e&&(e.aborted&&n.abort(),e.addEventListener("abort",()=>n.abort()))})}async request({headers:t,signal:e}={}){return await this.constructRequest(t,e)}}const NT={};class tq extends IE{constructor(t,e){super(),this.response=t,this.dataPromise=e}get status(){return this.response.statusCode}getHeader(t){return this.response.headers[t]}async getData(){return await this.dataPromise}}class eq extends AE{constructor(t){super(t),this.parsedUrl=NT.parse(this.url),this.httpApi=(this.parsedUrl.protocol,NT)}constructRequest(t,e){return new Promise((i,r)=>{const n=this.httpApi.get({...this.parsedUrl,headers:t},o=>{const a=new Promise(l=>{const h=[];o.on("data",c=>{h.push(c)}),o.on("end",()=>{const c=Buffer.concat(h).buffer;l(c)}),o.on("error",r)});i(new tq(o,a))});n.on("error",r),e&&(e.aborted&&n.destroy(new R0("Request aborted")),e.addEventListener("abort",()=>n.destroy(new R0("Request aborted"))))})}async request({headers:t,signal:e}={}){return await this.constructRequest(t,e)}}let LE=class extends ME{constructor(t,e,i,r){super(),this.client=t,this.headers=e,this.maxRanges=i,this.allowFullFile=r,this._fileSize=null}async fetch(t,e){return this.maxRanges>=t.length?this.fetchSlices(t,e):(this.maxRanges>0&&t.length>1,Promise.all(t.map(i=>this.fetchSlice(i,e))))}async fetchSlices(t,e){const i=await this.client.request({headers:{...this.headers,Range:`bytes=${t.map(({offset:r,length:n})=>`${r}-${r+n}`).join(",")}`},signal:e});if(i.ok)if(i.status===206){const{type:r,params:n}=zX(i.getHeader("content-type"));if(r==="multipart/byteranges"){const u=BX(await i.getData(),n.boundary);return this._fileSize=u[0].fileSize||null,u}const o=await i.getData(),{start:a,end:l,total:h}=Bv(i.getHeader("content-range"));this._fileSize=h||null;const c=[{data:o,offset:a,length:l-a}];if(t.length>1){const u=await Promise.all(t.slice(1).map(d=>this.fetchSlice(d,e)));return c.concat(u)}return c}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const r=await i.getData();return this._fileSize=r.byteLength,[{data:r,offset:0,length:r.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(t,e){const{offset:i,length:r}=t,n=await this.client.request({headers:{...this.headers,Range:`bytes=${i}-${i+r}`},signal:e});if(n.ok)if(n.status===206){const o=await n.getData(),{total:a}=Bv(n.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:i,length:r}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await n.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}};function PE(s,{blockSize:t,cacheSize:e}){return t===null?s:new YX(s,{blockSize:t,cacheSize:e})}function iq(s,{headers:t={},credentials:e,maxRanges:i=0,allowFullFile:r=!1,...n}={}){const o=new KX(s,e),a=new LE(o,t,i,r);return PE(a,n)}function sq(s,{headers:t={},maxRanges:e=0,allowFullFile:i=!1,...r}={}){const n=new QX(s),o=new LE(n,t,e,i);return PE(o,r)}function rq(s,{headers:t={},maxRanges:e=0,allowFullFile:i=!1,...r}={}){const n=new eq(s),o=new LE(n,t,e,i);return PE(o,r)}function Uv(s,{forceXHR:t=!1,...e}={}){return typeof fetch=="function"&&!t?iq(s,e):typeof XMLHttpRequest<"u"?sq(s,e):rq(s,e)}class nq extends ME{constructor(t){super(),this.file=t}async fetchSlice(t,e){return new Promise((i,r)=>{const n=this.file.slice(t.offset,t.offset+t.length),o=new FileReader;o.onload=a=>i(a.target.result),o.onerror=r,o.onabort=r,o.readAsArrayBuffer(n),e&&e.addEventListener("abort",()=>o.abort())})}}function oq(s){return new nq(s)}function Vv(s){switch(s){case ne.BYTE:case ne.ASCII:case ne.SBYTE:case ne.UNDEFINED:return 1;case ne.SHORT:case ne.SSHORT:return 2;case ne.LONG:case ne.SLONG:case ne.FLOAT:case ne.IFD:return 4;case ne.RATIONAL:case ne.SRATIONAL:case ne.DOUBLE:case ne.LONG8:case ne.SLONG8:case ne.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${s}`)}}function aq(s){const t=s.GeoKeyDirectory;if(!t)return null;const e={};for(let i=4;i<=t[3]*4;i+=4){const r=fX[t[i]],n=t[i+1]?yp[t[i+1]]:null,o=t[i+2],a=t[i+3];let l=null;if(!n)l=a;else{if(l=s[n],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${r}'.`);typeof l=="string"?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),o===1&&(l=l[0]))}e[r]=l}return e}function uc(s,t,e,i){let r=null,n=null;const o=Vv(t);switch(t){case ne.BYTE:case ne.ASCII:case ne.UNDEFINED:r=new Uint8Array(e),n=s.readUint8;break;case ne.SBYTE:r=new Int8Array(e),n=s.readInt8;break;case ne.SHORT:r=new Uint16Array(e),n=s.readUint16;break;case ne.SSHORT:r=new Int16Array(e),n=s.readInt16;break;case ne.LONG:case ne.IFD:r=new Uint32Array(e),n=s.readUint32;break;case ne.SLONG:r=new Int32Array(e),n=s.readInt32;break;case ne.LONG8:case ne.IFD8:r=new Array(e),n=s.readUint64;break;case ne.SLONG8:r=new Array(e),n=s.readInt64;break;case ne.RATIONAL:r=new Uint32Array(e*2),n=s.readUint32;break;case ne.SRATIONAL:r=new Int32Array(e*2),n=s.readInt32;break;case ne.FLOAT:r=new Float32Array(e),n=s.readFloat32;break;case ne.DOUBLE:r=new Float64Array(e),n=s.readFloat64;break;default:throw new RangeError(`Invalid field type: ${t}`)}if(t===ne.RATIONAL||t===ne.SRATIONAL)for(let a=0;a<e;a+=2)r[a]=n.call(s,i+a*o),r[a+1]=n.call(s,i+(a*o+4));else for(let a=0;a<e;++a)r[a]=n.call(s,i+a*o);return t===ne.ASCII?new TextDecoder("utf-8").decode(r):r}class lq{constructor(t,e,i){this.fileDirectory=t,this.geoKeyDirectory=e,this.nextIFDByteOffset=i}}let nm=class extends Error{constructor(t){super(`No image at index ${t}`),this.index=t}},YO=class{async readRasters(t={}){const{window:e,width:i,height:r}=t;let{resX:n,resY:o,bbox:a}=t;const l=await this.getImage();let h=l;const c=await this.getImageCount(),u=l.getBoundingBox();if(e&&a)throw new Error('Both "bbox" and "window" passed.');if(i||r){if(e){const[g,f]=l.getOrigin(),[m,_]=l.getResolution();a=[g+e[0]*m,f+e[1]*_,g+e[2]*m,f+e[3]*_]}const p=a||u;if(i){if(n)throw new Error("Both width and resX passed");n=(p[2]-p[0])/i}if(r){if(o)throw new Error("Both width and resY passed");o=(p[3]-p[1])/r}}if(n||o){const p=[];for(let g=0;g<c;++g){const f=await this.getImage(g),{SubfileType:m,NewSubfileType:_}=f.fileDirectory;(g===0||m===2||_&1)&&p.push(f)}p.sort((g,f)=>g.getWidth()-f.getWidth());for(let g=0;g<p.length;++g){const f=p[g],m=(u[2]-u[0])/f.getWidth(),_=(u[3]-u[1])/f.getHeight();if(h=f,n&&n>m||o&&o>_)break}}let d=e;if(a){const[p,g]=l.getOrigin(),[f,m]=h.getResolution(l);d=[Math.round((a[0]-p)/f),Math.round((a[1]-g)/m),Math.round((a[2]-p)/f),Math.round((a[3]-g)/m)],d=[Math.min(d[0],d[2]),Math.min(d[1],d[3]),Math.max(d[0],d[2]),Math.max(d[1],d[3])]}return h.readRasters({...t,window:d})}},M0=class ZO extends YO{constructor(t,e,i,r,n={}){super(),this.source=t,this.littleEndian=e,this.bigTiff=i,this.firstIFDOffset=r,this.cache=n.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(t,e){const i=this.bigTiff?4048:1024;return new NX((await this.source.fetch([{offset:t,length:typeof e<"u"?e:i}]))[0],t,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(t){const e=this.bigTiff?20:12,i=this.bigTiff?8:2;let r=await this.getSlice(t);const n=this.bigTiff?r.readUint64(t):r.readUint16(t),o=n*e+(this.bigTiff?16:6);r.covers(t,o)||(r=await this.getSlice(t,o));const a={};let l=t+(this.bigTiff?8:2);for(let u=0;u<n;l+=e,++u){const d=r.readUint16(l),p=r.readUint16(l+2),g=this.bigTiff?r.readUint64(l+4):r.readUint32(l+4);let f,m;const _=Vv(p),y=l+(this.bigTiff?12:8);if(_*g<=(this.bigTiff?8:4))f=uc(r,p,g,y);else{const v=r.readOffset(y),b=Vv(p)*g;if(r.covers(v,b))f=uc(r,p,g,v);else{const E=await this.getSlice(v,b);f=uc(E,p,g,v)}}g===1&&pX.indexOf(d)===-1&&!(p===ne.RATIONAL||p===ne.SRATIONAL)?m=f[0]:m=f,a[yp[d]]=m}const h=aq(a),c=r.readOffset(t+i+e*n);return new lq(a,h,c)}async requestIFD(t){if(this.ifdRequests[t])return this.ifdRequests[t];if(t===0)return this.ifdRequests[t]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[t];if(!this.ifdRequests[t-1])try{this.ifdRequests[t-1]=this.requestIFD(t-1)}catch(e){throw e instanceof nm?new nm(t):e}return this.ifdRequests[t]=(async()=>{const e=await this.ifdRequests[t-1];if(e.nextIFDByteOffset===0)throw new nm(t);return this.parseFileDirectoryAt(e.nextIFDByteOffset)})(),this.ifdRequests[t]}async getImage(t=0){const e=await this.requestIFD(t);return new WO(e.fileDirectory,e.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let t=0,e=!0;for(;e;)try{await this.requestIFD(t),++t}catch(i){if(i instanceof nm)e=!1;else throw i}return t}async getGhostValues(){const t=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const e="GDAL_STRUCTURAL_METADATA_SIZE=",i=e.length+100;let r=await this.getSlice(t,i);if(e===uc(r,ne.ASCII,e.length,t)){const n=uc(r,ne.ASCII,i,t).split(`
`)[0],o=Number(n.split("=")[1].split(" ")[0])+n.length;o>i&&(r=await this.getSlice(t,o));const a=uc(r,ne.ASCII,o,t);this.ghostValues={},a.split(`
`).filter(l=>l.length>0).map(l=>l.split("=")).forEach(([l,h])=>{this.ghostValues[l]=h})}return this.ghostValues}static async fromSource(t,e,i){const r=(await t.fetch([{offset:0,length:1024}],i))[0],n=new kX(r),o=n.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const l=n.getUint16(2,a);let h;if(l===42)h=!1;else if(l===43){if(h=!0,n.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const c=h?n.getUint64(8,a):n.getUint32(4,a);return new ZO(t,a,h,c,e)}close(){return typeof this.source.close=="function"?this.source.close():!1}};class hq extends YO{constructor(t,e){super(),this.mainFile=t,this.overviewFiles=e,this.imageFiles=[t].concat(e),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const t=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(e=>e.parseFileDirectoryAt(e.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(t),this.fileDirectoriesPerFile}async getImage(t=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let e=0,i=0;for(let r=0;r<this.imageFiles.length;r++){const n=this.imageFiles[r];for(let o=0;o<this.imageCounts[r];o++){if(t===e){const a=await n.requestIFD(i);return new WO(a.fileDirectory,a.geoKeyDirectory,n.dataView,n.littleEndian,n.cache,n.source)}e++,i++}i=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const t=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(e=>e.getImageCount()));return this.imageCounts=await Promise.all(t),this.imageCount=this.imageCounts.reduce((e,i)=>e+i,0),this.imageCount}}async function cq(s,t={},e){return M0.fromSource(Uv(s,t),e)}async function uq(s,t){return M0.fromSource(oq(s),t)}async function dq(s,t=[],e={},i){const r=await M0.fromSource(Uv(s,e),i),n=await Promise.all(t.map(o=>M0.fromSource(Uv(o,e))));return new hq(r,n)}function pq(s){return((s.fileDirectory.NewSubfileType||0)&4)===4}function gq(s,t){if(!s)return!1;if(s===!0)return!0;if(t.getSamplesPerPixel()!==3)return!1;const e=t.fileDirectory.PhotometricInterpretation,i=fr;return e===i.CMYK||e===i.YCbCr||e===i.CIELab||e===i.ICCLab}const DT="STATISTICS_MAXIMUM",$T="STATISTICS_MINIMUM",J1=256;let Q1;function fq(){return Q1||(Q1=new jX),Q1}function mq(s){try{return s.getBoundingBox()}catch{return[0,0,s.getWidth(),s.getHeight()]}}function _q(s){try{return s.getOrigin().slice(0,2)}catch{return[0,s.getHeight()]}}function yq(s,t){try{return s.getResolution(t)}catch{return[t.getWidth()/s.getWidth(),t.getHeight()/s.getHeight()]}}function xq(s){const t=s.geoKeys;if(!t)return null;if(t.ProjectedCSTypeGeoKey&&t.ProjectedCSTypeGeoKey!==32767){const e="EPSG:"+t.ProjectedCSTypeGeoKey;let i=ct(e);if(!i){const r=X2(t.ProjLinearUnitsGeoKey);r&&(i=new Ru({code:e,units:r}))}return i}if(t.GeographicTypeGeoKey&&t.GeographicTypeGeoKey!==32767){const e="EPSG:"+t.GeographicTypeGeoKey;let i=ct(e);if(!i){const r=X2(t.GeogAngularUnitsGeoKey);r&&(i=new Ru({code:e,units:r}))}return i}return null}function vq(s){return s.getImageCount().then(function(t){const e=new Array(t);for(let i=0;i<t;++i)e[i]=s.getImage(i);return Promise.all(e)})}function bq(s,t){let e;return s.blob?e=uq(s.blob):s.overviews?e=dq(s.url,s.overviews,t):e=cq(s.url,t),e.then(vq)}function Jd(s,t,e,i,r){if(Array.isArray(s)){const n=s.length;if(!Array.isArray(t)||n!=t.length){const o=new Error(i);throw r(o),o}for(let o=0;o<n;++o)Jd(s[o],t[o],e,i,r);return}if(t=t,Math.abs(s-t)>e*s)throw new Error(i)}function wq(s){return s instanceof Int8Array?-128:s instanceof Int16Array?-32768:s instanceof Int32Array?-2147483648:s instanceof Float32Array?12e-39:0}function Eq(s){return s instanceof Int8Array?127:s instanceof Uint8Array||s instanceof Uint8ClampedArray?255:s instanceof Int16Array?32767:s instanceof Uint16Array?65535:s instanceof Int32Array?2147483647:s instanceof Uint32Array?4294967295:s instanceof Float32Array?34e37:255}let KO=class extends mE{constructor(t){super({state:"loading",tileGrid:null,projection:t.projection||null,opaque:t.opaque,transition:t.transition,interpolate:t.interpolate!==!1,wrapX:t.wrapX}),this.sourceInfo_=t.sources;const e=this.sourceInfo_.length;this.sourceOptions_=t.sourceOptions,this.sourceImagery_=new Array(e),this.sourceMasks_=new Array(e),this.resolutionFactors_=new Array(e),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=t.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=t.convertToRGB||!1,this.setKey(this.sourceInfo_.map(n=>n.url).join(","));const i=this,r=new Array(e);for(let n=0;n<e;++n)r[n]=bq(this.sourceInfo_[n],this.sourceOptions_);Promise.all(r).then(function(n){i.configure_(n)}).catch(function(n){e0(n),i.error_=n,i.setState("error")})}getError(){return this.error_}determineProjection(t){const e=t[0];for(let i=e.length-1;i>=0;--i){const r=e[i],n=xq(r);if(n){this.projection=n;break}}}configure_(t){let e,i,r,n,o;const a=new Array(t.length),l=new Array(t.length),h=new Array(t.length);let c=0;const u=t.length;for(let f=0;f<u;++f){const m=[],_=[];t[f].forEach(R=>{pq(R)?_.push(R):m.push(R)});const y=m.length;if(_.length>0&&_.length!==y)throw new Error(`Expected one mask per image found ${_.length} masks and ${y} images`);let v,b;const E=new Array(y),S=new Array(y),T=new Array(y);l[f]=new Array(y),h[f]=new Array(y);for(let R=0;R<y;++R){const M=m[R],A=M.getGDALNoData();h[f][R]=M.getGDALMetadata(0),l[f][R]=A;const O=this.sourceInfo_[f].bands;a[f]=O?O.length:M.getSamplesPerPixel();const N=y-(R+1);v||(v=mq(M)),b||(b=_q(M));const x=yq(M,m[0]);T[N]=x[0];const w=[M.getTileWidth(),M.getTileHeight()];w[0]!==w[1]&&w[1]<J1&&(w[0]=J1,w[1]=J1),E[N]=w;const C=x[0]/Math.abs(x[1]);S[N]=[w[0],w[1]/C]}if(e?us(e,v,e):e=v,!i)i=b;else{const R=`Origin mismatch for source ${f}, got [${b}] but expected [${i}]`;Jd(i,b,0,R,this.viewRejector)}if(!o)o=T,this.resolutionFactors_[f]=1;else{o.length-c>T.length&&(c=o.length-T.length);const R=o[o.length-1]/T[T.length-1];this.resolutionFactors_[f]=R;const M=T.map(O=>O*=R),A=`Resolution mismatch for source ${f}, got [${M}] but expected [${o}]`;Jd(o.slice(c,o.length),M,.02,A,this.viewRejector)}r?Jd(r.slice(c,r.length),S,.01,`Tile size mismatch for source ${f}`,this.viewRejector):r=S,n?Jd(n.slice(c,n.length),E,0,`Tile size mismatch for source ${f}`,this.viewRejector):n=E,this.sourceImagery_[f]=m.reverse(),this.sourceMasks_[f]=_.reverse()}for(let f=0,m=this.sourceImagery_.length;f<m;++f){const _=this.sourceImagery_[f];for(;_.length<o.length;)_.unshift(void 0)}this.getProjection()||this.determineProjection(t),this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=h;t:for(let f=0;f<u;++f){if(this.sourceInfo_[f].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[f].length){this.addAlpha_=!0;break}const m=l[f],_=this.sourceInfo_[f].bands;if(_){for(let y=0;y<_.length;++y)if(m[_[y]-1]!==null){this.addAlpha_=!0;break t}continue}for(let y=0;y<m.length;++y)if(m[y]!==null){this.addAlpha_=!0;break t}}let d=this.addAlpha_?1:0;for(let f=0;f<u;++f)d+=a[f];this.bandCount=d;const p=new Dl({extent:e,minZoom:c,origin:i,resolutions:o,tileSizes:r});this.tileGrid=p,this.setTileSizes(n),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const g=1;o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[o[0]*2,o[0],o[0]/2]),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:nv(vs(e),this.projection),extent:W_(e,this.projection),zoom:g})}loadTile_(t,e,i){const r=this.getTileSize(t),n=this.sourceImagery_.length,o=new Array(n*2),a=this.nodataValues_,l=this.sourceInfo_,h=fq();for(let c=0;c<n;++c){const u=l[c],d=this.resolutionFactors_[c],p=[Math.round(e*(r[0]*d)),Math.round(i*(r[1]*d)),Math.round((e+1)*(r[0]*d)),Math.round((i+1)*(r[1]*d))],g=this.sourceImagery_[c][t];let f;u.bands&&(f=u.bands.map(function(b){return b-1}));let m;"nodata"in u&&u.nodata!==null?m=u.nodata:f?m=f.map(function(b){return a[c][b]}):m=a[c];const _={window:p,width:r[0],height:r[1],samples:f,fillValue:m,pool:h,interleave:!1};gq(this.convertToRGB_,g)?o[c]=g.readRGB(_):o[c]=g.readRasters(_);const y=n+c,v=this.sourceMasks_[c][t];if(!v){o[y]=Promise.resolve(null);continue}o[y]=v.readRasters({window:p,width:r[0],height:r[1],samples:[0],pool:h,interleave:!1})}return Promise.all(o).then(this.composeTile_.bind(this,r)).catch(function(c){throw e0(c),c})}composeTile_(t,e){const i=this.metadata_,r=this.sourceInfo_,n=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,h=this.normalize_,c=this.addAlpha_,u=t[0]*t[1],d=u*o;let p;h?p=new Uint8Array(d):p=new Float32Array(d);let g=0;for(let f=0;f<u;++f){let m=c;for(let _=0;_<n;++_){const y=r[_];let v=y.min,b=y.max,E,S;if(h){const T=i[_][0];v===void 0&&(T&&$T in T?v=parseFloat(T[$T]):v=wq(e[_][0])),b===void 0&&(T&&DT in T?b=parseFloat(T[DT]):b=Eq(e[_][0])),E=255/(b-v),S=-v*E}for(let T=0;T<a[_];++T){const R=e[_][T][f];let M;if(h?M=Jt(E*R+S,0,255):M=R,!c)p[g]=M;else{let A=y.nodata;if(A===void 0){let N;y.bands?N=y.bands[T]-1:N=T,A=l[_][N]}const O=isNaN(A);(!O&&R!==A||O&&!isNaN(R))&&(m=!1,p[g]=M)}g++}if(!m){const T=n+_,R=e[T];R&&!R[0][f]&&(m=!0)}}c&&(m||(p[g]=255),g++)}return p}};KO.prototype.getView;const JO=KO;class Sq extends JO{constructor(t){super(t),t.projection&&(this.projection=t.projection)}}class _i{constructor(t){this.name=t}toString(){return this.name}}_i.GeoTIFF=new _i("GeoTIFF");_i.ImageStatic=new _i("ImageStatic");_i.PMTilesRaster=new _i("PMTilesRaster");_i.PMTilesVector=new _i("PMTilesVector");_i.TileJSON=new _i("TileJSON");_i.TileWMS=new _i("TileWMS");_i.WMTS=new _i("WMTS");_i.XYZ=new _i("XYZ");class Cq extends Q_{constructor(t,e,i,r,n,o,a){let l=t.getExtent();l&&t.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let h=e.getExtent();h&&e.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const c=h?us(i,h):i,u=vs(c),d=ig(t,e,u,r),p=Kw,g=new Qw(t,e,c,l,d*p,r),f=g.calculateSourceExtent(),m=ba(f)?null:o(f,d,n),_=m?dt.IDLE:dt.EMPTY,y=m?m.getPixelRatio():1;super(i,r,y,_),this.targetProj_=e,this.maxSourceExtent_=l,this.triangulation_=g,this.targetResolution_=r,this.targetExtent_=i,this.sourceImage_=m,this.sourcePixelRatio_=y,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==dt.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const t=this.sourceImage_.getState();if(t==dt.LOADED){const e=Kt(this.targetExtent_)/this.targetResolution_,i=ci(this.targetExtent_)/this.targetResolution_;this.canvas_=tE(e,i,this.sourcePixelRatio_,S0(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=t,this.changed()}load(){if(this.state==dt.IDLE){this.state=dt.LOADING,this.changed();const t=this.sourceImage_.getState();t==dt.LOADED||t==dt.ERROR?this.reproject_():(this.sourceListenerKey_=Ai(this.sourceImage_,fe.CHANGE,function(e){const i=this.sourceImage_.getState();(i==dt.LOADED||i==dt.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){cs(this.sourceListenerKey_),this.sourceListenerKey_=null}}const Tq=Cq,so=4,tx={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class Rq extends Eo{constructor(t,e){super(t),this.image=e}}class Mq extends ud{constructor(t){super({attributions:t.attributions,projection:t.projection,state:t.state,interpolate:t.interpolate!==void 0?t.interpolate:!0}),this.on,this.once,this.un,this.loader=t.loader||null,this.resolutions_=t.resolutions!==void 0?t.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=t.loader?t.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(t){this.resolutions_=t}findNearestResolution(t){const e=this.getResolutions();if(e){const i=G_(e,t,0);t=e[i]}return t}getImage(t,e,i,r){const n=this.getProjection();if(!n||!r||Rs(n,r))return n&&(r=n),this.getImageInternal(t,e,i,r);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Rs(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==e&&ca(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Tq(n,r,t,e,i,(o,a,l)=>this.getImageInternal(o,a,l,n),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(t,e,i,r){if(this.loader){const n=_y(t,e,i,1),o=this.findNearestResolution(e);if(this.image&&(this.static_||this.wantedProjection_===r&&(this.wantedExtent_&&rr(this.wantedExtent_,n)||rr(this.image.getExtent(),n))&&(this.wantedResolution_&&S0(this.wantedResolution_)===o||S0(this.image.getResolution())===o)))return this.image;this.wantedProjection_=r,this.wantedExtent_=n,this.wantedResolution_=o,this.image=new Q_(n,o,i,this.loader),this.image.addEventListener(fe.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(t){const e=t.target;let i;switch(e.getState()){case dt.LOADING:this.loading=!0,i=tx.IMAGELOADSTART;break;case dt.LOADED:this.loading=!1,i=tx.IMAGELOADEND;break;case dt.ERROR:this.loading=!1,i=tx.IMAGELOADERROR;break;default:return}this.hasListener(i)&&this.dispatchEvent(new Rq(i,e))}}function my(s,t){s.getImage().src=t}function _y(s,t,e,i){const r=t/e,n=vs(s),o=nl(Kt(s)/r,so),a=nl(ci(s)/r,so),l=nl((i-1)*o/2,so),h=o+2*l,c=nl((i-1)*a/2,so),u=a+2*c;return Kb(n,r,0,[h,u])}const jl=Mq;function QO(s){const t=s.load||Nl,e=s.imageExtent,i=new Image;return s.crossOrigin!==null&&(i.crossOrigin=s.crossOrigin),()=>t(i,s.url).then(r=>{const n=Kt(e)/r.width,o=ci(e)/r.height;return{image:r,extent:e,resolution:n!==o?[n,o]:o,pixelRatio:1}})}class Iq extends jl{constructor(t){const e=t.crossOrigin!==void 0?t.crossOrigin:null,i=t.imageLoadFunction!==void 0?t.imageLoadFunction:my;super({attributions:t.attributions,interpolate:t.interpolate,projection:ct(t.projection)}),this.url_=t.url,this.imageExtent_=t.imageExtent,this.image=null,this.image=new Q_(this.imageExtent_,void 0,1,QO({url:t.url,imageExtent:t.imageExtent,crossOrigin:e,load:(r,n)=>(this.image.setImage(r),i(this.image,n),Nl(r))})),this.image.addEventListener(fe.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(t,e,i,r){return li(t,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}const tF=Iq;function Aq(s,t){const e=/\{z\}/g,i=/\{x\}/g,r=/\{y\}/g,n=/\{-y\}/g;return function(o,a,l){if(o)return s.replace(e,o[0].toString()).replace(i,o[1].toString()).replace(r,o[2].toString()).replace(n,function(){const h=o[0],c=t.getFullTileRange(h);if(!c)throw new Error("The {-y} placeholder requires a tile grid with extent");return(c.getHeight()-o[2]-1).toString()})}}function OE(s,t){const e=s.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=Aq(s[r],t);return ng(i)}function ng(s){return s.length===1?s[0]:function(t,e,i){if(!t)return;const r=rE(t),n=Ko(r,s.length);return s[n](t,e,i)}}function Lq(s,t,e){}function FE(s){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(s);if(e){const i=e[1].charCodeAt(0),r=e[2].charCodeAt(0);let n;for(n=i;n<=r;++n)t.push(s.replace(e[0],String.fromCharCode(n)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(s),e){const i=parseInt(e[2],10);for(let r=parseInt(e[1],10);r<=i;r++)t.push(s.replace(e[0],r.toString()));return t}return t.push(s),t}let Pq=class eF extends sf{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===eF.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=xt(e),r=e.getState();let n;r==X.LOADING?(this.tileLoadingKeys_[i]=!0,n=lu.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],n=r==X.ERROR?lu.TILELOADERROR:r==X.LOADED?lu.TILELOADEND:void 0),n!=null&&this.dispatchEvent(new CO(n,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=FE(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(OE(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}useTile(t,e,i){const r=_o(t,e,i);this.tileCache.containsKey(r)&&this.tileCache.get(r)}};const kE=Pq;class Oq extends kE{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Fq,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:tf,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(const r in this.tileCacheForProjection){const n=this.tileCacheForProjection[r];n.expireCache(n==i?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!Rs(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return this.getProjection()&&t&&!Rs(this.getProjection(),t)?!1:super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||Rs(e,t)))return this.tileGrid;const i=xt(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=fE(t)),this.tileGridForProjection[i]}getTileCacheForProjection(t){const e=this.getProjection();if(!e||Rs(e,t))return this.tileCache;const i=xt(t);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new gy(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(t,e,i,r,n,o){const a=[t,e,i],l=this.getTileCoordForTileUrlFunction(a,n),h=l?this.tileUrlFunction(l,r,n):void 0,c=new this.tileClass(a,h!==void 0?X.IDLE:X.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(fe.CHANGE,this.handleTileChange.bind(this)),c}getTile(t,e,i,r,n){const o=this.getProjection();if(!o||!n||Rs(o,n))return this.getTileInternal(t,e,i,r,o||n);const a=this.getTileCacheForProjection(n),l=[t,e,i];let h;const c=tl(l);a.containsKey(c)&&(h=a.get(c));const u=this.getKey();if(h&&h.key==u)return h;const d=this.getTileGridForProjection(o),p=this.getTileGridForProjection(n),g=this.getTileCoordForTileUrlFunction(l,n),f=new Ou(o,d,n,p,l,g,this.getTilePixelRatio(r),this.getGutter(),(m,_,y,v)=>this.getTileInternal(m,_,y,v,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return f.key=u,h?(f.interimTile=h,f.refreshInterimChain(),a.replace(c,f)):a.set(c,f),f}getTileInternal(t,e,i,r,n){let o=null;const a=_o(t,e,i),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(t,e,i,r,n,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(t,e,i,r,n,l),h.getState()==X.IDLE?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){const i=ct(t);if(i){const r=xt(i);r in this.tileGridForProjection||(this.tileGridForProjection[r]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}}function Fq(s,t){s.getImage().src=t}const Un=Oq;function NE(s,t,e,i){const r=document.createElement("script"),n="olc_"+xt(t);function o(){delete window[n],r.parentNode.removeChild(r)}r.async=!0,r.src=s+(s.includes("?")?"&":"?")+(i||"callback")+"="+n;const a=setTimeout(function(){o(),e&&e()},1e4);window[n]=function(l){clearTimeout(a),o(),t(l)},document.head.appendChild(r)}class kq extends Error{constructor(t){const e="Unexpected response status: "+t.status;super(e),this.name="ResponseError",this.response=t}}class Nq extends Error{constructor(t){super("Failed to issue request"),this.name="ClientError",this.client=t}}function iF(s){return new Promise(function(t,e){function i(o){const a=o.target;if(!a.status||a.status>=200&&a.status<300){let l;try{l=JSON.parse(a.responseText)}catch(h){const c="Error parsing response text as JSON: "+h.message;e(new Error(c));return}t(l);return}e(new kq(a))}function r(o){e(new Nq(o.target))}const n=new XMLHttpRequest;n.addEventListener("load",i),n.addEventListener("error",r),n.open("GET",s),n.setRequestHeader("Accept","application/json"),n.send()})}function sF(s,t){return t.includes("://")?t:new URL(t,s).href}class Dq extends Un{constructor(t){if(super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:ct("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.tileJSON_=null,this.tileSize_=t.tileSize,t.url)if(t.jsonp)NE(t.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",t.url),e.send()}else if(t.tileJSON)this.handleTileJSONResponse(t.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(t){const e=t.target;if(!e.status||e.status>=200&&e.status<300){let i;try{i=JSON.parse(e.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(i)}else this.handleTileJSONError()}onXHRError_(t){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(t){const e=ct("EPSG:4326"),i=this.getProjection();let r;if(t.bounds!==void 0){const h=zh(e,i);r=Tu(t.bounds,h)}const n=Ta(i),o=t.minzoom||0,a=t.maxzoom||22,l=Vh({extent:n,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=OE(t.tiles,l),t.attribution&&!this.getAttributions()){const h=r!==void 0?r:n;this.setAttributions(function(c){return li(h,c.extent)?[t.attribution]:null})}this.tileJSON_=t,this.setState("ready")}handleTileJSONError(){this.setState("error")}}const rF=Dq;let $q=class extends dd{constructor(s,t,e,i,r,n){super(s,t,n),this.extent=null,this.format_=i,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=r,this.url_=e,this.key=e}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==X.IDLE&&(this.setState(X.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(s,t){this.setFeatures(s)}onError(){this.setState(X.ERROR)}setFeatures(s){this.features_=s,this.setState(X.LOADED)}setLoader(s){this.loader_=s}};const jq=$q,jT=[];class Gq extends dd{constructor(t,e,i,r){super(t,e,{transition:0}),this.context_={},this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=r.bind(void 0,this),this.wrappedTileCoord=i}getContext(t){const e=xt(t);return e in this.context_||(this.context_[e]=ui(1,1,jT)),this.context_[e]}hasContext(t){return xt(t)in this.context_}getImage(t){return this.hasContext(t)?this.getContext(t).canvas:null}getReplayState(t){const e=xt(t);return e in this.replayState_||(this.replayState_[e]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[e]}load(){this.getSourceTiles()}release(){for(const t in this.context_){const e=this.context_[t];Rh(e),jT.push(e.canvas),delete this.context_[t]}super.release()}}const zq=Gq;class Bq extends kE{constructor(t){const e=t.projection||"EPSG:3857",i=t.extent||Ta(e),r=t.tileGrid||Vh({extent:i,maxResolution:t.maxResolution,maxZoom:t.maxZoom!==void 0?t.maxZoom:22,minZoom:t.minZoom,tileSize:t.tileSize||512});super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,interpolate:!0,opaque:!1,projection:e,state:t.state,tileGrid:r,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Uq,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX===void 0?!0:t.wrapX,transition:t.transition,zDirection:t.zDirection===void 0?1:t.zDirection}),this.format_=t.format?t.format:null,this.sourceTileCache=new gy(this.tileCache.highWaterMark),this.overlaps_=t.overlaps==null?!0:t.overlaps,this.tileClass=t.tileClass?t.tileClass:jq,this.tileGrids_={}}getFeaturesInExtent(t){const e=[],i=this.tileCache;if(i.getCount()===0)return e;const r=eO(i.peekFirstKey())[0],n=this.tileGrid;return i.forEach(function(o){if(o.tileCoord[0]!==r||o.getState()!==X.LOADED)return;const a=o.getSourceTiles();for(let l=0,h=a.length;l<h;++l){const c=a[l],u=c.tileCoord;if(li(t,n.getTileCoordExtent(u))){const d=c.getFeatures();if(d)for(let p=0,g=d.length;p<g;++p){const f=d[p],m=f.getGeometry();li(t,m.getExtent())&&e.push(f)}}}}),e}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(t,e){const i=this.getTileCacheForProjection(t),r=Object.keys(e).reduce((n,o)=>{const a=qH(o),l=i.peek(a);if(l){const h=l.sourceTiles;for(let c=0,u=h.length;c<u;++c)n[h[c].getKey()]=!0}return n},{});super.expireCache(t,e),this.sourceTileCache.expireCache(r)}getSourceTiles(t,e,i){if(i.getState()===X.IDLE){i.setState(X.LOADING);const r=i.wrappedTileCoord,n=this.getTileGridForProjection(e),o=n.getTileCoordExtent(r),a=r[0],l=n.getResolution(a);ln(o,-l,o);const h=this.tileGrid,c=h.getExtent();c&&us(o,c,o);const u=h.getZForResolution(l,this.zDirection);h.forEachTileCoord(o,u,d=>{const p=this.tileUrlFunction(d,t,e),g=this.sourceTileCache.containsKey(p)?this.sourceTileCache.get(p):new this.tileClass(d,p?X.IDLE:X.EMPTY,p,this.format_,this.tileLoadFunction);i.sourceTiles.push(g);const f=g.getState();if(f<X.LOADED){const m=_=>{this.handleTileChange(_);const y=g.getState();if(y===X.LOADED||y===X.ERROR){const v=g.getKey();v in i.errorTileKeys?g.getState()===X.LOADED&&delete i.errorTileKeys[v]:i.loadingSourceTiles--,y===X.ERROR?i.errorTileKeys[v]=!0:g.removeEventListener(fe.CHANGE,m),i.loadingSourceTiles===0&&i.setState(ha(i.errorTileKeys)?X.LOADED:X.ERROR)}};g.addEventListener(fe.CHANGE,m),i.loadingSourceTiles++}f===X.IDLE&&(g.extent=h.getTileCoordExtent(d),g.projection=e,g.resolution=h.getResolution(d[0]),this.sourceTileCache.set(p,g),g.load())}),i.loadingSourceTiles||i.setState(i.sourceTiles.some(d=>d.getState()===X.ERROR)?X.ERROR:X.LOADED)}return i.sourceTiles}getTile(t,e,i,r,n){const o=_o(t,e,i),a=this.getKey();let l;if(this.tileCache.containsKey(o)&&(l=this.tileCache.get(o),l.key===a))return l;const h=[t,e,i];let c=this.getTileCoordForTileUrlFunction(h,n);const u=this.getTileGrid().getExtent(),d=this.getTileGridForProjection(n);if(c&&u){const f=d.getTileCoordExtent(c);ln(f,-d.getResolution(t),f),li(u,f)||(c=null)}let p=!0;if(c!==null){const f=this.tileGrid,m=d.getResolution(t),_=f.getZForResolution(m,1),y=d.getTileCoordExtent(c);ln(y,-m,y),f.forEachTileCoord(y,_,v=>{p=p&&!this.tileUrlFunction(v,r,n)})}const g=new zq(h,p?X.EMPTY:X.IDLE,c,this.getSourceTiles.bind(this,r,n));return g.key=a,l?(g.interimTile=l,g.refreshInterimChain(),this.tileCache.replace(o,g)):this.tileCache.set(o,g),g}getTileGridForProjection(t){const e=t.getCode();let i=this.tileGrids_[e];if(!i){const r=this.tileGrid,n=r.getResolutions().slice(),o=n.map(function(h,c){return r.getOrigin(c)}),a=n.map(function(h,c){return r.getTileSize(c)}),l=_P+1;for(let h=n.length;h<l;++h)n.push(n[h-1]/2),o.push(o[h-1]),a.push(a[h-1]);i=new Dl({extent:r.getExtent(),origins:o,resolutions:n,tileSizes:a}),this.tileGrids_[e]=i}return i}getTilePixelRatio(t){return t}getTilePixelSize(t,e,i){const r=this.getTileGridForProjection(i),n=xi(r.getTileSize(t),this.tmpSize);return[Math.round(n[0]*e),Math.round(n[1]*e)]}updateCacheSize(t,e){super.updateCacheSize(t*2,e),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(e).highWaterMark}}const yy=Bq;function Uq(s,t){s.setLoader(function(e,i,r){$P(t,s.getFormat(),e,i,r,s.onLoad.bind(s),s.onError.bind(s))})}function Ih(s,t){const e=[];Object.keys(t).forEach(function(r){t[r]!==null&&t[r]!==void 0&&e.push(r+"="+encodeURIComponent(t[r]))});const i=e.join("&");return s=s.replace(/[?&]$/,""),s+=s.includes("?")?"&":"?",s+i}const I0="1.3.0",GT=[101,101];function nF(s,t,e,i,r){r.WIDTH=e[0],r.HEIGHT=e[1];const n=i.getAxisOrientation();let o;const a=Qb(r.VERSION,"1.3")>=0;return r[a?"CRS":"SRS"]=i.getCode(),a&&n.substr(0,2)=="ne"?o=[t[1],t[0],t[3],t[2]]:o=t,r.BBOX=o.join(","),Ih(s,r)}function oF(s,t,e,i,r,n,o){n=Object.assign({REQUEST:"GetMap"},n);const a=t/e,l=[Qm(Kt(s)/a,so),Qm(ci(s)/a,so)];if(e!=1)switch(o){case"geoserver":const h=90*e+.5|0;"FORMAT_OPTIONS"in n?n.FORMAT_OPTIONS+=";dpi:"+h:n.FORMAT_OPTIONS="dpi:"+h;break;case"mapserver":n.MAP_RESOLUTION=90*e;break;case"carmentaserver":case"qgis":n.DPI=90*e;break;default:throw new Error("Unknown `serverType` configured")}return nF(r,s,l,i,n)}function A0(s,t){return Object.assign({REQUEST:t,SERVICE:"WMS",VERSION:I0,FORMAT:"image/png",STYLES:"",TRANSPARENT:!0},s)}function aF(s){const t=s.hidpi===void 0?!0:s.hidpi,e=ct(s.projection||"EPSG:3857"),i=s.ratio||1.5,r=s.load||Nl;return(n,o,a)=>{n=_y(n,o,a,i),a!=1&&(!t||s.serverType===void 0)&&(a=1);const l=oF(n,o,a,e,s.url,A0(s.params,"GetMap"),s.serverType),h=new Image;return s.crossOrigin!==null&&(h.crossOrigin=s.crossOrigin),r(h,l).then(c=>({image:c,extent:n,pixelRatio:a}))}}function Vq(s,t,e){if(s.url===void 0)return;const i=ct(s.projection||"EPSG:3857"),r=Kb(t,e,0,GT),n={QUERY_LAYERS:s.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(n,A0(s.params,"GetFeatureInfo"),s.params);const o=Hc((t[0]-r[0])/e,so),a=Hc((r[3]-t[1])/e,so),l=Qb(n.VERSION,"1.3")>=0;return n[l?"I":"X"]=o,n[l?"J":"Y"]=a,nF(s.url,r,GT,i,n)}function Hq(s,t){if(s.url===void 0)return;const e={SERVICE:"WMS",VERSION:I0,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(s.params===void 0||s.params.LAYER===void 0){const i=s.params.LAYERS;if(!(!Array.isArray(i)||i.length===1))return;e.LAYER=i}if(t!==void 0){const i=ct(s.projection||"EPSG:3857").getMetersPerUnit()||1,r=28e-5;e.SCALE=t*i/r}return Object.assign(e,s.params),Ih(s.url,e)}class Wq extends Un{constructor(t){t=t||{};const e=Object.assign({},t.params),i="TRANSPARENT"in e?e.TRANSPARENT:!0;super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:!i,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0,this.params_=e,this.v13_=!0,this.serverType_=t.serverType,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.tmpExtent_=Ys(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(t,e,i,r){const n=ct(i),o=this.getProjection()||n;let a=this.getTileGrid();a||(a=this.getTileGridForProjection(o));const l=iw(t,n,o),h=ig(o,n,t,e),c=a.getZForResolution(h,this.zDirection),u=a.getResolution(c),d=a.getTileCoordForCoordAndZ(l,c);if(a.getResolutions().length<=d[0])return;let p=a.getTileCoordExtent(d,this.tmpExtent_);const g=this.gutter_;g!==0&&(p=ln(p,u*g,p));const f={QUERY_LAYERS:this.params_.LAYERS};Object.assign(f,A0(this.params_,"GetFeatureInfo"),r);const m=Math.floor((l[0]-p[0])/u),_=Math.floor((p[3]-l[1])/u);return f[this.v13_?"I":"X"]=m,f[this.v13_?"J":"Y"]=_,this.getRequestUrl_(d,p,1,o||n,f)}getLegendUrl(t,e){if(this.urls[0]===void 0)return;const i={SERVICE:"WMS",VERSION:I0,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(e===void 0||e.LAYER===void 0){const r=this.params_.LAYERS;if(!(!Array.isArray(r)||r.length===1))return;i.LAYER=r}if(t!==void 0){const r=this.getProjection()?this.getProjection().getMetersPerUnit():1,n=28e-5;i.SCALE=t*r/n}return Object.assign(i,e),Ih(this.urls[0],i)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(t,e,i,r,n){const o=this.urls;if(!o)return;let a;if(o.length==1)a=o[0];else{const l=Ko(rE(t),o.length);a=o[l]}return oF(e,(this.tileGrid||this.getTileGridForProjection(r)).getResolution(t[0]),i,r,a,n,this.serverType_)}getTilePixelRatio(t){return!this.hidpi_||this.serverType_===void 0?1:t}getKeyForParams_(){let t=0;const e=[];for(const i in this.params_)e[t++]=i+"-"+this.params_[i];return e.join("/")}updateParams(t){Object.assign(this.params_,t),this.updateV13_(),this.setKey(this.getKeyForParams_())}updateV13_(){const t=this.params_.VERSION||I0;this.v13_=Qb(t,"1.3")>=0}tileUrlFunction(t,e,i){let r=this.getTileGrid();if(r||(r=this.getTileGridForProjection(i)),r.getResolutions().length<=t[0])return;e!=1&&(!this.hidpi_||this.serverType_===void 0)&&(e=1);const n=r.getResolution(t[0]);let o=r.getTileCoordExtent(t,this.tmpExtent_);const a=this.gutter_;a!==0&&(o=ln(o,n*a,o));const l=Object.assign({},A0(this.params_,"GetMap"));return this.getRequestUrl_(t,o,e,i,l)}}const lF=Wq;class Xq extends Un{constructor(t){const e=t.requestEncoding!==void 0?t.requestEncoding:"KVP",i=t.tileGrid;let r=t.urls;r===void 0&&t.url!==void 0&&(r=FE(t.url)),super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,urls:r,wrapX:t.wrapX!==void 0?t.wrapX:!1,transition:t.transition,zDirection:t.zDirection}),this.version_=t.version!==void 0?t.version:"1.0.0",this.format_=t.format!==void 0?t.format:"image/jpeg",this.dimensions_=t.dimensions!==void 0?t.dimensions:{},this.layer_=t.layer,this.matrixSet_=t.matrixSet,this.style_=t.style,this.requestEncoding_=e,this.setKey(this.getKeyForDimensions_()),r&&r.length>0&&(this.tileUrlFunction=ng(r.map(this.createFromWMTSTemplate.bind(this))))}setUrls(t){this.urls=t;const e=t.join(`
`);this.setTileUrlFunction(ng(t.map(this.createFromWMTSTemplate.bind(this))),e)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const t=this.urls?this.urls.slice(0):[];for(const e in this.dimensions_)t.push(e+"-"+this.dimensions_[e]);return t.join("/")}updateDimensions(t){Object.assign(this.dimensions_,t),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(t){const e=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};e=="KVP"&&Object.assign(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),t=e=="KVP"?Ih(t,i):t.replace(/\{(\w+?)\}/g,function(o,a){return a.toLowerCase()in i?i[a.toLowerCase()]:o});const r=this.tileGrid,n=this.dimensions_;return function(o,a,l){if(!o)return;const h={TileMatrix:r.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(h,n);let c=t;return e=="KVP"?c=Ih(c,h):c=c.replace(/\{(\w+?)\}/g,function(u,d){return h[d]}),c}}}const hF=Xq;function qq(s,t){const e=s.Contents.Layer,i=e==null?void 0:e.find(function(O){return O.Identifier==t.layer});if(!i)return null;const r=s.Contents.TileMatrixSet;let n;i.TileMatrixSetLink.length>1?"projection"in t?n=i.TileMatrixSetLink.findIndex(function(O){const N=r.find(function(C){return C.Identifier==O.TileMatrixSet}).SupportedCRS,x=ct(N),w=ct(t.projection);return x&&w?Rs(x,w):N==t.projection}):n=i.TileMatrixSetLink.findIndex(function(O){return O.TileMatrixSet==t.matrixSet}):n=0,n<0&&(n=0);const o=i.TileMatrixSetLink[n].TileMatrixSet,a=i.TileMatrixSetLink[n].TileMatrixSetLimits;let l=i.Format[0];"format"in t&&(l=t.format),n=i.Style.findIndex(function(O){return"style"in t?O.Title==t.style:O.isDefault}),n<0&&(n=0);const h=i.Style[n].Identifier,c={};"Dimension"in i&&i.Dimension.forEach(function(O,N,x){const w=O.Identifier;let C=O.Default;C===void 0&&(C=O.Value[0]),c[w]=C});const u=s.Contents.TileMatrixSet.find(function(O){return O.Identifier==o});let d;const p=u.SupportedCRS;if(p&&(d=ct(p)),"projection"in t){const O=ct(t.projection);O&&(!d||Rs(O,d))&&(d=O)}let g=!1;const f=d.getAxisOrientation().substr(0,2)=="ne";let m=u.TileMatrix[0],_={MinTileCol:0,MinTileRow:0,MaxTileCol:m.MatrixWidth-1,MaxTileRow:m.MatrixHeight-1};if(a){_=a[a.length-1];const O=u.TileMatrix.find(N=>N.Identifier===_.TileMatrix||u.Identifier+":"+N.Identifier===_.TileMatrix);O&&(m=O)}const y=m.ScaleDenominator*28e-5/d.getMetersPerUnit(),v=f?[m.TopLeftCorner[1],m.TopLeftCorner[0]]:m.TopLeftCorner,b=m.TileWidth*y,E=m.TileHeight*y;let S=u.BoundingBox;S&&f&&(S=[S[1],S[0],S[3],S[2]]);let T=[v[0]+b*_.MinTileCol,v[1]-E*(1+_.MaxTileRow),v[0]+b*(1+_.MaxTileCol),v[1]-E*_.MinTileRow];if(S!==void 0&&!rr(S,T)){const O=i.WGS84BoundingBox,N=ct("EPSG:4326").getExtent();if(T=S,O)g=O[0]===N[0]&&O[2]===N[2];else{const x=sw(S,u.SupportedCRS,"EPSG:4326");g=x[0]-1e-10<=N[0]&&x[2]+1e-10>=N[2]}}const R=IW(u,T,a),M=[];let A=t.requestEncoding;if(A=A!==void 0?A:"","OperationsMetadata"in s&&"GetTile"in s.OperationsMetadata){const O=s.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let N=0,x=O.length;N<x;++N)if(O[N].Constraint){const w=O[N].Constraint.find(function(C){return C.name=="GetEncoding"}).AllowedValues.Value;if(A===""&&(A=w[0]),A==="KVP")w.includes("KVP")&&M.push(O[N].href);else break}else O[N].href&&(A="KVP",M.push(O[N].href))}return M.length===0&&(A="REST",i.ResourceURL.forEach(function(O){O.resourceType==="tile"&&(l=O.format,M.push(O.template))})),{urls:M,layer:t.layer,matrixSet:o,format:l,projection:d,requestEncoding:A,tileGrid:R,style:h,dimensions:c,wrapX:g,crossOrigin:t.crossOrigin}}class Yq extends Un{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",i=t.tileGrid!==void 0?t.tileGrid:Vh({extent:Ta(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}const Ah=Yq;var cF={exports:{}};(function(s,t){(function(e,i){s.exports=i()})(vh,function(){var e=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function i(u,d){return u.indexOf(d)===-1?u.length:u.indexOf(d)}function r(u){var d=u.replace(/^v/,"").replace(/\+.*$/,""),p=i(d,"-"),g=d.substring(0,p).split(".");return g.push(d.substring(p+1)),g}function n(u){return isNaN(Number(u))?u:Number(u)}function o(u){if(typeof u!="string")throw new TypeError("Invalid argument expected string");if(!e.test(u))throw new Error("Invalid argument not valid semver ('"+u+"' received)")}function a(u,d){[u,d].forEach(o);for(var p=r(u),g=r(d),f=0;f<Math.max(p.length-1,g.length-1);f++){var m=parseInt(p[f]||0,10),_=parseInt(g[f]||0,10);if(m>_)return 1;if(_>m)return-1}var y=p[p.length-1],v=g[g.length-1];if(y&&v){var b=y.split(".").map(n),E=v.split(".").map(n);for(f=0;f<Math.max(b.length,E.length);f++){if(b[f]===void 0||typeof E[f]=="string"&&typeof b[f]=="number")return-1;if(E[f]===void 0||typeof b[f]=="string"&&typeof E[f]=="number"||b[f]>E[f])return 1;if(E[f]>b[f])return-1}}else if(y||v)return y?-1:1;return 0}var l=[">",">=","=","<","<="],h={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function c(u){if(typeof u!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof u);if(l.indexOf(u)===-1)throw new TypeError("Invalid operator, expected one of "+l.join("|"))}return a.validate=function(u){return typeof u=="string"&&e.test(u)},a.compare=function(u,d,p){c(p);var g=a(u,d);return h[p].indexOf(g)>-1},a})})(cF);var Zq=cF.exports,Hv=Zq;const DE="1.0.0",Ot={classification:"https://stac-extensions.github.io/classification/v1.1.0/schema.json",datacube:"https://stac-extensions.github.io/datacube/v2.1.0/schema.json",eo:"https://stac-extensions.github.io/eo/v1.0.0/schema.json",file:"https://stac-extensions.github.io/file/v1.0.0/schema.json","item-assets":"https://stac-extensions.github.io/item-assets/v1.0.0/schema.json",label:"https://stac-extensions.github.io/label/v1.0.1/schema.json",pointcloud:"https://stac-extensions.github.io/pointcloud/v1.0.0/schema.json",processing:"https://stac-extensions.github.io/processing/v1.1.0/schema.json",projection:"https://stac-extensions.github.io/projection/v1.0.0/schema.json",raster:"https://stac-extensions.github.io/raster/v1.1.0/schema.json",sar:"https://stac-extensions.github.io/sar/v1.0.0/schema.json",sat:"https://stac-extensions.github.io/sat/v1.0.0/schema.json",scientific:"https://stac-extensions.github.io/scientific/v1.0.0/schema.json",table:"https://stac-extensions.github.io/table/v1.2.0/schema.json",timestamps:"https://stac-extensions.github.io/timestamps/v1.0.0/schema.json",version:"https://stac-extensions.github.io/version/v1.0.0/schema.json",view:"https://stac-extensions.github.io/view/v1.0.0/schema.json"},wh={itemAndCollection:{"cube:":Ot.datacube,"eo:":Ot.eo,"file:":Ot.file,"label:":Ot.label,"pc:":Ot.pointcloud,"processing:":Ot.processing,"proj:":Ot.projection,"raster:":Ot.raster,"sar:":Ot.sar,"sat:":Ot.sat,"sci:":Ot.scientific,"view:":Ot.view,version:Ot.version,deprecated:Ot.version,published:Ot.timestamps,expires:Ot.timestamps,unpublished:Ot.timestamps},catalog:{},collection:{item_assets:Ot["item-assets"]},item:{}};wh.collection=Object.assign(wh.collection,wh.itemAndCollection);wh.item=Object.assign(wh.item,wh.itemAndCollection);var Qd={parseUrl(s){let t=s.match(/^https?:\/\/stac-extensions.github.io\/([^\/]+)\/v([^\/]+)\/[^.]+.json$/i);if(t)return{id:t[1],version:t[2]}}},Ce={version:DE,extensions:{},set(s){if(typeof s.stac_version!="string"?Ce.version="0.6.0":Ce.version=s.stac_version,Array.isArray(s.stac_extensions))for(let t of s.stac_extensions){let e=Qd.parseUrl(t);e&&(Ce.extensions[e.id]=e.version)}},before(s,t=null){let e=t?Ce.extensions[t]:Ce.version;return typeof e>"u"?!1:Hv.compare(e,s,"<")}},U={type(s){let t=typeof s;if(t==="object"){if(s===null)return"null";if(Array.isArray(s))return"array"}return t},is(s,t){return U.type(s)===t},isDefined(s){return typeof s<"u"},isObject(s){return typeof s=="object"&&s===Object(s)&&!Array.isArray(s)},rename(s,t,e){return typeof s[t]<"u"&&typeof s[e]>"u"?(s[e]=s[t],delete s[t],!0):!1},forAll(s,t,e){if(s[t]&&typeof s[t]=="object")for(let i in s[t])e(s[t][i])},toArray(s,t){return typeof s[t]<"u"&&!Array.isArray(s[t])?(s[t]=[s[t]],!0):!1},flattenArray(s,t,e,i=!1){if(Array.isArray(s[t])){for(let r in s[t])if(typeof e[r]=="string"){let n=s[t][r];s[e[r]]=i?[n]:n}return delete s[t],!0}return!1},flattenOneElementArray(s,t,e=!1){return!e&&Array.isArray(s[t])?s[t].length===1?(s[t]=s[t][0],!0):!1:!0},removeFromArray(s,t,e){if(Array.isArray(s[t])){let i=s[t].indexOf(e);return i>-1&&s[t].splice(i,1),!0}return!1},ensure(s,t,e){return U.type(e)!==U.type(s[t])&&(s[t]=e),!0},upgradeExtension(s,t){let{id:e,version:i}=Qd.parseUrl(t),r=s.stac_extensions.findIndex(n=>{let o=Qd.parseUrl(n);return o&&o.id===e&&Hv.compare(o.version,i,"<")});return r!==-1?(s.stac_extensions[r]=t,!0):!1},addExtension(s,t){let{id:e,version:i}=Qd.parseUrl(t),r=s.stac_extensions.findIndex(n=>{if(n===t)return!0;let o=Qd.parseUrl(n);return!!(o&&o.id===e&&Hv.compare(o.version,i,"<"))});return r===-1?s.stac_extensions.push(t):s.stac_extensions[r]=t,s.stac_extensions.sort(),!0},removeExtension(s,t){return U.removeFromArray(s,"stac_extensions",t)},migrateExtensionShortnames(s){let t=Object.keys(Ot),e=Object.values(Ot);return U.mapValues(s,"stac_extensions",t,e)},populateExtensions(s,t){let e=[];(t=="catalog"||t=="collection")&&e.push(s),(t=="item"||t=="collection")&&U.isObject(s.assets)&&(e=e.concat(Object.values(s.assets))),t=="collection"&&U.isObject(s.item_assets)&&(e=e.concat(Object.values(s.item_assets))),t=="collection"&&U.isObject(s.summaries)&&e.push(s.summaries),t=="item"&&U.isObject(s.properties)&&e.push(s.properties);for(let i of e)Object.keys(i).forEach(r=>{let n=r.match(/^(\w+:|[^:]+$)/i);if(Array.isArray(n)){let o=wh[t][n[0]];U.is(o,"string")&&U.addExtension(s,o)}})},mapValues(s,t,e,i){let r=n=>{let o=e.indexOf(n);return o>=0?i[o]:n};return Array.isArray(s[t])?s[t]=s[t].map(r):typeof s[t]<"u"&&(s[t]=r(s[t])),!0},mapObject(s,t){for(let e in s)s[e]=t(s[e],e)},moveTo(s,t,e,i=!1,r=!1){let n;return i?r?n=o=>Array.isArray(o):n=o=>Array.isArray(o)&&o.length===1:n=U.isDefined,n(s[t])?(e[t]=i&&!r?s[t][0]:s[t],delete s[t],!0):!1},runAll(s,t,e,i){for(let r in s)r.startsWith("migrate")||s[r](t,e,i)},toUTC(s,t){if(typeof s[t]=="string")try{return s[t]=this.toISOString(s[t]),!0}catch{}return delete s[t],!1},toISOString(s){return s instanceof Date||(s=new Date(s)),s.toISOString().replace(".000","")}},to={multihash:null,hexToUint8(s){if(s.length===0||s.length%2!==0)throw new Error(`The string "${s}" is not valid hex.`);return new Uint8Array(s.match(/.{1,2}/g).map(t=>parseInt(t,16)))},uint8ToHex(s){return s.reduce((t,e)=>t+e.toString(16).padStart(2,"0"),"")},toMultihash(s,t,e){if(!to.multihash||!U.is(s[t],"string"))return!1;try{const i=to.multihash.encode(to.hexToUint8(s[t]),e);return s[t]=to.uint8ToHex(i),!0}catch(i){return console.warn(i),!1}}},$E={migrate(s,t=!0){return Ce.set(s),t&&(s.stac_version=DE),s.type="Catalog",U.ensure(s,"stac_extensions",[]),Ce.before("1.0.0-rc.1")&&U.migrateExtensionShortnames(s),U.ensure(s,"id",""),U.ensure(s,"description",""),U.ensure(s,"links",[]),U.runAll($E,s,s),Ce.before("0.8.0")&&U.populateExtensions(s,"catalog"),s}},jE={migrate(s,t=!0){return $E.migrate(s,t),s.type="Collection",Ce.before("1.0.0-rc.1")&&U.migrateExtensionShortnames(s),U.ensure(s,"license","proprietary"),U.ensure(s,"extent",{spatial:{bbox:[]},temporal:{interval:[]}}),U.runAll(jE,s,s),U.isObject(s.properties)&&(U.removeFromArray(s,"stac_extensions","commons"),delete s.properties),Ce.before("0.8.0")&&U.populateExtensions(s,"collection"),Ce.before("1.0.0-beta.1")&&U.mapValues(s,"stac_extensions",["assets"],["item-assets"]),s},extent(s){if(U.ensure(s,"extent",{}),Ce.before("0.8.0")&&(Array.isArray(s.extent.spatial)&&(s.extent.spatial={bbox:[s.extent.spatial]}),Array.isArray(s.extent.temporal)&&(s.extent.temporal={interval:[s.extent.temporal]})),U.ensure(s.extent,"spatial",{}),U.ensure(s.extent.spatial,"bbox",[]),U.ensure(s.extent,"temporal",{}),U.ensure(s.extent.temporal,"interval",[]),Ce.before("1.0.0-rc.3")){if(s.extent.temporal.interval.length>1){let t,e;for(let i of s.extent.temporal.interval){if(i[0]===null)t=null;else if(typeof i[0]=="string"&&t!==null)try{let r=new Date(i[0]);(typeof t>"u"||r<t)&&(t=r)}catch{}if(i[1]===null)e=null;else if(typeof i[1]=="string"&&e!==null)try{let r=new Date(i[1]);(typeof e>"u"||r>e)&&(e=r)}catch{}}s.extent.temporal.interval.unshift([t?U.toISOString(t):null,e?U.toISOString(e):null])}if(s.extent.spatial.bbox.length>1){let t=s.extent.spatial.bbox.reduce((e,i)=>Array.isArray(i)?Math.max(i.length,e):e,4);if(t>=4){let e=new Array(t).fill(null),i=t/2;for(let r of s.extent.spatial.bbox){if(!Array.isArray(r)||r.length<4)break;for(let n in r){let o=r[n];e[n]===null?e[n]=o:n<i?e[n]=Math.min(o,e[n]):e[n]=Math.max(o,e[n])}}e.findIndex(r=>r===null)===-1&&s.extent.spatial.bbox.unshift(e)}}}},collectionAssets(s){Ce.before("1.0.0-rc.1")&&U.removeExtension(s,"collection-assets"),og.migrateAll(s)},itemAsset(s){Ce.before("1.0.0-beta.2")&&U.rename(s,"item_assets","assets"),og.migrateAll(s,"item_assets")},summaries(s){if(U.ensure(s,"summaries",{}),Ce.before("0.8.0")&&U.isObject(s.other_properties)){for(let t in s.other_properties){let e=s.other_properties[t];Array.isArray(e.extent)&&e.extent.length===2?s.summaries[t]={minimum:e.extent[0],maximum:e.extent[1]}:Array.isArray(e.values)&&(e.values.filter(i=>Array.isArray(i)).length===e.values.length?s.summaries[t]=e.values.reduce((i,r)=>i.concat(r),[]):s.summaries[t]=e.values)}delete s.other_properties}if(Ce.before("1.0.0-beta.1")&&U.isObject(s.properties)&&!s.links.find(t=>["child","item"].includes(t.rel)))for(let t in s.properties){let e=s.properties[t];Array.isArray(e)||(e=[e]),s.summaries[t]=e}Ce.before("1.0.0-rc.1")&&U.mapObject(s.summaries,t=>(U.rename(t,"min","minimum"),U.rename(t,"max","maximum"),t)),xy.migrate(s.summaries,s,!0),U.moveTo(s.summaries,"sci:doi",s,!0)&&U.addExtension(s,Ot.scientific),U.moveTo(s.summaries,"sci:publications",s,!0,!0)&&U.addExtension(s,Ot.scientific),U.moveTo(s.summaries,"sci:citation",s,!0)&&U.addExtension(s,Ot.scientific),U.moveTo(s.summaries,"cube:dimensions",s,!0)&&U.addExtension(s,Ot.datacube),Object.keys(s.summaries).length===0&&delete s.summaries}},GE={migrate(s,t=null,e=!0){Ce.set(s),e&&(s.stac_version=DE),U.ensure(s,"stac_extensions",[]),Ce.before("1.0.0-rc.1")&&U.migrateExtensionShortnames(s),U.ensure(s,"id",""),U.ensure(s,"type","Feature"),U.isObject(s.geometry)||(s.geometry=null),s.geometry!==null&&U.ensure(s,"bbox",[]),U.ensure(s,"properties",{}),U.ensure(s,"links",[]),U.ensure(s,"assets",{});let i=!1;return U.isObject(t)&&U.isObject(t.properties)&&(U.removeFromArray(s,"stac_extensions","commons"),s.properties=Object.assign({},t.properties,s.properties),i=!0),U.runAll(GE,s,s),xy.migrate(s.properties,s),og.migrateAll(s),(Ce.before("0.8.0")||i)&&U.populateExtensions(s,"item"),s}},uF={migrate(s,t=!0){return U.ensure(s,"collections",[]),U.ensure(s,"links",[]),U.runAll(uF,s,s),s.collections=s.collections.map(e=>jE.migrate(e,t)),s}},dF={migrate(s,t=!0){return U.ensure(s,"type","FeatureCollection"),U.ensure(s,"features",[]),U.ensure(s,"links",[]),U.runAll(dF,s,s),s.features=s.features.map(e=>GE.migrate(e,null,t)),s}},og={migrateAll(s,t="assets"){for(let e in s[t])og.migrate(s[t][e],s)},migrate(s,t){return U.runAll(og,s,t),xy.migrate(s,t),s},mediaTypes(s){U.is(s.type,"string")&&U.mapValues(s,"type",["image/vnd.stac.geotiff","image/vnd.stac.geotiff; cloud-optimized=true"],["image/tiff; application=geotiff","image/tiff; application=geotiff; profile=cloud-optimized"])},eo(s,t){let e=U.isObject(t.properties)&&Array.isArray(t.properties["eo:bands"])?t.properties["eo:bands"]:[];if(Array.isArray(s["eo:bands"]))for(let i in s["eo:bands"]){let r=s["eo:bands"][i];U.is(r,"number")&&U.isObject(e[r])?r=e[r]:U.isObject(r)||(r={}),s["eo:bands"][i]=r}}},xy={migrate(s,t,e=!1){return U.runAll(xy,s,t,e),s},_commonMetadata(s){Ce.before("1.0.0-rc.3")&&(U.toUTC(s,"created"),U.toUTC(s,"updated"))},_timestamps(s,t){U.toUTC(s,"published"),U.toUTC(s,"expires"),U.toUTC(s,"unpublished"),U.upgradeExtension(t,Ot.timestamps)},_versioningIndicator(s,t){U.upgradeExtension(t,Ot.version)},checksum(s,t){Ce.before("0.9.0")&&to.multihash&&(U.rename(s,"checksum:md5","checksum:multihash")&&to.toMultihash(s,"checksum:multihash","md5"),U.rename(s,"checksum:sha1","checksum:multihash")&&to.toMultihash(s,"checksum:multihash","sha1"),U.rename(s,"checksum:sha2","checksum:multihash")&&to.toMultihash(s,"checksum:multihash","sha2-256"),U.rename(s,"checksum:sha3","checksum:multihash")&&to.toMultihash(s,"checksum:multihash","sha3-256")),Ce.before("1.0.0-rc.1")&&U.rename(s,"checksum:multihash","file:checksum")&&U.addExtension(t,Ot.file),U.removeExtension(t,"checksum")},classification(s,t){Ce.before("1.1.0","classification")&&U.forAll(s,"classification:classes",e=>U.rename(e,"color-hint","color_hint")),U.upgradeExtension(t,Ot.classification)},cube(s,t){U.upgradeExtension(t,Ot.datacube)},dtr(s,t){Ce.before("0.9.0")&&(U.rename(s,"dtr:start_datetime","start_datetime"),U.rename(s,"dtr:end_datetime","end_datetime"),U.removeExtension(t,"datetime-range"))},eo(s,t){Ce.before("0.9.0")&&(U.rename(s,"eo:epsg","proj:epsg")&&U.addExtension(t,Ot.projection),U.rename(s,"eo:platform","platform"),U.rename(s,"eo:instrument","instruments")&&U.toArray(s,"instruments"),U.rename(s,"eo:constellation","constellation"),U.rename(s,"eo:off_nadir","view:off_nadir")&&U.addExtension(t,Ot.view),U.rename(s,"eo:azimuth","view:azimuth")&&U.addExtension(t,Ot.view),U.rename(s,"eo:incidence_angle","view:incidence_angle")&&U.addExtension(t,Ot.view),U.rename(s,"eo:sun_azimuth","view:sun_azimuth")&&U.addExtension(t,Ot.view),U.rename(s,"eo:sun_elevation","view:sun_elevation")&&U.addExtension(t,Ot.view)),Ce.before("1.0.0-beta.1")&&U.rename(s,"eo:gsd","gsd"),U.upgradeExtension(t,Ot.eo)},file(s,t){U.upgradeExtension(t,Ot.file)},label(s,t){Ce.before("0.8.0")&&(U.rename(s,"label:property","label:properties"),U.rename(s,"label:task","label:tasks"),U.rename(s,"label:overview","label:overviews")&&U.toArray(s,"label:overviews"),U.rename(s,"label:method","label:methods"),U.toArray(s,"label:classes")),U.upgradeExtension(t,Ot.label)},pc(s,t){Ce.before("0.8.0")&&U.rename(s,"pc:schema","pc:schemas"),U.upgradeExtension(t,Ot.pointcloud)},processing(s,t){U.upgradeExtension(t,Ot.processing)},proj(s,t){U.upgradeExtension(t,Ot.projection)},raster(s,t){U.upgradeExtension(t,Ot.raster)},sar(s,t,e){U.rename(s,"sar:incidence_angle","view:incidence_angle")&&U.addExtension(t,Ot.view),U.rename(s,"sar:pass_direction","sat:orbit_state")&&U.mapValues(s,"sat:orbit_state",[null],["geostationary"])&&U.addExtension(t,Ot.sat),Ce.before("0.7.0")&&(U.flattenArray(s,"sar:resolution",["sar:resolution_range","sar:resolution_azimuth"],e),U.flattenArray(s,"sar:pixel_spacing",["sar:pixel_spacing_range","sar:pixel_spacing_azimuth"],e),U.flattenArray(s,"sar:looks",["sar:looks_range","sar:looks_azimuth","sar:looks_equivalent_number"],e),U.rename(s,"sar:off_nadir","view:off_nadir")&&U.addExtension(t,Ot.view)),Ce.before("0.9.0")&&(U.rename(s,"sar:platform","platform"),U.rename(s,"sar:instrument","instruments")&&U.toArray(s,"instruments"),U.rename(s,"sar:constellation","constellation"),U.rename(s,"sar:type","sar:product_type"),U.rename(s,"sar:polarization","sar:polarizations"),U.flattenOneElementArray(s,"sar:absolute_orbit",e)&&U.rename(s,"sar:absolute_orbit","sat:absolute_orbit")&&U.addExtension(t,Ot.sat),U.flattenOneElementArray(s,"sar:relative_orbit",e)&&U.rename(s,"sar:relative_orbit","sat:relative_orbit")&&U.addExtension(t,Ot.sat)),U.upgradeExtension(t,Ot.sar)},sat(s,t){Ce.before("0.9.0")&&(U.rename(s,"sat:off_nadir_angle","sat:off_nadir"),U.rename(s,"sat:azimuth_angle","sat:azimuth"),U.rename(s,"sat:sun_azimuth_angle","sat:sun_azimuth"),U.rename(s,"sat:sun_elevation_angle","sat:sun_elevation")),U.upgradeExtension(t,Ot.sat)},sci(s,t){U.upgradeExtension(t,Ot.scientific)},item(s){Ce.before("0.8.0")&&(U.rename(s,"item:license","license"),U.rename(s,"item:providers","providers"))},table(s,t){U.upgradeExtension(t,Ot.table)},view(s,t){U.upgradeExtension(t,Ot.view)}},Cc={item(s,t=null,e=!0){return GE.migrate(s,t,e)},catalog(s,t=!0){return $E.migrate(s,t)},collection(s,t=!0){return jE.migrate(s,t)},collectionCollection(s,t=!0){return uF.migrate(s,t)},itemCollection(s,t=!0){return dF.migrate(s,t)},stac(s,t=!0){return s.type==="Feature"?Cc.item(s,null,t):s.type==="FeatureCollection"?Cc.itemCollection(s,t):s.type==="Collection"||!s.type&&U.isDefined(s.extent)&&U.isDefined(s.license)?Cc.collection(s,t):!s.type&&Array.isArray(s.collections)?Cc.collectionCollection(s,t):Cc.catalog(s,t)},enableMultihash(s){to.multihash=s}},Kq=Cc;const Jq=od(Kq);function Cr(s){return typeof s=="string"&&s.length>0}function xr(s){return typeof s=="object"&&s===Object(s)&&!Array.isArray(s)}function pF(...s){if(s=s.filter(t=>Array.isArray(t)),s.length>1){let t=Math.max(...s.map(i=>i.length)),e=[];for(let i=0;i<t;i++)e.push(Object.assign({},...s.map(r=>r[i])));return e}else if(s.length===1)return s[0];return[]}function Qq(s){switch(s){case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648}return s.startsWith("u")?0:null}function tY(s){switch(s){case"int8":return 127;case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295}return null}let gF=class fF{constructor(t,e={},i=[]){if(!xr(t))throw new Error("Given data is not an object");if(t instanceof fF){for(let r of i)this[r]=t[r];t=t.toJSON()}this._keyMap=e,this._privateKeys=["_keyMap","_privateKeys"].concat(i);for(let r in t)typeof this[r]>"u"&&(r in e?this[r]=e[r](t[r],this):this[r]=t[r])}isItem(){return this.type==="Feature"}isCatalog(){return this.type==="Catalog"}isCatalogLike(){return this.isCatalog()||this.isCollection()}isCollection(){return this.type==="Collection"}isItemCollection(){return this.type==="FeatureCollection"}isCollectionCollection(){return!1}isAsset(){return!1}isLink(){return!1}getObjectType(){}getAbsoluteUrl(){return null}getMetadata(t){return this[t]}toGeoJSON(){return null}getBoundingBox(){return null}getBoundingBoxes(){return[]}toJSON(){let t={};return Object.keys(this).forEach(e=>{if(typeof this[e]=="function"||this._privateKeys.includes(e))return;let i=this[e];if(e in this._keyMap){let r=Array.isArray(i)?[]:{};for(let n in i)r[n]=i[n].toJSON();i=r}t[e]=i}),t}};var mF={exports:{}},$m={exports:{}};/*! https://mths.be/punycode v1.4.0 by @mathias */$m.exports;var zT;function eY(){return zT||(zT=1,function(s,t){(function(e){var i=t&&!t.nodeType&&t,r=s&&!s.nodeType&&s,n=typeof vh=="object"&&vh;(n.global===n||n.window===n||n.self===n)&&(e=n);var o,a=2147483647,l=36,h=1,c=26,u=38,d=700,p=72,g=128,f="-",m=/^xn--/,_=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=l-h,E=Math.floor,S=String.fromCharCode,T;function R(B){throw new RangeError(v[B])}function M(B,H){for(var Y=B.length,at=[];Y--;)at[Y]=H(B[Y]);return at}function A(B,H){var Y=B.split("@"),at="";Y.length>1&&(at=Y[0]+"@",B=Y[1]),B=B.replace(y,".");var k=B.split("."),it=M(k,H).join(".");return at+it}function O(B){for(var H=[],Y=0,at=B.length,k,it;Y<at;)k=B.charCodeAt(Y++),k>=55296&&k<=56319&&Y<at?(it=B.charCodeAt(Y++),(it&64512)==56320?H.push(((k&1023)<<10)+(it&1023)+65536):(H.push(k),Y--)):H.push(k);return H}function N(B){return M(B,function(H){var Y="";return H>65535&&(H-=65536,Y+=S(H>>>10&1023|55296),H=56320|H&1023),Y+=S(H),Y}).join("")}function x(B){return B-48<10?B-22:B-65<26?B-65:B-97<26?B-97:l}function w(B,H){return B+22+75*(B<26)-((H!=0)<<5)}function C(B,H,Y){var at=0;for(B=Y?E(B/d):B>>1,B+=E(B/H);B>b*c>>1;at+=l)B=E(B/b);return E(at+(b+1)*B/(B+u))}function I(B){var H=[],Y=B.length,at,k=0,it=g,nt=p,ht,Pt,Ct,ft,me,pi,he,ts,ve;for(ht=B.lastIndexOf(f),ht<0&&(ht=0),Pt=0;Pt<ht;++Pt)B.charCodeAt(Pt)>=128&&R("not-basic"),H.push(B.charCodeAt(Pt));for(Ct=ht>0?ht+1:0;Ct<Y;){for(ft=k,me=1,pi=l;Ct>=Y&&R("invalid-input"),he=x(B.charCodeAt(Ct++)),(he>=l||he>E((a-k)/me))&&R("overflow"),k+=he*me,ts=pi<=nt?h:pi>=nt+c?c:pi-nt,!(he<ts);pi+=l)ve=l-ts,me>E(a/ve)&&R("overflow"),me*=ve;at=H.length+1,nt=C(k-ft,at,ft==0),E(k/at)>a-it&&R("overflow"),it+=E(k/at),k%=at,H.splice(k++,0,it)}return N(H)}function L(B){var H,Y,at,k,it,nt,ht,Pt,Ct,ft,me,pi=[],he,ts,ve,ns;for(B=O(B),he=B.length,H=g,Y=0,it=p,nt=0;nt<he;++nt)me=B[nt],me<128&&pi.push(S(me));for(at=k=pi.length,k&&pi.push(f);at<he;){for(ht=a,nt=0;nt<he;++nt)me=B[nt],me>=H&&me<ht&&(ht=me);for(ts=at+1,ht-H>E((a-Y)/ts)&&R("overflow"),Y+=(ht-H)*ts,H=ht,nt=0;nt<he;++nt)if(me=B[nt],me<H&&++Y>a&&R("overflow"),me==H){for(Pt=Y,Ct=l;ft=Ct<=it?h:Ct>=it+c?c:Ct-it,!(Pt<ft);Ct+=l)ns=Pt-ft,ve=l-ft,pi.push(S(w(ft+ns%ve,0))),Pt=E(ns/ve);pi.push(S(w(Pt,0))),it=C(Y,ts,at==k),Y=0,++at}++Y,++H}return pi.join("")}function j(B){return A(B,function(H){return m.test(H)?I(H.slice(4).toLowerCase()):H})}function z(B){return A(B,function(H){return _.test(H)?"xn--"+L(H):H})}if(o={version:"1.3.2",ucs2:{decode:O,encode:N},decode:I,encode:L,toASCII:z,toUnicode:j},i&&r)if(s.exports==i)r.exports=o;else for(T in o)o.hasOwnProperty(T)&&(i[T]=o[T]);else e.punycode=o})(vh)}($m,$m.exports)),$m.exports}var BT={exports:{}};/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var UT;function iY(){return UT||(UT=1,function(s){(function(t,e){s.exports?s.exports=e():t.IPv6=e(t)})(vh,function(t){var e=t&&t.IPv6;function i(n){var o=n.toLowerCase(),a=o.split(":"),l=a.length,h=8;a[0]===""&&a[1]===""&&a[2]===""?(a.shift(),a.shift()):a[0]===""&&a[1]===""?a.shift():a[l-1]===""&&a[l-2]===""&&a.pop(),l=a.length,a[l-1].indexOf(".")!==-1&&(h=7);var c;for(c=0;c<l&&a[c]!=="";c++);if(c<h)for(a.splice(c,1,"0000");a.length<h;)a.splice(c,0,"0000");for(var u,d=0;d<h;d++){u=a[d].split("");for(var p=0;p<3&&u[0]==="0"&&u.length>1;p++)u.splice(0,1);a[d]=u.join("")}var g=-1,f=0,m=0,_=-1,y=!1;for(d=0;d<h;d++)y?a[d]==="0"?m+=1:(y=!1,m>f&&(g=_,f=m)):a[d]==="0"&&(y=!0,_=d,m=1);m>f&&(g=_,f=m),f>1&&a.splice(g,f,""),l=a.length;var v="";for(a[0]===""&&(v=":"),d=0;d<l&&(v+=a[d],d!==l-1);d++)v+=":";return a[l-1]===""&&(v+=":"),v}function r(){return t.IPv6===this&&(t.IPv6=e),this}return{best:i,noConflict:r}})}(BT)),BT.exports}var VT={exports:{}};/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var HT;function sY(){return HT||(HT=1,function(s){(function(t,e){s.exports?s.exports=e():t.SecondLevelDomains=e(t)})(vh,function(t){var e=t&&t.SecondLevelDomains,i={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(r){var n=r.lastIndexOf(".");if(n<=0||n>=r.length-1)return!1;var o=r.lastIndexOf(".",n-1);if(o<=0||o>=n-1)return!1;var a=i.list[r.slice(n+1)];return a?a.indexOf(" "+r.slice(o+1,n)+" ")>=0:!1},is:function(r){var n=r.lastIndexOf(".");if(n<=0||n>=r.length-1)return!1;var o=r.lastIndexOf(".",n-1);if(o>=0)return!1;var a=i.list[r.slice(n+1)];return a?a.indexOf(" "+r.slice(0,n)+" ")>=0:!1},get:function(r){var n=r.lastIndexOf(".");if(n<=0||n>=r.length-1)return null;var o=r.lastIndexOf(".",n-1);if(o<=0||o>=n-1)return null;var a=i.list[r.slice(n+1)];return!a||a.indexOf(" "+r.slice(o+1,n)+" ")<0?null:r.slice(o+1)},noConflict:function(){return t.SecondLevelDomains===this&&(t.SecondLevelDomains=e),this}};return i})}(VT)),VT.exports}/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(s){(function(t,e){s.exports?s.exports=e(eY(),iY(),sY()):t.URI=e(t.punycode,t.IPv6,t.SecondLevelDomains,t)})(vh,function(t,e,i,r){var n=r&&r.URI;function o(x,w){var C=arguments.length>=1,I=arguments.length>=2;if(!(this instanceof o))return C?I?new o(x,w):new o(x):new o;if(x===void 0){if(C)throw new TypeError("undefined is not a valid argument for URI");typeof location<"u"?x=location.href+"":x=""}if(x===null&&C)throw new TypeError("null is not a valid argument for URI");return this.href(x),w!==void 0?this.absoluteTo(w):this}function a(x){return/^[0-9]+$/.test(x)}o.version="1.19.11";var l=o.prototype,h=Object.prototype.hasOwnProperty;function c(x){return x.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function u(x){return x===void 0?"Undefined":String(Object.prototype.toString.call(x)).slice(8,-1)}function d(x){return u(x)==="Array"}function p(x,w){var C={},I,L;if(u(w)==="RegExp")C=null;else if(d(w))for(I=0,L=w.length;I<L;I++)C[w[I]]=!0;else C[w]=!0;for(I=0,L=x.length;I<L;I++){var j=C&&C[x[I]]!==void 0||!C&&w.test(x[I]);j&&(x.splice(I,1),L--,I--)}return x}function g(x,w){var C,I;if(d(w)){for(C=0,I=w.length;C<I;C++)if(!g(x,w[C]))return!1;return!0}var L=u(w);for(C=0,I=x.length;C<I;C++)if(L==="RegExp"){if(typeof x[C]=="string"&&x[C].match(w))return!0}else if(x[C]===w)return!0;return!1}function f(x,w){if(!d(x)||!d(w)||x.length!==w.length)return!1;x.sort(),w.sort();for(var C=0,I=x.length;C<I;C++)if(x[C]!==w[C])return!1;return!0}function m(x){var w=/^\/+|\/+$/g;return x.replace(w,"")}o._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:o.preventInvalidHostname,duplicateQueryParameters:o.duplicateQueryParameters,escapeQuerySpace:o.escapeQuerySpace}},o.preventInvalidHostname=!1,o.duplicateQueryParameters=!1,o.escapeQuerySpace=!0,o.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,o.idn_expression=/[^a-z0-9\._-]/i,o.punycode_expression=/(xn--)/i,o.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,o.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig,o.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},o.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,o.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,o.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},o.hostProtocols=["http","https"],o.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,o.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},o.getDomAttribute=function(x){if(!(!x||!x.nodeName)){var w=x.nodeName.toLowerCase();if(!(w==="input"&&x.type!=="image"))return o.domAttributes[w]}};function _(x){return escape(x)}function y(x){return encodeURIComponent(x).replace(/[!'()*]/g,_).replace(/\*/g,"%2A")}o.encode=y,o.decode=decodeURIComponent,o.iso8859=function(){o.encode=escape,o.decode=unescape},o.unicode=function(){o.encode=y,o.decode=decodeURIComponent},o.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},o.encodeQuery=function(x,w){var C=o.encode(x+"");return w===void 0&&(w=o.escapeQuerySpace),w?C.replace(/%20/g,"+"):C},o.decodeQuery=function(x,w){x+="",w===void 0&&(w=o.escapeQuerySpace);try{return o.decode(w?x.replace(/\+/g,"%20"):x)}catch{return x}};var v={encode:"encode",decode:"decode"},b,E=function(x,w){return function(C){try{return o[w](C+"").replace(o.characters[x][w].expression,function(I){return o.characters[x][w].map[I]})}catch{return C}}};for(b in v)o[b+"PathSegment"]=E("pathname",v[b]),o[b+"UrnPathSegment"]=E("urnpath",v[b]);var S=function(x,w,C){return function(I){var L;C?L=function(H){return o[w](o[C](H))}:L=o[w];for(var j=(I+"").split(x),z=0,B=j.length;z<B;z++)j[z]=L(j[z]);return j.join(x)}};o.decodePath=S("/","decodePathSegment"),o.decodeUrnPath=S(":","decodeUrnPathSegment"),o.recodePath=S("/","encodePathSegment","decode"),o.recodeUrnPath=S(":","encodeUrnPathSegment","decode"),o.encodeReserved=E("reserved","encode"),o.parse=function(x,w){var C;return w||(w={preventInvalidHostname:o.preventInvalidHostname}),x=x.replace(o.leading_whitespace_expression,""),x=x.replace(o.ascii_tab_whitespace,""),C=x.indexOf("#"),C>-1&&(w.fragment=x.substring(C+1)||null,x=x.substring(0,C)),C=x.indexOf("?"),C>-1&&(w.query=x.substring(C+1)||null,x=x.substring(0,C)),x=x.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://"),x=x.replace(/^[/\\]{2,}/i,"//"),x.substring(0,2)==="//"?(w.protocol=null,x=x.substring(2),x=o.parseAuthority(x,w)):(C=x.indexOf(":"),C>-1&&(w.protocol=x.substring(0,C)||null,w.protocol&&!w.protocol.match(o.protocol_expression)?w.protocol=void 0:x.substring(C+1,C+3).replace(/\\/g,"/")==="//"?(x=x.substring(C+3),x=o.parseAuthority(x,w)):(x=x.substring(C+1),w.urn=!0))),w.path=x,w},o.parseHost=function(x,w){x||(x=""),x=x.replace(/\\/g,"/");var C=x.indexOf("/"),I,L;if(C===-1&&(C=x.length),x.charAt(0)==="[")I=x.indexOf("]"),w.hostname=x.substring(1,I)||null,w.port=x.substring(I+2,C)||null,w.port==="/"&&(w.port=null);else{var j=x.indexOf(":"),z=x.indexOf("/"),B=x.indexOf(":",j+1);B!==-1&&(z===-1||B<z)?(w.hostname=x.substring(0,C)||null,w.port=null):(L=x.substring(0,C).split(":"),w.hostname=L[0]||null,w.port=L[1]||null)}return w.hostname&&x.substring(C).charAt(0)!=="/"&&(C++,x="/"+x),w.preventInvalidHostname&&o.ensureValidHostname(w.hostname,w.protocol),w.port&&o.ensureValidPort(w.port),x.substring(C)||"/"},o.parseAuthority=function(x,w){return x=o.parseUserinfo(x,w),o.parseHost(x,w)},o.parseUserinfo=function(x,w){var C=x,I=x.indexOf("\\");I!==-1&&(x=x.replace(/\\/g,"/"));var L=x.indexOf("/"),j=x.lastIndexOf("@",L>-1?L:x.length-1),z;return j>-1&&(L===-1||j<L)?(z=x.substring(0,j).split(":"),w.username=z[0]?o.decode(z[0]):null,z.shift(),w.password=z[0]?o.decode(z.join(":")):null,x=C.substring(j+1)):(w.username=null,w.password=null),x},o.parseQuery=function(x,w){if(!x)return{};if(x=x.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!x)return{};for(var C={},I=x.split("&"),L=I.length,j,z,B,H=0;H<L;H++)j=I[H].split("="),z=o.decodeQuery(j.shift(),w),B=j.length?o.decodeQuery(j.join("="),w):null,z!=="__proto__"&&(h.call(C,z)?((typeof C[z]=="string"||C[z]===null)&&(C[z]=[C[z]]),C[z].push(B)):C[z]=B);return C},o.build=function(x){var w="",C=!1;return x.protocol&&(w+=x.protocol+":"),!x.urn&&(w||x.hostname)&&(w+="//",C=!0),w+=o.buildAuthority(x)||"",typeof x.path=="string"&&(x.path.charAt(0)!=="/"&&C&&(w+="/"),w+=x.path),typeof x.query=="string"&&x.query&&(w+="?"+x.query),typeof x.fragment=="string"&&x.fragment&&(w+="#"+x.fragment),w},o.buildHost=function(x){var w="";if(x.hostname)o.ip6_expression.test(x.hostname)?w+="["+x.hostname+"]":w+=x.hostname;else return"";return x.port&&(w+=":"+x.port),w},o.buildAuthority=function(x){return o.buildUserinfo(x)+o.buildHost(x)},o.buildUserinfo=function(x){var w="";return x.username&&(w+=o.encode(x.username)),x.password&&(w+=":"+o.encode(x.password)),w&&(w+="@"),w},o.buildQuery=function(x,w,C){var I="",L,j,z,B;for(j in x)if(j!=="__proto__"&&h.call(x,j))if(d(x[j]))for(L={},z=0,B=x[j].length;z<B;z++)x[j][z]!==void 0&&L[x[j][z]+""]===void 0&&(I+="&"+o.buildQueryParameter(j,x[j][z],C),w!==!0&&(L[x[j][z]+""]=!0));else x[j]!==void 0&&(I+="&"+o.buildQueryParameter(j,x[j],C));return I.substring(1)},o.buildQueryParameter=function(x,w,C){return o.encodeQuery(x,C)+(w!==null?"="+o.encodeQuery(w,C):"")},o.addQuery=function(x,w,C){if(typeof w=="object")for(var I in w)h.call(w,I)&&o.addQuery(x,I,w[I]);else if(typeof w=="string"){if(x[w]===void 0){x[w]=C;return}else typeof x[w]=="string"&&(x[w]=[x[w]]);d(C)||(C=[C]),x[w]=(x[w]||[]).concat(C)}else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")},o.setQuery=function(x,w,C){if(typeof w=="object")for(var I in w)h.call(w,I)&&o.setQuery(x,I,w[I]);else if(typeof w=="string")x[w]=C===void 0?null:C;else throw new TypeError("URI.setQuery() accepts an object, string as the name parameter")},o.removeQuery=function(x,w,C){var I,L,j;if(d(w))for(I=0,L=w.length;I<L;I++)x[w[I]]=void 0;else if(u(w)==="RegExp")for(j in x)w.test(j)&&(x[j]=void 0);else if(typeof w=="object")for(j in w)h.call(w,j)&&o.removeQuery(x,j,w[j]);else if(typeof w=="string")C!==void 0?u(C)==="RegExp"?!d(x[w])&&C.test(x[w])?x[w]=void 0:x[w]=p(x[w],C):x[w]===String(C)&&(!d(C)||C.length===1)?x[w]=void 0:d(x[w])&&(x[w]=p(x[w],C)):x[w]=void 0;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")},o.hasQuery=function(x,w,C,I){switch(u(w)){case"String":break;case"RegExp":for(var L in x)if(h.call(x,L)&&w.test(L)&&(C===void 0||o.hasQuery(x,L,C)))return!0;return!1;case"Object":for(var j in w)if(h.call(w,j)&&!o.hasQuery(x,j,w[j]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(u(C)){case"Undefined":return w in x;case"Boolean":var z=!!(d(x[w])?x[w].length:x[w]);return C===z;case"Function":return!!C(x[w],w,x);case"Array":if(!d(x[w]))return!1;var B=I?g:f;return B(x[w],C);case"RegExp":return d(x[w])?I?g(x[w],C):!1:!!(x[w]&&x[w].match(C));case"Number":C=String(C);case"String":return d(x[w])?I?g(x[w],C):!1:x[w]===C;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},o.joinPaths=function(){for(var x=[],w=[],C=0,I=0;I<arguments.length;I++){var L=new o(arguments[I]);x.push(L);for(var j=L.segment(),z=0;z<j.length;z++)typeof j[z]=="string"&&w.push(j[z]),j[z]&&C++}if(!w.length||!C)return new o("");var B=new o("").segment(w);return(x[0].path()===""||x[0].path().slice(0,1)==="/")&&B.path("/"+B.path()),B.normalize()},o.commonPath=function(x,w){var C=Math.min(x.length,w.length),I;for(I=0;I<C;I++)if(x.charAt(I)!==w.charAt(I)){I--;break}return I<1?x.charAt(0)===w.charAt(0)&&x.charAt(0)==="/"?"/":"":((x.charAt(I)!=="/"||w.charAt(I)!=="/")&&(I=x.substring(0,I).lastIndexOf("/")),x.substring(0,I+1))},o.withinString=function(x,w,C){C||(C={});var I=C.start||o.findUri.start,L=C.end||o.findUri.end,j=C.trim||o.findUri.trim,z=C.parens||o.findUri.parens,B=/[a-z0-9-]=["']?$/i;for(I.lastIndex=0;;){var H=I.exec(x);if(!H)break;var Y=H.index;if(C.ignoreHtml){var at=x.slice(Math.max(Y-3,0),Y);if(at&&B.test(at))continue}for(var k=Y+x.slice(Y).search(L),it=x.slice(Y,k),nt=-1;;){var ht=z.exec(it);if(!ht)break;var Pt=ht.index+ht[0].length;nt=Math.max(nt,Pt)}if(nt>-1?it=it.slice(0,nt)+it.slice(nt).replace(j,""):it=it.replace(j,""),!(it.length<=H[0].length)&&!(C.ignore&&C.ignore.test(it))){k=Y+it.length;var Ct=w(it,Y,k,x);if(Ct===void 0){I.lastIndex=k;continue}Ct=String(Ct),x=x.slice(0,Y)+Ct+x.slice(k),I.lastIndex=Y+Ct.length}}return I.lastIndex=0,x},o.ensureValidHostname=function(x,w){var C=!!x,I=!!w,L=!1;if(I&&(L=g(o.hostProtocols,w)),L&&!C)throw new TypeError("Hostname cannot be empty, if protocol is "+w);if(x&&x.match(o.invalid_hostname_characters)){if(!t)throw new TypeError('Hostname "'+x+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(t.toASCII(x).match(o.invalid_hostname_characters))throw new TypeError('Hostname "'+x+'" contains characters other than [A-Z0-9.-:_]')}},o.ensureValidPort=function(x){if(x){var w=Number(x);if(!(a(w)&&w>0&&w<65536))throw new TypeError('Port "'+x+'" is not a valid port')}},o.noConflict=function(x){if(x){var w={URI:this.noConflict()};return r.URITemplate&&typeof r.URITemplate.noConflict=="function"&&(w.URITemplate=r.URITemplate.noConflict()),r.IPv6&&typeof r.IPv6.noConflict=="function"&&(w.IPv6=r.IPv6.noConflict()),r.SecondLevelDomains&&typeof r.SecondLevelDomains.noConflict=="function"&&(w.SecondLevelDomains=r.SecondLevelDomains.noConflict()),w}else r.URI===this&&(r.URI=n);return this},l.build=function(x){return x===!0?this._deferred_build=!0:(x===void 0||this._deferred_build)&&(this._string=o.build(this._parts),this._deferred_build=!1),this},l.clone=function(){return new o(this)},l.valueOf=l.toString=function(){return this.build(!1)._string};function T(x){return function(w,C){return w===void 0?this._parts[x]||"":(this._parts[x]=w||null,this.build(!C),this)}}function R(x,w){return function(C,I){return C===void 0?this._parts[x]||"":(C!==null&&(C=C+"",C.charAt(0)===w&&(C=C.substring(1))),this._parts[x]=C,this.build(!I),this)}}l.protocol=T("protocol"),l.username=T("username"),l.password=T("password"),l.hostname=T("hostname"),l.port=T("port"),l.query=R("query","?"),l.fragment=R("fragment","#"),l.search=function(x,w){var C=this.query(x,w);return typeof C=="string"&&C.length?"?"+C:C},l.hash=function(x,w){var C=this.fragment(x,w);return typeof C=="string"&&C.length?"#"+C:C},l.pathname=function(x,w){if(x===void 0||x===!0){var C=this._parts.path||(this._parts.hostname?"/":"");return x?(this._parts.urn?o.decodeUrnPath:o.decodePath)(C):C}else return this._parts.urn?this._parts.path=x?o.recodeUrnPath(x):"":this._parts.path=x?o.recodePath(x):"/",this.build(!w),this},l.path=l.pathname,l.href=function(x,w){var C;if(x===void 0)return this.toString();this._string="",this._parts=o._parts();var I=x instanceof o,L=typeof x=="object"&&(x.hostname||x.path||x.pathname);if(x.nodeName){var j=o.getDomAttribute(x);x=x[j]||"",L=!1}if(!I&&L&&x.pathname!==void 0&&(x=x.toString()),typeof x=="string"||x instanceof String)this._parts=o.parse(String(x),this._parts);else if(I||L){var z=I?x._parts:x;for(C in z)C!=="query"&&h.call(this._parts,C)&&(this._parts[C]=z[C]);z.query&&this.query(z.query,!1)}else throw new TypeError("invalid input");return this.build(!w),this},l.is=function(x){var w=!1,C=!1,I=!1,L=!1,j=!1,z=!1,B=!1,H=!this._parts.urn;switch(this._parts.hostname&&(H=!1,C=o.ip4_expression.test(this._parts.hostname),I=o.ip6_expression.test(this._parts.hostname),w=C||I,L=!w,j=L&&i&&i.has(this._parts.hostname),z=L&&o.idn_expression.test(this._parts.hostname),B=L&&o.punycode_expression.test(this._parts.hostname)),x.toLowerCase()){case"relative":return H;case"absolute":return!H;case"domain":case"name":return L;case"sld":return j;case"ip":return w;case"ip4":case"ipv4":case"inet4":return C;case"ip6":case"ipv6":case"inet6":return I;case"idn":return z;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return B}return null};var M=l.protocol,A=l.port,O=l.hostname;l.protocol=function(x,w){if(x&&(x=x.replace(/:(\/\/)?$/,""),!x.match(o.protocol_expression)))throw new TypeError('Protocol "'+x+`" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]`);return M.call(this,x,w)},l.scheme=l.protocol,l.port=function(x,w){return this._parts.urn?x===void 0?"":this:(x!==void 0&&(x===0&&(x=null),x&&(x+="",x.charAt(0)===":"&&(x=x.substring(1)),o.ensureValidPort(x))),A.call(this,x,w))},l.hostname=function(x,w){if(this._parts.urn)return x===void 0?"":this;if(x!==void 0){var C={preventInvalidHostname:this._parts.preventInvalidHostname},I=o.parseHost(x,C);if(I!=="/")throw new TypeError('Hostname "'+x+'" contains characters other than [A-Z0-9.-]');x=C.hostname,this._parts.preventInvalidHostname&&o.ensureValidHostname(x,this._parts.protocol)}return O.call(this,x,w)},l.origin=function(x,w){if(this._parts.urn)return x===void 0?"":this;if(x===void 0){var C=this.protocol(),I=this.authority();return I?(C?C+"://":"")+this.authority():""}else{var L=o(x);return this.protocol(L.protocol()).authority(L.authority()).build(!w),this}},l.host=function(x,w){if(this._parts.urn)return x===void 0?"":this;if(x===void 0)return this._parts.hostname?o.buildHost(this._parts):"";var C=o.parseHost(x,this._parts);if(C!=="/")throw new TypeError('Hostname "'+x+'" contains characters other than [A-Z0-9.-]');return this.build(!w),this},l.authority=function(x,w){if(this._parts.urn)return x===void 0?"":this;if(x===void 0)return this._parts.hostname?o.buildAuthority(this._parts):"";var C=o.parseAuthority(x,this._parts);if(C!=="/")throw new TypeError('Hostname "'+x+'" contains characters other than [A-Z0-9.-]');return this.build(!w),this},l.userinfo=function(x,w){if(this._parts.urn)return x===void 0?"":this;if(x===void 0){var C=o.buildUserinfo(this._parts);return C&&C.substring(0,C.length-1)}else return x[x.length-1]!=="@"&&(x+="@"),o.parseUserinfo(x,this._parts),this.build(!w),this},l.resource=function(x,w){var C;return x===void 0?this.path()+this.search()+this.hash():(C=o.parse(x),this._parts.path=C.path,this._parts.query=C.query,this._parts.fragment=C.fragment,this.build(!w),this)},l.subdomain=function(x,w){if(this._parts.urn)return x===void 0?"":this;if(x===void 0){if(!this._parts.hostname||this.is("IP"))return"";var C=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,C)||""}else{var I=this._parts.hostname.length-this.domain().length,L=this._parts.hostname.substring(0,I),j=new RegExp("^"+c(L));if(x&&x.charAt(x.length-1)!=="."&&(x+="."),x.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return x&&o.ensureValidHostname(x,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(j,x),this.build(!w),this}},l.domain=function(x,w){if(this._parts.urn)return x===void 0?"":this;if(typeof x=="boolean"&&(w=x,x=void 0),x===void 0){if(!this._parts.hostname||this.is("IP"))return"";var C=this._parts.hostname.match(/\./g);if(C&&C.length<2)return this._parts.hostname;var I=this._parts.hostname.length-this.tld(w).length-1;return I=this._parts.hostname.lastIndexOf(".",I-1)+1,this._parts.hostname.substring(I)||""}else{if(!x)throw new TypeError("cannot set domain empty");if(x.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");if(o.ensureValidHostname(x,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=x;else{var L=new RegExp(c(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(L,x)}return this.build(!w),this}},l.tld=function(x,w){if(this._parts.urn)return x===void 0?"":this;if(typeof x=="boolean"&&(w=x,x=void 0),x===void 0){if(!this._parts.hostname||this.is("IP"))return"";var C=this._parts.hostname.lastIndexOf("."),I=this._parts.hostname.substring(C+1);return w!==!0&&i&&i.list[I.toLowerCase()]&&i.get(this._parts.hostname)||I}else{var L;if(x)if(x.match(/[^a-zA-Z0-9-]/))if(i&&i.is(x))L=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(L,x);else throw new TypeError('TLD "'+x+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");L=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(L,x)}else throw new TypeError("cannot set TLD empty");return this.build(!w),this}},l.directory=function(x,w){if(this._parts.urn)return x===void 0?"":this;if(x===void 0||x===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var C=this._parts.path.length-this.filename().length-1,I=this._parts.path.substring(0,C)||(this._parts.hostname?"/":"");return x?o.decodePath(I):I}else{var L=this._parts.path.length-this.filename().length,j=this._parts.path.substring(0,L),z=new RegExp("^"+c(j));return this.is("relative")||(x||(x="/"),x.charAt(0)!=="/"&&(x="/"+x)),x&&x.charAt(x.length-1)!=="/"&&(x+="/"),x=o.recodePath(x),this._parts.path=this._parts.path.replace(z,x),this.build(!w),this}},l.filename=function(x,w){if(this._parts.urn)return x===void 0?"":this;if(typeof x!="string"){if(!this._parts.path||this._parts.path==="/")return"";var C=this._parts.path.lastIndexOf("/"),I=this._parts.path.substring(C+1);return x?o.decodePathSegment(I):I}else{var L=!1;x.charAt(0)==="/"&&(x=x.substring(1)),x.match(/\.?\//)&&(L=!0);var j=new RegExp(c(this.filename())+"$");return x=o.recodePath(x),this._parts.path=this._parts.path.replace(j,x),L?this.normalizePath(w):this.build(!w),this}},l.suffix=function(x,w){if(this._parts.urn)return x===void 0?"":this;if(x===void 0||x===!0){if(!this._parts.path||this._parts.path==="/")return"";var C=this.filename(),I=C.lastIndexOf("."),L,j;return I===-1?"":(L=C.substring(I+1),j=/^[a-z0-9%]+$/i.test(L)?L:"",x?o.decodePathSegment(j):j)}else{x.charAt(0)==="."&&(x=x.substring(1));var z=this.suffix(),B;if(z)x?B=new RegExp(c(z)+"$"):B=new RegExp(c("."+z)+"$");else{if(!x)return this;this._parts.path+="."+o.recodePath(x)}return B&&(x=o.recodePath(x),this._parts.path=this._parts.path.replace(B,x)),this.build(!w),this}},l.segment=function(x,w,C){var I=this._parts.urn?":":"/",L=this.path(),j=L.substring(0,1)==="/",z=L.split(I);if(x!==void 0&&typeof x!="number"&&(C=w,w=x,x=void 0),x!==void 0&&typeof x!="number")throw new Error('Bad segment "'+x+'", must be 0-based integer');if(j&&z.shift(),x<0&&(x=Math.max(z.length+x,0)),w===void 0)return x===void 0?z:z[x];if(x===null||z[x]===void 0)if(d(w)){z=[];for(var B=0,H=w.length;B<H;B++)!w[B].length&&(!z.length||!z[z.length-1].length)||(z.length&&!z[z.length-1].length&&z.pop(),z.push(m(w[B])))}else(w||typeof w=="string")&&(w=m(w),z[z.length-1]===""?z[z.length-1]=w:z.push(w));else w?z[x]=m(w):z.splice(x,1);return j&&z.unshift(""),this.path(z.join(I),C)},l.segmentCoded=function(x,w,C){var I,L,j;if(typeof x!="number"&&(C=w,w=x,x=void 0),w===void 0){if(I=this.segment(x,w,C),!d(I))I=I!==void 0?o.decode(I):void 0;else for(L=0,j=I.length;L<j;L++)I[L]=o.decode(I[L]);return I}if(!d(w))w=typeof w=="string"||w instanceof String?o.encode(w):w;else for(L=0,j=w.length;L<j;L++)w[L]=o.encode(w[L]);return this.segment(x,w,C)};var N=l.query;return l.query=function(x,w){if(x===!0)return o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof x=="function"){var C=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace),I=x.call(this,C);return this._parts.query=o.buildQuery(I||C,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!w),this}else return x!==void 0&&typeof x!="string"?(this._parts.query=o.buildQuery(x,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!w),this):N.call(this,x,w)},l.setQuery=function(x,w,C){var I=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof x=="string"||x instanceof String)I[x]=w!==void 0?w:null;else if(typeof x=="object")for(var L in x)h.call(x,L)&&(I[L]=x[L]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=o.buildQuery(I,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof x!="string"&&(C=w),this.build(!C),this},l.addQuery=function(x,w,C){var I=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.addQuery(I,x,w===void 0?null:w),this._parts.query=o.buildQuery(I,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof x!="string"&&(C=w),this.build(!C),this},l.removeQuery=function(x,w,C){var I=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.removeQuery(I,x,w),this._parts.query=o.buildQuery(I,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof x!="string"&&(C=w),this.build(!C),this},l.hasQuery=function(x,w,C){var I=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.hasQuery(I,x,w,C)},l.setSearch=l.setQuery,l.addSearch=l.addQuery,l.removeSearch=l.removeQuery,l.hasSearch=l.hasQuery,l.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},l.normalizeProtocol=function(x){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!x)),this},l.normalizeHostname=function(x){return this._parts.hostname&&(this.is("IDN")&&t?this._parts.hostname=t.toASCII(this._parts.hostname):this.is("IPv6")&&e&&(this._parts.hostname=e.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!x)),this},l.normalizePort=function(x){return typeof this._parts.protocol=="string"&&this._parts.port===o.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!x)),this},l.normalizePath=function(x){var w=this._parts.path;if(!w)return this;if(this._parts.urn)return this._parts.path=o.recodeUrnPath(this._parts.path),this.build(!x),this;if(this._parts.path==="/")return this;w=o.recodePath(w);var C,I="",L,j;for(w.charAt(0)!=="/"&&(C=!0,w="/"+w),(w.slice(-3)==="/.."||w.slice(-2)==="/.")&&(w+="/"),w=w.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),C&&(I=w.substring(1).match(/^(\.\.\/)+/)||"",I&&(I=I[0]));L=w.search(/\/\.\.(\/|$)/),L!==-1;){if(L===0){w=w.substring(3);continue}j=w.substring(0,L).lastIndexOf("/"),j===-1&&(j=L),w=w.substring(0,j)+w.substring(L+3)}return C&&this.is("relative")&&(w=I+w.substring(1)),this._parts.path=w,this.build(!x),this},l.normalizePathname=l.normalizePath,l.normalizeQuery=function(x){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(o.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!x)),this},l.normalizeFragment=function(x){return this._parts.fragment||(this._parts.fragment=null,this.build(!x)),this},l.normalizeSearch=l.normalizeQuery,l.normalizeHash=l.normalizeFragment,l.iso8859=function(){var x=o.encode,w=o.decode;o.encode=escape,o.decode=decodeURIComponent;try{this.normalize()}finally{o.encode=x,o.decode=w}return this},l.unicode=function(){var x=o.encode,w=o.decode;o.encode=y,o.decode=unescape;try{this.normalize()}finally{o.encode=x,o.decode=w}return this},l.readable=function(){var x=this.clone();x.username("").password("").normalize();var w="";if(x._parts.protocol&&(w+=x._parts.protocol+"://"),x._parts.hostname&&(x.is("punycode")&&t?(w+=t.toUnicode(x._parts.hostname),x._parts.port&&(w+=":"+x._parts.port)):w+=x.host()),x._parts.hostname&&x._parts.path&&x._parts.path.charAt(0)!=="/"&&(w+="/"),w+=x.path(!0),x._parts.query){for(var C="",I=0,L=x._parts.query.split("&"),j=L.length;I<j;I++){var z=(L[I]||"").split("=");C+="&"+o.decodeQuery(z[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),z[1]!==void 0&&(C+="="+o.decodeQuery(z[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}w+="?"+C.substring(1)}return w+=o.decodeQuery(x.hash(),!0),w},l.absoluteTo=function(x){var w=this.clone(),C=["protocol","username","password","hostname","port"],I,L,j;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(x instanceof o||(x=new o(x)),w._parts.protocol||(w._parts.protocol=x._parts.protocol,this._parts.hostname))return w;for(L=0;j=C[L];L++)w._parts[j]=x._parts[j];return w._parts.path?(w._parts.path.substring(-2)===".."&&(w._parts.path+="/"),w.path().charAt(0)!=="/"&&(I=x.directory(),I=I||(x.path().indexOf("/")===0?"/":""),w._parts.path=(I?I+"/":"")+w._parts.path,w.normalizePath())):(w._parts.path=x._parts.path,w._parts.query||(w._parts.query=x._parts.query)),w.build(),w},l.relativeTo=function(x){var w=this.clone().normalize(),C,I,L,j,z;if(w._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(x=new o(x).normalize(),C=w._parts,I=x._parts,j=w.path(),z=x.path(),j.charAt(0)!=="/")throw new Error("URI is already relative");if(z.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");if(C.protocol===I.protocol&&(C.protocol=null),C.username!==I.username||C.password!==I.password||C.protocol!==null||C.username!==null||C.password!==null)return w.build();if(C.hostname===I.hostname&&C.port===I.port)C.hostname=null,C.port=null;else return w.build();if(j===z)return C.path="",w.build();if(L=o.commonPath(j,z),!L)return w.build();var B=I.path.substring(L.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return C.path=B+C.path.substring(L.length)||"./",w.build()},l.equals=function(x){var w=this.clone(),C=new o(x),I={},L={},j={},z,B,H;if(w.normalize(),C.normalize(),w.toString()===C.toString())return!0;if(z=w.query(),B=C.query(),w.query(""),C.query(""),w.toString()!==C.toString()||z.length!==B.length)return!1;I=o.parseQuery(z,this._parts.escapeQuerySpace),L=o.parseQuery(B,this._parts.escapeQuerySpace);for(H in I)if(h.call(I,H)){if(d(I[H])){if(!f(I[H],L[H]))return!1}else if(I[H]!==L[H])return!1;j[H]=!0}for(H in L)if(h.call(L,H)&&!j[H])return!1;return!0},l.preventInvalidHostname=function(x){return this._parts.preventInvalidHostname=!!x,this},l.duplicateQueryParameters=function(x){return this._parts.duplicateQueryParameters=!!x,this},l.escapeQuerySpace=function(x){return this._parts.escapeQuerySpace=!!x,this},o})})(mF);var rY=mF.exports;const Wv=od(rY),WT=["http","https"];function nY(s){return typeof s=="string"&&s.startsWith("/vsi")&&!s.startsWith("/vsicurl/")}function oY(s,t,e=!0){return aY(s,t,!1,e)}function aY(s,t=null,e=!1,i=!0){typeof s=="string"&&s.startsWith("/vsicurl/")&&(s=s.replace(/^\/vsicurl\//,""));let r=Wv(s);if(t&&r.is("relative")&&!nY(s)){let n=Wv(t),o=n.path();!o.endsWith("/")&&!o.endsWith(".json")&&n.path(o+"/"),r=r.absoluteTo(n)}return r.normalize(),e&&(r.query(""),r.fragment("")),i?r.toString():r}const lY="application/geo+json",hY=["application/json",lY,"text/json"],XT=["image/gif","image/jpeg","image/apng","image/png","image/webp"],_F=["image/tiff; application=geotiff; profile=cloud-optimized","image/vnd.stac.geotiff; cloud-optimized=true"],yF=["application/geotiff","image/tiff; application=geotiff","image/vnd.stac.geotiff"].concat(_F);function zE(s,t,e=!1){return Array.isArray(t)||(t=[t]),e&&typeof s>"u"?!0:typeof s!="string"?!1:(t=t.map(i=>i.toLowerCase()),t.includes(s.toLowerCase()))}function cY(s,t=!1){return zE(s,hY,t)}let xF=class extends gF{constructor(t,e=null,i={},r=[]){super(t,i,["_context"].concat(r)),this._context||(this._context=e)}getAbsoluteUrl(t=!0){return this._context?oY(this.href,this._context.getAbsoluteUrl(),t):this.href.includes("://")?this.href:null}getContext(){return this._context}canBrowserDisplayImage(t=!1){if(typeof this.href!="string"||!t&&typeof this.type>"u")return!1;let e=new Wv(this.href),i=e.protocol().toLowerCase(),r=e.suffix().toLowerCase();return Cr(i)&&!WT.includes(i)?!1:Cr(this.type)&&XT.includes(this.type.toLowerCase())?!0:!!(typeof this.type>"u"&&Cr(r)&&(r==="jpg"||XT.includes("image/"+r)))}isType(t){return Cr(this.type)&&zE(this.type,t)}isGeoTIFF(){return this.isType(yF)}isCOG(){return this.isType(_F)}isHTTP(){let t=this.getAbsoluteUrl(!1).protocol().toLowerCase();return Cr(t)&&WT.includes(t)}},uY=class vF extends xF{constructor(t,e=null){super(t,e)}isLink(){return!0}getObjectType(){return"Link"}static fromLinks(t,e=null){return Array.isArray(t)?t.map(i=>xr(i)?new vF(i,e):i):[]}},bF=class extends gF{constructor(t,e=null,i={},r=[]){if(super(t,Object.assign({links:uY.fromLinks},i),["_url"].concat(r)),!this._url&&(this._url=e,!this._url)){let n=this.getSelfLink();n&&(this._url=n.href)}}getAbsoluteUrl(){return this._url}setAbsoluteUrl(t){this._url=t}getStacLinksWithRel(t,e=!0){return this.getLinksWithRels([t]).filter(i=>cY(i.type,e))}getStacLinkWithRel(t,e=!0){const i=this.getStacLinksWithRel(t,e);return i.length>0?i[0]:null}getLinks(){return Array.isArray(this.links)?this.links.filter(t=>xr(t)&&Cr(t.href)):[]}getLinkWithRel(t){return this.getLinks().find(e=>e.rel===t)||null}getLinksWithRels(t){return this.getLinks().filter(e=>t.includes(e.rel))}getLinksWithOtherRels(t){return this.getLinks().filter(e=>!t.includes(e.rel))}getSelfLink(){return this.getStacLinkWithRel("self")}getRootLink(){return this.getStacLinkWithRel("root")}getParentLink(){return this.getStacLinkWithRel("parent")}},wF=class extends bF{constructor(t,e=null,i={},r=[]){super(t,e,i,r)}getAll(){return[]}},cu=class EF extends xF{constructor(t,e=null,i=null){super(t,i,{},["_key"]),this._key||(this._key=e)}getObjectType(){return"Asset"}isAsset(){return!0}getAbsoluteUrl(t=!0){return this.isDefintion()?null:super.getAbsoluteUrl(t)}getKey(){return this._key}getMetadata(t){if(typeof this[t]<"u")return this[t];if(this._context)return this._context.getMetadata(t)}getBands(){return pF(this["eo:bands"],this["raster:bands"])}findVisualBands(){let t={red:null,green:null,blue:null},e=this.getBands();for(let i in e){let r=parseInt(i,10),n=e[r];xr(n)&&Cr(n.common_name)&&n.common_name in t&&(t[n.common_name]={index:r,band:n})}return Object.values(t).every(i=>i!==null)?t:null}findBand(t,e="name",i=null){Array.isArray(t)||(t=[t]),xr(i)||(i=this.getBands());let r=i.findIndex(n=>xr(n)&&t.includes(n[e]));return r>=0?{index:r,band:i[r]}:null}getBand(t){return xr(t)||t===null?t:this.getBands()[t]||null}getMinMaxValues(t=null){t=this.getBand(t);const e={minimum:null,maximum:null},i=a=>a.minimum!==null&&a.maximum!==null;if(t&&(xr(t.statistics)&&(typeof t.statistics.minimum=="number"&&(e.minimum=t.statistics.minimum),typeof t.statistics.maximum=="number"&&(e.maximum=t.statistics.maximum),i(e))||xr(t.histogram)&&(typeof t.histogram.min=="number"&&(e.minimum=t.histogram.min),typeof t.histogram.max=="number"&&(e.maximum=t.histogram.max),i(e))))return e;let r=this.getMetadata("classification:classes");if(Array.isArray(r)&&(r.reduce((a,l)=>(a.minimum=Math.min(a.minimum,l.value),a.maximum=Math.max(a.maximum,l.value),a),e),i(e)))return e;let n=this.getMetadata("file:values");if(Array.isArray(n)&&(n.reduce((a,l)=>(a.minimum=Math.min(a.minimum,...l.values),a.maximum=Math.max(a.maximum,...l.values),a),e),i(e)))return e;let o=xr(t)&&t.data_type||this.getMetadata("file:data_type");return o&&(e.minimum=Qq(o),e.maximum=tY(o)),e}getNoDataValues(t=null){t=this.getBand(t);let e=[];if(t&&typeof t.nodata<"u")e.push(t.nodata);else{let i=this.getMetadata("file:nodata");if(typeof i<"u")e=i;else{let r=this.getMetadata("classification:classes");Array.isArray(r)&&(e=r.filter(n=>!!n.nodata).map(n=>n.value))}}return e.map(i=>i==="nan"?NaN:i==="+inf"?1/0:i==="-inf"?-1/0:i)}isDefintion(){return!Cr(this.href)}isHTTP(){return this.isDefintion()?null:super.isHTTP()}hasRole(t,e=!1){return Array.isArray(t)||(t=[t]),e&&t.includes(this.getKey())?!0:Array.isArray(this.roles)&&!!this.roles.find(i=>t.includes(i))}static fromAssets(t,e=null){let i={};if(xr(t))for(let r in t)i[r]=new EF(t[r],r,e);return i}},BE=class SF extends bF{constructor(t,e=null,i={},r=[]){super(t,e,i,r)}getTemporalExtent(){return null}getTemporalExtents(){return[]}getIcons(t=!0){return this.getLinksWithRels(["icon"]).filter(e=>e.canBrowserDisplayImage(t))}getThumbnails(t=!0,e=null){let i=this.getAssetsWithRoles(["thumbnail","overview"],!0);return e&&i.length>1&&i.sort(r=>Array.isArray(r.roles)&&r.roles.includes(e)||r.getKey()===e?-1:1),i.length===0&&(i=this.getLinksWithRels(["preview"])),t&&(i=i.filter(r=>r.canBrowserDisplayImage())),i}getDefaultGeoTIFF(t=!0,e=!1){var i;return(i=this.rankGeoTIFFs(t,e)[0])==null?void 0:i.asset}rankGeoTIFFs(t=!0,e=!1,i=null,r=null){xr(i)||(i={data:1,visual:2,thumbnail:2,overview:3});let n=[],o=this.getAssetsByTypes(yF);t&&(o=o.filter(l=>l.isHTTP()&&(!e||l.isCOG())));let a=Object.entries(i);for(let l of o){let h=0;if(a.length>0){let c=a.filter(([u])=>l.hasRole(u,!0)).map(([,u])=>u);c.length>0&&(h+=Math.max(...c))}!e&&l.isCOG()&&(h+=2),l.findVisualBands()&&(h+=1),typeof r=="function"&&(h+=r(l)),n.push({asset:l,score:h})}return n.sort((l,h)=>h.score-l.score),n}findVisualAssets(){let t={red:null,green:null,blue:null},e=Object.keys(t),i=this.getAssets();for(let r of i){let n=r.getBands();if(n.length!==1)continue;let o=r.findBand(e,"common_name",n);o&&(t[o.band.common_name]=r)}return Object.values(t).every(r=>r!==null)?t:null}getAsset(t){return xr(this.assets)&&this.assets[t]||null}getAssets(){return xr(this.assets)?Object.values(this.assets):[]}getAssetsWithRoles(t,e=!1){return this.getAssets().filter(i=>i.hasRole(t,e))}getAssetWithRole(t,e=!1){return this.getAssetsWithRoles([t],e)[0]||null}getAssetsByTypes(t){return this.getAssets().filter(e=>zE(e.type,t))}equals(t){return this===t?!0:!(t instanceof SF)||this.getObjectType()!==t.getObjectType()?!1:!!(this.id&&this.id===t.id)}},CF=class extends BE{constructor(t,e=null,i={},r=[]){super(t,e,i,r)}getObjectType(){return this.type}getSearchLink(t=null){let e=this.getStacLinksWithRel("search");return t?e[0]||null:e.find(i=>i.method===t||!t&&!i.method)||null}getApiCollectionsLink(){return this.getStacLinkWithRel("data")}getApiItemsLink(){return this.getStacLinkWithRel("items")}getChildLinks(){return this.getStacLinksWithRel("child")}getItemLinks(){return this.getStacLinksWithRel("item")}};class dY extends CF{constructor(t,e=null){super(t,e)}}function tp(s){if(Cr(s)&&s.length>=10)try{let t=s.match(/^(-?\d{1,})-(\d\d)-(\d\d)[T ](\d\d):(\d\d):(\d\d)(?:\.(\d*))?(?:Z|[+-]00:00)?$/i).slice(1).map(e=>parseInt(e,10));return new Date(Date.UTC(t[0],t[1]-1,t[2],t[3],t[4],t[5],t[6]||0))}catch{return null}return null}function pY(s,t){return new Date(s.valueOf()+(t-s)/2)}function TF(s){if(!Array.isArray(s)||s.length===0)return null;let t,e;const i=(r,n,o)=>typeof r>"u"?n:r===null||n===null?null:o(r,n);return s.forEach(([r,n])=>{t=i(t,r,Math.min),e=i(e,n,Math.max)}),[t===null?null:new Date(t),e===null?null:new Date(e)]}function nf(s){let t=s.length>4,e=s[0],i=s[t?3:2],r=s[1],n=s[t?4:3];return{west:e,east:i,south:r,north:n}}function ex(s){let{west:t,east:e,south:i,north:r}=nf(s);return[[[t,r],[t,i],[e,i],[e,r],[t,r]]]}function RF(s){if(lo(s)?s=[s]:Array.isArray(s)&&(s=s.filter(i=>lo(i))),!Array.isArray(s)||s.length===0)return null;let t=s.reduce((i,r)=>{if(gY(r)){let{west:n,east:o,south:a,north:l}=nf(r);i.push(ex([-180,a,o,l])),i.push(ex([n,a,180,l]))}else i.push(ex(r));return i},[]),e=null;if(t.length===1?e={type:"Polygon",coordinates:t[0]}:t.length>1&&(e={type:"MultiPolygon",coordinates:t}),e)return{type:"Feature",geometry:e,properties:{}}}function lo(s){if(!Array.isArray(s)||![4,6].includes(s.length)||s.some(n=>typeof n!="number"))return!1;let{west:t,east:e,south:i,north:r}=nf(s);return i<=r&&t>=-180&&t<=180&&i>=-90&&e<=180&&e>=-180&&r<=90}function gY(s){if(!lo(s))return!1;let{west:t,east:e}=nf(s);return t>e}function MF(s){if(!Array.isArray(s)||s.length===0)return null;let t={west:180,south:90,east:-180,north:-90};s.forEach(i=>{if(!lo(i))return;let r=nf(i),n=["west","south"];for(let o in r){let a=n.includes(o)?Math.min:Math.max;t[o]=a(t[o],r[o])}});let e=[t.west,t.south,t.east,t.north];return lo(e)?e:null}let IF=class extends CF{constructor(t,e=null){const i={assets:cu.fromAssets,item_assets:cu.fromAssets};super(t,e,i)}toGeoJSON(){let t=RF(this.getBoundingBoxes());return t&&(t.id=this.id),t}getBoundingBox(){let t=this.getRawBoundingBoxes();return t.length>0&&lo(t[0])?t[0]:null}getBoundingBoxes(){let t=this.getRawBoundingBoxes();return t.length===1&&lo(t[0])?t:t.length>1?t.filter((e,i)=>i>0&&lo(e)):[]}getRawBoundingBoxes(){var t,e;let i=(e=(t=this.extent)==null?void 0:t.spatial)==null?void 0:e.bbox;return Array.isArray(i)&&i.length>0?i:[]}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){var t,e;let i=(e=(t=this.extent)==null?void 0:t.temporal)==null?void 0:e.interval;return Array.isArray(i)&&i.length>0?i.filter(r=>Array.isArray(r)&&(Cr(r[0])||Cr(r[1]))).map(r=>r.map(n=>tp(n))):[]}getSummary(t){return this.summaries[t]}getBands(){let t=this.getSummary("eo:bands"),e=this.getSummary("raster:bands"),i=[t,e].filter(r=>Array.isArray(r));return i.length>=2?pF(...i):i.length===1?i[0]:[]}};class fY extends wF{constructor(t,e=null){const i={collections:r=>r.map(n=>new IF(n))};super(t,e,i)}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map(t=>t.toGeoJSON()).filter(t=>t!==null)}}getBoundingBox(){return MF(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map(t=>t.getBoundingBox())}getTemporalExtent(){return TF(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map(t=>t.getTemporalExtent())}}let AF=class extends BE{constructor(t,e=null){super(t,e,{assets:cu.fromAssets})}getObjectType(){return"Item"}toGeoJSON(){return this.toJSON()}getBoundingBox(){return lo(this.bbox)?this.bbox:null}getBoundingBoxes(){return lo(this.bbox)?[this.bbox]:[]}getDateTime(){let t=tp(this.properties.datetime);if(!t){let e=tp(this.properties.start_datetime),i=tp(this.properties.end_datetime);return e&&i?pY(e,i):e||i}return t}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let t=[];return Cr(this.properties.start_datetime)||Cr(this.properties.end_datetime)?t=[[this.properties.start_datetime||null,this.properties.end_datetime||null]]:Cr(this.properties.datetime)&&(t=[[this.properties.datetime,this.properties.datetime]]),t.map(e=>e.map(i=>tp(i)))}getMetadata(t){return this.properties[t]}getBands(){let t=this.getMetadata("eo:bands");return Array.isArray(t)?t:[]}getCollectionLink(){return this.getStacLinkWithRel("collection")}};class mY extends wF{constructor(t,e=null){const i={features:r=>r.map(n=>new AF(n))};super(t,e,i)}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return MF(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map(t=>t.getBoundingBox())}getTemporalExtent(){return TF(this.getTemporalExtents())}getTemporalExtents(){return this.features.map(t=>t.getTemporalExtent())}}function _Y(s,t=!0,e=!1){return t&&(s=Jq.stac(s,e)),s.type==="Feature"?new AF(s):s.type==="FeatureCollection"?new mY(s):s.type==="Collection"||!s.type&&typeof s.extent<"u"&&typeof s.license<"u"?new IF(s):!s.type&&Array.isArray(s.collections)?new fY(s):new dY(s)}let qT=class extends mE{constructor(t){super({...t,state:"loading"}),Bb(this,"loadImage",i=>new Promise((r,n)=>{const o=new Image;o.addEventListener("load",()=>r(o)),o.addEventListener("error",()=>n(new Error("load failed"))),o.src=i}));const e=new gE(t.url);e.getHeader().then(i=>{this.tileGrid.minZoom=i.minZoom,this.tileGrid.maxZoom=i.maxZoom,this.setLoader(async(r,n,o)=>{const a=await e.getZxy(r,n,o),l=URL.createObjectURL(new Blob([a.data])),h=await this.loadImage(l);return URL.revokeObjectURL(l),h}),this.setState("ready")})}};class yY extends yy{constructor(t){super({...t,state:"loading",url:"pmtiles://"+t.url+"/{z}/{x}/{y}",format:new ZL}),Bb(this,"tileLoadFunction",(e,i)=>{const r=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),n=i.match(r),o=+n[2],a=+n[3],l=+n[4];e.setLoader((h,c,u)=>{e.setState(X.LOADING),this.pmtiles_.getZxy(o,a,l).then(d=>{if(d){const p=e.getFormat();e.setFeatures(p.readFeatures(d.data,{extent:h,featureProjection:u})),e.setState(X.LOADED)}else e.setFeatures([]),e.setState(X.EMPTY)}).catch(d=>{e.setFeatures([]),e.setState(X.ERROR)})})}),this.pmtiles_=new gE(t.url),this.pmtiles_.getHeader().then(e=>{this.tileGrid.minZoom=e.minZoom,this.tileGrid.maxZoom=e.maxZoom,this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}}let UE=null;function xY(){return!!UE}function LF(s){UE=s;const t=Object.keys(s.defs),e=t.length;let i,r;for(i=0;i<e;++i){const n=t[i];if(!ct(n)){const o=s.defs(n);let a=o.units;!a&&o.projName==="longlat"&&(a="degrees"),NA(new Ru({code:n,axisOrientation:o.axis,metersPerUnit:o.to_meter,units:a}))}}for(i=0;i<e;++i){const n=t[i],o=ct(n);for(r=0;r<e;++r){const a=t[r],l=ct(a);if(!AA(n,a))if(s.defs[n]===s.defs[a])rv([o,l]);else{const h=s(n,a);O5(o,l,eC(o,l,h.forward),eC(l,o,h.inverse))}}}}let vY=async function(s){const t=await fetch(`https://epsg.io/${s}.proj4`);if(!t.ok)throw new Error(`Unexpected response from epsg.io: ${t.status}`);return t.text()};async function bY(s){typeof s=="string"&&(s=parseInt(s.split(":").pop(),10));const t=UE;if(!t)throw new Error("Proj4 must be registered first with register(proj4)");const e="EPSG:"+s;return t.defs(e)||(t.defs(e,await vY(s)),LF(t)),ct(e)}const wY=new lr({fill:new da({color:"rgba(255,255,255,0.4)"}),stroke:new fo({color:"#3399CC",width:3})}),EY=new lr({stroke:new fo({color:"#ff9933",width:1})});function SY(s,t){const e={url:s.getAbsoluteUrl()};let i=null;s.getBands().length===1&&(i=0);const{minimum:r,maximum:n}=s.getMinMaxValues(i);typeof r=="number"&&(e.min=r),typeof n=="number"&&(e.max=n);const o=s.getNoDataValues(i);return o.length>0&&(e.nodata=o[0]),t.length>0&&(e.bands=t),e}async function YT(s,t=void 0){let e=t;if(xY()){const i=s.getMetadata("proj:epsg");if(i)try{e=await bY(i)}catch{}}return e}function ZT(s,t){const e=s.clone();return t.hasOnlyBounds()||e.setFill(null),e}function CY(s){let t=s.href;if(t.includes("{s}"))if(Array.isArray(s["href:servers"])&&s["href:servers"].length>0){const e=Math.random()*s["href:servers"].length|0;t=t.replace("{s}",s["href:servers"][e])}else return null;return t}async function TY(s){try{const t=new URL(s);t.searchParams.set("service","wmts"),t.searchParams.set("request","GetCapabilities");const e=await fetch(t);return new fP().read(await e.text())}catch{return null}}let RY=class PF extends GP{constructor(t){const e={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(i=>e[i]=t[i]),super(e),this.getSourceOptions_=t.getSourceOptions,this.data_,this.assets_=null,this.bands_=[],this.crossOrigin_=t.crossOrigin||null,this.displayFootprint_=t.displayFootprint!==!1,this.displayGeoTiffByDefault_=!!t.displayGeoTiffByDefault,this.displayPreview_=!!t.displayPreview,this.displayOverview_=t.displayOverview!==!1,this.displayWebMapLink_=t.displayWebMapLink||!1,this.buildTileUrlTemplate_=t.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=t.useTileLayerAsFallback||!1,this.boundsStyle_=t.boundsStyle||wY,this.collectionStyle_=t.collectionStyle||EY,this.boundsLayer_=null,t.data){try{this.configure_(t.data,t.url,t.assets,t.bands)}catch(i){this.handleError_(i)}return}if(!t.url)throw new Error("Either url or data must be provided");fetch(t.url).then(i=>i.json()).then(i=>this.configure_(i,t.url,t.assets,t.bands)).catch(i=>this.handleError_(i))}getBoundsLayer(){return this.boundsLayer_}handleError_(t){this.dispatchEvent(new CW(t))}configure_(t,e=null,i=null,r=[]){t instanceof cu||t instanceof BE?this.data_=t:this.data_=_Y(t),e&&e.includes("://")&&this.data_.setAbsoluteUrl(e),this.bands_=r,this.boundsLayer_=this.addFootprint_();const n=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(ZT(this.boundsStyle_,this))};this.getLayers().on("add",n),this.getLayers().on("remove",n),this.setAssets(i).then(()=>this.dispatchEvent("assetsready")).catch(o=>this.handleError_(o)),this.dispatchEvent("sourceready")}async addApiCollection_(){const t=this.getData().getAll().map(e=>{const i=new PF({data:e,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_});return this.addLayer_(i),i});return await Promise.all(t)}async addStacAssets_(){let t=this.getAssets();if(t===null){t=[];const i=this.getData().getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);if(i)t.push(i);else{const r=this.getData().getThumbnails();r.length>0&&t.push(r[0])}}const e=t.map(i=>this.addImagery_(i));return await Promise.all(e)}async addImagery_(t){if(t){if(t.isGeoTIFF())return await this.addGeoTiff_(t);if(t.canBrowserDisplayImage())return await this.addThumbnail_(t)}}async addThumbnail_(t){if(!this.displayPreview_)return;let e={url:t.getAbsoluteUrl(),projection:await YT(t,"EPSG:4326"),imageExtent:t.getContext().getBoundingBox(),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(e=await this.getSourceOptions_(_i.ImageStatic,e,t));const i=new lE({source:new tF(e)});return this.addLayer_(i,t),i}async addWebMapLinks_(){const t=this.getWebMapLinks();if(t.length>0)return await this.addLayerForLink(t[0])}async addLayerForLink(t){const e=CY(t);if(!e)return;const i={attributions:t.getMetadata("attribution")||this.data_.getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:e},r=async(o,a)=>(this.getSourceOptions_&&(a=await this.getSourceOptions_(o,a,t)),a),n=[];switch(t.rel){case"pmtiles":const o=await new gE(i.url).getHeader();let a;switch(o.tileType){case Sc.Mvt:a=new yY(await r(_i.PMTilesVector,i));break;case Sc.Avif:case Sc.Jpeg:case Sc.Png:case Sc.Webp:a=new qT(await r(_i.PMTilesRaster,i));break;default:return}n.push(a);break;case"tilejson":n.push(new rF(await r(_i.TileJSON,i)));break;case"wms":if(!Array.isArray(t["wms:layers"]))break;for(const c in t["wms:layers"]){const u=t["wms:layers"][c];let d;Array.isArray(t["wms:styles"])&&typeof t["wms:styles"][c]=="string"&&(d=t["wms:styles"][c]);const p=Object.assign({LAYERS:u,STYLES:d},t["wms:dimensions"]);typeof t["wms:transparent"]=="boolean"&&(p.TRANSPARENT=String(t["wms:transparent"])),typeof t.type=="string"&&t.type.startsWith("image/")&&(p.FORMAT=t.type);const g=await r(_i.TileWMS,Object.assign({},i,{params:p}));n.push(new lF(g))}break;case"wmts":const l=await TY(e);if(!l)return;const h=Array.isArray(t["wmts:layer"])?t["wmts:layer"]:[t["wmts:layer"]];for(const c of h){let u=Object.assign({},i,{layer:c});typeof t.type=="string"&&t.type.startsWith("image/")&&(u.format=t.type),u=await r(_i.WMTS,u),n.push(new hF(qq(l,u)))}break;case"xyz":n.push(new Ah(await r(_i.XYZ,i)));break;default:return}return n.map(o=>{let a;return o instanceof yy?a=new aO({source:o,declutter:!0}):o instanceof qT?a=new $v({source:o}):a=new E0({source:o}),this.addLayer_(a,t),a})}async addGeoTiff_(t){if(!this.displayOverview_)return;if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(t);let e={sources:[SY(t,this.bands_)]};const i=await YT(t);i&&(e.projection=i),this.getSourceOptions_&&(e=await this.getSourceOptions_(_i.GeoTIFF,e,t));const r=async(n,o)=>(o&&this.getLayers().remove(o),await this.addTileLayerForImagery_(n));try{const n=new Sq(e),o=new $v({source:n});if(this.useTileLayerAsFallback_){const a=()=>r(t,o);n.on("error",a),n.on("tileloaderror",a),n.on("change",()=>{n.getState()==="error"&&r(t,o)}),o.on("error",a),await n.getView()}return this.addLayer_(o,t),o}catch(n){if(this.useTileLayerAsFallback_)return await r(t,null);this.handleError_(n)}}async addTileLayerForImagery_(t){let e={crossOrigin:this.crossOrigin_,url:this.buildTileUrlTemplate_(t)};this.getSourceOptions_&&(e=await this.getSourceOptions_(_i.XYZ,e,t));const i=new E0({source:new Ah(e)});return this.addLayer_(i,t),i}addLayer_(t,e,i=0){t.set("stac",e),t.setZIndex(i),this.getLayers().push(t)}addFootprint_(){let t=null;const e=this.getData();if(e.isItemCollection()||e.isCollectionCollection()?t=RF(e.getBoundingBox()):t=e.toGeoJSON(),t){const i=new tL,r=new hy({format:i,loader:(o,a,l)=>{const h=i.readFeatures(t,{featureProjection:l});r.addFeatures(h)}}),n=new qw({source:r,style:ZT(this.boundsStyle_,this),visible:this.displayFootprint_});return n.set("bounds",!0),this.addLayer_(n,e,1),n}return null}async updateLayers_(){const t=this.getLayers();for(let i=t.getLength()-1;i>=0;i--){const r=t.item(i).get("stac");r&&(r.isLink()||r.isAsset())&&t.removeAt(i)}const e=this.getData();e.isItemCollection()||e.isCollectionCollection()?await this.addApiCollection_():(e.isItem()||e.isCollection())&&await this.addStacAssets_(),this.displayWebMapLink_&&this.hasOnlyBounds()&&await this.addWebMapLinks_()}hasOnlyBounds(){const t=this.getBoundsLayer();return typeof this.getLayersArray().find(e=>e!==t)>"u"}getWebMapLinks(){let t=["xyz","tilejson","pmtiles","wmts","wms"];typeof this.displayWebMapLink_=="string"&&(t=[this.displayWebMapLink_]);const e=this.data_.getLinksWithRels(t);return e.sort((i,r)=>{const n=t.indexOf(i.rel),o=t.indexOf(r.rel);return n-o}),e}async setAssets(t){Array.isArray(t)?this.assets_=t.map(e=>typeof e=="string"?this.getData().getAsset(e):e instanceof cu?e:new cu(e)):this.assets_=null,await this.updateLayers_()}getData(){return this.data_}getAssets(){return this.assets_}getExtent(){if(!this.boundsLayer_)return;const t=this.boundsLayer_.getMapInternal();if(!t)return;const e=t.getView();if(!e)return;const i=this.getData();if(!i)return;const r=i.getBoundingBox();if(r)return sw(r,"EPSG:4326",e.getProjection())}};function MY(s){s("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),s("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),s("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),s.WGS84=s["EPSG:4326"],s["EPSG:3785"]=s["EPSG:3857"],s.GOOGLE=s["EPSG:3857"],s["EPSG:900913"]=s["EPSG:3857"],s["EPSG:102113"]=s["EPSG:3857"]}var Lh=1,Ph=2,uu=3,IY=4,Xv=5,KT=6378137,AY=6356752314e-3,JT=.0066943799901413165,xp=484813681109536e-20,et=Math.PI/2,LY=.16666666666666666,PY=.04722222222222222,OY=.022156084656084655,lt=1e-10,Ts=.017453292519943295,ro=57.29577951308232,Ye=Math.PI/4,ag=Math.PI*2,Zi=3.14159265359,Ar={};Ar.greenwich=0;Ar.lisbon=-9.131906111111;Ar.paris=2.337229166667;Ar.bogota=-74.080916666667;Ar.madrid=-3.687938888889;Ar.rome=12.452333333333;Ar.bern=7.439583333333;Ar.jakarta=106.807719444444;Ar.ferro=-17.666666666667;Ar.brussels=4.367975;Ar.stockholm=18.058277777778;Ar.athens=23.7163375;Ar.oslo=10.722916666667;const FY={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var QT=/[\s_\-\/\(\)]/g;function Ml(s,t){if(s[t])return s[t];for(var e=Object.keys(s),i=t.toLowerCase().replace(QT,""),r=-1,n,o;++r<e.length;)if(n=e[r],o=n.toLowerCase().replace(QT,""),o===i)return s[n]}function qv(s){var t={},e=s.split("+").map(function(a){return a.trim()}).filter(function(a){return a}).reduce(function(a,l){var h=l.split("=");return h.push(!0),a[h[0].toLowerCase()]=h[1],a},{}),i,r,n,o={proj:"projName",datum:"datumCode",rf:function(a){t.rf=parseFloat(a)},lat_0:function(a){t.lat0=a*Ts},lat_1:function(a){t.lat1=a*Ts},lat_2:function(a){t.lat2=a*Ts},lat_ts:function(a){t.lat_ts=a*Ts},lon_0:function(a){t.long0=a*Ts},lon_1:function(a){t.long1=a*Ts},lon_2:function(a){t.long2=a*Ts},alpha:function(a){t.alpha=parseFloat(a)*Ts},gamma:function(a){t.rectified_grid_angle=parseFloat(a)},lonc:function(a){t.longc=a*Ts},x_0:function(a){t.x0=parseFloat(a)},y_0:function(a){t.y0=parseFloat(a)},k_0:function(a){t.k0=parseFloat(a)},k:function(a){t.k0=parseFloat(a)},a:function(a){t.a=parseFloat(a)},b:function(a){t.b=parseFloat(a)},r_a:function(){t.R_A=!0},zone:function(a){t.zone=parseInt(a,10)},south:function(){t.utmSouth=!0},towgs84:function(a){t.datum_params=a.split(",").map(function(l){return parseFloat(l)})},to_meter:function(a){t.to_meter=parseFloat(a)},units:function(a){t.units=a;var l=Ml(FY,a);l&&(t.to_meter=l.to_meter)},from_greenwich:function(a){t.from_greenwich=a*Ts},pm:function(a){var l=Ml(Ar,a);t.from_greenwich=(l||parseFloat(a))*Ts},nadgrids:function(a){a==="@null"?t.datumCode="none":t.nadgrids=a},axis:function(a){var l="ewnsud";a.length===3&&l.indexOf(a.substr(0,1))!==-1&&l.indexOf(a.substr(1,1))!==-1&&l.indexOf(a.substr(2,1))!==-1&&(t.axis=a)},approx:function(){t.approx=!0}};for(i in e)r=e[i],i in o?(n=o[i],typeof n=="function"?n(r):t[n]=r):t[i]=r;return typeof t.datumCode=="string"&&t.datumCode!=="WGS84"&&(t.datumCode=t.datumCode.toLowerCase()),t}var lg=1,OF=2,FF=3,L0=4,kF=5,VE=-1,kY=/\s/,NY=/[A-Za-z]/,DY=/[A-Za-z84_]/,vy=/[,\]]/,NF=/[\d\.E\-\+]/;function Ra(s){if(typeof s!="string")throw new Error("not a string");this.text=s.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=lg}Ra.prototype.readCharicter=function(){var s=this.text[this.place++];if(this.state!==L0)for(;kY.test(s);){if(this.place>=this.text.length)return;s=this.text[this.place++]}switch(this.state){case lg:return this.neutral(s);case OF:return this.keyword(s);case L0:return this.quoted(s);case kF:return this.afterquote(s);case FF:return this.number(s);case VE:return}};Ra.prototype.afterquote=function(s){if(s==='"'){this.word+='"',this.state=L0;return}if(vy.test(s)){this.word=this.word.trim(),this.afterItem(s);return}throw new Error(`havn't handled "`+s+'" in afterquote yet, index '+this.place)};Ra.prototype.afterItem=function(s){if(s===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=lg;return}if(s==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=lg,this.currentObject=this.stack.pop(),this.currentObject||(this.state=VE);return}};Ra.prototype.number=function(s){if(NF.test(s)){this.word+=s;return}if(vy.test(s)){this.word=parseFloat(this.word),this.afterItem(s);return}throw new Error(`havn't handled "`+s+'" in number yet, index '+this.place)};Ra.prototype.quoted=function(s){if(s==='"'){this.state=kF;return}this.word+=s};Ra.prototype.keyword=function(s){if(DY.test(s)){this.word+=s;return}if(s==="["){var t=[];t.push(this.word),this.level++,this.root===null?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,this.state=lg;return}if(vy.test(s)){this.afterItem(s);return}throw new Error(`havn't handled "`+s+'" in keyword yet, index '+this.place)};Ra.prototype.neutral=function(s){if(NY.test(s)){this.word=s,this.state=OF;return}if(s==='"'){this.word="",this.state=L0;return}if(NF.test(s)){this.word=s,this.state=FF;return}if(vy.test(s)){this.afterItem(s);return}throw new Error(`havn't handled "`+s+'" in neutral yet, index '+this.place)};Ra.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===VE)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function $Y(s){var t=new Ra(s);return t.output()}function tR(s,t,e){Array.isArray(t)&&(e.unshift(t),t=null);var i=t?{}:s,r=e.reduce(function(n,o){return Yc(o,n),n},i);t&&(s[t]=r)}function Yc(s,t){if(!Array.isArray(s)){t[s]=!0;return}var e=s.shift();if(e==="PARAMETER"&&(e=s.shift()),s.length===1){if(Array.isArray(s[0])){t[e]={},Yc(s[0],t[e]);return}t[e]=s[0];return}if(!s.length){t[e]=!0;return}if(e==="TOWGS84"){t[e]=s;return}if(e==="AXIS"){e in t||(t[e]=[]),t[e].push(s);return}Array.isArray(e)||(t[e]={});var i;switch(e){case"UNIT":case"PRIMEM":case"VERT_DATUM":t[e]={name:s[0].toLowerCase(),convert:s[1]},s.length===3&&Yc(s[2],t[e]);return;case"SPHEROID":case"ELLIPSOID":t[e]={name:s[0],a:s[1],rf:s[2]},s.length===4&&Yc(s[3],t[e]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":s[0]=["name",s[0]],tR(t,e,s);return;default:for(i=-1;++i<s.length;)if(!Array.isArray(s[i]))return Yc(s,t[e]);return tR(t,e,s)}}var jY=.017453292519943295;function GY(s,t){var e=t[0],i=t[1];!(e in s)&&i in s&&(s[e]=s[i],t.length===3&&(s[e]=t[2](s[e])))}function Zn(s){return s*jY}function zY(s){if(s.type==="GEOGCS"?s.projName="longlat":s.type==="LOCAL_CS"?(s.projName="identity",s.local=!0):typeof s.PROJECTION=="object"?s.projName=Object.keys(s.PROJECTION)[0]:s.projName=s.PROJECTION,s.AXIS){for(var t="",e=0,i=s.AXIS.length;e<i;++e){var r=[s.AXIS[e][0].toLowerCase(),s.AXIS[e][1].toLowerCase()];r[0].indexOf("north")!==-1||(r[0]==="y"||r[0]==="lat")&&r[1]==="north"?t+="n":r[0].indexOf("south")!==-1||(r[0]==="y"||r[0]==="lat")&&r[1]==="south"?t+="s":r[0].indexOf("east")!==-1||(r[0]==="x"||r[0]==="lon")&&r[1]==="east"?t+="e":(r[0].indexOf("west")!==-1||(r[0]==="x"||r[0]==="lon")&&r[1]==="west")&&(t+="w")}t.length===2&&(t+="u"),t.length===3&&(s.axis=t)}s.UNIT&&(s.units=s.UNIT.name.toLowerCase(),s.units==="metre"&&(s.units="meter"),s.UNIT.convert&&(s.type==="GEOGCS"?s.DATUM&&s.DATUM.SPHEROID&&(s.to_meter=s.UNIT.convert*s.DATUM.SPHEROID.a):s.to_meter=s.UNIT.convert));var n=s.GEOGCS;s.type==="GEOGCS"&&(n=s),n&&(n.DATUM?s.datumCode=n.DATUM.name.toLowerCase():s.datumCode=n.name.toLowerCase(),s.datumCode.slice(0,2)==="d_"&&(s.datumCode=s.datumCode.slice(2)),(s.datumCode==="new_zealand_geodetic_datum_1949"||s.datumCode==="new_zealand_1949")&&(s.datumCode="nzgd49"),(s.datumCode==="wgs_1984"||s.datumCode==="world_geodetic_system_1984")&&(s.PROJECTION==="Mercator_Auxiliary_Sphere"&&(s.sphere=!0),s.datumCode="wgs84"),s.datumCode.slice(-6)==="_ferro"&&(s.datumCode=s.datumCode.slice(0,-6)),s.datumCode.slice(-8)==="_jakarta"&&(s.datumCode=s.datumCode.slice(0,-8)),~s.datumCode.indexOf("belge")&&(s.datumCode="rnb72"),n.DATUM&&n.DATUM.SPHEROID&&(s.ellps=n.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),s.ellps.toLowerCase().slice(0,13)==="international"&&(s.ellps="intl"),s.a=n.DATUM.SPHEROID.a,s.rf=parseFloat(n.DATUM.SPHEROID.rf,10)),n.DATUM&&n.DATUM.TOWGS84&&(s.datum_params=n.DATUM.TOWGS84),~s.datumCode.indexOf("osgb_1936")&&(s.datumCode="osgb36"),~s.datumCode.indexOf("osni_1952")&&(s.datumCode="osni52"),(~s.datumCode.indexOf("tm65")||~s.datumCode.indexOf("geodetic_datum_of_1965"))&&(s.datumCode="ire65"),s.datumCode==="ch1903+"&&(s.datumCode="ch1903"),~s.datumCode.indexOf("israel")&&(s.datumCode="isr93")),s.b&&!isFinite(s.b)&&(s.b=s.a);function o(h){var c=s.to_meter||1;return h*c}var a=function(h){return GY(s,h)},l=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Zn],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Zn],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",Zn],["lat0","latitude_of_origin",Zn],["lat0","standard_parallel_1",Zn],["lat1","standard_parallel_1",Zn],["lat2","standard_parallel_2",Zn],["azimuth","Azimuth"],["alpha","azimuth",Zn],["srsCode","name"]];l.forEach(a),!s.long0&&s.longc&&(s.projName==="Albers_Conic_Equal_Area"||s.projName==="Lambert_Azimuthal_Equal_Area")&&(s.long0=s.longc),!s.lat_ts&&s.lat1&&(s.projName==="Stereographic_South_Pole"||s.projName==="Polar Stereographic (variant B)")?(s.lat0=Zn(s.lat1>0?90:-90),s.lat_ts=s.lat1):!s.lat_ts&&s.lat0&&s.projName==="Polar_Stereographic"&&(s.lat_ts=s.lat0,s.lat0=Zn(s.lat0>0?90:-90))}function DF(s){var t=$Y(s),e=t.shift(),i=t.shift();t.unshift(["name",i]),t.unshift(["type",e]);var r={};return Yc(t,r),zY(r),r}function ir(s){var t=this;if(arguments.length===2){var e=arguments[1];typeof e=="string"?e.charAt(0)==="+"?ir[s]=qv(arguments[1]):ir[s]=DF(arguments[1]):ir[s]=e}else if(arguments.length===1){if(Array.isArray(s))return s.map(function(i){Array.isArray(i)?ir.apply(t,i):ir(i)});if(typeof s=="string"){if(s in ir)return ir[s]}else"EPSG"in s?ir["EPSG:"+s.EPSG]=s:"ESRI"in s?ir["ESRI:"+s.ESRI]=s:"IAU2000"in s?ir["IAU2000:"+s.IAU2000]=s:console.log(s);return}}MY(ir);function BY(s){return typeof s=="string"}function UY(s){return s in ir}var VY=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function HY(s){return VY.some(function(t){return s.indexOf(t)>-1})}var WY=["3857","900913","3785","102113"];function XY(s){var t=Ml(s,"authority");if(t){var e=Ml(t,"epsg");return e&&WY.indexOf(e)>-1}}function qY(s){var t=Ml(s,"extension");if(t)return Ml(t,"proj4")}function YY(s){return s[0]==="+"}function ZY(s){if(BY(s)){if(UY(s))return ir[s];if(HY(s)){var t=DF(s);if(XY(t))return ir["EPSG:3857"];var e=qY(t);return e?qv(e):t}if(YY(s))return qv(s)}else return s}function eR(s,t){s=s||{};var e,i;if(!t)return s;for(i in t)e=t[i],e!==void 0&&(s[i]=e);return s}function yo(s,t,e){var i=s*t;return e/Math.sqrt(1-i*i)}function of(s){return s<0?-1:1}function gt(s){return Math.abs(s)<=Zi?s:s-of(s)*ag}function Nn(s,t,e){var i=s*e,r=.5*s;return i=Math.pow((1-i)/(1+i),r),Math.tan(.5*(et-t))/i}function hg(s,t){for(var e=.5*s,i,r,n=et-2*Math.atan(t),o=0;o<=15;o++)if(i=s*Math.sin(n),r=et-2*Math.atan(t*Math.pow((1-i)/(1+i),e))-n,n+=r,Math.abs(r)<=1e-10)return n;return-9999}function KY(){var s=this.b/this.a;this.es=1-s*s,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=yo(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function JY(s){var t=s.x,e=s.y;if(e*ro>90&&e*ro<-90&&t*ro>180&&t*ro<-180)return null;var i,r;if(Math.abs(Math.abs(e)-et)<=lt)return null;if(this.sphere)i=this.x0+this.a*this.k0*gt(t-this.long0),r=this.y0+this.a*this.k0*Math.log(Math.tan(Ye+.5*e));else{var n=Math.sin(e),o=Nn(this.e,e,n);i=this.x0+this.a*this.k0*gt(t-this.long0),r=this.y0-this.a*this.k0*Math.log(o)}return s.x=i,s.y=r,s}function QY(s){var t=s.x-this.x0,e=s.y-this.y0,i,r;if(this.sphere)r=et-2*Math.atan(Math.exp(-e/(this.a*this.k0)));else{var n=Math.exp(-e/(this.a*this.k0));if(r=hg(this.e,n),r===-9999)return null}return i=gt(this.long0+t/(this.a*this.k0)),s.x=i,s.y=r,s}var tZ=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const eZ={init:KY,forward:JY,inverse:QY,names:tZ};function iZ(){}function iR(s){return s}var sZ=["longlat","identity"];const rZ={init:iZ,forward:iR,inverse:iR,names:sZ};var nZ=[eZ,rZ],jm={},P0=[];function $F(s,t){var e=P0.length;return s.names?(P0[e]=s,s.names.forEach(function(i){jm[i.toLowerCase()]=e}),this):(console.log(t),!0)}function oZ(s){if(!s)return!1;var t=s.toLowerCase();if(typeof jm[t]<"u"&&P0[jm[t]])return P0[jm[t]]}function aZ(){nZ.forEach($F)}const lZ={start:aZ,add:$F,get:oZ};var te={};te.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};te.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};te.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};te.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};te.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};te.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};te.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};te.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};te.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};te.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};te.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};te.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};te.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};te.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};te.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};te.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};te.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};te.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};te.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};te.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};te.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};te.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};te.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};te.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};te.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};te.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};te.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};te.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};te.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};te.hough={a:6378270,rf:297,ellipseName:"Hough"};te.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};te.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};te.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};te.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};te.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};te.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};te.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};te.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};te.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};te.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};te.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};te.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var hZ=te.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};te.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function cZ(s,t,e,i){var r=s*s,n=t*t,o=(r-n)/r,a=0;i?(s*=1-o*(LY+o*(PY+o*OY)),r=s*s,o=0):a=Math.sqrt(o);var l=(r-n)/n;return{es:o,e:a,ep2:l}}function uZ(s,t,e,i,r){if(!s){var n=Ml(te,i);n||(n=hZ),s=n.a,t=n.b,e=n.rf}return e&&!t&&(t=(1-1/e)*s),(e===0||Math.abs(s-t)<lt)&&(r=!0,t=s),{a:s,b:t,rf:e,sphere:r}}var ps={};ps.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};ps.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};ps.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};ps.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};ps.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};ps.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};ps.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};ps.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};ps.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"};ps.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};ps.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};ps.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};ps.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};ps.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};ps.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};ps.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};ps.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};ps.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function dZ(s,t,e,i,r,n,o){var a={};return s===void 0||s==="none"?a.datum_type=Xv:a.datum_type=IY,t&&(a.datum_params=t.map(parseFloat),(a.datum_params[0]!==0||a.datum_params[1]!==0||a.datum_params[2]!==0)&&(a.datum_type=Lh),a.datum_params.length>3&&(a.datum_params[3]!==0||a.datum_params[4]!==0||a.datum_params[5]!==0||a.datum_params[6]!==0)&&(a.datum_type=Ph,a.datum_params[3]*=xp,a.datum_params[4]*=xp,a.datum_params[5]*=xp,a.datum_params[6]=a.datum_params[6]/1e6+1)),o&&(a.datum_type=uu,a.grids=o),a.a=e,a.b=i,a.es=r,a.ep2=n,a}var jF={};function pZ(s,t){var e=new DataView(t),i=mZ(e),r=_Z(e,i),n=yZ(e,r,i),o={header:r,subgrids:n};return jF[s]=o,o}function gZ(s){if(s===void 0)return null;var t=s.split(",");return t.map(fZ)}function fZ(s){if(s.length===0)return null;var t=s[0]==="@";return t&&(s=s.slice(1)),s==="null"?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:s,mandatory:!t,grid:jF[s]||null,isNull:!1}}function Zc(s){return s/3600*Math.PI/180}function mZ(s){var t=s.getInt32(8,!1);return t===11?!1:(t=s.getInt32(8,!0),t!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function _Z(s,t){return{nFields:s.getInt32(8,t),nSubgridFields:s.getInt32(24,t),nSubgrids:s.getInt32(40,t),shiftType:Yv(s,56,64).trim(),fromSemiMajorAxis:s.getFloat64(120,t),fromSemiMinorAxis:s.getFloat64(136,t),toSemiMajorAxis:s.getFloat64(152,t),toSemiMinorAxis:s.getFloat64(168,t)}}function Yv(s,t,e){return String.fromCharCode.apply(null,new Uint8Array(s.buffer.slice(t,e)))}function yZ(s,t,e){for(var i=176,r=[],n=0;n<t.nSubgrids;n++){var o=vZ(s,i,e),a=bZ(s,i,o,e),l=Math.round(1+(o.upperLongitude-o.lowerLongitude)/o.longitudeInterval),h=Math.round(1+(o.upperLatitude-o.lowerLatitude)/o.latitudeInterval);r.push({ll:[Zc(o.lowerLongitude),Zc(o.lowerLatitude)],del:[Zc(o.longitudeInterval),Zc(o.latitudeInterval)],lim:[l,h],count:o.gridNodeCount,cvs:xZ(a)}),i+=176+o.gridNodeCount*16}return r}function xZ(s){return s.map(function(t){return[Zc(t.longitudeShift),Zc(t.latitudeShift)]})}function vZ(s,t,e){return{name:Yv(s,t+8,t+16).trim(),parent:Yv(s,t+24,t+24+8).trim(),lowerLatitude:s.getFloat64(t+72,e),upperLatitude:s.getFloat64(t+88,e),lowerLongitude:s.getFloat64(t+104,e),upperLongitude:s.getFloat64(t+120,e),latitudeInterval:s.getFloat64(t+136,e),longitudeInterval:s.getFloat64(t+152,e),gridNodeCount:s.getInt32(t+168,e)}}function bZ(s,t,e,i){for(var r=t+176,n=16,o=[],a=0;a<e.gridNodeCount;a++){var l={latitudeShift:s.getFloat32(r+a*n,i),longitudeShift:s.getFloat32(r+a*n+4,i),latitudeAccuracy:s.getFloat32(r+a*n+8,i),longitudeAccuracy:s.getFloat32(r+a*n+12,i)};o.push(l)}return o}function ho(s,t){if(!(this instanceof ho))return new ho(s);t=t||function(h){if(h)throw h};var e=ZY(s);if(typeof e!="object"){t(s);return}var i=ho.projections.get(e.projName);if(!i){t(s);return}if(e.datumCode&&e.datumCode!=="none"){var r=Ml(ps,e.datumCode);r&&(e.datum_params=e.datum_params||(r.towgs84?r.towgs84.split(","):null),e.ellps=r.ellipse,e.datumName=r.datumName?r.datumName:e.datumCode)}e.k0=e.k0||1,e.axis=e.axis||"enu",e.ellps=e.ellps||"wgs84",e.lat1=e.lat1||e.lat0;var n=uZ(e.a,e.b,e.rf,e.ellps,e.sphere),o=cZ(n.a,n.b,n.rf,e.R_A),a=gZ(e.nadgrids),l=e.datum||dZ(e.datumCode,e.datum_params,n.a,n.b,o.es,o.ep2,a);eR(this,e),eR(this,i),this.a=n.a,this.b=n.b,this.rf=n.rf,this.sphere=n.sphere,this.es=o.es,this.e=o.e,this.ep2=o.ep2,this.datum=l,this.init(),t(null,this)}ho.projections=lZ;ho.projections.start();function wZ(s,t){return s.datum_type!==t.datum_type||s.a!==t.a||Math.abs(s.es-t.es)>5e-11?!1:s.datum_type===Lh?s.datum_params[0]===t.datum_params[0]&&s.datum_params[1]===t.datum_params[1]&&s.datum_params[2]===t.datum_params[2]:s.datum_type===Ph?s.datum_params[0]===t.datum_params[0]&&s.datum_params[1]===t.datum_params[1]&&s.datum_params[2]===t.datum_params[2]&&s.datum_params[3]===t.datum_params[3]&&s.datum_params[4]===t.datum_params[4]&&s.datum_params[5]===t.datum_params[5]&&s.datum_params[6]===t.datum_params[6]:!0}function GF(s,t,e){var i=s.x,r=s.y,n=s.z?s.z:0,o,a,l,h;if(r<-et&&r>-1.001*et)r=-et;else if(r>et&&r<1.001*et)r=et;else{if(r<-et)return{x:-1/0,y:-1/0,z:s.z};if(r>et)return{x:1/0,y:1/0,z:s.z}}return i>Math.PI&&(i-=2*Math.PI),a=Math.sin(r),h=Math.cos(r),l=a*a,o=e/Math.sqrt(1-t*l),{x:(o+n)*h*Math.cos(i),y:(o+n)*h*Math.sin(i),z:(o*(1-t)+n)*a}}function zF(s,t,e,i){var r=1e-12,n=r*r,o=30,a,l,h,c,u,d,p,g,f,m,_,y,v,b=s.x,E=s.y,S=s.z?s.z:0,T,R,M;if(a=Math.sqrt(b*b+E*E),l=Math.sqrt(b*b+E*E+S*S),a/e<r){if(T=0,l/e<r)return R=et,M=-i,{x:s.x,y:s.y,z:s.z}}else T=Math.atan2(E,b);h=S/l,c=a/l,u=1/Math.sqrt(1-t*(2-t)*c*c),g=c*(1-t)*u,f=h*u,v=0;do v++,p=e/Math.sqrt(1-t*f*f),M=a*g+S*f-p*(1-t*f*f),d=t*p/(p+M),u=1/Math.sqrt(1-d*(2-d)*c*c),m=c*(1-d)*u,_=h*u,y=_*g-m*f,g=m,f=_;while(y*y>n&&v<o);return R=Math.atan(_/Math.abs(m)),{x:T,y:R,z:M}}function EZ(s,t,e){if(t===Lh)return{x:s.x+e[0],y:s.y+e[1],z:s.z+e[2]};if(t===Ph){var i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],l=e[5],h=e[6];return{x:h*(s.x-l*s.y+a*s.z)+i,y:h*(l*s.x+s.y-o*s.z)+r,z:h*(-a*s.x+o*s.y+s.z)+n}}}function SZ(s,t,e){if(t===Lh)return{x:s.x-e[0],y:s.y-e[1],z:s.z-e[2]};if(t===Ph){var i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],l=e[5],h=e[6],c=(s.x-i)/h,u=(s.y-r)/h,d=(s.z-n)/h;return{x:c+l*u-a*d,y:-l*c+u+o*d,z:a*c-o*u+d}}}function om(s){return s===Lh||s===Ph}function CZ(s,t,e){if(wZ(s,t)||s.datum_type===Xv||t.datum_type===Xv)return e;var i=s.a,r=s.es;if(s.datum_type===uu){var n=sR(s,!1,e);if(n!==0)return;i=KT,r=JT}var o=t.a,a=t.b,l=t.es;if(t.datum_type===uu&&(o=KT,a=AY,l=JT),r===l&&i===o&&!om(s.datum_type)&&!om(t.datum_type))return e;if(e=GF(e,r,i),om(s.datum_type)&&(e=EZ(e,s.datum_type,s.datum_params)),om(t.datum_type)&&(e=SZ(e,t.datum_type,t.datum_params)),e=zF(e,l,o,a),t.datum_type===uu){var h=sR(t,!0,e);if(h!==0)return}return e}function sR(s,t,e){if(s.grids===null||s.grids.length===0)return console.log("Grid shift grids not found"),-1;var i={x:-e.x,y:e.y},r={x:Number.NaN,y:Number.NaN},n=[];t:for(var o=0;o<s.grids.length;o++){var a=s.grids[o];if(n.push(a.name),a.isNull){r=i;break}if(a.mandatory,a.grid===null){if(a.mandatory)return console.log("Unable to find mandatory grid '"+a.name+"'"),-1;continue}for(var l=a.grid.subgrids,h=0,c=l.length;h<c;h++){var u=l[h],d=(Math.abs(u.del[1])+Math.abs(u.del[0]))/1e4,p=u.ll[0]-d,g=u.ll[1]-d,f=u.ll[0]+(u.lim[0]-1)*u.del[0]+d,m=u.ll[1]+(u.lim[1]-1)*u.del[1]+d;if(!(g>i.y||p>i.x||m<i.y||f<i.x)&&(r=TZ(i,t,u),!isNaN(r.x)))break t}}return isNaN(r.x)?(console.log("Failed to find a grid shift table for location '"+-i.x*ro+" "+i.y*ro+" tried: '"+n+"'"),-1):(e.x=-r.x,e.y=r.y,0)}function TZ(s,t,e){var i={x:Number.NaN,y:Number.NaN};if(isNaN(s.x))return i;var r={x:s.x,y:s.y};r.x-=e.ll[0],r.y-=e.ll[1],r.x=gt(r.x-Math.PI)+Math.PI;var n=rR(r,e);if(t){if(isNaN(n.x))return i;n.x=r.x-n.x,n.y=r.y-n.y;var o=9,a=1e-12,l,h;do{if(h=rR(n,e),isNaN(h.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}l={x:r.x-(h.x+n.x),y:r.y-(h.y+n.y)},n.x+=l.x,n.y+=l.y}while(o--&&Math.abs(l.x)>a&&Math.abs(l.y)>a);if(o<0)return console.log("Inverse grid shift iterator failed to converge."),i;i.x=gt(n.x+e.ll[0]),i.y=n.y+e.ll[1]}else isNaN(n.x)||(i.x=s.x+n.x,i.y=s.y+n.y);return i}function rR(s,t){var e={x:s.x/t.del[0],y:s.y/t.del[1]},i={x:Math.floor(e.x),y:Math.floor(e.y)},r={x:e.x-1*i.x,y:e.y-1*i.y},n={x:Number.NaN,y:Number.NaN},o;if(i.x<0||i.x>=t.lim[0]||i.y<0||i.y>=t.lim[1])return n;o=i.y*t.lim[0]+i.x;var a={x:t.cvs[o][0],y:t.cvs[o][1]};o++;var l={x:t.cvs[o][0],y:t.cvs[o][1]};o+=t.lim[0];var h={x:t.cvs[o][0],y:t.cvs[o][1]};o--;var c={x:t.cvs[o][0],y:t.cvs[o][1]},u=r.x*r.y,d=r.x*(1-r.y),p=(1-r.x)*(1-r.y),g=(1-r.x)*r.y;return n.x=p*a.x+d*l.x+g*c.x+u*h.x,n.y=p*a.y+d*l.y+g*c.y+u*h.y,n}function nR(s,t,e){var i=e.x,r=e.y,n=e.z||0,o,a,l,h={};for(l=0;l<3;l++)if(!(t&&l===2&&e.z===void 0))switch(l===0?(o=i,"ew".indexOf(s.axis[l])!==-1?a="x":a="y"):l===1?(o=r,"ns".indexOf(s.axis[l])!==-1?a="y":a="x"):(o=n,a="z"),s.axis[l]){case"e":h[a]=o;break;case"w":h[a]=-o;break;case"n":h[a]=o;break;case"s":h[a]=-o;break;case"u":e[a]!==void 0&&(h.z=o);break;case"d":e[a]!==void 0&&(h.z=-o);break;default:return null}return h}function BF(s){var t={x:s[0],y:s[1]};return s.length>2&&(t.z=s[2]),s.length>3&&(t.m=s[3]),t}function RZ(s){oR(s.x),oR(s.y)}function oR(s){if(typeof Number.isFinite=="function"){if(Number.isFinite(s))return;throw new TypeError("coordinates must be finite numbers")}if(typeof s!="number"||s!==s||!isFinite(s))throw new TypeError("coordinates must be finite numbers")}function MZ(s,t){return(s.datum.datum_type===Lh||s.datum.datum_type===Ph||s.datum.datum_type===uu)&&t.datumCode!=="WGS84"||(t.datum.datum_type===Lh||t.datum.datum_type===Ph||t.datum.datum_type===uu)&&s.datumCode!=="WGS84"}function O0(s,t,e,i){var r;Array.isArray(e)?e=BF(e):e={x:e.x,y:e.y,z:e.z,m:e.m};var n=e.z!==void 0;if(RZ(e),s.datum&&t.datum&&MZ(s,t)&&(r=new ho("WGS84"),e=O0(s,r,e,i),s=r),i&&s.axis!=="enu"&&(e=nR(s,!1,e)),s.projName==="longlat")e={x:e.x*Ts,y:e.y*Ts,z:e.z||0};else if(s.to_meter&&(e={x:e.x*s.to_meter,y:e.y*s.to_meter,z:e.z||0}),e=s.inverse(e),!e)return;if(s.from_greenwich&&(e.x+=s.from_greenwich),e=CZ(s.datum,t.datum,e),!!e)return t.from_greenwich&&(e={x:e.x-t.from_greenwich,y:e.y,z:e.z||0}),t.projName==="longlat"?e={x:e.x*ro,y:e.y*ro,z:e.z||0}:(e=t.forward(e),t.to_meter&&(e={x:e.x/t.to_meter,y:e.y/t.to_meter,z:e.z||0})),i&&t.axis!=="enu"?nR(t,!0,e):(e&&!n&&delete e.z,e)}var aR=ho("WGS84");function ix(s,t,e,i){var r,n,o;return Array.isArray(e)?(r=O0(s,t,e,i)||{x:NaN,y:NaN},e.length>2?typeof s.name<"u"&&s.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"?typeof r.z=="number"?[r.x,r.y,r.z].concat(e.splice(3)):[r.x,r.y,e[2]].concat(e.splice(3)):[r.x,r.y].concat(e.splice(2)):[r.x,r.y]):(n=O0(s,t,e,i),o=Object.keys(e),o.length===2||o.forEach(function(a){if(typeof s.name<"u"&&s.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"){if(a==="x"||a==="y"||a==="z")return}else if(a==="x"||a==="y")return;n[a]=e[a]}),n)}function lR(s){return s instanceof ho?s:s.oProj?s.oProj:ho(s)}function qr(s,t,e){s=lR(s);var i=!1,r;return typeof t>"u"?(t=s,s=aR,i=!0):(typeof t.x<"u"||Array.isArray(t))&&(e=t,t=s,s=aR,i=!0),t=lR(t),e?ix(s,t,e):(r={forward:function(n,o){return ix(s,t,n,o)},inverse:function(n,o){return ix(t,s,n,o)}},i&&(r.oProj=t),r)}var hR=6,UF="AJSAJS",VF="AFAFAF",Kc=65,mr=73,Qr=79,ep=86,ip=90;const IZ={forward:HF,inverse:AZ,toPoint:WF};function HF(s,t){return t=t||5,OZ(LZ({lat:s[1],lon:s[0]}),t)}function AZ(s){var t=HE(qF(s.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]}function WF(s){var t=HE(qF(s.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function sx(s){return s*(Math.PI/180)}function cR(s){return 180*(s/Math.PI)}function LZ(s){var t=s.lat,e=s.lon,i=6378137,r=.00669438,n=.9996,o,a,l,h,c,u,d,p=sx(t),g=sx(e),f,m;m=Math.floor((e+180)/6)+1,e===180&&(m=60),t>=56&&t<64&&e>=3&&e<12&&(m=32),t>=72&&t<84&&(e>=0&&e<9?m=31:e>=9&&e<21?m=33:e>=21&&e<33?m=35:e>=33&&e<42&&(m=37)),o=(m-1)*6-180+3,f=sx(o),a=r/(1-r),l=i/Math.sqrt(1-r*Math.sin(p)*Math.sin(p)),h=Math.tan(p)*Math.tan(p),c=a*Math.cos(p)*Math.cos(p),u=Math.cos(p)*(g-f),d=i*((1-r/4-3*r*r/64-5*r*r*r/256)*p-(3*r/8+3*r*r/32+45*r*r*r/1024)*Math.sin(2*p)+(15*r*r/256+45*r*r*r/1024)*Math.sin(4*p)-35*r*r*r/3072*Math.sin(6*p));var _=n*l*(u+(1-h+c)*u*u*u/6+(5-18*h+h*h+72*c-58*a)*u*u*u*u*u/120)+5e5,y=n*(d+l*Math.tan(p)*(u*u/2+(5-h+9*c+4*c*c)*u*u*u*u/24+(61-58*h+h*h+600*c-330*a)*u*u*u*u*u*u/720));return t<0&&(y+=1e7),{northing:Math.round(y),easting:Math.round(_),zoneNumber:m,zoneLetter:PZ(t)}}function HE(s){var t=s.northing,e=s.easting,i=s.zoneLetter,r=s.zoneNumber;if(r<0||r>60)return null;var n=.9996,o=6378137,a=.00669438,l,h=(1-Math.sqrt(1-a))/(1+Math.sqrt(1-a)),c,u,d,p,g,f,m,_,y,v=e-5e5,b=t;i<"N"&&(b-=1e7),m=(r-1)*6-180+3,l=a/(1-a),f=b/n,_=f/(o*(1-a/4-3*a*a/64-5*a*a*a/256)),y=_+(3*h/2-27*h*h*h/32)*Math.sin(2*_)+(21*h*h/16-55*h*h*h*h/32)*Math.sin(4*_)+151*h*h*h/96*Math.sin(6*_),c=o/Math.sqrt(1-a*Math.sin(y)*Math.sin(y)),u=Math.tan(y)*Math.tan(y),d=l*Math.cos(y)*Math.cos(y),p=o*(1-a)/Math.pow(1-a*Math.sin(y)*Math.sin(y),1.5),g=v/(c*n);var E=y-c*Math.tan(y)/p*(g*g/2-(5+3*u+10*d-4*d*d-9*l)*g*g*g*g/24+(61+90*u+298*d+45*u*u-252*l-3*d*d)*g*g*g*g*g*g/720);E=cR(E);var S=(g-(1+2*u+d)*g*g*g/6+(5-2*d+28*u-3*d*d+8*l+24*u*u)*g*g*g*g*g/120)/Math.cos(y);S=m+cR(S);var T;if(s.accuracy){var R=HE({northing:s.northing+s.accuracy,easting:s.easting+s.accuracy,zoneLetter:s.zoneLetter,zoneNumber:s.zoneNumber});T={top:R.lat,right:R.lon,bottom:E,left:S}}else T={lat:E,lon:S};return T}function PZ(s){var t="Z";return 84>=s&&s>=72?t="X":72>s&&s>=64?t="W":64>s&&s>=56?t="V":56>s&&s>=48?t="U":48>s&&s>=40?t="T":40>s&&s>=32?t="S":32>s&&s>=24?t="R":24>s&&s>=16?t="Q":16>s&&s>=8?t="P":8>s&&s>=0?t="N":0>s&&s>=-8?t="M":-8>s&&s>=-16?t="L":-16>s&&s>=-24?t="K":-24>s&&s>=-32?t="J":-32>s&&s>=-40?t="H":-40>s&&s>=-48?t="G":-48>s&&s>=-56?t="F":-56>s&&s>=-64?t="E":-64>s&&s>=-72?t="D":-72>s&&s>=-80&&(t="C"),t}function OZ(s,t){var e="00000"+s.easting,i="00000"+s.northing;return s.zoneNumber+s.zoneLetter+FZ(s.easting,s.northing,s.zoneNumber)+e.substr(e.length-5,t)+i.substr(i.length-5,t)}function FZ(s,t,e){var i=XF(e),r=Math.floor(s/1e5),n=Math.floor(t/1e5)%20;return kZ(r,n,i)}function XF(s){var t=s%hR;return t===0&&(t=hR),t}function kZ(s,t,e){var i=e-1,r=UF.charCodeAt(i),n=VF.charCodeAt(i),o=r+s-1,a=n+t,l=!1;o>ip&&(o=o-ip+Kc-1,l=!0),(o===mr||r<mr&&o>mr||(o>mr||r<mr)&&l)&&o++,(o===Qr||r<Qr&&o>Qr||(o>Qr||r<Qr)&&l)&&(o++,o===mr&&o++),o>ip&&(o=o-ip+Kc-1),a>ep?(a=a-ep+Kc-1,l=!0):l=!1,(a===mr||n<mr&&a>mr||(a>mr||n<mr)&&l)&&a++,(a===Qr||n<Qr&&a>Qr||(a>Qr||n<Qr)&&l)&&(a++,a===mr&&a++),a>ep&&(a=a-ep+Kc-1);var h=String.fromCharCode(o)+String.fromCharCode(a);return h}function qF(s){if(s&&s.length===0)throw"MGRSPoint coverting from nothing";for(var t=s.length,e=null,i="",r,n=0;!/[A-Z]/.test(r=s.charAt(n));){if(n>=2)throw"MGRSPoint bad conversion from: "+s;i+=r,n++}var o=parseInt(i,10);if(n===0||n+3>t)throw"MGRSPoint bad conversion from: "+s;var a=s.charAt(n++);if(a<="A"||a==="B"||a==="Y"||a>="Z"||a==="I"||a==="O")throw"MGRSPoint zone letter "+a+" not handled: "+s;e=s.substring(n,n+=2);for(var l=XF(o),h=NZ(e.charAt(0),l),c=DZ(e.charAt(1),l);c<$Z(a);)c+=2e6;var u=t-n;if(u%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+s;var d=u/2,p=0,g=0,f,m,_,y,v;return d>0&&(f=1e5/Math.pow(10,d),m=s.substring(n,n+d),p=parseFloat(m)*f,_=s.substring(n+d),g=parseFloat(_)*f),y=p+h,v=g+c,{easting:y,northing:v,zoneLetter:a,zoneNumber:o,accuracy:f}}function NZ(s,t){for(var e=UF.charCodeAt(t-1),i=1e5,r=!1;e!==s.charCodeAt(0);){if(e++,e===mr&&e++,e===Qr&&e++,e>ip){if(r)throw"Bad character: "+s;e=Kc,r=!0}i+=1e5}return i}function DZ(s,t){if(s>"V")throw"MGRSPoint given invalid Northing "+s;for(var e=VF.charCodeAt(t-1),i=0,r=!1;e!==s.charCodeAt(0);){if(e++,e===mr&&e++,e===Qr&&e++,e>ep){if(r)throw"Bad character: "+s;e=Kc,r=!0}i+=1e5}return i}function $Z(s){var t;switch(s){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+s}function Fu(s,t,e){if(!(this instanceof Fu))return new Fu(s,t,e);if(Array.isArray(s))this.x=s[0],this.y=s[1],this.z=s[2]||0;else if(typeof s=="object")this.x=s.x,this.y=s.y,this.z=s.z||0;else if(typeof s=="string"&&typeof t>"u"){var i=s.split(",");this.x=parseFloat(i[0],10),this.y=parseFloat(i[1],10),this.z=parseFloat(i[2],10)||0}else this.x=s,this.y=t,this.z=e||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Fu.fromMGRS=function(s){return new Fu(WF(s))};Fu.prototype.toMGRS=function(s){return HF([this.x,this.y],s)};var jZ=1,GZ=.25,uR=.046875,dR=.01953125,pR=.01068115234375,zZ=.75,BZ=.46875,UZ=.013020833333333334,VZ=.007120768229166667,HZ=.3645833333333333,WZ=.005696614583333333,XZ=.3076171875;function YF(s){var t=[];t[0]=jZ-s*(GZ+s*(uR+s*(dR+s*pR))),t[1]=s*(zZ-s*(uR+s*(dR+s*pR)));var e=s*s;return t[2]=e*(BZ-s*(UZ+s*VZ)),e*=s,t[3]=e*(HZ-s*WZ),t[4]=e*s*XZ,t}function by(s,t,e,i){return e*=t,t*=t,i[0]*s-e*(i[1]+t*(i[2]+t*(i[3]+t*i[4])))}var qZ=20;function ZF(s,t,e){for(var i=1/(1-t),r=s,n=qZ;n;--n){var o=Math.sin(r),a=1-t*o*o;if(a=(by(r,o,Math.cos(r),e)-s)*(a*Math.sqrt(a))*i,r-=a,Math.abs(a)<lt)return r}return r}function YZ(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=YF(this.es),this.ml0=by(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function ZZ(s){var t=s.x,e=s.y,i=gt(t-this.long0),r,n,o,a=Math.sin(e),l=Math.cos(e);if(this.es){var h=l*i,c=Math.pow(h,2),u=this.ep2*Math.pow(l,2),d=Math.pow(u,2),p=Math.abs(l)>lt?Math.tan(e):0,g=Math.pow(p,2),f=Math.pow(g,2);r=1-this.es*Math.pow(a,2),h=h/Math.sqrt(r);var m=by(e,a,l,this.en);n=this.a*(this.k0*h*(1+c/6*(1-g+u+c/20*(5-18*g+f+14*u-58*g*u+c/42*(61+179*f-f*g-479*g)))))+this.x0,o=this.a*(this.k0*(m-this.ml0+a*i*h/2*(1+c/12*(5-g+9*u+4*d+c/30*(61+f-58*g+270*u-330*g*u+c/56*(1385+543*f-f*g-3111*g))))))+this.y0}else{var _=l*Math.sin(i);if(Math.abs(Math.abs(_)-1)<lt)return 93;if(n=.5*this.a*this.k0*Math.log((1+_)/(1-_))+this.x0,o=l*Math.cos(i)/Math.sqrt(1-Math.pow(_,2)),_=Math.abs(o),_>=1){if(_-1>lt)return 93;o=0}else o=Math.acos(o);e<0&&(o=-o),o=this.a*this.k0*(o-this.lat0)+this.y0}return s.x=n,s.y=o,s}function KZ(s){var t,e,i,r,n=(s.x-this.x0)*(1/this.a),o=(s.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+o/this.k0,e=ZF(t,this.es,this.en),Math.abs(e)<et){var a=Math.sin(e),l=Math.cos(e),h=Math.abs(l)>lt?Math.tan(e):0,c=this.ep2*Math.pow(l,2),u=Math.pow(c,2),d=Math.pow(h,2),p=Math.pow(d,2);t=1-this.es*Math.pow(a,2);var g=n*Math.sqrt(t)/this.k0,f=Math.pow(g,2);t=t*h,i=e-t*f/(1-this.es)*.5*(1-f/12*(5+3*d-9*c*d+c-4*u-f/30*(61+90*d-252*c*d+45*p+46*c-f/56*(1385+3633*d+4095*p+1574*p*d)))),r=gt(this.long0+g*(1-f/6*(1+2*d+c-f/20*(5+28*d+24*p+8*c*d+6*c-f/42*(61+662*d+1320*p+720*p*d))))/l)}else i=et*of(o),r=0;else{var m=Math.exp(n/this.k0),_=.5*(m-1/m),y=this.lat0+o/this.k0,v=Math.cos(y);t=Math.sqrt((1-Math.pow(v,2))/(1+Math.pow(_,2))),i=Math.asin(t),o<0&&(i=-i),_===0&&v===0?r=0:r=gt(Math.atan2(_,v)+this.long0)}return s.x=r,s.y=i,s}var JZ=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const Gm={init:YZ,forward:ZZ,inverse:KZ,names:JZ};function KF(s){var t=Math.exp(s);return t=(t-1/t)/2,t}function sn(s,t){s=Math.abs(s),t=Math.abs(t);var e=Math.max(s,t),i=Math.min(s,t)/(e||1);return e*Math.sqrt(1+Math.pow(i,2))}function QZ(s){var t=1+s,e=t-1;return e===0?s:s*Math.log(t)/e}function tK(s){var t=Math.abs(s);return t=QZ(t*(1+t/(sn(1,t)+1))),s<0?-t:t}function WE(s,t){for(var e=2*Math.cos(2*t),i=s.length-1,r=s[i],n=0,o;--i>=0;)o=-n+e*r+s[i],n=r,r=o;return t+o*Math.sin(2*t)}function eK(s,t){for(var e=2*Math.cos(t),i=s.length-1,r=s[i],n=0,o;--i>=0;)o=-n+e*r+s[i],n=r,r=o;return Math.sin(t)*o}function iK(s){var t=Math.exp(s);return t=(t+1/t)/2,t}function JF(s,t,e){for(var i=Math.sin(t),r=Math.cos(t),n=KF(e),o=iK(e),a=2*r*o,l=-2*i*n,h=s.length-1,c=s[h],u=0,d=0,p=0,g,f;--h>=0;)g=d,f=u,d=c,u=p,c=-g+a*d-l*u+s[h],p=-f+l*d+a*u;return a=i*o,l=r*n,[a*c-l*p,a*p+l*c]}function sK(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Gm.init.apply(this),this.forward=Gm.forward,this.inverse=Gm.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var s=this.es/(1+Math.sqrt(1-this.es)),t=s/(2-s),e=t;this.cgb[0]=t*(2+t*(-2/3+t*(-2+t*(116/45+t*(26/45+t*(-2854/675)))))),this.cbg[0]=t*(-2+t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))),e=e*t,this.cgb[1]=e*(7/3+t*(-8/5+t*(-227/45+t*(2704/315+t*(2323/945))))),this.cbg[1]=e*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),e=e*t,this.cgb[2]=e*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=e*(-26/15+t*(34/21+t*(8/5+t*(-12686/2835)))),e=e*t,this.cgb[3]=e*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=e*(1237/630+t*(-12/5+t*(-24832/14175))),e=e*t,this.cgb[4]=e*(4174/315+t*(-144838/6237)),this.cbg[4]=e*(-734/315+t*(109598/31185)),e=e*t,this.cgb[5]=e*(601676/22275),this.cbg[5]=e*(444337/155925),e=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+e*(1/4+e*(1/64+e/256))),this.utg[0]=t*(-.5+t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=e*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=e*(13/48+t*(-3/5+t*(557/1440+t*(281/630+t*(-1983433/1935360))))),e=e*t,this.utg[2]=e*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=e*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),e=e*t,this.utg[3]=e*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=e*(49561/161280+t*(-179/168+t*(6601661/7257600))),e=e*t,this.utg[4]=e*(-4583/161280+t*(108847/3991680)),this.gtu[4]=e*(34729/80640+t*(-3418889/1995840)),e=e*t,this.utg[5]=e*(-20648693/638668800),this.gtu[5]=e*(212378941/319334400);var i=WE(this.cbg,this.lat0);this.Zb=-this.Qn*(i+eK(this.gtu,2*i))}function rK(s){var t=gt(s.x-this.long0),e=s.y;e=WE(this.cbg,e);var i=Math.sin(e),r=Math.cos(e),n=Math.sin(t),o=Math.cos(t);e=Math.atan2(i,o*r),t=Math.atan2(n*r,sn(i,r*o)),t=tK(Math.tan(t));var a=JF(this.gtu,2*e,2*t);e=e+a[0],t=t+a[1];var l,h;return Math.abs(t)<=2.623395162778?(l=this.a*(this.Qn*t)+this.x0,h=this.a*(this.Qn*e+this.Zb)+this.y0):(l=1/0,h=1/0),s.x=l,s.y=h,s}function nK(s){var t=(s.x-this.x0)*(1/this.a),e=(s.y-this.y0)*(1/this.a);e=(e-this.Zb)/this.Qn,t=t/this.Qn;var i,r;if(Math.abs(t)<=2.623395162778){var n=JF(this.utg,2*e,2*t);e=e+n[0],t=t+n[1],t=Math.atan(KF(t));var o=Math.sin(e),a=Math.cos(e),l=Math.sin(t),h=Math.cos(t);e=Math.atan2(o*h,sn(l,h*a)),t=Math.atan2(l,h*a),i=gt(t+this.long0),r=WE(this.cgb,e)}else i=1/0,r=1/0;return s.x=i,s.y=r,s}var oK=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const zm={init:sK,forward:rK,inverse:nK,names:oK};function aK(s,t){if(s===void 0){if(s=Math.floor((gt(t)+Math.PI)*30/Math.PI)+1,s<0)return 0;if(s>60)return 60}return s}var lK="etmerc";function hK(){var s=aK(this.zone,this.long0);if(s===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(s)-183)*Ts,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,zm.init.apply(this),this.forward=zm.forward,this.inverse=zm.inverse}var cK=["Universal Transverse Mercator System","utm"];const uK={init:hK,names:cK,dependsOn:lK};function XE(s,t){return Math.pow((1-s)/(1+s),t)}var dK=20;function pK(){var s=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*s*s),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(s/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Ye)/(Math.pow(Math.tan(.5*this.lat0+Ye),this.C)*XE(this.e*s,this.ratexp))}function gK(s){var t=s.x,e=s.y;return s.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*e+Ye),this.C)*XE(this.e*Math.sin(e),this.ratexp))-et,s.x=this.C*t,s}function fK(s){for(var t=1e-14,e=s.x/this.C,i=s.y,r=Math.pow(Math.tan(.5*i+Ye)/this.K,1/this.C),n=dK;n>0&&(i=2*Math.atan(r*XE(this.e*Math.sin(s.y),-.5*this.e))-et,!(Math.abs(i-s.y)<t));--n)s.y=i;return n?(s.x=e,s.y=i,s):null}var mK=["gauss"];const qE={init:pK,forward:gK,inverse:fK,names:mK};function _K(){qE.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function yK(s){var t,e,i,r;return s.x=gt(s.x-this.long0),qE.forward.apply(this,[s]),t=Math.sin(s.y),e=Math.cos(s.y),i=Math.cos(s.x),r=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*e*i),s.x=r*e*Math.sin(s.x),s.y=r*(this.cosc0*t-this.sinc0*e*i),s.x=this.a*s.x+this.x0,s.y=this.a*s.y+this.y0,s}function xK(s){var t,e,i,r,n;if(s.x=(s.x-this.x0)/this.a,s.y=(s.y-this.y0)/this.a,s.x/=this.k0,s.y/=this.k0,n=sn(s.x,s.y)){var o=2*Math.atan2(n,this.R2);t=Math.sin(o),e=Math.cos(o),r=Math.asin(e*this.sinc0+s.y*t*this.cosc0/n),i=Math.atan2(s.x*t,n*this.cosc0*e-s.y*this.sinc0*t)}else r=this.phic0,i=0;return s.x=i,s.y=r,qE.inverse.apply(this,[s]),s.x=gt(s.x+this.long0),s}var vK=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const bK={init:_K,forward:yK,inverse:xK,names:vK};function wK(s,t,e){return t*=e,Math.tan(.5*(et+s))*Math.pow((1-t)/(1+t),.5*e)}function EK(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=lt&&(this.k0=.5*(1+of(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=lt&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=lt&&Math.abs(Math.cos(this.lat_ts))>lt&&(this.k0=.5*this.cons*yo(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Nn(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=yo(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-et,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function SK(s){var t=s.x,e=s.y,i=Math.sin(e),r=Math.cos(e),n,o,a,l,h,c,u=gt(t-this.long0);return Math.abs(Math.abs(t-this.long0)-Math.PI)<=lt&&Math.abs(e+this.lat0)<=lt?(s.x=NaN,s.y=NaN,s):this.sphere?(n=2*this.k0/(1+this.sinlat0*i+this.coslat0*r*Math.cos(u)),s.x=this.a*n*r*Math.sin(u)+this.x0,s.y=this.a*n*(this.coslat0*i-this.sinlat0*r*Math.cos(u))+this.y0,s):(o=2*Math.atan(this.ssfn_(e,i,this.e))-et,l=Math.cos(o),a=Math.sin(o),Math.abs(this.coslat0)<=lt?(h=Nn(this.e,e*this.con,this.con*i),c=2*this.a*this.k0*h/this.cons,s.x=this.x0+c*Math.sin(t-this.long0),s.y=this.y0-this.con*c*Math.cos(t-this.long0),s):(Math.abs(this.sinlat0)<lt?(n=2*this.a*this.k0/(1+l*Math.cos(u)),s.y=n*a):(n=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*a+this.cosX0*l*Math.cos(u))),s.y=n*(this.cosX0*a-this.sinX0*l*Math.cos(u))+this.y0),s.x=n*l*Math.sin(u)+this.x0,s))}function CK(s){s.x-=this.x0,s.y-=this.y0;var t,e,i,r,n,o=Math.sqrt(s.x*s.x+s.y*s.y);if(this.sphere){var a=2*Math.atan(o/(2*this.a*this.k0));return t=this.long0,e=this.lat0,o<=lt?(s.x=t,s.y=e,s):(e=Math.asin(Math.cos(a)*this.sinlat0+s.y*Math.sin(a)*this.coslat0/o),Math.abs(this.coslat0)<lt?this.lat0>0?t=gt(this.long0+Math.atan2(s.x,-1*s.y)):t=gt(this.long0+Math.atan2(s.x,s.y)):t=gt(this.long0+Math.atan2(s.x*Math.sin(a),o*this.coslat0*Math.cos(a)-s.y*this.sinlat0*Math.sin(a))),s.x=t,s.y=e,s)}else if(Math.abs(this.coslat0)<=lt){if(o<=lt)return e=this.lat0,t=this.long0,s.x=t,s.y=e,s;s.x*=this.con,s.y*=this.con,i=o*this.cons/(2*this.a*this.k0),e=this.con*hg(this.e,i),t=this.con*gt(this.con*this.long0+Math.atan2(s.x,-1*s.y))}else r=2*Math.atan(o*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,o<=lt?n=this.X0:(n=Math.asin(Math.cos(r)*this.sinX0+s.y*Math.sin(r)*this.cosX0/o),t=gt(this.long0+Math.atan2(s.x*Math.sin(r),o*this.cosX0*Math.cos(r)-s.y*this.sinX0*Math.sin(r)))),e=-1*hg(this.e,Math.tan(.5*(et+n)));return s.x=t,s.y=e,s}var TK=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const RK={init:EK,forward:SK,inverse:CK,names:TK,ssfn_:wK};function MK(){var s=this.lat0;this.lambda0=this.long0;var t=Math.sin(s),e=this.a,i=this.rf,r=1/i,n=2*r-Math.pow(r,2),o=this.e=Math.sqrt(n);this.R=this.k0*e*Math.sqrt(1-n)/(1-n*Math.pow(t,2)),this.alpha=Math.sqrt(1+n/(1-n)*Math.pow(Math.cos(s),4)),this.b0=Math.asin(t/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),l=Math.log(Math.tan(Math.PI/4+s/2)),h=Math.log((1+o*t)/(1-o*t));this.K=a-this.alpha*l+this.alpha*o/2*h}function IK(s){var t=Math.log(Math.tan(Math.PI/4-s.y/2)),e=this.e/2*Math.log((1+this.e*Math.sin(s.y))/(1-this.e*Math.sin(s.y))),i=-this.alpha*(t+e)+this.K,r=2*(Math.atan(Math.exp(i))-Math.PI/4),n=this.alpha*(s.x-this.lambda0),o=Math.atan(Math.sin(n)/(Math.sin(this.b0)*Math.tan(r)+Math.cos(this.b0)*Math.cos(n))),a=Math.asin(Math.cos(this.b0)*Math.sin(r)-Math.sin(this.b0)*Math.cos(r)*Math.cos(n));return s.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,s.x=this.R*o+this.x0,s}function AK(s){for(var t=s.x-this.x0,e=s.y-this.y0,i=t/this.R,r=2*(Math.atan(Math.exp(e/this.R))-Math.PI/4),n=Math.asin(Math.cos(this.b0)*Math.sin(r)+Math.sin(this.b0)*Math.cos(r)*Math.cos(i)),o=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(r))),a=this.lambda0+o/this.alpha,l=0,h=n,c=-1e3,u=0;Math.abs(h-c)>1e-7;){if(++u>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+n/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),c=h,h=2*Math.atan(Math.exp(l))-Math.PI/2}return s.x=a,s.y=h,s}var LK=["somerc"];const PK={init:MK,forward:IK,inverse:AK,names:LK};var Tc=1e-7;function OK(s){var t=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],e=typeof s.PROJECTION=="object"?Object.keys(s.PROJECTION)[0]:s.PROJECTION;return"no_uoff"in s||"no_off"in s||t.indexOf(e)!==-1}function FK(){var s,t,e,i,r,n,o,a,l,h,c=0,u,d=0,p=0,g=0,f=0,m=0,_=0;this.no_off=OK(this),this.no_rot="no_rot"in this;var y=!1;"alpha"in this&&(y=!0);var v=!1;if("rectified_grid_angle"in this&&(v=!0),y&&(_=this.alpha),v&&(c=this.rectified_grid_angle*Ts),y||v)d=this.longc;else if(p=this.long1,f=this.lat1,g=this.long2,m=this.lat2,Math.abs(f-m)<=Tc||(s=Math.abs(f))<=Tc||Math.abs(s-et)<=Tc||Math.abs(Math.abs(this.lat0)-et)<=Tc||Math.abs(Math.abs(m)-et)<=Tc)throw new Error;var b=1-this.es;t=Math.sqrt(b),Math.abs(this.lat0)>lt?(a=Math.sin(this.lat0),e=Math.cos(this.lat0),s=1-this.es*a*a,this.B=e*e,this.B=Math.sqrt(1+this.es*this.B*this.B/b),this.A=this.B*this.k0*t/s,i=this.B*t/(e*Math.sqrt(s)),r=i*i-1,r<=0?r=0:(r=Math.sqrt(r),this.lat0<0&&(r=-r)),this.E=r+=i,this.E*=Math.pow(Nn(this.e,this.lat0,a),this.B)):(this.B=1/t,this.A=this.k0,this.E=i=r=1),y||v?(y?(u=Math.asin(Math.sin(_)/i),v||(c=_)):(u=c,_=Math.asin(i*Math.sin(u))),this.lam0=d-Math.asin(.5*(r-1/r)*Math.tan(u))/this.B):(n=Math.pow(Nn(this.e,f,Math.sin(f)),this.B),o=Math.pow(Nn(this.e,m,Math.sin(m)),this.B),r=this.E/n,l=(o-n)/(o+n),h=this.E*this.E,h=(h-o*n)/(h+o*n),s=p-g,s<-Math.pi?g-=ag:s>Math.pi&&(g+=ag),this.lam0=gt(.5*(p+g)-Math.atan(h*Math.tan(.5*this.B*(p-g))/l)/this.B),u=Math.atan(2*Math.sin(this.B*gt(p-this.lam0))/(r-1/r)),c=_=Math.asin(i*Math.sin(u))),this.singam=Math.sin(u),this.cosgam=Math.cos(u),this.sinrot=Math.sin(c),this.cosrot=Math.cos(c),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(i*i-1)/Math.cos(_))),this.lat0<0&&(this.u_0=-this.u_0)),r=.5*u,this.v_pole_n=this.ArB*Math.log(Math.tan(Ye-r)),this.v_pole_s=this.ArB*Math.log(Math.tan(Ye+r))}function kK(s){var t={},e,i,r,n,o,a,l,h;if(s.x=s.x-this.lam0,Math.abs(Math.abs(s.y)-et)>lt){if(o=this.E/Math.pow(Nn(this.e,s.y,Math.sin(s.y)),this.B),a=1/o,e=.5*(o-a),i=.5*(o+a),n=Math.sin(this.B*s.x),r=(e*this.singam-n*this.cosgam)/i,Math.abs(Math.abs(r)-1)<lt)throw new Error;h=.5*this.ArB*Math.log((1-r)/(1+r)),a=Math.cos(this.B*s.x),Math.abs(a)<Tc?l=this.A*s.x:l=this.ArB*Math.atan2(e*this.cosgam+n*this.singam,a)}else h=s.y>0?this.v_pole_n:this.v_pole_s,l=this.ArB*s.y;return this.no_rot?(t.x=l,t.y=h):(l-=this.u_0,t.x=h*this.cosrot+l*this.sinrot,t.y=l*this.cosrot-h*this.sinrot),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function NK(s){var t,e,i,r,n,o,a,l={};if(s.x=(s.x-this.x0)*(1/this.a),s.y=(s.y-this.y0)*(1/this.a),this.no_rot?(e=s.y,t=s.x):(e=s.x*this.cosrot-s.y*this.sinrot,t=s.y*this.cosrot+s.x*this.sinrot+this.u_0),i=Math.exp(-this.BrA*e),r=.5*(i-1/i),n=.5*(i+1/i),o=Math.sin(this.BrA*t),a=(o*this.cosgam+r*this.singam)/n,Math.abs(Math.abs(a)-1)<lt)l.x=0,l.y=a<0?-et:et;else{if(l.y=this.E/Math.sqrt((1+a)/(1-a)),l.y=hg(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(r*this.cosgam-o*this.singam,Math.cos(this.BrA*t))}return l.x+=this.lam0,l}var DK=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const $K={init:FK,forward:kK,inverse:NK,names:DK};function jK(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<lt)){var s=this.b/this.a;this.e=Math.sqrt(1-s*s);var t=Math.sin(this.lat1),e=Math.cos(this.lat1),i=yo(this.e,t,e),r=Nn(this.e,this.lat1,t),n=Math.sin(this.lat2),o=Math.cos(this.lat2),a=yo(this.e,n,o),l=Nn(this.e,this.lat2,n),h=Nn(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>lt?this.ns=Math.log(i/a)/Math.log(r/l):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=i/(this.ns*Math.pow(r,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function GK(s){var t=s.x,e=s.y;Math.abs(2*Math.abs(e)-Math.PI)<=lt&&(e=of(e)*(et-2*lt));var i=Math.abs(Math.abs(e)-et),r,n;if(i>lt)r=Nn(this.e,e,Math.sin(e)),n=this.a*this.f0*Math.pow(r,this.ns);else{if(i=e*this.ns,i<=0)return null;n=0}var o=this.ns*gt(t-this.long0);return s.x=this.k0*(n*Math.sin(o))+this.x0,s.y=this.k0*(this.rh-n*Math.cos(o))+this.y0,s}function zK(s){var t,e,i,r,n,o=(s.x-this.x0)/this.k0,a=this.rh-(s.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(o*o+a*a),e=1):(t=-Math.sqrt(o*o+a*a),e=-1);var l=0;if(t!==0&&(l=Math.atan2(e*o,e*a)),t!==0||this.ns>0){if(e=1/this.ns,i=Math.pow(t/(this.a*this.f0),e),r=hg(this.e,i),r===-9999)return null}else r=-et;return n=gt(l/this.ns+this.long0),s.x=n,s.y=r,s}var BK=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const UK={init:jK,forward:GK,inverse:zK,names:BK};function VK(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function HK(s){var t,e,i,r,n,o,a,l=s.x,h=s.y,c=gt(l-this.long0);return t=Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.alfa*this.e/2),e=2*(Math.atan(this.k*Math.pow(Math.tan(h/2+this.s45),this.alfa)/t)-this.s45),i=-c*this.alfa,r=Math.asin(Math.cos(this.ad)*Math.sin(e)+Math.sin(this.ad)*Math.cos(e)*Math.cos(i)),n=Math.asin(Math.cos(e)*Math.sin(i)/Math.cos(r)),o=this.n*n,a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(r/2+this.s45),this.n),s.y=a*Math.cos(o)/1,s.x=a*Math.sin(o)/1,this.czech||(s.y*=-1,s.x*=-1),s}function WK(s){var t,e,i,r,n,o,a,l,h=s.x;s.x=s.y,s.y=h,this.czech||(s.y*=-1,s.x*=-1),o=Math.sqrt(s.x*s.x+s.y*s.y),n=Math.atan2(s.y,s.x),r=n/Math.sin(this.s0),i=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(i)-Math.sin(this.ad)*Math.cos(i)*Math.cos(r)),e=Math.asin(Math.cos(i)*Math.sin(r)/Math.cos(t)),s.x=this.long0-e/this.alfa,a=t,l=0;var c=0;do s.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-s.y)<1e-10&&(l=1),a=s.y,c+=1;while(l===0&&c<15);return c>=15?null:s}var XK=["Krovak","krovak"];const qK={init:VK,forward:HK,inverse:WK,names:XK};function nr(s,t,e,i,r){return s*r-t*Math.sin(2*r)+e*Math.sin(4*r)-i*Math.sin(6*r)}function af(s){return 1-.25*s*(1+s/16*(3+1.25*s))}function lf(s){return .375*s*(1+.25*s*(1+.46875*s))}function hf(s){return .05859375*s*s*(1+.75*s)}function cf(s){return s*s*s*(35/3072)}function ku(s,t,e){var i=t*e;return s/Math.sqrt(1-i*i)}function fd(s){return Math.abs(s)<et?s:s-of(s)*Math.PI}function F0(s,t,e,i,r){var n,o;n=s/t;for(var a=0;a<15;a++)if(o=(s-(t*n-e*Math.sin(2*n)+i*Math.sin(4*n)-r*Math.sin(6*n)))/(t-2*e*Math.cos(2*n)+4*i*Math.cos(4*n)-6*r*Math.cos(6*n)),n+=o,Math.abs(o)<=1e-10)return n;return NaN}function YK(){this.sphere||(this.e0=af(this.es),this.e1=lf(this.es),this.e2=hf(this.es),this.e3=cf(this.es),this.ml0=this.a*nr(this.e0,this.e1,this.e2,this.e3,this.lat0))}function ZK(s){var t,e,i=s.x,r=s.y;if(i=gt(i-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(r)*Math.sin(i)),e=this.a*(Math.atan2(Math.tan(r),Math.cos(i))-this.lat0);else{var n=Math.sin(r),o=Math.cos(r),a=ku(this.a,this.e,n),l=Math.tan(r)*Math.tan(r),h=i*Math.cos(r),c=h*h,u=this.es*o*o/(1-this.es),d=this.a*nr(this.e0,this.e1,this.e2,this.e3,r);t=a*h*(1-c*l*(1/6-(8-l+8*u)*c/120)),e=d-this.ml0+a*n/o*c*(.5+(5-l+6*u)*c/24)}return s.x=t+this.x0,s.y=e+this.y0,s}function KK(s){s.x-=this.x0,s.y-=this.y0;var t=s.x/this.a,e=s.y/this.a,i,r;if(this.sphere){var n=e+this.lat0;i=Math.asin(Math.sin(n)*Math.cos(t)),r=Math.atan2(Math.tan(t),Math.cos(n))}else{var o=this.ml0/this.a+e,a=F0(o,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(a)-et)<=lt)return s.x=this.long0,s.y=et,e<0&&(s.y*=-1),s;var l=ku(this.a,this.e,Math.sin(a)),h=l*l*l/this.a/this.a*(1-this.es),c=Math.pow(Math.tan(a),2),u=t*this.a/l,d=u*u;i=a-l*Math.tan(a)/h*u*u*(.5-(1+3*c)*u*u/24),r=u*(1-d*(c/3+(1+3*c)*c*d/15))/Math.cos(a)}return s.x=gt(r+this.long0),s.y=fd(i),s}var JK=["Cassini","Cassini_Soldner","cass"];const QK={init:YK,forward:ZK,inverse:KK,names:JK};function wl(s,t){var e;return s>1e-7?(e=s*t,(1-s*s)*(t/(1-e*e)-.5/s*Math.log((1-e)/(1+e)))):2*t}var tJ=1,eJ=2,iJ=3,sJ=4;function rJ(){var s=Math.abs(this.lat0);if(Math.abs(s-et)<lt?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(s)<lt?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var t;switch(this.qp=wl(this.e,1),this.mmf=.5/(1-this.es),this.apa=pJ(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=wl(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function nJ(s){var t,e,i,r,n,o,a,l,h,c,u=s.x,d=s.y;if(u=gt(u-this.long0),this.sphere){if(n=Math.sin(d),c=Math.cos(d),i=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e=this.mode===this.EQUIT?1+c*i:1+this.sinph0*n+this.cosph0*c*i,e<=lt)return null;e=Math.sqrt(2/e),t=e*c*Math.sin(u),e*=this.mode===this.EQUIT?n:this.cosph0*n-this.sinph0*c*i}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),Math.abs(d+this.lat0)<lt)return null;e=Ye-d*.5,e=2*(this.mode===this.S_POLE?Math.cos(e):Math.sin(e)),t=e*Math.sin(u),e*=i}}else{switch(a=0,l=0,h=0,i=Math.cos(u),r=Math.sin(u),n=Math.sin(d),o=wl(this.e,n),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(a=o/this.qp,l=Math.sqrt(1-a*a)),this.mode){case this.OBLIQ:h=1+this.sinb1*a+this.cosb1*l*i;break;case this.EQUIT:h=1+l*i;break;case this.N_POLE:h=et+d,o=this.qp-o;break;case this.S_POLE:h=d-et,o=this.qp+o;break}if(Math.abs(h)<lt)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),this.mode===this.OBLIQ?e=this.ymf*h*(this.cosb1*a-this.sinb1*l*i):e=(h=Math.sqrt(2/(1+l*i)))*a*this.ymf,t=this.xmf*h*l*r;break;case this.N_POLE:case this.S_POLE:o>=0?(t=(h=Math.sqrt(o))*r,e=i*(this.mode===this.S_POLE?h:-h)):t=e=0;break}}return s.x=this.a*t+this.x0,s.y=this.a*e+this.y0,s}function oJ(s){s.x-=this.x0,s.y-=this.y0;var t=s.x/this.a,e=s.y/this.a,i,r,n,o,a,l,h;if(this.sphere){var c=0,u,d=0;if(u=Math.sqrt(t*t+e*e),r=u*.5,r>1)return null;switch(r=2*Math.asin(r),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(d=Math.sin(r),c=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(u)<=lt?0:Math.asin(e*d/u),t*=d,e=c*u;break;case this.OBLIQ:r=Math.abs(u)<=lt?this.lat0:Math.asin(c*this.sinph0+e*d*this.cosph0/u),t*=d*this.cosph0,e=(c-Math.sin(r)*this.sinph0)*u;break;case this.N_POLE:e=-e,r=et-r;break;case this.S_POLE:r-=et;break}i=e===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(t,e)}else{if(h=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t/=this.dd,e*=this.dd,l=Math.sqrt(t*t+e*e),l<lt)return s.x=this.long0,s.y=this.lat0,s;o=2*Math.asin(.5*l/this.rq),n=Math.cos(o),t*=o=Math.sin(o),this.mode===this.OBLIQ?(h=n*this.sinb1+e*o*this.cosb1/l,a=this.qp*h,e=l*this.cosb1*n-e*this.sinb1*o):(h=e*o/l,a=this.qp*h,e=l*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(e=-e),a=t*t+e*e,!a)return s.x=this.long0,s.y=this.lat0,s;h=1-a/this.qp,this.mode===this.S_POLE&&(h=-h)}i=Math.atan2(t,e),r=gJ(Math.asin(h),this.apa)}return s.x=gt(this.long0+i),s.y=r,s}var aJ=.3333333333333333,lJ=.17222222222222222,hJ=.10257936507936508,cJ=.06388888888888888,uJ=.0664021164021164,dJ=.016415012942191543;function pJ(s){var t,e=[];return e[0]=s*aJ,t=s*s,e[0]+=t*lJ,e[1]=t*cJ,t*=s,e[0]+=t*hJ,e[1]+=t*uJ,e[2]=t*dJ,e}function gJ(s,t){var e=s+s;return s+t[0]*Math.sin(e)+t[1]*Math.sin(e+e)+t[2]*Math.sin(e+e+e)}var fJ=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const mJ={init:rJ,forward:nJ,inverse:oJ,names:fJ,S_POLE:tJ,N_POLE:eJ,EQUIT:iJ,OBLIQ:sJ};function Il(s){return Math.abs(s)>1&&(s=s>1?1:-1),Math.asin(s)}function _J(){Math.abs(this.lat1+this.lat2)<lt||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=yo(this.e3,this.sin_po,this.cos_po),this.qs1=wl(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=yo(this.e3,this.sin_po,this.cos_po),this.qs2=wl(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=wl(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>lt?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function yJ(s){var t=s.x,e=s.y;this.sin_phi=Math.sin(e),this.cos_phi=Math.cos(e);var i=wl(this.e3,this.sin_phi),r=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,n=this.ns0*gt(t-this.long0),o=r*Math.sin(n)+this.x0,a=this.rh-r*Math.cos(n)+this.y0;return s.x=o,s.y=a,s}function xJ(s){var t,e,i,r,n,o;return s.x-=this.x0,s.y=this.rh-s.y+this.y0,this.ns0>=0?(t=Math.sqrt(s.x*s.x+s.y*s.y),i=1):(t=-Math.sqrt(s.x*s.x+s.y*s.y),i=-1),r=0,t!==0&&(r=Math.atan2(i*s.x,i*s.y)),i=t*this.ns0/this.a,this.sphere?o=Math.asin((this.c-i*i)/(2*this.ns0)):(e=(this.c-i*i)/this.ns0,o=this.phi1z(this.e3,e)),n=gt(r/this.ns0+this.long0),s.x=n,s.y=o,s}function vJ(s,t){var e,i,r,n,o,a=Il(.5*t);if(s<lt)return a;for(var l=s*s,h=1;h<=25;h++)if(e=Math.sin(a),i=Math.cos(a),r=s*e,n=1-r*r,o=.5*n*n/i*(t/(1-l)-e/n+.5/s*Math.log((1-r)/(1+r))),a=a+o,Math.abs(o)<=1e-7)return a;return null}var bJ=["Albers_Conic_Equal_Area","Albers","aea"];const wJ={init:_J,forward:yJ,inverse:xJ,names:bJ,phi1z:vJ};function EJ(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function SJ(s){var t,e,i,r,n,o,a,l,h=s.x,c=s.y;return i=gt(h-this.long0),t=Math.sin(c),e=Math.cos(c),r=Math.cos(i),o=this.sin_p14*t+this.cos_p14*e*r,n=1,o>0||Math.abs(o)<=lt?(a=this.x0+this.a*n*e*Math.sin(i)/o,l=this.y0+this.a*n*(this.cos_p14*t-this.sin_p14*e*r)/o):(a=this.x0+this.infinity_dist*e*Math.sin(i),l=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*e*r)),s.x=a,s.y=l,s}function CJ(s){var t,e,i,r,n,o;return s.x=(s.x-this.x0)/this.a,s.y=(s.y-this.y0)/this.a,s.x/=this.k0,s.y/=this.k0,(t=Math.sqrt(s.x*s.x+s.y*s.y))?(r=Math.atan2(t,this.rc),e=Math.sin(r),i=Math.cos(r),o=Il(i*this.sin_p14+s.y*e*this.cos_p14/t),n=Math.atan2(s.x*e,t*this.cos_p14*i-s.y*this.sin_p14*e),n=gt(this.long0+n)):(o=this.phic0,n=0),s.x=n,s.y=o,s}var TJ=["gnom"];const RJ={init:EJ,forward:SJ,inverse:CJ,names:TJ};function MJ(s,t){var e=1-(1-s*s)/(2*s)*Math.log((1-s)/(1+s));if(Math.abs(Math.abs(t)-e)<1e-6)return t<0?-1*et:et;for(var i=Math.asin(.5*t),r,n,o,a,l=0;l<30;l++)if(n=Math.sin(i),o=Math.cos(i),a=s*n,r=Math.pow(1-a*a,2)/(2*o)*(t/(1-s*s)-n/(1-a*a)+.5/s*Math.log((1-a)/(1+a))),i+=r,Math.abs(r)<=1e-10)return i;return NaN}function IJ(){this.sphere||(this.k0=yo(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function AJ(s){var t=s.x,e=s.y,i,r,n=gt(t-this.long0);if(this.sphere)i=this.x0+this.a*n*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(e)/Math.cos(this.lat_ts);else{var o=wl(this.e,Math.sin(e));i=this.x0+this.a*this.k0*n,r=this.y0+this.a*o*.5/this.k0}return s.x=i,s.y=r,s}function LJ(s){s.x-=this.x0,s.y-=this.y0;var t,e;return this.sphere?(t=gt(this.long0+s.x/this.a/Math.cos(this.lat_ts)),e=Math.asin(s.y/this.a*Math.cos(this.lat_ts))):(e=MJ(this.e,2*s.y*this.k0/this.a),t=gt(this.long0+s.x/(this.a*this.k0))),s.x=t,s.y=e,s}var PJ=["cea"];const OJ={init:IJ,forward:AJ,inverse:LJ,names:PJ};function FJ(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function kJ(s){var t=s.x,e=s.y,i=gt(t-this.long0),r=fd(e-this.lat0);return s.x=this.x0+this.a*i*this.rc,s.y=this.y0+this.a*r,s}function NJ(s){var t=s.x,e=s.y;return s.x=gt(this.long0+(t-this.x0)/(this.a*this.rc)),s.y=fd(this.lat0+(e-this.y0)/this.a),s}var DJ=["Equirectangular","Equidistant_Cylindrical","eqc"];const $J={init:FJ,forward:kJ,inverse:NJ,names:DJ};var gR=20;function jJ(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=af(this.es),this.e1=lf(this.es),this.e2=hf(this.es),this.e3=cf(this.es),this.ml0=this.a*nr(this.e0,this.e1,this.e2,this.e3,this.lat0)}function GJ(s){var t=s.x,e=s.y,i,r,n,o=gt(t-this.long0);if(n=o*Math.sin(e),this.sphere)Math.abs(e)<=lt?(i=this.a*o,r=-1*this.a*this.lat0):(i=this.a*Math.sin(n)/Math.tan(e),r=this.a*(fd(e-this.lat0)+(1-Math.cos(n))/Math.tan(e)));else if(Math.abs(e)<=lt)i=this.a*o,r=-1*this.ml0;else{var a=ku(this.a,this.e,Math.sin(e))/Math.tan(e);i=a*Math.sin(n),r=this.a*nr(this.e0,this.e1,this.e2,this.e3,e)-this.ml0+a*(1-Math.cos(n))}return s.x=i+this.x0,s.y=r+this.y0,s}function zJ(s){var t,e,i,r,n,o,a,l,h;if(i=s.x-this.x0,r=s.y-this.y0,this.sphere)if(Math.abs(r+this.a*this.lat0)<=lt)t=gt(i/this.a+this.long0),e=0;else{o=this.lat0+r/this.a,a=i*i/this.a/this.a+o*o,l=o;var c;for(n=gR;n;--n)if(c=Math.tan(l),h=-1*(o*(l*c+1)-l-.5*(l*l+a)*c)/((l-o)/c-1),l+=h,Math.abs(h)<=lt){e=l;break}t=gt(this.long0+Math.asin(i*Math.tan(l)/this.a)/Math.sin(e))}else if(Math.abs(r+this.ml0)<=lt)e=0,t=gt(this.long0+i/this.a);else{o=(this.ml0+r)/this.a,a=i*i/this.a/this.a+o*o,l=o;var u,d,p,g,f;for(n=gR;n;--n)if(f=this.e*Math.sin(l),u=Math.sqrt(1-f*f)*Math.tan(l),d=this.a*nr(this.e0,this.e1,this.e2,this.e3,l),p=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),g=d/this.a,h=(o*(u*g+1)-g-.5*u*(g*g+a))/(this.es*Math.sin(2*l)*(g*g+a-2*o*g)/(4*u)+(o-g)*(u*p-2/Math.sin(2*l))-p),l-=h,Math.abs(h)<=lt){e=l;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(e),2))*Math.tan(e),t=gt(this.long0+Math.asin(i*u/this.a)/Math.sin(e))}return s.x=t,s.y=e,s}var BJ=["Polyconic","poly"];const UJ={init:jJ,forward:GJ,inverse:zJ,names:BJ};function VJ(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function HJ(s){var t,e=s.x,i=s.y,r=i-this.lat0,n=e-this.long0,o=r/xp*1e-5,a=n,l=1,h=0;for(t=1;t<=10;t++)l=l*o,h=h+this.A[t]*l;var c=h,u=a,d=1,p=0,g,f,m=0,_=0;for(t=1;t<=6;t++)g=d*c-p*u,f=p*c+d*u,d=g,p=f,m=m+this.B_re[t]*d-this.B_im[t]*p,_=_+this.B_im[t]*d+this.B_re[t]*p;return s.x=_*this.a+this.x0,s.y=m*this.a+this.y0,s}function WJ(s){var t,e=s.x,i=s.y,r=e-this.x0,n=i-this.y0,o=n/this.a,a=r/this.a,l=1,h=0,c,u,d=0,p=0;for(t=1;t<=6;t++)c=l*o-h*a,u=h*o+l*a,l=c,h=u,d=d+this.C_re[t]*l-this.C_im[t]*h,p=p+this.C_im[t]*l+this.C_re[t]*h;for(var g=0;g<this.iterations;g++){var f=d,m=p,_,y,v=o,b=a;for(t=2;t<=6;t++)_=f*d-m*p,y=m*d+f*p,f=_,m=y,v=v+(t-1)*(this.B_re[t]*f-this.B_im[t]*m),b=b+(t-1)*(this.B_im[t]*f+this.B_re[t]*m);f=1,m=0;var E=this.B_re[1],S=this.B_im[1];for(t=2;t<=6;t++)_=f*d-m*p,y=m*d+f*p,f=_,m=y,E=E+t*(this.B_re[t]*f-this.B_im[t]*m),S=S+t*(this.B_im[t]*f+this.B_re[t]*m);var T=E*E+S*S;d=(v*E+b*S)/T,p=(b*E-v*S)/T}var R=d,M=p,A=1,O=0;for(t=1;t<=9;t++)A=A*R,O=O+this.D[t]*A;var N=this.lat0+O*xp*1e5,x=this.long0+M;return s.x=x,s.y=N,s}var XJ=["New_Zealand_Map_Grid","nzmg"];const qJ={init:VJ,forward:HJ,inverse:WJ,names:XJ};function YJ(){}function ZJ(s){var t=s.x,e=s.y,i=gt(t-this.long0),r=this.x0+this.a*i,n=this.y0+this.a*Math.log(Math.tan(Math.PI/4+e/2.5))*1.25;return s.x=r,s.y=n,s}function KJ(s){s.x-=this.x0,s.y-=this.y0;var t=gt(this.long0+s.x/this.a),e=2.5*(Math.atan(Math.exp(.8*s.y/this.a))-Math.PI/4);return s.x=t,s.y=e,s}var JJ=["Miller_Cylindrical","mill"];const QJ={init:YJ,forward:ZJ,inverse:KJ,names:JJ};var tQ=20;function eQ(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=YF(this.es)}function iQ(s){var t,e,i=s.x,r=s.y;if(i=gt(i-this.long0),this.sphere){if(!this.m)r=this.n!==1?Math.asin(this.n*Math.sin(r)):r;else for(var n=this.n*Math.sin(r),o=tQ;o;--o){var a=(this.m*r+Math.sin(r)-n)/(this.m+Math.cos(r));if(r-=a,Math.abs(a)<lt)break}t=this.a*this.C_x*i*(this.m+Math.cos(r)),e=this.a*this.C_y*r}else{var l=Math.sin(r),h=Math.cos(r);e=this.a*by(r,l,h,this.en),t=this.a*i*h/Math.sqrt(1-this.es*l*l)}return s.x=t,s.y=e,s}function sQ(s){var t,e,i,r;return s.x-=this.x0,i=s.x/this.a,s.y-=this.y0,t=s.y/this.a,this.sphere?(t/=this.C_y,i=i/(this.C_x*(this.m+Math.cos(t))),this.m?t=Il((this.m*t+Math.sin(t))/this.n):this.n!==1&&(t=Il(Math.sin(t)/this.n)),i=gt(i+this.long0),t=fd(t)):(t=ZF(s.y/this.a,this.es,this.en),r=Math.abs(t),r<et?(r=Math.sin(t),e=this.long0+s.x*Math.sqrt(1-this.es*r*r)/(this.a*Math.cos(t)),i=gt(e)):r-lt<et&&(i=this.long0)),s.x=i,s.y=t,s}var rQ=["Sinusoidal","sinu"];const nQ={init:eQ,forward:iQ,inverse:sQ,names:rQ};function oQ(){}function aQ(s){for(var t=s.x,e=s.y,i=gt(t-this.long0),r=e,n=Math.PI*Math.sin(e);;){var o=-(r+Math.sin(r)-n)/(1+Math.cos(r));if(r+=o,Math.abs(o)<lt)break}r/=2,Math.PI/2-Math.abs(e)<lt&&(i=0);var a=.900316316158*this.a*i*Math.cos(r)+this.x0,l=1.4142135623731*this.a*Math.sin(r)+this.y0;return s.x=a,s.y=l,s}function lQ(s){var t,e;s.x-=this.x0,s.y-=this.y0,e=s.y/(1.4142135623731*this.a),Math.abs(e)>.999999999999&&(e=.999999999999),t=Math.asin(e);var i=gt(this.long0+s.x/(.900316316158*this.a*Math.cos(t)));i<-Math.PI&&(i=-Math.PI),i>Math.PI&&(i=Math.PI),e=(2*t+Math.sin(2*t))/Math.PI,Math.abs(e)>1&&(e=1);var r=Math.asin(e);return s.x=i,s.y=r,s}var hQ=["Mollweide","moll"];const cQ={init:oQ,forward:aQ,inverse:lQ,names:hQ};function uQ(){Math.abs(this.lat1+this.lat2)<lt||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=af(this.es),this.e1=lf(this.es),this.e2=hf(this.es),this.e3=cf(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=yo(this.e,this.sinphi,this.cosphi),this.ml1=nr(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<lt?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=yo(this.e,this.sinphi,this.cosphi),this.ml2=nr(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=nr(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function dQ(s){var t=s.x,e=s.y,i;if(this.sphere)i=this.a*(this.g-e);else{var r=nr(this.e0,this.e1,this.e2,this.e3,e);i=this.a*(this.g-r)}var n=this.ns*gt(t-this.long0),o=this.x0+i*Math.sin(n),a=this.y0+this.rh-i*Math.cos(n);return s.x=o,s.y=a,s}function pQ(s){s.x-=this.x0,s.y=this.rh-s.y+this.y0;var t,e,i,r;this.ns>=0?(e=Math.sqrt(s.x*s.x+s.y*s.y),t=1):(e=-Math.sqrt(s.x*s.x+s.y*s.y),t=-1);var n=0;if(e!==0&&(n=Math.atan2(t*s.x,t*s.y)),this.sphere)return r=gt(this.long0+n/this.ns),i=fd(this.g-e/this.a),s.x=r,s.y=i,s;var o=this.g-e/this.a;return i=F0(o,this.e0,this.e1,this.e2,this.e3),r=gt(this.long0+n/this.ns),s.x=r,s.y=i,s}var gQ=["Equidistant_Conic","eqdc"];const fQ={init:uQ,forward:dQ,inverse:pQ,names:gQ};function mQ(){this.R=this.a}function _Q(s){var t=s.x,e=s.y,i=gt(t-this.long0),r,n;Math.abs(e)<=lt&&(r=this.x0+this.R*i,n=this.y0);var o=Il(2*Math.abs(e/Math.PI));(Math.abs(i)<=lt||Math.abs(Math.abs(e)-et)<=lt)&&(r=this.x0,e>=0?n=this.y0+Math.PI*this.R*Math.tan(.5*o):n=this.y0+Math.PI*this.R*-Math.tan(.5*o));var a=.5*Math.abs(Math.PI/i-i/Math.PI),l=a*a,h=Math.sin(o),c=Math.cos(o),u=c/(h+c-1),d=u*u,p=u*(2/h-1),g=p*p,f=Math.PI*this.R*(a*(u-g)+Math.sqrt(l*(u-g)*(u-g)-(g+l)*(d-g)))/(g+l);i<0&&(f=-f),r=this.x0+f;var m=l+u;return f=Math.PI*this.R*(p*m-a*Math.sqrt((g+l)*(l+1)-m*m))/(g+l),e>=0?n=this.y0+f:n=this.y0-f,s.x=r,s.y=n,s}function yQ(s){var t,e,i,r,n,o,a,l,h,c,u,d,p;return s.x-=this.x0,s.y-=this.y0,u=Math.PI*this.R,i=s.x/u,r=s.y/u,n=i*i+r*r,o=-Math.abs(r)*(1+n),a=o-2*r*r+i*i,l=-2*o+1+2*r*r+n*n,p=r*r/l+(2*a*a*a/l/l/l-9*o*a/l/l)/27,h=(o-a*a/3/l)/l,c=2*Math.sqrt(-h/3),u=3*p/h/c,Math.abs(u)>1&&(u>=0?u=1:u=-1),d=Math.acos(u)/3,s.y>=0?e=(-c*Math.cos(d+Math.PI/3)-a/3/l)*Math.PI:e=-(-c*Math.cos(d+Math.PI/3)-a/3/l)*Math.PI,Math.abs(i)<lt?t=this.long0:t=gt(this.long0+Math.PI*(n-1+Math.sqrt(1+2*(i*i-r*r)+n*n))/2/i),s.x=t,s.y=e,s}var xQ=["Van_der_Grinten_I","VanDerGrinten","vandg"];const vQ={init:mQ,forward:_Q,inverse:yQ,names:xQ};function bQ(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function wQ(s){var t=s.x,e=s.y,i=Math.sin(s.y),r=Math.cos(s.y),n=gt(t-this.long0),o,a,l,h,c,u,d,p,g,f,m,_,y,v,b,E,S,T,R,M,A,O,N;return this.sphere?Math.abs(this.sin_p12-1)<=lt?(s.x=this.x0+this.a*(et-e)*Math.sin(n),s.y=this.y0-this.a*(et-e)*Math.cos(n),s):Math.abs(this.sin_p12+1)<=lt?(s.x=this.x0+this.a*(et+e)*Math.sin(n),s.y=this.y0+this.a*(et+e)*Math.cos(n),s):(T=this.sin_p12*i+this.cos_p12*r*Math.cos(n),E=Math.acos(T),S=E?E/Math.sin(E):1,s.x=this.x0+this.a*S*r*Math.sin(n),s.y=this.y0+this.a*S*(this.cos_p12*i-this.sin_p12*r*Math.cos(n)),s):(o=af(this.es),a=lf(this.es),l=hf(this.es),h=cf(this.es),Math.abs(this.sin_p12-1)<=lt?(c=this.a*nr(o,a,l,h,et),u=this.a*nr(o,a,l,h,e),s.x=this.x0+(c-u)*Math.sin(n),s.y=this.y0-(c-u)*Math.cos(n),s):Math.abs(this.sin_p12+1)<=lt?(c=this.a*nr(o,a,l,h,et),u=this.a*nr(o,a,l,h,e),s.x=this.x0+(c+u)*Math.sin(n),s.y=this.y0+(c+u)*Math.cos(n),s):(d=i/r,p=ku(this.a,this.e,this.sin_p12),g=ku(this.a,this.e,i),f=Math.atan((1-this.es)*d+this.es*p*this.sin_p12/(g*r)),m=Math.atan2(Math.sin(n),this.cos_p12*Math.tan(f)-this.sin_p12*Math.cos(n)),m===0?R=Math.asin(this.cos_p12*Math.sin(f)-this.sin_p12*Math.cos(f)):Math.abs(Math.abs(m)-Math.PI)<=lt?R=-Math.asin(this.cos_p12*Math.sin(f)-this.sin_p12*Math.cos(f)):R=Math.asin(Math.sin(n)*Math.cos(f)/Math.sin(m)),_=this.e*this.sin_p12/Math.sqrt(1-this.es),y=this.e*this.cos_p12*Math.cos(m)/Math.sqrt(1-this.es),v=_*y,b=y*y,M=R*R,A=M*R,O=A*R,N=O*R,E=p*R*(1-M*b*(1-b)/6+A/8*v*(1-2*b)+O/120*(b*(4-7*b)-3*_*_*(1-7*b))-N/48*v),s.x=this.x0+E*Math.sin(m),s.y=this.y0+E*Math.cos(m),s))}function EQ(s){s.x-=this.x0,s.y-=this.y0;var t,e,i,r,n,o,a,l,h,c,u,d,p,g,f,m,_,y,v,b,E,S,T,R;return this.sphere?(t=Math.sqrt(s.x*s.x+s.y*s.y),t>2*et*this.a?void 0:(e=t/this.a,i=Math.sin(e),r=Math.cos(e),n=this.long0,Math.abs(t)<=lt?o=this.lat0:(o=Il(r*this.sin_p12+s.y*i*this.cos_p12/t),a=Math.abs(this.lat0)-et,Math.abs(a)<=lt?this.lat0>=0?n=gt(this.long0+Math.atan2(s.x,-s.y)):n=gt(this.long0-Math.atan2(-s.x,s.y)):n=gt(this.long0+Math.atan2(s.x*i,t*this.cos_p12*r-s.y*this.sin_p12*i))),s.x=n,s.y=o,s)):(l=af(this.es),h=lf(this.es),c=hf(this.es),u=cf(this.es),Math.abs(this.sin_p12-1)<=lt?(d=this.a*nr(l,h,c,u,et),t=Math.sqrt(s.x*s.x+s.y*s.y),p=d-t,o=F0(p/this.a,l,h,c,u),n=gt(this.long0+Math.atan2(s.x,-1*s.y)),s.x=n,s.y=o,s):Math.abs(this.sin_p12+1)<=lt?(d=this.a*nr(l,h,c,u,et),t=Math.sqrt(s.x*s.x+s.y*s.y),p=t-d,o=F0(p/this.a,l,h,c,u),n=gt(this.long0+Math.atan2(s.x,s.y)),s.x=n,s.y=o,s):(t=Math.sqrt(s.x*s.x+s.y*s.y),m=Math.atan2(s.x,s.y),g=ku(this.a,this.e,this.sin_p12),_=Math.cos(m),y=this.e*this.cos_p12*_,v=-y*y/(1-this.es),b=3*this.es*(1-v)*this.sin_p12*this.cos_p12*_/(1-this.es),E=t/g,S=E-v*(1+v)*Math.pow(E,3)/6-b*(1+3*v)*Math.pow(E,4)/24,T=1-v*S*S/2-E*S*S*S/6,f=Math.asin(this.sin_p12*Math.cos(S)+this.cos_p12*Math.sin(S)*_),n=gt(this.long0+Math.asin(Math.sin(m)*Math.sin(S)/Math.cos(f))),R=Math.sin(f),o=Math.atan2((R-this.es*T*this.sin_p12)*Math.tan(f),R*(1-this.es)),s.x=n,s.y=o,s))}var SQ=["Azimuthal_Equidistant","aeqd"];const CQ={init:bQ,forward:wQ,inverse:EQ,names:SQ};function TQ(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function RQ(s){var t,e,i,r,n,o,a,l,h=s.x,c=s.y;return i=gt(h-this.long0),t=Math.sin(c),e=Math.cos(c),r=Math.cos(i),o=this.sin_p14*t+this.cos_p14*e*r,n=1,(o>0||Math.abs(o)<=lt)&&(a=this.a*n*e*Math.sin(i),l=this.y0+this.a*n*(this.cos_p14*t-this.sin_p14*e*r)),s.x=a,s.y=l,s}function MQ(s){var t,e,i,r,n,o,a;return s.x-=this.x0,s.y-=this.y0,t=Math.sqrt(s.x*s.x+s.y*s.y),e=Il(t/this.a),i=Math.sin(e),r=Math.cos(e),o=this.long0,Math.abs(t)<=lt?(a=this.lat0,s.x=o,s.y=a,s):(a=Il(r*this.sin_p14+s.y*i*this.cos_p14/t),n=Math.abs(this.lat0)-et,Math.abs(n)<=lt?(this.lat0>=0?o=gt(this.long0+Math.atan2(s.x,-s.y)):o=gt(this.long0-Math.atan2(-s.x,s.y)),s.x=o,s.y=a,s):(o=gt(this.long0+Math.atan2(s.x*i,t*this.cos_p14*r-s.y*this.sin_p14*i)),s.x=o,s.y=a,s))}var IQ=["ortho"];const AQ={init:TQ,forward:RQ,inverse:MQ,names:IQ};var Mi={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},Ze={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function LQ(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=et-Ye/2?this.face=Mi.TOP:this.lat0<=-(et-Ye/2)?this.face=Mi.BOTTOM:Math.abs(this.long0)<=Ye?this.face=Mi.FRONT:Math.abs(this.long0)<=et+Ye?this.face=this.long0>0?Mi.RIGHT:Mi.LEFT:this.face=Mi.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function PQ(s){var t={x:0,y:0},e,i,r,n,o,a,l={value:0};if(s.x-=this.long0,this.es!==0?e=Math.atan(this.one_minus_f_squared*Math.tan(s.y)):e=s.y,i=s.x,this.face===Mi.TOP)n=et-e,i>=Ye&&i<=et+Ye?(l.value=Ze.AREA_0,r=i-et):i>et+Ye||i<=-(et+Ye)?(l.value=Ze.AREA_1,r=i>0?i-Zi:i+Zi):i>-(et+Ye)&&i<=-Ye?(l.value=Ze.AREA_2,r=i+et):(l.value=Ze.AREA_3,r=i);else if(this.face===Mi.BOTTOM)n=et+e,i>=Ye&&i<=et+Ye?(l.value=Ze.AREA_0,r=-i+et):i<Ye&&i>=-Ye?(l.value=Ze.AREA_1,r=-i):i<-Ye&&i>=-(et+Ye)?(l.value=Ze.AREA_2,r=-i-et):(l.value=Ze.AREA_3,r=i>0?-i+Zi:-i-Zi);else{var h,c,u,d,p,g,f;this.face===Mi.RIGHT?i=du(i,+et):this.face===Mi.BACK?i=du(i,+Zi):this.face===Mi.LEFT&&(i=du(i,-et)),d=Math.sin(e),p=Math.cos(e),g=Math.sin(i),f=Math.cos(i),h=p*f,c=p*g,u=d,this.face===Mi.FRONT?(n=Math.acos(h),r=am(n,u,c,l)):this.face===Mi.RIGHT?(n=Math.acos(c),r=am(n,u,-h,l)):this.face===Mi.BACK?(n=Math.acos(-h),r=am(n,u,-c,l)):this.face===Mi.LEFT?(n=Math.acos(-c),r=am(n,u,h,l)):(n=r=0,l.value=Ze.AREA_0)}return a=Math.atan(12/Zi*(r+Math.acos(Math.sin(r)*Math.cos(Ye))-et)),o=Math.sqrt((1-Math.cos(n))/(Math.cos(a)*Math.cos(a))/(1-Math.cos(Math.atan(1/Math.cos(r))))),l.value===Ze.AREA_1?a+=et:l.value===Ze.AREA_2?a+=Zi:l.value===Ze.AREA_3&&(a+=1.5*Zi),t.x=o*Math.cos(a),t.y=o*Math.sin(a),t.x=t.x*this.a+this.x0,t.y=t.y*this.a+this.y0,s.x=t.x,s.y=t.y,s}function OQ(s){var t={lam:0,phi:0},e,i,r,n,o,a,l,h,c,u={value:0};if(s.x=(s.x-this.x0)/this.a,s.y=(s.y-this.y0)/this.a,i=Math.atan(Math.sqrt(s.x*s.x+s.y*s.y)),e=Math.atan2(s.y,s.x),s.x>=0&&s.x>=Math.abs(s.y)?u.value=Ze.AREA_0:s.y>=0&&s.y>=Math.abs(s.x)?(u.value=Ze.AREA_1,e-=et):s.x<0&&-s.x>=Math.abs(s.y)?(u.value=Ze.AREA_2,e=e<0?e+Zi:e-Zi):(u.value=Ze.AREA_3,e+=et),c=Zi/12*Math.tan(e),o=Math.sin(c)/(Math.cos(c)-1/Math.sqrt(2)),a=Math.atan(o),r=Math.cos(e),n=Math.tan(i),l=1-r*r*n*n*(1-Math.cos(Math.atan(1/Math.cos(a)))),l<-1?l=-1:l>1&&(l=1),this.face===Mi.TOP)h=Math.acos(l),t.phi=et-h,u.value===Ze.AREA_0?t.lam=a+et:u.value===Ze.AREA_1?t.lam=a<0?a+Zi:a-Zi:u.value===Ze.AREA_2?t.lam=a-et:t.lam=a;else if(this.face===Mi.BOTTOM)h=Math.acos(l),t.phi=h-et,u.value===Ze.AREA_0?t.lam=-a+et:u.value===Ze.AREA_1?t.lam=-a:u.value===Ze.AREA_2?t.lam=-a-et:t.lam=a<0?-a-Zi:-a+Zi;else{var d,p,g;d=l,c=d*d,c>=1?g=0:g=Math.sqrt(1-c)*Math.sin(a),c+=g*g,c>=1?p=0:p=Math.sqrt(1-c),u.value===Ze.AREA_1?(c=p,p=-g,g=c):u.value===Ze.AREA_2?(p=-p,g=-g):u.value===Ze.AREA_3&&(c=p,p=g,g=-c),this.face===Mi.RIGHT?(c=d,d=-p,p=c):this.face===Mi.BACK?(d=-d,p=-p):this.face===Mi.LEFT&&(c=d,d=p,p=-c),t.phi=Math.acos(-g)-et,t.lam=Math.atan2(p,d),this.face===Mi.RIGHT?t.lam=du(t.lam,-et):this.face===Mi.BACK?t.lam=du(t.lam,-Zi):this.face===Mi.LEFT&&(t.lam=du(t.lam,+et))}if(this.es!==0){var f,m,_;f=t.phi<0?1:0,m=Math.tan(t.phi),_=this.b/Math.sqrt(m*m+this.one_minus_f_squared),t.phi=Math.atan(Math.sqrt(this.a*this.a-_*_)/(this.one_minus_f*_)),f&&(t.phi=-t.phi)}return t.lam+=this.long0,s.x=t.lam,s.y=t.phi,s}function am(s,t,e,i){var r;return s<lt?(i.value=Ze.AREA_0,r=0):(r=Math.atan2(t,e),Math.abs(r)<=Ye?i.value=Ze.AREA_0:r>Ye&&r<=et+Ye?(i.value=Ze.AREA_1,r-=et):r>et+Ye||r<=-(et+Ye)?(i.value=Ze.AREA_2,r=r>=0?r-Zi:r+Zi):(i.value=Ze.AREA_3,r+=et)),r}function du(s,t){var e=s+t;return e<-Zi?e+=ag:e>+Zi&&(e-=ag),e}var FQ=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const kQ={init:LQ,forward:PQ,inverse:OQ,names:FQ};var Zv=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],sp=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],QF=.8487,tk=1.3523,ek=ro/5,NQ=1/ek,Jc=18,k0=function(s,t){return s[0]+t*(s[1]+t*(s[2]+t*s[3]))},DQ=function(s,t){return s[1]+t*(2*s[2]+t*3*s[3])};function $Q(s,t,e,i){for(var r=t;i;--i){var n=s(r);if(r-=n,Math.abs(n)<e)break}return r}function jQ(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function GQ(s){var t=gt(s.x-this.long0),e=Math.abs(s.y),i=Math.floor(e*ek);i<0?i=0:i>=Jc&&(i=Jc-1),e=ro*(e-NQ*i);var r={x:k0(Zv[i],e)*t,y:k0(sp[i],e)};return s.y<0&&(r.y=-r.y),r.x=r.x*this.a*QF+this.x0,r.y=r.y*this.a*tk+this.y0,r}function zQ(s){var t={x:(s.x-this.x0)/(this.a*QF),y:Math.abs(s.y-this.y0)/(this.a*tk)};if(t.y>=1)t.x/=Zv[Jc][0],t.y=s.y<0?-et:et;else{var e=Math.floor(t.y*Jc);for(e<0?e=0:e>=Jc&&(e=Jc-1);;)if(sp[e][0]>t.y)--e;else if(sp[e+1][0]<=t.y)++e;else break;var i=sp[e],r=5*(t.y-i[0])/(sp[e+1][0]-i[0]);r=$Q(function(n){return(k0(i,n)-t.y)/DQ(i,n)},r,lt,100),t.x/=k0(Zv[e],r),t.y=(5*e+r)*Ts,s.y<0&&(t.y=-t.y)}return t.x=gt(t.x+this.long0),t}var BQ=["Robinson","robin"];const UQ={init:jQ,forward:GQ,inverse:zQ,names:BQ};function VQ(){this.name="geocent"}function HQ(s){var t=GF(s,this.es,this.a);return t}function WQ(s){var t=zF(s,this.es,this.a,this.b);return t}var XQ=["Geocentric","geocentric","geocent","Geocent"];const qQ={init:VQ,forward:HQ,inverse:WQ,names:XQ};var Us={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},jd={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function YQ(){if(Object.keys(jd).forEach((function(e){if(typeof this[e]>"u")this[e]=jd[e].def;else{if(jd[e].num&&isNaN(this[e]))throw new Error("Invalid parameter value, must be numeric "+e+" = "+this[e]);jd[e].num&&(this[e]=parseFloat(this[e]))}jd[e].degrees&&(this[e]=this[e]*Ts)}).bind(this)),Math.abs(Math.abs(this.lat0)-et)<lt?this.mode=this.lat0<0?Us.S_POLE:Us.N_POLE:Math.abs(this.lat0)<lt?this.mode=Us.EQUIT:(this.mode=Us.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var s=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(s),this.sw=Math.sin(s)}function ZQ(s){s.x-=this.long0;var t=Math.sin(s.y),e=Math.cos(s.y),i=Math.cos(s.x),r,n;switch(this.mode){case Us.OBLIQ:n=this.sinph0*t+this.cosph0*e*i;break;case Us.EQUIT:n=e*i;break;case Us.S_POLE:n=-t;break;case Us.N_POLE:n=t;break}switch(n=this.pn1/(this.p-n),r=n*e*Math.sin(s.x),this.mode){case Us.OBLIQ:n*=this.cosph0*t-this.sinph0*e*i;break;case Us.EQUIT:n*=t;break;case Us.N_POLE:n*=-(e*i);break;case Us.S_POLE:n*=e*i;break}var o,a;return o=n*this.cg+r*this.sg,a=1/(o*this.sw*this.h1+this.cw),r=(r*this.cg-n*this.sg)*this.cw*a,n=o*a,s.x=r*this.a,s.y=n*this.a,s}function KQ(s){s.x/=this.a,s.y/=this.a;var t={x:s.x,y:s.y},e,i,r;r=1/(this.pn1-s.y*this.sw),e=this.pn1*s.x*r,i=this.pn1*s.y*this.cw*r,s.x=e*this.cg+i*this.sg,s.y=i*this.cg-e*this.sg;var n=sn(s.x,s.y);if(Math.abs(n)<lt)t.x=0,t.y=s.y;else{var o,a;switch(a=1-n*n*this.pfact,a=(this.p-Math.sqrt(a))/(this.pn1/n+n/this.pn1),o=Math.sqrt(1-a*a),this.mode){case Us.OBLIQ:t.y=Math.asin(o*this.sinph0+s.y*a*this.cosph0/n),s.y=(o-this.sinph0*Math.sin(t.y))*n,s.x*=a*this.cosph0;break;case Us.EQUIT:t.y=Math.asin(s.y*a/n),s.y=o*n,s.x*=a;break;case Us.N_POLE:t.y=Math.asin(o),s.y=-s.y;break;case Us.S_POLE:t.y=-Math.asin(o);break}t.x=Math.atan2(s.x,s.y)}return s.x=t.x+this.long0,s.y=t.y,s}var JQ=["Tilted_Perspective","tpers"];const QQ={init:YQ,forward:ZQ,inverse:KQ,names:JQ};function ttt(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var s=1-this.es,t=1/s;this.radius_p=Math.sqrt(s),this.radius_p2=s,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function ett(s){var t=s.x,e=s.y,i,r,n,o;if(t=t-this.long0,this.shape==="ellipse"){e=Math.atan(this.radius_p2*Math.tan(e));var a=this.radius_p/sn(this.radius_p*Math.cos(e),Math.sin(e));if(r=a*Math.cos(t)*Math.cos(e),n=a*Math.sin(t)*Math.cos(e),o=a*Math.sin(e),(this.radius_g-r)*r-n*n-o*o*this.radius_p_inv2<0)return s.x=Number.NaN,s.y=Number.NaN,s;i=this.radius_g-r,this.flip_axis?(s.x=this.radius_g_1*Math.atan(n/sn(o,i)),s.y=this.radius_g_1*Math.atan(o/i)):(s.x=this.radius_g_1*Math.atan(n/i),s.y=this.radius_g_1*Math.atan(o/sn(n,i)))}else this.shape==="sphere"&&(i=Math.cos(e),r=Math.cos(t)*i,n=Math.sin(t)*i,o=Math.sin(e),i=this.radius_g-r,this.flip_axis?(s.x=this.radius_g_1*Math.atan(n/sn(o,i)),s.y=this.radius_g_1*Math.atan(o/i)):(s.x=this.radius_g_1*Math.atan(n/i),s.y=this.radius_g_1*Math.atan(o/sn(n,i))));return s.x=s.x*this.a,s.y=s.y*this.a,s}function itt(s){var t=-1,e=0,i=0,r,n,o,a;if(s.x=s.x/this.a,s.y=s.y/this.a,this.shape==="ellipse"){this.flip_axis?(i=Math.tan(s.y/this.radius_g_1),e=Math.tan(s.x/this.radius_g_1)*sn(1,i)):(e=Math.tan(s.x/this.radius_g_1),i=Math.tan(s.y/this.radius_g_1)*sn(1,e));var l=i/this.radius_p;if(r=e*e+l*l+t*t,n=2*this.radius_g*t,o=n*n-4*r*this.C,o<0)return s.x=Number.NaN,s.y=Number.NaN,s;a=(-n-Math.sqrt(o))/(2*r),t=this.radius_g+a*t,e*=a,i*=a,s.x=Math.atan2(e,t),s.y=Math.atan(i*Math.cos(s.x)/t),s.y=Math.atan(this.radius_p_inv2*Math.tan(s.y))}else if(this.shape==="sphere"){if(this.flip_axis?(i=Math.tan(s.y/this.radius_g_1),e=Math.tan(s.x/this.radius_g_1)*Math.sqrt(1+i*i)):(e=Math.tan(s.x/this.radius_g_1),i=Math.tan(s.y/this.radius_g_1)*Math.sqrt(1+e*e)),r=e*e+i*i+t*t,n=2*this.radius_g*t,o=n*n-4*r*this.C,o<0)return s.x=Number.NaN,s.y=Number.NaN,s;a=(-n-Math.sqrt(o))/(2*r),t=this.radius_g+a*t,e*=a,i*=a,s.x=Math.atan2(e,t),s.y=Math.atan(i*Math.cos(s.x)/t)}return s.x=s.x+this.long0,s}var stt=["Geostationary Satellite View","Geostationary_Satellite","geos"];const rtt={init:ttt,forward:ett,inverse:itt,names:stt};function ntt(s){s.Proj.projections.add(Gm),s.Proj.projections.add(zm),s.Proj.projections.add(uK),s.Proj.projections.add(bK),s.Proj.projections.add(RK),s.Proj.projections.add(PK),s.Proj.projections.add($K),s.Proj.projections.add(UK),s.Proj.projections.add(qK),s.Proj.projections.add(QK),s.Proj.projections.add(mJ),s.Proj.projections.add(wJ),s.Proj.projections.add(RJ),s.Proj.projections.add(OJ),s.Proj.projections.add($J),s.Proj.projections.add(UJ),s.Proj.projections.add(qJ),s.Proj.projections.add(QJ),s.Proj.projections.add(nQ),s.Proj.projections.add(cQ),s.Proj.projections.add(fQ),s.Proj.projections.add(vQ),s.Proj.projections.add(CQ),s.Proj.projections.add(AQ),s.Proj.projections.add(kQ),s.Proj.projections.add(UQ),s.Proj.projections.add(qQ),s.Proj.projections.add(QQ),s.Proj.projections.add(rtt)}qr.defaultDatum="WGS84";qr.Proj=ho;qr.WGS84=new qr.Proj("WGS84");qr.Point=Fu;qr.toPoint=BF;qr.defs=ir;qr.nadgrid=pZ;qr.transform=O0;qr.mgrs=IZ;qr.version="__VERSION__";ntt(qr);LF(qr);window.eoxMapAdvancedOlLayers={...j7,STAC:RY};function ott(s){const t=s[0],e=new Array(t);let i=1<<t-1,r,n;for(r=0;r<t;++r)n=48,s[1]&i&&(n+=1),s[2]&i&&(n+=2),e[r]=String.fromCharCode(n),i>>=1;return e.join("")}const att='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>';class ltt extends Un{constructor(t){const e=t.hidpi!==void 0?t.hidpi:!1;super({cacheSize:t.cacheSize,crossOrigin:"anonymous",interpolate:t.interpolate,opaque:!0,projection:ct("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,tilePixelRatio:e?2:1,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.hidpi_=e,this.culture_=t.culture!==void 0?t.culture:"en-us",this.maxZoom_=t.maxZoom!==void 0?t.maxZoom:-1,this.apiKey_=t.key,this.imagerySet_=t.imagerySet,this.placeholderTiles_=t.placeholderTiles;const i="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(i).then(r=>r.json()).then(r=>this.handleImageryMetadataResponse(r))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(t){if(t.statusCode!=200||t.statusDescription!="OK"||t.authenticationResultCode!="ValidCredentials"||t.resourceSets.length!=1||t.resourceSets[0].resources.length!=1){this.setState("error");return}const e=t.resourceSets[0].resources[0],i=this.maxZoom_==-1?e.zoomMax:this.maxZoom_,r=this.getProjection(),n=Ta(r),o=this.hidpi_?2:1,a=e.imageWidth==e.imageHeight?e.imageWidth/o:[e.imageWidth/o,e.imageHeight/o],l=Vh({extent:n,minZoom:e.zoomMin,maxZoom:i,tileSize:a});this.tileGrid=l;const h=this.culture_,c=this.hidpi_,u=this.placeholderTiles_;if(this.tileUrlFunction=ng(e.imageUrlSubdomains.map(function(d){const p=[0,0,0],g=e.imageUrl.replace("{subdomain}",d).replace("{culture}",h);return function(f,m,_){if(!f)return;sg(f[0],f[1],f[2],p);const y=new URL(g.replace("{quadkey}",ott(p))),v=y.searchParams;return c&&(v.set("dpi","d1"),v.set("device","mobile")),u===!0?v.delete("n"):u===!1&&v.set("n","z"),y.toString()}})),e.imageryProviders){const d=zh(ct("EPSG:4326"),this.getProjection());this.setAttributions(p=>{const g=[],f=p.viewState,m=this.getTileGrid(),_=m.getZForResolution(f.resolution,this.zDirection),y=m.getTileCoordForCoordAndZ(f.center,_)[0];return e.imageryProviders.map(function(v){let b=!1;const E=v.coverageAreas;for(let S=0,T=E.length;S<T;++S){const R=E[S];if(y>=R.zoomMin&&y<=R.zoomMax){const M=R.bbox,A=[M[1],M[0],M[3],M[2]],O=Tu(A,d);if(li(O,p.extent)){b=!0;break}}}b&&g.push(v.attribution)}),g.push(att),g})}this.setState("ready")}}const htt=ltt;class ctt extends Ah{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,maxZoom:t.maxZoom!==void 0?t.maxZoom:18,minZoom:t.minZoom,projection:t.projection,transition:t.transition,wrapX:t.wrapX,zDirection:t.zDirection}),this.account_=t.account,this.mapId_=t.map||"",this.config_=t.config||{},this.templateCache_={},this.initializeMap_()}getConfig(){return this.config_}updateConfig(t){Object.assign(this.config_,t),this.initializeMap_()}setConfig(t){this.config_=t||{},this.initializeMap_()}initializeMap_(){const t=JSON.stringify(this.config_);if(this.templateCache_[t]){this.applyTemplate_(this.templateCache_[t]);return}let e="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(e+="/named/"+this.mapId_);const i=new XMLHttpRequest;i.addEventListener("load",this.handleInitResponse_.bind(this,t)),i.addEventListener("error",this.handleInitError_.bind(this)),i.open("POST",e),i.setRequestHeader("Content-type","application/json"),i.send(JSON.stringify(this.config_))}handleInitResponse_(t,e){const i=e.target;if(!i.status||i.status>=200&&i.status<300){let r;try{r=JSON.parse(i.responseText)}catch{this.setState("error");return}this.applyTemplate_(r),this.templateCache_[t]=r,this.setState("ready")}else this.setState("error")}handleInitError_(t){this.setState("error")}applyTemplate_(t){const e="https://"+t.cdn_url.https+"/"+this.account_+"/api/v1/map/"+t.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(e)}}const utt=ctt;class dtt extends hy{constructor(t){super({attributions:t.attributions,wrapX:t.wrapX}),this.resolution=void 0,this.distance=t.distance!==void 0?t.distance:20,this.minDistance=t.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=t.geometryFunction||function(e){const i=e.getGeometry();return ge(!i||i.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),i},this.createCustomCluster_=t.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(t.source||null)}clear(t){this.features.length=0,super.clear(t)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(t,e,i){this.source.loadFeatures(t,e,i),e!==this.resolution&&(this.resolution=e,this.refresh())}setDistance(t){this.updateDistance(t,this.minDistance)}setMinDistance(t){this.updateDistance(this.distance,t)}getMinDistance(){return this.minDistance}setSource(t){this.source&&this.source.removeEventListener(fe.CHANGE,this.boundRefresh_),this.source=t,t&&t.addEventListener(fe.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(t,e){const i=t===0?0:Math.min(e,t)/t,r=t!==this.distance||this.interpolationRatio!==i;this.distance=t,this.minDistance=e,this.interpolationRatio=i,r&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const t=Ys(),e=this.distance*this.resolution,i=this.source.getFeatures(),r={};for(let n=0,o=i.length;n<o;n++){const a=i[n];if(!(xt(a)in r)){const l=this.geometryFunction(a);if(l){const h=l.getCoordinates();Yb(h,t),ln(t,e,t);const c=this.source.getFeaturesInExtent(t).filter(function(u){const d=xt(u);return d in r?!1:(r[d]=!0,!0)});this.features.push(this.createCluster(c,t))}}}}createCluster(t,e){const i=[0,0];for(let a=t.length-1;a>=0;--a){const l=this.geometryFunction(t[a]);l?PA(i,l.getCoordinates()):t.splice(a,1)}R5(i,1/t.length);const r=vs(e),n=this.interpolationRatio,o=new xs([i[0]*(1-n)+r[0]*n,i[1]*(1-n)+r[1]*n]);return this.createCustomCluster_?this.createCustomCluster_(o,t):new Ls({geometry:o,features:t})}}const ptt=dtt,gtt='Google Maps<a class="ol-attribution-google-tos" href="https://cloud.google.com/maps-platform/terms/" target="_blank">Terms of Use</a> and <a class="ol-attribution-google-tos" href="https://policies.google.com/privacy" target="_blank">Privacy Policy</a>',ftt="https://tile.googleapis.com/v1/createSession",mtt="https://tile.googleapis.com/v1/2dtiles",_tt=22;class ytt extends Un{constructor(t){const e=!!t.highDpi,i=t.overlay!==!0,r=t.attributions||[gtt];super({attributions:r,cacheSize:t.cacheSize,crossOrigin:"anonymous",interpolate:t.interpolate,opaque:i,projection:"EPSG:3857",reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,tilePixelRatio:e?2:1,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.apiKey_=t.key,this.error_=null;const n={mapType:t.mapType||"roadmap",language:t.language||"en-US",region:t.region||"US"};t.imageFormat&&(n.imageFormat=t.imageFormat),t.scale&&(n.scale=t.scale),e&&(n.highDpi=!0),t.layerTypes&&(n.layerTypes=t.layerTypes),t.styles&&(n.styles=t.styles),t.overlay===!0&&(n.overlay=!0),this.sessionTokenRequest_=n,this.sessionRefreshId_,this.createSession_()}getError(){return this.error_}fetchSessionToken(t,e){return fetch(t,e)}async createSession_(){const t=ftt+"?key="+this.apiKey_,e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.sessionTokenRequest_)},i=await this.fetchSessionToken(t,e);if(!i.ok){try{const u=await i.json();this.error_=new Error(u.error.message)}catch{this.error_=new Error("Error fetching session token")}this.setState("error");return}const r=await i.json(),n=this.getTilePixelRatio(1),o=[r.tileWidth/n,r.tileHeight/n];this.tileGrid=Vh({extent:Ta(this.getProjection()),maxZoom:_tt,tileSize:o});const a=r.session,l=this.apiKey_;this.tileUrlFunction=function(u,d,p){const g=u[0],f=u[1],m=u[2];return`${mtt}/${g}/${f}/${m}?session=${a}&key=${l}`};const h=parseInt(r.expiry,10)*1e3,c=Math.max(h-Date.now()-60*1e3,1);this.sessionRefreshId_=setTimeout(()=>this.createSession_(),c),this.setState("ready")}disposeInternal(){clearTimeout(this.sessionRefreshId_),super.disposeInternal()}}const xtt=ytt;let ik=class extends tf{constructor(t,e,i,r,n,o,a){super(e,i,r,n,o,a),this.zoomifyImage_=null,this.tileSize_=t}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const t=super.getImage();if(this.state==X.LOADED){const e=this.tileSize_;if(t.width==e[0]&&t.height==e[1])return this.zoomifyImage_=t,t;const i=ui(e[0],e[1]);return i.drawImage(t,0,0),this.zoomifyImage_=i.canvas,i.canvas}return t}};class vtt extends Un{constructor(t){const e=t.size,i=t.tierSizeCalculation!==void 0?t.tierSizeCalculation:"default",r=t.tilePixelRatio||1,n=e[0],o=e[1],a=[],l=t.tileSize||Pu;let h=l*r;switch(i){case"default":for(;n>h||o>h;)a.push([Math.ceil(n/h),Math.ceil(o/h)]),h+=h;break;case"truncated":let S=n,T=o;for(;S>h||T>h;)a.push([Math.ceil(S/h),Math.ceil(T/h)]),S>>=1,T>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}a.push([1,1]),a.reverse();const c=[r],u=[0];for(let S=1,T=a.length;S<T;S++)c.push(r<<S),u.push(a[S-1][0]*a[S-1][1]+u[S-1]);c.reverse();const d=new Dl({tileSize:l,extent:t.extent||[0,-o,n,0],resolutions:c});let p=t.url;p&&!p.includes("{TileGroup}")&&!p.includes("{tileIndex}")&&(p+="{TileGroup}/{z}-{x}-{y}.jpg");const g=FE(p);let f=l*r;function m(S){return function(T,R,M){if(!T)return;const A=T[0],O=T[1],N=T[2],x=O+N*a[A][0],w=(x+u[A])/f|0,C={z:A,x:O,y:N,tileIndex:x,TileGroup:"TileGroup"+w};return S.replace(/\{(\w+?)\}/g,function(I,L){return C[L]})}}const _=ng(g.map(m)),y=ik.bind(null,xi(l*r));super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,tilePixelRatio:r,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:y,tileGrid:d,tileUrlFunction:_,transition:t.transition}),this.zDirection=t.zDirection;const v=d.getTileCoordForCoordAndResolution(vs(d.getExtent()),c[c.length-1]),b=_(v,1,null),E=new Image;E.addEventListener("error",()=>{f=l,this.changed()}),E.src=b}}const btt=vtt;function Gd(s){return s.toLocaleString("en",{maximumFractionDigits:10})}class wtt extends Un{constructor(t){const e=t||{};let i=e.url||"";i=i+(i.lastIndexOf("/")===i.length-1||i===""?"":"/");const r=e.version||is.VERSION2,n=e.sizes||[],o=e.size;ge(o!=null&&Array.isArray(o)&&o.length==2&&!isNaN(o[0])&&o[0]>0&&!isNaN(o[1])&&o[1]>0,"Missing or invalid `size`");const a=o[0],l=o[1],h=e.tileSize,c=e.tilePixelRatio||1,u=e.format||"jpg",d=e.quality||(e.version==is.VERSION1?"native":"default");let p=e.resolutions||[];const g=e.supports||[],f=e.extent||[0,-l,a,0],m=n!=null&&Array.isArray(n)&&n.length>0,_=h!==void 0&&(typeof h=="number"&&Number.isInteger(h)&&h>0||Array.isArray(h)&&h.length>0),y=g!=null&&Array.isArray(g)&&(g.includes("regionByPx")||g.includes("regionByPct"))&&(g.includes("sizeByWh")||g.includes("sizeByH")||g.includes("sizeByW")||g.includes("sizeByPct"));let v,b,E;if(p.sort(function(M,A){return A-M}),_||y)if(h!=null&&(typeof h=="number"&&Number.isInteger(h)&&h>0?(v=h,b=h):Array.isArray(h)&&h.length>0&&((h.length==1||h[1]==null&&Number.isInteger(h[0]))&&(v=h[0],b=h[0]),h.length==2&&(Number.isInteger(h[0])&&Number.isInteger(h[1])?(v=h[0],b=h[1]):h[0]==null&&Number.isInteger(h[1])&&(v=h[1],b=h[1])))),(v===void 0||b===void 0)&&(v=Pu,b=Pu),p.length==0){E=Math.max(Math.ceil(Math.log(a/v)/Math.LN2),Math.ceil(Math.log(l/b)/Math.LN2));for(let M=E;M>=0;M--)p.push(Math.pow(2,M))}else{const M=Math.max(...p);E=Math.round(Math.log(M)/Math.LN2)}else if(v=a,b=l,p=[],m){n.sort(function(A,O){return A[0]-O[0]}),E=-1;const M=[];for(let A=0;A<n.length;A++){const O=a/n[A][0];if(p.length>0&&p[p.length-1]==O){M.push(A);continue}p.push(O),E++}if(M.length>0)for(let A=0;A<M.length;A++)n.splice(M[A]-A,1)}else p.push(1),n.push([a,l]),E=0;const S=new Dl({tileSize:[v,b],extent:f,origin:va(f),resolutions:p}),T=function(M,A,O){let N,x;const w=M[0];if(w>E)return;const C=M[1],I=M[2],L=p[w];if(!(C===void 0||I===void 0||L===void 0||C<0||Math.ceil(a/L/v)<=C||I<0||Math.ceil(l/L/b)<=I)){if(y||_){const j=C*v*L,z=I*b*L;let B=v*L,H=b*L,Y=v,at=b;if(j+B>a&&(B=a-j),z+H>l&&(H=l-z),j+v*L>a&&(Y=Math.floor((a-j+L-1)/L)),z+b*L>l&&(at=Math.floor((l-z+L-1)/L)),j==0&&B==a&&z==0&&H==l)N="full";else if(!y||g.includes("regionByPx"))N=j+","+z+","+B+","+H;else if(g.includes("regionByPct")){const k=Gd(j/a*100),it=Gd(z/l*100),nt=Gd(B/a*100),ht=Gd(H/l*100);N="pct:"+k+","+it+","+nt+","+ht}r==is.VERSION3&&(!y||g.includes("sizeByWh"))?x=Y+","+at:!y||g.includes("sizeByW")?x=Y+",":g.includes("sizeByH")?x=","+at:g.includes("sizeByWh")?x=Y+","+at:g.includes("sizeByPct")&&(x="pct:"+Gd(100/L))}else if(N="full",m){const j=n[w][0],z=n[w][1];r==is.VERSION3?j==a&&z==l?x="max":x=j+","+z:j==a?x="full":x=j+","}else x=r==is.VERSION3?"max":"full";return i+N+"/"+x+"/0/"+d+"."+u}},R=ik.bind(null,xi(h||256).map(function(M){return M*c}));super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:e.state,tileClass:R,tileGrid:S,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:T,transition:e.transition}),this.zDirection=e.zDirection}}const Ett=wtt;function sk(s,t,e,i,r,n){const o=r.getCode().split(/:(?=\d+$)/).pop(),a=e/i,l=[Qm(Kt(t)/a,so),Qm(ci(t)/a,so)];n.SIZE=l[0]+","+l[1],n.BBOX=t.join(","),n.BBOXSR=o,n.IMAGESR=o,n.DPI=Math.round(n.DPI?n.DPI*i:90*i);const h=s.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return Ih(h,n)}function rk(s){const t=s.load?s.load:Nl,e=ct(s.projection||"EPSG:3857");return function(i,r,n){n=s.hidpi?n:1;const o={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(o,s.params),i=_y(i,r,n,s.ratio);const a=sk(s.url,i,r,n,e,o),l=new Image;return s.crossOrigin!==null&&(l.crossOrigin=s.crossOrigin),t(l,a).then(h=>{const c=Kt(i)/h.width*n;return{image:h,extent:i,resolution:c,pixelRatio:n}})}}class Stt extends jl{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.url_=t.url,this.imageLoadFunction_=t.imageLoadFunction!==void 0?t.imageLoadFunction:my,this.params_=Object.assign({},t.params),this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=t.ratio!==void 0?t.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(t,e,i,r){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==r)&&(this.loaderProjection_=r,this.loader=rk({crossOrigin:this.crossOrigin_,params:this.params_,projection:r,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(n,o)=>(this.image.setImage(n),this.imageLoadFunction_(this.image,o),Nl(n))})),super.getImageInternal(t,e,i,r))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(t){this.imageLoadFunction_=t,this.changed()}setUrl(t){t!=this.url_&&(this.url_=t,this.loader=null,this.changed())}updateParams(t){Object.assign(this.params_,t),this.changed()}changed(){this.image=null,super.changed()}}const Ctt=Stt;class Ttt extends jl{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions,state:t.state}),this.canvasFunction_=t.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=t.ratio!==void 0?t.ratio:1.5}getImageInternal(t,e,i,r){e=this.findNearestResolution(e);let n=this.canvas_;if(n&&this.renderedRevision_==this.getRevision()&&n.getResolution()==e&&n.getPixelRatio()==i&&rr(n.getExtent(),t))return n;t=t.slice(),IA(t,this.ratio_);const o=Kt(t)/e,a=ci(t)/e,l=[o*i,a*i],h=this.canvasFunction_.call(this,t,e,i,l,r);return h&&(n=new hE(t,e,i,h)),this.canvas_=n,this.renderedRevision_=this.getRevision(),n}}const Rtt=Ttt;function Mtt(s,t,e,i){const r=Kt(s),n=ci(s),o=t[0],a=t[1],l=.0254/i;return a*r>o*n?r*e/(o*l):n*e/(a*l)}function Itt(s,t,e,i,r,n,o){const a=Mtt(e,i,n,o),l=vs(e),h={OPERATION:r?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:o,SETDISPLAYWIDTH:Math.round(i[0]),SETDISPLAYHEIGHT:Math.round(i[1]),SETVIEWSCALE:a,SETVIEWCENTERX:l[0],SETVIEWCENTERY:l[1]};return Object.assign(h,t),Ih(s,h)}function nk(s){const t=s.load||Nl;return function(e,i,r){const n=new Image;s.crossOrigin!==null&&(n.crossOrigin=s.crossOrigin),e=_y(e,i,r,s.ratio);const o=Kt(e)/i,a=ci(e)/i,l=[o*r,a*r],h=Itt(s.url,s.params,e,l,s.useOverlay,s.metersPerUnit||1,s.displayDpi||96);return t(n,h).then(c=>({image:c,extent:e,pixelRatio:r}))}}class Att extends jl{constructor(t){super({interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null,this.displayDpi_=t.displayDpi!==void 0?t.displayDpi:96,this.params_=Object.assign({},t.params),this.url_=t.url,this.imageLoadFunction_=t.imageLoadFunction!==void 0?t.imageLoadFunction:my,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.metersPerUnit_=t.metersPerUnit!==void 0?t.metersPerUnit:1,this.ratio_=t.ratio!==void 0?t.ratio:1,this.useOverlay_=t.useOverlay!==void 0?t.useOverlay:!1,this.renderedRevision_=0,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(t,e,i,r){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==r)&&(this.loaderProjection_=r,this.loader=nk({crossOrigin:this.crossOrigin_,params:this.params_,hidpi:this.hidpi_,metersPerUnit:this.metersPerUnit_,url:this.url_,useOverlay:this.useOverlay_,ratio:this.ratio_,load:(n,o)=>(this.image.setImage(n),this.imageLoadFunction_(this.image,o),Nl(n))})),super.getImageInternal(t,e,i,r))}getImageLoadFunction(){return this.imageLoadFunction_}updateParams(t){Object.assign(this.params_,t),this.changed()}setImageLoadFunction(t){this.imageLoadFunction_=t,this.changed()}changed(){this.image=null,super.changed()}}const Ltt=Att;class Ptt extends jl{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null,this.url_=t.url,this.imageLoadFunction_=t.imageLoadFunction!==void 0?t.imageLoadFunction:my,this.params_=Object.assign({},t.params),this.serverType_=t.serverType,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.renderedRevision_=0,this.ratio_=t.ratio!==void 0?t.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(t,e,i,r){const n=ct(i),o=this.getProjection();o&&o!==n&&(e=ig(o,n,t,e),t=iw(t,n,o));const a={url:this.url_,params:{...this.params_,...r},projection:o||n};return Vq(a,t,e)}getLegendUrl(t,e){return Hq({url:this.url_,params:{...this.params_,...e}},t)}getParams(){return this.params_}getImageInternal(t,e,i,r){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==r)&&(this.loaderProjection_=r,this.loader=aF({crossOrigin:this.crossOrigin_,params:this.params_,projection:r,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(n,o)=>(this.image.setImage(n),this.imageLoadFunction_(this.image,o),Nl(n))})),super.getImageInternal(t,e,i,r))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(t){this.imageLoadFunction_=t,this.changed()}setUrl(t){t!=this.url_&&(this.url_=t,this.loader=null,this.changed())}updateParams(t){Object.assign(this.params_,t),this.changed()}changed(){this.image=null,super.changed()}}const Ott=Ptt,Ftt={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},ktt={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function Ntt(s,t){let e,i;for(let r=0;r<s.length;++r){const n=s[r];if(n.rel==="item"){if(n.type===t){e=n.href;break}(Ftt[n.type]||!i&&n.type.startsWith("image/"))&&(i=n.href)}}if(!e)if(i)e=i;else throw new Error('Could not find "item" link');return e}function Dtt(s,t,e){let i,r;const n={};for(let o=0;o<s.length;++o){const a=s[o];if(n[a.type]=a.href,a.rel==="item"){if(a.type===t){i=a.href;break}ktt[a.type]&&(r=a.href)}}if(!i&&e)for(let o=0;o<e.length;++o){const a=e[o];if(n[a]){i=n[a];break}}if(!i)if(r)i=r;else throw new Error('Could not find "item" link');return i}function fR(s,t,e,i){let r=s.projection;if(!r&&(r=ct(t.crs),!r))throw new Error(`Unsupported CRS: ${t.crs}`);const n=t.orderedAxes,o=(n?n.slice(0,2).map(E=>E.replace(/E|X|Lon/i,"e").replace(/N|Y|Lat/i,"n")).join(""):r.getAxisOrientation().substr(0,2))!=="en",a=t.tileMatrices,l={};for(let E=0;E<a.length;++E){const S=a[E];l[S.id]=S}const h={},c=[];if(i)for(let E=0;E<i.length;++E){const S=i[E],T=S.tileMatrix;c.push(T),h[T]=S}else for(let E=0;E<a.length;++E){const S=a[E].id;c.push(S)}const u=c.length,d=new Array(u),p=new Array(u),g=new Array(u),f=new Array(u),m=[-1/0,-1/0,1/0,1/0];for(let E=0;E<u;++E){const S=c[E],T=l[S],R=T.pointOfOrigin;o?d[E]=[R[1],R[0]]:d[E]=R,p[E]=T.cellSize,g[E]=[T.matrixWidth,T.matrixHeight],f[E]=[T.tileWidth,T.tileHeight];const M=h[S];if(M){const A=T.cellSize*T.tileWidth,O=d[E][0]+M.minTileCol*A,N=d[E][0]+(M.maxTileCol+1)*A,x=T.cellSize*T.tileHeight,w=T.cornerOfOrigin==="bottomLeft";let C,I;w?(C=d[E][1]+M.minTileRow*x,I=d[E][1]+(M.maxTileRow+1)*x):(C=d[E][1]-(M.maxTileRow+1)*x,I=d[E][1]-M.minTileRow*x),us(m,[O,C,N,I],m)}}const _=new Dl({origins:d,resolutions:p,sizes:g,tileSizes:f,extent:i?m:void 0}),y=s.context,v=s.url;function b(E,S,T){if(!E)return;const R=c[E[0]],M=l[R],A=M.cornerOfOrigin==="bottomLeft",O={tileMatrix:R,tileCol:E[1],tileRow:A?-E[2]-1:E[2]};if(i){const x=h[M.id];if(O.tileCol<x.minTileCol||O.tileCol>x.maxTileCol||O.tileRow<x.minTileRow||O.tileRow>x.maxTileRow)return}Object.assign(O,y);const N=e.replace(/\{(\w+?)\}/g,function(x,w){return O[w]});return sF(v,N)}return{grid:_,urlTemplate:e,urlFunction:b}}function $tt(s,t){const e=t.tileMatrixSetLimits;let i;if(t.dataType==="map")i=Ntt(t.links,s.mediaType);else if(t.dataType==="vector")i=Dtt(t.links,s.mediaType,s.supportedMediaTypes);else throw new Error('Expected tileset data type to be "map" or "vector"');if(t.tileMatrixSet)return fR(s,t.tileMatrixSet,i,e);const r=t.links.find(a=>a.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!r)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const n=r.href,o=sF(s.url,n);return iF(o).then(function(a){return fR(s,a,i,e)})}function ok(s){return iF(s.url).then(function(t){return $tt(s,t)})}class jtt extends Un{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition});const e={url:t.url,projection:this.getProjection(),mediaType:t.mediaType,context:t.context||null};ok(e).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(t){this.tileGrid=t.grid,this.setTileUrlFunction(t.urlFunction,t.urlTemplate),this.setState("ready")}handleError_(t){e0(t),this.setState("error")}}const Gtt=jtt;class ztt extends yy{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,format:t.format,overlaps:t.overlaps,projection:t.projection,tileClass:t.tileClass,transition:t.transition,wrapX:t.wrapX,zDirection:t.zDirection,state:"loading"});const e={url:t.url,projection:this.getProjection(),mediaType:t.mediaType,supportedMediaTypes:t.format.supportedMediaTypes,context:t.context||null};ok(e).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(t){this.tileGrid=t.grid,this.setTileUrlFunction(t.urlFunction,t.urlTemplate),this.setState("ready")}handleError_(t){e0(t),this.setState("error")}}const Btt=ztt,ak='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class Utt extends Ah{constructor(t){t=t||{};let e;t.attributions!==void 0?e=t.attributions:e=[ak];const i=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",r=t.url!==void 0?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:i,interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:19,opaque:t.opaque!==void 0?t.opaque:!0,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:r,wrapX:t.wrapX,zDirection:t.zDirection})}}const Vtt=Utt,mR=1/0;class Htt{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,ed(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,i=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const r=this.keyFunction_(i);return delete this.queuedElements_[r],i}enqueue(t){ge(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=mR?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,i=this.priorities_,r=e.length,n=e[t],o=i[t],a=t;for(;t<r>>1;){const l=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),c=h<r&&i[h]<i[l]?h:l;e[t]=e[c],i[t]=i[c],t=c}e[t]=n,i[t]=o,this.siftDown_(a,t)}siftDown_(t,e){const i=this.elements_,r=this.priorities_,n=i[e],o=r[e];for(;e>t;){const a=this.getParentIndex_(e);if(r[a]>o)i[e]=i[a],r[e]=r[a],e=a;else break}i[e]=n,r[e]=o}reprioritize(){const t=this.priorityFunction_,e=this.elements_,i=this.priorities_;let r=0;const n=e.length;let o,a,l;for(a=0;a<n;++a)o=e[a],l=t(o),l==mR?delete this.queuedElements_[this.keyFunction_(o)]:(i[r]=l,e[r++]=o);e.length=r,i.length=r,this.heapify_()}}const Wtt=Htt;class Xtt extends Wtt{constructor(t,e){super(function(i){return t.apply(null,i)},function(i){return i[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(fe.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,i=e.getState();if(i===X.LOADED||i===X.ERROR||i===X.EMPTY){i!==X.ERROR&&e.removeEventListener(fe.CHANGE,this.boundHandleTileChange_);const r=e.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let i=0,r,n,o;for(;this.tilesLoading_<t&&i<e&&this.getCount()>0;)n=this.dequeue()[0],o=n.getKey(),r=n.getState(),r===X.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++i,n.load())}}const qtt=Xtt;let lk=!0;try{new ImageData(10,10)}catch{lk=!1}let rx;function Ytt(s,t,e){if(lk)return new ImageData(s,t,e);rx||(rx=document.createElement("canvas").getContext("2d"));const i=rx.createImageData(t,e);return i.data.set(s),i}function hk(s){let t=!0;try{new ImageData(10,10)}catch{t=!1}function e(i,r,n){return t?new ImageData(i,r,n):{data:i,width:r,height:n}}return function(i){const r=i.buffers,n=i.meta,o=i.imageOps,a=i.width,l=i.height,h=r.length,c=r[0].byteLength;if(o){const g=new Array(h);for(let f=0;f<h;++f)g[f]=e(new Uint8ClampedArray(r[f]),a,l);return s(g,n).data.buffer}const u=new Uint8ClampedArray(c),d=new Array(h),p=new Array(h);for(let g=0;g<h;++g)d[g]=new Uint8ClampedArray(r[g]),p[g]=[0,0,0,0];for(let g=0;g<c;g+=4){for(let m=0;m<h;++m){const _=d[m];p[m][0]=_[g],p[m][1]=_[g+1],p[m][2]=_[g+2],p[m][3]=_[g+3]}const f=s(p,n);u[g]=f[0],u[g+1]=f[1],u[g+2]=f[2],u[g+3]=f[3]}return u.buffer}}function Ztt(s,t){const e=Object.keys(s.lib||{}).map(function(r){return"const "+r+" = "+s.lib[r].toString()+";"}).concat(["const __minion__ = ("+hk.toString()+")(",s.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),i=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(e.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(e,{type:"text/javascript"})));return i.addEventListener("message",t),i}function Ktt(s,t){const e=hk(s.operation);let i=!1;return{postMessage:function(r){setTimeout(function(){i||t({data:{buffer:e(r),meta:r.meta}})},0)},terminate:function(){i=!0}}}class Jtt extends Vb{constructor(t){super(),this._imageOps=!!t.imageOps;let e;t.threads===0?e=0:this._imageOps?e=1:e=t.threads||1;const i=new Array(e);if(e)for(let r=0;r<e;++r)i[r]=Ztt(t,this._onWorkerMessage.bind(this,r));else i[0]=Ktt(t,this._onWorkerMessage.bind(this,0));this._workers=i,this._queue=[],this._maxQueueLength=t.queue||1/0,this._running=0,this._dataLookup={},this._job=null}process(t,e,i){this._enqueue({inputs:t,meta:e,callback:i}),this._dispatch()}_enqueue(t){for(this._queue.push(t);this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)}_dispatch(){if(this._running||this._queue.length===0)return;const t=this._queue.shift();this._job=t;const e=t.inputs[0].width,i=t.inputs[0].height,r=t.inputs.map(function(l){return l.data.buffer}),n=this._workers.length;if(this._running=n,n===1){this._workers[0].postMessage({buffers:r,meta:t.meta,imageOps:this._imageOps,width:e,height:i},r);return}const o=t.inputs[0].data.length,a=4*Math.ceil(o/4/n);for(let l=0;l<n;++l){const h=l*a,c=[];for(let u=0,d=r.length;u<d;++u)c.push(r[u].slice(h,h+a));this._workers[l].postMessage({buffers:c,meta:t.meta,imageOps:this._imageOps,width:e,height:i},c)}}_onWorkerMessage(t,e){this.disposed||(this._dataLookup[t]=e.data,--this._running,this._running===0&&this._resolveJob())}_resolveJob(){const t=this._job,e=this._workers.length;let i,r;if(e===1)i=new Uint8ClampedArray(this._dataLookup[0].buffer),r=this._dataLookup[0].meta;else{const n=t.inputs[0].data.length;i=new Uint8ClampedArray(n),r=new Array(e);const o=4*Math.ceil(n/4/e);for(let a=0;a<e;++a){const l=this._dataLookup[a].buffer,h=a*o;i.set(new Uint8ClampedArray(l),h),r[a]=this._dataLookup[a].meta}}this._job=null,this._dataLookup={},t.callback(null,Ytt(i,t.inputs[0].width,t.inputs[0].height),r),this._dispatch()}disposeInternal(){for(let t=0;t<this._workers.length;++t)this._workers[t].terminate();this._workers.length=0}}const _R={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};let yR=class extends Eo{constructor(t,e,i){super(t),this.extent=e.extent,this.resolution=e.viewState.resolution/e.pixelRatio,this.data=i}},ck=class extends jl{constructor(t){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=t.operationType!==void 0?t.operationType:"pixel",this.threads_=t.threads!==void 0?t.threads:1,this.layers_=eet(t.sources);const e=this.changed.bind(this);for(let i=0,r=this.layers_.length;i<r;++i)this.layers_[i].addEventListener(fe.CHANGE,e);this.useResolutions_=t.resolutions!==null,this.tileQueue_=new qtt(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:Ki(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:tet(this.layers_),pixelRatio:1,pixelToCoordinateTransform:Ki(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:xt(this),renderTargets:{}},this.setAttributions(function(i){const r=[];for(let n=0,o=t.sources.length;n<o;++n){const a=t.sources[n],l=a instanceof ud?a:a.getSource();if(!l)continue;const h=l.getAttributions();if(typeof h=="function"){const c=h(i);r.push.apply(r,c)}}return r.length!==0?r:null}),t.operation!==void 0&&this.setOperation(t.operation,t.lib)}setOperation(t,e){this.processor_&&this.processor_.dispose(),this.processor_=new Jtt({operation:t,imageOps:this.operationType_==="image",queue:1,lib:e,threads:this.threads_}),this.changed()}updateFrameState_(t,e,i){const r=Object.assign({},this.frameState_);r.viewState=Object.assign({},r.viewState);const n=vs(t);r.size[0]=Math.ceil(Kt(t)/e),r.size[1]=Math.ceil(ci(t)/e),r.extent=[n[0]-r.size[0]*e/2,n[1]-r.size[1]*e/2,n[0]+r.size[0]*e/2,n[1]+r.size[1]*e/2],r.time=Date.now();const o=r.viewState;return o.center=n,o.projection=i,o.resolution=e,r}allSourcesReady_(){let t=!0,e;for(let i=0,r=this.layers_.length;i<r;++i)if(e=this.layers_[i].getSource(),!e||e.getState()!=="ready"){t=!1;break}return t}getImage(t,e,i,r){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),e=this.findNearestResolution(e);const n=this.updateFrameState_(t,e,r);if(this.requestedFrameState_=n,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();(e!==o||!ca(n.extent,a))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),n.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const t=this.requestedFrameState_,e=this.layers_.length,i=new Array(e);for(let n=0;n<e;++n){t.layerIndex=n,t.renderTargets={};const o=Qtt(this.layers_[n],t);if(o)i[n]=o;else return}const r={};this.dispatchEvent(new yR(_R.BEFOREOPERATIONS,t,r)),this.processor_.process(i,r,this.onWorkerComplete_.bind(this,t))}onWorkerComplete_(t,e,i,r){if(e||!i)return;const n=t.extent,o=t.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!ca(n,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{const l=Math.round(Kt(n)/o),h=Math.round(ci(n)/o);a=ui(l,h),this.renderedImageCanvas_=new hE(n,o,1,a.canvas)}a.putImageData(i,0,0),t.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new yR(_R.AFTEROPERATIONS,t,r))}getResolutions(t){if(!this.useResolutions_)return null;let e=super.getResolutions();if(!e)for(let i=0,r=this.layers_.length;i<r&&(e=this.layers_[i].getSource().getResolutions(t),!e);++i);return e}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}};ck.prototype.dispose;let Yl=null;function Qtt(s,t){const e=s.getRenderer();if(!e)throw new Error("Unsupported layer type: "+s);if(!e.prepareFrame(t))return null;const i=t.size[0],r=t.size[1];if(i===0||r===0)return null;const n=e.renderFrame(t,null);let o;if(n instanceof HTMLCanvasElement)o=n;else{if(n&&(o=n.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===i&&o.height===r)return o.getContext("2d").getImageData(0,0,i,r)}if(!Yl)Yl=ui(i,r,void 0,{willReadFrequently:!0});else{const a=Yl.canvas;a.width!==i||a.height!==r?Yl=ui(i,r,void 0,{willReadFrequently:!0}):Yl.clearRect(0,0,i,r)}return Yl.drawImage(o,0,0,i,r),Yl.getImageData(0,0,i,r)}function tet(s){return s.map(function(t){return t.getLayerState()})}function eet(s){const t=s.length,e=new Array(t);for(let i=0;i<t;++i)e[i]=iet(s[i]);return e}function iet(s){let t;return s instanceof ud?s instanceof sf?t=new E0({source:s}):s instanceof jl&&(t=new lE({source:s})):t=s,t}const set=ck,ret='&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>',net='&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>',oet='&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>',aet={stamen_terrain:{extension:"png",opaque:!0},stamen_terrain_background:{extension:"png",opaque:!0},stamen_terrain_labels:{extension:"png",opaque:!1},stamen_terrain_lines:{extension:"png",opaque:!1},stamen_toner_background:{extension:"png",opaque:!0},stamen_toner:{extension:"png",opaque:!0},stamen_toner_labels:{extension:"png",opaque:!1},stamen_toner_lines:{extension:"png",opaque:!1},stamen_toner_lite:{extension:"png",opaque:!0},stamen_watercolor:{extension:"jpg",opaque:!0},alidade_smooth:{extension:"png",opaque:!0},alidade_smooth_dark:{extension:"png",opaque:!0},outdoors:{extension:"png",opaque:!0},osm_bright:{extension:"png",opaque:!0}},het={stamen_terrain:{minZoom:0,maxZoom:18,retina:!0},stamen_toner:{minZoom:0,maxZoom:20,retina:!0},stamen_watercolor:{minZoom:1,maxZoom:18,retina:!1}};class cet extends Ah{constructor(t){const e=t.layer.indexOf("-"),i=e==-1?t.layer:t.layer.slice(0,e),r=het[i]||{minZoom:0,maxZoom:20,retina:!0},n=aet[t.layer],o=t.apiKey?"?api_key="+t.apiKey:"",a=r.retina&&t.retina?"@2x":"",l=t.url!==void 0?t.url:"https://tiles.stadiamaps.com/tiles/"+t.layer+"/{z}/{x}/{y}"+a+"."+n.extension+o,h=[ret,net,ak];t.layer.startsWith("stamen_")&&h.splice(1,0,oet),super({attributions:h,cacheSize:t.cacheSize,crossOrigin:"anonymous",interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:r.maxZoom,minZoom:t.minZoom!==void 0?t.minZoom:r.minZoom,opaque:n.opaque,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:l,tilePixelRatio:a?2:1,wrapX:t.wrapX,zDirection:t.zDirection})}}const uet=cet;class det extends Un{constructor(t){t=t||{},super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.params_=Object.assign({},t.params),this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.tmpExtent_=Ys(),this.setKey(this.getKeyForParams_())}getKeyForParams_(){let t=0;const e=[];for(const i in this.params_)e[t++]=i+"-"+this.params_[i];return e.join("/")}getParams(){return this.params_}getRequestUrl_(t,e,i,r,n,o){const a=this.urls;if(!a)return;let l;if(a.length==1)l=a[0];else{const h=Ko(rE(t),a.length);l=a[h]}return sk(l,i,(this.tileGrid||this.getTileGridForProjection(n)).getResolution(t[0]),r,n,o)}getTilePixelRatio(t){return this.hidpi_?t:1}updateParams(t){Object.assign(this.params_,t),this.setKey(this.getKeyForParams_())}tileUrlFunction(t,e,i){let r=this.getTileGrid();if(r||(r=this.getTileGridForProjection(i)),r.getResolutions().length<=t[0])return;e!=1&&!this.hidpi_&&(e=1);const n=r.getTileCoordExtent(t,this.tmpExtent_);let o=xi(r.getTileSize(t[0]),this.tmpSize);e!=1&&(o=pL(o,e,this.tmpSize));const a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(a,this.params_),this.getRequestUrl_(t,o,n,e,i,a)}}const pet=det;class get extends Ah{constructor(t){t=t||{},super({opaque:!1,projection:t.projection,tileGrid:t.tileGrid,wrapX:t.wrapX!==void 0?t.wrapX:!0,zDirection:t.zDirection,url:t.template||"z:{z} x:{x} y:{y}",tileLoadFunction:(e,i)=>{const r=e.getTileCoord()[0],n=xi(this.tileGrid.getTileSize(r)),o=ui(n[0],n[1]);o.strokeStyle="grey",o.strokeRect(.5,.5,n[0]+.5,n[1]+.5),o.fillStyle="grey",o.strokeStyle="white",o.textAlign="center",o.textBaseline="middle",o.font="24px sans-serif",o.lineWidth=4,o.strokeText(i,n[0]/2,n[1]/2,n[0]),o.fillText(i,n[0]/2,n[1]/2,n[0]),e.setImage(o.canvas)}})}}const fet=get;class met extends dd{constructor(t,e,i,r,n,o){super(t,e),this.src_=i,this.extent_=r,this.preemptive_=n,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=o}getImage(){return null}getData(t){if(!this.grid_||!this.keys_)return null;const e=(t[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),i=(t[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),r=this.grid_[Math.floor((1-i)*this.grid_.length)];if(typeof r!="string")return null;let n=r.charCodeAt(Math.floor(e*r.length));n>=93&&n--,n>=35&&n--,n-=32;let o=null;if(n in this.keys_){const a=this.keys_[n];this.data_&&a in this.data_?o=this.data_[a]:o=a}return o}forDataAtCoordinate(t,e,i){this.state==X.EMPTY&&i===!0?(this.state=X.IDLE,jp(this,fe.CHANGE,function(r){e(this.getData(t))},this),this.loadInternal_()):i===!0?setTimeout(()=>{e(this.getData(t))},0):e(this.getData(t))}getKey(){return this.src_}handleError_(){this.state=X.ERROR,this.changed()}handleLoad_(t){this.grid_=t.grid,this.keys_=t.keys,this.data_=t.data,this.state=X.LOADED,this.changed()}loadInternal_(){if(this.state==X.IDLE)if(this.state=X.LOADING,this.jsonp_)NE(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",this.src_),t.send()}}onXHRLoad_(t){const e=t.target;if(!e.status||e.status>=200&&e.status<300){let i;try{i=JSON.parse(e.responseText)}catch{this.handleError_();return}this.handleLoad_(i)}else this.handleError_()}onXHRError_(t){this.handleError_()}load(){this.preemptive_?this.loadInternal_():this.setState(X.EMPTY)}}class _et extends sf{constructor(t){if(super({projection:ct("EPSG:3857"),state:"loading",zDirection:t.zDirection}),this.preemptive_=t.preemptive!==void 0?t.preemptive:!0,this.tileUrlFunction_=Lq,this.template_=void 0,this.jsonp_=t.jsonp||!1,t.url)if(this.jsonp_)NE(t.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",t.url),e.send()}else if(t.tileJSON)this.handleTileJSONResponse(t.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(t){const e=t.target;if(!e.status||e.status>=200&&e.status<300){let i;try{i=JSON.parse(e.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(i)}else this.handleTileJSONError()}onXHRError_(t){this.handleTileJSONError()}getTemplate(){return this.template_}forDataAtCoordinateAndResolution(t,e,i,r){if(this.tileGrid){const n=this.tileGrid.getZForResolution(e,this.zDirection),o=this.tileGrid.getTileCoordForCoordAndZ(t,n);this.getTile(o[0],o[1],o[2],1,this.getProjection()).forDataAtCoordinate(t,i,r)}else r===!0?setTimeout(function(){i(null)},0):i(null)}handleTileJSONError(){this.setState("error")}handleTileJSONResponse(t){const e=ct("EPSG:4326"),i=this.getProjection();let r;if(t.bounds!==void 0){const c=zh(e,i);r=Tu(t.bounds,c)}const n=Ta(i),o=t.minzoom||0,a=t.maxzoom||22,l=Vh({extent:n,maxZoom:a,minZoom:o});this.tileGrid=l,this.template_=t.template;const h=t.grids;if(!h){this.setState("error");return}if(this.tileUrlFunction_=OE(h,l),t.attribution!==void 0){const c=r!==void 0?r:n;this.setAttributions(function(u){return li(c,u.extent)?[t.attribution]:null})}this.setState("ready")}getTile(t,e,i,r,n){const o=_o(t,e,i);if(this.tileCache.containsKey(o))return this.tileCache.get(o);const a=[t,e,i],l=this.getTileCoordForTileUrlFunction(a,n),h=this.tileUrlFunction_(l,r,n),c=new met(a,h!==void 0?X.IDLE:X.EMPTY,h!==void 0?h:"",this.tileGrid.getTileCoordExtent(a),this.preemptive_,this.jsonp_);return this.tileCache.set(o,c),c}useTile(t,e,i){const r=_o(t,e,i);this.tileCache.containsKey(r)&&this.tileCache.get(r)}}const yet=_et;function xet(s,t){const e=new iE(32),i=s.getExtent();return function(r,n){e.expireCache(),i&&(r=us(i,r));const o=s.getZForResolution(n),a=[];return s.forEachTileCoord(r,o,l=>{const h=l.toString();if(!e.containsKey(h)){const c=t(l);e.set(h,c)}a.push(e.get(h))}),a}}const vet=Object.freeze(Object.defineProperty({__proto__:null,BingMaps:htt,CartoDB:utt,Cluster:ptt,DataTile:mE,GeoTIFF:JO,Google:xtt,IIIF:Ett,Image:jl,ImageArcGISRest:Ctt,ImageCanvas:Rtt,ImageMapGuide:Ltt,ImageStatic:tF,ImageWMS:Ott,OGCMapTile:Gtt,OGCVectorTile:Btt,OSM:Vtt,Raster:set,Source:ud,StadiaMaps:uet,Tile:sf,TileArcGISRest:pet,TileDebug:fet,TileImage:Un,TileJSON:rF,TileWMS:lF,UTFGrid:yet,UrlTile:kE,Vector:hy,VectorTile:yy,WMTS:hF,XYZ:Ah,Zoomify:btt,createArcGISRestLoader:rk,createMapGuideLoader:nk,createStaticLoader:QO,createWMSLoader:aF,sourcesFromTileGrid:xet},Symbol.toStringTag,{value:"Module"}));window.eoxMapAdvancedOlSources=vet;var bet=Object.defineProperty,wet=(s,t,e)=>t in s?bet(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,Eet=(s,t,e)=>(wet(s,typeof t!="symbol"?t+"":t,e),e);/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Bm=globalThis,YE=Bm.ShadowRoot&&(Bm.ShadyCSS===void 0||Bm.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,uk=Symbol(),xR=new WeakMap;let Cet=class{constructor(s,t,e){if(this._$cssResult$=!0,e!==uk)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=s,this.t=t}get styleSheet(){let s=this.o;const t=this.t;if(YE&&s===void 0){const e=t!==void 0&&t.length===1;e&&(s=xR.get(t)),s===void 0&&((this.o=s=new CSSStyleSheet).replaceSync(this.cssText),e&&xR.set(t,s))}return s}toString(){return this.cssText}};const Tet=s=>new Cet(typeof s=="string"?s:s+"",void 0,uk),Ret=(s,t)=>{if(YE)s.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const e of t){const i=document.createElement("style"),r=Bm.litNonce;r!==void 0&&i.setAttribute("nonce",r),i.textContent=e.cssText,s.appendChild(i)}},vR=YE?s=>s:s=>s instanceof CSSStyleSheet?(t=>{let e="";for(const i of t.cssRules)e+=i.cssText;return Tet(e)})(s):s;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:Met,defineProperty:Iet,getOwnPropertyDescriptor:Aet,getOwnPropertyNames:Let,getOwnPropertySymbols:Pet,getPrototypeOf:Oet}=Object,Nu=globalThis,bR=Nu.trustedTypes,Fet=bR?bR.emptyScript:"",wR=Nu.reactiveElementPolyfillSupport,vp=(s,t)=>s,N0={toAttribute(s,t){switch(t){case Boolean:s=s?Fet:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,t){let e=s;switch(t){case Boolean:e=s!==null;break;case Number:e=s===null?null:Number(s);break;case Object:case Array:try{e=JSON.parse(s)}catch{e=null}}return e}},ZE=(s,t)=>!Met(s,t),ER={attribute:!0,type:String,converter:N0,reflect:!1,hasChanged:ZE};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Nu.litPropertyMetadata??(Nu.litPropertyMetadata=new WeakMap);let Rc=class extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??(this.l=[])).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=ER){if(e.state&&(e.attribute=!1),this._$Ei(),this.elementProperties.set(t,e),!e.noAccessor){const i=Symbol(),r=this.getPropertyDescriptor(t,i,e);r!==void 0&&Iet(this.prototype,t,r)}}static getPropertyDescriptor(t,e,i){const{get:r,set:n}=Aet(this.prototype,t)??{get(){return this[e]},set(o){this[e]=o}};return{get(){return r==null?void 0:r.call(this)},set(o){const a=r==null?void 0:r.call(this);n.call(this,o),this.requestUpdate(t,a,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??ER}static _$Ei(){if(this.hasOwnProperty(vp("elementProperties")))return;const t=Oet(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(vp("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(vp("properties"))){const e=this.properties,i=[...Let(e),...Pet(e)];for(const r of i)this.createProperty(r,e[r])}const t=this[Symbol.metadata];if(t!==null){const e=litPropertyMetadata.get(t);if(e!==void 0)for(const[i,r]of e)this.elementProperties.set(i,r)}this._$Eh=new Map;for(const[e,i]of this.elementProperties){const r=this._$Eu(e,i);r!==void 0&&this._$Eh.set(r,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const r of i)e.unshift(vR(r))}else t!==void 0&&e.push(vR(t));return e}static _$Eu(t,e){const i=e.attribute;return i===!1?void 0:typeof i=="string"?i:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var t;this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),(t=this.constructor.l)==null||t.forEach(e=>e(this))}addController(t){var e;(this._$EO??(this._$EO=new Set)).add(t),this.renderRoot!==void 0&&this.isConnected&&((e=t.hostConnected)==null||e.call(t))}removeController(t){var e;(e=this._$EO)==null||e.delete(t)}_$E_(){const t=new Map,e=this.constructor.elementProperties;for(const i of e.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return Ret(t,this.constructor.elementStyles),t}connectedCallback(){var t;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$EO)==null||t.forEach(e=>{var i;return(i=e.hostConnected)==null?void 0:i.call(e)})}enableUpdating(t){}disconnectedCallback(){var t;(t=this._$EO)==null||t.forEach(e=>{var i;return(i=e.hostDisconnected)==null?void 0:i.call(e)})}attributeChangedCallback(t,e,i){this._$AK(t,i)}_$EC(t,e){var i;const r=this.constructor.elementProperties.get(t),n=this.constructor._$Eu(t,r);if(n!==void 0&&r.reflect===!0){const o=(((i=r.converter)==null?void 0:i.toAttribute)!==void 0?r.converter:N0).toAttribute(e,r.type);this._$Em=t,o==null?this.removeAttribute(n):this.setAttribute(n,o),this._$Em=null}}_$AK(t,e){var i;const r=this.constructor,n=r._$Eh.get(t);if(n!==void 0&&this._$Em!==n){const o=r.getPropertyOptions(n),a=typeof o.converter=="function"?{fromAttribute:o.converter}:((i=o.converter)==null?void 0:i.fromAttribute)!==void 0?o.converter:N0;this._$Em=n,this[n]=a.fromAttribute(e,o.type),this._$Em=null}}requestUpdate(t,e,i){if(t!==void 0){if(i??(i=this.constructor.getPropertyOptions(t)),!(i.hasChanged??ZE)(this[t],e))return;this.P(t,e,i)}this.isUpdatePending===!1&&(this._$ES=this._$ET())}P(t,e,i){this._$AL.has(t)||this._$AL.set(t,e),i.reflect===!0&&this._$Em!==t&&(this._$Ej??(this._$Ej=new Set)).add(t)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[n,o]of this._$Ep)this[n]=o;this._$Ep=void 0}const r=this.constructor.elementProperties;if(r.size>0)for(const[n,o]of r)o.wrapped!==!0||this._$AL.has(n)||this[n]===void 0||this.P(n,this[n],o)}let e=!1;const i=this._$AL;try{e=this.shouldUpdate(i),e?(this.willUpdate(i),(t=this._$EO)==null||t.forEach(r=>{var n;return(n=r.hostUpdate)==null?void 0:n.call(r)}),this.update(i)):this._$EU()}catch(r){throw e=!1,this._$EU(),r}e&&this._$AE(i)}willUpdate(t){}_$AE(t){var e;(e=this._$EO)==null||e.forEach(i=>{var r;return(r=i.hostUpdated)==null?void 0:r.call(i)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Ej&&(this._$Ej=this._$Ej.forEach(e=>this._$EC(e,this[e]))),this._$EU()}updated(t){}firstUpdated(t){}};Rc.elementStyles=[],Rc.shadowRootOptions={mode:"open"},Rc[vp("elementProperties")]=new Map,Rc[vp("finalized")]=new Map,wR==null||wR({ReactiveElement:Rc}),(Nu.reactiveElementVersions??(Nu.reactiveElementVersions=[])).push("2.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const D0=globalThis,$0=D0.trustedTypes,SR=$0?$0.createPolicy("lit-html",{createHTML:s=>s}):void 0,dk="$lit$",el=`lit$${(Math.random()+"").slice(9)}$`,pk="?"+el,ket=`<${pk}>`,Oh=document,cg=()=>Oh.createComment(""),ug=s=>s===null||typeof s!="object"&&typeof s!="function",gk=Array.isArray,Net=s=>gk(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",nx=`[ 	
\f\r]`,zd=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,CR=/-->/g,TR=/>/g,Zl=RegExp(`>|${nx}(?:([^\\s"'>=/]+)(${nx}*=${nx}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),RR=/'/g,MR=/"/g,fk=/^(?:script|style|textarea|title)$/i,Det=s=>(t,...e)=>({_$litType$:s,strings:t,values:e}),pu=Det(1),Du=Symbol.for("lit-noChange"),_s=Symbol.for("lit-nothing"),IR=new WeakMap,uh=Oh.createTreeWalker(Oh,129);function mk(s,t){if(!Array.isArray(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return SR!==void 0?SR.createHTML(t):t}const $et=(s,t)=>{const e=s.length-1,i=[];let r,n=t===2?"<svg>":"",o=zd;for(let a=0;a<e;a++){const l=s[a];let h,c,u=-1,d=0;for(;d<l.length&&(o.lastIndex=d,c=o.exec(l),c!==null);)d=o.lastIndex,o===zd?c[1]==="!--"?o=CR:c[1]!==void 0?o=TR:c[2]!==void 0?(fk.test(c[2])&&(r=RegExp("</"+c[2],"g")),o=Zl):c[3]!==void 0&&(o=Zl):o===Zl?c[0]===">"?(o=r??zd,u=-1):c[1]===void 0?u=-2:(u=o.lastIndex-c[2].length,h=c[1],o=c[3]===void 0?Zl:c[3]==='"'?MR:RR):o===MR||o===RR?o=Zl:o===CR||o===TR?o=zd:(o=Zl,r=void 0);const p=o===Zl&&s[a+1].startsWith("/>")?" ":"";n+=o===zd?l+ket:u>=0?(i.push(h),l.slice(0,u)+dk+l.slice(u)+el+p):l+el+(u===-2?a:p)}return[mk(s,n+(s[e]||"<?>")+(t===2?"</svg>":"")),i]};class dg{constructor({strings:t,_$litType$:e},i){let r;this.parts=[];let n=0,o=0;const a=t.length-1,l=this.parts,[h,c]=$et(t,e);if(this.el=dg.createElement(h,i),uh.currentNode=this.el.content,e===2){const u=this.el.content.firstChild;u.replaceWith(...u.childNodes)}for(;(r=uh.nextNode())!==null&&l.length<a;){if(r.nodeType===1){if(r.hasAttributes())for(const u of r.getAttributeNames())if(u.endsWith(dk)){const d=c[o++],p=r.getAttribute(u).split(el),g=/([.?@])?(.*)/.exec(d);l.push({type:1,index:n,name:g[2],strings:p,ctor:g[1]==="."?Get:g[1]==="?"?zet:g[1]==="@"?Bet:wy}),r.removeAttribute(u)}else u.startsWith(el)&&(l.push({type:6,index:n}),r.removeAttribute(u));if(fk.test(r.tagName)){const u=r.textContent.split(el),d=u.length-1;if(d>0){r.textContent=$0?$0.emptyScript:"";for(let p=0;p<d;p++)r.append(u[p],cg()),uh.nextNode(),l.push({type:2,index:++n});r.append(u[d],cg())}}}else if(r.nodeType===8)if(r.data===pk)l.push({type:2,index:n});else{let u=-1;for(;(u=r.data.indexOf(el,u+1))!==-1;)l.push({type:7,index:n}),u+=el.length-1}n++}}static createElement(t,e){const i=Oh.createElement("template");return i.innerHTML=t,i}}function $u(s,t,e=s,i){var r,n;if(t===Du)return t;let o=i!==void 0?(r=e._$Co)==null?void 0:r[i]:e._$Cl;const a=ug(t)?void 0:t._$litDirective$;return(o==null?void 0:o.constructor)!==a&&((n=o==null?void 0:o._$AO)==null||n.call(o,!1),a===void 0?o=void 0:(o=new a(s),o._$AT(s,e,i)),i!==void 0?(e._$Co??(e._$Co=[]))[i]=o:e._$Cl=o),o!==void 0&&(t=$u(s,o._$AS(s,t.values),o,i)),t}class jet{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:i}=this._$AD,r=((t==null?void 0:t.creationScope)??Oh).importNode(e,!0);uh.currentNode=r;let n=uh.nextNode(),o=0,a=0,l=i[0];for(;l!==void 0;){if(o===l.index){let h;l.type===2?h=new uf(n,n.nextSibling,this,t):l.type===1?h=new l.ctor(n,l.name,l.strings,this,t):l.type===6&&(h=new Uet(n,this,t)),this._$AV.push(h),l=i[++a]}o!==(l==null?void 0:l.index)&&(n=uh.nextNode(),o++)}return uh.currentNode=Oh,r}p(t){let e=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(t,i,e),e+=i.strings.length-2):i._$AI(t[e])),e++}}class uf{get _$AU(){var t;return((t=this._$AM)==null?void 0:t._$AU)??this._$Cv}constructor(t,e,i,r){this.type=2,this._$AH=_s,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=r,this._$Cv=(r==null?void 0:r.isConnected)??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=$u(this,t,e),ug(t)?t===_s||t==null||t===""?(this._$AH!==_s&&this._$AR(),this._$AH=_s):t!==this._$AH&&t!==Du&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):Net(t)?this.k(t):this._(t)}S(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.S(t))}_(t){this._$AH!==_s&&ug(this._$AH)?this._$AA.nextSibling.data=t:this.T(Oh.createTextNode(t)),this._$AH=t}$(t){var e;const{values:i,_$litType$:r}=t,n=typeof r=="number"?this._$AC(t):(r.el===void 0&&(r.el=dg.createElement(mk(r.h,r.h[0]),this.options)),r);if(((e=this._$AH)==null?void 0:e._$AD)===n)this._$AH.p(i);else{const o=new jet(n,this),a=o.u(this.options);o.p(i),this.T(a),this._$AH=o}}_$AC(t){let e=IR.get(t.strings);return e===void 0&&IR.set(t.strings,e=new dg(t)),e}k(t){gk(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let i,r=0;for(const n of t)r===e.length?e.push(i=new uf(this.S(cg()),this.S(cg()),this,this.options)):i=e[r],i._$AI(n),r++;r<e.length&&(this._$AR(i&&i._$AB.nextSibling,r),e.length=r)}_$AR(t=this._$AA.nextSibling,e){var i;for((i=this._$AP)==null?void 0:i.call(this,!1,!0,e);t&&t!==this._$AB;){const r=t.nextSibling;t.remove(),t=r}}setConnected(t){var e;this._$AM===void 0&&(this._$Cv=t,(e=this._$AP)==null||e.call(this,t))}}let wy=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,i,r,n){this.type=1,this._$AH=_s,this._$AN=void 0,this.element=t,this.name=e,this._$AM=r,this.options=n,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=_s}_$AI(t,e=this,i,r){const n=this.strings;let o=!1;if(n===void 0)t=$u(this,t,e,0),o=!ug(t)||t!==this._$AH&&t!==Du,o&&(this._$AH=t);else{const a=t;let l,h;for(t=n[0],l=0;l<n.length-1;l++)h=$u(this,a[i+l],e,l),h===Du&&(h=this._$AH[l]),o||(o=!ug(h)||h!==this._$AH[l]),h===_s?t=_s:t!==_s&&(t+=(h??"")+n[l+1]),this._$AH[l]=h}o&&!r&&this.j(t)}j(t){t===_s?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}};class Get extends wy{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===_s?void 0:t}}class zet extends wy{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==_s)}}class Bet extends wy{constructor(t,e,i,r,n){super(t,e,i,r,n),this.type=5}_$AI(t,e=this){if((t=$u(this,t,e,0)??_s)===Du)return;const i=this._$AH,r=t===_s&&i!==_s||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,n=t!==_s&&(i===_s||r);r&&this.element.removeEventListener(this.name,this,i),n&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e;typeof this._$AH=="function"?this._$AH.call(((e=this.options)==null?void 0:e.host)??this.element,t):this._$AH.handleEvent(t)}}class Uet{constructor(t,e,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){$u(this,t)}}const AR=D0.litHtmlPolyfillSupport;AR==null||AR(dg,uf),(D0.litHtmlVersions??(D0.litHtmlVersions=[])).push("3.1.2");const _k=(s,t,e)=>{const i=(e==null?void 0:e.renderBefore)??t;let r=i._$litPart$;if(r===void 0){const n=(e==null?void 0:e.renderBefore)??null;i._$litPart$=r=new uf(t.insertBefore(cg(),n),n,void 0,e??{})}return r._$AI(s),r};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let gu=class extends Rc{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t;const e=super.createRenderRoot();return(t=this.renderOptions).renderBefore??(t.renderBefore=e.firstChild),e}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=_k(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),(t=this._$Do)==null||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),(t=this._$Do)==null||t.setConnected(!1)}render(){return Du}};var LR;gu._$litElement$=!0,gu.finalized=!0,(LR=globalThis.litElementHydrateSupport)==null||LR.call(globalThis,{LitElement:gu});const PR=globalThis.litElementPolyfillSupport;PR==null||PR({LitElement:gu});(globalThis.litElementVersions??(globalThis.litElementVersions=[])).push("4.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Vet=s=>(t,e)=>{e!==void 0?e.addInitializer(()=>{customElements.define(s,t)}):customElements.define(s,t)};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Het={attribute:!0,type:String,converter:N0,reflect:!1,hasChanged:ZE},Wet=(s=Het,t,e)=>{const{kind:i,metadata:r}=e;let n=globalThis.litPropertyMetadata.get(r);if(n===void 0&&globalThis.litPropertyMetadata.set(r,n=new Map),n.set(e.name,s),i==="accessor"){const{name:o}=e;return{set(a){const l=t.get.call(this);t.set.call(this,a),this.requestUpdate(o,l,s)},init(a){return a!==void 0&&this.P(o,void 0,s),a}}}if(i==="setter"){const{name:o}=e;return function(a){const l=this[o];t.call(this,a),this.requestUpdate(o,l,s)}}throw Error("Unsupported decorator location: "+i)};function Ma(s){return(t,e)=>typeof e=="object"?Wet(s,t,e):((i,r,n)=>{const o=r.hasOwnProperty(n);return r.constructor.createProperty(n,o?{...i,wrapped:!0}:i),o?Object.getOwnPropertyDescriptor(r,n):void 0})(s,t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Ey(s){return Ma({...s,state:!0,attribute:!1})}class Xet{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}function qet(s){s.stopPropagation()}const mn=Xet,Fh={PROPERTYCHANGE:"propertychange"};class Yet{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}const KE=Yet;function Zet(s,t,e){let i,r;e=e||ga;let n=0,o=s.length,a=!1;for(;n<o;)i=n+(o-n>>1),r=+e(s[i],t),r<0?n=i+1:(o=i,a=!r);return a?n:~n}function ga(s,t){return s>t?1:s<t?-1:0}function Sy(s,t,e){if(s[0]<=t)return 0;const i=s.length;if(t<=s[i-1])return i-1;if(typeof e=="function"){for(let r=1;r<i;++r){const n=s[r];if(n===t)return r;if(n<t)return e(t,s[r-1],n)>0?r-1:r}return i-1}if(e>0){for(let r=1;r<i;++r)if(s[r]<t)return r-1;return i-1}if(e<0){for(let r=1;r<i;++r)if(s[r]<=t)return r;return i-1}for(let r=1;r<i;++r){if(s[r]==t)return r;if(s[r]<t)return s[r-1]-t<t-s[r]?r-1:r}return i-1}function Ket(s,t,e){for(;t<e;){const i=s[t];s[t]=s[e],s[e]=i,++t,--e}}function qe(s,t){const e=Array.isArray(t)?t:[t],i=e.length;for(let r=0;r<i;r++)s[s.length]=e[r]}function Ia(s,t){const e=s.length;if(e!==t.length)return!1;for(let i=0;i<e;i++)if(s[i]!==t[i])return!1;return!0}function Jet(s,t,e){const i=t||ga;return s.every(function(r,n){if(n===0)return!0;const o=i(s[n-1],r);return!(o>0||e&&o===0)})}function ju(){return!0}function md(){return!1}function Gu(){}function yk(s){let t=!1,e,i,r;return function(){const n=Array.prototype.slice.call(arguments);return(!t||this!==r||!Ia(n,i))&&(t=!0,r=this,i=n,e=s.apply(this,arguments)),e}}function Qet(s){function t(){let e;try{e=s()}catch(i){return Promise.reject(i)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function df(s){for(const t in s)delete s[t]}function Al(s){let t;for(t in s)return!1;return!t}class tit extends KE{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),r=i[t]||(i[t]=[]);r.includes(e)||r.push(e)}dispatchEvent(t){const e=typeof t=="string",i=e?t:t.type,r=this.listeners_&&this.listeners_[i];if(!r)return;const n=e?new mn(t):t;n.target||(n.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});i in o||(o[i]=0,a[i]=0),++o[i];let l;for(let h=0,c=r.length;h<c;++h)if("handleEvent"in r[h]?l=r[h].handleEvent(n):l=r[h].call(this,n),l===!1||n.propagationStopped){l=!1;break}if(--o[i]===0){let h=a[i];for(delete a[i];h--;)this.removeEventListener(i,Gu);delete o[i]}return l}disposeInternal(){this.listeners_&&df(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const i=this.listeners_[t];if(!i)return;const r=i.indexOf(e);r!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[r]=Gu,++this.pendingRemovals_[t]):(i.splice(r,1),i.length===0&&delete this.listeners_[t]))}}const pf=tit,Mt={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function ae(s,t,e,i,r){if(i&&i!==s&&(e=e.bind(i)),r){const o=e;e=function(){s.removeEventListener(t,e),o.apply(this,arguments)}}const n={target:s,type:t,listener:e};return s.addEventListener(t,e),n}function pg(s,t,e,i){return ae(s,t,e,i,!0)}function ii(s){s&&s.target&&(s.target.removeEventListener(s.type,s.listener),df(s))}let Cy=class extends pf{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(Mt.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,r=new Array(i);for(let n=0;n<i;++n)r[n]=ae(this,t[n],e);return r}return ae(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const r=t.length;i=new Array(r);for(let n=0;n<r;++n)i[n]=pg(this,t[n],e)}else i=pg(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)eit(i);else if(Array.isArray(t))for(let r=0,n=t.length;r<n;++r)this.removeEventListener(t[r],e);else this.removeEventListener(t,e)}};Cy.prototype.on;Cy.prototype.once;Cy.prototype.un;function eit(s){if(Array.isArray(s))for(let t=0,e=s.length;t<e;++t)ii(s[t]);else ii(s)}const xk=Cy;function Xt(){throw new Error("Unimplemented abstract method.")}let iit=0;function Nt(s){return s.ol_uid||(s.ol_uid=String(++iit))}class OR extends mn{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}class sit extends xk{constructor(t){super(),this.on,this.once,this.un,Nt(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let i;i=`change:${t}`,this.hasListener(i)&&this.dispatchEvent(new OR(i,t,e)),i=Fh.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new OR(i,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const r=this.values_||(this.values_={});if(i)r[t]=e;else{const n=r[t];r[t]=e,n!==e&&this.notify(t,n)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],Al(this.values_)&&(this.values_=null),e||this.notify(t,i)}}}const Vn=sit,Vs={ADD:"add",REMOVE:"remove"},FR={LENGTH:"length"};class lm extends mn{constructor(t,e,i){super(t),this.element=e,this.index=i}}class rit extends Vn{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let i=0,r=this.array_.length;i<r;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,i=t.length;e<i;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let i=0,r=e.length;i<r;++i)t(e[i],i,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(FR.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new lm(Vs.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let i=0,r=e.length;i<r;++i)if(e[i]===t)return this.removeAt(i)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new lm(Vs.REMOVE,e,t)),e}setAt(t,e){const i=this.getLength();if(t>=i){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const r=this.array_[t];this.array_[t]=e,this.dispatchEvent(new lm(Vs.REMOVE,r,t)),this.dispatchEvent(new lm(Vs.ADD,e,t))}updateLength_(){this.set(FR.LENGTH,this.array_.length)}assertUnique_(t,e){for(let i=0,r=this.array_.length;i<r;++i)if(this.array_[i]===t&&i!==e)throw new Error("Duplicate item added to a unique collection")}}const or=rit,ti={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};function Te(s,t){if(!s)throw new Error(t)}function Oi(s,t,e){return Math.min(Math.max(s,t),e)}function nit(s,t,e,i,r,n){const o=r-e,a=n-i;if(o!==0||a!==0){const l=((s-e)*o+(t-i)*a)/(o*o+a*a);l>1?(e=r,i=n):l>0&&(e+=o*l,i+=a*l)}return ia(s,t,e,i)}function ia(s,t,e,i){const r=e-s,n=i-t;return r*r+n*n}function oit(s){const t=s.length;for(let i=0;i<t;i++){let r=i,n=Math.abs(s[i][i]);for(let a=i+1;a<t;a++){const l=Math.abs(s[a][i]);l>n&&(n=l,r=a)}if(n===0)return null;const o=s[r];s[r]=s[i],s[i]=o;for(let a=i+1;a<t;a++){const l=-s[a][i]/s[i][i];for(let h=i;h<t+1;h++)i==h?s[a][h]=0:s[a][h]+=l*s[i][h]}}const e=new Array(t);for(let i=t-1;i>=0;i--){e[i]=s[i][t]/s[i][i];for(let r=i-1;r>=0;r--)s[r][t]-=s[r][i]*e[i]}return e}function El(s){return s*Math.PI/180}function Eh(s,t){const e=s%t;return e*t<0?e+t:e}function Gr(s,t,e){return s+e*(t-s)}function gf(s,t){const e=Math.pow(10,t);return Math.round(s*e)/e}function kR(s,t){return Math.round(gf(s,t))}function Qc(s,t){return Math.floor(gf(s,t))}function ul(s,t){return Math.ceil(gf(s,t))}class ait extends Vn{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[ti.OPACITY]=t.opacity!==void 0?t.opacity:1,Te(typeof e[ti.OPACITY]=="number","Layer opacity must be a number"),e[ti.VISIBLE]=t.visible!==void 0?t.visible:!0,e[ti.Z_INDEX]=t.zIndex,e[ti.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[ti.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[ti.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[ti.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},i=this.getZIndex();return e.opacity=Oi(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=i===void 0&&!e.managed?1/0:i,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return Xt()}getLayerStatesArray(t){return Xt()}getExtent(){return this.get(ti.EXTENT)}getMaxResolution(){return this.get(ti.MAX_RESOLUTION)}getMinResolution(){return this.get(ti.MIN_RESOLUTION)}getMinZoom(){return this.get(ti.MIN_ZOOM)}getMaxZoom(){return this.get(ti.MAX_ZOOM)}getOpacity(){return this.get(ti.OPACITY)}getSourceState(){return Xt()}getVisible(){return this.get(ti.VISIBLE)}getZIndex(){return this.get(ti.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(ti.EXTENT,t)}setMaxResolution(t){this.set(ti.MAX_RESOLUTION,t)}setMinResolution(t){this.set(ti.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(ti.MAX_ZOOM,t)}setMinZoom(t){this.set(ti.MIN_ZOOM,t)}setOpacity(t){Te(typeof t=="number","Layer opacity must be a number"),this.set(ti.OPACITY,t)}setVisible(t){this.set(ti.VISIBLE,t)}setZIndex(t){this.set(ti.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const vk=ait,on={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},Si={ANIMATING:0,INTERACTING:1},kr={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},bk=42,JE=256,zu={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class lit{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||zu[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const QE=lit,ff=6378137,tu=Math.PI*ff,hit=[-tu,-tu,tu,tu],cit=[-180,-85,180,85],hm=ff*Math.log(Math.tan(Math.PI/2));let dc=class extends QE{constructor(t){super({code:t,units:"m",extent:hit,global:!0,worldExtent:cit,getPointResolution:function(e,i){return e/Math.cosh(i[1]/ff)}})}};const NR=[new dc("EPSG:3857"),new dc("EPSG:102100"),new dc("EPSG:102113"),new dc("EPSG:900913"),new dc("http://www.opengis.net/def/crs/EPSG/0/3857"),new dc("http://www.opengis.net/gml/srs/epsg.xml#3857")];function uit(s,t,e){const i=s.length;e=e>1?e:2,t===void 0&&(e>2?t=s.slice():t=new Array(i));for(let r=0;r<i;r+=e){t[r]=tu*s[r]/180;let n=ff*Math.log(Math.tan(Math.PI*(+s[r+1]+90)/360));n>hm?n=hm:n<-hm&&(n=-hm),t[r+1]=n}return t}function dit(s,t,e){const i=s.length;e=e>1?e:2,t===void 0&&(e>2?t=s.slice():t=new Array(i));for(let r=0;r<i;r+=e)t[r]=180*s[r]/tu,t[r+1]=360*Math.atan(Math.exp(s[r+1]/ff))/Math.PI-90;return t}const pit=6378137,DR=[-180,-90,180,90],git=Math.PI*pit/180;let Kl=class extends QE{constructor(t,e){super({code:t,units:"degrees",extent:DR,axisOrientation:e,global:!0,metersPerUnit:git,worldExtent:DR})}};const $R=[new Kl("CRS:84"),new Kl("EPSG:4326","neu"),new Kl("urn:ogc:def:crs:OGC:1.3:CRS84"),new Kl("urn:ogc:def:crs:OGC:2:84"),new Kl("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Kl("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Kl("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Kv={};function fit(s){return Kv[s]||Kv[s.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function mit(s,t){Kv[s]=t}let fu={};function j0(s,t,e){const i=s.getCode(),r=t.getCode();i in fu||(fu[i]={}),fu[i][r]=e}function _it(s,t){let e;return s in fu&&t in fu[s]&&(e=fu[s][t]),e}const ms={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function yr(s){const t=Yr();for(let e=0,i=s.length;e<i;++e)wp(t,s[e]);return t}function hn(s,t,e){return e?(e[0]=s[0]-t,e[1]=s[1]-t,e[2]=s[2]+t,e[3]=s[3]+t,e):[s[0]-t,s[1]-t,s[2]+t,s[3]+t]}function wk(s,t){return t?(t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t):s.slice()}function Hh(s,t,e){let i,r;return t<s[0]?i=s[0]-t:s[2]<t?i=t-s[2]:i=0,e<s[1]?r=s[1]-e:s[3]<e?r=e-s[3]:r=0,i*i+r*r}function kh(s,t){return tS(s,t[0],t[1])}function an(s,t){return s[0]<=t[0]&&t[2]<=s[2]&&s[1]<=t[1]&&t[3]<=s[3]}function tS(s,t,e){return s[0]<=t&&t<=s[2]&&s[1]<=e&&e<=s[3]}function Jv(s,t){const e=s[0],i=s[1],r=s[2],n=s[3],o=t[0],a=t[1];let l=ms.UNKNOWN;return o<e?l=l|ms.LEFT:o>r&&(l=l|ms.RIGHT),a<i?l=l|ms.BELOW:a>n&&(l=l|ms.ABOVE),l===ms.UNKNOWN&&(l=ms.INTERSECTING),l}function Yr(){return[1/0,1/0,-1/0,-1/0]}function fa(s,t,e,i,r){return r?(r[0]=s,r[1]=t,r[2]=e,r[3]=i,r):[s,t,e,i]}function mf(s){return fa(1/0,1/0,-1/0,-1/0,s)}function bp(s,t){const e=s[0],i=s[1];return fa(e,i,e,i,t)}function eS(s,t,e,i,r){const n=mf(r);return Sk(n,s,t,e,i)}function Ll(s,t){return s[0]==t[0]&&s[2]==t[2]&&s[1]==t[1]&&s[3]==t[3]}function Ek(s,t){return t[0]<s[0]&&(s[0]=t[0]),t[2]>s[2]&&(s[2]=t[2]),t[1]<s[1]&&(s[1]=t[1]),t[3]>s[3]&&(s[3]=t[3]),s}function wp(s,t){t[0]<s[0]&&(s[0]=t[0]),t[0]>s[2]&&(s[2]=t[0]),t[1]<s[1]&&(s[1]=t[1]),t[1]>s[3]&&(s[3]=t[1])}function Sk(s,t,e,i,r){for(;e<i;e+=r)yit(s,t[e],t[e+1]);return s}function yit(s,t,e){s[0]=Math.min(s[0],t),s[1]=Math.min(s[1],e),s[2]=Math.max(s[2],t),s[3]=Math.max(s[3],e)}function iS(s,t){let e;return e=t(Bu(s)),e||(e=t(_d(s)),e)||(e=t(_f(s)),e)||(e=t(Co(s)),e)?e:!1}function Qv(s){let t=0;return yd(s)||(t=Fe(s)*hs(s)),t}function Bu(s){return[s[0],s[1]]}function _d(s){return[s[2],s[1]]}function xo(s){return[(s[0]+s[2])/2,(s[1]+s[3])/2]}function xit(s,t){let e;if(t==="bottom-left")e=Bu(s);else if(t==="bottom-right")e=_d(s);else if(t==="top-left")e=Co(s);else if(t==="top-right")e=_f(s);else throw new Error("Invalid corner");return e}function gg(s,t,e,i,r){const[n,o,a,l,h,c,u,d]=tb(s,t,e,i);return fa(Math.min(n,a,h,u),Math.min(o,l,c,d),Math.max(n,a,h,u),Math.max(o,l,c,d),r)}function tb(s,t,e,i){const r=t*i[0]/2,n=t*i[1]/2,o=Math.cos(e),a=Math.sin(e),l=r*o,h=r*a,c=n*o,u=n*a,d=s[0],p=s[1];return[d-l+u,p-h-c,d-l-u,p-h+c,d+l-u,p+h+c,d+l+u,p+h-c,d-l+u,p-h-c]}function hs(s){return s[3]-s[1]}function sa(s,t,e){const i=e||Yr();return zi(s,t)?(s[0]>t[0]?i[0]=s[0]:i[0]=t[0],s[1]>t[1]?i[1]=s[1]:i[1]=t[1],s[2]<t[2]?i[2]=s[2]:i[2]=t[2],s[3]<t[3]?i[3]=s[3]:i[3]=t[3]):mf(i),i}function Co(s){return[s[0],s[3]]}function _f(s){return[s[2],s[3]]}function Fe(s){return s[2]-s[0]}function zi(s,t){return s[0]<=t[2]&&s[2]>=t[0]&&s[1]<=t[3]&&s[3]>=t[1]}function yd(s){return s[2]<s[0]||s[3]<s[1]}function vit(s,t){return t?(t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t):s}function bit(s,t){const e=(s[2]-s[0])/2*(t-1),i=(s[3]-s[1])/2*(t-1);s[0]-=e,s[2]+=e,s[1]-=i,s[3]+=i}function wit(s,t,e){let i=!1;const r=Jv(s,t),n=Jv(s,e);if(r===ms.INTERSECTING||n===ms.INTERSECTING)i=!0;else{const o=s[0],a=s[1],l=s[2],h=s[3],c=t[0],u=t[1],d=e[0],p=e[1],g=(p-u)/(d-c);let f,m;n&ms.ABOVE&&!(r&ms.ABOVE)&&(f=d-(p-h)/g,i=f>=o&&f<=l),!i&&n&ms.RIGHT&&!(r&ms.RIGHT)&&(m=p-(d-l)*g,i=m>=a&&m<=h),!i&&n&ms.BELOW&&!(r&ms.BELOW)&&(f=d-(p-a)/g,i=f>=o&&f<=l),!i&&n&ms.LEFT&&!(r&ms.LEFT)&&(m=p-(d-o)*g,i=m>=a&&m<=h)}return i}function Ck(s,t){const e=t.getExtent(),i=xo(s);if(t.canWrapX()&&(i[0]<e[0]||i[0]>=e[2])){const r=Fe(e),n=Math.floor((i[0]-e[0])/r)*r;s[0]-=n,s[2]-=n}return s}function Eit(s,t){if(t.canWrapX()){const e=t.getExtent();if(!isFinite(s[0])||!isFinite(s[2]))return[[e[0],s[1],e[2],s[3]]];Ck(s,t);const i=Fe(e);if(Fe(s)>i)return[[e[0],s[1],e[2],s[3]]];if(s[0]<e[0])return[[s[0]+i,s[1],e[2],s[3]],[e[0],s[1],s[2],s[3]]];if(s[2]>e[2])return[[s[0],s[1],e[2],s[3]],[e[0],s[1],s[2]-i,s[3]]]}return[s]}function sS(s,t){const e=(""+s).split("."),i=(""+t).split(".");for(let r=0;r<Math.max(e.length,i.length);r++){const n=parseInt(e[r]||"0",10),o=parseInt(i[r]||"0",10);if(n>o)return 1;if(o>n)return-1}return 0}function Sit(s,t){return s[0]+=+t[0],s[1]+=+t[1],s}function Tk(s,t){const e=s[0],i=s[1],r=t[0],n=t[1],o=r[0],a=r[1],l=n[0],h=n[1],c=l-o,u=h-a,d=c===0&&u===0?0:(c*(e-o)+u*(i-a))/(c*c+u*u||0);let p,g;return d<=0?(p=o,g=a):d>=1?(p=l,g=h):(p=o+d*c,g=a+d*u),[p,g]}function en(s,t){let e=!0;for(let i=s.length-1;i>=0;--i)if(s[i]!=t[i]){e=!1;break}return e}function rS(s,t){const e=Math.cos(t),i=Math.sin(t),r=s[0]*e-s[1]*i,n=s[1]*e+s[0]*i;return s[0]=r,s[1]=n,s}function Cit(s,t){return s[0]*=t,s[1]*=t,s}function Uu(s,t){const e=s[0]-t[0],i=s[1]-t[1];return e*e+i*i}function G0(s,t){return Math.sqrt(Uu(s,t))}function Tit(s,t){return Uu(s,Tk(s,t))}function Ty(s,t){if(t.canWrapX()){const e=Fe(t.getExtent()),i=Rit(s,t,e);i&&(s[0]-=i*e)}return s}function Rit(s,t,e){const i=t.getExtent();let r=0;return t.canWrapX()&&(s[0]<i[0]||s[0]>i[2])&&(e=e||Fe(i),r=Math.floor((s[0]-i[0])/e)),r}const nS=63710088e-1;function eb(s,t,e){e=e||nS;const i=El(s[1]),r=El(t[1]),n=(r-i)/2,o=El(t[0]-s[0])/2,a=Math.sin(n)*Math.sin(n)+Math.sin(o)*Math.sin(o)*Math.cos(i)*Math.cos(r);return 2*e*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function ox(s,t){let e=0;for(let i=0,r=s.length;i<r-1;++i)e+=eb(s[i],s[i+1],t);return e}function Rk(s,t){t=t||{};const e=t.radius||nS,i=t.projection||"EPSG:3857",r=s.getType();r!=="GeometryCollection"&&(s=s.clone().transform(i,"EPSG:4326"));let n=0,o,a,l,h,c,u;switch(r){case"Point":case"MultiPoint":break;case"LineString":case"LinearRing":{o=s.getCoordinates(),n=ox(o,e);break}case"MultiLineString":case"Polygon":{for(o=s.getCoordinates(),l=0,h=o.length;l<h;++l)n+=ox(o[l],e);break}case"MultiPolygon":{for(o=s.getCoordinates(),l=0,h=o.length;l<h;++l)for(a=o[l],c=0,u=a.length;c<u;++c)n+=ox(a[c],e);break}case"GeometryCollection":{const d=s.getGeometries();for(l=0,h=d.length;l<h;++l)n+=Rk(d[l],t);break}default:throw new Error("Unsupported geometry type: "+r)}return n}function cm(s,t){let e=0;const i=s.length;let r=s[i-1][0],n=s[i-1][1];for(let o=0;o<i;o++){const a=s[o][0],l=s[o][1];e+=El(a-r)*(2+Math.sin(El(n))+Math.sin(El(l))),r=a,n=l}return e*t*t/2}function Mk(s,t){t=t||{};const e=t.radius||nS,i=t.projection||"EPSG:3857",r=s.getType();r!=="GeometryCollection"&&(s=s.clone().transform(i,"EPSG:4326"));let n=0,o,a,l,h,c,u;switch(r){case"Point":case"MultiPoint":case"LineString":case"MultiLineString":case"LinearRing":break;case"Polygon":{for(o=s.getCoordinates(),n=Math.abs(cm(o[0],e)),l=1,h=o.length;l<h;++l)n-=Math.abs(cm(o[l],e));break}case"MultiPolygon":{for(o=s.getCoordinates(),l=0,h=o.length;l<h;++l)for(a=o[l],n+=Math.abs(cm(a[0],e)),c=1,u=a.length;c<u;++c)n-=Math.abs(cm(a[c],e));break}case"GeometryCollection":{const d=s.getGeometries();for(l=0,h=d.length;l<h;++l)n+=Mk(d[l],t);break}default:throw new Error("Unsupported geometry type: "+r)}return n}function Ik(...s){console.warn(...s)}let ib=!0;function Ak(s){ib=!(s===void 0||s)}function oS(s,t){if(t!==void 0){for(let e=0,i=s.length;e<i;++e)t[e]=s[e];t=t}else t=s.slice();return t}function aS(s,t){if(t!==void 0&&s!==t){for(let e=0,i=s.length;e<i;++e)t[e]=s[e];s=t}return s}function Mit(s){mit(s.getCode(),s),j0(s,s,oS)}function Iit(s){s.forEach(Mit)}function si(s){return typeof s=="string"?fit(s):s||null}function z0(s,t,e,i){s=si(s);let r;const n=s.getPointResolutionFunc();if(n){if(r=n(t,e),i&&i!==s.getUnits()){const o=s.getMetersPerUnit();o&&(r=r*o/zu[i])}}else{const o=s.getUnits();if(o=="degrees"&&!i||i=="degrees")r=t;else{const a=yf(s,si("EPSG:4326"));if(a===aS&&o!=="degrees")r=t*s.getMetersPerUnit();else{let h=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];h=a(h,h,2);const c=eb(h.slice(0,2),h.slice(2,4)),u=eb(h.slice(4,6),h.slice(6,8));r=(c+u)/2}const l=i?zu[i]:s.getMetersPerUnit();l!==void 0&&(r/=l)}}return r}function jR(s){Iit(s),s.forEach(function(t){s.forEach(function(e){t!==e&&j0(t,e,oS)})})}function Ait(s,t,e,i){s.forEach(function(r){t.forEach(function(n){j0(r,n,e),j0(n,r,i)})})}function lS(s,t){return s?typeof s=="string"?si(s):s:si(t)}function Lit(s,t){return Ak(),Ry(s,"EPSG:4326",t!==void 0?t:"EPSG:3857")}function Xo(s,t){if(s===t)return!0;const e=s.getUnits()===t.getUnits();return(s.getCode()===t.getCode()||yf(s,t)===oS)&&e}function yf(s,t){const e=s.getCode(),i=t.getCode();let r=_it(e,i);return r||(r=aS),r}function fg(s,t){const e=si(s),i=si(t);return yf(e,i)}function Ry(s,t,e){return fg(t,e)(s,void 0,s.length)}let Pit=null;function Oit(){return Pit}function Vu(s,t){return s}function ji(s,t){return ib&&!en(s,[0,0])&&s[0]>=-180&&s[0]<=180&&s[1]>=-90&&s[1]<=90&&(ib=!1,Ik("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),s}function My(s,t){return s}function Pn(s,t){return s}function Fit(){jR(NR),jR($R),Ait($R,NR,uit,dit)}Fit();function GR(s,t,e){return function(i,r,n,o,a){if(!i)return;if(!r&&!t)return i;const l=t?0:n[0]*r,h=t?0:n[1]*r,c=a?a[0]:0,u=a?a[1]:0;let d=s[0]+l/2+c,p=s[2]-l/2+c,g=s[1]+h/2+u,f=s[3]-h/2+u;d>p&&(d=(p+d)/2,p=d),g>f&&(g=(f+g)/2,f=g);let m=Oi(i[0],d,p),_=Oi(i[1],g,f);if(o&&e&&r){const y=30*r;m+=-y*Math.log(1+Math.max(0,d-i[0])/y)+y*Math.log(1+Math.max(0,i[0]-p)/y),_+=-y*Math.log(1+Math.max(0,g-i[1])/y)+y*Math.log(1+Math.max(0,i[1]-f)/y)}return[m,_]}}function kit(s){return s}function hS(s,t,e,i){const r=Fe(t)/e[0],n=hs(t)/e[1];return i?Math.min(s,Math.max(r,n)):Math.min(s,Math.min(r,n))}function cS(s,t,e){let i=Math.min(s,t);const r=50;return i*=Math.log(1+r*Math.max(0,s/t-1))/r+1,e&&(i=Math.max(i,e),i/=Math.log(1+r*Math.max(0,e/s-1))/r+1),Oi(i,e/2,t*2)}function Nit(s,t,e,i){return t=t!==void 0?t:!0,function(r,n,o,a){if(r!==void 0){const l=s[0],h=s[s.length-1],c=e?hS(l,e,o,i):l;if(a)return t?cS(r,c,h):Oi(r,h,c);const u=Math.min(c,r),d=Math.floor(Sy(s,u,n));return s[d]>c&&d<s.length-1?s[d+1]:s[d]}}}function Dit(s,t,e,i,r,n){return i=i!==void 0?i:!0,e=e!==void 0?e:0,function(o,a,l,h){if(o!==void 0){const c=r?hS(t,r,l,n):t;if(h)return i?cS(o,c,e):Oi(o,e,c);const u=1e-9,d=Math.ceil(Math.log(t/c)/Math.log(s)-u),p=-a*(.5-u)+.5,g=Math.min(c,o),f=Math.floor(Math.log(t/g)/Math.log(s)+p),m=Math.max(d,f),_=t/Math.pow(s,m);return Oi(_,e,c)}}}function zR(s,t,e,i,r){return e=e!==void 0?e:!0,function(n,o,a,l){if(n!==void 0){const h=i?hS(s,i,a,r):s;return!e||!l?Oi(n,t,h):cS(n,h,t)}}}function uS(s){if(s!==void 0)return 0}function BR(s){if(s!==void 0)return s}function $it(s){const t=2*Math.PI/s;return function(e,i){if(i)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function jit(s){const t=s===void 0?El(5):s;return function(e,i){return i||e===void 0?e:Math.abs(e)<=t?0:e}}function Lk(s){return Math.pow(s,3)}function Wh(s){return 1-Lk(1-s)}function Git(s){return 3*s*s-2*s*s*s}function zit(s){return s}const Pk=new Array(6);function cn(){return[1,0,0,1,0,0]}function UR(s){return Iy(s,1,0,0,1,0,0)}function dS(s,t){const e=s[0],i=s[1],r=s[2],n=s[3],o=s[4],a=s[5],l=t[0],h=t[1],c=t[2],u=t[3],d=t[4],p=t[5];return s[0]=e*l+r*h,s[1]=i*l+n*h,s[2]=e*c+r*u,s[3]=i*c+n*u,s[4]=e*d+r*p+o,s[5]=i*d+n*p+a,s}function Iy(s,t,e,i,r,n,o){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s[4]=n,s[5]=o,s}function Bit(s,t){return s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[4]=t[4],s[5]=t[5],s}function ss(s,t){const e=t[0],i=t[1];return t[0]=s[0]*e+s[2]*i+s[4],t[1]=s[1]*e+s[3]*i+s[5],t}function ax(s,t,e){return dS(s,Iy(Pk,t,0,0,e,0,0))}function Uit(s,t,e){return Iy(s,t,0,0,e,0,0)}function Vit(s,t,e){return dS(s,Iy(Pk,1,0,0,1,t,e))}function Gn(s,t,e,i,r,n,o,a){const l=Math.sin(n),h=Math.cos(n);return s[0]=i*h,s[1]=r*l,s[2]=-i*l,s[3]=r*h,s[4]=o*i*h-a*i*l+t,s[5]=o*r*l+a*r*h+e,s}function Ay(s,t){const e=Hit(t);Te(e!==0,"Transformation matrix cannot be inverted");const i=t[0],r=t[1],n=t[2],o=t[3],a=t[4],l=t[5];return s[0]=o/e,s[1]=-r/e,s[2]=-n/e,s[3]=i/e,s[4]=(n*l-o*a)/e,s[5]=-(i*l-r*a)/e,s}function Hit(s){return s[0]*s[3]-s[1]*s[2]}const VR=[1e6,1e6,1e6,1e6,2,2];function pS(s){return"matrix("+s.map((t,e)=>Math.round(t*VR[e])/VR[e]).join(", ")+")"}function Sl(s,t,e,i,r,n){n=n||[];let o=0;for(let a=t;a<e;a+=i){const l=s[a],h=s[a+1];n[o++]=r[0]*l+r[2]*h+r[4],n[o++]=r[1]*l+r[3]*h+r[5]}return n&&n.length!=o&&(n.length=o),n}function gS(s,t,e,i,r,n,o){o=o||[];const a=Math.cos(r),l=Math.sin(r),h=n[0],c=n[1];let u=0;for(let d=t;d<e;d+=i){const p=s[d]-h,g=s[d+1]-c;o[u++]=h+p*a-g*l,o[u++]=c+p*l+g*a;for(let f=d+2;f<d+i;++f)o[u++]=s[f]}return o&&o.length!=u&&(o.length=u),o}function Wit(s,t,e,i,r,n,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=t;u<e;u+=i){const d=s[u]-l,p=s[u+1]-h;a[c++]=l+r*d,a[c++]=h+n*p;for(let g=u+2;g<u+i;++g)a[c++]=s[g]}return a&&a.length!=c&&(a.length=c),a}function Xit(s,t,e,i,r,n,o){o=o||[];let a=0;for(let l=t;l<e;l+=i){o[a++]=s[l]+r,o[a++]=s[l+1]+n;for(let h=l+2;h<l+i;++h)o[a++]=s[h]}return o&&o.length!=a&&(o.length=a),o}const HR=cn();class qit extends Vn{constructor(){super(),this.extent_=Yr(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=yk((t,e,i)=>{if(!i)return this.getSimplifiedGeometry(e);const r=this.clone();return r.applyTransform(i),r.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return Xt()}closestPointXY(t,e,i,r){return Xt()}containsXY(t,e){const i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return Xt()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&mf(e),this.extentRevision_=this.getRevision()}return vit(this.extent_,t)}rotate(t,e){Xt()}scale(t,e,i){Xt()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return Xt()}getType(){return Xt()}applyTransform(t){Xt()}intersectsExtent(t){return Xt()}translate(t,e){Xt()}transform(t,e){const i=si(t),r=i.getUnits()=="tile-pixels"?function(n,o,a){const l=i.getExtent(),h=i.getWorldExtent(),c=hs(h)/hs(l);return Gn(HR,h[0],h[3],c,-c,0,0,0),Sl(n,0,n.length,a,HR,o),fg(i,e)(n,o,a)}:fg(i,e);return this.applyTransform(r),this}}const Ok=qit;class Gl extends Ok{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return eS(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return Xt()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=B0(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){Xt()}setLayout(t,e,i){let r;if(t)r=B0(t);else{for(let n=0;n<i;++n){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}r=e.length,t=Xh(r)}this.layout=t,this.stride=r}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const r=this.getStride();gS(i,0,i.length,r,t,e,i),this.changed()}}scale(t,e,i){e===void 0&&(e=t),i||(i=xo(this.getExtent()));const r=this.getFlatCoordinates();if(r){const n=this.getStride();Wit(r,0,r.length,n,t,e,i,r),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const r=this.getStride();Xit(i,0,i.length,r,t,e,i),this.changed()}}}function Xh(s){let t;return s==2?t="XY":s==3?t="XYZ":s==4&&(t="XYZM"),t}function B0(s){let t;return s=="XY"?t=2:s=="XYZ"||s=="XYM"?t=3:s=="XYZM"&&(t=4),t}function Yit(s,t,e){const i=s.getFlatCoordinates();if(!i)return null;const r=s.getStride();return Sl(i,0,i.length,r,t,e)}function WR(s,t,e,i,r,n,o){const a=s[t],l=s[t+1],h=s[e]-a,c=s[e+1]-l;let u;if(h===0&&c===0)u=t;else{const d=((r-a)*h+(n-l)*c)/(h*h+c*c);if(d>1)u=e;else if(d>0){for(let p=0;p<i;++p)o[p]=Gr(s[t+p],s[e+p],d);o.length=i;return}else u=t}for(let d=0;d<i;++d)o[d]=s[u+d];o.length=i}function fS(s,t,e,i,r){let n=s[t],o=s[t+1];for(t+=i;t<e;t+=i){const a=s[t],l=s[t+1],h=ia(n,o,a,l);h>r&&(r=h),n=a,o=l}return r}function mS(s,t,e,i,r){for(let n=0,o=e.length;n<o;++n){const a=e[n];r=fS(s,t,a,i,r),t=a}return r}function Zit(s,t,e,i,r){for(let n=0,o=e.length;n<o;++n){const a=e[n];r=mS(s,t,a,i,r),t=a[a.length-1]}return r}function _S(s,t,e,i,r,n,o,a,l,h,c){if(t==e)return h;let u,d;if(r===0){if(d=ia(o,a,s[t],s[t+1]),d<h){for(u=0;u<i;++u)l[u]=s[t+u];return l.length=i,d}return h}c=c||[NaN,NaN];let p=t+i;for(;p<e;)if(WR(s,p-i,p,i,o,a,c),d=ia(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<i;++u)l[u]=c[u];l.length=i,p+=i}else p+=i*Math.max((Math.sqrt(d)-Math.sqrt(h))/r|0,1);if(n&&(WR(s,e-i,t,i,o,a,c),d=ia(o,a,c[0],c[1]),d<h)){for(h=d,u=0;u<i;++u)l[u]=c[u];l.length=i}return h}function yS(s,t,e,i,r,n,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const p=e[u];h=_S(s,t,p,i,r,n,o,a,l,h,c),t=p}return h}function Kit(s,t,e,i,r,n,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const p=e[u];h=yS(s,t,p,i,r,n,o,a,l,h,c),t=p[p.length-1]}return h}function Fk(s,t,e,i){for(let r=0,n=e.length;r<n;++r)s[t++]=e[r];return t}function Ly(s,t,e,i){for(let r=0,n=e.length;r<n;++r){const o=e[r];for(let a=0;a<i;++a)s[t++]=o[a]}return t}function xf(s,t,e,i,r){r=r||[];let n=0;for(let o=0,a=e.length;o<a;++o){const l=Ly(s,t,e[o],i);r[n++]=l,t=l}return r.length=n,r}function kk(s,t,e,i,r){r=r||[];let n=0;for(let o=0,a=e.length;o<a;++o){const l=xf(s,t,e[o],i,r[n]);l.length===0&&(l[0]=t),r[n++]=l,t=l[l.length-1]}return r.length=n,r}function Py(s,t,e,i,r,n,o){const a=(e-t)/i;if(a<3){for(;t<e;t+=i)n[o++]=s[t],n[o++]=s[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[t,e-i];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let p=0;const g=s[d],f=s[d+1],m=s[u],_=s[u+1];for(let y=d+i;y<u;y+=i){const v=s[y],b=s[y+1],E=nit(v,b,g,f,m,_);E>p&&(c=y,p=E)}p>r&&(l[(c-t)/i]=1,d+i<c&&h.push(d,c),c+i<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(n[o++]=s[t+u*i],n[o++]=s[t+u*i+1]);return o}function Nk(s,t,e,i,r,n,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=Py(s,t,c,i,r,n,o),a.push(o),t=c}return o}function sh(s,t){return t*Math.round(s/t)}function Jit(s,t,e,i,r,n,o){if(t==e)return o;let a=sh(s[t],r),l=sh(s[t+1],r);t+=i,n[o++]=a,n[o++]=l;let h,c;do if(h=sh(s[t],r),c=sh(s[t+1],r),t+=i,t==e)return n[o++]=h,n[o++]=c,o;while(h==a&&c==l);for(;t<e;){const u=sh(s[t],r),d=sh(s[t+1],r);if(t+=i,u==h&&d==c)continue;const p=h-a,g=c-l,f=u-a,m=d-l;if(p*m==g*f&&(p<0&&f<p||p==f||p>0&&f>p)&&(g<0&&m<g||g==m||g>0&&m>g)){h=u,c=d;continue}n[o++]=h,n[o++]=c,a=h,l=c,h=u,c=d}return n[o++]=h,n[o++]=c,o}function xS(s,t,e,i,r,n,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=Jit(s,t,c,i,r,n,o),a.push(o),t=c}return o}function Qit(s,t,e,i,r,n,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l],u=[];o=xS(s,t,c,i,r,n,o,u),a.push(u),t=c[c.length-1]}return o}function dl(s,t,e,i,r){r=r!==void 0?r:[];let n=0;for(let o=t;o<e;o+=i)r[n++]=s.slice(o,o+i);return r.length=n,r}function mg(s,t,e,i,r){r=r!==void 0?r:[];let n=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];r[n++]=dl(s,t,l,i,r[n]),t=l}return r.length=n,r}function sb(s,t,e,i,r){r=r!==void 0?r:[];let n=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];r[n++]=l.length===1&&l[0]===t?[]:mg(s,t,l,i,r[n]),t=l[l.length-1]}return r.length=n,r}function Dk(s,t,e,i){let r=0,n=s[e-i],o=s[e-i+1];for(;t<e;t+=i){const a=s[t],l=s[t+1];r+=o*a-n*l,n=a,o=l}return r/2}function $k(s,t,e,i){let r=0;for(let n=0,o=e.length;n<o;++n){const a=e[n];r+=Dk(s,t,a,i),t=a}return r}function tst(s,t,e,i){let r=0;for(let n=0,o=e.length;n<o;++n){const a=e[n];r+=$k(s,t,a,i),t=a[a.length-1]}return r}let est=class rb extends Gl{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new rb(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,r){return r<Hh(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(fS(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),_S(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,r))}getArea(){return Dk(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return dl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=Py(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new rb(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ly(this.flatCoordinates,0,t,this.stride),this.changed()}};const XR=est;class vS extends Gl{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new vS(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,r){const n=this.flatCoordinates,o=ia(t,e,n[0],n[1]);if(o<r){const a=this.stride;for(let l=0;l<a;++l)i[l]=n[l];return i.length=a,o}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return bp(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return tS(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Fk(this.flatCoordinates,0,t,this.stride),this.changed()}}const un=vS;function ist(s,t,e,i,r){return!iS(r,function(n){return!dh(s,t,e,i,n[0],n[1])})}function dh(s,t,e,i,r,n){let o=0,a=s[e-i],l=s[e-i+1];for(;t<e;t+=i){const h=s[t],c=s[t+1];l<=n?c>n&&(h-a)*(n-l)-(r-a)*(c-l)>0&&o++:c<=n&&(h-a)*(n-l)-(r-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function bS(s,t,e,i,r,n){if(e.length===0||!dh(s,t,e[0],i,r,n))return!1;for(let o=1,a=e.length;o<a;++o)if(dh(s,e[o-1],e[o],i,r,n))return!1;return!0}function sst(s,t,e,i,r,n){if(e.length===0)return!1;for(let o=0,a=e.length;o<a;++o){const l=e[o];if(bS(s,t,l,i,r,n))return!0;t=l[l.length-1]}return!1}function wS(s,t,e,i,r,n,o){let a,l,h,c,u,d,p;const g=r[n+1],f=[];for(let y=0,v=e.length;y<v;++y){const b=e[y];for(c=s[b-i],d=s[b-i+1],a=t;a<b;a+=i)u=s[a],p=s[a+1],(g<=d&&p<=g||d<=g&&g<=p)&&(h=(g-d)/(p-d)*(u-c)+c,f.push(h)),c=u,d=p}let m=NaN,_=-1/0;for(f.sort(ga),c=f[0],a=1,l=f.length;a<l;++a){u=f[a];const y=Math.abs(u-c);y>_&&(h=(c+u)/2,bS(s,t,e,i,h,g)&&(m=h,_=y)),c=u}return isNaN(m)&&(m=r[n]),o?(o.push(m,g,_),o):[m,g,_]}function jk(s,t,e,i,r){let n=[];for(let o=0,a=e.length;o<a;++o){const l=e[o];n=wS(s,t,l,i,r,2*o,n),t=l[l.length-1]}return n}function Gk(s,t,e,i,r){let n;for(t+=i;t<e;t+=i)if(n=r(s.slice(t-i,t),s.slice(t,t+i)),n)return n;return!1}function Oy(s,t,e,i,r){const n=Sk(Yr(),s,t,e,i);return zi(r,n)?an(r,n)||n[0]>=r[0]&&n[2]<=r[2]||n[1]>=r[1]&&n[3]<=r[3]?!0:Gk(s,t,e,i,function(o,a){return wit(r,o,a)}):!1}function rst(s,t,e,i,r){for(let n=0,o=e.length;n<o;++n){if(Oy(s,t,e[n],i,r))return!0;t=e[n]}return!1}function zk(s,t,e,i,r){return!!(Oy(s,t,e,i,r)||dh(s,t,e,i,r[0],r[1])||dh(s,t,e,i,r[0],r[3])||dh(s,t,e,i,r[2],r[1])||dh(s,t,e,i,r[2],r[3]))}function Bk(s,t,e,i,r){if(!zk(s,t,e[0],i,r))return!1;if(e.length===1)return!0;for(let n=1,o=e.length;n<o;++n)if(ist(s,e[n-1],e[n],i,r)&&!Oy(s,e[n-1],e[n],i,r))return!1;return!0}function nst(s,t,e,i,r){for(let n=0,o=e.length;n<o;++n){const a=e[n];if(Bk(s,t,a,i,r))return!0;t=a[a.length-1]}return!1}function ost(s,t,e,i){for(;t<e-i;){for(let r=0;r<i;++r){const n=s[t+r];s[t+r]=s[e-i+r],s[e-i+r]=n}t+=i,e-=i}}function ES(s,t,e,i){let r=0,n=s[e-i],o=s[e-i+1];for(;t<e;t+=i){const a=s[t],l=s[t+1];r+=(a-n)*(l+o),n=a,o=l}return r===0?void 0:r>0}function SS(s,t,e,i,r){r=r!==void 0?r:!1;for(let n=0,o=e.length;n<o;++n){const a=e[n],l=ES(s,t,a,i);if(n===0){if(r&&l||!r&&!l)return!1}else if(r&&!l||!r&&l)return!1;t=a}return!0}function Uk(s,t,e,i,r){for(let n=0,o=e.length;n<o;++n){const a=e[n];if(!SS(s,t,a,i,r))return!1;a.length&&(t=a[a.length-1])}return!0}function U0(s,t,e,i,r){r=r!==void 0?r:!1;for(let n=0,o=e.length;n<o;++n){const a=e[n],l=ES(s,t,a,i);(n===0?r&&l||!r&&!l:r&&!l||!r&&l)&&ost(s,t,a,i),t=a}return t}function nb(s,t,e,i,r){for(let n=0,o=e.length;n<o;++n)t=U0(s,t,e[n],i,r);return t}function Vk(s,t){const e=[];let i=0,r=0,n;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=ES(s,i,l,2);if(n===void 0&&(n=h),h===n)e.push(t.slice(r,o+1));else{if(e.length===0)continue;e[e.length-1].push(t[r])}r=o+1,i=l}return e}class Zs extends Gl{constructor(t,e,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&i?(this.setFlatCoordinates(e,t),this.ends_=i):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?qe(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Zs(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,r){return r<Hh(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(mS(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),yS(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,r))}containsXY(t,e){return bS(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return $k(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),U0(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,mg(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=xo(this.getExtent());this.flatInteriorPoint_=wS(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new un(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new XR(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,i=this.ends_,r=[];let n=0;for(let o=0,a=i.length;o<a;++o){const l=i[o],h=new XR(e.slice(n,l),t);r.push(h),n=l}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;SS(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=U0(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=xS(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new Zs(e,"XY",i)}getType(){return"Polygon"}intersectsExtent(t){return Bk(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=xf(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function V0(s){if(yd(s))throw new Error("Cannot create polygon from empty extent");const t=s[0],e=s[1],i=s[2],r=s[3],n=[t,e,t,r,i,r,i,e,t,e];return new Zs(n,"XY",[n.length])}const lx=0;class ast extends Vn{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=lS(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&Ak(),t.center&&(t.center=ji(t.center,this.projection_)),t.extent&&(t.extent=Pn(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const a in kr)delete e[a];this.setProperties(e,!0);const i=hst(t);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=i.minZoom;const r=lst(t),n=i.constraint,o=cst(t);this.constraints_={center:r,resolution:n,rotation:o},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const i=this.getCenterInternal();if(i){const r=t||[0,0,0,0];e=e||[0,0,0,0];const n=this.getResolution(),o=n/2*(r[3]-e[3]+e[1]-r[1]),a=n/2*(r[0]-e[0]+e[2]-r[2]);this.setCenterInternal([i[0]+o,i[1]-a])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let i=0;i<e.length;++i){let r=arguments[i];r.center&&(r=Object.assign({},r),r.center=ji(r.center,this.getProjection())),r.anchor&&(r=Object.assign({},r),r.anchor=ji(r.anchor,this.getProjection())),e[i]=r}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,i;e>1&&typeof arguments[e-1]=="function"&&(i=arguments[e-1],--e);let r=0;for(;r<e&&!this.isDef();++r){const c=arguments[r];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(r===e){i&&um(i,!0);return}let n=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;r<e;++r){const c=arguments[r],u={start:n,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||Git,callback:i};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const d=Eh(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}ust(u)?u.complete=!0:n+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(Si.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Si.ANIMATING]>0}getInteracting(){return this.hints_[Si.INTERACTING]>0}cancelAnimations(){this.setHint(Si.ANIMATING,-this.hints_[Si.ANIMATING]);let t;for(let e=0,i=this.animations_.length;e<i;++e){const r=this.animations_[e];if(r[0].callback&&um(r[0].callback,!1),!t)for(let n=0,o=r.length;n<o;++n){const a=r[n];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let i=this.animations_.length-1;i>=0;--i){const r=this.animations_[i];let n=!0;for(let o=0,a=r.length;o<a;++o){const l=r[o];if(l.complete)continue;const h=t-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):n=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],p=l.sourceCenter[1],g=l.targetCenter[0],f=l.targetCenter[1];this.nextCenter_=l.targetCenter;const m=d+u*(g-d),_=p+u*(f-p);this.targetCenter_=[m,_]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const p=this.getViewportSize_(this.getRotation()),g=this.constraints_.resolution(d,0,p,!0);this.targetCenter_=this.calculateCenterZoom(g,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?Eh(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const p=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(p,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(n){this.animations_[i]=null,this.setHint(Si.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=r[0].callback;o&&um(o,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let i;const r=this.getCenterInternal();return r!==void 0&&(i=[r[0]-e[0],r[1]-e[1]],rS(i,t-this.getRotation()),Sit(i,e)),i}calculateCenterZoom(t,e){let i;const r=this.getCenterInternal(),n=this.getResolution();if(r!==void 0&&n!==void 0){const o=e[0]-t*(e[0]-r[0])/n,a=e[1]-t*(e[1]-r[1])/n;i=[o,a]}return i}getViewportSize_(t){const e=this.viewportSize_;if(t){const i=e[0],r=e[1];return[Math.abs(i*Math.cos(t))+Math.abs(r*Math.sin(t)),Math.abs(i*Math.sin(t))+Math.abs(r*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&Vu(t,this.getProjection())}getCenterInternal(){return this.get(kr.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return My(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();Te(e,"The view center is not defined");const i=this.getResolution();Te(i!==void 0,"The view resolution is not defined");const r=this.getRotation();return Te(r!==void 0,"The view rotation is not defined"),gg(e,i,r,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(kr.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(Pn(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const i=Fe(t)/e[0],r=hs(t)/e[1];return Math.max(i,r)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,r=Math.log(e/i)/Math.log(t);return function(n){return e/Math.pow(t,n*r)}}getRotation(){return this.get(kr.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,n=Math.log(i/r)/e;return function(o){return Math.log(i/o)/e/n}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const i=this.padding_;return i&&(e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),i=this.getRotation();let r=this.getCenterInternal();const n=this.padding_;if(n){const o=this.getViewportSizeMinusPadding_();r=hx(r,this.getViewportSize_(),[o[0]/2+n[3],o[1]/2+n[0]],e,i)}return{center:r.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,i,r;if(this.resolutions_){const n=Sy(this.resolutions_,t,1);e=n,i=this.resolutions_[n],n==this.resolutions_.length-1?r=2:r=i/this.resolutions_[n+1]}else i=this.maxResolution_,r=this.zoomFactor_;return e+Math.log(i/t)/Math.log(r)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=Oi(Math.floor(t),0,this.resolutions_.length-2),i=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(i,Oi(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let i;if(Te(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){Te(!yd(t),"Cannot fit empty extent provided as `geometry`");const r=Pn(t,this.getProjection());i=V0(r)}else if(t.getType()==="Circle"){const r=Pn(t.getExtent(),this.getProjection());i=V0(r),i.rotate(this.getRotation(),xo(r))}else i=t;this.fitInternal(i,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),i=Math.cos(e),r=Math.sin(-e),n=t.getFlatCoordinates(),o=t.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=n.length;u<d;u+=o){const p=n[u]*i-n[u+1]*r,g=n[u]*r+n[u+1]*i;a=Math.min(a,p),l=Math.min(l,g),h=Math.max(h,p),c=Math.max(c,g)}return[a,l,h,c]}fitInternal(t,e){e=e||{};let i=e.size;i||(i=this.getViewportSizeMinusPadding_());const r=e.padding!==void 0?e.padding:[0,0,0,0],n=e.nearest!==void 0?e.nearest:!1;let o;e.minResolution!==void 0?o=e.minResolution:e.maxZoom!==void 0?o=this.getResolutionForZoom(e.maxZoom):o=0;const a=this.rotatedExtentForGeometry(t);let l=this.getResolutionForExtentInternal(a,[i[0]-r[1]-r[3],i[1]-r[0]-r[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,n?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=xo(a);d[0]+=(r[1]-r[3])/2*l,d[1]+=(r[0]-r[2])/2*l;const p=d[0]*u-d[1]*c,g=d[1]*u+d[0]*c,f=this.getConstrainedCenter([p,g],l),m=e.callback?e.callback:Gu;e.duration!==void 0?this.animateInternal({resolution:l,center:f,duration:e.duration,easing:e.easing},m):(this.targetResolution_=l,this.targetCenter_=f,this.applyTargetState_(!1,!0),um(m,!0))}centerOn(t,e,i){this.centerOnInternal(ji(t,this.getProjection()),e,i)}centerOnInternal(t,e,i){this.setCenterInternal(hx(t,e,i,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,i,r){let n;const o=this.padding_;if(o&&t){const a=this.getViewportSizeMinusPadding_(-i),l=hx(t,r,[a[0]/2+o[3],a[1]/2+o[0]],e,i);n=[t[0]-l[0],t[1]-l[1]]}return n}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=Vu(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&ji(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const i=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),n=this.constraints_.resolution(this.targetResolution_*t,0,r,i);e&&(this.targetCenter_=this.calculateCenterZoom(n,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=ji(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const i=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(r,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&ji(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const i=this.getAnimating()||this.getInteracting()||e,r=this.constraints_.rotation(this.targetRotation_,i),n=this.getViewportSize_(r),o=this.constraints_.resolution(this.targetResolution_,0,n,i),a=this.constraints_.center(this.targetCenter_,o,n,i,this.calculateCenterShift(this.targetCenter_,o,r,n));this.get(kr.ROTATION)!==r&&this.set(kr.ROTATION,r),this.get(kr.RESOLUTION)!==o&&(this.set(kr.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(kr.CENTER)||!en(this.get(kr.CENTER),a))&&this.set(kr.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,i){t=t!==void 0?t:200;const r=e||0,n=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(n),a=this.constraints_.resolution(this.targetResolution_,r,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,n,o));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=n,this.targetCenter_=l,this.applyTargetState_();return}i=i||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==n||!this.getCenterInternal()||!en(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:n,center:l,resolution:a,duration:t,easing:Wh,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Si.INTERACTING,1)}endInteraction(t,e,i){i=i&&ji(i,this.getProjection()),this.endInteractionInternal(t,e,i)}endInteractionInternal(t,e,i){this.getInteracting()&&(this.setHint(Si.INTERACTING,-1),this.resolveConstraints(t,e,i))}getConstrainedCenter(t,e){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)}getConstrainedZoom(t,e){const i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i,e))}getConstrainedResolution(t,e){e=e||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,i)}}function um(s,t){setTimeout(function(){s(t)},0)}function lst(s){if(s.extent!==void 0){const e=s.smoothExtentConstraint!==void 0?s.smoothExtentConstraint:!0;return GR(s.extent,s.constrainOnlyCenter,e)}const t=lS(s.projection,"EPSG:3857");if(s.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,GR(e,!1,!1)}return kit}function hst(s){let t,e,i,r=s.minZoom!==void 0?s.minZoom:lx,n=s.maxZoom!==void 0?s.maxZoom:28;const o=s.zoomFactor!==void 0?s.zoomFactor:2,a=s.multiWorld!==void 0?s.multiWorld:!1,l=s.smoothResolutionConstraint!==void 0?s.smoothResolutionConstraint:!0,h=s.showFullExtent!==void 0?s.showFullExtent:!1,c=lS(s.projection,"EPSG:3857"),u=c.getExtent();let d=s.constrainOnlyCenter,p=s.extent;if(!a&&!p&&c.isGlobal()&&(d=!1,p=u),s.resolutions!==void 0){const g=s.resolutions;e=g[r],i=g[n]!==void 0?g[n]:g[g.length-1],s.constrainResolution?t=Nit(g,l,!d&&p,h):t=zR(e,i,l,!d&&p,h)}else{const g=(u?Math.max(Fe(u),hs(u)):360*zu.degrees/c.getMetersPerUnit())/JE/Math.pow(2,lx),f=g/Math.pow(2,28-lx);e=s.maxResolution,e!==void 0?r=0:e=g/Math.pow(o,r),i=s.minResolution,i===void 0&&(s.maxZoom!==void 0?s.maxResolution!==void 0?i=e/Math.pow(o,n):i=g/Math.pow(o,n):i=f),n=r+Math.floor(Math.log(e/i)/Math.log(o)),i=e/Math.pow(o,n-r),s.constrainResolution?t=Dit(o,e,i,l,!d&&p,h):t=zR(e,i,l,!d&&p,h)}return{constraint:t,maxResolution:e,minResolution:i,minZoom:r,zoomFactor:o}}function cst(s){if(s.enableRotation===void 0||s.enableRotation){const t=s.constrainRotation;return t===void 0||t===!0?jit():t===!1?BR:typeof t=="number"?$it(t):BR}return uS}function ust(s){return!(s.sourceCenter&&s.targetCenter&&!en(s.sourceCenter,s.targetCenter)||s.sourceResolution!==s.targetResolution||s.sourceRotation!==s.targetRotation)}function hx(s,t,e,i,r){const n=Math.cos(-r);let o=Math.sin(-r),a=s[0]*n-s[1]*o,l=s[1]*n+s[0]*o;a+=(t[0]/2-e[0])*i,l+=(e[1]-t[1]/2)*i,o=-o;const h=a*n-l*o,c=l*n+a*o;return[h,c]}const Mn=ast;class dst extends vk{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(ti.SOURCE,this.handleSourcePropertyChange_);const i=t.source?t.source:null;this.setSource(i)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(ti.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(ii(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=ae(t,Mt.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const i=this.getMapInternal();!t&&i&&(t=i.getView()),t instanceof Mn?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&i&&(e.layerStatesArray=i.getLayerGroup().getLayerStatesArray());let r;e.layerStatesArray?r=e.layerStatesArray.find(o=>o.layer===this):r=this.getLayerState();const n=this.getExtent();return CS(r,e.viewState)&&(!n||zi(n,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];let e;const i=this.getSource();if(i&&(e=i.getAttributions()),!e)return[];const r=t instanceof Mn?t.getViewStateAndExtent():t;let n=e(r);return Array.isArray(n)||(n=[n]),n}render(t,e){const i=this.getRenderer();return i.prepareFrame(t)?(this.rendered=!0,i.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(ti.MAP,t)}getMapInternal(){return this.get(ti.MAP)}setMap(t){this.mapPrecomposeKey_&&(ii(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(ii(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=ae(t,on.PRECOMPOSE,function(e){const i=e.frameState.layerStatesArray,r=this.getLayerState(!1);Te(!i.some(function(n){return n.layer===r.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),i.push(r)},this),this.mapRenderKey_=ae(this,Mt.CHANGE,t.render,t),this.changed())}setSource(t){this.set(ti.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function CS(s,t){if(!s.visible)return!1;const e=t.resolution;if(e<s.minResolution||e>=s.maxResolution)return!1;const i=t.zoom;return i>s.minZoom&&i<=s.maxZoom}const vf=dst;function pst(s,t,e,i,r){Hk(s,t,e||0,i||s.length-1,r||gst)}function Hk(s,t,e,i,r){for(;i>e;){if(i-e>600){var n=i-e+1,o=t-e+1,a=Math.log(n),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(n-l)/n)*(o-n/2<0?-1:1),c=Math.max(e,Math.floor(t-o*l/n+h)),u=Math.min(i,Math.floor(t+(n-o)*l/n+h));Hk(s,t,c,u,r)}var d=s[t],p=e,g=i;for(Bd(s,e,t),r(s[i],d)>0&&Bd(s,e,i);p<g;){for(Bd(s,p,g),p++,g--;r(s[p],d)<0;)p++;for(;r(s[g],d)>0;)g--}r(s[e],d)===0?Bd(s,e,g):(g++,Bd(s,g,i)),g<=t&&(e=g+1),t<=g&&(i=g-1)}}function Bd(s,t,e){var i=s[t];s[t]=s[e],s[e]=i}function gst(s,t){return s<t?-1:s>t?1:0}let Wk=class{constructor(s=9){this._maxEntries=Math.max(4,s),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(s){let t=this.data;const e=[];if(!pm(s,t))return e;const i=this.toBBox,r=[];for(;t;){for(let n=0;n<t.children.length;n++){const o=t.children[n],a=t.leaf?i(o):o;pm(s,a)&&(t.leaf?e.push(o):ux(s,a)?this._all(o,e):r.push(o))}t=r.pop()}return e}collides(s){let t=this.data;if(!pm(s,t))return!1;const e=[];for(;t;){for(let i=0;i<t.children.length;i++){const r=t.children[i],n=t.leaf?this.toBBox(r):r;if(pm(s,n)){if(t.leaf||ux(s,n))return!0;e.push(r)}}t=e.pop()}return!1}load(s){if(!(s&&s.length))return this;if(s.length<this._minEntries){for(let e=0;e<s.length;e++)this.insert(s[e]);return this}let t=this._build(s.slice(),0,s.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(s){return s&&this._insert(s,this.data.height-1),this}clear(){return this.data=Mc([]),this}remove(s,t){if(!s)return this;let e=this.data;const i=this.toBBox(s),r=[],n=[];let o,a,l;for(;e||r.length;){if(e||(e=r.pop(),a=r[r.length-1],o=n.pop(),l=!0),e.leaf){const h=fst(s,e.children,t);if(h!==-1)return e.children.splice(h,1),r.push(e),this._condense(r),this}!l&&!e.leaf&&ux(e,i)?(r.push(e),n.push(o),o=0,a=e,e=e.children[0]):a?(o++,e=a.children[o],l=!1):e=null}return this}toBBox(s){return s}compareMinX(s,t){return s.minX-t.minX}compareMinY(s,t){return s.minY-t.minY}toJSON(){return this.data}fromJSON(s){return this.data=s,this}_all(s,t){const e=[];for(;s;)s.leaf?t.push(...s.children):e.push(...s.children),s=e.pop();return t}_build(s,t,e,i){const r=e-t+1;let n=this._maxEntries,o;if(r<=n)return o=Mc(s.slice(t,e+1)),pc(o,this.toBBox),o;i||(i=Math.ceil(Math.log(r)/Math.log(n)),n=Math.ceil(r/Math.pow(n,i-1))),o=Mc([]),o.leaf=!1,o.height=i;const a=Math.ceil(r/n),l=a*Math.ceil(Math.sqrt(n));qR(s,t,e,l,this.compareMinX);for(let h=t;h<=e;h+=l){const c=Math.min(h+l-1,e);qR(s,h,c,a,this.compareMinY);for(let u=h;u<=c;u+=a){const d=Math.min(u+a-1,c);o.children.push(this._build(s,u,d,i-1))}}return pc(o,this.toBBox),o}_chooseSubtree(s,t,e,i){for(;i.push(t),!(t.leaf||i.length-1===e);){let r=1/0,n=1/0,o;for(let a=0;a<t.children.length;a++){const l=t.children[a],h=cx(l),c=yst(s,l)-h;c<n?(n=c,r=h<r?h:r,o=l):c===n&&h<r&&(r=h,o=l)}t=o||t.children[0]}return t}_insert(s,t,e){const i=e?s:this.toBBox(s),r=[],n=this._chooseSubtree(i,this.data,t,r);for(n.children.push(s),np(n,i);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(i,r,t)}_split(s,t){const e=s[t],i=e.children.length,r=this._minEntries;this._chooseSplitAxis(e,r,i);const n=this._chooseSplitIndex(e,r,i),o=Mc(e.children.splice(n,e.children.length-n));o.height=e.height,o.leaf=e.leaf,pc(e,this.toBBox),pc(o,this.toBBox),t?s[t-1].children.push(o):this._splitRoot(e,o)}_splitRoot(s,t){this.data=Mc([s,t]),this.data.height=s.height+1,this.data.leaf=!1,pc(this.data,this.toBBox)}_chooseSplitIndex(s,t,e){let i,r=1/0,n=1/0;for(let o=t;o<=e-t;o++){const a=rp(s,0,o,this.toBBox),l=rp(s,o,e,this.toBBox),h=xst(a,l),c=cx(a)+cx(l);h<r?(r=h,i=o,n=c<n?c:n):h===r&&c<n&&(n=c,i=o)}return i||e-t}_chooseSplitAxis(s,t,e){const i=s.leaf?this.compareMinX:mst,r=s.leaf?this.compareMinY:_st,n=this._allDistMargin(s,t,e,i),o=this._allDistMargin(s,t,e,r);n<o&&s.children.sort(i)}_allDistMargin(s,t,e,i){s.children.sort(i);const r=this.toBBox,n=rp(s,0,t,r),o=rp(s,e-t,e,r);let a=dm(n)+dm(o);for(let l=t;l<e-t;l++){const h=s.children[l];np(n,s.leaf?r(h):h),a+=dm(n)}for(let l=e-t-1;l>=t;l--){const h=s.children[l];np(o,s.leaf?r(h):h),a+=dm(o)}return a}_adjustParentBBoxes(s,t,e){for(let i=e;i>=0;i--)np(t[i],s)}_condense(s){for(let t=s.length-1,e;t>=0;t--)s[t].children.length===0?t>0?(e=s[t-1].children,e.splice(e.indexOf(s[t]),1)):this.clear():pc(s[t],this.toBBox)}};function fst(s,t,e){if(!e)return t.indexOf(s);for(let i=0;i<t.length;i++)if(e(s,t[i]))return i;return-1}function pc(s,t){rp(s,0,s.children.length,t,s)}function rp(s,t,e,i,r){r||(r=Mc(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let n=t;n<e;n++){const o=s.children[n];np(r,s.leaf?i(o):o)}return r}function np(s,t){return s.minX=Math.min(s.minX,t.minX),s.minY=Math.min(s.minY,t.minY),s.maxX=Math.max(s.maxX,t.maxX),s.maxY=Math.max(s.maxY,t.maxY),s}function mst(s,t){return s.minX-t.minX}function _st(s,t){return s.minY-t.minY}function cx(s){return(s.maxX-s.minX)*(s.maxY-s.minY)}function dm(s){return s.maxX-s.minX+(s.maxY-s.minY)}function yst(s,t){return(Math.max(t.maxX,s.maxX)-Math.min(t.minX,s.minX))*(Math.max(t.maxY,s.maxY)-Math.min(t.minY,s.minY))}function xst(s,t){const e=Math.max(s.minX,t.minX),i=Math.max(s.minY,t.minY),r=Math.min(s.maxX,t.maxX),n=Math.min(s.maxY,t.maxY);return Math.max(0,r-e)*Math.max(0,n-i)}function ux(s,t){return s.minX<=t.minX&&s.minY<=t.minY&&t.maxX<=s.maxX&&t.maxY<=s.maxY}function pm(s,t){return t.minX<=s.maxX&&t.minY<=s.maxY&&t.maxX>=s.minX&&t.maxY>=s.minY}function Mc(s){return{children:s,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function qR(s,t,e,i,r){const n=[t,e];for(;n.length;){if(e=n.pop(),t=n.pop(),e-t<=i)continue;const o=t+Math.ceil((e-t)/i/2)*i;pst(s,o,t,e,r),n.push(t,o,o,e)}}const yt={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function YR(s){return s[0]>0&&s[1]>0}function vst(s,t,e){return e===void 0&&(e=[0,0]),e[0]=s[0]*t+.5|0,e[1]=s[1]*t+.5|0,e}function ar(s,t){return Array.isArray(s)?s:(t===void 0?t=[s,s]:(t[0]=s,t[1]=s),t)}class TS{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=ar(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new TS({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return Xt()}getImage(t){return Xt()}getHitDetectionImage(){return Xt()}getPixelRatio(t){return 1}getImageState(){return Xt()}getImageSize(){return Xt()}getOrigin(){return Xt()}getSize(){return Xt()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=ar(t)}listenImageChange(t){Xt()}load(){Xt()}unlistenImageChange(t){Xt()}ready(){return Promise.resolve()}}const Xk=TS,_g={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var As={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};As.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};As.max=As.whitepoint[2].D65;As.rgb=function(s,t){t=t||As.whitepoint[2].E;var e=s[0]/t[0],i=s[1]/t[1],r=s[2]/t[2],n,o,a;return n=e*3.240969941904521+i*-1.537383177570093+r*-.498610760293,o=e*-.96924363628087+i*1.87596750150772+r*.041555057407175,a=e*.055630079696993+i*-.20397695888897+r*1.056971514242878,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:n=n*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,n=Math.min(Math.max(0,n),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[n*255,o*255,a*255]};_g.xyz=function(s,t){var e=s[0]/255,i=s[1]/255,r=s[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;var n=e*.41239079926595+i*.35758433938387+r*.18048078840183,o=e*.21263900587151+i*.71516867876775+r*.072192315360733,a=e*.019330818715591+i*.11919477979462+r*.95053215224966;return t=t||As.whitepoint[2].E,[n*t[0],o*t[1],a*t[2]]};const RS={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(s,t,e){var i,r,n,o,a,l,h,c,u,d,p,g,f;if(n=s[0],o=s[1],a=s[2],n===0)return[0,0,0];var m=.0011070564598794539;return t=t||"D65",e=e||2,u=As.whitepoint[e][t][0],d=As.whitepoint[e][t][1],p=As.whitepoint[e][t][2],g=4*u/(u+15*d+3*p),f=9*d/(u+15*d+3*p),i=o/(13*n)+g||0,r=a/(13*n)+f||0,h=n>8?d*Math.pow((n+16)/116,3):d*n*m,l=h*9*i/(4*r)||0,c=h*(12-3*i-20*r)/(4*r)||0,[l,h,c]}};As.luv=function(s,t,e){var i,r,n,o,a,l,h,c,u,d,p,g,f,m=.008856451679035631,_=903.2962962962961;t=t||"D65",e=e||2,u=As.whitepoint[e][t][0],d=As.whitepoint[e][t][1],p=As.whitepoint[e][t][2],g=4*u/(u+15*d+3*p),f=9*d/(u+15*d+3*p),l=s[0],h=s[1],c=s[2],i=4*l/(l+15*h+3*c)||0,r=9*h/(l+15*h+3*c)||0;var y=h/d;return n=y<=m?_*y:116*Math.pow(y,1/3)-16,o=13*n*(i-g),a=13*n*(r-f),[n,o,a]};var qk={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(s){var t=s[0],e=s[1],i=s[2],r,n,o;return o=i/360*2*Math.PI,r=e*Math.cos(o),n=e*Math.sin(o),[t,r,n]},xyz:function(s){return RS.xyz(qk.luv(s))}};RS.lchuv=function(s){var t=s[0],e=s[1],i=s[2],r=Math.sqrt(e*e+i*i),n=Math.atan2(i,e),o=n*360/2/Math.PI;return o<0&&(o+=360),[t,r,o]};As.lchuv=function(s){return RS.lchuv(As.luv(s))};function Yk(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var bst={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};const ZR=Yk(bst);var KR={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function wst(s){var t,e,i,r=[],n=1,o;if(typeof s=="number")return{space:"rgb",values:[s>>>16,(s&65280)>>>8,s&255],alpha:1};if(typeof s=="number")return{space:"rgb",values:[s>>>16,(s&65280)>>>8,s&255],alpha:1};if(s=String(s).toLowerCase(),ZR[s])r=ZR[s].slice(),o="rgb";else if(s==="transparent")n=0,o="rgb",r=[0,0,0];else if(s[0]==="#"){var a=s.slice(1),l=a.length,h=l<=4;n=1,h?(r=[parseInt(a[0]+a[0],16),parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16)],l===4&&(n=parseInt(a[3]+a[3],16)/255)):(r=[parseInt(a[0]+a[1],16),parseInt(a[2]+a[3],16),parseInt(a[4]+a[5],16)],l===8&&(n=parseInt(a[6]+a[7],16)/255)),r[0]||(r[0]=0),r[1]||(r[1]=0),r[2]||(r[2]=0),o="rgb"}else if(i=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(s)){var c=i[1];o=c.replace(/a$/,"");var u=o==="cmyk"?4:o==="gray"?1:3;r=i[2].trim().split(/\s*[,\/]\s*|\s+/),o==="color"&&(o=r.shift()),r=r.map(function(d,p){if(d[d.length-1]==="%")return d=parseFloat(d)/100,p===3?d:o==="rgb"?d*255:o[0]==="h"||o[0]==="l"&&!p?d*100:o==="lab"?d*125:o==="lch"?p<2?d*150:d*360:o[0]==="o"&&!p?d:o==="oklab"?d*.4:o==="oklch"?p<2?d*.4:d*360:d;if(o[p]==="h"||p===2&&o[o.length-1]==="h"){if(KR[d]!==void 0)return KR[d];if(d.endsWith("deg"))return parseFloat(d);if(d.endsWith("turn"))return parseFloat(d)*360;if(d.endsWith("grad"))return parseFloat(d)*360/400;if(d.endsWith("rad"))return parseFloat(d)*180/Math.PI}return d==="none"?0:parseFloat(d)}),n=r.length>u?r.pop():1}else/[0-9](?:\s|\/|,)/.test(s)&&(r=s.match(/([0-9]+)/g).map(function(d){return parseFloat(d)}),o=((e=(t=s.match(/([a-z])/ig))==null?void 0:t.join(""))==null?void 0:e.toLowerCase())||"rgb");return{space:o,values:r,alpha:n}}const dx={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(s){var t=s[0]/360,e=s[1]/100,i=s[2]/100,r,n,o,a,l,h=0;if(e===0)return l=i*255,[l,l,l];for(n=i<.5?i*(1+e):i+e-i*e,r=2*i-n,a=[0,0,0];h<3;)o=t+1/3*-(h-1),o<0?o++:o>1&&o--,l=6*o<1?r+(n-r)*6*o:2*o<1?n:3*o<2?r+(n-r)*(2/3-o)*6:r,a[h++]=l*255;return a}};_g.hsl=function(s){var t=s[0]/255,e=s[1]/255,i=s[2]/255,r=Math.min(t,e,i),n=Math.max(t,e,i),o=n-r,a,l,h;return n===r?a=0:t===n?a=(e-i)/o:e===n?a=2+(i-t)/o:i===n&&(a=4+(t-e)/o),a=Math.min(a*60,360),a<0&&(a+=360),h=(r+n)/2,n===r?l=0:h<=.5?l=o/(n+r):l=o/(2-n-r),[a,l*100,h*100]};function Est(s){Array.isArray(s)&&s.raw&&(s=String.raw(...arguments)),s instanceof Number&&(s=+s);var t,e=wst(s);if(!e.space)return[];const i=e.space[0]==="h"?dx.min:_g.min,r=e.space[0]==="h"?dx.max:_g.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],i[0]),r[0]),t[1]=Math.min(Math.max(e.values[1],i[1]),r[1]),t[2]=Math.min(Math.max(e.values[2],i[2]),r[2]),e.space[0]==="h"&&(t=dx.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}function Sst(s){return typeof s=="string"?s:Kk(s)}const Cst=1024,Ud={};let px=0;function Tst(s){if(s.length===4)return s;const t=s.slice();return t[3]=1,t}function JR(s){const t=As.lchuv(_g.xyz(s));return t[3]=s[3],t}function Rst(s){const t=As.rgb(qk.xyz(s));return t[3]=s[3],t}function MS(s){if(Ud.hasOwnProperty(s))return Ud[s];if(px>=Cst){let e=0;for(const i in Ud)e++&3||(delete Ud[i],--px)}const t=Est(s);if(t.length!==4)throw new Error('Failed to parse "'+s+'" as color');for(const e of t)if(isNaN(e))throw new Error('Failed to parse "'+s+'" as color');return Zk(t),Ud[s]=t,++px,t}function Hu(s){return Array.isArray(s)?s:MS(s)}function Zk(s){return s[0]=Oi(s[0]+.5|0,0,255),s[1]=Oi(s[1]+.5|0,0,255),s[2]=Oi(s[2]+.5|0,0,255),s[3]=Oi(s[3],0,1),s}function Kk(s){let t=s[0];t!=(t|0)&&(t=t+.5|0);let e=s[1];e!=(e|0)&&(e=e+.5|0);let i=s[2];i!=(i|0)&&(i=i+.5|0);const r=s[3]===void 0?1:Math.round(s[3]*1e3)/1e3;return"rgba("+t+","+e+","+i+","+r+")"}function Mst(s){try{return MS(s),!0}catch{return!1}}const Pl=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",Ist=Pl.includes("firefox"),Ast=Pl.includes("safari")&&!Pl.includes("chrom");Ast&&(Pl.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Pl));const Lst=Pl.includes("webkit")&&!Pl.includes("edge"),IS=Pl.includes("macintosh"),Jk=typeof devicePixelRatio<"u"?devicePixelRatio:1,Qk=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,AS=typeof Image<"u"&&Image.prototype.decode,Pst=typeof createImageBitmap=="function",tN=function(){let s=!1;try{const t=Object.defineProperty({},"passive",{get:function(){s=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return s}();function ws(s,t,e,i){let r;return e&&e.length?r=e.shift():Qk?r=new OffscreenCanvas(s||300,t||300):r=document.createElement("canvas"),s&&(r.width=s),t&&(r.height=t),r.getContext("2d",i)}let gx;function ob(){return gx||(gx=ws(1,1)),gx}function bf(s){const t=s.canvas;t.width=1,t.height=1,s.clearRect(0,0,1,1)}function Ost(s){let t=s.offsetWidth;const e=getComputedStyle(s);return t+=parseInt(e.marginLeft,10)+parseInt(e.marginRight,10),t}function Fst(s){let t=s.offsetHeight;const e=getComputedStyle(s);return t+=parseInt(e.marginTop,10)+parseInt(e.marginBottom,10),t}function Wu(s,t){const e=t.parentNode;e&&e.replaceChild(s,t)}function H0(s){return s&&s.parentNode?s.parentNode.removeChild(s):null}function eN(s){for(;s.lastChild;)s.removeChild(s.lastChild)}function kst(s,t){const e=s.childNodes;for(let i=0;;++i){const r=e[i],n=t[i];if(!r&&!n)break;if(r!==n){if(!r){s.appendChild(n);continue}if(!n){s.removeChild(r),--i;continue}s.insertBefore(n,r)}}}class iN extends pf{constructor(t,e,i,r){super(),this.extent=t,this.pixelRatio_=i,this.resolution=e,this.state=typeof r=="function"?yt.IDLE:r,this.image_=null,this.loader=typeof r=="function"?r:null}changed(){this.dispatchEvent(Mt.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==yt.IDLE&&this.loader){this.state=yt.LOADING,this.changed();const t=this.getResolution(),e=Array.isArray(t)?t[0]:t;Qet(()=>this.loader(this.getExtent(),e,this.getPixelRatio())).then(i=>{"image"in i&&(this.image_=i.image),"extent"in i&&(this.extent=i.extent),"resolution"in i&&(this.resolution=i.resolution),"pixelRatio"in i&&(this.pixelRatio_=i.pixelRatio),(i instanceof HTMLImageElement||i instanceof ImageBitmap||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement)&&(this.image_=i),this.state=yt.LOADED}).catch(i=>{this.state=yt.ERROR,console.error(i)}).finally(()=>this.changed())}}setImage(t){this.image_=t}setResolution(t){this.resolution=t}}function Nst(s,t,e){const i=s;let r=!0,n=!1,o=!1;const a=[pg(i,Mt.LOAD,function(){o=!0,n||t()})];return i.src&&AS?(n=!0,i.decode().then(function(){r&&t()}).catch(function(l){r&&(o?t():e())})):a.push(pg(i,Mt.ERROR,e)),function(){r=!1,a.forEach(ii)}}function Dst(s,t){return new Promise((e,i)=>{function r(){o(),e(s)}function n(){o(),i(new Error("Image load error"))}function o(){s.removeEventListener("load",r),s.removeEventListener("error",n)}s.addEventListener("load",r),s.addEventListener("error",n),t&&(s.src=t)})}function sN(s,t){return t&&(s.src=t),s.src&&AS?new Promise((e,i)=>s.decode().then(()=>e(s)).catch(r=>s.complete&&s.width?e(s):i(r))):Dst(s)}function rN(s,t){return t&&(s.src=t),s.src&&AS&&Pst?s.decode().then(()=>createImageBitmap(s)).catch(e=>{if(s.complete&&s.width)return s;throw e}):sN(s)}class $st{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const i=this.cache_[e];!(t++&3)&&!i.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,i){const r=fx(t,e,i);return r in this.cache_?this.cache_[r]:null}getPattern(t,e,i){const r=fx(t,e,i);return r in this.patternCache_?this.patternCache_[r]:null}set(t,e,i,r,n){const o=fx(t,e,i),a=o in this.cache_;this.cache_[o]=r,n&&(r.getImageState()===yt.IDLE&&r.load(),r.getImageState()===yt.LOADING?r.ready().then(()=>{this.patternCache_[o]=ob().createPattern(r.getImage(1),"repeat")}):this.patternCache_[o]=ob().createPattern(r.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function fx(s,t,e){const i=e?Hu(e):"null";return t+":"+s+":"+i}const no=new $st;let Vd=null;class jst extends pf{constructor(t,e,i,r,n){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=i,this.canvas_={},this.color_=n,this.imageState_=r===void 0?yt.IDLE:r,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===yt.LOADED){Vd||(Vd=ws(1,1,void 0,{willReadFrequently:!0})),Vd.drawImage(this.image_,0,0);try{Vd.getImageData(0,0,1,1),this.tainted_=!1}catch{Vd=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(Mt.CHANGE)}handleImageError_(){this.imageState_=yt.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=yt.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=ws(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===yt.IDLE){this.image_||this.initializeImage_(),this.imageState_=yt.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&sN(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==yt.LOADED)return;const e=this.image_,i=document.createElement("canvas");i.width=Math.ceil(e.width*t),i.height=Math.ceil(e.height*t);const r=i.getContext("2d");r.scale(t,t),r.drawImage(e,0,0),r.globalCompositeOperation="multiply",r.fillStyle=Sst(this.color_),r.fillRect(0,0,i.width/t,i.height/t),r.globalCompositeOperation="destination-in",r.drawImage(e,0,0),this.canvas_[t]=i}ready(){return this.ready_||(this.ready_=new Promise(t=>{this.imageState_===yt.LOADED||this.imageState_===yt.ERROR?t():this.addEventListener(Mt.CHANGE,function e(){(this.imageState_===yt.LOADED||this.imageState_===yt.ERROR)&&(this.removeEventListener(Mt.CHANGE,e),t())})})),this.ready_}}function LS(s,t,e,i,r,n){let o=t===void 0?void 0:no.get(t,e,r);return o||(o=new jst(s,s instanceof HTMLImageElement?s.src||void 0:t,e,i,r),no.set(t,e,r,o,n)),n&&o&&!no.getPattern(t,e,r)&&no.set(t,e,r,o,n),o}function oo(s){return s?Array.isArray(s)?Kk(s):typeof s=="object"&&"src"in s?Gst(s):s:null}function Gst(s){if(!s.offset||!s.size)return no.getPattern(s.src,"anonymous",s.color);const t=s.src+":"+s.offset,e=no.getPattern(t,void 0,s.color);if(e)return e;const i=no.get(s.src,"anonymous",null);if(i.getImageState()!==yt.LOADED)return null;const r=ws(s.size[0],s.size[1]);return r.drawImage(i.getImage(1),s.offset[0],s.offset[1],s.size[0],s.size[1],0,0,s.size[0],s.size[1]),LS(r.canvas,t,void 0,yt.LOADED,s.color,!0),no.getPattern(t,void 0,s.color)}const gm="ol-hidden",zst="ol-selectable",vo="ol-unselectable",QR="ol-unsupported",qh="ol-control",W0="ol-collapsed",Bst=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),tM=["style","variant","weight","size","lineHeight","family"],nN=function(s){const t=s.match(Bst);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,r=tM.length;i<r;++i){const n=t[i+1];n!==void 0&&(e[tM[i]]=n)}return e.families=e.family.split(/,\s?/),e},oN="10px sans-serif",Er="#000",Xu="round",ra=[],na=0,qu="round",yg=10,xg="#000",vg="center",X0="middle",ph=[0,0,0,0],bg=1,zo=new Vn;let Ic=null,ab;const lb={},Ust=function(){const s="32px ",t=["monospace","serif"],e=t.length,i="wmytzilWMYTZIL@#/&?$%10";let r,n;function o(l,h,c){let u=!0;for(let d=0;d<e;++d){const p=t[d];if(n=q0(l+" "+h+" "+s+p,i),c!=p){const g=q0(l+" "+h+" "+s+c+","+p,i);u=u&&g!=n}}return!!u}function a(){let l=!0;const h=zo.getKeys();for(let c=0,u=h.length;c<u;++c){const d=h[c];zo.get(d)<100&&(o.apply(this,d.split(`
`))?(df(lb),Ic=null,ab=void 0,zo.set(d,100)):(zo.set(d,zo.get(d)+1,!0),l=!1))}l&&(clearInterval(r),r=void 0)}return function(l){const h=nN(l);if(!h)return;const c=h.families;for(let u=0,d=c.length;u<d;++u){const p=c[u],g=h.style+`
`+h.weight+`
`+p;zo.get(g)===void 0&&(zo.set(g,100,!0),o(h.style,h.weight,p)||(zo.set(g,0,!0),r===void 0&&(r=setInterval(a,32))))}}}(),Vst=function(){let s;return function(t){let e=lb[t];if(e==null){if(Qk){const i=nN(t),r=aN(t,"Žg");e=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent)}else s||(s=document.createElement("div"),s.innerHTML="M",s.style.minHeight="0",s.style.maxHeight="none",s.style.height="auto",s.style.padding="0",s.style.border="none",s.style.position="absolute",s.style.display="block",s.style.left="-99999px"),s.style.font=t,document.body.appendChild(s),e=s.offsetHeight,document.body.removeChild(s);lb[t]=e}return e}}();function aN(s,t){return Ic||(Ic=ws(1,1)),s!=ab&&(Ic.font=s,ab=Ic.font),Ic.measureText(t)}function q0(s,t){return aN(s,t).width}function eM(s,t,e){if(t in e)return e[t];const i=t.split(`
`).reduce((r,n)=>Math.max(r,q0(s,n)),0);return e[t]=i,i}function Hst(s,t){const e=[],i=[],r=[];let n=0,o=0,a=0,l=0;for(let h=0,c=t.length;h<=c;h+=2){const u=t[h];if(u===`
`||h===c){n=Math.max(n,o),r.push(o),o=0,a+=l;continue}const d=t[h+1]||s.font,p=q0(d,u);e.push(p),o+=p;const g=Vst(d);i.push(g),l=Math.max(l,g)}return{width:n,height:a,widths:e,heights:i,lineWidths:r}}function Wst(s,t,e,i,r,n,o,a,l,h,c){s.save(),e!==1&&(s.globalAlpha===void 0?s.globalAlpha=u=>u.globalAlpha*=e:s.globalAlpha*=e),t&&s.transform.apply(s,t),i.contextInstructions?(s.translate(l,h),s.scale(c[0],c[1]),Xst(i,s)):c[0]<0||c[1]<0?(s.translate(l,h),s.scale(c[0],c[1]),s.drawImage(i,r,n,o,a,0,0,o,a)):s.drawImage(i,r,n,o,a,l,h,o*c[0],a*c[1]),s.restore()}function Xst(s,t){const e=s.contextInstructions;for(let i=0,r=e.length;i<r;i+=2)Array.isArray(e[i+1])?t[e[i]].apply(t,e[i+1]):t[e[i]]=e[i+1]}class PS extends Xk{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?yt.LOADING:yt.LOADED,this.imageState_===yt.LOADING&&this.ready().then(()=>this.imageState_=yt.LOADED),this.render()}clone(){const t=this.getScale(),e=new PS({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let e=this.canvases_[t];if(!e){const i=this.renderOptions_,r=ws(i.size*t,i.size*t);this.draw_(i,r,t),e=r.canvas,this.canvases_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let r=this.radius_,n=this.radius2_===void 0?r:this.radius2_;if(r<n){const b=r;r=n,n=b}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=n*Math.sin(a),h=Math.sqrt(n*n-l*l),c=r-h,u=Math.sqrt(l*l+c*c),d=u/l;if(t==="miter"&&d<=i)return d*e;const p=e/2/d,g=e/2*(c/u),f=Math.sqrt((r+p)*(r+p)+g*g)-r;if(this.radius2_===void 0||t==="bevel")return f*2;const m=r*Math.sin(a),_=Math.sqrt(r*r-m*m),y=n-_,v=Math.sqrt(m*m+y*y)/m;if(v<=i){const b=v*e/2-n-r;return 2*Math.max(f,b)}return f*2}createRenderOptions(){let t=Xu,e=qu,i=0,r=null,n=0,o,a=0;this.stroke_&&(o=oo(this.stroke_.getColor()??xg),a=this.stroke_.getWidth()??bg,r=this.stroke_.getLineDash(),n=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??qu,t=this.stroke_.getLineCap()??Xu,i=this.stroke_.getMiterLimit()??yg);const l=this.calculateLineJoinSize_(e,a,i),h=Math.max(this.radius_,this.radius2_||0),c=Math.ceil(2*h+l);return{strokeStyle:o,strokeWidth:a,size:c,lineCap:t,lineDash:r,lineDashOffset:n,lineJoin:e,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let r=this.fill_.getColor();r===null&&(r=Er),e.fillStyle=oo(r),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let i=this.fill_.getColor(),r=0;typeof i=="string"&&(i=Hu(i)),i===null?r=1:Array.isArray(i)&&(r=i.length===4?i[3]:1),r===0&&(e=ws(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const i=this.radius_;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const r=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(e*=2);const n=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let a=0;a<e;a++){const l=n+a*o,h=a%2===0?i:r;t.lineTo(h*Math.cos(l),h*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=Er,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}const lN=PS;class OS extends lN{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new OS({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}const FS=OS;class kS{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new kS({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=LS(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===yt.IDLE&&e.load(),e.getImageState()===yt.LOADING&&(this.patternImage_=e)}this.color_=t}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}const Ol=kS;class NS{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new NS({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}const Cl=NS;class pl{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=iM,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new pl({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=iM,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function qst(s){let t;if(typeof s=="function")t=s;else{let e;Array.isArray(s)?e=s:(Te(typeof s.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[s]),t=function(){return e}}return t}let mx=null;function Yst(s,t){if(!mx){const e=new Ol({color:"rgba(255,255,255,0.4)"}),i=new Cl({color:"#3399CC",width:1.25});mx=[new pl({image:new FS({fill:e,stroke:i,radius:5}),fill:e,stroke:i})]}return mx}function hN(){const s={},t=[255,255,255,1],e=[0,153,255,1],i=3;return s.Polygon=[new pl({fill:new Ol({color:[255,255,255,.5]})})],s.MultiPolygon=s.Polygon,s.LineString=[new pl({stroke:new Cl({color:t,width:i+2})}),new pl({stroke:new Cl({color:e,width:i})})],s.MultiLineString=s.LineString,s.Circle=s.Polygon.concat(s.LineString),s.Point=[new pl({image:new FS({radius:i*2,fill:new Ol({color:e}),stroke:new Cl({color:t,width:i/2})}),zIndex:1/0})],s.MultiPoint=s.Point,s.GeometryCollection=s.Polygon.concat(s.LineString,s.Point),s}function iM(s){return s.getGeometry()}const co=pl;function sM(s,t,e,i){return e!==void 0&&i!==void 0?[e/s,i/t]:e!==void 0?e/s:i!==void 0?i/t:1}class DS extends Xk{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,i=t.rotation!==void 0?t.rotation:0,r=t.scale!==void 0?t.scale:1,n=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:i,scale:r,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:n,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const o=t.img!==void 0?t.img:null;let a=t.src;Te(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||Nt(o)),Te(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),Te(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=yt.IDLE:o!==void 0&&(o instanceof HTMLImageElement?o.complete?l=o.src?yt.LOADED:yt.IDLE:l=yt.LOADING:l=yt.LOADED),this.color_=t.color!==void 0?Hu(t.color):null,this.iconImage_=LS(o,a,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,t.width!==void 0||t.height!==void 0){let h,c;if(t.size)[h,c]=t.size;else{const u=this.getImage(1);if(u.width&&u.height)h=u.width,c=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=t;const d=()=>{if(this.unlistenImageChange(d),!this.initialOptions_)return;const p=this.iconImage_.getSize();this.setScale(sM(p[0],p[1],t.width,t.height))};this.listenImageChange(d);return}}h!==void 0&&this.setScale(sM(h,c,t.width,t.height))}}clone(){let t,e,i;return this.initialOptions_?(e=this.initialOptions_.width,i=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new DS({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const r=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!r)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=r[0]),this.anchorYUnits_=="fraction"&&(t[1]*=r[1])}if(this.anchorOrigin_!="top-left"){if(!r)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+r[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+r[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=i[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==yt.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==yt.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(Mt.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(Mt.CHANGE,t)}ready(){return this.iconImage_.ready()}}const Fy=DS,Zst="#333";class $S{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=ar(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new Ol({color:Zst}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new $S({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=ar(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}const jS=$S;let xd=0;const vd=0,qi=1<<xd++,Rt=1<<xd++,On=1<<xd++,Hs=1<<xd++,ma=1<<xd++,Bs=Math.pow(2,xd)-1,cN={[qi]:"boolean",[Rt]:"number",[On]:"string",[Hs]:"color",[ma]:"number[]"},Kst=Object.keys(cN).map(Number).sort(ga);function qs(s){const t=[];for(const e of Kst)Jst(s,e)&&t.push(cN[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function Jst(s,t){return(s&t)===t}function uo(s,t){return!!(s&t)}function ky(s,t){return s===t}class gl{constructor(t,e){this.type=t,this.value=e}}class Qst{constructor(t,e,...i){this.type=t,this.operator=e,this.args=i}}function uN(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,style:{}}}function trt(s){switch(s){case"string":return On;case"color":return Hs;case"number":return Rt;case"boolean":return qi;case"number[]":return ma;default:throw new Error(`Unrecognized type hint: ${s}`)}}function Ke(s,t,e){switch(typeof s){case"boolean":return new gl(qi,s);case"number":return new gl(Rt,s);case"string":{let r=On;return Mst(s)&&(r|=Hs),ky(r&e,vd)||(r&=e),new gl(r,s)}}if(!Array.isArray(s))throw new Error("Expression must be an array or a primitive value");if(s.length===0)throw new Error("Empty expression");if(typeof s[0]=="string")return drt(s,t,e);for(const r of s)if(typeof r!="number")throw new Error("Expected an array of numbers");let i=ma;return(s.length===3||s.length===4)&&(i|=Hs),e&&(i&=e),new gl(i,s)}const J={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette"},ert={[J.Get]:ie(([s,t])=>t!==void 0?trt(t.value):Bs,de(1,2),irt),[J.Var]:ie(([s])=>s.type,de(1,1),srt),[J.Id]:ie(Rt|On,Hd,rrt),[J.Concat]:ie(On,de(2,1/0),Oe(Bs)),[J.GeometryType]:ie(On,Hd,nrt),[J.Resolution]:ie(Rt,Hd),[J.Zoom]:ie(Rt,Hd),[J.Time]:ie(Rt,Hd),[J.Any]:ie(qi,de(2,1/0),Oe(qi)),[J.All]:ie(qi,de(2,1/0),Oe(qi)),[J.Not]:ie(qi,de(1,1),Oe(qi)),[J.Equal]:ie(qi,de(2,2),Oe(Bs),Wa),[J.NotEqual]:ie(qi,de(2,2),Oe(Bs),Wa),[J.GreaterThan]:ie(qi,de(2,2),Oe(Bs),Wa),[J.GreaterThanOrEqualTo]:ie(qi,de(2,2),Oe(Bs),Wa),[J.LessThan]:ie(qi,de(2,2),Oe(Bs),Wa),[J.LessThanOrEqualTo]:ie(qi,de(2,2),Oe(Bs),Wa),[J.Multiply]:ie(s=>{let t=Rt|Hs;for(let e=0;e<s.length;e++)t&=s[e].type;return t},de(2,1/0),Oe(Rt|Hs),Wa),[J.Coalesce]:ie(s=>{let t=Bs;for(let e=1;e<s.length;e+=2)t&=s[e].type;return t&=s[s.length-1].type,t},de(2,1/0),Oe(Bs),Wa),[J.Divide]:ie(Rt,de(2,2),Oe(Rt)),[J.Add]:ie(Rt,de(2,1/0),Oe(Rt)),[J.Subtract]:ie(Rt,de(2,2),Oe(Rt)),[J.Clamp]:ie(Rt,de(3,3),Oe(Rt)),[J.Mod]:ie(Rt,de(2,2),Oe(Rt)),[J.Pow]:ie(Rt,de(2,2),Oe(Rt)),[J.Abs]:ie(Rt,de(1,1),Oe(Rt)),[J.Floor]:ie(Rt,de(1,1),Oe(Rt)),[J.Ceil]:ie(Rt,de(1,1),Oe(Rt)),[J.Round]:ie(Rt,de(1,1),Oe(Rt)),[J.Sin]:ie(Rt,de(1,1),Oe(Rt)),[J.Cos]:ie(Rt,de(1,1),Oe(Rt)),[J.Atan]:ie(Rt,de(1,2),Oe(Rt)),[J.Sqrt]:ie(Rt,de(1,1),Oe(Rt)),[J.Match]:ie(s=>{let t=Bs;for(let e=2;e<s.length;e+=2)t&=s[e].type;return t&=s[s.length-1].type,t},de(4,1/0),rM,art),[J.Between]:ie(qi,de(3,3),Oe(Rt)),[J.Interpolate]:ie(s=>{let t=Hs|Rt;for(let e=3;e<s.length;e+=2)t&=s[e].type;return t},de(6,1/0),rM,lrt),[J.Case]:ie(s=>{let t=Bs;for(let e=1;e<s.length;e+=2)t&=s[e].type;return t&=s[s.length-1].type,t},de(3,1/0),ort,hrt),[J.In]:ie(qi,de(2,2),crt),[J.Number]:ie(Rt,de(1,1/0),Oe(Bs)),[J.String]:ie(On,de(1,1/0),Oe(Bs)),[J.Array]:ie(s=>s.length===3||s.length===4?ma|Hs:ma,de(1,1/0),Oe(Rt)),[J.Color]:ie(Hs,de(1,4),Oe(Rt)),[J.Band]:ie(Rt,de(1,3),Oe(Rt)),[J.Palette]:ie(Hs,de(2,2),urt)};function irt(s,t){const e=Ke(s[1],t);if(!(e instanceof gl))throw new Error("Expected a literal argument for get operation");if(typeof e.value!="string")throw new Error("Expected a string argument for get operation");if(t.properties.add(e.value),s.length===3){const i=Ke(s[2],t);return[e,i]}return[e]}function srt(s,t,e,i){const r=s[1];if(typeof r!="string")throw new Error("Expected a string argument for var operation");if(t.variables.add(r),!("variables"in t.style)||t.style.variables[r]===void 0)return[new gl(Bs,r)];const n=t.style.variables[r],o=Ke(n,t);if(o.value=r,i&&!uo(i,o.type))throw new Error(`The variable ${r} has type ${qs(o.type)} but the following type was expected: ${qs(i)}`);return[o]}function rrt(s,t){t.featureId=!0}function nrt(s,t){t.geometryType=!0}function Hd(s,t){const e=s[0];if(s.length!==1)throw new Error(`Expected no arguments for ${e} operation`);return[]}function de(s,t){return function(e,i){const r=e[0],n=e.length-1;if(s===t){if(n!==s){const o=s===1?"":"s";throw new Error(`Expected ${s} argument${o} for ${r}, got ${n}`)}}else if(n<s||n>t){const o=t===1/0?`${s} or more`:`${s} to ${t}`;throw new Error(`Expected ${o} arguments for ${r}, got ${n}`)}}}function Oe(s){return function(t,e){const i=t[0],r=t.length-1,n=new Array(r);for(let o=0;o<r;++o){const a=Ke(t[o+1],e);if(!uo(s,a.type)){const l=qs(s),h=qs(a.type);throw new Error(`Unexpected type for argument ${o} of ${i} operation, got ${l} but expected ${h}`)}a.type&=s,n[o]=a}return n}}function Wa(s,t,e){const i=s[0],r=s.length-1;let n=Bs;for(let a=0;a<e.length;++a)n&=e[a].type;if(n===vd)throw new Error(`No common type could be found for arguments of ${i} operation`);const o=new Array(r);for(let a=0;a<r;++a)o[a]=Ke(s[a+1],t,n);return o}function ort(s,t){const e=s[0],i=s.length-1;if(i%2===0)throw new Error(`An odd amount of arguments was expected for operation ${e}, got ${JSON.stringify(i)} instead`)}function rM(s,t){const e=s[0],i=s.length-1;if(i%2===1)throw new Error(`An even amount of arguments was expected for operation ${e}, got ${JSON.stringify(i)} instead`)}function art(s,t,e,i){const r=s.length-1;let n=Ke(s[1],t).type;const o=Ke(s[s.length-1],t);let a=i!==void 0?i&o.type:o.type;const l=new Array(r-2);for(let c=0;c<r-2;c+=2){const u=Ke(s[c+2],t),d=Ke(s[c+3],t);n&=u.type,a&=d.type,l[c]=u,l[c+1]=d}const h=On|Rt|qi;if(!uo(h,n))throw new Error(`Expected an input of type ${qs(h)} for the interpolate operation, got ${qs(n)} instead`);if(ky(a,vd))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(s));for(let c=0;c<r-2;c+=2){const u=Ke(s[c+2],t,n),d=Ke(s[c+3],t,a);l[c]=u,l[c+1]=d}return[Ke(s[1],t,n),...l,Ke(s[s.length-1],t,a)]}function lrt(s,t,e,i){const r=s[1];let n;switch(r[0]){case"linear":n=1;break;case"exponential":if(n=r[1],typeof n!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(n)} instead`);break;default:n=null}if(!n)throw new Error(`Invalid interpolation type: ${JSON.stringify(r)}`);n=Ke(n,t);let o=Ke(s[2],t);if(!uo(Rt,o.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${qs(o.type)} instead`);o=Ke(s[2],t,Rt);const a=new Array(s.length-3);for(let l=0;l<a.length;l+=2){let h=Ke(s[l+3],t);if(!uo(Rt,h.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${qs(h.type)} at position ${l+2} instead`);let c=Ke(s[l+4],t);if(!uo(Rt|Hs,c.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${qs(c.type)} at position ${l+3} instead`);h=Ke(s[l+3],t,Rt),c=Ke(s[l+4],t,Rt|Hs),a[l]=h,a[l+1]=c}return[n,o,...a]}function hrt(s,t,e,i){const r=Ke(s[s.length-1],t);let n=i!==void 0?i&r.type:r.type;const o=new Array(s.length-1);for(let a=0;a<o.length-1;a+=2){const l=Ke(s[a+1],t),h=Ke(s[a+2],t);if(!uo(qi,l.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${qs(l.type)} at position ${a} instead`);n&=h.type,o[a]=l,o[a+1]=h}if(ky(n,vd))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(s));for(let a=0;a<o.length-1;a+=2)o[a+1]=Ke(s[a+2],t,n);return o[o.length-1]=Ke(s[s.length-1],t,n),o}function crt(s,t){let e=s[2];if(!Array.isArray(e))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof e[0]=="string"){if(e[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(e[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');e=e[1]}let i=On|Rt;const r=new Array(e.length);for(let n=0;n<r.length;n++){const o=Ke(e[n],t);i&=o.type,r[n]=o}if(ky(i,vd))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(s));return[Ke(s[1],t,i),...r]}function urt(s,t){const e=Ke(s[1],t,Rt);if(e.type!==Rt)throw new Error(`The first argument of palette must be an number, got ${qs(e.type)} instead`);const i=s[2];if(!Array.isArray(i))throw new Error("The second argument of palette must be an array");const r=new Array(i.length);for(let n=0;n<r.length;n++){const o=Ke(i[n],t,Hs);if(!(o instanceof gl))throw new Error(`The palette color at index ${n} must be a literal value`);if(!uo(o.type,Hs))throw new Error(`The palette color at index ${n} should be of type color, got ${qs(o.type)} instead`);r[n]=o}return[e,...r]}function ie(s,...t){return function(e,i,r){const n=e[0];let o=[];for(let l=0;l<t.length;l++)o=t[l](e,i,o,r)||o;let a=typeof s=="function"?s(o):s;if(r!==void 0){if(!uo(a,r))throw new Error(`The following expression was expected to return ${qs(r)}, but returns ${qs(a)} instead: ${JSON.stringify(e)}`);a&=r}if(a===vd)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(e)}`);return new Qst(a,n,...o)}}function drt(s,t,e){const i=s[0],r=ert[i];if(!r)throw new Error(`Unknown operator: ${i}`);return r(s,t,e)}function dN(s){if(!s)return"";const t=s.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return dN(s.getGeometries()[0]);default:return""}}function pN(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function Aa(s,t,e){const i=Ke(s,e);if(!uo(t,i.type)){const r=qs(t),n=qs(i.type);throw new Error(`Expected expression to be of type ${r}, got ${n}`)}return bo(i)}function bo(s,t){if(s instanceof gl){if(s.type===Hs&&typeof s.value=="string"){const i=MS(s.value);return function(){return i}}return function(){return s.value}}const e=s.operator;switch(e){case J.Number:case J.String:case J.Coalesce:return prt(s);case J.Get:case J.Var:return grt(s);case J.Id:return i=>i.featureId;case J.GeometryType:return i=>i.geometryType;case J.Concat:{const i=s.args.map(r=>bo(r));return r=>"".concat(...i.map(n=>n(r).toString()))}case J.Resolution:return i=>i.resolution;case J.Any:case J.All:case J.Not:return mrt(s);case J.Equal:case J.NotEqual:case J.LessThan:case J.LessThanOrEqualTo:case J.GreaterThan:case J.GreaterThanOrEqualTo:return frt(s);case J.Multiply:case J.Divide:case J.Add:case J.Subtract:case J.Clamp:case J.Mod:case J.Pow:case J.Abs:case J.Floor:case J.Ceil:case J.Round:case J.Sin:case J.Cos:case J.Atan:case J.Sqrt:return _rt(s);case J.Case:return yrt(s);case J.Match:return xrt(s);case J.Interpolate:return vrt(s);default:throw new Error(`Unsupported operator ${e}`)}}function prt(s,t){const e=s.operator,i=s.args.length,r=new Array(i);for(let n=0;n<i;++n)r[n]=bo(s.args[n]);switch(e){case J.Coalesce:return n=>{for(let o=0;o<i;++o){const a=r[o](n);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case J.Number:case J.String:return n=>{for(let o=0;o<i;++o){const a=r[o](n);if(typeof a===e)return a}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function grt(s,t){const e=s.args[0].value;switch(s.operator){case J.Get:return i=>i.properties[e];case J.Var:return i=>i.variables[e];default:throw new Error(`Unsupported accessor operator ${s.operator}`)}}function frt(s,t){const e=s.operator,i=bo(s.args[0]),r=bo(s.args[1]);switch(e){case J.Equal:return n=>i(n)===r(n);case J.NotEqual:return n=>i(n)!==r(n);case J.LessThan:return n=>i(n)<r(n);case J.LessThanOrEqualTo:return n=>i(n)<=r(n);case J.GreaterThan:return n=>i(n)>r(n);case J.GreaterThanOrEqualTo:return n=>i(n)>=r(n);default:throw new Error(`Unsupported comparison operator ${e}`)}}function mrt(s,t){const e=s.operator,i=s.args.length,r=new Array(i);for(let n=0;n<i;++n)r[n]=bo(s.args[n]);switch(e){case J.Any:return n=>{for(let o=0;o<i;++o)if(r[o](n))return!0;return!1};case J.All:return n=>{for(let o=0;o<i;++o)if(!r[o](n))return!1;return!0};case J.Not:return n=>!r[0](n);default:throw new Error(`Unsupported logical operator ${e}`)}}function _rt(s,t){const e=s.operator,i=s.args.length,r=new Array(i);for(let n=0;n<i;++n)r[n]=bo(s.args[n]);switch(e){case J.Multiply:return n=>{let o=1;for(let a=0;a<i;++a)o*=r[a](n);return o};case J.Divide:return n=>r[0](n)/r[1](n);case J.Add:return n=>{let o=0;for(let a=0;a<i;++a)o+=r[a](n);return o};case J.Subtract:return n=>r[0](n)-r[1](n);case J.Clamp:return n=>{const o=r[0](n),a=r[1](n);if(o<a)return a;const l=r[2](n);return o>l?l:o};case J.Mod:return n=>r[0](n)%r[1](n);case J.Pow:return n=>Math.pow(r[0](n),r[1](n));case J.Abs:return n=>Math.abs(r[0](n));case J.Floor:return n=>Math.floor(r[0](n));case J.Ceil:return n=>Math.ceil(r[0](n));case J.Round:return n=>Math.round(r[0](n));case J.Sin:return n=>Math.sin(r[0](n));case J.Cos:return n=>Math.cos(r[0](n));case J.Atan:return i===2?n=>Math.atan2(r[0](n),r[1](n)):n=>Math.atan(r[0](n));case J.Sqrt:return n=>Math.sqrt(r[0](n));default:throw new Error(`Unsupported numeric operator ${e}`)}}function yrt(s,t){const e=s.args.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=bo(s.args[r]);return r=>{for(let n=0;n<e-1;n+=2)if(i[n](r))return i[n+1](r);return i[e-1](r)}}function xrt(s,t){const e=s.args.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=bo(s.args[r]);return r=>{const n=i[0](r);for(let o=1;o<e;o+=2)if(n===i[o](r))return i[o+1](r);return i[e-1](r)}}function vrt(s,t){const e=s.args.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=bo(s.args[r]);return r=>{const n=i[0](r),o=i[1](r);let a,l;for(let h=2;h<e;h+=2){const c=i[h](r);let u=i[h+1](r);const d=Array.isArray(u);if(d&&(u=Tst(u)),c>=o)return h===2?u:d?brt(n,o,a,l,c,u):op(n,o,a,l,c,u);a=c,l=u}return l}}function op(s,t,e,i,r,n){const o=r-e;if(o===0)return i;const a=t-e,l=s===1?a/o:(Math.pow(s,a)-1)/(Math.pow(s,o)-1);return i+l*(n-i)}function brt(s,t,e,i,r,n){if(r-e===0)return i;const o=JR(i),a=JR(n);let l=a[2]-o[2];l>180?l-=360:l<-180&&(l+=360);const h=[op(s,t,e,o[0],r,a[0]),op(s,t,e,o[1],r,a[1]),o[2]+op(s,t,e,0,r,l),op(s,t,e,i[3],r,n[3])];return Zk(Rst(h))}function wrt(s){return!0}function Ert(s){const t=uN(),e=Srt(s,t),i=pN();return function(r,n){if(i.properties=r.getPropertiesInternal(),i.resolution=n,t.featureId){const o=r.getId();o!==void 0?i.featureId=o:i.featureId=null}return t.geometryType&&(i.geometryType=dN(r.getGeometry())),e(i)}}function nM(s){const t=uN(),e=s.length,i=new Array(e);for(let o=0;o<e;++o)i[o]=hb(s[o],t);const r=pN(),n=new Array(e);return function(o,a){if(r.properties=o.getPropertiesInternal(),r.resolution=a,t.featureId){const h=o.getId();h!==void 0?r.featureId=h:r.featureId=null}let l=0;for(let h=0;h<e;++h){const c=i[h](r);c&&(n[l]=c,l+=1)}return n.length=l,n}}function Srt(s,t){const e=s.length,i=new Array(e);for(let r=0;r<e;++r){const n=s[r],o="filter"in n?Aa(n.filter,qi,t):wrt;let a;if(Array.isArray(n.style)){const l=n.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=hb(n.style[h],t)}else a=[hb(n.style,t)];i[r]={filter:o,styles:a}}return function(r){const n=[];let o=!1;for(let a=0;a<e;++a){const l=i[a].filter;if(l(r)&&!(s[a].else&&o)){o=!0;for(const h of i[a].styles){const c=h(r);c&&n.push(c)}}}return n}}function hb(s,t){const e=wg(s,"",t),i=Eg(s,"",t),r=Crt(s,t),n=Trt(s,t),o=Tr(s,"z-index",t);if(!e&&!i&&!r&&!n&&!Al(s))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(s));const a=new co;return function(l){let h=!0;if(e){const c=e(l);c&&(h=!1),a.setFill(c)}if(i){const c=i(l);c&&(h=!1),a.setStroke(c)}if(r){const c=r(l);c&&(h=!1),a.setText(c)}if(n){const c=n(l);c&&(h=!1),a.setImage(c)}return o&&a.setZIndex(o(l)),h?null:a}}function wg(s,t,e){let i;if(t+"fill-pattern-src"in s?i=Art(s,t+"fill-",e):i=GS(s,t+"fill-color",e),!i)return null;const r=new Ol;return function(n){const o=i(n);return o==="none"?null:(r.setColor(o),r)}}function Eg(s,t,e){const i=Tr(s,t+"stroke-width",e),r=GS(s,t+"stroke-color",e);if(!i&&!r)return null;const n=Wo(s,t+"stroke-line-cap",e),o=Wo(s,t+"stroke-line-join",e),a=gN(s,t+"stroke-line-dash",e),l=Tr(s,t+"stroke-line-dash-offset",e),h=Tr(s,t+"stroke-miter-limit",e),c=new Cl;return function(u){if(r){const d=r(u);if(d==="none")return null;c.setColor(d)}if(i&&c.setWidth(i(u)),n){const d=n(u);if(d!=="butt"&&d!=="round"&&d!=="square")throw new Error("Expected butt, round, or square line cap");c.setLineCap(d)}if(o){const d=o(u);if(d!=="bevel"&&d!=="round"&&d!=="miter")throw new Error("Expected bevel, round, or miter line join");c.setLineJoin(d)}return a&&c.setLineDash(a(u)),l&&c.setLineDashOffset(l(u)),h&&c.setMiterLimit(h(u)),c}}function Crt(s,t){const e="text-",i=Wo(s,e+"value",t);if(!i)return null;const r=wg(s,e,t),n=wg(s,e+"background-",t),o=Eg(s,e,t),a=Eg(s,e+"background-",t),l=Wo(s,e+"font",t),h=Tr(s,e+"max-angle",t),c=Tr(s,e+"offset-x",t),u=Tr(s,e+"offset-y",t),d=Sg(s,e+"overflow",t),p=Wo(s,e+"placement",t),g=Tr(s,e+"repeat",t),f=Ny(s,e+"scale",t),m=Sg(s,e+"rotate-with-view",t),_=Tr(s,e+"rotation",t),y=Wo(s,e+"align",t),v=Wo(s,e+"justify",t),b=Wo(s,e+"baseline",t),E=gN(s,e+"padding",t),S=Dy(s,e+"declutter-mode"),T=new jS({declutterMode:S});return function(R){if(T.setText(i(R)),r&&T.setFill(r(R)),n&&T.setBackgroundFill(n(R)),o&&T.setStroke(o(R)),a&&T.setBackgroundStroke(a(R)),l&&T.setFont(l(R)),h&&T.setMaxAngle(h(R)),c&&T.setOffsetX(c(R)),u&&T.setOffsetY(u(R)),d&&T.setOverflow(d(R)),p){const M=p(R);if(M!=="point"&&M!=="line")throw new Error("Expected point or line for text-placement");T.setPlacement(M)}if(g&&T.setRepeat(g(R)),f&&T.setScale(f(R)),m&&T.setRotateWithView(m(R)),_&&T.setRotation(_(R)),y){const M=y(R);if(M!=="left"&&M!=="center"&&M!=="right"&&M!=="end"&&M!=="start")throw new Error("Expected left, right, center, start, or end for text-align");T.setTextAlign(M)}if(v){const M=v(R);if(M!=="left"&&M!=="right"&&M!=="center")throw new Error("Expected left, right, or center for text-justify");T.setJustify(M)}if(b){const M=b(R);if(M!=="bottom"&&M!=="top"&&M!=="middle"&&M!=="alphabetic"&&M!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");T.setTextBaseline(M)}return E&&T.setPadding(E(R)),T}}function Trt(s,t){return"icon-src"in s?Rrt(s,t):"shape-points"in s?Mrt(s,t):"circle-radius"in s?Irt(s,t):null}function Rrt(s,t){const e="icon-",i=e+"src",r=fN(s[i],i),n=Y0(s,e+"anchor",t),o=Ny(s,e+"scale",t),a=Tr(s,e+"opacity",t),l=Y0(s,e+"displacement",t),h=Tr(s,e+"rotation",t),c=Sg(s,e+"rotate-with-view",t),u=aM(s,e+"anchor-origin"),d=lM(s,e+"anchor-x-units"),p=lM(s,e+"anchor-y-units"),g=Frt(s,e+"color"),f=Prt(s,e+"cross-origin"),m=Ort(s,e+"offset"),_=aM(s,e+"offset-origin"),y=Z0(s,e+"width"),v=Z0(s,e+"height"),b=Lrt(s,e+"size"),E=Dy(s,e+"declutter-mode"),S=new Fy({src:r,anchorOrigin:u,anchorXUnits:d,anchorYUnits:p,color:g,crossOrigin:f,offset:m,offsetOrigin:_,height:v,width:y,size:b,declutterMode:E});return function(T){return a&&S.setOpacity(a(T)),l&&S.setDisplacement(l(T)),h&&S.setRotation(h(T)),c&&S.setRotateWithView(c(T)),o&&S.setScale(o(T)),n&&S.setAnchor(n(T)),S}}function Mrt(s,t){const e="shape-",i=e+"points",r=e+"radius",n=cb(s[i],i),o=cb(s[r],r),a=wg(s,e,t),l=Eg(s,e,t),h=Ny(s,e+"scale",t),c=Y0(s,e+"displacement",t),u=Tr(s,e+"rotation",t),d=Sg(s,e+"rotate-with-view",t),p=Z0(s,e+"radius2"),g=Z0(s,e+"angle"),f=Dy(s,e+"declutter-mode"),m=new lN({points:n,radius:o,radius2:p,angle:g,declutterMode:f});return function(_){return a&&m.setFill(a(_)),l&&m.setStroke(l(_)),c&&m.setDisplacement(c(_)),u&&m.setRotation(u(_)),d&&m.setRotateWithView(d(_)),h&&m.setScale(h(_)),m}}function Irt(s,t){const e="circle-",i=wg(s,e,t),r=Eg(s,e,t),n=Tr(s,e+"radius",t),o=Ny(s,e+"scale",t),a=Y0(s,e+"displacement",t),l=Tr(s,e+"rotation",t),h=Sg(s,e+"rotate-with-view",t),c=Dy(s,e+"declutter-mode"),u=new FS({radius:5,declutterMode:c});return function(d){return n&&u.setRadius(n(d)),i&&u.setFill(i(d)),r&&u.setStroke(r(d)),a&&u.setDisplacement(a(d)),l&&u.setRotation(l(d)),h&&u.setRotateWithView(h(d)),o&&u.setScale(o(d)),u}}function Tr(s,t,e){if(!(t in s))return;const i=Aa(s[t],Rt,e);return function(r){return cb(i(r),t)}}function Wo(s,t,e){if(!(t in s))return null;const i=Aa(s[t],On,e);return function(r){return fN(i(r),t)}}function Art(s,t,e){const i=Wo(s,t+"pattern-src",e),r=oM(s,t+"pattern-offset",e),n=oM(s,t+"pattern-size",e),o=GS(s,t+"color",e);return function(a){return{src:i(a),offset:r&&r(a),size:n&&n(a),color:o&&o(a)}}}function Sg(s,t,e){if(!(t in s))return null;const i=Aa(s[t],qi,e);return function(r){const n=i(r);if(typeof n!="boolean")throw new Error(`Expected a boolean for ${t}`);return n}}function GS(s,t,e){if(!(t in s))return null;const i=Aa(s[t],Hs|On,e);return function(r){return mN(i(r),t)}}function gN(s,t,e){if(!(t in s))return null;const i=Aa(s[t],ma,e);return function(r){return wf(i(r),t)}}function Y0(s,t,e){if(!(t in s))return null;const i=Aa(s[t],ma,e);return function(r){const n=wf(i(r),t);if(n.length!==2)throw new Error(`Expected two numbers for ${t}`);return n}}function oM(s,t,e){if(!(t in s))return null;const i=Aa(s[t],ma,e);return function(r){return _N(i(r),t)}}function Ny(s,t,e){if(!(t in s))return null;const i=Aa(s[t],ma|Rt,e);return function(r){return krt(i(r),t)}}function Z0(s,t){const e=s[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function Lrt(s,t){const e=s[t];if(e!==void 0){if(typeof e=="number")return ar(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function Prt(s,t){const e=s[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function aM(s,t){const e=s[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function lM(s,t){const e=s[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function Ort(s,t){const e=s[t];if(e!==void 0)return wf(e,t)}function Dy(s,t){const e=s[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function Frt(s,t){const e=s[t];if(e!==void 0)return mN(e,t)}function wf(s,t){if(!Array.isArray(s))throw new Error(`Expected an array for ${t}`);const e=s.length;for(let i=0;i<e;++i)if(typeof s[i]!="number")throw new Error(`Expected an array of numbers for ${t}`);return s}function fN(s,t){if(typeof s!="string")throw new Error(`Expected a string for ${t}`);return s}function cb(s,t){if(typeof s!="number")throw new Error(`Expected a number for ${t}`);return s}function mN(s,t){if(typeof s=="string")return s;const e=wf(s,t),i=e.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function _N(s,t){const e=wf(s,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function krt(s,t){return typeof s=="number"?s:_N(s,t)}const hM={RENDER_ORDER:"renderOrder"};class Nrt extends vf{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(hM.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const i=this.getDeclutter();i in t.declutter||(t.declutter[i]=new Wk(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(hM.RENDER_ORDER,t)}setStyle(t){this.style_=Drt(t),this.styleFunction_=t===null?void 0:qst(this.style_),this.changed()}}function Drt(s){if(s===void 0)return Yst;if(!s)return null;if(typeof s=="function"||s instanceof co)return s;if(!Array.isArray(s))return nM([s]);if(s.length===0)return[];const t=s.length,e=s[0];if(e instanceof co){const i=new Array(t);for(let r=0;r<t;++r){const n=s[r];if(!(n instanceof co))throw new Error("Expected a list of style instances");i[r]=n}return i}if("style"in e){const i=new Array(t);for(let r=0;r<t;++r){const n=s[r];if(!("style"in n))throw new Error("Expected a list of rules with a style property");i[r]=n}return Ert(i)}return nM(s)}const zS=Nrt;class $rt extends KE{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){Xt()}calculateMatrices2D(t){const e=t.viewState,i=t.coordinateToPixelTransform,r=t.pixelToCoordinateTransform;Gn(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),Ay(r,i)}forEachFeatureAtCoordinate(t,e,i,r,n,o,a,l){let h;const c=e.viewState;function u(b,E,S,T){return n.call(o,E,b?S:null,T)}const d=c.projection,p=Ty(t.slice(),d),g=[[0,0]];if(d.canWrapX()&&r){const b=d.getExtent(),E=Fe(b);g.push([-E,0],[E,0])}const f=e.layerStatesArray,m=f.length,_=[],y=[];for(let b=0;b<g.length;b++)for(let E=m-1;E>=0;--E){const S=f[E],T=S.layer;if(T.hasRenderer()&&CS(S,c)&&a.call(l,T)){const R=T.getRenderer(),M=T.getSource();if(R&&M){const A=M.getWrapX()?p:t,O=u.bind(null,S.managed);y[0]=A[0]+g[b][0],y[1]=A[1]+g[b][1],h=R.forEachFeatureAtCoordinate(y,e,i,O,_)}if(h)return h}}if(_.length===0)return;const v=1/_.length;return _.forEach((b,E)=>b.distanceSq+=E*v),_.sort((b,E)=>b.distanceSq-E.distanceSq),_.some(b=>h=b.callback(b.feature,b.layer,b.geometry)),h}hasFeatureAtCoordinate(t,e,i,r,n,o){return this.forEachFeatureAtCoordinate(t,e,i,r,ju,this,n,o)!==void 0}getMap(){return this.map_}renderFrame(t){Xt()}scheduleExpireIconCache(t){no.canExpireCache()&&t.postRenderFunctions.push(jrt)}}function jrt(s,t){no.expire()}const Grt=$rt;class zrt extends mn{constructor(t,e,i,r){super(t),this.inversePixelTransform=e,this.frameState=i,this.context=r}}const yN=zrt;class Brt extends Grt{constructor(t){super(t),this.fontChangeListenerKey_=ae(zo,Fh.PROPERTYCHANGE,t.redrawText.bind(t)),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=vo+" ol-layers";const i=t.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const i=this.getMap();if(i.hasListener(t)){const r=new yN(t,void 0,e);i.dispatchEvent(r)}}disposeInternal(){ii(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(on.PRECOMPOSE,t);const e=t.layerStatesArray.sort(function(o,a){return o.zIndex-a.zIndex});e.some(o=>o.layer instanceof zS&&o.layer.getDeclutter())&&(t.declutter={});const i=t.viewState;this.children_.length=0;const r=[];let n=null;for(let o=0,a=e.length;o<a;++o){const l=e[o];t.layerIndex=o;const h=l.layer,c=h.getSourceState();if(!CS(l,i)||c!="ready"&&c!="undefined"){h.unrender();continue}const u=h.render(t,n);u&&(u!==n&&(this.children_.push(u),n=u),r.push(l))}this.declutter(t,r),kst(this.element_,this.children_),this.dispatchRenderEvent(on.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,e){for(let i=e.length-1;i>=0;--i){const r=e[i],n=r.layer;n.getDeclutter()&&n.renderDeclutter(t,r)}e.forEach(i=>i.layer.renderDeferred(t))}}const Urt=Brt;class Ja extends mn{constructor(t,e){super(t),this.layer=e}}const _x={LAYERS:"layers"};class BS extends vk{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let i=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(_x.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new or(i.slice(),{unique:!0}):Te(typeof i.getArray=="function","Expected `layers` to be an array or a `Collection`"):i=new or(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(ii),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(ae(t,Vs.ADD,this.handleLayersAdd_,this),ae(t,Vs.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(ii);df(this.listenerKeys_);const e=t.getArray();for(let i=0,r=e.length;i<r;i++){const n=e[i];this.registerLayerListeners_(n),this.dispatchEvent(new Ja("addlayer",n))}this.changed()}registerLayerListeners_(t){const e=[ae(t,Fh.PROPERTYCHANGE,this.handleLayerChange_,this),ae(t,Mt.CHANGE,this.handleLayerChange_,this)];t instanceof BS&&e.push(ae(t,"addlayer",this.handleLayerGroupAdd_,this),ae(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[Nt(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new Ja("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new Ja("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new Ja("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,i=Nt(e);this.listenerKeys_[i].forEach(ii),delete this.listenerKeys_[i],this.dispatchEvent(new Ja("removelayer",e)),this.changed()}getLayers(){return this.get(_x.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const i=e.getArray();for(let r=0,n=i.length;r<n;++r)this.dispatchEvent(new Ja("removelayer",i[r]))}this.set(_x.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],i=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});const r=this.getLayerState();let n=r.zIndex;!t&&r.zIndex===void 0&&(n=0);for(let o=i,a=e.length;o<a;o++){const l=e[o];l.opacity*=r.opacity,l.visible=l.visible&&r.visible,l.maxResolution=Math.min(l.maxResolution,r.maxResolution),l.minResolution=Math.max(l.minResolution,r.minResolution),l.minZoom=Math.max(l.minZoom,r.minZoom),l.maxZoom=Math.min(l.maxZoom,r.maxZoom),r.extent!==void 0&&(l.extent!==void 0?l.extent=sa(l.extent,r.extent):l.extent=r.extent),l.zIndex===void 0&&(l.zIndex=n)}return e}getSourceState(){return"ready"}}const Nh=BS;class Vrt extends mn{constructor(t,e,i){super(t),this.map=e,this.frameState=i!==void 0?i:null}}const Ac=Vrt;class Hrt extends Ac{constructor(t,e,i,r,n,o){super(t,e,n),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=r!==void 0?r:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Bo=Hrt,we={SINGLECLICK:"singleclick",CLICK:Mt.CLICK,DBLCLICK:Mt.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},eo={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class Wrt extends pf{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=ae(i,eo.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=ae(i,eo.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(Mt.TOUCHMOVE,this.boundHandleTouchMove_,tN?{passive:!1}:!1)}emulateClick_(t){let e=new Bo(we.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new Bo(we.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new Bo(we.SINGLECLICK,this.map_,t);this.dispatchEvent(i)},250)}updateActivePointers_(t){const e=t,i=e.pointerId;if(e.type==we.POINTERUP||e.type==we.POINTERCANCEL){delete this.trackedTouches_[i];for(const r in this.trackedTouches_)if(this.trackedTouches_[r].target!==e.target){delete this.trackedTouches_[r];break}}else(e.type==we.POINTERDOWN||e.type==we.POINTERMOVE)&&(this.trackedTouches_[i]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new Bo(we.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(ii),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new Bo(we.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(ae(i,we.POINTERMOVE,this.handlePointerMove_,this),ae(i,we.POINTERUP,this.handlePointerUp_,this),ae(this.element_,we.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(ae(this.element_.getRootNode(),we.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new Bo(we.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new Bo(we.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(ii(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(Mt.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(ii(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(ii),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const Xrt=Wrt,Jn={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},Yi={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},ub=1/0;class qrt{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,df(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,i=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const r=this.keyFunction_(i);return delete this.queuedElements_[r],i}enqueue(t){Te(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=ub?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,i=this.priorities_,r=e.length,n=e[t],o=i[t],a=t;for(;t<r>>1;){const l=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),c=h<r&&i[h]<i[l]?h:l;e[t]=e[c],i[t]=i[c],t=c}e[t]=n,i[t]=o,this.siftDown_(a,t)}siftDown_(t,e){const i=this.elements_,r=this.priorities_,n=i[e],o=r[e];for(;e>t;){const a=this.getParentIndex_(e);if(r[a]>o)i[e]=i[a],r[e]=r[a],e=a;else break}i[e]=n,r[e]=o}reprioritize(){const t=this.priorityFunction_,e=this.elements_,i=this.priorities_;let r=0;const n=e.length;let o,a,l;for(a=0;a<n;++a)o=e[a],l=t(o),l==ub?delete this.queuedElements_[this.keyFunction_(o)]:(i[r]=l,e[r++]=o);e.length=r,i.length=r,this.heapify_()}}const Yrt=qrt,ot={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class Zrt extends Yrt{constructor(t,e){super(function(i){return t.apply(null,i)},function(i){return i[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(Mt.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,i=e.getState();if(i===ot.LOADED||i===ot.ERROR||i===ot.EMPTY){i!==ot.ERROR&&e.removeEventListener(Mt.CHANGE,this.boundHandleTileChange_);const r=e.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let i=0,r,n,o;for(;this.tilesLoading_<t&&i<e&&this.getCount()>0;)n=this.dequeue()[0],o=n.getKey(),r=n.getState(),r===ot.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++i,n.load())}}const Krt=Zrt;function Jrt(s,t,e,i,r){if(!s||!(e in s.wantedTiles)||!s.wantedTiles[e][t.getKey()])return ub;const n=s.viewState.center,o=i[0]-n[0],a=i[1]-n[1];return 65536*Math.log(r)+Math.sqrt(o*o+a*a)/r}class Qrt extends Vn{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){H0(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&H0(this.element);for(let e=0,i=this.listenerKeys.length;e<i;++e)ii(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==Gu&&this.listenerKeys.push(ae(t,Jn.POSTRENDER,this.render,this)),t.render())}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}const To=Qrt;class tnt extends To{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const e=t.className!==void 0?t.className:"ol-attribution",i=t.tipLabel!==void 0?t.tipLabel:"Attributions",r=t.expandClassName!==void 0?t.expandClassName:e+"-expand",n=t.collapseLabel!==void 0?t.collapseLabel:"›",o=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof n=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=n,this.collapseLabel_.className=o):this.collapseLabel_=n;const a=t.label!==void 0?t.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=r):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(Mt.CLICK,this.handleClick_.bind(this),!1);const h=e+" "+vo+" "+qh+(this.collapsed_&&this.collapsible_?" "+W0:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e=Array.from(new Set(this.getMap().getAllLayers().flatMap(r=>r.getAttributions(t)))),i=!this.getMap().getAllLayers().some(r=>r.getSource()&&r.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(i),e}updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=this.collectSourceAttributions_(t),i=e.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!Ia(e,this.renderedAttributions_)){eN(this.ulElement_);for(let r=0,n=e.length;r<n;++r){const o=document.createElement("li");o.innerHTML=e[r],this.ulElement_.appendChild(o)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(W0),this.collapsed_?Wu(this.collapseLabel_,this.label_):Wu(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}const xN=tnt;class ent extends To{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",i=t.label!==void 0?t.label:"⇧",r=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=r,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(r));const n=t.tipLabel?t.tipLabel:"Reset rotation",o=document.createElement("button");o.className=e+"-reset",o.setAttribute("type","button"),o.title=n,o.appendChild(this.label_),o.addEventListener(Mt.CLICK,this.handleClick_.bind(this),!1);const a=e+" "+vo+" "+qh,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(gm)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const e=t.getRotation();e!==void 0&&(this.duration_>0&&e%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:Wh}):t.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const i=e.viewState.rotation;if(i!=this.rotation_){const r="rotate("+i+"rad)";if(this.autoHide_){const n=this.element.classList.contains(gm);!n&&i===0?this.element.classList.add(gm):n&&i!==0&&this.element.classList.remove(gm)}this.label_.style.transform=r}this.rotation_=i}}const vN=ent;class int extends To{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",i=t.delta!==void 0?t.delta:1,r=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",n=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",o=t.zoomInLabel!==void 0?t.zoomInLabel:"+",a=t.zoomOutLabel!==void 0?t.zoomOutLabel:"–",l=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",h=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=r,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(Mt.CLICK,this.handleClick_.bind(this,i),!1);const u=document.createElement("button");u.className=n,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(Mt.CLICK,this.handleClick_.bind(this,-i),!1);const d=e+" "+vo+" "+qh,p=this.element;p.className=d,p.appendChild(c),p.appendChild(u),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const e=this.getMap().getView();if(!e)return;const i=e.getZoom();if(i!==void 0){const r=e.getConstrainedZoom(i+t);this.duration_>0?(e.getAnimating()&&e.cancelAnimations(),e.animate({zoom:r,duration:this.duration_,easing:Wh})):e.setZoom(r)}}}const bN=int;function wN(s){s=s||{};const t=new or;return(s.zoom===void 0||s.zoom)&&t.push(new bN(s.zoomOptions)),(s.rotate===void 0||s.rotate)&&t.push(new vN(s.rotateOptions)),(s.attribution===void 0||s.attribution)&&t.push(new xN(s.attributionOptions)),t}const db={ACTIVE:"active"};class snt extends Vn{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(db.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(db.ACTIVE,t)}setMap(t){this.map_=t}}function rnt(s,t,e){const i=s.getCenterInternal();if(i){const r=[i[0]+t[0],i[1]+t[1]];s.animateInternal({duration:e!==void 0?e:250,easing:zit,center:s.getConstrainedCenter(r)})}}function US(s,t,e,i){const r=s.getZoom();if(r===void 0)return;const n=s.getConstrainedZoom(r+t),o=s.getResolutionForZoom(n);s.getAnimating()&&s.cancelAnimations(),s.animate({resolution:o,anchor:e,duration:i!==void 0?i:250,easing:Wh})}const Ef=snt;class nnt extends Ef{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==we.DBLCLICK){const i=t.originalEvent,r=t.map,n=t.coordinate,o=i.shiftKey?-this.delta_:this.delta_,a=r.getView();US(a,o,n,this.duration_),i.preventDefault(),e=!0}return!e}}const ont=nnt;class ant extends Ef{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==we.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==we.POINTERUP){const i=this.handleUpEvent(t);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(t.type==we.POINTERDOWN){const i=this.handleDownEvent(t);this.handlingDownUpSequence=i,e=this.stopDown(i)}else t.type==we.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function VS(s){const t=s.length;let e=0,i=0;for(let r=0;r<t;r++)e+=s[r].clientX,i+=s[r].clientY;return{clientX:e/t,clientY:i/t}}const Yh=ant;function pb(s){const t=arguments;return function(e){let i=!0;for(let r=0,n=t.length;r<n&&(i=i&&t[r](e),!!i);++r);return i}}const lnt=function(s){const t=s.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},hnt=function(s){const t=s.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},cnt=function(s){const t=s.map.getTargetElement(),e=s.map.getOwnerDocument().activeElement;return t.contains(e)},EN=function(s){return s.map.getTargetElement().hasAttribute("tabindex")?cnt(s):!0},K0=ju,SN=function(s){const t=s.originalEvent;return t.button==0&&!(Lst&&IS&&t.ctrlKey)},unt=md,dnt=function(s){return s.type==we.SINGLECLICK},HS=function(s){const t=s.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},cM=function(s){const t=s.originalEvent;return!t.altKey&&(IS?t.metaKey:t.ctrlKey)&&!t.shiftKey},pnt=function(s){const t=s.originalEvent;return IS?t.metaKey:t.ctrlKey},CN=function(s){const t=s.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},TN=function(s){const t=s.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},yx=function(s){const t=s.originalEvent;return Te(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.pointerType=="mouse"},RN=function(s){const t=s.originalEvent;return Te(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.isPrimary&&t.button===0};class gnt extends Yh{constructor(t){super({stopDown:md}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:pb(HS,RN);this.condition_=t.onFocusOnly?pb(EN,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const i=this.targetPointers,r=e.getEventPixel(VS(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){const n=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],o=t.map.getView();Cit(n,o.getResolution()),rS(n,o.getRotation()),o.adjustCenterInternal(n)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=i.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,i=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const r=this.kinetic_.getDistance(),n=this.kinetic_.getAngle(),o=i.getCenterInternal(),a=e.getPixelFromCoordinateInternal(o),l=e.getCoordinateFromPixelInternal([a[0]-r*Math.cos(n),a[1]-r*Math.sin(n)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:Wh})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const e=t.map.getView();return this.lastCentroid=null,e.getAnimating()&&e.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}const Ep=gnt;class fnt extends Yh{constructor(t){t=t||{},super({stopDown:md}),this.condition_=t.condition?t.condition:hnt,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!yx(t))return;const e=t.map,i=e.getView();if(i.getConstraints().rotation===uS)return;const r=e.getSize(),n=t.pixel,o=Math.atan2(r[1]/2-n[1],n[0]-r[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;i.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(t){return yx(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return yx(t)&&SN(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}const mnt=fnt;class _nt extends KE{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,i="px",r=this.element_.style;r.left=Math.min(t[0],e[0])+i,r.top=Math.min(t[1],e[1])+i,r.width=Math.abs(e[0]-t[0])+i,r.height=Math.abs(e[1]-t[1])+i}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const t=this.startPixel_,e=this.endPixel_,i=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);i[4]=i[0].slice(),this.geometry_?this.geometry_.setCoordinates([i]):this.geometry_=new Zs([i])}getGeometry(){return this.geometry_}}const ynt=_nt,fm={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};let xx=class extends mn{constructor(t,e,i){super(t),this.coordinate=e,this.mapBrowserEvent=i}};class xnt extends Yh{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.box_=new ynt(t.className||"ol-dragbox"),this.minArea_=t.minArea!==void 0?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:SN,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,i){const r=i[0]-e[0],n=i[1]-e[1];return r*r+n*n>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new xx(fm.BOXDRAG,t.coordinate,t))}handleUpEvent(t){this.box_.setMap(null);const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new xx(e?fm.BOXEND:fm.BOXCANCEL,t.coordinate,t)),!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new xx(fm.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}}const vnt=xnt;class bnt extends vnt{constructor(t){t=t||{};const e=t.condition?t.condition:CN;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const e=this.getMap().getView();let i=this.getGeometry();if(this.out_){const r=e.rotatedExtentForGeometry(i),n=e.getResolutionForExtentInternal(r),o=e.getResolution()/n;i=i.clone(),i.scale(o*o)}e.fitInternal(i,{duration:this.duration_,easing:Wh})}}const wnt=bnt,Jl={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class Ent extends Ef{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return HS(e)&&TN(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==Mt.KEYDOWN){const i=t.originalEvent,r=i.key;if(this.condition_(t)&&(r==Jl.DOWN||r==Jl.LEFT||r==Jl.RIGHT||r==Jl.UP)){const n=t.map.getView(),o=n.getResolution()*this.pixelDelta_;let a=0,l=0;r==Jl.DOWN?l=-o:r==Jl.LEFT?a=-o:r==Jl.RIGHT?a=o:l=o;const h=[a,l];rS(h,n.getRotation()),rnt(n,h,this.duration_),i.preventDefault(),e=!0}}return!e}}const Snt=Ent;class Cnt extends Ef{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(e){return!pnt(e)&&TN(e)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==Mt.KEYDOWN||t.type==Mt.KEYPRESS){const i=t.originalEvent,r=i.key;if(this.condition_(t)&&(r==="+"||r==="-")){const n=t.map,o=r==="+"?this.delta_:-this.delta_,a=n.getView();US(a,o,void 0,this.duration_),i.preventDefault(),e=!0}}return!e}}const Tnt=Cnt;class Rnt{constructor(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let i=e-3;for(;i>0&&this.points_[i+2]>t;)i-=3;const r=this.points_[e+2]-this.points_[i+2];if(r<1e3/60)return!1;const n=this.points_[e]-this.points_[i],o=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(o,n),this.initialVelocity_=Math.sqrt(n*n+o*o)/r,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const Mnt=Rnt;class Int extends Ef{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const e=t.condition?t.condition:K0;this.condition_=t.onFocusOnly?pb(EN,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();t&&t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t)||t.type!==Mt.WHEEL)return!0;const e=t.map,i=t.originalEvent;i.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate);let r;if(t.type==Mt.WHEEL&&(r=i.deltaY,Ist&&i.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(r/=Jk),i.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)),r===0)return!1;this.lastDelta_=r;const n=Date.now();this.startTime_===void 0&&(this.startTime_=n),(!this.mode_||n-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const o=e.getView();if(this.mode_==="trackpad"&&!(o.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(o.getAnimating()&&o.cancelAnimations(),o.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),o.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=n,!1;this.totalDelta_+=r;const a=Math.max(this.timeout_-(n-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,e),a),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let i=-Oi(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),US(e,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}const J0=Int;class Ant extends Yh{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=md),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const i=this.targetPointers[0],r=this.targetPointers[1],n=Math.atan2(r.clientY-i.clientY,r.clientX-i.clientX);if(this.lastAngle_!==void 0){const l=n-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=l}this.lastAngle_=n;const o=t.map,a=o.getView();a.getConstraints().rotation!==uS&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(VS(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}const Lnt=Ant;class Pnt extends Yh{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=md),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const i=this.targetPointers[0],r=this.targetPointers[1],n=i.clientX-r.clientX,o=i.clientY-r.clientY,a=Math.sqrt(n*n+o*o);this.lastDistance_!==void 0&&(e=this.lastDistance_/a),this.lastDistance_=a;const l=t.map,h=l.getView();e!=1&&(this.lastScaleDelta_=e),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(VS(this.targetPointers))),l.render(),h.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const e=t.map.getView(),i=this.lastScaleDelta_>1?1:-1;return e.endInteraction(this.duration_,i),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}const Ont=Pnt;function Fnt(s){s=s||{};const t=new or,e=new Mnt(-.005,.05,100);return(s.altShiftDragRotate===void 0||s.altShiftDragRotate)&&t.push(new mnt),(s.doubleClickZoom===void 0||s.doubleClickZoom)&&t.push(new ont({delta:s.zoomDelta,duration:s.zoomDuration})),(s.dragPan===void 0||s.dragPan)&&t.push(new Ep({onFocusOnly:s.onFocusOnly,kinetic:e})),(s.pinchRotate===void 0||s.pinchRotate)&&t.push(new Lnt),(s.pinchZoom===void 0||s.pinchZoom)&&t.push(new Ont({duration:s.zoomDuration})),(s.keyboard===void 0||s.keyboard)&&(t.push(new Snt),t.push(new Tnt({delta:s.zoomDelta,duration:s.zoomDuration}))),(s.mouseWheelZoom===void 0||s.mouseWheelZoom)&&t.push(new J0({onFocusOnly:s.onFocusOnly,duration:s.zoomDuration})),(s.shiftDragZoom===void 0||s.shiftDragZoom)&&t.push(new wnt({duration:s.zoomDuration})),t}function MN(s){if(s instanceof vf){s.setMapInternal(null);return}s instanceof Nh&&s.getLayers().forEach(MN)}function IN(s,t){if(s instanceof vf){s.setMapInternal(t);return}if(s instanceof Nh){const e=s.getLayers().getArray();for(let i=0,r=e.length;i<r;++i)IN(e[i],t)}}let knt=class extends Vn{constructor(s){super(),s=s||{},this.on,this.once,this.un;const t=Nnt(s);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=s.maxTilesLoading!==void 0?s.maxTilesLoading:16,this.pixelRatio_=s.pixelRatio!==void 0?s.pixelRatio:Jk,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=cn(),this.pixelToCoordinateTransform_=cn(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=s.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||wN(),this.interactions=t.interactions||Fnt({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new Krt(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Yi.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Yi.VIEW,this.handleViewChanged_),this.addChangeListener(Yi.SIZE,this.handleSizeChanged_),this.addChangeListener(Yi.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const e=this;s.view&&!(s.view instanceof Mn)&&s.view.then(function(i){e.setView(new Mn(i))}),this.controls.addEventListener(Vs.ADD,i=>{i.element.setMap(this)}),this.controls.addEventListener(Vs.REMOVE,i=>{i.element.setMap(null)}),this.interactions.addEventListener(Vs.ADD,i=>{i.element.setMap(this)}),this.interactions.addEventListener(Vs.REMOVE,i=>{i.element.setMap(null)}),this.overlays_.addEventListener(Vs.ADD,i=>{this.addOverlayInternal_(i.element)}),this.overlays_.addEventListener(Vs.REMOVE,i=>{const r=i.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],i.element.setMap(null)}),this.controls.forEach(i=>{i.setMap(this)}),this.interactions.forEach(i=>{i.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(s){this.getControls().push(s)}addInteraction(s){this.getInteractions().push(s)}addLayer(s){this.getLayerGroup().getLayers().push(s)}handleLayerAdd_(s){IN(s.layer,this)}addOverlay(s){this.getOverlays().push(s)}addOverlayInternal_(s){const t=s.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=s),s.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(s,t,e){if(!this.frameState_||!this.renderer_)return;const i=this.getCoordinateFromPixelInternal(s);e=e!==void 0?e:{};const r=e.hitTolerance!==void 0?e.hitTolerance:0,n=e.layerFilter!==void 0?e.layerFilter:ju,o=e.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(i,this.frameState_,r,o,t,null,n,null)}getFeaturesAtPixel(s,t){const e=[];return this.forEachFeatureAtPixel(s,function(i){e.push(i)},t),e}getAllLayers(){const s=[];function t(e){e.forEach(function(i){i instanceof Nh?t(i.getLayers()):s.push(i)})}return t(this.getLayers()),s}hasFeatureAtPixel(s,t){if(!this.frameState_||!this.renderer_)return!1;const e=this.getCoordinateFromPixelInternal(s);t=t!==void 0?t:{};const i=t.layerFilter!==void 0?t.layerFilter:ju,r=t.hitTolerance!==void 0?t.hitTolerance:0,n=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(e,this.frameState_,r,n,i,null)}getEventCoordinate(s){return this.getCoordinateFromPixel(this.getEventPixel(s))}getEventCoordinateInternal(s){return this.getCoordinateFromPixelInternal(this.getEventPixel(s))}getEventPixel(s){const t=this.viewport_.getBoundingClientRect(),e=this.getSize(),i=t.width/e[0],r=t.height/e[1],n="changedTouches"in s?s.changedTouches[0]:s;return[(n.clientX-t.left)/i,(n.clientY-t.top)/r]}getTarget(){return this.get(Yi.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(s){return Vu(this.getCoordinateFromPixelInternal(s),this.getView().getProjection())}getCoordinateFromPixelInternal(s){const t=this.frameState_;return t?ss(t.pixelToCoordinateTransform,s.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(s){const t=this.overlayIdIndex_[s.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Yi.LAYERGROUP)}setLayers(s){const t=this.getLayerGroup();if(s instanceof or){t.setLayers(s);return}const e=t.getLayers();e.clear(),e.extend(s)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const s=this.getLayerGroup().getLayerStatesArray();for(let t=0,e=s.length;t<e;++t){const i=s[t];if(!i.visible)continue;const r=i.layer.getRenderer();if(r&&!r.ready)return!0;const n=i.layer.getSource();if(n&&n.loading)return!0}return!1}getPixelFromCoordinate(s){const t=ji(s,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(s){const t=this.frameState_;return t?ss(t.coordinateToPixelTransform,s.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Yi.SIZE)}getView(){return this.get(Yi.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const s=this.getTargetElement();return s?s.ownerDocument:document}getTilePriority(s,t,e,i){return Jrt(this.frameState_,s,t,e,i)}handleBrowserEvent(s,t){t=t||s.type;const e=new Bo(t,this,s);this.handleMapBrowserEvent(e)}handleMapBrowserEvent(s){if(!this.frameState_)return;const t=s.originalEvent,e=t.type;if(e===eo.POINTERDOWN||e===Mt.WHEEL||e===Mt.KEYDOWN){const i=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():i,n=t.target;if(this.overlayContainerStopEvent_.contains(n)||!(r===i?i.documentElement:r).contains(n))return}if(s.frameState=this.frameState_,this.dispatchEvent(s)!==!1){const i=this.getInteractions().getArray().slice();for(let r=i.length-1;r>=0;r--){const n=i[r];if(!(n.getMap()!==this||!n.getActive()||!this.getTargetElement())&&(!n.handleEvent(s)||s.propagationStopped))break}}}handlePostRender(){const s=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let i=this.maxTilesLoading_,r=i;if(s){const n=s.viewHints;if(n[Si.ANIMATING]||n[Si.INTERACTING]){const o=Date.now()-s.time>8;i=o?0:8,r=o?0:2}}t.getTilesLoading()<i&&(t.reprioritize(),t.loadMoreTiles(i,r))}s&&this.renderer_&&!s.animate&&(this.renderComplete_===!0?(this.hasListener(on.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(on.RENDERCOMPLETE,s),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Ac(Jn.LOADEND,this,s)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Ac(Jn.LOADSTART,this,s))));const e=this.postRenderFunctions_;for(let i=0,r=e.length;i<r;++i)e[i](this,s);e.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let e=0,i=this.targetChangeHandlerKeys_.length;e<i;++e)ii(this.targetChangeHandlerKeys_[e]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(Mt.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(Mt.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,H0(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const e=this.targetElement_.getRootNode();e instanceof ShadowRoot&&this.resizeObserver_.unobserve(e.host),this.setSize(void 0)}const s=this.getTarget(),t=typeof s=="string"?document.getElementById(s):s;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Urt(this)),this.mapBrowserEventHandler_=new Xrt(this,this.moveTolerance_);for(const r in we)this.mapBrowserEventHandler_.addEventListener(we[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(Mt.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(Mt.WHEEL,this.boundHandleBrowserEvent_,tN?{passive:!1}:!1);const e=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[ae(e,Mt.KEYDOWN,this.handleBrowserEvent,this),ae(e,Mt.KEYPRESS,this.handleBrowserEvent,this)];const i=t.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.observe(i.host),this.resizeObserver_.observe(t)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(ii(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(ii(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const s=this.getView();s&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=ae(s,Fh.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=ae(s,Mt.CHANGE,this.handleViewPropertyChanged_,this),s.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(ii),this.layerGroupPropertyListenerKeys_=null);const s=this.getLayerGroup();s&&(this.handleLayerAdd_(new Ja("addlayer",s)),this.layerGroupPropertyListenerKeys_=[ae(s,Fh.PROPERTYCHANGE,this.render,this),ae(s,Mt.CHANGE,this.render,this),ae(s,"addlayer",this.handleLayerAdd_,this),ae(s,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const s=this.getLayerGroup().getLayerStatesArray();for(let t=0,e=s.length;t<e;++t){const i=s[t].layer;i.hasRenderer()&&i.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(s){return this.getControls().remove(s)}removeInteraction(s){return this.getInteractions().remove(s)}removeLayer(s){return this.getLayerGroup().getLayers().remove(s)}handleLayerRemove_(s){MN(s.layer)}removeOverlay(s){return this.getOverlays().remove(s)}renderFrame_(s){const t=this.getSize(),e=this.getView(),i=this.frameState_;let r=null;if(t!==void 0&&YR(t)&&e&&e.isDef()){const n=e.getHints(this.frameState_?this.frameState_.viewHints:void 0),o=e.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:gg(o.center,o.resolution,o.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:s,usedTiles:{},viewState:o,viewHints:n,wantedTiles:{},mapId:Nt(this),renderTargets:{}},o.nextCenter&&o.nextResolution){const a=isNaN(o.nextRotation)?o.rotation:o.nextRotation;r.nextExtent=gg(o.nextCenter,o.nextResolution,a,t)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),i&&(!this.previousExtent_||!yd(this.previousExtent_)&&!Ll(r.extent,this.previousExtent_))&&(this.dispatchEvent(new Ac(Jn.MOVESTART,this,i)),this.previousExtent_=mf(this.previousExtent_)),this.previousExtent_&&!r.viewHints[Si.ANIMATING]&&!r.viewHints[Si.INTERACTING]&&!Ll(r.extent,this.previousExtent_)&&(this.dispatchEvent(new Ac(Jn.MOVEEND,this,r)),wk(r.extent,this.previousExtent_))),this.dispatchEvent(new Ac(Jn.POSTRENDER,this,r)),this.renderComplete_=this.hasListener(Jn.LOADSTART)||this.hasListener(Jn.LOADEND)||this.hasListener(on.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(s){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new Ja("removelayer",t)),this.set(Yi.LAYERGROUP,s)}setSize(s){this.set(Yi.SIZE,s)}setTarget(s){this.set(Yi.TARGET,s)}setView(s){if(!s||s instanceof Mn){this.set(Yi.VIEW,s);return}this.set(Yi.VIEW,new Mn);const t=this;s.then(function(e){t.setView(new Mn(e))})}updateSize(){const s=this.getTargetElement();let t;if(s){const i=getComputedStyle(s),r=s.offsetWidth-parseFloat(i.borderLeftWidth)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderRightWidth),n=s.offsetHeight-parseFloat(i.borderTopWidth)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderBottomWidth);!isNaN(r)&&!isNaN(n)&&(t=[r,n],!YR(t)&&(s.offsetWidth||s.offsetHeight||s.getClientRects().length)&&Ik("No map visible because the map container's width or height are 0."))}const e=this.getSize();t&&(!e||!Ia(t,e))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(s){const t=this.getView();t&&t.setViewportSize(s)}};function Nnt(s){let t=null;s.keyboardEventTarget!==void 0&&(t=typeof s.keyboardEventTarget=="string"?document.getElementById(s.keyboardEventTarget):s.keyboardEventTarget);const e={},i=s.layers&&typeof s.layers.getLayers=="function"?s.layers:new Nh({layers:s.layers});e[Yi.LAYERGROUP]=i,e[Yi.TARGET]=s.target,e[Yi.VIEW]=s.view instanceof Mn?s.view:new Mn;let r;s.controls!==void 0&&(Array.isArray(s.controls)?r=new or(s.controls.slice()):(Te(typeof s.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),r=s.controls));let n;s.interactions!==void 0&&(Array.isArray(s.interactions)?n=new or(s.interactions.slice()):(Te(typeof s.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),n=s.interactions));let o;return s.overlays!==void 0?Array.isArray(s.overlays)?o=new or(s.overlays.slice()):(Te(typeof s.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=s.overlays):o=new or,{controls:r,interactions:n,keyboardEventTarget:t,overlays:o,values:e}}const AN=knt,Dnt=':root,:host{--ol-background-color: white;--ol-accent-background-color: #F5F5F5;--ol-subtle-background-color: rgba(128, 128, 128, .25);--ol-partial-background-color: rgba(255, 255, 255, .75);--ol-foreground-color: #333333;--ol-subtle-foreground-color: #666666;--ol-brand-color: #00AAFF}.ol-box{box-sizing:border-box;border-radius:2px;border:1.5px solid var(--ol-background-color);background-color:var(--ol-partial-background-color)}.ol-mouse-position{top:8px;right:8px;position:absolute}.ol-scale-line{background:var(--ol-partial-background-color);border-radius:4px;bottom:8px;left:8px;padding:2px;position:absolute}.ol-scale-line-inner{border:1px solid var(--ol-subtle-foreground-color);border-top:none;color:var(--ol-foreground-color);font-size:10px;text-align:center;margin:1px;will-change:contents,width;transition:all .25s}.ol-scale-bar{position:absolute;bottom:8px;left:8px}.ol-scale-bar-inner{display:flex}.ol-scale-step-marker{width:1px;height:15px;background-color:var(--ol-foreground-color);float:right;z-index:10}.ol-scale-step-text{position:absolute;bottom:-5px;font-size:10px;z-index:11;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-text{position:absolute;font-size:12px;text-align:center;bottom:25px;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-singlebar{position:relative;height:10px;z-index:9;box-sizing:border-box;border:1px solid var(--ol-foreground-color)}.ol-scale-singlebar-even{background-color:var(--ol-subtle-foreground-color)}.ol-scale-singlebar-odd{background-color:var(--ol-background-color)}.ol-unsupported{display:none}.ol-viewport,.ol-unselectable{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent}.ol-viewport canvas{all:unset;overflow:hidden}.ol-viewport{touch-action:pan-x pan-y}.ol-selectable{-webkit-touch-callout:default;-webkit-user-select:text;-moz-user-select:text;user-select:text}.ol-grabbing{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.ol-grab{cursor:move;cursor:-webkit-grab;cursor:-moz-grab;cursor:grab}.ol-control{position:absolute;background-color:var(--ol-subtle-background-color);border-radius:4px}.ol-zoom{top:.5em;left:.5em}.ol-rotate{top:.5em;right:.5em;transition:opacity .25s linear,visibility 0s linear}.ol-rotate.ol-hidden{opacity:0;visibility:hidden;transition:opacity .25s linear,visibility 0s linear .25s}.ol-zoom-extent{top:4.643em;left:.5em}.ol-full-screen{right:.5em;top:.5em}.ol-control button{display:block;margin:1px;padding:0;color:var(--ol-subtle-foreground-color);font-weight:700;text-decoration:none;font-size:inherit;text-align:center;height:1.375em;width:1.375em;line-height:.4em;background-color:var(--ol-background-color);border:none;border-radius:2px}.ol-control button::-moz-focus-inner{border:none;padding:0}.ol-zoom-extent button{line-height:1.4em}.ol-compass{display:block;font-weight:400;will-change:transform}.ol-touch .ol-control button{font-size:1.5em}.ol-touch .ol-zoom-extent{top:5.5em}.ol-control button:hover,.ol-control button:focus{text-decoration:none;outline:1px solid var(--ol-subtle-foreground-color);color:var(--ol-foreground-color)}.ol-zoom .ol-zoom-in{border-radius:2px 2px 0 0}.ol-zoom .ol-zoom-out{border-radius:0 0 2px 2px}.ol-attribution{text-align:right;bottom:.5em;right:.5em;max-width:calc(100% - 1.3em);display:flex;flex-flow:row-reverse;align-items:center}.ol-attribution a{color:var(--ol-subtle-foreground-color);text-decoration:none}.ol-attribution ul{margin:0;padding:1px .5em;color:var(--ol-foreground-color);text-shadow:0 0 2px var(--ol-background-color);font-size:12px}.ol-attribution li{display:inline;list-style:none}.ol-attribution li:not(:last-child):after{content:" "}.ol-attribution img{max-height:2em;max-width:inherit;vertical-align:middle}.ol-attribution button{flex-shrink:0}.ol-attribution.ol-collapsed ul{display:none}.ol-attribution:not(.ol-collapsed){background:var(--ol-partial-background-color)}.ol-attribution.ol-uncollapsible{bottom:0;right:0;border-radius:4px 0 0}.ol-attribution.ol-uncollapsible img{margin-top:-.2em;max-height:1.6em}.ol-attribution.ol-uncollapsible button{display:none}.ol-zoomslider{top:4.5em;left:.5em;height:200px}.ol-zoomslider button{position:relative;height:10px}.ol-touch .ol-zoomslider{top:5.5em}.ol-overviewmap{left:.5em;bottom:.5em}.ol-overviewmap.ol-uncollapsible{bottom:0;left:0;border-radius:0 4px 0 0}.ol-overviewmap .ol-overviewmap-map,.ol-overviewmap button{display:block}.ol-overviewmap .ol-overviewmap-map{border:1px solid var(--ol-subtle-foreground-color);height:150px;width:150px}.ol-overviewmap:not(.ol-collapsed) button{bottom:0;left:0;position:absolute}.ol-overviewmap.ol-collapsed .ol-overviewmap-map,.ol-overviewmap.ol-uncollapsible button{display:none}.ol-overviewmap:not(.ol-collapsed){background:var(--ol-subtle-background-color)}.ol-overviewmap-box{border:1.5px dotted var(--ol-subtle-foreground-color)}.ol-overviewmap .ol-overviewmap-box:hover{cursor:move}';class WS extends Vn{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new WS(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(ii(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=ae(t,Mt.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?$nt(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function $nt(s){if(typeof s=="function")return s;let t;return Array.isArray(s)?t=s:(Te(typeof s.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[s]),function(){return t}}const In=WS;let LN=class PN extends Gl{constructor(t,e,i){super(),i!==void 0&&e===void 0?this.setFlatCoordinates(i,t):(e=e||0,this.setCenterAndRadius(t,e,i))}clone(){const t=new PN(this.flatCoordinates.slice(),void 0,this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,r){const n=this.flatCoordinates,o=t-n[0],a=e-n[1],l=o*o+a*a;if(l<r){if(l===0)for(let h=0;h<this.stride;++h)i[h]=n[h];else{const h=this.getRadius()/Math.sqrt(l);i[0]=n[0]+h*o,i[1]=n[1]+h*a;for(let c=2;c<this.stride;++c)i[c]=n[c]}return i.length=this.stride,l}return r}containsXY(t,e){const i=this.flatCoordinates,r=t-i[0],n=e-i[1];return r*r+n*n<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(t){const e=this.flatCoordinates,i=e[this.stride]-e[0];return fa(e[0]-i,e[1]-i,e[0]+i,e[1]+i,t)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e}getType(){return"Circle"}intersectsExtent(t){const e=this.getExtent();if(zi(t,e)){const i=this.getCenter();return t[0]<=i[0]&&t[2]>=i[0]||t[1]<=i[1]&&t[3]>=i[1]?!0:iS(t,this.intersectsCoordinate.bind(this))}return!1}setCenter(t){const e=this.stride,i=this.flatCoordinates[e]-this.flatCoordinates[0],r=t.slice();r[e]=r[0]+i;for(let n=1;n<e;++n)r[e+n]=t[n];this.setFlatCoordinates(this.layout,r),this.changed()}setCenterAndRadius(t,e,i){this.setLayout(i,t,0),this.flatCoordinates||(this.flatCoordinates=[]);const r=this.flatCoordinates;let n=Fk(r,0,t,this.stride);r[n++]=r[0]+e;for(let o=1,a=this.stride;o<a;++o)r[n++]=r[o];r.length=n,this.changed()}getCoordinates(){return null}setCoordinates(t,e){}setRadius(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()}rotate(t,e){const i=this.getCenter(),r=this.getStride();this.setCenter(gS(i,0,i.length,r,t,e,i)),this.changed()}};LN.prototype.transform;const jnt=LN;let Gnt=class gb extends Ok{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(ii),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,i=t.length;e<i;++e)this.changeEventsKeys_.push(ae(t[e],Mt.CHANGE,this.changed,this))}clone(){const t=new gb(vx(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,i,r){if(r<Hh(this.getExtent(),t,e))return r;const n=this.geometries_;for(let o=0,a=n.length;o<a;++o)r=n[o].closestPointXY(t,e,i,r);return r}containsXY(t,e){const i=this.geometries_;for(let r=0,n=i.length;r<n;++r)if(i[r].containsXY(t,e))return!0;return!1}computeExtent(t){mf(t);const e=this.geometries_;for(let i=0,r=e.length;i<r;++i)Ek(t,e[i].getExtent());return t}getGeometries(){return vx(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let i=0,r=e.length;i<r;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],i=this.geometries_;let r=!1;for(let n=0,o=i.length;n<o;++n){const a=i[n],l=a.getSimplifiedGeometry(t);e.push(l),l!==a&&(r=!0)}return r?new gb(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let i=0,r=e.length;i<r;++i)if(e[i].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const i=this.geometries_;for(let r=0,n=i.length;r<n;++r)i[r].rotate(t,e);this.changed()}scale(t,e,i){i||(i=xo(this.getExtent()));const r=this.geometries_;for(let n=0,o=r.length;n<o;++n)r[n].scale(t,e,i);this.changed()}setGeometries(t){this.setGeometriesArray(vx(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let i=0,r=e.length;i<r;++i)e[i].applyTransform(t);this.changed()}translate(t,e){const i=this.geometries_;for(let r=0,n=i.length;r<n;++r)i[r].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}};function vx(s){return s.map(t=>t.clone())}const oa=Gnt;function Q0(s,t,e,i,r,n,o){let a,l;const h=(e-t)/i;if(h===1)a=t;else if(h===2)a=t,l=r;else if(h!==0){let c=s[t],u=s[t+1],d=0;const p=[0];for(let m=t+i;m<e;m+=i){const _=s[m],y=s[m+1];d+=Math.sqrt((_-c)*(_-c)+(y-u)*(y-u)),p.push(d),c=_,u=y}const g=r*d,f=Zet(p,g);f<0?(l=(g-p[-f-2])/(p[-f-1]-p[-f-2]),a=t+(-f-2)*i):a=t+f*i}o=o>1?o:2,n=n||new Array(o);for(let c=0;c<o;++c)n[c]=a===void 0?NaN:l===void 0?s[a+c]:Gr(s[a+c],s[a+i+c],l);return n}function fb(s,t,e,i,r,n){if(e==t)return null;let o;if(r<s[t+i-1])return n?(o=s.slice(t,t+i),o[i-1]=r,o):null;if(s[e-1]<r)return n?(o=s.slice(e-i,e),o[i-1]=r,o):null;if(r==s[t+i-1])return s.slice(t,t+i);let a=t/i,l=e/i;for(;a<l;){const d=a+l>>1;r<s[(d+1)*i-1]?l=d:a=d+1}const h=s[a*i-1];if(r==h)return s.slice((a-1)*i,(a-1)*i+i);const c=s[(a+1)*i-1],u=(r-h)/(c-h);o=[];for(let d=0;d<i-1;++d)o.push(Gr(s[(a-1)*i+d],s[a*i+d],u));return o.push(r),o}function znt(s,t,e,i,r,n,o){if(o)return fb(s,t,e[e.length-1],i,r,n);let a;if(r<s[i-1])return n?(a=s.slice(0,i),a[i-1]=r,a):null;if(s[s.length-1]<r)return n?(a=s.slice(s.length-i),a[i-1]=r,a):null;for(let l=0,h=e.length;l<h;++l){const c=e[l];if(t!=c){if(r<s[t+i-1])return null;if(r<=s[c-1])return fb(s,t,c,i,r,!1);t=c}}return null}function ON(s,t,e,i){let r=s[t],n=s[t+1],o=0;for(let a=t+i;a<e;a+=i){const l=s[a],h=s[a+1];o+=Math.sqrt((l-r)*(l-r)+(h-n)*(h-n)),r=l,n=h}return o}let Bnt=class mb extends Gl{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){qe(this.flatCoordinates,t),this.changed()}clone(){const t=new mb(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,r){return r<Hh(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(fS(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),_S(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,r))}forEachSegment(t){return Gk(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,fb(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return dl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return Q0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return ON(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=Py(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new mb(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return Oy(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ly(this.flatCoordinates,0,t,this.stride),this.changed()}};const dn=Bnt;let Unt=class _b extends Gl{constructor(t,e,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&i)this.setFlatCoordinates(e,t),this.ends_=i;else{const r=t,n=[],o=[];for(let l=0,h=r.length;l<h;++l){const c=r[l];qe(n,c.getFlatCoordinates()),o.push(n.length)}const a=r.length===0?this.getLayout():r[0].getLayout();this.setFlatCoordinates(a,n),this.ends_=o}}appendLineString(t){qe(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new _b(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,r){return r<Hh(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(mS(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),yS(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,r))}getCoordinateAtM(t,e,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,i=i!==void 0?i:!1,znt(this.flatCoordinates,0,this.ends_,this.stride,t,e,i))}getCoordinates(){return mg(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new dn(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,i=this.layout,r=[];let n=0;for(let o=0,a=e.length;o<a;++o){const l=e[o],h=new dn(t.slice(n,l),i);r.push(h),n=l}return r}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let i=0;const r=this.ends_,n=this.stride;for(let o=0,a=r.length;o<a;++o){const l=r[o],h=Q0(e,i,l,n,.5);qe(t,h),i=l}return t}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=Nk(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new _b(e,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(t){return rst(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=xf(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}};const Zh=Unt;class XS extends Gl{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){qe(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new XS(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,r){if(r<Hh(this.getExtent(),t,e))return r;const n=this.flatCoordinates,o=this.stride;for(let a=0,l=n.length;a<l;a+=o){const h=ia(t,e,n[a],n[a+1]);if(h<r){r=h;for(let c=0;c<o;++c)i[c]=n[a+c];i.length=o}}return r}getCoordinates(){return dl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new un(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,i=this.stride,r=[];for(let n=0,o=t.length;n<o;n+=i){const a=new un(t.slice(n,n+i),e);r.push(a)}return r}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,i=this.stride;for(let r=0,n=e.length;r<n;r+=i){const o=e[r],a=e[r+1];if(tS(t,o,a))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ly(this.flatCoordinates,0,t,this.stride),this.changed()}}const bd=XS;function FN(s,t,e,i){const r=[];let n=Yr();for(let o=0,a=e.length;o<a;++o){const l=e[o];n=eS(s,t,l[0],i),r.push((n[0]+n[2])/2,(n[1]+n[3])/2),t=l[l.length-1]}return r}let Vnt=class yb extends Gl{constructor(t,e,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){const r=t,n=[],o=[];for(let a=0,l=r.length;a<l;++a){const h=r[a],c=n.length,u=h.getEnds();for(let d=0,p=u.length;d<p;++d)u[d]+=c;qe(n,h.getFlatCoordinates()),o.push(u)}e=r.length===0?this.getLayout():r[0].getLayout(),t=n,i=o}e!==void 0&&i?(this.setFlatCoordinates(e,t),this.endss_=i):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;qe(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let r=0,n=e.length;r<n;++r)e[r]+=i}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let r=0;r<t;++r)e[r]=this.endss_[r].slice();const i=new yb(this.flatCoordinates.slice(),this.layout,e);return i.applyProperties(this),i}closestPointXY(t,e,i,r){return r<Hh(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Zit(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Kit(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,r))}containsXY(t,e){return sst(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return tst(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),nb(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,sb(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=FN(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=jk(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new bd(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Uk(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=nb(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=Qit(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new yb(e,"XY",i)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const n=this.endss_[t-1];e=n[n.length-1]}const i=this.endss_[t].slice(),r=i[i.length-1];if(e!==0)for(let n=0,o=i.length;n<o;++n)i[n]-=e;return new Zs(this.flatCoordinates.slice(e,r),this.layout,i)}getPolygons(){const t=this.layout,e=this.flatCoordinates,i=this.endss_,r=[];let n=0;for(let o=0,a=i.length;o<a;++o){const l=i[o].slice(),h=l[l.length-1];if(n!==0)for(let u=0,d=l.length;u<d;++u)l[u]-=n;const c=new Zs(e.slice(n,h),t,l);r.push(c),n=h}return r}getType(){return"MultiPolygon"}intersectsExtent(t){return nst(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=kk(this.flatCoordinates,0,t,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const r=i[i.length-1];this.flatCoordinates.length=r.length===0?0:r[r.length-1]}this.changed()}};const wd=Vnt,uM=cn();let xb=class vb{constructor(t,e,i,r,n,o){this.styleFunction,this.extent_,this.id_=o,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=n,this.squaredTolerance_,this.stride_=r,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?bp(this.flatCoordinates_):eS(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=xo(this.getExtent());this.flatInteriorPoints_=wS(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=Vk(this.flatCoordinates_,this.ends_),e=FN(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=jk(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Q0(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const i=this.ends_;for(let r=0,n=i.length;r<n;++r){const o=i[r],a=Q0(t,e,o,2,.5);qe(this.flatMidpoints_,a),e=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=si(t);const e=t.getExtent(),i=t.getWorldExtent();if(e&&i){const r=hs(i)/hs(e);Gn(uM,i[0],i[3],r,-r,0,0,0),Sl(this.flatCoordinates_,0,this.flatCoordinates_.length,2,uM,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var t;return new vb(this.type_,this.flatCoordinates_.slice(),(t=this.ends_)==null?void 0:t.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=yk((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const i=this.simplifiedGeometry_.getFlatCoordinates();let r;switch(this.type_){case"LineString":i.length=Py(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,i,0),r=[i.length];break;case"MultiLineString":r=[],i.length=Nk(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,i,0,r);break;case"Polygon":r=[],i.length=xS(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),i,0,r);break}return r&&(this.simplifiedGeometry_=new vb(this.type_,i,r,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}};xb.prototype.getFlatCoordinates=xb.prototype.getOrientedFlatCoordinates;const Tn=xb;class qS{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=In,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let i=e.dataProjection?si(e.dataProjection):this.readProjection(t);e.extent&&i&&i.getUnits()==="tile-pixels"&&(i=si(i),i.setWorldExtent(e.extent)),e={dataProjection:i,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return Xt()}readFeature(t,e){return Xt()}readFeatures(t,e){return Xt()}readGeometry(t,e){return Xt()}readProjection(t){return Xt()}writeFeature(t,e){return Xt()}writeFeatures(t,e){return Xt()}writeGeometry(t,e){return Xt()}}function Kh(s,t,e){const i=e?si(e.featureProjection):null,r=e?si(e.dataProjection):null;let n=s;if(i&&r&&!Xo(i,r)){t&&(n=s.clone());const o=t?i:r,a=t?r:i;o.getUnits()==="tile-pixels"?n.transform(o,a):n.applyTransform(fg(o,a))}if(t&&e&&e.decimals!==void 0){const o=Math.pow(10,e.decimals),a=function(l){for(let h=0,c=l.length;h<c;++h)l[h]=Math.round(l[h]*o)/o;return l};n===s&&(n=s.clone()),n.applyTransform(a)}return n}const Hnt={Point:un,LineString:dn,Polygon:Zs,MultiPoint:bd,MultiLineString:Zh,MultiPolygon:wd};function Wnt(s,t,e){return Array.isArray(t[0])?(Uk(s,0,t,e)||(s=s.slice(),nb(s,0,t,e)),s):(SS(s,0,t,e)||(s=s.slice(),U0(s,0,t,e)),s)}function kN(s,t){var e;const i=s.geometry;if(!i)return[];if(Array.isArray(i))return i.map(o=>kN({...s,geometry:o})).flat();const r=i.type==="MultiPolygon"?"Polygon":i.type;if(r==="GeometryCollection"||r==="Circle")throw new Error("Unsupported geometry type: "+r);const n=i.layout.length;return Kh(new Tn(r,r==="Polygon"?Wnt(i.flatCoordinates,i.ends,n):i.flatCoordinates,(e=i.ends)==null?void 0:e.flat(),n,s.properties||{},s.id).enableSimplifyTransformed(),!1,t)}function YS(s,t){if(!s)return null;if(Array.isArray(s)){const i=s.map(r=>YS(r,t));return new oa(i)}const e=Hnt[s.type];return Kh(new e(s.flatCoordinates,s.layout,s.ends),!1,t)}class Xnt extends qS{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(mm(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(mm(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return Xt()}readFeaturesFromObject(t,e){return Xt()}readGeometry(t,e){return this.readGeometryFromObject(mm(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return Xt()}readProjection(t){return this.readProjectionFromObject(mm(t))}readProjectionFromObject(t){return Xt()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return Xt()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return Xt()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return Xt()}}function mm(s){return typeof s=="string"?JSON.parse(s)||null:s!==null?s:null}const NN=Xnt;class qnt extends NN{constructor(t){t=t||{},super(),this.dataProjection=si(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=si(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let i=null;t.type==="Feature"?i=t:i={type:"Feature",geometry:t,properties:null};const r=ZS(i.geometry);if(this.featureClass===Tn)return kN({geometry:r,id:i.id,properties:i.properties},e);const n=new In;return this.geometryName_?n.setGeometryName(this.geometryName_):this.extractGeometryName_&&i.geometry_name&&n.setGeometryName(i.geometry_name),n.setGeometry(YS(r,e)),"id"in i&&n.setId(i.id),i.properties&&n.setProperties(i.properties,!0),n}readFeaturesFromObject(t,e){const i=t;let r=null;if(i.type==="FeatureCollection"){const n=t;r=[];const o=n.features;for(let a=0,l=o.length;a<l;++a){const h=this.readFeatureFromObject(o[a],e);h&&r.push(h)}}else r=[this.readFeatureFromObject(t,e)];return r.flat()}readGeometryFromObject(t,e){return Ynt(t,e)}readProjectionFromObject(t){const e=t.crs;let i;if(e)if(e.type=="name")i=si(e.properties.name);else if(e.type==="EPSG")i=si("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else i=this.dataProjection;return i}writeFeatureObject(t,e){e=this.adaptOptions(e);const i={type:"Feature",geometry:null,properties:null},r=t.getId();if(r!==void 0&&(i.id=r),!t.hasProperties())return i;const n=t.getProperties(),o=t.getGeometry();return o&&(i.geometry=bb(o,e),delete n[t.getGeometryName()]),Al(n)||(i.properties=n),i}writeFeaturesObject(t,e){e=this.adaptOptions(e);const i=[];for(let r=0,n=t.length;r<n;++r)i.push(this.writeFeatureObject(t[r],e));return{type:"FeatureCollection",features:i}}writeGeometryObject(t,e){return bb(t,this.adaptOptions(e))}}function ZS(s,t){if(!s)return null;let e;switch(s.type){case"Point":{e=Knt(s);break}case"LineString":{e=Jnt(s);break}case"Polygon":{e=iot(s);break}case"MultiPoint":{e=tot(s);break}case"MultiLineString":{e=Qnt(s);break}case"MultiPolygon":{e=eot(s);break}case"GeometryCollection":{e=Znt(s);break}default:throw new Error("Unsupported GeoJSON type: "+s.type)}return e}function Ynt(s,t){const e=ZS(s);return YS(e,t)}function Znt(s,t){return s.geometries.map(function(e){return ZS(e)})}function Knt(s){const t=s.coordinates;return{type:"Point",flatCoordinates:t,layout:Xh(t.length)}}function Jnt(s){var t;const e=s.coordinates,i=e.flat();return{type:"LineString",flatCoordinates:i,ends:[i.length],layout:Xh(((t=e[0])==null?void 0:t.length)||2)}}function Qnt(s){var t,e;const i=s.coordinates,r=((e=(t=i[0])==null?void 0:t[0])==null?void 0:e.length)||2,n=[],o=xf(n,0,i,r);return{type:"MultiLineString",flatCoordinates:n,ends:o,layout:Xh(r)}}function tot(s){var t;const e=s.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:Xh(((t=e[0])==null?void 0:t.length)||2)}}function eot(s){var t,e;const i=s.coordinates,r=[],n=((e=(t=i[0])==null?void 0:t[0])==null?void 0:e[0].length)||2,o=kk(r,0,i,n);return{type:"MultiPolygon",flatCoordinates:r,ends:o,layout:Xh(n)}}function iot(s){var t,e;const i=s.coordinates,r=[],n=(e=(t=i[0])==null?void 0:t[0])==null?void 0:e.length,o=xf(r,0,i,n);return{type:"Polygon",flatCoordinates:r,ends:o,layout:Xh(n)}}function bb(s,t){s=Kh(s,!0,t);const e=s.getType();let i;switch(e){case"Point":{i=lot(s);break}case"LineString":{i=rot(s);break}case"Polygon":{i=hot(s,t);break}case"MultiPoint":{i=oot(s);break}case"MultiLineString":{i=not(s);break}case"MultiPolygon":{i=aot(s,t);break}case"GeometryCollection":{i=sot(s,t);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return i}function sot(s,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:s.getGeometriesArray().map(function(e){return bb(e,t)})}}function rot(s,t){return{type:"LineString",coordinates:s.getCoordinates()}}function not(s,t){return{type:"MultiLineString",coordinates:s.getCoordinates()}}function oot(s,t){return{type:"MultiPoint",coordinates:s.getCoordinates()}}function aot(s,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:s.getCoordinates(e)}}function lot(s,t){return{type:"Point",coordinates:s.getCoordinates()}}function hot(s,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:s.getCoordinates(e)}}const $y=qnt,dM="http://www.w3.org/2001/XMLSchema-instance";function Sf(s,t){return jy().createElementNS(s,t)}function La(s,t){return DN(s,t,[]).join("")}function DN(s,t,e){if(s.nodeType==Node.CDATA_SECTION_NODE||s.nodeType==Node.TEXT_NODE)t?e.push(String(s.nodeValue).replace(/(\r\n|\r|\n)/g,"")):e.push(s.nodeValue);else{let i;for(i=s.firstChild;i;i=i.nextSibling)DN(i,t,e)}return e}function fl(s){return"documentElement"in s}function ml(s){return new DOMParser().parseFromString(s,"application/xml")}function pM(s,t){return function(e,i){const r=s.call(t!==void 0?t:this,e,i);if(r!==void 0){const n=i[i.length-1];qe(n,r)}}}function il(s,t){return function(e,i){const r=s.call(t!==void 0?t:this,e,i);r!==void 0&&i[i.length-1].push(r)}}function KS(s,t){return function(e,i){const r=s.call(t!==void 0?t:this,e,i);r!==void 0&&(i[i.length-1]=r)}}function _t(s,t,e){return function(i,r){const n=s.call(e!==void 0?e:this,i,r);if(n!==void 0){const o=r[r.length-1],a=t!==void 0?t:i.localName;o[a]=n}}}function Ft(s,t){return function(e,i,r){s.call(t!==void 0?t:this,e,i,r),r[r.length-1].node.appendChild(e)}}function Pa(s,t){return function(e,i,r){const n=i[i.length-1].node;let o=s;o===void 0&&(o=r);const a=t!==void 0?t:n.namespaceURI;return Sf(a,o)}}const pn=Pa();function zn(s,t){const e=t.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=s[t[r]];return i}function It(s,t,e){e=e!==void 0?e:{};let i,r;for(i=0,r=s.length;i<r;++i)e[s[i]]=t;return e}function Ed(s,t,e,i){let r;for(r=t.firstElementChild;r;r=r.nextElementSibling){const n=s[r.namespaceURI];if(n!==void 0){const o=n[r.localName];o!==void 0&&o.call(i,r,e)}}}function hi(s,t,e,i,r){return i.push(s),Ed(t,e,i,r),i.pop()}function cot(s,t,e,i,r,n){const o=(r!==void 0?r:e).length;let a,l;for(let h=0;h<o;++h)a=e[h],a!==void 0&&(l=t.call(n!==void 0?n:this,a,i,r!==void 0?r[h]:void 0),l!==void 0&&s[l.namespaceURI][l.localName].call(n,l,a,i))}function Qi(s,t,e,i,r,n,o){return r.push(s),cot(t,e,i,r,n,o),r.pop()}let bx;function uot(){return bx===void 0&&typeof XMLSerializer<"u"&&(bx=new XMLSerializer),bx}let wx;function jy(){return wx===void 0&&typeof document<"u"&&(wx=document.implementation.createDocument("","",null)),wx}class dot extends qS{constructor(){super(),this.xmlSerializer_=uot()}getType(){return"xml"}readFeature(t,e){if(!t)return null;if(typeof t=="string"){const i=ml(t);return this.readFeatureFromDocument(i,e)}return fl(t)?this.readFeatureFromDocument(t,e):this.readFeatureFromNode(t,e)}readFeatureFromDocument(t,e){const i=this.readFeaturesFromDocument(t,e);return i.length>0?i[0]:null}readFeatureFromNode(t,e){return null}readFeatures(t,e){if(!t)return[];if(typeof t=="string"){const i=ml(t);return this.readFeaturesFromDocument(i,e)}return fl(t)?this.readFeaturesFromDocument(t,e):this.readFeaturesFromNode(t,e)}readFeaturesFromDocument(t,e){const i=[];for(let r=t.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&qe(i,this.readFeaturesFromNode(r,e));return i}readFeaturesFromNode(t,e){return Xt()}readGeometry(t,e){if(!t)return null;if(typeof t=="string"){const i=ml(t);return this.readGeometryFromDocument(i,e)}return fl(t)?this.readGeometryFromDocument(t,e):this.readGeometryFromNode(t,e)}readGeometryFromDocument(t,e){return null}readGeometryFromNode(t,e){return null}readProjection(t){if(!t)return null;if(typeof t=="string"){const e=ml(t);return this.readProjectionFromDocument(e)}return fl(t)?this.readProjectionFromDocument(t):this.readProjectionFromNode(t)}readProjectionFromDocument(t){return this.dataProjection}readProjectionFromNode(t){return this.dataProjection}writeFeature(t,e){const i=this.writeFeatureNode(t,e);return this.xmlSerializer_.serializeToString(i)}writeFeatureNode(t,e){return null}writeFeatures(t,e){const i=this.writeFeaturesNode(t,e);return this.xmlSerializer_.serializeToString(i)}writeFeaturesNode(t,e){return null}writeGeometry(t,e){const i=this.writeGeometryNode(t,e);return this.xmlSerializer_.serializeToString(i)}writeGeometryNode(t,e){return null}}const pot=dot;function Fl(s){const t=La(s,!1);return got(t)}function got(s){const t=/^\s*(true|1)|(false|0)\s*$/.exec(s);if(t)return t[1]!==void 0||!1}function Li(s){const t=La(s,!1);return fot(t)}function fot(s){const t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(s);if(t)return parseFloat(t[1])}function Ws(s){return La(s,!1).trim()}function Yu(s,t){An(s,t?"1":"0")}function mot(s,t){s.appendChild(jy().createCDATASection(t))}function gh(s,t){const e=t.toPrecision();s.appendChild(jy().createTextNode(e))}function An(s,t){s.appendChild(jy().createTextNode(t))}const Oa=["http://www.google.com/kml/ext/2.2"],Et=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],_ot="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",gM={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},yot=It(Et,{ExtendedData:JN,Region:QN,MultiGeometry:_t(YN,"geometry"),LineString:_t(XN,"geometry"),LinearRing:_t(qN,"geometry"),Point:_t(ZN,"geometry"),Polygon:_t(KN,"geometry"),Style:_t(t2),StyleMap:eat,address:_t(Ws),description:_t(Ws),name:_t(Ws),open:_t(Fl),phoneNumber:_t(Ws),styleUrl:_t(BN),visibility:_t(Fl)},It(Oa,{MultiTrack:_t(Bot,"geometry"),Track:_t(WN,"geometry")})),xot=It(Et,{ExtendedData:JN,Region:QN,Link:pat,address:_t(Ws),description:_t(Ws),name:_t(Ws),open:_t(Fl),phoneNumber:_t(Ws),visibility:_t(Fl)}),vot=It(Et,{href:_t(zN)}),bot=It(Et,{Altitude:_t(Li),Longitude:_t(Li),Latitude:_t(Li),Tilt:_t(Li),AltitudeMode:_t(Ws),Heading:_t(Li),Roll:_t(Li)}),$N=It(Et,{LatLonAltBox:oat,Lod:lat}),wot=It(Et,["Document","Placemark"]),Eot=It(Et,{Document:Ft(bat),Placemark:Ft(iD)});let mu,Um=null,wb,Sp,Cp,Tp,t_,Eb=null,JS,Sb=null,Cb,fh=null,fM=null,Tb=null;function e_(s){return 32/Math.min(s[0],s[1])}function Sot(){mu=[255,255,255,1],Um=new Ol({color:mu}),wb=[20,2],Sp="pixels",Cp="pixels",Tp=[64,64],t_="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",Eb=new Fy({anchor:wb,anchorOrigin:"bottom-left",anchorXUnits:Sp,anchorYUnits:Cp,crossOrigin:"anonymous",rotation:0,scale:e_(Tp),size:Tp,src:t_}),JS="NO_IMAGE",Sb=new Cl({color:mu,width:1}),Cb=new Cl({color:[51,51,51,1],width:2}),fh=new jS({font:"bold 16px Helvetica",fill:Um,stroke:Cb,scale:.8}),fM=new co({fill:Um,image:Eb,text:fh,stroke:Sb,zIndex:0}),Tb=[fM]}let _m;function Cot(s){return s}class Tot extends pot{constructor(t){super(),t=t||{},Tb||Sot(),this.dataProjection=si("EPSG:4326"),this.defaultStyle_=t.defaultStyle?t.defaultStyle:Tb,this.extractStyles_=t.extractStyles!==void 0?t.extractStyles:!0,this.writeStyles_=t.writeStyles!==void 0?t.writeStyles:!0,this.sharedStyles_={},this.showPointNames_=t.showPointNames!==void 0?t.showPointNames:!0,this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",this.iconUrlFunction_=t.iconUrlFunction?t.iconUrlFunction:Cot,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(t,e){const i=It(Et,{Document:pM(this.readDocumentOrFolder_,this),Folder:pM(this.readDocumentOrFolder_,this),Placemark:il(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),r=hi([],i,t,e,this);if(r)return r}readPlacemark_(t,e){const i=hi({geometry:null},yot,t,e,this);if(!i)return;const r=new In,n=t.getAttribute("id");n!==null&&r.setId(n);const o=e[0],a=i.geometry;if(a&&Kh(a,!1,o),r.setGeometry(a),delete i.geometry,this.extractStyles_){const l=i.Style,h=i.styleUrl,c=Mot(l,h,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);r.setStyle(c)}return delete i.Style,r.setProperties(i,!0),r}readSharedStyle_(t,e){const i=t.getAttribute("id");if(i!==null){const r=t2.call(this,t,e);if(r){let n,o=t.baseURI;(!o||o=="about:blank")&&(o=window.location.href),o?n=new URL("#"+i,o).href:n="#"+i,this.sharedStyles_[n]=r}}}readSharedStyleMap_(t,e){const i=t.getAttribute("id");if(i===null)return;const r=VN.call(this,t,e);if(!r)return;let n,o=t.baseURI;(!o||o=="about:blank")&&(o=window.location.href),o?n=new URL("#"+i,o).href:n="#"+i,this.sharedStyles_[n]=r}readFeatureFromNode(t,e){return Et.includes(t.namespaceURI)&&this.readPlacemark_(t,[this.getReadOptions(t,e)])||null}readFeaturesFromNode(t,e){if(!Et.includes(t.namespaceURI))return[];let i;const r=t.localName;if(r=="Document"||r=="Folder")return i=this.readDocumentOrFolder_(t,[this.getReadOptions(t,e)]),i||[];if(r=="Placemark"){const n=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return n?[n]:[]}if(r=="kml"){i=[];for(let n=t.firstElementChild;n;n=n.nextElementSibling){const o=this.readFeaturesFromNode(n,e);o&&qe(i,o)}return i}return[]}readName(t){if(t){if(typeof t=="string"){const e=ml(t);return this.readNameFromDocument(e)}return fl(t)?this.readNameFromDocument(t):this.readNameFromNode(t)}}readNameFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE){const i=this.readNameFromNode(e);if(i)return i}}readNameFromNode(t){for(let e=t.firstElementChild;e;e=e.nextElementSibling)if(Et.includes(e.namespaceURI)&&e.localName=="name")return Ws(e);for(let e=t.firstElementChild;e;e=e.nextElementSibling){const i=e.localName;if(Et.includes(e.namespaceURI)&&(i=="Document"||i=="Folder"||i=="Placemark"||i=="kml")){const r=this.readNameFromNode(e);if(r)return r}}}readNetworkLinks(t){const e=[];if(typeof t=="string"){const i=ml(t);qe(e,this.readNetworkLinksFromDocument(i))}else fl(t)?qe(e,this.readNetworkLinksFromDocument(t)):qe(e,this.readNetworkLinksFromNode(t));return e}readNetworkLinksFromDocument(t){const e=[];for(let i=t.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&qe(e,this.readNetworkLinksFromNode(i));return e}readNetworkLinksFromNode(t){const e=[];for(let i=t.firstElementChild;i;i=i.nextElementSibling)if(Et.includes(i.namespaceURI)&&i.localName=="NetworkLink"){const r=hi({},xot,i,[]);e.push(r)}for(let i=t.firstElementChild;i;i=i.nextElementSibling){const r=i.localName;Et.includes(i.namespaceURI)&&(r=="Document"||r=="Folder"||r=="kml")&&qe(e,this.readNetworkLinksFromNode(i))}return e}readRegion(t){const e=[];if(typeof t=="string"){const i=ml(t);qe(e,this.readRegionFromDocument(i))}else fl(t)?qe(e,this.readRegionFromDocument(t)):qe(e,this.readRegionFromNode(t));return e}readRegionFromDocument(t){const e=[];for(let i=t.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&qe(e,this.readRegionFromNode(i));return e}readRegionFromNode(t){const e=[];for(let i=t.firstElementChild;i;i=i.nextElementSibling)if(Et.includes(i.namespaceURI)&&i.localName=="Region"){const r=hi({},$N,i,[]);e.push(r)}for(let i=t.firstElementChild;i;i=i.nextElementSibling){const r=i.localName;Et.includes(i.namespaceURI)&&(r=="Document"||r=="Folder"||r=="kml")&&qe(e,this.readRegionFromNode(i))}return e}readCamera(t){const e=[];if(typeof t=="string"){const i=ml(t);qe(e,this.readCameraFromDocument(i))}else fl(t)?qe(e,this.readCameraFromDocument(t)):qe(e,this.readCameraFromNode(t));return e}readCameraFromDocument(t){const e=[];for(let i=t.firstChild;i;i=i.nextSibling)i.nodeType===Node.ELEMENT_NODE&&qe(e,this.readCameraFromNode(i));return e}readCameraFromNode(t){const e=[];for(let i=t.firstElementChild;i;i=i.nextElementSibling)if(Et.includes(i.namespaceURI)&&i.localName==="Camera"){const r=hi({},bot,i,[]);e.push(r)}for(let i=t.firstElementChild;i;i=i.nextElementSibling){const r=i.localName;Et.includes(i.namespaceURI)&&(r==="Document"||r==="Folder"||r==="Placemark"||r==="kml")&&qe(e,this.readCameraFromNode(i))}return e}writeFeaturesNode(t,e){e=this.adaptOptions(e);const i=Sf(Et[4],"kml"),r="http://www.w3.org/2000/xmlns/";i.setAttributeNS(r,"xmlns:gx",Oa[0]),i.setAttributeNS(r,"xmlns:xsi",dM),i.setAttributeNS(dM,"xsi:schemaLocation",_ot);const n={node:i},o={};t.length>1?o.Document=t:t.length==1&&(o.Placemark=t[0]);const a=wot[i.namespaceURI],l=zn(o,a);return Qi(n,Eot,pn,l,[e],a,this),i}}function Rot(s,t){const e=[0,0];let i="start";const r=s.getImage();if(r){const o=r.getSize();if(o&&o.length==2){const a=r.getScaleArray(),l=r.getAnchor();e[0]=a[0]*(o[0]-l[0]),e[1]=a[1]*(o[1]/2-l[1]),i="left"}}let n=s.getText();return n?(n=n.clone(),n.setFont(n.getFont()||fh.getFont()),n.setScale(n.getScale()||fh.getScale()),n.setFill(n.getFill()||fh.getFill()),n.setStroke(n.getStroke()||Cb)):n=fh.clone(),n.setText(t),n.setOffsetX(e[0]),n.setOffsetY(e[1]),n.setTextAlign(i),new co({image:r,text:n})}function Mot(s,t,e,i,r){return function(n,o){let a=r,l="",h=[];if(a){const u=n.getGeometry();if(u)if(u instanceof oa)h=u.getGeometriesArrayRecursive().filter(function(d){const p=d.getType();return p==="Point"||p==="MultiPoint"}),a=h.length>0;else{const d=u.getType();a=d==="Point"||d==="MultiPoint"}}a&&(l=n.get("name"),a=a&&!!l,a&&/&[^&]+;/.test(l)&&(_m||(_m=document.createElement("textarea")),_m.innerHTML=l,l=_m.value));let c=e;if(s?c=s:t&&(c=jN(t,e,i)),a){const u=Rot(c[0],l);if(h.length>0){u.setGeometry(new oa(h));const d=new co({geometry:c[0].getGeometry(),image:null,fill:c[0].getFill(),stroke:c[0].getStroke(),text:null});return[u,d].concat(c.slice(1))}return u}return c}}function jN(s,t,e){return Array.isArray(s)?s:typeof s=="string"?jN(e[s],t,e):t}function Gy(s){const t=La(s,!1),e=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(t);if(e){const i=e[1];return[parseInt(i.substr(6,2),16),parseInt(i.substr(4,2),16),parseInt(i.substr(2,2),16),parseInt(i.substr(0,2),16)/255]}}function GN(s){let t=La(s,!1);const e=[];t=t.replace(/\s*,\s*/g,",");const i=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;let r;for(;r=i.exec(t);){const n=parseFloat(r[1]),o=parseFloat(r[2]),a=r[3]?parseFloat(r[3]):0;e.push(n,o,a),t=t.substr(r[0].length)}if(t==="")return e}function zN(s){const t=La(s,!1).trim();let e=s.baseURI;return(!e||e=="about:blank")&&(e=window.location.href),e?new URL(t,e).href:t}function BN(s){const t=La(s,!1).trim().replace(/^(?!.*#)/,"#");let e=s.baseURI;return(!e||e=="about:blank")&&(e=window.location.href),e?new URL(t,e).href:t}function Iot(s){const t=s.getAttribute("xunits"),e=s.getAttribute("yunits");let i;return t!=="insetPixels"?e!=="insetPixels"?i="bottom-left":i="top-left":e!=="insetPixels"?i="bottom-right":i="top-right",{x:parseFloat(s.getAttribute("x")),xunits:gM[t],y:parseFloat(s.getAttribute("y")),yunits:gM[e],origin:i}}function UN(s){return Li(s)}const Aot=It(Et,{Pair:tat});function VN(s,t){return hi(void 0,Aot,s,t,this)}const Lot=It(Et,{Icon:_t(Hot),color:_t(Gy),heading:_t(Li),hotSpot:_t(Iot),scale:_t(UN)});function Pot(s,t){const e=hi({},Lot,s,t);if(!e)return;const i=t[t.length-1],r="Icon"in e?e.Icon:{},n=!("Icon"in e)||Object.keys(r).length>0;let o;const a=r.href;a?o=a:n&&(o=t_);let l,h,c,u="bottom-left";const d=e.hotSpot;d?(l=[d.x,d.y],h=d.xunits,c=d.yunits,u=d.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(o)&&(o.includes("pushpin")?(l=wb,h=Sp,c=Cp):o.includes("arrow-reverse")?(l=[54,42],h=Sp,c=Cp):o.includes("paddle")&&(l=[32,1],h=Sp,c=Cp));let p;const g=r.x,f=r.y;g!==void 0&&f!==void 0&&(p=[g,f]);let m;const _=r.w,y=r.h;_!==void 0&&y!==void 0&&(m=[_,y]);let v;const b=e.heading;b!==void 0&&(v=El(b));const E=e.scale,S=e.color;if(n){o==t_&&(m=Tp);const T=new Fy({anchor:l,anchorOrigin:u,anchorXUnits:h,anchorYUnits:c,crossOrigin:this.crossOrigin_,offset:p,offsetOrigin:"bottom-left",rotation:v,scale:E,size:m,src:this.iconUrlFunction_(o),color:S}),R=T.getScaleArray()[0],M=T.getSize();if(M===null){const A=T.getImageState();if(A===yt.IDLE||A===yt.LOADING){const O=function(){const N=T.getImageState();if(!(N===yt.IDLE||N===yt.LOADING)){const x=T.getSize();if(x&&x.length==2){const w=e_(x);T.setScale(R*w)}T.unlistenImageChange(O)}};T.listenImageChange(O),A===yt.IDLE&&T.load()}}else if(M.length==2){const A=e_(M);T.setScale(R*A)}i.imageStyle=T}else i.imageStyle=JS}const Oot=It(Et,{color:_t(Gy),scale:_t(UN)});function Fot(s,t){const e=hi({},Oot,s,t);if(!e)return;const i=t[t.length-1],r=new jS({fill:new Ol({color:"color"in e?e.color:mu}),scale:e.scale});i.textStyle=r}const kot=It(Et,{color:_t(Gy),width:_t(Li)});function Not(s,t){const e=hi({},kot,s,t);if(!e)return;const i=t[t.length-1],r=new Cl({color:"color"in e?e.color:mu,width:"width"in e?e.width:1});i.strokeStyle=r}const Dot=It(Et,{color:_t(Gy),fill:_t(Fl),outline:_t(Fl)});function $ot(s,t){const e=hi({},Dot,s,t);if(!e)return;const i=t[t.length-1],r=new Ol({color:"color"in e?e.color:mu});i.fillStyle=r;const n=e.fill;n!==void 0&&(i.fill=n);const o=e.outline;o!==void 0&&(i.outline=o)}const jot=It(Et,{coordinates:KS(GN)});function HN(s,t){return hi(null,jot,s,t)}function Got(s,t){const e=t[t.length-1].coordinates,i=La(s,!1),r=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(i);if(r){const n=parseFloat(r[1]),o=parseFloat(r[2]),a=parseFloat(r[3]);e.push([n,o,a])}else e.push([])}const zot=It(Oa,{Track:il(WN)});function Bot(s,t){const e=hi([],zot,s,t);if(e)return new Zh(e)}const Uot=It(Et,{when:gat},It(Oa,{coord:Got}));function WN(s,t){const e=hi({coordinates:[],whens:[]},Uot,s,t);if(!e)return;const i=[],r=e.coordinates,n=e.whens;for(let o=0,a=Math.min(r.length,n.length);o<a;++o)r[o].length==3&&i.push(r[o][0],r[o][1],r[o][2],n[o]);return new dn(i,"XYZM")}const Vot=It(Et,{href:_t(zN)},It(Oa,{x:_t(Li),y:_t(Li),w:_t(Li),h:_t(Li)}));function Hot(s,t){return hi({},Vot,s,t)||null}const Wot=It(Et,{coordinates:KS(GN)});function QS(s,t){return hi(null,Wot,s,t)}const zy=It(Et,{extrude:_t(Fl),tessellate:_t(Fl),altitudeMode:_t(Ws)});function XN(s,t){const e=hi({},zy,s,t),i=QS(s,t);if(i){const r=new dn(i,"XYZ");return r.setProperties(e,!0),r}}function qN(s,t){const e=hi({},zy,s,t),i=QS(s,t);if(i){const r=new Zs(i,"XYZ",[i.length]);return r.setProperties(e,!0),r}}const Xot=It(Et,{LineString:il(XN),LinearRing:il(qN),MultiGeometry:il(YN),Point:il(ZN),Polygon:il(KN)});function YN(s,t){const e=hi([],Xot,s,t);if(!e)return null;if(e.length===0)return new oa(e);let i,r=!0;const n=e[0].getType();let o;for(let a=1,l=e.length;a<l;++a)if(o=e[a],o.getType()!=n){r=!1;break}if(r){let a,l;if(n=="Point"){const h=e[0];a=h.getLayout(),l=h.getFlatCoordinates();for(let c=1,u=e.length;c<u;++c)o=e[c],qe(l,o.getFlatCoordinates());i=new bd(l,a),Ex(i,e)}else if(n=="LineString")i=new Zh(e),Ex(i,e);else if(n=="Polygon")i=new wd(e),Ex(i,e);else if(n=="GeometryCollection")i=new oa(e);else throw new Error("Unknown geometry type found")}else i=new oa(e);return i}function ZN(s,t){const e=hi({},zy,s,t),i=QS(s,t);if(i){const r=new un(i,"XYZ");return r.setProperties(e,!0),r}}const qot=It(Et,{innerBoundaryIs:cat,outerBoundaryIs:dat});function KN(s,t){const e=hi({},zy,s,t),i=hi([null],qot,s,t);if(i&&i[0]){const r=i[0],n=[r.length];for(let a=1,l=i.length;a<l;++a)qe(r,i[a]),n.push(r.length);const o=new Zs(r,"XYZ",n);return o.setProperties(e,!0),o}}const Yot=It(Et,{IconStyle:Pot,LabelStyle:Fot,LineStyle:Not,PolyStyle:$ot});function t2(s,t){const e=hi({},Yot,s,t,this);if(!e)return null;let i="fillStyle"in e?e.fillStyle:Um;const r=e.fill;r!==void 0&&!r&&(i=null);let n;"imageStyle"in e?e.imageStyle!=JS&&(n=e.imageStyle):n=Eb;const o="textStyle"in e?e.textStyle:fh,a="strokeStyle"in e?e.strokeStyle:Sb,l=e.outline;return l!==void 0&&!l?[new co({geometry:function(h){const c=h.getGeometry(),u=c.getType();if(u==="GeometryCollection"){const d=c;return new oa(d.getGeometriesArrayRecursive().filter(function(p){const g=p.getType();return g!=="Polygon"&&g!=="MultiPolygon"}))}if(u!=="Polygon"&&u!=="MultiPolygon")return c},fill:i,image:n,stroke:a,text:o,zIndex:void 0}),new co({geometry:function(h){const c=h.getGeometry(),u=c.getType();if(u==="GeometryCollection"){const d=c;return new oa(d.getGeometriesArrayRecursive().filter(function(p){const g=p.getType();return g==="Polygon"||g==="MultiPolygon"}))}if(u==="Polygon"||u==="MultiPolygon")return c},fill:i,stroke:null,zIndex:void 0})]:[new co({fill:i,image:n,stroke:a,text:o,zIndex:void 0})]}function Ex(s,t){const e=t.length,i=new Array(t.length),r=new Array(t.length),n=new Array(t.length);let o,a,l;o=!1,a=!1,l=!1;for(let h=0;h<e;++h){const c=t[h];i[h]=c.get("extrude"),r[h]=c.get("tessellate"),n[h]=c.get("altitudeMode"),o=o||i[h]!==void 0,a=a||r[h]!==void 0,l=l||n[h]}o&&s.set("extrude",i),a&&s.set("tessellate",r),l&&s.set("altitudeMode",n)}const Zot=It(Et,{displayName:_t(Ws),value:_t(Ws)});function Kot(s,t){const e=s.getAttribute("name");Ed(Zot,s,t);const i=t[t.length-1];e&&i.displayName?i[e]={value:i.value,displayName:i.displayName,toString:function(){return i.value}}:e!==null?i[e]=i.value:i.displayName!==null&&(i[i.displayName]=i.value),delete i.value}const Jot=It(Et,{Data:Kot,SchemaData:sat});function JN(s,t){Ed(Jot,s,t)}function QN(s,t){Ed($N,s,t)}const Qot=It(Et,{Style:_t(t2),key:_t(Ws),styleUrl:_t(BN)});function tat(s,t){const e=hi({},Qot,s,t,this);if(!e)return;const i=e.key;if(i&&i=="normal"){const r=e.styleUrl;r&&(t[t.length-1]=r);const n=e.Style;n&&(t[t.length-1]=n)}}function eat(s,t){const e=VN.call(this,s,t);if(!e)return;const i=t[t.length-1];if(Array.isArray(e))i.Style=e;else if(typeof e=="string")i.styleUrl=e;else throw new Error("`styleMapValue` has an unknown type")}const iat=It(Et,{SimpleData:rat});function sat(s,t){Ed(iat,s,t)}function rat(s,t){const e=s.getAttribute("name");if(e!==null){const i=Ws(s),r=t[t.length-1];r[e]=i}}const nat=It(Et,{altitudeMode:_t(Ws),minAltitude:_t(Li),maxAltitude:_t(Li),north:_t(Li),south:_t(Li),east:_t(Li),west:_t(Li)});function oat(s,t){const e=hi({},nat,s,t);if(!e)return;const i=t[t.length-1],r=[parseFloat(e.west),parseFloat(e.south),parseFloat(e.east),parseFloat(e.north)];i.extent=r,i.altitudeMode=e.altitudeMode,i.minAltitude=parseFloat(e.minAltitude),i.maxAltitude=parseFloat(e.maxAltitude)}const aat=It(Et,{minLodPixels:_t(Li),maxLodPixels:_t(Li),minFadeExtent:_t(Li),maxFadeExtent:_t(Li)});function lat(s,t){const e=hi({},aat,s,t);if(!e)return;const i=t[t.length-1];i.minLodPixels=parseFloat(e.minLodPixels),i.maxLodPixels=parseFloat(e.maxLodPixels),i.minFadeExtent=parseFloat(e.minFadeExtent),i.maxFadeExtent=parseFloat(e.maxFadeExtent)}const hat=It(Et,{LinearRing:il(HN)});function cat(s,t){const e=hi([],hat,s,t);e.length>0&&t[t.length-1].push(...e)}const uat=It(Et,{LinearRing:KS(HN)});function dat(s,t){const e=hi(void 0,uat,s,t);if(e){const i=t[t.length-1];i[0]=e}}function pat(s,t){Ed(vot,s,t)}function gat(s,t){const e=t[t.length-1].whens,i=La(s,!1),r=Date.parse(i);e.push(isNaN(r)?0:r)}function By(s,t){const e=Hu(t),i=[(e.length==4?e[3]:1)*255,e[2],e[1],e[0]];for(let r=0;r<4;++r){const n=Math.floor(i[r]).toString(16);i[r]=n.length==1?"0"+n:n}An(s,i.join(""))}function fat(s,t,e){const i=e[e.length-1],r=i.layout,n=i.stride;let o;if(r=="XY"||r=="XYM")o=2;else if(r=="XYZ"||r=="XYZM")o=3;else throw new Error("Invalid geometry layout");const a=t.length;let l="";if(a>0){l+=t[0];for(let h=1;h<o;++h)l+=","+t[h];for(let h=n;h<a;h+=n){l+=" "+t[h];for(let c=1;c<o;++c)l+=","+t[h+c]}}An(s,l)}const Vm=It(Et,{Data:Ft(mat),value:Ft(yat),displayName:Ft(_at)});function mat(s,t,e){s.setAttribute("name",t.name);const i={node:s},r=t.value;typeof r=="object"?(r!==null&&r.displayName&&Qi(i,Vm,pn,[r.displayName],e,["displayName"]),r!==null&&r.value&&Qi(i,Vm,pn,[r.value],e,["value"])):Qi(i,Vm,pn,[r],e,["value"])}function _at(s,t){mot(s,t)}function yat(s,t){An(s,t)}const xat=It(Et,{Placemark:Ft(iD)}),vat=function(s,t,e){const i=t[t.length-1].node;return Sf(i.namespaceURI,"Placemark")};function bat(s,t,e){Qi({node:s},xat,vat,t,e,void 0,this)}const wat=Pa("Data");function Eat(s,t,e){const i={node:s},r=t.names,n=t.values,o=r.length;for(let a=0;a<o;a++)Qi(i,Vm,wat,[{name:r[a],value:n[a]}],e)}const mM=It(Et,["href"],It(Oa,["x","y","w","h"])),_M=It(Et,{href:Ft(An)},It(Oa,{x:Ft(gh),y:Ft(gh),w:Ft(gh),h:Ft(gh)})),Sat=function(s,t,e){return Sf(Oa[0],"gx:"+e)};function Cat(s,t,e){const i={node:s},r=e[e.length-1].node;let n=mM[r.namespaceURI],o=zn(t,n);Qi(i,_M,pn,o,e,n),n=mM[Oa[0]],o=zn(t,n),Qi(i,_M,Sat,o,e,n)}const Tat=It(Et,["scale","heading","Icon","color","hotSpot"]),Rat=It(Et,{Icon:Ft(Cat),color:Ft(By),heading:Ft(gh),hotSpot:Ft(tlt),scale:Ft(rD)});function Mat(s,t,e){const i={node:s},r={},n=t.getSrc(),o=t.getSize(),a=t.getImageSize(),l={href:n};if(o){l.w=o[0],l.h=o[1];const m=t.getAnchor(),_=t.getOrigin();if(_&&a&&_[0]!==0&&_[1]!==o[1]&&(l.x=_[0],l.y=a[1]-(_[1]+o[1])),m&&(m[0]!==o[0]/2||m[1]!==o[1]/2)){const y={x:m[0],xunits:"pixels",y:o[1]-m[1],yunits:"pixels"};r.hotSpot=y}}r.Icon=l;let h=t.getScaleArray()[0],c=o;if(c===null&&(c=Tp),c.length==2){const m=e_(c);h=h/m}h!==1&&(r.scale=h);const u=t.getRotation();u!==0&&(r.heading=u);const d=t.getColor();d&&(r.color=d);const p=e[e.length-1].node,g=Tat[p.namespaceURI],f=zn(r,g);Qi(i,Rat,pn,f,e,g)}const Iat=It(Et,["color","scale"]),Aat=It(Et,{color:Ft(By),scale:Ft(rD)});function Lat(s,t,e){const i={node:s},r={},n=t.getFill();n&&(r.color=n.getColor());const o=t.getScale();o&&o!==1&&(r.scale=o);const a=e[e.length-1].node,l=Iat[a.namespaceURI],h=zn(r,l);Qi(i,Aat,pn,h,e,l)}const Pat=It(Et,["color","width"]),Oat=It(Et,{color:Ft(By),width:Ft(gh)});function Fat(s,t,e){const i={node:s},r={color:t.getColor(),width:Number(t.getWidth())||1},n=e[e.length-1].node,o=Pat[n.namespaceURI],a=zn(r,o);Qi(i,Oat,pn,a,e,o)}const kat={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},tD=function(s,t,e){if(s){const i=t[t.length-1].node;return Sf(i.namespaceURI,kat[s.getType()])}},Nat=Pa("Point"),Dat=Pa("LineString"),$at=Pa("LinearRing"),jat=Pa("Polygon"),Gat=It(Et,{LineString:Ft(_u),Point:Ft(_u),Polygon:Ft(sD),GeometryCollection:Ft(eD)});function eD(s,t,e){const i={node:s},r=t.getType();let n=[],o;if(r==="GeometryCollection")t.getGeometriesArrayRecursive().forEach(function(a){const l=a.getType();if(l==="MultiPoint")n=n.concat(a.getPoints());else if(l==="MultiLineString")n=n.concat(a.getLineStrings());else if(l==="MultiPolygon")n=n.concat(a.getPolygons());else if(l==="Point"||l==="LineString"||l==="Polygon")n.push(a);else throw new Error("Unknown geometry type")}),o=tD;else if(r==="MultiPoint")n=t.getPoints(),o=Nat;else if(r==="MultiLineString")n=t.getLineStrings(),o=Dat;else if(r==="MultiPolygon")n=t.getPolygons(),o=jat;else throw new Error("Unknown geometry type");Qi(i,Gat,o,n,e)}const zat=It(Et,{LinearRing:Ft(_u)});function yM(s,t,e){Qi({node:s},zat,$at,[t],e)}const Sx=It(Et,{ExtendedData:Ft(Eat),MultiGeometry:Ft(eD),LineString:Ft(_u),LinearRing:Ft(_u),Point:Ft(_u),Polygon:Ft(sD),Style:Ft(Qat),address:Ft(An),description:Ft(An),name:Ft(An),open:Ft(Yu),phoneNumber:Ft(An),styleUrl:Ft(An),visibility:Ft(Yu)}),Bat=It(Et,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),Uat=Pa("ExtendedData");function iD(s,t,e){const i={node:s};t.getId()&&s.setAttribute("id",t.getId());const r=t.getProperties(),n={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};n[t.getGeometryName()]=1;const o=Object.keys(r||{}).sort().filter(function(p){return!n[p]}),a=t.getStyleFunction();if(a){const p=a(t,0);if(p){const g=Array.isArray(p)?p:[p];let f=g;if(t.getGeometry()&&(f=g.filter(function(m){const _=m.getGeometryFunction()(t);if(_){const y=_.getType();return y==="GeometryCollection"?_.getGeometriesArrayRecursive().filter(function(v){const b=v.getType();return b==="Point"||b==="MultiPoint"}).length:y==="Point"||y==="MultiPoint"}})),this.writeStyles_){let m=g,_=g;t.getGeometry()&&(m=g.filter(function(y){const v=y.getGeometryFunction()(t);if(v){const b=v.getType();return b==="GeometryCollection"?v.getGeometriesArrayRecursive().filter(function(E){const S=E.getType();return S==="LineString"||S==="MultiLineString"}).length:b==="LineString"||b==="MultiLineString"}}),_=g.filter(function(y){const v=y.getGeometryFunction()(t);if(v){const b=v.getType();return b==="GeometryCollection"?v.getGeometriesArrayRecursive().filter(function(E){const S=E.getType();return S==="Polygon"||S==="MultiPolygon"}).length:b==="Polygon"||b==="MultiPolygon"}})),r.Style={pointStyles:f,lineStyles:m,polyStyles:_}}if(f.length&&r.name===void 0){const m=f[0].getText();m&&(r.name=m.getText())}}}const l=e[e.length-1].node,h=Bat[l.namespaceURI],c=zn(r,h);if(Qi(i,Sx,pn,c,e,h),o.length>0){const p=zn(r,o);Qi(i,Sx,Uat,[{names:o,values:p}],e)}const u=e[0];let d=t.getGeometry();d&&(d=Kh(d,!0,u)),Qi(i,Sx,tD,[d],e)}const Vat=It(Et,["extrude","tessellate","altitudeMode","coordinates"]),Hat=It(Et,{extrude:Ft(Yu),tessellate:Ft(Yu),altitudeMode:Ft(An),coordinates:Ft(fat)});function _u(s,t,e){const i=t.getFlatCoordinates(),r={node:s};r.layout=t.getLayout(),r.stride=t.getStride();const n=t.getProperties();n.coordinates=i;const o=e[e.length-1].node,a=Vat[o.namespaceURI],l=zn(n,a);Qi(r,Hat,pn,l,e,a)}const Wat=It(Et,["color","fill","outline"]),xM=It(Et,{outerBoundaryIs:Ft(yM),innerBoundaryIs:Ft(yM)}),Xat=Pa("innerBoundaryIs"),qat=Pa("outerBoundaryIs");function sD(s,t,e){const i=t.getLinearRings(),r=i.shift(),n={node:s};Qi(n,xM,Xat,i,e),Qi(n,xM,qat,[r],e)}const Yat=It(Et,{color:Ft(By),fill:Ft(Yu),outline:Ft(Yu)});function Zat(s,t,e){const i={node:s},r=t.getFill(),n=t.getStroke(),o={color:r?r.getColor():void 0,fill:r?void 0:!1,outline:n?void 0:!1},a=e[e.length-1].node,l=Wat[a.namespaceURI],h=zn(o,l);Qi(i,Yat,pn,h,e,l)}function rD(s,t){gh(s,Math.round(t*1e6)/1e6)}const Kat=It(Et,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),Jat=It(Et,{IconStyle:Ft(Mat),LabelStyle:Ft(Lat),LineStyle:Ft(Fat),PolyStyle:Ft(Zat)});function Qat(s,t,e){const i={node:s},r={};if(t.pointStyles.length){const l=t.pointStyles[0].getText();l&&(r.LabelStyle=l);const h=t.pointStyles[0].getImage();h&&typeof h.getSrc=="function"&&(r.IconStyle=h)}if(t.lineStyles.length){const l=t.lineStyles[0].getStroke();l&&(r.LineStyle=l)}if(t.polyStyles.length){const l=t.polyStyles[0].getStroke();l&&!r.LineStyle&&(r.LineStyle=l),r.PolyStyle=t.polyStyles[0]}const n=e[e.length-1].node,o=Kat[n.namespaceURI],a=zn(r,o);Qi(i,Jat,pn,a,e,o)}function tlt(s,t){s.setAttribute("x",String(t.x)),s.setAttribute("y",String(t.y)),s.setAttribute("xunits",t.xunits),s.setAttribute("yunits",t.yunits)}const elt=Tot;var e2={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */e2.read=function(s,t,e,i,r){var n,o,a=r*8-i-1,l=(1<<a)-1,h=l>>1,c=-7,u=e?r-1:0,d=e?-1:1,p=s[t+u];for(u+=d,n=p&(1<<-c)-1,p>>=-c,c+=a;c>0;n=n*256+s[t+u],u+=d,c-=8);for(o=n&(1<<-c)-1,n>>=-c,c+=i;c>0;o=o*256+s[t+u],u+=d,c-=8);if(n===0)n=1-h;else{if(n===l)return o?NaN:(p?-1:1)*(1/0);o=o+Math.pow(2,i),n=n-h}return(p?-1:1)*o*Math.pow(2,n-i)};e2.write=function(s,t,e,i,r,n){var o,a,l,h=n*8-r-1,c=(1<<h)-1,u=c>>1,d=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:n-1,g=i?1:-1,f=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+u>=1?t+=d/l:t+=d*Math.pow(2,1-u),t*l>=2&&(o++,l/=2),o+u>=c?(a=0,o=c):o+u>=1?(a=(t*l-1)*Math.pow(2,r),o=o+u):(a=t*Math.pow(2,u-1)*Math.pow(2,r),o=0));r>=8;s[e+p]=a&255,p+=g,a/=256,r-=8);for(o=o<<r|a,h+=r;h>0;s[e+p]=o&255,p+=g,o/=256,h-=8);s[e+p-g]|=f*128};var ilt=Ge,ym=e2;function Ge(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Ge.Varint=0;Ge.Fixed64=1;Ge.Bytes=2;Ge.Fixed32=5;var Rb=65536*65536,vM=1/Rb,slt=12,nD=typeof TextDecoder>"u"?null:new TextDecoder("utf8");Ge.prototype={destroy:function(){this.buf=null},readFields:function(s,t,e){for(e=e||this.length;this.pos<e;){var i=this.readVarint(),r=i>>3,n=this.pos;this.type=i&7,s(r,t,this),this.pos===n&&this.skip(i)}return t},readMessage:function(s,t){return this.readFields(s,t,this.readVarint()+this.pos)},readFixed32:function(){var s=xm(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=wM(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=xm(this.buf,this.pos)+xm(this.buf,this.pos+4)*Rb;return this.pos+=8,s},readSFixed64:function(){var s=xm(this.buf,this.pos)+wM(this.buf,this.pos+4)*Rb;return this.pos+=8,s},readFloat:function(){var s=ym.read(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=ym.read(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var t=this.buf,e,i;return i=t[this.pos++],e=i&127,i<128||(i=t[this.pos++],e|=(i&127)<<7,i<128)||(i=t[this.pos++],e|=(i&127)<<14,i<128)||(i=t[this.pos++],e|=(i&127)<<21,i<128)?e:(i=t[this.pos],e|=(i&15)<<28,rlt(e,s,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2===1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,t=this.pos;return this.pos=s,s-t>=slt&&nD?xlt(this.buf,t,s):ylt(this.buf,t,s)},readBytes:function(){var s=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,s);return this.pos=s,t},readPackedVarint:function(s,t){if(this.type!==Ge.Bytes)return s.push(this.readVarint(t));var e=Do(this);for(s=s||[];this.pos<e;)s.push(this.readVarint(t));return s},readPackedSVarint:function(s){if(this.type!==Ge.Bytes)return s.push(this.readSVarint());var t=Do(this);for(s=s||[];this.pos<t;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Ge.Bytes)return s.push(this.readBoolean());var t=Do(this);for(s=s||[];this.pos<t;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Ge.Bytes)return s.push(this.readFloat());var t=Do(this);for(s=s||[];this.pos<t;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Ge.Bytes)return s.push(this.readDouble());var t=Do(this);for(s=s||[];this.pos<t;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Ge.Bytes)return s.push(this.readFixed32());var t=Do(this);for(s=s||[];this.pos<t;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Ge.Bytes)return s.push(this.readSFixed32());var t=Do(this);for(s=s||[];this.pos<t;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Ge.Bytes)return s.push(this.readFixed64());var t=Do(this);for(s=s||[];this.pos<t;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Ge.Bytes)return s.push(this.readSFixed64());var t=Do(this);for(s=s||[];this.pos<t;)s.push(this.readSFixed64());return s},skip:function(s){var t=s&7;if(t===Ge.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ge.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ge.Fixed32)this.pos+=4;else if(t===Ge.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+t)},writeTag:function(s,t){this.writeVarint(s<<3|t)},realloc:function(s){for(var t=this.length||16;t<this.pos+s;)t*=2;if(t!==this.length){var e=new Uint8Array(t);e.set(this.buf),this.buf=e,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),gc(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),gc(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),gc(this.buf,s&-1,this.pos),gc(this.buf,Math.floor(s*vM),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),gc(this.buf,s&-1,this.pos),gc(this.buf,Math.floor(s*vM),this.pos+4),this.pos+=8},writeVarint:function(s){if(s=+s||0,s>268435455||s<0){olt(s,this);return}this.realloc(4),this.buf[this.pos++]=s&127|(s>127?128:0),!(s<=127)&&(this.buf[this.pos++]=(s>>>=7)&127|(s>127?128:0),!(s<=127)&&(this.buf[this.pos++]=(s>>>=7)&127|(s>127?128:0),!(s<=127)&&(this.buf[this.pos++]=s>>>7&127)))},writeSVarint:function(s){this.writeVarint(s<0?-s*2-1:s*2)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(s.length*4),this.pos++;var t=this.pos;this.pos=vlt(this.buf,s,this.pos);var e=this.pos-t;e>=128&&bM(t,e,this),this.pos=t-1,this.writeVarint(e),this.pos+=e},writeFloat:function(s){this.realloc(4),ym.write(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),ym.write(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var t=s.length;this.writeVarint(t),this.realloc(t);for(var e=0;e<t;e++)this.buf[this.pos++]=s[e]},writeRawMessage:function(s,t){this.pos++;var e=this.pos;s(t,this);var i=this.pos-e;i>=128&&bM(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeMessage:function(s,t,e){this.writeTag(s,Ge.Bytes),this.writeRawMessage(t,e)},writePackedVarint:function(s,t){t.length&&this.writeMessage(s,hlt,t)},writePackedSVarint:function(s,t){t.length&&this.writeMessage(s,clt,t)},writePackedBoolean:function(s,t){t.length&&this.writeMessage(s,plt,t)},writePackedFloat:function(s,t){t.length&&this.writeMessage(s,ult,t)},writePackedDouble:function(s,t){t.length&&this.writeMessage(s,dlt,t)},writePackedFixed32:function(s,t){t.length&&this.writeMessage(s,glt,t)},writePackedSFixed32:function(s,t){t.length&&this.writeMessage(s,flt,t)},writePackedFixed64:function(s,t){t.length&&this.writeMessage(s,mlt,t)},writePackedSFixed64:function(s,t){t.length&&this.writeMessage(s,_lt,t)},writeBytesField:function(s,t){this.writeTag(s,Ge.Bytes),this.writeBytes(t)},writeFixed32Field:function(s,t){this.writeTag(s,Ge.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(s,t){this.writeTag(s,Ge.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(s,t){this.writeTag(s,Ge.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(s,t){this.writeTag(s,Ge.Fixed64),this.writeSFixed64(t)},writeVarintField:function(s,t){this.writeTag(s,Ge.Varint),this.writeVarint(t)},writeSVarintField:function(s,t){this.writeTag(s,Ge.Varint),this.writeSVarint(t)},writeStringField:function(s,t){this.writeTag(s,Ge.Bytes),this.writeString(t)},writeFloatField:function(s,t){this.writeTag(s,Ge.Fixed32),this.writeFloat(t)},writeDoubleField:function(s,t){this.writeTag(s,Ge.Fixed64),this.writeDouble(t)},writeBooleanField:function(s,t){this.writeVarintField(s,!!t)}};function rlt(s,t,e){var i=e.buf,r,n;if(n=i[e.pos++],r=(n&112)>>4,n<128||(n=i[e.pos++],r|=(n&127)<<3,n<128)||(n=i[e.pos++],r|=(n&127)<<10,n<128)||(n=i[e.pos++],r|=(n&127)<<17,n<128)||(n=i[e.pos++],r|=(n&127)<<24,n<128)||(n=i[e.pos++],r|=(n&1)<<31,n<128))return nlt(s,r,t);throw new Error("Expected varint not more than 10 bytes")}function Do(s){return s.type===Ge.Bytes?s.readVarint()+s.pos:s.pos+1}function nlt(s,t,e){return e?t*4294967296+(s>>>0):(t>>>0)*4294967296+(s>>>0)}function olt(s,t){var e,i;if(s>=0?(e=s%4294967296|0,i=s/4294967296|0):(e=~(-s%4294967296),i=~(-s/4294967296),e^4294967295?e=e+1|0:(e=0,i=i+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),alt(e,i,t),llt(i,t)}function alt(s,t,e){e.buf[e.pos++]=s&127|128,s>>>=7,e.buf[e.pos++]=s&127|128,s>>>=7,e.buf[e.pos++]=s&127|128,s>>>=7,e.buf[e.pos++]=s&127|128,s>>>=7,e.buf[e.pos]=s&127}function llt(s,t){var e=(s&7)<<4;t.buf[t.pos++]|=e|((s>>>=3)?128:0),s&&(t.buf[t.pos++]=s&127|((s>>>=7)?128:0),s&&(t.buf[t.pos++]=s&127|((s>>>=7)?128:0),s&&(t.buf[t.pos++]=s&127|((s>>>=7)?128:0),s&&(t.buf[t.pos++]=s&127|((s>>>=7)?128:0),s&&(t.buf[t.pos++]=s&127)))))}function bM(s,t,e){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));e.realloc(i);for(var r=e.pos-1;r>=s;r--)e.buf[r+i]=e.buf[r]}function hlt(s,t){for(var e=0;e<s.length;e++)t.writeVarint(s[e])}function clt(s,t){for(var e=0;e<s.length;e++)t.writeSVarint(s[e])}function ult(s,t){for(var e=0;e<s.length;e++)t.writeFloat(s[e])}function dlt(s,t){for(var e=0;e<s.length;e++)t.writeDouble(s[e])}function plt(s,t){for(var e=0;e<s.length;e++)t.writeBoolean(s[e])}function glt(s,t){for(var e=0;e<s.length;e++)t.writeFixed32(s[e])}function flt(s,t){for(var e=0;e<s.length;e++)t.writeSFixed32(s[e])}function mlt(s,t){for(var e=0;e<s.length;e++)t.writeFixed64(s[e])}function _lt(s,t){for(var e=0;e<s.length;e++)t.writeSFixed64(s[e])}function xm(s,t){return(s[t]|s[t+1]<<8|s[t+2]<<16)+s[t+3]*16777216}function gc(s,t,e){s[e]=t,s[e+1]=t>>>8,s[e+2]=t>>>16,s[e+3]=t>>>24}function wM(s,t){return(s[t]|s[t+1]<<8|s[t+2]<<16)+(s[t+3]<<24)}function ylt(s,t,e){for(var i="",r=t;r<e;){var n=s[r],o=null,a=n>239?4:n>223?3:n>191?2:1;if(r+a>e)break;var l,h,c;a===1?n<128&&(o=n):a===2?(l=s[r+1],(l&192)===128&&(o=(n&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=s[r+1],h=s[r+2],(l&192)===128&&(h&192)===128&&(o=(n&15)<<12|(l&63)<<6|h&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=s[r+1],h=s[r+2],c=s[r+3],(l&192)===128&&(h&192)===128&&(c&192)===128&&(o=(n&15)<<18|(l&63)<<12|(h&63)<<6|c&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,i+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),i+=String.fromCharCode(o),r+=a}return i}function xlt(s,t,e){return nD.decode(s.subarray(t,e))}function vlt(s,t,e){for(var i=0,r,n;i<t.length;i++){if(r=t.charCodeAt(i),r>55295&&r<57344)if(n)if(r<56320){s[e++]=239,s[e++]=191,s[e++]=189,n=r;continue}else r=n-55296<<10|r-56320|65536,n=null;else{r>56319||i+1===t.length?(s[e++]=239,s[e++]=191,s[e++]=189):n=r;continue}else n&&(s[e++]=239,s[e++]=191,s[e++]=189,n=null);r<128?s[e++]=r:(r<2048?s[e++]=r>>6|192:(r<65536?s[e++]=r>>12|224:(s[e++]=r>>18|240,s[e++]=r>>12&63|128),s[e++]=r>>6&63|128),s[e++]=r&63|128)}return e}const blt=Yk(ilt);class wlt extends qS{constructor(t){super(),t=t||{},this.dataProjection=new QE({code:"",units:"tile-pixels"}),this.featureClass_=t.featureClass?t.featureClass:Tn,this.geometryName_=t.geometryName,this.layerName_=t.layerName?t.layerName:"layer",this.layers_=t.layers?t.layers:null,this.idProperty_=t.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(t,e,i,r){t.pos=e.geometry;const n=t.readVarint()+t.pos;let o=1,a=0,l=0,h=0,c=0,u=0;for(;t.pos<n;){if(!a){const d=t.readVarint();o=d&7,a=d>>3}if(a--,o===1||o===2)l+=t.readSVarint(),h+=t.readSVarint(),o===1&&c>u&&(r.push(c),u=c),i.push(l,h),c+=2;else if(o===7)c>u&&(i.push(i[u],i[u+1]),c+=2);else throw new Error("Invalid command found in the PBF")}c>u&&(r.push(c),u=c)}createFeature_(t,e,i){const r=e.type;if(r===0)return null;let n;const o=e.properties;let a;this.idProperty_?(a=o[this.idProperty_],delete o[this.idProperty_]):a=e.id,o[this.layerName_]=e.layer.name;const l=[],h=[];this.readRawGeometry_(t,e,l,h);const c=Rlt(r,h.length);if(this.featureClass_===Tn)n=new this.featureClass_(c,l,h,2,o,a),n.transform(i.dataProjection);else{let u;if(c=="Polygon"){const g=Vk(l,h);u=g.length>1?new wd(l,"XY",g):new Zs(l,"XY",h)}else u=c==="Point"?new un(l,"XY"):c==="LineString"?new dn(l,"XY"):c==="MultiPoint"?new bd(l,"XY"):c==="MultiLineString"?new Zh(l,"XY",h):null;const d=this.featureClass_;n=new d,this.geometryName_&&n.setGeometryName(this.geometryName_);const p=Kh(u,!1,i);n.setGeometry(p),a!==void 0&&n.setId(a),n.setProperties(o,!0)}return n}getType(){return"arraybuffer"}readFeatures(t,e){const i=this.layers_;e=this.adaptOptions(e);const r=si(e.dataProjection);r.setWorldExtent(e.extent),e.dataProjection=r;const n=new blt(t),o=n.readFields(Elt,{}),a=[];for(const l in o){if(i&&!i.includes(l))continue;const h=o[l],c=h?[0,0,h.extent,h.extent]:null;r.setExtent(c);for(let u=0,d=h.length;u<d;++u){const p=Tlt(n,h,u),g=this.createFeature_(n,p,e);g!==null&&a.push(g)}}return a}readProjection(t){return this.dataProjection}setLayers(t){this.layers_=t}}function Elt(s,t,e){if(s===3){const i={keys:[],values:[],features:[]},r=e.readVarint()+e.pos;e.readFields(Slt,i,r),i.length=i.features.length,i.length&&(t[i.name]=i)}}function Slt(s,t,e){if(s===15)t.version=e.readVarint();else if(s===1)t.name=e.readString();else if(s===5)t.extent=e.readVarint();else if(s===2)t.features.push(e.pos);else if(s===3)t.keys.push(e.readString());else if(s===4){let i=null;const r=e.readVarint()+e.pos;for(;e.pos<r;)s=e.readVarint()>>3,i=s===1?e.readString():s===2?e.readFloat():s===3?e.readDouble():s===4?e.readVarint64():s===5?e.readVarint():s===6?e.readSVarint():s===7?e.readBoolean():null;t.values.push(i)}}function Clt(s,t,e){if(s==1)t.id=e.readVarint();else if(s==2){const i=e.readVarint()+e.pos;for(;e.pos<i;){const r=t.layer.keys[e.readVarint()],n=t.layer.values[e.readVarint()];t.properties[r]=n}}else s==3?t.type=e.readVarint():s==4&&(t.geometry=e.pos)}function Tlt(s,t,e){s.pos=t.features[e];const i=s.readVarint()+s.pos,r={layer:t,type:0,properties:{}};return s.readFields(Clt,r,i),r}function Rlt(s,t){let e;return s===1?e=t===1?"Point":"MultiPoint":s===2?e=t===1?"LineString":"MultiLineString":s===3&&(e="Polygon"),e}const Mlt=wlt;class Ilt extends NN{constructor(t){super(),t=t||{},this.layerName_=t.layerName,this.layers_=t.layers?t.layers:null,this.dataProjection=si(t.dataProjection?t.dataProjection:"EPSG:4326")}readFeaturesFromObject(t,e){if(t.type=="Topology"){const i=t;let r,n=null,o=null;i.transform&&(r=i.transform,n=r.scale,o=r.translate);const a=i.arcs;r&&$lt(a,n,o);const l=[],h=i.objects,c=this.layerName_;let u;for(const d in h)this.layers_&&!this.layers_.includes(d)||(h[d].type==="GeometryCollection"?(u=h[d],l.push.apply(l,Dlt(u,a,n,o,c,d,e))):(u=h[d],l.push(oD(u,a,n,o,c,d,e))));return l}return[]}readProjectionFromObject(t){return this.dataProjection}}const Alt={Point:Llt,LineString:Olt,Polygon:klt,MultiPoint:Plt,MultiLineString:Flt,MultiPolygon:Nlt};function Uy(s,t){const e=[];let i;for(let r=0,n=s.length;r<n;++r)if(i=s[r],r>0&&e.pop(),i>=0){const o=t[i];for(let a=0,l=o.length;a<l;++a)e.push(o[a].slice(0))}else{const o=t[~i];for(let a=o.length-1;a>=0;--a)e.push(o[a].slice(0))}return e}function Llt(s,t,e){const i=s.coordinates;return t&&e&&i2(i,t,e),new un(i)}function Plt(s,t,e){const i=s.coordinates;if(t&&e)for(let r=0,n=i.length;r<n;++r)i2(i[r],t,e);return new bd(i)}function Olt(s,t){const e=Uy(s.arcs,t);return new dn(e)}function Flt(s,t){const e=[];for(let i=0,r=s.arcs.length;i<r;++i)e[i]=Uy(s.arcs[i],t);return new Zh(e)}function klt(s,t){const e=[];for(let i=0,r=s.arcs.length;i<r;++i)e[i]=Uy(s.arcs[i],t);return new Zs(e)}function Nlt(s,t){const e=[];for(let i=0,r=s.arcs.length;i<r;++i){const n=s.arcs[i],o=[];for(let a=0,l=n.length;a<l;++a)o[a]=Uy(n[a],t);e[i]=o}return new wd(e)}function Dlt(s,t,e,i,r,n,o){const a=s.geometries,l=[];for(let h=0,c=a.length;h<c;++h)l[h]=oD(a[h],t,e,i,r,n,o);return l}function oD(s,t,e,i,r,n,o){let a=null;const l=s.type;if(l){const u=Alt[l];l==="Point"||l==="MultiPoint"?a=u(s,e,i):a=u(s,t),a=Kh(a,!1,o)}const h=new In({geometry:a});s.id!==void 0&&h.setId(s.id);let c=s.properties;return r&&(c||(c={}),c[r]=n),c&&h.setProperties(c,!0),h}function $lt(s,t,e){for(let i=0,r=s.length;i<r;++i)jlt(s[i],t,e)}function jlt(s,t,e){let i=0,r=0;for(let n=0,o=s.length;n<o;++n){const a=s[n];i+=a[0],r+=a[1],a[0]=i,a[1]=r,i2(a,t,e)}}function i2(s,t,e){s[0]=s[0]*t[0]+e[0],s[1]=s[1]*t[1]+e[1]}const Glt=Ilt,Cf={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},vm=[Cf.FILL],_l=[Cf.STROKE],mh=[Cf.BEGIN_PATH],EM=[Cf.CLOSE_PATH],Gt=Cf;class zlt{drawCustom(t,e,i,r,n){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,i){}drawFeature(t,e,i){}drawGeometryCollection(t,e,i){}drawLineString(t,e,i){}drawMultiLineString(t,e,i){}drawMultiPoint(t,e,i){}drawMultiPolygon(t,e,i){}drawPoint(t,e,i){}drawPolygon(t,e,i){}drawText(t,e,i){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}const aD=zlt;class Blt extends aD{constructor(t,e,i,r){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=r,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(i){return i*e})}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),r=this.tmpCoordinate_,n=this.coordinates;let o=n.length;for(let a=0,l=t.length;a<l;a+=e)r[0]=t[a],r[1]=t[a+1],kh(i,r)&&(n[o++]=r[0],n[o++]=r[1]);return o}appendFlatLineCoordinates(t,e,i,r,n,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(e+=r);let c=t[e],u=t[e+1];const d=this.tmpCoordinate_;let p=!0,g,f,m;for(g=e+r;g<i;g+=r)d[0]=t[g],d[1]=t[g+1],m=Jv(h,d),m!==f?(p&&(a[l++]=c,a[l++]=u,p=!1),a[l++]=d[0],a[l++]=d[1]):m===ms.INTERSECTING?(a[l++]=d[0],a[l++]=d[1],p=!1):p=!0,c=d[0],u=d[1],f=m;return(n&&p||g===e+r)&&(a[l++]=c,a[l++]=u),l}drawCustomCoordinates_(t,e,i,r,n){for(let o=0,a=i.length;o<a;++o){const l=i[o],h=this.appendFlatLineCoordinates(t,e,l,r,!1,!1);n.push(h),e=l}return e}drawCustom(t,e,i,r,n){this.beginGeometry(t,e,n);const o=t.getType(),a=t.getStride(),l=this.coordinates.length;let h,c,u,d,p;switch(o){case"MultiPolygon":h=t.getOrientedFlatCoordinates(),d=[];const g=t.getEndss();p=0;for(let f=0,m=g.length;f<m;++f){const _=[];p=this.drawCustomCoordinates_(h,p,g[f],a,_),d.push(_)}this.instructions.push([Gt.CUSTOM,l,d,t,i,sb,n]),this.hitDetectionInstructions.push([Gt.CUSTOM,l,d,t,r||i,sb,n]);break;case"Polygon":case"MultiLineString":u=[],h=o=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),p=this.drawCustomCoordinates_(h,0,t.getEnds(),a,u),this.instructions.push([Gt.CUSTOM,l,u,t,i,mg,n]),this.hitDetectionInstructions.push([Gt.CUSTOM,l,u,t,r||i,mg,n]);break;case"LineString":case"Circle":h=t.getFlatCoordinates(),c=this.appendFlatLineCoordinates(h,0,h.length,a,!1,!1),this.instructions.push([Gt.CUSTOM,l,c,t,i,dl,n]),this.hitDetectionInstructions.push([Gt.CUSTOM,l,c,t,r||i,dl,n]);break;case"MultiPoint":h=t.getFlatCoordinates(),c=this.appendFlatPointCoordinates(h,a),c>l&&(this.instructions.push([Gt.CUSTOM,l,c,t,i,dl,n]),this.hitDetectionInstructions.push([Gt.CUSTOM,l,c,t,r||i,dl,n]));break;case"Point":h=t.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),c=this.coordinates.length,this.instructions.push([Gt.CUSTOM,l,c,t,i,void 0,n]),this.hitDetectionInstructions.push([Gt.CUSTOM,l,c,t,r||i,void 0,n]);break}this.endGeometry(e)}beginGeometry(t,e,i){this.beginGeometryInstruction1_=[Gt.BEGIN_GEOMETRY,e,0,t,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Gt.BEGIN_GEOMETRY,e,0,t,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const i=t.length;let r,n,o=-1;for(e=0;e<i;++e)r=t[e],n=r[0],n==Gt.END_GEOMETRY?o=e:n==Gt.BEGIN_GEOMETRY&&(r[2]=e,Ket(this.hitDetectionInstructions,o,e),o=-1)}setFillStrokeStyle(t,e){const i=this.state;if(t){const r=t.getColor();i.fillPatternScale=r&&typeof r=="object"&&"src"in r?this.pixelRatio:1,i.fillStyle=oo(r||Er)}else i.fillStyle=void 0;if(e){const r=e.getColor();i.strokeStyle=oo(r||xg);const n=e.getLineCap();i.lineCap=n!==void 0?n:Xu;const o=e.getLineDash();i.lineDash=o?o.slice():ra;const a=e.getLineDashOffset();i.lineDashOffset=a||na;const l=e.getLineJoin();i.lineJoin=l!==void 0?l:qu;const h=e.getWidth();i.lineWidth=h!==void 0?h:bg;const c=e.getMiterLimit();i.miterLimit=c!==void 0?c:yg,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){const e=t.fillStyle,i=[Gt.SET_FILL_STYLE,e];return typeof e!="string"&&i.push(t.fillPatternScale),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[Gt.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;(typeof i!="string"||t.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,r=t.lineCap,n=t.lineDash,o=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=r||n!=t.currentLineDash&&!Ia(t.currentLineDash,n)||t.currentLineDashOffset!=o||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=h)&&(i!==void 0&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=r,t.currentLineDash=n,t.currentLineDashOffset=o,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[Gt.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=wk(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;hn(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}const Tf=Blt;class Ult extends Tf{constructor(t,e,i,r){super(t,e,i,r),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,i){if(!this.image_||this.maxExtent&&!kh(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,i);const r=t.getFlatCoordinates(),n=t.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(r,n);this.instructions.push([Gt.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Gt.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,i){if(!this.image_)return;this.beginGeometry(t,e,i);const r=t.getFlatCoordinates(),n=[];for(let l=0,h=r.length;l<h;l+=t.getStride())(!this.maxExtent||kh(this.maxExtent,r.slice(l,l+2)))&&n.push(r[l],r[l+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(n,2);this.instructions.push([Gt.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Gt.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),r=t.getSize(),n=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=r[1],this.opacity_=t.getOpacity(),this.originX_=n[0],this.originY_=n[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=r[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const Vlt=Ult;class Hlt extends Tf{constructor(t,e,i,r){super(t,e,i,r)}drawFlatCoordinates_(t,e,i,r){const n=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,i,r,!1,!1),a=[Gt.MOVE_TO_LINE_TO,n,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),i}drawLineString(t,e,i){const r=this.state,n=r.strokeStyle,o=r.lineWidth;if(n===void 0||o===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([Gt.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,ra,na],mh);const a=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(_l),this.endGeometry(e)}drawMultiLineString(t,e,i){const r=this.state,n=r.strokeStyle,o=r.lineWidth;if(n===void 0||o===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([Gt.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,ra,na],mh);const a=t.getEnds(),l=t.getFlatCoordinates(),h=t.getStride();let c=0;for(let u=0,d=a.length;u<d;++u)c=this.drawFlatCoordinates_(l,c,a[u],h);this.hitDetectionInstructions.push(_l),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(_l),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(_l),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(mh)}}const Wlt=Hlt;class Xlt extends Tf{constructor(t,e,i,r){super(t,e,i,r)}drawFlatCoordinatess_(t,e,i,r){const n=this.state,o=n.fillStyle!==void 0,a=n.strokeStyle!==void 0,l=i.length;this.instructions.push(mh),this.hitDetectionInstructions.push(mh);for(let h=0;h<l;++h){const c=i[h],u=this.coordinates.length,d=this.appendFlatLineCoordinates(t,e,c,r,!0,!a),p=[Gt.MOVE_TO_LINE_TO,u,d];this.instructions.push(p),this.hitDetectionInstructions.push(p),a&&(this.instructions.push(EM),this.hitDetectionInstructions.push(EM)),e=c}return o&&(this.instructions.push(vm),this.hitDetectionInstructions.push(vm)),a&&(this.instructions.push(_l),this.hitDetectionInstructions.push(_l)),e}drawCircle(t,e,i){const r=this.state,n=r.fillStyle,o=r.strokeStyle;if(n===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Gt.SET_FILL_STYLE,Er]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Gt.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,ra,na]);const a=t.getFlatCoordinates(),l=t.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const c=[Gt.CIRCLE,h];this.instructions.push(mh,c),this.hitDetectionInstructions.push(mh,c),r.fillStyle!==void 0&&(this.instructions.push(vm),this.hitDetectionInstructions.push(vm)),r.strokeStyle!==void 0&&(this.instructions.push(_l),this.hitDetectionInstructions.push(_l)),this.endGeometry(e)}drawPolygon(t,e,i){const r=this.state,n=r.fillStyle,o=r.strokeStyle;if(n===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Gt.SET_FILL_STYLE,Er]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Gt.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,ra,na]);const a=t.getEnds(),l=t.getOrientedFlatCoordinates(),h=t.getStride();this.drawFlatCoordinatess_(l,0,a,h),this.endGeometry(e)}drawMultiPolygon(t,e,i){const r=this.state,n=r.fillStyle,o=r.strokeStyle;if(n===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Gt.SET_FILL_STYLE,Er]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Gt.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,ra,na]);const a=t.getEndss(),l=t.getOrientedFlatCoordinates(),h=t.getStride();let c=0;for(let u=0,d=a.length;u<d;++u)c=this.drawFlatCoordinatess_(l,c,a[u],h);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let i=0,r=e.length;i<r;++i)e[i]=sh(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}const SM=Xlt;function qlt(s,t,e,i,r){const n=[];let o=e,a=0,l=t.slice(e,2);for(;a<s&&o+r<i;){const[h,c]=l.slice(-2),u=t[o+r],d=t[o+r+1],p=Math.sqrt((u-h)*(u-h)+(d-c)*(d-c));if(a+=p,a>=s){const g=(s-a+p)/p,f=Gr(h,u,g),m=Gr(c,d,g);l.push(f,m),n.push(l),l=[f,m],a==s&&(o+=r),a=0}else if(a<s)l.push(t[o+r],t[o+r+1]),o+=r;else{const g=p-a,f=Gr(h,u,g/p),m=Gr(c,d,g/p);l.push(f,m),n.push(l),l=[f,m],a=0,o+=r}}return a>0&&n.push(l),n}function Ylt(s,t,e,i,r){let n=e,o=e,a=0,l=0,h=e,c,u,d,p,g,f,m,_,y,v;for(u=e;u<i;u+=r){const b=t[u],E=t[u+1];g!==void 0&&(y=b-g,v=E-f,p=Math.sqrt(y*y+v*v),m!==void 0&&(l+=d,c=Math.acos((m*y+_*v)/(d*p)),c>s&&(l>a&&(a=l,n=h,o=u),l=0,h=u-r)),d=p,m=y,_=v),g=b,f=E}return l+=p,l>a?[h,u]:[n,o]}const i_={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class Zlt extends Tf{constructor(t,e,i,r){super(t,e,i,r),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[Er]={fillStyle:Er},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,i){const r=this.textFillState_,n=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!r&&!n)return;const a=this.coordinates;let l=a.length;const h=t.getType();let c=null,u=t.getStride();if(o.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!zi(this.maxExtent,t.getExtent()))return;let d;if(c=t.getFlatCoordinates(),h=="LineString")d=[c.length];else if(h=="MultiLineString")d=t.getEnds();else if(h=="Polygon")d=t.getEnds().slice(0,1);else if(h=="MultiPolygon"){const m=t.getEndss();d=[];for(let _=0,y=m.length;_<y;++_)d.push(m[_][0])}this.beginGeometry(t,e,i);const p=o.repeat,g=p?void 0:o.textAlign;let f=0;for(let m=0,_=d.length;m<_;++m){let y;p?y=qlt(p*this.resolution,c,f,d[m],u):y=[c.slice(f,d[m])];for(let v=0,b=y.length;v<b;++v){const E=y[v];let S=0,T=E.length;if(g==null){const M=Ylt(o.maxAngle,E,0,E.length,2);S=M[0],T=M[1]}for(let M=S;M<T;M+=u)a.push(E[M],E[M+1]);const R=a.length;f=d[m],this.drawChars_(l,R),l=R}}this.endGeometry(e)}else{let d=o.overflow?null:[];switch(h){case"Point":case"MultiPoint":c=t.getFlatCoordinates();break;case"LineString":c=t.getFlatMidpoint();break;case"Circle":c=t.getCenter();break;case"MultiLineString":c=t.getFlatMidpoints(),u=2;break;case"Polygon":c=t.getFlatInteriorPoint(),o.overflow||d.push(c[2]/this.resolution),u=3;break;case"MultiPolygon":const y=t.getFlatInteriorPoints();c=[];for(let v=0,b=y.length;v<b;v+=3)o.overflow||d.push(y[v+2]/this.resolution),c.push(y[v],y[v+1]);if(c.length===0)return;u=2;break}const p=this.appendFlatPointCoordinates(c,u);if(p===l)return;if(d&&(p-l)/2!==c.length/u){let y=l/2;d=d.filter((v,b)=>{const E=a[(y+b)*2]===c[b*u]&&a[(y+b)*2+1]===c[b*u+1];return E||--y,E})}this.saveTextStates_(),(o.backgroundFill||o.backgroundStroke)&&(this.setFillStrokeStyle(o.backgroundFill,o.backgroundStroke),o.backgroundFill&&this.updateFillStyle(this.state,this.createFill),o.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e,i);let g=o.padding;if(g!=ph&&(o.scale[0]<0||o.scale[1]<0)){let y=o.padding[0],v=o.padding[1],b=o.padding[2],E=o.padding[3];o.scale[0]<0&&(v=-v,E=-E),o.scale[1]<0&&(y=-y,b=-b),g=[y,v,b,E]}const f=this.pixelRatio;this.instructions.push([Gt.DRAW_IMAGE,l,p,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,g==ph?ph:g.map(function(y){return y*f}),!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]);const m=1/f,_=this.state.fillStyle;o.backgroundFill&&(this.state.fillStyle=Er,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([Gt.DRAW_IMAGE,l,p,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[m,m],NaN,this.declutterMode_,this.declutterImageWithText_,g,!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?Er:this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]),o.backgroundFill&&(this.state.fillStyle=_,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,r=this.strokeKey_;t&&(r in this.strokeStates||(this.strokeStates[r]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const n=this.textKey_;n in this.textStates||(this.textStates[n]={font:e.font,textAlign:e.textAlign||vg,justify:e.justify,textBaseline:e.textBaseline||X0,scale:e.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,r=this.textState_,n=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=i_[r.textBaseline],c=this.textOffsetY_*l,u=this.text_,d=i?i.lineWidth*Math.abs(r.scale[0])/2:0;this.instructions.push([Gt.DRAW_CHARS,t,e,h,r.overflow,a,r.maxAngle,l,c,n,d*l,u,o,1,this.declutterMode_]),this.hitDetectionInstructions.push([Gt.DRAW_CHARS,t,e,h,r.overflow,a&&Er,r.maxAngle,l,c,n,d*l,u,o,1/l,this.declutterMode_])}setTextStyle(t,e){let i,r,n;if(!t)this.text_="";else{const o=t.getFill();o?(r=this.textFillState_,r||(r={},this.textFillState_=r),r.fillStyle=oo(o.getColor()||Er)):(r=null,this.textFillState_=r);const a=t.getStroke();if(!a)n=null,this.textStrokeState_=n;else{n=this.textStrokeState_,n||(n={},this.textStrokeState_=n);const g=a.getLineDash(),f=a.getLineDashOffset(),m=a.getWidth(),_=a.getMiterLimit();n.lineCap=a.getLineCap()||Xu,n.lineDash=g?g.slice():ra,n.lineDashOffset=f===void 0?na:f,n.lineJoin=a.getLineJoin()||qu,n.lineWidth=m===void 0?bg:m,n.miterLimit=_===void 0?yg:_,n.strokeStyle=oo(a.getColor()||xg)}i=this.textState_;const l=t.getFont()||oN;Ust(l);const h=t.getScaleArray();i.overflow=t.getOverflow(),i.font=l,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.repeat=t.getRepeat(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||X0,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||ph,i.scale=h===void 0?[1,1]:h;const c=t.getOffsetX(),u=t.getOffsetY(),d=t.getRotateWithView(),p=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=c===void 0?0:c,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=d===void 0?!1:d,this.textRotation_=p===void 0?0:p,this.strokeKey_=n?(typeof n.strokeStyle=="string"?n.strokeStyle:Nt(n.strokeStyle))+n.lineCap+n.lineDashOffset+"|"+n.lineWidth+n.lineJoin+n.miterLimit+"["+n.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=r&&r.fillStyle?typeof r.fillStyle=="string"?r.fillStyle:"|"+Nt(r.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const Klt={Circle:SM,Default:Tf,Image:Vlt,LineString:Wlt,Polygon:SM,Text:Zlt};class Jlt{constructor(t,e,i,r){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=r,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const r in i){const n=i[r].finish();t[e][r]=n}}return t}getBuilder(t,e){const i=t!==void 0?t.toString():"0";let r=this.buildersByZIndex_[i];r===void 0&&(r={},this.buildersByZIndex_[i]=r);let n=r[e];if(n===void 0){const o=Klt[e];n=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),r[e]=n}return n}}const lD=Jlt;class Qlt extends xk{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return Xt()}getData(t){return null}prepareFrame(t){return Xt()}renderFrame(t,e){return Xt()}loadedTileCallback(t,e,i){t[e]||(t[e]={}),t[e][i.tileCoord.toString()]=i}createLoadedTileFinder(t,e,i){return(r,n)=>{const o=this.loadedTileCallback.bind(this,i,r);return t.forEachLoadedTile(e,r,n,o)}}forEachFeatureAtCoordinate(t,e,i,r,n){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===yt.LOADED||e.getState()===yt.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=yt.LOADED&&e!=yt.ERROR&&t.addEventListener(Mt.CHANGE,this.boundHandleImageChange_),e==yt.IDLE&&(t.load(),e=t.getState()),e==yt.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const tht=Qlt;class eht{constructor(){Eet(this,"pushMethodArgs_",(...t)=>(this.instructions_[this.zIndex+this.offset_].push(t),this)),this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(CanvasRenderingContext2D.prototype,{get:(t,e)=>{if(typeof ob()[e]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e),this.pushMethodArgs_},set:(t,e,i)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e,i),!0)})}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let i=0,r=e.length;i<r;i+=2){const n=e[i],o=e[i+1];if(typeof t[n]=="function")t[n](...o);else{if(typeof o=="function"){t[n]=o(t);continue}t[n]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const s2=eht,CM=[];let Lc=null;function iht(){Lc=ws(1,1,void 0,{willReadFrequently:!0})}class sht extends tht{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=cn(),this.pixelTransform=cn(),this.inversePixelTransform=cn(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,i){Lc||iht(),Lc.clearRect(0,0,1,1);let r;try{Lc.drawImage(t,e,i,1,1,0,0,1,1),r=Lc.getImageData(0,0,1,1).data}catch{return Lc=null,null}return r}getBackground(t){let e=this.getLayer().getBackground();return typeof e=="function"&&(e=e(t.viewState.resolution)),e||void 0}useContainer(t,e,i){const r=this.getLayer().getClassName();let n,o;if(t&&t.className===r&&(!i||t&&t.style.backgroundColor&&Ia(Hu(t.style.backgroundColor),Hu(i)))){const a=t.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===e?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){n=document.createElement("div"),n.className=r;let a=n.style;a.position="absolute",a.width="100%",a.height="100%",o=ws();const l=o.canvas;n.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=n,this.context=o}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){const r=Co(i),n=_f(i),o=_d(i),a=Bu(i);ss(e.coordinateToPixelTransform,r),ss(e.coordinateToPixelTransform,n),ss(e.coordinateToPixelTransform,o),ss(e.coordinateToPixelTransform,a);const l=this.inversePixelTransform;ss(l,r),ss(l,n),ss(l,o),ss(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}dispatchRenderEvent_(t,e,i){const r=this.getLayer();if(r.hasListener(t)){const n=new yN(t,this.inversePixelTransform,i,e);r.dispatchEvent(n)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(on.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(on.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new s2),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(on.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(on.POSTRENDER,this.context,t))}getRenderTransform(t,e,i,r,n,o,a){const l=n/2,h=o/2,c=r/e,u=-c,d=-t[0]+a,p=-t[1];return Gn(this.tempTransform,l,h,c,u,-i,d,p)}disposeInternal(){delete this.frameState,super.disposeInternal()}}const r2=sht;function rht(s,t,e,i,r,n,o,a,l,h,c,u){let d=s[t],p=s[t+1],g=0,f=0,m=0,_=0;function y(){g=d,f=p,t+=i,d=s[t],p=s[t+1],_+=m,m=Math.sqrt((d-g)*(d-g)+(p-f)*(p-f))}do y();while(t<e-i&&_+m<n);let v=m===0?0:(n-_)/m;const b=Gr(g,d,v),E=Gr(f,p,v),S=t-i,T=_,R=n+a*l(h,r,c);for(;t<e-i&&_+m<R;)y();v=m===0?0:(R-_)/m;const M=Gr(g,d,v),A=Gr(f,p,v);let O;if(u){const I=[b,E,M,A];gS(I,0,4,2,u,I,I),O=I[0]>I[2]}else O=b>M;const N=Math.PI,x=[],w=S+i===t;t=S,m=0,_=T,d=s[t],p=s[t+1];let C;if(w){y(),C=Math.atan2(p-f,d-g),O&&(C+=C>0?-N:N);const I=(M+b)/2,L=(A+E)/2;return x[0]=[I,L,(R-n)/2,C,r],x}r=r.replace(/\n/g," ");for(let I=0,L=r.length;I<L;){y();let j=Math.atan2(p-f,d-g);if(O&&(j+=j>0?-N:N),C!==void 0){let k=j-C;if(k+=k>N?-2*N:k<-N?2*N:0,Math.abs(k)>o)return null}C=j;const z=I;let B=0;for(;I<L;++I){const k=O?L-I-1:I,it=a*l(h,r[k],c);if(t+i<e&&_+m<n+B+it/2)break;B+=it}if(I===z)continue;const H=O?r.substring(L-z,L-I):r.substring(z,I);v=m===0?0:(n+B/2-_)/m;const Y=Gr(g,d,v),at=Gr(f,p,v);x.push([Y,at,B/2,j,H]),n+=B}return x}const fc=Yr(),Xa=[],$o=[],jo=[],qa=[];function TM(s){return s[3].declutterBox}const RM=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function Cx(s,t){return t==="start"?t=RM.test(s)?"right":"left":t==="end"&&(t=RM.test(s)?"left":"right"),i_[t]}function nht(s,t,e){return e>0&&s.push(`
`,""),s.push(t,""),s}class oht{constructor(t,e,i,r,n){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=r.instructions,this.coordinates=r.coordinates,this.coordinateCache_={},this.renderedTransform_=cn(),this.hitDetectionInstructions=r.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=r.fillStates||{},this.strokeStates=r.strokeStates||{},this.textStates=r.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=n?new s2:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,i,r){const n=t+e+i+r;if(this.labels_[n])return this.labels_[n];const o=r?this.strokeStates[r]:null,a=i?this.fillStates[i]:null,l=this.textStates[e],h=this.pixelRatio,c=[l.scale[0]*h,l.scale[1]*h],u=Array.isArray(t),d=l.justify?i_[l.justify]:Cx(Array.isArray(t)?t[0]:t,l.textAlign||vg),p=r&&o.lineWidth?o.lineWidth:0,g=u?t:t.split(`
`).reduce(nht,[]),{width:f,height:m,widths:_,heights:y,lineWidths:v}=Hst(l,g),b=f+p,E=[],S=(b+2)*c[0],T=(m+p)*c[1],R={width:S<0?Math.floor(S):Math.ceil(S),height:T<0?Math.floor(T):Math.ceil(T),contextInstructions:E};(c[0]!=1||c[1]!=1)&&E.push("scale",c),r&&(E.push("strokeStyle",o.strokeStyle),E.push("lineWidth",p),E.push("lineCap",o.lineCap),E.push("lineJoin",o.lineJoin),E.push("miterLimit",o.miterLimit),E.push("setLineDash",[o.lineDash]),E.push("lineDashOffset",o.lineDashOffset)),i&&E.push("fillStyle",a.fillStyle),E.push("textBaseline","middle"),E.push("textAlign","center");const M=.5-d;let A=d*b+M*p;const O=[],N=[];let x=0,w=0,C=0,I=0,L;for(let j=0,z=g.length;j<z;j+=2){const B=g[j];if(B===`
`){w+=x,x=0,A=d*b+M*p,++I;continue}const H=g[j+1]||l.font;H!==L&&(r&&O.push("font",H),i&&N.push("font",H),L=H),x=Math.max(x,y[C]);const Y=[B,A+M*_[C]+d*(_[C]-v[I]),.5*(p+x)+w];A+=_[C],r&&O.push("strokeText",Y),i&&N.push("fillText",Y),++C}return Array.prototype.push.apply(E,O),Array.prototype.push.apply(E,N),this.labels_[n]=R,R}replayTextBackground_(t,e,i,r,n,o,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,r),t.lineTo.apply(t,n),t.lineTo.apply(t,e),o&&(this.alignAndScaleFill_=o[2],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,r,n,o,a,l,h,c,u,d,p,g,f,m){a*=d[0],l*=d[1];let _=i-a,y=r-l;const v=n+h>t?t-h:n,b=o+c>e?e-c:o,E=g[3]+v*d[0]+g[1],S=g[0]+b*d[1]+g[2],T=_-g[3],R=y-g[0];(f||u!==0)&&(Xa[0]=T,qa[0]=T,Xa[1]=R,$o[1]=R,$o[0]=T+E,jo[0]=$o[0],jo[1]=R+S,qa[1]=jo[1]);let M;return u!==0?(M=Gn(cn(),i,r,1,1,u,-i,-r),ss(M,Xa),ss(M,$o),ss(M,jo),ss(M,qa),fa(Math.min(Xa[0],$o[0],jo[0],qa[0]),Math.min(Xa[1],$o[1],jo[1],qa[1]),Math.max(Xa[0],$o[0],jo[0],qa[0]),Math.max(Xa[1],$o[1],jo[1],qa[1]),fc)):fa(Math.min(T,T+E),Math.min(R,R+S),Math.max(T,T+E),Math.max(R,R+S),fc),p&&(_=Math.round(_),y=Math.round(y)),{drawImageX:_,drawImageY:y,drawImageW:v,drawImageH:b,originX:h,originY:c,declutterBox:{minX:fc[0],minY:fc[1],maxX:fc[2],maxY:fc[3],value:m},canvasTransform:M,scale:d}}replayImageOrLabel_(t,e,i,r,n,o,a){const l=!!(o||a),h=r.declutterBox,c=a?a[2]*r.scale[0]/2:0;return h.minX-c<=e[0]&&h.maxX+c>=0&&h.minY-c<=e[1]&&h.maxY+c>=0&&(l&&this.replayTextBackground_(t,Xa,$o,jo,qa,o,a),Wst(t,r.canvasTransform,n,i,r.originX,r.originY,r.drawImageW,r.drawImageH,r.drawImageX,r.drawImageY,r.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const i=ss(this.renderedTransform_,[0,0]),r=512*this.pixelRatio;t.save(),t.translate(i[0]%r,i[1]%r),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,r){const n=this.textStates[e],o=this.createLabel(t,e,r,i),a=this.strokeStates[i],l=this.pixelRatio,h=Cx(Array.isArray(t)?t[0]:t,n.textAlign||vg),c=i_[n.textBaseline||X0],u=a&&a.lineWidth?a.lineWidth:0,d=o.width/l-2*n.scale[0],p=h*d+2*(.5-h)*u,g=c*o.height/l+2*(.5-c)*u;return{label:o,anchorX:p,anchorY:g}}execute_(t,e,i,r,n,o,a,l){const h=this.zIndexContext_;let c;this.pixelCoordinates_&&Ia(i,this.renderedTransform_)?c=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),c=Sl(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),Bit(this.renderedTransform_,i));let u=0;const d=r.length;let p=0,g,f,m,_,y,v,b,E,S,T,R,M,A,O=0,N=0,x=null,w=null;const C=this.coordinateCache_,I=this.viewRotation_,L=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,j={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:I},z=this.instructions!=r||this.overlaps?0:200;let B,H,Y,at;for(;u<d;){const k=r[u];switch(k[0]){case Gt.BEGIN_GEOMETRY:B=k[1],at=k[3],B.getGeometry()?a!==void 0&&!zi(a,at.getExtent())?u=k[2]+1:++u:u=k[2],h&&(h.zIndex=k[4]);break;case Gt.BEGIN_PATH:O>z&&(this.fill_(t),O=0),N>z&&(t.stroke(),N=0),!O&&!N&&(t.beginPath(),y=NaN,v=NaN),++u;break;case Gt.CIRCLE:p=k[1];const it=c[p],nt=c[p+1],ht=c[p+2],Pt=c[p+3],Ct=ht-it,ft=Pt-nt,me=Math.sqrt(Ct*Ct+ft*ft);t.moveTo(it+me,nt),t.arc(it,nt,me,0,2*Math.PI,!0),++u;break;case Gt.CLOSE_PATH:t.closePath(),++u;break;case Gt.CUSTOM:p=k[1],g=k[2];const pi=k[3],he=k[4],ts=k[5];j.geometry=pi,j.feature=B,u in C||(C[u]=[]);const ve=C[u];ts?ts(c,p,g,2,ve):(ve[0]=c[p],ve[1]=c[p+1],ve.length=2),h&&(h.zIndex=k[6]),he(ve,j),++u;break;case Gt.DRAW_IMAGE:p=k[1],g=k[2],S=k[3],f=k[4],m=k[5];let ns=k[6];const _n=k[7],Mo=k[8],Lr=k[9],yn=k[10];let Je=k[11];const gi=k[12];let bi=k[13];_=k[14]||"declutter";const fi=k[15];if(!S&&k.length>=20){T=k[19],R=k[20],M=k[21],A=k[22];const ni=this.drawLabelWithPointPlacement_(T,R,M,A);S=ni.label,k[3]=S;const ki=k[23];f=(ni.anchorX-ki)*this.pixelRatio,k[4]=f;const ri=k[24];m=(ni.anchorY-ri)*this.pixelRatio,k[5]=m,ns=S.height,k[6]=ns,bi=S.width,k[13]=bi}let Js;k.length>25&&(Js=k[25]);let Qs,os,Ui;k.length>17?(Qs=k[16],os=k[17],Ui=k[18]):(Qs=ph,os=!1,Ui=!1),yn&&L?Je+=I:!yn&&!L&&(Je-=I);let Io=0;for(;p<g;p+=2){if(Js&&Js[Io++]<bi/this.pixelRatio)continue;const ni=this.calculateImageOrLabelDimensions_(S.width,S.height,c[p],c[p+1],bi,ns,f,m,Mo,Lr,Je,gi,n,Qs,os||Ui,B),ki=[t,e,S,ni,_n,os?x:null,Ui?w:null];if(l){let ri,Ci,oi;if(fi){const Bt=g-p;if(!fi[Bt]){fi[Bt]={args:ki,declutterMode:_};continue}const Me=fi[Bt];ri=Me.args,Ci=Me.declutterMode,delete fi[Bt],oi=TM(ri)}let Ni,Vi;if(ri&&(Ci!=="declutter"||!l.collides(oi))&&(Ni=!0),(_!=="declutter"||!l.collides(ni.declutterBox))&&(Vi=!0),Ci==="declutter"&&_==="declutter"){const Bt=Ni&&Vi;Ni=Bt,Vi=Bt}Ni&&(Ci!=="none"&&l.insert(oi),this.replayImageOrLabel_.apply(this,ri)),Vi&&(_!=="none"&&l.insert(ni.declutterBox),this.replayImageOrLabel_.apply(this,ki))}else this.replayImageOrLabel_.apply(this,ki)}++u;break;case Gt.DRAW_CHARS:const Re=k[1],zl=k[2],Ao=k[3],Td=k[4];A=k[5];const Rd=k[6],Bl=k[7],Ul=k[8];M=k[9];const Lo=k[10];T=k[11],R=k[12];const Vl=[k[13],k[13]];_=k[14]||"declutter";const Po=this.textStates[R],Pr=Po.font,Or=[Po.scale[0]*Bl,Po.scale[1]*Bl];let Ds;Pr in this.widths_?Ds=this.widths_[Pr]:(Ds={},this.widths_[Pr]=Ds);const Hl=ON(c,Re,zl,2),Da=Math.abs(Or[0])*eM(Pr,T,Ds);if(Td||Da<=Hl){const ni=this.textStates[R].textAlign,ki=(Hl-Da)*Cx(T,ni),ri=rht(c,Re,zl,2,T,ki,Rd,Math.abs(Or[0]),eM,Pr,Ds,L?0:this.viewRotation_);t:if(ri){const Ci=[];let oi,Ni,Vi,Bt,Me;if(M)for(oi=0,Ni=ri.length;oi<Ni;++oi){Me=ri[oi],Vi=Me[4],Bt=this.createLabel(Vi,R,"",M),f=Me[2]+(Or[0]<0?-Lo:Lo),m=Ao*Bt.height+(.5-Ao)*2*Lo*Or[1]/Or[0]-Ul;const Di=this.calculateImageOrLabelDimensions_(Bt.width,Bt.height,Me[0],Me[1],Bt.width,Bt.height,f,m,0,0,Me[3],Vl,!1,ph,!1,B);if(l&&_==="declutter"&&l.collides(Di.declutterBox))break t;Ci.push([t,e,Bt,Di,1,null,null])}if(A)for(oi=0,Ni=ri.length;oi<Ni;++oi){Me=ri[oi],Vi=Me[4],Bt=this.createLabel(Vi,R,A,""),f=Me[2],m=Ao*Bt.height-Ul;const Di=this.calculateImageOrLabelDimensions_(Bt.width,Bt.height,Me[0],Me[1],Bt.width,Bt.height,f,m,0,0,Me[3],Vl,!1,ph,!1,B);if(l&&_==="declutter"&&l.collides(Di.declutterBox))break t;Ci.push([t,e,Bt,Di,1,null,null])}l&&_!=="none"&&l.load(Ci.map(TM));for(let Di=0,Md=Ci.length;Di<Md;++Di)this.replayImageOrLabel_.apply(this,Ci[Di])}}++u;break;case Gt.END_GEOMETRY:if(o!==void 0){B=k[1];const ni=o(B,at);if(ni)return ni}++u;break;case Gt.FILL:z?O++:this.fill_(t),++u;break;case Gt.MOVE_TO_LINE_TO:for(p=k[1],g=k[2],H=c[p],Y=c[p+1],b=H+.5|0,E=Y+.5|0,(b!==y||E!==v)&&(t.moveTo(H,Y),y=b,v=E),p+=2;p<g;p+=2)H=c[p],Y=c[p+1],b=H+.5|0,E=Y+.5|0,(p==g-2||b!==y||E!==v)&&(t.lineTo(H,Y),y=b,v=E);++u;break;case Gt.SET_FILL_STYLE:x=k,this.alignAndScaleFill_=k[2],O&&(this.fill_(t),O=0,N&&(t.stroke(),N=0)),t.fillStyle=k[1],++u;break;case Gt.SET_STROKE_STYLE:w=k,N&&(t.stroke(),N=0),this.setStrokeStyle_(t,k),++u;break;case Gt.STROKE:z?N++:t.stroke(),++u;break;default:++u;break}}O&&this.fill_(t),N&&t.stroke()}execute(t,e,i,r,n,o){this.viewRotation_=r,this.execute_(t,e,i,this.instructions,n,void 0,void 0,o)}executeHitDetection(t,e,i,r,n){return this.viewRotation_=i,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,r,n)}}const aht=oht,Rp=["Polygon","Circle","LineString","Image","Text","Default"],s_=["Image","Text"],lht=Rp.filter(s=>!s_.includes(s));class hht{constructor(t,e,i,r,n,o,a){this.maxExtent_=t,this.overlaps_=r,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=cn(),this.renderedContext_=null,this.deferredZIndexContexts_=[],this.createExecutors_(n,a)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t,e){for(const i in t){let r=this.executorsByZIndex_[i];r===void 0&&(r={},this.executorsByZIndex_[i]=r);const n=t[i];for(const o in n){const a=n[o];r[o]=new aht(this.resolution_,this.pixelRatio_,this.overlaps_,a,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let r=0,n=t.length;r<n;++r)if(t[r]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,r,n,o){r=Math.round(r);const a=r*2+1,l=Gn(this.hitDetectionTransform_,r+.5,r+.5,1/e,-1/e,-i,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=ws(a,a,void 0,{willReadFrequently:!0}));const c=this.hitDetectionContext_;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):h||c.clearRect(0,0,a,a);let u;this.renderBuffer_!==void 0&&(u=Yr(),wp(u,t),hn(u,e*(this.renderBuffer_+r),u));const d=cht(r);let p;function g(E,S){const T=c.getImageData(0,0,a,a).data;for(let R=0,M=d.length;R<M;R++)if(T[d[R]]>0){if(!o||p!=="Image"&&p!=="Text"||o.includes(E)){const A=(d[R]-3)/4,O=r-A%a,N=r-(A/a|0),x=n(E,S,O*O+N*N);if(x)return x}c.clearRect(0,0,a,a);break}}const f=Object.keys(this.executorsByZIndex_).map(Number);f.sort(ga);let m,_,y,v,b;for(m=f.length-1;m>=0;--m){const E=f[m].toString();for(y=this.executorsByZIndex_[E],_=Rp.length-1;_>=0;--_)if(p=Rp[_],v=y[p],v!==void 0&&(b=v.executeHitDetection(c,l,i,g,u),b))return b}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],r=e[1],n=e[2],o=e[3],a=[i,r,i,o,n,o,n,r];return Sl(a,0,8,2,t,a),a}isEmpty(){return Al(this.executorsByZIndex_)}execute(t,e,i,r,n,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(ga),o=o||Rp;let h,c,u,d,p,g;for(a&&l.reverse(),h=0,c=l.length;h<c;++h){const f=l[h].toString();for(p=this.executorsByZIndex_[f],u=0,d=o.length;u<d;++u){const m=o[u];if(g=p[m],g!==void 0){const _=a===null?void 0:g.getZIndexContext(),y=_?_.getContext():t,v=this.maxExtent_&&m!=="Image"&&m!=="Text";if(v&&(y.save(),this.clip(y,i)),g.execute(y,e,i,r,n,a),v&&y.restore(),_){_.offset();const b=l[h];this.deferredZIndexContexts_[b]||(this.deferredZIndexContexts_[b]=[]),this.deferredZIndexContexts_[b].push(_)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){this.deferredZIndexContexts_.forEach(t=>{t.forEach(e=>{e.draw(this.renderedContext_),e.clear()})})}}const Tx={};function cht(s){if(Tx[s]!==void 0)return Tx[s];const t=s*2+1,e=s*s,i=new Array(e+1);for(let n=0;n<=s;++n)for(let o=0;o<=s;++o){const a=n*n+o*o;if(a>e)break;let l=i[a];l||(l=[],i[a]=l),l.push(((s+n)*t+(s+o))*4+3),n>0&&l.push(((s-n)*t+(s+o))*4+3),o>0&&(l.push(((s+n)*t+(s-o))*4+3),n>0&&l.push(((s-n)*t+(s-o))*4+3))}const r=[];for(let n=0,o=i.length;n<o;++n)i[n]&&r.push(...i[n]);return Tx[s]=r,r}const hD=hht;class uht extends aD{constructor(t,e,i,r,n,o,a){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=r,this.transformRotation_=r?gf(Math.atan2(r[1],r[0]),10):0,this.viewRotation_=n,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=cn()}drawImages_(t,e,i,r){if(!this.image_)return;const n=Sl(t,e,i,r,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,u=n.length;c<u;c+=2){const d=n[c]-this.imageAnchorX_,p=n[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const g=d+this.imageAnchorX_,f=p+this.imageAnchorY_;Gn(a,g,f,1,1,h,-g,-f),o.save(),o.transform.apply(o,a),o.translate(g,f),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,p,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(t,e,i,r){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const n=Sl(t,e,i,r,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);e<i;e+=r){const l=n[e]+this.textOffsetX_,h=n[e+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(t,e,i,r,n){const o=this.context_,a=Sl(t,e,i,r,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;n&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return n&&o.closePath(),i}drawRings_(t,e,i,r){for(let n=0,o=i.length;n<o;++n)e=this.moveToLineTo_(t,e,i[n],r,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!zi(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=Yit(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],r=e[3]-e[1],n=Math.sqrt(i*i+r*r),o=this.context_;o.beginPath(),o.arc(e[0],e[1],n,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,r=e.length;i<r;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!zi(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(zi(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,r=t.getFlatCoordinates();let n=0;const o=t.getEnds(),a=t.getStride();i.beginPath();for(let l=0,h=o.length;l<h;++l)n=this.moveToLineTo_(r,n,o[l],a,!1);i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!zi(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!zi(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let r=0;const n=t.getEndss(),o=t.getStride();e.beginPath();for(let a=0,l=n.length;a<l;++a){const h=n[a];r=this.drawRings_(i,r,h,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),Ia(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,r=t.textAlign?t.textAlign:vg;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=r&&(i.textAlign=r,e.textAlign=r),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=r,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:r,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const i=t.getColor();this.fillState_={fillStyle:oo(i||Er)}}if(!e)this.strokeState_=null;else{const i=e.getColor(),r=e.getLineCap(),n=e.getLineDash(),o=e.getLineDashOffset(),a=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit(),c=n||ra;this.strokeState_={lineCap:r!==void 0?r:Xu,lineDash:this.pixelRatio_===1?c:c.map(u=>u*this.pixelRatio_),lineDashOffset:(o||na)*this.pixelRatio_,lineJoin:a!==void 0?a:qu,lineWidth:(l!==void 0?l:bg)*this.pixelRatio_,miterLimit:h!==void 0?h:yg,strokeStyle:oo(i||xg)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const i=t.getPixelRatio(this.pixelRatio_),r=t.getAnchor(),n=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*i,this.imageAnchorY_=r[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=n[0],this.imageOriginY_=n[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const p=e.getColor();this.textFillState_={fillStyle:oo(p||Er)}}const i=t.getStroke();if(!i)this.textStrokeState_=null;else{const p=i.getColor(),g=i.getLineCap(),f=i.getLineDash(),m=i.getLineDashOffset(),_=i.getLineJoin(),y=i.getWidth(),v=i.getMiterLimit();this.textStrokeState_={lineCap:g!==void 0?g:Xu,lineDash:f||ra,lineDashOffset:m||na,lineJoin:_!==void 0?_:qu,lineWidth:y!==void 0?y:bg,miterLimit:v!==void 0?v:yg,strokeStyle:oo(p||xg)}}const r=t.getFont(),n=t.getOffsetX(),o=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),h=t.getScaleArray(),c=t.getText(),u=t.getTextAlign(),d=t.getTextBaseline();this.textState_={font:r!==void 0?r:oN,textAlign:u!==void 0?u:vg,textBaseline:d!==void 0?d:X0},this.text_=c!==void 0?Array.isArray(c)?c.reduce((p,g,f)=>p+=f%2?" ":g,""):c:"",this.textOffsetX_=n!==void 0?this.pixelRatio_*n:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const dht=uht,Ur=.5;function cD(s,t,e,i,r,n,o,a,l){const h=l?My(r):r,c=s[0]*Ur,u=s[1]*Ur,d=ws(c,u);d.imageSmoothingEnabled=!1;const p=d.canvas,g=new dht(d,Ur,r,null,o,a,l?yf(Oit(),l):null),f=e.length,m=Math.floor((256*256*256-1)/f),_={};for(let v=1;v<=f;++v){const b=e[v-1],E=b.getStyleFunction()||i;if(!E)continue;let S=E(b,n);if(!S)continue;Array.isArray(S)||(S=[S]);const T=(v*m).toString(16).padStart(7,"#00000");for(let R=0,M=S.length;R<M;++R){const A=S[R],O=A.getGeometryFunction()(b);if(!O||!zi(h,O.getExtent()))continue;const N=A.clone(),x=N.getFill();x&&x.setColor(T);const w=N.getStroke();w&&(w.setColor(T),w.setLineDash(null)),N.setText(void 0);const C=A.getImage();if(C){const z=C.getImageSize();if(!z)continue;const B=ws(z[0],z[1],void 0,{alpha:!1}),H=B.canvas;B.fillStyle=T,B.fillRect(0,0,H.width,H.height),N.setImage(new Fy({img:H,anchor:C.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:C.getOrigin(),opacity:1,size:C.getSize(),scale:C.getScale(),rotation:C.getRotation(),rotateWithView:C.getRotateWithView()}))}const I=N.getZIndex()||0;let L=_[I];L||(L={},_[I]=L,L.Polygon=[],L.Circle=[],L.LineString=[],L.Point=[]);const j=O.getType();if(j==="GeometryCollection"){const z=O.getGeometriesArrayRecursive();for(let B=0,H=z.length;B<H;++B){const Y=z[B];L[Y.getType().replace("Multi","")].push(Y,N)}}else L[j.replace("Multi","")].push(O,N)}}const y=Object.keys(_).map(Number).sort(ga);for(let v=0,b=y.length;v<b;++v){const E=_[y[v]];for(const S in E){const T=E[S];for(let R=0,M=T.length;R<M;R+=2){g.setStyle(T[R+1]);for(let A=0,O=t.length;A<O;++A)g.setTransform(t[A]),g.drawGeometry(T[R])}}}return d.getImageData(0,0,p.width,p.height)}function uD(s,t,e){const i=[];if(e){const r=Math.floor(Math.round(s[0])*Ur),n=Math.floor(Math.round(s[1])*Ur),o=(Oi(r,0,e.width-1)+Oi(n,0,e.height-1)*e.width)*4,a=e.data[o],l=e.data[o+1],h=e.data[o+2]+256*(l+256*a),c=Math.floor((256*256*256-1)/t.length);h&&h%c===0&&i.push(t[h/c-1])}return i}const pht=.5,dD={Point:bht,LineString:yht,Polygon:Eht,MultiPoint:wht,MultiLineString:xht,MultiPolygon:vht,GeometryCollection:_ht,Circle:fht};function ght(s,t){return parseInt(Nt(s),10)-parseInt(Nt(t),10)}function Mb(s,t){const e=pD(s,t);return e*e}function pD(s,t){return pht*s/t}function fht(s,t,e,i){const r=e.getFill(),n=e.getStroke();if(r||n){const a=s.getBuilder(e.getZIndex(),"Circle");a.setFillStrokeStyle(r,n),a.drawCircle(t,i)}const o=e.getText();if(o&&o.getText()){const a=s.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i)}}function r_(s,t,e,i,r,n,o,a){const l=[],h=e.getImage();if(h){let d=!0;const p=h.getImageState();p==yt.LOADED||p==yt.ERROR?d=!1:p==yt.IDLE&&h.load(),d&&l.push(h.ready())}const c=e.getFill();c&&c.loading()&&l.push(c.ready());const u=l.length>0;return u&&Promise.all(l).then(()=>r(null)),mht(s,t,e,i,n,o,a),u}function mht(s,t,e,i,r,n,o){const a=e.getGeometryFunction()(t);if(!a)return;const l=a.simplifyTransformed(i,r);if(e.getRenderer())gD(s,l,e,t,o);else{const h=dD[l.getType()];h(s,l,e,t,o,n)}}function gD(s,t,e,i,r){if(t.getType()=="GeometryCollection"){const n=t.getGeometries();for(let o=0,a=n.length;o<a;++o)gD(s,n[o],e,i,r);return}s.getBuilder(e.getZIndex(),"Default").drawCustom(t,i,e.getRenderer(),e.getHitDetectionRenderer(),r)}function _ht(s,t,e,i,r,n){const o=t.getGeometriesArray();let a,l;for(a=0,l=o.length;a<l;++a){const h=dD[o[a].getType()];h(s,o[a],e,i,r,n)}}function yht(s,t,e,i,r){const n=e.getStroke();if(n){const a=s.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,n),a.drawLineString(t,i,r)}const o=e.getText();if(o&&o.getText()){const a=s.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i,r)}}function xht(s,t,e,i,r){const n=e.getStroke();if(n){const a=s.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,n),a.drawMultiLineString(t,i,r)}const o=e.getText();if(o&&o.getText()){const a=s.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i,r)}}function vht(s,t,e,i,r){const n=e.getFill(),o=e.getStroke();if(o||n){const l=s.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(n,o),l.drawMultiPolygon(t,i,r)}const a=e.getText();if(a&&a.getText()){const l=s.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i,r)}}function bht(s,t,e,i,r,n){const o=e.getImage(),a=e.getText(),l=a&&a.getText(),h=n&&o&&l?{}:void 0;if(o){if(o.getImageState()!=yt.LOADED)return;const c=s.getBuilder(e.getZIndex(),"Image");c.setImageStyle(o,h),c.drawPoint(t,i,r)}if(l){const c=s.getBuilder(e.getZIndex(),"Text");c.setTextStyle(a,h),c.drawText(t,i,r)}}function wht(s,t,e,i,r,n){const o=e.getImage(),a=o&&o.getOpacity()!==0,l=e.getText(),h=l&&l.getText(),c=n&&a&&h?{}:void 0;if(a){if(o.getImageState()!=yt.LOADED)return;const u=s.getBuilder(e.getZIndex(),"Image");u.setImageStyle(o,c),u.drawMultiPoint(t,i,r)}if(h){const u=s.getBuilder(e.getZIndex(),"Text");u.setTextStyle(l,c),u.drawText(t,i,r)}}function Eht(s,t,e,i,r){const n=e.getFill(),o=e.getStroke();if(n||o){const l=s.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(n,o),l.drawPolygon(t,i,r)}const a=e.getText();if(a&&a.getText()){const l=s.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i,r)}}class Sht extends r2{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Yr(),this.wrappedRenderedExtent_=Yr(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(t,e,i){const r=e.extent,n=e.viewState,o=n.center,a=n.resolution,l=n.projection,h=n.rotation,c=l.getExtent(),u=this.getLayer().getSource(),d=this.getLayer().getDeclutter(),p=e.pixelRatio,g=e.viewHints,f=!(g[Si.ANIMATING]||g[Si.INTERACTING]),m=this.compositionContext_,_=Math.round(e.size[0]*p),y=Math.round(e.size[1]*p),v=u.getWrapX()&&l.canWrapX(),b=v?Fe(c):null,E=v?Math.ceil((r[2]-c[2])/b)+1:1;let S=v?Math.floor((r[0]-c[0])/b):0;do{const T=this.getRenderTransform(o,a,h,p,_,y,S*b);t.execute(m,[m.canvas.width,m.canvas.height],T,h,f,i===void 0?Rp:i?s_:lht,i?d&&e.declutter[d]:void 0)}while(++S<E)}setupCompositionContext_(){if(this.opacity_!==1){const t=ws(this.context.canvas.width,this.context.canvas.height,CM);this.compositionContext_=t}else this.compositionContext_=this.context}releaseCompositionContext_(){if(this.opacity_!==1){const t=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=t,bf(this.compositionContext_),CM.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(t){this.getLayer().getDeclutter()&&(this.setupCompositionContext_(),this.renderWorlds(this.replayGroup_,t,!0),this.releaseCompositionContext_())}renderDeferredInternal(t){this.replayGroup_.renderDeferred()}renderFrame(t,e){const i=t.pixelRatio,r=t.layerStatesArray[t.layerIndex];Uit(this.pixelTransform,1/i,1/i),Ay(this.inversePixelTransform,this.pixelTransform);const n=pS(this.pixelTransform);this.useContainer(e,n,this.getBackground(t));const o=this.context,a=o.canvas,l=this.replayGroup_;let h=l&&!l.isEmpty();if(!h&&!(this.getLayer().hasListener(on.PRERENDER)||this.getLayer().hasListener(on.POSTRENDER)))return null;const c=Math.round(t.size[0]*i),u=Math.round(t.size[1]*i);a.width!=c||a.height!=u?(a.width=c,a.height=u,a.style.transform!==n&&(a.style.transform=n)):this.containerReused||o.clearRect(0,0,c,u),this.preRender(o,t);const d=t.viewState;d.projection,this.opacity_=r.opacity,this.setupCompositionContext_();let p=!1;if(h&&r.extent&&this.clipping){const g=Pn(r.extent);h=zi(g,t.extent),p=h&&!an(g,t.extent),p&&this.clipUnrotated(this.compositionContext_,t,g)}return h&&this.renderWorlds(l,t,this.getLayer().getDeclutter()?!1:void 0),p&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,t),this.renderedRotation_!==d.rotation&&(this.renderedRotation_=d.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(t){return new Promise(e=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=[this.context.canvas.width,this.context.canvas.height];ss(this.pixelTransform,i);const r=this.renderedCenter_,n=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],u=i[0]*Ur,d=i[1]*Ur;c.push(this.getRenderTransform(r,n,o,Ur,u,d,0).slice());const p=h.getSource(),g=a.getExtent();if(p.getWrapX()&&a.canWrapX()&&!an(g,l)){let f=l[0];const m=Fe(g);let _=0,y;for(;f<g[0];)--_,y=m*_,c.push(this.getRenderTransform(r,n,o,Ur,u,d,y).slice()),f+=m;for(_=0,f=l[2];f>g[2];)++_,y=m*_,c.push(this.getRenderTransform(r,n,o,Ur,u,d,y).slice()),f-=m}this.hitDetectionImageData_=cD(i,c,this.renderedFeatures_,h.getStyleFunction(),l,n,o,Mb(n,this.renderedPixelRatio_),null)}e(uD(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,i,r,n){if(!this.replayGroup_)return;const o=e.viewState.resolution,a=e.viewState.rotation,l=this.getLayer(),h={},c=function(g,f,m){const _=Nt(g),y=h[_];if(y){if(y!==!0&&m<y.distanceSq){if(m===0)return h[_]=!0,n.splice(n.lastIndexOf(y),1),r(g,l,f);y.geometry=f,y.distanceSq=m}}else{if(m===0)return h[_]=!0,r(g,l,f);n.push(h[_]={feature:g,layer:l,geometry:f,distanceSq:m,callback:r})}};let u;const d=[this.replayGroup_],p=this.getLayer().getDeclutter();return d.some(g=>u=g.forEachFeatureAtCoordinate(t,o,a,i,c,p&&e.declutter[p]?e.declutter[p].all().map(f=>f.value):null)),u}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const r=t.viewHints[Si.ANIMATING],n=t.viewHints[Si.INTERACTING],o=e.getUpdateWhileAnimating(),a=e.getUpdateWhileInteracting();if(this.ready&&!o&&r||!a&&n)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=t.extent,h=t.viewState,c=h.projection,u=h.resolution,d=t.pixelRatio,p=e.getRevision(),g=e.getRenderBuffer();let f=e.getRenderOrder();f===void 0&&(f=ght);const m=h.center.slice(),_=hn(l,g*u),y=_.slice(),v=[_.slice()],b=c.getExtent();if(i.getWrapX()&&c.canWrapX()&&!an(b,t.extent)){const w=Fe(b),C=Math.max(Fe(_)/2,w);_[0]=b[0]-C,_[2]=b[2]+C,Ty(m,c);const I=Ck(v[0],c);I[0]<b[0]&&I[2]<b[2]?v.push([I[0]+w,I[1],I[2]+w,I[3]]):I[0]>b[0]&&I[2]>b[2]&&v.push([I[0]-w,I[1],I[2]-w,I[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==p&&this.renderedRenderOrder_==f&&an(this.wrappedRenderedExtent_,_))return Ia(this.renderedExtent_,y)||(this.hitDetectionImageData_=null,this.renderedExtent_=y),this.renderedCenter_=m,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const E=new lD(pD(u,d),_,u,d);let S;for(let w=0,C=v.length;w<C;++w)i.loadFeatures(v[w],u,c);const T=Mb(u,d);let R=!0;const M=(w,C)=>{let I;const L=w.getStyleFunction()||e.getStyleFunction();if(L&&(I=L(w,u)),I){const j=this.renderFeature(w,T,I,E,S,this.getLayer().getDeclutter(),C);R=R&&!j}},A=My(_),O=i.getFeaturesInExtent(A);f&&O.sort(f);for(let w=0,C=O.length;w<C;++w)M(O[w],w);this.renderedFeatures_=O,this.ready=R;const N=E.finish(),x=new hD(_,u,d,i.getOverlaps(),N,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=u,this.renderedRevision_=p,this.renderedRenderOrder_=f,this.renderedExtent_=y,this.wrappedRenderedExtent_=_,this.renderedCenter_=m,this.renderedProjection_=c,this.renderedPixelRatio_=d,this.replayGroup_=x,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,r,n,o,a){if(!i)return!1;let l=!1;if(Array.isArray(i))for(let h=0,c=i.length;h<c;++h)l=r_(r,t,i[h],e,this.boundHandleStyleImageChange_,n,o,a)||l;else l=r_(r,t,i,e,this.boundHandleStyleImageChange_,n,o,a);return l}}const Cht=Sht;class Tht extends zS{constructor(t){super(t)}createRenderer(){return new Cht(this)}}const n2=Tht;class Rht{constructor(t){this.rbush_=new Wk(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[Nt(e)]=i}load(t,e){const i=new Array(e.length);for(let r=0,n=e.length;r<n;r++){const o=t[r],a=e[r],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};i[r]=l,this.items_[Nt(a)]=l}this.rbush_.load(i)}remove(t){const e=Nt(t),i=this.items_[e];return delete this.items_[e],this.rbush_.remove(i)!==null}update(t,e){const i=this.items_[Nt(e)],r=[i.minX,i.minY,i.maxX,i.maxY];Ll(r,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(i){return i.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let r=0,n=t.length;r<n;r++)if(i=e(t[r]),i)return i;return i}isEmpty(){return Al(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return fa(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}const Ib=Rht;class Mht extends Vn{constructor(t){super(),this.projection=si(t.projection),this.attributions_=MM(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(i,r){e.viewResolver=i,e.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=MM(t),this.changed()}setState(t){this.state_=t,this.changed()}}function MM(s){return s?Array.isArray(s)?function(t){return s}:typeof s=="function"?s:function(t){return[s]}:null}const o2=Mht,Nr={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function Iht(s,t){return[[-1/0,-1/0,1/0,1/0]]}let Aht=!1;function fD(s,t,e,i,r,n,o){const a=new XMLHttpRequest;a.open("GET",typeof s=="function"?s(e,i,r):s,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=Aht,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=t.getType();let c;h=="json"?c=JSON.parse(a.responseText):h=="text"?c=a.responseText:h=="xml"?(c=a.responseXML,c||(c=new DOMParser().parseFromString(a.responseText,"application/xml"))):h=="arraybuffer"&&(c=a.response),c?n(t.readFeatures(c,{extent:e,featureProjection:r}),t.readProjection(c)):o()}else o()},a.onerror=o,a.send()}function IM(s,t){return function(e,i,r,n,o){const a=this;fD(s,t,e,i,r,function(l,h){a.addFeatures(l),n!==void 0&&n(l)},o||Gu)}}class Ya extends mn{constructor(t,e,i){super(t),this.feature=e,this.features=i}}class Lht extends o2{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=Gu,this.format_=t.format,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(Te(this.format_,"`format` must be set when `url` is set"),this.loader_=IM(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:Iht;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new Ib:null,this.loadedExtentsRtree_=new Ib,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,r;Array.isArray(t.features)?r=t.features:t.features&&(i=t.features,r=i.getArray()),!e&&i===void 0&&(i=new or(r)),r!==void 0&&this.addFeaturesInternal(r),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=Nt(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const r=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(r,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Ya(Nr.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof Tn||(this.featureChangeKeys_[t]=[ae(e,Mt.CHANGE,this.handleFeatureChange_,this),ae(e,Fh.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let i=!0;if(e.getId()!==void 0){const r=String(e.getId());if(!(r in this.idIndex_))this.idIndex_[r]=e;else if(e instanceof Tn){const n=this.idIndex_[r];n instanceof Tn?Array.isArray(n)?n.push(e):this.idIndex_[r]=[n,e]:i=!1}else i=!1}return i&&(Te(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],r=[];for(let n=0,o=t.length;n<o;n++){const a=t[n],l=Nt(a);this.addToIndex_(l,a)&&i.push(a)}for(let n=0,o=i.length;n<o;n++){const a=i[n],l=Nt(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const c=h.getExtent();e.push(c),r.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(e,r),this.hasListener(Nr.ADDFEATURE))for(let n=0,o=i.length;n<o;n++)this.dispatchEvent(new Ya(Nr.ADDFEATURE,i[n]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(Nr.ADDFEATURE,function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener(Nr.REMOVEFEATURE,function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener(Vs.ADD,i=>{e||(e=!0,this.addFeature(i.element),e=!1)}),t.addEventListener(Vs.REMOVE,i=>{e||(e=!0,this.removeFeature(i.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(ii);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const i=r=>{this.removeFeatureInternal(r)};this.featuresRtree_.forEach(i);for(const r in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[r])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new Ya(Nr.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const i=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(i,function(r){const n=r.getGeometry();if(n instanceof Tn||n.intersectsCoordinate(t))return e(r)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(i){const r=i.getGeometry();if(r instanceof Tn||r.intersectsExtent(t)){const n=e(i);if(n)return n}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Al(this.nullGeometryFeatures_)||qe(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(i){e.push(i)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const i=Eit(t,e);return[].concat(...i.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],r=t[1];let n=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return e=e||ju,this.featuresRtree_.forEachInExtent(l,function(h){if(e(h)){const c=h.getGeometry(),u=a;if(a=c instanceof Tn?0:c.closestPointXY(i,r,o,a),a<u){n=h;const d=Math.sqrt(a);l[0]=i-d,l[1]=r-d,l[2]=i+d,l[3]=r+d}}}),n}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=Nt(e),r=e.getGeometry();if(!r)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);else{const o=r.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(o,e)):this.featuresRtree_&&this.featuresRtree_.update(o,e)}const n=e.getId();if(n!==void 0){const o=n.toString();this.idIndex_[o]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[o]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new Ya(Nr.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:Nt(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Al(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,i){const r=this.loadedExtentsRtree_,n=this.strategy_(t,e,i);for(let o=0,a=n.length;o<a;++o){const l=n[o];r.forEachInExtent(l,function(h){return an(h.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Ya(Nr.FEATURESLOADSTART)),this.loader_.call(this,l,e,i,h=>{--this.loadingExtentsCount_,this.dispatchEvent(new Ya(Nr.FEATURESLOADEND,void 0,h))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Ya(Nr.FEATURESLOADERROR))}),r.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let i;e.forEachInExtent(t,function(r){if(Ll(r.extent,t))return i=r,!0}),i&&e.remove(i)}removeFeature(t){if(!t)return;const e=Nt(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=Nt(t),i=this.featureChangeKeys_[e];if(!i)return;i.forEach(ii),delete this.featureChangeKeys_[e];const r=t.getId();return r!==void 0&&delete this.idIndex_[r.toString()],delete this.uidIndex_[e],this.dispatchEvent(new Ya(Nr.REMOVEFEATURE,t)),t}removeFromIdIndex_(t){let e=!1;for(const i in this.idIndex_){const r=this.idIndex_[i];if(t instanceof Tn&&Array.isArray(r)&&r.includes(t))r.splice(r.indexOf(t),1);else if(this.idIndex_[i]===t){delete this.idIndex_[i],e=!0;break}}return e}setLoader(t){this.loader_=t}setUrl(t){Te(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(IM(t,this.format_))}}const a2=Lht,mD=.5;let Pht=class extends pf{constructor(s,t,e){super(),e=e||{},this.tileCoord=s,this.state=t,this.interimTile=null,this.key="",this.transition_=e.transition===void 0?250:e.transition,this.transitionStarts_={},this.interpolate=!!e.interpolate}changed(){this.dispatchEvent(Mt.CHANGE)}release(){this.state===ot.ERROR&&this.setState(ot.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let s=this.interimTile;if(!s)return this;do{if(s.getState()==ot.LOADED)return this.transition_=0,s;s=s.interimTile}while(s);return this}refreshInterimChain(){let s=this.interimTile;if(!s)return;let t=this;do{if(s.getState()==ot.LOADED){s.interimTile=null;break}s.getState()==ot.LOADING?t=s:s.getState()==ot.IDLE?t.interimTile=s.interimTile:t=s,s=t.interimTile}while(s)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(s){if(this.state!==ot.ERROR&&this.state>s)throw new Error("Tile load sequence violation");this.state=s,this.changed()}load(){Xt()}getAlpha(s,t){if(!this.transition_)return 1;let e=this.transitionStarts_[s];if(!e)e=t,this.transitionStarts_[s]=e;else if(e===-1)return 1;const i=t-e+1e3/60;return i>=this.transition_?1:Lk(i/this.transition_)}inTransition(s){return this.transition_?this.transitionStarts_[s]!==-1:!1}endTransition(s){this.transition_&&(this.transitionStarts_[s]=-1)}};const Vy=Pht,Oht=10,AM=.25;class Fht{constructor(t,e,i,r,n,o){this.sourceProj_=t,this.targetProj_=e;let a={};const l=fg(this.targetProj_,this.sourceProj_);this.transformInv_=function(y){const v=y[0]+"/"+y[1];return a[v]||(a[v]=l(y)),a[v]},this.maxSourceExtent_=r,this.errorThresholdSquared_=n*n,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&Fe(r)>=Fe(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Fe(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Fe(this.targetProj_.getExtent()):null;const h=Co(i),c=_f(i),u=_d(i),d=Bu(i),p=this.transformInv_(h),g=this.transformInv_(c),f=this.transformInv_(u),m=this.transformInv_(d),_=Oht+(o?Math.max(0,Math.ceil(Math.log2(Qv(i)/(o*o*256*256)))):0);if(this.addQuad_(h,c,u,d,p,g,f,m,_),this.wrapsXInSource_){let y=1/0;this.triangles_.forEach(function(v,b,E){y=Math.min(y,v.source[0][0],v.source[1][0],v.source[2][0])}),this.triangles_.forEach(v=>{if(Math.max(v.source[0][0],v.source[1][0],v.source[2][0])-y>this.sourceWorldWidth_/2){const b=[[v.source[0][0],v.source[0][1]],[v.source[1][0],v.source[1][1]],[v.source[2][0],v.source[2][1]]];b[0][0]-y>this.sourceWorldWidth_/2&&(b[0][0]-=this.sourceWorldWidth_),b[1][0]-y>this.sourceWorldWidth_/2&&(b[1][0]-=this.sourceWorldWidth_),b[2][0]-y>this.sourceWorldWidth_/2&&(b[2][0]-=this.sourceWorldWidth_);const E=Math.min(b[0][0],b[1][0],b[2][0]);Math.max(b[0][0],b[1][0],b[2][0])-E<this.sourceWorldWidth_/2&&(v.source=b)}})}a={}}addTriangle_(t,e,i,r,n,o){this.triangles_.push({source:[r,n,o],target:[t,e,i]})}addQuad_(t,e,i,r,n,o,a,l,h){const c=yr([n,o,a,l]),u=this.sourceWorldWidth_?Fe(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,p=this.sourceProj_.canWrapX()&&u>.5&&u<1;let g=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const m=yr([t,e,i,r]);g=Fe(m)/this.targetWorldWidth_>AM||g}!p&&this.sourceProj_.isGlobal()&&u&&(g=u>AM||g)}if(!g&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!zi(c,this.maxSourceExtent_))return;let f=0;if(!g&&(!isFinite(n[0])||!isFinite(n[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)g=!0;else if(f=(!isFinite(n[0])||!isFinite(n[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),f!=1&&f!=2&&f!=4&&f!=8)return}if(h>0){if(!g){const m=[(t[0]+i[0])/2,(t[1]+i[1])/2],_=this.transformInv_(m);let y;p?y=(Eh(n[0],d)+Eh(a[0],d))/2-Eh(_[0],d):y=(n[0]+a[0])/2-_[0];const v=(n[1]+a[1])/2-_[1];g=y*y+v*v>this.errorThresholdSquared_}if(g){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const m=[(e[0]+i[0])/2,(e[1]+i[1])/2],_=this.transformInv_(m),y=[(r[0]+t[0])/2,(r[1]+t[1])/2],v=this.transformInv_(y);this.addQuad_(t,e,m,y,n,o,_,v,h-1),this.addQuad_(y,m,i,r,v,_,a,l,h-1)}else{const m=[(t[0]+e[0])/2,(t[1]+e[1])/2],_=this.transformInv_(m),y=[(i[0]+r[0])/2,(i[1]+r[1])/2],v=this.transformInv_(y);this.addQuad_(t,m,y,r,n,_,v,l,h-1),this.addQuad_(m,e,i,y,_,o,a,v,h-1)}return}}if(p){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}f&11||this.addTriangle_(t,i,r,n,a,l),f&14||this.addTriangle_(t,i,e,n,a,o),f&&(f&13||this.addTriangle_(e,r,t,o,l,n),f&7||this.addTriangle_(e,r,i,o,l,a))}calculateSourceExtent(){const t=Yr();return this.triangles_.forEach(function(e,i,r){const n=e.source;wp(t,n[0]),wp(t,n[1]),wp(t,n[2])}),t}getTriangles(){return this.triangles_}}const _D=Fht;let Rx;const yu=[];function LM(s,t,e,i,r){s.beginPath(),s.moveTo(0,0),s.lineTo(t,e),s.lineTo(i,r),s.closePath(),s.save(),s.clip(),s.fillRect(0,0,Math.max(t,i)+1,Math.max(e,r)),s.restore()}function Mx(s,t){return Math.abs(s[t*4]-210)>2||Math.abs(s[t*4+3]-.75*255)>2}function kht(){if(Rx===void 0){const s=ws(6,6,yu);s.globalCompositeOperation="lighter",s.fillStyle="rgba(210, 0, 0, 0.75)",LM(s,4,5,4,0),LM(s,4,5,0,5);const t=s.getImageData(0,0,3,3).data;Rx=Mx(t,0)||Mx(t,4)||Mx(t,8),bf(s),yu.push(s.canvas)}return Rx}function Cg(s,t,e,i){const r=Ry(e,t,s);let n=z0(t,i,e);const o=t.getMetersPerUnit();o!==void 0&&(n*=o);const a=s.getMetersPerUnit();a!==void 0&&(n/=a);const l=s.getExtent();if(!l||kh(l,r)){const h=z0(s,n,r)/n;isFinite(h)&&h>0&&(n/=h)}return n}function Nht(s,t,e,i){const r=xo(e);let n=Cg(s,t,r,i);return(!isFinite(n)||n<=0)&&iS(e,function(o){return n=Cg(s,t,o,i),isFinite(n)&&n>0}),n}function yD(s,t,e,i,r,n,o,a,l,h,c,u,d,p){const g=ws(Math.round(e*s),Math.round(e*t),yu);if(u||(g.imageSmoothingEnabled=!1),l.length===0)return g.canvas;g.scale(e,e);function f(E){return Math.round(E*e)/e}g.globalCompositeOperation="lighter";const m=Yr();l.forEach(function(E,S,T){Ek(m,E.extent)});let _;const y=e/i,v=(u?1:1+Math.pow(2,-24))/y;if(!d||l.length!==1||h!==0){if(_=ws(Math.round(Fe(m)*y),Math.round(hs(m)*y),yu),u||(_.imageSmoothingEnabled=!1),r&&p){const E=(r[0]-m[0])*y,S=-(r[3]-m[3])*y,T=Fe(r)*y,R=hs(r)*y;_.rect(E,S,T,R),_.clip()}l.forEach(function(E,S,T){const R=(E.extent[0]-m[0])*y,M=-(E.extent[3]-m[3])*y,A=Fe(E.extent)*y,O=hs(E.extent)*y;E.image.width>0&&E.image.height>0&&_.drawImage(E.image,h,h,E.image.width-2*h,E.image.height-2*h,u?R:Math.round(R),u?M:Math.round(M),u?A:Math.round(R+A)-Math.round(R),u?O:Math.round(M+O)-Math.round(M))})}const b=Co(o);return a.getTriangles().forEach(function(E,S,T){const R=E.source,M=E.target;let A=R[0][0],O=R[0][1],N=R[1][0],x=R[1][1],w=R[2][0],C=R[2][1];const I=f((M[0][0]-b[0])/n),L=f(-(M[0][1]-b[1])/n),j=f((M[1][0]-b[0])/n),z=f(-(M[1][1]-b[1])/n),B=f((M[2][0]-b[0])/n),H=f(-(M[2][1]-b[1])/n),Y=A,at=O;A=0,O=0,N-=Y,x-=at,w-=Y,C-=at;const k=[[N,x,0,0,j-I],[w,C,0,0,B-I],[0,0,N,x,z-L],[0,0,w,C,H-L]],it=oit(k);if(!it)return;if(g.save(),g.beginPath(),kht()||!u){g.moveTo(j,z);const ht=4,Pt=I-j,Ct=L-z;for(let ft=0;ft<ht;ft++)g.lineTo(j+f((ft+1)*Pt/ht),z+f(ft*Ct/(ht-1))),ft!=ht-1&&g.lineTo(j+f((ft+1)*Pt/ht),z+f((ft+1)*Ct/(ht-1)));g.lineTo(B,H)}else g.moveTo(j,z),g.lineTo(I,L),g.lineTo(B,H);g.clip(),g.transform(it[0],it[2],it[1],it[3],I,L),g.translate(m[0]-Y,m[3]-at);let nt;if(_)nt=_.canvas,g.scale(v,-v);else{const ht=l[0],Pt=ht.extent;nt=ht.image,g.scale(Fe(Pt)/nt.width,-hs(Pt)/nt.height)}g.drawImage(nt,0,0),g.restore()}),_&&(bf(_),yu.push(_.canvas)),c&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,a.getTriangles().forEach(function(E,S,T){const R=E.target,M=(R[0][0]-b[0])/n,A=-(R[0][1]-b[1])/n,O=(R[1][0]-b[0])/n,N=-(R[1][1]-b[1])/n,x=(R[2][0]-b[0])/n,w=-(R[2][1]-b[1])/n;g.beginPath(),g.moveTo(O,N),g.lineTo(M,A),g.lineTo(x,w),g.closePath(),g.stroke()}),g.restore()),g.canvas}class Dht extends Vy{constructor(t,e,i,r,n,o,a,l,h,c,u,d){super(n,ot.IDLE,d),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=r,this.wrappedTileCoord_=o||n,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const p=r.getTileCoordExtent(this.wrappedTileCoord_),g=this.targetTileGrid_.getExtent();let f=this.sourceTileGrid_.getExtent();const m=g?sa(p,g):p;if(Qv(m)===0){this.state=ot.EMPTY;return}const _=t.getExtent();_&&(f?f=sa(f,_):f=_);const y=r.getResolution(this.wrappedTileCoord_[0]),v=Nht(t,i,m,y);if(!isFinite(v)||v<=0){this.state=ot.EMPTY;return}const b=c!==void 0?c:mD;if(this.triangulation_=new _D(t,i,m,f,v*b,y),this.triangulation_.getTriangles().length===0){this.state=ot.EMPTY;return}this.sourceZ_=e.getZForResolution(v);let E=this.triangulation_.calculateSourceExtent();if(f&&(t.canWrapX()?(E[1]=Oi(E[1],f[1],f[3]),E[3]=Oi(E[3],f[1],f[3])):E=sa(E,f)),!Qv(E))this.state=ot.EMPTY;else{const S=e.getTileRangeForExtentAndZ(E,this.sourceZ_);for(let T=S.minX;T<=S.maxX;T++)for(let R=S.minY;R<=S.maxY;R++){const M=h(this.sourceZ_,T,R,a);M&&this.sourceTiles_.push(M)}this.sourceTiles_.length===0&&(this.state=ot.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{e&&e.getState()==ot.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}),this.sourceTiles_.length=0,t.length===0)this.state=ot.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),r=typeof i=="number"?i:i[0],n=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=yD(r,n,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=ot.LOADED}this.changed()}load(){if(this.state==ot.IDLE){this.state=ot.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(e=>{const i=e.getState();if(i==ot.IDLE||i==ot.LOADING){t++;const r=ae(e,Mt.CHANGE,function(n){const o=e.getState();(o==ot.LOADED||o==ot.ERROR||o==ot.EMPTY)&&(ii(r),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,i,r){e.getState()==ot.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(ii),this.sourcesListenerKeys_=null}release(){this.canvas_&&(bf(this.canvas_.getContext("2d")),yu.push(this.canvas_),this.canvas_=null),super.release()}}const Ab=Dht;class $ht extends Vy{constructor(t,e,i,r,n,o){super(t,e,o),this.crossOrigin_=r,this.src_=i,this.key=i,this.image_=new Image,r!==null&&(this.image_.crossOrigin=r),this.unlisten_=null,this.tileLoadFunction_=n}getImage(){return this.image_}setImage(t){this.image_=t,this.state=ot.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=ot.ERROR,this.unlistenImage_(),this.image_=jht(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=ot.LOADED:this.state=ot.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==ot.ERROR&&(this.state=ot.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==ot.IDLE&&(this.state=ot.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Nst(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function jht(){const s=ws(1,1);return s.fillStyle="rgba(0,0,0,0)",s.fillRect(0,0,1,1),s.canvas}const xD=$ht;class Ght{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const i=this.entries_[t];return Te(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(t){const e=this.entries_[t];return Te(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.key_;return t}getValues(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){var e;return(e=this.entries_[t])==null?void 0:e.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){Te(!(t in this.entries_),"Tried to set a value for a key that is used already");const i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}setSize(t){this.highWaterMark=t}}const zht=Ght;class vD{constructor(t,e,i,r){this.minX=t,this.maxX=e,this.minY=i,this.maxY=r}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function mc(s,t,e,i,r){return r!==void 0?(r.minX=s,r.maxX=t,r.minY=e,r.maxY=i,r):new vD(s,t,e,i)}const bD=vD;function PM(s,t,e,i){return i!==void 0?(i[0]=s,i[1]=t,i[2]=e,i):[s,t,e]}function Sd(s,t,e){return s+"/"+t+"/"+e}function wD(s){return Sd(s[0],s[1],s[2])}function Bht(s){const[t,e,i]=s.substring(s.lastIndexOf("/")+1,s.length).split(",").map(Number);return Sd(t,e,i)}function ED(s){return s.split("/").map(Number)}function SD(s){return(s[1]<<s[0])+s[2]}function Uht(s,t){const e=s[0],i=s[1],r=s[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const n=t.getFullTileRange(e);return n?n.containsXY(i,r):!0}class Vht extends vf{constructor(t){t=t||{},super(t)}}const Hht=Vht;class Wht extends r2{constructor(t){super(t),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(t){const e=t.layerStatesArray[t.layerIndex],i=t.pixelRatio,r=t.viewState,n=r.resolution,o=this.getLayer().getSource(),a=t.viewHints;let l=t.extent;if(e.extent!==void 0&&(l=sa(l,Pn(e.extent,r.projection))),!a[Si.ANIMATING]&&!a[Si.INTERACTING]&&!yd(l))if(o){const h=r.projection,c=o.getImage(l,n,i,h);c&&(this.loadImage(c)?this.image_=c:c.getState()===yt.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),r=ss(e.pixelToCoordinateTransform,t.slice()),n=i.getExtent();if(n&&!kh(n,r))return null;const o=this.image_.getExtent(),a=this.image_.getImage(),l=Fe(o),h=Math.floor(a.width*((r[0]-o[0])/l));if(h<0||h>=a.width)return null;const c=hs(o),u=Math.floor(a.height*((o[3]-r[1])/c));return u<0||u>=a.height?null:this.getImageData(a,h,u)}renderFrame(t,e){const i=this.image_,r=i.getExtent(),n=i.getResolution(),[o,a]=Array.isArray(n)?n:[n,n],l=i.getPixelRatio(),h=t.layerStatesArray[t.layerIndex],c=t.pixelRatio,u=t.viewState,d=u.center,p=u.resolution,g=c*o/(p*l),f=c*a/(p*l),m=t.extent,_=u.resolution,y=u.rotation,v=Math.round(Fe(m)/_*c),b=Math.round(hs(m)/_*c);Gn(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/c,1/c,y,-v/2,-b/2),Ay(this.inversePixelTransform,this.pixelTransform);const E=pS(this.pixelTransform);this.useContainer(e,E,this.getBackground(t));const S=this.getRenderContext(t),T=this.context.canvas;T.width!=v||T.height!=b?(T.width=v,T.height=b):this.containerReused||S.clearRect(0,0,v,b);let R=!1,M=!0;if(h.extent){const w=Pn(h.extent,u.projection);M=zi(w,t.extent),R=M&&!an(w,t.extent),R&&this.clipUnrotated(S,t,w)}const A=i.getImage(),O=Gn(this.tempTransform,v/2,b/2,g,f,0,l*(r[0]-d[0])/o,l*(d[1]-r[3])/a);this.renderedResolution=a*c/l;const N=A.width*O[0],x=A.height*O[3];if(this.getLayer().getSource().getInterpolate()||(S.imageSmoothingEnabled=!1),this.preRender(S,t),M&&N>=.5&&x>=.5){const w=O[4],C=O[5],I=h.opacity;I!==1&&(S.save(),S.globalAlpha=I),S.drawImage(A,0,0,+A.width,+A.height,w,C,N,x),I!==1&&S.restore()}return this.postRender(this.context,t),R&&S.restore(),S.imageSmoothingEnabled=!0,E!==T.style.transform&&(T.style.transform=E),this.container}}const Xht=Wht;class qht extends Hht{constructor(t){super(t)}createRenderer(){return new Xht(this)}getData(t){return super.getData(t)}}const Yht=qht,yl={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class Zht extends vf{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getPreload(){return this.get(yl.PRELOAD)}setPreload(t){this.set(yl.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(yl.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(yl.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}const Kht=Zht;class Jht extends r2{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=Yr(),this.tmpTileRange_=new bD(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),i=t.getState(),r=e.getUseInterimTilesOnError();return i==ot.LOADED||i==ot.EMPTY||i==ot.ERROR&&!r}getTile(t,e,i,r){const n=r.pixelRatio,o=r.viewState.projection,a=this.getLayer();let l=a.getSource().getTile(t,e,i,n,o);return l.getState()==ot.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(l)||(l=l.getInterimTile()),l}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),r=ss(e.pixelToCoordinateTransform,t.slice()),n=i.getExtent();if(n&&!kh(n,r))return null;const o=e.pixelRatio,a=e.viewState.projection,l=e.viewState,h=i.getRenderSource(),c=h.getTileGridForProjection(l.projection),u=h.getTilePixelRatio(e.pixelRatio);for(let d=c.getZForResolution(l.resolution);d>=c.getMinZoom();--d){const p=c.getTileCoordForCoordAndZ(r,d),g=h.getTile(d,p[1],p[2],o,a);if(!(g instanceof xD||g instanceof Ab)||g instanceof Ab&&g.getState()===ot.EMPTY)return null;if(g.getState()!==ot.LOADED)continue;const f=c.getOrigin(d),m=ar(c.getTileSize(d)),_=c.getResolution(d),y=Math.floor(u*((r[0]-f[0])/_-p[1]*m[0])),v=Math.floor(u*((f[1]-r[1])/_-p[2]*m[1])),b=Math.round(u*h.getGutterForProjection(l.projection));return this.getImageData(g.getImage(),y+b,v+b)}return null}loadedTileCallback(t,e,i){return this.isDrawableTile(i)?super.loadedTileCallback(t,e,i):!1}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex],r=t.viewState,n=r.projection,o=r.resolution,a=r.center,l=r.rotation,h=t.pixelRatio,c=this.getLayer(),u=c.getSource(),d=u.getRevision(),p=u.getTileGridForProjection(n),g=p.getZForResolution(o,u.zDirection),f=p.getResolution(g);let m=t.extent;const _=t.viewState.resolution,y=u.getTilePixelRatio(h),v=Math.round(Fe(m)/_*h),b=Math.round(hs(m)/_*h),E=i.extent&&Pn(i.extent);E&&(m=sa(m,Pn(i.extent)));const S=f*v/2/y,T=f*b/2/y,R=[a[0]-S,a[1]-T,a[0]+S,a[1]+T],M=p.getTileRangeForExtentAndZ(m,g),A={};A[g]={};const O=this.createLoadedTileFinder(u,n,A),N=this.tmpExtent,x=this.tmpTileRange_;this.newTiles_=!1;const w=l?tb(r.center,_,l,t.size):void 0;for(let at=M.minX;at<=M.maxX;++at)for(let k=M.minY;k<=M.maxY;++k){if(l&&!p.tileCoordIntersectsViewport([g,at,k],w))continue;const it=this.getTile(g,at,k,t);if(this.isDrawableTile(it)){const Pt=Nt(this);if(it.getState()==ot.LOADED){A[g][it.tileCoord.toString()]=it;let Ct=it.inTransition(Pt);Ct&&i.opacity!==1&&(it.endTransition(Pt),Ct=!1),!this.newTiles_&&(Ct||!this.renderedTiles.includes(it))&&(this.newTiles_=!0)}if(it.getAlpha(Pt,t.time)===1)continue}const nt=p.getTileCoordChildTileRange(it.tileCoord,x,N);let ht=!1;nt&&(ht=O(g+1,nt)),ht||p.forEachTileCoordParentTileRange(it.tileCoord,O,x,N)}const C=f/o*h/y;Gn(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/h,1/h,l,-v/2,-b/2);const I=pS(this.pixelTransform);this.useContainer(e,I,this.getBackground(t));const L=this.getRenderContext(t),j=this.context.canvas;Ay(this.inversePixelTransform,this.pixelTransform),Gn(this.tempTransform,v/2,b/2,C,C,0,-v/2,-b/2),j.width!=v||j.height!=b?(j.width=v,j.height=b):this.containerReused||L.clearRect(0,0,v,b),E&&this.clipUnrotated(L,t,E),u.getInterpolate()||(L.imageSmoothingEnabled=!1),this.preRender(L,t),this.renderedTiles.length=0;let z=Object.keys(A).map(Number);z.sort(ga);let B,H,Y;i.opacity===1&&(!this.containerReused||u.getOpaque(t.viewState.projection))?z=z.reverse():(B=[],H=[]);for(let at=z.length-1;at>=0;--at){const k=z[at],it=u.getTilePixelSize(k,h,n),nt=p.getResolution(k)/f,ht=it[0]*nt*C,Pt=it[1]*nt*C,Ct=p.getTileCoordForCoordAndZ(Co(R),k),ft=p.getTileCoordExtent(Ct),me=ss(this.tempTransform,[y*(ft[0]-R[0])/f,y*(R[3]-ft[3])/f]),pi=y*u.getGutterForProjection(n),he=A[k];for(const ts in he){const ve=he[ts],ns=ve.tileCoord,_n=Ct[1]-ns[1],Mo=Math.round(me[0]-(_n-1)*ht),Lr=Ct[2]-ns[2],yn=Math.round(me[1]-(Lr-1)*Pt),Je=Math.round(me[0]-_n*ht),gi=Math.round(me[1]-Lr*Pt),bi=Mo-Je,fi=yn-gi,Js=g===k,Qs=Js&&ve.getAlpha(Nt(this),t.time)!==1;let os=!1;if(!Qs)if(B){Y=[Je,gi,Je+bi,gi,Je+bi,gi+fi,Je,gi+fi];for(let Ui=0,Io=B.length;Ui<Io;++Ui)if(g!==k&&k<H[Ui]){const Re=B[Ui];zi([Je,gi,Je+bi,gi+fi],[Re[0],Re[3],Re[4],Re[7]])&&(os||(L.save(),os=!0),L.beginPath(),L.moveTo(Y[0],Y[1]),L.lineTo(Y[2],Y[3]),L.lineTo(Y[4],Y[5]),L.lineTo(Y[6],Y[7]),L.moveTo(Re[6],Re[7]),L.lineTo(Re[4],Re[5]),L.lineTo(Re[2],Re[3]),L.lineTo(Re[0],Re[1]),L.clip())}B.push(Y),H.push(k)}else L.clearRect(Je,gi,bi,fi);this.drawTileImage(ve,t,Je,gi,bi,fi,pi,Js),B&&!Qs?(os&&L.restore(),this.renderedTiles.unshift(ve)):this.renderedTiles.push(ve),this.updateUsedTiles(t.usedTiles,u,ve)}}return this.renderedRevision=d,this.renderedResolution=f,this.extentChanged=!this.renderedExtent_||!Ll(this.renderedExtent_,R),this.renderedExtent_=R,this.renderedPixelRatio=h,this.renderedProjection=n,this.manageTilePyramid(t,u,p,h,n,m,g,c.getPreload()),this.scheduleExpireCache(t,u),this.postRender(this.context,t),i.extent&&L.restore(),L.imageSmoothingEnabled=!0,I!==j.style.transform&&(j.style.transform=I),this.container}drawTileImage(t,e,i,r,n,o,a,l){const h=this.getTileImage(t);if(!h)return;const c=this.getRenderContext(e),u=Nt(this),d=e.layerStatesArray[e.layerIndex],p=d.opacity*(l?t.getAlpha(u,e.time):1),g=p!==c.globalAlpha;g&&(c.save(),c.globalAlpha=p),c.drawImage(h,a,a,h.width-2*a,h.height-2*a,i,r,n,o),g&&c.restore(),p!==d.opacity?e.animate=!0:l&&t.endTransition(u)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const i=(function(r,n,o){const a=Nt(r);a in o.usedTiles&&r.expireCache(o.viewState.projection,o.usedTiles[a])}).bind(null,e);t.postRenderFunctions.push(i)}}updateUsedTiles(t,e,i){const r=Nt(e);r in t||(t[r]={}),t[r][i.getKey()]=!0}manageTilePyramid(t,e,i,r,n,o,a,l,h){const c=Nt(e);c in t.wantedTiles||(t.wantedTiles[c]={});const u=t.wantedTiles[c],d=t.tileQueue,p=i.getMinZoom(),g=t.viewState.rotation,f=g?tb(t.viewState.center,t.viewState.resolution,g,t.size):void 0;let m=0,_,y,v,b,E,S;for(S=p;S<=a;++S)for(y=i.getTileRangeForExtentAndZ(o,S,y),v=i.getResolution(S),b=y.minX;b<=y.maxX;++b)for(E=y.minY;E<=y.maxY;++E)g&&!i.tileCoordIntersectsViewport([S,b,E],f)||(a-S<=l?(++m,_=e.getTile(S,b,E,r,n),_.getState()==ot.IDLE&&(u[_.getKey()]=!0,d.isKeyQueued(_.getKey())||d.enqueue([_,c,i.getTileCoordCenter(_.tileCoord),v])),h!==void 0&&h(_)):e.useTile(S,b,E,n));e.updateCacheSize(m,n)}}const CD=Jht;class Qht extends Kht{constructor(t){super(t)}createRenderer(){return new CD(this)}}const tct=Qht;function Lb(s){return Array.isArray(s)?Math.min(...s):s}const ect={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},OM={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class ict extends CD{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=cn(),this.tileClipContexts_=null}prepareTile(t,e,i){let r;const n=t.getState();return(n===ot.LOADED||n===ot.ERROR)&&(this.updateExecutorGroup_(t,e,i),this.tileImageNeedsRender_(t)&&(r=!0)),r}getTile(t,e,i,r){const n=r.pixelRatio,o=r.viewState,a=o.resolution,l=o.projection,h=this.getLayer(),c=h.getSource().getTile(t,e,i,n,l),u=r.viewHints,d=!(u[Si.ANIMATING]||u[Si.INTERACTING]);return(d||!c.wantedResolution)&&(c.wantedResolution=a),this.prepareTile(c,n,l)&&(d||Date.now()-r.time<8)&&h.getRenderMode()!=="vector"&&this.renderTileImage_(c,r),super.getTile(t,e,i,r)}isDrawableTile(t){const e=this.getLayer();return super.isDrawableTile(t)&&(e.getRenderMode()==="vector"?Nt(e)in t.executorGroups:t.hasContext(e))}getTileImage(t){return t.getImage(this.getLayer())}prepareFrame(t){const e=this.getLayer().getRevision();return this.renderedLayerRevision_!==e&&(this.renderedLayerRevision_=e,this.renderedTiles.length=0),super.prepareFrame(t)}updateExecutorGroup_(t,e,i){var r;const n=this.getLayer(),o=n.getRevision(),a=n.getRenderOrder()||null,l=t.wantedResolution,h=t.getReplayState(n);if(!h.dirty&&h.renderedResolution===l&&h.renderedRevision==o&&h.renderedRenderOrder==a)return;const c=n.getSource(),u=!!n.getDeclutter(),d=c.getTileGrid(),p=c.getTileGridForProjection(i).getTileCoordExtent(t.wrappedTileCoord),g=c.getSourceTiles(e,i,t),f=Nt(n);delete t.hitDetectionImageData[f],t.executorGroups[f]=[],h.dirty=!1;for(let m=0,_=g.length;m<_;++m){const y=g[m];if(y.getState()!=ot.LOADED)continue;const v=y.tileCoord,b=d.getTileCoordExtent(v),E=sa(p,b),S=hn(E,n.getRenderBuffer()*l,this.tmpExtent),T=Ll(b,E)?null:S,R=new lD(0,E,l,e),M=Mb(l,e),A=function(C,I){let L;const j=C.getStyleFunction()||n.getStyleFunction();if(j&&(L=j(C,l)),L){const z=this.renderFeature(C,M,L,R,u,I);h.dirty=h.dirty||z}},O=y.getFeatures();a&&a!==h.renderedRenderOrder&&O.sort(a);for(let C=0,I=O.length;C<I;++C){const L=O[C];(!T||zi(T,L.getGeometry().getExtent()))&&A.call(this,L,C)}const N=R.finish(),x=n.getRenderMode()!=="vector"&&u&&g.length===1?null:E,w=new hD(x,l,e,c.getOverlaps(),N,n.getRenderBuffer(),!!((r=this.frameState)!=null&&r.declutter));t.executorGroups[f].push(w)}h.renderedRevision=o,h.renderedRenderOrder=a,h.renderedResolution=l}forEachFeatureAtCoordinate(t,e,i,r,n){const o=e.viewState.resolution,a=e.viewState.rotation;i=i??0;const l=this.getLayer(),h=l.getSource().getTileGridForProjection(e.viewState.projection),c=yr([t]);hn(c,o*i,c);const u={},d=function(f,m,_){let y=f.getId();y===void 0&&(y=Nt(f));const v=u[y];if(v){if(v!==!0&&_<v.distanceSq){if(_===0)return u[y]=!0,n.splice(n.lastIndexOf(v),1),r(f,l,m);v.geometry=m,v.distanceSq=_}}else{if(_===0)return u[y]=!0,r(f,l,m);n.push(u[y]={feature:f,layer:l,geometry:m,distanceSq:_,callback:r})}},p=this.renderedTiles;let g;for(let f=0,m=p.length;!g&&f<m;++f){const _=p[f],y=h.getTileCoordExtent(_.wrappedTileCoord);if(!zi(y,c))continue;const v=Nt(l),b=[_.executorGroups[v]],E=l.getDeclutter();b.some(S=>{const T=E?e.declutter[E].all().map(R=>R.value):null;for(let R=0,M=S.length;R<M;++R)if(g=S[R].forEachFeatureAtCoordinate(t,o,a,i,d,T),g)return!0})}return g}getFeatures(t){return new Promise((e,i)=>{const r=this.getLayer(),n=Nt(r),o=r.getSource(),a=this.renderedProjection,l=a.getExtent(),h=this.renderedResolution,c=o.getTileGridForProjection(a),u=ss(this.renderedPixelToCoordinateTransform_,t.slice()),d=c.getTileCoordForCoordAndResolution(u,h);let p;for(let v=0,b=this.renderedTiles.length;v<b;++v)if(d.toString()===this.renderedTiles[v].tileCoord.toString()){if(p=this.renderedTiles[v],p.getState()===ot.LOADED){const E=c.getTileCoordExtent(p.tileCoord);o.getWrapX()&&a.canWrapX()&&!an(l,E)&&Ty(u,a);break}p=void 0}if(!p||p.loadingSourceTiles>0){e([]);return}const g=c.getTileCoordExtent(p.wrappedTileCoord),f=Co(g),m=[(u[0]-f[0])/h,(f[1]-u[1])/h],_=p.getSourceTiles().reduce(function(v,b){return v.concat(b.getFeatures())},[]);let y=p.hitDetectionImageData[n];if(!y){const v=ar(c.getTileSize(c.getZForResolution(h,o.zDirection))),b=this.renderedRotation_,E=[this.getRenderTransform(c.getTileCoordCenter(p.wrappedTileCoord),h,0,Ur,v[0]*Ur,v[1]*Ur,0)];y=cD(v,E,_,r.getStyleFunction(),c.getTileCoordExtent(p.wrappedTileCoord),p.getReplayState(r).renderedResolution,b),p.hitDetectionImageData[n]=y}e(uD(m,_,y))})}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.renderedLayerRevision_!==void 0&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}renderDeclutter(t,e){const i=this.context,r=i.globalAlpha;i.globalAlpha=e.opacity;const n=t.viewHints,o=!(n[Si.ANIMATING]||n[Si.INTERACTING]),a=this.renderedTiles;for(let l=0,h=a.length;l<h;++l){const c=a[l],u=c.executorGroups[Nt(this.getLayer())],d=this.getLayer().getDeclutter();if(u)for(let p=u.length-1;p>=0;--p)u[p].execute(this.context,[this.context.canvas.width,this.context.canvas.height],this.getTileRenderTransform(c,t),t.viewState.rotation,o,s_,d?t.declutter[d]:void 0)}i.globalAlpha=r}renderDeferredInternal(t){const e=this.renderedTiles.reduce((r,n,o)=>(n.executorGroups[Nt(this.getLayer())].forEach(a=>r.push({executorGroup:a,index:o})),r),[]),i=e.map(({executorGroup:r})=>r.getDeferredZIndexContexts());i.map(r=>Object.keys(r)).flat().sort(ga).map(Number).forEach(r=>{i.forEach((n,o)=>{n[r]&&n[r].forEach(a=>{const{executorGroup:l,index:h}=e[o],c=l.getRenderedContext(),u=c.globalAlpha;c.globalAlpha=this.renderedOpacity_;const d=this.tileClipContexts_[h];d&&d.draw(c),a.draw(c),d&&c.restore(),c.globalAlpha=u,a.clear()})})})}getTileRenderTransform(t,e){const i=e.pixelRatio,r=e.viewState,n=r.center,o=r.resolution,a=r.rotation,l=e.size,h=Math.round(l[0]*i),c=Math.round(l[1]*i),u=this.getLayer().getSource().getTileGridForProjection(e.viewState.projection),d=t.tileCoord,p=u.getTileCoordExtent(t.wrappedTileCoord),g=u.getTileCoordExtent(d,this.tmpExtent)[0]-p[0];return dS(ax(this.inversePixelTransform.slice(),1/i,1/i),this.getRenderTransform(n,o,a,i,h,c,g))}postRender(t,e){const i=e.viewHints,r=!(i[Si.ANIMATING]||i[Si.INTERACTING]);this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice(),this.renderedRotation_=e.viewState.rotation,this.renderedOpacity_=e.layerStatesArray[e.layerIndex].opacity;const n=this.getLayer(),o=n.getRenderMode(),a=t.globalAlpha;t.globalAlpha=this.renderedOpacity_;const l=n.getDeclutter(),h=l?OM[o].filter(v=>!s_.includes(v)):OM[o],c=e.viewState,u=c.rotation,d=n.getSource(),p=d.getTileGridForProjection(c.projection).getZForResolution(c.resolution,d.zDirection),g=this.renderedTiles,f=[],m=[],_=[];let y=!0;for(let v=g.length-1;v>=0;--v){const b=g[v];y=y&&!b.getReplayState(n).dirty;const E=b.executorGroups[Nt(n)].filter(N=>N.hasExecutors(h));if(E.length===0)continue;const S=this.getTileRenderTransform(b,e),T=b.tileCoord[0];let R=!1;const M=E[0].getClipCoords(S);let A=t,O;if(M){l&&(O=new s2,A=O.getContext());for(let N=0,x=f.length;N<x;++N)if(p!==T&&T<m[N]){const w=f[N];zi([M[0],M[3],M[4],M[7]],[w[0],w[3],w[4],w[7]])&&(R||(A.save(),R=!0),A.beginPath(),A.moveTo(M[0],M[1]),A.lineTo(M[2],M[3]),A.lineTo(M[4],M[5]),A.lineTo(M[6],M[7]),A.moveTo(w[6],w[7]),A.lineTo(w[4],w[5]),A.lineTo(w[2],w[3]),A.lineTo(w[0],w[1]),A.clip())}f.push(M),m.push(T)}for(let N=0,x=E.length;N<x;++N)E[N].execute(t,[t.canvas.width,t.canvas.height],S,u,r,h);R&&(A===t?A.restore():_[v]=O)}t.globalAlpha=a,this.ready=y,this.tileClipContexts_=_,super.postRender(t,e)}renderFeature(t,e,i,r,n,o){if(!i)return!1;let a=!1;if(Array.isArray(i))for(let l=0,h=i.length;l<h;++l)a=r_(r,t,i[l],e,this.boundHandleStyleImageChange_,void 0,n,o)||a;else a=r_(r,t,i,e,this.boundHandleStyleImageChange_,void 0,n,o);return a}tileImageNeedsRender_(t){const e=this.getLayer();if(e.getRenderMode()==="vector")return!1;const i=t.getReplayState(e),r=e.getRevision(),n=t.wantedResolution;return i.renderedTileResolution!==n||i.renderedTileRevision!==r}renderTileImage_(t,e){const i=this.getLayer(),r=t.getReplayState(i),n=i.getRevision(),o=t.executorGroups[Nt(i)];r.renderedTileRevision=n;const a=t.wrappedTileCoord,l=a[0],h=i.getSource();let c=e.pixelRatio;const u=e.viewState.projection,d=h.getTileGridForProjection(u),p=d.getResolution(t.tileCoord[0]),g=e.pixelRatio/t.wantedResolution*p,f=d.getResolution(l),m=t.getContext(i);c=Math.round(Math.max(c,g/c));const _=h.getTilePixelSize(l,c,u);m.canvas.width=_[0],m.canvas.height=_[1];const y=c/g;if(y!==1){const S=UR(this.tmpTransform_);ax(S,y,y),m.setTransform.apply(m,S)}const v=d.getTileCoordExtent(a,this.tmpExtent),b=g/f,E=UR(this.tmpTransform_);ax(E,b,-b),Vit(E,-v[0],-v[3]);for(let S=0,T=o.length;S<T;++S)o[S].execute(m,[m.canvas.width*y,m.canvas.height*y],E,0,!0,ect[i.getRenderMode()],null);r.renderedTileResolution=t.wantedResolution}}const sct=ict;class rct extends zS{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un;const i=t.renderMode||"hybrid";Te(i=="hybrid"||i=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=i,this.setPreload(t.preload?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new sct(this)}getFeatures(t){return super.getFeatures(t)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(yl.PRELOAD)}getUseInterimTilesOnError(){return this.get(yl.USE_INTERIM_TILES_ON_ERROR)}setPreload(t){this.set(yl.PRELOAD,t)}setUseInterimTilesOnError(t){this.set(yl.USE_INTERIM_TILES_ON_ERROR,t)}}const nct=rct;class oct extends zht{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const t=this.peekFirstKey(),e=ED(t)[0];this.forEach(i=>{i.tileCoord[0]!==e&&(this.remove(wD(i.tileCoord)),i.release())})}}const l2=oct,Ix={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},_c=[0,0,0],Za=5;class act{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,Te(Jet(this.resolutions_,(r,n)=>n-r,!0),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let r=0,n=this.resolutions_.length-1;r<n;++r)if(!e)e=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,Te(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=t.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Co(i)),Te(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,Te(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:JE,Te(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((r,n)=>{const o=new bD(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,n);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const r=this.getTileRangeForExtentAndZ(t,e);for(let n=r.minX,o=r.maxX;n<=o;++n)for(let a=r.minY,l=r.maxY;a<=l;++a)i([e,n,a])}forEachTileCoordParentTileRange(t,e,i,r){let n,o,a,l=null,h=t[0]-1;for(this.zoomFactor_===2?(o=t[1],a=t[2]):l=this.getTileCoordExtent(t,r);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),n=mc(o,o,a,a,i)):n=this.getTileRangeForExtentAndZ(l,h,i),e(h,n))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const n=t[1]*2,o=t[2]*2;return mc(n,n+1,o,o+1,e)}const r=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const r=t[0],n=t[1],o=t[2];if(e===r)return mc(n,o,n,o,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,e-r),h=Math.floor(n*l),c=Math.floor(o*l);if(e<r)return mc(h,h,c,c,i);const u=Math.floor(l*(n+1))-1,d=Math.floor(l*(o+1))-1;return mc(h,u,c,d,i)}const a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e,i)}getTileRangeForExtentAndZ(t,e,i){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,_c);const r=_c[1],n=_c[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,_c);const o=_c[1],a=_c[2];return mc(r,o,n,a,i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),r=ar(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*r[0]*i,e[1]-(t[2]+.5)*r[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),r=this.getResolution(t[0]),n=ar(this.getTileSize(t[0]),this.tmpSize_),o=i[0]+t[1]*n[0]*r,a=i[1]-(t[2]+1)*n[1]*r,l=o+n[0]*r,h=a+n[1]*r;return fa(o,a,l,h,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,r,n){const o=this.getZForResolution(i),a=i/this.getResolution(o),l=this.getOrigin(o),h=ar(this.getTileSize(o),this.tmpSize_);let c=a*(t-l[0])/i/h[0],u=a*(l[1]-e)/i/h[1];return r?(c=ul(c,Za)-1,u=ul(u,Za)-1):(c=Qc(c,Za),u=Qc(u,Za)),PM(o,c,u,n)}getTileCoordForXYAndZ_(t,e,i,r,n){const o=this.getOrigin(i),a=this.getResolution(i),l=ar(this.getTileSize(i),this.tmpSize_);let h=(t-o[0])/a/l[0],c=(o[1]-e)/a/l[1];return r?(h=ul(h,Za)-1,c=ul(c,Za)-1):(h=Qc(h,Za),c=Qc(c,Za)),PM(i,h,c,n)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const i=Sy(this.resolutions_,t,e||0);return Oi(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return zk(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let r=this.minZoom;r<e;++r)i[r]=this.getTileRangeForExtentAndZ(t,r);this.fullTileRanges_=i}}const h2=act;function TD(s){let t=s.getDefaultTileGrid();return t||(t=cct(s),s.setDefaultTileGrid(t)),t}function lct(s,t,e){const i=t[0],r=s.getTileCoordCenter(t),n=Hy(e);if(!kh(n,r)){const o=Fe(n),a=Math.ceil((n[0]-r[0])/o);return r[0]+=o*a,s.getTileCoordForCoordAndZ(r,i)}return t}function hct(s,t,e,i){i=i!==void 0?i:"top-left";const r=RD(s,t,e);return new h2({extent:s,origin:xit(s,i),resolutions:r,tileSize:e})}function c2(s){const t=s||{},e=t.extent||si("EPSG:3857").getExtent(),i={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:RD(e,t.maxZoom,t.tileSize,t.maxResolution)};return new h2(i)}function RD(s,t,e,i){t=t!==void 0?t:bk,e=ar(e!==void 0?e:JE);const r=hs(s),n=Fe(s);i=i>0?i:Math.max(n/e[0],r/e[1]);const o=t+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=i/Math.pow(2,l);return a}function cct(s,t,e,i){const r=Hy(s);return hct(r,t,e,i)}function Hy(s){s=si(s);let t=s.getExtent();if(!t){const e=180*zu.degrees/s.getMetersPerUnit();t=fa(-e,-e,e,e)}return t}class uct extends o2{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=t.opaque!==void 0?t.opaque:!1,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&ar(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tileCache=new l2(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const i=this.getTileCacheForProjection(t);i&&i.expireCache(e)}forEachLoadedTile(t,e,i,r){const n=this.getTileCacheForProjection(t);if(!n)return!1;let o=!0,a,l,h;for(let c=i.minX;c<=i.maxX;++c)for(let u=i.minY;u<=i.maxY;++u)l=Sd(e,c,u),h=!1,n.containsKey(l)&&(a=n.get(l),h=a.getState()===ot.LOADED,h&&(h=r(a)!==!1)),h||(o=!1);return o}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,i,r,n){return Xt()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:TD(t)}getTileCacheForProjection(t){const e=this.getProjection();return Te(e===null||Xo(e,t),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const r=this.getTileGridForProjection(i),n=this.getTilePixelRatio(e),o=ar(r.getTileSize(t),this.tmpSize);return n==1?o:vst(o,n,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=e!==void 0?e:this.getProjection();const i=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=lct(i,t,e)),Uht(t,i)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const i=this.getTileCacheForProjection(e);t>i.highWaterMark&&(i.highWaterMark=t)}useTile(t,e,i,r){}}class dct extends mn{constructor(t,e){super(t),this.tile=e}}const MD=uct;function pct(s,t){const e=/\{z\}/g,i=/\{x\}/g,r=/\{y\}/g,n=/\{-y\}/g;return function(o,a,l){if(o)return s.replace(e,o[0].toString()).replace(i,o[1].toString()).replace(r,o[2].toString()).replace(n,function(){const h=o[0],c=t.getFullTileRange(h);if(!c)throw new Error("The {-y} placeholder requires a tile grid with extent");return(c.getHeight()-o[2]-1).toString()})}}function gct(s,t){const e=s.length,i=new Array(e);for(let r=0;r<e;++r)i[r]=pct(s[r],t);return Pb(i)}function Pb(s){return s.length===1?s[0]:function(t,e,i){if(!t)return;const r=SD(t),n=Eh(r,s.length);return s[n](t,e,i)}}function ID(s){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(s);if(e){const i=e[1].charCodeAt(0),r=e[2].charCodeAt(0);let n;for(n=i;n<=r;++n)t.push(s.replace(e[0],String.fromCharCode(n)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(s),e){const i=parseInt(e[2],10);for(let r=parseInt(e[1],10);r<=i;r++)t.push(s.replace(e[0],r.toString()));return t}return t.push(s),t}class u2 extends MD{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===u2.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=Nt(e),r=e.getState();let n;r==ot.LOADING?(this.tileLoadingKeys_[i]=!0,n=Ix.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],n=r==ot.ERROR?Ix.TILELOADERROR:r==ot.LOADED?Ix.TILELOADEND:void 0),n!=null&&this.dispatchEvent(new dct(n,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=ID(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(gct(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}useTile(t,e,i){const r=Sd(t,e,i);this.tileCache.containsKey(r)&&this.tileCache.get(r)}}const AD=u2;class fct extends AD{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:mct,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:xD,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(const r in this.tileCacheForProjection){const n=this.tileCacheForProjection[r];n.expireCache(n==i?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!Xo(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return this.getProjection()&&t&&!Xo(this.getProjection(),t)?!1:super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||Xo(e,t)))return this.tileGrid;const i=Nt(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=TD(t)),this.tileGridForProjection[i]}getTileCacheForProjection(t){const e=this.getProjection();if(!e||Xo(e,t))return this.tileCache;const i=Nt(t);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new l2(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(t,e,i,r,n,o){const a=[t,e,i],l=this.getTileCoordForTileUrlFunction(a,n),h=l?this.tileUrlFunction(l,r,n):void 0,c=new this.tileClass(a,h!==void 0?ot.IDLE:ot.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(Mt.CHANGE,this.handleTileChange.bind(this)),c}getTile(t,e,i,r,n){const o=this.getProjection();if(!o||!n||Xo(o,n))return this.getTileInternal(t,e,i,r,o||n);const a=this.getTileCacheForProjection(n),l=[t,e,i];let h;const c=wD(l);a.containsKey(c)&&(h=a.get(c));const u=this.getKey();if(h&&h.key==u)return h;const d=this.getTileGridForProjection(o),p=this.getTileGridForProjection(n),g=this.getTileCoordForTileUrlFunction(l,n),f=new Ab(o,d,n,p,l,g,this.getTilePixelRatio(r),this.getGutter(),(m,_,y,v)=>this.getTileInternal(m,_,y,v,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return f.key=u,h?(f.interimTile=h,f.refreshInterimChain(),a.replace(c,f)):a.set(c,f),f}getTileInternal(t,e,i,r,n){let o=null;const a=Sd(t,e,i),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(t,e,i,r,n,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(t,e,i,r,n,l),h.getState()==ot.IDLE?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){const i=si(t);if(i){const r=Nt(i);r in this.tileGridForProjection||(this.tileGridForProjection[r]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}}function mct(s,t){s.getImage().src=t}const d2=fct;class _ct extends d2{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",i=t.tileGrid!==void 0?t.tileGrid:c2({extent:Hy(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}const LD=_ct;class yct extends iN{constructor(t,e,i,r,n,o,a){let l=t.getExtent();l&&t.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let h=e.getExtent();h&&e.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const c=h?sa(i,h):i,u=xo(c),d=Cg(t,e,u,r),p=mD,g=new _D(t,e,c,l,d*p,r),f=g.calculateSourceExtent(),m=yd(f)?null:o(f,d,n),_=m?yt.IDLE:yt.EMPTY,y=m?m.getPixelRatio():1;super(i,r,y,_),this.targetProj_=e,this.maxSourceExtent_=l,this.triangulation_=g,this.targetResolution_=r,this.targetExtent_=i,this.sourceImage_=m,this.sourcePixelRatio_=y,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==yt.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const t=this.sourceImage_.getState();if(t==yt.LOADED){const e=Fe(this.targetExtent_)/this.targetResolution_,i=hs(this.targetExtent_)/this.targetResolution_;this.canvas_=yD(e,i,this.sourcePixelRatio_,Lb(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=t,this.changed()}load(){if(this.state==yt.IDLE){this.state=yt.LOADING,this.changed();const t=this.sourceImage_.getState();t==yt.LOADED||t==yt.ERROR?this.reproject_():(this.sourceListenerKey_=ae(this.sourceImage_,Mt.CHANGE,function(e){const i=this.sourceImage_.getState();(i==yt.LOADED||i==yt.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){ii(this.sourceListenerKey_),this.sourceListenerKey_=null}}const xct=yct,xl=4,Ax={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class vct extends mn{constructor(t,e){super(t),this.image=e}}class bct extends o2{constructor(t){super({attributions:t.attributions,projection:t.projection,state:t.state,interpolate:t.interpolate!==void 0?t.interpolate:!0}),this.on,this.once,this.un,this.loader=t.loader||null,this.resolutions_=t.resolutions!==void 0?t.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=t.loader?t.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(t){this.resolutions_=t}findNearestResolution(t){const e=this.getResolutions();if(e){const i=Sy(e,t,0);t=e[i]}return t}getImage(t,e,i,r){const n=this.getProjection();if(!n||!r||Xo(n,r))return n&&(r=n),this.getImageInternal(t,e,i,r);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Xo(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==e&&Ll(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new xct(n,r,t,e,i,(o,a,l)=>this.getImageInternal(o,a,l,n),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(t,e,i,r){if(this.loader){const n=PD(t,e,i,1),o=this.findNearestResolution(e);if(this.image&&(this.static_||this.wantedProjection_===r&&(this.wantedExtent_&&an(this.wantedExtent_,n)||an(this.image.getExtent(),n))&&(this.wantedResolution_&&Lb(this.wantedResolution_)===o||Lb(this.image.getResolution())===o)))return this.image;this.wantedProjection_=r,this.wantedExtent_=n,this.wantedResolution_=o,this.image=new iN(n,o,i,this.loader),this.image.addEventListener(Mt.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(t){const e=t.target;let i;switch(e.getState()){case yt.LOADING:this.loading=!0,i=Ax.IMAGELOADSTART;break;case yt.LOADED:this.loading=!1,i=Ax.IMAGELOADEND;break;case yt.ERROR:this.loading=!1,i=Ax.IMAGELOADERROR;break;default:return}this.hasListener(i)&&this.dispatchEvent(new vct(i,e))}}function wct(s,t){s.getImage().src=t}function PD(s,t,e,i){const r=t/e,n=xo(s),o=ul(Fe(s)/r,xl),a=ul(hs(s)/r,xl),l=ul((i-1)*o/2,xl),h=o+2*l,c=ul((i-1)*a/2,xl),u=a+2*c;return gg(n,r,0,[h,u])}const Ect=bct;function Tg(s,t){const e=[];Object.keys(t).forEach(function(r){t[r]!==null&&t[r]!==void 0&&e.push(r+"="+encodeURIComponent(t[r]))});const i=e.join("&");return s=s.replace(/[?&]$/,""),s+=s.includes("?")?"&":"?",s+i}const n_="1.3.0",FM=[101,101];function OD(s,t,e,i,r){r.WIDTH=e[0],r.HEIGHT=e[1];const n=i.getAxisOrientation();let o;const a=sS(r.VERSION,"1.3")>=0;return r[a?"CRS":"SRS"]=i.getCode(),a&&n.substr(0,2)=="ne"?o=[t[1],t[0],t[3],t[2]]:o=t,r.BBOX=o.join(","),Tg(s,r)}function FD(s,t,e,i,r,n,o){n=Object.assign({REQUEST:"GetMap"},n);const a=t/e,l=[kR(Fe(s)/a,xl),kR(hs(s)/a,xl)];if(e!=1)switch(o){case"geoserver":const h=90*e+.5|0;"FORMAT_OPTIONS"in n?n.FORMAT_OPTIONS+=";dpi:"+h:n.FORMAT_OPTIONS="dpi:"+h;break;case"mapserver":n.MAP_RESOLUTION=90*e;break;case"carmentaserver":case"qgis":n.DPI=90*e;break;default:throw new Error("Unknown `serverType` configured")}return OD(r,s,l,i,n)}function o_(s,t){return Object.assign({REQUEST:t,SERVICE:"WMS",VERSION:n_,FORMAT:"image/png",STYLES:"",TRANSPARENT:!0},s)}function Sct(s){const t=s.hidpi===void 0?!0:s.hidpi,e=si(s.projection||"EPSG:3857"),i=s.ratio||1.5,r=s.load||rN;return(n,o,a)=>{n=PD(n,o,a,i),a!=1&&(!t||s.serverType===void 0)&&(a=1);const l=FD(n,o,a,e,s.url,o_(s.params,"GetMap"),s.serverType),h=new Image;return s.crossOrigin!==null&&(h.crossOrigin=s.crossOrigin),r(h,l).then(c=>({image:c,extent:n,pixelRatio:a}))}}function Cct(s,t,e){if(s.url===void 0)return;const i=si(s.projection||"EPSG:3857"),r=gg(t,e,0,FM),n={QUERY_LAYERS:s.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(n,o_(s.params,"GetFeatureInfo"),s.params);const o=Qc((t[0]-r[0])/e,xl),a=Qc((r[3]-t[1])/e,xl),l=sS(n.VERSION,"1.3")>=0;return n[l?"I":"X"]=o,n[l?"J":"Y"]=a,OD(s.url,r,FM,i,n)}function Tct(s,t){if(s.url===void 0)return;const e={SERVICE:"WMS",VERSION:n_,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(s.params===void 0||s.params.LAYER===void 0){const i=s.params.LAYERS;if(!(!Array.isArray(i)||i.length===1))return;e.LAYER=i}if(t!==void 0){const i=si(s.projection||"EPSG:3857").getMetersPerUnit()||1,r=28e-5;e.SCALE=t*i/r}return Object.assign(e,s.params),Tg(s.url,e)}class Rct extends Ect{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null,this.url_=t.url,this.imageLoadFunction_=t.imageLoadFunction!==void 0?t.imageLoadFunction:wct,this.params_=Object.assign({},t.params),this.serverType_=t.serverType,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.renderedRevision_=0,this.ratio_=t.ratio!==void 0?t.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(t,e,i,r){const n=si(i),o=this.getProjection();o&&o!==n&&(e=Cg(o,n,t,e),t=Ry(t,n,o));const a={url:this.url_,params:{...this.params_,...r},projection:o||n};return Cct(a,t,e)}getLegendUrl(t,e){return Tct({url:this.url_,params:{...this.params_,...e}},t)}getParams(){return this.params_}getImageInternal(t,e,i,r){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==r)&&(this.loaderProjection_=r,this.loader=Sct({crossOrigin:this.crossOrigin_,params:this.params_,projection:r,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(n,o)=>(this.image.setImage(n),this.imageLoadFunction_(this.image,o),rN(n))})),super.getImageInternal(t,e,i,r))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(t){this.imageLoadFunction_=t,this.changed()}setUrl(t){t!=this.url_&&(this.url_=t,this.loader=null,this.changed())}updateParams(t){Object.assign(this.params_,t),this.changed()}changed(){this.image=null,super.changed()}}const Mct=Rct;let Ict=class extends Vy{constructor(s,t,e,i,r,n){super(s,t,n),this.extent=null,this.format_=i,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=r,this.url_=e,this.key=e}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==ot.IDLE&&(this.setState(ot.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(s,t){this.setFeatures(s)}onError(){this.setState(ot.ERROR)}setFeatures(s){this.features_=s,this.setState(ot.LOADED)}setLoader(s){this.loader_=s}};const Act=Ict,kM=[];class Lct extends Vy{constructor(t,e,i,r){super(t,e,{transition:0}),this.context_={},this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=r.bind(void 0,this),this.wrappedTileCoord=i}getContext(t){const e=Nt(t);return e in this.context_||(this.context_[e]=ws(1,1,kM)),this.context_[e]}hasContext(t){return Nt(t)in this.context_}getImage(t){return this.hasContext(t)?this.getContext(t).canvas:null}getReplayState(t){const e=Nt(t);return e in this.replayState_||(this.replayState_[e]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[e]}load(){this.getSourceTiles()}release(){for(const t in this.context_){const e=this.context_[t];bf(e),kM.push(e.canvas),delete this.context_[t]}super.release()}}const Pct=Lct;class Oct extends AD{constructor(t){const e=t.projection||"EPSG:3857",i=t.extent||Hy(e),r=t.tileGrid||c2({extent:i,maxResolution:t.maxResolution,maxZoom:t.maxZoom!==void 0?t.maxZoom:22,minZoom:t.minZoom,tileSize:t.tileSize||512});super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,interpolate:!0,opaque:!1,projection:e,state:t.state,tileGrid:r,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:kct,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX===void 0?!0:t.wrapX,transition:t.transition,zDirection:t.zDirection===void 0?1:t.zDirection}),this.format_=t.format?t.format:null,this.sourceTileCache=new l2(this.tileCache.highWaterMark),this.overlaps_=t.overlaps==null?!0:t.overlaps,this.tileClass=t.tileClass?t.tileClass:Act,this.tileGrids_={}}getFeaturesInExtent(t){const e=[],i=this.tileCache;if(i.getCount()===0)return e;const r=ED(i.peekFirstKey())[0],n=this.tileGrid;return i.forEach(function(o){if(o.tileCoord[0]!==r||o.getState()!==ot.LOADED)return;const a=o.getSourceTiles();for(let l=0,h=a.length;l<h;++l){const c=a[l],u=c.tileCoord;if(zi(t,n.getTileCoordExtent(u))){const d=c.getFeatures();if(d)for(let p=0,g=d.length;p<g;++p){const f=d[p],m=f.getGeometry();zi(t,m.getExtent())&&e.push(f)}}}}),e}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(t,e){const i=this.getTileCacheForProjection(t),r=Object.keys(e).reduce((n,o)=>{const a=Bht(o),l=i.peek(a);if(l){const h=l.sourceTiles;for(let c=0,u=h.length;c<u;++c)n[h[c].getKey()]=!0}return n},{});super.expireCache(t,e),this.sourceTileCache.expireCache(r)}getSourceTiles(t,e,i){if(i.getState()===ot.IDLE){i.setState(ot.LOADING);const r=i.wrappedTileCoord,n=this.getTileGridForProjection(e),o=n.getTileCoordExtent(r),a=r[0],l=n.getResolution(a);hn(o,-l,o);const h=this.tileGrid,c=h.getExtent();c&&sa(o,c,o);const u=h.getZForResolution(l,this.zDirection);h.forEachTileCoord(o,u,d=>{const p=this.tileUrlFunction(d,t,e),g=this.sourceTileCache.containsKey(p)?this.sourceTileCache.get(p):new this.tileClass(d,p?ot.IDLE:ot.EMPTY,p,this.format_,this.tileLoadFunction);i.sourceTiles.push(g);const f=g.getState();if(f<ot.LOADED){const m=_=>{this.handleTileChange(_);const y=g.getState();if(y===ot.LOADED||y===ot.ERROR){const v=g.getKey();v in i.errorTileKeys?g.getState()===ot.LOADED&&delete i.errorTileKeys[v]:i.loadingSourceTiles--,y===ot.ERROR?i.errorTileKeys[v]=!0:g.removeEventListener(Mt.CHANGE,m),i.loadingSourceTiles===0&&i.setState(Al(i.errorTileKeys)?ot.LOADED:ot.ERROR)}};g.addEventListener(Mt.CHANGE,m),i.loadingSourceTiles++}f===ot.IDLE&&(g.extent=h.getTileCoordExtent(d),g.projection=e,g.resolution=h.getResolution(d[0]),this.sourceTileCache.set(p,g),g.load())}),i.loadingSourceTiles||i.setState(i.sourceTiles.some(d=>d.getState()===ot.ERROR)?ot.ERROR:ot.LOADED)}return i.sourceTiles}getTile(t,e,i,r,n){const o=Sd(t,e,i),a=this.getKey();let l;if(this.tileCache.containsKey(o)&&(l=this.tileCache.get(o),l.key===a))return l;const h=[t,e,i];let c=this.getTileCoordForTileUrlFunction(h,n);const u=this.getTileGrid().getExtent(),d=this.getTileGridForProjection(n);if(c&&u){const f=d.getTileCoordExtent(c);hn(f,-d.getResolution(t),f),zi(u,f)||(c=null)}let p=!0;if(c!==null){const f=this.tileGrid,m=d.getResolution(t),_=f.getZForResolution(m,1),y=d.getTileCoordExtent(c);hn(y,-m,y),f.forEachTileCoord(y,_,v=>{p=p&&!this.tileUrlFunction(v,r,n)})}const g=new Pct(h,p?ot.EMPTY:ot.IDLE,c,this.getSourceTiles.bind(this,r,n));return g.key=a,l?(g.interimTile=l,g.refreshInterimChain(),this.tileCache.replace(o,g)):this.tileCache.set(o,g),g}getTileGridForProjection(t){const e=t.getCode();let i=this.tileGrids_[e];if(!i){const r=this.tileGrid,n=r.getResolutions().slice(),o=n.map(function(h,c){return r.getOrigin(c)}),a=n.map(function(h,c){return r.getTileSize(c)}),l=bk+1;for(let h=n.length;h<l;++h)n.push(n[h-1]/2),o.push(o[h-1]),a.push(a[h-1]);i=new h2({extent:r.getExtent(),origins:o,resolutions:n,tileSizes:a}),this.tileGrids_[e]=i}return i}getTilePixelRatio(t){return t}getTilePixelSize(t,e,i){const r=this.getTileGridForProjection(i),n=ar(r.getTileSize(t),this.tmpSize);return[Math.round(n[0]*e),Math.round(n[1]*e)]}updateCacheSize(t,e){super.updateCacheSize(t*2,e),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(e).highWaterMark}}const Fct=Oct;function kct(s,t){s.setLoader(function(e,i,r){fD(t,s.getFormat(),e,i,r,s.onLoad.bind(s),s.onError.bind(s))})}const Nct='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class Dct extends LD{constructor(t){t=t||{};let e;t.attributions!==void 0?e=t.attributions:e=[Nct];const i=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",r=t.url!==void 0?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:i,interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:19,opaque:t.opaque!==void 0?t.opaque:!0,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:r,wrapX:t.wrapX,zDirection:t.zDirection})}}const $ct=Dct;class jct extends d2{constructor(t){t=t||{};const e=Object.assign({},t.params),i="TRANSPARENT"in e?e.TRANSPARENT:!0;super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:!i,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0,this.params_=e,this.v13_=!0,this.serverType_=t.serverType,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.tmpExtent_=Yr(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(t,e,i,r){const n=si(i),o=this.getProjection()||n;let a=this.getTileGrid();a||(a=this.getTileGridForProjection(o));const l=Ry(t,n,o),h=Cg(o,n,t,e),c=a.getZForResolution(h,this.zDirection),u=a.getResolution(c),d=a.getTileCoordForCoordAndZ(l,c);if(a.getResolutions().length<=d[0])return;let p=a.getTileCoordExtent(d,this.tmpExtent_);const g=this.gutter_;g!==0&&(p=hn(p,u*g,p));const f={QUERY_LAYERS:this.params_.LAYERS};Object.assign(f,o_(this.params_,"GetFeatureInfo"),r);const m=Math.floor((l[0]-p[0])/u),_=Math.floor((p[3]-l[1])/u);return f[this.v13_?"I":"X"]=m,f[this.v13_?"J":"Y"]=_,this.getRequestUrl_(d,p,1,o||n,f)}getLegendUrl(t,e){if(this.urls[0]===void 0)return;const i={SERVICE:"WMS",VERSION:n_,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(e===void 0||e.LAYER===void 0){const r=this.params_.LAYERS;if(!(!Array.isArray(r)||r.length===1))return;i.LAYER=r}if(t!==void 0){const r=this.getProjection()?this.getProjection().getMetersPerUnit():1,n=28e-5;i.SCALE=t*r/n}return Object.assign(i,e),Tg(this.urls[0],i)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(t,e,i,r,n){const o=this.urls;if(!o)return;let a;if(o.length==1)a=o[0];else{const l=Eh(SD(t),o.length);a=o[l]}return FD(e,(this.tileGrid||this.getTileGridForProjection(r)).getResolution(t[0]),i,r,a,n,this.serverType_)}getTilePixelRatio(t){return!this.hidpi_||this.serverType_===void 0?1:t}getKeyForParams_(){let t=0;const e=[];for(const i in this.params_)e[t++]=i+"-"+this.params_[i];return e.join("/")}updateParams(t){Object.assign(this.params_,t),this.updateV13_(),this.setKey(this.getKeyForParams_())}updateV13_(){const t=this.params_.VERSION||n_;this.v13_=sS(t,"1.3")>=0}tileUrlFunction(t,e,i){let r=this.getTileGrid();if(r||(r=this.getTileGridForProjection(i)),r.getResolutions().length<=t[0])return;e!=1&&(!this.hidpi_||this.serverType_===void 0)&&(e=1);const n=r.getResolution(t[0]);let o=r.getTileCoordExtent(t,this.tmpExtent_);const a=this.gutter_;a!==0&&(o=hn(o,n*a,o));const l=Object.assign({},o_(this.params_,"GetMap"));return this.getRequestUrl_(t,o,e,i,l)}}const Gct=jct;class zct extends d2{constructor(t){const e=t.requestEncoding!==void 0?t.requestEncoding:"KVP",i=t.tileGrid;let r=t.urls;r===void 0&&t.url!==void 0&&(r=ID(t.url)),super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,urls:r,wrapX:t.wrapX!==void 0?t.wrapX:!1,transition:t.transition,zDirection:t.zDirection}),this.version_=t.version!==void 0?t.version:"1.0.0",this.format_=t.format!==void 0?t.format:"image/jpeg",this.dimensions_=t.dimensions!==void 0?t.dimensions:{},this.layer_=t.layer,this.matrixSet_=t.matrixSet,this.style_=t.style,this.requestEncoding_=e,this.setKey(this.getKeyForDimensions_()),r&&r.length>0&&(this.tileUrlFunction=Pb(r.map(this.createFromWMTSTemplate.bind(this))))}setUrls(t){this.urls=t;const e=t.join(`
`);this.setTileUrlFunction(Pb(t.map(this.createFromWMTSTemplate.bind(this))),e)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const t=this.urls?this.urls.slice(0):[];for(const e in this.dimensions_)t.push(e+"-"+this.dimensions_[e]);return t.join("/")}updateDimensions(t){Object.assign(this.dimensions_,t),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(t){const e=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};e=="KVP"&&Object.assign(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),t=e=="KVP"?Tg(t,i):t.replace(/\{(\w+?)\}/g,function(o,a){return a.toLowerCase()in i?i[a.toLowerCase()]:o});const r=this.tileGrid,n=this.dimensions_;return function(o,a,l){if(!o)return;const h={TileMatrix:r.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(h,n);let c=t;return e=="KVP"?c=Tg(c,h):c=c.replace(/\{(\w+?)\}/g,function(u,d){return h[d]}),c}}}const Bct=zct,js={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class Uct extends Vn{constructor(t){super(),this.on,this.once,this.un,this.options=t,this.id=t.id,this.insertFirst=t.insertFirst!==void 0?t.insertFirst:!0,this.stopEvent=t.stopEvent!==void 0?t.stopEvent:!0,this.element=document.createElement("div"),this.element.className=t.className!==void 0?t.className:"ol-overlay-container "+zst,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=t.autoPan===!0?{}:t.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(js.ELEMENT,this.handleElementChanged),this.addChangeListener(js.MAP,this.handleMapChanged),this.addChangeListener(js.OFFSET,this.handleOffsetChanged),this.addChangeListener(js.POSITION,this.handlePositionChanged),this.addChangeListener(js.POSITIONING,this.handlePositioningChanged),t.element!==void 0&&this.setElement(t.element),this.setOffset(t.offset!==void 0?t.offset:[0,0]),this.setPositioning(t.positioning||"top-left"),t.position!==void 0&&this.setPosition(t.position)}getElement(){return this.get(js.ELEMENT)}getId(){return this.id}getMap(){return this.get(js.MAP)||null}getOffset(){return this.get(js.OFFSET)}getPosition(){return this.get(js.POSITION)}getPositioning(){return this.get(js.POSITIONING)}handleElementChanged(){eN(this.element);const t=this.getElement();t&&this.element.appendChild(t)}handleMapChanged(){this.mapPostrenderListenerKey&&(H0(this.element),ii(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const t=this.getMap();if(t){this.mapPostrenderListenerKey=ae(t,Jn.POSTRENDER,this.render,this),this.updatePixelPosition();const e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(t){this.set(js.ELEMENT,t)}setMap(t){this.set(js.MAP,t)}setOffset(t){this.set(js.OFFSET,t)}setPosition(t){this.set(js.POSITION,t)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(t){const e=this.getMap();if(!e||!e.getTargetElement()||!this.get(js.POSITION))return;const i=this.getRect(e.getTargetElement(),e.getSize()),r=this.getElement(),n=this.getRect(r,[Ost(r),Fst(r)]);t=t||{};const o=t.margin===void 0?20:t.margin;if(!an(i,n)){const a=n[0]-i[0],l=i[2]-n[2],h=n[1]-i[1],c=i[3]-n[3],u=[0,0];if(a<0?u[0]=a-o:l<0&&(u[0]=Math.abs(l)+o),h<0?u[1]=h-o:c<0&&(u[1]=Math.abs(c)+o),u[0]!==0||u[1]!==0){const d=e.getView().getCenterInternal(),p=e.getPixelFromCoordinateInternal(d);if(!p)return;const g=[p[0]+u[0],p[1]+u[1]],f=t.animation||{};e.getView().animateInternal({center:e.getCoordinateFromPixelInternal(g),duration:f.duration,easing:f.easing})}}}getRect(t,e){const i=t.getBoundingClientRect(),r=i.left+window.pageXOffset,n=i.top+window.pageYOffset;return[r,n,r+e[0],n+e[1]]}setPositioning(t){this.set(js.POSITIONING,t)}setVisible(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)}updatePixelPosition(){const t=this.getMap(),e=this.getPosition();if(!t||!t.isRendered()||!e){this.setVisible(!1);return}const i=t.getPixelFromCoordinate(e),r=t.getSize();this.updateRenderedPosition(i,r)}updateRenderedPosition(t,e){const i=this.element.style,r=this.getOffset(),n=this.getPositioning();this.setVisible(!0);const o=Math.round(t[0]+r[0])+"px",a=Math.round(t[1]+r[1])+"px";let l="0%",h="0%";n=="bottom-right"||n=="center-right"||n=="top-right"?l="-100%":(n=="bottom-center"||n=="center-center"||n=="top-center")&&(l="-50%"),n=="bottom-left"||n=="bottom-center"||n=="bottom-right"?h="-100%":(n=="center-left"||n=="center-center"||n=="center-right")&&(h="-50%");const c=`translate(${l}, ${h}) translate(${o}, ${a})`;this.rendered.transform_!=c&&(this.rendered.transform_=c,i.transform=c)}getOptions(){return this.options}}const kD=Uct,NM=0,Mp=1,DM=[0,0,0,0],xu=[],Lx={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};let Px=class extends mn{constructor(t,e,i){super(t),this.features=e,this.mapBrowserEvent=i}};class Vct extends Yh{constructor(t){super(t),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=t.condition?t.condition:RN,this.defaultDeleteCondition_=function(i){return lnt(i)&&dnt(i)},this.deleteCondition_=t.deleteCondition?t.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=t.insertVertexCondition?t.insertVertexCondition:K0,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Ib,this.pixelTolerance_=t.pixelTolerance!==void 0?t.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new n2({source:new a2({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style?t.style:Wct(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let e;if(t.features?e=t.features:t.source&&(this.source_=t.source,e=new or(this.source_.getFeatures()),this.source_.addEventListener(Nr.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Nr.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!e)throw new Error("The modify interaction requires features, a source or a layer");t.hitDetection&&(this.hitDetection_=t.hitDetection),this.features_=e,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(Vs.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(Vs.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=t.snapToPointer===void 0?!this.hitDetection_:t.snapToPointer}addFeature_(t){const e=t.getGeometry();if(e){const r=this.SEGMENT_WRITERS_[e.getType()];r&&r(t,e)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),t.addEventListener(Mt.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(t,e){if(!this.featuresBeingModified_){this.featuresBeingModified_=new or;const i=this.featuresBeingModified_.getArray();for(let r=0,n=e.length;r<n;++r){const o=e[r];for(let a=0,l=o.length;a<l;++a){const h=o[a].feature;h&&!i.includes(h)&&this.featuresBeingModified_.push(h)}}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Px(Lx.MODIFYSTART,this.featuresBeingModified_,t))}}removeFeature_(t){this.removeFeatureSegmentData_(t),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.removeEventListener(Mt.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(t){const e=this.rBush_,i=[];e.forEach(function(r){t===r.feature&&i.push(r)});for(let r=i.length-1;r>=0;--r){const n=i[r];for(let o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===n&&this.dragSegments_.splice(o,1);e.remove(n)}}setActive(t){this.vertexFeature_&&!t&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(t)}setMap(t){this.overlay_.setMap(t),super.setMap(t)}getOverlay(){return this.overlay_}handleSourceAdd_(t){t.feature&&this.features_.push(t.feature)}handleSourceRemove_(t){t.feature&&this.features_.remove(t.feature)}handleFeatureAdd_(t){this.addFeature_(t.element)}handleFeatureChange_(t){if(!this.changingFeature_){const e=t.target;this.removeFeature_(e),this.addFeature_(e)}}handleFeatureRemove_(t){this.removeFeature_(t.element)}writePointGeometry_(t,e){const i=e.getCoordinates(),r={feature:t,geometry:e,segment:[i,i]};this.rBush_.insert(e.getExtent(),r)}writeMultiPointGeometry_(t,e){const i=e.getCoordinates();for(let r=0,n=i.length;r<n;++r){const o=i[r],a={feature:t,geometry:e,depth:[r],index:r,segment:[o,o]};this.rBush_.insert(e.getExtent(),a)}}writeLineStringGeometry_(t,e){const i=e.getCoordinates();for(let r=0,n=i.length-1;r<n;++r){const o=i.slice(r,r+2),a={feature:t,geometry:e,index:r,segment:o};this.rBush_.insert(yr(o),a)}}writeMultiLineStringGeometry_(t,e){const i=e.getCoordinates();for(let r=0,n=i.length;r<n;++r){const o=i[r];for(let a=0,l=o.length-1;a<l;++a){const h=o.slice(a,a+2),c={feature:t,geometry:e,depth:[r],index:a,segment:h};this.rBush_.insert(yr(h),c)}}}writePolygonGeometry_(t,e){const i=e.getCoordinates();for(let r=0,n=i.length;r<n;++r){const o=i[r];for(let a=0,l=o.length-1;a<l;++a){const h=o.slice(a,a+2),c={feature:t,geometry:e,depth:[r],index:a,segment:h};this.rBush_.insert(yr(h),c)}}}writeMultiPolygonGeometry_(t,e){const i=e.getCoordinates();for(let r=0,n=i.length;r<n;++r){const o=i[r];for(let a=0,l=o.length;a<l;++a){const h=o[a];for(let c=0,u=h.length-1;c<u;++c){const d=h.slice(c,c+2),p={feature:t,geometry:e,depth:[a,r],index:c,segment:d};this.rBush_.insert(yr(d),p)}}}}writeCircleGeometry_(t,e){const i=e.getCenter(),r={feature:t,geometry:e,index:NM,segment:[i,i]},n={feature:t,geometry:e,index:Mp,segment:[i,i]},o=[r,n];r.featureSegments=o,n.featureSegments=o,this.rBush_.insert(bp(i),r);let a=e;this.rBush_.insert(a.getExtent(),n)}writeGeometryCollectionGeometry_(t,e){const i=e.getGeometriesArray();for(let r=0;r<i.length;++r){const n=i[r],o=this.SEGMENT_WRITERS_[n.getType()];o(t,n)}}createOrUpdateVertexFeature_(t,e,i){let r=this.vertexFeature_;return r?r.getGeometry().setCoordinates(t):(r=new In(new un(t)),this.vertexFeature_=r,this.overlay_.getSource().addFeature(r)),r.set("features",e),r.set("geometries",i),r}handleEvent(t){if(!t.originalEvent)return!0;this.lastPointerEvent_=t;let e;return!t.map.getView().getInteracting()&&t.type==we.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(t),this.vertexFeature_&&this.deleteCondition_(t)&&(t.type!=we.SINGLECLICK||!this.ignoreNextSingleClick_?e=this.removePoint():e=!0),t.type==we.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(t)&&!e}handleDragEvent(t){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(t,this.dragSegments_);const e=[t.coordinate[0]+this.delta_[0],t.coordinate[1]+this.delta_[1]],i=[],r=[];for(let n=0,o=this.dragSegments_.length;n<o;++n){const a=this.dragSegments_[n],l=a[0],h=l.feature;i.includes(h)||i.push(h);const c=l.geometry;r.includes(c)||r.push(c);const u=l.depth;let d;const p=l.segment,g=a[1];for(;e.length<c.getStride();)e.push(p[g][e.length]);switch(c.getType()){case"Point":d=e,p[0]=e,p[1]=e;break;case"MultiPoint":d=c.getCoordinates(),d[l.index]=e,p[0]=e,p[1]=e;break;case"LineString":d=c.getCoordinates(),d[l.index+g]=e,p[g]=e;break;case"MultiLineString":d=c.getCoordinates(),d[u[0]][l.index+g]=e,p[g]=e;break;case"Polygon":d=c.getCoordinates(),d[u[0]][l.index+g]=e,p[g]=e;break;case"MultiPolygon":d=c.getCoordinates(),d[u[1]][u[0]][l.index+g]=e,p[g]=e;break;case"Circle":if(p[0]=e,p[1]=e,l.index===NM)this.changingFeature_=!0,c.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0,t.map.getView().getProjection();let f=G0(ji(c.getCenter()),ji(e));c.setRadius(f),this.changingFeature_=!1}break}d&&this.setGeometryCoordinates_(c,d)}this.createOrUpdateVertexFeature_(e,i,r)}handleDownEvent(t){if(!this.condition_(t))return!1;const e=t.coordinate;this.handlePointerAtPixel_(t.pixel,t.map,e),this.dragSegments_.length=0,this.featuresBeingModified_=null;const i=this.vertexFeature_;if(i){t.map.getView().getProjection();const r=[],n=i.getGeometry().getCoordinates(),o=yr([n]),a=this.rBush_.getInExtent(o),l={};a.sort(Hct);for(let h=0,c=a.length;h<c;++h){const u=a[h],d=u.segment;let p=Nt(u.geometry);const g=u.depth;if(g&&(p+="-"+g.join("-")),l[p]||(l[p]=new Array(2)),u.geometry.getType()==="Circle"&&u.index===Mp){const f=jM(e,u);en(f,n)&&!l[p][0]&&(this.dragSegments_.push([u,0]),l[p][0]=u);continue}if(en(d[0],n)&&!l[p][0]){this.dragSegments_.push([u,0]),l[p][0]=u;continue}if(en(d[1],n)&&!l[p][1]){if(l[p][0]&&l[p][0].index===0){let f=u.geometry.getCoordinates();switch(u.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":f=f[g[1]];case"Polygon":if(u.index!==f[g[0]].length-2)continue;break}}this.dragSegments_.push([u,1]),l[p][1]=u;continue}Nt(d)in this.vertexSegments_&&!l[p][0]&&!l[p][1]&&this.insertVertexCondition_(t)&&r.push(u)}r.length&&this.willModifyFeatures_(t,[r]);for(let h=r.length-1;h>=0;--h)this.insertVertex_(r[h],n)}return!!this.vertexFeature_}handleUpEvent(t){for(let e=this.dragSegments_.length-1;e>=0;--e){const i=this.dragSegments_[e][0],r=i.geometry;if(r.getType()==="Circle"){const n=r.getCenter(),o=i.featureSegments[0],a=i.featureSegments[1];o.segment[0]=n,o.segment[1]=n,a.segment[0]=n,a.segment[1]=n,this.rBush_.update(bp(n),o);let l=r;this.rBush_.update(l.getExtent(),a)}else this.rBush_.update(yr(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new Px(Lx.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null),!1}handlePointerMove_(t){this.lastPixel_=t.pixel,this.handlePointerAtPixel_(t.pixel,t.map,t.coordinate)}handlePointerAtPixel_(t,e,i){const r=i||e.getCoordinateFromPixel(t);e.getView().getProjection();const n=function(l,h){return $M(r,l)-$M(r,h)};let o,a;if(this.hitDetection_){const l=typeof this.hitDetection_=="object"?h=>h===this.hitDetection_:void 0;e.forEachFeatureAtPixel(t,(h,c,u)=>{u&&u.getType()==="Point"&&(u=new un(Vu(u.getCoordinates())));const d=u||h.getGeometry();if(h instanceof In&&this.features_.getArray().includes(h)){a=d;const p=h.getGeometry().getFlatCoordinates().slice(0,2);o=[{feature:h,geometry:a,segment:[p,p]}]}return!0},{layerFilter:l})}if(!o){const l=Pn(bp(r,DM)),h=e.getView().getResolution()*this.pixelTolerance_,c=My(hn(l,h,DM));o=this.rBush_.getInExtent(c)}if(o&&o.length>0){const l=o.sort(n)[0],h=l.segment;let c=jM(r,l);const u=e.getPixelFromCoordinate(c);let d=G0(t,u);if(a||d<=this.pixelTolerance_){const p={};if(p[Nt(h)]=!0,this.snapToPointer_||(this.delta_[0]=c[0]-r[0],this.delta_[1]=c[1]-r[1]),l.geometry.getType()==="Circle"&&l.index===Mp)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(c,[l.feature],[l.geometry]);else{const g=e.getPixelFromCoordinate(h[0]),f=e.getPixelFromCoordinate(h[1]),m=Uu(u,g),_=Uu(u,f);d=Math.sqrt(Math.min(m,_)),this.snappedToVertex_=d<=this.pixelTolerance_,this.snappedToVertex_&&(c=m>_?h[1]:h[0]),this.createOrUpdateVertexFeature_(c,[l.feature],[l.geometry]);const y={};y[Nt(l.geometry)]=!0;for(let v=1,b=o.length;v<b;++v){const E=o[v].segment;if(en(h[0],E[0])&&en(h[1],E[1])||en(h[0],E[1])&&en(h[1],E[0])){const S=Nt(o[v].geometry);S in y||(y[S]=!0,p[Nt(E)]=!0)}else break}}this.vertexSegments_=p;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(t,e){const i=t.segment,r=t.feature,n=t.geometry,o=t.depth,a=t.index;let l;for(;e.length<n.getStride();)e.push(0);switch(n.getType()){case"MultiLineString":l=n.getCoordinates(),l[o[0]].splice(a+1,0,e);break;case"Polygon":l=n.getCoordinates(),l[o[0]].splice(a+1,0,e);break;case"MultiPolygon":l=n.getCoordinates(),l[o[1]][o[0]].splice(a+1,0,e);break;case"LineString":l=n.getCoordinates(),l.splice(a+1,0,e);break;default:return}this.setGeometryCoordinates_(n,l);const h=this.rBush_;h.remove(t),this.updateSegmentIndices_(n,a,o,1);const c={segment:[i[0],e],feature:r,geometry:n,depth:o,index:a};h.insert(yr(c.segment),c),this.dragSegments_.push([c,1]);const u={segment:[e,i[1]],feature:r,geometry:n,depth:o,index:a+1};h.insert(yr(u.segment),u),this.dragSegments_.push([u,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=we.POINTERDRAG){const t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_);const e=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Px(Lx.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null,e}return!1}removeVertex_(){const t=this.dragSegments_,e={};let i=!1,r,n,o,a,l,h,c,u,d,p,g;for(l=t.length-1;l>=0;--l)o=t[l],p=o[0],g=Nt(p.feature),p.depth&&(g+="-"+p.depth.join("-")),g in e||(e[g]={}),o[1]===0?(e[g].right=p,e[g].index=p.index):o[1]==1&&(e[g].left=p,e[g].index=p.index+1);for(g in e){switch(d=e[g].right,c=e[g].left,h=e[g].index,u=h-1,c!==void 0?p=c:p=d,u<0&&(u=0),a=p.geometry,n=a.getCoordinates(),r=n,i=!1,a.getType()){case"MultiLineString":n[p.depth[0]].length>2&&(n[p.depth[0]].splice(h,1),i=!0);break;case"LineString":n.length>2&&(n.splice(h,1),i=!0);break;case"MultiPolygon":r=r[p.depth[1]];case"Polygon":r=r[p.depth[0]],r.length>4&&(h==r.length-1&&(h=0),r.splice(h,1),i=!0,h===0&&(r.pop(),r.push(r[0]),u=r.length-1));break}if(i){this.setGeometryCoordinates_(a,n);const f=[];if(c!==void 0&&(this.rBush_.remove(c),f.push(c.segment[0])),d!==void 0&&(this.rBush_.remove(d),f.push(d.segment[1])),c!==void 0&&d!==void 0){const m={depth:p.depth,feature:p.feature,geometry:p.geometry,index:u,segment:f};this.rBush_.insert(yr(m.segment),m)}this.updateSegmentIndices_(a,h,p.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.length=0}}return i}setGeometryCoordinates_(t,e){this.changingFeature_=!0,t.setCoordinates(e),this.changingFeature_=!1}updateSegmentIndices_(t,e,i,r){this.rBush_.forEachInExtent(t.getExtent(),function(n){n.geometry===t&&(i===void 0||n.depth===void 0||Ia(n.depth,i))&&n.index>e&&(n.index+=r)})}}function Hct(s,t){return s.index-t.index}function $M(s,t,e){const i=t.geometry;if(i.getType()==="Circle"){let n=i;if(t.index===Mp){const o=Uu(n.getCenter(),ji(s)),a=Math.sqrt(o)-n.getRadius();return a*a}}const r=ji(s);return xu[0]=ji(t.segment[0]),xu[1]=ji(t.segment[1]),Tit(r,xu)}function jM(s,t,e){const i=t.geometry;if(i.getType()==="Circle"&&t.index===Mp)return Vu(i.getClosestPoint(ji(s)));const r=ji(s);return xu[0]=ji(t.segment[0]),xu[1]=ji(t.segment[1]),Vu(Tk(r,xu))}function Wct(){const s=hN();return function(t,e){return s.Point}}const Xct=Vct,bm={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};let wm=class extends mn{constructor(t,e){super(t),this.feature=e}};function qct(s,t){const e=[];for(let i=0;i<t.length;++i){const r=t[i].getGeometry();ND(s,r,e)}return e}function Em(s,t){return ia(s[0],s[1],t[0],t[1])}function eu(s,t){const e=s.length;return t<0?s[t+e]:t>=e?s[t-e]:s[t]}function Sm(s,t,e){let i,r;t<e?(i=t,r=e):(i=e,r=t);const n=Math.ceil(i),o=Math.floor(r);if(n>o){const l=iu(s,i),h=iu(s,r);return Em(l,h)}let a=0;if(i<n){const l=iu(s,i),h=eu(s,n);a+=Em(l,h)}if(o<r){const l=eu(s,o),h=iu(s,r);a+=Em(l,h)}for(let l=n;l<o-1;++l){const h=eu(s,l),c=eu(s,l+1);a+=Em(h,c)}return a}function ND(s,t,e){if(t instanceof dn){Cm(s,t.getCoordinates(),!1,e);return}if(t instanceof Zh){const i=t.getCoordinates();for(let r=0,n=i.length;r<n;++r)Cm(s,i[r],!1,e);return}if(t instanceof Zs){const i=t.getCoordinates();for(let r=0,n=i.length;r<n;++r)Cm(s,i[r],!0,e);return}if(t instanceof wd){const i=t.getCoordinates();for(let r=0,n=i.length;r<n;++r){const o=i[r];for(let a=0,l=o.length;a<l;++a)Cm(s,o[a],!0,e)}return}if(t instanceof oa){const i=t.getGeometries();for(let r=0;r<i.length;++r)ND(s,i[r],e);return}}const Ox={index:-1,endIndex:NaN};function Yct(s,t,e,i){const r=s[0],n=s[1];let o=1/0,a=-1,l=NaN;for(let u=0;u<t.targets.length;++u){const d=t.targets[u],p=d.coordinates;let g=1/0,f;for(let m=0;m<p.length-1;++m){const _=p[m],y=p[m+1],v=DD(r,n,_,y);v.squaredDistance<g&&(g=v.squaredDistance,f=m+v.along)}g<o&&(o=g,d.ring&&t.targetIndex===u&&(d.endIndex>d.startIndex?f<d.startIndex&&(f+=p.length):d.endIndex<d.startIndex&&f>d.startIndex&&(f-=p.length)),l=f,a=u)}const h=t.targets[a];let c=h.ring;if(t.targetIndex===a&&c){const u=iu(h.coordinates,l),d=e.getPixelFromCoordinate(u);G0(d,t.startPx)>i&&(c=!1)}if(c){const u=h.coordinates,d=u.length,p=h.startIndex,g=l;if(p<g){const f=Sm(u,p,g);Sm(u,p,g-d)<f&&(l-=d)}else{const f=Sm(u,p,g);Sm(u,p,g+d)<f&&(l+=d)}}return Ox.index=a,Ox.endIndex=l,Ox}function Cm(s,t,e,i){const r=s[0],n=s[1];for(let o=0,a=t.length-1;o<a;++o){const l=t[o],h=t[o+1],c=DD(r,n,l,h);if(c.squaredDistance===0){const u=o+c.along;i.push({coordinates:t,ring:e,startIndex:u,endIndex:u});return}}}const Fx={along:0,squaredDistance:0};function DD(s,t,e,i){const r=e[0],n=e[1],o=i[0],a=i[1],l=o-r,h=a-n;let c=0,u=r,d=n;return(l!==0||h!==0)&&(c=Oi(((s-r)*l+(t-n)*h)/(l*l+h*h),0,1),u+=l*c,d+=h*c),Fx.along=c,Fx.squaredDistance=gf(ia(s,t,u,d),10),Fx}function iu(s,t){const e=s.length;let i=Math.floor(t);const r=t-i;i>=e?i-=e:i<0&&(i+=e);let n=i+1;n>=e&&(n-=e);const o=s[i],a=o[0],l=o[1],h=s[n],c=h[0]-a,u=h[1]-l;return[a+c*r,l+u*r]}class Zct extends Yh{constructor(t){const e=t;e.stopDown||(e.stopDown=md),super(e),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=t.source?t.source:null,this.features_=t.features?t.features:null,this.snapTolerance_=t.snapTolerance?t.snapTolerance:12,this.type_=t.type,this.mode_=Qct(this.type_),this.stopClick_=!!t.stopClick,this.minPoints_=t.minPoints?t.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:t.maxPoints?t.maxPoints:1/0,this.finishCondition_=t.finishCondition?t.finishCondition:ju,this.geometryLayout_=t.geometryLayout?t.geometryLayout:"XY";let i=t.geometryFunction;if(!i){const r=this.mode_;if(r==="Circle")i=function(n,o,a){const l=o||new jnt([NaN,NaN]),h=ji(n[0]),c=Uu(h,ji(n[n.length-1]));return l.setCenterAndRadius(h,Math.sqrt(c),this.geometryLayout_),l};else{let n;r==="Point"?n=un:r==="LineString"?n=dn:r==="Polygon"&&(n=Zs),i=function(o,a,l){return a?r==="Polygon"?o[0].length?a.setCoordinates([o[0].concat([o[0][0]])],this.geometryLayout_):a.setCoordinates([],this.geometryLayout_):a.setCoordinates(o,this.geometryLayout_):a=new n(o,this.geometryLayout_),a}}}this.geometryFunction_=i,this.dragVertexDelay_=t.dragVertexDelay!==void 0?t.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=t.clickTolerance?t.clickTolerance*t.clickTolerance:36,this.overlay_=new n2({source:new a2({useSpatialIndex:!1,wrapX:t.wrapX?t.wrapX:!1}),style:t.style?t.style:Kct(),updateWhileInteracting:!0}),this.geometryName_=t.geometryName,this.condition_=t.condition?t.condition:HS,this.freehandCondition_,t.freehand?this.freehandCondition_=K0:this.freehandCondition_=t.freehandCondition?t.freehandCondition:CN,this.traceCondition_,this.setTrace(t.trace||!1),this.traceState_={active:!1},this.traceSource_=t.traceSource||t.source||null,this.addChangeListener(db.ACTIVE,this.updateState_)}setTrace(t){let e;t?t===!0?e=K0:e=t:e=unt,this.traceCondition_=e}setMap(t){super.setMap(t),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(t){t.originalEvent.type===Mt.CONTEXTMENU&&t.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(t);let e=t.type===we.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&t.type===we.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=t.pixel,this.shouldHandle_=!this.freehand_,e=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&t.type===we.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(t.coordinate),i=!1):this.freehand_&&t.type===we.POINTERDOWN?i=!1:e&&this.getPointerCount()<2?(i=t.type===we.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(t),this.shouldHandle_&&t.originalEvent.preventDefault()):(t.originalEvent.pointerType==="mouse"||t.type===we.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(t)):t.type===we.DBLCLICK&&(i=!1),super.handleEvent(t)&&i}handleDownEvent(t){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=t.pixel,this.finishCoordinate_||this.startDrawing_(t.coordinate),!0):this.condition_(t)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new Bo(we.POINTERMOVE,t.map,t.originalEvent,!1,t.frameState))},this.dragVertexDelay_),this.downPx_=t.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(t){if(!this.traceSource_||!this.traceCondition_(t))return;if(this.traceState_.active){this.deactivateTrace_();return}const e=this.getMap(),i=e.getCoordinateFromPixel([t.pixel[0]-this.snapTolerance_,t.pixel[1]+this.snapTolerance_]),r=e.getCoordinateFromPixel([t.pixel[0]+this.snapTolerance_,t.pixel[1]-this.snapTolerance_]),n=yr([i,r]),o=this.traceSource_.getFeaturesInExtent(n);if(o.length===0)return;const a=qct(t.coordinate,o);a.length&&(this.traceState_={active:!0,startPx:t.pixel.slice(),targets:a,targetIndex:-1})}addOrRemoveTracedCoordinates_(t,e){const i=t.startIndex<=t.endIndex,r=t.startIndex<=e;i===r?i&&e>t.endIndex||!i&&e<t.endIndex?this.addTracedCoordinates_(t,t.endIndex,e):(i&&e<t.endIndex||!i&&e>t.endIndex)&&this.removeTracedCoordinates_(e,t.endIndex):(this.removeTracedCoordinates_(t.startIndex,t.endIndex),this.addTracedCoordinates_(t,t.startIndex,e))}removeTracedCoordinates_(t,e){if(t===e)return;let i=0;if(t<e){const r=Math.ceil(t);let n=Math.floor(e);n===e&&(n-=1),i=n-r+1}else{const r=Math.floor(t);let n=Math.ceil(e);n===e&&(n+=1),i=r-n+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(t,e,i){if(e===i)return;const r=[];if(e<i){const n=Math.ceil(e);let o=Math.floor(i);o===i&&(o-=1);for(let a=n;a<=o;++a)r.push(eu(t.coordinates,a))}else{const n=Math.floor(e);let o=Math.ceil(i);o===i&&(o+=1);for(let a=n;a>=o;--a)r.push(eu(t.coordinates,a))}r.length&&this.appendCoordinates(r)}updateTrace_(t){const e=this.traceState_;if(!e.active||e.targetIndex===-1&&G0(e.startPx,t.pixel)<this.snapTolerance_)return;const i=Yct(t.coordinate,e,this.getMap(),this.snapTolerance_);if(e.targetIndex!==i.index){if(e.targetIndex!==-1){const l=e.targets[e.targetIndex];this.removeTracedCoordinates_(l.startIndex,l.endIndex)}const a=e.targets[i.index];this.addTracedCoordinates_(a,a.startIndex,i.endIndex)}else{const a=e.targets[e.targetIndex];this.addOrRemoveTracedCoordinates_(a,i.endIndex)}e.targetIndex=i.index;const r=e.targets[e.targetIndex];r.endIndex=i.endIndex;const n=iu(r.coordinates,r.endIndex),o=this.getMap().getPixelFromCoordinate(n);t.coordinate=n,t.pixel=[Math.round(o[0]),Math.round(o[1])]}handleUpEvent(t){let e=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(t);const i=this.traceState_.active;if(this.toggleTraceState_(t),this.shouldHandle_){const r=!this.finishCoordinate_;r&&this.startDrawing_(t.coordinate),!r&&this.freehand_?this.finishDrawing():!this.freehand_&&(!r||this.mode_==="Point")&&(this.atFinish_(t.pixel,i)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t.coordinate)),e=!1}else this.freehand_&&this.abortDrawing()}return!e&&this.stopClick_&&t.preventDefault(),e}handlePointerMove_(t){if(this.pointerType_=t.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const e=this.downPx_,i=t.pixel,r=e[0]-i[0],n=e[1]-i[1],o=r*r+n*n;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(t.coordinate.slice());return}this.updateTrace_(t),this.modifyDrawing_(t.coordinate)}atFinish_(t,e){let i=!1;if(this.sketchFeature_){let r=!1,n=[this.finishCoordinate_];const o=this.mode_;if(o==="Point")i=!0;else if(o==="Circle")i=this.sketchCoords_.length===2;else if(o==="LineString")r=!e&&this.sketchCoords_.length>this.minPoints_;else if(o==="Polygon"){const a=this.sketchCoords_;r=a[0].length>this.minPoints_,n=[a[0][0],a[0][a[0].length-2]],e?n=[a[0][0]]:n=[a[0][0],a[0][a[0].length-2]]}if(r){const a=this.getMap();for(let l=0,h=n.length;l<h;l++){const c=n[l],u=a.getPixelFromCoordinate(c),d=t[0]-u[0],p=t[1]-u[1],g=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(d*d+p*p)<=g,i){this.finishCoordinate_=c;break}}}}return i}createOrUpdateSketchPoint_(t){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(t):(this.sketchPoint_=new In(new un(t)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(t){this.sketchLine_||(this.sketchLine_=new In);const e=t.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(e.getLayout(),e.getFlatCoordinates()),i.changed()):(i=new dn(e.getFlatCoordinates(),e.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(t){const e=this.getMap().getView().getProjection(),i=B0(this.geometryLayout_);for(;t.length<i;)t.push(0);this.finishCoordinate_=t,this.mode_==="Point"?this.sketchCoords_=t.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[t.slice(),t.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[t.slice(),t.slice()],this.sketchLineCoords_&&(this.sketchLine_=new In(new dn(this.sketchLineCoords_)));const r=this.geometryFunction_(this.sketchCoords_,void 0,e);this.sketchFeature_=new In,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(r),this.updateSketchFeatures_(),this.dispatchEvent(new wm(bm.DRAWSTART,this.sketchFeature_))}modifyDrawing_(t){const e=this.getMap(),i=this.sketchFeature_.getGeometry(),r=e.getView().getProjection(),n=B0(this.geometryLayout_);let o,a;for(;t.length<n;)t.push(0);this.mode_==="Point"?a=this.sketchCoords_:this.mode_==="Polygon"?(o=this.sketchCoords_[0],a=o[o.length-1],this.atFinish_(e.getPixelFromCoordinate(t))&&(t=this.finishCoordinate_.slice())):(o=this.sketchCoords_,a=o[o.length-1]),a[0]=t[0],a[1]=t[1],this.geometryFunction_(this.sketchCoords_,i,r),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(t),i.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(t){const e=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let r,n;const o=this.mode_;return o==="LineString"||o==="Circle"?(this.finishCoordinate_=t.slice(),n=this.sketchCoords_,n.length>=this.maxPoints_&&(this.freehand_?n.pop():r=!0),n.push(t.slice()),this.geometryFunction_(n,e,i)):o==="Polygon"&&(n=this.sketchCoords_[0],n.length>=this.maxPoints_&&(this.freehand_?n.pop():r=!0),n.push(t.slice()),r&&(this.finishCoordinate_=n[0]),this.geometryFunction_(this.sketchCoords_,e,i)),this.createOrUpdateSketchPoint_(t.slice()),this.updateSketchFeatures_(),r?this.finishDrawing():this.sketchFeature_}removeLastPoints_(t){if(!this.sketchFeature_)return;const e=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),r=this.mode_;for(let n=0;n<t;++n){let o;if(r==="LineString"||r==="Circle"){if(o=this.sketchCoords_,o.splice(-2,1),o.length>=2){this.finishCoordinate_=o[o.length-2].slice();const a=this.finishCoordinate_.slice();o[o.length-1]=a,this.createOrUpdateSketchPoint_(a)}this.geometryFunction_(o,e,i),e.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(e)}else if(r==="Polygon"){o=this.sketchCoords_[0],o.splice(-2,1);const a=this.sketchLine_.getGeometry();if(o.length>=2){const l=o[o.length-2].slice();o[o.length-1]=l,this.createOrUpdateSketchPoint_(l)}a.setCoordinates(o),this.geometryFunction_(this.sketchCoords_,e,i)}if(o.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const t=this.abortDrawing_();if(!t)return null;let e=this.sketchCoords_;const i=t.getGeometry(),r=this.getMap().getView().getProjection();return this.mode_==="LineString"?(e.pop(),this.geometryFunction_(e,i,r)):this.mode_==="Polygon"&&(e[0].pop(),this.geometryFunction_(e,i,r),e=i.getCoordinates()),this.type_==="MultiPoint"?t.setGeometry(new bd([e])):this.type_==="MultiLineString"?t.setGeometry(new Zh([e])):this.type_==="MultiPolygon"&&t.setGeometry(new wd([e])),this.dispatchEvent(new wm(bm.DRAWEND,t)),this.features_&&this.features_.push(t),this.source_&&this.source_.addFeature(t),t}abortDrawing_(){this.finishCoordinate_=null;const t=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),t}abortDrawing(){const t=this.abortDrawing_();t&&this.dispatchEvent(new wm(bm.DRAWABORT,t))}appendCoordinates(t){const e=this.mode_,i=!this.sketchFeature_;i&&this.startDrawing_(t[0]);let r;if(e==="LineString"||e==="Circle")r=this.sketchCoords_;else if(e==="Polygon")r=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;i&&r.shift(),r.pop();for(let o=0;o<t.length;o++)this.addToDrawing_(t[o]);const n=t[t.length-1];this.sketchFeature_=this.addToDrawing_(n),this.modifyDrawing_(n)}extend(t){const e=t.getGeometry();this.sketchFeature_=t,this.sketchCoords_=e.getCoordinates();const i=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=i.slice(),this.sketchCoords_.push(i.slice()),this.sketchPoint_=new In(new un(i)),this.updateSketchFeatures_(),this.dispatchEvent(new wm(bm.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const t=[];this.sketchFeature_&&t.push(this.sketchFeature_),this.sketchLine_&&t.push(this.sketchLine_),this.sketchPoint_&&t.push(this.sketchPoint_);const e=this.overlay_.getSource();e.clear(!0),e.addFeatures(t)}updateState_(){const t=this.getMap(),e=this.getActive();(!t||!e)&&this.abortDrawing(),this.overlay_.setMap(e?t:null)}}function Kct(){const s=hN();return function(t,e){return s[t.getGeometry().getType()]}}function Jct(){return function(s,t,e){const i=yr([s[0],s[s.length-1]].map(function(n){return ji(n)})),r=[[Bu(i),_d(i),_f(i),Co(i),Bu(i)]];return t?t.setCoordinates(r):t=new Zs(r),t}}function Qct(s){switch(s){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+s)}}const tut=Zct,p2={dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"};function GM(s,t,e,i){const r=new CustomEvent(t,{detail:{originalEvent:e,geoJSON:i}});s.dispatchEvent(r)}function $D(s,t,e,i=!1,r=!1){const n=i?[s.feature]:s.features;r&&t.getSource().clear();const o=t.getSource().getFeatures();if(!t.get("multipleFeatures")&&(o.length||n.length>1))return console.error("Multiple features detected!");n.forEach(h=>{const c=h.getGeometry();if(c instanceof dn){const d=Rk(c,{radius:6378137,projection:"EPSG:3857"});h.set("measure",d)}else if(c instanceof Zs){const d=Mk(c,{radius:6378137,projection:"EPSG:3857"});h.set("measure",d)}const u=Nt(h);h.set("id",u),h.setId(u)}),!i&&n.length&&(t.getSource().addFeatures(n),e.map.getView().fit(t.getSource().getExtent(),{duration:750}));const a=new $y,l=JSON.parse(a.writeFeatures(n,p2));(i||r)&&GM(e,"drawend",s,l),GM(e,"addfeatures",s,l)}function eut(s,t,e,i=!1){try{const r=iut(s);if(!r){console.error("Unsupported format or invalid data");return}const n=r.readFeatures(s,p2);$D({features:n},t,e,!1,i)}catch(r){console.error("Error parsing data:",r)}}function iut(s){return sut(s)?new $y:rut(s)?new elt({extractStyles:!1}):nut(s)?new Glt:null}function sut(s){try{const t=JSON.parse(s);return t.type==="FeatureCollection"||t.type==="Feature"}catch{return!1}}function rut(s){return s.includes("<kml")&&s.includes("</kml>")}function nut(s){try{const t=JSON.parse(s);return t.type==="Topology"&&t.objects}catch{return!1}}function out(s,t,e){const i=Object.assign({},e);if(s.interactions[i.id])throw Error(`Interaction with id: ${i.id} already exists.`);i.modify=typeof i.modify=="boolean"?i.modify:!0;const r=t.getSource();i.type==="Box"&&(i.geometryFunction=Jct(),i.type="Circle");const n=new tut({...i,source:r});i.active===!1&&n.setActive(!1),n.on("drawend",l=>{t.get("isDrawingEnabled")&&$D(l,t,s,!0)}),s.map.addInteraction(n),s.interactions[i.id]=n;const o=new Xct({source:r});o.setActive(i.modify),s.map.addInteraction(o),s.interactions[`${i.id}_modify`]=o;const a=()=>{s.getLayerById(t.get("id"))||(s.removeInteraction(i.id),s.removeInteraction(`${i.id}_modify`),s.map.getLayerGroup().un("change",a))};s.map.getLayerGroup().on("change",a)}class jD extends gu{constructor(){super(...arguments),this.templates={},this._renderedTemplates={}}setBindingSyntax(t,e){this._startExpression=t,this._endExpression=e;const i=this.escapeRegex(this._startExpression),r=this.escapeRegex(this._endExpression);this._expression=new RegExp(`${i}\\s*([$\\w\\.,'"\\s()\\[\\]]+)\\s*${r}`,"g")}hasTemplate(t){return this.templates&&!!this.templates[t]}renderTemplate(t,e,i){if(!this.hasTemplate(t))return null;i=i||t;const r=pu` <slot name=${i}></slot> `,n={[t]:{...e}};if(this._renderedTemplates.hasOwnProperty(i)){const{slot:a}=this._renderedTemplates[i];this.contains(a)&&this.removeChild(a)}const o=document.createElement("div");return o.slot=i,o.dataset.generated="template",this._renderTemplate(o,this.templates[t],n),this.appendChild(o),this._renderedTemplates[i]={context:n,slot:o},r}getTemplates(){const t={};for(let e=0;e<this.children.length;e++){const i=this.children[e];if(i.nodeName==="RENDER-TEMPLATE"){const r=i;r.dataset.type?t[r.dataset.type]=r:t.default=r,r.templateOrder=e}}return t}_renderTemplate(t,e,i){let r;if(e&&e.childNodes.length){const n=e.cloneNode(!0);r=this.renderNode(n,t,i)}r&&t.appendChild(r)}expandExpressionsAsString(t,e){return t.replace(this.expression,(i,r)=>{const n=this.evalInContext(r||this.trimExpression(i),e);return n?typeof n=="object"?JSON.stringify(n):n.toString():""})}get expression(){return this._expression||this.setBindingSyntax("{{","}}"),this._expression}escapeRegex(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}evalInContext(t,e){e={...e};const i=new Function("with(this) { return "+t+";}");let r;try{r=i.call(e)}catch{}return r}trimExpression(t){return t=t.trim(),t.startsWith(this._startExpression)&&t.endsWith(this._endExpression)&&(t=t.substr(this._startExpression.length,t.length-this._startExpression.length-this._endExpression.length),t=t.trim()),t}renderNode(t,e,i){if(t.nodeName==="#text")return t.textContent=this.expandExpressionsAsString(t.textContent,i),t;if(t.nodeName==="TEMPLATE")return t.$parentTemplateContext=i,t;for(let r=0;r<t.childNodes.length;r++){const n=t.childNodes[r];this.renderNode(n,e,i)}return t}firstUpdated(){this.templates=this.getTemplates()}}var aut=Object.defineProperty,lut=Object.getOwnPropertyDescriptor,hut=(s,t,e,i)=>{for(var r=i>1?void 0:i?lut(t,e):t,n=s.length-1,o;n>=0;n--)(o=s[n])&&(r=(i?o(t,e,r):o(r))||r);return i&&r&&aut(t,e,r),r};class GD extends jD{constructor(){super(),this.propertyTransform=(t,e)=>t}renderContent(t){_k(this.hasTemplate("properties")?pu`${this.renderTemplate("properties",t.getProperties(),"tooltip-1")}`:pu` <style>
              ul {
                margin: 0;
                padding: 15px 15px 15px 30px;
                background: #0008;
                border-radius: 15px;
                color: white;
                max-width: 250px;
                font-size: small;
              }
              span {
                font-weight: bold;
              }
            </style>
            <ul>
              ${Object.entries(t.getProperties()).map(([e,i])=>this.propertyTransform({key:e,value:i},t)).filter(e=>e).map(({key:e,value:i})=>pu`<li><span>${e}</span>: ${i}</li>`)}
            </ul>`,this.shadowRoot)}}hut([Ma()],GD.prototype,"propertyTransform",2);customElements.define("eox-map-tooltip",GD);class cut{constructor(t,e,i){var r,n;this.eoxMap=t,this.selectLayer=e,this.options=i,this.active=i.active||e.getVisible(),this.panIn=i.panIn||!1;const o=this.eoxMap.map.getOverlayById("eox-map-tooltip");let a;this.selectedFids=[],o?(this.tooltip=o.getElement(),a=o):(this.tooltip=this.eoxMap.querySelector("eox-map-tooltip")||((r=i.overlay)==null?void 0:r.element),this.tooltip&&(a=new kD({element:this.tooltip,position:void 0,offset:[0,0],positioning:"top-left",className:"eox-map-tooltip",id:"eox-map-tooltip",...i.overlay}),this.eoxMap.map.addOverlay(a)));const l=()=>{a&&i.condition==="pointermove"&&a.setPosition(void 0)};t.map.on("change:target",g=>{var f,m;(f=g.oldValue)==null||f.removeEventListener("pointerleave",l),(m=g.target.getTargetElement())==null||m.addEventListener("pointerleave",l)}),(n=t.map.getTargetElement())==null||n.addEventListener("pointerleave",l);let h;if(this.options.layer)h=this.options.layer;else{const g=this.selectLayer.get("_jsonDefinition");h={...g,style:i.style,properties:{id:this.selectLayer.get("id")+"_select"},source:{type:g.type}}}h.renderMode="vector",delete h.interactions,this.selectStyleLayer=Zu(t,h),this.selectStyleLayer.setSource(this.selectLayer.getSource()),this.selectStyleLayer.setMap(this.eoxMap.map);const c=this.selectStyleLayer.getStyleFunction();this.selectStyleLayer.setStyle((g,f)=>this.selectedFids.length&&this.selectedFids.includes(this.getId(g))?c(g,f):null);const u=g=>{this.panIn&&this.eoxMap.map.getView().fit(g.getGeometry().getExtent(),{duration:750})},d=g=>{if(!this.active)return;const f=this.eoxMap.map.getView().getZoom();g.dragging||!this.active||f<this.selectLayer.getMinZoom()||f>this.selectLayer.getMaxZoom()||this.selectLayer.getFeatures(g.pixel).then(m=>{const _=m.length?m[0]:null,y=_?[this.getId(_)]:[],v=this.selectedFids[0]!==y[0];if(this.selectedFids=y,v&&(this.selectStyleLayer.changed(),_&&u(_)),a){const E=g.pixel[0]>this.eoxMap.offsetWidth/2?"right":"left",S=g.pixel[1]>this.eoxMap.offsetHeight/2?"bottom":"top";a.setPositioning(`${S}-${E}`),a.setPosition(_?g.coordinate:null),_&&this.tooltip.renderContent&&this.tooltip.renderContent(_)}const b=new CustomEvent("select",{detail:{id:i.id,originalEvent:g,feature:_}});this.eoxMap.dispatchEvent(b)})};this.eoxMap.map.on(i.condition||"click",d),this.selectLayer.on("change:opacity",()=>{this.selectStyleLayer.setOpacity(this.selectLayer.getOpacity())}),this.selectLayer.on("change:visible",()=>{const g=this.selectLayer.getVisible();this.selectStyleLayer.setVisible(g),this.setActive(g)}),this.changeSourceListener=()=>{this.selectStyleLayer.setSource(this.selectLayer.getSource())},this.selectLayer.on("change:source",this.changeSourceListener),this.removeListener=()=>{},this.eoxMap.map.getLayers().on("remove",this.removeListener);const p=()=>{t.getLayerById(e.get("id"))||(t.selectInteractions[i.id].remove(),t.map.getLayerGroup().un("change",p))};t.map.getLayerGroup().on("change",p)}setActive(t){this.active=t}highlightById(t){this.selectedFids=t,this.selectStyleLayer.changed()}remove(){this.selectStyleLayer.setMap(null),delete this.eoxMap.selectInteractions[this.options.id],this.selectLayer.un("change:source",this.changeSourceListener),this.eoxMap.map.getLayers().un("remove",this.removeListener)}getId(t){if(this.options.idProperty)return t.get(this.options.idProperty);if(t.getId()!==void 0)return t.getId();if(t.get("id")!==void 0)return t.get("id");throw Error("No feature id found. Please provide which feature property should be taken instead using idProperty.")}}function uut(s,t,e){if(s.interactions[e.id])throw Error(`Interaction with id: ${e.id} already exists.`);return s.selectInteractions[e.id]=new cut(s,t,e),s.selectInteractions[e.id]}const dut={GeoJSON:$y,MVT:Mlt},put={Group:Nh,Image:Yht,Tile:tct,Vector:n2,VectorTile:nct},gut={ImageWMS:Mct,OSM:$ct,Tile:MD,TileWMS:Gct,Vector:a2,VectorTile:Fct,WMTS:Bct,XYZ:LD};function Zu(s,t,e=!0){var i,r;t=JSON.parse(JSON.stringify(t));const n={...dut,...window.eoxMapAdvancedOlFormats},o={...put,...window.eoxMapAdvancedOlLayers},a={...gut,...window.eoxMapAdvancedOlSources},l=o[t.type],h=a[(i=t.source)==null?void 0:i.type];if(!l)throw window.eoxMapAdvancedOlLayers?new Error(`Layer type ${t.type} not supported!`):new Error(`Layer type ${t.type} not created! Forgot to import advanced layers & sources plugin from @eox/map/dist/eox-map-advanced-layers-and-sources.js?`);if(t.source&&!h)throw window.eoxMapAdvancedOlSources?new Error(`Source type ${t.source.type} not supported!`):new Error(`Source type ${t.source.type} not created! Forgot to import advanced layers & sources plugin from @eox/map/dist/eox-map-advanced-layers-and-sources.js?`);const c=new l({...t,...t.source&&{source:new h({...t.source,...t.source.format&&{format:new n[t.source.format]},...t.source.tileGrid&&{tileGrid:c2({...t.source.tileGrid})}})},...t.type==="Group"&&{layers:[]},...t.properties,style:void 0});if(c.set("_jsonDefinition",t,!0),t.type==="Group"){const u=t.layers.reverse().map(d=>Zu(s,d));u.forEach(d=>d.set("_group",c,!0)),c.setLayers(new or(u))}if(t.style&&c.setStyle(t.style),e&&(r=t.interactions)!=null&&r.length)for(let u=0,d=t.interactions.length;u<d;u++){const p=t.interactions[u];zD(s,c,p)}return UD(c,t),c}function zD(s,t,e){e.type==="draw"?out(s,t,e.options):e.type==="select"&&uut(s,t,e.options)}function BD(s,t,e){var i,r,n,o;const a=e.get("_jsonDefinition");if(t.type!==a.type||((i=t.source)==null?void 0:i.type)!==((r=a.source)==null?void 0:r.type))throw new Error("Layers are not compatible to be updated");const l=Zu(s,t,!1);if(JSON.stringify(t.source)!==JSON.stringify(a.source)&&e.setSource(l.getSource()),["Vector","VectorTile"].includes(t.type)&&JSON.stringify(t.style)!==JSON.stringify(a.style)&&e.setStyle(l.getStyle()),JSON.stringify(t.properties)!==JSON.stringify(a.properties)&&e.setProperties(t.properties),t.visible!==a.visible&&e.setVisible(t.visible),t.opacity!==a.opacity&&e.setOpacity(t.opacity),JSON.stringify(t.interactions)!==JSON.stringify(a.interactions)&&((n=a.interactions)==null||n.forEach(h=>{const c=t.interactions.find(u=>u.type===h.type);c?c.type==="draw"?(s.interactions[c.options.id].setActive(c.options.active),s.interactions[`${c.options.id}_modify`].setActive(c.options.modify)):s.selectInteractions[c.options.id].setActive(c.options.active):s.removeInteraction(h.options.id)}),(o=t.interactions)==null||o.forEach(h=>{a.interactions.find(c=>c.type===h.type)||zD(s,e,h)})),t.type==="Group"){const h=t.layers.map(u=>{var d;return(d=u.properties)==null?void 0:d.id}),c=e.getLayers();c.forEach(u=>{h.includes(u.get("id"))||c.remove(u)}),t.layers.forEach(u=>{const d=u.properties.id;if(c.getArray().map(p=>p.get("id")).includes(d))BD(s,u,s.getLayerById(d));else{const p=Zu(s,u);c.push(p)}}),c.getArray().sort((u,d)=>h.indexOf(u.get("id"))-h.indexOf(d.get("id"))),c.changed()}return UD(e,t),e}const fut=(s,t)=>t?[...t].reverse().map(e=>Zu(s,e)):[];function UD(s,t){s.on("change:opacity",()=>{t.opacity=s.getOpacity()}),s.on("change:visible",()=>{t.visible=s.getVisible()}),s.on("change:zIndex",()=>{t.zIndex=s.getZIndex()}),s.on("propertychange",e=>{e.key!=="map"&&(t.properties[e.key]=e.target.get(e.key))})}function kx(s,t){return VD(s.map.getLayers().getArray()).find(e=>e.get("id")===t)}function VD(s){const t=[];t.push(...s);let e=t.filter(i=>i instanceof Nh);for(;e.length;){const i=[];for(let r=0,n=e.length;r<n;r++){const o=e[r].getLayers().getArray();t.push(...o),i.push(...o.filter(a=>a instanceof Nh))}e=i}return t}function zM(s){if(s){const t=s;return!en(t,[0,0])&&t[0]>=-180&&t[0]<=180&&t[1]>=-90&&t[1]<=90?Lit(t):t}return[0,0]}const BM=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange"],UM={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class mut extends To{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target}),this.on,this.once,this.un,this.keys_=t.keys!==void 0?t.keys:!1,this.source_=t.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=t.className!==void 0?t.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=t.activeClassName!==void 0?t.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=t.inactiveClassName!==void 0?t.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const e=t.label!==void 0?t.label:"⤢";this.labelNode_=typeof e=="string"?document.createTextNode(e):e;const i=t.labelActive!==void 0?t.labelActive:"×";this.labelActiveNode_=typeof i=="string"?document.createTextNode(i):i;const r=t.tipLabel?t.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=r,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(Mt.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${vo} ${qh}`,this.element.appendChild(this.button_)}handleClick_(t){t.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const t=this.getMap();if(!t)return;const e=t.getOwnerDocument();if(VM(e))if(HM(e))yut(e);else{let i;this.source_?i=typeof this.source_=="string"?e.getElementById(this.source_):this.source_:i=t.getTargetElement(),this.keys_?_ut(i):HD(i)}}handleFullScreenChange_(){const t=this.getMap();if(!t)return;const e=this.isInFullscreen_;this.isInFullscreen_=HM(t.getOwnerDocument()),e!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(Wu(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(UM.ENTERFULLSCREEN)):(Wu(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(UM.LEAVEFULLSCREEN)),t.updateSize())}setClassName_(t,e){e?(t.classList.remove(...this.inactiveClassName_),t.classList.add(...this.activeClassName_)):(t.classList.remove(...this.activeClassName_),t.classList.add(...this.inactiveClassName_))}setMap(t){const e=this.getMap();e&&e.removeChangeListener(Yi.TARGET,this.boundHandleMapTargetChange_),super.setMap(t),this.handleMapTargetChange_(),t&&t.addChangeListener(Yi.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const t=this.documentListeners_;for(let i=0,r=t.length;i<r;++i)ii(t[i]);t.length=0;const e=this.getMap();if(e){const i=e.getOwnerDocument();VM(i)?this.element.classList.remove(QR):this.element.classList.add(QR);for(let r=0,n=BM.length;r<n;++r)t.push(ae(i,BM[r],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function VM(s){const t=s.body;return!!(t.webkitRequestFullscreen||t.requestFullscreen&&s.fullscreenEnabled)}function HM(s){return!!(s.webkitIsFullScreen||s.fullscreenElement)}function HD(s){s.requestFullscreen?s.requestFullscreen():s.webkitRequestFullscreen&&s.webkitRequestFullscreen()}function _ut(s){s.webkitRequestFullscreen?s.webkitRequestFullscreen():HD(s)}function yut(s){s.exitFullscreen?s.exitFullscreen():s.webkitExitFullscreen&&s.webkitExitFullscreen()}const xut=mut,Nx="projection",WM="coordinateFormat";class vut extends To{constructor(t){t=t||{};const e=document.createElement("div");e.className=t.className!==void 0?t.className:"ol-mouse-position",super({element:e,render:t.render,target:t.target}),this.on,this.once,this.un,this.addChangeListener(Nx,this.handleProjectionChanged_),t.coordinateFormat&&this.setCoordinateFormat(t.coordinateFormat),t.projection&&this.setProjection(t.projection),this.renderOnMouseOut_=t.placeholder!==void 0,this.placeholder_=this.renderOnMouseOut_?t.placeholder:"&#160;",this.renderedHTML_=e.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=t.wrapX!==!1}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(WM)}getProjection(){return this.get(Nx)}handleMouseMove(t){const e=this.getMap();this.updateHTML_(e.getEventPixel(t))}handleMouseOut(t){this.updateHTML_(null)}setMap(t){if(super.setMap(t),t){const e=t.getViewport();this.listenerKeys.push(ae(e,eo.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(ae(e,eo.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(t){this.set(WM,t)}setProjection(t){this.set(Nx,si(t))}updateHTML_(t){let e=this.placeholder_;if(t&&this.mapProjection_){if(!this.transform_){const r=this.getProjection();r?this.transform_=yf(this.mapProjection_,r):this.transform_=aS}const i=this.getMap().getCoordinateFromPixelInternal(t);if(i){if(this.transform_(i,i),this.wrapX_){const n=this.getProjection()||this.mapProjection_;Ty(i,n)}const r=this.getCoordinateFormat();r?e=r(i):e=i.toString()}}(!this.renderedHTML_||e!==this.renderedHTML_)&&(this.element.innerHTML=e,this.renderedHTML_=e)}render(t){const e=t.frameState;e?this.mapProjection_!=e.viewState.projection&&(this.mapProjection_=e.viewState.projection,this.transform_=null):this.mapProjection_=null}}const but=vut,Dx=.75,Tm=.1;class wut extends To{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=t.rotateWithView!==void 0?t.rotateWithView:!1,this.viewExtent_=void 0;const e=t.className!==void 0?t.className:"ol-overviewmap",i=t.tipLabel!==void 0?t.tipLabel:"Overview map",r=t.collapseLabel!==void 0?t.collapseLabel:"‹";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r):this.collapseLabel_=r;const n=t.label!==void 0?t.label:"›";typeof n=="string"?(this.label_=document.createElement("span"),this.label_.textContent=n):this.label_=n;const o=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,a=document.createElement("button");a.setAttribute("type","button"),a.title=i,a.appendChild(o),a.addEventListener(Mt.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=t.view;const l=new AN({view:t.view,controls:new or,interactions:new or});this.ovmap_=l,t.layers&&t.layers.forEach(function(y){l.addLayer(y)});const h=document.createElement("div");h.className="ol-overviewmap-box",h.style.boxSizing="border-box",this.boxOverlay_=new kD({position:[0,0],positioning:"center-center",element:h}),this.ovmap_.addOverlay(this.boxOverlay_);const c=e+" "+vo+" "+qh+(this.collapsed_&&this.collapsible_?" "+W0:"")+(this.collapsible_?"":" ol-uncollapsible"),u=this.element;u.className=c,u.appendChild(this.ovmapDiv_),u.appendChild(a);const d=this,p=this.boxOverlay_,g=this.boxOverlay_.getElement(),f=function(y){return{clientX:y.clientX,clientY:y.clientY}},m=function(y){const v=f(y),b=l.getEventCoordinateInternal(v);p.setPosition(b)},_=function(y){const v=l.getEventCoordinateInternal(y);d.getMap().getView().setCenterInternal(v),window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",_)};g.addEventListener("mousedown",function(){window.addEventListener("mousemove",m),window.addEventListener("mouseup",_)})}setMap(t){const e=this.getMap();if(t!==e){if(e){const i=e.getView();i&&this.unbindView_(i),this.ovmap_.setTarget(null)}if(super.setMap(t),t){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(ae(t,Fh.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const i=t.getView();i&&(this.bindView_(i),i.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(t){if(t.key===Yi.VIEW){const e=t.oldValue;e&&this.unbindView_(e);const i=this.getMap().getView();this.bindView_(i)}else!this.ovmap_.isRendered()&&(t.key===Yi.TARGET||t.key===Yi.SIZE)&&this.ovmap_.updateSize()}bindView_(t){if(!this.view_){const e=new Mn({projection:t.getProjection()});this.ovmap_.setView(e)}t.addChangeListener(kr.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_()}unbindView_(t){t.removeChangeListener(kr.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const t=this.getMap(),e=this.ovmap_;if(!t.isRendered()||!e.isRendered())return;const i=t.getSize(),r=t.getView().calculateExtentInternal(i);if(this.viewExtent_&&Ll(r,this.viewExtent_))return;this.viewExtent_=r;const n=e.getSize(),o=e.getView().calculateExtentInternal(n),a=e.getPixelFromCoordinateInternal(Co(r)),l=e.getPixelFromCoordinateInternal(_d(r)),h=Math.abs(a[0]-l[0]),c=Math.abs(a[1]-l[1]),u=n[0],d=n[1];h<u*Tm||c<d*Tm||h>u*Dx||c>d*Dx?this.resetExtent_():an(o,r)||this.recenter_()}resetExtent_(){const t=this.getMap(),e=this.ovmap_,i=t.getSize(),r=t.getView().calculateExtentInternal(i),n=e.getView(),o=Math.log(Dx/Tm)/Math.LN2,a=1/(Math.pow(2,o/2)*Tm);bit(r,a),n.fitInternal(V0(r))}recenter_(){const t=this.getMap(),e=this.ovmap_,i=t.getView();e.getView().setCenterInternal(i.getCenterInternal())}updateBox_(){const t=this.getMap(),e=this.ovmap_;if(!t.isRendered()||!e.isRendered())return;const i=t.getSize(),r=t.getView(),n=e.getView(),o=this.rotateWithView_?0:-r.getRotation(),a=this.boxOverlay_,l=this.boxOverlay_.getElement(),h=r.getCenterInternal(),c=r.getResolution(),u=n.getResolution(),d=i[0]*c/u,p=i[1]*c/u;if(a.setPosition(h),l){l.style.width=d+"px",l.style.height=p+"px";const g="rotate("+o+"rad)";l.style.transform=g}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=pg(this.ovmap_,Jn.POSTRENDER,function(t){delete this.ovmapPostrenderKey_,this.updateBox_()},this))}handleClick_(t){t.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(W0),this.collapsed_?Wu(this.collapseLabel_,this.label_):Wu(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const t=this.ovmap_;if(!this.collapsed_){if(t.isRendered()){this.viewExtent_=void 0,t.render();return}t.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),!t&&this.collapsed_&&this.handleToggle_())}setCollapsed(t){!this.collapsible_||this.collapsed_===t||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(t){this.rotateWithView_!==t&&(this.rotateWithView_=t,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(t){this.validateExtent_(),this.updateBox_()}}const Eut=wut,$x="units",Sut=[1,2,5],Wd=25.4/.28;class Cut extends To{constructor(t){t=t||{};const e=document.createElement("div");e.style.pointerEvents="none",super({element:e,render:t.render,target:t.target}),this.on,this.once,this.un;const i=t.className!==void 0?t.className:t.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" "+vo,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=t.minWidth!==void 0?t.minWidth:64,this.maxWidth_=t.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener($x,this.handleUnitsChanged_),this.setUnits(t.units||"metric"),this.scaleBar_=t.bar||!1,this.scaleBarSteps_=t.steps||4,this.scaleBarText_=t.text||!1,this.dpi_=t.dpi||void 0}getUnits(){return this.get($x)}handleUnitsChanged_(){this.updateElement_()}setUnits(t){this.set($x,t)}setDpi(t){this.dpi_=t}updateElement_(){const t=this.viewState_;if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=t.center,i=t.projection,r=this.getUnits(),n=r=="degrees"?"degrees":"m";let o=z0(i,t.resolution,e,n);const a=this.minWidth_*(this.dpi_||Wd)/Wd,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||Wd)/Wd:void 0;let h=a*o,c="";if(r=="degrees"){const v=zu.degrees;h*=v,h<v/60?(c="″",o*=3600):h<v?(c="′",o*=60):c="°"}else if(r=="imperial")h<.9144?(c="in",o/=.0254):h<1609.344?(c="ft",o/=.3048):(c="mi",o/=1609.344);else if(r=="nautical")o/=1852,c="NM";else if(r=="metric")h<1e-6?(c="nm",o*=1e9):h<.001?(c="μm",o*=1e6):h<1?(c="mm",o*=1e3):h<1e3?c="m":(c="km",o/=1e3);else if(r=="us")h<.9144?(c="in",o*=39.37):h<1609.344?(c="ft",o/=.30480061):(c="mi",o/=1609.3472);else throw new Error("Invalid units");let u=3*Math.floor(Math.log(a*o)/Math.log(10)),d,p,g,f,m,_;for(;;){g=Math.floor(u/3);const v=Math.pow(10,g);if(d=Sut[(u%3+3)%3]*v,p=Math.round(d/o),isNaN(p)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&p>=l){d=f,p=m,g=_;break}else if(p>=a)break;f=d,m=p,_=g,++u}const y=this.scaleBar_?this.createScaleBar(p,d,c):d.toFixed(g<0?-g:0)+" "+c;this.renderedHTML_!=y&&(this.innerElement_.innerHTML=y,this.renderedHTML_=y),this.renderedWidth_!=p&&(this.innerElement_.style.width=p+"px",this.renderedWidth_=p),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(t,e,i){const r=this.getScaleForResolution(),n=r<1?Math.round(1/r).toLocaleString()+" : 1":"1 : "+Math.round(r).toLocaleString(),o=this.scaleBarSteps_,a=t/o,l=[this.createMarker("absolute")];for(let h=0;h<o;++h){const c=h%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${c}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(h%2===0||o===2?this.createStepText(h,t,!1,e,i):"")+"</div>")}return l.push(this.createStepText(o,t,!0,e,i)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${t}px;">`+n+"</div>":"")+l.join("")}createMarker(t){return`<div class="ol-scale-step-marker" style="position: ${t}; top: ${t==="absolute"?3:-10}px;"></div>`}createStepText(t,e,i,r,n){const o=(t===0?0:Math.round(r/this.scaleBarSteps_*t*100)/100)+(t===0?"":" "+n),a=t===0?-3:e/this.scaleBarSteps_*-1,l=t===0?0:e/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${a}px;text-align: ${t===0?"left":"center"};min-width: ${l}px;left: ${i?e+"px":"unset"};">`+o+"</div>"}getScaleForResolution(){const t=z0(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),e=this.dpi_||Wd,i=1e3/25.4;return t*i*e}render(t){const e=t.frameState;e?this.viewState_=e.viewState:this.viewState_=null,this.updateElement_()}}const Tut=Cut,Xd={VERTICAL:0,HORIZONTAL:1};class Rut extends To{constructor(t){t=t||{},super({target:t.target,element:document.createElement("div"),render:t.render}),this.dragListenerKeys_=[],this.currentResolution_=void 0,this.direction_=Xd.VERTICAL,this.dragging_,this.heightLimit_=0,this.widthLimit_=0,this.startX_,this.startY_,this.thumbSize_=null,this.sliderInitialized_=!1,this.duration_=t.duration!==void 0?t.duration:200;const e=t.className!==void 0?t.className:"ol-zoomslider",i=document.createElement("button");i.setAttribute("type","button"),i.className=e+"-thumb "+vo;const r=this.element;r.className=e+" "+vo+" "+qh,r.appendChild(i),r.addEventListener(eo.POINTERDOWN,this.handleDraggerStart_.bind(this),!1),r.addEventListener(eo.POINTERMOVE,this.handleDraggerDrag_.bind(this),!1),r.addEventListener(eo.POINTERUP,this.handleDraggerEnd_.bind(this),!1),r.addEventListener(Mt.CLICK,this.handleContainerClick_.bind(this),!1),i.addEventListener(Mt.CLICK,qet,!1)}setMap(t){super.setMap(t),t&&t.render()}initSlider_(){const t=this.element;let e=t.offsetWidth,i=t.offsetHeight;if(e===0&&i===0)return this.sliderInitialized_=!1;const r=getComputedStyle(t);e-=parseFloat(r.paddingRight)+parseFloat(r.paddingLeft),i-=parseFloat(r.paddingTop)+parseFloat(r.paddingBottom);const n=t.firstElementChild,o=getComputedStyle(n),a=n.offsetWidth+parseFloat(o.marginRight)+parseFloat(o.marginLeft),l=n.offsetHeight+parseFloat(o.marginTop)+parseFloat(o.marginBottom);return this.thumbSize_=[a,l],e>i?(this.direction_=Xd.HORIZONTAL,this.widthLimit_=e-a):(this.direction_=Xd.VERTICAL,this.heightLimit_=i-l),this.sliderInitialized_=!0}handleContainerClick_(t){const e=this.getMap().getView(),i=this.getRelativePosition_(t.offsetX-this.thumbSize_[0]/2,t.offsetY-this.thumbSize_[1]/2),r=this.getResolutionForPosition_(i),n=e.getConstrainedZoom(e.getZoomForResolution(r));e.animateInternal({zoom:n,duration:this.duration_,easing:Wh})}handleDraggerStart_(t){if(!this.dragging_&&t.target===this.element.firstElementChild){const e=this.element.firstElementChild;if(this.getMap().getView().beginInteraction(),this.startX_=t.clientX-parseFloat(e.style.left),this.startY_=t.clientY-parseFloat(e.style.top),this.dragging_=!0,this.dragListenerKeys_.length===0){const i=this.handleDraggerDrag_,r=this.handleDraggerEnd_,n=this.getMap().getOwnerDocument();this.dragListenerKeys_.push(ae(n,eo.POINTERMOVE,i,this),ae(n,eo.POINTERUP,r,this))}}}handleDraggerDrag_(t){if(this.dragging_){const e=t.clientX-this.startX_,i=t.clientY-this.startY_,r=this.getRelativePosition_(e,i);this.currentResolution_=this.getResolutionForPosition_(r),this.getMap().getView().setResolution(this.currentResolution_)}}handleDraggerEnd_(t){this.dragging_&&(this.getMap().getView().endInteraction(),this.dragging_=!1,this.startX_=void 0,this.startY_=void 0,this.dragListenerKeys_.forEach(ii),this.dragListenerKeys_.length=0)}setThumbPosition_(t){const e=this.getPositionForResolution_(t),i=this.element.firstElementChild;this.direction_==Xd.HORIZONTAL?i.style.left=this.widthLimit_*e+"px":i.style.top=this.heightLimit_*e+"px"}getRelativePosition_(t,e){let i;return this.direction_===Xd.HORIZONTAL?i=t/this.widthLimit_:i=e/this.heightLimit_,Oi(i,0,1)}getResolutionForPosition_(t){return this.getMap().getView().getResolutionForValueFunction()(1-t)}getPositionForResolution_(t){const e=this.getMap().getView().getValueForResolutionFunction();return Oi(1-e(t),0,1)}render(t){if(!t.frameState||!this.sliderInitialized_&&!this.initSlider_())return;const e=t.frameState.viewState.resolution;this.currentResolution_=e,this.setThumbPosition_(e)}}const Mut=Rut;class Iut extends To{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target}),this.extent=t.extent?t.extent:null;const e=t.className!==void 0?t.className:"ol-zoom-extent",i=t.label!==void 0?t.label:"E",r=t.tipLabel!==void 0?t.tipLabel:"Fit to extent",n=document.createElement("button");n.setAttribute("type","button"),n.title=r,n.appendChild(typeof i=="string"?document.createTextNode(i):i),n.addEventListener(Mt.CLICK,this.handleClick_.bind(this),!1);const o=e+" "+vo+" "+qh,a=this.element;a.className=o,a.appendChild(n)}handleClick_(t){t.preventDefault(),this.handleZoomToExtent()}handleZoomToExtent(){const t=this.getMap().getView(),e=this.extent?Pn(this.extent,t.getProjection()):t.getProjection().getExtent();t.fitInternal(V0(e))}}const Aut=Iut,Lut=Object.freeze(Object.defineProperty({__proto__:null,Attribution:xN,Control:To,FullScreen:xut,MousePosition:but,OverviewMap:Eut,Rotate:vN,ScaleLine:Tut,Zoom:bN,ZoomSlider:Mut,ZoomToExtent:Aut,defaults:wN},Symbol.toStringTag,{value:"Module"}));function Put(s,t,e,i){t&&t[e]?JSON.stringify(t[e])!==JSON.stringify(i)&&(s.removeControl(e),XM(s,e,i)):XM(s,e,i)}function XM(s,t,e){const i=Object.assign({},e);e&&e.layers&&(i.layers=fut(s,e.layers));const r=new Lut[t](i);s.map.addControl(r),s.mapControls[t]=r}var Out=Object.defineProperty,Fut=Object.getOwnPropertyDescriptor,kut=(s,t,e,i)=>{for(var r=i>1?void 0:i?Fut(t,e):t,n=s.length-1,o;n>=0;n--)(o=s[n])&&(r=(i?o(t,e,r):o(r))||r);return i&&r&&Out(t,e,r),r};class WD extends jD{constructor(){super(...arguments),this.value=50}render(){return pu`
      <style>
        :host {
          display: block;
        }
        /* Inspired by https://www.codehim.com/html5-css3/html-css-image-comparison-slider/ */
        .eox-map-compare {
          --thumb-bgc: #fff;
          --thumb-w: 0.2rem;

          position: relative;
        }
        .eox-map-compare::after {
          content: "";
          display: block;
          padding-bottom: 50%;
        }
        .eox-map-compare__first,
        .eox-map-compare__second {
          height: 100%;
          object-fit: cover;
          position: absolute;
          top: 0;
          width: 100%;
        }
        .eox-map-compare__first {
          clip-path: polygon(
            0% 0%,
            ${this.value}% 0%,
            ${this.value}% 100%,
            0% 100%
          );
        }
        .eox-map-compare__second {
          clip-path: polygon(
            100% 0%,
            ${this.value}% 0%,
            ${this.value}% 100%,
            100% 100%
          );
        }
        .eox-map-compare__range {
          background-color: transparent;
          box-sizing: border-box;
          font-family: inherit;
          height: 100%;
          margin: 0;
          outline: none;
          position: absolute;
          top: 0;
          width: 100%;
          pointer-events: none;
        }
        .eox-map-compare__range::-moz-range-thumb {
          background-color: var(--thumb-bgc);
          cursor: ew-resize;
          height: 100%;
          width: var(--thumb-w);
          pointer-events: all;
          box-shadow: 0 0 5px black;
          clip-path: inset(0 -5px 0 -5px);
        }
        .eox-map-compare__range::-webkit-slider-thumb {
          background-color: var(--thumb-bgc);
          cursor: ew-resize;
          height: 100%;
          width: var(--thumb-w);
          pointer-events: all;
          position: relative;
          box-shadow: 0 0 5px black;
          -webkit-clip-path: inset(0 -5px 0 -5px);
          clip-path: inset(0 -5px 0 -5px);
        }
        .eox-map-compare__range::-moz-range-track {
          background: transparent;
          background-size: 100%;
          box-sizing: border-box;
        }
        .eox-map-compare__range::-webkit-slider-runnable-track {
          background: transparent;
          background-size: 100%;
          box-sizing: border-box;
          height: 100%;
        }
        .eox-map-compare__range,
        .eox-map-compare__range::-webkit-slider-runnable-track,
        .eox-map-compare__range::-webkit-slider-thumb {
          -webkit-appearance: none;
          appearance: none;
        }
      </style>
      <div class="eox-map-compare">
        <div class="eox-map-compare__first">
          <slot name="first"></slot>
        </div>
        <div class="eox-map-compare__second">
          <slot name="second"></slot>
        </div>
        <input
          type="range"
          class="eox-map-compare__range"
          min="0"
          max="100"
          value=${this.value}
          @input=${t=>this.value=parseInt(t.target.value)}
        />
      </div>
    `}}kut([Ma()],WD.prototype,"value",2);customElements.define("eox-map-compare",WD);function qM(s,t=!1){t?(s.addInteraction(new J0({condition:cM})),"ontouchstart"in window||navigator.maxTouchPoints>0?s.addInteraction(new Ep({condition:function(e){return this.getPointerCount()===2||cM(e)}})):s.addInteraction(new Ep)):(s.addInteraction(new J0),s.addInteraction(new Ep))}function Nut(s){s.getInteractions().getArray().forEach(t=>{(t instanceof J0||t instanceof Ep)&&s.removeInteraction(t)})}var Dut=Object.defineProperty,$ut=Object.getOwnPropertyDescriptor,Hn=(s,t,e,i)=>{for(var r=i>1?void 0:i?$ut(t,e):t,n=s.length-1,o;n>=0;n--)(o=s[n])&&(r=(i?o(t,e,r):o(r))||r);return i&&r&&Dut(t,e,r),r};let fn=class extends gu{constructor(){super(...arguments),this.center=[0,0],this.zoom=0,this.map=new AN({controls:[],layers:[],view:new Mn({center:[0,0],zoom:0})}),this.interactions={},this.selectInteractions={},this.mapControls={},this.addOrUpdateLayer=s=>{var t;s.interactions||(s.interactions=[]);const e=(t=s.properties)==null?void 0:t.id,i=e?kx(this,e):!1;let r;return i?(BD(this,s,i),r=i):(r=Zu(this,s),this.map.addLayer(r)),r},this.removeInteraction=s=>{this.map.removeInteraction(this.interactions[s]),delete this.interactions[s],this.interactions[`${s}_modify`]&&(this.map.removeInteraction(this.interactions[`${s}_modify`]),delete this.interactions[`${s}_modify`])},this.removeSelect=s=>{this.selectInteractions[s].remove(),delete this.selectInteractions[s]},this.removeControl=s=>{this.map.removeControl(this.mapControls[s]),delete this.mapControls[s]},this.getLayerById=s=>kx(this,s),this.parseFeature=s=>new $y().writeFeaturesObject(s,p2),this.parseTextToFeature=(s,t,e=!1)=>{eut(s,t,this,e)},this.getFlatLayersArray=VD}set controls(s){const t=this._controls,e=s;if(t){const i=Object.keys(t),r=Object.keys(e);for(let n=0,o=i.length;n<o;n++){const a=i[n];r.includes(a)||this.removeControl(a)}}if(e){const i=Object.keys(s);for(let r=0,n=i.length;r<n;r++){const o=i[r];Put(this,t,o,s[o])}}this._controls=e}get controls(){return this._controls}set layers(s){const t=this._layers,e=JSON.parse(JSON.stringify(s)).reverse();t&&t.forEach(r=>{var n,o;if(!((n=r.properties)!=null&&n.id)||!e.find(a=>a.properties.id===r.properties.id)){const a=kx(this,(o=r.properties)==null?void 0:o.id);this.map.removeLayer(a)}}),e.forEach(r=>{this.addOrUpdateLayer(r)});const i=e.map(r=>{var n;return(n=r.properties)==null?void 0:n.id});this.map.getLayers().getArray().sort((r,n)=>i.indexOf(r.get("id"))-i.indexOf(n.get("id"))),this._layers=e}get layers(){return this._layers}set preventScroll(s){s?(Nut(this.map),qM(this.map,!0)):qM(this.map),this._preventScroll=s}get preventScroll(){return this._preventScroll}set config(s){var t;this._config=s,this.center=(t=s.view)==null?void 0:t.center,this.zoom=s==null?void 0:s.view.zoom,this.layers=s==null?void 0:s.layers,this.controls=s==null?void 0:s.controls,this.preventScroll===void 0&&(this.preventScroll=s==null?void 0:s.preventScroll)}get config(){return this._config}render(){return pu`
      <style>
        ${`
      :host {
        display: block;
      }
      .eox-map-tooltip {
        pointer-events: none !important;
      }
    `}
        ${Dnt}
      </style>
      <div style="width: 100%; height: 100%"></div>
      <slot></slot>
    `}buffer(s,t){return hn(s,t)}firstUpdated(){if(this.sync){const s=document.querySelector(this.sync);s&&this.map.setView(s.map.getView())}else this.center&&this.map.getView().setCenter(zM(this.center)),this.zoom&&this.map.getView().setZoom(this.zoom);this.map.setTarget(this.renderRoot.querySelector("div")),this.map.on("loadend",()=>{this.dispatchEvent(new CustomEvent("loadend",{detail:this.map}))})}updated(s){s.has("center")&&this.map.getView().setCenter(zM(this.center)),s.has("zoom")&&this.map.getView().setZoom(this.zoom||0)}};Hn([Ma({attribute:!1,type:Array})],fn.prototype,"center",2);Hn([Ma({attribute:!1,type:Array})],fn.prototype,"layers",1);Hn([Ma({attribute:"prevent-scroll",type:Boolean})],fn.prototype,"preventScroll",1);Hn([Ma({attribute:!1,type:Object})],fn.prototype,"config",1);Hn([Ma({attribute:!1,type:Number})],fn.prototype,"zoom",2);Hn([Ma()],fn.prototype,"sync",2);Hn([Ey()],fn.prototype,"map",2);Hn([Ey()],fn.prototype,"interactions",2);Hn([Ey()],fn.prototype,"selectInteractions",2);Hn([Ey()],fn.prototype,"mapControls",2);fn=Hn([Vet("eox-map")],fn);var jut=Object.defineProperty,Gut=(s,t,e)=>t in s?jut(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,zut=(s,t,e)=>(Gut(s,typeof t!="symbol"?t+"":t,e),e),g2=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)},Ip=(s,t,e)=>(g2(s,t,"read from private field"),e?e.call(s):t.get(s)),Rm=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},XD=(s,t,e,i)=>(g2(s,t,"write to private field"),i?i.call(s,e):t.set(s,e),e),qD=(s,t,e)=>(g2(s,t,"access private method"),e);const But=s=>typeof s.type!="string"&&"multiple",Uut=s=>typeof s.type=="string"&&"string",Vut=s=>!s.type&&s.properties&&"object",Hut=s=>typeof s.type=="string"&&["string","number","integer","boolean","null","array","object"].includes(s.type)&&s.type,Wut=s=>s.type==="string"&&s.format==="signature"&&"signature",Xut=s=>{if(s.type==="boolean")return s.format==="checkbox"||s.options&&s.options.checkbox?"checkbox":s.format==="select2"?"select2":s.format==="selectize"?"selectize":s.format==="choices"?"choices":"select"},qut=s=>s.type==="any"&&"multiple",Yut=s=>s.type==="string"&&s.media&&s.media.binaryEncoding==="base64"&&"base64",Zut=s=>s.type==="string"&&s.format==="url"&&window.FileReader&&s.options&&s.options.upload===Object(s.options.upload)&&"upload",Kut=s=>s.type==="array"&&s.format==="table"&&"table",Jut=s=>{if(s.enumSource)return s.format==="radio"?"radio":s.format==="select2"?"select2":s.format==="selectize"?"selectize":s.format==="choices"?"choices":"select"},Qut=s=>{if(s.enum){if(s.type==="array"||s.type==="object")return"enum";if(s.type==="number"||s.type==="integer"||s.type==="string")return s.format==="radio"?"radio":s.format==="select2"?"select2":s.format==="selectize"?"selectize":s.format==="choices"?"choices":"select"}},tdt=(s,t)=>{if(s.items&&(s.items=t.expandSchema(s.items)),s.type==="array"&&s.items&&!Array.isArray(s.items)&&["string","number","integer"].includes(s.items.type)){if(s.format==="choices")return"arrayChoices";if(s.uniqueItems){if(s.format==="selectize")return"arraySelectize";if(s.format==="select2")return"arraySelect2";if(s.items.enum)return"multiselect"}}},edt=s=>(s.oneOf||s.anyOf)&&"multiple",idt=s=>s.if&&"multiple",sdt=s=>["string","integer"].includes(s.type)&&["date","time","datetime-local"].includes(s.format)&&"datetime",rdt=s=>["string","integer"].includes(s.type)&&["starrating","rating"].includes(s.format)&&"starrating",ndt=s=>{if(s.links){for(let t=0;t<s.links.length;t++)if(s.links[t].rel&&s.links[t].rel.toLowerCase()==="describedby")return"describedBy"}},odt=s=>{if((s.type==="integer"||s.type==="number")&&s.format==="stepper")return"stepper"},adt=s=>s.format==="button"&&"button",ldt=s=>s.format==="info"&&"info",hdt=s=>s.type==="string"&&s.format==="uuid"&&"uuid",cdt=s=>s.type==="string"&&s.format==="autocomplete"&&"autocomplete",udt=s=>s.type==="string"&&s.format==="jodit"&&"jodit",ddt=s=>s.type==="string"&&s.format==="markdown"&&"simplemde",pdt=s=>s.type==="string"&&["xhtml","bbcode"].includes(s.format)&&"sceditor",gdt=["actionscript","batchfile","c","c++","cpp","coffee","csharp","css","dart","django","ejs","erlang","golang","groovy","handlebars","haskell","haxe","html","ini","jade","java","javascript","json","less","lisp","lua","makefile","matlab","mysql","objectivec","pascal","perl","pgsql","php","python","prql","r","ruby","rust","sass","scala","scss","sh","smarty","sql","sqlserver","stylus","svg","typescript","twig","vbscript","xml","yaml","zig"],fdt=s=>s.type==="string"&&gdt.includes(s.format)&&"ace",mdt=s=>s.type==="string"&&["ip","ipv4","ipv6","hostname"].includes(s.format)&&"ip",_dt=s=>s.type==="string"&&s.format==="color"&&"colorpicker",ydt=[_dt,mdt,fdt,pdt,ddt,udt,cdt,hdt,ldt,adt,odt,ndt,rdt,sdt,edt,idt,tdt,Qut,Jut,Kut,Zut,Yut,qut,Xut,Wut,Hut,Vut,But,Uut];function YD(s){return!(s===null||typeof s!="object"||s.nodeType||s===s.window||s.constructor&&!Wr(s.constructor.prototype,"isPrototypeOf"))}function ZD(s){return YD(s)?$t({},s):Array.isArray(s)?s.map(ZD):s}function $t(s,...t){return t.forEach(e=>{e&&Object.keys(e).forEach(i=>{e[i]&&YD(e[i])?(Wr(s,i)||(s[i]={}),$t(s[i],e[i])):Array.isArray(e[i])?s[i]=ZD(e[i]):s[i]=e[i]})}),s}function Dn(s,t){const e=document.createEvent("HTMLEvents");e.initEvent(t,!0,!0),s.dispatchEvent(e)}function KD(s){return s&&(s.toString()==="[object ShadowRoot]"?s:KD(s.parentNode))}function Wr(s,t){return s&&Object.prototype.hasOwnProperty.call(s,t)}const xdt=/^\s*(-|\+)?(\d+|(\d*(\.\d*)))([eE][+-]?\d+)?\s*$/;function vdt(s){if(typeof s>"u"||s===null)return!1;const t=s.match(xdt),e=parseFloat(s);return t!==null&&!isNaN(e)&&isFinite(e)}const bdt=/^\s*(-|\+)?(\d+)\s*$/;function wdt(s){if(typeof s>"u"||s===null)return!1;const t=s.match(bdt),e=parseInt(s);return t!==null&&!isNaN(e)&&isFinite(e)}function Rg(){let s=new Date().getTime();return typeof performance<"u"&&typeof performance.now=="function"&&(s+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=(s+Math.random()*16)%16|0;return s=Math.floor(s/16),(t==="x"?e:e&3|8).toString(16)})}function jx(s){return s&&typeof s=="object"&&!Array.isArray(s)}function a_(s,...t){if(!t.length)return s;const e=t.shift();if(jx(s)&&jx(e))for(const i in e)jx(e[i])?(s[i]||Object.assign(s,{[i]:{}}),a_(s[i],e[i])):Object.assign(s,{[i]:e[i]});return a_(s,...t)}function Edt(s,t){return Object.keys(t).forEach(function(e){e in s&&(s[e]=t[e])}),s}class Ks{constructor(t,e){this.defaults=e,this.jsoneditor=t.jsoneditor,this.theme=this.jsoneditor.theme,this.template_engine=this.jsoneditor.template,this.iconlib=this.jsoneditor.iconlib,this.translate=this.jsoneditor.translate||this.defaults.translate,this.translateProperty=this.jsoneditor.translateProperty||this.defaults.translateProperty,this.original_schema=t.schema,this.schema=this.jsoneditor.expandSchema(this.original_schema),this.active=!0,this.isUiOnly=!1,this.options=$t({},this.options||{},this.schema.options||{},t.schema.options||{},t),this.formname=this.jsoneditor.options.form_name_root||"root",!t.path&&!this.schema.id&&(this.schema.id=this.formname),this.path=t.path||this.formname,this.formname=t.formname||this.path.replace(/\.([^.]+)/g,"[$1]"),this.parent=t.parent,this.key=this.parent!==void 0?this.path.split(".").slice(this.parent.path.split(".").length).join("."):this.path,this.link_watchers=[],this.watchLoop=!1,t.container&&this.setContainer(t.container),this.registerDependencies()}onChildEditorChange(t){this.onChange(!0)}notify(){this.path&&this.jsoneditor.notifyWatchers(this.path)}change(){this.parent?this.parent.onChildEditorChange(this):this.jsoneditor&&this.jsoneditor.onChange()}onChange(t){this.notify(),this.watch_listener&&this.watch_listener(),t&&this.change()}register(){if(this.jsoneditor.registerEditor(this),this.input&&!this.label){const t=this.getTitle()||this.formname;this.input.setAttribute("aria-label",t)}this.onChange()}unregister(){this.jsoneditor&&this.jsoneditor.unregisterEditor(this)}getNumColumns(){return 12}isActive(){return this.active}activate(){this.active=!0,this.optInCheckbox.checked=!0,this.enable(),this.change()}deactivate(){this.isRequired()||(this.active=!1,this.optInCheckbox.checked=!1,this.disable(),this.change())}registerDependencies(){this.dependenciesFulfilled=!0;const t=this.options.dependencies;t&&Object.keys(t).forEach(e=>{let i;e.startsWith(this.jsoneditor.root.path)?i=e:(i=this.path.split("."),i[i.length-1]=e,i=i.join(".")),this.jsoneditor.watch(i,()=>{this.evaluateDependencies()})})}evaluateDependencies(){const t=this.container||this.control;if(!t||this.jsoneditor===null)return;const e=this.options.dependencies;if(!e)return;const i=this.dependenciesFulfilled;this.dependenciesFulfilled=!0,Object.keys(e).forEach(n=>{let o;n.startsWith(this.jsoneditor.root.path)?o=n:(o=this.path.split("."),o[o.length-1]=n,o=o.join("."));const a=e[n];this.checkDependency(o,a)}),this.dependenciesFulfilled!==i&&this.notify();let r=this.dependenciesFulfilled?"block":"none";this.options.hidden&&(r="none"),t.tagName==="TD"?Object.keys(t.childNodes).forEach(n=>t.childNodes[n].style.display=r):t.style.display=r}checkDependency(t,e){if(this.path===t||this.jsoneditor===null)return;const i=this.jsoneditor.getEditor(t),r=i?i.getValue():void 0;!i||!i.dependenciesFulfilled?this.dependenciesFulfilled=!1:Array.isArray(e)?this.dependenciesFulfilled=e.some(n=>{if(JSON.stringify(r)===JSON.stringify(n))return!0}):typeof e=="object"?typeof r!="object"?this.dependenciesFulfilled=e===r:Object.keys(e).some(n=>{if(!Wr(e,n))return!1;if(!Wr(r,n)||e[n]!==r[n])return this.dependenciesFulfilled=!1,!0}):typeof e=="string"||typeof e=="number"?this.dependenciesFulfilled=this.dependenciesFulfilled&&r===e:typeof e=="boolean"&&(e?this.dependenciesFulfilled=this.dependenciesFulfilled&&(r||r.length>0):this.dependenciesFulfilled=this.dependenciesFulfilled&&(!r||r.length===0))}setContainer(t){this.container=t,this.setContainerAttributes(),this.schema.id&&this.container.setAttribute("data-schemaid",this.schema.id),this.schema.type&&typeof this.schema.type=="string"&&this.container.setAttribute("data-schematype",this.schema.type),this.container.setAttribute("data-schemapath",this.path)}setOptInCheckbox(t){this.optInLabel=this.theme.getHiddenLabel(this.formname+" opt-in"),this.optInLabel.setAttribute("for",this.formname+"-opt-in"),this.optInCheckbox=document.createElement("input"),this.optInCheckbox.setAttribute("type","checkbox"),this.optInCheckbox.setAttribute("style","margin: 0 10px 0 0;"),this.optInCheckbox.setAttribute("id",this.formname+"-opt-in"),this.optInCheckbox.classList.add("json-editor-opt-in"),this.optInCheckbox.addEventListener("click",()=>{this.isActive()?this.deactivate():this.activate()});const e=this.jsoneditor.options.show_opt_in,i=typeof this.parent.options.show_opt_in<"u",r=i&&this.parent.options.show_opt_in===!0,n=i&&this.parent.options.show_opt_in===!1;(r||!n&&e||!i&&e)&&this.parent&&this.parent.schema.type==="object"&&!this.isRequired()&&this.header&&(this.header.appendChild(this.optInLabel),this.header.appendChild(this.optInCheckbox),this.header.insertBefore(this.optInCheckbox,this.header.firstChild))}preBuild(){}build(){}postBuild(){this.setupWatchListeners(),this.addLinks(),this.register(),this.setValue(this.getDefault(),!0),this.updateHeaderText(),this.onWatchedFieldChange(),this.options.titleHidden&&(this.theme.visuallyHidden(this.label),this.theme.visuallyHidden(this.header))}setupWatchListeners(){if(this.watched={},this.schema.vars&&(this.schema.watch=this.schema.vars),this.watched_values={},this.watch_listener=()=>{this.refreshWatchedFieldValues()&&this.onWatchedFieldChange()},Wr(this.schema,"watch")){let t,e,i,r,n;const o=this.container.getAttribute("data-schemapath");Object.keys(this.schema.watch).forEach(a=>{if(t=this.schema.watch[a],Array.isArray(t)){if(t.length<2)return;e=[t[0]].concat(t[1].split("."))}else e=t.split("."),this.theme.closest(this.container,`[data-schemaid="${e[0]}"]`)||e.unshift("#");if(i=e.shift(),i==="#"&&(i=this.jsoneditor.schema.id||this.jsoneditor.root.formname),r=this.theme.closest(this.container,`[data-schemaid="${i}"]`),!r)throw new Error(`Could not find ancestor node with id ${i}`);n=`${r.getAttribute("data-schemapath")}.${e.join(".")}`,o.startsWith(n)&&(this.watchLoop=!0),this.jsoneditor.watch(n,this.watch_listener),this.watched[a]=n})}this.schema.headerTemplate&&(this.header_template=this.jsoneditor.compileTemplate(this.schema.headerTemplate,this.template_engine))}addLinks(){if(!this.no_link_holder&&(this.link_holder=this.theme.getLinksHolder(),typeof this.description<"u"?this.description.parentNode.insertBefore(this.link_holder,this.description):this.container.appendChild(this.link_holder),this.schema.links))for(let t=0;t<this.schema.links.length;t++)this.addLink(this.getLink(this.schema.links[t]))}onMove(){}getButton(t,e,i,r=[]){const n=`json-editor-btn-${e}`;this.iconlib?e=this.iconlib.getIcon(e):e=null,t=this.translate(t,r),i=this.translate(i,r),!e&&i&&(t=i,i=null);const o=this.theme.getButton(t,e,i);return o.classList.add(n),o}setButtonText(t,e,i,r,n=[]){return this.iconlib?i=this.iconlib.getIcon(i):i=null,e=this.translate(e,n),r=this.translate(r,n),!i&&r&&(e=r,r=null),this.theme.setButtonText(t,e,i,r)}addLink(t){this.link_holder&&this.link_holder.appendChild(t)}getLink(t){let e,i;const r=(t.mediaType||"application/javascript").split("/")[0],n=this.jsoneditor.compileTemplate(t.href,this.template_engine),o=this.jsoneditor.compileTemplate(t.rel?t.rel:t.href,this.template_engine);let a=null;if(t.download&&(a=t.download),a&&a!==!0&&(a=this.jsoneditor.compileTemplate(a,this.template_engine)),r==="image"){e=this.theme.getBlockLinkHolder(),i=document.createElement("a"),i.setAttribute("target","_blank");const l=document.createElement("img");this.theme.createImageLink(e,i,l),this.link_watchers.push(h=>{const c=n(h),u=o(h);i.setAttribute("href",c),i.setAttribute("title",u||c),l.setAttribute("src",c)})}else if(["audio","video"].includes(r)){e=this.theme.getBlockLinkHolder(),i=this.theme.getBlockLink(),i.setAttribute("target","_blank");const l=document.createElement(r);l.setAttribute("controls","controls"),this.theme.createMediaLink(e,i,l),this.link_watchers.push(h=>{const c=n(h),u=o(h);i.setAttribute("href",c),i.textContent=u||c,l.setAttribute("src",c)})}else i=e=this.theme.getBlockLink(),e.setAttribute("target","_blank"),e.textContent=t.rel,e.style.display="none",this.link_watchers.push(l=>{const h=n(l),c=o(l);h&&(e.style.display=""),e.setAttribute("href",h),e.textContent=c||h});return a&&i&&(a===!0?i.setAttribute("download",""):this.link_watchers.push(l=>{i.setAttribute("download",a(l))})),t.class&&i.classList.add(t.class),e}refreshWatchedFieldValues(){if(!this.watched_values)return;const t={};let e=!1;return this.watched&&Object.keys(this.watched).forEach(i=>{const r=this.jsoneditor.getEditor(this.watched[i]),n=r?r.getValue():null;this.watched_values[i]!==n&&(e=!0),t[i]=n}),t.self=this.getValue(),this.watched_values.self!==t.self&&(e=!0),this.watched_values=t,e}getWatchedFieldValues(){return this.watched_values}updateHeaderText(){if(this.header){const t=this.getHeaderText();if(this.header.children.length){for(let e=0;e<this.header.childNodes.length;e++)if(this.header.childNodes[e].nodeType===3){this.header.childNodes[e].nodeValue=this.cleanText(t);break}}else window.DOMPurify?this.header.innerHTML=window.DOMPurify.sanitize(t):this.header.textContent=this.cleanText(t)}}getHeaderText(t){return this.header_text?this.header_text:t?this.translateProperty(this.schema.title):this.getTitle()}getPathDepth(){return this.path.split(".").length}cleanText(t){const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText}onWatchedFieldChange(){let t;if(this.header_template){t=$t(this.getWatchedFieldValues(),{key:this.key,i:this.key,i0:this.key*1,i1:this.key*1+1,title:this.getTitle()}),this.editors&&Object.keys(this.editors).length&&(t.properties={},Object.keys(this.editors).forEach(i=>{const r=this.editors[i];if(r.schema&&r.schema.enum&&r.schema.options&&r.schema.options.enum_titles){const n=r.schema.enum.indexOf(r.value),o=r.options.enum_titles[n];t.properties[i]={enumTitle:o}}}));const e=this.header_template(t);e!==this.header_text&&(this.header_text=e,this.updateHeaderText(),this.notify())}if(this.link_watchers.length){t=this.getWatchedFieldValues();for(let e=0;e<this.link_watchers.length;e++)this.link_watchers[e](t)}}setValue(t){this.value=t}getValue(){if(this.dependenciesFulfilled)return this.value}refreshValue(){}getChildEditors(){return!1}destroy(){this.unregister(this),this.watched&&Object.values(this.watched).forEach(t=>this.jsoneditor.unwatch(t,this.watch_listener)),this.watched=null,this.watched_values=null,this.watch_listener=null,this.header_text=null,this.header_template=null,this.value=null,this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.jsoneditor=null,this.schema=null,this.path=null,this.key=null,this.parent=null}isDefaultRequired(){return this.isRequired()||!!this.jsoneditor.options.use_default_values}getDefault(){if(typeof this.schema.default<"u")return this.schema.default;if(typeof this.schema.enum<"u")return this.schema.enum[0];let t=this.schema.type||this.schema.oneOf;if(t&&Array.isArray(t)&&(t=t[0]),t&&typeof t=="object"&&(t=t.type),t&&Array.isArray(t)&&(t=t[0]),typeof t=="string"){if(t==="number")return this.isDefaultRequired()?0:void 0;if(t==="boolean")return this.isDefaultRequired()?!1:void 0;if(t==="integer")return this.isDefaultRequired()?0:void 0;if(t==="string")return this.isDefaultRequired()?"":void 0;if(t==="null")return null;if(t==="object")return{};if(t==="array")return[]}}getTitle(){return this.translateProperty(this.schema.title||this.key||this.formname)}enable(){this.disabled=!1}disable(){this.disabled=!0}isEnabled(){return!this.disabled}isRequired(){return typeof this.schema.required=="boolean"?this.schema.required:this.parent&&this.parent.schema&&Array.isArray(this.parent.schema.required)?this.parent.schema.required.includes(this.key):!!this.jsoneditor.options.required_by_default}getDisplayText(t){const e=[],i={};t.forEach(n=>{n.title&&(i[n.title]=i[n.title]||0,i[n.title]++),n.description&&(i[n.description]=i[n.description]||0,i[n.description]++),n.format&&(i[n.format]=i[n.format]||0,i[n.format]++),n.type&&(i[n.type]=i[n.type]||0,i[n.type]++)}),t.forEach(n=>{let o;typeof n=="string"?o=n:n.title&&i[n.title]<=1?o=n.title:n.format&&i[n.format]<=1?o=n.format:n.type&&i[n.type]<=1?o=n.type:n.description&&i[n.description]<=1?o=n.description:n.title?o=n.title:n.format?o=n.format:n.type?o=n.type:n.description?o=n.description:JSON.stringify(n).length<500?o=JSON.stringify(n):o="type",e.push(o)});const r={};return e.forEach((n,o)=>{r[n]=r[n]||0,r[n]++,i[n]>1&&(e[o]=`${n} ${r[n]}`)}),e}getValidId(t){return t=t===void 0?"":t.toString(),t.replace(/\s+/g,"-")}setInputAttributes(t){if(this.schema.options&&this.schema.options.inputAttributes){const e=this.schema.options.inputAttributes,i=["name","type"].concat(t);Object.keys(e).forEach(r=>{i.includes(r.toLowerCase())||this.input.setAttribute(r,e[r])})}}setContainerAttributes(){if(this.schema.options&&this.schema.options.containerAttributes){const t=this.schema.options.containerAttributes,e=["data-schemapath","data-schematype","data-schemaid"];Object.keys(t).forEach(i=>{e.includes(i.toLowerCase())||this.container.setAttribute(i,t[i])})}}expandCallbacks(t,e){const i=this.defaults.callbacks[t];return Object.entries(e).forEach(([r,n])=>{n===Object(n)?e[r]=this.expandCallbacks(t,n):typeof n=="string"&&typeof i=="object"&&typeof i[n]=="function"&&(e[r]=i[n].bind(null,this))}),e}showValidationErrors(t){}}class Zr extends Ks{register(){super.register(),this.input&&this.jsoneditor.options.use_name_attributes&&this.input.setAttribute("name",this.formname)}unregister(){super.unregister(),this.input&&(this.input.removeAttribute("name"),this.input.removeAttribute("aria-label"))}setValue(t,e,i){if(this.template&&!i||(!this.shouldBeUnset()&&(t===null||typeof t>"u")?t="":typeof t=="object"?t=JSON.stringify(t):!this.shouldBeUnset()&&typeof t!="string"&&(t=`${t}`),t===this.serialized))return;const r=this.sanitize(t);if(this.input.value===r)return;if(this.setValueToInputField(r),this.format==="range"){const o=this.control.querySelector("output");o&&(o.value=r)}const n=i||this.getValue()!==t;return this.refreshValue(),e?this.is_dirty=!1:this.jsoneditor.options.show_errors==="change"&&(this.is_dirty=!0),this.adjust_height&&this.adjust_height(this.input),i||this.onChange(n),{changed:n,value:r}}setValueToInputField(t){this.input.value=t===void 0?"":t}getNumColumns(){const t=Math.ceil(Math.max(this.getTitle().length,this.schema.maxLength||0,this.schema.minLength||0)/5);let e;return this.input_type==="textarea"?e=6:["text","email"].includes(this.input_type)?e=4:e=2,Math.min(12,Math.max(t,e))}build(){if(this.options.compact||(this.header=this.label=this.theme.getFormInputLabel(this.getTitle(),this.isRequired())),this.schema.description&&(this.description=this.theme.getFormInputDescription(this.translateProperty(this.schema.description))),this.options.infoText&&(this.infoButton=this.theme.getInfoButton(this.translateProperty(this.options.infoText))),this.format=this.schema.format,!this.format&&this.schema.media&&this.schema.media.type&&(this.format=this.schema.media.type.replace(/(^(application|text)\/(x-)?(script\.)?)|(-source$)/g,"")),!this.format&&this.options.default_format&&(this.format=this.options.default_format),this.options.format&&(this.format=this.options.format),this.format)if(this.format==="textarea")this.input_type="textarea",this.input=this.theme.getTextareaInput();else if(this.format==="range"){this.input_type="range";let e=this.schema.minimum||0,i=this.schema.maximum||Math.max(100,e+1),r=1;this.schema.multipleOf&&(e%this.schema.multipleOf&&(e=Math.ceil(e/this.schema.multipleOf)*this.schema.multipleOf),i%this.schema.multipleOf&&(i=Math.floor(i/this.schema.multipleOf)*this.schema.multipleOf),r=this.schema.multipleOf),this.input=this.theme.getRangeInput(e,i,r,this.description,this.formname),this.input.setAttribute("id",this.formname)}else this.input_type="text",["button","checkbox","color","date","datetime-local","email","file","hidden","image","month","number","password","radio","reset","search","submit","tel","text","time","url","week"].includes(this.format)&&(this.input_type=this.format),this.input=this.theme.getFormInputField(this.input_type);else this.input_type="text",this.input=this.theme.getFormInputField(this.input_type);typeof this.schema.maxLength<"u"&&this.input.setAttribute("maxlength",this.schema.maxLength),typeof this.schema.pattern<"u"?this.input.setAttribute("pattern",this.schema.pattern):typeof this.schema.minLength<"u"&&this.input.setAttribute("pattern",`.{${this.schema.minLength},}`),this.options.compact?this.container.classList.add("compact"):this.options.input_width&&(this.input.style.width=this.options.input_width),(this.schema.readOnly||this.schema.readonly||this.schema.template)&&(this.disable(!0),this.input.setAttribute("readonly","true")),this.setInputAttributes(["maxlength","pattern","readonly","min","max","step"]),this.input.addEventListener("change",e=>{if(e.preventDefault(),e.stopPropagation(),this.schema.template){e.currentTarget.value=this.value;return}const i=e.currentTarget.value,r=this.sanitize(i);i!==r&&(e.currentTarget.value=r),this.is_dirty=!0,this.refreshValue(),this.onChange(!0)}),this.options.input_height&&(this.input.style.height=this.options.input_height),this.options.expand_height&&(this.adjust_height=e=>{if(!e)return;let i,r=e.offsetHeight;if(e.offsetHeight<e.scrollHeight)for(i=0;e.offsetHeight<e.scrollHeight+3&&!(i>100);)i++,r++,e.style.height=`${r}px`;else{for(i=0;e.offsetHeight>=e.scrollHeight+3&&!(i>100);)i++,r--,e.style.height=`${r}px`;e.style.height=`${r+1}px`}},this.input.addEventListener("keyup",e=>{this.adjust_height(e.currentTarget)}),this.input.addEventListener("change",e=>{this.adjust_height(e.currentTarget)}),this.adjust_height()),this.format&&this.input.setAttribute("data-schemaformat",this.format);let{input:t}=this;if(this.format==="range"&&(t=this.theme.getRangeControl(this.input,this.theme.getRangeOutput(this.input,this.schema.default||Math.max(this.schema.minimum||0,0)))),this.control=this.theme.getFormControl(this.label,t,this.description,this.infoButton,this.formname),this.container.appendChild(this.control),window.requestAnimationFrame(()=>{if(this.input.parentNode&&this.afterInputReady(),this.adjust_height&&this.adjust_height(this.input),this.format==="range"){const e=this.control.querySelector("output");e.value=this.input.value}}),this.schema.template){const e=this.expandCallbacks("template",{template:this.schema.template});typeof e.template=="function"?this.template=e.template:this.template=this.jsoneditor.compileTemplate(this.schema.template,this.template_engine),this.refreshValue()}else this.refreshValue()}setupCleave(t){const e=this.expandCallbacks("cleave",$t({},this.defaults.options.cleave||{},this.options.cleave||{}));typeof e=="object"&&Object.keys(e).length>0&&(this.cleave_instance=new window.Cleave(t,e))}setupImask(t){const e=this.expandCallbacks("imask",$t({},this.defaults.options.imask||{},this.options.imask||{}));typeof e=="object"&&Object.keys(e).length>0&&(this.imask_instance=window.IMask(t,this.ajustIMaskOptions(e)))}ajustIMaskOptions(t){return Object.keys(t).forEach(e=>{if(t[e]===Object(t[e]))t[e]=this.ajustIMaskOptions(t[e]);else if(e==="mask")if(t[e].substr(0,6)==="regex:"){const i=t[e].match(/^regex:\/(.*)\/([gimsuy]*)$/);if(i!==null)try{t[e]=new RegExp(i[1],i[2])}catch{}}else t[e]=this.getGlobalPropertyFromString(t[e])}),t}getGlobalPropertyFromString(t){if(t.includes(".")){const e=t.split("."),i=e[0],r=e[1];if(typeof window[i]<"u"&&typeof window[i][r]<"u")return window[i][r]}else if(typeof window[t]<"u")return window[t];return t}shouldBeUnset(){return!this.jsoneditor.options.use_default_values&&!this.is_dirty}getValue(){const t=!!(this.input&&this.input.value);if(!(this.shouldBeUnset()&&!t))return this.imask_instance&&this.dependenciesFulfilled&&this.options.imask.returnUnmasked?this.imask_instance.unmaskedValue:super.getValue()}enable(){this.always_disabled||(this.input.disabled=!1,super.enable())}disable(t){t&&(this.always_disabled=!0),this.input.disabled=!0,super.disable()}afterInputReady(){this.theme.afterInputReady(this.input),window.Cleave&&!this.cleave_instance?this.setupCleave(this.input):window.IMask&&!this.imask_instance&&this.setupImask(this.input)}refreshValue(){this.input&&(this.value=this.input.value,typeof this.value!="string"&&!this.shouldBeUnset()&&(this.value=""),this.serialized=this.value)}destroy(){this.cleave_instance&&this.cleave_instance.destroy(),this.imask_instance&&this.imask_instance.destroy(),this.template=null,this.input&&this.input.parentNode&&this.input.parentNode.removeChild(this.input),this.label&&this.label.parentNode&&this.label.parentNode.removeChild(this.label),this.description&&this.description.parentNode&&this.description.parentNode.removeChild(this.description),super.destroy()}sanitize(t){return t}onWatchedFieldChange(){let t;this.template&&(t=this.getWatchedFieldValues(),this.setValue(this.template(t),!1,!0)),super.onWatchedFieldChange()}showValidationErrors(t){if(this.jsoneditor.options.show_errors!=="always"&&!this.is_dirty&&this.previous_error_setting===this.jsoneditor.options.show_errors)return;this.previous_error_setting=this.jsoneditor.options.show_errors;const e=(r,n)=>(n.path===this.path&&r.push(n.message),r),i=t.reduce(e,[]);i.length?this.theme.addInputError(this.input,`${i.join(". ")}.`):this.theme.removeInputError(this.input)}}class Sdt extends Zr{setValue(t,e,i){const r=super.setValue(t,e,i);r!==void 0&&r.changed&&this.ace_editor_instance&&(this.ace_editor_instance.setValue(r.value),this.ace_editor_instance.session.getSelection().clearSelection(),this.ace_editor_instance.resize())}build(){this.options.format="textarea",super.build(),this.input_type=this.schema.format,this.input.setAttribute("data-schemaformat",this.input_type)}afterInputReady(){let t;if(window.ace){let e=this.input_type;(e==="cpp"||e==="c++"||e==="c")&&(e="c_cpp"),t=this.expandCallbacks("ace",$t({},{selectionStyle:"text",minLines:30,maxLines:30},this.defaults.options.ace||{},this.options.ace||{},{mode:`ace/mode/${e}`})),this.ace_container=document.createElement("div"),this.ace_container.style.width="100%",this.ace_container.style.position="relative",this.input.parentNode.insertBefore(this.ace_container,this.input),this.input.style.display="none",this.ace_editor_instance=window.ace.edit(this.ace_container,t),this.ace_editor_instance.setValue(this.getValue()),this.ace_editor_instance.session.getSelection().clearSelection(),this.ace_editor_instance.resize(),(this.schema.readOnly||this.schema.readonly||this.schema.template)&&this.ace_editor_instance.setReadOnly(!0),this.ace_editor_instance.on("change",()=>{this.input.value=this.ace_editor_instance.getValue(),this.refreshValue(),this.is_dirty=!0,this.onChange(!0)}),this.theme.afterInputReady(this.input)}else super.afterInputReady()}getNumColumns(){return 6}enable(){!this.always_disabled&&this.ace_editor_instance&&this.ace_editor_instance.setReadOnly(!1),super.enable()}disable(t){this.ace_editor_instance&&this.ace_editor_instance.setReadOnly(!0),super.disable(t)}destroy(){this.ace_editor_instance&&(this.ace_editor_instance.destroy(),this.ace_editor_instance=null),super.destroy()}}const Cdt={".json-editor-btntype-toggle":"margin:0%2010px%200%200",".je-array-control-btn":"width:100%25;text-align:left;margin-bottom:3px"};class f2 extends Ks{askConfirmation(){return!(this.jsoneditor.options.prompt_before_delete===!0&&window.confirm(this.translate("button_delete_node_warning"))===!1)}getDefault(){return this.schema.default||[]}register(){super.register(),this.rows&&this.rows.forEach(t=>t.register())}unregister(){super.unregister(),this.rows&&this.rows.forEach(t=>t.unregister())}getNumColumns(){const t=this.getItemInfo(0);return this.tabs_holder&&this.schema.format!=="tabs-top"?Math.max(Math.min(12,t.width+2),4):t.width}enable(){this.always_disabled||(this.setAvailability(this,!1),this.rows&&this.rows.forEach(t=>{t.enable(),this.setAvailability(t,!1)}),super.enable())}disable(t){t&&(this.always_disabled=!0),this.setAvailability(this,!0),this.rows&&this.rows.forEach(e=>{e.disable(t),this.setAvailability(e,!0)}),super.disable()}setAvailability(t,e){t.add_row_button&&(t.add_row_button.disabled=e),t.remove_all_rows_button&&(t.remove_all_rows_button.disabled=e),t.delete_last_row_button&&(t.delete_last_row_button.disabled=e),t.copy_button&&(t.copy_button.disabled=e),t.delete_button&&(t.delete_button.disabled=e),t.moveup_button&&(t.moveup_button.disabled=e),t.movedown_button&&(t.movedown_button.disabled=e)}preBuild(){super.preBuild(),this.rows=[],this.row_cache=[],this.hide_delete_buttons=this.options.disable_array_delete||this.jsoneditor.options.disable_array_delete,this.hide_delete_all_rows_buttons=this.hide_delete_buttons||this.options.disable_array_delete_all_rows||this.jsoneditor.options.disable_array_delete_all_rows,this.hide_delete_last_row_buttons=this.hide_delete_buttons||this.options.disable_array_delete_last_row||this.jsoneditor.options.disable_array_delete_last_row,this.hide_move_buttons=this.options.disable_array_reorder||this.jsoneditor.options.disable_array_reorder,this.hide_add_button=this.options.disable_array_add||this.jsoneditor.options.disable_array_add,this.show_copy_button=this.options.enable_array_copy||this.jsoneditor.options.enable_array_copy,this.array_controls_top=this.options.array_controls_top||this.jsoneditor.options.array_controls_top}build(){this.options.compact?(this.title=this.theme.getHeader("",this.getPathDepth()),this.container.appendChild(this.title),this.panel=this.theme.getIndentedPanel(),this.container.appendChild(this.panel),this.title_controls=this.theme.getHeaderButtonHolder(),this.title.appendChild(this.title_controls),this.controls=this.theme.getHeaderButtonHolder(),this.title.appendChild(this.controls),this.row_holder=document.createElement("div"),this.panel.appendChild(this.row_holder)):(this.header=document.createElement("span"),this.header.textContent=this.getTitle(),this.title=this.theme.getHeader(this.header,this.getPathDepth()),this.container.appendChild(this.title),this.options.infoText&&(this.infoButton=this.theme.getInfoButton(this.translateProperty(this.options.infoText)),this.container.appendChild(this.infoButton)),this.title_controls=this.theme.getHeaderButtonHolder(),this.title.appendChild(this.title_controls),this.schema.description&&(this.description=this.theme.getDescription(this.translateProperty(this.schema.description)),this.container.appendChild(this.description)),this.error_holder=document.createElement("div"),this.container.appendChild(this.error_holder),this.schema.format==="tabs-top"?(this.controls=this.theme.getHeaderButtonHolder(),this.title.appendChild(this.controls),this.tabs_holder=this.theme.getTopTabHolder(this.getValidId(this.getItemTitle())),this.container.appendChild(this.tabs_holder),this.row_holder=this.theme.getTopTabContentHolder(this.tabs_holder),this.active_tab=null):this.schema.format==="tabs"?(this.controls=this.theme.getHeaderButtonHolder(),this.title.appendChild(this.controls),this.tabs_holder=this.theme.getTabHolder(this.getValidId(this.getItemTitle())),this.container.appendChild(this.tabs_holder),this.row_holder=this.theme.getTabContentHolder(this.tabs_holder),this.active_tab=null):(this.panel=this.theme.getIndentedPanel(),this.container.appendChild(this.panel),this.row_holder=document.createElement("div"),this.panel.appendChild(this.row_holder),this.controls=this.theme.getButtonHolder(),this.array_controls_top?this.title.appendChild(this.controls):this.panel.appendChild(this.controls))),this.addControls()}postBuild(){super.postBuild(),(this.schema.readOnly||this.schema.readonly)&&this.disable()}onChildEditorChange(t){this.refreshValue(),this.refreshTabs(!0),super.onChildEditorChange(t)}getItemTitle(){if(!this.item_title)if(this.schema.items&&!Array.isArray(this.schema.items)){const t=this.jsoneditor.expandRefs(this.schema.items);this.item_title=this.translateProperty(t.title)||this.translate("default_array_item_title")}else this.item_title=this.translate("default_array_item_title");return this.cleanText(this.item_title)}getItemSchema(t){if(Array.isArray(this.schema.items))if(t>=this.schema.items.length){if(this.schema.additionalItems===!0)return{};if(this.schema.additionalItems)return $t({},this.schema.additionalItems)}else return $t({},this.schema.items[t]);else return this.schema.items?$t({},this.schema.items):{}}getItemInfo(t){let e=this.getItemSchema(t);this.item_info=this.item_info||{};const i=JSON.stringify(e);return typeof this.item_info[i]<"u"?this.item_info[i]:(e=this.jsoneditor.expandRefs(e),this.item_info[i]={title:this.translateProperty(e.title)||this.translate("default_array_item_title"),default:e.default,width:12,child_editors:e.properties||e.items},this.item_info[i])}getElementEditor(t){const e=this.getItemInfo(t);let i=this.getItemSchema(t);i=this.jsoneditor.expandRefs(i),i.title=`${e.title} ${t+1}`;const r=this.jsoneditor.getEditorClass(i);let n;this.tabs_holder?(this.schema.format==="tabs-top"?n=this.theme.getTopTabContent():n=this.theme.getTabContent(),n.id=`${this.path}.${t}`):e.child_editors?n=this.theme.getChildEditorHolder():n=this.theme.getIndentedPanel(),this.row_holder.appendChild(n);const o=this.jsoneditor.createEditor(r,{jsoneditor:this.jsoneditor,schema:i,container:n,path:`${this.path}.${t}`,parent:this,required:!0});return o.preBuild(),o.build(),o.postBuild(),o.title_controls||(o.array_controls=this.theme.getButtonHolder(),n.appendChild(o.array_controls)),o}checkParent(t){return t&&t.parentNode}destroy(){this.empty(!0),this.checkParent(this.title)&&this.title.parentNode.removeChild(this.title),this.checkParent(this.description)&&this.description.parentNode.removeChild(this.description),this.checkParent(this.row_holder)&&this.row_holder.parentNode.removeChild(this.row_holder),this.checkParent(this.controls)&&this.controls.parentNode.removeChild(this.controls),this.checkParent(this.panel)&&this.panel.parentNode.removeChild(this.panel),this.rows=this.row_cache=this.title=this.description=this.row_holder=this.panel=this.controls=null,super.destroy()}empty(t){if(this.rows!==null){if(this.rows.forEach((e,i)=>{t&&(this.checkParent(e.tab)&&e.tab.parentNode.removeChild(e.tab),this.destroyRow(e,!0),this.row_cache[i]=null),this.rows[i]=null}),t)for(let e=this.rows.length;e<this.row_cache.length;e++)this.destroyRow(this.row_cache[e],!0),this.row_cache[e]=null;this.rows=[],t&&(this.row_cache=[])}}destroyRow(t,e){const i=t.container;e?(t.destroy(),i.parentNode&&i.parentNode.removeChild(i),this.checkParent(t.tab)&&t.tab.parentNode.removeChild(t.tab)):(t.tab&&(t.tab.style.display="none"),i.style.display="none",t.unregister())}getMax(){return Array.isArray(this.schema.items)&&this.schema.additionalItems===!1?Math.min(this.schema.items.length,this.schema.maxItems||1/0):this.schema.maxItems||1/0}refreshTabs(t){this.rows.forEach(e=>{e.tab&&(t?e.tab_text.textContent=e.getHeaderText():e.tab===this.active_tab?this.theme.markTabActive(e):this.theme.markTabInactive(e))})}ensureArraySize(t){if(Array.isArray(t)||(t=[t]),this.schema.minItems)for(;t.length<this.schema.minItems;)t.push(this.getItemInfo(t.length).default);return this.getMax()&&t.length>this.getMax()&&(t=t.slice(0,this.getMax())),t}setValue(t=[],e){if(t=this.ensureArraySize(t),JSON.stringify(t)===this.serialized){e&&this.refreshValue(e);return}t.forEach((n,o)=>{if(this.rows[o])this.rows[o].setValue(n,e);else if(this.row_cache[o])this.rows[o]=this.row_cache[o],this.rows[o].setValue(n,e),this.rows[o].container.style.display="",this.rows[o].tab&&(this.rows[o].tab.style.display=""),this.rows[o].register(),this.jsoneditor.trigger("addRow",this.rows[o]);else{const a=this.addRow(n,e);this.jsoneditor.trigger("addRow",a)}});for(let n=t.length;n<this.rows.length;n++)this.destroyRow(this.rows[n]),this.rows[n]=null;this.rows=this.rows.slice(0,t.length);const i=this.rows.find(n=>n.tab===this.active_tab);let r=typeof i<"u"?i.tab:null;!r&&this.rows.length&&(r=this.rows[0].tab),this.active_tab=r,this.refreshValue(e),this.refreshTabs(!0),this.refreshTabs(),this.onChange()}setButtonState(t,e){switch(this.options.button_state_mode||this.jsoneditor.options.button_state_mode){case 1:t.style.display=e?"":"none";break;case 2:t.disabled=!e;break;default:t.style.display=e?"":"none"}}setupButtons(t){const e=[];if(!this.value.length)this.setButtonState(this.delete_last_row_button,!1),this.setButtonState(this.remove_all_rows_button,!1);else if(this.value.length===1){this.setButtonState(this.remove_all_rows_button,!1);const r=!(t||this.hide_delete_last_row_buttons);this.setButtonState(this.delete_last_row_button,r),e.push(r)}else{const r=!(t||this.hide_delete_last_row_buttons);this.setButtonState(this.delete_last_row_button,r),e.push(r);const n=!(t||this.hide_delete_all_rows_buttons);this.setButtonState(this.remove_all_rows_button,n),e.push(n)}const i=!(this.getMax()&&this.getMax()<=this.rows.length||this.hide_add_button);return this.setButtonState(this.add_row_button,i),e.push(i),e.some(r=>r)}refreshValue(t){const e=this.value?this.value.length:0;if(this.value=this.rows.map(i=>i.getValue()),e!==this.value.length||t){const i=this.schema.minItems&&this.schema.minItems>=this.rows.length;this.rows.forEach((r,n)=>{if(r.movedown_button){const o=n!==this.rows.length-1;this.setButtonState(r.movedown_button,o)}r.delete_button&&this.setButtonState(r.delete_button,!i),this.value[n]=r.getValue()}),this.setupButtons(i)&&!this.collapsed?this.controls.style.display="inline-block":this.controls.style.display="none"}this.serialized=JSON.stringify(this.value)}addRow(t,e){const i=this.rows.length;this.rows[i]=this.getElementEditor(i),this.row_cache[i]=this.rows[i],this.tabs_holder&&(this.rows[i].tab_text=document.createElement("span"),this.rows[i].tab_text.textContent=this.rows[i].getHeaderText(),this.schema.format==="tabs-top"?(this.rows[i].tab=this.theme.getTopTab(this.rows[i].tab_text,this.getValidId(this.rows[i].path)),this.theme.addTopTab(this.tabs_holder,this.rows[i].tab)):(this.rows[i].tab=this.theme.getTab(this.rows[i].tab_text,this.getValidId(this.rows[i].path)),this.theme.addTab(this.tabs_holder,this.rows[i].tab)),this.rows[i].tab.addEventListener("click",n=>{this.active_tab=this.rows[i].tab,this.refreshTabs(),n.preventDefault(),n.stopPropagation()}));const r=this.rows[i].title_controls||this.rows[i].array_controls;return this.hide_delete_buttons||(this.rows[i].delete_button=this._createDeleteButton(i,r)),this.show_copy_button&&(this.rows[i].copy_button=this._createCopyButton(i,r)),i&&!this.hide_move_buttons&&(this.rows[i].moveup_button=this._createMoveUpButton(i,r)),this.hide_move_buttons||(this.rows[i].movedown_button=this._createMoveDownButton(i,r)),typeof t<"u"&&this.rows[i].setValue(t,e),this.refreshTabs(),this.rows[i]}_createDeleteButton(t,e){const i=this.getButton(this.getItemTitle(),"delete","button_delete_row_title",[this.getItemTitle()]);return i.classList.add("delete","json-editor-btntype-delete"),i.setAttribute("data-i",t),i.addEventListener("click",r=>{if(r.preventDefault(),r.stopPropagation(),!this.askConfirmation())return!1;const n=r.currentTarget.getAttribute("data-i")*1,o=this.getValue().filter((h,c)=>c!==n);let a=null;const l=this.rows[n].getValue();this.setValue(o),this.rows[n]?a=this.rows[n].tab:this.rows[n-1]&&(a=this.rows[n-1].tab),a&&(this.active_tab=a,this.refreshTabs()),this.onChange(!0),this.jsoneditor.trigger("deleteRow",l)}),e&&e.appendChild(i),i}_createCopyButton(t,e){const i=this.getButton(this.getItemTitle(),"copy","button_copy_row_title",[this.getItemTitle()]),r=this.schema;return i.classList.add("copy","json-editor-btntype-copy"),i.setAttribute("data-i",t),i.addEventListener("click",n=>{const o=this.getValue();n.preventDefault(),n.stopPropagation();const a=n.currentTarget.getAttribute("data-i")*1;o.forEach((l,h)=>{if(h===a){if(r.items.type==="string"&&r.items.format==="uuid")l=Rg();else if(r.items.type==="object"&&r.items.properties)for(const c of Object.keys(l))r.items.properties&&r.items.properties[c]&&r.items.properties[c].format==="uuid"&&(l[c]=Rg());o.push(l)}}),this.setValue(o),this.refreshValue(!0),this.onChange(!0)}),e.appendChild(i),i}_createMoveUpButton(t,e){const i=this.getButton("",this.schema.format==="tabs-top"?"moveleft":"moveup","button_move_up_title");return i.classList.add("moveup","json-editor-btntype-move"),i.setAttribute("data-i",t),i.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation();const n=r.currentTarget.getAttribute("data-i")*1;if(n<=0)return;const o=this.getValue(),a=o[n-1];o[n-1]=o[n],o[n]=a,this.setValue(o),this.active_tab=this.rows[n-1].tab,this.refreshTabs(),this.onChange(!0),this.jsoneditor.trigger("moveRow",this.rows[n-1])}),e&&e.appendChild(i),i}_createMoveDownButton(t,e){const i=this.getButton("",this.schema.format==="tabs-top"?"moveright":"movedown","button_move_down_title");return i.classList.add("movedown","json-editor-btntype-move"),i.setAttribute("data-i",t),i.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation();const n=r.currentTarget.getAttribute("data-i")*1,o=this.getValue();if(n>=o.length-1)return;const a=o[n+1];o[n+1]=o[n],o[n]=a,this.setValue(o),this.active_tab=this.rows[n+1].tab,this.refreshTabs(),this.onChange(!0),this.jsoneditor.trigger("moveRow",this.rows[n+1])}),e&&e.appendChild(i),i}addControls(){this.collapsed=!1,this.toggle_button=this._createToggleButton(),this.options.collapsed&&Dn(this.toggle_button,"click"),this.schema.options&&typeof this.schema.options.disable_collapse<"u"?this.schema.options.disable_collapse&&(this.toggle_button.style.display="none"):this.jsoneditor.options.disable_collapse&&(this.toggle_button.style.display="none"),this.add_row_button=this._createAddRowButton(),this.delete_last_row_button=this._createDeleteLastRowButton(),this.remove_all_rows_button=this._createRemoveAllRowsButton(),this.tabs&&(this.add_row_button.classList.add("je-array-control-btn"),this.delete_last_row_button.classList.add("je-array-control-btn"),this.remove_all_rows_button.classList.add("je-array-control-btn"))}_createToggleButton(){const t=this.getButton("","collapse","button_collapse");t.classList.add("json-editor-btntype-toggle"),this.title.insertBefore(t,this.title.childNodes[0]);const e=this.row_holder.style.display,i=this.controls.style.display;return t.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation(),this.panel&&this.setButtonState(this.panel,this.collapsed),this.tabs_holder&&this.setButtonState(this.tabs_holder,this.collapsed),this.collapsed?(this.collapsed=!1,this.row_holder.style.display=e,this.controls.style.display=i,this.setButtonText(r.currentTarget,"","collapse","button_collapse")):(this.collapsed=!0,this.row_holder.style.display="none",this.controls.style.display="none",this.setButtonText(r.currentTarget,"","expand","button_expand"))}),t}_createAddRowButton(){const t=this.getButton(this.getItemTitle(),"add","button_add_row_title",[this.getItemTitle()]);return t.classList.add("json-editor-btntype-add"),t.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const i=this.rows.length;let r;this.row_cache[i]?(r=this.rows[i]=this.row_cache[i],this.rows[i].setValue(this.rows[i].getDefault(),!0),this.rows[i].container.style.display="",this.rows[i].tab&&(this.rows[i].tab.style.display=""),this.rows[i].register()):r=this.addRow(),this.active_tab=this.rows[i].tab,this.refreshTabs(),this.refreshValue(),this.onChange(!0),this.jsoneditor.trigger("addRow",r)}),this.controls.appendChild(t),t}_createDeleteLastRowButton(){const t=this.getButton("button_delete_last","subtract","button_delete_last_title",[this.getItemTitle()]);return t.classList.add("json-editor-btntype-deletelast"),t.addEventListener("click",e=>{if(e.preventDefault(),e.stopPropagation(),!this.askConfirmation())return!1;const i=this.getValue();let r=null;const n=i.pop();this.setValue(i),this.rows[this.rows.length-1]&&(r=this.rows[this.rows.length-1].tab),r&&(this.active_tab=r,this.refreshTabs()),this.onChange(!0),this.jsoneditor.trigger("deleteRow",n)}),this.controls.appendChild(t),t}_createRemoveAllRowsButton(){const t=this.getButton("button_delete_all","delete","button_delete_all_title");return t.classList.add("json-editor-btntype-deleteall"),t.addEventListener("click",e=>{if(e.preventDefault(),e.stopPropagation(),!this.askConfirmation())return!1;const i=this.getValue();this.empty(!0),this.setValue([]),this.onChange(!0),this.jsoneditor.trigger("deleteAllRows",i)}),this.controls.appendChild(t),t}showValidationErrors(t){const e=[],i=[];t.forEach(r=>{r.path===this.path?e.push(r):i.push(r)}),this.error_holder&&(e.length?(this.error_holder.innerHTML="",this.error_holder.style.display="",e.forEach(r=>{this.error_holder.appendChild(this.theme.getErrorMessage(r.message))})):this.error_holder.style.display="none"),this.rows.forEach(r=>r.showValidationErrors(i))}}f2.rules=Cdt;class Wy extends Ks{onInputChange(){this.value=this.input.value,this.onChange(!0)}register(){super.register(),this.input&&this.jsoneditor.options.use_name_attributes&&this.input.setAttribute("name",this.formname)}unregister(){super.unregister(),this.input&&this.input.removeAttribute("name")}getNumColumns(){let t=this.getTitle().length;return Object.keys(this.select_values).forEach(e=>t=Math.max(t,`${this.select_values[e]}`.length+4)),Math.min(12,Math.max(t/7,2))}preBuild(){super.preBuild(),this.select_options={},this.select_values={},this.option_titles=[],this.option_keys=[],this.option_enum=[];let t;const e=this.jsoneditor.expandRefs(this.schema.items||{}),i=e.enum||[],r=e.options?e.options.enum||[]:[],n=e.options?e.options.enum_titles||[]:[];for(t=0;t<i.length;t++){if(this.sanitize(i[t])!==i[t])continue;const o=r[t]||{};"title"in o||(o.title=`${n[t]||i[t]}`),this.option_keys.push(`${i[t]}`),this.option_enum.push(o),this.select_values[`${i[t]}`]=i[t]}}build(){let t;if(this.options.compact||(this.header=this.label=this.theme.getLabelLike(this.getTitle(),this.isRequired())),this.schema.description&&(this.description=this.theme.getFormInputDescription(this.translateProperty(this.schema.description))),this.options.infoText&&(this.infoButton=this.theme.getInfoButton(this.translateProperty(this.options.infoText))),this.options.compact&&this.container.classList.add("compact"),!this.schema.format&&this.option_keys.length<8||this.schema.format==="checkbox"){for(this.input_type="checkboxes",this.inputs={},this.controls={},t=0;t<this.option_keys.length;t++){const e=this.formname+t.toString();this.inputs[this.option_keys[t]]=this.theme.getCheckbox(),this.inputs[this.option_keys[t]].id=e,this.select_options[this.option_keys[t]]=this.inputs[this.option_keys[t]];const i=this.theme.getCheckboxLabel(this.option_enum[t].title);if(i.htmlFor=e,this.option_enum[t].infoText){const r=this.theme.getInfoButton(this.translateProperty(this.option_enum[t].infoText));i.appendChild(r)}this.controls["_"+this.option_keys[t]]=this.theme.getFormControl(i,this.inputs[this.option_keys[t]])}this.control=this.theme.getMultiCheckboxHolder(this.controls,this.label,this.description,this.infoButton),this.inputs.controlgroup=this.inputs.controls=this.control}else{for(this.options.compact||(this.header=this.label=this.theme.getFormInputLabel(this.getTitle(),this.isRequired())),this.input_type="select",this.input=this.theme.getSelectInput(this.option_keys,!0),this.theme.setSelectOptions(this.input,this.option_keys,this.option_enum.map(e=>e.title)),this.input.setAttribute("multiple","multiple"),this.input.size=Math.min(10,this.option_keys.length),t=0;t<this.option_keys.length;t++)this.select_options[this.option_keys[t]]=this.input.children[t];this.control=this.theme.getFormControl(this.label,this.input,this.description,this.infoButton,this.formname)}(this.schema.readOnly||this.schema.readonly)&&this.disable(!0),this.container.appendChild(this.control),this.multiselectChangeHandler=e=>{const i=[];for(t=0;t<this.option_keys.length;t++)this.select_options[this.option_keys[t]]&&(this.select_options[this.option_keys[t]].selected||this.select_options[this.option_keys[t]].checked)&&i.push(this.select_values[this.option_keys[t]]);this.updateValue(i),this.onChange(!0)},this.control.addEventListener("change",this.multiselectChangeHandler,!1),window.requestAnimationFrame(()=>{this.afterInputReady()})}postBuild(){super.postBuild()}afterInputReady(){this.theme.afterInputReady(this.input||this.inputs)}setValue(t,e){t=t||[],Array.isArray(t)||(t=[t]),t=t.map(i=>`${i}`),Object.keys(this.select_options).forEach(i=>{this.select_options[i][this.input_type==="select"?"selected":"checked"]=t.includes(i)}),this.updateValue(t),this.onChange(!0)}removeValue(t){t=[].concat(t),this.setValue(this.getValue().filter(e=>!t.includes(e)))}addValue(t){this.setValue(this.getValue().concat(t))}updateValue(t){let e=!1;const i=[];for(let r=0;r<t.length;r++){if(!this.select_options[`${t[r]}`]){e=!0;continue}const n=this.sanitize(this.select_values[t[r]]);i.push(n),n!==t[r]&&(e=!0)}return this.value=i,e}sanitize(t){return this.schema.items.type==="boolean"?!!t:this.schema.items.type==="number"?1*t||0:this.schema.items.type==="integer"?Math.floor(t*1||0):`${t}`}enable(){this.always_disabled||(this.input?this.input.disabled=!1:this.inputs&&Object.keys(this.inputs).forEach(t=>this.inputs[t].disabled=!1),super.enable())}disable(t){t&&(this.always_disabled=!0),this.input?this.input.disabled=!0:this.inputs&&Object.keys(this.inputs).forEach(e=>this.inputs[e].disabled=!0),super.disable()}destroy(){super.destroy()}escapeRegExp(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}showValidationErrors(t){const e=new RegExp(`^${this.escapeRegExp(this.path)}(\\.\\d+)?$`),i=(n,o)=>(o.path.match(e)&&n.push(o.message),n),r=t.reduce(i,[]);r.length?this.theme.addInputError(this.input||this.inputs,`${r.join(". ")}.`):this.theme.removeInputError(this.input||this.inputs)}}class Tdt extends Wy{setValue(t,e){this.choices_instance?(t=[].concat(t).map(i=>`${i}`),this.updateValue(t),this.choices_instance.removeActiveItems(),this.choices_instance.setChoiceByValue(this.value),this.onChange(!0)):super.setValue(t,e)}afterInputReady(){if(window.Choices&&!this.choices_instance){const t=this.expandCallbacks("choices",$t({},{removeItems:!0,removeItemButton:!0},this.defaults.options.choices||{},this.options.choices||{},{addItems:!0,editItems:!1,duplicateItemsAllowed:!1}));this.newEnumAllowed=!1,this.choices_instance=new window.Choices(this.input,t),this.control.removeEventListener("change",this.multiselectChangeHandler),this.multiselectChangeHandler=e=>{const i=this.choices_instance.getValue(!0);this.updateValue(i),this.onChange(!0)},this.control.addEventListener("change",this.multiselectChangeHandler,!1)}super.afterInputReady()}updateValue(t){t=[].concat(t);let e=!1;const i=[];for(let r=0;r<t.length;r++){if(!this.select_values[`${t[r]}`])if(e=!0,this.newEnumAllowed){if(!this.addNewOption(t[r]))continue}else continue;const n=this.sanitize(this.select_values[t[r]]);i.push(n),n!==t[r]&&(e=!0)}return this.value=i,e}addNewOption(t){return this.option_keys.push(`${t}`),this.option_titles.push(`${t}`),this.select_values[`${t}`]=t,this.schema.items.enum.push(t),this.choices_instance.setChoices([{value:`${t}`,label:`${t}`}],"value","label",!1),!0}enable(){!this.always_disabled&&this.choices_instance&&this.choices_instance.enable(),super.enable()}disable(t){this.choices_instance&&this.choices_instance.disable(),super.disable(t)}destroy(){this.choices_instance&&(this.choices_instance.destroy(),this.choices_instance=null),super.destroy()}}class Rdt extends Wy{setValue(t,e){this.select2_instance?(t=[].concat(t).map(i=>`${i}`),this.updateValue(t),this.select2v4?this.select2_instance.val(this.value).change():this.select2_instance.select2("val",this.value),this.onChange(!0)):super.setValue(t,e)}afterInputReady(){let t;window.jQuery&&window.jQuery.fn&&window.jQuery.fn.select2&&!this.select2_instance&&(t=this.expandCallbacks("select2",$t({},{tags:!0,width:"100%"},this.defaults.options.select2||{},this.options.select2||{})),this.newEnumAllowed=t.tags=!!t.tags&&this.schema.items&&this.schema.items.type==="string",this.select2_instance=window.jQuery(this.input).select2(t),this.select2v4=Wr(this.select2_instance.select2,"amd"),this.selectChangeHandler=()=>{const e=this.select2v4?this.select2_instance.val():this.select2_instance.select2("val");this.updateValue(e),this.onChange(!0)},this.select2_instance.on("select2-blur",this.selectChangeHandler),this.select2_instance.on("change",this.selectChangeHandler)),super.afterInputReady()}updateValue(t){t=[].concat(t);let e=!1;const i=[];for(let r=0;r<t.length;r++){if(!this.select_values[`${t[r]}`])if(e=!0,this.newEnumAllowed){if(!this.addNewOption(t[r]))continue}else continue;const n=this.sanitize(this.select_values[t[r]]);i.push(n),n!==t[r]&&(e=!0)}return this.value=i,e}addNewOption(t){this.option_keys.push(`${t}`),this.option_titles.push(`${t}`),this.select_values[`${t}`]=t,this.schema.items.enum.push(t);const e=this.input.querySelector(`option[value="${t}"]`);return e?e.removeAttribute("data-select2-tag"):this.input.appendChild(new Option(t,t,!1,!1)).trigger("change"),!0}enable(){!this.always_disabled&&this.select2_instance&&(this.select2v4?this.select2_instance.prop("disabled",!1):this.select2_instance.select2("enable",!0)),super.enable()}disable(t){this.select2_instance&&(this.select2v4?this.select2_instance.prop("disabled",!0):this.select2_instance.select2("enable",!1)),super.disable()}destroy(){this.select2_instance&&(this.select2_instance.select2("destroy"),this.select2_instance=null),super.destroy()}}class Mdt extends Wy{setValue(t,e){this.selectize_instance?(t=[].concat(t).map(i=>`${i}`),this.updateValue(t),this.selectize_instance.setValue(this.value),this.onChange(!0)):super.setValue(t,e)}afterInputReady(){let t;if(window.jQuery&&window.jQuery.fn&&window.jQuery.fn.selectize&&!this.selectize_instance){t=this.expandCallbacks("selectize",$t({},{plugins:["remove_button"],delimiter:!1,createOnBlur:!0,create:!0},this.defaults.options.selectize||{},this.options.selectize||{})),this.newEnumAllowed=t.create=!!t.create&&this.schema.items&&this.schema.items.type==="string",this.selectize_instance=window.jQuery(this.input).selectize(t)[0].selectize,this.control.removeEventListener("change",this.multiselectChangeHandler),this.multiselectChangeHandler=r=>{const n=this.selectize_instance.getValue();this.updateValue(n),this.onChange(!0)},this.selectize_instance.on("change",this.multiselectChangeHandler);const e=this.theme.getHiddenLabel(this.formname);this.input.setAttribute("id",this.formname+"-hidden-input"),e.setAttribute("for",this.formname+"-hidden-input"),this.input.parentNode.insertBefore(e,this.input);const i=this.selectize_instance.$control[0];if(i){const r=this.theme.getHiddenLabel(this.formname);r.setAttribute("for",this.formname+"-selectized"),i.appendChild(r)}}super.afterInputReady()}updateValue(t){t=[].concat(t);let e=!1;const i=[];for(let r=0;r<t.length;r++){if(!this.select_values[`${t[r]}`])if(e=!0,this.newEnumAllowed){if(!this.addNewOption(t[r]))continue}else continue;const n=this.sanitize(this.select_values[t[r]]);i.push(n),n!==t[r]&&(e=!0)}return this.value=i,e}addNewOption(t){return this.option_keys.push(`${t}`),this.option_titles.push(`${t}`),this.select_values[`${t}`]=t,this.selectize_instance.addOption({text:t,value:t}),!0}enable(){!this.always_disabled&&this.selectize_instance&&this.selectize_instance.unlock(),super.enable()}disable(t){this.selectize_instance&&this.selectize_instance.lock(),super.disable(t)}destroy(){this.selectize_instance&&(this.selectize_instance.destroy(),this.selectize_instance=null),super.destroy()}}class Idt extends Zr{postBuild(){window.Autocomplete&&(this.autocomplete_wrapper=document.createElement("div"),this.input.parentNode.insertBefore(this.autocomplete_wrapper,this.input.nextSibling),this.autocomplete_wrapper.appendChild(this.input),this.autocomplete_dropdown=document.createElement("ul"),this.input.parentNode.insertBefore(this.autocomplete_dropdown,this.input.nextSibling)),super.postBuild()}afterInputReady(){let t;window.Autocomplete&&!this.autocomplete_instance&&(t=this.expandCallbacks("autocomplete",$t({},{search:e=>(console.log(`No "search" callback defined for autocomplete in property "${e.key}"`),[]),onSubmit:()=>{this.input.blur()},baseClass:"autocomplete"},this.defaults.options.autocomplete||{},this.options.autocomplete||{})),this.autocomplete_wrapper.classList.add(t.baseClass),this.autocomplete_dropdown.classList.add(`${t.baseClass}-result-list`),this.autocomplete_instance=new window.Autocomplete(this.autocomplete_wrapper,t)),super.afterInputReady()}destroy(){this.autocomplete_instance&&(this.input&&this.input.parentNode&&this.input.parentNode.removeChild(this.input),this.autocomplete_dropdown&&this.autocomplete_dropdown.parentNode&&this.autocomplete_dropdown.parentNode.removeChild(this.autocomplete_dropdown),this.autocomplete_wrapper&&this.autocomplete_wrapper.parentNode&&this.autocomplete_wrapper.parentNode.removeChild(this.autocomplete_wrapper),this.autocomplete_instance=null),super.destroy()}}class Adt extends Ks{getNumColumns(){return 4}setFileReaderListener(t){t.addEventListener("load",e=>{if(this.count===this.current_item_index)this.value[this.count][this.key]=e.target.result;else{const i={};for(const r in this.parent.schema.properties)i[r]="";i[this.key]=e.target.result,this.value.splice(this.count,0,i)}this.count+=1,this.count===this.total+this.current_item_index&&this.arrayEditor.setValue(this.value)})}build(){if(this.options.compact||(this.title=this.header=this.label=this.theme.getFormInputLabel(this.getTitle(),this.isRequired())),this.options.infoText&&(this.infoButton=this.theme.getInfoButton(this.translateProperty(this.options.infoText))),this.input=this.theme.getFormInputField("hidden"),this.container.appendChild(this.input),!this.schema.readOnly&&!this.schema.readonly){if(!window.FileReader)throw new Error("FileReader required for base64 editor");this.uploader=this.theme.getFormInputField("file"),this.uploader.style.display="none",this.schema.options&&this.schema.options.multiple&&this.schema.options.multiple===!0&&this.parent&&this.parent.schema.type==="object"&&this.parent.parent&&this.parent.parent.schema.type==="array"&&this.uploader.setAttribute("multiple",""),this.uploader.addEventListener("change",e=>{if(e.preventDefault(),e.stopPropagation(),e.currentTarget.files&&e.currentTarget.files.length)if(e.currentTarget.files.length>1&&this.schema.options&&this.schema.options.multiple&&this.schema.options.multiple===!0&&this.parent&&this.parent.schema.type==="object"&&this.parent.parent&&this.parent.parent.schema.type==="array"){this.arrayEditor=this.jsoneditor.getEditor(this.parent.parent.path),this.value=this.arrayEditor.getValue(),this.total=e.currentTarget.files.length,this.current_item_index=parseInt(this.parent.key),this.count=this.current_item_index;for(let i=0;i<this.total;i++){const r=new FileReader;this.setFileReaderListener(r),r.readAsDataURL(e.currentTarget.files[i])}}else{let i=new FileReader;i.onload=r=>{this.value=r.target.result,this.refreshPreview(),this.onChange(!0),i=null},i.readAsDataURL(e.currentTarget.files[0])}})}this.preview=this.theme.getFormInputDescription(this.translateProperty(this.schema.description)),this.container.appendChild(this.preview),this.control=this.theme.getFormControl(this.label,this.uploader||this.input,this.preview,this.infoButton),this.container.appendChild(this.control);const t=this.getButton("button_upload","upload","button_upload");t.addEventListener("click",()=>{this.uploader.click()}),this.control.appendChild(t)}refreshPreview(){if(this.last_preview===this.value||(this.last_preview=this.value,this.preview.innerHTML="",!this.value))return;let t=this.value.match(/^data:([^;,]+)[;,]/);if(t&&(t=t[1]),!t)this.preview.innerHTML="<em>Invalid data URI</em>";else if(this.preview.innerHTML=`<strong>Type:</strong> ${t}, <strong>Size:</strong> ${Math.floor((this.value.length-this.value.split(",")[0].length-1)/1.33333)} bytes`,t.substr(0,5)==="image"){this.preview.innerHTML+="<br>";const e=document.createElement("img");e.style.maxWidth="100%",e.style.maxHeight="100px",e.src=this.value,this.preview.appendChild(e)}}enable(){this.always_disabled||(this.uploader&&(this.uploader.disabled=!1),super.enable())}disable(t){t&&(this.always_disabled=!0),this.uploader&&(this.uploader.disabled=!0),super.disable()}setValue(t){this.value!==t&&(this.schema.readOnly&&this.schema.enum&&!this.schema.enum.includes(t)?this.value=this.schema.enum[0]:this.value=t,this.input.value=this.value,this.refreshPreview(),this.onChange())}destroy(){this.preview&&this.preview.parentNode&&this.preview.parentNode.removeChild(this.preview),this.title&&this.title.parentNode&&this.title.parentNode.removeChild(this.title),this.input&&this.input.parentNode&&this.input.parentNode.removeChild(this.input),this.uploader&&this.uploader.parentNode&&this.uploader.parentNode.removeChild(this.uploader),super.destroy()}}class JD extends Ks{constructor(t,e){super(t,e),this.active=!1,this.isUiOnly=!0,this.parent&&this.parent.schema&&(Array.isArray(this.parent.schema.required)?this.parent.schema.required.includes(this.key)||this.parent.schema.required.push(this.key):this.parent.schema.required=[this.key])}build(){this.options.compact=!0;const t=this.expandCallbacks("button",$t({},{icon:"",validated:!1,align:"left",action:(i,r)=>{window.alert(`No button action defined for "${i.path}"`)}},this.defaults.options.button||{},this.options.button||{})),e=this.translateProperty(t.text||this.schema.title)||this.key;this.input=this.getButton(e,t.icon,e),typeof t.action!="function"?window.alert(`No button action defined for "${this.path}"`):this.input.addEventListener("click",t.action,!1),(this.schema.readOnly||this.schema.readonly||this.schema.template)&&(this.disable(!0),this.input.setAttribute("readonly","true")),this.setInputAttributes(["readonly"]),this.control=this.theme.getFormButtonHolder(t.align),this.control.appendChild(this.input),this.container.appendChild(this.control),this.changeHandler=()=>{this.jsoneditor.validate(this.jsoneditor.getValue()).length>0?this.disable():this.enable()},t.validated&&this.jsoneditor.on("change",this.changeHandler)}enable(){this.always_disabled||(this.input.disabled=!1,super.enable())}disable(t){t&&(this.always_disabled=!0),this.input.disabled=!0,super.disable()}getNumColumns(){return 2}activate(){this.active=!1,this.enable()}deactivate(){this.isRequired()||(this.active=!1,this.disable())}destroy(){this.jsoneditor.off("change",this.changeHandler),this.changeHandler=null,super.destroy()}}class Ldt extends Ks{setValue(t,e){t=!!t;const i=this.getValue()!==t;this.value=t,this.input.checked=this.value,e||(this.is_dirty=!0),this.onChange(i)}register(){super.register(),this.input&&this.jsoneditor.options.use_name_attributes&&this.input.setAttribute("name",this.formname)}unregister(){super.unregister(),this.input&&this.input.removeAttribute("name")}getNumColumns(){return Math.min(12,Math.max(this.getTitle().length/7,2))}build(){this.parent.options.table_row||(this.label=this.header=this.theme.getCheckboxLabel(this.getTitle(),this.isRequired()),this.label.htmlFor=this.formname),this.schema.description&&(this.description=this.theme.getFormInputDescription(this.translateProperty(this.schema.description))),this.options.infoText&&!this.options.compact&&(this.infoButton=this.theme.getInfoButton(this.translateProperty(this.options.infoText))),this.options.compact&&this.container.classList.add("compact"),this.input=this.theme.getCheckbox(),this.input.id=this.formname,this.control=this.theme.getFormControl(this.label,this.input,this.description,this.infoButton),(this.schema.readOnly||this.schema.readonly)&&(this.disable(!0),this.input.disabled=!0),this.input.addEventListener("change",t=>{t.preventDefault(),t.stopPropagation(),this.value=t.currentTarget.checked,this.is_dirty=!0,this.onChange(!0)}),this.container.appendChild(this.control)}enable(){this.always_disabled||(this.input.disabled=!1,super.enable())}disable(t){t&&(this.always_disabled=!0),this.input.disabled=!0,super.disable()}destroy(){this.label&&this.label.parentNode&&this.label.parentNode.removeChild(this.label),this.description&&this.description.parentNode&&this.description.parentNode.removeChild(this.description),this.input&&this.input.parentNode&&this.input.parentNode.removeChild(this.input),super.destroy()}showValidationErrors(t){const e=this.jsoneditor.options.show_errors;if(e==="never"||(e==="change"||e==="interaction")&&!this.is_dirty)return;const r=(o,a)=>(a.path===this.path&&o.push(a.message),o),n=t.reduce(r,[]);this.input.controlgroup=this.control,n.length?this.theme.addInputError(this.input,`${n.join(". ")}.`):this.theme.removeInputError(this.input)}}class Rf extends Ks{setValue(t,e){let i=this.typecast(t);const r=!!this.jsoneditor.options.use_default_values||typeof this.schema.default<"u";(this.enum_options.length>0&&!this.enum_values.includes(i)||e&&!this.isRequired()&&!r)&&(i=this.enum_values[0]),this.value!==i&&(this.input.value=this.enum_options[this.enum_values.indexOf(i)],this.value=i,e||(this.is_dirty=!0),this.onChange(),this.change())}register(){super.register(),this.input&&this.jsoneditor.options.use_name_attributes&&this.input.setAttribute("name",this.formname)}unregister(){super.unregister(),this.input&&this.input.removeAttribute("name")}getNumColumns(){if(!this.enum_options)return 3;let t=this.getTitle().length;for(let e=0;e<this.enum_options.length;e++)t=Math.max(t,this.enum_options[e].length+4);return Math.min(12,Math.max(t/7,2))}typecast(t){return this.schema.type==="boolean"?t==="undefined"||t===void 0?void 0:!!t:this.schema.type==="number"?1*t||0:this.schema.type==="integer"?Math.floor(t*1||0):this.schema.enum&&t===void 0?void 0:`${t}`}getValue(){if(this.dependenciesFulfilled)return this.typecast(this.value)}preBuild(){this.input_type="select",this.enum_options=[],this.enum_values=[],this.enum_display=[];let t,e;if(this.schema.enum){const i=this.schema.options&&this.schema.options.enum_titles||[];this.schema.enum.forEach((r,n)=>{this.enum_options[n]=`${r}`,this.enum_display[n]=`${this.translateProperty(i[n])||r}`,this.enum_values[n]=this.typecast(r)})}else if(this.schema.type==="boolean")this.enum_display=this.schema.options&&this.schema.options.enum_titles||["true","false"],this.enum_options=["1",""],this.enum_values=[!0,!1],this.isRequired()||(this.enum_display.unshift(" "),this.enum_options.unshift("undefined"),this.enum_values.unshift(void 0));else if(this.schema.enumSource){if(this.enumSource=[],this.enum_display=[],this.enum_options=[],this.enum_values=[],!Array.isArray(this.schema.enumSource))this.schema.enumValue?this.enumSource=[{source:this.schema.enumSource,value:this.schema.enumValue}]:this.enumSource=[{source:this.schema.enumSource}];else for(t=0;t<this.schema.enumSource.length;t++)typeof this.schema.enumSource[t]=="string"?this.enumSource[t]={source:this.schema.enumSource[t]}:Array.isArray(this.schema.enumSource[t])?this.enumSource[t]=this.schema.enumSource[t]:this.enumSource[t]=$t({},this.schema.enumSource[t]);for(t=0;t<this.enumSource.length;t++)this.enumSource[t].value&&(e=this.expandCallbacks("template",{template:this.enumSource[t].value}),typeof e.template=="function"?this.enumSource[t].value=e.template:this.enumSource[t].value=this.jsoneditor.compileTemplate(this.enumSource[t].value,this.template_engine)),this.enumSource[t].title&&(e=this.expandCallbacks("template",{template:this.enumSource[t].title}),typeof e.template=="function"?this.enumSource[t].title=e.template:this.enumSource[t].title=this.jsoneditor.compileTemplate(this.enumSource[t].title,this.template_engine)),this.enumSource[t].filter&&this.enumSource[t].value&&(e=this.expandCallbacks("template",{template:this.enumSource[t].filter}),typeof e.template=="function"?this.enumSource[t].filter=e.template:this.enumSource[t].filter=this.jsoneditor.compileTemplate(this.enumSource[t].filter,this.template_engine))}else throw new Error("'select' editor requires the enum property to be set.")}build(){this.options.compact||(this.header=this.label=this.theme.getFormInputLabel(this.getTitle(),this.isRequired())),this.schema.description&&(this.description=this.theme.getFormInputDescription(this.translateProperty(this.schema.description))),this.options.infoText&&(this.infoButton=this.theme.getInfoButton(this.translateProperty(this.options.infoText))),this.options.compact&&this.container.classList.add("compact"),this.input=this.theme.getSelectInput(this.enum_options,!1),this.theme.setSelectOptions(this.input,this.enum_options,this.enum_display),(this.schema.readOnly||this.schema.readonly)&&(this.disable(!0),this.input.disabled=!0),this.setInputAttributes([]),this.input.addEventListener("change",t=>{t.preventDefault(),t.stopPropagation(),this.onInputChange()}),this.control=this.theme.getFormControl(this.label,this.input,this.description,this.infoButton,this.formname),this.container.appendChild(this.control),this.value=this.enum_values[0],window.requestAnimationFrame(()=>{this.input.parentNode&&this.afterInputReady()})}afterInputReady(){this.theme.afterInputReady(this.input)}onInputChange(){const t=this.typecast(this.input.value);let e;this.enum_values.includes(t)?e=this.enum_values[this.enum_values.indexOf(t)]:e=this.enum_values[0],e!==this.value&&(this.is_dirty=!0,this.value=e,this.onChange(!0))}onWatchedFieldChange(){let t,e,i=[],r=[];if(this.enumSource){t=this.getWatchedFieldValues();for(let o=0;o<this.enumSource.length;o++)if(Array.isArray(this.enumSource[o]))i=i.concat(this.enumSource[o]),r=r.concat(this.enumSource[o]);else{let a=[];if(Array.isArray(this.enumSource[o].source)?a=this.enumSource[o].source:a=t[this.enumSource[o].source],a){if(this.enumSource[o].slice&&(a=Array.prototype.slice.apply(a,this.enumSource[o].slice)),this.enumSource[o].filter){const c=[];for(e=0;e<a.length;e++)this.enumSource[o].filter({i:e,item:a[e],watched:t})&&c.push(a[e]);a=c}const l=[],h=[];for(e=0;e<a.length;e++){const c=a[e];this.enumSource[o].value?h[e]=this.typecast(this.enumSource[o].value({i:e,item:c})):h[e]=a[e],this.enumSource[o].title?l[e]=this.enumSource[o].title({i:e,item:c}):l[e]=h[e]}this.enumSource[o].sort&&((c,u,d)=>{c.map((p,g)=>({v:p,t:u[g]})).sort((p,g)=>p.v<g.v?-d:p.v===g.v?0:d).forEach((p,g)=>{c[g]=p.v,u[g]=p.t})}).bind(null,h,l,this.enumSource[o].sort==="desc"?1:-1)(),i=i.concat(h),r=r.concat(l)}}const n=this.value;this.theme.setSelectOptions(this.input,i,r),this.enum_options=i,this.enum_display=r,this.enum_values=i,i.includes(n)||this.jsoneditor.options.enum_source_value_auto_select!==!1?(this.input.value=n,this.value=n):(this.input.value=i[0],this.value=this.typecast(i[0]||""),this.parent&&!this.watchLoop?this.parent.onChildEditorChange(this):this.jsoneditor.onChange(),this.jsoneditor.notifyWatchers(this.path))}super.onWatchedFieldChange()}enable(){this.always_disabled||(this.input.disabled=!1,super.enable())}disable(t){t&&(this.always_disabled=!0),this.input.disabled=!0,super.disable(t)}destroy(){this.label&&this.label.parentNode&&this.label.parentNode.removeChild(this.label),this.description&&this.description.parentNode&&this.description.parentNode.removeChild(this.description),this.input&&this.input.parentNode&&this.input.parentNode.removeChild(this.input),super.destroy()}showValidationErrors(t){const e=this.jsoneditor.options.show_errors;if(e==="never"||(e==="change"||e==="interaction")&&!this.is_dirty)return;const r=(o,a)=>(a.path===this.path&&o.push(a.message),o),n=t.reduce(r,[]);n.length?this.theme.addInputError(this.input,`${n.join(". ")}.`):this.theme.removeInputError(this.input)}}const Pdt={".choices > *":"box-sizing:border-box"};class QD extends Rf{setValue(t,e){if(this.choices_instance){let i=this.typecast(t||"");if(this.enum_values.includes(i)||(i=this.enum_values[0]),this.value===i)return;e?this.is_dirty=!1:this.jsoneditor.options.show_errors==="change"&&(this.is_dirty=!0),this.input.value=this.enum_options[this.enum_values.indexOf(i)],this.choices_instance.setChoiceByValue(this.input.value),this.value=i,this.onChange()}else super.setValue(t,e)}afterInputReady(){if(window.Choices&&!this.choices_instance){const t=this.expandCallbacks("choices",$t({},this.defaults.options.choices||{},this.options.choices||{}));this.choices_instance=new window.Choices(this.input,t)}super.afterInputReady()}onWatchedFieldChange(){if(super.onWatchedFieldChange(),this.choices_instance){const t=this.enum_options.map((e,i)=>({value:e,label:this.enum_display[i]}));this.choices_instance.setChoices(t,"value","label",!0),this.choices_instance.setChoiceByValue(`${this.value}`)}}enable(){!this.always_disabled&&this.choices_instance&&this.choices_instance.enable(),super.enable()}disable(t){this.choices_instance&&this.choices_instance.disable(),super.disable(t)}destroy(){this.choices_instance&&(this.choices_instance.destroy(),this.choices_instance=null),super.destroy()}}QD.rules=Pdt;class Odt extends Zr{build(){if(super.build(),!!this.input&&(this.schema.max&&typeof this.schema.max=="string"&&this.input.setAttribute("max",this.schema.max),this.schema.min&&typeof this.schema.max=="string"&&this.input.setAttribute("min",this.schema.min),window.flatpickr&&typeof this.options.flatpickr=="object")){this.options.flatpickr.enableTime=this.schema.format!=="date",this.options.flatpickr.noCalendar=this.schema.format==="time",this.schema.type==="integer"&&(this.options.flatpickr.mode="single"),this.input.setAttribute("data-input","");let{input:t}=this;if(this.options.flatpickr.wrap===!0){const e=[];if(this.options.flatpickr.showToggleButton!==!1){const o=this.getButton("",this.schema.format==="time"?"time":"calendar","flatpickr_toggle_button");o.setAttribute("data-toggle",""),e.push(o)}if(this.options.flatpickr.showClearButton!==!1){const o=this.getButton("","clear","flatpickr_clear_button");o.setAttribute("data-clear",""),e.push(o)}const{parentNode:i}=this.input,{nextSibling:r}=this.input,n=this.theme.getInputGroup(this.input,e);n!==void 0?(this.options.flatpickr.inline=!1,i.insertBefore(n,r),t=n):this.options.flatpickr.wrap=!1}this.flatpickr=window.flatpickr(t,this.options.flatpickr),this.options.flatpickr.inline===!0&&this.options.flatpickr.inlineHideInput===!0&&this.input.setAttribute("type","hidden")}}getValue(){if(!this.dependenciesFulfilled)return;if(this.schema.type==="string")return this.value;if(this.value===""||this.value===void 0)return;const t=this.schema.format==="time"?`1970-01-01 ${this.value}`:this.value;return parseInt(new Date(t).getTime()/1e3)}setValue(t,e,i){if(this.schema.type==="string")super.setValue(t,e,i),this.flatpickr&&this.flatpickr.setDate(t);else if(t>0){const r=new Date(t*1e3),n=r.getFullYear(),o=this.zeroPad(r.getMonth()+1),a=this.zeroPad(r.getDate()),l=this.zeroPad(r.getHours()),h=this.zeroPad(r.getMinutes()),c=this.zeroPad(r.getSeconds()),u=[n,o,a].join("-"),d=[l,h,c].join(":");let p=`${u}T${d}`;this.schema.format==="date"?p=u:this.schema.format==="time"&&(p=d),this.input.value=p,this.refreshValue(),this.flatpickr&&this.flatpickr.setDate(p)}}destroy(){this.flatpickr&&this.flatpickr.destroy(),this.flatpickr=null,super.destroy()}zeroPad(t){return`0${t}`.slice(-2)}}class Fdt extends Ks{register(){if(this.editors){for(let t=0;t<this.editors.length;t++)this.editors[t]&&this.editors[t].unregister();this.editors[this.currentEditor]&&this.editors[this.currentEditor].register()}super.register()}unregister(){if(super.unregister(),this.editors)for(let t=0;t<this.editors.length;t++)this.editors[t]&&this.editors[t].unregister()}getNumColumns(){return this.editors[this.currentEditor]?Math.max(this.editors[this.currentEditor].getNumColumns(),4):4}enable(){if(this.editors)for(let t=0;t<this.editors.length;t++)this.editors[t]&&this.editors[t].enable();super.enable()}disable(){if(this.editors)for(let t=0;t<this.editors.length;t++)this.editors[t]&&this.editors[t].disable();super.disable()}switchEditor(){const t=this.getWatchedFieldValues();if(!t)return;const e=document.location.origin+document.location.pathname+this.template(t);this.editors[this.refs[e]]||this.buildChildEditor(e),this.currentEditor=this.refs[e],this.register(),this.editors.forEach((i,r)=>{i&&(this.currentEditor===r?i.container.style.display="":i.container.style.display="none")}),this.refreshValue(),this.onChange(!0)}buildChildEditor(t){this.refs[t]=this.editors.length;const e=this.theme.getChildEditorHolder();this.editor_holder.appendChild(e);const i=$t({},this.schema,this.jsoneditor.refs[t]),r=this.jsoneditor.getEditorClass(i,this.jsoneditor),n=this.jsoneditor.createEditor(r,{jsoneditor:this.jsoneditor,schema:i,container:e,path:this.path,parent:this,required:!0});this.editors.push(n),n.preBuild(),n.build(),n.postBuild()}preBuild(){this.refs={},this.editors=[],this.currentEditor="";let t;for(t=0;t<this.schema.links.length;t++)if(this.schema.links[t].rel.toLowerCase()==="describedby"){this.template=this.jsoneditor.compileTemplate(this.schema.links[t].href,this.template_engine);break}this.schema.links=this.schema.links.slice(0,t).concat(this.schema.links.slice(t+1)),this.schema.links.length===0&&delete this.schema.links,this.baseSchema=$t({},this.schema)}build(){this.editor_holder=document.createElement("div"),this.container.appendChild(this.editor_holder),this.switchEditor()}onWatchedFieldChange(){this.switchEditor()}onChildEditorChange(t){this.editors[this.currentEditor]&&this.refreshValue(),super.onChildEditorChange(t)}refreshValue(){this.editors[this.currentEditor]&&(this.value=this.editors[this.currentEditor].getValue())}setValue(t,e){this.editors[this.currentEditor]&&(this.editors[this.currentEditor].setValue(t,e),this.refreshValue(),this.onChange())}destroy(){this.editors.forEach(t=>{t&&t.destroy()}),this.editor_holder&&this.editor_holder.parentNode&&this.editor_holder.parentNode.removeChild(this.editor_holder),super.destroy()}showValidationErrors(t){this.editors.forEach(e=>{e&&e.showValidationErrors(t)})}}class kdt extends Ks{getNumColumns(){return 4}build(){this.title=this.header=this.label=this.theme.getFormInputLabel(this.getTitle(),this.isRequired()),this.container.appendChild(this.title),this.options.enum_titles=this.options.enum_titles||[],this.enum=this.schema.enum,this.selected=0,this.select_options=[],this.html_values=[];for(let t=0;t<this.enum.length;t++)this.select_options[t]=this.options.enum_titles[t]||`Value ${t+1}`,this.html_values[t]=this.getHTML(this.enum[t]);this.switcher=this.theme.getSwitcher(this.select_options),this.container.appendChild(this.switcher),this.display_area=this.theme.getIndentedPanel(),this.container.appendChild(this.display_area),this.options.hide_display&&(this.display_area.style.display="none"),this.switcher.addEventListener("change",t=>{this.selected=this.select_options.indexOf(t.currentTarget.value),this.value=this.enum[this.selected],this.refreshValue(),this.onChange(!0)}),this.value=this.enum[0],this.refreshValue(),this.enum.length===1&&(this.switcher.style.display="none")}refreshValue(){this.selected=-1;const t=JSON.stringify(this.value);if(this.enum.forEach((e,i)=>{if(t===JSON.stringify(e))return this.selected=i,!1}),this.selected<0){this.setValue(this.enum[0]);return}this.switcher.value=this.select_options[this.selected],this.display_area.innerHTML=this.html_values[this.selected]}enable(){this.always_disabled||(this.switcher.disabled=!1,super.enable())}disable(t){t&&(this.always_disabled=!0),this.switcher.disabled=!0,super.disable()}getHTML(t){const e=(i,r)=>{Array.isArray(i)||typeof i.length=="number"&&i.length>0&&i.length-1 in i?Array.from(i).forEach((n,o)=>r(o,n)):Object.entries(i).forEach(([n,o])=>r(n,o))};if(t===null)return"<em>null</em>";if(typeof t=="object"){let i="";return e(t,(r,n)=>{let o=this.getHTML(n);Array.isArray(t)||(o=`<div><em>${r}</em>: ${o}</div>`),i+=`<li>${o}</li>`}),Array.isArray(t)?i=`<ol>${i}</ol>`:i=`<ul style='margin-top:0;margin-bottom:0;padding-top:0;padding-bottom:0;'>${i}</ul>`,i}else{if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}return t}setValue(t){this.value!==t&&(this.value=t,this.refreshValue(),this.onChange())}destroy(){this.display_area&&this.display_area.parentNode&&this.display_area.parentNode.removeChild(this.display_area),this.title&&this.title.parentNode&&this.title.parentNode.removeChild(this.title),this.switcher&&this.switcher.parentNode&&this.switcher.parentNode.removeChild(this.switcher),super.destroy()}}class Ndt extends Ks{register(){super.register(),this.input&&this.jsoneditor.options.use_name_attributes&&this.input.setAttribute("name",this.formname)}unregister(){super.unregister(),this.input&&this.input.removeAttribute("name")}setValue(t,e,i){if(this.template&&!i||(t===null||typeof t>"u"?t="":typeof t=="object"?t=JSON.stringify(t):typeof t!="string"&&(t=`${t}`),t===this.serialized))return;const r=this.sanitize(t);if(this.input.value===r)return;this.input.value=r;const n=i||this.getValue()!==t;this.refreshValue(),e?this.is_dirty=!1:this.jsoneditor.options.show_errors==="change"&&(this.is_dirty=!0),this.adjust_height&&this.adjust_height(this.input),this.onChange(n)}getNumColumns(){return 2}enable(){super.enable()}disable(){super.disable()}refreshValue(){this.value=this.input.value,typeof this.value!="string"&&(this.value=""),this.serialized=this.value}destroy(){this.template=null,this.input&&this.input.parentNode&&this.input.parentNode.removeChild(this.input),this.label&&this.label.parentNode&&this.label.parentNode.removeChild(this.label),this.description&&this.description.parentNode&&this.description.parentNode.removeChild(this.description),super.destroy()}sanitize(t){return t}onWatchedFieldChange(){let t;this.template&&(t=this.getWatchedFieldValues(),this.setValue(this.template(t),!1,!0)),super.onWatchedFieldChange()}build(){if(this.format=this.schema.format,!this.format&&this.options.default_format&&(this.format=this.options.default_format),this.options.format&&(this.format=this.options.format),this.input_type="hidden",this.input=this.theme.getFormInputField(this.input_type),this.format&&this.input.setAttribute("data-schemaformat",this.format),this.container.appendChild(this.input),this.schema.template){const t=this.expandCallbacks("template",{template:this.schema.template});typeof t.template=="function"?this.template=t.template:this.template=this.jsoneditor.compileTemplate(this.schema.template,this.template_engine),this.refreshValue()}else this.refreshValue()}}class Ddt extends JD{build(){this.options.compact=!1,this.header=this.label=this.theme.getLabelLike(this.getTitle()),this.description=this.theme.getDescription(this.schema.description||""),this.control=this.theme.getFormControl(this.label,this.description,null),this.container.appendChild(this.control)}getTitle(){return this.translateProperty(this.schema.title)}getNumColumns(){return 12}}class t$ extends Zr{build(){if(super.build(),typeof this.schema.minimum<"u"){let{minimum:t}=this.schema;typeof this.schema.exclusiveMinimum<"u"&&(t+=1),this.input.setAttribute("min",t)}if(typeof this.schema.maximum<"u"){let{maximum:t}=this.schema;typeof this.schema.exclusiveMaximum<"u"&&(t-=1),this.input.setAttribute("max",t)}if(typeof this.schema.step<"u"){const t=this.schema.step||1;this.input.setAttribute("step",t)}this.setInputAttributes(["maxlength","pattern","readonly","min","max","step"])}getNumColumns(){return 2}getValue(){if(this.dependenciesFulfilled)if(!this.schema.default&&!this.jsoneditor.options.use_default_values&&this.value===""){if(this.shouldBeUnset()){this.input.value="";return}}else return vdt(this.value)?parseFloat(this.value):this.value}}class e$ extends t${getNumColumns(){return 2}getValue(){if(this.dependenciesFulfilled)if(!this.schema.default&&!this.jsoneditor.options.use_default_values&&this.value===""){if(this.shouldBeUnset())return}else return wdt(this.value)?parseInt(this.value):this.value}}class $dt extends Zr{preBuild(){if(super.preBuild(),this.schema.options||(this.schema.options={}),!this.schema.options.cleave)switch(this.format){case"ipv6":this.schema.options.cleave={delimiters:[":"],blocks:[4,4,4,4,4,4,4,4],uppercase:!0};break;case"ipv4":this.schema.options.cleave={delimiters:["."],blocks:[3,3,3,3],numericOnly:!0};break}this.options=$t(this.options,this.schema.options||{})}}class jdt extends Zr{setValue(t,e,i){const r=super.setValue(t,e,i);r!==void 0&&r.changed&&this.jodit_instance&&this.jodit_instance.setEditorValue(r.value)}build(){this.options.format="textarea",super.build(),this.input_type=this.schema.format,this.input.setAttribute("data-schemaformat",this.input_type)}afterInputReady(){let t;window.Jodit?(t=this.expandCallbacks("jodit",$t({},{height:300},this.defaults.options.jodit||{},this.options.jodit||{})),this.jodit_instance=new window.Jodit(this.input,t),(this.schema.readOnly||this.schema.readonly||this.schema.template)&&this.jodit_instance.setReadOnly(!0),this.jodit_instance.events.on("change",()=>{this.value=this.jodit_instance.getEditorValue(),this.is_dirty=!0,this.onChange(!0)}),this.theme.afterInputReady(this.input)):super.afterInputReady()}getNumColumns(){return 6}enable(){!this.always_disabled&&this.jodit_instance&&this.jodit_instance.setReadOnly(!1),super.enable()}disable(t){this.jodit_instance&&this.jodit_instance.setReadOnly(!0),super.disable(t)}destroy(){this.jodit_instance&&(this.jodit_instance.destruct(),this.jodit_instance=null),super.destroy()}}const Gdt=s=>{const t=s.split(".");if(t.length!==4)throw new Error("error_ipv4");t.forEach(e=>{if(isNaN(+e)||+e<0||+e>255)throw new Error("error_ipv4")})},zdt=s=>{if(!s.match("^(?:(?:(?:[a-fA-F0-9]{1,4}:){6}|(?=(?:[a-fA-F0-9]{0,4}:){2,6}(?:[0-9]{1,3}.){3}[0-9]{1,3}$)(([0-9a-fA-F]{1,4}:){1,5}|:)((:[0-9a-fA-F]{1,4}){1,5}:|:)|::(?:[a-fA-F0-9]{1,4}:){5})(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9]).){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])|(?:[a-fA-F0-9]{1,4}:){7}[a-fA-F0-9]{1,4}|(?=(?:[a-fA-F0-9]{0,4}:){0,7}[a-fA-F0-9]{0,4}$)(([0-9a-fA-F]{1,4}:){1,7}|:)((:[0-9a-fA-F]{1,4}){1,7}|:)|(?:[a-fA-F0-9]{1,4}:){7}:|:(:[a-fA-F0-9]{1,4}){7})$"))throw new Error("error_ipv6")},Bdt=s=>{if(!s.match("(?=^.{4,253}$)(^((?!-)[a-zA-Z0-9-]{0,62}[a-zA-Z0-9].)+[a-zA-Z]{2,63}$)"))throw new Error("error_hostname")};function Udt(s,t,e,i){try{switch(s.format){case"ipv4":Gdt(t);break;case"ipv6":zdt(t);break;case"hostname":Bdt(t);break}return[]}catch(r){return[{path:e,property:"format",message:i(r.message)}]}}class i${constructor(t,e,i,r){this.jsoneditor=t,this.schema=e||this.jsoneditor.schema,this.options=i||{},this.translate=this.jsoneditor.translate||r.translate,this.translateProperty=this.jsoneditor.translateProperty||r.translateProperty,this.defaults=r,this._validateSubSchema={dependentRequired(n,o,a){const l=[];if(typeof n.dependentRequired<"u"){let h=[];Object.keys(n.dependentRequired).forEach(c=>{typeof o[c]<"u"&&(h=n.dependentRequired[c].filter(u=>!Wr(o,u)))}),h.length>0&&l.push({message:"Must have the required properties: "+h.join(", "),path:a})}return l},dependentSchemas(n,o,a){let l=[];return Object.keys(n.dependentSchemas).forEach(h=>{if(typeof o[h]<"u"){const c=n.dependentSchemas[h],u=this._validateSchema(c,o,a);l=[...l,...u]}}),l},contains(n,o,a){const l=[];let h=0;o.forEach(u=>{this._validateSchema(n.contains,u,a).length===0&&h++});const c=h===0;return typeof n.minContains<"u"?h<n.minContains&&l.push({message:this.translate("error_minContains",[h,n.minContains],n),path:a}):c&&l.push({message:this.translate("error_contains",null,n),path:a}),typeof n.maxContains<"u"&&h>n.maxContains&&l.push({message:this.translate("error_maxContains",[h,n.maxContains],n),path:a}),l},if(n,o,a){if(typeof n.then>"u"&&typeof n.else>"u")return[];const l=this._validateSchema(n.if,o,a);let h=[],c=[];return typeof n.then<"u"&&(h=this._validateSchema(n.then,o,a)),typeof n.else<"u"&&(c=this._validateSchema(n.else,o,a)),n.if===!0?h:n.if===!1?c:l.length===0?h:l.length>0?c:[]},const(n,o,a){return JSON.stringify(n.const)===JSON.stringify(o)?[]:[{path:a,property:"const",message:this.translate("error_const",null,n)}]},enum(n,o,a){const l=JSON.stringify(o);return n.enum.some(h=>l===JSON.stringify(h))?[]:[{path:a,property:"enum",message:this.translate("error_enum",null,n)}]},extends(n,o,a){const l=(h,c)=>(h.push(...this._validateSchema(c,o,a)),h);return n.extends.reduce(l,[])},allOf(n,o,a){const l=(h,c)=>(h.push(...this._validateSchema(c,o,a)),h);return n.allOf.reduce(l,[])},anyOf(n,o,a){return n.anyOf.some(l=>!this._validateSchema(l,o,a).length)?[]:[{path:a,property:"anyOf",message:this.translate("error_anyOf",null,n)}]},oneOf(n,o,a){let l=0;const h=[];n.oneOf.forEach((u,d)=>{const p=this._validateSchema(u,o,a);p.length||l++,p.forEach(g=>{g.path=`${a}.oneOf[${d}]${g.path.substr(a.length)}`}),h.push(...p)});const c=[];return l!==1&&(c.push({path:a,property:"oneOf",message:this.translate("error_oneOf",[l],n)}),c.push(...h)),c},not(n,o,a){return this._validateSchema(n.not,o,a).length?[]:[{path:a,property:"not",message:this.translate("error_not",null,n)}]},type(n,o,a){if(Array.isArray(n.type)){if(!n.type.some(l=>this._checkType(l,o)))return[{path:a,property:"type",message:this.translate("error_type_union",null,n)}]}else if(["date","time","datetime-local"].includes(n.format)&&n.type==="integer"){if(!this._checkType("string",`${o}`))return[{path:a,property:"type",message:this.translate("error_type",[n.format],n)}]}else if(!this._checkType(n.type,o))return[{path:a,property:"type",message:this.translate("error_type",[n.type],n)}];return[]},disallow(n,o,a){if(Array.isArray(n.disallow)){if(n.disallow.some(l=>this._checkType(l,o)))return[{path:a,property:"disallow",message:this.translate("error_disallow_union",null,n)}]}else if(this._checkType(n.disallow,o))return[{path:a,property:"disallow",message:this.translate("error_disallow",[n.disallow],n)}];return[]}},this._validateNumberSubSchema={multipleOf(n,o,a){return this._validateNumberSubSchemaMultipleDivisible(n,o,a)},divisibleBy(n,o,a){return this._validateNumberSubSchemaMultipleDivisible(n,o,a)},maximum(n,o,a){let l=n.exclusiveMaximum?o<n.maximum:o<=n.maximum;return window.math?l=window.math[n.exclusiveMaximum?"smaller":"smallerEq"](window.math.bignumber(o),window.math.bignumber(n.maximum)):window.Decimal&&(l=new window.Decimal(o)[n.exclusiveMaximum?"lt":"lte"](new window.Decimal(n.maximum))),l?[]:[{path:a,property:"maximum",message:this.translate(n.exclusiveMaximum?"error_maximum_excl":"error_maximum_incl",[n.maximum],n)}]},minimum(n,o,a){let l=n.exclusiveMinimum?o>n.minimum:o>=n.minimum;return window.math?l=window.math[n.exclusiveMinimum?"larger":"largerEq"](window.math.bignumber(o),window.math.bignumber(n.minimum)):window.Decimal&&(l=new window.Decimal(o)[n.exclusiveMinimum?"gt":"gte"](new window.Decimal(n.minimum))),l?[]:[{path:a,property:"minimum",message:this.translate(n.exclusiveMinimum?"error_minimum_excl":"error_minimum_incl",[n.minimum],n)}]}},this._validateStringSubSchema={maxLength(n,o,a){const l=[];return`${o}`.length>n.maxLength&&l.push({path:a,property:"maxLength",message:this.translate("error_maxLength",[n.maxLength],n)}),l},minLength(n,o,a){return`${o}`.length<n.minLength?[{path:a,property:"minLength",message:this.translate(n.minLength===1?"error_notempty":"error_minLength",[n.minLength],n)}]:[]},pattern(n,o,a){return new RegExp(n.pattern).test(o)?[]:[{path:a,property:"pattern",message:n.options&&n.options.patternmessage?n.options.patternmessage:this.translate("error_pattern",[n.pattern],n)}]}},this._validateArraySubSchema={items(n,o,a){const l=[];if(Array.isArray(n.items))for(let h=0;h<o.length;h++)if(n.items[h])l.push(...this._validateSchema(n.items[h],o[h],`${a}.${h}`));else{if(n.additionalItems===!0)break;if(n.additionalItems)l.push(...this._validateSchema(n.additionalItems,o[h],`${a}.${h}`));else if(n.additionalItems===!1){l.push({path:a,property:"additionalItems",message:this.translate("error_additionalItems",null,n)});break}else break}else o.forEach((h,c)=>{l.push(...this._validateSchema(n.items,h,`${a}.${c}`))});return l},maxItems(n,o,a){return o.length>n.maxItems?[{path:a,property:"maxItems",message:this.translate("error_maxItems",[n.maxItems],n)}]:[]},minItems(n,o,a){return o.length<n.minItems?[{path:a,property:"minItems",message:this.translate("error_minItems",[n.minItems],n)}]:[]},uniqueItems(n,o,a){const l={};for(let h=0;h<o.length;h++){const c=JSON.stringify(o[h]);if(l[c])return[{path:a,property:"uniqueItems",message:this.translate("error_uniqueItems",null,n)}];l[c]=!0}return[]}},this._validateObjectSubSchema={maxProperties(n,o,a){return Object.keys(o).length>n.maxProperties?[{path:a,property:"maxProperties",message:this.translate("error_maxProperties",[n.maxProperties],n)}]:[]},minProperties(n,o,a){return Object.keys(o).length<n.minProperties?[{path:a,property:"minProperties",message:this.translate("error_minProperties",[n.minProperties],n)}]:[]},required(n,o,a){const l=[];return Array.isArray(n.required)&&n.required.forEach(h=>{if(typeof o[h]<"u")return;const c=this.jsoneditor.getEditor(`${a}.${h}`);c&&c.dependenciesFulfilled===!1||c&&["button","info"].includes(c.schema.format||c.schema.type)||l.push({path:a,property:"required",message:this.translate("error_required",[n&&n.properties&&n.properties[h]&&n.properties[h].title?n.properties[h].title:h],n)})}),l},properties(n,o,a,l){const h=[];return Object.entries(n.properties).forEach(([c,u])=>{l[c]=!0,h.push(...this._validateSchema(u,o[c],`${a}.${c}`))}),h},patternProperties(n,o,a,l){const h=[];return Object.entries(n.patternProperties).forEach(([c,u])=>{const d=new RegExp(c);Object.entries(o).forEach(([p,g])=>{d.test(p)&&(l[p]=!0,h.push(...this._validateSchema(u,g,`${a}.${p}`)))})}),h}},this._validateObjectSubSchema2={propertyNames(n,o,a,l){const h=[],c=Object.keys(o);let u=null;for(let d=0;d<c.length;d++){let p="",g=!1;if(u=c[d],typeof n.propertyNames=="boolean"){if(n.propertyNames===!0)continue;h.push({path:a,property:"propertyNames",message:this.translate("error_property_names_false",[u],n)});break}if(g=Object.entries(n.propertyNames).every(([f,m])=>{let _=!1,y=null;switch(f){case"maxLength":if(typeof m!="number"){p="error_property_names_maxlength";break}if(u.length>m){p="error_property_names_exceeds_maxlength";break}return!0;case"const":if(m!==u){p="error_property_names_const_mismatch";break}return!0;case"enum":if(!Array.isArray(m)){p="error_property_names_enum";break}if(m.forEach(v=>{v===u&&(_=!0)}),!_){p="error_property_names_enum_mismatch";break}return!0;case"pattern":if(typeof m!="string"){p="error_property_names_pattern";break}if(y=new RegExp(m),!y.test(u)){p="error_property_names_pattern_mismatch";break}return!0;default:return h.push({path:a,property:"propertyNames",message:this.translate("error_property_names_unsupported",[f],n)}),!1}return h.push({path:a,property:"propertyNames",message:this.translate(p,[u],n)}),!1}),!g)break}return h},additionalProperties(n,o,a,l){const h=[],c=Object.keys(o);for(let u=0;u<c.length;u++){const d=c[u];if(!l[d])if(n.additionalProperties){if(n.additionalProperties===!0)break;h.push(...this._validateSchema(n.additionalProperties,o[d],`${a}.${d}`))}else{h.push({path:a,property:"additionalProperties",message:this.translate("error_additional_properties",[d],n)});break}}return h},dependencies(n,o,a){const l=[];return Object.entries(n.dependencies).forEach(([h,c])=>{typeof o[h]>"u"||(Array.isArray(c)?c.forEach(u=>{typeof o[u]>"u"&&l.push({path:a,property:"dependencies",message:this.translate("error_dependency",[u],n)})}):l.push(...this._validateSchema(c,o,a)))}),l}}}fitTest(t,e,i=1e7){const r={match:0,extra:0};if(typeof t=="object"&&t!==null){const n=this._getSchema(e);if(n.anyOf){let o={...r};for(const a of n.anyOf){const l=this.fitTest(t,a,i);(l.match>o.match||l.match===o.match&&l.extra<o.extra)&&(o=l)}return o}else{const o=this._getSchema(e).properties;for(const a in o){if(!Wr(o,a)){r.extra+=i;continue}if(typeof t[a]=="object"&&typeof o[a]=="object"&&typeof o[a].properties=="object"){const l=this.fitTest(t[a],o[a],i/100);r.match+=l.match,r.extra+=l.extra}typeof t[a]<"u"&&(r.match+=i)}}}return r}_getSchema(t){return typeof t>"u"?$t({},this.jsoneditor.expandRefs(this.schema)):t}validate(t){return this._validateSchema(this.schema,t)}_validateSchema(t,e,i){const r=[];return i=i||this.jsoneditor.root.formname,t=$t({},this.jsoneditor.expandRefs(t)),typeof e>"u"?this._validateV3Required(t,e,i):(Object.keys(t).forEach(n=>{this._validateSubSchema[n]&&r.push(...this._validateSubSchema[n].call(this,t,e,i))}),r.push(...this._validateByValueType(t,e,i)),t.links&&t.links.forEach((n,o)=>{n.rel&&n.rel.toLowerCase()==="describedby"&&(t=this._expandSchemaLink(t,o),r.push(...this._validateSchema(t,e,i,this.translate)))}),["date","time","datetime-local"].includes(t.format)&&r.push(...this._validateDateTimeSubSchema(t,e,i)),["uuid"].includes(t.format)&&r.push(...this._validateUUIDSchema(t,e,i)),r.push(...this._validateCustomValidator(t,e,i)),this._removeDuplicateErrors(r))}_expandSchemaLink(t,e){const i=t.links[e].href,r=this.jsoneditor.root.getValue(),n=this.jsoneditor.compileTemplate(i,this.jsoneditor.template),o=document.location.origin+document.location.pathname+n(r);return t.links=t.links.slice(0,e).concat(t.links.slice(e+1)),$t({},t,this.jsoneditor.refs[o])}_validateV3Required(t,e,i){return(typeof t.required<"u"&&t.required===!0||typeof t.required>"u"&&this.jsoneditor.options.required_by_default===!0)&&t.type!=="info"?[{path:i,property:"required",message:this.translate("error_notset",null,t)}]:[]}_validateByValueType(t,e,i){const r=[];if(e===null)return r;if(typeof e=="number")Object.keys(t).forEach(n=>{this._validateNumberSubSchema[n]&&r.push(...this._validateNumberSubSchema[n].call(this,t,e,i))});else if(typeof e=="string")Object.keys(t).forEach(n=>{this._validateStringSubSchema[n]&&r.push(...this._validateStringSubSchema[n].call(this,t,e,i))});else if(Array.isArray(e))Object.keys(t).forEach(n=>{this._validateArraySubSchema[n]&&r.push(...this._validateArraySubSchema[n].call(this,t,e,i))});else if(typeof e=="object"){const n={};Object.keys(t).forEach(o=>{this._validateObjectSubSchema[o]&&r.push(...this._validateObjectSubSchema[o].call(this,t,e,i,n))}),typeof t.additionalProperties>"u"&&this.jsoneditor.options.no_additional_properties&&!t.oneOf&&!t.anyOf&&!t.allOf&&(t.additionalProperties=!1),Object.keys(t).forEach(o=>{typeof this._validateObjectSubSchema2[o]<"u"&&r.push(...this._validateObjectSubSchema2[o].call(this,t,e,i,n))})}return r}_validateUUIDSchema(t,e,i){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)?[]:[{path:i,property:"format",message:this.translate("error_pattern",["^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"],t)}]}_validateNumberSubSchemaMultipleDivisible(t,e,i){const r=t.multipleOf||t.divisibleBy;let n=e/r===Math.floor(e/r);return window.math?n=window.math.mod(window.math.bignumber(e),window.math.bignumber(r)).equals(0):window.Decimal&&(n=new window.Decimal(e).mod(new window.Decimal(r)).equals(0)),n?[]:[{path:i,property:t.multipleOf?"multipleOf":"divisibleBy",message:this.translate("error_multipleOf",[r],t)}]}_validateDateTimeSubSchema(t,e,i){const r=(c,u,d)=>u*1<1?[{path:d,property:"format",message:this.translate("error_invalid_epoch",null,c)}]:u!==Math.abs(parseInt(u))?[{path:d,property:"format",message:this.translate(`error_${c.format.replace(/-/g,"_")}`,[h],c)}]:[],n=(c,u,d,p)=>{if(u!==""){let g;if(p.flatpickr.config.mode!=="single"){const f=p.flatpickr.config.mode==="range"?p.flatpickr.l10n.rangeSeparator:", ";g=p.flatpickr.selectedDates.map(m=>p.flatpickr.formatDate(m,p.flatpickr.config.dateFormat)).join(f)}try{if(g){if(g!==u)throw new Error(`${p.flatpickr.config.mode} mismatch`)}else if(p.flatpickr.formatDate(p.flatpickr.parseDate(u,p.flatpickr.config.dateFormat),p.flatpickr.config.dateFormat)!==u)throw new Error("mismatch")}catch{const f=p.flatpickr.config.errorDateFormat!==void 0?p.flatpickr.config.errorDateFormat:p.flatpickr.config.dateFormat;return[{path:d,property:"format",message:this.translate(`error_${p.format.replace(/-/g,"_")}`,[f],c)}]}}return[]},o={date:/^(\d{4}\D\d{2}\D\d{2})$/,time:/^(\d{2}:\d{2}(?::\d{2})?)$/,"datetime-local":/^(\d{4}\D\d{2}\D\d{2}[ T]\d{2}:\d{2}(?::\d{2})?)$/},a={date:'"YYYY-MM-DD"',time:'"HH:MM"',"datetime-local":'"YYYY-MM-DD HH:MM"'},l=this.jsoneditor.getEditor(i),h=l&&l.flatpickr?l.flatpickr.config.dateFormat:a[t.format];if(t.type==="integer")return r(t,e,i);if(!l||!l.flatpickr){if(!o[t.format].test(e))return[{path:i,property:"format",message:this.translate(`error_${t.format.replace(/-/g,"_")}`,[h],t)}]}else if(l)return n(t,e,i,l);return[]}_validateCustomValidator(t,e,i){const r=[];r.push(...Udt.call(this,t,e,i,this.translate));const n=o=>{r.push(...o.call(this,t,e,i))};return this.defaults.custom_validators.forEach(n),this.options.custom_validators&&this.options.custom_validators.forEach(n),r}_removeDuplicateErrors(t){return t.reduce((e,i)=>{let r=!0;return e||(e=[]),e.forEach(n=>{n.message===i.message&&n.path===i.path&&n.property===i.property&&(n.errorcount++,r=!1)}),r&&(i.errorcount=1,e.push(i)),e},[])}_checkType(t,e){const i={string:r=>typeof r=="string",number:r=>typeof r=="number",integer:r=>typeof r=="number"&&r===Math.floor(r),boolean:r=>typeof r=="boolean",array:r=>Array.isArray(r),object:r=>r!==null&&!Array.isArray(r)&&typeof r=="object",null:r=>r===null};return typeof t=="string"?i[t]?i[t](e):!0:!this._validateSchema(t,e).length}}class Vdt extends Ks{register(){if(this.editors){for(let t=0;t<this.editors.length;t++)this.editors[t]&&this.editors[t].unregister();this.editors[this.type]&&this.editors[this.type].register()}super.register()}unregister(){if(super.unregister(),this.editors)for(let t=0;t<this.editors.length;t++)this.editors[t]&&this.editors[t].unregister()}getNumColumns(){return this.editors[this.type]?Math.max(this.editors[this.type].getNumColumns(),4):4}enable(){if(!this.always_disabled){if(this.editors)for(let t=0;t<this.editors.length;t++)this.editors[t]&&this.editors[t].enable();this.switcher.disabled=!1,super.enable()}}disable(t){if(t&&(this.always_disabled=!0),this.editors)for(let e=0;e<this.editors.length;e++)this.editors[e]&&this.editors[e].disable(t);this.switcher.disabled=!0,super.disable()}switchEditor(t){this.lastType=this.type,this.editors[t]||this.buildChildEditor(t);let e=this.getValue();this.type=t,this.register(),this.editors.forEach((i,r)=>{i&&(this.type===r?(this.keep_only_existing_values&&(e=Edt(i.getValue(),e)),(this.keep_values||this.if)&&i.setValue(e,!0),i.container.style.display=""):i.container.style.display="none")}),this.refreshValue(),this.refreshHeaderText()}buildChildEditor(t){var e;const i=this.types[t],r=this.theme.getChildEditorHolder();this.editor_holder.appendChild(r);let n;typeof i=="string"?(n=$t({},this.schema),n.type=i):(n=$t({},this.schema,i),n=this.jsoneditor.expandRefs(n),i&&i.required&&Array.isArray(i.required)&&this.schema.required&&Array.isArray(this.schema.required)&&(n.required=this.schema.required.concat(i.required))),(e=n==null?void 0:n.options)!=null&&e.dependencies&&delete n.options.dependencies;const o=this.jsoneditor.getEditorClass(n);this.editors[t]=this.jsoneditor.createEditor(o,{jsoneditor:this.jsoneditor,schema:n,container:r,path:this.path,parent:this,required:!0}),this.editors[t].preBuild(),this.editors[t].build(),this.editors[t].postBuild(),this.editors[t].header&&this.theme.visuallyHidden(this.editors[t].header),this.editors[t].option=this.switcher_options[t],r.addEventListener("change_header_text",()=>{this.refreshHeaderText()}),t!==this.type&&(r.style.display="none")}preBuild(){if(this.types=[],this.type=0,this.editors=[],this.validators=[],this.keep_values=!0,typeof this.jsoneditor.options.keep_oneof_values<"u"&&(this.keep_values=this.jsoneditor.options.keep_oneof_values),typeof this.options.keep_oneof_values<"u"&&(this.keep_values=this.options.keep_oneof_values),this.keep_only_existing_values=!1,typeof this.jsoneditor.options.keep_only_existing_values<"u"&&(this.keep_only_existing_values=this.jsoneditor.options.keep_only_existing_values),typeof this.options.keep_only_existing_values<"u"&&(this.keep_only_existing_values=this.options.keep_only_existing_values),this.schema.oneOf)this.oneOf=!0,this.types=this.schema.oneOf,delete this.schema.oneOf;else if(this.schema.anyOf)this.anyOf=!0,this.types=this.schema.anyOf,delete this.schema.anyOf;else if(this.schema.if)this.if=!0,this.ifSchema=JSON.parse(JSON.stringify(this.schema.if)),this.thenSchema={title:"then"},this.elseSchema={title:"else"},this.types=[],this.schema.then&&a_(this.thenSchema,this.schema,this.schema.then),this.schema.else&&a_(this.elseSchema,this.schema,this.schema.else),this.types.push(this.thenSchema),this.types.push(this.elseSchema),this.types.forEach(t=>{delete t.if,delete t.then,delete t.else}),delete this.schema.if;else{if(!this.schema.type||this.schema.type==="any"){if(this.types=["string","number","integer","boolean","object","array","null"],this.schema.disallow){let{disallow:t}=this.schema;(typeof t!="object"||!Array.isArray(t))&&(t=[t]);const e=[];this.types.forEach(i=>{t.includes(i)||e.push(i)}),this.types=e}}else Array.isArray(this.schema.type)?this.types=this.schema.type:this.types=[this.schema.type];delete this.schema.type}this.display_text=this.getDisplayText(this.types)}build(){const{container:t}=this;this.header=this.label=this.theme.getLabelLike(this.getTitle(),this.isRequired()),this.switcher=this.theme.getSwitcher(this.display_text),this.switcher.setAttribute("id",this.formname+"switcher"),this.switcherLabel=this.theme.getHiddenLabel(this.formname+" switcher"),this.switcherLabel.setAttribute("for",this.formname+"switcher"),this.if||(this.container.appendChild(this.header),t.appendChild(this.switcherLabel),t.appendChild(this.switcher)),this.switcher.addEventListener("change",i=>{i.preventDefault(),i.stopPropagation(),this.switchEditor(this.display_text.indexOf(i.currentTarget.value)),this.onChange(!0)}),this.editor_holder=document.createElement("div"),t.appendChild(this.editor_holder);const e={};this.jsoneditor.options.custom_validators&&(e.custom_validators=this.jsoneditor.options.custom_validators),this.switcher_options=this.theme.getSwitcherOptions(this.switcher),this.types.forEach((i,r)=>{this.editors[r]=!1;let n;typeof i=="string"?(n=$t({},this.schema),n.type=i):(n=$t({},this.schema,i),i.required&&Array.isArray(i.required)&&this.schema.required&&Array.isArray(this.schema.required)&&(n.required=this.schema.required.concat(i.required))),this.validators[r]=new i$(this.jsoneditor,n,e,this.defaults)}),this.jsoneditor.on("change",()=>{this.switchIf()}),this.switchEditor(0)}onChildEditorChange(t){this.editors[this.type]&&(this.refreshValue(),this.refreshHeaderText()),super.onChildEditorChange()}refreshHeaderText(){const t=this.getDisplayText(this.types);Array.from(this.switcher_options).forEach((e,i)=>{e.textContent=t[i]})}refreshValue(){this.editors[this.type]&&(this.value=this.editors[this.type].getValue())}switchIf(){if(this.ifSchema&&this.value){const t=this.getIfType(this.value);this.lastType!==t&&(this.switchEditor(t),this.editors[this.type].setValue(this.value,!0)),this.switcher.value=this.display_text[this.type]}}getIfType(t){return this.jsoneditor.validator._validateSchema(this.ifSchema,t).length===0?0:1}setValue(t,e){const i=this.type;let r={match:0,extra:0,i:this.type};const n={match:0,i:null};this.validators.forEach((l,h)=>{let c=null;typeof this.anyOf<"u"&&this.anyOf&&(c=l.fitTest(t),(r.match<c.match||r.match===c.match&&r.extra>c.extra)&&(r=c,r.i=h)),!l.validate(t).length&&n.i===null?(n.i=h,c!==null&&(n.match=c.match)):r=n});let o=n.i;typeof this.anyOf<"u"&&this.anyOf&&n.match<r.match&&(o=r.i),this.if&&(o=this.getIfType(t)),o===null&&(o=this.type),this.type=o,this.switcher.value=this.display_text[o];const a=this.type!==i;a&&(this.switchEditor(this.type),this.editors[this.type].setValue(t,e)),typeof t<"u"&&this.editors[this.type].setValue(t,e),this.refreshValue(),this.onChange(a)}destroy(){this.editors.forEach(t=>{t&&t.destroy()}),this.editor_holder&&this.editor_holder.parentNode&&this.editor_holder.parentNode.removeChild(this.editor_holder),this.switcher&&this.switcher.parentNode&&this.switcher.parentNode.removeChild(this.switcher),super.destroy()}showValidationErrors(t){if(this.oneOf||this.anyOf){const e=this.oneOf?"oneOf":"anyOf";this.editors.forEach((i,r)=>{if(!i)return;const n=`${this.path}.${e}[${r}]`,o=(a,l)=>{if(l.path.startsWith(n)||l.path===n.substr(0,l.path.length)){const h=$t({},l);l.path.startsWith(n)&&(h.path=this.path+h.path.substr(n.length)),a.push(h)}return a};i.showValidationErrors(t.reduce(o,[]))})}else this.editors.forEach(e=>{e&&e.showValidationErrors(t)})}addLinks(){}}class Hdt extends Ks{getValue(){if(this.dependenciesFulfilled)return null}setValue(){this.onChange()}getNumColumns(){return 2}}const Wdt={".je-object__title":"display:inline-block",".je-object__controls":"margin:0%200%200%2010px",".je-object__container":"position:relative",".je-object__property-checkbox":"margin:0;height:auto",".property-selector":"width:295px;max-height:160px;padding:5px%200;overflow-y:auto;overflow-x:hidden;padding-left:5px",".property-selector-input":"width:220px;margin-bottom:0;display:inline-block",".json-editor-btntype-toggle":"margin:0%2010px%200%200",".je-edit-json--textarea":"height:170px;width:300px;display:block"};class s$ extends Ks{constructor(t,e,i){super(t,e),this.currentDepth=i}getDefault(){return $t({},this.schema.default||{})}getChildEditors(){return this.editors}register(){super.register(),this.editors&&Object.values(this.editors).forEach(t=>t.register())}unregister(){super.unregister(),this.editors&&Object.values(this.editors).forEach(t=>t.unregister())}getNumColumns(){return Math.max(Math.min(12,this.maxwidth),3)}enable(){this.always_disabled||(this.editjson_control&&(this.editjson_control.disabled=!1),this.addproperty_button&&(this.addproperty_button.disabled=!1),super.enable(),this.editors&&Object.values(this.editors).forEach(t=>{(t.isActive()||t.isUiOnly)&&t.enable(),t.optInCheckbox.disabled=!1}))}disable(t){t&&(this.always_disabled=!0),this.editjson_control&&(this.editjson_control.disabled=!0),this.addproperty_button&&(this.addproperty_button.disabled=!0),this.hideEditJSON(),super.disable(),this.editors&&Object.values(this.editors).forEach(e=>{(e.isActive()||e.isUiOnly)&&e.disable(t),e.optInCheckbox.disabled=!0})}layoutEditors(){let t,e;if(!this.row_container)return;this.property_order=Object.keys(this.editors),this.property_order=this.property_order.sort((h,c)=>{let u=this.editors[h].schema.propertyOrder,d=this.editors[c].schema.propertyOrder;return typeof u!="number"&&(u=1e3),typeof d!="number"&&(d=1e3),u-d});let i;const r=this.format==="categories",n=[];let o=null,a=null,l;if(this.format==="grid-strict"){let h=0;if(l=[],this.property_order.forEach(c=>{const u=this.editors[c];if(u.property_removed)return;const d=u.options.hidden?0:u.options.grid_columns||u.getNumColumns(),p=u.options.hidden?0:u.options.grid_offset||0,g=u.options.hidden?!1:u.options.grid_break||!1,f=u.options.hidden?0:u.container.offsetHeight,m={key:c,width:d,offset:p,height:f};l.push(m),n[h]=l,g&&(h++,l=[])}),this.layout===JSON.stringify(n))return!1;for(this.layout=JSON.stringify(n),i=document.createElement("div"),t=0;t<n.length;t++)for(l=this.theme.getGridRow(),i.appendChild(l),e=0;e<n[t].length;e++)o=n[t][e].key,a=this.editors[o],a.options.hidden?a.container.style.display="none":this.theme.setGridColumnSize(a.container,n[t][e].width,n[t][e].offset),l.appendChild(a.container)}else if(this.format==="grid"){for(this.property_order.forEach(h=>{const c=this.editors[h];if(c.property_removed)return;let u=!1;const d=c.options.hidden?0:c.options.grid_columns||c.getNumColumns(),p=c.options.hidden?0:c.container.offsetHeight;for(let g=0;g<n.length;g++)n[g].width+d<=12&&(!p||n[g].minh*.5<p&&n[g].maxh*2>p)&&(u=g);u===!1&&(n.push({width:0,minh:999999,maxh:0,editors:[]}),u=n.length-1),n[u].editors.push({key:h,width:d,height:p}),n[u].width+=d,n[u].minh=Math.min(n[u].minh,p),n[u].maxh=Math.max(n[u].maxh,p)}),t=0;t<n.length;t++)if(n[t].width<12){let h=!1,c=0;for(e=0;e<n[t].editors.length;e++)(h===!1||n[t].editors[e].width>n[t].editors[h].width)&&(h=e),n[t].editors[e].width*=12/n[t].width,n[t].editors[e].width=Math.floor(n[t].editors[e].width),c+=n[t].editors[e].width;c<12&&(n[t].editors[h].width+=12-c),n[t].width=12}if(this.layout===JSON.stringify(n))return!1;for(this.layout=JSON.stringify(n),i=document.createElement("div"),t=0;t<n.length;t++)for(l=this.theme.getGridRow(),i.appendChild(l),e=0;e<n[t].editors.length;e++)o=n[t].editors[e].key,a=this.editors[o],a.options.hidden?a.container.style.display="none":this.theme.setGridColumnSize(a.container,n[t].editors[e].width),l.appendChild(a.container)}else{if(i=document.createElement("div"),r){const h=document.createElement("div"),c=this.theme.getTopTabHolder(this.translateProperty(this.schema.title)),u=this.theme.getTopTabContentHolder(c);for(this.property_order.forEach(g=>{const f=this.editors[g];if(f.property_removed)return;const m=this.theme.getTabContent(),_=f.schema&&(f.schema.type==="object"||f.schema.type==="array");m.isObjOrArray=_;const y=this.theme.getGridRow();f.tab||(typeof this.basicPane>"u"?this.addRow(f,c,m):this.addRow(f,c,this.basicPane)),m.id=this.getValidId(f.tab_text.textContent),_?(m.appendChild(y),u.appendChild(m),this.theme.addTopTab(c,f.tab)):(h.appendChild(y),u.childElementCount>0?u.firstChild.isObjOrArray&&(m.appendChild(h),u.insertBefore(m,u.firstChild),this.theme.insertBasicTopTab(f.tab,c),f.basicPane=m):(m.appendChild(h),u.appendChild(m),this.theme.addTopTab(c,f.tab),f.basicPane=m)),f.options.hidden?f.container.style.display="none":this.theme.setGridColumnSize(f.container,12),y.appendChild(f.container),f.rowPane=m});this.tabPanesContainer.firstChild;)this.tabPanesContainer.removeChild(this.tabPanesContainer.firstChild);const d=this.tabs_holder.parentNode;d.removeChild(d.firstChild),d.appendChild(c),this.tabPanesContainer=u,this.tabs_holder=c;const p=this.theme.getFirstTab(this.tabs_holder);p&&Dn(p,"click");return}this.property_order.forEach(h=>{const c=this.editors[h];c.property_removed||(l=this.theme.getGridRow(),i.appendChild(l),c.options.hidden?c.container.style.display="none":this.theme.setGridColumnSize(c.container,12),l.appendChild(c.container))})}for(;this.row_container.firstChild;)this.row_container.removeChild(this.row_container.firstChild);this.row_container.appendChild(i)}getPropertySchema(t){let e=this.schema.properties[t]||{};e=$t({},e);let i=!!this.schema.properties[t];return this.schema.patternProperties&&Object.keys(this.schema.patternProperties).forEach(r=>{new RegExp(r).test(t)&&(e.allOf=e.allOf||[],e.allOf.push(this.schema.patternProperties[r]),i=!0)}),!i&&this.schema.additionalProperties&&typeof this.schema.additionalProperties=="object"&&(e=$t({},this.schema.additionalProperties)),e}preBuild(){if(super.preBuild(),this.editors={},this.cached_editors={},this.format=this.options.layout||this.options.object_layout||this.schema.format||this.jsoneditor.options.object_layout||"normal",this.schema.properties=this.schema.properties||{},this.minwidth=0,this.maxwidth=0,this.options.table_row)Object.entries(this.schema.properties).forEach(([t,e])=>{const i=this.jsoneditor.getEditorClass(e);this.editors[t]=this.jsoneditor.createEditor(i,{jsoneditor:this.jsoneditor,schema:e,path:`${this.path}.${t}`,parent:this,compact:!0,required:!0},this.currentDepth+1),this.editors[t].preBuild();const r=this.editors[t].options.hidden?0:this.editors[t].options.grid_columns||this.editors[t].getNumColumns();this.minwidth+=r,this.maxwidth+=r}),this.no_link_holder=!0;else{if(this.options.table)throw new Error("Not supported yet");this.schema.defaultProperties||(this.jsoneditor.options.display_required_only||this.options.display_required_only?this.schema.defaultProperties=Object.keys(this.schema.properties).filter(t=>this.isRequiredObject({key:t,schema:this.schema.properties[t]})):this.schema.defaultProperties=Object.keys(this.schema.properties)),this.maxwidth+=1,Array.isArray(this.schema.defaultProperties)&&this.schema.defaultProperties.forEach(t=>{this.addObjectProperty(t,!0),this.editors[t]&&(this.minwidth=Math.max(this.minwidth,this.editors[t].options.grid_columns||this.editors[t].getNumColumns()),this.maxwidth+=this.editors[t].options.grid_columns||this.editors[t].getNumColumns())})}this.property_order=Object.keys(this.editors),this.property_order=this.property_order.sort((t,e)=>{let i=this.editors[t].schema.propertyOrder,r=this.editors[e].schema.propertyOrder;return typeof i!="number"&&(i=1e3),typeof r!="number"&&(r=1e3),i-r})}addTab(t){const e=this.rows[t].schema&&(this.rows[t].schema.type==="object"||this.rows[t].schema.type==="array");this.tabs_holder&&(this.rows[t].tab_text=document.createElement("span"),e?this.rows[t].tab_text.textContent=this.rows[t].getHeaderText():this.rows[t].tab_text.textContent=typeof this.schema.basicCategoryTitle>"u"?"Basic":this.schema.basicCategoryTitle,this.rows[t].tab=this.theme.getTopTab(this.rows[t].tab_text,this.getValidId(this.rows[t].tab_text.textContent)),this.rows[t].tab.addEventListener("click",i=>{this.active_tab=this.rows[t].tab,this.refreshTabs(),i.preventDefault(),i.stopPropagation()}))}addRow(t,e,i){const r=this.rows.length,n=t.schema.type==="object"||t.schema.type==="array";this.rows[r]=t,this.rows[r].rowPane=i,n?(this.addTab(r),this.theme.addTopTab(e,this.rows[r].tab)):typeof this.basicTab>"u"?(this.addTab(r),this.basicTab=r,this.basicPane=i,this.theme.addTopTab(e,this.rows[r].tab)):(this.rows[r].tab=this.rows[this.basicTab].tab,this.rows[r].tab_text=this.rows[this.basicTab].tab_text,this.rows[r].rowPane=this.rows[this.basicTab].rowPane)}refreshTabs(t){const e=typeof this.basicTab<"u";let i=!1;this.rows.forEach(r=>{!r.tab||!r.rowPane||!r.rowPane.parentNode||e&&r.tab===this.rows[this.basicTab].tab&&i||(t?r.tab_text.textContent=r.getHeaderText():(e&&r.tab===this.rows[this.basicTab].tab&&(i=!0),r.tab===this.active_tab?this.theme.markTabActive(r):this.theme.markTabInactive(r)))})}build(){const t=this.format==="categories";if(this.rows=[],this.active_tab=null,this.options.table_row)this.editor_holder=this.container,Object.entries(this.editors).forEach(([e,i])=>{const r=this.theme.getTableCell();this.editor_holder.appendChild(r),i.setContainer(r),i.build(),i.postBuild(),i.setOptInCheckbox(i.header),i.setValue(i.getDefault(),!0),this.editors[e].options.hidden&&(r.style.display="none"),this.editors[e].options.input_width&&(r.style.width=this.editors[e].options.input_width)});else{if(this.options.table)throw new Error("Not supported yet");{this.header="",this.options.compact||(this.header=document.createElement("span"),this.header.textContent=this.getTitle()),this.title=this.theme.getHeader(this.header,this.getPathDepth()),this.title.classList.add("je-object__title"),this.controls=this.theme.getButtonHolder(),this.controls.classList.add("je-object__controls"),this.container.appendChild(this.title),this.container.appendChild(this.controls),this.container.classList.add("je-object__container"),this.editjson_holder=this.theme.getModal(),this.editjson_textarea_label=this.theme.getHiddenLabel(this.translate("button_edit_json")),this.editjson_textarea_label.setAttribute("for",this.path+"-edit-json-textarea"),this.editjson_textarea=this.theme.getTextareaInput(),this.editjson_textarea.setAttribute("id",this.path+"-edit-json-textarea"),this.editjson_textarea.setAttribute("aria-labelledby",this.path+"-edit-json-textarea"),this.editjson_textarea.classList.add("je-edit-json--textarea"),this.editjson_save=this.getButton("button_save","save","button_save"),this.editjson_save.classList.add("json-editor-btntype-save"),this.editjson_save.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),this.saveJSON()}),this.editjson_copy=this.getButton("button_copy","copy","button_copy"),this.editjson_copy.classList.add("json-editor-btntype-copy"),this.editjson_copy.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),this.copyJSON()}),this.editjson_cancel=this.getButton("button_cancel","cancel","button_cancel"),this.editjson_cancel.classList.add("json-editor-btntype-cancel"),this.editjson_cancel.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),this.hideEditJSON()}),this.editjson_holder.appendChild(this.editjson_textarea_label),this.editjson_holder.appendChild(this.editjson_textarea),this.editjson_holder.appendChild(this.editjson_save),this.editjson_holder.appendChild(this.editjson_copy),this.editjson_holder.appendChild(this.editjson_cancel),this.addproperty_holder=this.theme.getModal(),this.addproperty_list=document.createElement("div"),this.addproperty_list.classList.add("property-selector"),this.addproperty_add=this.getButton("button_add","add","button_add"),this.addproperty_add.classList.add("json-editor-btntype-add"),this.addproperty_input=this.theme.getFormInputField("text"),this.addproperty_input.setAttribute("placeholder","Property name..."),this.addproperty_input_label=this.theme.getHiddenLabel(this.translate("button_properties")),this.addproperty_input_label.setAttribute("for",this.path+"-property-selector"),this.addproperty_input.classList.add("property-selector-input"),this.addproperty_input.setAttribute("id",this.path+"-property-selector"),this.addproperty_input.setAttribute("aria-labelledby",this.path+"-property-selector"),this.addproperty_add.addEventListener("click",i=>{if(i.preventDefault(),i.stopPropagation(),this.addproperty_input.value){if(this.editors[this.addproperty_input.value]){window.alert("there is already a property with that name");return}this.addObjectProperty(this.addproperty_input.value),this.editors[this.addproperty_input.value]&&this.editors[this.addproperty_input.value].disable(),this.onChange(!0)}}),this.addproperty_input.addEventListener("input",i=>{i.target.previousSibling.previousSibling.childNodes.forEach(r=>{let n=r.innerText,o=i.target.value;this.options.case_sensitive_property_search||this.jsoneditor.options.case_sensitive_property_search||(n=n.toLowerCase(),o=o.toLowerCase()),n.includes(o)?r.style.display="":r.style.display="none"})}),this.addproperty_holder.appendChild(this.addproperty_list),this.addproperty_holder.appendChild(this.addproperty_input_label),this.addproperty_holder.appendChild(this.addproperty_input),this.addproperty_holder.appendChild(this.addproperty_add);const e=document.createElement("div");e.style.clear="both",this.addproperty_holder.appendChild(e),this.onOutsideModalClickListener=this.onOutsideModalClick.bind(this),document.addEventListener("click",this.onOutsideModalClickListener,!0),this.schema.description&&(this.description=this.theme.getDescription(this.translateProperty(this.schema.description)),this.container.appendChild(this.description)),this.error_holder=document.createElement("div"),this.container.appendChild(this.error_holder),this.editor_holder=this.theme.getIndentedPanel(),this.container.appendChild(this.editor_holder),this.row_container=this.theme.getGridContainer(),t?(this.tabs_holder=this.theme.getTopTabHolder(this.getValidId(this.translateProperty(this.schema.title))),this.tabPanesContainer=this.theme.getTopTabContentHolder(this.tabs_holder),this.editor_holder.appendChild(this.tabs_holder)):(this.tabs_holder=this.theme.getTabHolder(this.getValidId(this.translateProperty(this.schema.title))),this.tabPanesContainer=this.theme.getTabContentHolder(this.tabs_holder),this.editor_holder.appendChild(this.row_container)),Object.values(this.editors).forEach(i=>{const r=this.theme.getTabContent(),n=this.theme.getGridColumn(),o=!!(i.schema&&(i.schema.type==="object"||i.schema.type==="array"));if(r.isObjOrArray=o,t){if(o){const a=this.theme.getGridContainer();a.appendChild(n),r.appendChild(a),this.tabPanesContainer.appendChild(r),this.row_container=a}else typeof this.row_container_basic>"u"&&(this.row_container_basic=this.theme.getGridContainer(),r.appendChild(this.row_container_basic),this.tabPanesContainer.childElementCount===0?this.tabPanesContainer.appendChild(r):this.tabPanesContainer.insertBefore(r,this.tabPanesContainer.childNodes[1])),this.row_container_basic.appendChild(n);this.addRow(i,this.tabs_holder,r),r.id=this.getValidId(i.schema.title)}else this.row_container.appendChild(n);i.setContainer(n),i.build(),i.postBuild(),i.setOptInCheckbox(i.header)}),this.rows[0]&&Dn(this.rows[0].tab,"click"),this.collapsed=!1,this.collapse_control=this.getButton("","collapse","button_collapse"),this.collapse_control.classList.add("json-editor-btntype-toggle"),this.title.insertBefore(this.collapse_control,this.title.childNodes[0]),this.collapse_control.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),this.collapsed?(this.editor_holder.style.display="",this.collapsed=!1,this.setButtonText(this.collapse_control,"","collapse","button_collapse")):(this.editor_holder.style.display="none",this.collapsed=!0,this.setButtonText(this.collapse_control,"","expand","button_expand"))}),this.options.collapsed&&Dn(this.collapse_control,"click"),this.schema.options&&typeof this.schema.options.disable_collapse<"u"?this.schema.options.disable_collapse&&(this.collapse_control.style.display="none"):this.jsoneditor.options.disable_collapse&&(this.collapse_control.style.display="none"),this.editjson_control=this.getButton("JSON","edit","button_edit_json"),this.editjson_control.classList.add("json-editor-btntype-editjson"),this.editjson_control.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),this.toggleEditJSON()}),this.controls.appendChild(this.editjson_control),this.controls.insertBefore(this.editjson_holder,this.controls.childNodes[0]),this.schema.options&&typeof this.schema.options.disable_edit_json<"u"?this.schema.options.disable_edit_json&&(this.editjson_control.style.display="none"):this.jsoneditor.options.disable_edit_json&&(this.editjson_control.style.display="none"),this.addproperty_button=this.getButton("properties","edit_properties","button_object_properties"),this.addproperty_button.classList.add("json-editor-btntype-properties"),this.addproperty_button.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),this.toggleAddProperty()}),this.controls.appendChild(this.addproperty_button),this.controls.insertBefore(this.addproperty_holder,this.controls.childNodes[1]),this.refreshAddProperties(),this.deactivateNonRequiredProperties()}}this.options.table_row?(this.editor_holder=this.container,this.property_order.forEach(e=>{this.editor_holder.appendChild(this.editors[e].container)})):(this.layoutEditors(),this.layoutEditors()),(this.schema.readOnly||this.schema.readonly)&&this.disable()}deactivateNonRequiredProperties(){const t=this.jsoneditor.options.show_opt_in,e=typeof this.options.show_opt_in<"u",i=e&&this.options.show_opt_in===!0,r=e&&this.options.show_opt_in===!1;(i||!r&&t||!e&&t)&&Object.entries(this.editors).forEach(([n,o])=>{this.isRequiredObject(o)||this.editors[n].deactivate()})}showEditJSON(){this.editjson_holder&&(this.hideAddProperty(),this.editjson_holder.style.left=`${this.editjson_control.offsetLeft}px`,this.editjson_holder.style.top=`${this.editjson_control.offsetTop+this.editjson_control.offsetHeight}px`,this.editjson_textarea.value=JSON.stringify(this.getValue(),null,2),this.disable(),this.editjson_holder.style.display="",this.editjson_control.disabled=!1,this.editing_json=!0)}hideEditJSON(){this.editjson_holder&&this.editing_json&&(this.editjson_holder.style.display="none",this.enable(),this.editing_json=!1)}copyJSON(){this.editjson_holder&&navigator.clipboard.writeText(this.editjson_textarea.value).catch(t=>window.alert(t))}saveJSON(){if(this.editjson_holder)try{const t=JSON.parse(this.editjson_textarea.value);this.setValue(t),this.hideEditJSON(),this.onChange(!0)}catch(t){throw window.alert("invalid JSON"),t}}toggleEditJSON(){this.editing_json?this.hideEditJSON():this.showEditJSON()}insertPropertyControlUsingPropertyOrder(t,e,i){let r;this.schema.properties[t]&&(r=this.schema.properties[t].propertyOrder),typeof r!="number"&&(r=1e3),e.propertyOrder=r;for(let n=0;n<i.childNodes.length;n++){const o=i.childNodes[n];if(e.propertyOrder<o.propertyOrder){this.addproperty_list.insertBefore(e,o),e=null;break}}e&&this.addproperty_list.appendChild(e)}addPropertyCheckbox(t){let e;const i=this.theme.getCheckbox();this.schema.properties[t]&&this.schema.properties[t].title?e=this.schema.properties[t].title:e=t;const r=this.theme.getCheckboxLabel(e),n=this.theme.getFormControl(r,i,null,null,this.path+"-"+t);return n.style.paddingBottom=n.style.marginBottom=n.style.paddingTop=n.style.marginTop=0,n.style.height="auto",this.insertPropertyControlUsingPropertyOrder(t,n,this.addproperty_list),i.checked=t in this.editors,i.addEventListener("change",()=>{i.checked?this.addObjectProperty(t):this.removeObjectProperty(t),this.onChange(!0)}),this.addproperty_checkboxes[t]=i,i}showAddProperty(){this.addproperty_holder&&(this.hideEditJSON(),this.addproperty_holder.style.left=`${this.addproperty_button.offsetLeft}px`,this.addproperty_holder.style.top=`${this.addproperty_button.offsetTop+this.addproperty_button.offsetHeight}px`,this.disable(),this.adding_property=!0,this.addproperty_button.disabled=!1,this.addproperty_holder.style.display="",this.refreshAddProperties())}hideAddProperty(){this.addproperty_holder&&this.adding_property&&(this.addproperty_holder.style.display="none",this.enable(),this.adding_property=!1)}toggleAddProperty(){this.adding_property?this.hideAddProperty():this.showAddProperty()}removeObjectProperty(t){this.editors[t]&&(this.editors[t].unregister(),delete this.editors[t],this.refreshValue(),this.layoutEditors())}getSchemaOnMaxDepth(t){return Object.keys(t).reduce((e,i)=>{switch(i){case"$ref":return e;case"properties":case"items":return{...e,[i]:{}};case"additionalProperties":case"propertyNames":return{...e,[i]:!0};default:return{...e,[i]:t[i]}}},{})}addObjectProperty(t,e){if(!this.editors[t]){if(this.cached_editors[t]){if(this.editors[t]=this.cached_editors[t],e)return;this.editors[t].register()}else{if(!this.canHaveAdditionalProperties()&&(!this.schema.properties||!this.schema.properties[t])&&(!this.schema.patternProperties||!Object.keys(this.schema.patternProperties).find(o=>new RegExp(o).test(t))))return;const i=this.getPropertySchema(t);typeof i.propertyOrder!="number"&&(i.propertyOrder=Object.keys(this.editors).length+1e3);const r=this.jsoneditor.getEditorClass(i),{max_depth:n}=this.jsoneditor.options;if(this.editors[t]=this.jsoneditor.createEditor(r,{jsoneditor:this.jsoneditor,schema:n&&this.currentDepth>=n?this.getSchemaOnMaxDepth(i):i,path:`${this.path}.${t}`,parent:this},this.currentDepth+1),this.editors[t].preBuild(),!e){const o=this.theme.getChildEditorHolder();this.editor_holder.appendChild(o),this.editors[t].setContainer(o),this.editors[t].build(),this.editors[t].postBuild(),this.editors[t].setOptInCheckbox(r.header),this.editors[t].activate()}this.cached_editors[t]=this.editors[t]}e||(this.refreshValue(),this.layoutEditors())}}onOutsideModalClick(t){const e=t.path||t.composedPath&&t.composedPath();this.addproperty_holder&&!this.addproperty_holder.contains(e[0])&&this.adding_property&&(t.preventDefault(),t.stopPropagation(),this.toggleAddProperty())}onChildEditorChange(t){this.refreshValue(),super.onChildEditorChange(t)}canHaveAdditionalProperties(){return typeof this.schema.additionalProperties=="boolean"?this.schema.additionalProperties:typeof this.schema.additionalProperties=="object"&&this.schema.additionalProperties!==null?!0:typeof this.options.no_additional_properties=="boolean"?!this.options.no_additional_properties:typeof this.jsoneditor.options.no_additional_properties=="boolean"?!this.jsoneditor.options.no_additional_properties:!0}destroy(){Object.values(this.cached_editors).forEach(t=>t.destroy()),this.editor_holder&&(this.editor_holder.innerHTML=""),this.title&&this.title.parentNode&&this.title.parentNode.removeChild(this.title),this.error_holder&&this.error_holder.parentNode&&this.error_holder.parentNode.removeChild(this.error_holder),this.editors=null,this.cached_editors=null,this.editor_holder&&this.editor_holder.parentNode&&this.editor_holder.parentNode.removeChild(this.editor_holder),this.editor_holder=null,document.removeEventListener("click",this.onOutsideModalClickListener,!0),super.destroy()}getValue(){if(!this.dependenciesFulfilled)return;const t=super.getValue(),e=i=>typeof i>"u"||i===""||i===Object(i)&&Object.keys(i).length===0&&i.constructor===Object;return t&&(this.jsoneditor.options.remove_empty_properties||this.options.remove_empty_properties)&&Object.keys(t).forEach(i=>{e(t[i])&&delete t[i]}),t}refreshValue(){this.value={},this.editors&&(Object.keys(this.editors).forEach(t=>{this.editors[t].isActive()&&(this.editors[t].refreshValue(),this.value[t]=this.editors[t].getValue())}),Object.keys(this.editors).forEach(t=>{this.editors[t].isActive()&&this.activateDependentRequired(this.editors[t].key)}),this.adding_property&&this.refreshAddProperties())}activateDependentRequired(t){this.getDependentRequired(t).forEach(e=>{let i;Object.entries(this.cached_editors).forEach(([r,n])=>{n.key===e&&(i=n)}),i&&!i.isActive()&&i.activate()})}getDependentRequired(t){return this.schema.dependentRequired&&Wr(this.schema.dependentRequired,t)?this.schema.dependentRequired[t]:[]}refreshAddProperties(){if(this.options.disable_properties||this.options.disable_properties!==!1&&this.jsoneditor.options.disable_properties){this.addproperty_button.style.display="none";return}let t=!1,e=0,i=!1;Object.keys(this.editors).forEach(r=>e++),t=this.canHaveAdditionalProperties()&&!(typeof this.schema.maxProperties<"u"&&e>=this.schema.maxProperties),this.addproperty_checkboxes&&(this.addproperty_list.innerHTML=""),this.addproperty_checkboxes={},Object.keys(this.cached_editors).forEach(r=>{this.addPropertyCheckbox(r),this.isRequiredObject(this.cached_editors[r])&&r in this.editors&&(this.addproperty_checkboxes[r].disabled=!0),typeof this.schema.minProperties<"u"&&e<=this.schema.minProperties?(this.addproperty_checkboxes[r].disabled=this.addproperty_checkboxes[r].checked,this.addproperty_checkboxes[r].checked||(i=!0)):r in this.editors?i=!0:!t&&!Wr(this.schema.properties,r)?this.addproperty_checkboxes[r].disabled=!0:(this.addproperty_checkboxes[r].disabled=!1,i=!0)}),this.canHaveAdditionalProperties()&&(i=!0),Object.keys(this.schema.properties).forEach(r=>{this.cached_editors[r]||(i=!0,this.addPropertyCheckbox(r))}),i?this.canHaveAdditionalProperties()?t?this.addproperty_add.disabled=!1:this.addproperty_add.disabled=!0:(this.addproperty_add.style.display="none",this.addproperty_input.style.display="none"):(this.hideAddProperty(),this.addproperty_button.style.display="none")}isRequiredObject(t){if(t)return typeof t.schema.required=="boolean"?t.schema.required:Array.isArray(this.schema.required)?this.schema.required.includes(t.key):!!this.jsoneditor.options.required_by_default}setValue(t,e){t=t||{},(typeof t!="object"||Array.isArray(t))&&(t={}),Object.entries(this.cached_editors).forEach(([i,r])=>{typeof t[i]<"u"?(this.addObjectProperty(i),r.setValue(t[i],e),r.activate()):!e&&!this.isRequiredObject(r)?this.jsoneditor.options.show_opt_in||this.options.show_opt_in?r.deactivate():this.removeObjectProperty(i):r.setValue(r.getDefault(),e)}),Object.entries(t).forEach(([i,r])=>{this.cached_editors[i]||(this.addObjectProperty(i),this.editors[i]&&this.editors[i].setValue(r,e,!!this.editors[i].template))}),this.refreshValue(),this.layoutEditors(),this.onChange()}showValidationErrors(t){const e=[],i=[];t.forEach(r=>{r.path===this.path?e.push(r):i.push(r)}),this.error_holder&&(e.length?(this.error_holder.innerHTML="",this.error_holder.style.display="",e.forEach(r=>{r.errorcount&&r.errorcount>1&&(r.message+=` (${r.errorcount} errors)`),this.error_holder.appendChild(this.theme.getErrorMessage(r.message))})):this.error_holder.style.display="none"),this.options.table_row&&(e.length?this.theme.addTableRowError(this.container):this.theme.removeTableRowError(this.container)),Object.values(this.editors).forEach(r=>{r.showValidationErrors(i)})}}s$.rules=Wdt;class Xdt extends Rf{preBuild(){super.preBuild()}build(){this.label="",this.options.compact||(this.header=this.label=this.theme.getFormInputLabel(this.getTitle(),this.isRequired())),this.schema.description&&(this.description=this.theme.getFormInputDescription(this.translateProperty(this.schema.description))),this.options.infoText&&(this.infoButton=this.theme.getInfoButton(this.translateProperty(this.options.infoText))),this.options.compact&&this.container.classList.add("compact"),this.radioContainer=document.createElement("div"),this.radioGroup=[];const t=i=>{this.setValue(i.currentTarget.value),this.onChange(!0),this.radioGroup.forEach(r=>{r.checked=r.value===this.getValue()})};for(let i=0;i<this.enum_values.length;i++){const r={id:`${this.formname}[${i}]`,value:this.enum_values[i]};this.jsoneditor.options.use_name_attributes&&(r.name=this.formname),this.input=this.theme.getFormRadio(r),this.setInputAttributes(["id","value","name"]),this.input.addEventListener("change",t,!1),this.radioGroup.push(this.input);const n=this.theme.getFormRadioLabel(this.enum_display[i]);n.htmlFor=this.input.id;const o=this.theme.getFormRadioControl(n,this.input,!!(this.options.layout==="horizontal"||this.options.compact));this.radioContainer.appendChild(o)}if(this.schema.readOnly||this.schema.readonly){this.disable(!0);for(let i=0;i<this.radioGroup.length;i++)this.radioGroup[i].disabled=!0;this.radioContainer.classList.add("readonly")}const e=this.theme.getContainer();e.appendChild(this.radioContainer),e.dataset.containerFor="radio",this.input=e,this.control=this.theme.getFormControl(this.label,e,this.description,this.infoButton),this.container.appendChild(this.control),window.requestAnimationFrame(()=>{this.input.parentNode&&this.afterInputReady()})}enable(){if(!this.always_disabled){for(let t=0;t<this.radioGroup.length;t++)this.radioGroup[t].disabled=!1;this.radioContainer.classList.remove("readonly"),super.enable()}}disable(t){t&&(this.always_disabled=!0);for(let e=0;e<this.radioGroup.length;e++)this.radioGroup[e].disabled=!0;this.radioContainer.classList.add("readonly"),super.disable()}destroy(){this.radioContainer.parentNode&&this.radioContainer.parentNode.parentNode&&this.radioContainer.parentNode.parentNode.removeChild(this.radioContainer.parentNode),this.label&&this.label.parentNode&&this.label.parentNode.removeChild(this.label),this.description&&this.description.parentNode&&this.description.parentNode.removeChild(this.description),super.destroy()}getNumColumns(){return 2}setValue(t){typeof t!="string"&&(t=String(t));for(let e=0;e<this.radioGroup.length;e++)if(this.radioGroup[e].value===t){this.radioGroup[e].checked=!0,this.value=t,this.onChange();break}}}class qdt extends Zr{setValue(t,e,i){const r=super.setValue(t,e,i);r!==void 0&&r.changed&&this.sceditor_instance&&this.sceditor_instance.val(r.value)}build(){this.options.format="textarea",super.build(),this.input_type=this.schema.format,this.input.setAttribute("data-schemaformat",this.input_type)}afterInputReady(){if(window.sceditor){const t=this.expandCallbacks("sceditor",$t({},{format:this.input_type,emoticonsEnabled:!1,width:"100%",height:300,readOnly:this.schema.readOnly||this.schema.readonly||this.schema.template},this.defaults.options.sceditor||{},this.options.sceditor||{},{element:this.input})),e=window.sceditor.instance(this.input);e===void 0&&window.sceditor.create(this.input,t),this.sceditor_instance=e||window.sceditor.instance(this.input),this.sceditor_instance.blur(()=>{this.value=this.sceditor_instance.val(),this.sceditor_instance.updateOriginal(),this.is_dirty=!0,this.onChange(!0)}),this.theme.afterInputReady(this.input)}else super.afterInputReady()}getNumColumns(){return 6}enable(){!this.always_disabled&&this.sceditor_instance&&this.sceditor_instance.readOnly(!1),super.enable()}disable(t){this.sceditor_instance&&this.sceditor_instance.readOnly(!0),super.disable(t)}destroy(){this.sceditor_instance&&(this.sceditor_instance.destroy(),this.sceditor_instance=null),super.destroy()}}class Ydt extends Rf{setValue(t,e){if(this.select2_instance){e?this.is_dirty=!1:this.jsoneditor.options.show_errors==="change"&&(this.is_dirty=!0);const i=this.updateValue(t);this.input.value=i,this.select2v4?this.select2_instance.val(i).trigger("change"):this.select2_instance.select2("val",i),this.onChange(!0)}else super.setValue(t,e)}afterInputReady(){if(window.jQuery&&window.jQuery.fn&&window.jQuery.fn.select2&&!this.select2_instance){const t=this.expandCallbacks("select2",$t({},this.defaults.options.select2||{},this.options.select2||{}));this.newEnumAllowed=t.tags=!!t.tags&&this.schema.type==="string",this.select2_instance=window.jQuery(this.input).select2(t),this.select2v4=Wr(this.select2_instance.select2,"amd"),this.selectChangeHandler=()=>{const e=this.select2v4?this.select2_instance.val():this.select2_instance.select2("val");this.updateValue(e),this.onChange(!0)},this.select2_instance.on("change",this.selectChangeHandler),this.select2_instance.on("select2-blur",this.selectChangeHandler)}super.afterInputReady()}updateValue(t){let e=this.enum_values[0];return t=this.typecast(t||""),this.enum_values.includes(t)?e=t:this.newEnumAllowed&&(e=this.addNewOption(t)?t:e),this.value=e,e}addNewOption(t){const e=this.typecast(t);let i=!1,r;return!this.enum_values.includes(e)&&e!==""&&(this.enum_options.push(`${e}`),this.enum_display.push(`${e}`),this.enum_values.push(e),this.schema.enum.push(e),r=this.input.querySelector(`option[value="${e}"]`),r?r.removeAttribute("data-select2-tag"):this.input.appendChild(new Option(e,e,!1,!1)).trigger("change"),i=!0),i}enable(){this.always_disabled||this.select2_instance&&(this.select2v4?this.select2_instance.prop("disabled",!1):this.select2_instance.select2("enable",!0)),super.enable()}disable(t){this.select2_instance&&(this.select2v4?this.select2_instance.prop("disabled",!0):this.select2_instance.select2("enable",!1)),super.disable(t)}destroy(){this.select2_instance&&(this.select2_instance.select2("destroy"),this.select2_instance=null),super.destroy()}}class Zdt extends Rf{setValue(t,e){if(this.selectize_instance){e?this.is_dirty=!1:this.jsoneditor.options.show_errors==="change"&&(this.is_dirty=!0);const i=this.updateValue(t);this.input.value=i,this.selectize_instance.clear(!0),this.selectize_instance.setValue(i),this.onChange(!0)}else super.setValue(t,e)}afterInputReady(){if(window.jQuery&&window.jQuery.fn&&window.jQuery.fn.selectize&&!this.selectize_instance){const t=this.expandCallbacks("selectize",$t({},this.defaults.options.selectize||{},this.options.selectize||{}));this.newEnumAllowed=t.create=!!t.create&&this.schema.type==="string",this.selectize_instance=window.jQuery(this.input).selectize(t)[0].selectize,this.control.removeEventListener("change",this.multiselectChangeHandler),this.multiselectChangeHandler=e=>{this.updateValue(e),this.onChange(!0)},this.selectize_instance.on("change",this.multiselectChangeHandler)}super.afterInputReady()}updateValue(t){let e=this.enum_values[0];return t=this.typecast(t||""),this.enum_values.includes(t)?e=t:this.newEnumAllowed&&(e=this.addNewOption(t)?t:e),this.value=e,e}addNewOption(t){const e=this.typecast(t);let i=!1;return!this.enum_values.includes(e)&&e!==""&&(this.enum_options.push(`${e}`),this.enum_display.push(`${e}`),this.enum_values.push(e),this.schema.enum.push(e),this.selectize_instance.addItem(e),this.selectize_instance.refreshOptions(!1),i=!0),i}onWatchedFieldChange(){super.onWatchedFieldChange(),this.selectize_instance&&(this.selectize_instance.clear(!0),this.selectize_instance.clearOptions(!0),this.enum_options.forEach((t,e)=>{this.selectize_instance.addOption({value:t,text:this.enum_display[e]})}),this.selectize_instance.addItem(`${this.value}`,!0))}enable(){!this.always_disabled&&this.selectize_instance&&this.selectize_instance.unlock(),super.enable()}disable(t){this.selectize_instance&&this.selectize_instance.lock(),super.disable(t)}destroy(){this.selectize_instance&&(this.selectize_instance.destroy(),this.selectize_instance=null),super.destroy()}}class Kdt extends Zr{build(){this.options.compact||(this.header=this.label=this.theme.getFormInputLabel(this.getTitle(),this.isRequired())),this.schema.description&&(this.description=this.theme.getFormInputDescription(this.translateProperty(this.schema.description)));const t=this.formname.replace(/\W/g,"");if(typeof SignaturePad=="function"){this.input=this.theme.getFormInputField("hidden"),this.container.appendChild(this.input);const e=document.createElement("div");e.classList.add("signature-container");const i=document.createElement("canvas");this.jsoneditor.options.use_name_attributes&&i.setAttribute("name",t),i.classList.add("signature"),e.appendChild(i),this.signaturePad=new window.SignaturePad(i),this.signaturePad.onEnd=()=>{this.signaturePad.isEmpty()?this.input.value="":this.input.value=this.signaturePad.toDataURL(),this.is_dirty=!0,this.refreshValue(),this.watch_listener(),this.jsoneditor.notifyWatchers(this.path),this.parent?this.parent.onChildEditorChange(this):this.jsoneditor.onChange()};const r=document.createElement("div"),n=document.createElement("button");n.classList.add("tiny","button"),n.innerHTML="Clear signature",r.appendChild(n),e.appendChild(r),this.options.compact&&this.container.setAttribute("class",`${this.container.getAttribute("class")} compact`),(this.schema.readOnly||this.schema.readonly)&&(this.disable(!0),Array.from(this.inputs).forEach(o=>{i.setAttribute("readOnly","readOnly"),o.disabled=!0})),n.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),this.signaturePad.clear(),this.signaturePad.strokeEnd()}),this.control=this.theme.getFormControl(this.label,e,this.description),this.container.appendChild(this.control),this.refreshValue(),i.width=e.offsetWidth,this.options&&this.options.canvas_height?i.height=this.options.canvas_height:i.height="300"}else{const e=document.createElement("p");e.innerHTML="Signature pad is not available, please include SignaturePad from https://github.com/szimek/signature_pad",this.container.appendChild(e)}}setValue(t){if(typeof SignaturePad=="function"){const e=this.sanitize(t);return this.value===e?void 0:(this.value=e,this.input.value=this.value,this.signaturePad.clear(),t&&t!==""&&this.signaturePad.fromDataURL(t),this.watch_listener(),this.jsoneditor.notifyWatchers(this.path),!1)}}destroy(){this.signaturePad.off(),delete this.signaturePad}}class Jdt extends Zr{setValue(t,e,i){const r=super.setValue(t,e,i);r!==void 0&&r.changed&&this.simplemde_instance&&this.simplemde_instance.value(r.value)}build(){this.options.format="textarea",super.build(),this.input_type=this.schema.format,this.input.setAttribute("data-schemaformat",this.input_type)}afterInputReady(){let t;window.SimpleMDE?(t=this.expandCallbacks("simplemde",$t({},{height:300},this.defaults.options.simplemde||{},this.options.simplemde||{},{element:this.input,forceSync:!0})),this.simplemde_instance=new window.SimpleMDE(t),(this.schema.readOnly||this.schema.readonly||this.schema.template)&&(this.simplemde_instance.codemirror.options.readOnly=!0),this.simplemde_instance.codemirror.on("change",()=>{this.value=this.simplemde_instance.value(),this.is_dirty=!0,this.onChange(!0)}),t.autorefresh&&this.startListening(this.simplemde_instance.codemirror,this.simplemde_instance.codemirror.state.autoRefresh={delay:250}),this.theme.afterInputReady(this.input)):super.afterInputReady()}getNumColumns(){return 6}enable(){!this.always_disabled&&this.simplemde_instance&&(this.simplemde_instance.codemirror.options.readOnly=!1),super.enable()}disable(t){this.simplemde_instance&&(this.simplemde_instance.codemirror.options.readOnly=!0),super.disable(t)}destroy(){this.simplemde_instance&&(this.simplemde_instance.toTextArea(),this.simplemde_instance=null),super.destroy()}startListening(t,e){function i(){t.display.wrapper.offsetHeight?(this.stopListening(t,e),t.display.lastWrapHeight!==t.display.wrapper.clientHeight&&t.refresh()):e.timeout=window.setTimeout(i,e.delay)}e.timeout=window.setTimeout(i,e.delay),e.hurry=()=>{window.clearTimeout(e.timeout),e.timeout=window.setTimeout(i,50)},t.on(window,"mouseup",e.hurry),t.on(window,"keyup",e.hurry)}stopListening(t,e){window.clearTimeout(e.timeout),t.off(window,"mouseup",e.hurry),t.off(window,"keyup",e.hurry)}}const Qdt={".starrating":"direction:rtl;display:inline-block;white-space:nowrap",".starrating > input":"display:none",".starrating > label:before":"content:'%5C2606';margin:1px;font-size:18px;font-style:normal;font-weight:400;line-height:1;font-family:'Arial';display:inline-block",".starrating > label":"color:%23888;cursor:pointer;margin:8px%200%202px%200",".starrating > label.starrating-display-enabled":"margin:1px%200%200%200",".starrating > input:checked ~ label":"color:%23ffca08",".starrating:not(.readonly) > input:hover ~ label":"color:%23ffca08",".starrating > input:checked ~ label:before":"content:'%5C2605';text-shadow:0%200%201px%20rgba(0%2C20%2C20%2C1)",".starrating:not(.readonly) > input:hover ~ label:before":"content:'%5C2605';text-shadow:0%200%201px%20rgba(0%2C20%2C20%2C1)",".starrating .starrating-display":"position:relative;direction:rtl;text-align:center;font-size:10px;line-height:0px"};class r$ extends Zr{build(){if(this.options.compact||(this.header=this.label=this.theme.getLabelLike(this.getTitle(),this.isRequired())),this.schema.description&&(this.description=this.theme.getFormInputDescription(this.translateProperty(this.schema.description))),this.options.infoText&&(this.infoButton=this.theme.getInfoButton(this.translateProperty(this.options.infoText))),this.options.compact&&this.container.classList.add("compact"),this.ratingContainer=document.createElement("div"),this.ratingContainer.classList.add("starrating"),this.schema.enum===void 0){let i=this.schema.maximum?this.schema.maximum:5;this.schema.exclusiveMaximum&&i--,this.enum_values=[];for(let r=0;r<i;r++)this.enum_values.push(r+1)}else this.enum_values=this.schema.enum;this.radioGroup=[];const t=i=>{i.preventDefault(),i.stopPropagation(),this.setValue(i.currentTarget.value),this.onChange(!0)};for(let i=this.enum_values.length-1;i>-1;i--){const r=this.formname+(i+1),n=this.theme.getFormInputField("radio");n.name=`${this.formname}[starrating]`,n.value=this.enum_values[i],n.id=r,n.addEventListener("change",t,!1),this.radioGroup.push(n);const o=document.createElement("label");o.htmlFor=r,o.title=this.enum_values[i],this.options.displayValue&&o.classList.add("starrating-display-enabled");const a=this.theme.getHiddenText("label");a.textContent=i,o.appendChild(a),this.ratingContainer.appendChild(n),this.ratingContainer.appendChild(o)}if(this.options.displayValue&&(this.displayRating=document.createElement("div"),this.displayRating.classList.add("starrating-display"),this.displayRating.innerText=this.enum_values[0],this.ratingContainer.appendChild(this.displayRating)),this.schema.readOnly||this.schema.readonly){this.disable(!0);for(let i=0;i<this.radioGroup.length;i++)this.radioGroup[i].disabled=!0;this.ratingContainer.classList.add("readonly")}const e=this.theme.getContainer();e.appendChild(this.ratingContainer),this.input=e,this.control=this.theme.getFormControl(this.label,e,this.description,this.infoButton),this.container.appendChild(this.control),this.refreshValue()}enable(){if(!this.always_disabled){for(let t=0;t<this.radioGroup.length;t++)this.radioGroup[t].disabled=!1;this.ratingContainer.classList.remove("readonly"),this.disabled=!1}}disable(t){t&&(this.always_disabled=!0);for(let e=0;e<this.radioGroup.length;e++)this.radioGroup[e].disabled=!0;this.ratingContainer.classList.add("readonly"),this.disabled=!0}destroy(){this.ratingContainer.parentNode&&this.ratingContainer.parentNode.parentNode&&this.ratingContainer.parentNode.parentNode.removeChild(this.ratingContainer.parentNode),this.label&&this.label.parentNode&&this.label.parentNode.removeChild(this.label),this.description&&this.description.parentNode&&this.description.parentNode.removeChild(this.description),super.destroy()}getNumColumns(){return 2}getValue(){if(this.dependenciesFulfilled)return this.schema.type==="integer"?this.value===""?void 0:this.value*1:this.value}setValue(t){for(let e=0;e<this.radioGroup.length;e++)if(this.radioGroup[e].value===`${t}`){this.radioGroup[e].checked=!0,this.value=t,this.options.displayValue&&(this.displayRating.innerHTML=this.value),this.onChange(!0);break}}}r$.rules=Qdt;class tpt extends e${build(){super.build(),this.input.setAttribute("type","number"),this.input.getAttribute("step")||this.input.setAttribute("step","1");const t=this.theme.getStepperButtons(this.input);this.control.appendChild(t),this.stepperDown=this.control.querySelector(".stepper-down"),this.stepperUp=this.control.querySelector(".stepper-up")}enable(){super.enable(),this.stepperDown.removeAttribute("disabled"),this.stepperUp.removeAttribute("disabled")}disable(){super.disable(),this.stepperDown.setAttribute("disabled",!0),this.stepperUp.setAttribute("disabled",!0)}}class ept extends f2{register(){if(super.register(),this.rows)for(let t=0;t<this.rows.length;t++)this.rows[t].register()}unregister(){if(super.unregister(),this.rows)for(let t=0;t<this.rows.length;t++)this.rows[t].unregister()}getNumColumns(){return Math.max(Math.min(12,this.width),3)}preBuild(){const t=this.jsoneditor.expandRefs(this.schema.items||{});this.item_title=t.title||"row",this.item_default=t.default||null,this.item_has_child_editors=t.properties||t.items,this.width=12,this.array_controls_top=this.options.array_controls_top||this.jsoneditor.options.array_controls_top,super.preBuild()}build(){this.tableContainer=this.theme.getTableContainer(),this.table=this.theme.getTable(),this.tableContainer.appendChild(this.table),this.container.appendChild(this.tableContainer),this.thead=this.theme.getTableHead(),this.table.appendChild(this.thead),this.header_row=this.theme.getTableRow(),this.thead.appendChild(this.header_row),this.row_holder=this.theme.getTableBody(),this.table.appendChild(this.row_holder);const t=this.getElementEditor(0,!0);if(this.item_default=t.getDefault(),this.width=t.getNumColumns()+2,this.options.compact?(this.panel=document.createElement("div"),this.container.appendChild(this.panel)):(this.header=document.createElement("span"),this.header.textContent=this.getTitle(),this.title=this.theme.getHeader(this.header,this.getPathDepth()),this.container.appendChild(this.title),this.options.infoText&&(this.infoButton=this.theme.getInfoButton(this.translateProperty(this.options.infoText)),this.container.appendChild(this.infoButton)),this.title_controls=this.theme.getHeaderButtonHolder(),this.title.appendChild(this.title_controls),this.schema.description&&(this.description=this.theme.getDescription(this.translateProperty(this.schema.description)),this.container.appendChild(this.description)),this.panel=this.theme.getIndentedPanel(),this.container.appendChild(this.panel),this.error_holder=document.createElement("div"),this.panel.appendChild(this.error_holder)),this.panel.appendChild(this.tableContainer),this.controls=this.theme.getButtonHolder(),this.array_controls_top?this.title.appendChild(this.controls):this.panel.appendChild(this.controls),this.item_has_child_editors){const e=t.getChildEditors(),i=t.property_order||Object.keys(e);for(let r=0;r<i.length;r++){const n=this.theme.getTableHeaderCell(e[i[r]].getTitle());e[i[r]].options.hidden&&(n.style.display="none"),this.header_row.appendChild(n)}}else this.header_row.appendChild(this.theme.getTableHeaderCell(this.item_title));t.destroy(),this.row_holder.innerHTML="",this.controls_header_cell=this.theme.getTableHeaderCell(this.translate("table_controls")),this.controls_header_cell.setAttribute("aria-hidden","true"),this.controls_header_cell.style.visibility="hidden",this.header_row.appendChild(this.controls_header_cell),this.addControls()}onChildEditorChange(t){this.refreshValue(),super.onChildEditorChange()}getItemDefault(){return $t({},{default:this.item_default}).default}getItemTitle(){return this.item_title}getElementEditor(t,e){const i=$t({},this.schema.items),r=this.jsoneditor.getEditorClass(i,this.jsoneditor),n=this.row_holder.appendChild(this.theme.getTableRow());let o=n;this.item_has_child_editors||(o=this.theme.getTableCell(),n.appendChild(o));const a=this.jsoneditor.createEditor(r,{jsoneditor:this.jsoneditor,schema:i,container:o,path:`${this.path}.${t}`,parent:this,compact:!0,table_row:!0});return a.preBuild(),e||(a.build(),a.postBuild(),a.controls_cell=n.appendChild(this.theme.getTableCell()),a.row=n,a.table_controls=this.theme.getButtonHolder(),a.controls_cell.appendChild(a.table_controls),a.table_controls.style.margin=0,a.table_controls.style.padding=0),a}destroy(){this.innerHTML="",this.checkParent(this.title)&&this.title.parentNode.removeChild(this.title),this.checkParent(this.description)&&this.description.parentNode.removeChild(this.description),this.checkParent(this.row_holder)&&this.row_holder.parentNode.removeChild(this.row_holder),this.checkParent(this.table)&&this.table.parentNode.removeChild(this.table),this.checkParent(this.panel)&&this.panel.parentNode.removeChild(this.panel),this.rows=this.title=this.description=this.row_holder=this.table=this.panel=null,super.destroy()}ensureArraySize(t){if(Array.isArray(t)||(t=[t]),this.schema.minItems)for(;t.length<this.schema.minItems;)t.push(this.getItemDefault());return this.schema.maxItems&&t.length>this.schema.maxItems&&(t=t.slice(0,this.schema.maxItems)),t}setValue(t=[],e){if(t=this.ensureArraySize(t),JSON.stringify(t)===this.serialized)return;let i=!1;t.forEach((r,n)=>{this.rows[n]?this.rows[n].setValue(r):(this.addRow(r),i=!0)});for(let r=t.length;r<this.rows.length;r++){const n=this.rows[r].container;this.item_has_child_editors||this.rows[r].row.parentNode.removeChild(this.rows[r].row),this.rows[r].destroy(),n.parentNode&&n.parentNode.removeChild(n),this.rows[r]=null,i=!0}this.rows=this.rows.slice(0,t.length),this.refreshValue(),(i||e)&&this.refreshRowButtons(),this.onChange()}refreshRowButtons(){const t=this.schema.minItems&&this.schema.minItems>=this.rows.length,e=this.schema.maxItems&&this.schema.maxItems<=this.rows.length,i=[];this.rows.forEach((h,c)=>{if(h.delete_button){const u=!t;this.setButtonState(h.delete_button,u),i.push(u)}if(h.copy_button){const u=!e;this.setButtonState(h.copy_button,u),i.push(u)}if(h.moveup_button){const u=c!==0;this.setButtonState(h.moveup_button,u),i.push(u)}if(h.movedown_button){const u=c!==this.rows.length-1;this.setButtonState(h.movedown_button,u),i.push(u)}});const r=i.some(h=>h);this.rows.forEach(h=>this.setButtonState(h.controls_cell,r)),this.setButtonState(this.controls_header_cell,r),this.setButtonState(this.table,this.value.length);const n=!(e||this.hide_add_button);this.setButtonState(this.add_row_button,n);const o=!(!this.value.length||t||this.hide_delete_last_row_buttons);this.setButtonState(this.delete_last_row_button,o);const a=!(this.value.length<=1||t||this.hide_delete_all_rows_buttons);this.setButtonState(this.remove_all_rows_button,a);const l=n||o||a;this.setButtonState(this.controls,l)}refreshValue(){this.value=[],this.rows.forEach((t,e)=>{this.value[e]=t.getValue()}),this.serialized=JSON.stringify(this.value)}addRow(t){const e=this.rows.length;this.rows[e]=this.getElementEditor(e);const i=this.rows[e].table_controls;return this.hide_delete_buttons||(this.rows[e].delete_button=this._createDeleteButton(e,i)),this.show_copy_button&&(this.rows[e].copy_button=this._createCopyButton(e,i)),this.hide_move_buttons||(this.rows[e].moveup_button=this._createMoveUpButton(e,i)),this.hide_move_buttons||(this.rows[e].movedown_button=this._createMoveDownButton(e,i)),typeof t<"u"&&this.rows[e].setValue(t),this.rows[e]}_createDeleteButton(t,e){const i=this.getButton("","delete","button_delete_row_title_short");return i.classList.add("delete","json-editor-btntype-delete"),i.setAttribute("data-i",t),i.addEventListener("click",r=>{if(r.preventDefault(),r.stopPropagation(),!this.askConfirmation())return!1;const n=r.currentTarget.getAttribute("data-i")*1,o=this.getValue(),a=this.getValue()[n];o.splice(n,1),this.setValue(o),this.onChange(!0),this.jsoneditor.trigger("deleteRow",a)}),e.appendChild(i),i}_createCopyButton(t,e){const i=this.getButton("","copy","button_copy_row_title_short"),r=this.schema;return i.classList.add("copy","json-editor-btntype-copy"),i.setAttribute("data-i",t),i.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation();const o=n.currentTarget.getAttribute("data-i")*1,a=this.getValue();let l=a[o];r.items.type==="string"&&r.items.format==="uuid"?l=Rg():r.items.type==="object"&&r.items.properties&&a.forEach((h,c)=>{if(o===c)for(const u of Object.keys(h))r.items.properties&&r.items.properties[u]&&r.items.properties[u].format==="uuid"&&(l=Object.assign({},a[o]),l[u]=Rg())}),a.splice(o+1,0,l),this.setValue(a),this.onChange(!0),this.jsoneditor.trigger("copyRow",this.rows[o+1])}),e.appendChild(i),i}_createMoveUpButton(t,e){const i=this.getButton("","moveup","button_move_up_title");return i.classList.add("moveup","json-editor-btntype-move"),i.setAttribute("data-i",t),i.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation();const n=r.currentTarget.getAttribute("data-i")*1,o=this.getValue();o.splice(n-1,0,o.splice(n,1)[0]),this.setValue(o),this.onChange(!0),this.jsoneditor.trigger("moveRow",this.rows[n-1])}),e.appendChild(i),i}_createMoveDownButton(t,e){const i=this.getButton("","movedown","button_move_down_title");return i.classList.add("movedown","json-editor-btntype-move"),i.setAttribute("data-i",t),i.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation();const n=r.currentTarget.getAttribute("data-i")*1,o=this.getValue();o.splice(n+1,0,o.splice(n,1)[0]),this.setValue(o),this.onChange(!0),this.jsoneditor.trigger("moveRow",this.rows[n+1])}),e.appendChild(i),i}addControls(){this.collapsed=!1,this.toggle_button=this._createToggleButton(),this.title_controls&&(this.title.insertBefore(this.toggle_button,this.title.childNodes[0]),this.toggle_button.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),this.setButtonState(this.panel,this.collapsed),this.collapsed?(this.collapsed=!1,this.setButtonText(t.currentTarget,"","collapse","button_collapse")):(this.collapsed=!0,this.setButtonText(t.currentTarget,"","expand","button_expand"))}),this.options.collapsed&&Dn(this.toggle_button,"click"),this.schema.options&&typeof this.schema.options.disable_collapse<"u"?this.schema.options.disable_collapse&&(this.toggle_button.style.display="none"):this.jsoneditor.options.disable_collapse&&(this.toggle_button.style.display="none")),this.add_row_button=this._createAddRowButton(),this.delete_last_row_button=this._createDeleteLastRowButton(),this.remove_all_rows_button=this._createRemoveAllRowsButton()}_createToggleButton(){const t=this.getButton("","collapse","button_collapse");return t.classList.add("json-editor-btntype-toggle"),t}_createAddRowButton(){const t=this.getButton(this.getItemTitle(),"add","button_add_row_title",[this.getItemTitle()]);return t.classList.add("json-editor-btntype-add"),t.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const i=this.addRow();this.refreshValue(),this.refreshRowButtons(),this.onChange(!0),this.jsoneditor.trigger("addRow",i)}),this.controls.appendChild(t),t}_createDeleteLastRowButton(){const t=this.getButton("button_delete_last","subtract","button_delete_last_title",[this.getItemTitle()]);return t.classList.add("json-editor-btntype-deletelast"),t.addEventListener("click",e=>{if(e.preventDefault(),e.stopPropagation(),!this.askConfirmation())return!1;const i=this.getValue(),r=i.pop();this.setValue(i),this.onChange(!0),this.jsoneditor.trigger("deleteRow",r)}),this.controls.appendChild(t),t}_createRemoveAllRowsButton(){const t=this.getButton("button_delete_all","delete","button_delete_all_title");return t.classList.add("json-editor-btntype-deleteall"),t.addEventListener("click",e=>{if(e.preventDefault(),e.stopPropagation(),!this.askConfirmation())return!1;const i=this.getValue();this.setValue([]),this.onChange(!0),this.jsoneditor.trigger("deleteAllRows",i)}),this.controls.appendChild(t),t}}class ipt extends Ks{getNumColumns(){return 4}build(){if(this.options.compact||(this.header=this.label=this.theme.getFormInputLabel(this.getTitle(),this.isRequired())),this.schema.description&&(this.description=this.theme.getFormInputDescription(this.translateProperty(this.schema.description))),this.options.infoText&&(this.infoButton=this.theme.getInfoButton(this.translateProperty(this.options.infoText))),this.options.hidden&&(this.container.style.display="none"),this.options=this.expandCallbacks("upload",$t({},{title:"Browse",icon:"",auto_upload:!1,hide_input:!1,enable_drag_drop:!1,drop_zone_text:"Drag & Drop file here",drop_zone_top:!1,alt_drop_zone:"",mime_type:"",max_upload_size:0,upload_handler:(i,r,n,o)=>{window.alert(`No upload_handler defined for "${i.path}". You must create your own handler to enable upload to server`)}},this.defaults.options.upload||{},this.options.upload||{})),this.options.mime_type=this.options.mime_type?[].concat(this.options.mime_type):[],this.input=this.theme.getFormInputField("hidden"),this.container.appendChild(this.input),!this.schema.readOnly&&!this.schema.readonly){if(typeof this.options.upload_handler!="function")throw new Error("Upload handler required for upload editor");if(this.uploader=this.theme.getFormInputField("file"),this.uploader.style.display="none",this.options.mime_type.length&&this.uploader.setAttribute("accept",this.options.mime_type),this.options.enable_drag_drop===!0&&this.options.hide_input===!0||(this.clickHandler=i=>{this.uploader.dispatchEvent(new window.MouseEvent("click",{view:window,bubbles:!0,cancelable:!1}))},this.browseButton=this.getButton(this.options.title,this.options.icon,this.options.title),this.browseButton.addEventListener("click",this.clickHandler),this.fileDisplay=this.theme.getFormInputField("input"),this.fileDisplay.setAttribute("readonly",!0),this.fileDisplay.value="No file selected.",this.fileDisplay.addEventListener("dblclick",this.clickHandler),this.fileUploadGroup=this.theme.getInputGroup(this.fileDisplay,[this.browseButton]),this.fileUploadGroup||(this.fileUploadGroup=document.createElement("div"),this.fileUploadGroup.appendChild(this.fileDisplay),this.fileUploadGroup.appendChild(this.browseButton))),this.options.enable_drag_drop===!0){if(this.options.alt_drop_zone!=="")if(this.altDropZone=document.querySelector(this.options.alt_drop_zone),this.altDropZone)this.dropZone=this.altDropZone;else throw new Error(`Error: alt_drop_zone selector "${this.options.alt_drop_zone}" not found!`);else this.dropZone=this.theme.getDropZone(this.options.drop_zone_text);this.dropZone&&(this.dropZone.classList.add("upload-dropzone"),this.dropZone.addEventListener("dblclick",this.clickHandler))}this.uploadHandler=i=>{i.preventDefault(),i.stopPropagation();const r=i.target.files||i.dataTransfer.files;if(r&&r.length)if(this.options.max_upload_size!==0&&r[0].size>this.options.max_upload_size)this.theme.addInputError(this.uploader,`${this.translate("upload_max_size")} ${this.options.max_upload_size}`);else if(this.options.mime_type.length!==0&&!this.isValidMimeType(r[0].type,this.options.mime_type))this.theme.addInputError(this.uploader,`${this.translate("upload_wrong_file_format")} ${this.options.mime_type.toString()}`);else{this.fileDisplay&&(this.fileDisplay.value=r[0].name);let n=new window.FileReader;n.onload=o=>{this.preview_value=o.target.result,this.refreshPreview(r),this.onChange(!0),n=null},n.readAsDataURL(r[0])}},this.uploader.addEventListener("change",this.uploadHandler),this.dragHandler=i=>{const r=i.dataTransfer.items||i.dataTransfer.files,n=r&&r.length&&(this.options.mime_type.length===0||this.isValidMimeType(r[0].type,this.options.mime_type)),o=i.currentTarget.classList&&i.currentTarget.classList.contains("upload-dropzone")&&n;switch((i.currentTarget===window?"w_":"e_")+i.type){case"w_drop":case"w_dragover":o||(i.dataTransfer.dropEffect="none");break;case"e_dragenter":{o?(this.dropZone.classList.add("valid-dropzone"),i.dataTransfer.dropEffect="copy"):this.dropZone.classList.add("invalid-dropzone");break}case"e_dragover":{o&&(i.dataTransfer.dropEffect="copy");break}case"e_dragleave":this.dropZone.classList.remove("valid-dropzone","invalid-dropzone");break;case"e_drop":{this.dropZone.classList.remove("valid-dropzone","invalid-dropzone"),o&&this.uploadHandler(i);break}}o||i.preventDefault()},this.options.enable_drag_drop===!0&&(["dragover","drop"].forEach(i=>{window.addEventListener(i,this.dragHandler,!0)}),["dragenter","dragover","dragleave","drop"].forEach(i=>{this.dropZone.addEventListener(i,this.dragHandler,!0)}))}this.preview=document.createElement("div"),this.control=this.input.controlgroup=this.theme.getFormControl(this.label,this.uploader||this.input,this.description,this.infoButton),this.uploader&&(this.uploader.controlgroup=this.control);const t=this.uploader||this.input,e=document.createElement("div");this.dropZone&&!this.altDropZone&&this.options.drop_zone_top===!0&&e.appendChild(this.dropZone),this.fileUploadGroup&&e.appendChild(this.fileUploadGroup),this.dropZone&&!this.altDropZone&&this.options.drop_zone_top!==!0&&e.appendChild(this.dropZone),e.appendChild(this.preview),t.parentNode.insertBefore(e,t.nextSibling),this.container.appendChild(this.control),window.requestAnimationFrame(()=>{this.afterInputReady()})}afterInputReady(){if(this.value){const t=document.createElement("img");t.style.maxWidth="100%",t.style.maxHeight="100px",t.onload=e=>{this.preview.appendChild(t)},t.onerror=e=>{console.error("upload error",e,e.currentTarget)},t.src=this.container.querySelector("a").href}this.theme.afterInputReady(this.input)}refreshPreview(t){if(this.last_preview===this.preview_value||(this.last_preview=this.preview_value,this.preview.innerHTML="",!this.preview_value))return;const e=t[0],i=this.preview_value.match(/^data:([^;,]+)[;,]/);if(e.mimeType=i?i[1]:"unknown",e.size>0){const n=Math.floor(Math.log(e.size)/Math.log(1024));e.formattedSize=`${parseFloat((e.size/1024**n).toFixed(2))} ${["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][n]}`}else e.formattedSize="0 Bytes";const r=this.getButton("button_upload","upload","button_upload");r.addEventListener("click",n=>{n.preventDefault(),r.setAttribute("disabled","disabled"),this.theme.removeInputError(this.uploader),this.theme.getProgressBar&&(this.progressBar=this.theme.getProgressBar(),this.preview.appendChild(this.progressBar)),this.options.upload_handler(this.path,e,{success:o=>{this.setValue(o),this.parent?this.parent.onChildEditorChange(this):this.jsoneditor.onChange(),this.progressBar&&this.preview.removeChild(this.progressBar),r.removeAttribute("disabled")},failure:o=>{this.theme.addInputError(this.uploader,o),this.progressBar&&this.preview.removeChild(this.progressBar),r.removeAttribute("disabled")},updateProgress:o=>{this.progressBar&&(o?this.theme.updateProgressBar(this.progressBar,o):this.theme.updateProgressBarUnknown(this.progressBar))}})}),this.preview.appendChild(this.theme.getUploadPreview(e,r,this.preview_value)),this.options.auto_upload&&(r.dispatchEvent(new window.MouseEvent("click")),r.parentNode.removeChild(r))}enable(){this.always_disabled||(this.uploader&&(this.uploader.disabled=!1),super.enable())}disable(t){t&&(this.always_disabled=!0),this.uploader&&(this.uploader.disabled=!0),super.disable()}setValue(t){this.value!==t&&(this.value=t,this.input.value=this.value,this.onChange())}destroy(){this.options.enable_drag_drop===!0&&(["dragover","drop"].forEach(t=>{window.removeEventListener(t,this.dragHandler,!0)}),["dragenter","dragover","dragleave","drop"].forEach(t=>{this.dropZone.removeEventListener(t,this.dragHandler,!0)}),this.dropZone.removeEventListener("dblclick",this.clickHandler),this.dropZone&&this.dropZone.parentNode&&this.dropZone.parentNode.removeChild(this.dropZone)),this.uploader&&this.uploader.parentNode&&(this.uploader.removeEventListener("change",this.uploadHandler),this.uploader.parentNode.removeChild(this.uploader)),this.browseButton&&this.browseButton.parentNode&&(this.browseButton.removeEventListener("click",this.clickHandler),this.browseButton.parentNode.removeChild(this.browseButton)),this.fileDisplay&&this.fileDisplay.parentNode&&(this.fileDisplay.removeEventListener("dblclick",this.clickHandler),this.fileDisplay.parentNode.removeChild(this.fileDisplay)),this.fileUploadGroup&&this.fileUploadGroup.parentNode&&this.fileUploadGroup.parentNode.removeChild(this.fileUploadGroup),this.preview&&this.preview.parentNode&&this.preview.parentNode.removeChild(this.preview),this.header&&this.header.parentNode&&this.header.parentNode.removeChild(this.header),this.input&&this.input.parentNode&&this.input.parentNode.removeChild(this.input),super.destroy()}isValidMimeType(t,e){return e.reduce((i,r)=>i||new RegExp(r.replace(/\*/g,".*"),"gi").test(t),!1)}}class spt extends Zr{preBuild(){super.preBuild(),this.schema.default=this.uuid=this.getUuid(),this.schema.options||(this.schema.options={}),this.schema.options.cleave||(this.schema.options.cleave={delimiters:["-"],blocks:[8,4,4,4,12]})}build(){super.build(),this.disable(!0),this.input.setAttribute("readonly","true")}sanitize(t){return this.testUuid(t)||(t=this.uuid),t}setValue(t,e,i){this.testUuid(t)||(t=this.uuid),this.uuid=t,super.setValue(t,e,i)}getUuid(){return Rg()}testUuid(t){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}}class rpt extends Zr{postBuild(){window.Picker&&(this.input.type="text"),this.input.style.padding="3px"}setValue(t,e,i){const r=super.setValue(t,e,i);return this.picker_instance&&this.picker_instance.domElement&&r&&r.changed&&this.picker_instance.setColor(r.value,!0),r}getNumColumns(){return 2}afterInputReady(){super.afterInputReady(),this.createPicker(!0)}disable(){if(super.disable(),this.picker_instance&&this.picker_instance.domElement){this.picker_instance.domElement.style.pointerEvents="none";const t=this.picker_instance.domElement.querySelectorAll("button");for(let e=0;e<t.length;e++)t[e].disabled=!0}}enable(){if(super.enable(),this.picker_instance&&this.picker_instance.domElement){this.picker_instance.domElement.style.pointerEvents="auto";const t=this.picker_instance.domElement.querySelectorAll("button");for(let e=0;e<t.length;e++)t[e].disabled=!1}}destroy(){this.createPicker(!1),super.destroy()}createPicker(t){if(t){if(window.Picker&&!this.picker_instance){const e=this.expandCallbacks("colorpicker",$t({},{editor:!1,alpha:!1,color:this.value,popup:"bottom"},this.defaults.options.colorpicker||{},this.options.colorpicker||{},{parent:this.container})),i=r=>{const n=this.picker_instance.settings.editorFormat,o=this.picker_instance.settings.alpha;this.setValue(n==="hex"?o?r.hex:r.hex.slice(0,7):r[`${n+(o?"a":"")}String`])};!e.popup&&typeof e.onChange!="function"?e.onChange=i:e.popup&&typeof e.onDone!="function"&&(e.onDone=i),this.picker_instance=new window.Picker(e),e.popup||(this.input.style.display="none",this.theme.afterInputReady(this.picker_instance.domElement))}}else this.picker_instance&&(this.picker_instance.destroy(),this.picker_instance=null,this.input.style.display="")}}const l_={ace:Sdt,array:f2,arrayChoices:Tdt,arraySelect2:Rdt,arraySelectize:Mdt,autocomplete:Idt,base64:Adt,button:JD,checkbox:Ldt,choices:QD,datetime:Odt,describedBy:Fdt,enum:kdt,hidden:Ndt,info:Ddt,integer:e$,ip:$dt,jodit:jdt,multiple:Vdt,multiselect:Wy,null:Hdt,number:t$,object:s$,radio:Xdt,sceditor:qdt,select:Rf,select2:Ydt,selectize:Zdt,signature:Kdt,simplemde:Jdt,starrating:r$,stepper:tpt,string:Zr,table:ept,upload:ipt,uuid:spt,colorpicker:rpt},npt="html",opt="default",apt={},lpt={},hpt={},cpt={},n$={},upt=[],m2="en",dpt=m2;n$.en={error_notset:"Property must be set",error_notempty:"Value required",error_enum:"Value must be one of the enumerated values",error_const:"Value must be the constant value",error_anyOf:"Value must validate against at least one of the provided schemas",error_oneOf:"Value must validate against exactly one of the provided schemas. It currently validates against {{0}} of the schemas.",error_not:"Value must not validate against the provided schema",error_type_union:"Value must be one of the provided types",error_type:"Value must be of type {{0}}",error_disallow_union:"Value must not be one of the provided disallowed types",error_disallow:"Value must not be of type {{0}}",error_multipleOf:"Value must be a multiple of {{0}}",error_maximum_excl:"Value must be less than {{0}}",error_maximum_incl:"Value must be at most {{0}}",error_minimum_excl:"Value must be greater than {{0}}",error_minimum_incl:"Value must be at least {{0}}",error_maxLength:"Value must be at most {{0}} characters long",error_contains:"No items match contains",error_minContains:"Contains match count {{0}} is less than minimum contains count of {{1}}",error_maxContains:"Contains match count {{0}} exceeds maximum contains count of {{1}}",error_minLength:"Value must be at least {{0}} characters long",error_pattern:"Value must match the pattern {{0}}",error_additionalItems:"No additional items allowed in this array",error_maxItems:"Value must have at most {{0}} items",error_minItems:"Value must have at least {{0}} items",error_uniqueItems:"Array must have unique items",error_maxProperties:"Object must have at most {{0}} properties",error_minProperties:"Object must have at least {{0}} properties",error_required:"Object is missing the required property '{{0}}'",error_additional_properties:"No additional properties allowed, but property {{0}} is set",error_property_names_exceeds_maxlength:"Property name {{0}} exceeds maxLength",error_property_names_enum_mismatch:"Property name {{0}} does not match any enum values",error_property_names_const_mismatch:"Property name {{0}} does not match the const value",error_property_names_pattern_mismatch:"Property name {{0}} does not match pattern",error_property_names_false:"Property name {{0}} fails when propertyName is false",error_property_names_maxlength:"Property name {{0}} cannot match invalid maxLength",error_property_names_enum:"Property name {{0}} cannot match invalid enum",error_property_names_pattern:"Property name {{0}} cannot match invalid pattern",error_property_names_unsupported:"Unsupported propertyName {{0}}",error_dependency:"Must have property {{0}}",error_date:"Date must be in the format {{0}}",error_time:"Time must be in the format {{0}}",error_datetime_local:"Datetime must be in the format {{0}}",error_invalid_epoch:"Date must be greater than 1 January 1970",error_ipv4:"Value must be a valid IPv4 address in the form of 4 numbers between 0 and 255, separated by dots",error_ipv6:"Value must be a valid IPv6 address",error_hostname:"The hostname has the wrong format",upload_max_size:"Filesize too large. Max size is ",upload_wrong_file_format:"Wrong file format. Allowed format(s): ",button_save:"Save",button_copy:"Copy",button_cancel:"Cancel",button_add:"Add",button_delete_all:"All",button_delete_all_title:"Delete All",button_delete_last:"Last {{0}}",button_delete_last_title:"Delete Last {{0}}",button_add_row_title:"Add {{0}}",button_move_down_title:"Move down",button_move_up_title:"Move up",button_properties:"Properties",button_object_properties:"Object Properties",button_copy_row_title:"Copy {{0}}",button_delete_row_title:"Delete {{0}}",button_delete_row_title_short:"Delete",button_copy_row_title_short:"Copy",button_collapse:"Collapse",button_expand:"Expand",button_edit_json:"Edit JSON",button_upload:"Upload",flatpickr_toggle_button:"Toggle",flatpickr_clear_button:"Clear",choices_placeholder_text:"Start typing to add value",default_array_item_title:"item",button_delete_node_warning:"Are you sure you want to remove this item?",table_controls:"Controls"};Object.entries(l_).forEach(([s,t])=>{l_[s].options=t.options||{}});function ppt(s,t,e){console.log("Upload handler required for upload editor")}function gpt(s,t,e){let i={};e&&e.options&&e.options.error_messages&&e.options.error_messages[rh.language]&&(i=e.options.error_messages[rh.language]);const r=rh.languages[rh.language];if(!r)throw new Error(`Unknown language ${rh.language}`);let n=i[s]||r[s]||rh.languages[m2][s]||s;if(t)for(let o=0;o<t.length;o++)n=n.replace(new RegExp(`\\{\\{${o}}}`,"g"),t[o]);return n}function fpt(s,t){return s}const mpt={upload:ppt,use_name_attributes:!0,prompt_before_delete:!0,use_default_values:!0,max_depth:0,button_state_mode:1,case_sensitive_property_search:!0,show_errors:"interaction"},rh={options:mpt,theme:npt,template:opt,themes:lpt,callbacks:apt,templates:hpt,iconlibs:cpt,editors:l_,languages:n$,resolvers:ydt,custom_validators:upt,default_language:m2,language:dpt,translate:gpt,translateProperty:fpt};class _pt{constructor(t){this.options=t||{},this.schema={},this.refs=this.options.refs||{},this.refs_with_info={},this.refs_prefix="#/counter/",this.refs_counter=1,this._subSchema1={type(e){typeof e.type=="object"&&(e.type=this._expandSubSchema(e.type))},disallow(e){typeof e.disallow=="object"&&(e.disallow=this._expandSubSchema(e.disallow))},anyOf(e){Object.entries(e.anyOf).forEach(([i,r])=>{e.anyOf[i]=this.expandSchema(r)})},dependencies(e){Object.entries(e.dependencies).forEach(([i,r])=>{typeof r=="object"&&!Array.isArray(r)&&(e.dependencies[i]=this.expandSchema(r))})},not(e){e.not=this.expandSchema(e.not)}},this._subSchema2={allOf(e,i){let r=$t({},i);return Object.entries(e.allOf).forEach(([n,o])=>{e.allOf[n]=this.expandRefs(o,!0),r=this.extendSchemas(r,this.expandSchema(o))}),delete r.allOf,r},extends(e,i){let r;return Array.isArray(e.extends)?r=e.extends.reduce((n,o,a)=>this.extendSchemas(n,this.expandSchema(o)),i):r=this.extendSchemas(i,this.expandSchema(e.extends)),delete r.extends,r},oneOf(e,i){const r=$t({},i);return delete r.oneOf,e.oneOf.reduce((n,o,a)=>(n.oneOf[a]=this.extendSchemas(this.expandSchema(o),r),n),i),i}}}async load(t,e,i){return this.schema=t,await this._asyncloadExternalRefs(t,e,this._getFileBase(i),!0),this.expandRefs(t)}expandRefs(t,e){const i=$t({},t);if(!i.$ref)return i;const r=i.$ref.split("#");if(r.length===2&&!this.refs_with_info[i.$ref]){const l=this.expandRecursivePointer(this.schema,r[1]),h=this.extendSchemas(i,this.expandSchema(l));return delete h.$ref,h}const n=r.length>2?this.refs_with_info["#"+r[1]]:this.refs_with_info[i.$ref];delete i.$ref;const o=n.$ref.startsWith("#")?n.fetchUrl:"",a=this._getRef(o,n);if(!this.refs[a])console.warn(`reference:'${a}' not found!`);else if(e&&Wr(this.refs[a],"allOf")){const l=this.refs[a].allOf;Object.keys(l).forEach(h=>{l[h]=this.expandRefs(l[h],!0)})}return r.length>2?this.extendSchemas(i,this.expandSchema(this.expandRecursivePointer(this.refs[a],r[2]))):this.extendSchemas(i,this.expandSchema(this.refs[a]))}expandRecursivePointer(t,e){let i=t;return e.split("/").slice(1).forEach(r=>{i[r]&&(i=i[r])}),i.$refs&&i.$refs.startsWith("#")?this.expandRecursivePointer(t,i.$refs):i}expandSchema(t){Object.entries(this._subSchema1).forEach(([i,r])=>{t[i]&&r.call(this,t)});let e=$t({},t);return Object.entries(this._subSchema2).forEach(([i,r])=>{t[i]&&(e=r.call(this,t,e))}),this.expandRefs(e)}_getRef(t,e){const i=t+e;return this.refs[i]?i:t+decodeURIComponent(e.$ref)}_expandSubSchema(t){return Array.isArray(t)?t.map(e=>typeof e=="object"?this.expandSchema(e):e):this.expandSchema(t)}_manageRecursivePointer(t,e){Object.keys(t).forEach(i=>{t[i].$ref&&t[i].$ref.indexOf("#")===0&&(t[i].$ref=e+t[i].$ref)})}_getExternalRefs(t,e,i=!1){i||this._manageRecursivePointer(t,e);const r={},n=o=>Object.keys(o).forEach(a=>{r[a]=!0});if(t.$ref&&typeof t.$ref!="object"&&!(t.$ref.indexOf("#")===0&&i)){let o=t.$ref,a="";o.indexOf("#")>0&&(o=o.substr(0,o.indexOf("#"))),o!==t.$ref&&(a=t.$ref.substr(t.$ref.indexOf("#")));const l=this.refs_prefix+this.refs_counter++,h=l+a;t.$ref.substr(0,1)!=="#"&&!this.refs[t.$ref]&&(r[o]=!0),this.refs_with_info[l]={fetchUrl:e,$ref:o},t.$ref=h}return Object.values(t).forEach(o=>{!o||typeof o!="object"||(Array.isArray(o)?Object.values(o).forEach(a=>{a&&typeof a=="object"&&n(this._getExternalRefs(a,e,i))}):(!o.$ref||!(typeof o.$ref=="string"&&o.$ref.startsWith("#")))&&n(this._getExternalRefs(o,e,i)))}),t.id&&typeof t.id=="string"&&t.id.substr(0,4)==="urn:"?this.refs[t.id]=t:t.$id&&typeof t.$id=="string"&&t.$id.substr(0,4)==="urn:"&&(this.refs[t.$id]=t),r}_getFileBase(t){if(!t)return"/";const{ajaxBase:e}=this.options;return typeof e>"u"?this._getFileBaseFromFileLocation(t):e}_getFileBaseFromFileLocation(t){const e=t.split("/");return e.pop(),`${e.join("/")}/`}_joinUrl(t,e){var i=t;return t.substr(0,7)!=="http://"&&t.substr(0,8)!=="https://"&&t.substr(0,5)!=="blob:"&&t.substr(0,5)!=="data:"&&t.substr(0,1)!=="#"&&t.substr(0,1)!=="/"&&(i=e+t),i.indexOf("#")>0&&(i=i.substr(0,i.indexOf("#"))),i}_isUniformResourceName(t){return t.substr(0,4)==="urn:"}async _asyncloadExternalRefs(t,e,i,r=!1){const n=this._getExternalRefs(t,e,r);let o=0;for(const a of Object.keys(n)){if(typeof a>"u"||this.refs[a])continue;if(this._isUniformResourceName(a)){this.refs[a]="loading",o++;const u=this.options.urn_resolver;let d=a;if(typeof u!="function")throw console.log(`No "urn_resolver" callback defined to resolve "${d}"`),new Error(`Must set urn_resolver option to a callback to resolve ${d}`);d.indexOf("#")>0&&(d=d.substr(0,d.indexOf("#")));let p;try{let g;p=await u(d);try{g=JSON.parse(p)}catch(f){throw console.log(f),new Error(`Failed to parse external ref ${d}`)}if(!(typeof g=="boolean"||typeof g=="object")||g===null||Array.isArray(g))throw new Error(`External ref does not contain a valid schema - ${d}`);this.refs[a]=g,await this._asyncloadExternalRefs(g,a,i)}catch(g){throw console.log(g),new Error(`Failed to parse external ref ${d}`)}if(typeof p=="boolean")throw new Error(`External ref does not contain a valid schema - ${d}`);continue}if(!this.options.ajax)throw new Error(`Must set ajax option to true to load external ref ${a}`);o++;let l=this._joinUrl(a,i),h;if(this.options.ajax_cache_responses){const u=this.cacheGet(l);u&&(h=u)}if(!h){const u=await new Promise(d=>{const p=new XMLHttpRequest;this.options.ajaxCredentials&&(p.withCredentials=this.options.ajaxCredentials),p.overrideMimeType("application/json"),p.open("GET",l,!0),p.onload=()=>{d(p)},p.onerror=g=>{d(void 0)},p.send()});if(typeof u>"u")throw new Error(`Failed to fetch ref via ajax - ${a}`);try{h=JSON.parse(u.responseText),this.onSchemaLoaded({schema:h,schemaUrl:l}),this.options.ajax_cache_responses&&this.cacheSet(l,h)}catch(d){throw console.log(d),new Error(`Failed to parse external ref ${l}`)}}if(!(typeof h=="boolean"||typeof h=="object")||h===null||Array.isArray(h))throw new Error(`External ref does not contain a valid schema - ${l}`);this.refs[a]=h;const c=this._getFileBaseFromFileLocation(l);if(l!==a){const u=l.split("/");l=(a.substr(0,1)==="/"?"/":"")+u.pop()}await this._asyncloadExternalRefs(h,l,c)}if(!o)return!0;this.onAllSchemasLoaded()}onSchemaLoaded(t){}onAllSchemasLoaded(){}extendSchemas(t,e){t=$t({},t),e=$t({},e);const i={},r=(a,l)=>(a==="required"||a==="defaultProperties")&&typeof l=="object"&&Array.isArray(l),n=(a,l)=>{r(a,l)?i[a]=l.concat(e[a]).reduce((h,c)=>(h.includes(c)||h.push(c),h),[]):a==="type"&&(typeof l=="string"||Array.isArray(l))?o(l):typeof l=="object"&&!Array.isArray(l)&&l!==null?i[a]=this.extendSchemas(l,e[a]):i[a]=l},o=a=>{typeof a=="string"&&(a=[a]),typeof e.type=="string"&&(e.type=[e.type]),!e.type||!e.type.length?i.type=a:i.type=a.filter(l=>e.type.includes(l)),i.type.length===1&&typeof i.type[0]=="string"?i.type=i.type[0]:i.type.length===0&&delete i.type};return Object.entries(t).forEach(([a,l])=>{typeof e[a]<"u"?n(a,l):i[a]=l}),Object.entries(e).forEach(([a,l])=>{typeof t[a]>"u"&&(i[a]=l)}),i}getCacheKey(t){return["je-cache",t].join("::")}getCacheBuster(){return this.options.ajax_cache_buster||new Date().toISOString().slice(0,10)}cacheSet(t,e){try{window.localStorage.setItem(this.getCacheKey(t),JSON.stringify({cacheBuster:this.getCacheBuster(),schema:e}))}catch(i){console.error(i)}}cacheGet(t){try{const e=window.localStorage.getItem(this.getCacheKey(t));if(e){const i=JSON.parse(e);if(i.cacheBuster&&i.schema&&i.cacheBuster===this.getCacheBuster())return i.schema;this.cacheDelete(t)}}catch(e){console.error(e)}}cacheDelete(t){window.localStorage.removeItem(this.getCacheKey(t))}}const ypt=()=>({compile(s){const t=s.match(/{{\s*([a-zA-Z0-9\-_ .]+)\s*}}/g),e=t&&t.length;if(!e)return()=>s;const i=[],r=o=>{let a=t[o].replace(/[{}]+/g,"").trim().split(".");const l=a.length;let h;if(l>1){let c;h=u=>{for(c=u,o=0;o<l&&(c=c[a[o]],!!c);o++);return c}}else a=a[0],h=c=>c[a];i.push({s:t[o],r:h})};for(var n=0;n<e;n++)r(n);return o=>{let a=`${s}`,l;for(n=0;n<e;n++)l=i[n],a=a.replace(l.s,l.r(o));return a}}}),xpt=()=>window.EJS?{compile(s){const t=new window.EJS({text:s});return e=>t.render(e)}}:!1,vpt=()=>window.Handlebars,bpt=()=>window.Hogan?{compile(s){const t=window.Hogan.compile(s);return e=>t.render(e)}}:!1,wpt=()=>window._?{compile(s){return t=>window._.template(s)(t)}}:!1,Ept=()=>!window.Mark||!window.Mark.up?!1:{compile(s){return t=>window.Mark.up(s,t)}},Spt=()=>window.Mustache?{compile(s){return t=>window.Mustache.render(s,t)}}:!1,Cpt=()=>window.swig,Tpt=()=>window._?{compile(s){return t=>window._.template(s)(t)}}:!1,Rpt={default:ypt,ejs:xpt,handlebars:vpt,hogan:bpt,lodash:wpt,markup:Ept,mustache:Spt,swig:Cpt,underscore:Tpt},Mpt={collapse:"",expand:"",delete:"",edit:"",add:"",cancel:"",save:"",moveup:"",movedown:""};class Fa{constructor(t="",e=Mpt){this.mapping=e,this.icon_prefix=t}getIconClass(t){return this.mapping[t]?this.icon_prefix+this.mapping[t]:this.icon_prefix+t}getIcon(t){const e=this.getIconClass(t);if(!e)return null;const i=document.createElement("i");return i.classList.add(...e.split(" ")),i}}const Ipt="glyphicon glyphicon-",Apt={collapse:"chevron-down",expand:"chevron-right",delete:"trash",edit:"pencil",add:"plus",subtract:"minus",cancel:"floppy-remove",save:"floppy-saved",moveup:"arrow-up",moveright:"arrow-right",movedown:"arrow-down",moveleft:"arrow-left",copy:"copy",clear:"remove-circle",time:"time",calendar:"calendar",edit_properties:"list"};class Lpt extends Fa{constructor(){super(Ipt,Apt)}}const Ppt="icon-",Opt={collapse:"chevron-down",expand:"chevron-right",delete:"trash",edit:"pencil",add:"plus",subtract:"minus",cancel:"ban-circle",save:"save",moveup:"arrow-up",moveright:"arrow-right",movedown:"arrow-down",moveleft:"arrow-left",copy:"copy",clear:"remove-circle",time:"time",calendar:"calendar",edit_properties:"list"};class Fpt extends Fa{constructor(){super(Ppt,Opt)}}const kpt="fa fa-",Npt={collapse:"caret-square-o-down",expand:"caret-square-o-right",delete:"times",edit:"pencil",add:"plus",subtract:"minus",cancel:"ban",save:"save",moveup:"arrow-up",moveright:"arrow-right",movedown:"arrow-down",moveleft:"arrow-left",copy:"files-o",clear:"times-circle-o",time:"clock-o",calendar:"calendar",edit_properties:"list"};class Dpt extends Fa{constructor(){super(kpt,Npt)}}const $pt="fas fa-",jpt={collapse:"caret-down",expand:"caret-right",delete:"trash",edit:"pen",add:"plus",subtract:"minus",cancel:"ban",save:"save",moveup:"arrow-up",moveright:"arrow-right",movedown:"arrow-down",moveleft:"arrow-left",copy:"copy",clear:"times-circle",time:"clock",calendar:"calendar",edit_properties:"list"};class Gpt extends Fa{constructor(){super($pt,jpt)}}const zpt="ui-icon ui-icon-",Bpt={collapse:"triangle-1-s",expand:"triangle-1-e",delete:"trash",edit:"pencil",add:"plusthick",subtract:"minusthick",cancel:"closethick",save:"disk",moveup:"arrowthick-1-n",moveright:"arrowthick-1-e",movedown:"arrowthick-1-s",moveleft:"arrowthick-1-w",copy:"copy",clear:"circle-close",time:"time",calendar:"calendar",edit_properties:"note"};class Upt extends Fa{constructor(){super(zpt,Bpt)}}const Vpt="oi oi-",Hpt={collapse:"collapse-down",expand:"expand-right",delete:"trash",edit:"pencil",add:"plus",subtract:"minus",cancel:"ban",save:"file",moveup:"arrow-thick-top",moveright:"arrow-thick-right",movedown:"arrow-thick-bottom",moveleft:"arrow-thick-left",copy:"clipboard",clear:"circle-x",time:"clock",calendar:"calendar",edit_properties:"list"};class Wpt extends Fa{constructor(){super(Vpt,Hpt)}}const Xpt="icon icon-",qpt={collapse:"arrow-down",expand:"arrow-right",delete:"delete",edit:"edit",add:"plus",subtract:"minus",cancel:"cross",save:"check",moveup:"upward",moveright:"forward",movedown:"downward",moveleft:"back",copy:"copy",clear:"close",time:"time",calendar:"bookmark",edit_properties:"menu"};class Ypt extends Fa{constructor(){super(Xpt,qpt)}}const Zpt="bi bi-",Kpt={collapse:"chevron-down",expand:"chevron-right",delete:"trash",edit:"pencil",add:"plus",subtract:"dash",cancel:"x-circle",save:"save",moveup:"arrow-up",moveright:"arrow-right",movedown:"arrow-down",moveleft:"arrow-left",copy:"clipboard",clear:"x-circle",time:"clock",calendar:"calendar",edit_properties:"list-ul"};class Jpt extends Fa{constructor(){super(Zpt,Kpt)}}const Qpt={bootstrap:Jpt,bootstrap3:Lpt,fontawesome3:Fpt,fontawesome4:Dpt,fontawesome5:Gpt,jqueryui:Upt,openiconic:Wpt,spectre:Ypt},YM=["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].find(s=>s in document.documentElement);class ka{constructor(t,e={disable_theme_rules:!1}){this.jsoneditor=t,Object.keys(e).forEach(i=>{typeof t.options[i]<"u"&&(e[i]=t.options[i])}),this.options=e}getContainer(){return document.createElement("div")}getFloatRightLinkHolder(){const t=document.createElement("div");return t.classList.add("je-float-right-linkholder"),t}getModal(){const t=document.createElement("div");return t.style.display="none",t.classList.add("je-modal"),t}getGridContainer(){return document.createElement("div")}getGridRow(){const t=document.createElement("div");return t.classList.add("row"),t}getGridColumn(){return document.createElement("div")}setGridColumnSize(t,e){}getLink(t){const e=document.createElement("a");return e.setAttribute("href","#"),e.appendChild(document.createTextNode(t)),e}disableHeader(t){t.style.color="#ccc"}disableLabel(t){t.style.color="#ccc"}enableHeader(t){t.style.color=""}enableLabel(t){t.style.color=""}getInfoButton(t){const e=document.createElement("span");e.innerText="ⓘ",e.classList.add("je-infobutton-icon");const i=document.createElement("span");return i.classList.add("je-infobutton-tooltip"),i.innerText=t,e.onmouseover=()=>{i.style.visibility="visible"},e.onmouseleave=()=>{i.style.visibility="hidden"},e.appendChild(i),e}getFormInputLabel(t,e){const i=document.createElement("label");return i.appendChild(document.createTextNode(t)),e&&i.classList.add("required"),i}getLabelLike(t,e){const i=document.createElement("b");return i.appendChild(document.createTextNode(t)),e&&i.classList.add("required"),i}getHeader(t,e){const i=document.createElement("span");return typeof t=="string"?i.textContent=t:i.appendChild(t),i.classList.add("je-header"),i}getCheckbox(){const t=this.getFormInputField("checkbox");return t.classList.add("je-checkbox"),t}getCheckboxLabel(t,e){const i=document.createElement("label");return i.appendChild(document.createTextNode(` ${t}`)),e&&i.classList.add("required"),i}getMultiCheckboxHolder(t,e,i,r){const n=document.createElement("div");return n.classList.add("control-group"),e&&(e.style.display="block",n.appendChild(e),r&&e.appendChild(r)),Object.values(t).forEach(o=>{o.style.display="inline-block",o.style.marginRight="20px",n.appendChild(o)}),i&&n.appendChild(i),n}getFormCheckboxControl(t,e,i){const r=document.createElement("div");return r.appendChild(t),e.style.width="auto",t.insertBefore(e,t.firstChild),i&&r.classList.add("je-checkbox-control--compact"),r}getFormRadio(t){const e=this.getFormInputField("radio");return Object.keys(t).forEach(i=>e.setAttribute(i,t[i])),e.classList.add("je-radio"),e}getFormRadioLabel(t,e){const i=document.createElement("label");return i.appendChild(document.createTextNode(` ${t}`)),e&&i.classList.add("required"),i}getFormRadioControl(t,e,i,r){const n=document.createElement("div");return n.appendChild(t),e.style.width="auto",t.insertBefore(e,t.firstChild),i&&n.classList.add("je-radio-control--compact"),e.tagName.toLowerCase()!=="div"&&r&&t&&e&&(e.setAttribute("id",r),e.setAttribute("aria-labelledby",r),t.setAttribute("for",r)),n}getSelectInput(t,e){const i=document.createElement("select");return t&&this.setSelectOptions(i,t),i}getSwitcher(t){const e=this.getSelectInput(t,!1);return e.classList.add("je-switcher"),e}getSwitcherOptions(t){return t.getElementsByTagName("option")}setSwitcherOptions(t,e,i){this.setSelectOptions(t,e,i)}setSelectOptions(t,e,i=[]){t.innerHTML="";for(let r=0;r<e.length;r++){const n=document.createElement("option");n.setAttribute("value",e[r]),n.textContent=i[r]||e[r],t.appendChild(n)}}getTextareaInput(){const t=document.createElement("textarea");return t.classList.add("je-textarea"),t}getHiddenLabel(t){const e=document.createElement("label");return e.textContent=t,e.setAttribute("style","position: absolute;width: 1px;height: 1px;padding: 0;margin: -1px;overflow: hidden;clip: rect(0,0,0,0);border: 0;"),e}visuallyHidden(t){t&&t.setAttribute("style","position: absolute;width: 1px;height: 1px;padding: 0;margin: -1px;overflow: hidden;clip: rect(0,0,0,0);border: 0;")}getHiddenText(t){const e=document.createElement("span");return e.textContent=t,e.setAttribute("style","position: absolute;width: 1px;height: 1px;padding: 0;margin: -1px;overflow: hidden;clip: rect(0,0,0,0);border: 0;"),e}getRangeInput(t,e,i,r,n){const o=this.getFormInputField("range");return o.setAttribute("min",t),o.setAttribute("max",e),o.setAttribute("step",i),r&&(r.setAttribute("id",n+"-description"),o.setAttribute("aria-describedby",n+"-description")),o}getStepperButtons(t){const e=document.createElement("div"),i=document.createElement("button");i.setAttribute("type","button"),i.classList.add("stepper-down");const r=document.createElement("button");r.setAttribute("type","button"),r.classList.add("stepper-up"),t.getAttribute("readonly")&&(i.setAttribute("disabled",!0),r.setAttribute("disabled",!0)),i.textContent="-",r.textContent="+";const n=(l,h)=>{h?l.value=Number(h):l.value=Number(l.value),l.setAttribute("initialized","1")},o=t.getAttribute("min"),a=t.getAttribute("max");return i.addEventListener("click",()=>{t.getAttribute("initialized")?o?Number(t.value)>Number(o)&&t.stepDown():t.stepDown():n(t,o),Dn(t,"change")}),r.addEventListener("click",()=>{t.getAttribute("initialized")?a?Number(t.value)<Number(a)&&t.stepUp():t.stepUp():n(t,o),Dn(t,"change")}),e.appendChild(i),e.appendChild(r),e}getRangeOutput(t){const e=document.createElement("output"),i=r=>{e.value=r.currentTarget.value};return t.addEventListener("change",i,!1),t.addEventListener("input",i,!1),e}getRangeControl(t,e){const i=document.createElement("div");return i.classList.add("je-range-control"),e&&i.appendChild(e),i.appendChild(t),i}getFormInputField(t){const e=document.createElement("input");return e.setAttribute("type",t),e}afterInputReady(t){}getFormControl(t,e,i,r,n){const o=document.createElement("div");return o.classList.add("form-control"),t&&(o.appendChild(t),n&&t.setAttribute("for",n)),(e.type==="checkbox"||e.type==="radio")&&t?(e.style.width="auto",t.insertBefore(e,t.firstChild),r&&t.appendChild(r)):(r&&t&&t.appendChild(r),o.appendChild(e)),e.tagName.toLowerCase()!=="div"&&e&&t&&n&&(t.setAttribute("for",n),e.setAttribute("id",n)),e.tagName.toLowerCase()!=="div"&&e&&i&&(i.setAttribute("id",n+"-description"),e.setAttribute("aria-describedby",n+"-description")),i&&o.appendChild(i),o}getIndentedPanel(){const t=document.createElement("div");return t.classList.add("je-indented-panel"),t}getTopIndentedPanel(){const t=document.createElement("div");return t.classList.add("je-indented-panel--top"),t}getChildEditorHolder(){return document.createElement("div")}getDescription(t){const e=document.createElement("p");return window.DOMPurify?e.innerHTML=window.DOMPurify.sanitize(t):e.textContent=this.cleanText(t),e}getCheckboxDescription(t){return this.getDescription(t)}getFormInputDescription(t){return this.getDescription(t)}getButtonHolder(){return document.createElement("span")}getHeaderButtonHolder(){return this.getButtonHolder()}getFormButtonHolder(t){return this.getButtonHolder()}getButton(t,e,i){const r=document.createElement("button");return r.type="button",this.setButtonText(r,t,e,i),r}getFormButton(t,e,i){return this.getButton(t,e,i)}setButtonText(t,e,i,r){for(;t.firstChild;)t.removeChild(t.firstChild);if(i&&(t.appendChild(i),e=` ${e}`),!this.jsoneditor.options.iconlib||!this.jsoneditor.options.remove_button_labels||!i){const n=document.createElement("span");n.appendChild(document.createTextNode(e)),t.appendChild(n)}r&&t.setAttribute("title",r)}getTableContainer(){return document.createElement("div")}getTable(){return document.createElement("table")}getTableRow(){return document.createElement("tr")}getTableHead(){return document.createElement("thead")}getTableBody(){return document.createElement("tbody")}getTableHeaderCell(t){const e=document.createElement("th");return e.textContent=t,e}getTableCell(){return document.createElement("td")}getErrorMessage(t){const e=document.createElement("p");return e.style=e.style||{},e.style.color="red",e.appendChild(document.createTextNode(t)),e}addInputError(t,e){t.errmsg.setAttribute("role","alert")}removeInputError(t){}addTableRowError(t){}removeTableRowError(t){}getTabHolder(t){const e=typeof t>"u"?"":t,i=document.createElement("div");return i.innerHTML=`<div class='je-tabholder tabs'></div><div class='content' id='${e}'></div><div class='je-tabholder--clear'></div>`,i}getTopTabHolder(t){const e=typeof t>"u"?"":t,i=document.createElement("div");return i.innerHTML=`<div class='tabs je-tabholder--top'></div><div class='je-tabholder--clear'></div><div class='content' id='${e}'></div>`,i}applyStyles(t,e){Object.keys(e).forEach(i=>t.style[i]=e[i])}closest(t,e){for(;t&&t!==document;)if(t[YM]){if(t[YM](e))return t;t=t.parentNode}else return!1;return!1}insertBasicTopTab(t,e){e.firstChild.insertBefore(t,e.firstChild.firstChild)}getTab(t,e){const i=document.createElement("div");return i.appendChild(t),i.id=e,i.classList.add("je-tab"),i}getTopTab(t,e){const i=document.createElement("div");return i.appendChild(t),i.id=e,i.classList.add("je-tab--top"),i}getTabContentHolder(t){return t.children[1]}getTopTabContentHolder(t){return t.children[1]}getTabContent(){return this.getIndentedPanel()}getTopTabContent(){return this.getTopIndentedPanel()}markTabActive(t){this.applyStyles(t.tab,{opacity:1,background:"white"}),typeof t.rowPane<"u"?t.rowPane.style.display="":t.container.style.display=""}markTabInactive(t){this.applyStyles(t.tab,{opacity:.5,background:""}),typeof t.rowPane<"u"?t.rowPane.style.display="none":t.container.style.display="none"}addTab(t,e){t.children[0].appendChild(e)}addTopTab(t,e){t.children[0].appendChild(e)}getBlockLink(){const t=document.createElement("a");return t.classList.add("je-block-link"),t}getBlockLinkHolder(){return document.createElement("div")}getLinksHolder(){return document.createElement("div")}createMediaLink(t,e,i){t.appendChild(e),i.classList.add("je-media"),t.appendChild(i)}createImageLink(t,e,i){t.appendChild(e),e.appendChild(i)}getFirstTab(t){return t.firstChild.firstChild}getInputGroup(t,e){}cleanText(t){const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText}getDropZone(t){const e=document.createElement("div");return e.setAttribute("data-text",t),e.classList.add("je-dropzone"),e}getUploadPreview(t,e,i){const r=document.createElement("div");if(r.classList.add("je-upload-preview"),t.mimeType.substr(0,5)==="image"){const a=document.createElement("img");a.src=i,r.appendChild(a)}const n=document.createElement("div");n.innerHTML+=`<strong>Name:</strong> ${t.name}<br><strong>Type:</strong> ${t.type}<br><strong>Size:</strong> ${t.formattedSize}`,r.appendChild(n),r.appendChild(e);const o=document.createElement("div");return o.style.clear="left",r.appendChild(o),r}getProgressBar(){const t=document.createElement("progress");return t.setAttribute("max",100),t.setAttribute("value",0),t}updateProgressBar(t,e){t&&t.setAttribute("value",e)}updateProgressBarUnknown(t){t&&t.removeAttribute("value")}}const tgt={".je-form-input-label":"display:block;margin-bottom:3px;font-weight:bold",".je-form-input-description":"display:inline-block;margin:0;font-size:0.8em;font-style:italic",".je-indented-panel":"padding:5px;margin:10px;border-radius:3px;border:1px%20solid%20%23ddd",".je-child-editor-holder":"margin-bottom:8px",".je-header-button-holder":"display:inline-block;margin-left:10px;font-size:0.8em;vertical-align:middle",".je-table":"margin-bottom:5px;border-bottom:1px%20solid%20%23ccc",".je-upload-preview img":"float:left;margin:0%200.5rem%200.5rem%200;max-width:100%25;max-height:5rem",".je-dropzone":"position:relative;margin:0.5rem%200;border:2px%20dashed%20black;width:100%25;height:60px;background:teal;transition:all%200.5s",".je-dropzone:before":"position:absolute;content:attr(data-text);color:rgba(0%2C%200%2C%200%2C%200.6);left:50%25;top:50%25;transform:translate(-50%25%2C%20-50%25)",".je-dropzone.valid-dropzone":"background:green",".je-dropzone.invalid-dropzone":"background:red"};class o$ extends ka{getFormInputLabel(t,e){const i=super.getFormInputLabel(t,e);return i.classList.add("je-form-input-label"),i}getFormInputDescription(t){const e=super.getFormInputDescription(t);return e.classList.add("je-form-input-label"),e}getIndentedPanel(){const t=super.getIndentedPanel();return t.classList.add("je-indented-panel"),t}getTopIndentedPanel(){return this.getIndentedPanel()}getChildEditorHolder(){const t=super.getChildEditorHolder();return t.classList.add("je-child-editor-holder"),t}getHeaderButtonHolder(){const t=this.getButtonHolder();return t.classList.add("je-header-button-holder"),t}getTable(){const t=super.getTable();return t.classList.add("je-table"),t}addInputError(t,e){const i=this.closest(t,".form-control")||t.controlgroup;t.errmsg?t.errmsg.style.display="block":(t.errmsg=document.createElement("div"),t.errmsg.setAttribute("class","errmsg"),t.errmsg.style=t.errmsg.style||{},t.errmsg.style.color="red",i.appendChild(t.errmsg)),t.errmsg.innerHTML="",t.errmsg.appendChild(document.createTextNode(e)),t.errmsg.setAttribute("role","alert")}removeInputError(t){t.style&&(t.style.borderColor=""),t.errmsg&&(t.errmsg.style.display="none")}}o$.rules=tgt;const egt={};class a$ extends ka{getSelectInput(t,e){const i=super.getSelectInput(t);return i.classList.add("form-control"),i}setGridColumnSize(t,e,i){t.classList.add(`col-md-${e}`),i&&t.classList.add(`col-md-offset-${i}`)}afterInputReady(t){t.controlgroup||(t.controlgroup=this.closest(t,".form-group"),this.closest(t,".compact")&&(t.controlgroup.style.marginBottom=0))}getTextareaInput(){const t=document.createElement("textarea");return t.classList.add("form-control"),t}getRangeInput(t,e,i,r,n){return super.getRangeInput(t,e,i,r,n)}getFormInputField(t){const e=super.getFormInputField(t);return t!=="checkbox"&&t!=="radio"&&e.classList.add("form-control"),e}getHiddenLabel(t){const e=document.createElement("label");return e.textContent=t,e.classList.add("sr-only"),e}visuallyHidden(t){t&&t.classList.add("sr-only")}getHiddenText(t){const e=document.createElement("span");return e.textContent=t,e.classList.add("sr-only"),e}getFormControl(t,e,i,r,n){const o=document.createElement("div");return t&&(e.type==="checkbox"||e.type==="radio")?(o.classList.add(e.type),r&&t.appendChild(r),t.insertBefore(e,t.firstChild),o.appendChild(t)):(o.classList.add("form-group"),t&&(t.classList.add("control-label"),o.appendChild(t),r&&t.appendChild(r)),o.appendChild(e)),i&&o.appendChild(i),e.tagName.toLowerCase()!=="div"&&e&&t&&n&&(t.setAttribute("for",n),e.setAttribute("id",n)),e.tagName.toLowerCase()!=="div"&&e&&i&&(i.setAttribute("id",n+"-description"),e.setAttribute("aria-describedby",n+"-description")),o}getIndentedPanel(){const t=document.createElement("div");return t.classList.add("well","well-sm"),t.style.paddingBottom=0,t}getInfoButton(t){const e=document.createElement("span");e.classList.add("glyphicon","glyphicon-info-sign","pull-right"),e.style.padding=".25rem",e.style.position="relative",e.style.display="inline-block";const i=document.createElement("span");return i.style["font-family"]="sans-serif",i.style.visibility="hidden",i.style["background-color"]="rgba(50, 50, 50, .75)",i.style.margin="0 .25rem",i.style.color="#FAFAFA",i.style.padding=".5rem 1rem",i.style["border-radius"]=".25rem",i.style.width="25rem",i.style.position="absolute",i.innerText=t,e.onmouseover=()=>{i.style.visibility="visible"},e.onmouseleave=()=>{i.style.visibility="hidden"},e.appendChild(i),e}getFormInputDescription(t){const e=document.createElement("p");return e.classList.add("help-block"),window.DOMPurify?e.innerHTML=window.DOMPurify.sanitize(t):e.textContent=this.cleanText(t),e}getHeader(t,e){const i=document.createElement("span");return i.classList.add("h3"),typeof t=="string"?i.textContent=t:i.appendChild(t),i}getHeaderButtonHolder(){const t=this.getButtonHolder();return t.style.marginLeft="10px",t}getButtonHolder(){const t=document.createElement("span");return t.classList.add("btn-group"),t}getButton(t,e,i){const r=super.getButton(t,e,i);return r.classList.add("btn","btn-default"),r}getTableContainer(){const t=super.getTableContainer();return t.classList.add("table-responsive"),t}getTable(){const t=document.createElement("table");return t.classList.add("table","table-bordered"),t.style.width="auto",t.style.maxWidth="none",t}addInputError(t,e){t.controlgroup&&(t.controlgroup.classList.add("has-error"),t.errmsg?t.errmsg.style.display="":(t.errmsg=document.createElement("p"),t.errmsg.classList.add("help-block","errormsg"),t.controlgroup.appendChild(t.errmsg)),t.errmsg.textContent=e,t.errmsg.setAttribute("role","alert"))}removeInputError(t){t.errmsg&&(t.errmsg.style.display="none",t.controlgroup.classList.remove("has-error"))}getTabHolder(t){const e=typeof t>"u"?"":t,i=document.createElement("div");return i.innerHTML=`<ul class='col-md-2 nav nav-pills nav-stacked' id='${e}' role='tablist'></ul><div class='col-md-10 tab-content active well well-small'  id='${e}'></div>`,i}getTopTabHolder(t){const e=typeof t>"u"?"":t,i=document.createElement("div");return i.innerHTML=`<ul class='nav nav-tabs' id='${e}' role='tablist'></ul><div class='tab-content active well well-small'  id='${e}'></div>`,i}getTab(t,e){const i=document.createElement("li");i.setAttribute("role","presentation");const r=document.createElement("a");return r.setAttribute("href",`#${e}`),r.appendChild(t),r.setAttribute("aria-controls",e),r.setAttribute("role","tab"),r.setAttribute("data-toggle","tab"),i.appendChild(r),i}getTopTab(t,e){const i=document.createElement("li");i.setAttribute("role","presentation");const r=document.createElement("a");return r.setAttribute("href",`#${e}`),r.appendChild(t),r.setAttribute("aria-controls",e),r.setAttribute("role","tab"),r.setAttribute("data-toggle","tab"),i.appendChild(r),i}getTabContent(){const t=document.createElement("div");return t.classList.add("tab-pane"),t.setAttribute("role","tabpanel"),t}getTopTabContent(){const t=document.createElement("div");return t.classList.add("tab-pane"),t.setAttribute("role","tabpanel"),t}markTabActive(t){t.tab.classList.add("active"),typeof t.rowPane<"u"?t.rowPane.classList.add("active"):t.container.classList.add("active")}markTabInactive(t){t.tab.classList.remove("active"),typeof t.rowPane<"u"?t.rowPane.classList.remove("active"):t.container.classList.remove("active")}getProgressBar(){const t=document.createElement("div");t.classList.add("progress");const e=document.createElement("div");return e.classList.add("progress-bar"),e.setAttribute("role","progressbar"),e.setAttribute("aria-valuenow",0),e.setAttribute("aria-valuemin",0),e.setAttribute("aria-valuenax",100),e.innerHTML="0%",t.appendChild(e),t}updateProgressBar(t,e){if(!t)return;const i=t.firstChild,r=`${e}%`;i.setAttribute("aria-valuenow",e),i.style.width=r,i.innerHTML=r}updateProgressBarUnknown(t){if(!t)return;const e=t.firstChild;t.classList.add("progress","progress-striped","active"),e.removeAttribute("aria-valuenow"),e.style.width="100%",e.innerHTML=""}getInputGroup(t,e){if(!t)return;const i=document.createElement("div");i.classList.add("input-group"),i.appendChild(t);const r=document.createElement("div");r.classList.add("input-group-btn"),i.appendChild(r);for(let n=0;n<e.length;n++)r.appendChild(e[n]);return i}}a$.rules=egt;const igt={".jsoneditor-twbs4-text-button":"background:none;padding:0;border:0;color:currentColor","td > .form-group":"margin-bottom:0",".json-editor-btn-upload":"margin-top:1rem",".je-noindent .card":"padding:0;border:0",".je-tooltip:hover::before":"display:block;position:absolute;font-size:0.8em;color:%23fff;border-radius:0.2em;content:attr(title);background-color:%23000;margin-top:-2.5em;padding:0.3em",".je-tooltip:hover::after":"display:block;position:absolute;font-size:0.8em;color:%23fff",".select2-container--default .select2-selection--single":"height:calc(1.5em%20%2B%200.75rem%20%2B%202px)",".select2-container--default   .select2-selection--single   .select2-selection__arrow":"height:calc(1.5em%20%2B%200.75rem%20%2B%202px)",".select2-container--default   .select2-selection--single   .select2-selection__rendered":"line-height:calc(1.5em%20%2B%200.75rem%20%2B%202px)",".selectize-control.form-control":"padding:0",".selectize-dropdown.form-control":"padding:0;height:auto",".je-upload-preview img":"float:left;margin:0%200.5rem%200.5rem%200;max-width:100%25;max-height:5rem",".je-dropzone":"position:relative;margin:0.5rem%200;border:2px%20dashed%20black;width:100%25;height:60px;background:teal;transition:all%200.5s",".je-dropzone:before":"position:absolute;content:attr(data-text);color:rgba(0%2C%200%2C%200%2C%200.6);left:50%25;top:50%25;transform:translate(-50%25%2C%20-50%25)",".je-dropzone.valid-dropzone":"background:green",".je-dropzone.invalid-dropzone":"background:red"},sgt={disable_theme_rules:!1,input_size:"normal",custom_forms:!1,object_indent:!0,object_background:"bg-light",object_text:"",table_border:!1,table_zebrastyle:!1,tooltip:"bootstrap"};class l$ extends ka{constructor(t){super(t,sgt)}getSelectInput(t,e){const i=super.getSelectInput(t);return i.classList.add("form-control"),this.options.custom_forms===!1?(this.options.input_size==="small"&&i.classList.add("form-control-sm"),this.options.input_size==="large"&&i.classList.add("form-control-lg")):(i.classList.remove("form-control"),i.classList.add("custom-select"),this.options.input_size==="small"&&i.classList.add("custom-select-sm"),this.options.input_size==="large"&&i.classList.add("custom-select-lg")),i}getContainer(){const t=document.createElement("div");return this.options.object_indent||t.classList.add("je-noindent"),t}setGridColumnSize(t,e,i){t.classList.add(`col-md-${e}`),i&&t.classList.add(`offset-md-${i}`)}afterInputReady(t){if(t.controlgroup)return;const e=t.name;t.id=e;const i=t.parentNode.parentNode.getElementsByTagName("label")[0];i&&(i.htmlFor=e),t.controlgroup=this.closest(t,".form-group")}getTextareaInput(){const t=document.createElement("textarea");return t.classList.add("form-control"),this.options.input_size==="small"&&t.classList.add("form-control-sm"),this.options.input_size==="large"&&t.classList.add("form-control-lg"),t}getRangeInput(t,e,i,r,n){const o=super.getRangeInput(t,e,i,r,n);return this.options.custom_forms===!0&&(o.classList.remove("form-control"),o.classList.add("custom-range")),o}getStepperButtons(t){const e=document.createElement("div"),i=document.createElement("div"),r=document.createElement("div"),n=document.createElement("button");n.setAttribute("type","button");const o=document.createElement("button");o.setAttribute("type","button"),e.appendChild(i),e.appendChild(t),e.appendChild(r),i.appendChild(n),r.appendChild(o),e.classList.add("input-group"),i.classList.add("input-group-prepend"),r.classList.add("input-group-append"),n.classList.add("btn"),n.classList.add("btn-secondary"),n.classList.add("stepper-down"),o.classList.add("btn"),o.classList.add("btn-secondary"),o.classList.add("stepper-up"),t.getAttribute("readonly")&&(n.setAttribute("disabled",!0),o.setAttribute("disabled",!0)),n.textContent="-",o.textContent="+";const a=(c,u)=>{u?c.value=Number(u):c.value=Number(c.value),c.setAttribute("initialized","1")},l=t.getAttribute("min"),h=t.getAttribute("max");return t.addEventListener("change",()=>{t.getAttribute("initialized")||t.setAttribute("initialized","1")}),n.addEventListener("click",()=>{t.getAttribute("initialized")?l?Number(t.value)>Number(l)&&t.stepDown():t.stepDown():a(t,l),Dn(t,"change")}),o.addEventListener("click",()=>{t.getAttribute("initialized")?h?Number(t.value)<Number(h)&&t.stepUp():t.stepUp():a(t,l),Dn(t,"change")}),e}getFormInputField(t){const e=super.getFormInputField(t);return t!=="checkbox"&&t!=="radio"&&t!=="file"&&(e.classList.add("form-control"),this.options.input_size==="small"&&e.classList.add("form-control-sm"),this.options.input_size==="large"&&e.classList.add("form-control-lg")),t==="file"&&e.classList.add("form-control-file"),e}getHiddenLabel(t){const e=document.createElement("label");return e.textContent=t,e.classList.add("sr-only"),e}visuallyHidden(t){t&&t.classList.add("sr-only")}getHiddenText(t){const e=document.createElement("span");return e.textContent=t,e.classList.add("sr-only"),e}getFormControl(t,e,i,r,n){const o=document.createElement("div");if(o.classList.add("form-group"),t&&(e.type==="checkbox"||e.type==="radio")){const a=document.createElement("div");this.options.custom_forms===!1?(a.classList.add("form-check"),e.classList.add("form-check-input"),t.classList.add("form-check-label")):(a.classList.add("custom-control"),e.classList.add("custom-control-input"),t.classList.add("custom-control-label"),e.type==="checkbox"?a.classList.add("custom-checkbox"):a.classList.add("custom-radio")),a.appendChild(e),a.appendChild(t),r&&a.appendChild(r),o.appendChild(a)}else t&&(o.appendChild(t),r&&o.appendChild(r)),o.appendChild(e);return i&&o.appendChild(i),e.tagName.toLowerCase()!=="div"&&e&&t&&n&&(t.setAttribute("for",n),e.setAttribute("id",n)),e.tagName.toLowerCase()!=="div"&&e&&i&&(i.setAttribute("id",n+"-description"),e.setAttribute("aria-describedby",n+"-description")),o}getInfoButton(t){const e=document.createElement("button");e.type="button",e.classList.add("ml-3","jsoneditor-twbs4-text-button"),e.setAttribute("data-toggle","tooltip"),e.setAttribute("data-placement","auto"),e.title=t;const i=document.createTextNode("ⓘ");return e.appendChild(i),this.options.tooltip==="bootstrap"?window.jQuery&&window.jQuery().tooltip?window.jQuery(e).tooltip():console.warn("Could not find popper jQuery plugin of Bootstrap."):this.options.tooltip==="css"&&e.classList.add("je-tooltip"),e}getCheckbox(){return this.getFormInputField("checkbox")}getMultiCheckboxHolder(t,e,i,r){const n=document.createElement("div");n.classList.add("form-group"),e&&(n.appendChild(e),r&&e.appendChild(r));const o=document.createElement("div");return Object.values(t).forEach(a=>{const l=a.firstChild;o.appendChild(l)}),n.appendChild(o),i&&n.appendChild(i),n}getFormRadio(t){const e=this.getFormInputField("radio");for(const i in t)e.setAttribute(i,t[i]);return this.options.custom_forms===!1?e.classList.add("form-check-input"):e.classList.add("custom-control-input"),e}getFormRadioLabel(t,e){const i=document.createElement("label");return this.options.custom_forms===!1?i.classList.add("form-check-label"):i.classList.add("custom-control-label"),i.appendChild(document.createTextNode(t)),i}getFormRadioControl(t,e,i){const r=document.createElement("div");return this.options.custom_forms===!1?r.classList.add("form-check"):r.classList.add("custom-control","custom-radio"),r.appendChild(e),r.appendChild(t),i&&(this.options.custom_forms===!1?r.classList.add("form-check-inline"):r.classList.add("custom-control-inline")),r}getIndentedPanel(){const t=document.createElement("div");return t.classList.add("card","card-body","mb-3"),this.options.object_background&&t.classList.add(this.options.object_background),this.options.object_text&&t.classList.add(this.options.object_text),t}getFormInputDescription(t){const e=document.createElement("small");return e.classList.add("form-text"),window.DOMPurify?e.innerHTML=window.DOMPurify.sanitize(t):e.textContent=this.cleanText(t),e}getHeader(t,e){const i=document.createElement("span");return i.classList.add("h3"),i.classList.add("card-title"),i.classList.add("level-"+e),typeof t=="string"?i.textContent=t:i.appendChild(t),i.style.display="inline-block",i}getHeaderButtonHolder(){return this.getButtonHolder()}getButtonHolder(){const t=document.createElement("span");return t.classList.add("btn-group"),t}getFormButtonHolder(t){const e=this.getButtonHolder();return e.classList.add("d-block"),t==="center"?e.classList.add("text-center"):t==="right"&&e.classList.add("text-right"),e}getButton(t,e,i){const r=super.getButton(t,e,i);return r.classList.add("btn","btn-secondary","btn-sm"),r}getTableContainer(){const t=super.getTableContainer();return t.classList.add("table-responsive"),t}getTable(){const t=document.createElement("table");return t.classList.add("table","table-sm"),this.options.table_border&&t.classList.add("table-bordered"),this.options.table_zebrastyle&&t.classList.add("table-striped"),t}getErrorMessage(t){const e=document.createElement("div");return e.classList.add("alert","alert-danger"),e.setAttribute("role","alert"),e.appendChild(document.createTextNode(t)),e}addInputError(t,e){t.controlgroup&&(t.controlgroup.classList.add("is-invalid"),t.errmsg||(t.errmsg=document.createElement("p"),t.errmsg.classList.add("invalid-feedback"),t.controlgroup.appendChild(t.errmsg),t.errmsg.style.display="block"),t.errmsg.style.display="block",t.errmsg.textContent=e,t.errmsg.setAttribute("role","alert"))}removeInputError(t){t.errmsg&&(t.errmsg.style.display="none",t.controlgroup.classList.remove("is-invalid"))}getTabHolder(t){const e=document.createElement("div"),i=typeof t>"u"?"":t;return e.innerHTML=`<div class='col-md-2' id='${i}'><ul class='nav flex-column nav-pills'></ul></div><div class='col-md-10'><div class='tab-content' id='${i}'></div></div>`,e.classList.add("row"),e}addTab(t,e){t.children[0].children[0].appendChild(e)}getTabContentHolder(t){return t.children[1].children[0]}getTopTabHolder(t){const e=typeof t>"u"?"":t,i=document.createElement("div");return i.classList.add("card"),i.innerHTML=`<div class='card-header'><ul class='nav nav-tabs card-header-tabs' id='${e}'></ul></div><div class='card-body'><div class='tab-content' id='${e}'></div></div>`,i}getTab(t,e){const i=document.createElement("li");i.classList.add("nav-item");const r=document.createElement("a");return r.classList.add("nav-link"),r.setAttribute("href",`#${e}`),r.setAttribute("data-toggle","tab"),r.appendChild(t),i.appendChild(r),i}getTopTab(t,e){const i=document.createElement("li");i.classList.add("nav-item");const r=document.createElement("a");return r.classList.add("nav-link"),r.setAttribute("href",`#${e}`),r.setAttribute("data-toggle","tab"),r.appendChild(t),i.appendChild(r),i}getTabContent(){const t=document.createElement("div");return t.classList.add("tab-pane"),t.setAttribute("role","tabpanel"),t}getTopTabContent(){const t=document.createElement("div");return t.classList.add("tab-pane"),t.setAttribute("role","tabpanel"),t}markTabActive(t){t.tab.firstChild.classList.add("active"),typeof t.rowPane<"u"?t.rowPane.classList.add("active"):t.container.classList.add("active")}markTabInactive(t){t.tab.firstChild.classList.remove("active"),typeof t.rowPane<"u"?t.rowPane.classList.remove("active"):t.container.classList.remove("active")}insertBasicTopTab(t,e){e.children[0].children[0].insertBefore(t,e.children[0].children[0].firstChild)}addTopTab(t,e){t.children[0].children[0].appendChild(e)}getTopTabContentHolder(t){return t.children[1].children[0]}getFirstTab(t){return t.firstChild.firstChild.firstChild}getProgressBar(){const t=document.createElement("div");t.classList.add("progress");const e=document.createElement("div");return e.classList.add("progress-bar"),e.setAttribute("role","progressbar"),e.setAttribute("aria-valuenow",0),e.setAttribute("aria-valuemin",0),e.setAttribute("aria-valuenax",100),e.innerHTML="0%",t.appendChild(e),t}updateProgressBar(t,e){if(!t)return;const i=t.firstChild,r=`${e}%`;i.setAttribute("aria-valuenow",e),i.style.width=r,i.innerHTML=r}updateProgressBarUnknown(t){if(!t)return;const e=t.firstChild;t.classList.add("progress","progress-striped","active"),e.removeAttribute("aria-valuenow"),e.style.width="100%",e.innerHTML=""}getBlockLink(){const t=document.createElement("a");return t.classList.add("mb-3","d-inline-block"),t}getLinksHolder(){return document.createElement("div")}getInputGroup(t,e){if(!t)return;const i=document.createElement("div");i.classList.add("input-group"),i.appendChild(t);const r=document.createElement("div");r.classList.add("input-group-append"),i.appendChild(r);for(let n=0;n<e.length;n++)e[n].classList.remove("mr-2","btn-secondary"),e[n].classList.add("btn-outline-secondary"),r.appendChild(e[n]);return i}}l$.rules=igt;const rgt={".form-group":"margin-bottom:1rem",".form-text":"display:block",".jsoneditor-twbs5-text-button":"background:none;padding:0;border:0;color:currentColor","td > .form-group":"margin-bottom:0",".json-editor-btn-upload":"margin-top:1rem",".je-noindent .card":"padding:0;border:0",".je-tooltip:hover::before":"display:block;position:absolute;font-size:0.8em;color:%23fff;border-radius:0.2em;content:attr(title);background-color:%23000;margin-top:-2.5em;padding:0.3em",".je-tooltip:hover::after":"display:block;position:absolute;font-size:0.8em;color:%23fff",".select2-container--default .select2-selection--single":"height:calc(1.5em%20%2B%200.75rem%20%2B%202px)",".select2-container--default   .select2-selection--single   .select2-selection__arrow":"height:calc(1.5em%20%2B%200.75rem%20%2B%202px)",".select2-container--default   .select2-selection--single   .select2-selection__rendered":"line-height:calc(1.5em%20%2B%200.75rem%20%2B%202px)",".selectize-control.form-control":"padding:0",".selectize-dropdown.form-control":"padding:0;height:auto",".je-upload-preview img":"float:left;margin:0%200.5rem%200.5rem%200;max-width:100%25;max-height:5rem",".je-dropzone":"position:relative;margin:0.5rem%200;border:2px%20dashed%20black;width:100%25;height:60px;background:teal;transition:all%200.5s",".je-dropzone:before":"position:absolute;content:attr(data-text);color:rgba(0%2C%200%2C%200%2C%200.6);left:50%25;top:50%25;transform:translate(-50%25%2C%20-50%25)",".je-dropzone.valid-dropzone":"background:green",".je-dropzone.invalid-dropzone":"background:red"},ngt={disable_theme_rules:!1,input_size:"normal",object_indent:!0,object_background:"bg-light",object_text:"",table_border:!1,table_zebrastyle:!1,tooltip:"bootstrap"};class h$ extends ka{constructor(t){super(t,ngt)}getSelectInput(t,e){const i=super.getSelectInput(t);return i.classList.add("form-control"),i.classList.add("form-select"),this.options.input_size==="small"&&i.classList.add("form-control-sm"),this.options.input_size==="large"&&i.classList.add("form-control-lg"),i}getContainer(){const t=document.createElement("div");return this.options.object_indent||t.classList.add("je-noindent"),t}setGridColumnSize(t,e,i){t.classList.add(`col-md-${e}`),i&&t.classList.add(`offset-md-${i}`)}afterInputReady(t){if(t.controlgroup)return;const e=t.name;t.id=e;const i=t.parentNode.parentNode.getElementsByTagName("label")[0];i&&(i.classList.add("form-label"),i.htmlFor=e),t.controlgroup=this.closest(t,".form-group")}getTextareaInput(){const t=document.createElement("textarea");return t.classList.add("form-control"),this.options.input_size==="small"&&t.classList.add("form-control-sm"),this.options.input_size==="large"&&t.classList.add("form-control-lg"),t}getRangeInput(t,e,i,r,n){const o=super.getRangeInput(t,e,i,r,n);return o.classList.remove("form-control"),o.classList.add("form-range"),o}getStepperButtons(t){const e=document.createElement("div"),i=document.createElement("button");i.setAttribute("type","button");const r=document.createElement("button");r.setAttribute("type","button"),e.appendChild(i),e.appendChild(t),e.appendChild(r),e.classList.add("input-group"),i.classList.add("btn"),i.classList.add("btn-secondary"),i.classList.add("stepper-down"),r.classList.add("btn"),r.classList.add("btn-secondary"),r.classList.add("stepper-up"),t.getAttribute("readonly")&&(i.setAttribute("disabled",!0),r.setAttribute("disabled",!0)),i.textContent="-",r.textContent="+";const n=(l,h)=>{h?l.value=Number(h):l.value=Number(l.value),l.setAttribute("initialized","1")},o=t.getAttribute("min"),a=t.getAttribute("max");return t.addEventListener("change",()=>{t.getAttribute("initialized")||t.setAttribute("initialized","1")}),i.addEventListener("click",()=>{t.getAttribute("initialized")?o?Number(t.value)>Number(o)&&t.stepDown():t.stepDown():n(t,o),Dn(t,"change")}),r.addEventListener("click",()=>{t.getAttribute("initialized")?a?Number(t.value)<Number(a)&&t.stepUp():t.stepUp():n(t,o),Dn(t,"change")}),e}getFormInputField(t){const e=super.getFormInputField(t);return t!=="checkbox"&&t!=="radio"&&(e.classList.add("form-control"),this.options.input_size==="small"&&e.classList.add("form-control-sm"),this.options.input_size==="large"&&e.classList.add("form-control-lg")),e}getFormControl(t,e,i,r,n){const o=document.createElement("div");if(o.classList.add("form-group"),t&&(e.type==="checkbox"||e.type==="radio")){const a=document.createElement("div");a.classList.add("form-check"),e.classList.add("form-check-input"),t.classList.add("form-check-label"),e.tagName.toLowerCase()!=="div"&&e&&t&&n&&(t.setAttribute("for",n),e.setAttribute("id",n)),e.tagName.toLowerCase()!=="div"&&e&&i&&(i.setAttribute("id",n+"-description"),e.setAttribute("aria-describedby",n+"-description")),a.appendChild(e),a.appendChild(t),r&&a.appendChild(r),o.appendChild(a)}else t&&(t.classList.add("form-label"),o.appendChild(t),r&&o.appendChild(r)),o.appendChild(e);return i&&o.appendChild(i),o}getHiddenLabel(t){const e=document.createElement("label");return e.textContent=t,e.classList.add("visually-hidden"),e}visuallyHidden(t){t&&t.classList.add("visually-hidden")}getHiddenText(t){const e=document.createElement("span");return e.textContent=t,e.classList.add("sr-only"),e}getInfoButton(t){const e=document.createElement("button");e.type="button",e.classList.add("ms-3","jsoneditor-twbs5-text-button"),e.setAttribute("data-toggle","tooltip"),e.setAttribute("data-placement","auto"),e.title=t;const i=document.createTextNode("ⓘ");return e.appendChild(i),this.options.tooltip==="bootstrap"?window.jQuery&&window.jQuery().tooltip?window.jQuery(e).tooltip():console.warn("Could not find popper jQuery plugin of Bootstrap."):this.options.tooltip==="css"&&e.classList.add("je-tooltip"),e}getCheckbox(){return this.getFormInputField("checkbox")}getMultiCheckboxHolder(t,e,i,r){const n=document.createElement("div");n.classList.add("form-group"),e&&(n.appendChild(e),r&&e.appendChild(r));const o=document.createElement("div");return Object.values(t).forEach(a=>{const l=a.firstChild;o.appendChild(l)}),n.appendChild(o),i&&n.appendChild(i),n}getFormRadio(t){const e=this.getFormInputField("radio");for(const i in t)e.setAttribute(i,t[i]);return e.classList.add("form-check-input"),e}getFormRadioLabel(t,e){const i=document.createElement("label");return i.classList.add("form-check-label"),i.appendChild(document.createTextNode(t)),i}getFormRadioControl(t,e,i){const r=document.createElement("div");return r.classList.add("form-check"),r.appendChild(e),r.appendChild(t),i&&r.classList.add("form-check-inline"),r}getIndentedPanel(){const t=document.createElement("div");return t.classList.add("card","card-body","my-3"),this.options.object_background&&t.classList.add(this.options.object_background),this.options.object_text&&t.classList.add(this.options.object_text),t}getFormInputDescription(t){const e=document.createElement("small");return e.classList.add("form-text"),e.classList.add("d-block"),window.DOMPurify?e.innerHTML=window.DOMPurify.sanitize(t):e.textContent=this.cleanText(t),e}getHeader(t,e){const i=document.createElement("span");return i.classList.add("h3"),i.classList.add("card-title"),i.classList.add("level-"+e),typeof t=="string"?i.textContent=t:i.appendChild(t),i.style.display="inline-block",i}getHeaderButtonHolder(){return this.getButtonHolder()}getButtonHolder(){const t=document.createElement("span");return t.classList.add("btn-group"),t}getFormButtonHolder(t){const e=this.getButtonHolder();return e.classList.add("d-block"),t==="center"?e.classList.add("text-center"):t==="right"&&e.classList.add("text-end"),e}getButton(t,e,i){const r=super.getButton(t,e,i);return r.classList.add("btn","btn-secondary","btn-sm"),r}getTableContainer(){const t=super.getTableContainer();return t.classList.add("table-responsive"),t}getTable(){const t=document.createElement("table");return t.classList.add("table","table-sm"),this.options.table_border&&t.classList.add("table-bordered"),this.options.table_zebrastyle&&t.classList.add("table-striped"),t}getErrorMessage(t){const e=document.createElement("div");return e.classList.add("alert","alert-danger"),e.setAttribute("role","alert"),e.appendChild(document.createTextNode(t)),e}addInputError(t,e){t.controlgroup&&(t.controlgroup.classList.add("is-invalid"),t.errmsg||(t.errmsg=document.createElement("p"),t.errmsg.classList.add("invalid-feedback"),t.controlgroup.appendChild(t.errmsg),t.errmsg.style.display="block"),t.errmsg.style.display="block",t.errmsg.textContent=e,t.errmsg.setAttribute("role","alert"))}removeInputError(t){t.errmsg&&(t.errmsg.style.display="none",t.controlgroup.classList.remove("is-invalid"))}getTabHolder(t){const e=document.createElement("div"),i=typeof t>"u"?"":t;return e.innerHTML=`<div class='col-md-2' id='${i}'><ul class='nav flex-column nav-pills'></ul></div><div class='col-md-10'><div class='tab-content' id='${i}'></div></div>`,e.classList.add("row"),e}addTab(t,e){t.children[0].children[0].appendChild(e)}getTabContentHolder(t){return t.children[1].children[0]}getTopTabHolder(t){const e=typeof t>"u"?"":t,i=document.createElement("div");return i.classList.add("card"),i.innerHTML=`<div class='card-header'><ul class='nav nav-tabs card-header-tabs' id='${e}'></ul></div><div class='card-body'><div class='tab-content' id='${e}'></div></div>`,i}getTab(t,e){const i=document.createElement("li");i.classList.add("nav-item");const r=document.createElement("a");return r.classList.add("nav-link"),r.setAttribute("href",`#${e}`),r.setAttribute("data-toggle","tab"),r.appendChild(t),i.appendChild(r),i}getTopTab(t,e){const i=document.createElement("li");i.classList.add("nav-item");const r=document.createElement("a");return r.classList.add("nav-link"),r.setAttribute("href",`#${e}`),r.setAttribute("data-toggle","tab"),r.appendChild(t),i.appendChild(r),i}getTabContent(){const t=document.createElement("div");return t.classList.add("tab-pane"),t.setAttribute("role","tabpanel"),t}getTopTabContent(){const t=document.createElement("div");return t.classList.add("tab-pane"),t.setAttribute("role","tabpanel"),t}markTabActive(t){t.tab.firstChild.classList.add("active"),typeof t.rowPane<"u"?t.rowPane.classList.add("active"):t.container.classList.add("active")}markTabInactive(t){t.tab.firstChild.classList.remove("active"),typeof t.rowPane<"u"?t.rowPane.classList.remove("active"):t.container.classList.remove("active")}insertBasicTopTab(t,e){e.children[0].children[0].insertBefore(t,e.children[0].children[0].firstChild)}addTopTab(t,e){t.children[0].children[0].appendChild(e)}getTopTabContentHolder(t){return t.children[1].children[0]}getFirstTab(t){return t.firstChild.firstChild.firstChild}getProgressBar(){const t=document.createElement("div");t.classList.add("progress");const e=document.createElement("div");return e.classList.add("progress-bar"),e.setAttribute("role","progressbar"),e.setAttribute("aria-valuenow",0),e.setAttribute("aria-valuemin",0),e.setAttribute("aria-valuenax",100),e.innerHTML="0%",t.appendChild(e),t}updateProgressBar(t,e){if(!t)return;const i=t.firstChild,r=`${e}%`;i.setAttribute("aria-valuenow",e),i.style.width=r,i.innerHTML=r}updateProgressBarUnknown(t){if(!t)return;const e=t.firstChild;t.classList.add("progress","progress-striped","active"),e.removeAttribute("aria-valuenow"),e.style.width="100%",e.innerHTML=""}getBlockLink(){const t=document.createElement("a");return t.classList.add("mb-3","d-inline-block"),t}getLinksHolder(){return document.createElement("div")}getInputGroup(t,e){if(!t)return;const i=document.createElement("div");i.classList.add("input-group"),i.appendChild(t);for(let r=0;r<e.length;r++)e[r].classList.remove("me-2","btn-secondary"),e[r].classList.add("btn-outline-secondary"),i.appendChild(e[r]);return i}}h$.rules=rgt;class c$ extends ka{getTable(){const t=super.getTable();return t.setAttribute("cellpadding",5),t.setAttribute("cellspacing",0),t}getTableHeaderCell(t){const e=super.getTableHeaderCell(t);return e.classList.add("ui-state-active"),e.style.fontWeight="bold",e}getTableCell(){const t=super.getTableCell();return t.classList.add("ui-widget-content"),t}getHeaderButtonHolder(){const t=this.getButtonHolder();return t.style.marginLeft="10px",t.style.fontSize=".6em",t.style.display="inline-block",t}getFormInputDescription(t){const e=this.getDescription(t);return e.style.marginLeft="10px",e.style.display="inline-block",e}getFormControl(t,e,i,r){const n=super.getFormControl(t,e,i,r);return e.type==="checkbox"?(n.style.lineHeight="25px",n.style.padding="3px 0"):n.style.padding="4px 0 8px 0",n}getDescription(t){const e=document.createElement("span");return e.style.fontSize=".8em",e.style.fontStyle="italic",window.DOMPurify?e.innerHTML=window.DOMPurify.sanitize(t):e.textContent=this.cleanText(t),e}getButtonHolder(){const t=document.createElement("div");return t.classList.add("ui-buttonset"),t.style.fontSize=".7em",t}getFormInputLabel(t,e){const i=document.createElement("label");return i.style.fontWeight="bold",i.style.display="block",i.textContent=t,e&&i.classList.add("required"),i}getButton(t,e,i){const r=document.createElement("button");r.classList.add("ui-button","ui-widget","ui-state-default","ui-corner-all"),e&&!t?(r.classList.add("ui-button-icon-only"),e.classList.add("ui-button-icon-primary","ui-icon-primary"),r.appendChild(e)):e?(r.classList.add("ui-button-text-icon-primary"),e.classList.add("ui-button-icon-primary","ui-icon-primary"),r.appendChild(e)):r.classList.add("ui-button-text-only");const n=document.createElement("span");return n.classList.add("ui-button-text"),n.textContent=t||i||".",r.appendChild(n),r.setAttribute("title",i),r}setButtonText(t,e,i,r){t.innerHTML="",t.classList.add("ui-button","ui-widget","ui-state-default","ui-corner-all"),i&&!e?(t.classList.add("ui-button-icon-only"),i.classList.add("ui-button-icon-primary","ui-icon-primary"),t.appendChild(i)):i?(t.classList.add("ui-button-text-icon-primary"),i.classList.add("ui-button-icon-primary","ui-icon-primary"),t.appendChild(i)):t.classList.add("ui-button-text-only");const n=document.createElement("span");n.classList.add("ui-button-text"),n.textContent=e||r||".",t.appendChild(n),t.setAttribute("title",r)}getIndentedPanel(){const t=document.createElement("div");return t.classList.add("ui-widget-content","ui-corner-all"),t.style.padding="1em 1.4em",t.style.marginBottom="20px",t}afterInputReady(t){if(!t.controls&&(t.controls=this.closest(t,".form-control"),this.queuedInputErrorText)){const e=this.queuedInputErrorText;delete this.queuedInputErrorText,this.addInputError(t,e)}}addInputError(t,e){if(!t.controls){this.queuedInputErrorText=e;return}t.errmsg?t.errmsg.style.display="":(t.errmsg=document.createElement("div"),t.errmsg.classList.add("ui-state-error"),t.controls.appendChild(t.errmsg)),t.errmsg.textContent=e}removeInputError(t){t.controls||delete this.queuedInputErrorText,t.errmsg&&(t.errmsg.style.display="none")}markTabActive(t){t.tab.classList.remove("ui-widget-header"),t.tab.classList.add("ui-state-active"),typeof t.rowPane<"u"?t.rowPane.style.display="":t.container.style.display=""}markTabInactive(t){t.tab.classList.add("ui-widget-header"),t.tab.classList.remove("ui-state-active"),typeof t.rowPane<"u"?t.rowPane.style.display="none":t.container.style.display="none"}}c$.rules={'div[data-schemaid="root"]:after':'position:relative;color:red;margin:10px 0;font-weight:600;display:block;width:100%;text-align:center;content:"This is an old JSON-Editor 1.x Theme and might not display elements correctly when used with the 2.x version"'};const ogt={".je-upload-preview img":"float:left;margin:0%200.5rem%200.5rem%200;max-width:100%25;max-height:5rem",".je-dropzone":"position:relative;margin:0.5rem%200;border:2px%20dashed%20black;width:100%25;height:60px;background:teal;transition:all%200.5s",".je-dropzone:before":"position:absolute;content:attr(data-text);color:rgba(0%2C%200%2C%200%2C%200.6);left:50%25;top:50%25;transform:translate(-50%25%2C%20-50%25)",".je-dropzone.valid-dropzone":"background:green",".je-dropzone.invalid-dropzone":"background:red"};class u$ extends ka{addInputError(t,e){if(t.errmsg)t.errmsg.style.display="block";else{const i=this.closest(t,".form-control");t.errmsg=document.createElement("div"),t.errmsg.setAttribute("class","errmsg"),i.nodeName&&i.appendChild(t.errmsg)}t.errmsg.innerHTML="",t.errmsg.appendChild(document.createTextNode(e)),t.errmsg.setAttribute("role","alert")}removeInputError(t){t.style&&(t.style.borderColor=""),t.errmsg&&(t.errmsg.style.display="none")}}u$.rules=ogt;const agt={"*":"--primary-color:%235755d9;--gray-color:%23bcc3ce;--light-color:%23fff",".slider:focus":"box-shadow:none","h4 > label + .btn-group":"margin-left:1rem",".text-right > button":"margin-right:0%20!important",".text-left > button":"margin-left:0%20!important",".property-selector":"font-size:0.7rem;font-weight:normal;max-height:260px%20!important;width:395px%20!important",".property-selector .form-checkbox":"margin:0",textarea:"width:100%25;min-height:2rem;resize:vertical",table:"border-collapse:collapse",".table td":"padding:0.4rem%200.4rem",".mr-5":"margin-right:1rem%20!important","div[data-schematype]:not([data-schematype='object'])":"transition:0.5s","div[data-schematype]:not([data-schematype='object']):hover":"background-color:%23eee",".je-table-border td":"border:0.05rem%20solid%20%23dadee4%20!important",".btn-info":"font-size:0.5rem;font-weight:bold;height:0.8rem;padding:0.15rem%200;line-height:0.8;margin:0.3rem%200%200.3rem%200.1rem",".je-label + select":"min-width:5rem",".je-label":"font-weight:600",".btn-action.btn-info":"width:0.8rem",".je-border":"border:0.05rem%20solid%20%23dadee4",".je-panel":"padding:0.2rem;margin:0.2rem;background-color:rgba(218%2C%20222%2C%20228%2C%200.1)",".je-panel-top":"padding:0.2rem;margin:0.2rem;background-color:rgba(218%2C%20222%2C%20228%2C%200.1)",".required:after":"content:%22%20*%22;color:red;font:inherit",".je-align-bottom":"margin-top:auto",".je-desc":"font-size:smaller;margin:0.2rem%200",".je-upload-preview img":"float:left;margin:0%200.5rem%200.5rem%200;max-width:100%25;max-height:5rem;border:3px%20solid%20white;box-shadow:0px%200px%208px%20rgba(0%2C%200%2C%200%2C%200.3);box-sizing:border-box",".je-dropzone":"position:relative;margin:0.5rem%200;border:2px%20dashed%20black;width:100%25;height:60px;background:teal;transition:all%200.5s",".je-dropzone:before":"position:absolute;content:attr(data-text);color:rgba(0%2C%200%2C%200%2C%200.6);left:50%25;top:50%25;transform:translate(-50%25%2C%20-50%25)",".je-dropzone.valid-dropzone":"background:green",".je-dropzone.invalid-dropzone":"background:red",".columns .container.je-noindent":"padding-left:0;padding-right:0",".selectize-control.multi .item":"background:var(--primary-color)%20!important",".select2-container--default   .select2-selection--single   .select2-selection__arrow":"display:none",".select2-container--default .select2-selection--single":"border:none",".select2-container .select2-selection--single .select2-selection__rendered":"padding:0",".select2-container .select2-search--inline .select2-search__field":"margin-top:0",".select2-container--default.select2-container--focus   .select2-selection--multiple":"border:0.05rem%20solid%20var(--gray-color)",".select2-container--default   .select2-selection--multiple   .select2-selection__choice":"margin:0.4rem%200.2rem%200.2rem%200;padding:2px%205px;background-color:var(--primary-color);color:var(--light-color)",".select2-container--default .select2-search--inline .select2-search__field":"line-height:normal",".choices":"margin-bottom:auto",".choices__list--multiple .choices__item":"border:none;background-color:var(--primary-color);color:var(--light-color)",".choices[data-type*='select-multiple'] .choices__button":"border-left:0.05rem%20solid%20%232826a6",".choices__inner":"font-size:inherit;min-height:20px;padding:4px%207.5px%204px%203.75px",".choices[data-type*='select-one'] .choices__inner":"padding-bottom:4px",".choices__list--dropdown .choices__item":"font-size:inherit"},lgt={disable_theme_rules:!1,label_bold:!0,align_bottom:!1,object_indent:!1,object_border:!1,table_border:!1,table_zebrastyle:!1,input_size:"normal"};class d$ extends ka{constructor(t){super(t,lgt)}setGridColumnSize(t,e,i){t.classList.add(`col-${e}`),i&&t.classList.add("col-mx-auto")}getGridContainer(){const t=document.createElement("div");return t.classList.add("container"),this.options.object_indent||t.classList.add("je-noindent"),t}getGridRow(){const t=document.createElement("div");return t.classList.add("columns"),t}getGridColumn(){const t=document.createElement("div");return t.classList.add("column"),this.options.align_bottom&&t.classList.add("je-align-bottom"),t}getIndentedPanel(){const t=document.createElement("div");return t.classList.add("je-panel"),this.options.object_border&&t.classList.add("je-border"),t}getTopIndentedPanel(){const t=document.createElement("div");return t.classList.add("je-panel-top"),this.options.object_border&&t.classList.add("je-border"),t}getHeaderButtonHolder(){return this.getButtonHolder()}getButtonHolder(){const t=super.getButtonHolder();return t.classList.add("btn-group"),t}getFormButtonHolder(t){const e=super.getFormButtonHolder();return e.classList.remove("btn-group"),e.classList.add("d-block"),t==="center"?e.classList.add("text-center"):t==="right"?e.classList.add("text-right"):e.classList.add("text-left"),e}getFormButton(t,e,i){const r=super.getFormButton(t,e,i);return r.classList.add("btn","btn-primary","mx-2","my-1"),this.options.input_size!=="small"&&r.classList.remove("btn-sm"),this.options.input_size==="large"&&r.classList.add("btn-lg"),r}getButton(t,e,i){const r=super.getButton(t,e,i);return r.classList.add("btn","btn-sm","btn-primary","mr-2","my-1"),r}getHeader(t,e){const i=document.createElement("span");return typeof t=="string"?i.textContent=t:i.appendChild(t),i.style.display="inline-block",i}getFormInputDescription(t){const e=super.getFormInputDescription(t);return e.classList.add("je-desc","hide-sm"),e}getFormInputLabel(t,e){const i=super.getFormInputLabel(t,e);return this.options.label_bold&&i.classList.add("je-label"),i}getCheckbox(){return this.getFormInputField("checkbox")}getCheckboxLabel(t,e){const i=super.getCheckboxLabel(t,e),r=document.createElement("i");return r.classList.add("form-icon"),i.classList.add("form-checkbox","pr-0"),i.insertBefore(r,i.firstChild),i}getFormCheckboxControl(t,e,i){return t.insertBefore(e,t.firstChild),i&&t.classList.add("form-inline"),t}getMultiCheckboxHolder(t,e,i,r){return super.getMultiCheckboxHolder(t,e,i,r)}getFormRadio(t){const e=this.getFormInputField("radio");for(const i in t)e.setAttribute(i,t[i]);return e}getFormRadioLabel(t,e){const i=super.getFormRadioLabel(t,e),r=document.createElement("i");return r.classList.add("form-icon"),i.classList.add("form-radio"),i.insertBefore(r,i.firstChild),i}getFormRadioControl(t,e,i){return t.insertBefore(e,t.firstChild),i&&t.classList.add("form-inline"),t}getFormInputField(t){const e=super.getFormInputField(t);return["checkbox","radio"].includes(t)||e.classList.add("form-input"),e}getRangeInput(t,e,i,r,n){const o=super.getRangeInput(t,e,i,r,n);return o.classList.add("slider"),o.classList.remove("form-input"),o.setAttribute("oninput",'this.setAttribute("value", this.value)'),o}getRangeControl(t,e){const i=super.getRangeControl(t,e);return i.classList.add("text-center"),i}getSelectInput(t,e){const i=super.getSelectInput(t);return i.classList.add("form-select"),i}getTextareaInput(){const t=document.createElement("textarea");return t.classList.add("form-input"),t}getFormControl(t,e,i,r,n){const o=document.createElement("div");return o.classList.add("form-group"),t&&(e.type==="checkbox"||e.type==="radio")?(o.classList.add(e.type),r&&t.appendChild(r),t.insertBefore(e,t.firstChild),o.appendChild(t)):(t&&(t.classList.add("form-label"),o.appendChild(t),r&&t.appendChild(r)),o.appendChild(e)),this.options.input_size==="small"?e.classList.add("input-sm","select-sm"):this.options.input_size==="large"&&e.classList.add("input-lg","select-lg"),e.type!=="checkbox"&&o.appendChild(e),i&&o.appendChild(i),e.tagName.toLowerCase()!=="div"&&e&&t&&n&&(t.setAttribute("for",n),e.setAttribute("id",n)),e.tagName.toLowerCase()!=="div"&&e&&i&&(i.setAttribute("id",n+"-description"),e.setAttribute("aria-describedby",n+"-description")),o}getInputGroup(t,e){if(!t)return;const i=document.createElement("div");i.classList.add("input-group"),i.appendChild(t);for(let r=0;r<e.length;r++)e[r].classList.add("input-group-btn"),e[r].classList.remove("btn-sm","mr-2","my-1"),i.appendChild(e[r]);return i}getInfoButton(t){const e=document.createElement("div");e.classList.add("popover","popover-left","float-right");const i=document.createElement("button");i.classList.add("btn","btn-secondary","btn-info","btn-action","s-circle"),i.setAttribute("tabindex","-1"),e.appendChild(i);const r=document.createTextNode("I");i.appendChild(r);const n=document.createElement("div");n.classList.add("popover-container"),e.appendChild(n);const o=document.createElement("div");o.classList.add("card"),n.appendChild(o);const a=document.createElement("div");return a.classList.add("card-body"),a.innerHTML=t,o.appendChild(a),e}getTable(){const t=super.getTable();return t.classList.add("table","table-scroll"),this.options.table_border&&t.classList.add("je-table-border"),this.options.table_zebrastyle&&t.classList.add("table-striped"),t}getProgressBar(){const t=super.getProgressBar();return t.classList.add("progress"),t}getTabHolder(t){const e=typeof t>"u"?"":t,i=document.createElement("div");return i.classList.add("columns"),i.innerHTML=`<div class="column col-2"></div><div class="column col-10 content" id="${e}"></div>`,i}getTopTabHolder(t){const e=typeof t>"u"?"":t,i=document.createElement("div");return i.innerHTML=`<ul class="tab"></ul><div class="content" id="${e}"></div>`,i}getTab(t,e){const i=document.createElement("a");return i.classList.add("btn","btn-secondary","btn-block"),i.setAttribute("href",`#${e}`),i.appendChild(t),i}getTopTab(t,e){const i=document.createElement("li");i.id=e,i.classList.add("tab-item");const r=document.createElement("a");return r.setAttribute("href",`#${e}`),r.appendChild(t),i.appendChild(r),i}markTabActive(t){t.tab.classList.add("active"),typeof t.rowPane<"u"?t.rowPane.style.display="":t.container.style.display=""}markTabInactive(t){t.tab.classList.remove("active"),typeof t.rowPane<"u"?t.rowPane.style.display="none":t.container.style.display="none"}afterInputReady(t){if(t.localName==="select"){if(t.classList.contains("selectized")){const e=t.nextSibling;e&&(e.classList.remove("form-select"),Array.from(e.querySelectorAll(".form-select")).forEach(i=>{i.classList.remove("form-select")}))}else if(t.classList.contains("select2-hidden-accessible")){const e=t.nextSibling;e&&e.querySelector(".select2-selection--single")&&e.classList.add("form-select")}}t.controlgroup||(t.controlgroup=this.closest(t,".form-group"),this.closest(t,".compact")&&(t.controlgroup.style.marginBottom=0))}addInputError(t,e){t.controlgroup&&(t.controlgroup.classList.add("has-error"),t.errmsg||(t.errmsg=document.createElement("p"),t.errmsg.classList.add("form-input-hint"),t.controlgroup.appendChild(t.errmsg)),t.errmsg.classList.remove("d-hide"),t.errmsg.textContent=e,t.errmsg.setAttribute("role","alert"))}removeInputError(t){t.errmsg&&(t.errmsg.classList.add("d-hide"),t.controlgroup.classList.remove("has-error"))}}d$.rules=agt;const hgt={".slider":"-webkit-appearance:none;-moz-appearance:none;appearance:none;background:transparent;display:block;border:none;height:1.2rem;width:100%25",".slider:focus":"box-shadow:0%200%200%200%20rgba(87%2C%2085%2C%20217%2C%200.2);outline:none",".slider.tooltip:not([data-tooltip])::after":"content:attr(value)",".slider::-webkit-slider-thumb":"-webkit-appearance:none;background:%23f17405;border-radius:100%25;height:0.6rem;margin-top:-0.25rem;transition:transform%200.2s;width:0.6rem",".slider:active::-webkit-slider-thumb":"transform:scale(1.25);outline:none",".slider::-webkit-slider-runnable-track":"background:%23b2b4b6;border-radius:0.1rem;height:0.1rem;width:100%25","a.tooltips":"position:relative;display:inline","a.tooltips span":"position:absolute;white-space:nowrap;width:auto;padding-left:1rem;padding-right:1rem;color:%23ffffff;background:rgba(56%2C%2056%2C%2056%2C%200.85);height:1.5rem;line-height:1.5rem;text-align:center;visibility:hidden;border-radius:3px","a.tooltips span:after":"content:%22%22;position:absolute;top:50%25;left:100%25;margin-top:-5px;width:0;height:0;border-left:5px%20solid%20rgba(56%2C%2056%2C%2056%2C%200.85);border-top:5px%20solid%20transparent;border-bottom:5px%20solid%20transparent","a:hover.tooltips span":"visibility:visible;opacity:0.9;font-size:0.8rem;right:100%25;top:50%25;margin-top:-12px;margin-right:10px;z-index:999",".json-editor-btntype-properties + div":"font-size:0.8rem;font-weight:normal",textarea:"width:100%25;min-height:2rem;resize:vertical",table:"width:100%25;border-collapse:collapse",".table td":"padding:0rem%200rem","div[data-schematype]:not([data-schematype='object'])":"transition:0.5s","div[data-schematype]:not([data-schematype='object']):hover":"background-color:%23e6f4fe","div[data-schemaid='root']":"position:relative;width:inherit;display:inherit;overflow-x:hidden;z-index:10","select[multiple]":"height:auto","select[multiple].from-select":"height:auto",".je-table-zebra:nth-child(even)":"background-color:%23f2f2f2",".je-table-border":"border:0.5px%20solid%20black",".je-table-hdiv":"border-bottom:1px%20solid%20black",".je-border":"border:0.05rem%20solid%20%233182ce",".je-panel":"width:inherit;padding:0.2rem;margin:0.2rem;background-color:rgba(218%2C%20222%2C%20228%2C%200.1)",".je-panel-top":"width:100%25;padding:0.2rem;margin:0.2rem;background-color:rgba(218%2C%20222%2C%20228%2C%200.1)",".required:after":"content:%22%20*%22;color:red;font:inherit;font-weight:bold",".je-desc":"font-size:smaller;margin:0.2rem%200",".container-xl.je-noindent":"padding-left:0;padding-right:0",".json-editor-btntype-add":"color:white;margin:0.3rem;padding:0.3rem%200.8rem;background-color:%234299e1;box-shadow:3px%203px%205px%201px%20rgba(4%2C%204%2C%204%2C%200.2);-webkit-box-shadow:3px%203px%205px%201px%20rgba(4%2C%204%2C%204%2C%200.2);-moz-box-shadow:3px%203px%205px%201px%20rgba(4%2C%204%2C%204%2C%200.2)",".json-editor-btntype-deletelast":"color:white;margin:0.3rem;padding:0.3rem%200.8rem;background-color:%23e53e3e;box-shadow:3px%203px%205px%201px%20rgba(4%2C%204%2C%204%2C%200.2);-webkit-box-shadow:3px%203px%205px%201px%20rgba(4%2C%204%2C%204%2C%200.2);-moz-box-shadow:3px%203px%205px%201px%20rgba(4%2C%204%2C%204%2C%200.2)",".json-editor-btntype-deleteall":"color:white;margin:0.3rem;padding:0.3rem%200.8rem;background-color:%23000000;box-shadow:3px%203px%205px%201px%20rgba(4%2C%204%2C%204%2C%200.2);-webkit-box-shadow:3px%203px%205px%201px%20rgba(4%2C%204%2C%204%2C%200.2);-moz-box-shadow:3px%203px%205px%201px%20rgba(4%2C%204%2C%204%2C%200.2)",".json-editor-btn-save":"float:right;color:white;margin:0.3rem;padding:0.3rem%200.8rem;background-color:%232b6cb0;box-shadow:3px%203px%205px%201px%20rgba(4%2C%204%2C%204%2C%200.2);-webkit-box-shadow:3px%203px%205px%201px%20rgba(4%2C%204%2C%204%2C%200.2);-moz-box-shadow:3px%203px%205px%201px%20rgba(4%2C%204%2C%204%2C%200.2)",".json-editor-btn-back":"color:white;margin:0.3rem;padding:0.3rem%200.8rem;background-color:%232b6cb0;box-shadow:3px%203px%205px%201px%20rgba(4%2C%204%2C%204%2C%200.2);-webkit-box-shadow:3px%203px%205px%201px%20rgba(4%2C%204%2C%204%2C%200.2);-moz-box-shadow:3px%203px%205px%201px%20rgba(4%2C%204%2C%204%2C%200.2)",".json-editor-btntype-delete":"color:%23e53e3e;background-color:rgba(218%2C%20222%2C%20228%2C%200.1);margin:0.03rem;padding:0.1rem",".json-editor-btntype-move":"color:%23000000;background-color:rgba(218%2C%20222%2C%20228%2C%200.1);margin:0.03rem;padding:0.1rem",".json-editor-btn-collapse":"padding:0em%200.8rem;font-size:1.3rem;color:%23e53e3e;background-color:rgba(218%2C%20222%2C%20228%2C%200.1)",".je-upload-preview img":"float:left;margin:0%200.5rem%200.5rem%200;max-width:100%25;max-height:5rem",".je-dropzone":"position:relative;margin:0.5rem%200;border:2px%20dashed%20black;width:100%25;height:60px;background:teal;transition:all%200.5s",".je-dropzone:before":"position:absolute;content:attr(data-text);color:rgba(0%2C%200%2C%200%2C%200.6);left:50%25;top:50%25;transform:translate(-50%25%2C%20-50%25)",".je-dropzone.valid-dropzone":"background:green",".je-dropzone.invalid-dropzone":"background:red"},cgt={disable_theme_rules:!1,label_bold:!1,object_panel_default:!0,object_indent:!0,object_border:!1,table_border:!1,table_hdiv:!1,table_zebrastyle:!1,input_size:"small",enable_compact:!1};class p$ extends ka{constructor(t){super(t,cgt)}getGridContainer(){const t=document.createElement("div");return t.classList.add("flex","flex-col","w-full"),this.options.object_indent||t.classList.add("je-noindent"),t}getGridRow(){const t=document.createElement("div");return t.classList.add("flex","flex-wrap","w-full"),t}getGridColumn(){const t=document.createElement("div");return t.classList.add("flex","flex-col"),t}setGridColumnSize(t,e,i){e>0&&e<12?t.classList.add(`w-${e}/12`,"px-1"):t.classList.add("w-full","px-1"),i&&(t.style.marginLeft=`${100/12*i}%`)}getIndentedPanel(){const t=document.createElement("div");return this.options.object_panel_default?t.classList.add("w-full","p-1"):t.classList.add("relative","flex","flex-col","rounded","break-words","border","bg-white","border-0","border-blue-400","p-1","shadow-md"),this.options.object_border&&t.classList.add("je-border"),t}getTopIndentedPanel(){const t=document.createElement("div");return this.options.object_panel_default?t.classList.add("w-full","m-2"):t.classList.add("relative","flex","flex-col","rounded","break-words","border","bg-white","border-0","border-blue-400","p-1","shadow-md"),this.options.object_border&&t.classList.add("je-border"),t}getTitle(){return this.translateProperty(this.schema.title)}getSelectInput(t,e){const i=super.getSelectInput(t);return e?i.classList.add("form-multiselect","block","py-0","h-auto","w-full","px-1","text-sm","text-black","leading-normal","bg-white","border","border-grey","rounded"):i.classList.add("form-select","block","py-0","h-6","w-full","px-1","text-sm","text-black","leading-normal","bg-white","border","border-grey","rounded"),this.options.enable_compact&&i.classList.add("compact"),i}afterInputReady(t){t.controlgroup||(t.controlgroup=this.closest(t,".form-group"),this.closest(t,".compact")&&(t.controlgroup.style.marginBottom=0))}getTextareaInput(){const t=super.getTextareaInput();return t.classList.add("block","w-full","px-1","text-sm","leading-normal","bg-white","text-black","border","border-grey","rounded"),this.options.enable_compact&&t.classList.add("compact"),t.style.height=0,t}getRangeInput(t,e,i){const r=this.getFormInputField("range");return r.classList.add("slider"),this.options.enable_compact&&r.classList.add("compact"),r.setAttribute("oninput",'this.setAttribute("value", this.value)'),r.setAttribute("min",t),r.setAttribute("max",e),r.setAttribute("step",i),r}getRangeControl(t,e){const i=super.getRangeControl(t,e);return i.classList.add("text-center","text-black"),i}getCheckbox(){const t=this.getFormInputField("checkbox");return t.classList.add("form-checkbox","text-red-600"),t}getCheckboxLabel(t,e){const i=super.getCheckboxLabel(t,e);return i.classList.add("inline-flex","items-center"),i}getFormCheckboxControl(t,e,i){return t.insertBefore(e,t.firstChild),i&&t.classList.add("inline-flex flex-row"),t}getMultiCheckboxHolder(t,e,i,r){const n=super.getMultiCheckboxHolder(t,e,i,r);return n.classList.add("inline-flex","flex-col"),n}getFormRadio(t){const e=this.getFormInputField("radio");e.classList.add("form-radio","text-red-600");for(const i in t)e.setAttribute(i,t[i]);return e}getFormRadioLabel(t,e){const i=super.getFormRadioLabel(t,e);return i.classList.add("inline-flex","items-center","mr-2"),i}getFormRadioControl(t,e,i){return t.insertBefore(e,t.firstChild),i&&t.classList.add("form-radio"),t}getRadioHolder(t,e,i,r,n){const o=super.getRadioHolder(e,i,r,n);return t.options.layout==="h"?o.classList.add("inline-flex","flex-row"):o.classList.add("inline-flex","flex-col"),o}getFormInputLabel(t,e){const i=super.getFormInputLabel(t,e);return this.options.label_bold?i.classList.add("font-bold"):i.classList.add("required"),i}getFormInputField(t){const e=super.getFormInputField(t);return["checkbox","radio"].includes(t)||e.classList.add("block","w-full","px-1","text-black","text-sm","leading-normal","bg-white","border","border-grey","rounded"),this.options.enable_compact&&e.classList.add("compact"),e}getFormInputDescription(t){const e=document.createElement("p");return e.classList.add("block","mt-1","text-xs"),window.DOMPurify?e.innerHTML=window.DOMPurify.sanitize(t):e.textContent=this.cleanText(t),e}getFormControl(t,e,i,r){const n=document.createElement("div");return n.classList.add("form-group","mb-1","w-full"),t&&(t.classList.add("text-xs"),e.type==="checkbox"&&(e.classList.add("form-checkbox","text-xs","text-red-600","mr-1"),t.classList.add("items-center","flex"),t=this.getFormCheckboxControl(t,e,!1,r)),e.type==="radio"&&(e.classList.add("form-radio","text-red-600","mr-1"),t.classList.add("items-center","flex"),t=this.getFormRadioControl(t,e,!1,r)),n.appendChild(t),!["checkbox","radio"].includes(e.type)&&r&&n.appendChild(r)),["checkbox","radio"].includes(e.type)||(this.options.input_size==="small"?e.classList.add("text-xs"):this.options.input_size==="normal"?e.classList.add("text-base"):this.options.input_size==="large"&&e.classList.add("text-xl"),n.appendChild(e)),i&&n.appendChild(i),n}getHeaderButtonHolder(){const t=this.getButtonHolder();return t.classList.add("text-sm"),t}getButtonHolder(){const t=document.createElement("div");return t.classList.add("flex","relative","inline-flex","align-middle"),t}getButton(t,e,i){const r=super.getButton(t,e,i);return r.classList.add("inline-block","align-middle","text-center","text-sm","bg-blue-700","text-white","py-1","pr-1","m-2","shadow","select-none","whitespace-no-wrap","rounded"),r}getInfoButton(t){const e=document.createElement("a");e.classList.add("tooltips","float-right"),e.innerHTML="ⓘ";const i=document.createElement("span");return i.innerHTML=t,e.appendChild(i),e}getTable(){const t=super.getTable();return this.options.table_border?t.classList.add("je-table-border"):t.classList.add("table","border","p-0"),t}getTableRow(){const t=super.getTableRow();return this.options.table_border&&t.classList.add("je-table-border"),this.options.table_zebrastyle&&t.classList.add("je-table-zebra"),t}getTableHeaderCell(t){const e=super.getTableHeaderCell(t);return this.options.table_border?e.classList.add("je-table-border"):this.options.table_hdiv?e.classList.add("je-table-hdiv"):e.classList.add("text-xs","border","p-0","m-0"),e}getTableCell(){const t=super.getTableCell();return this.options.table_border?t.classList.add("je-table-border"):this.options.table_hdiv?t.classList.add("je-table-hdiv"):t.classList.add("border-0","p-0","m-0"),t}addInputError(t,e){t.controlgroup&&(t.controlgroup.classList.add("has-error"),t.controlgroup.classList.add("text-red-600"),t.errmsg?t.errmsg.style.display="":(t.errmsg=document.createElement("p"),t.errmsg.classList.add("block","mt-1","text-xs","text-red"),t.controlgroup.appendChild(t.errmsg)),t.errmsg.textContent=e)}removeInputError(t){t.errmsg&&(t.errmsg.style.display="none",t.controlgroup.classList.remove("text-red-600"),t.controlgroup.classList.remove("has-error"))}getTabHolder(t){const e=document.createElement("div"),i=typeof t>"u"?"":t;return e.innerHTML=`<div class='w-2/12' id='${i}'><ul class='list-reset pl-0 mb-0'></ul></div><div class='w-10/12' id='${i}'></div>`,e.classList.add("flex"),e}addTab(t,e){t.children[0].children[0].appendChild(e)}getTopTabHolder(t){const e=typeof t>"u"?"":t,i=document.createElement("div");return i.innerHTML=`<ul class='nav-tabs flex list-reset pl-0 mb-0 border-b border-grey-light' id='${e}'></ul><div class='p-6 block' id='${e}'></div>`,i}getTab(t,e){const i=document.createElement("li");i.classList.add("nav-item","flex-col","text-center","text-white","bg-blue-500","shadow-md","border","p-2","mb-2","mr-2","hover:bg-blue-400","rounded");const r=document.createElement("a");return r.classList.add("nav-link","text-center"),r.setAttribute("href",`#${e}`),r.setAttribute("data-toggle","tab"),r.appendChild(t),i.appendChild(r),i}getTopTab(t,e){const i=document.createElement("li");i.classList.add("nav-item","flex","border-l","border-t","border-r");const r=document.createElement("a");return r.classList.add("nav-link","-mb-px","flex-row","text-center","bg-white","p-2","hover:bg-blue-400","rounded-t"),r.setAttribute("href",`#${e}`),r.setAttribute("data-toggle","tab"),r.appendChild(t),i.appendChild(r),i}getTabContent(){const t=document.createElement("div");return t.setAttribute("role","tabpanel"),t}getTopTabContent(){const t=document.createElement("div");return t.setAttribute("role","tabpanel"),t}markTabActive(t){t.tab.firstChild.classList.add("block"),t.tab.firstChild.classList.contains("border-b")===!0?(t.tab.firstChild.classList.add("border-b-0"),t.tab.firstChild.classList.remove("border-b")):t.tab.firstChild.classList.add("border-b-0"),t.container.classList.contains("hidden")===!0&&t.container.classList.remove("hidden"),t.container.classList.add("block")}markTabInactive(t){t.tab.firstChild.classList.contains("border-b-0")===!0?(t.tab.firstChild.classList.add("border-b"),t.tab.firstChild.classList.remove("border-b-0")):t.tab.firstChild.classList.add("border-b"),t.container.classList.contains("block")===!0&&(t.container.classList.remove("block"),t.container.classList.add("hidden"))}getProgressBar(){const t=document.createElement("div");t.classList.add("progress");const e=document.createElement("div");return e.classList.add("bg-blue","leading-none","py-1","text-xs","text-center","text-white"),e.setAttribute("role","progressbar"),e.setAttribute("aria-valuenow",0),e.setAttribute("aria-valuemin",0),e.setAttribute("aria-valuenax",100),e.innerHTML="0%",t.appendChild(e),t}updateProgressBar(t,e){if(!t)return;const i=t.firstChild,r=`${e}%`;i.setAttribute("aria-valuenow",e),i.style.width=r,i.innerHTML=r}updateProgressBarUnknown(t){if(!t)return;const e=t.firstChild;t.classList.add("progress","bg-blue","leading-none","py-1","text-xs","text-center","text-white","block"),e.removeAttribute("aria-valuenow"),e.classList.add("w-full"),e.innerHTML=""}getInputGroup(t,e){if(!t)return;const i=document.createElement("div");i.classList.add("relative","items-stretch","w-full"),i.appendChild(t);const r=document.createElement("div");r.classList.add("-mr-1"),i.appendChild(r);for(let n=0;n<e.length;n++)r.appendChild(e[n]);return i}}p$.rules=hgt;const ugt={html:o$,bootstrap3:a$,bootstrap4:l$,bootstrap5:h$,jqueryui:c$,barebones:u$,spectre:d$,tailwind:p$},dgt={".je-float-right-linkholder":"float:right;margin-left:10px",".je-modal":"background-color:white;border:1px%20solid%20black;box-shadow:3px%203px%20black;position:absolute;z-index:10",".je-infobutton-icon":"font-size:16px;font-weight:bold;padding:0.25rem;position:relative;display:inline-block",".je-infobutton-tooltip":"font-size:12px;font-weight:normal;font-family:sans-serif;visibility:hidden;background-color:rgba(50%2C%2050%2C%2050%2C%200.75);margin:0%200.25rem;color:%23fafafa;padding:0.5rem%201rem;border-radius:0.25rem;width:20rem;position:absolute",".je-not-loaded":"pointer-events:none",".je-header":"display:inline-block",".je-upload-preview img":"float:left;margin:0%200.5rem%200.5rem%200;max-width:100%25;max-height:5rem",".je-checkbox":"display:inline-block;width:auto",".je-checkbox-control--compact":"display:inline-block;margin-right:1rem",".je-radio":"display:inline-block;width:auto",".je-radio-control--compact":"display:inline-block;margin-right:1rem",".je-switcher":"background-color:transparent;display:inline-block;font-style:italic;font-weight:normal;height:auto;width:auto;margin-bottom:0;margin-left:5px;padding:0%200%200%203px",".je-textarea":"width:100%25;height:300px;box-sizing:border-box",".je-range-control":"text-align:center",".je-indented-panel":"padding-left:10px;margin-left:10px;border-left:1px%20solid%20%23ccc",".je-indented-panel--top":"padding-left:10px;margin-left:10px",".je-tabholder":"float:left;width:130px",".je-tabholder .content":"margin-left:120px",".je-tabholder--top":"margin-left:10px",".je-tabholder--clear":"clear:both",".je-tab":"border:1px%20solid%20%23ccc;border-width:1px%200%201px%201px;text-align:center;line-height:30px;border-radius:5px;border-bottom-right-radius:0;border-top-right-radius:0;font-weight:bold;cursor:pointer",".je-tab--top":"float:left;border:1px%20solid%20%23ccc;border-width:1px%201px%200px%201px;text-align:center;line-height:30px;border-radius:5px;padding-left:5px;padding-right:5px;border-bottom-right-radius:0;border-bottom-left-radius:0;font-weight:bold;cursor:pointer",".je-block-link":"display:block",".je-media":"width:100%25"};class Xe{constructor(t,e={}){if(!(t instanceof Element))throw new Error("element should be an instance of Element");this.element=t,this.options=$t({},Xe.defaults.options,e),this.ready=!1,this.copyClipboard=null,this.schema=this.options.schema,this.template=this.options.template,this.translate=this.options.translate||Xe.defaults.translate,this.translateProperty=this.options.translateProperty||Xe.defaults.translateProperty,this.uuid=0,this.__data={};const i=this.options.theme||Xe.defaults.theme,r=Xe.defaults.themes[i];if(!r)throw new Error(`Unknown theme ${i}`);this.element.setAttribute("data-theme",i),this.element.classList.add("je-not-loaded"),this.element.classList.remove("je-ready"),this.theme=new r(this);const n=$t(dgt,this.getEditorsRules()),o=(l,h,c)=>c?this.addNewStyleRulesToShadowRoot(l,h,c):this.addNewStyleRules(l,h);if(!this.theme.options.disable_theme_rules){const l=KD(this.element);o("default",n,l),typeof r.rules<"u"&&o(i,r.rules,l)}const a=Xe.defaults.iconlibs[this.options.iconlib||Xe.defaults.iconlib];a&&(this.iconlib=new a),this.root_container=this.theme.getContainer(),this.element.appendChild(this.root_container),this.promise=this.load()}async load(){const t=document.location.origin+document.location.pathname.toString(),e=new _pt(this.options);e.onSchemaLoaded=a=>{this.trigger("schemaLoaded",a)},e.onAllSchemasLoaded=()=>{this.trigger("allSchemasLoaded")},this.expandSchema=a=>e.expandSchema(a),this.expandRefs=(a,l)=>e.expandRefs(a,l);const i=document.location.toString(),r=await e.load(this.schema,t,i),n=this.options.custom_validators?{custom_validators:this.options.custom_validators}:{};this.validator=new i$(this,null,n,Xe.defaults);const o=this.getEditorClass(r);this.root=this.createEditor(o,{jsoneditor:this,schema:r,required:!0,container:this.root_container}),this.root.preBuild(),this.root.build(),this.root.postBuild(),Wr(this.options,"startval")&&this.root.setValue(this.options.startval),this.validation_results=this.validator.validate(this.root.getValue()),this.root.showValidationErrors(this.validation_results),this.ready=!0,this.element.classList.remove("je-not-loaded"),this.element.classList.add("je-ready"),window.requestAnimationFrame(()=>{this.ready&&(this.validation_results=this.validator.validate(this.root.getValue()),this.root.showValidationErrors(this.validation_results),this.trigger("ready"),this.trigger("change"))})}getValue(){if(!this.ready)throw new Error("JSON Editor not ready yet. Make sure the load method is complete");return this.root.getValue()}setValue(t){if(!this.ready)throw new Error("JSON Editor not ready yet. Make sure the load method is complete");return this.root.setValue(t),this}validate(t){if(!this.ready)throw new Error("JSON Editor not ready yet. Make sure the load method is complete");return arguments.length===1?this.validator.validate(t):this.validation_results}destroy(){this.destroyed||this.ready&&(this.schema=null,this.options=null,this.root.destroy(),this.root=null,this.root_container=null,this.validator=null,this.validation_results=null,this.theme=null,this.iconlib=null,this.template=null,this.__data=null,this.ready=!1,this.element.innerHTML="",this.element.removeAttribute("data-theme"),this.destroyed=!0)}on(t,e){return this.callbacks=this.callbacks||{},this.callbacks[t]=this.callbacks[t]||[],this.callbacks[t].push(e),this}off(t,e){if(t&&e){this.callbacks=this.callbacks||{},this.callbacks[t]=this.callbacks[t]||[];const i=[];for(let r=0;r<this.callbacks[t].length;r++)this.callbacks[t][r]!==e&&i.push(this.callbacks[t][r]);this.callbacks[t]=i}else t?(this.callbacks=this.callbacks||{},this.callbacks[t]=[]):this.callbacks={};return this}trigger(t,e){if(this.callbacks&&this.callbacks[t]&&this.callbacks[t].length)for(let i=0;i<this.callbacks[t].length;i++)this.callbacks[t][i].apply(this,[e]);return this}setOption(t,e){if(t==="show_errors")this.options.show_errors=e,this.onChange();else throw new Error(`Option ${t} must be set during instantiation and cannot be changed later`);return this}getEditorsRules(){const t=(e,i)=>i.rules?$t(e,i.rules):e;return Object.values(Xe.defaults.editors).reduce(t,{})}getEditorClass(t){let e;if(t=this.expandSchema(t),Xe.defaults.resolvers.find(i=>(e=i(t,this),e&&Xe.defaults.editors[e])),!e)throw new Error(`Unknown editor for schema ${JSON.stringify(t)}`);if(!Xe.defaults.editors[e])throw new Error(`Unknown editor ${e}`);return Xe.defaults.editors[e]}createEditor(t,e,i=1){return e=$t({},t.options||{},e),new t(e,Xe.defaults,i)}onChange(){if(this.ready&&!this.firing_change)return this.firing_change=!0,window.requestAnimationFrame(()=>{this.firing_change=!1,this.ready&&(this.validation_results=this.validator.validate(this.root.getValue()),this.options.show_errors!=="never"?this.root.showValidationErrors(this.validation_results):this.root.showValidationErrors([]),this.trigger("change"))}),this}compileTemplate(t,e=Xe.defaults.template){let i;if(typeof e=="string"){if(!Xe.defaults.templates[e])throw new Error(`Unknown template engine ${e}`);if(i=Xe.defaults.templates[e](),!i)throw new Error(`Template engine ${e} missing required library.`)}else i=e;if(!i)throw new Error("No template engine set");if(!i.compile)throw new Error("Invalid template engine set");return i.compile(t)}_data(t,e,i){if(arguments.length===3){let r;t.hasAttribute(`data-jsoneditor-${e}`)?r=t.getAttribute(`data-jsoneditor-${e}`):(r=this.uuid++,t.setAttribute(`data-jsoneditor-${e}`,r)),this.__data[r]=i}else return t.hasAttribute(`data-jsoneditor-${e}`)?this.__data[t.getAttribute(`data-jsoneditor-${e}`)]:null}registerEditor(t){return this.editors=this.editors||{},this.editors[t.path]=t,this}unregisterEditor(t){return this.editors=this.editors||{},this.editors[t.path]=null,this}getEditor(t){if(this.editors)return this.editors[t]}watch(t,e){return this.watchlist=this.watchlist||{},this.watchlist[t]=this.watchlist[t]||[],this.watchlist[t].push(e),this}unwatch(t,e){if(!this.watchlist||!this.watchlist[t])return this;if(!e)return this.watchlist[t]=null,this;const i=[];for(let r=0;r<this.watchlist[t].length;r++)this.watchlist[t][r]!==e&&i.push(this.watchlist[t][r]);return this.watchlist[t]=i.length?i:null,this}notifyWatchers(t){if(!this.watchlist||!this.watchlist[t])return this;for(let e=0;e<this.watchlist[t].length;e++)this.watchlist[t][e]()}isEnabled(){return!this.root||this.root.isEnabled()}enable(){this.root.enable()}disable(){this.root.disable()}setCopyClipboardContents(t){this.copyClipboard=t}getCopyClipboardContents(){return this.copyClipboard}addNewStyleRules(t,e){let i=document.querySelector(`#theme-${t}`);i||(i=document.createElement("style"),i.setAttribute("id",`theme-${t}`),i.appendChild(document.createTextNode("")),document.head.appendChild(i));const r=i.sheet?i.sheet:i.styleSheet,n=this.element.nodeName.toLowerCase();for(;r.cssRules.length>0;)r.deleteRule(0);Object.keys(e).forEach(o=>{const a=t==="default"?o:`${n}[data-theme="${t}"] ${o}`;r.insertRule?r.insertRule(a+" {"+decodeURIComponent(e[o])+"}",0):r.addRule&&r.addRule(a,decodeURIComponent(e[o]),0)})}addNewStyleRulesToShadowRoot(t,e,i){const r=this.element.nodeName.toLowerCase();let n="";Object.keys(e).forEach(a=>{const l=t==="default"?a:`${r}[data-theme="${t}"] ${a}`;n+=l+" {"+decodeURIComponent(e[a])+`}
`});const o=new CSSStyleSheet;o.replaceSync(n),i.adoptedStyleSheets=[...i.adoptedStyleSheets,o]}}Xe.defaults=rh;Xe.AbstractEditor=Ks;Xe.AbstractTheme=ka;Xe.AbstractIconLib=Fa;Object.assign(Xe.defaults.themes,ugt);Object.assign(Xe.defaults.editors,l_);Object.assign(Xe.defaults.templates,Rpt);Object.assign(Xe.defaults.iconlibs,Qpt);/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Hm=globalThis,_2=Hm.ShadowRoot&&(Hm.ShadyCSS===void 0||Hm.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,g$=Symbol(),ZM=new WeakMap;let pgt=class{constructor(s,t,e){if(this._$cssResult$=!0,e!==g$)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=s,this.t=t}get styleSheet(){let s=this.o;const t=this.t;if(_2&&s===void 0){const e=t!==void 0&&t.length===1;e&&(s=ZM.get(t)),s===void 0&&((this.o=s=new CSSStyleSheet).replaceSync(this.cssText),e&&ZM.set(t,s))}return s}toString(){return this.cssText}};const ggt=s=>new pgt(typeof s=="string"?s:s+"",void 0,g$),fgt=(s,t)=>{if(_2)s.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const e of t){const i=document.createElement("style"),r=Hm.litNonce;r!==void 0&&i.setAttribute("nonce",r),i.textContent=e.cssText,s.appendChild(i)}},KM=_2?s=>s:s=>s instanceof CSSStyleSheet?(t=>{let e="";for(const i of t.cssRules)e+=i.cssText;return ggt(e)})(s):s;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:mgt,defineProperty:_gt,getOwnPropertyDescriptor:ygt,getOwnPropertyNames:xgt,getOwnPropertySymbols:vgt,getPrototypeOf:bgt}=Object,Ku=globalThis,JM=Ku.trustedTypes,wgt=JM?JM.emptyScript:"",QM=Ku.reactiveElementPolyfillSupport,Ap=(s,t)=>s,Ob={toAttribute(s,t){switch(t){case Boolean:s=s?wgt:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,t){let e=s;switch(t){case Boolean:e=s!==null;break;case Number:e=s===null?null:Number(s);break;case Object:case Array:try{e=JSON.parse(s)}catch{e=null}}return e}},f$=(s,t)=>!mgt(s,t),tI={attribute:!0,type:String,converter:Ob,reflect:!1,hasChanged:f$};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Ku.litPropertyMetadata??(Ku.litPropertyMetadata=new WeakMap);class Pc extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??(this.l=[])).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=tI){if(e.state&&(e.attribute=!1),this._$Ei(),this.elementProperties.set(t,e),!e.noAccessor){const i=Symbol(),r=this.getPropertyDescriptor(t,i,e);r!==void 0&&_gt(this.prototype,t,r)}}static getPropertyDescriptor(t,e,i){const{get:r,set:n}=ygt(this.prototype,t)??{get(){return this[e]},set(o){this[e]=o}};return{get(){return r==null?void 0:r.call(this)},set(o){const a=r==null?void 0:r.call(this);n.call(this,o),this.requestUpdate(t,a,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??tI}static _$Ei(){if(this.hasOwnProperty(Ap("elementProperties")))return;const t=bgt(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(Ap("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Ap("properties"))){const e=this.properties,i=[...xgt(e),...vgt(e)];for(const r of i)this.createProperty(r,e[r])}const t=this[Symbol.metadata];if(t!==null){const e=litPropertyMetadata.get(t);if(e!==void 0)for(const[i,r]of e)this.elementProperties.set(i,r)}this._$Eh=new Map;for(const[e,i]of this.elementProperties){const r=this._$Eu(e,i);r!==void 0&&this._$Eh.set(r,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const r of i)e.unshift(KM(r))}else t!==void 0&&e.push(KM(t));return e}static _$Eu(t,e){const i=e.attribute;return i===!1?void 0:typeof i=="string"?i:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var t;this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),(t=this.constructor.l)==null||t.forEach(e=>e(this))}addController(t){var e;(this._$EO??(this._$EO=new Set)).add(t),this.renderRoot!==void 0&&this.isConnected&&((e=t.hostConnected)==null||e.call(t))}removeController(t){var e;(e=this._$EO)==null||e.delete(t)}_$E_(){const t=new Map,e=this.constructor.elementProperties;for(const i of e.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return fgt(t,this.constructor.elementStyles),t}connectedCallback(){var t;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$EO)==null||t.forEach(e=>{var i;return(i=e.hostConnected)==null?void 0:i.call(e)})}enableUpdating(t){}disconnectedCallback(){var t;(t=this._$EO)==null||t.forEach(e=>{var i;return(i=e.hostDisconnected)==null?void 0:i.call(e)})}attributeChangedCallback(t,e,i){this._$AK(t,i)}_$EC(t,e){var i;const r=this.constructor.elementProperties.get(t),n=this.constructor._$Eu(t,r);if(n!==void 0&&r.reflect===!0){const o=(((i=r.converter)==null?void 0:i.toAttribute)!==void 0?r.converter:Ob).toAttribute(e,r.type);this._$Em=t,o==null?this.removeAttribute(n):this.setAttribute(n,o),this._$Em=null}}_$AK(t,e){var i;const r=this.constructor,n=r._$Eh.get(t);if(n!==void 0&&this._$Em!==n){const o=r.getPropertyOptions(n),a=typeof o.converter=="function"?{fromAttribute:o.converter}:((i=o.converter)==null?void 0:i.fromAttribute)!==void 0?o.converter:Ob;this._$Em=n,this[n]=a.fromAttribute(e,o.type),this._$Em=null}}requestUpdate(t,e,i){if(t!==void 0){if(i??(i=this.constructor.getPropertyOptions(t)),!(i.hasChanged??f$)(this[t],e))return;this.P(t,e,i)}this.isUpdatePending===!1&&(this._$ES=this._$ET())}P(t,e,i){this._$AL.has(t)||this._$AL.set(t,e),i.reflect===!0&&this._$Em!==t&&(this._$Ej??(this._$Ej=new Set)).add(t)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[n,o]of this._$Ep)this[n]=o;this._$Ep=void 0}const r=this.constructor.elementProperties;if(r.size>0)for(const[n,o]of r)o.wrapped!==!0||this._$AL.has(n)||this[n]===void 0||this.P(n,this[n],o)}let e=!1;const i=this._$AL;try{e=this.shouldUpdate(i),e?(this.willUpdate(i),(t=this._$EO)==null||t.forEach(r=>{var n;return(n=r.hostUpdate)==null?void 0:n.call(r)}),this.update(i)):this._$EU()}catch(r){throw e=!1,this._$EU(),r}e&&this._$AE(i)}willUpdate(t){}_$AE(t){var e;(e=this._$EO)==null||e.forEach(i=>{var r;return(r=i.hostUpdated)==null?void 0:r.call(i)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Ej&&(this._$Ej=this._$Ej.forEach(e=>this._$EC(e,this[e]))),this._$EU()}updated(t){}firstUpdated(t){}}Pc.elementStyles=[],Pc.shadowRootOptions={mode:"open"},Pc[Ap("elementProperties")]=new Map,Pc[Ap("finalized")]=new Map,QM==null||QM({ReactiveElement:Pc}),(Ku.reactiveElementVersions??(Ku.reactiveElementVersions=[])).push("2.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const h_=globalThis,c_=h_.trustedTypes,eI=c_?c_.createPolicy("lit-html",{createHTML:s=>s}):void 0,m$="$lit$",sl=`lit$${(Math.random()+"").slice(9)}$`,_$="?"+sl,Egt=`<${_$}>`,Dh=document,Mg=()=>Dh.createComment(""),Ig=s=>s===null||typeof s!="object"&&typeof s!="function",y$=Array.isArray,Sgt=s=>y$(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",Gx=`[ 	
\f\r]`,qd=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,iI=/-->/g,sI=/>/g,Ql=RegExp(`>|${Gx}(?:([^\\s"'>=/]+)(${Gx}*=${Gx}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),rI=/'/g,nI=/"/g,x$=/^(?:script|style|textarea|title)$/i,Cgt=s=>(t,...e)=>({_$litType$:s,strings:t,values:e}),Tgt=Cgt(1),Ju=Symbol.for("lit-noChange"),ys=Symbol.for("lit-nothing"),oI=new WeakMap,_h=Dh.createTreeWalker(Dh,129);function v$(s,t){if(!Array.isArray(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return eI!==void 0?eI.createHTML(t):t}const Rgt=(s,t)=>{const e=s.length-1,i=[];let r,n=t===2?"<svg>":"",o=qd;for(let a=0;a<e;a++){const l=s[a];let h,c,u=-1,d=0;for(;d<l.length&&(o.lastIndex=d,c=o.exec(l),c!==null);)d=o.lastIndex,o===qd?c[1]==="!--"?o=iI:c[1]!==void 0?o=sI:c[2]!==void 0?(x$.test(c[2])&&(r=RegExp("</"+c[2],"g")),o=Ql):c[3]!==void 0&&(o=Ql):o===Ql?c[0]===">"?(o=r??qd,u=-1):c[1]===void 0?u=-2:(u=o.lastIndex-c[2].length,h=c[1],o=c[3]===void 0?Ql:c[3]==='"'?nI:rI):o===nI||o===rI?o=Ql:o===iI||o===sI?o=qd:(o=Ql,r=void 0);const p=o===Ql&&s[a+1].startsWith("/>")?" ":"";n+=o===qd?l+Egt:u>=0?(i.push(h),l.slice(0,u)+m$+l.slice(u)+sl+p):l+sl+(u===-2?a:p)}return[v$(s,n+(s[e]||"<?>")+(t===2?"</svg>":"")),i]};class Ag{constructor({strings:t,_$litType$:e},i){let r;this.parts=[];let n=0,o=0;const a=t.length-1,l=this.parts,[h,c]=Rgt(t,e);if(this.el=Ag.createElement(h,i),_h.currentNode=this.el.content,e===2){const u=this.el.content.firstChild;u.replaceWith(...u.childNodes)}for(;(r=_h.nextNode())!==null&&l.length<a;){if(r.nodeType===1){if(r.hasAttributes())for(const u of r.getAttributeNames())if(u.endsWith(m$)){const d=c[o++],p=r.getAttribute(u).split(sl),g=/([.?@])?(.*)/.exec(d);l.push({type:1,index:n,name:g[2],strings:p,ctor:g[1]==="."?Igt:g[1]==="?"?Agt:g[1]==="@"?Lgt:Xy}),r.removeAttribute(u)}else u.startsWith(sl)&&(l.push({type:6,index:n}),r.removeAttribute(u));if(x$.test(r.tagName)){const u=r.textContent.split(sl),d=u.length-1;if(d>0){r.textContent=c_?c_.emptyScript:"";for(let p=0;p<d;p++)r.append(u[p],Mg()),_h.nextNode(),l.push({type:2,index:++n});r.append(u[d],Mg())}}}else if(r.nodeType===8)if(r.data===_$)l.push({type:2,index:n});else{let u=-1;for(;(u=r.data.indexOf(sl,u+1))!==-1;)l.push({type:7,index:n}),u+=sl.length-1}n++}}static createElement(t,e){const i=Dh.createElement("template");return i.innerHTML=t,i}}function Qu(s,t,e=s,i){var r,n;if(t===Ju)return t;let o=i!==void 0?(r=e._$Co)==null?void 0:r[i]:e._$Cl;const a=Ig(t)?void 0:t._$litDirective$;return(o==null?void 0:o.constructor)!==a&&((n=o==null?void 0:o._$AO)==null||n.call(o,!1),a===void 0?o=void 0:(o=new a(s),o._$AT(s,e,i)),i!==void 0?(e._$Co??(e._$Co=[]))[i]=o:e._$Cl=o),o!==void 0&&(t=Qu(s,o._$AS(s,t.values),o,i)),t}class Mgt{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:i}=this._$AD,r=((t==null?void 0:t.creationScope)??Dh).importNode(e,!0);_h.currentNode=r;let n=_h.nextNode(),o=0,a=0,l=i[0];for(;l!==void 0;){if(o===l.index){let h;l.type===2?h=new Mf(n,n.nextSibling,this,t):l.type===1?h=new l.ctor(n,l.name,l.strings,this,t):l.type===6&&(h=new Pgt(n,this,t)),this._$AV.push(h),l=i[++a]}o!==(l==null?void 0:l.index)&&(n=_h.nextNode(),o++)}return _h.currentNode=Dh,r}p(t){let e=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(t,i,e),e+=i.strings.length-2):i._$AI(t[e])),e++}}class Mf{get _$AU(){var t;return((t=this._$AM)==null?void 0:t._$AU)??this._$Cv}constructor(t,e,i,r){this.type=2,this._$AH=ys,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=r,this._$Cv=(r==null?void 0:r.isConnected)??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=Qu(this,t,e),Ig(t)?t===ys||t==null||t===""?(this._$AH!==ys&&this._$AR(),this._$AH=ys):t!==this._$AH&&t!==Ju&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):Sgt(t)?this.k(t):this._(t)}S(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.S(t))}_(t){this._$AH!==ys&&Ig(this._$AH)?this._$AA.nextSibling.data=t:this.T(Dh.createTextNode(t)),this._$AH=t}$(t){var e;const{values:i,_$litType$:r}=t,n=typeof r=="number"?this._$AC(t):(r.el===void 0&&(r.el=Ag.createElement(v$(r.h,r.h[0]),this.options)),r);if(((e=this._$AH)==null?void 0:e._$AD)===n)this._$AH.p(i);else{const o=new Mgt(n,this),a=o.u(this.options);o.p(i),this.T(a),this._$AH=o}}_$AC(t){let e=oI.get(t.strings);return e===void 0&&oI.set(t.strings,e=new Ag(t)),e}k(t){y$(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let i,r=0;for(const n of t)r===e.length?e.push(i=new Mf(this.S(Mg()),this.S(Mg()),this,this.options)):i=e[r],i._$AI(n),r++;r<e.length&&(this._$AR(i&&i._$AB.nextSibling,r),e.length=r)}_$AR(t=this._$AA.nextSibling,e){var i;for((i=this._$AP)==null?void 0:i.call(this,!1,!0,e);t&&t!==this._$AB;){const r=t.nextSibling;t.remove(),t=r}}setConnected(t){var e;this._$AM===void 0&&(this._$Cv=t,(e=this._$AP)==null||e.call(this,t))}}class Xy{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,i,r,n){this.type=1,this._$AH=ys,this._$AN=void 0,this.element=t,this.name=e,this._$AM=r,this.options=n,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=ys}_$AI(t,e=this,i,r){const n=this.strings;let o=!1;if(n===void 0)t=Qu(this,t,e,0),o=!Ig(t)||t!==this._$AH&&t!==Ju,o&&(this._$AH=t);else{const a=t;let l,h;for(t=n[0],l=0;l<n.length-1;l++)h=Qu(this,a[i+l],e,l),h===Ju&&(h=this._$AH[l]),o||(o=!Ig(h)||h!==this._$AH[l]),h===ys?t=ys:t!==ys&&(t+=(h??"")+n[l+1]),this._$AH[l]=h}o&&!r&&this.j(t)}j(t){t===ys?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class Igt extends Xy{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===ys?void 0:t}}class Agt extends Xy{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==ys)}}class Lgt extends Xy{constructor(t,e,i,r,n){super(t,e,i,r,n),this.type=5}_$AI(t,e=this){if((t=Qu(this,t,e,0)??ys)===Ju)return;const i=this._$AH,r=t===ys&&i!==ys||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,n=t!==ys&&(i===ys||r);r&&this.element.removeEventListener(this.name,this,i),n&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e;typeof this._$AH=="function"?this._$AH.call(((e=this.options)==null?void 0:e.host)??this.element,t):this._$AH.handleEvent(t)}}class Pgt{constructor(t,e,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){Qu(this,t)}}const aI=h_.litHtmlPolyfillSupport;aI==null||aI(Ag,Mf),(h_.litHtmlVersions??(h_.litHtmlVersions=[])).push("3.1.2");const Ogt=(s,t,e)=>{const i=(e==null?void 0:e.renderBefore)??t;let r=i._$litPart$;if(r===void 0){const n=(e==null?void 0:e.renderBefore)??null;i._$litPart$=r=new Mf(t.insertBefore(Mg(),n),n,void 0,e??{})}return r._$AI(s),r};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class Lp extends Pc{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t;const e=super.createRenderRoot();return(t=this.renderOptions).renderBefore??(t.renderBefore=e.firstChild),e}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=Ogt(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),(t=this._$Do)==null||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),(t=this._$Do)==null||t.setConnected(!1)}render(){return Ju}}var lI;Lp._$litElement$=!0,Lp.finalized=!0,(lI=globalThis.litElementHydrateSupport)==null||lI.call(globalThis,{LitElement:Lp});const hI=globalThis.litElementPolyfillSupport;hI==null||hI({LitElement:Lp});(globalThis.litElementVersions??(globalThis.litElementVersions=[])).push("4.0.4");const Fgt=`
  * {
    font-family: Roboto, sans-serif;
  }
`,kgt=`
input[type=checkbox] {
  appearance: none;
  -webkit-appearance: none;
  margin: 0;
  cursor: pointer;
  display: flex;
  flex-direction: row;
  align-items: center;
  width: 24px;
  height: 24px;
}
input[type=checkbox]:after {
  display: block;
  content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Echeckbox-blank-outline%3C/title%3E%3Cpath d='M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,5V19H5V5H19Z' /%3E%3C/svg%3E");
  width: 20px;
  height: 20px;
  margin-right: 4px;
}
input[type=checkbox]:checked:after {
  content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Echeckbox-marked%3C/title%3E%3Cpath d='M10,17L5,12L6.41,10.58L10,14.17L17.59,6.58L19,8M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z' /%3E%3C/svg%3E");

}
`,Ngt=`
input[type=radio] {
  appearance: none;
  -webkit-appearance: none;
  margin: 0;
  cursor: pointer;
  display: flex;
  flex-direction: row;
  align-items: center;
  width: 24px;
  height: 24px;
}

label span {
  font-size: small;
}

input[type=radio]:after {
  display: block;
  content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Eradiobox-blank%3C/title%3E%3Cpath d='M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z' /%3E%3C/svg%3E");
  width: 20px;
  height: 20px;
  margin-right: 4px;
}
input[type=radio]:checked:after {
  content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Eradiobox-marked%3C/title%3E%3Cpath d='M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7Z' /%3E%3C/svg%3E");

}
`,Dgt=`
input[type="range"] {
  -webkit-appearance: none;
  width: 90%;
  margin-left: 5%;
  height: 6px;
  border-radius: 5px;
  background: #d7dcdf;
  outline: none;
  padding: 0;
}
input[type="range"]::-webkit-slider-thumb {
  appearance: none;
  width: 15px;
  height: 15px;
  border-radius: 50%;
  background: #2c3e50;
  cursor: pointer;
  transition: background 0.15s ease-in-out;
}
.range-slider {
  margin: 60px 0 0 0;
}
.range-slider {
  width: 100%;
}
input[type="range"]::-webkit-slider-thumb:hover {
  background: #00416F;
}
input[type="range"]:active::-webkit-slider-thumb {
  background: #00416F;
}
input[type="range"]::-moz-range-thumb {
  width: 15px;
  height: 15px;
  border: 0;
  border-radius: 50%;
  background: #2c3e50;
  cursor: pointer;
  transition: background 0.15s ease-in-out;
}
input[type="range"]::-moz-range-thumb:hover {
  background: #00416F;
}
input[type="range"]:active::-moz-range-thumb {
  background: #00416F;
}
input[type="range"]:focus::-webkit-slider-thumb {
  box-shadow: 0 0 0 3px #fff0, 0 0 0 6px #00416F00;
}
.range-slider__value {
  display: inline-block;
  position: relative;
  width: 60px;
  color: #fff;
  line-height: 20px;
  text-align: center;
  border-radius: 3px;
  background: #2c3e50;
  padding: 5px 10px;
  margin-left: 8px;
}
.range-slider__value:after {
  position: absolute;
  top: 8px;
  left: -7px;
  width: 0;
  height: 0;
  border-top: 7px solid transparent;
  border-right: 7px solid #2c3e50;
  border-bottom: 7px solid transparent;
  content: '';
}

input::-moz-focus-inner, input::-moz-focus-outer {
  border: 0;
}
`,$gt=`
  ${kgt}
  ${Ngt}
  ${Dgt}

  [data-schemaid=root] > .je-header {
    display: none;
  }
  input[type="text"], select {
    box-sizing: border-box !important;
    width: 100% !important;
    margin: 0.5rem 0rem !important;
    padding: 5px 7px !important;
    border-radius: 4px !important;
    border: 1px solid #0004 !important;
  }
  .je-range-control {
    padding: 0.5rem 0;
  }
  .errmsg {
    font-size: x-small;
  }
  tc-range-slider{
    display: block;
    margin: 0.5rem 0;
  }
`;(()=>{var s=n=>n==null?!1:typeof n=="boolean"?n:n.trim().toLowerCase()==="true";window.tcRangeSliderPlugins=window.tcRangeSliderPlugins||[];var t="min-label",e="max-label",i="#1E293B",r=()=>{let n=null,o=null,a=null,l,h=!1,c=i,u="",d,p=null,g=null,f=null,m=[],_=()=>{var A;let O=(A=n==null?void 0:n.shadowRoot)==null?void 0:A.querySelector(".range-slider-box");p=document.createElement("div"),p.classList.add("labels-row"),O.prepend(p)},y=A=>{let O=document.createElement("label");return O.className=A,O.setAttribute("for","range-slider"),O},v=()=>{g=y(t),g.textContent=M(a==null?void 0:a.getTextMin(),u),f=y(e),f.textContent=M(a==null?void 0:a.getTextMax(),u),o==null||o.before(g),o==null||o.after(f);let A=a==null?void 0:a.getValues();if(A)for(let O=0;O<A.length;O++){let N=y(`value${O+1}-label generated-label`);N.textContent=M(A[O],u),m.push(N),p==null||p.append(N)}},b=()=>{for(let A of m)!A||A.remove();g==null||g.remove(),f==null||f.remove(),p==null||p.remove(),m=[]},E=A=>{h=A,h?(_(),v()):b()},S=A=>{c=A;for(let O of m)!O||(O.style.color=c??i);g&&(g.style.color=c??i),f&&(f.style.color=c??i)},T=A=>{u=A,l&&l()},R=()=>{!a||!p||p.classList.toggle("is-reversed",a.isRightToLeft()||a.isBottomToTop())},M=(A,O)=>{let N=`${(A??"").toString()}${O}`;return d&&typeof d=="function"?d(A):N};return{get name(){return"Generated Labels"},init:(A,O,N,x)=>{var w,C,I;n=A,a=x,o=(w=A.shadowRoot)==null?void 0:w.getElementById("range-slider"),l=O,c=(C=n.getAttribute("generate-labels-text-color"))!=null?C:i,u=(I=n.getAttribute("generate-labels-units"))!=null?I:"",E(s(n.getAttribute("generate-labels"))),R(),S(c)},update:A=>{if(!(!h||!A.values)){R();for(let O=0;O<A.values.length;O++){let N=A.values[O],x=m[O];if(N===void 0&&x){x.remove(),m[O]=void 0;continue}if(N!==void 0&&!x){let w=y(`value${O+1}-label generated-label`);if(w.textContent=M(N,u),m[O]=w,A.values.length<=0)p==null||p.append(w);else if(O===0)p==null||p.append(w);else{let C=m[O-1];C==null||C.after(w)}continue}!x||(x.textContent=M(N,u))}g&&(g.textContent=M(A.textMin,u)),f&&(f.textContent=M(A.textMax,u)),S(c)}},onAttrChange:(A,O)=>{A==="generate-labels"&&E(s(O)),A==="generate-labels-text-color"&&S(O),A==="generate-labels-units"&&T(O)},gettersAndSetters:[{name:"generateLabels",attributes:{get(){return h??!1},set:A=>{E(s(A))}}},{name:"textColor",attributes:{get(){return c??""},set:A=>{S(A)}}},{name:"generateLabelsTextColor",attributes:{get(){return c??""},set:A=>{S(A)}}},{name:"units",attributes:{get(){return u??""},set:A=>{T(A)}}},{name:"generateLabelsUnits",attributes:{get(){return u??""},set:A=>{T(A)}}},{name:"generateLabelsFormat",attributes:{get(){return d},set:A=>{d=A,l&&l()}}}],css:`
    .labels-row{
      text-align: center;
      display: flex;
      justify-content: center;
    }
    
    .is-reversed,
    .is-reversed + .row{
      flex-direction: row-reverse;
    }
    
    .type-vertical{
      position: relative;
    }
    
    .type-vertical .labels-row{
      flex-direction: column;
      position: absolute;
      top: 50%;
      right: -100%;
      transform: translateY(-50%);
    }
    
    .type-vertical .is-reversed,
    .type-vertical .is-reversed + .row{
      flex-direction: column-reverse;
    }
    
    .max-label,
    .min-label{
      margin: 0 1rem;
      width: 2rem;
      text-align: center;
      white-space: nowrap;
    }
    
    .generated-label{
      text-align: center;
      margin: 0 0.5rem;
      white-space: nowrap;
    }
    `,destroy:b}};window.tcRangeSliderPlugins.push(r)})();(()=>{var s=Object.defineProperty,t=Math.pow,e=(P,G,K)=>G in P?s(P,G,{enumerable:!0,configurable:!0,writable:!0,value:K}):P[G]=K,i=(P,G,K)=>(e(P,typeof G!="symbol"?G+"":G,K),K),r=(P,G)=>` ${G&&G.length>0?G.map(K=>`<link rel="stylesheet" href="${K}" />`).join(""):""} <style> ${P} </style> <div class="range-slider-box"> <div class="row"> <div id="range-slider" class="range-slider"> <div class="container"> <div class="panel"></div> <div class="panel-fill"></div> <div class="container"> <div class="pointer" tabindex="0" role="slider"> <div class="pointer-shape"></div> </div> </div> </div> </div> </div> </div>`,n=":host{--width:300px;--height:.25rem;--opacity:.4;--panel-bg:#cbd5e1;--panel-bg-hover:#94a3b8;--panel-bg-fill:#475569;--panel-bg-border-radius:1rem;--pointer-width:1rem;--pointer-height:1rem;--pointer-bg:#fff;--pointer-bg-hover:#dcdcdc;--pointer-bg-focus:#dcdcdc;--pointer-shadow:0 0 2px rgba(0,0,0,0.8);--pointer-shadow-hover:0 0 2px #000;--pointer-shadow-focus:var(--pointer-shadow-hover);--pointer-border:1px solid hsla(0,0%,88%,0.5);--pointer-border-hover:1px solid #94a3b8;--pointer-border-focus:var(--pointer-border-hover);--pointer-border-radius:100%;--animate-onclick:.3s}:host{max-width:100%}.range-slider-box{display:flex;position:relative;flex-direction:column}.range-slider{position:relative;width:var(--width,100%);height:var(--height,0.25rem);touch-action:none;max-width:100%;box-sizing:border-box;cursor:pointer}.row{width:100%;display:flex;align-items:center}.range-slider.disabled{opacity:var(--opacity,0.4);cursor:default}.pointer.disabled{-webkit-filter:brightness(0.8);filter:brightness(0.8);cursor:default}.range-slider *{box-sizing:border-box}.container{position:absolute;width:100%;height:100%}.panel{position:absolute;z-index:10;width:100%;height:100%;background:var(--panel-bg,#2d4373);border-radius:var(--panel-bg-border-radius,1rem);overflow:hidden;transition:.3s all ease}.panel-fill{background:var(--panel-bg-fill,#000);border-radius:var(--panel-bg-border-radius,1rem);overflow:hidden;height:100%;position:absolute;z-index:10}.panel:hover{background:var(--panel-bg-hover,#5f79b7)}.disabled .panel:hover{background:var(--panel-bg,#5f79b7)}.pointer{position:absolute;z-index:20;outline:0;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.pointer-shape{background:var(--pointer-bg,#fff);background-size:contain;box-shadow:var(--pointer-shadow);border:var(--pointer-border);border-radius:var(--pointer-border-radius,100%);-webkit-transform:translateX(-50%);transform:translateX(-50%);width:var(--pointer-width,15px);height:var(--pointer-height,15px);transition:.3s all ease}.pointer-shape:hover{background:var(--pointer-bg-hover,#fff);background-size:contain;border:var(--pointer-border-hover);box-shadow:var(--pointer-shadow-hover)}.disabled .pointer-shape:hover{background:var(--pointer-bg,#fff);background-size:contain;border:var(--pointer-border);box-shadow:var(--pointer-shadow)}.pointer:focus .pointer-shape{background:var(--pointer-bg-focus,#fff);background-size:contain;border:var(--pointer-border-focus);box-shadow:var(--pointer-shadow-focus)}.disabled .pointer:focus .pointer-shape{background:var(--pointer-bg,#fff);background-size:contain;border:var(--pointer-border);box-shadow:var(--pointer-shadow)}.type-vertical .range-slider{--width:.25rem;--height:300px;max-height:100%}.type-vertical .range-slider .pointer{left:50%}.type-vertical .range-slider .panel-fill{width:100%}.type-vertical.range-slider-box{flex-direction:row}.type-vertical .row{flex-direction:column}.animate-on-click .pointer,.animate-on-click .panel-fill{transition:all var(--animate-onclick)}.range-dragging .panel-fill{cursor:move}",o="pointers-overlap",a="pointers-min-distance",l="pointers-max-distance",h="range-dragging",c="data",u="min",d="max",p="step",g="round",f="type",m="theme",_="rtl",y="btt",v="disabled",b="keyboard-disabled",E="mousewheel-disabled",S="slider-width",T="slider-height",R="slider-radius",M="slider-bg",A="slider-bg-hover",O="slider-bg-fill",N="pointer-width",x="pointer-height",w="pointer-radius",C="pointer-bg",I="pointer-bg-hover",L="pointer-bg-focus",j="pointer-shadow",z="pointer-shadow-hover",B="pointer-shadow-focus",H="pointer-border",Y="pointer-border-hover",at="pointer-border-focus",k="animate-onclick",it="css-links",nt="vertical",ht="horizontal",Pt=(P,G,K,W,ut)=>{let qt=G-P;return qt===0?K:(W-K)*(ut-P)/qt+K},Ct=P=>!isNaN(parseFloat(P))&&isFinite(P),ft=(P,G)=>Ct(P)?Number(P):G,me=(P,G)=>G===0?0:Math.round(P/G)*G,pi=(P,G=1/0)=>{if(G===1/0)return P;let K=t(10,G);return Math.round(P*K)/K},he=P=>P==null?!1:typeof P=="boolean"?P:P.trim().toLowerCase()==="true",ts=(P,G)=>{P.dispatchEvent(new CustomEvent("onPointerClicked",{detail:{$pointer:G}}))},ve=(P,G)=>{P.dispatchEvent(new CustomEvent("onMouseDown",{detail:{nativeEvent:G}}))},ns=(P,G)=>{P.dispatchEvent(new CustomEvent("onMouseUp",{detail:{nativeEvent:G}}))},_n=(P,G)=>{P.dispatchEvent(new CustomEvent("onKeyDown",{detail:{nativeEvent:G}}))},Mo=(P,G)=>{if(!G||G.length<=0)return;let K=G.map(ut=>Ct(ut)?ft(ut,ut):ut),W={values:K||[]};W.value=K[0],W.value0=K[0],W.value1=K[0];for(let ut=1;ut<K.length;ut++)W[`value${ut+1}`]=K[ut];P.dispatchEvent(new CustomEvent("change",{detail:W}))},Lr=(P,G,K)=>{let W=0,ut,qt,ce,pt,mt=!1,_e=(Zt,di,gs,as,Hi,Wi)=>{let ur=W;gs!==void 0&&Zt>gs&&(Zt=gs),di!==void 0&&Zt<di&&(Zt=di),W=Zt;let dr=W;return(as===nt&&Wi||as===ht&&Hi)&&(dr=100-dr),as===nt?G.style.top=`${dr}%`:G.style.left=`${dr}%`,ur!==W},be=Zt=>Zt===G||G.contains(Zt),kt=(Zt,di,gs,as)=>{ut=Zt,qt=di,ce=gs,pt=as},He=Zt=>{mt=Zt,G.classList.toggle("disabled",mt),mt?G.setAttribute("aria-disabled","true"):G.hasAttribute("aria-disabled")&&G.removeAttribute("aria-disabled")},Kr=(Zt,di)=>{di==null?G.removeAttribute(Zt):G.setAttribute(Zt,di)},$s=Zt=>G.getAttribute(Zt),Yt=Zt=>{if(!mt){switch(Zt.key){case"ArrowLeft":{Zt.preventDefault(),typeof ut=="function"&&ut(K);break}case"ArrowRight":{Zt.preventDefault(),typeof qt=="function"&&qt(K);break}case"ArrowUp":{Zt.preventDefault(),typeof ce=="function"&&ce(K);break}case"ArrowDown":{Zt.preventDefault(),typeof pt=="function"&&pt(K);break}}_n(P,Zt)}},xe=()=>{mt||ts(P,G)};return G.className=`pointer pointer-${K}`,G.addEventListener("keydown",Yt),G.addEventListener("click",xe),{$pointer:G,get percent(){return W},get disabled(){return mt},set disabled(Zt){He(Zt)},updatePosition:_e,isClicked:be,setCallbacks:kt,setAttr:Kr,getAttr:$s,destroy:()=>{G.removeEventListener("keydown",Yt),G.removeEventListener("click",xe),G.remove()}}},yn=P=>{if(P==null)return;if(Array.isArray(P))return P;if(P.trim()==="")return;let G=P.split(","),K=[],W=!0;for(let ut=0;ut<G.length;ut++){let qt=G[ut].trim();qt!==""&&(K.push(qt),Ct(qt)||(W=!1))}return W?K.map(ut=>Number(ut)):K},Je=(P,G)=>G?G.findIndex(K=>K===P||K.toString().trim()===P.toString().trim()):-1,gi=P=>({updatePosition:(G,K,W,ut)=>{if(K.length<=0)return;let qt=K.length===1,ce=K[0],pt=K[K.length-1];G===nt?(P.style.removeProperty("width"),P.style.removeProperty("right"),P.style.removeProperty("left"),qt?P.style.height=`${ce}%`:P.style.height=`${Math.abs(ce-pt)}%`,ut?(P.style.bottom="0%",qt?P.style.top="auto":P.style.top=`${Math.min(100-pt,100-ce)}%`):(P.style.bottom="auto",qt?P.style.top="0%":P.style.top=`${Math.min(ce,pt)}%`)):(P.style.removeProperty("height"),P.style.removeProperty("top"),P.style.removeProperty("bottom"),qt?P.style.width=`${ce}%`:P.style.width=`${Math.abs(ce-pt)}%`,W?(P.style.right="0%",qt?P.style.left="auto":P.style.left=`${Math.min(100-pt,100-ce)}%`):(P.style.right="auto",qt?P.style.left="0%":P.style.left=`${Math.min(ce,pt)}%`))}}),bi="--animate-onclick",fi="--width",Js="--height",Qs="--panel-bg-border-radius",os="--panel-bg",Ui="--panel-bg-hover",Io="--panel-bg-fill",Re="--pointer-width",zl="--pointer-height",Ao="--pointer-border-radius",Td="--pointer-bg",Rd="--pointer-bg-hover",Bl="--pointer-bg-focus",Ul="--pointer-shadow",Lo="--pointer-shadow-hover",Vl="--pointer-shadow-focus",Po="--pointer-border",Pr="--pointer-border-hover",Or="--pointer-border-focus",Ds=(P,G,K)=>{let W=new Map;for(let ut of P.attributes){let qt=ut.nodeName.trim().toLowerCase();if(!G.test(qt))continue;let ce=qt.replace(/\D/g,"").trim(),pt=ce===""||ce==="0"||ce==="1"?0:ft(ce,0)-1,mt=K&&typeof K=="function"?K(ut.value):ut.value;W.set(pt,mt)}return W},Hl=P=>{if(!P)return null;let G=P.getAttribute(it);if(!G)return null;let K=G.split(";"),W=[];for(let ut of K)ut.trim()!==""&&W.push(ut.trim());return W},Da=[[fi,S,"sliderWidth",null],[Js,T,"sliderHeight",null],[Qs,R,"sliderRadius",null],[os,M,"sliderBg",null],[Ui,A,"sliderBgHover",null],[Io,O,"sliderBgFill",null],[Re,N,"pointer#Width",/^pointer([0-9]*)-width$/],[zl,x,"pointer#Height",/^pointer([0-9]*)-height$/],[Ao,w,"pointer#Radius",/^pointer([0-9]*)-radius$/],[Td,C,"pointer#Bg",/^pointer([0-9]*)-bg$/],[Rd,I,"pointer#BgHover",/^pointer([0-9]*)-bg-hover$/],[Bl,L,"pointer#BgFocus",/^pointer([0-9]*)-bg-focus$/],[Ul,j,"pointer#Shadow",/^pointer([0-9]*)-shadow$/],[Lo,z,"pointer#ShadowHover",/^pointer([0-9]*)-shadow-hover$/],[Vl,B,"pointer#ShadowFocus",/^pointer([0-9]*)-shadow-focus$/],[Po,H,"pointer#Border",/^pointer([0-9]*)-border$/],[Pr,Y,"pointer#BorderHover",/^pointer([0-9]*)-border-hover$/],[Or,at,"pointer#BorderFocus",/^pointer([0-9]*)-border-focus$/]],ni=(P,G,K)=>{let W=null,ut=[],qt=new Map,ce=(Yt,xe=G)=>{let Zt=[...xe.classList];for(let di of Zt)di.startsWith(Yt)&&G.classList.remove(di)},pt=()=>{ce("shape");let Yt=G.querySelectorAll(".pointer");for(let xe of Yt)ce("shape",xe)},mt=Yt=>{W=Yt,ce("theme-"),typeof Yt=="string"&&G.classList.add(`theme-${Yt}`)},_e=()=>{if(pt(),!(ut.length<=0)){G.classList.add("shape",`shape-${ut[0]}`);for(let Yt=1;Yt<ut.length;Yt++){let xe=ut[Yt];if(!xe)continue;let Zt=G.querySelector(`.pointer-${Yt}`);!Zt||Zt.classList.add("shape",`shape-${xe}`)}}},be=(Yt,xe)=>{ut[Yt]=xe,_e()},kt=()=>{pt();let Yt=Ds(P,/^pointer([0-9]*)-shape$/);if(!(Yt.size<=0)){for(let xe of Yt){let Zt=xe[0];ut[Zt]=xe[1]}_e()}},He=(Yt,xe)=>`${Yt}-${xe}`,Kr=(Yt,xe,Zt)=>{let di=K[Zt];if(!di)return;let gs=Zt===0?G:di.$pointer;if(xe==null){qt.has(He(Yt,Zt))&&qt.delete(He(Yt,Zt)),gs.style.removeProperty(Yt);return}qt.set(He(Yt,Zt),xe),gs.style.setProperty(Yt,xe)},$s=(Yt,xe)=>qt.get(He(Yt,xe));return(()=>{for(let Yt of Da){let[xe,Zt,di,gs]=Yt;if(gs){let Hi=Ds(P,gs);for(let Wi of Hi){let ur=Wi[0],dr=Wi[1];Kr(xe,dr,ur)}}else{let Hi=P.getAttribute(Zt);Kr(xe,Hi,0)}let as=[];if(di.indexOf("#")===-1)as.push([di,0]);else{as.push([di.replace("#",""),0]),as.push([di.replace("#","0"),0]),as.push([di.replace("#","1"),0]);for(let Hi=1;Hi<K.length;Hi++)as.push([di.replace("#",(Hi+1).toString()),Hi])}for(let Hi of as)try{let Wi=Hi[0],ur=Hi[1];Object.prototype.hasOwnProperty.call(P,Wi)||Object.defineProperty(P,Wi,{get(){return $s(xe,ur)},set:dr=>{Kr(xe,dr,ur)}})}catch(Wi){console.error(Wi)}}mt(P.getAttribute(m)),kt()})(),{setStyle:Kr,getStyle:$s,get theme(){return W},set theme(Yt){mt(Yt)},get pointerShapes(){return ut},setPointerShape:be}},ki="animate-on-click",ri="range-dragging",Ci=(P,G,K,W)=>{let ut=[],qt=be=>{for(let kt of ut)kt.update&&typeof kt.update=="function"&&kt.update(be)},ce=()=>{for(let be of ut)be.destroy&&typeof be.destroy=="function"&&be.destroy()},pt=(be,kt)=>{for(let He of ut)He.onAttrChange&&typeof He.onAttrChange=="function"&&He.onAttrChange(be,kt)},mt=be=>{if(be.gettersAndSetters){for(let kt of be.gettersAndSetters)if(!(!kt.name||!kt.attributes))try{Object.prototype.hasOwnProperty.call(P,kt.name)||Object.defineProperty(P,kt.name,kt.attributes)}catch(He){console.error("defineSettersGetters error:",He)}}},_e=be=>{var kt;if(!be.css)return;let He=(kt=P.shadowRoot)==null?void 0:kt.querySelector("style");!He||(He.innerHTML+=be.css)};return{init:()=>{if(window.tcRangeSliderPlugins)for(let be of window.tcRangeSliderPlugins){let kt=be();ut.push(kt),kt.init&&typeof kt.init=="function"&&(kt.init(P,G,K,W),mt(kt),_e(kt))}},update:qt,onAttrChange:pt,destroy:ce}},oi=10,Ni=20,Vi=(P,G)=>{let K=new Map,W=/^value([0-9]*)$/;for(let pt of P.attributes){let mt=pt.nodeName.trim().toLowerCase();if(!W.test(mt))continue;let _e=mt.replace("value","").trim(),be=_e===""||_e==="0"||_e==="1"?0:ft(_e,0)-1,kt=Ct(pt.value)?ft(pt.value,0):pt.value;K.set(be,kt)}let ut=Math.max(...Array.from(K.keys())),qt=[];qt.push([Lr(P,G,0),K.get(0)]);let ce=G;for(let pt=1;pt<=ut;pt++){let mt=G.cloneNode(!0);ce.after(mt),ce=mt,qt.push([Lr(P,mt,pt),K.get(pt)])}return qt},Bt=(P,G,K,W,ut,qt,ce)=>{try{Object.defineProperty(P,W,{configurable:!0,get(){if(!G)return;let pt=G.pointers[K];if(!pt)return;let mt=G.getTextValue(pt.percent);return Ct(mt)?ft(mt,mt):mt},set:pt=>{G.pointers[K]?G==null||G.setValue(pt,K):G==null||G.addPointer(pt)}}),Object.defineProperty(P,ut,{configurable:!0,get(){var pt,mt;return(mt=(pt=G==null?void 0:G.pointers[K])==null?void 0:pt.getAttr("aria-label"))!=null?mt:void 0},set:pt=>{!G||G.setAriaLabel(K,pt)}}),Object.defineProperty(P,qt,{configurable:!0,get(){var pt,mt;return(mt=(pt=G==null?void 0:G.styles)==null?void 0:pt.pointerShapes[K])!=null?mt:null},set:pt=>{!G||!G.styles||G.styles.setPointerShape(K,pt)}}),Object.defineProperty(P,ce,{configurable:!0,get(){var pt;return(pt=G==null?void 0:G.pointers[K].disabled)!=null?pt:!1},set:pt=>{if(!G)return;let mt=G==null?void 0:G.pointers[K];!mt||(mt.disabled=pt)}})}catch(pt){console.error(pt)}},Me=(P,G)=>{let K=[["value","ariaLabel","pointerShape","pointerDisabled",0],["value0","ariaLabel0","pointerShape0","pointer0Disabled",0],["value1","ariaLabel1","pointerShape1","pointer1Disabled",0]];for(let W=2;W<oi;W++)K.push([`value${W}`,`ariaLabel${W}`,`pointer${W}Shape`,`pointer${W}Disabled`,W-1]);for(let W of K)Bt(P,G,W[4],W[0],W[1],W[2],W[3])},Di=(P,G,K)=>{var W;let ut=(W=K.shadowRoot)==null?void 0:W.querySelector(".container");if(ut)for(let qt of P)G?ut.prepend(qt.$pointer):ut.append(qt.$pointer)},Md=(P,G)=>{if(!(!G||P.length<=1)){for(let K of P)K.$pointer.style.zIndex=Ni.toString();G.$pointer.style.zIndex=(Ni*2).toString()}},Ky=0,Id=100,Jh=2,R2="0.3s",p3=(P,G,K)=>{let W=K.map($=>$[0]),ut=null,qt=null,ce=null,pt=null,mt=Ky,_e=Id,be,kt,He=ht,Kr=Jh,$s=!1,Yt=!1,xe=!1,Zt=0,di=1/0,gs=!1,as,Hi,Wi=!1,ur=!1,dr=!1,$a=R2,M2=[],I2=$=>{Wi||($.preventDefault&&$.preventDefault(),Wl($),window.addEventListener("mousemove",Wl),window.addEventListener("mouseup",Lf),ve(P,$))},Lf=$=>{Wi||(as=void 0,Hi=void 0,window.removeEventListener("mousemove",Wl),window.removeEventListener("mouseup",Lf),$a&&G.classList.add(ki),ns(P,$))},m3=($,tt)=>{if(W.length<=0)return;if(W.length===1)return W[0].isClicked($)&&$a&&G.classList.remove(ki),W[0];let Tt=y3($);if(gs){let De=tt,xn=Of(De);xn!==void 0&&(De=me(De,xn)),Tt?(as=De,Hi=0,$a&&G.classList.remove(ki)):as!==void 0&&(Hi=De-as,as=De)}if(!_3($)&&!Tt){for(let De of W)if(!(!De.isClicked($)||De.disabled))return $a&&G.classList.remove(ki),De;for(let De of W)if(ut===De)return De}let Qe=1/0,Xi=null;for(let De of W){if(De.disabled)continue;let xn=Math.abs(tt-De.percent);xn<Qe&&(Qe=xn,Xi=De)}return Xi},A2=()=>W.findIndex($=>ut===$&&!$.disabled),Wl=$=>{let tt;if(He===nt){let{height:Qe,top:Xi}=G.getBoundingClientRect(),De=$.type.indexOf("mouse")!==-1?$.clientY:$.touches[0].clientY;tt=Math.min(Math.max(0,De-Xi),Qe)*100/Qe}else{let{width:Qe,left:Xi}=G.getBoundingClientRect(),De=$.type.indexOf("mouse")!==-1?$.clientX:$.touches[0].clientX;tt=Math.min(Math.max(0,De-Xi),Qe)*100/Qe}if(($s||Yt)&&(tt=100-tt),ut=m3($.target,tt),ut&&Md(W,ut),gs&&W.length>1&&Hi!==void 0){let Qe=W[0],Xi=W[W.length-1],De=Qe.percent+Hi<0,xn=Xi.percent+Hi>100;if(De||xn)return;for(let zf=0;zf<W.length;zf++)pr(zf,W[zf].percent+Hi);return}let Tt=A2();Tt!==-1&&(pr(Tt,tt),ut==null||ut.$pointer.focus())},Pf=$=>{if(Wi||document.activeElement!==P||ut!=null&&ut.disabled)return;$.stopPropagation(),$.preventDefault();let tt=$.deltaY<0,Tt=$s||Yt,Qe=tt?!Tt:Tt,Xi=A2();Xi!==-1&&(Qe?Ad(Xi,W[Xi].percent):Ld(Xi,W[Xi].percent))},L2=$=>{Wi||ur||(He===nt?Yt?pr($,100):pr($,0):$s?Ld($,W[$].percent):Ad($,W[$].percent))},P2=$=>{Wi||ur||(He===nt?Yt?pr($,0):pr($,100):$s?Ad($,W[$].percent):Ld($,W[$].percent))},O2=$=>{Wi||ur||(He===nt?Yt?Ld($,W[$].percent):Ad($,W[$].percent):$s?pr($,100):pr($,0))},F2=$=>{Wi||ur||(He===nt?Yt?Ad($,W[$].percent):Ld($,W[$].percent):$s?pr($,0):pr($,100))},_3=$=>$.classList.contains("panel"),y3=$=>$.classList.contains("panel-fill"),Ad=($,tt)=>{if(tt===void 0)return;let Tt=Of(tt);Tt==null&&(Tt=1),tt-=Tt,tt<0&&(tt=0),pr($,tt)},Ld=($,tt)=>{if(tt===void 0)return;let Tt=Of(tt);Tt==null&&(Tt=1),tt+=Tt,tt>100&&(tt=100),pr($,tt)},Xl=()=>{!pt||pt.update({percents:k2(),values:N2(),$pointers:D2(),min:$2(),max:j2(),data:t1(),step:Qy(),round:i1(),type:e1(),textMin:Ff(),textMax:kf(),rightToLeft:n1(),bottomToTop:o1(),pointersOverlap:c1(),pointersMinDistance:s1(),pointersMaxDistance:r1(),rangeDragging:u1(),disabled:a1(),keyboardDisabled:l1(),mousewheelDisabled:h1()})},x3=()=>{Xl()},v3=$=>{if(!(xe||W.length<=1||_e===mt))if($===0){let tt=di*100/(_e-mt);return Math.max(0,W[$+1].percent-tt)}else{let tt=Zt*100/(_e-mt);return Math.min(W[$-1].percent+tt,100)}},b3=$=>{if(!(xe||W.length<=1||_e===mt))if($===W.length-1){let tt=di*100/(_e-mt);return Math.min(W[$-1].percent+tt,100)}else{let tt=Zt*100/(_e-mt);return Math.max(0,W[$+1].percent-tt)}},Of=$=>{let tt;if(typeof be=="function"){let Tt=Pt(0,100,mt,_e,$);tt=be(Tt,$)}else tt=be;if(Ct(tt)){let Tt=_e-mt;return tt=Tt===0?0:tt*100/Tt,tt}},Qh=$=>{if($===void 0)return;let tt=Pt(0,100,mt,_e,$);return kt!==void 0?kt[Math.round(tt)]:pi(tt,Kr)},Ff=()=>kt!==void 0?kt[mt]:mt,kf=()=>kt!==void 0?kt[_e]:_e,Qy=()=>be,w3=$=>{var tt;return $<=0||xe?Ff():(tt=Qh(W[$-1].percent))!=null?tt:""},E3=$=>{var tt;return W.length<=1||$>=W.length-1||xe?kf():(tt=Qh(W[$+1].percent))!=null?tt:""},k2=()=>W.map($=>$.percent),N2=()=>W.map($=>Qh($.percent)),D2=()=>W.map($=>$.$pointer),$2=()=>mt,j2=()=>_e,t1=()=>kt,e1=()=>He,i1=()=>Kr,s1=()=>Zt,r1=()=>di,S3=$=>M2[$],n1=()=>$s,o1=()=>Yt,a1=()=>Wi,l1=()=>ur,h1=()=>dr,c1=()=>xe,u1=()=>gs,pr=($,tt)=>{if(tt===void 0)return;let Tt=Of(tt);Tt!==void 0&&(tt=me(tt,Tt));let Qe=W[$];if(!Qe)return;let Xi=Qe.updatePosition(tt,v3($),b3($),He,$s,Yt);qt==null||qt.updatePosition(He,W.map(De=>De.percent),$s,Yt),Xl();for(let De of W){let xn=Qh(De.percent);xn!==void 0&&(De.setAttr("aria-valuenow",xn.toString()),De.setAttr("aria-valuetext",xn.toString()))}T3(),Xi&&Mo(P,W.map(De=>Qh(De.percent)))},Wn=()=>{for(let $=0;$<W.length;$++)pr($,W[$].percent)},C3=($,tt)=>{mt=kt!==void 0?0:ft($,Ky),_e=kt!==void 0?kt.length-1:ft(tt,Id),Nf(mt),Df(_e)},T3=()=>{var $,tt;for(let Tt=0;Tt<W.length;Tt++){let Qe=W[Tt];Qe.setAttr("aria-valuemin",(($=w3(Tt))!=null?$:"").toString()),Qe.setAttr("aria-valuemax",((tt=E3(Tt))!=null?tt:"").toString())}},Nf=$=>{mt=ft($,Ky),mt>_e&&(_e=mt+Id),Wn()},Df=$=>{_e=ft($,Id),_e<mt&&(_e=mt+Id),Wn()},G2=$=>{xe=!0;for(let tt=0;tt<$.length;tt++)$f($[tt],tt);xe=!1;for(let tt=0;tt<$.length;tt++)$f($[tt],tt)},$f=($,tt)=>{let Tt;kt!==void 0?(Tt=$==null?0:Je($,kt),Tt===-1&&(Tt=0)):(Tt=ft($,mt),Tt<mt&&(Tt=mt),Tt>_e&&(Tt=_e));let Qe=Pt(mt,_e,0,100,Tt);pr(tt,Qe)},jf=$=>{if($==null){be=void 0;return}if(typeof $=="function"){be=$,Wn();return}if(Ct($)){be=ft($,1);let tt=Math.abs(_e-mt);be>tt&&(be=void 0),Wn();return}be=void 0},d1=$=>{xe=$,Wn()},p1=$=>{(!Ct($)||$<0)&&($=0),Zt=$},g1=$=>{(!Ct($)||$<0)&&($=1/0),di=$},f1=$=>{Wi=$,G.classList.toggle("disabled",Wi),Wi?G.setAttribute("aria-disabled","true"):G.hasAttribute("aria-disabled")&&G.removeAttribute("aria-disabled")},z2=$=>{ur=$},B2=$=>{dr=$,dr?document.removeEventListener("wheel",Pf):document.addEventListener("wheel",Pf,{passive:!1})},m1=$=>{if($==null){kt=void 0;return}if(kt=yn($),kt===void 0||kt.length<=0){kt=void 0;return}Nf(0),Df(kt.length-1),be===void 0&&jf(1)},_1=$=>{var tt;typeof $=="string"?He=$.trim().toLowerCase()===nt?nt:ht:He=ht;let Tt=(tt=P.shadowRoot)==null?void 0:tt.querySelector(".range-slider-box");if(!Tt)return;Tt.className=`range-slider-box type-${He}`,Wn();let Qe=He===nt?"vertical":"horizontal";for(let Xi of W)Xi.setAttr("aria-orientation",Qe)},y1=$=>{$s=$,W.length>1&&Di(W,$s,P),Wn(),Xl()},x1=$=>{Yt=$,W.length>1&&Di(W,Yt,P),Wn(),Xl()},v1=$=>{Kr=ft($,Jh),Kr<0&&(Kr=Jh),Xl()},U2=$=>{$==null||$.toString().trim().toLowerCase()==="false"?($a=void 0,G.style.removeProperty(bi),G.classList.remove(ki)):($a=$.toString(),G.style.setProperty(bi,$a),G.classList.add(ki))},V2=($,tt)=>{let Tt=W[$];!Tt||(Tt.setAttr("aria-label",tt),M2[$]=tt)},Gf=$=>{if(as=void 0,W.length<=1){gs=!1,G.classList.remove(ri);return}gs=$,G.classList.toggle(ri,gs)},R3=()=>{f1(he(P.getAttribute(v))),ur=he(P.getAttribute(b)),dr=he(P.getAttribute(E));let $=Ds(P,/^pointer([0-9]*)-disabled$/,tt=>he(tt));for(let tt of $){let Tt=tt[0];!W[Tt]||(W[Tt].disabled=tt[1])}},M3=()=>{let $=Ds(P,/^aria-label([0-9]*)$/);for(let tt of $){let Tt=tt[0];V2(Tt,tt[1])}},I3=$=>{let tt=W.length,Tt=W[tt-1].$pointer,Qe=Tt.cloneNode(!0);Tt.after(Qe);let Xi=Lr(P,Qe,tt);return Xi.setCallbacks(L2,P2,O2,F2),W.push(Xi),$f($,tt),Wn(),Xl(),tt},A3=()=>{let $=W.length,tt=W[$-1];return tt?(tt.destroy(),W.pop(),W.length<=1&&Gf(!1),Wn(),Xl(),$-1):-1};return(()=>{var $,tt;for(let Qe of W)Qe.setCallbacks(L2,P2,O2,F2);let Tt=($=P.shadowRoot)==null?void 0:$.querySelector(".panel-fill");Tt&&(qt=gi(Tt)),_1(P.getAttribute(f)),y1(he(P.getAttribute(_))),x1(he(P.getAttribute(y))),C3(P.getAttribute(u),P.getAttribute(d)),jf(P.getAttribute(p)),m1(P.getAttribute(c)),G2(K.map(Qe=>Qe[1])),d1(he(P.getAttribute(o))),p1(ft(P.getAttribute(a),0)),g1(ft(P.getAttribute(l),1/0)),Gf(he(P.getAttribute(h))),v1(ft(P.getAttribute(g),Jh)),R3(),M3(),ce=ni(P,G,W),U2((tt=P.getAttribute(k))!=null?tt:R2),G.addEventListener("mousedown",I2),G.addEventListener("mouseup",Lf),G.addEventListener("touchmove",Wl),G.addEventListener("touchstart",Wl),dr||document.addEventListener("wheel",Pf,{passive:!1}),pt=Ci(P,x3,{setValues:G2,setMin:Nf,setMax:Df,setStep:jf,setPointersOverlap:d1,setPointersMinDistance:p1,setPointersMaxDistance:g1,setDisabled:f1,setType:_1,setRightToLeft:y1,setBottomToTop:x1,setRound:v1,setKeyboardDisabled:z2,setMousewheelDisabled:B2,setRangeDragging:Gf,setData:m1},{getPercents:k2,getValues:N2,getPointerElements:D2,getMin:$2,getMax:j2,getStep:Qy,getData:t1,getType:e1,getRound:i1,getTextMin:Ff,getTextMax:kf,isRightToLeft:n1,isBottomToTop:o1,isDisabled:a1,isKeyboardDisabled:l1,isMousewheelDisabled:h1,isPointersOverlap:c1,isRangeDraggingEnabled:u1,getPointersMinDistance:s1,getPointersMaxDistance:r1}),pt.init()})(),{get pointers(){return W},get styles(){return ce},get pluginsManager(){return pt},get min(){return Ff()},get max(){return kf()},get step(){return Qy()},get pointersOverlap(){return c1()},set pointersOverlap($){d1($)},get pointersMinDistance(){return s1()},set pointersMinDistance($){p1($)},get pointersMaxDistance(){return r1()},set pointersMaxDistance($){g1($)},get disabled(){return a1()},set disabled($){f1($)},get data(){return t1()},get type(){return e1()},set type($){_1($)},get rightToLeft(){return n1()},set rightToLeft($){y1($)},get bottomToTop(){return o1()},set bottomToTop($){x1($)},get round(){return i1()},set round($){v1($)},get animateOnClick(){return $a},set animateOnClick($){U2($)},get keyboardDisabled(){return l1()},set keyboardDisabled($){z2($)},get mousewheelDisabled(){return h1()},set mousewheelDisabled($){B2($)},get rangeDragging(){return u1()},set rangeDragging($){Gf($)},setMin:Nf,setMax:Df,setValue:$f,setStep:jf,setData:m1,getTextValue:Qh,setAriaLabel:V2,getAriaLabel:S3,addPointer:I3,removePointer:A3,destroy:()=>{G.removeEventListener("mousedown",I2),G.removeEventListener("mouseup",Lf),G.removeEventListener("touchmove",Wl),G.removeEventListener("touchstart",Wl),document.removeEventListener("wheel",Pf);for(let $ of W)$.destroy();pt==null||pt.destroy()}}},g3=(P,G,K)=>{let W=Da.find(([pt,mt,_e,be])=>mt.replace("#","")===G.replace(/\d+/g,""));if(W&&P.styles){let[pt,mt,_e,be]=W,kt=G.replace(/\D/g,"").trim(),He=kt===""||kt==="0"||kt==="1"?0:ft(kt,0)-1;P.styles.setStyle(pt,K,He);return}switch(P&&P.pluginsManager&&P.pluginsManager.onAttrChange(G,K),G){case u:{P.setMin(K);break}case d:{P.setMax(K);break}case p:{P.setStep(K);break}case o:{P.pointersOverlap=he(K);break}case a:{P.pointersMinDistance=ft(K,0);break}case h:{P.rangeDragging=he(K);break}case l:{P.pointersMaxDistance=ft(K,1/0);break}case v:{P.disabled=he(K);break}case b:{P.keyboardDisabled=he(K);break}case E:{P.mousewheelDisabled=he(K);break}case c:{P.setData(K);break}case f:{P.type=K;break}case _:{P.rightToLeft=he(K);break}case y:{P.bottomToTop=he(K);break}case g:{P.round=ft(K,Jh);break}case m:{P.styles&&(P.styles.theme=K);break}case k:{P.animateOnClick=K;break}}let ut=null;if(/^value([0-9]*)$/.test(G)&&(ut="value"),/^pointer([0-9]*)-disabled$/.test(G)&&(ut="pointer-disabled"),/^aria-label([0-9]*)$/.test(G)&&(ut="aria-label"),/^pointer([0-9]*)-shape$/.test(G)&&(ut="pointer-shape"),!ut)return;let qt=G.replace(/\D/g,"").trim(),ce=qt===""||qt==="0"||qt==="1"?0:ft(qt,0)-1;switch(ut){case"value":{P.setValue(K,ce);break}case"pointer-disabled":{let pt=P==null?void 0:P.pointers[ce];if(!pt)return;pt.disabled=he(K);break}case"aria-label":{P.setAriaLabel(ce,K);break}case"pointer-shape":{P.styles&&P.styles.setPointerShape(ce,K);break}}},f3=class extends HTMLElement{constructor(){super(),i(this,"slider"),i(this,"_externalCSSList",[]),i(this,"_observer",null),this.attachShadow({mode:"open"})}set step(P){this.slider&&this.slider.setStep(P)}get step(){var P;return(P=this.slider)==null?void 0:P.step}set disabled(P){this.slider&&(this.slider.disabled=P)}get disabled(){var P,G;return(G=(P=this.slider)==null?void 0:P.disabled)!=null?G:!1}set data(P){var G;(G=this.slider)==null||G.setData(P)}get data(){var P;return(P=this.slider)==null?void 0:P.data}set min(P){var G;(G=this.slider)==null||G.setMin(P)}get min(){var P;return(P=this.slider)==null?void 0:P.min}set max(P){var G;(G=this.slider)==null||G.setMax(P)}get max(){var P;return(P=this.slider)==null?void 0:P.max}set round(P){!this.slider||(this.slider.round=P)}get round(){var P,G;return(G=(P=this.slider)==null?void 0:P.round)!=null?G:Jh}set type(P){!this.slider||(this.slider.type=P??ht)}get type(){var P;return((P=this.slider)==null?void 0:P.type)||ht}set pointersOverlap(P){!this.slider||(this.slider.pointersOverlap=P)}get pointersOverlap(){var P,G;return(G=(P=this.slider)==null?void 0:P.pointersOverlap)!=null?G:!1}set pointersMinDistance(P){!this.slider||(this.slider.pointersMinDistance=P)}get pointersMinDistance(){var P,G;return(G=(P=this.slider)==null?void 0:P.pointersMinDistance)!=null?G:0}set pointersMaxDistance(P){!this.slider||(this.slider.pointersMaxDistance=P)}get pointersMaxDistance(){var P,G;return(G=(P=this.slider)==null?void 0:P.pointersMaxDistance)!=null?G:1/0}set theme(P){!this.slider||!this.slider.styles||(this.slider.styles.theme=P)}get theme(){var P,G,K;return(K=(G=(P=this.slider)==null?void 0:P.styles)==null?void 0:G.theme)!=null?K:null}set rtl(P){!this.slider||(this.slider.rightToLeft=P)}get rtl(){var P,G;return(G=(P=this.slider)==null?void 0:P.rightToLeft)!=null?G:!1}set btt(P){!this.slider||(this.slider.bottomToTop=P)}get btt(){var P,G;return(G=(P=this.slider)==null?void 0:P.bottomToTop)!=null?G:!1}set keyboardDisabled(P){!this.slider||(this.slider.keyboardDisabled=P)}get keyboardDisabled(){var P,G;return(G=(P=this.slider)==null?void 0:P.keyboardDisabled)!=null?G:!1}set mousewheelDisabled(P){!this.slider||(this.slider.mousewheelDisabled=P)}get mousewheelDisabled(){var P,G;return(G=(P=this.slider)==null?void 0:P.mousewheelDisabled)!=null?G:!1}set animateOnClick(P){!this.slider||(this.slider.animateOnClick=P)}get animateOnClick(){var P;return(P=this.slider)==null?void 0:P.animateOnClick}get rangeDragging(){var P,G;return(G=(P=this.slider)==null?void 0:P.rangeDragging)!=null?G:!1}set rangeDragging(P){this.slider&&(this.slider.rangeDragging=he(P))}get externalCSSList(){return this._externalCSSList}addPointer(P){var G,K;if(!this.slider)return;let W=(K=(G=this.slider)==null?void 0:G.addPointer(P))!=null?K:0;Bt(this,this.slider,W,`value${W+1}`,`ariaLabel${W+1}`,`pointerShape${W+1}`,`pointer${W+1}Disabled`)}removePointer(){var P;!this.slider||(P=this.slider)==null||P.removePointer()}addCSS(P){if(!this.shadowRoot)return;let G=document.createElement("style");G.textContent=P,this.shadowRoot.appendChild(G)}connectedCallback(){var P,G;if(!this.shadowRoot)return;this._externalCSSList=Hl(this),this.shadowRoot.innerHTML=r(n,this._externalCSSList);let K=(P=this.shadowRoot)==null?void 0:P.querySelector(".pointer");if(!K)return;let W=(G=this.shadowRoot)==null?void 0:G.getElementById("range-slider");if(!W)return;let ut=Vi(this,K);this.slider=p3(this,W,ut),Me(this,this.slider),this._observer=new MutationObserver(qt=>{qt.forEach(ce=>{var pt;if(!this.slider||ce.type!=="attributes")return;let mt=ce.attributeName;!mt||g3(this.slider,mt,(pt=this.getAttribute(mt))!=null?pt:"")})}),this._observer.observe(this,{attributes:!0})}disconnectedCallback(){this._observer&&this._observer.disconnect(),this.slider&&this.slider.destroy()}},Jy=f3;window.tcRangeSlider=Jy,customElements.get("toolcool-range-slider")||customElements.define("toolcool-range-slider",Jy),customElements.get("tc-range-slider")||customElements.define("tc-range-slider",class extends Jy{})})();function jgt(s,t){Object.keys(t).forEach(e=>{s.setAttribute(e,t[e])})}class Ggt extends Ks{register(){super.register()}unregister(){super.unregister()}build(){const t=this.schema.properties,e=this.options,i=this.schema.description,r=this.theme,n=this.defaults.startVals[this.key];e.compact||(this.header=this.label=r.getFormInputLabel(this.getTitle(),this.isRequired())),i&&(this.description=r.getFormInputDescription(this.translateProperty(i))),e.infoText&&(this.infoButton=r.getInfoButton(this.translateProperty(e.infoText)));const o=document.createElement("tc-range-slider"),a=Object.keys(t).find(c=>c.includes("min")),l=Object.keys(t).find(c=>c.includes("max")),h={min:t[a].minimum,max:t[l].maximum,value1:(n==null?void 0:n[a])||t[a].default,value2:(n==null?void 0:n[l])||t[l].default,"slider-bg-fill":"#004170","generate-labels":"true","slider-width":"100%","range-dragging":"false"};jgt(o,h),this.input=o,this.input.id=this.formname,this.control=r.getFormControl(this.label,this.input,this.description,this.infoButton),(this.schema.readOnly||this.schema.readonly)&&(this.disable(!0),this.input.disabled=!0),this.input.addEventListener("change",c=>{c.preventDefault(),c.stopPropagation(),this.value={[a]:c.detail.value1,[l]:c.detail.value2},this.onChange(!0)}),this.container.appendChild(this.control)}destroy(){this.label&&this.label.parentNode&&this.label.parentNode.removeChild(this.label),this.description&&this.description.parentNode&&this.description.parentNode.removeChild(this.description),this.input&&this.input.parentNode&&this.input.parentNode.removeChild(this.input),super.destroy()}}const zgt=[{type:"object",format:"minmax",func:Ggt}],Bgt=s=>{zgt.map(({type:t,format:e,func:i})=>{Xe.defaults.startVals=s,Xe.defaults.editors[e]=i,Xe.defaults.resolvers.unshift(r=>{if(r.type===t&&r.format===e)return e})})};var Pp,vu,Fb,cI,kb,b$;class w$ extends Lp{constructor(){super(),Rm(this,Fb),Rm(this,kb),Rm(this,Pp,{}),Rm(this,vu,null),this.schema,this.startVals,this.options={show_opt_in:!1,disable_collapse:!0,disable_edit_json:!0,disable_properties:!0,disable_array_delete_all_rows:!0,disable_array_delete_last_row:!0,array_controls_top:!0},this.unstyled=!1}async parseProperty(t){if(t&&typeof t!="object")try{const e=await fetch(t);if(e.ok)return await e.json();console.error("Failed to fetch schema from URL: ",e.status)}catch(e){console.error("Error fetching schema: ",e)}return t}getSchema(){return this.schema}setSchema(t){this.schema=t}getDefaultValues(){return this.startVals}setDefaultValues(t){this.startVals=t}getValues(){return Ip(this,Pp)}async firstUpdated(){if(this.setSchema(await this.parseProperty(this.schema)),this.setDefaultValues(await this.parseProperty(this.startVals)),!Ip(this,vu)){Bgt(this.startVals||{});const t=this.renderRoot.querySelector("form");XD(this,vu,new Xe(t,{schema:this.schema,...this.startVals?{startval:this.startVals}:{},theme:"html",ajax:!0,...this.options})),qD(this,kb,b$).call(this)}}render(){return Tgt`
      <style>
        ${Fgt}
          ${!this.unstyled&&$gt}
      </style>
      <form></form>
    `}}Pp=new WeakMap,vu=new WeakMap,Fb=new WeakSet,cI=function(){this.dispatchEvent(new CustomEvent("change",{detail:Ip(this,Pp),bubbles:!0,composed:!0})),this.requestUpdate()},kb=new WeakSet,b$=function(){["ready","change"].map(s=>{Ip(this,vu).on(s,()=>{XD(this,Pp,Ip(this,vu).getValue()),qD(this,Fb,cI).call(this)})})},zut(w$,"properties",{schema:{attribute:!1,type:Object},startVals:{attribute:!1,type:Object},options:{attribute:!1,type:Object},unstyled:{type:Boolean}});customElements.define("eox-jsonform",w$);/**
 * wms-capabilities @0.6.0
 * @description WMS service Capabilities > JSON, based on openlayers 
 * @license BSD-2-Clause
 * @preserve
 */var ye=s=>s!==void 0,E$=(s,t,e)=>t in s?s[t]:s[t]=e;const Lg={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12};class Ugt{constructor(t){this._parser=new t}toDocument(t){return this._parser.parseFromString(t,"application/xml")}getAllTextContent(t,e){return qy(t,e).join("")}}function qy(s,t){return S$(s,t,[]).join("")}function S$(s,t,e){if(s.nodeType===Lg.CDATA_SECTION||s.nodeType===Lg.TEXT)t?e.push(String(s.nodeValue).replace(/(\r\n|\r|\n)/g,"")):e.push(s.nodeValue);else{var i;for(i=s.firstChild;i;i=i.nextSibling)S$(i,t,e)}return e}function Vgt(s,t,e,i){for(var r=Hgt(t);r;r=Wgt(r)){var n=r.namespaceURI||null,o=s[n];if(ye(o)){var a=o[r.localName];ye(a)&&a.call(i,r,e)}}}function Hgt(s){let t=s.firstElementChild||s.firstChild;for(;t&&t.nodeType!==Lg.ELEMENT;)t=t.nextSibling;return t}function Wgt(s){let t=s.nextElementSibling||s.nextSibling;for(;t&&t.nodeType!==Lg.ELEMENT;)t=t.nextSibling;return t}function ks(s,t,e){return Xgt(s,t,e)}function Xgt(s,t,e){var i=ye(e)?e:{},r,n;for(r=0,n=s.length;r<n;++r)i[s[r]]=t;return i}function C$(s,t){return function(e,i){var r=s.call(ye(t)?t:this,e,i);if(ye(r)){var n=i[i.length-1];n.push(r)}}}function Es(s,t,e,i,r){return i.push(s),Vgt(t,e,i,r),i.pop()}function St(s,t,e){return function(i,r){let n=s.call(ye(e)?e:this,i,r);if(ye(n)){var o=r[r.length-1],a=ye(t)?t:i.localName;o[a]=n}}}function _r(s,t,e){return function(i,r){var n=s.call(ye(e)?e:this,i,r);if(ye(n)){var o=r[r.length-1],a=ye(t)?t:i.localName,l=E$(o,a,[]);l.push(n)}}}const qgt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;function Ygt(s){return s.replace(qgt,"")}function Sh(s){const t=/^\s*(true|1)|(false|0)\s*$/.exec(s);if(t)return ye(t[1])||!1}function su(s){return Zo(qy(s,!1))}function Zo(s){const t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(s);if(t)return parseFloat(t[1])}function zx(s){return u_(qy(s,!1))}function u_(s){const t=/^\s*(\d+)\s*$/.exec(s);if(t)return parseInt(t[1],10)}function ke(s){return Ygt(qy(s,!1))}const Zgt="http://www.w3.org/1999/xlink";function y2(s){return s.getAttributeNS(Zgt,"href")}function Kgt(s,t){return Es({},Sft,s,t)}function T$(s){return[Zo(s.getAttribute("minx")),Zo(s.getAttribute("miny")),Zo(s.getAttribute("maxx")),Zo(s.getAttribute("maxy"))]}function Jgt(s,t){const e=T$(s),i=[Zo(s.getAttribute("resx")),Zo(s.getAttribute("resy"))];return{crs:s.getAttribute("CRS")||s.getAttribute("SRS"),extent:e,res:i}}function Qgt(s,t){const e=T$(s);if(!(!ye(e[0])||!ye(e[1])||!ye(e[2])||!ye(e[3])))return e}function tft(s,t){const e=parseFloat(s.getAttribute("min")),i=parseFloat(s.getAttribute("max"));return{min:e,max:i}}function eft(s,t){const e=Es({},Cft,s,t);if(!ye(e))return;const i=e.westBoundLongitude,r=e.southBoundLatitude,n=e.eastBoundLongitude,o=e.northBoundLatitude;if(!(!ye(i)||!ye(r)||!ye(n)||!ye(o)))return[i,r,n,o]}function ift(s,t){return Es({},yft,s,t)}function sft(s,t){return Es({},xft,s,t)}function rft(s,t){return Es({},vft,s,t)}function nft(s,t){return Es({},bft,s,t)}function oft(s,t){return Es({},wft,s,t)}function aft(s,t){return Es([],Eft,s,t)}function lft(s,t){const e=Sh(s.getAttribute("queryable"));return Es({queryable:ye(e)?e:!1},I$,s,t)}function hft(s,t){var e=t[t.length-1];const i=Es({},I$,s,t);if(!ye(i))return;let r=Sh(s.getAttribute("queryable"));ye(r)||(r=e.queryable),i.queryable=ye(r)?r:!1;let n=u_(s.getAttribute("cascaded"));ye(n)||(n=e.cascaded),i.cascaded=n;let o=Sh(s.getAttribute("opaque"));ye(o)||(o=e.opaque),i.opaque=ye(o)?o:!1;let a=Sh(s.getAttribute("noSubsets"));ye(a)||(a=e.noSubsets),i.noSubsets=ye(a)?a:!1;let l=Zo(s.getAttribute("fixedWidth"));ye(l)||(l=e.fixedWidth),i.fixedWidth=l;let h=Zo(s.getAttribute("fixedHeight"));ye(h)||(h=e.fixedHeight),i.fixedHeight=h;const c=["Style","CRS","AuthorityURL"];for(let d=0,p=c.length;d<p;d++){const g=c[d],f=e[g];if(ye(f)){let m=E$(i,g,[]);m=m.concat(f),i[g]=m}}const u=["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"];for(let d=0,p=u.length;d<p;d++){const g=u[d],f=i[g];if(!ye(f)){const m=e[g];i[g]=m}}return i}function cft(s,t){return{name:s.getAttribute("name"),units:s.getAttribute("units"),unitSymbol:s.getAttribute("unitSymbol"),default:s.getAttribute("default"),multipleValues:Sh(s.getAttribute("multipleValues")),nearestValue:Sh(s.getAttribute("nearestValue")),current:Sh(s.getAttribute("current")),values:ke(s)}}function _a(s,t){return Es({},Lft,s,t)}function uft(s,t){return Es({},Tft,s,t)}function dft(s,t){return Es({},Mft,s,t)}function pft(s,t){return Es({},Ift,s,t)}function Bx(s,t){return Es({},Rft,s,t)}function R$(s,t){var e=_a(s,t);if(ye(e)){const i=[u_(s.getAttribute("width")),u_(s.getAttribute("height"))];return e.size=i,e}}function gft(s,t){var e=_a(s,t);if(ye(e))return e.name=s.getAttribute("name"),e}function fft(s,t){var e=_a(s,t);if(ye(e))return e.type=s.getAttribute("type"),e}function mft(s,t){return Es({},Aft,s,t)}function M$(s,t){return Es([],Pft,s,t)}const Ns=[null,"http://www.opengis.net/wms"],_ft=ks(Ns,{Service:St(sft),Capability:St(ift)}),yft=ks(Ns,{Request:St(uft),Exception:St(aft),Layer:St(lft)}),xft=ks(Ns,{Name:St(ke),Title:St(ke),Abstract:St(ke),KeywordList:St(M$),OnlineResource:St(y2),ContactInformation:St(rft),Fees:St(ke),AccessConstraints:St(ke),LayerLimit:St(zx),MaxWidth:St(zx),MaxHeight:St(zx)}),vft=ks(Ns,{ContactPersonPrimary:St(nft),ContactPosition:St(ke),ContactAddress:St(oft),ContactVoiceTelephone:St(ke),ContactFacsimileTelephone:St(ke),ContactElectronicMailAddress:St(ke)}),bft=ks(Ns,{ContactPerson:St(ke),ContactOrganization:St(ke)}),wft=ks(Ns,{AddressType:St(ke),Address:St(ke),City:St(ke),StateOrProvince:St(ke),PostCode:St(ke),Country:St(ke)}),Eft=ks(Ns,{Format:C$(ke)}),I$=ks(Ns,{Name:St(ke),Title:St(ke),Abstract:St(ke),KeywordList:St(M$),CRS:_r(ke),SRS:_r(ke),EX_GeographicBoundingBox:St(eft),LatLonBoundingBox:St(Qgt),BoundingBox:_r(Jgt),Dimension:_r(cft),Attribution:St(Kgt),AuthorityURL:_r(gft),Identifier:_r(ke),MetadataURL:_r(fft),DataURL:_r(_a),FeatureListURL:_r(_a),Style:_r(mft),MinScaleDenominator:St(su),MaxScaleDenominator:St(su),ScaleHint:St(tft),Layer:_r(hft)}),Sft=ks(Ns,{Title:St(ke),OnlineResource:St(y2),LogoURL:St(R$)}),Cft=ks(Ns,{westBoundLongitude:St(su),eastBoundLongitude:St(su),southBoundLatitude:St(su),northBoundLatitude:St(su)}),Tft=ks(Ns,{GetCapabilities:St(Bx),GetMap:St(Bx),GetFeatureInfo:St(Bx)}),Rft=ks(Ns,{Format:_r(ke),DCPType:_r(dft)}),Mft=ks(Ns,{HTTP:St(pft)}),Ift=ks(Ns,{Get:St(_a),Post:St(_a)}),Aft=ks(Ns,{Name:St(ke),Title:St(ke),Abstract:St(ke),LegendURL:_r(R$),StyleSheetURL:St(_a),StyleURL:St(_a)}),Lft=ks(Ns,{Format:St(ke),OnlineResource:St(y2)}),Pft=ks(Ns,{Keyword:C$(ke)});class Oft{constructor(t,e){!e&&typeof window<"u"&&(e=window.DOMParser),this.version=void 0,this._parser=new Ugt(e),this._data=t}data(t){return this._data=t,this}toJSON(t){return t=t||this._data,this.parse(t)}parse(t){return this.readFromDocument(this._parser.toDocument(t))}readFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Lg.ELEMENT)return this.readFromNode(e);return null}readFromNode(t){return this.version=t.getAttribute("version"),Es({version:this.version},_ft,t,[])||null}}async function Fft(s){let t=new URL(s),e=t.searchParams;e.set("SERVICE","WMS"),e.set("REQUEST","GetCapabilities");let i=t.toString();const r=await fetch(i);if(r.ok){const n=await r.text();return new Oft(n).toJSON()}else throw new Error(`Error: ${r.status}`)}function x2(s){const t=/\b(?:wms|ows)\b/i,e=/{(?:z|x|y-?)}\/{(?:z|x|y-?)}\/{(?:z|x|y-?)}/i;return t.test(s)?"TileWMS":e.test(s)?"XYZ":!1}function kft(s){const e=/^(?:(?:https?|ftp):\/\/|\/\/)?(?:localhost|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}|(?:\w+[\w-]*\.)+\w+)(?::\d+)?(?:\/\S*)?$/.test(s),i=x2(s);return!!(s&&e&&i)}function A$(s){return s.replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2": ').replace(/,\s*}/g,"}").replace(/,\s*]/g,"]").replace(/\s*(\{|}|\[|\]|,)\s*/g,"$1").replaceAll('": //',"://")}function Nft(s){try{return JSON.parse(A$(s)),!!s}catch{return!1}}function Dft(s,t){const e=new URL(s).searchParams;Object.entries(t).forEach(([o,a])=>{typeof a=="object"&&!Array.isArray(a)&&a!==null?Object.keys(a).forEach(l=>{e.set(l,a[l])}):e.set(o,a)});const i=s.split("?")[0],r=e.toString();return`${i}?${r}`}/**!
 * Sortable 1.15.2
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function uI(s,t){var e=Object.keys(s);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),e.push.apply(e,i)}return e}function wo(s){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?uI(Object(e),!0).forEach(function(i){$ft(s,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(e)):uI(Object(e)).forEach(function(i){Object.defineProperty(s,i,Object.getOwnPropertyDescriptor(e,i))})}return s}function Wm(s){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Wm=function(t){return typeof t}:Wm=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wm(s)}function $ft(s,t,e){return t in s?Object.defineProperty(s,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):s[t]=e,s}function ya(){return ya=Object.assign||function(s){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i])}return s},ya.apply(this,arguments)}function jft(s,t){if(s==null)return{};var e={},i=Object.keys(s),r,n;for(n=0;n<i.length;n++)r=i[n],!(t.indexOf(r)>=0)&&(e[r]=s[r]);return e}function Gft(s,t){if(s==null)return{};var e=jft(s,t),i,r;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(s);for(r=0;r<n.length;r++)i=n[r],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(s,i)&&(e[i]=s[i])}return e}var zft="1.15.2";function aa(s){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(s)}var Na=aa(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),If=aa(/Edge/i),dI=aa(/firefox/i),Op=aa(/safari/i)&&!aa(/chrome/i)&&!aa(/android/i),L$=aa(/iP(ad|od|hone)/i),P$=aa(/chrome/i)&&aa(/android/i),O$={capture:!1,passive:!1};function Be(s,t,e){s.addEventListener(t,e,!Na&&O$)}function Ie(s,t,e){s.removeEventListener(t,e,!Na&&O$)}function d_(s,t){if(t){if(t[0]===">"&&(t=t.substring(1)),s)try{if(s.matches)return s.matches(t);if(s.msMatchesSelector)return s.msMatchesSelector(t);if(s.webkitMatchesSelector)return s.webkitMatchesSelector(t)}catch{return!1}return!1}}function Bft(s){return s.host&&s!==document&&s.host.nodeType?s.host:s.parentNode}function Rn(s,t,e,i){if(s){e=e||document;do{if(t!=null&&(t[0]===">"?s.parentNode===e&&d_(s,t):d_(s,t))||i&&s===e)return s;if(s===e)break}while(s=Bft(s))}return null}var pI=/\s+/g;function Fr(s,t,e){if(s&&t)if(s.classList)s.classList[e?"add":"remove"](t);else{var i=(" "+s.className+" ").replace(pI," ").replace(" "+t+" "," ");s.className=(i+(e?" "+t:"")).replace(pI," ")}}function Ut(s,t,e){var i=s&&s.style;if(i){if(e===void 0)return document.defaultView&&document.defaultView.getComputedStyle?e=document.defaultView.getComputedStyle(s,""):s.currentStyle&&(e=s.currentStyle),t===void 0?e:e[t];!(t in i)&&t.indexOf("webkit")===-1&&(t="-webkit-"+t),i[t]=e+(typeof e=="string"?"":"px")}}function bu(s,t){var e="";if(typeof s=="string")e=s;else do{var i=Ut(s,"transform");i&&i!=="none"&&(e=i+" "+e)}while(!t&&(s=s.parentNode));var r=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return r&&new r(e)}function F$(s,t,e){if(s){var i=s.getElementsByTagName(t),r=0,n=i.length;if(e)for(;r<n;r++)e(i[r],r);return i}return[]}function po(){var s=document.scrollingElement;return s||document.documentElement}function rs(s,t,e,i,r){if(!(!s.getBoundingClientRect&&s!==window)){var n,o,a,l,h,c,u;if(s!==window&&s.parentNode&&s!==po()?(n=s.getBoundingClientRect(),o=n.top,a=n.left,l=n.bottom,h=n.right,c=n.height,u=n.width):(o=0,a=0,l=window.innerHeight,h=window.innerWidth,c=window.innerHeight,u=window.innerWidth),(t||e)&&s!==window&&(r=r||s.parentNode,!Na))do if(r&&r.getBoundingClientRect&&(Ut(r,"transform")!=="none"||e&&Ut(r,"position")!=="static")){var d=r.getBoundingClientRect();o-=d.top+parseInt(Ut(r,"border-top-width")),a-=d.left+parseInt(Ut(r,"border-left-width")),l=o+n.height,h=a+n.width;break}while(r=r.parentNode);if(i&&s!==window){var p=bu(r||s),g=p&&p.a,f=p&&p.d;p&&(o/=f,a/=g,u/=g,c/=f,l=o+c,h=a+u)}return{top:o,left:a,bottom:l,right:h,width:u,height:c}}}function gI(s,t,e){for(var i=vl(s,!0),r=rs(s)[t];i;){var n=rs(i)[e],o=void 0;if(e==="top"||e==="left"?o=r>=n:o=r<=n,!o)return i;if(i===po())break;i=vl(i,!1)}return!1}function td(s,t,e,i){for(var r=0,n=0,o=s.children;n<o.length;){if(o[n].style.display!=="none"&&o[n]!==Vt.ghost&&(i||o[n]!==Vt.dragged)&&Rn(o[n],e.draggable,s,!1)){if(r===t)return o[n];r++}n++}return null}function v2(s,t){for(var e=s.lastElementChild;e&&(e===Vt.ghost||Ut(e,"display")==="none"||t&&!d_(e,t));)e=e.previousElementSibling;return e||null}function tn(s,t){var e=0;if(!s||!s.parentNode)return-1;for(;s=s.previousElementSibling;)s.nodeName.toUpperCase()!=="TEMPLATE"&&s!==Vt.clone&&(!t||d_(s,t))&&e++;return e}function fI(s){var t=0,e=0,i=po();if(s)do{var r=bu(s),n=r.a,o=r.d;t+=s.scrollLeft*n,e+=s.scrollTop*o}while(s!==i&&(s=s.parentNode));return[t,e]}function Uft(s,t){for(var e in s)if(s.hasOwnProperty(e)){for(var i in t)if(t.hasOwnProperty(i)&&t[i]===s[e][i])return Number(e)}return-1}function vl(s,t){if(!s||!s.getBoundingClientRect)return po();var e=s,i=!1;do if(e.clientWidth<e.scrollWidth||e.clientHeight<e.scrollHeight){var r=Ut(e);if(e.clientWidth<e.scrollWidth&&(r.overflowX=="auto"||r.overflowX=="scroll")||e.clientHeight<e.scrollHeight&&(r.overflowY=="auto"||r.overflowY=="scroll")){if(!e.getBoundingClientRect||e===document.body)return po();if(i||t)return e;i=!0}}while(e=e.parentNode);return po()}function Vft(s,t){if(s&&t)for(var e in t)t.hasOwnProperty(e)&&(s[e]=t[e]);return s}function Ux(s,t){return Math.round(s.top)===Math.round(t.top)&&Math.round(s.left)===Math.round(t.left)&&Math.round(s.height)===Math.round(t.height)&&Math.round(s.width)===Math.round(t.width)}var Fp;function k$(s,t){return function(){if(!Fp){var e=arguments,i=this;e.length===1?s.call(i,e[0]):s.apply(i,e),Fp=setTimeout(function(){Fp=void 0},t)}}}function Hft(){clearTimeout(Fp),Fp=void 0}function N$(s,t,e){s.scrollLeft+=t,s.scrollTop+=e}function D$(s){var t=window.Polymer,e=window.jQuery||window.Zepto;return t&&t.dom?t.dom(s).cloneNode(!0):e?e(s).clone(!0)[0]:s.cloneNode(!0)}function $$(s,t,e){var i={};return Array.from(s.children).forEach(function(r){var n,o,a,l;if(!(!Rn(r,t.draggable,s,!1)||r.animated||r===e)){var h=rs(r);i.left=Math.min((n=i.left)!==null&&n!==void 0?n:1/0,h.left),i.top=Math.min((o=i.top)!==null&&o!==void 0?o:1/0,h.top),i.right=Math.max((a=i.right)!==null&&a!==void 0?a:-1/0,h.right),i.bottom=Math.max((l=i.bottom)!==null&&l!==void 0?l:-1/0,h.bottom)}}),i.width=i.right-i.left,i.height=i.bottom-i.top,i.x=i.left,i.y=i.top,i}var Vr="Sortable"+new Date().getTime();function Wft(){var s=[],t;return{captureAnimationState:function(){if(s=[],!!this.options.animation){var i=[].slice.call(this.el.children);i.forEach(function(r){if(!(Ut(r,"display")==="none"||r===Vt.ghost)){s.push({target:r,rect:rs(r)});var n=wo({},s[s.length-1].rect);if(r.thisAnimationDuration){var o=bu(r,!0);o&&(n.top-=o.f,n.left-=o.e)}r.fromRect=n}})}},addAnimationState:function(i){s.push(i)},removeAnimationState:function(i){s.splice(Uft(s,{target:i}),1)},animateAll:function(i){var r=this;if(!this.options.animation){clearTimeout(t),typeof i=="function"&&i();return}var n=!1,o=0;s.forEach(function(a){var l=0,h=a.target,c=h.fromRect,u=rs(h),d=h.prevFromRect,p=h.prevToRect,g=a.rect,f=bu(h,!0);f&&(u.top-=f.f,u.left-=f.e),h.toRect=u,h.thisAnimationDuration&&Ux(d,u)&&!Ux(c,u)&&(g.top-u.top)/(g.left-u.left)===(c.top-u.top)/(c.left-u.left)&&(l=qft(g,d,p,r.options)),Ux(u,c)||(h.prevFromRect=c,h.prevToRect=u,l||(l=r.options.animation),r.animate(h,g,u,l)),l&&(n=!0,o=Math.max(o,l),clearTimeout(h.animationResetTimer),h.animationResetTimer=setTimeout(function(){h.animationTime=0,h.prevFromRect=null,h.fromRect=null,h.prevToRect=null,h.thisAnimationDuration=null},l),h.thisAnimationDuration=l)}),clearTimeout(t),n?t=setTimeout(function(){typeof i=="function"&&i()},o):typeof i=="function"&&i(),s=[]},animate:function(i,r,n,o){if(o){Ut(i,"transition",""),Ut(i,"transform","");var a=bu(this.el),l=a&&a.a,h=a&&a.d,c=(r.left-n.left)/(l||1),u=(r.top-n.top)/(h||1);i.animatingX=!!c,i.animatingY=!!u,Ut(i,"transform","translate3d("+c+"px,"+u+"px,0)"),this.forRepaintDummy=Xft(i),Ut(i,"transition","transform "+o+"ms"+(this.options.easing?" "+this.options.easing:"")),Ut(i,"transform","translate3d(0,0,0)"),typeof i.animated=="number"&&clearTimeout(i.animated),i.animated=setTimeout(function(){Ut(i,"transition",""),Ut(i,"transform",""),i.animated=!1,i.animatingX=!1,i.animatingY=!1},o)}}}}function Xft(s){return s.offsetWidth}function qft(s,t,e,i){return Math.sqrt(Math.pow(t.top-s.top,2)+Math.pow(t.left-s.left,2))/Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))*i.animation}var yc=[],Vx={initializeByDefault:!0},Af={mount:function(t){for(var e in Vx)Vx.hasOwnProperty(e)&&!(e in t)&&(t[e]=Vx[e]);yc.forEach(function(i){if(i.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")}),yc.push(t)},pluginEvent:function(t,e,i){var r=this;this.eventCanceled=!1,i.cancel=function(){r.eventCanceled=!0};var n=t+"Global";yc.forEach(function(o){e[o.pluginName]&&(e[o.pluginName][n]&&e[o.pluginName][n](wo({sortable:e},i)),e.options[o.pluginName]&&e[o.pluginName][t]&&e[o.pluginName][t](wo({sortable:e},i)))})},initializePlugins:function(t,e,i,r){yc.forEach(function(a){var l=a.pluginName;if(!(!t.options[l]&&!a.initializeByDefault)){var h=new a(t,e,t.options);h.sortable=t,h.options=t.options,t[l]=h,ya(i,h.defaults)}});for(var n in t.options)if(t.options.hasOwnProperty(n)){var o=this.modifyOption(t,n,t.options[n]);typeof o<"u"&&(t.options[n]=o)}},getEventProperties:function(t,e){var i={};return yc.forEach(function(r){typeof r.eventProperties=="function"&&ya(i,r.eventProperties.call(e[r.pluginName],t))}),i},modifyOption:function(t,e,i){var r;return yc.forEach(function(n){t[n.pluginName]&&n.optionListeners&&typeof n.optionListeners[e]=="function"&&(r=n.optionListeners[e].call(t[n.pluginName],i))}),r}};function Yft(s){var t=s.sortable,e=s.rootEl,i=s.name,r=s.targetEl,n=s.cloneEl,o=s.toEl,a=s.fromEl,l=s.oldIndex,h=s.newIndex,c=s.oldDraggableIndex,u=s.newDraggableIndex,d=s.originalEvent,p=s.putSortable,g=s.extraEventProperties;if(t=t||e&&e[Vr],!!t){var f,m=t.options,_="on"+i.charAt(0).toUpperCase()+i.substr(1);window.CustomEvent&&!Na&&!If?f=new CustomEvent(i,{bubbles:!0,cancelable:!0}):(f=document.createEvent("Event"),f.initEvent(i,!0,!0)),f.to=o||e,f.from=a||e,f.item=r||e,f.clone=n,f.oldIndex=l,f.newIndex=h,f.oldDraggableIndex=c,f.newDraggableIndex=u,f.originalEvent=d,f.pullMode=p?p.lastPutMode:void 0;var y=wo(wo({},g),Af.getEventProperties(i,t));for(var v in y)f[v]=y[v];e&&e.dispatchEvent(f),m[_]&&m[_].call(t,f)}}var Zft=["evt"],gr=function(t,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=i.evt,n=Gft(i,Zft);Af.pluginEvent.bind(Vt)(t,e,wo({dragEl:rt,parentEl:$i,ghostEl:se,rootEl:wi,nextEl:nh,lastDownEl:Xm,cloneEl:Ri,cloneHidden:rl,dragStarted:ap,putSortable:Cs,activeSortable:Vt.active,originalEvent:r,oldIndex:ru,oldDraggableIndex:kp,newIndex:Dr,newDraggableIndex:Qa,hideGhostForTarget:B$,unhideGhostForTarget:U$,cloneNowHidden:function(){rl=!0},cloneNowShown:function(){rl=!1},dispatchSortableEvent:function(a){tr({sortable:e,name:a,originalEvent:r})}},n))};function tr(s){Yft(wo({putSortable:Cs,cloneEl:Ri,targetEl:rt,rootEl:wi,oldIndex:ru,oldDraggableIndex:kp,newIndex:Dr,newDraggableIndex:Qa},s))}var rt,$i,se,wi,nh,Xm,Ri,rl,ru,Dr,kp,Qa,Mm,Cs,Oc=!1,p_=!1,g_=[],th,Sn,Hx,Wx,mI,_I,ap,xc,Np,Dp=!1,Im=!1,qm,Gs,Xx=[],Nb=!1,f_=[],Yy=typeof document<"u",Am=L$,yI=If||Na?"cssFloat":"float",Kft=Yy&&!P$&&!L$&&"draggable"in document.createElement("div"),j$=function(){if(Yy){if(Na)return!1;var s=document.createElement("x");return s.style.cssText="pointer-events:auto",s.style.pointerEvents==="auto"}}(),G$=function(t,e){var i=Ut(t),r=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),n=td(t,0,e),o=td(t,1,e),a=n&&Ut(n),l=o&&Ut(o),h=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+rs(n).width,c=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+rs(o).width;if(i.display==="flex")return i.flexDirection==="column"||i.flexDirection==="column-reverse"?"vertical":"horizontal";if(i.display==="grid")return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(n&&a.float&&a.float!=="none"){var u=a.float==="left"?"left":"right";return o&&(l.clear==="both"||l.clear===u)?"vertical":"horizontal"}return n&&(a.display==="block"||a.display==="flex"||a.display==="table"||a.display==="grid"||h>=r&&i[yI]==="none"||o&&i[yI]==="none"&&h+c>r)?"vertical":"horizontal"},Jft=function(t,e,i){var r=i?t.left:t.top,n=i?t.right:t.bottom,o=i?t.width:t.height,a=i?e.left:e.top,l=i?e.right:e.bottom,h=i?e.width:e.height;return r===a||n===l||r+o/2===a+h/2},Qft=function(t,e){var i;return g_.some(function(r){var n=r[Vr].options.emptyInsertThreshold;if(!(!n||v2(r))){var o=rs(r),a=t>=o.left-n&&t<=o.right+n,l=e>=o.top-n&&e<=o.bottom+n;if(a&&l)return i=r}}),i},z$=function(t){function e(n,o){return function(a,l,h,c){var u=a.options.group.name&&l.options.group.name&&a.options.group.name===l.options.group.name;if(n==null&&(o||u))return!0;if(n==null||n===!1)return!1;if(o&&n==="clone")return n;if(typeof n=="function")return e(n(a,l,h,c),o)(a,l,h,c);var d=(o?a:l).options.group.name;return n===!0||typeof n=="string"&&n===d||n.join&&n.indexOf(d)>-1}}var i={},r=t.group;(!r||Wm(r)!="object")&&(r={name:r}),i.name=r.name,i.checkPull=e(r.pull,!0),i.checkPut=e(r.put),i.revertClone=r.revertClone,t.group=i},B$=function(){!j$&&se&&Ut(se,"display","none")},U$=function(){!j$&&se&&Ut(se,"display","")};Yy&&!P$&&document.addEventListener("click",function(s){if(p_)return s.preventDefault(),s.stopPropagation&&s.stopPropagation(),s.stopImmediatePropagation&&s.stopImmediatePropagation(),p_=!1,!1},!0);var eh=function(t){if(rt){t=t.touches?t.touches[0]:t;var e=Qft(t.clientX,t.clientY);if(e){var i={};for(var r in t)t.hasOwnProperty(r)&&(i[r]=t[r]);i.target=i.rootEl=e,i.preventDefault=void 0,i.stopPropagation=void 0,e[Vr]._onDragOver(i)}}},tmt=function(t){rt&&rt.parentNode[Vr]._isOutsideThisEl(t.target)};function Vt(s,t){if(!(s&&s.nodeType&&s.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(s));this.el=s,this.options=t=ya({},t),s[Vr]=this;var e={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(s.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return G$(s,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(o,a){o.setData("Text",a.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:Vt.supportPointer!==!1&&"PointerEvent"in window&&!Op,emptyInsertThreshold:5};Af.initializePlugins(this,s,e);for(var i in e)!(i in t)&&(t[i]=e[i]);z$(t);for(var r in this)r.charAt(0)==="_"&&typeof this[r]=="function"&&(this[r]=this[r].bind(this));this.nativeDraggable=t.forceFallback?!1:Kft,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?Be(s,"pointerdown",this._onTapStart):(Be(s,"mousedown",this._onTapStart),Be(s,"touchstart",this._onTapStart)),this.nativeDraggable&&(Be(s,"dragover",this),Be(s,"dragenter",this)),g_.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),ya(this,Wft())}Vt.prototype={constructor:Vt,_isOutsideThisEl:function(t){!this.el.contains(t)&&t!==this.el&&(xc=null)},_getDirection:function(t,e){return typeof this.options.direction=="function"?this.options.direction.call(this,t,e,rt):this.options.direction},_onTapStart:function(t){if(t.cancelable){var e=this,i=this.el,r=this.options,n=r.preventOnFilter,o=t.type,a=t.touches&&t.touches[0]||t.pointerType&&t.pointerType==="touch"&&t,l=(a||t).target,h=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||l,c=r.filter;if(lmt(i),!rt&&!(/mousedown|pointerdown/.test(o)&&t.button!==0||r.disabled)&&!h.isContentEditable&&!(!this.nativeDraggable&&Op&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=Rn(l,r.draggable,i,!1),!(l&&l.animated)&&Xm!==l)){if(ru=tn(l),kp=tn(l,r.draggable),typeof c=="function"){if(c.call(this,t,l,this)){tr({sortable:e,rootEl:h,name:"filter",targetEl:l,toEl:i,fromEl:i}),gr("filter",e,{evt:t}),n&&t.cancelable&&t.preventDefault();return}}else if(c&&(c=c.split(",").some(function(u){if(u=Rn(h,u.trim(),i,!1),u)return tr({sortable:e,rootEl:u,name:"filter",targetEl:l,fromEl:i,toEl:i}),gr("filter",e,{evt:t}),!0}),c)){n&&t.cancelable&&t.preventDefault();return}r.handle&&!Rn(h,r.handle,i,!1)||this._prepareDragStart(t,a,l)}}},_prepareDragStart:function(t,e,i){var r=this,n=r.el,o=r.options,a=n.ownerDocument,l;if(i&&!rt&&i.parentNode===n){var h=rs(i);if(wi=n,rt=i,$i=rt.parentNode,nh=rt.nextSibling,Xm=i,Mm=o.group,Vt.dragged=rt,th={target:rt,clientX:(e||t).clientX,clientY:(e||t).clientY},mI=th.clientX-h.left,_I=th.clientY-h.top,this._lastX=(e||t).clientX,this._lastY=(e||t).clientY,rt.style["will-change"]="all",l=function(){if(gr("delayEnded",r,{evt:t}),Vt.eventCanceled){r._onDrop();return}r._disableDelayedDragEvents(),!dI&&r.nativeDraggable&&(rt.draggable=!0),r._triggerDragStart(t,e),tr({sortable:r,name:"choose",originalEvent:t}),Fr(rt,o.chosenClass,!0)},o.ignore.split(",").forEach(function(c){F$(rt,c.trim(),qx)}),Be(a,"dragover",eh),Be(a,"mousemove",eh),Be(a,"touchmove",eh),Be(a,"mouseup",r._onDrop),Be(a,"touchend",r._onDrop),Be(a,"touchcancel",r._onDrop),dI&&this.nativeDraggable&&(this.options.touchStartThreshold=4,rt.draggable=!0),gr("delayStart",this,{evt:t}),o.delay&&(!o.delayOnTouchOnly||e)&&(!this.nativeDraggable||!(If||Na))){if(Vt.eventCanceled){this._onDrop();return}Be(a,"mouseup",r._disableDelayedDrag),Be(a,"touchend",r._disableDelayedDrag),Be(a,"touchcancel",r._disableDelayedDrag),Be(a,"mousemove",r._delayedDragTouchMoveHandler),Be(a,"touchmove",r._delayedDragTouchMoveHandler),o.supportPointer&&Be(a,"pointermove",r._delayedDragTouchMoveHandler),r._dragStartTimer=setTimeout(l,o.delay)}else l()}},_delayedDragTouchMoveHandler:function(t){var e=t.touches?t.touches[0]:t;Math.max(Math.abs(e.clientX-this._lastX),Math.abs(e.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){rt&&qx(rt),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;Ie(t,"mouseup",this._disableDelayedDrag),Ie(t,"touchend",this._disableDelayedDrag),Ie(t,"touchcancel",this._disableDelayedDrag),Ie(t,"mousemove",this._delayedDragTouchMoveHandler),Ie(t,"touchmove",this._delayedDragTouchMoveHandler),Ie(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,e){e=e||t.pointerType=="touch"&&t,!this.nativeDraggable||e?this.options.supportPointer?Be(document,"pointermove",this._onTouchMove):e?Be(document,"touchmove",this._onTouchMove):Be(document,"mousemove",this._onTouchMove):(Be(rt,"dragend",this),Be(wi,"dragstart",this._onDragStart));try{document.selection?Ym(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(t,e){if(Oc=!1,wi&&rt){gr("dragStarted",this,{evt:e}),this.nativeDraggable&&Be(document,"dragover",tmt);var i=this.options;!t&&Fr(rt,i.dragClass,!1),Fr(rt,i.ghostClass,!0),Vt.active=this,t&&this._appendGhost(),tr({sortable:this,name:"start",originalEvent:e})}else this._nulling()},_emulateDragOver:function(){if(Sn){this._lastX=Sn.clientX,this._lastY=Sn.clientY,B$();for(var t=document.elementFromPoint(Sn.clientX,Sn.clientY),e=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(Sn.clientX,Sn.clientY),t!==e);)e=t;if(rt.parentNode[Vr]._isOutsideThisEl(t),e)do{if(e[Vr]){var i=void 0;if(i=e[Vr]._onDragOver({clientX:Sn.clientX,clientY:Sn.clientY,target:t,rootEl:e}),i&&!this.options.dragoverBubble)break}t=e}while(e=e.parentNode);U$()}},_onTouchMove:function(t){if(th){var e=this.options,i=e.fallbackTolerance,r=e.fallbackOffset,n=t.touches?t.touches[0]:t,o=se&&bu(se,!0),a=se&&o&&o.a,l=se&&o&&o.d,h=Am&&Gs&&fI(Gs),c=(n.clientX-th.clientX+r.x)/(a||1)+(h?h[0]-Xx[0]:0)/(a||1),u=(n.clientY-th.clientY+r.y)/(l||1)+(h?h[1]-Xx[1]:0)/(l||1);if(!Vt.active&&!Oc){if(i&&Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))<i)return;this._onDragStart(t,!0)}if(se){o?(o.e+=c-(Hx||0),o.f+=u-(Wx||0)):o={a:1,b:0,c:0,d:1,e:c,f:u};var d="matrix(".concat(o.a,",").concat(o.b,",").concat(o.c,",").concat(o.d,",").concat(o.e,",").concat(o.f,")");Ut(se,"webkitTransform",d),Ut(se,"mozTransform",d),Ut(se,"msTransform",d),Ut(se,"transform",d),Hx=c,Wx=u,Sn=n}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!se){var t=this.options.fallbackOnBody?document.body:wi,e=rs(rt,!0,Am,!0,t),i=this.options;if(Am){for(Gs=t;Ut(Gs,"position")==="static"&&Ut(Gs,"transform")==="none"&&Gs!==document;)Gs=Gs.parentNode;Gs!==document.body&&Gs!==document.documentElement?(Gs===document&&(Gs=po()),e.top+=Gs.scrollTop,e.left+=Gs.scrollLeft):Gs=po(),Xx=fI(Gs)}se=rt.cloneNode(!0),Fr(se,i.ghostClass,!1),Fr(se,i.fallbackClass,!0),Fr(se,i.dragClass,!0),Ut(se,"transition",""),Ut(se,"transform",""),Ut(se,"box-sizing","border-box"),Ut(se,"margin",0),Ut(se,"top",e.top),Ut(se,"left",e.left),Ut(se,"width",e.width),Ut(se,"height",e.height),Ut(se,"opacity","0.8"),Ut(se,"position",Am?"absolute":"fixed"),Ut(se,"zIndex","100000"),Ut(se,"pointerEvents","none"),Vt.ghost=se,t.appendChild(se),Ut(se,"transform-origin",mI/parseInt(se.style.width)*100+"% "+_I/parseInt(se.style.height)*100+"%")}},_onDragStart:function(t,e){var i=this,r=t.dataTransfer,n=i.options;if(gr("dragStart",this,{evt:t}),Vt.eventCanceled){this._onDrop();return}gr("setupClone",this),Vt.eventCanceled||(Ri=D$(rt),Ri.removeAttribute("id"),Ri.draggable=!1,Ri.style["will-change"]="",this._hideClone(),Fr(Ri,this.options.chosenClass,!1),Vt.clone=Ri),i.cloneId=Ym(function(){gr("clone",i),!Vt.eventCanceled&&(i.options.removeCloneOnHide||wi.insertBefore(Ri,rt),i._hideClone(),tr({sortable:i,name:"clone"}))}),!e&&Fr(rt,n.dragClass,!0),e?(p_=!0,i._loopId=setInterval(i._emulateDragOver,50)):(Ie(document,"mouseup",i._onDrop),Ie(document,"touchend",i._onDrop),Ie(document,"touchcancel",i._onDrop),r&&(r.effectAllowed="move",n.setData&&n.setData.call(i,r,rt)),Be(document,"drop",i),Ut(rt,"transform","translateZ(0)")),Oc=!0,i._dragStartId=Ym(i._dragStarted.bind(i,e,t)),Be(document,"selectstart",i),ap=!0,Op&&Ut(document.body,"user-select","none")},_onDragOver:function(t){var e=this.el,i=t.target,r,n,o,a=this.options,l=a.group,h=Vt.active,c=Mm===l,u=a.sort,d=Cs||h,p,g=this,f=!1;if(Nb)return;function m(j,z){gr(j,g,wo({evt:t,isOwner:c,axis:p?"vertical":"horizontal",revert:o,dragRect:r,targetRect:n,canSort:u,fromSortable:d,target:i,completed:y,onMove:function(H,Y){return Lm(wi,e,rt,r,H,rs(H),t,Y)},changed:v},z))}function _(){m("dragOverAnimationCapture"),g.captureAnimationState(),g!==d&&d.captureAnimationState()}function y(j){return m("dragOverCompleted",{insertion:j}),j&&(c?h._hideClone():h._showClone(g),g!==d&&(Fr(rt,Cs?Cs.options.ghostClass:h.options.ghostClass,!1),Fr(rt,a.ghostClass,!0)),Cs!==g&&g!==Vt.active?Cs=g:g===Vt.active&&Cs&&(Cs=null),d===g&&(g._ignoreWhileAnimating=i),g.animateAll(function(){m("dragOverAnimationComplete"),g._ignoreWhileAnimating=null}),g!==d&&(d.animateAll(),d._ignoreWhileAnimating=null)),(i===rt&&!rt.animated||i===e&&!i.animated)&&(xc=null),!a.dragoverBubble&&!t.rootEl&&i!==document&&(rt.parentNode[Vr]._isOutsideThisEl(t.target),!j&&eh(t)),!a.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),f=!0}function v(){Dr=tn(rt),Qa=tn(rt,a.draggable),tr({sortable:g,name:"change",toEl:e,newIndex:Dr,newDraggableIndex:Qa,originalEvent:t})}if(t.preventDefault!==void 0&&t.cancelable&&t.preventDefault(),i=Rn(i,a.draggable,e,!0),m("dragOver"),Vt.eventCanceled)return f;if(rt.contains(t.target)||i.animated&&i.animatingX&&i.animatingY||g._ignoreWhileAnimating===i)return y(!1);if(p_=!1,h&&!a.disabled&&(c?u||(o=$i!==wi):Cs===this||(this.lastPutMode=Mm.checkPull(this,h,rt,t))&&l.checkPut(this,h,rt,t))){if(p=this._getDirection(t,i)==="vertical",r=rs(rt),m("dragOverValid"),Vt.eventCanceled)return f;if(o)return $i=wi,_(),this._hideClone(),m("revert"),Vt.eventCanceled||(nh?wi.insertBefore(rt,nh):wi.appendChild(rt)),y(!0);var b=v2(e,a.draggable);if(!b||rmt(t,p,this)&&!b.animated){if(b===rt)return y(!1);if(b&&e===t.target&&(i=b),i&&(n=rs(i)),Lm(wi,e,rt,r,i,n,t,!!i)!==!1)return _(),b&&b.nextSibling?e.insertBefore(rt,b.nextSibling):e.appendChild(rt),$i=e,v(),y(!0)}else if(b&&smt(t,p,this)){var E=td(e,0,a,!0);if(E===rt)return y(!1);if(i=E,n=rs(i),Lm(wi,e,rt,r,i,n,t,!1)!==!1)return _(),e.insertBefore(rt,E),$i=e,v(),y(!0)}else if(i.parentNode===e){n=rs(i);var S=0,T,R=rt.parentNode!==e,M=!Jft(rt.animated&&rt.toRect||r,i.animated&&i.toRect||n,p),A=p?"top":"left",O=gI(i,"top","top")||gI(rt,"top","top"),N=O?O.scrollTop:void 0;xc!==i&&(T=n[A],Dp=!1,Im=!M&&a.invertSwap||R),S=nmt(t,i,n,p,M?1:a.swapThreshold,a.invertedSwapThreshold==null?a.swapThreshold:a.invertedSwapThreshold,Im,xc===i);var x;if(S!==0){var w=tn(rt);do w-=S,x=$i.children[w];while(x&&(Ut(x,"display")==="none"||x===se))}if(S===0||x===i)return y(!1);xc=i,Np=S;var C=i.nextElementSibling,I=!1;I=S===1;var L=Lm(wi,e,rt,r,i,n,t,I);if(L!==!1)return(L===1||L===-1)&&(I=L===1),Nb=!0,setTimeout(imt,30),_(),I&&!C?e.appendChild(rt):i.parentNode.insertBefore(rt,I?C:i),O&&N$(O,0,N-O.scrollTop),$i=rt.parentNode,T!==void 0&&!Im&&(qm=Math.abs(T-rs(i)[A])),v(),y(!0)}if(e.contains(rt))return y(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){Ie(document,"mousemove",this._onTouchMove),Ie(document,"touchmove",this._onTouchMove),Ie(document,"pointermove",this._onTouchMove),Ie(document,"dragover",eh),Ie(document,"mousemove",eh),Ie(document,"touchmove",eh)},_offUpEvents:function(){var t=this.el.ownerDocument;Ie(t,"mouseup",this._onDrop),Ie(t,"touchend",this._onDrop),Ie(t,"pointerup",this._onDrop),Ie(t,"touchcancel",this._onDrop),Ie(document,"selectstart",this)},_onDrop:function(t){var e=this.el,i=this.options;if(Dr=tn(rt),Qa=tn(rt,i.draggable),gr("drop",this,{evt:t}),$i=rt&&rt.parentNode,Dr=tn(rt),Qa=tn(rt,i.draggable),Vt.eventCanceled){this._nulling();return}Oc=!1,Im=!1,Dp=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Db(this.cloneId),Db(this._dragStartId),this.nativeDraggable&&(Ie(document,"drop",this),Ie(e,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Op&&Ut(document.body,"user-select",""),Ut(rt,"transform",""),t&&(ap&&(t.cancelable&&t.preventDefault(),!i.dropBubble&&t.stopPropagation()),se&&se.parentNode&&se.parentNode.removeChild(se),(wi===$i||Cs&&Cs.lastPutMode!=="clone")&&Ri&&Ri.parentNode&&Ri.parentNode.removeChild(Ri),rt&&(this.nativeDraggable&&Ie(rt,"dragend",this),qx(rt),rt.style["will-change"]="",ap&&!Oc&&Fr(rt,Cs?Cs.options.ghostClass:this.options.ghostClass,!1),Fr(rt,this.options.chosenClass,!1),tr({sortable:this,name:"unchoose",toEl:$i,newIndex:null,newDraggableIndex:null,originalEvent:t}),wi!==$i?(Dr>=0&&(tr({rootEl:$i,name:"add",toEl:$i,fromEl:wi,originalEvent:t}),tr({sortable:this,name:"remove",toEl:$i,originalEvent:t}),tr({rootEl:$i,name:"sort",toEl:$i,fromEl:wi,originalEvent:t}),tr({sortable:this,name:"sort",toEl:$i,originalEvent:t})),Cs&&Cs.save()):Dr!==ru&&Dr>=0&&(tr({sortable:this,name:"update",toEl:$i,originalEvent:t}),tr({sortable:this,name:"sort",toEl:$i,originalEvent:t})),Vt.active&&((Dr==null||Dr===-1)&&(Dr=ru,Qa=kp),tr({sortable:this,name:"end",toEl:$i,originalEvent:t}),this.save()))),this._nulling()},_nulling:function(){gr("nulling",this),wi=rt=$i=se=nh=Ri=Xm=rl=th=Sn=ap=Dr=Qa=ru=kp=xc=Np=Cs=Mm=Vt.dragged=Vt.ghost=Vt.clone=Vt.active=null,f_.forEach(function(t){t.checked=!0}),f_.length=Hx=Wx=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":rt&&(this._onDragOver(t),emt(t));break;case"selectstart":t.preventDefault();break}},toArray:function(){for(var t=[],e,i=this.el.children,r=0,n=i.length,o=this.options;r<n;r++)e=i[r],Rn(e,o.draggable,this.el,!1)&&t.push(e.getAttribute(o.dataIdAttr)||amt(e));return t},sort:function(t,e){var i={},r=this.el;this.toArray().forEach(function(n,o){var a=r.children[o];Rn(a,this.options.draggable,r,!1)&&(i[n]=a)},this),e&&this.captureAnimationState(),t.forEach(function(n){i[n]&&(r.removeChild(i[n]),r.appendChild(i[n]))}),e&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,e){return Rn(t,e||this.options.draggable,this.el,!1)},option:function(t,e){var i=this.options;if(e===void 0)return i[t];var r=Af.modifyOption(this,t,e);typeof r<"u"?i[t]=r:i[t]=e,t==="group"&&z$(i)},destroy:function(){gr("destroy",this);var t=this.el;t[Vr]=null,Ie(t,"mousedown",this._onTapStart),Ie(t,"touchstart",this._onTapStart),Ie(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(Ie(t,"dragover",this),Ie(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),g_.splice(g_.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!rl){if(gr("hideClone",this),Vt.eventCanceled)return;Ut(Ri,"display","none"),this.options.removeCloneOnHide&&Ri.parentNode&&Ri.parentNode.removeChild(Ri),rl=!0}},_showClone:function(t){if(t.lastPutMode!=="clone"){this._hideClone();return}if(rl){if(gr("showClone",this),Vt.eventCanceled)return;rt.parentNode==wi&&!this.options.group.revertClone?wi.insertBefore(Ri,rt):nh?wi.insertBefore(Ri,nh):wi.appendChild(Ri),this.options.group.revertClone&&this.animate(rt,Ri),Ut(Ri,"display",""),rl=!1}}};function emt(s){s.dataTransfer&&(s.dataTransfer.dropEffect="move"),s.cancelable&&s.preventDefault()}function Lm(s,t,e,i,r,n,o,a){var l,h=s[Vr],c=h.options.onMove,u;return window.CustomEvent&&!Na&&!If?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=t,l.from=s,l.dragged=e,l.draggedRect=i,l.related=r||t,l.relatedRect=n||rs(t),l.willInsertAfter=a,l.originalEvent=o,s.dispatchEvent(l),c&&(u=c.call(h,l,o)),u}function qx(s){s.draggable=!1}function imt(){Nb=!1}function smt(s,t,e){var i=rs(td(e.el,0,e.options,!0)),r=$$(e.el,e.options,se),n=10;return t?s.clientX<r.left-n||s.clientY<i.top&&s.clientX<i.right:s.clientY<r.top-n||s.clientY<i.bottom&&s.clientX<i.left}function rmt(s,t,e){var i=rs(v2(e.el,e.options.draggable)),r=$$(e.el,e.options,se),n=10;return t?s.clientX>r.right+n||s.clientY>i.bottom&&s.clientX>i.left:s.clientY>r.bottom+n||s.clientX>i.right&&s.clientY>i.top}function nmt(s,t,e,i,r,n,o,a){var l=i?s.clientY:s.clientX,h=i?e.height:e.width,c=i?e.top:e.left,u=i?e.bottom:e.right,d=!1;if(!o){if(a&&qm<h*r){if(!Dp&&(Np===1?l>c+h*n/2:l<u-h*n/2)&&(Dp=!0),Dp)d=!0;else if(Np===1?l<c+qm:l>u-qm)return-Np}else if(l>c+h*(1-r)/2&&l<u-h*(1-r)/2)return omt(t)}return d=d||o,d&&(l<c+h*n/2||l>u-h*n/2)?l>c+h/2?1:-1:0}function omt(s){return tn(rt)<tn(s)?1:-1}function amt(s){for(var t=s.tagName+s.className+s.src+s.href+s.textContent,e=t.length,i=0;e--;)i+=t.charCodeAt(e);return i.toString(36)}function lmt(s){f_.length=0;for(var t=s.getElementsByTagName("input"),e=t.length;e--;){var i=t[e];i.checked&&f_.push(i)}}function Ym(s){return setTimeout(s,0)}function Db(s){return clearTimeout(s)}Yy&&Be(document,"touchmove",function(s){(Vt.active||Oc)&&s.cancelable&&s.preventDefault()});Vt.utils={on:Be,off:Ie,css:Ut,find:F$,is:function(t,e){return!!Rn(t,e,t,!1)},extend:Vft,throttle:k$,closest:Rn,toggleClass:Fr,clone:D$,index:tn,nextTick:Ym,cancelNextTick:Db,detectDirection:G$,getChild:td};Vt.get=function(s){return s[Vr]};Vt.mount=function(){for(var s=arguments.length,t=new Array(s),e=0;e<s;e++)t[e]=arguments[e];t[0].constructor===Array&&(t=t[0]),t.forEach(function(i){if(!i.prototype||!i.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(i));i.utils&&(Vt.utils=wo(wo({},Vt.utils),i.utils)),Af.mount(i)})};Vt.create=function(s,t){return new Vt(s,t)};Vt.version=zft;var es=[],lp,$b,jb=!1,Yx,Zx,m_,hp;function hmt(){function s(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var t in this)t.charAt(0)==="_"&&typeof this[t]=="function"&&(this[t]=this[t].bind(this))}return s.prototype={dragStarted:function(e){var i=e.originalEvent;this.sortable.nativeDraggable?Be(document,"dragover",this._handleAutoScroll):this.options.supportPointer?Be(document,"pointermove",this._handleFallbackAutoScroll):i.touches?Be(document,"touchmove",this._handleFallbackAutoScroll):Be(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var i=e.originalEvent;!this.options.dragOverBubble&&!i.rootEl&&this._handleAutoScroll(i)},drop:function(){this.sortable.nativeDraggable?Ie(document,"dragover",this._handleAutoScroll):(Ie(document,"pointermove",this._handleFallbackAutoScroll),Ie(document,"touchmove",this._handleFallbackAutoScroll),Ie(document,"mousemove",this._handleFallbackAutoScroll)),xI(),Zm(),Hft()},nulling:function(){m_=$b=lp=jb=hp=Yx=Zx=null,es.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,i){var r=this,n=(e.touches?e.touches[0]:e).clientX,o=(e.touches?e.touches[0]:e).clientY,a=document.elementFromPoint(n,o);if(m_=e,i||this.options.forceAutoScrollFallback||If||Na||Op){Kx(e,this.options,a,i);var l=vl(a,!0);jb&&(!hp||n!==Yx||o!==Zx)&&(hp&&xI(),hp=setInterval(function(){var h=vl(document.elementFromPoint(n,o),!0);h!==l&&(l=h,Zm()),Kx(e,r.options,h,i)},10),Yx=n,Zx=o)}else{if(!this.options.bubbleScroll||vl(a,!0)===po()){Zm();return}Kx(e,this.options,vl(a,!1),!1)}}},ya(s,{pluginName:"scroll",initializeByDefault:!0})}function Zm(){es.forEach(function(s){clearInterval(s.pid)}),es=[]}function xI(){clearInterval(hp)}var Kx=k$(function(s,t,e,i){if(t.scroll){var r=(s.touches?s.touches[0]:s).clientX,n=(s.touches?s.touches[0]:s).clientY,o=t.scrollSensitivity,a=t.scrollSpeed,l=po(),h=!1,c;$b!==e&&($b=e,Zm(),lp=t.scroll,c=t.scrollFn,lp===!0&&(lp=vl(e,!0)));var u=0,d=lp;do{var p=d,g=rs(p),f=g.top,m=g.bottom,_=g.left,y=g.right,v=g.width,b=g.height,E=void 0,S=void 0,T=p.scrollWidth,R=p.scrollHeight,M=Ut(p),A=p.scrollLeft,O=p.scrollTop;p===l?(E=v<T&&(M.overflowX==="auto"||M.overflowX==="scroll"||M.overflowX==="visible"),S=b<R&&(M.overflowY==="auto"||M.overflowY==="scroll"||M.overflowY==="visible")):(E=v<T&&(M.overflowX==="auto"||M.overflowX==="scroll"),S=b<R&&(M.overflowY==="auto"||M.overflowY==="scroll"));var N=E&&(Math.abs(y-r)<=o&&A+v<T)-(Math.abs(_-r)<=o&&!!A),x=S&&(Math.abs(m-n)<=o&&O+b<R)-(Math.abs(f-n)<=o&&!!O);if(!es[u])for(var w=0;w<=u;w++)es[w]||(es[w]={});(es[u].vx!=N||es[u].vy!=x||es[u].el!==p)&&(es[u].el=p,es[u].vx=N,es[u].vy=x,clearInterval(es[u].pid),(N!=0||x!=0)&&(h=!0,es[u].pid=setInterval((function(){i&&this.layer===0&&Vt.active._onTouchMove(m_);var C=es[this.layer].vy?es[this.layer].vy*a:0,I=es[this.layer].vx?es[this.layer].vx*a:0;typeof c=="function"&&c.call(Vt.dragged.parentNode[Vr],I,C,s,m_,es[this.layer].el)!=="continue"||N$(es[this.layer].el,I,C)}).bind({layer:u}),24))),u++}while(t.bubbleScroll&&d!==l&&(d=vl(d,!1)));jb=h}},30),V$=function(t){var e=t.originalEvent,i=t.putSortable,r=t.dragEl,n=t.activeSortable,o=t.dispatchSortableEvent,a=t.hideGhostForTarget,l=t.unhideGhostForTarget;if(e){var h=i||n;a();var c=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e,u=document.elementFromPoint(c.clientX,c.clientY);l(),h&&!h.el.contains(u)&&(o("spill"),this.onSpill({dragEl:r,putSortable:i}))}};function b2(){}b2.prototype={startIndex:null,dragStart:function(t){var e=t.oldDraggableIndex;this.startIndex=e},onSpill:function(t){var e=t.dragEl,i=t.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var r=td(this.sortable.el,this.startIndex,this.options);r?this.sortable.el.insertBefore(e,r):this.sortable.el.appendChild(e),this.sortable.animateAll(),i&&i.animateAll()},drop:V$};ya(b2,{pluginName:"revertOnSpill"});function w2(){}w2.prototype={onSpill:function(t){var e=t.dragEl,i=t.putSortable,r=i||this.sortable;r.captureAnimationState(),e.parentNode&&e.parentNode.removeChild(e),r.animateAll()},drop:V$};ya(w2,{pluginName:"removeOnSpill"});Vt.mount(new hmt);Vt.mount(w2,b2);const cmt=s=>{const t=s.item;let e=Array.prototype.slice.call(t.parentNode.childNodes);return e=e.filter(i=>i.nodeType!=Node.ELEMENT_NODE||!i.classList.contains("sortable-fallback")),e},umt=(s,t,e,i,r,n)=>{const a=s.item.parentNode;for(const f of e)a.appendChild(f);if(s.oldIndex==s.newIndex)return;const l=i.getArray(),h=s.item.querySelector("eox-layercontrol-layer").layer.get(r),c=l.find(f=>f.get(r)===h),u=n.dataset.layer,d=l.find(f=>f.get(r)==u);let p,g;for(p=0;p<l.length;p++)if(l[p]==c){i.removeAt(p);break}for(g=0;g<l.length;g++)if(l[g]===d){p>g?i.insertAt(g,c):i.insertAt(g+1,c);break}t.requestUpdate()};function dmt(s,t,e,i){let r=[],n=null;s._sortable=Vt.create(s,{handle:".drag-handle",filter:".drag-handle.disabled",swapThreshold:.5,animation:150,easing:"cubic-bezier(1, 0, 0, 1)",onStart:o=>r=cmt(o),onMove:o=>{n=o.related},onEnd:o=>umt(o,i,r,t,e,n)})}function pmt(s,t,e,i){const r=s.getArray();let n=!1;r.forEach(o=>{const a=o.ol_uid;o.get(t)||(o.set(t,a),n=!0),o.get(e)||(o.set(e,`layer ${a}`),n=!0),n&&i.requestUpdate()})}function E2(s,t,e){let i=[];const r=(n,o,a)=>{i=[...i,...n.filter(h=>h.get(o)===a)];const l=n.filter(h=>h.getLayers);return l.length>0&&l.forEach(h=>r(h.getLayers().getArray(),o,a)),i};return r(s,t,e),i}function gmt(s,t,e){if(!s||!t)return!1;if(!H$(s,e))return!0;const i=s.get("minZoom"),r=s.get("maxZoom"),n=t.getView().getZoom();return n>i&&n<r}function H$(s,t){const e=s.get("minZoom"),i=s.get("maxZoom");return!!(t&&(e!==-1/0||i!==1/0))}function fmt(s,t){var r,n,o;return!s||!t?void 0:s.getLayers?"group":((o=(r=t.getInteractions().getArray().filter(a=>a.freehand_!==void 0).map(a=>a.source_))==null?void 0:r.ol_uid)==null?void 0:o.includes(s.getSource?(n=s.getSource())==null?void 0:n.ol_uid:void 0))?"draw":s.declutter_!==void 0?"vector":"raster"}function W$(s,t){var i;let e={};for(const r in s){const n=s[r].type;if(n&&n!=="object")e[r]=n==="number"?Number(t[r]):t[r];else if(typeof s[r]=="object"&&((i=s[r])!=null&&i.properties)){const o=W$(s[r].properties,t);Object.keys(o).length>0&&(e[r]=o)}}return e}function mmt(s,t){var n;if(!t||!s.getSource().getTileUrlFunction())return null;const e=new URL(s.getSource().getTileUrlFunction()([0,0,0])),i=Object.fromEntries(e.searchParams.entries()),r=W$(((n=t.schema)==null?void 0:n.properties)||t.schema,i);return Object.keys(r).length?r:null}const _mt=(s,t)=>s==null?void 0:s.filter(e=>["remove","sort"].filter(i=>t!=null&&t.get("layerControlDisable")?i!=="sort":!0).includes(e)),ymt=(s,t)=>s==null?void 0:s.filter(e=>{let i=!0;return["remove","sort"].includes(e)&&(i=!1),e==="info"&&(i=t.get("description")),e==="config"&&(i=t.get("layerConfig")),i}),xmt=(s,t)=>Qt`
  <button slot="${s}-icon" class="icon">${t?s:ao}</button>
`,vmt=s=>Qt`
  <button
    class="remove-icon icon"
    @click=${()=>{const{layer:t}=s;t==null||t.set("layerControlOptional",!0),t==null||t.setVisible(!1),s.dispatchEvent(new CustomEvent("changed",{detail:t,bubbles:!0}))}}
  >
    ${s.unstyled?"x":ao}
  </button>
`,bmt=s=>Qt`
  <span class="button sort-icon icon drag-handle">
    ${s?"═":ao}
  </span>
`,X$=s=>{var e;const t=["layerControlHide","layerControlOptional"];return(e=s==null?void 0:s.getArray())==null?void 0:e.filter(i=>t.every(r=>!i.get(r)))};/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const q$=O3(class extends F3{constructor(s){if(super(s),s.type!==tc.PROPERTY&&s.type!==tc.ATTRIBUTE&&s.type!==tc.BOOLEAN_ATTRIBUTE)throw Error("The `live` directive is not allowed on child or event bindings");if(!N3(s))throw Error("`live` bindings can only contain a single expression")}render(s){return s}update(s,[t]){if(t===Bf||t===ao)return t;const e=s.element,i=s.name;if(s.type===tc.PROPERTY){if(t===e[i])return Bf}else if(s.type===tc.BOOLEAN_ATTRIBUTE){if(!!t===e.hasAttribute(i))return Bf}else if(s.type===tc.ATTRIBUTE&&e.getAttribute(i)===t+"")return Bf;return D3(s),t}}),wmt=(s,t,e)=>{let i=t;return e.layer.getSource().getTileUrlFunction()&&(i||(i=e.layer.getSource().getTileUrlFunction()),e.layer.getSource().setTileUrlFunction((...r)=>Dft(i(...r),s)),e.layer.getSource().setKey(new Date)),i};var Pg,Og,Fg,__,Z$,y_,x_;class Y$ extends xa{constructor(){super();Ae(this,__);Ae(this,Pg,{});Ae(this,Og,null);Ae(this,Fg,void 0);Ae(this,y_,"");Ae(this,x_,"");this.layer=null,this.unstyled=!1,this.noShadow=!1,this.layerConfig=null,this.debouncedDataChange=vA(Ss(this,__,Z$),1e3,{leading:!0})}createRenderRoot(){return this.noShadow?this:super.createRenderRoot()}render(){Pd(this,Og,mmt(this.layer,this.layerConfig)),customElements.get("eox-jsonform")||console.error("Please import @eox/jsonform in order to use layerconfig");const e={disable_edit_json:!0,disable_collapse:!0,disable_properties:!0};return Qt`
      <style>
        ${Ti(this,y_)}
        ${!this.unstyled&&Ti(this,x_)}
      </style>
      ${Fn(this.layerConfig,()=>Qt`
          <!-- Render a JSON form for layer configuration -->
          <eox-jsonform
            .schema=${this.layerConfig.schema}
            .startVals=${Ti(this,Og)}
            .options=${e}
            @change=${this.debouncedDataChange}
          ></eox-jsonform>
        `)}
    `}}Pg=new WeakMap,Og=new WeakMap,Fg=new WeakMap,__=new WeakSet,Z$=function(e){Pd(this,Pg,e.detail),Pd(this,Fg,wmt(Ti(this,Pg),Ti(this,Fg),this)),this.requestUpdate()},y_=new WeakMap,x_=new WeakMap,ls(Y$,"properties",{layer:{attribute:!1},unstyled:{type:Boolean},noShadow:{type:Boolean},layerConfig:{attribute:!1}});customElements.define("eox-layercontrol-layerconfig",Y$);var kg,v_,b_;class K$ extends xa{constructor(){super();Ae(this,kg,e=>this.selectedTab===e&&"highlighted");Ae(this,v_,`
    .tabbed figure {
      margin: 0;
    }
    .tabbed nav {
      display: flex;
      justify-content: space-between;
    }
    .tabbed nav div {
      display: flex;
    }
    .tabbed .tab {
      display: none;
    }
    .tabbed .tab.highlighted {
      display: block;
    }
    .tabbed label.highlighted {
      background: lightgrey;
    }
  `);Ae(this,b_,`
    .tabbed {
      font-size: small;
    }
    .tabbed label.highlighted {
      background: #00417011;
      pointer-events: none;
    }
    nav div label,
    nav div span {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    figure {
      background: #00417011;
      border-top: 1px solid #0041701a;
    }
  `);this.actions=[],this.selectedTab=0,this.tabs=[],this.unstyled=!1,this.noShadow=!1}createRenderRoot(){return this.noShadow?this:super.createRenderRoot()}render(){const e=this.tabs,i=this.actions,r=i.length+e.length>1;return Qt`
      <style>
        ${Ti(this,v_)}
        ${!this.unstyled&&Ti(this,b_)}
      </style>
      <div class="tabbed">
        <!-- Navigation for tabs and actions -->
        ${Fn(r,()=>Qt`
            <nav>
              <div>
                <!-- Labels for tabs -->
                ${Pm(e,(n,o)=>Qt`
                      <label
                        class=${Ti(this,kg).call(this,o)}
                        @click=${()=>this.selectedTab=o}
                      >
                        <!-- Customizable icon for each tab -->
                        <slot name=${`${n}-icon`}>${n}</slot>
                      </label>
                    `)}
              </div>
              <div>
                <!-- Icons for actions -->
                ${Pm(i,n=>Qt`
                      <span>
                        <!-- Customizable icon for each action -->
                        <slot name=${`${n}-icon`}>${n}</slot>
                      </span>
                    `)}
              </div>
            </nav>
          `)}
        <figure>
          <!-- Content for each tab -->
          ${Pm(e,(n,o)=>Qt`
              <div class="tab ${Ti(this,kg).call(this,o)}">
                <!-- Content slot for each tab -->
                <slot name=${`${n}-content`}>${n}</slot>
              </div>
            `)}
        </figure>
      </div>
    `}}kg=new WeakMap,v_=new WeakMap,b_=new WeakMap,ls(K$,"properties",{actions:{attribute:!1},selectedTab:{state:!0},tabs:{attribute:!1},unstyled:{type:Boolean},noShadow:{type:Boolean}});customElements.define("eox-layercontrol-tabs",K$);var w_,E_;class J$ extends xa{constructor(){super();ls(this,"_removeButton",()=>vmt(this));ls(this,"_sortButton",()=>bmt(this.unstyled));ls(this,"_button",e=>xmt(e,this.unstyled));Ae(this,w_,"");Ae(this,E_,`
    ${j3}  
    ${G3}
    ${bA}
    ${z3}
    .drag-handle {
      cursor: n-resize;
    }
    .single-action-container,
    details.tools {
      position: relative;
    }
    eox-layercontrol-layer details summary::before {
      content: "";
    }
    details.tools[open] {
      /*border-top: 1px solid #0041703a;*/
    }
    .single-action {
      position: relative;
    }
    details.tools summary .icon {
      pointer-events: none;
    }
    .single-action,
    details.tools summary {
      position: absolute;
      right: 0;
      top: -24px;
      display: flex;
      border-radius: 4px;
      cursor: pointer;
    }
    .single-action .icon::before,
    details.tools summary .icon::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Edots-vertical%3C/title%3E%3Cpath d='M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z' /%3E%3C/svg%3E");
    }
    .single-action,
    details.tools summary,
    eox-layercontrol-tabs button.icon {
      transition: opacity .2s;
    }
    .single-action,
    details.tools summary {
      opacity: .5;
    }
    eox-layercontrol-tabs button.icon {
      opacity: .7;
    }
    .single-action:hover,
    details.tools summary:hover,
    eox-layercontrol-tabs button.icon:hover {
      opacity: 1;
    }
    .tools-placeholder,
    .single-action .icon,
    .single-action .icon::before,
    details.tools summary .icon,
    details.tools summary .icon::before {
      height: 16px;
      width: 16px;
    }
    eox-layercontrol-tabs button.icon,
    eox-layercontrol-tabs .button.icon {
      display: flex;
      justify-content: center;
    }
    eox-layercontrol-tabs button.icon::before,
    eox-layercontrol-tabs .button.icon::before {
      width: 16px;
      height: 16px;
    }
    details.tools summary .info-icon,
    button.icon[slot=info-icon]::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Einformation-outline%3C/title%3E%3Cpath d='M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z' /%3E%3C/svg%3E");
    }
    details.tools summary .opacity-icon,
    button.icon[slot=opacity-icon]::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Eopacity%3C/title%3E%3Cpath d='M17.66,8L12,2.35L6.34,8C4.78,9.56 4,11.64 4,13.64C4,15.64 4.78,17.75 6.34,19.31C7.9,20.87 9.95,21.66 12,21.66C14.05,21.66 16.1,20.87 17.66,19.31C19.22,17.75 20,15.64 20,13.64C20,11.64 19.22,9.56 17.66,8M6,14C6,12 6.62,10.73 7.76,9.6L12,5.27L16.24,9.65C17.38,10.77 18,12 18,14H6Z' /%3E%3C/svg%3E");
    }
    details.tools summary .config-icon,
    button.icon[slot=config-icon]::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Etune%3C/title%3E%3Cpath d='M3,17V19H9V17H3M3,5V7H13V5H3M13,21V19H21V17H13V15H11V21H13M7,9V11H3V13H7V15H9V9H7M21,13V11H11V13H21M15,9H17V7H21V5H17V3H15V9Z' /%3E%3C/svg%3E");
    }
    .single-action .remove-icon::before,
    [slot=remove-icon] button.icon::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23ff0000' viewBox='0 0 24 24'%3E%3Ctitle%3Edelete-outline%3C/title%3E%3Cpath d='M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19M8,9H16V19H8V9M15.5,4L14.5,3H9.5L8.5,4H5V6H19V4H15.5Z' /%3E%3C/svg%3E");
    }
    .single-action .sort-icon::before,
    [slot=sort-icon] .button.icon::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Edrag-horizontal-variant%3C/title%3E%3Cpath d='M21 11H3V9H21V11M21 13H3V15H21V13Z' /%3E%3C/svg%3E");
    }
    [slot=info-content],
    [slot=opacity-content] {
      padding: 12px 6px;
    }
  `);this.layer=null,this.tools=[],this.unstyled=!1,this.noShadow=!1}createRenderRoot(){return this.noShadow?this:super.createRenderRoot()}render(){var l;const e=_mt(this.tools,this.layer),i=ymt(this.tools,this.layer),r=this[`_${e==null?void 0:e[0]}Button`]?this[`_${e==null?void 0:e[0]}Button`]():ao,n=((l=this.tools)==null?void 0:l.length)===1?`${this.tools[0]}-icon`:"",o=e==null?void 0:e.length,a=i==null?void 0:i.length;return Qt`
      <style>
        ${Ti(this,w_)}
        ${!this.unstyled&&Ti(this,E_)}
      </style>
      ${Fn(o+a>0,()=>Qt`
          ${Fn(o===1&&a===0,()=>Qt`
              <div class="single-action-container">
                <div class="single-action">${r}</div>
              </div>
            `,()=>{var h;return Qt`
              <details
                class="tools"
                open=${this.layer.get("layerControlToolsExpand")||ao}
              >
                <summary>
                  <button class="icon ${n}">Tools</button>
                </summary>
                <eox-layercontrol-tabs
                  .noShadow=${!1}
                  .actions=${e}
                  .tabs=${i}
                  .unstyled=${this.unstyled}
                >
                  <!-- Rendering tabs and content -->
                  ${Pm(i,c=>this._button(c))}

                  <div slot="info-content">
                    ${$3(this.layer.get("description"))}
                  </div>
                  <div slot="opacity-content">
                    <!-- Input for opacity -->
                    <input
                      type="range"
                      min="0"
                      max="1"
                      step="0.01"
                      value=${q$((h=this.layer)==null?void 0:h.getOpacity())}
                      @input=${c=>this.layer.setOpacity(parseFloat(c.target.value))}
                    />
                  </div>
                  <div slot="config-content">
                    <!-- Layer configuration -->
                    <eox-layercontrol-layerconfig
                      slot="config-content"
                      .layer=${this.layer}
                      .noShadow=${!0}
                      .layerConfig=${this.layer.get("layerConfig")}
                      .unstyled=${this.unstyled}
                      @changed=${()=>this.requestUpdate()}
                    ></eox-layercontrol-layerconfig>
                  </div>
                  <div slot="remove-icon">${this._removeButton()}</div>
                  <div slot="sort-icon">${this._sortButton()}</div>
                </eox-layercontrol-tabs>
              </details>
            `})}
        `)}
    `}}w_=new WeakMap,E_=new WeakMap,ls(J$,"properties",{layer:{attribute:!1},tools:{attribute:!1},unstyled:{type:Boolean},noShadow:{type:Boolean}});customElements.define("eox-layercontrol-layer-tools",J$);const Emt=s=>{const t=()=>{const e=gmt(s.layer,s.map,s.showLayerZoomState);let i=!1;!e&&s.currLayerVisibilityBasedOnZoom?(s.currLayerVisibilityBasedOnZoom=!1,i=!0):e&&!s.currLayerVisibilityBasedOnZoom&&(s.currLayerVisibilityBasedOnZoom=!0,i=!0),i&&(s.requestUpdate(),s.dispatchEvent(new CustomEvent("change:resolution",{bubbles:!0})))};H$(s.layer,s.showLayerZoomState)&&(t(),s.map.getView().on("change:resolution",()=>t()))},Smt=(s,t)=>{const e=t.layer;e.setVisible(s.target.checked),s.target.checked&&e.get("layerControlExclusive")&&t.parentNode.parentNode.querySelectorAll("li > eox-layercontrol-layer").forEach(r=>{var n;r.layer!==e&&((n=r.layer)!=null&&n.get("layerControlExclusive"))&&(r.layer.setVisible(!1),r.requestUpdate())}),t.dispatchEvent(new CustomEvent("changed",{bubbles:!0})),t.requestUpdate()};var wu,Km,S_,t3,C_,T_;class Q$ extends xa{constructor(){super();Ae(this,wu);Ae(this,S_);ls(this,"currLayerVisibilityBasedOnZoom",!0);Ae(this,C_,"");Ae(this,T_,`
    ${bA}
    eox-layercontrol-layer {
      width: 100%;
    }
    .layer.zoom-state-invisible {
      background: #d2e2ee;
      opacity: 0.3;
    }
    .layer {
      width: 100%;
      align-items: center;
      justify-content: space-between;
      padding: 4px 0;
    }
    label, span {
      display: flex;
      align-items: center;
      cursor: pointer;
    }
    [data-type] .title::before {
      width: 20px;
      min-width: 20px;
      height: 20px;
      margin-right: 6px;
    }
    [data-type=group] .title::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%230041703a' viewBox='0 0 24 24'%3E%3Ctitle%3Efolder-outline%3C/title%3E%3Cpath d='M20,18H4V8H20M20,6H12L10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6Z' /%3E%3C/svg%3E");
    }
    [data-type=group] > eox-layercontrol-layer-group > details[open] > summary > eox-layercontrol-layer > .layer > label > .title::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%230041703a' viewBox='0 0 24 24'%3E%3Ctitle%3Efolder-open-outline%3C/title%3E%3Cpath d='M6.1,10L4,18V8H21A2,2 0 0,0 19,6H12L10,4H4A2,2 0 0,0 2,6V18A2,2 0 0,0 4,20H19C19.9,20 20.7,19.4 20.9,18.5L23.2,10H6.1M19,18H6L7.6,12H20.6L19,18Z' /%3E%3C/svg%3E");
    }
    [data-type=raster] .title::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%230041703a' viewBox='0 0 24 24'%3E%3Ctitle%3Echeckerboard%3C/title%3E%3Cpath d='M2 2V22H22V2H2M20 12H16V16H20V20H16V16H12V20H8V16H4V12H8V8H4V4H8V8H12V4H16V8H20V12M16 8V12H12V8H16M12 12V16H8V12H12Z' /%3E%3C/svg%3E");
    }
    [data-type=vector] .title::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%230041703a' viewBox='0 0 24 24'%3E%3Ctitle%3Eshape-outline%3C/title%3E%3Cpath d='M11,13.5V21.5H3V13.5H11M9,15.5H5V19.5H9V15.5M12,2L17.5,11H6.5L12,2M12,5.86L10.08,9H13.92L12,5.86M17.5,13C20,13 22,15 22,17.5C22,20 20,22 17.5,22C15,22 13,20 13,17.5C13,15 15,13 17.5,13M17.5,15A2.5,2.5 0 0,0 15,17.5A2.5,2.5 0 0,0 17.5,20A2.5,2.5 0 0,0 20,17.5A2.5,2.5 0 0,0 17.5,15Z' /%3E%3C/svg%3E");
    }
    [data-type=draw] .title::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%230041703a' viewBox='0 0 24 24'%3E%3Ctitle%3Evector-square-edit%3C/title%3E%3Cpath d='M22.7 14.4L21.7 15.4L19.6 13.3L20.6 12.3C20.8 12.1 21.2 12.1 21.4 12.3L22.7 13.6C22.9 13.8 22.9 14.1 22.7 14.4M13 19.9L19.1 13.8L21.2 15.9L15.1 22H13V19.9M11 19.9V19.1L11.6 18.5L12.1 18H8V16H6V8H8V6H16V8H18V12.1L19.1 11L19.3 10.8C19.5 10.6 19.8 10.4 20.1 10.3V8H22.1V2H16.1V4H8V2H2V8H4V16H2V22H8V20L11 19.9M18 4H20V6H18V4M4 4H6V6H4V4M6 20H4V18H6V20Z' /%3E%3C/svg%3E");
    }
  `);this.layer=null,this.map=null,this.titleProperty="title",this.showLayerZoomState=!1,this.tools=[],this.unstyled=!1,this.noShadow=!1}createRenderRoot(){return this.noShadow?this:super.createRenderRoot()}firstUpdated(){Emt(this)}render(){var l;const e=this.layer.getVisible(),i=e?"visible":"",r=this.currLayerVisibilityBasedOnZoom?"":"zoom-state-invisible",n=Ss(this,wu,Km).call(this,"layerControlDisable")?"disabled":"",o=Ss(this,wu,Km).call(this,"layerControlExclusive")?"radio":"checkbox",a=((l=this.tools)==null?void 0:l.length)>0;return Qt`
      <style>
        ${Ti(this,C_)}
        ${!this.unstyled&&Ti(this,T_)}
      </style>
      ${Fn(this.layer,()=>Qt`
          <!-- Render the layer -->
          <div class="layer ${i} ${r}">
            <label class="drag-handle ${n}">
              <!-- Input element for layer visibility -->
              <input
                type=${o}
                .checked=${q$(e)}
                @click=${Ss(this,S_,t3)}
              />

              <!-- Layer title -->
              <span class="title">${Ss(this,wu,Km).call(this,this.titleProperty)}</span>
              ${Fn(a,()=>Qt`<span class="tools-placeholder"></span>`)}
            </label>
          </div>

          <!-- Render layer tools -->
          <eox-layercontrol-layer-tools
            .noShadow=${!0}
            .layer=${this.layer}
            .tools=${this.tools}
            .unstyled=${this.unstyled}
          ></eox-layercontrol-layer-tools>
        `)}
    `}}wu=new WeakSet,Km=function(e){var i;return(i=this.layer)==null?void 0:i.get(e)},S_=new WeakSet,t3=function(e){Smt(e,this)},C_=new WeakMap,T_=new WeakMap,ls(Q$,"properties",{layer:{attribute:!1},map:{attribute:!1,state:!0},titleProperty:{attribute:"title-property",type:String},showLayerZoomState:{attribute:"show-layer-zoom-state",type:Boolean},tools:{attribute:!1},unstyled:{type:Boolean},noShadow:{type:Boolean}});customElements.define("eox-layercontrol-layer",Q$);var R_,M_;class e3 extends xa{constructor(){super();Ae(this,R_,"");Ae(this,M_,`
    details summary {
      cursor: pointer;
      display: flex;
    }
    details summary { list-style-type: none; } /* Firefox */
    details summary::-webkit-details-marker { display: none; } /* Chrome */
    details summary::marker { display: none; }
    details summary::before {
      display: block;
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Echevron-right%3C/title%3E%3Cpath d='M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z' /%3E%3C/svg%3E");
      font-size: 13px;
      width: 24px;
      height: 24px;
      margin: 4px 0;
      transform-origin: center;
      transition: transform 0.1s ease-in-out;
    }
    details[open] > summary:before {
      transform: rotate(90deg);
    }
    details[data-children-length="0"] summary::before {
      display: none;
    }
  `);this.group=null,this.idProperty="id",this.map=null,this.titleProperty="title",this.showLayerZoomState=!1,this.tools=[],this.unstyled=!1,this.noShadow=!1}createRenderRoot(){return this.noShadow?this:super.createRenderRoot()}render(){var r,n;const e=!!((r=this.group)!=null&&r.get("layerControlExpand")),i=(n=X$(this.group.getLayers()))==null?void 0:n.length;return Qt`
      <style>
        ${Ti(this,R_)}
        ${!this.unstyled&&Ti(this,M_)}
      </style>
      ${Fn(this.group,()=>Qt`
          <!-- Render the details element with the layer control -->
          <details
            open=${e||ao}
            data-children-length=${i}
          >
            <summary>
              <!-- Render the layer control within the summary -->
              <eox-layercontrol-layer
                .noShadow=${!0}
                .layer=${this.group}
                .map=${this.map}
                .titleProperty=${this.titleProperty}
                .showLayerZoomState=${this.showLayerZoomState}
                .tools=${this.tools}
                .unstyled=${this.unstyled}
                @changed=${()=>this.requestUpdate()}
              ></eox-layercontrol-layer>
            </summary>

            <!-- Render the list of layers within the details -->
            <eox-layercontrol-layer-list
              .noShadow=${!0}
              .idProperty=${this.idProperty}
              .layers=${this.group.getLayers()}
              .map=${this.map}
              .titleProperty=${this.titleProperty}
              .showLayerZoomState=${this.showLayerZoomState}
              .tools=${this.tools}
              .unstyled=${this.unstyled}
              @changed=${()=>this.requestUpdate()}
            ></eox-layercontrol-layer-list>
          </details>
        `)}
    `}}R_=new WeakMap,M_=new WeakMap,ls(e3,"properties",{group:{attribute:!1},idProperty:{attribute:"id-property"},map:{attribute:!1,state:!0},titleProperty:{attribute:"title-property",type:String},showLayerZoomState:{attribute:"show-layer-zoom-state",type:Boolean},tools:{attribute:!1},unstyled:{type:Boolean},noShadow:{type:Boolean}});customElements.define("eox-layercontrol-layer-group",e3);const Cmt=s=>{const{layers:t,idProperty:e,titleProperty:i,renderRoot:r}=s;if(t){const n=r.querySelector("ul");pmt(t,e,i,s),dmt(n,t,e,s)}},Tmt=s=>{const{layers:t}=s,e=vA(()=>{s.requestUpdate(),s.dispatchEvent(new CustomEvent("changed",{bubbles:!0}))},50),i=()=>e();t&&(t.hasListener("change:length")&&(t==null||t.un("change:length",i)),t.on("change:length",i))};var I_,A_;class i3 extends xa{constructor(){super();Ae(this,I_,"");Ae(this,A_,`
    ul {
      padding: 0;
      margin: 0;
    }
    ul ul {
      padding-left: 48px;
    }
    li {
      list-style: none;
    }
    li {
      border-bottom: 1px solid #0041703a;
    }
    li:first-child {
      border-top: 1px solid #0041703a;
    }
    li:last-child {
      border: none;
    }
    li.sortable-chosen {
      background: #eeea;
    }
    li.sortable-drag {
      opacity: 0;
    }
    li.sortable-ghost {
    }
  `);this.idProperty="id",this.layers=null,this.map=null,this.tools=void 0,this.titleProperty="title",this.showLayerZoomState=!1,this.unstyled=!1,this.noShadow=!1}firstUpdated(){Cmt(this)}updated(){Tmt(this)}createRenderRoot(){return this.noShadow?this:super.createRenderRoot()}render(){const e=X$(this.layers).reverse();return Qt`
      <style>
        ${Ti(this,I_)}
        ${!this.unstyled&&Ti(this,A_)}
      </style>
      <ul>
        ${Fn(this.layers,()=>Qt`
            ${k3(e,i=>i,i=>Qt`
                <li
                  data-layer="${i.get(this.idProperty)}"
                  data-type="${fmt(i,this.map)}"
                >
                  ${i.getLayers?Qt`
                          <eox-layercontrol-layer-group
                            .noShadow=${!0}
                            .group=${i}
                            .idProperty=${this.idProperty}
                            .map=${this.map}
                            .titleProperty=${this.titleProperty}
                            .showLayerZoomState=${this.showLayerZoomState}
                            .tools=${this.tools}
                            .unstyled=${this.unstyled}
                            @changed=${()=>this.requestUpdate()}
                          >
                          </eox-layercontrol-layer-group>
                        `:Qt`
                          <eox-layercontrol-layer
                            .noShadow=${!0}
                            .layer=${i}
                            .map=${this.map}
                            .titleProperty=${this.titleProperty}
                            .showLayerZoomState=${this.showLayerZoomState}
                            .tools=${this.tools}
                            .unstyled=${this.unstyled}
                            @changed=${()=>this.requestUpdate()}
                          ></eox-layercontrol-layer>
                        `}
                </li>
              `)}
          `)}
      </ul>
    `}}I_=new WeakMap,A_=new WeakMap,ls(i3,"properties",{idProperty:{attribute:"id-property"},layers:{attribute:!1},map:{attribute:!1,state:!0},titleProperty:{attribute:"title-property",type:String},showLayerZoomState:{attribute:"show-layer-zoom-state",type:Boolean},tools:{attribute:!1},unstyled:{type:Boolean},noShadow:{type:Boolean}});customElements.define("eox-layercontrol-layer-list",i3);const Rmt=s=>{const t=s.querySelector("select[name=optional]"),e=t?t.value:null,i=E2(s.layers.getArray(),"layerControlOptional",!0).find(r=>(r.get(s.idProperty)||r.ol_uid)===e);i==null||i.set("layerControlOptional",!1),i==null||i.setVisible(!0),s.dispatchEvent(new CustomEvent("changed",{bubbles:!0})),s.renderRoot.parentNode.querySelectorAll("eox-layercontrol-layer-list").forEach(r=>r.requestUpdate()),s.requestUpdate()};var L_,r3;class s3 extends xa{constructor(){super();Ae(this,L_);this.idProperty="id",this.layers=null,this.titleProperty="title",this.unstyled=!1,this.noShadow=!1}createRenderRoot(){return this.noShadow?this:super.createRenderRoot()}render(){const e=E2(this.layers.getArray(),"layerControlOptional",!0);return Qt`
      <!-- Label for the dropdown -->
      <label for="optional">Optional layers</label>

      <!-- Dropdown select element -->
      <select name="optional" data-cy="optionalLayers">
        <!-- Default placeholder option -->
        <option disabled selected value>
          -- select an optional layer to add --
        </option>

        <!-- Mapping through filtered layers list to generate dropdown options -->
        ${e.map(i=>{const r=i.get(this.idProperty)||i.ol_uid,n=i.get(this.titleProperty),o=`layer ${i.get(this.idProperty)}`;return Qt` <option value="${r}">${n||o}</option> `})}
      </select>

      <!-- Button to handle adding layers -->
      <button @click="${Ss(this,L_,r3)}">add</button>
    `}}L_=new WeakSet,r3=function(){Rmt(this)},ls(s3,"properties",{idProperty:{attribute:"id-property"},layers:{attribute:!1},titleProperty:{attribute:"title-property",type:String},unstyled:{type:Boolean},noShadow:{type:Boolean}});customElements.define("eox-layercontrol-optional-list",s3);const Mmt=(s,t)=>{t.jsonInput=s.target.value,t.requestUpdate()},vI=s=>{const t=JSON.parse(`{"data":${A$(s.jsonInput)}}`);Array.isArray(t.data)?t.data.forEach(e=>{s.eoxMap.addOrUpdateLayer(e)}):s.eoxMap.addOrUpdateLayer(t.data),s.jsonInput=null,s.requestUpdate()},Imt=(s,t)=>{t.urlInput=s.target.value,t.requestUpdate()};async function Amt(s){const t=s.urlInput;if(s.wmsCapabilities=null,s.searchLoad=!0,s.requestUpdate(),!t)return!1;if(x2(t)==="XYZ")return{Name:t};try{const e=await Fft(t);s.wmsCapabilities=e}catch{}finally{s.searchLoad=!1,s.requestUpdate()}return!1}const Lmt=(s,t)=>{const{Name:e}=s,i=x2(t.urlInput)||"XYZ",r={type:"Tile",properties:{id:e,title:e},source:{type:i,url:t.urlInput,params:{LAYERS:e}}};t.jsonInput=JSON.stringify(r)},Pmt=(s,t)=>{t.open=s||null,t.urlInput=null,t.jsonInput=null,t.wmsCapabilities=null,t.requestUpdate()};var P_,o3,O_,a3,Ng,Gb,F_,l3,k_,h3,Eu,Jm,N_,D_;class n3 extends xa{constructor(){super();Ae(this,P_);Ae(this,O_);Ae(this,Ng);Ae(this,F_);Ae(this,k_);Ae(this,Eu);ls(this,"urlInput",null);ls(this,"jsonInput",null);ls(this,"open",null);ls(this,"searchLoad",!1);ls(this,"wmsCapabilities",null);Ae(this,N_,`
    .eox-add-layer-main .open {
      position: relative;
    }
    .eox-add-layer-main .close {
      display: none;
    }
  `);Ae(this,D_,`
    .eox-add {
      background: #f0f2f5;
      border-top: 1px solid #0041701a;
      padding: 0.5rem;
      font-size: small;
    }
    .eox-add-layer-col, .eox-add-layer-tab {
      display: flex;
      width: 100%;
    }
    .eox-add-layer-main .close {
      display: none;
    }
    .eox-add-layer-main .open {
      position: relative;
    }
    button.icon.add-icon {
      flex-grow: 1;
    }
    .eox-add-layer-tab li {
      border: 0 !important;
      font-size: smaller;
      padding: 0.2rem 0.7rem;
      background: #f0f2f5;
      border-radius: 4px 4px 0px 0px;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
    }
    .eox-add-layer-tab li.active {
      background: #204270;
      color: white;
      font-weight: 700;
    }
    .relative {
      position: relative
    }
    .eox-add-layer-col.justify-end {
      justify-content: end;
    }
    .eox-add ul {
      max-height: 120px;
      overflow: scroll;
    }
    .eox-add ul li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.1rem 0.2rem;
    }
    button.icon {
      justify-content: end;
      transition: opacity .2s;
      opacity: .7;
    }
    button.icon:hover {
      opacity: 1;
    }
    button.icon.add-layer-icon::before {
      width: 16px;
      min-width: 16px;
      height: 16px;
    }
    button.icon.add-icon::before {
      width: 18px;
      min-width: 18px;
      height: 18px;
    }
    .add-icon.icon::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath xmlns='http://www.w3.org/2000/svg' d='M17,14H19V17H22V19H19V22H17V19H14V17H17V14M11,16L2,9L11,2L20,9L11,16M11,18.54L12,17.75V18C12,18.71 12.12,19.39 12.35,20L11,21.07L2,14.07L3.62,12.81L11,18.54Z' fill='%23004270'/%3E%3C/svg%3E");
    }
    .add-layer-icon::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Ctitle%3Eplus-thick%3C/title%3E%3Cpath fill='%23004270' d='M20 14H14V20H10V14H4V10H10V4H14V10H20V14Z' /%3E%3C/svg%3E");
    }
    .json-add-layer {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Ctitle%3Eplus-thick%3C/title%3E%3Cpath fill='white' d='M20 14H14V20H10V14H4V10H10V4H14V10H20V14Z' /%3E%3C/svg%3E");
    }
    .search-icon::after {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Ctitle%3Emagnify%3C/title%3E%3Cpath d='M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z' fill='white' /%3E%3C/svg%3E");
    }
    .search-icon::after, .json-add-layer::before {
      width: 14px;
      min-width: 14px;
      height: 14px;
      display:flex
      margin-right: 6px;
      color: white;
    }
    .search-icon, .json-add-layer {
      padding: 4px 6px;
      height: 28px;
      border-radius: 0px 4px 4px 0px;
      box-shadow: none;
    }
    .json-add-layer {
      position: absolute;
      bottom: 16px;
      right: 14px;
      border-radius: 4px;
      height: 24px;
      padding: 4px;
    }
    input.add-url, textarea.add-layer-input {
      box-sizing: border-box !important;
      width: 100%;
      height: 28px;
      padding: 5px 7px !important;
      border: 1px solid #0004 !important;
      font-size: smaller;
      border-radius: 4px 0px 0px 4px;
    }
    textarea.add-layer-input {
      height: 90px;
      resize: none;
      border-radius: 4px;
    }
    .divider {
      margin: 1rem 0px;
      height: 1px;
      border-top: 1.5px solid #00417059;
      text-align: center;
      position: relative;
    }
    .divider span {
      position: relative;
      top: -.6em;
      padding: 0px 0.5rem;
      background: #f0f2f5;
      color: #00417059;
      font-weight: bold;
      display: inline-block;
    }
  `);this.eoxMap=null,this.unstyled=!1,this.noShadow=!1}createRenderRoot(){return this.noShadow?this:super.createRenderRoot()}render(){const e=this.open?"open":"close",i=this.open==="url",r=this.open==="json",n=!kft(this.urlInput)||this.searchLoad?!0:ao;return Qt`
      <style>
        ${Ti(this,N_)}
        ${!this.unstyled&&Ti(this,D_)}
      </style>
      <div class="eox-add-layer-main">
        <div class="eox-add-layer-col">
          <!-- Tabbed interface for URL and JSON -->
          <ul class="eox-add-layer-tab ${e}">
            <li
              @click=${()=>Ss(this,Eu,Jm).call(this,"url")}
              class="${i?"active":""}"
            >
              URL
            </li>
            <li
              @click=${()=>Ss(this,Eu,Jm).call(this,"json")}
              class="${r?"active":""}"
            >
              JSON
            </li>
          </ul>

          <!-- Button to toggle tabs -->
          <button
            class="add-icon icon"
            @click=${()=>Ss(this,Eu,Jm).call(this,this.open?null:"url")}
          >
            ${this.unstyled?"Add Layer":""}
          </button>
        </div>
        <div class="eox-add ${e}">
          ${i?Qt`
              <!-- Input field for URL -->
              <div class="eox-add-layer-col">
                <input 
                  type="text" 
                  class="add-url" 
                  placeholder="Add URL (WMS/XYZ)" 
                  .value="${this.urlInput}" 
                  @input=${Ss(this,P_,o3)}
                >
                </input>
                <!-- Search button for URL -->
                <button 
                  class="search-icon" 
                  disabled=${n} 
                  @click=${Ss(this,O_,a3)}
                >
                  ${this.unstyled?"Search":""}
                </button>
              </div>

              <!-- Display layers for WMS capabilities -->
              ${this.wmsCapabilities?Qt`<ul class="search-lists">
                      ${this.wmsCapabilities.Capability.Layer.Layer.map(o=>{const a=o.Name;return Qt`
                            <li class="search-list">
                              ${a}
                              <!-- Button to add layer -->
                              <button
                                class="add-layer-icon icon"
                                @click=${()=>Ss(this,Ng,Gb).call(this,o)}
                              >
                                ${this.unstyled?"+":""}
                              </button>
                            </li>
                          `})}
                    </ul>`:ao}
            `:Qt`
                <!-- Textarea for JSON input -->
                <textarea
                  class="add-layer-input"
                  placeholder="Please put a valid eox-map layer JSON."
                  @input=${Ss(this,k_,h3)}
                  .value=${this.jsonInput}
                ></textarea>

                <!-- Button to add JSON layer -->
                <button
                  class="add-layer-icon json-add-layer"
                  disabled=${Nft(this.jsonInput)?ao:!0}
                  @click=${Ss(this,F_,l3)}
                >
                  ${this.unstyled?"Add JSON":""}
                </button>
              `}
        </div>
      </div>
    `}}P_=new WeakSet,o3=function(e){Imt(e,this)},O_=new WeakSet,a3=async function(){const e=await Amt(this);e&&Ss(this,Ng,Gb).call(this,e)},Ng=new WeakSet,Gb=function(e){Lmt(e,this),vI(this)},F_=new WeakSet,l3=function(){vI(this)},k_=new WeakSet,h3=function(e){Mmt(e,this)},Eu=new WeakSet,Jm=function(e){Pmt(e,this)},N_=new WeakMap,D_=new WeakMap,ls(n3,"properties",{eoxMap:{attribute:!1,state:!0},unstyled:{type:Boolean},noShadow:{type:Boolean}});customElements.define("eox-layercontrol-add-layers",n3);const Omt=(s,t)=>{if(t.requestUpdate(),s.target.tagName==="EOX-LAYERCONTROL-LAYER-TOOLS"){const e=t.renderRoot.querySelector("eox-layercontrol-optional-list");e==null||e.requestUpdate()}},Fmt=s=>{const t=s.for;return document.querySelector(t)},kmt=s=>{const t=document.querySelector(s.for);t&&t.map!==s.map&&(s.map=t.map)};var Su,$_,u3,j_;class c3 extends xa{constructor(){super();Ae(this,$_);Ae(this,Su,void 0);Ae(this,j_,"* { font-family: Roboto, sans-serif; }");this.for="eox-map",this.idProperty="id",this.map=null,this.titleProperty="title",this.showLayerZoomState=!1,this.tools=["info","opacity","config","remove","sort"],this.addExternalLayers=!1,this.unstyled=!1,this.styleOverride=""}updated(){kmt(this)}firstUpdated(){Pd(this,Su,Fmt(this))}render(){var r,n,o;const e=(r=this.map)==null?void 0:r.getLayers().getArray(),i=e&&((n=E2(e,"layerControlOptional",!0))==null?void 0:n.length)>0;return Qt`
      <style>
        ${!this.unstyled&&Ti(this,j_)}
        ${this.styleOverride}
      </style>

      <!-- Conditional rendering of add layers component -->
      ${Fn(this.addExternalLayers&&((o=Ti(this,Su))==null?void 0:o.addOrUpdateLayer),()=>Qt`
          <eox-layercontrol-add-layers
            .noShadow=${!0}
            .eoxMap=${Ti(this,Su)}
            .unstyled=${this.unstyled}
          ></eox-layercontrol-add-layers>
        `)}

      <!-- Conditional rendering of layer list component -->
      ${Fn(this.map,()=>Qt`
          <eox-layercontrol-layer-list
            .noShadow=${!0}
            class="layers"
            .idProperty=${this.idProperty}
            .layers=${this.map.getLayers()}
            .map=${this.map}
            .titleProperty=${this.titleProperty}
            .showLayerZoomState=${this.showLayerZoomState}
            .tools=${this.tools}
            .unstyled=${this.unstyled}
            @changed=${Ss(this,$_,u3)}
          ></eox-layercontrol-layer-list>
        `)}

      <!-- Conditional rendering of optional list component -->
      ${Fn(i,()=>Qt`
          <eox-layercontrol-optional-list
            .noShadow=${!0}
            .idProperty=${this.idProperty}
            .layers=${this.map.getLayers()}
            .titleProperty=${this.titleProperty}
            @changed=${()=>this.requestUpdate()}
          ></eox-layercontrol-optional-list>
        `)}
    `}}Su=new WeakMap,$_=new WeakSet,u3=function(e){Omt(e,this)},j_=new WeakMap,ls(c3,"properties",{for:{type:String},idProperty:{attribute:"id-property"},map:{attribute:!1,state:!0},titleProperty:{attribute:"title-property",type:String},showLayerZoomState:{attribute:"show-layer-zoom-state",type:Boolean},tools:{attribute:!1},addExternalLayers:{attribute:!1},unstyled:{type:Boolean},styleOverride:{type:String}});customElements.define("eox-layercontrol",c3);const bI="https://services.sentinel-hub.com/ogc/wms/0635c213-17a1-48ee-aef7-9d1731695a54",d3=s=>`//s2maps-tiles.eu/wmts/1.0.0/${s}/default/g/{z}/{y}/{x}.jpg`,S2=s=>({type:"Tile",properties:{title:`EOxCloudless ${s}`},source:{type:"XYZ",url:d3(`s2cloudless-${s}_3857`)}}),Ro="width: 400px; height: 300px; margin-left: 7px;",zb={wind:{type:"Tile",properties:{id:"WIND",title:"WIND"},source:{type:"TileWMS",url:bI,params:{LAYERS:"AWS_VIS_WIND_V_10M"}}},no2:{type:"Tile",properties:{id:"NO2",title:"NO2"},source:{type:"TileWMS",url:bI,params:{LAYERS:"AWS_NO2-VISUALISATION"}}}},Zy={type:"Vector",properties:{title:"Regions",id:"regions",description:"Ecological regions of the earth."},source:{type:"Vector",url:"https://openlayers.org/data/vector/ecoregions.json",format:"GeoJSON",attributions:"Regions: @ openlayers.org"}},Nmt={type:"WebGLTile",properties:{id:"s2",layerControlExclusive:!0,title:"s2"},style:{variables:{red:1,green:2,blue:3,redMax:3e3,greenMax:3e3,blueMax:3e3},color:["array",["/",["band",["var","red"]],["var","redMax"]],["/",["band",["var","green"]],["var","greenMax"]],["/",["band",["var","blue"]],["var","blueMax"]],1],gamma:1.1},source:{type:"GeoTIFF",normalize:!1,sources:[{url:"https://s2downloads.eox.at/demo/EOxCloudless/2020/rgbnir/s2cloudless2020-16bits_sinlge-file_z0-4.tif"}]}},Dmt={type:"Tile",properties:{id:"osm",title:"Open Street Map",layerControlExclusive:!0},visible:!1,opacity:.5,source:{type:"OSM"}},Cd={type:"Tile",properties:{title:"Terrain Light"},source:{type:"XYZ",url:d3("terrain-light_3857")}},$mt=S2("2019"),jmt=S2("2020"),C2=S2("2021"),T2=[{type:"Group",properties:{id:"group2",title:"Data Layers",layerControlExpand:!0,description:"# Hello world"},layers:[zb.wind,zb.no2,Zy]},{type:"Group",properties:{id:"group1",title:"Background Layers"},layers:[Nmt,Dmt]}],Gmt={type:"Tile",properties:{id:"customId",title:"Tile XYZ",layerControlToolsExpand:!0,layerConfig:{schema:{type:"object",properties:{vminmax:{type:"object",properties:{vmin:{type:"number",minimum:0,maximum:10,format:"range"},vmax:{type:"number",minimum:0,maximum:10,format:"range"}},format:"minmax"},cbar:{type:"string",enum:["rain","temperature"]}}}}},source:{type:"XYZ",url:"https://reccap2.api.dev.brockmann-consult.de/api/tiles/cop28~reccap2-9x108x139-0.0.1.zarr/deforested_biomass/{z}/{y}/{x}?crs=EPSG:3857&time=2018-01-01T00:00:00Z&vmin=0&vmax=3&cbar=rain"}},zmt={args:{idProperty:"id",titleProperty:"title",unstyled:!1},render:s=>Qt`
    <div style="display: flex">
      <eox-layercontrol
        .idProperty=${s.idProperty}
        .titleProperty=${s.titleProperty}
        .unstyled=${s.unstyled}
        for="eox-map"
      ></eox-layercontrol>
      <eox-map
        .style=${Ro}
        .zoom=${3}
        .layers=${T2}
      ></eox-map>
    </div>
  `},wI=(s,t=!0)=>({...s,properties:{...s.properties,layerControlExclusive:!0},visible:t}),Bmt={args:{},render:()=>Qt`
    <div style="display: flex">
      <eox-layercontrol for="eox-map#exclusive"></eox-layercontrol>
      <eox-map
        id="exclusive"
        .style=${Ro}
        .layers=${[wI(Cd),wI(C2,!1)]}
      >
      </eox-map>
    </div>
  `},Jx=s=>({...s,properties:{...s.properties,layerControlOptional:!0},visible:!1}),Umt={args:{},render:()=>Qt`
    <div style="display: flex">
      <eox-layercontrol for="eox-map#optional"></eox-layercontrol>
      <eox-map
        id="optional"
        .style=${Ro}
        .layers=${[Jx(C2),Jx(jmt),Jx($mt),Cd]}
      >
      </eox-map>
    </div>
  `},Vmt={args:{},render:()=>Qt`
    <div style="display: flex">
      <eox-layercontrol for="eox-map#expanded"></eox-layercontrol>
      <eox-map
        id="expanded"
        .style=${Ro}
        .layers=${[Cd,{type:"Group",properties:{title:"Layer group",layerControlExpand:!0},layers:[{...C2,visible:!1}]}]}
      >
      </eox-map>
    </div>
  `},Hmt={args:{},render:()=>Qt`
    <p>Default tools: info, opacity, config, remove, sort</p>
    <eox-layercontrol for="eox-map#tools"></eox-layercontrol>
    <hr />
    <p>Only one tool: info</p>
    <eox-layercontrol .tools=${["info"]} for="eox-map#tools"></eox-layercontrol>
    <hr />
    <p>Only one tool: sort</p>
    <eox-layercontrol .tools=${["sort"]} for="eox-map#tools"></eox-layercontrol>
    <hr />
    <p>No tools</p>
    <eox-layercontrol .tools=${[]} for="eox-map#tools"></eox-layercontrol>
    <eox-map
      id="tools"
      .style=${Ro}
      .layers=${[Zy,Cd]}
    >
    </eox-map>
  `},Wmt={args:{},render:()=>Qt`
    <eox-layercontrol
      .tools=${["config"]}
      for="eox-map#config"
    ></eox-layercontrol>
    <hr />
    <eox-map
      .center=${[-7e6,-5e5]}
      .zoom=${4}
      id="config"
      .style=${Ro}
      .layers=${[Gmt,Cd]}
    >
    </eox-map>
  `},Xmt=s=>({...s,properties:{...s.properties,layerControlHide:!0}}),qmt={args:{},render:()=>Qt`
    <div style="display: flex">
      <eox-layercontrol for="eox-map#hidden"></eox-layercontrol>
      <eox-map
        id="hidden"
        .style=${Ro}
        .layers=${[Xmt(Zy),Cd]}
      >
      </eox-map>
    </div>
  `},Ymt={args:{idProperty:"id",titleProperty:"title",unstyled:!1,addExternalLayers:!0},render:s=>Qt`
    <div style="display: flex">
      <eox-layercontrol
        .idProperty=${s.idProperty}
        .titleProperty=${s.titleProperty}
        .unstyled=${s.unstyled}
        .addExternalLayers=${s.addExternalLayers}
        for="eox-map"
      ></eox-layercontrol>
      <eox-map
        .style=${Ro}
        .zoom=${3}
        .layers=${T2}
      ></eox-map>
    </div>
  `},EI=(s,t)=>({...s,properties:{...s.properties,layerControlExclusive:!0},...t}),Zmt={args:{showLayerZoomState:!0},render:s=>Qt`
    <div style="display: flex">
      <eox-layercontrol
        .showLayerZoomState=${s.showLayerZoomState}
        for="eox-map#zoomstate"
      ></eox-layercontrol>
      <eox-map
        id="zoomstate"
        .style=${Ro}
        .zoom=${1}
        .layers=${[EI(Zy,{minZoom:2}),EI(zb.wind,{maxZoom:9})]}
      >
      </eox-map>
    </div>
  `},Kmt={args:{unstyled:!0},render:s=>Qt`
    <div style="display: flex">
      <eox-layercontrol
        .unstyled=${s.unstyled}
        for="eox-map"
      ></eox-layercontrol>
      <eox-map
        .style=${Ro}
        .zoom=${3}
        .layers=${T2}
      ></eox-map>
    </div>
  `},Jmt={title:"Elements/eox-layercontrol",tags:["autodocs"],component:"eox-layercontrol",parameters:{componentSubtitle:"Manage and configure OpenLayers map layers",layout:"centered"}},Fc=zmt,kc=Bmt,Nc=Umt,Dc=Vmt,$c=Hmt,jc=Wmt,Gc=qmt,zc=Ymt,Bc=Zmt,Uc=Kmt;var SI,CI,TI,RI,MI;Fc.parameters={...Fc.parameters,docs:{...(SI=Fc.parameters)==null?void 0:SI.docs,source:{originalSource:"PrimaryStory",...(TI=(CI=Fc.parameters)==null?void 0:CI.docs)==null?void 0:TI.source},description:{story:"Basic layercontrol setup.",...(MI=(RI=Fc.parameters)==null?void 0:RI.docs)==null?void 0:MI.description}}};var II,AI,LI,PI,OI;kc.parameters={...kc.parameters,docs:{...(II=kc.parameters)==null?void 0:II.docs,source:{originalSource:"ExclusiveLayersStory",...(LI=(AI=kc.parameters)==null?void 0:AI.docs)==null?void 0:LI.source},description:{story:"By adding the `layerControlExclusive` property to map layers,\nonly one of them at a time can be visualized.",...(OI=(PI=kc.parameters)==null?void 0:PI.docs)==null?void 0:OI.description}}};var FI,kI,NI,DI,$I;Nc.parameters={...Nc.parameters,docs:{...(FI=Nc.parameters)==null?void 0:FI.docs,source:{originalSource:"OptionalLayersStory",...(NI=(kI=Nc.parameters)==null?void 0:kI.docs)==null?void 0:NI.source},description:{story:`By adding the \`layerControlOptional\` property to map layers,
they are not initially rendered in the layer list, but in a
selection interface. They can be added to the layer list manually.
Removing a layer puts it back into the optional list.`,...($I=(DI=Nc.parameters)==null?void 0:DI.docs)==null?void 0:$I.description}}};var jI,GI,zI,BI,UI;Dc.parameters={...Dc.parameters,docs:{...(jI=Dc.parameters)==null?void 0:jI.docs,source:{originalSource:"ExpandedLayersStory",...(zI=(GI=Dc.parameters)==null?void 0:GI.docs)==null?void 0:zI.source},description:{story:"By adding the `layerControlExpand` property to map layers,\nthey render in the layer control as opened.",...(UI=(BI=Dc.parameters)==null?void 0:BI.docs)==null?void 0:UI.description}}};var VI,HI,WI,XI,qI;$c.parameters={...$c.parameters,docs:{...(VI=$c.parameters)==null?void 0:VI.docs,source:{originalSource:"ToolsStory",...(WI=(HI=$c.parameters)==null?void 0:HI.docs)==null?void 0:WI.source},description:{story:`The layer control accepts a "tools" array, which enable
extra functionalities for layers`,...(qI=(XI=$c.parameters)==null?void 0:XI.docs)==null?void 0:qI.description}}};var YI,ZI,KI,JI,QI;jc.parameters={...jc.parameters,docs:{...(YI=jc.parameters)==null?void 0:YI.docs,source:{originalSource:"LayerConfigStory",...(KI=(ZI=jc.parameters)==null?void 0:ZI.docs)==null?void 0:KI.source},description:{story:`The "config" tool reads settings passed via the "layerConfig" property,
e.g. rendering a from from a provided JSON schema that allows updating the
source url parameters.
Needs import of \`@eox/jsonform\` in order to work.`,...(QI=(JI=jc.parameters)==null?void 0:JI.docs)==null?void 0:QI.description}}};var tA,eA,iA,sA,rA;Gc.parameters={...Gc.parameters,docs:{...(tA=Gc.parameters)==null?void 0:tA.docs,source:{originalSource:"HiddenLayersStory",...(iA=(eA=Gc.parameters)==null?void 0:eA.docs)==null?void 0:iA.source},description:{story:"By adding the `layerControlHide` property to map layers,\nthey aren't displayed in the layer control at all (but may\nbe still rendered on the map).",...(rA=(sA=Gc.parameters)==null?void 0:sA.docs)==null?void 0:rA.description}}};var nA,oA,aA,lA,hA;zc.parameters={...zc.parameters,docs:{...(nA=zc.parameters)==null?void 0:nA.docs,source:{originalSource:"addExternalLayerStory",...(aA=(oA=zc.parameters)==null?void 0:oA.docs)==null?void 0:aA.source},description:{story:"Defining the configuration for adding an external layer like WMS/XYZ or import JSON.",...(hA=(lA=zc.parameters)==null?void 0:lA.docs)==null?void 0:hA.description}}};var cA,uA,dA,pA,gA;Bc.parameters={...Bc.parameters,docs:{...(cA=Bc.parameters)==null?void 0:cA.docs,source:{originalSource:"layerZoomStateStory",...(dA=(uA=Bc.parameters)==null?void 0:uA.docs)==null?void 0:dA.source},description:{story:"Zoom layer state based on `minZoom` and `maxZoom`.\nThe color change state only visible when `showLayerZoomState` is set inside layer properties.",...(gA=(pA=Bc.parameters)==null?void 0:pA.docs)==null?void 0:gA.description}}};var fA,mA,_A,yA,xA;Uc.parameters={...Uc.parameters,docs:{...(fA=Uc.parameters)==null?void 0:fA.docs,source:{originalSource:"unstyledStory",...(_A=(mA=Uc.parameters)==null?void 0:mA.docs)==null?void 0:_A.source},description:{story:"Unstyled version of the Element",...(xA=(yA=Uc.parameters)==null?void 0:yA.docs)==null?void 0:xA.description}}};const Qmt=["Primary","ExclusiveLayers","OptionalLayers","ExpandedLayers","Tools","LayerConfig","HiddenLayers","AddExternalLayer","LayerZoomState","Unstyled"],G_t=Object.freeze(Object.defineProperty({__proto__:null,AddExternalLayer:zc,ExclusiveLayers:kc,ExpandedLayers:Dc,HiddenLayers:Gc,LayerConfig:jc,LayerZoomState:Bc,OptionalLayers:Nc,Primary:Fc,Tools:$c,Unstyled:Uc,__namedExportsOrder:Qmt,default:Jmt},Symbol.toStringTag,{value:"Module"}));export{od as Z,u_t as _,G_t as l,d_t as y};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./raw-_eObXrMO-oXDaFVpk.js","./basedecoder-PFIibI7U-dTiwOugk.js","./lzw-5BnjP5Zu-0J7qsfmy.js","./jpeg-cL5qbLGO-7dbkD1kf.js","./deflate-vcCR2g03-wnJcwXgQ.js","./pako.esm-BSHzuB9t-sBEVeKh3.js","./packbits-QLsyzNt2-ZLc6Jich.js","./lerc-9qQlmsx0-loZIUmm3.js","./iframe-e2n9tP5e.js","./lit-element-uhisBW42.js","./when-fh6s5Pmf.js","./index-EJ4ljtJk.js","./directive-helpers-qkjFCehB.js","./_commonjsHelpers-4gQjN7DL.js","./unsafe-html-rU-ujVzY.js","./map-K4dZiwsf.js","./button--cdmXcoW.js","./slider-MCblB636.js","./webimage-Hf-HYtMO-GVd5WROI.js","./decoder-00rTu5yO-N9Evg126.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
