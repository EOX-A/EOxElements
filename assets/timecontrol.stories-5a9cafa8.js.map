{"version":3,"file":"timecontrol.stories-5a9cafa8.js","sources":["../../elements/timecontrol/src/style.ts","../../elements/timecontrol/src/style.eox.ts","../../elements/timecontrol/src/main.ts"],"sourcesContent":["export const style = `\n:host {\n  display: block;\n}\n`;\n","import { button } from \"../../../utils/styles/button\";\n\nexport const styleEOX = `\n* {\n  font-family: Roboto, sans-serif;\n}\n\n${button}\n\nbutton.icon-text.play:before {\n  content: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Ctitle%3Eplay%3C/title%3E%3Cpath d='M8,5.14V19.14L19,12.14L8,5.14Z' fill='%23fff' /%3E%3C/svg%3E\");\n}\n\nbutton.icon-text.pause:before {\n  content: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Ctitle%3Epause%3C/title%3E%3Cpath d='M14,19H18V5H14M6,19H10V5H6V19Z' fill='%23fff' /%3E%3C/svg%3E\");\n}\n\nbutton.icon.previous:before {\n  content: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Ctitle%3Earrow-left-drop-circle%3C/title%3E%3Cpath d='M22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2A10,10 0 0,1 22,12M14,7L9,12L14,17V7Z' fill='%23004170' /%3E%3C/svg%3E\");\n}\n\nbutton.icon.next:before {\n  content: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Ctitle%3Earrow-right-drop-circle%3C/title%3E%3Cpath d='M2,12A10,10 0 0,1 12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12M10,17L15,12L10,7V17Z' fill='%23004170' /%3E%3C/svg%3E\");\n}\n`;\n","import { LitElement, html } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators.js\";\nimport { Map } from \"ol\";\nimport Layer from \"ol/layer/Layer\";\nimport UrlTile from \"ol/source/UrlTile\";\nimport \"toolcool-range-slider\";\nimport { style } from \"./style\";\nimport { styleEOX } from \"./style.eox\";\nimport { UrlFunction } from \"ol/Tile\";\n\n@customElement(\"eox-timecontrol\")\nexport class EOxTimeControl extends LitElement {\n  /**\n   * The WMS parameter to update\n   */\n  @property({ attribute: \"animation-property\" })\n  animationProperty?: string;\n\n  /**\n   * The list of available values for the animation property\n   */\n  @property({ attribute: \"animation-values\", type: Array })\n  animationValues: Array<string> = [];\n\n  /**\n   * The query selector for the map\n   */\n  @property()\n  for: string;\n\n  /**\n   * The layerid of the animated layer\n   */\n  @property()\n  layer: string;\n\n  /**\n   * Display a slider for the values\n   */\n  @property({ type: Boolean })\n  slider: boolean;\n\n  /**\n   * Custom url function to manually override the url creation. Receives the current url as property.\n   * @param url the current url function output\n   * @returns url the new url string\n   * @example ```\n   * document.querySelector(\"eox-timecontrol\").urlFunction = (url) => {\n   *   // do something with the url\n   *   const newUrl = url.replace('foo', 'bar');\n   *   return newUrl;\n   *};\n   * ```\n   */\n  @property()\n  urlFunction: (url: string) => string;\n\n  /**\n   * Original tile url function of the source.\n   * Used to get the correct TileGrid-Values, while manipulating certain parts of the URL.\n   */\n  @property()\n  private _originalTileUrlFunction: UrlFunction;\n\n  /**\n   * Go to next step\n   */\n  next() {\n    this._updateStep(+1);\n  }\n\n  /**\n   * Go to previous step\n   */\n  previous() {\n    this._updateStep(-1);\n  }\n\n  /**\n   * Toggle play animation\n   * @param on animation on/off\n   */\n  playAnimation(on: boolean) {\n    if (on) {\n      this._animationInterval = setInterval(() => this._updateStep(1), 500);\n    } else {\n      clearInterval(this._animationInterval);\n    }\n    this._isAnimationPlaying = on;\n    this.requestUpdate();\n  }\n\n  /**\n   * Set the config at a later point\n   * @param config\n   */\n  setConfig(config: {\n    layer: string;\n    animationProperty: string;\n    animationValues: Array<string>;\n  }) {\n    this.layer = config.layer ?? this.layer;\n    this.animationProperty = config.animationProperty ?? this.animationProperty;\n    this.animationValues = config.animationValues ?? this.animationValues;\n    this.requestUpdate();\n    this._updateStep(0);\n  }\n\n  @state()\n  private _animationInterval: ReturnType<typeof setInterval>;\n\n  @state()\n  private _animationSource: UrlTile;\n\n  @state()\n  private _isAnimationPlaying: boolean;\n\n  @state()\n  private _newTimeIndex = 0;\n\n  @property({ type: Boolean })\n  unstyled: boolean;\n\n  private _updateStep(step = 1) {\n    this._newTimeIndex = this._newTimeIndex + step;\n    if (this._newTimeIndex > this.animationValues.length - 1) {\n      this._newTimeIndex = 0;\n    }\n    if (this._newTimeIndex < 0) {\n      this._newTimeIndex = this.animationValues.length - 1;\n    }\n\n    //@ts-ignore\n    this._animationSource.setTileUrlFunction(\n      //@ts-ignore\n      (tileCoord, pixelRatio, projection) => {\n        const src = this._originalTileUrlFunction(\n          tileCoord,\n          pixelRatio,\n          projection\n        );\n        if (this.urlFunction) {\n          return this.urlFunction(src);\n        }\n        const searchParams = new URLSearchParams(\n          src.substring(src.indexOf(\"?\"))\n        );\n        searchParams.set(\n          this.animationProperty,\n          this.animationValues[this._newTimeIndex]\n        );\n\n        return src.substring(0, src.indexOf(\"?\") + 1) + searchParams.toString();\n      }\n    );\n    // TODO dont be accessing protected methods!\n    //@ts-ignore\n    this._animationSource.setKey(new Date());\n    this._animationSource.changed();\n    this.requestUpdate();\n  }\n\n  render() {\n    const mapQuery = document.querySelector(this.for as string);\n    // @ts-ignore\n    const olMap: Map = mapQuery.map || mapQuery;\n\n    olMap.once(\"loadend\", () => {\n      if (!this._originalTileUrlFunction) {\n        const animationLayer = olMap\n          .getLayers()\n          .getArray()\n          .find((l) => l.get(\"id\") === this.layer) as Layer;\n        this._animationSource = animationLayer.getSource() as UrlTile;\n        this._originalTileUrlFunction =\n          //@ts-ignore\n          this._animationSource.getTileUrlFunction();\n      }\n    });\n\n    return html`\n      <style>\n        ${style}\n        ${!this.unstyled && styleEOX}\n      </style>\n      <main>\n        <div id=\"controls\" part=\"controls\">\n          <button\n            part=\"previous\"\n            class=\"icon previous\"\n            @click=\"${() => this.previous()}\"\n          >\n            <\n          </button>\n          <button part=\"next\" class=\"icon next\" @click=\"${() => this.next()}\">\n            >\n          </button>\n          <button\n            part=\"play\"\n            class=\"icon-text ${this._isAnimationPlaying ? \"pause\" : \"play\"}\"\n            @click=\"${() =>\n              this.playAnimation(this._isAnimationPlaying ? false : true)}\"\n          >\n            ${this._isAnimationPlaying ? \"Pause\" : \"Play\"}\n          </button>\n\n          ${this.slider\n            ? html`\n                <tc-range-slider\n                  data=\"${this.animationValues}\"\n                  part=\"slider\"\n                  value=\"${this.animationValues[this._newTimeIndex]}\"\n                  style=\"display: inline-block;\"\n                  @change=\"${(evt: { detail: { value: string } }) =>\n                    this._updateStep(\n                      this.animationValues.findIndex(\n                        (v) => v === evt.detail.value\n                      ) - this._newTimeIndex\n                    )}\"\n                ></tc-range-slider>\n              `\n            : \"\"}\n\n          <span part=\"current\"\n            >${this.animationValues[this._newTimeIndex]}</span\n          >\n        </div>\n      </main>\n    `;\n  }\n}\n"],"names":["style","styleEOX","button","EOxTimeControl","LitElement","on","config","step","tileCoord","pixelRatio","projection","src","searchParams","mapQuery","olMap","animationLayer","l","html","evt","v","__decorateClass","property","state","customElement"],"mappings":"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"}