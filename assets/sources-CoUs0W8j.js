function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./raw-Dt1HMqYc.js","./basedecoder-DvumDe3Y.js","./lzw-DpvbRwG5.js","./jpeg-CdeCw_eT.js","./deflate-CUkHh1nh.js","./pako.esm-CPws4d4z.js","./packbits-DQnG8s9w.js","./lerc-Bav3bQjX.js","./_commonjsHelpers-BosuxZz1.js","./main-BYQt9p7Q.js","./lit-element-Bq1Y8_dt.js","./state-DQZYXMyu.js","./index-CBTDJjUK.js","./iframe-BuCumc0t.js","./webimage-BcnuJlio.js","./decoder-Ddo2r026.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
var Uu=Object.defineProperty;var Bu=(r,e,t)=>e in r?Uu(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ei=(r,e,t)=>(Bu(r,typeof e!="symbol"?e+"":e,t),t);import{J as zu,F as Ye,g as _e,i as ku,t as Ce,d as $u,l as ju,c as fn,a as Ti,P as rt,b as dt,M as dr,e as Mn,f as Vr,h as Xr,X as Fn,m as H,j as Y,p as G,k as Zi,n as dn,G as Zu,o as Vu,q as At,s as pn,u as Ea,v as J,w as P,x as se,y as xe,z as Xe,O as pr,A as Pt,B as Nr,C as wa,D as $,E as gn,H as mn,I as R,K as D,N as Nn,Q as Re,R as Ne,S as _n,U as Ta,V as Dt,W as Xu,Y as Vi,Z as va,_ as yt,$ as pt,a0 as Ee,a1 as Hu,a2 as Wu,a3 as Ct,a4 as io,a5 as bt,a6 as sr,a7 as Xi,a8 as Sa,a9 as Yu,aa as Ra,ab as qu,ac as ba,ad as Ku,ae as Qu,af as yn,ag as Ju,ah as Dr,ai as Hi,aj as so,ak as Or,al as oo,am as vi,an as Ut,ao as Dn,ap as ec,aq as tc,ar as rc,as as ht,at as xn,au as Wi,av as It,aw as br,ax as ar,ay as He,az as ve,aA as Gr,aB as tr,aC as nc,aD as Pe,aE as Pa,aF as nt,aG as Yi,aH as ic,aI as sc,aJ as Aa,aK as ti,aL as oc,aM as qi,aN as ac,aO as Pr,aP as en,aQ as lr,aR as Ki,aS as Ia,aT as Ur,aU as La,aV as Si,aW as Ca,aX as q,aY as wt,aZ as ao,a_ as ri,a$ as lc,b0 as lo,b1 as $e,b2 as uc,b3 as cc,b4 as hc,b5 as fc,b6 as Qi,b7 as ft,b8 as Ji,b9 as Kt,ba as dc,bb as Ri,bc as Oa,bd as pc,be as uo,bf as gc,bg as mc,bh as Ma,bi as Br,bj as _c,bk as yc,bl as xc,bm as bi,bn as Ec,bo as he,bp as un,bq as ur,br as We,bs as Ke,bt as wc,bu as ie,bv as Tc,bw as Fa,bx as Bt,by as vc,bz as Sc,bA as Na,bB as Ot,bC as Rc,bD as bc,bE as Pc,bF as Da,bG as Ac,L as Ga,bH as es,bI as En,bJ as Ua,bK as vt,bL as Hr,bM as Wr,bN as ts,bO as rs,bP as cr,bQ as Ic,bR as Lc,bS as Cc,bT as Gn,bU as Oc,bV as Mc,bW as Fc,bX as wn,bY as Nc,bZ as ni,b_ as Tn,b$ as Un,c0 as Dc,c1 as Gc,c2 as co,c3 as ho,c4 as fo,c5 as Uc,c6 as Bc,c7 as Pi,c8 as zc,c9 as kc,ca as gr,cb as Ba,cc as po,cd as vn,ce as go,cf as Vt,cg as ns,ch as Bn,ci as $c,cj as is,ck as za,cl as jc,cm as Zc,cn as Vc,co as Xc,cp as ka,cq as Hc,cr as Wc,cs as Yc,ct as qc,cu as $a,cv as Kc,cw as ja,cx as Qc,cy as Jc,cz as eh,cA as Za,cB as th,cC as rh,cD as nh}from"./main-BYQt9p7Q.js";import{g as zn,c as zt}from"./_commonjsHelpers-BosuxZz1.js";import{_ as Mt}from"./iframe-BuCumc0t.js";const ih={Point:lh,LineString:uh,Polygon:dh,MultiPoint:hh,MultiLineString:ch,MultiPolygon:fh},sh={Point:ph,LineString:gh,Polygon:mh,MultiPoint:yh,MultiLineString:_h,MultiPolygon:xh};class oh extends zu{constructor(e){e=e||{},super(),this.geometryName_=e.geometryName}readFeatureFromObject(e,t,n){const i=e,s=mo(i.geometry,t),o=new Ye;if(this.geometryName_&&o.setGeometryName(this.geometryName_),o.setGeometry(s),i.attributes){o.setProperties(i.attributes,!0);const a=i.attributes[n];a!==void 0&&o.setId(a)}return o}readFeaturesFromObject(e,t){if(t=t||{},e.features){const n=e,i=[],s=n.features;for(let o=0,a=s.length;o<a;++o)i.push(this.readFeatureFromObject(s[o],t,e.objectIdFieldName));return i}return[this.readFeatureFromObject(e,t)]}readGeometryFromObject(e,t){return mo(e,t)}readProjectionFromObject(e){if(e.spatialReference&&e.spatialReference.wkid!==void 0){const n=e.spatialReference.wkid;return _e("EPSG:"+n)}return null}writeGeometryObject(e,t){return _o(e,this.adaptOptions(t))}writeFeatureObject(e,t){t=this.adaptOptions(t);const n={};if(!e.hasProperties())return n.attributes={},n;const i=e.getProperties(),s=e.getGeometry();if(s){n.geometry=_o(s,t);const o=t&&(t.dataProjection||t.featureProjection);o&&(n.geometry.spatialReference={wkid:Number(_e(o).getCode().split(":").pop())}),delete i[e.getGeometryName()]}return ku(i)?n.attributes={}:n.attributes=i,n}writeFeaturesObject(e,t){t=this.adaptOptions(t);const n=[];for(let i=0,s=e.length;i<s;++i)n.push(this.writeFeatureObject(e[i],t));return{features:n}}}function mo(r,e){if(!r)return null;let t;if(typeof r.x=="number"&&typeof r.y=="number")t="Point";else if(r.points)t="MultiPoint";else if(r.paths)r.paths.length===1?t="LineString":t="MultiLineString";else if(r.rings){const i=r,s=mr(i),o=ah(i.rings,s);o.length===1?(t="Polygon",r=Object.assign({},r,{rings:o[0]})):(t="MultiPolygon",r=Object.assign({},r,{rings:o}))}const n=ih[t];return Ce(n(r),!1,e)}function ah(r,e){const t=[],n=[],i=[];let s,o;for(s=0,o=r.length;s<o;++s)t.length=0,$u(t,0,r[s],e.length),ju(t,0,t.length,e.length)?n.push([r[s]]):i.push(r[s]);for(;i.length;){const a=i.shift();let l=!1;for(s=n.length-1;s>=0;s--){const u=n[s][0];if(fn(new Ti(u).getExtent(),new Ti(a).getExtent())){n[s].push(a),l=!0;break}}l||n.push([a.reverse()])}return n}function lh(r){let e;return r.m!==void 0&&r.z!==void 0?e=new rt([r.x,r.y,r.z,r.m],"XYZM"):r.z!==void 0?e=new rt([r.x,r.y,r.z],"XYZ"):r.m!==void 0?e=new rt([r.x,r.y,r.m],"XYM"):e=new rt([r.x,r.y]),e}function uh(r){const e=mr(r);return new dt(r.paths[0],e)}function ch(r){const e=mr(r);return new dr(r.paths,e)}function mr(r){let e="XY";return r.hasZ===!0&&r.hasM===!0?e="XYZM":r.hasZ===!0?e="XYZ":r.hasM===!0&&(e="XYM"),e}function hh(r){const e=mr(r);return new Mn(r.points,e)}function fh(r){const e=mr(r);return new Vr(r.rings,e)}function dh(r){const e=mr(r);return new Xr(r.rings,e)}function ph(r,e){const t=r.getCoordinates();let n;const i=r.getLayout();if(i==="XYZ")n={x:t[0],y:t[1],z:t[2]};else if(i==="XYM")n={x:t[0],y:t[1],m:t[2]};else if(i==="XYZM")n={x:t[0],y:t[1],z:t[2],m:t[3]};else if(i==="XY")n={x:t[0],y:t[1]};else throw new Error("Invalid geometry layout");return n}function Yr(r){const e=r.getLayout();return{hasZ:e==="XYZ"||e==="XYZM",hasM:e==="XYM"||e==="XYZM"}}function gh(r,e){const t=Yr(r);return{hasZ:t.hasZ,hasM:t.hasM,paths:[r.getCoordinates()]}}function mh(r,e){const t=Yr(r);return{hasZ:t.hasZ,hasM:t.hasM,rings:r.getCoordinates(!1)}}function _h(r,e){const t=Yr(r);return{hasZ:t.hasZ,hasM:t.hasM,paths:r.getCoordinates()}}function yh(r,e){const t=Yr(r);return{hasZ:t.hasZ,hasM:t.hasM,points:r.getCoordinates()}}function xh(r,e){const t=Yr(r),n=r.getCoordinates(!1),i=[];for(let s=0;s<n.length;s++)for(let o=n[s].length-1;o>=0;o--)i.push(n[s][o]);return{hasZ:t.hasZ,hasM:t.hasM,rings:i}}function _o(r,e){const t=sh[r.getType()];return t(Ce(r,!0,e),e)}const Eh=oh,Et="http://www.opengis.net/gml",wh=/^\s*$/;class j extends Fn{constructor(e){super(),e=e||{},this.featureType=e.featureType,this.featureNS=e.featureNS,this.srsName=e.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:H(this.readFeaturesInternal),featureMembers:Y(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(e,t){const n=e.localName;let i=null;if(n=="FeatureCollection")i=G([],this.FEATURE_COLLECTION_PARSERS,e,t,this);else if(n=="featureMembers"||n=="featureMember"||n=="member"){const s=t[0];let o=s.featureType,a=s.featureNS;const l="p",u="p0";if(!o&&e.childNodes){o=[],a={};for(let d=0,g=e.childNodes.length;d<g;++d){const m=e.childNodes[d];if(m.nodeType===1){const y=m.nodeName.split(":").pop();if(!o.includes(y)){let x="",w=0;const E=m.namespaceURI;for(const v in a){if(a[v]===E){x=v;break}++w}x||(x=l+w,a[x]=E),o.push(x+":"+y)}}}n!="featureMember"&&(s.featureType=o,s.featureNS=a)}if(typeof a=="string"){const d=a;a={},a[u]=d}const h={},f=Array.isArray(o)?o:[o];for(const d in a){const g={};for(let m=0,y=f.length;m<y;++m)(f[m].includes(":")?f[m].split(":")[0]:u)===d&&(g[f[m].split(":").pop()]=n=="featureMembers"?H(this.readFeatureElement,this):Y(this.readFeatureElement,this));h[a[d]]=g}n=="featureMember"||n=="member"?i=G(void 0,h,e,t):i=G([],h,e,t)}return i===null&&(i=[]),i}readGeometryOrExtent(e,t){const n=t[0];return n.srsName=e.firstElementChild.getAttribute("srsName"),n.srsDimension=e.firstElementChild.getAttribute("srsDimension"),G(null,this.GEOMETRY_PARSERS,e,t,this)}readExtentElement(e,t){const n=t[0],i=this.readGeometryOrExtent(e,t);return i?Zi(i,n):void 0}readGeometryElement(e,t){const n=t[0],i=this.readGeometryOrExtent(e,t);return i?Ce(i,!1,n):void 0}readFeatureElementInternal(e,t,n){let i;const s={};for(let l=e.firstElementChild;l;l=l.nextElementSibling){let u;const h=l.localName;l.childNodes.length===0||l.childNodes.length===1&&(l.firstChild.nodeType===3||l.firstChild.nodeType===4)?(u=dn(l,!1),wh.test(u)&&(u=void 0)):(n&&(u=h==="boundedBy"?this.readExtentElement(l,t):this.readGeometryElement(l,t)),u?h!=="boundedBy"&&(i=h):u=this.readFeatureElementInternal(l,t,!1));const f=l.attributes.length;if(f>0&&!(u instanceof Zu)){u={_content_:u};for(let d=0;d<f;d++){const g=l.attributes[d].name;u[g]=l.attributes[d].value}}s[h]?(s[h]instanceof Array||(s[h]=[s[h]]),s[h].push(u)):s[h]=u}if(!n)return s;const o=new Ye(s);i&&o.setGeometryName(i);const a=e.getAttribute("fid")||Vu(e,this.namespace,"id");return a&&o.setId(a),o}readFeatureElement(e,t){return this.readFeatureElementInternal(e,t,!0)}readPoint(e,t){const n=this.readFlatCoordinatesFromNode(e,t);if(n)return new rt(n,"XYZ")}readMultiPoint(e,t){const n=G([],this.MULTIPOINT_PARSERS,e,t,this);if(n)return new Mn(n)}readMultiLineString(e,t){const n=G([],this.MULTILINESTRING_PARSERS,e,t,this);if(n)return new dr(n)}readMultiPolygon(e,t){const n=G([],this.MULTIPOLYGON_PARSERS,e,t,this);if(n)return new Vr(n)}pointMemberParser(e,t){At(this.POINTMEMBER_PARSERS,e,t,this)}lineStringMemberParser(e,t){At(this.LINESTRINGMEMBER_PARSERS,e,t,this)}polygonMemberParser(e,t){At(this.POLYGONMEMBER_PARSERS,e,t,this)}readLineString(e,t){const n=this.readFlatCoordinatesFromNode(e,t);if(n)return new dt(n,"XYZ")}readFlatLinearRing(e,t){const n=G(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this);if(n)return n}readLinearRing(e,t){const n=this.readFlatCoordinatesFromNode(e,t);if(n)return new Ti(n,"XYZ")}readPolygon(e,t){const n=G([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this);if(n&&n[0]){const i=n[0],s=[i.length];let o,a;for(o=1,a=n.length;o<a;++o)pn(i,n[o]),s.push(i.length);return new Xr(i,"XYZ",s)}}readFlatCoordinatesFromNode(e,t){return G(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}readGeometryFromNode(e,t){const n=this.readGeometryElement(e,[this.getReadOptions(e,t||{})]);return n||null}readFeaturesFromNode(e,t){const n={featureType:this.featureType,featureNS:this.featureNS};return n&&Object.assign(n,this.getReadOptions(e,t)),this.readFeaturesInternal(e,[n])||[]}readProjectionFromNode(e){return _e(this.srsName?this.srsName:e.firstElementChild.getAttribute("srsName"))}}j.prototype.namespace=Et;j.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};j.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};j.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};j.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:H(j.prototype.pointMemberParser),pointMembers:H(j.prototype.pointMemberParser)}};j.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:H(j.prototype.lineStringMemberParser),lineStringMembers:H(j.prototype.lineStringMemberParser)}};j.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:H(j.prototype.polygonMemberParser),polygonMembers:H(j.prototype.polygonMemberParser)}};j.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:H(j.prototype.readFlatCoordinatesFromNode)}};j.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:H(j.prototype.readLineString)}};j.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:H(j.prototype.readPolygon)}};j.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:Y(j.prototype.readFlatLinearRing)}};const Th=Et+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",vh={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class ne extends j{constructor(e){e=e||{},super(e),this.FEATURE_COLLECTION_PARSERS[Et].featureMember=H(this.readFeaturesInternal),this.schemaLocation=e.schemaLocation?e.schemaLocation:Th}readFlatCoordinates(e,t){const n=dn(e,!1).replace(/^\s*|\s*$/g,""),s=t[0].srsName;let o="enu";if(s){const u=_e(s);u&&(o=u.getAxisOrientation())}const a=n.trim().split(/\s+/),l=[];for(let u=0,h=a.length;u<h;u++){const f=a[u].split(/,+/),d=parseFloat(f[0]),g=parseFloat(f[1]),m=f.length===3?parseFloat(f[2]):0;o.substr(0,2)==="en"?l.push(d,g,m):l.push(g,d,m)}return l}readBox(e,t){const n=G([null],this.BOX_PARSERS_,e,t,this);return Ea(n[1][0],n[1][1],n[1][3],n[1][4])}innerBoundaryIsParser(e,t){const n=G(void 0,this.RING_PARSERS,e,t,this);n&&t[t.length-1].push(n)}outerBoundaryIsParser(e,t){const n=G(void 0,this.RING_PARSERS,e,t,this);if(n){const i=t[t.length-1];i[0]=n}}GEOMETRY_NODE_FACTORY_(e,t,n){const i=t[t.length-1],s=i.multiSurface,o=i.surface,a=i.multiCurve;return Array.isArray(e)?n="Envelope":(n=e.getType(),n==="MultiPolygon"&&s===!0?n="MultiSurface":n==="Polygon"&&o===!0?n="Surface":n==="MultiLineString"&&a===!0&&(n="MultiCurve")),J("http://www.opengis.net/gml",n)}writeFeatureElement(e,t,n){const i=t.getId();i&&e.setAttribute("fid",i);const s=n[n.length-1],o=s.featureNS,a=t.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],u=[];if(t.hasProperties()){const f=t.getProperties();for(const d in f){const g=f[d];g!==null&&(l.push(d),u.push(g),d==a||typeof g.getSimplifiedGeometry=="function"?d in s.serializers[o]||(s.serializers[o][d]=P(this.writeGeometryElement,this)):d in s.serializers[o]||(s.serializers[o][d]=P(se)))}}const h=Object.assign({},s);h.node=e,xe(h,s.serializers,Xe(void 0,o),u,n,l)}writeCurveOrLineString(e,t,n){const s=n[n.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,n)}else if(e.nodeName==="Curve"){const o=J(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,n)}}writeLineStringOrCurveMember(e,t,n){const i=this.GEOMETRY_NODE_FACTORY_(t,n);i&&(e.appendChild(i),this.writeCurveOrLineString(i,t,n))}writeMultiCurveOrLineString(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.curve;o&&e.setAttribute("srsName",o);const l=t.getLineStrings();xe({node:e,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeGeometryElement(e,t,n){const i=n[n.length-1],s=Object.assign({},i);s.node=e;let o;Array.isArray(t)?o=Zi(t,i):o=Ce(t,!0,i),xe(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],n,void 0,this)}createCoordinatesNode_(e){const t=J(e,"coordinates");return t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," "),t}writeCoordinates_(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=t.getCoordinates(),l=a.length,u=new Array(l);for(let h=0;h<l;++h){const f=a[h];u[h]=this.getCoords_(f,o,s)}se(e,u.join(" "))}writeCurveSegments_(e,t,n){const i=J(e.namespaceURI,"LineStringSegment");e.appendChild(i),this.writeCurveOrLineString(i,t,n)}writeSurfaceOrPolygon(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();xe({node:e,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,n,void 0,this)}else if(e.nodeName==="Surface"){const a=J(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,n)}}RING_NODE_FACTORY_(e,t,n){const i=t[t.length-1],s=i.node,o=i.exteriorWritten;return o===void 0&&(i.exteriorWritten=!0),J(s.namespaceURI,o!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(e,t,n){const i=J(e.namespaceURI,"PolygonPatch");e.appendChild(i),this.writeSurfaceOrPolygon(i,t,n)}writeRing(e,t,n){const i=J(e.namespaceURI,"LinearRing");e.appendChild(i),this.writeLinearRing(i,t,n)}getCoords_(e,t,n){let i="enu";t&&(i=_e(t).getAxisOrientation());let s=i.substr(0,2)==="en"?e[0]+","+e[1]:e[1]+","+e[0];if(n){const o=e[2]||0;s+=","+o}return s}writePoint(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;o&&e.setAttribute("srsName",o);const a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a);const l=t.getCoordinates(),u=this.getCoords_(l,o,s);se(a,u)}writeMultiPoint(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;o&&e.setAttribute("srsName",o);const a=t.getPoints();xe({node:e,hasZ:s,srsName:o},this.POINTMEMBER_SERIALIZERS,Xe("pointMember"),a,n,void 0,this)}writePointMember(e,t,n){const i=J(e.namespaceURI,"Point");e.appendChild(i),this.writePoint(i,t,n)}writeLinearRing(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,n)}writeMultiSurfaceOrPolygon(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.surface;o&&e.setAttribute("srsName",o);const l=t.getPolygons();xe({node:e,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeSurfaceOrPolygonMember(e,t,n){const i=this.GEOMETRY_NODE_FACTORY_(t,n);i&&(e.appendChild(i),this.writeSurfaceOrPolygon(i,t,n))}writeEnvelope(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];xe({node:e},this.ENVELOPE_SERIALIZERS,pr,a,n,o,this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,n){const i=t[t.length-1].node;return J("http://www.opengis.net/gml",vh[i.nodeName])}}ne.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:Y(ne.prototype.readFlatCoordinates)}};ne.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:ne.prototype.innerBoundaryIsParser,outerBoundaryIs:ne.prototype.outerBoundaryIsParser}};ne.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:H(ne.prototype.readFlatCoordinates)}};ne.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:Y(j.prototype.readPoint),MultiPoint:Y(j.prototype.readMultiPoint),LineString:Y(j.prototype.readLineString),MultiLineString:Y(j.prototype.readMultiLineString),LinearRing:Y(j.prototype.readLinearRing),Polygon:Y(j.prototype.readPolygon),MultiPolygon:Y(j.prototype.readMultiPolygon),Box:Y(ne.prototype.readBox)}};ne.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:P(ne.prototype.writeCurveOrLineString),MultiCurve:P(ne.prototype.writeMultiCurveOrLineString),Point:P(ne.prototype.writePoint),MultiPoint:P(ne.prototype.writeMultiPoint),LineString:P(ne.prototype.writeCurveOrLineString),MultiLineString:P(ne.prototype.writeMultiCurveOrLineString),LinearRing:P(ne.prototype.writeLinearRing),Polygon:P(ne.prototype.writeSurfaceOrPolygon),MultiPolygon:P(ne.prototype.writeMultiSurfaceOrPolygon),Surface:P(ne.prototype.writeSurfaceOrPolygon),MultiSurface:P(ne.prototype.writeMultiSurfaceOrPolygon),Envelope:P(ne.prototype.writeEnvelope)}};ne.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:P(ne.prototype.writeLineStringOrCurveMember),curveMember:P(ne.prototype.writeLineStringOrCurveMember)}};ne.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:P(ne.prototype.writeRing),innerBoundaryIs:P(ne.prototype.writeRing)}};ne.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:P(ne.prototype.writePointMember)}};ne.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:P(ne.prototype.writeSurfaceOrPolygonMember),polygonMember:P(ne.prototype.writeSurfaceOrPolygonMember)}};ne.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:P(se),upperCorner:P(se)}};const Sh=Et+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",Rh={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class Z extends j{constructor(e){e=e||{},super(e),this.surface_=e.surface!==void 0?e.surface:!1,this.curve_=e.curve!==void 0?e.curve:!1,this.multiCurve_=e.multiCurve!==void 0?e.multiCurve:!0,this.multiSurface_=e.multiSurface!==void 0?e.multiSurface:!0,this.schemaLocation=e.schemaLocation?e.schemaLocation:Sh,this.hasZ=e.hasZ!==void 0?e.hasZ:!1}readMultiCurve(e,t){const n=G([],this.MULTICURVE_PARSERS,e,t,this);if(n)return new dr(n)}readFlatCurveRing(e,t){const n=G([],this.MULTICURVE_PARSERS,e,t,this),i=[];for(let s=0,o=n.length;s<o;++s)pn(i,n[s].getFlatCoordinates());return i}readMultiSurface(e,t){const n=G([],this.MULTISURFACE_PARSERS,e,t,this);if(n)return new Vr(n)}curveMemberParser(e,t){At(this.CURVEMEMBER_PARSERS,e,t,this)}surfaceMemberParser(e,t){At(this.SURFACEMEMBER_PARSERS,e,t,this)}readPatch(e,t){return G([null],this.PATCHES_PARSERS,e,t,this)}readSegment(e,t){return G([],this.SEGMENTS_PARSERS,e,t,this)}readPolygonPatch(e,t){return G([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this)}readLineStringSegment(e,t){return G([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}interiorParser(e,t){const n=G(void 0,this.RING_PARSERS,e,t,this);n&&t[t.length-1].push(n)}exteriorParser(e,t){const n=G(void 0,this.RING_PARSERS,e,t,this);if(n){const i=t[t.length-1];i[0]=n}}readSurface(e,t){const n=G([null],this.SURFACE_PARSERS,e,t,this);if(n&&n[0]){const i=n[0],s=[i.length];let o,a;for(o=1,a=n.length;o<a;++o)pn(i,n[o]),s.push(i.length);return new Xr(i,"XYZ",s)}}readCurve(e,t){const n=G([null],this.CURVE_PARSERS,e,t,this);if(n)return new dt(n,"XYZ")}readEnvelope(e,t){const n=G([null],this.ENVELOPE_PARSERS,e,t,this);return Ea(n[1][0],n[1][1],n[2][0],n[2][1])}readFlatPos(e,t){let n=dn(e,!1);const i=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,s=[];let o;for(;o=i.exec(n);)s.push(parseFloat(o[1])),n=n.substr(o[0].length);if(n!=="")return;const l=t[0].srsName;let u="enu";if(l&&(u=_e(l).getAxisOrientation()),u==="neu"){let f,d;for(f=0,d=s.length;f<d;f+=3){const g=s[f],m=s[f+1];s[f]=m,s[f+1]=g}}const h=s.length;if(h==2&&s.push(0),h!==0)return s}readFlatPosList(e,t){const n=dn(e,!1).replace(/^\s*|\s*$/g,""),i=t[0],s=i.srsName,o=i.srsDimension;let a="enu";s&&(a=_e(s).getAxisOrientation());const l=n.split(/\s+/);let u=2;e.getAttribute("srsDimension")?u=Pt(e.getAttribute("srsDimension")):e.getAttribute("dimension")?u=Pt(e.getAttribute("dimension")):e.parentNode.getAttribute("srsDimension")?u=Pt(e.parentNode.getAttribute("srsDimension")):o&&(u=Pt(o));let h,f,d;const g=[];for(let m=0,y=l.length;m<y;m+=u)h=parseFloat(l[m]),f=parseFloat(l[m+1]),d=u===3?parseFloat(l[m+2]):0,a.substr(0,2)==="en"?g.push(h,f,d):g.push(f,h,d);return g}writePos_(e,t,n){const i=n[n.length-1],s=i.hasZ,o=s?"3":"2";e.setAttribute("srsDimension",o);const a=i.srsName;let l="enu";a&&(l=_e(a).getAxisOrientation());const u=t.getCoordinates();let h;if(l.substr(0,2)==="en"?h=u[0]+" "+u[1]:h=u[1]+" "+u[0],s){const f=u[2]||0;h+=" "+f}se(e,h)}getCoords_(e,t,n){let i="enu";t&&(i=_e(t).getAxisOrientation());let s=i.substr(0,2)==="en"?e[0]+" "+e[1]:e[1]+" "+e[0];if(n){const o=e[2]||0;s+=" "+o}return s}writePosList_(e,t,n){const i=n[n.length-1],s=i.hasZ,o=s?"3":"2";e.setAttribute("srsDimension",o);const a=i.srsName,l=t.getCoordinates(),u=l.length,h=new Array(u);let f;for(let d=0;d<u;++d)f=l[d],h[d]=this.getCoords_(f,a,s);se(e,h.join(" "))}writePoint(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=J(e.namespaceURI,"pos");e.appendChild(o),this.writePos_(o,t,n)}writeEnvelope(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];xe({node:e},this.ENVELOPE_SERIALIZERS,pr,a,n,o,this)}writeLinearRing(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=J(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,n)}RING_NODE_FACTORY_(e,t,n){const i=t[t.length-1],s=i.node,o=i.exteriorWritten;return o===void 0&&(i.exteriorWritten=!0),J(s.namespaceURI,o!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();xe({node:e,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,n,void 0,this)}else if(e.nodeName==="Surface"){const a=J(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,n)}}writeCurveOrLineString(e,t,n){const s=n[n.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=J(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,n)}else if(e.nodeName==="Curve"){const o=J(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,n)}}writeMultiSurfaceOrPolygon(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.surface;o&&e.setAttribute("srsName",o);const l=t.getPolygons();xe({node:e,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeMultiPoint(e,t,n){const i=n[n.length-1],s=i.srsName,o=i.hasZ;s&&e.setAttribute("srsName",s);const a=t.getPoints();xe({node:e,hasZ:o,srsName:s},this.POINTMEMBER_SERIALIZERS,Xe("pointMember"),a,n,void 0,this)}writeMultiCurveOrLineString(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.curve;o&&e.setAttribute("srsName",o);const l=t.getLineStrings();xe({node:e,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeRing(e,t,n){const i=J(e.namespaceURI,"LinearRing");e.appendChild(i),this.writeLinearRing(i,t,n)}writeSurfaceOrPolygonMember(e,t,n){const i=this.GEOMETRY_NODE_FACTORY_(t,n);i&&(e.appendChild(i),this.writeSurfaceOrPolygon(i,t,n))}writePointMember(e,t,n){const i=J(e.namespaceURI,"Point");e.appendChild(i),this.writePoint(i,t,n)}writeLineStringOrCurveMember(e,t,n){const i=this.GEOMETRY_NODE_FACTORY_(t,n);i&&(e.appendChild(i),this.writeCurveOrLineString(i,t,n))}writeSurfacePatches_(e,t,n){const i=J(e.namespaceURI,"PolygonPatch");e.appendChild(i),this.writeSurfaceOrPolygon(i,t,n)}writeCurveSegments_(e,t,n){const i=J(e.namespaceURI,"LineStringSegment");e.appendChild(i),this.writeCurveOrLineString(i,t,n)}writeGeometryElement(e,t,n){const i=n[n.length-1],s=Object.assign({},i);s.node=e;let o;Array.isArray(t)?o=Zi(t,i):o=Ce(t,!0,i),xe(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],n,void 0,this)}writeFeatureElement(e,t,n){const i=t.getId();i&&e.setAttribute("fid",i);const s=n[n.length-1],o=s.featureNS,a=t.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],u=[];if(t.hasProperties()){const f=t.getProperties();for(const d in f){const g=f[d];g!==null&&(l.push(d),u.push(g),d==a||typeof g.getSimplifiedGeometry=="function"?d in s.serializers[o]||(s.serializers[o][d]=P(this.writeGeometryElement,this)):d in s.serializers[o]||(s.serializers[o][d]=P(se)))}}const h=Object.assign({},s);h.node=e,xe(h,s.serializers,Xe(void 0,o),u,n,l)}writeFeatureMembers_(e,t,n){const i=n[n.length-1],s=i.featureType,o=i.featureNS,a={};a[o]={},a[o][s]=P(this.writeFeatureElement,this);const l=Object.assign({},i);l.node=e,xe(l,a,Xe(s,o),t,n)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,n){const i=t[t.length-1].node;return J(this.namespace,Rh[i.nodeName])}GEOMETRY_NODE_FACTORY_(e,t,n){const i=t[t.length-1],s=i.multiSurface,o=i.surface,a=i.curve,l=i.multiCurve;return Array.isArray(e)?n="Envelope":(n=e.getType(),n==="MultiPolygon"&&s===!0?n="MultiSurface":n==="Polygon"&&o===!0?n="Surface":n==="LineString"&&a===!0?n="Curve":n==="MultiLineString"&&l===!0&&(n="MultiCurve")),J(this.namespace,n)}writeGeometryNode(e,t){t=this.adaptOptions(t);const n=J(this.namespace,"geom"),i={node:n,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return t&&Object.assign(i,t),this.writeGeometryElement(n,e,[i]),n}writeFeaturesNode(e,t){t=this.adaptOptions(t);const n=J(this.namespace,"featureMembers");n.setAttributeNS(Nr,"xsi:schemaLocation",this.schemaLocation);const i={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return t&&Object.assign(i,t),this.writeFeatureMembers_(n,e,[i]),n}}Z.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:Y(Z.prototype.readFlatPos),posList:Y(Z.prototype.readFlatPosList),coordinates:Y(ne.prototype.readFlatCoordinates)}};Z.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:Z.prototype.interiorParser,exterior:Z.prototype.exteriorParser}};Z.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:Y(j.prototype.readPoint),MultiPoint:Y(j.prototype.readMultiPoint),LineString:Y(j.prototype.readLineString),MultiLineString:Y(j.prototype.readMultiLineString),LinearRing:Y(j.prototype.readLinearRing),Polygon:Y(j.prototype.readPolygon),MultiPolygon:Y(j.prototype.readMultiPolygon),Surface:Y(Z.prototype.readSurface),MultiSurface:Y(Z.prototype.readMultiSurface),Curve:Y(Z.prototype.readCurve),MultiCurve:Y(Z.prototype.readMultiCurve),Envelope:Y(Z.prototype.readEnvelope)}};Z.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:H(Z.prototype.curveMemberParser),curveMembers:H(Z.prototype.curveMemberParser)}};Z.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:H(Z.prototype.surfaceMemberParser),surfaceMembers:H(Z.prototype.surfaceMemberParser)}};Z.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:H(j.prototype.readLineString),Curve:H(Z.prototype.readCurve)}};Z.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:H(j.prototype.readPolygon),Surface:H(Z.prototype.readSurface)}};Z.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:Y(Z.prototype.readPatch)}};Z.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:Y(Z.prototype.readSegment)}};Z.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:H(Z.prototype.readFlatPosList),upperCorner:H(Z.prototype.readFlatPosList)}};Z.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:Y(Z.prototype.readPolygonPatch)}};Z.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:wa(Z.prototype.readLineStringSegment)}};j.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:Y(j.prototype.readFlatLinearRing),Ring:Y(Z.prototype.readFlatCurveRing)}};Z.prototype.writeFeatures;Z.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:P(Z.prototype.writeRing),interior:P(Z.prototype.writeRing)}};Z.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:P(se),upperCorner:P(se)}};Z.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:P(Z.prototype.writeSurfaceOrPolygonMember),polygonMember:P(Z.prototype.writeSurfaceOrPolygonMember)}};Z.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:P(Z.prototype.writePointMember)}};Z.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:P(Z.prototype.writeLineStringOrCurveMember),curveMember:P(Z.prototype.writeLineStringOrCurveMember)}};Z.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:P(Z.prototype.writeCurveOrLineString),MultiCurve:P(Z.prototype.writeMultiCurveOrLineString),Point:P(Z.prototype.writePoint),MultiPoint:P(Z.prototype.writeMultiPoint),LineString:P(Z.prototype.writeCurveOrLineString),MultiLineString:P(Z.prototype.writeMultiCurveOrLineString),LinearRing:P(Z.prototype.writeLinearRing),Polygon:P(Z.prototype.writeSurfaceOrPolygon),MultiPolygon:P(Z.prototype.writeMultiSurfaceOrPolygon),Surface:P(Z.prototype.writeSurfaceOrPolygon),MultiSurface:P(Z.prototype.writeMultiSurfaceOrPolygon),Envelope:P(Z.prototype.writeEnvelope)}};const re=Z,ss=re;ss.prototype.writeFeatures;ss.prototype.writeFeaturesNode;const bh=ss,Te=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],Ph="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",Ah={rte:Va,trk:Xa,wpt:Ha},Ih=$(Te,{rte:H(Va),trk:H(Xa),wpt:H(Ha)}),Lh=$(Te,{text:R(D,"linkText"),type:R(D,"linkType")}),Ch=$(Te,{name:R(D),email:sf,link:qr}),Oh=$(Te,{name:R(D),desc:R(D),author:R(tf),copyright:R(rf),link:qr,time:R(Nn),keywords:R(D),bounds:nf,extensions:kn}),Mh=$(Te,{year:R(Re),license:R(D)}),Fh=$(Te,{rte:P(uf),trk:P(cf),wpt:P(ff)});class Nh extends Fn{constructor(e){super(),e=e||{},this.dataProjection=_e("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let t=0,n=e.length;t<n;++t){const i=e[t];if(this.readExtensions_){const s=i.get("extensionsNode_")||null;this.readExtensions_(i,s)}i.set("extensionsNode_",void 0)}}readMetadata(e){return e?typeof e=="string"?this.readMetadataFromDocument(gn(e)):mn(e)?this.readMetadataFromDocument(e):this.readMetadataFromNode(e):null}readMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType===Node.ELEMENT_NODE){const n=this.readMetadataFromNode(t);if(n)return n}return null}readMetadataFromNode(e){if(!Te.includes(e.namespaceURI))return null;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(Te.includes(t.namespaceURI)&&t.localName==="metadata")return G({},Oh,t,[]);return null}readFeatureFromNode(e,t){if(!Te.includes(e.namespaceURI))return null;const n=Ah[e.localName];if(!n)return null;const i=n(e,[this.getReadOptions(e,t)]);return i?(this.handleReadExtensions_([i]),i):null}readFeaturesFromNode(e,t){if(!Te.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const n=G([],Ih,e,[this.getReadOptions(e,t)]);return n?(this.handleReadExtensions_(n),n):[]}return[]}writeFeaturesNode(e,t){t=this.adaptOptions(t);const n=J("http://www.topografix.com/GPX/1/1","gpx");return n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",Nr),n.setAttributeNS(Nr,"xsi:schemaLocation",Ph),n.setAttribute("version","1.1"),n.setAttribute("creator","OpenLayers"),xe({node:n},Fh,ef,e,[t]),n}}const Dh=$(Te,{name:R(D),cmt:R(D),desc:R(D),src:R(D),link:qr,number:R(Re),extensions:kn,type:R(D),rtept:of}),Gh=$(Te,{ele:R(Ne),time:R(Nn)}),Uh=$(Te,{name:R(D),cmt:R(D),desc:R(D),src:R(D),link:qr,number:R(Re),type:R(D),extensions:kn,trkseg:lf}),Bh=$(Te,{trkpt:af}),zh=$(Te,{ele:R(Ne),time:R(Nn)}),kh=$(Te,{ele:R(Ne),time:R(Nn),magvar:R(Ne),geoidheight:R(Ne),name:R(D),cmt:R(D),desc:R(D),src:R(D),link:qr,sym:R(D),type:R(D),fix:R(D),sat:R(Re),hdop:R(Ne),vdop:R(Ne),pdop:R(Ne),ageofdgpsdata:R(Ne),dgpsid:R(Re),extensions:kn}),$h=["text","type"],jh=$(Te,{text:P(se),type:P(se)}),Zh=$(Te,["name","cmt","desc","src","link","number","type","rtept"]),Vh=$(Te,{name:P(se),cmt:P(se),desc:P(se),src:P(se),link:P(ls),number:P(_n),type:P(se),rtept:Ta(P(us))}),Xh=$(Te,["ele","time"]),Hh=$(Te,["name","cmt","desc","src","link","number","type","trkseg"]),Wh=$(Te,{name:P(se),cmt:P(se),desc:P(se),src:P(se),link:P(ls),number:P(_n),type:P(se),trkseg:Ta(P(hf))}),Yh=Xe("trkpt"),qh=$(Te,{trkpt:P(us)}),Kh=$(Te,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),Qh=$(Te,{ele:P(Dt),time:P(Xu),magvar:P(Dt),geoidheight:P(Dt),name:P(se),cmt:P(se),desc:P(se),src:P(se),link:P(ls),sym:P(se),type:P(se),fix:P(se),sat:P(_n),hdop:P(Dt),vdop:P(Dt),pdop:P(Dt),ageofdgpsdata:P(Dt),dgpsid:P(_n)}),Jh={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function ef(r,e,t){const n=r.getGeometry();if(n){const i=Jh[n.getType()];if(i){const s=e[e.length-1].node;return J(s.namespaceURI,i)}}}function os(r,e,t,n){return r.push(parseFloat(t.getAttribute("lon")),parseFloat(t.getAttribute("lat"))),"ele"in n?(r.push(n.ele),delete n.ele,e.hasZ=!0):r.push(0),"time"in n?(r.push(n.time),delete n.time,e.hasM=!0):r.push(0),r}function as(r,e,t){let n="XY",i=2;if(r.hasZ&&r.hasM?(n="XYZM",i=4):r.hasZ?(n="XYZ",i=3):r.hasM&&(n="XYM",i=3),i!==4){for(let s=0,o=e.length/4;s<o;s++)e[s*i]=e[s*4],e[s*i+1]=e[s*4+1],r.hasZ&&(e[s*i+2]=e[s*4+2]),r.hasM&&(e[s*i+2]=e[s*4+3]);if(e.length=e.length/4*i,t)for(let s=0,o=t.length;s<o;s++)t[s]=t[s]/4*i}return n}function tf(r,e){const t=G({},Ch,r,e);if(t)return t}function rf(r,e){const t=G({},Mh,r,e);if(t){const n=r.getAttribute("author");return n!==null&&(t.author=n),t}}function nf(r,e){const t=e[e.length-1],n=r.getAttribute("minlat"),i=r.getAttribute("minlon"),s=r.getAttribute("maxlat"),o=r.getAttribute("maxlon");i!==null&&n!==null&&o!==null&&s!==null&&(t.bounds=[[parseFloat(i),parseFloat(n)],[parseFloat(o),parseFloat(s)]])}function sf(r,e){const t=e[e.length-1],n=r.getAttribute("id"),i=r.getAttribute("domain");n!==null&&i!==null&&(t.email=`${n}@${i}`)}function qr(r,e){const t=e[e.length-1],n=r.getAttribute("href");n!==null&&(t.link=n),At(Lh,r,e)}function kn(r,e){const t=e[e.length-1];t.extensionsNode_=r}function of(r,e){const t=G({},Gh,r,e);if(t){const n=e[e.length-1],i=n.flatCoordinates,s=n.layoutOptions;os(i,s,r,t)}}function af(r,e){const t=G({},zh,r,e);if(t){const n=e[e.length-1],i=n.flatCoordinates,s=n.layoutOptions;os(i,s,r,t)}}function lf(r,e){const t=e[e.length-1];At(Bh,r,e);const n=t.flatCoordinates;t.ends.push(n.length)}function Va(r,e){const t=e[0],n=G({flatCoordinates:[],layoutOptions:{}},Dh,r,e);if(!n)return;const i=n.flatCoordinates;delete n.flatCoordinates;const s=n.layoutOptions;delete n.layoutOptions;const o=as(s,i),a=new dt(i,o);Ce(a,!1,t);const l=new Ye(a);return l.setProperties(n,!0),l}function Xa(r,e){const t=e[0],n=G({flatCoordinates:[],ends:[],layoutOptions:{}},Uh,r,e);if(!n)return;const i=n.flatCoordinates;delete n.flatCoordinates;const s=n.ends;delete n.ends;const o=n.layoutOptions;delete n.layoutOptions;const a=as(o,i,s),l=new dr(i,a,s);Ce(l,!1,t);const u=new Ye(l);return u.setProperties(n,!0),u}function Ha(r,e){const t=e[0],n=G({},kh,r,e);if(!n)return;const i={},s=os([],i,r,n),o=as(i,s),a=new rt(s,o);Ce(a,!1,t);const l=new Ye(a);return l.setProperties(n,!0),l}function ls(r,e,t){r.setAttribute("href",e);const i=t[t.length-1].properties,s=[i.linkText,i.linkType];xe({node:r},jh,pr,s,t,$h)}function us(r,e,t){const n=t[t.length-1],s=n.node.namespaceURI,o=n.properties;switch(r.setAttributeNS(null,"lat",String(e[1])),r.setAttributeNS(null,"lon",String(e[0])),n.geometryLayout){case"XYZM":e[3]!==0&&(o.time=e[3]);case"XYZ":e[2]!==0&&(o.ele=e[2]);break;case"XYM":e[2]!==0&&(o.time=e[2]);break}const l=r.nodeName=="rtept"?Xh[s]:Kh[s],u=Vi(o,l);xe({node:r,properties:o},Qh,pr,u,t,l)}function uf(r,e,t){const n=t[0],i=e.getProperties(),s={node:r};s.properties=i;const o=e.getGeometry();if(o.getType()=="LineString"){const h=Ce(o,!0,n);s.geometryLayout=h.getLayout(),i.rtept=h.getCoordinates()}const a=t[t.length-1].node,l=Zh[a.namespaceURI],u=Vi(i,l);xe(s,Vh,pr,u,t,l)}function cf(r,e,t){const n=t[0],i=e.getProperties(),s={node:r};s.properties=i;const o=e.getGeometry();if(o.getType()=="MultiLineString"){const h=Ce(o,!0,n);i.trkseg=h.getLineStrings()}const a=t[t.length-1].node,l=Hh[a.namespaceURI],u=Vi(i,l);xe(s,Wh,pr,u,t,l)}function hf(r,e,t){const n={node:r};n.geometryLayout=e.getLayout(),n.properties={},xe(n,qh,Yh,e.getCoordinates(),t)}function ff(r,e,t){const n=t[0],i=t[t.length-1];i.properties=e.getProperties();const s=e.getGeometry();if(s.getType()=="Point"){const o=Ce(s,!0,n);i.geometryLayout=o.getLayout(),us(r,o.getCoordinates(),t)}}const df=Nh;class cs extends va{constructor(){super()}getType(){return"text"}readFeature(e,t){return this.readFeatureFromText(tn(e),this.adaptOptions(t))}readFeatureFromText(e,t){return yt()}readFeatures(e,t){return this.readFeaturesFromText(tn(e),this.adaptOptions(t))}readFeaturesFromText(e,t){return yt()}readGeometry(e,t){return this.readGeometryFromText(tn(e),this.adaptOptions(t))}readGeometryFromText(e,t){return yt()}readProjection(e){return this.readProjectionFromText(tn(e))}readProjectionFromText(e){return this.dataProjection}writeFeature(e,t){return this.writeFeatureText(e,this.adaptOptions(t))}writeFeatureText(e,t){return yt()}writeFeatures(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))}writeFeaturesText(e,t){return yt()}writeGeometry(e,t){return this.writeGeometryText(e,this.adaptOptions(t))}writeGeometryText(e,t){return yt()}}function tn(r){return typeof r=="string"?r:""}const pf=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,gf=/^H.([A-Z]{3}).*?:(.*)/,mf=/^HFDTE(\d{2})(\d{2})(\d{2})/,_f=/\r\n|\r|\n/;class yf extends cs{constructor(e){super(),e=e||{},this.dataProjection=_e("EPSG:4326"),this.altitudeMode_=e.altitudeMode?e.altitudeMode:"none"}readFeatureFromText(e,t){const n=this.altitudeMode_,i=e.split(_f),s={},o=[];let a=2e3,l=0,u=1,h=-1,f,d;for(f=0,d=i.length;f<d;++f){const x=i[f];let w;if(x.charAt(0)=="B"){if(w=pf.exec(x),w){const E=parseInt(w[1],10),v=parseInt(w[2],10),S=parseInt(w[3],10);let A=parseInt(w[4],10)+parseInt(w[5],10)/6e4;w[6]=="S"&&(A=-A);let O=parseInt(w[7],10)+parseInt(w[8],10)/6e4;if(w[9]=="W"&&(O=-O),o.push(O,A),n!="none"){let F;n=="gps"?F=parseInt(w[11],10):n=="barometric"?F=parseInt(w[12],10):F=0,o.push(F)}let L=Date.UTC(a,l,u,E,v,S);L<h&&(L=Date.UTC(a,l,u+1,E,v,S)),o.push(L/1e3),h=L}}else x.charAt(0)=="H"&&(w=mf.exec(x),w?(u=parseInt(w[1],10),l=parseInt(w[2],10)-1,a=2e3+parseInt(w[3],10)):(w=gf.exec(x),w&&(s[w[1]]=w[2].trim())))}if(o.length===0)return null;const g=n=="none"?"XYM":"XYZM",m=new dt(o,g),y=new Ye(Ce(m,!1,t));return y.setProperties(s,!0),y}readFeaturesFromText(e,t){const n=this.readFeatureFromText(e,t);return n?[n]:[]}}const xf=yf,Ae={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"},jt={};jt[Ae.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}};jt[Ae.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}};jt[Ae.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}};jt.none={none:{supports:[],formats:[],qualities:[]}};const Ef=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,yo=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,wf=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function Tf(r){let e=r.getComplianceLevelSupportedFeatures();return e===void 0&&(e=jt[Ae.VERSION1].level0),{url:r.imageInfo["@id"]===void 0?void 0:r.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:e.supports,formats:[...e.formats,r.imageInfo.formats===void 0?[]:r.imageInfo.formats],qualities:[...e.qualities,r.imageInfo.qualities===void 0?[]:r.imageInfo.qualities],resolutions:r.imageInfo.scale_factors,tileSize:r.imageInfo.tile_width!==void 0?r.imageInfo.tile_height!==void 0?[r.imageInfo.tile_width,r.imageInfo.tile_height]:[r.imageInfo.tile_width,r.imageInfo.tile_width]:r.imageInfo.tile_height!=null?[r.imageInfo.tile_height,r.imageInfo.tile_height]:void 0}}function vf(r){const e=r.getComplianceLevelSupportedFeatures(),t=Array.isArray(r.imageInfo.profile)&&r.imageInfo.profile.length>1,n=t&&r.imageInfo.profile[1].supports?r.imageInfo.profile[1].supports:[],i=t&&r.imageInfo.profile[1].formats?r.imageInfo.profile[1].formats:[],s=t&&r.imageInfo.profile[1].qualities?r.imageInfo.profile[1].qualities:[];return{url:r.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:r.imageInfo.sizes===void 0?void 0:r.imageInfo.sizes.map(function(o){return[o.width,o.height]}),tileSize:r.imageInfo.tiles===void 0?void 0:[r.imageInfo.tiles.map(function(o){return o.width})[0],r.imageInfo.tiles.map(function(o){return o.height===void 0?o.width:o.height})[0]],resolutions:r.imageInfo.tiles===void 0?void 0:r.imageInfo.tiles.map(function(o){return o.scaleFactors})[0],supports:[...e.supports,...n],formats:[...e.formats,...i],qualities:[...e.qualities,...s]}}function Sf(r){const e=r.getComplianceLevelSupportedFeatures(),t=r.imageInfo.extraFormats===void 0?e.formats:[...e.formats,...r.imageInfo.extraFormats],n=r.imageInfo.preferredFormats!==void 0&&Array.isArray(r.imageInfo.preferredFormats)&&r.imageInfo.preferredFormats.length>0?r.imageInfo.preferredFormats.filter(function(i){return["jpg","png","gif"].includes(i)}).reduce(function(i,s){return i===void 0&&t.includes(s)?s:i},void 0):void 0;return{url:r.imageInfo.id,sizes:r.imageInfo.sizes===void 0?void 0:r.imageInfo.sizes.map(function(i){return[i.width,i.height]}),tileSize:r.imageInfo.tiles===void 0?void 0:[r.imageInfo.tiles.map(function(i){return i.width})[0],r.imageInfo.tiles.map(function(i){return i.height})[0]],resolutions:r.imageInfo.tiles===void 0?void 0:r.imageInfo.tiles.map(function(i){return i.scaleFactors})[0],supports:r.imageInfo.extraFeatures===void 0?e.supports:[...e.supports,...r.imageInfo.extraFeatures],formats:t,qualities:r.imageInfo.extraQualities===void 0?e.qualities:[...e.qualities,...r.imageInfo.extraQualities],preferredFormat:n}}const $n={};$n[Ae.VERSION1]=Tf;$n[Ae.VERSION2]=vf;$n[Ae.VERSION3]=Sf;class Rf{constructor(e){this.setImageInfo(e)}setImageInfo(e){typeof e=="string"?this.imageInfo=JSON.parse(e):this.imageInfo=e}getImageApiVersion(){if(this.imageInfo===void 0)return;let e=this.imageInfo["@context"]||"ol-no-context";typeof e=="string"&&(e=[e]);for(let t=0;t<e.length;t++)switch(e[t]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return Ae.VERSION1;case"http://iiif.io/api/image/2/context.json":return Ae.VERSION2;case"http://iiif.io/api/image/3/context.json":return Ae.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(Ae.VERSION1)&&this.imageInfo.identifier)return Ae.VERSION1;break}pt(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(e){if(!(this.imageInfo===void 0||this.imageInfo.profile===void 0))switch(e===void 0&&(e=this.getImageApiVersion()),e){case Ae.VERSION1:if(Ef.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Ae.VERSION3:if(wf.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Ae.VERSION2:if(typeof this.imageInfo.profile=="string"&&yo.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&typeof this.imageInfo.profile[0]=="string"&&yo.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0];break}}getComplianceLevelFromProfile(e){const t=this.getComplianceLevelEntryFromProfile(e);if(t===void 0)return;const n=t.match(/level[0-2](?:\.json)?$/g);return Array.isArray(n)?n[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(this.imageInfo===void 0)return;const e=this.getImageApiVersion(),t=this.getComplianceLevelFromProfile(e);return t===void 0?jt.none.none:jt[e][t]}getTileSourceOptions(e){const t=e||{},n=this.getImageApiVersion();if(n===void 0)return;const i=n===void 0?void 0:$n[n](this);if(i!==void 0)return{url:i.url,version:n,size:[this.imageInfo.width,this.imageInfo.height],sizes:i.sizes,format:t.format!==void 0&&i.formats.includes(t.format)?t.format:i.preferredFormat!==void 0?i.preferredFormat:"jpg",supports:i.supports,quality:t.quality&&i.qualities.includes(t.quality)?t.quality:i.qualities.includes("native")?"native":"default",resolutions:Array.isArray(i.resolutions)?i.resolutions.sort(function(s,o){return o-s}):void 0,tileSize:i.tileSize}}}const bf=Rf;class hs{read(e){if(!e)return null;if(typeof e=="string"){const t=gn(e);return this.readFromDocument(t)}return mn(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){yt()}}const Pf="http://www.w3.org/1999/xlink";function _r(r){return r.getAttributeNS(Pf,"href")}const je=[null,"http://www.opengis.net/ows/1.1"],Af=$(je,{ServiceIdentification:R(Jf),ServiceProvider:R(td),OperationsMetadata:R(Kf)});class If extends hs{constructor(){super()}readFromNode(e){const t=G({},Af,e,[]);return t||null}}const Lf=$(je,{DeliveryPoint:R(D),City:R(D),AdministrativeArea:R(D),PostalCode:R(D),Country:R(D),ElectronicMailAddress:R(D)}),Cf=$(je,{Value:Ee(rd)}),Of=$(je,{AllowedValues:R(Zf)}),Mf=$(je,{Phone:R(Qf),Address:R(jf)}),Ff=$(je,{HTTP:R(Yf)}),Nf=$(je,{Get:Ee(Wf),Post:void 0}),Df=$(je,{DCP:R(Hf)}),Gf=$(je,{Operation:qf}),Uf=$(je,{Voice:R(D),Facsimile:R(D)}),Bf=$(je,{Constraint:Ee(Vf)}),zf=$(je,{IndividualName:R(D),PositionName:R(D),ContactInfo:R(Xf)}),kf=$(je,{Abstract:R(D),AccessConstraints:R(D),Fees:R(D),Title:R(D),ServiceTypeVersion:R(D),ServiceType:R(D)}),$f=$(je,{ProviderName:R(D),ProviderSite:R(_r),ServiceContact:R(ed)});function jf(r,e){return G({},Lf,r,e)}function Zf(r,e){return G({},Cf,r,e)}function Vf(r,e){const t=r.getAttribute("name");if(t)return G({name:t},Of,r,e)}function Xf(r,e){return G({},Mf,r,e)}function Hf(r,e){return G({},Ff,r,e)}function Wf(r,e){const t=_r(r);if(t)return G({href:t},Bf,r,e)}function Yf(r,e){return G({},Nf,r,e)}function qf(r,e){const t=r.getAttribute("name"),n=G({},Df,r,e);if(!n)return;const i=e[e.length-1];i[t]=n}function Kf(r,e){return G({},Gf,r,e)}function Qf(r,e){return G({},Uf,r,e)}function Jf(r,e){return G({},kf,r,e)}function ed(r,e){return G({},zf,r,e)}function td(r,e){return G({},$f,r,e)}function rd(r,e){return D(r)}const Wa=If;function xo(r,e,t,n,i,s){i!==void 0?(i=i,s=s!==void 0?s:0):(i=[],s=0);let o=e;for(;o<t;){const a=r[o++];i[s++]=r[o++],i[s++]=a;for(let l=2;l<n;++l)i[s++]=r[o++]}return i.length=s,i}class nd extends cs{constructor(e){super(),e=e||{},this.dataProjection=_e("EPSG:4326"),this.factor_=e.factor?e.factor:1e5,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY"}readFeatureFromText(e,t){const n=this.readGeometryFromText(e,t);return new Ye(n)}readFeaturesFromText(e,t){return[this.readFeatureFromText(e,t)]}readGeometryFromText(e,t){const n=Hu(this.geometryLayout_),i=sd(e,n,this.factor_);xo(i,0,i.length,n,i);const s=Wu(i,0,i.length,n),o=new dt(s,this.geometryLayout_);return Ce(o,!1,this.adaptOptions(t))}writeFeatureText(e,t){const n=e.getGeometry();if(n)return this.writeGeometryText(n,t);throw new Error("Expected `feature` to have a geometry")}writeFeaturesText(e,t){return this.writeFeatureText(e[0],t)}writeGeometryText(e,t){e=Ce(e,!0,this.adaptOptions(t));const n=e.getFlatCoordinates(),i=e.getStride();return xo(n,0,n.length,i,n),id(n,i,this.factor_)}}function id(r,e,t){t=t||1e5;let n;const i=new Array(e);for(n=0;n<e;++n)i[n]=0;for(let s=0,o=r.length;s<o;)for(n=0;n<e;++n,++s){const a=r[s],l=a-i[n];i[n]=a,r[s]=l}return od(r,t)}function sd(r,e,t){t=t||1e5;let n;const i=new Array(e);for(n=0;n<e;++n)i[n]=0;const s=ad(r,t);for(let o=0,a=s.length;o<a;)for(n=0;n<e;++n,++o)i[n]+=s[o],s[o]=i[n];return s}function od(r,e){e=e||1e5;for(let t=0,n=r.length;t<n;++t)r[t]=Math.round(r[t]*e);return ld(r)}function ad(r,e){e=e||1e5;const t=ud(r);for(let n=0,i=t.length;n<i;++n)t[n]/=e;return t}function ld(r){for(let e=0,t=r.length;e<t;++e){const n=r[e];r[e]=n<0?~(n<<1):n<<1}return cd(r)}function ud(r){const e=hd(r);for(let t=0,n=e.length;t<n;++t){const i=e[t];e[t]=i&1?~(i>>1):i>>1}return e}function cd(r){let e="";for(let t=0,n=r.length;t<n;++t)e+=fd(r[t]);return e}function hd(r){const e=[];let t=0,n=0;for(let i=0,s=r.length;i<s;++i){const o=r.charCodeAt(i)-63;t|=(o&31)<<n,o<32?(e.push(t),t=0,n=0):n+=5}return e}function fd(r){let e,t="";for(;r>=32;)e=(32|r&31)+63,t+=String.fromCharCode(e),r>>=5;return e=r+63,t+=String.fromCharCode(e),t}const dd=nd;class de extends re{constructor(e){e=e||{},super(e),this.schemaLocation=e.schemaLocation?e.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(e,t,n){const i=n[n.length-1];n[n.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},i),super.writeGeometryElement(e,t,n)}}de.prototype.namespace="http://www.opengis.net/gml/3.2";de.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:Y(re.prototype.readFlatPos),posList:Y(re.prototype.readFlatPosList),coordinates:Y(ne.prototype.readFlatCoordinates)}};de.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:re.prototype.interiorParser,exterior:re.prototype.exteriorParser}};de.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:Y(j.prototype.readPoint),MultiPoint:Y(j.prototype.readMultiPoint),LineString:Y(j.prototype.readLineString),MultiLineString:Y(j.prototype.readMultiLineString),LinearRing:Y(j.prototype.readLinearRing),Polygon:Y(j.prototype.readPolygon),MultiPolygon:Y(j.prototype.readMultiPolygon),Surface:Y(de.prototype.readSurface),MultiSurface:Y(re.prototype.readMultiSurface),Curve:Y(de.prototype.readCurve),MultiCurve:Y(re.prototype.readMultiCurve),Envelope:Y(de.prototype.readEnvelope)}};de.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:H(re.prototype.curveMemberParser),curveMembers:H(re.prototype.curveMemberParser)}};de.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:H(re.prototype.surfaceMemberParser),surfaceMembers:H(re.prototype.surfaceMemberParser)}};de.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:H(j.prototype.readLineString),Curve:H(re.prototype.readCurve)}};de.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:H(j.prototype.readPolygon),Surface:H(re.prototype.readSurface)}};de.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:Y(re.prototype.readPatch)}};de.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:Y(re.prototype.readSegment)}};de.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:H(re.prototype.readFlatPosList),upperCorner:H(re.prototype.readFlatPosList)}};de.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:Y(re.prototype.readPolygonPatch)}};de.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:wa(re.prototype.readLineStringSegment)}};de.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:H(j.prototype.pointMemberParser),pointMembers:H(j.prototype.pointMemberParser)}};de.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:H(j.prototype.lineStringMemberParser),lineStringMembers:H(j.prototype.lineStringMemberParser)}};de.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:H(j.prototype.polygonMemberParser),polygonMembers:H(j.prototype.polygonMemberParser)}};de.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:H(j.prototype.readFlatCoordinatesFromNode)}};de.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:H(j.prototype.readLineString)}};de.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:H(j.prototype.readPolygon)}};de.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:Y(j.prototype.readFlatLinearRing),Ring:Y(de.prototype.readFlatCurveRing)}};de.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:P(re.prototype.writeRing),interior:P(re.prototype.writeRing)}};de.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:P(se),upperCorner:P(se)}};de.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:P(re.prototype.writeSurfaceOrPolygonMember),polygonMember:P(re.prototype.writeSurfaceOrPolygonMember)}};de.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:P(re.prototype.writePointMember)}};de.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:P(re.prototype.writeLineStringOrCurveMember),curveMember:P(re.prototype.writeLineStringOrCurveMember)}};de.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:P(re.prototype.writeCurveOrLineString),MultiCurve:P(re.prototype.writeMultiCurveOrLineString),Point:P(de.prototype.writePoint),MultiPoint:P(re.prototype.writeMultiPoint),LineString:P(re.prototype.writeCurveOrLineString),MultiLineString:P(re.prototype.writeMultiCurveOrLineString),LinearRing:P(re.prototype.writeLinearRing),Polygon:P(re.prototype.writeSurfaceOrPolygon),MultiPolygon:P(re.prototype.writeMultiSurfaceOrPolygon),Surface:P(re.prototype.writeSurfaceOrPolygon),MultiSurface:P(re.prototype.writeMultiSurfaceOrPolygon),Envelope:P(re.prototype.writeEnvelope)}};const fs=de;class Ya{constructor(e){this.tagName_=e}getTagName(){return this.tagName_}}class pd extends Ya{constructor(e,t){super(e),this.conditions=t,pt(this.conditions.length>=2,"At least 2 conditions are required")}}class gd extends pd{constructor(e){super("And",Array.prototype.slice.call(arguments))}}const md=gd;class _d extends Ya{constructor(e,t,n){if(super("BBOX"),this.geometryName=e,this.extent=t,t.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=n}}function yd(r){const e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(md,e))}function xd(r,e,t){return new _d(r,e,t)}const Eo={"http://www.opengis.net/gml":{boundedBy:R(j.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:H(j.prototype.readFeaturesInternal)}},Ed={"http://www.opengis.net/wfs":{totalInserted:R(Re),totalUpdated:R(Re),totalDeleted:R(Re)},"http://www.opengis.net/wfs/2.0":{totalInserted:R(Re),totalUpdated:R(Re),totalDeleted:R(Re)}},wd={"http://www.opengis.net/wfs":{TransactionSummary:R(To,"transactionSummary"),InsertResults:R(So,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:R(To,"transactionSummary"),InsertResults:R(So,"insertIds")}},Td={"http://www.opengis.net/wfs":{PropertyName:P(se)},"http://www.opengis.net/wfs/2.0":{PropertyName:P(se)}},qa={"http://www.opengis.net/wfs":{Insert:P(Ro),Update:P(Po),Delete:P(bo),Property:P(Ao),Native:P(Io)},"http://www.opengis.net/wfs/2.0":{Insert:P(Ro),Update:P(Po),Delete:P(bo),Property:P(Ao),Native:P(Io)}},Ka="feature",ds="http://www.w3.org/2000/xmlns/",ps={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},Ai={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},gs={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},wo={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},ms={"2.0.0":fs,"1.1.0":re,"1.0.0":ne},vd="1.1.0";class Sd extends Fn{constructor(e){super(),e=e||{},this.version_=e.version?e.version:vd,this.featureType_=e.featureType,this.featureNS_=e.featureNS,this.gmlFormat_=e.gmlFormat?e.gmlFormat:new ms[this.version_],this.schemaLocation_=e.schemaLocation?e.schemaLocation:wo[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(e){this.featureType_=e}readFeaturesFromNode(e,t){const n={node:e};Object.assign(n,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(n,this.getReadOptions(e,t||{}));const i=[n];let s;this.version_==="2.0.0"?s=Eo:s=this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let o=G([],s,e,i,this.gmlFormat_);return o||(o=[]),o}readTransactionResponse(e){if(e){if(typeof e=="string"){const t=gn(e);return this.readTransactionResponseFromDocument(t)}return mn(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}}readFeatureCollectionMetadata(e){if(e){if(typeof e=="string"){const t=gn(e);return this.readFeatureCollectionMetadataFromDocument(t)}return mn(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}}readFeatureCollectionMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)}readFeatureCollectionMetadataFromNode(e){const t={},n=Pt(e.getAttribute("numberOfFeatures"));return t.numberOfFeatures=n,G(t,Eo,e,[],this.gmlFormat_)}readTransactionResponseFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)}readTransactionResponseFromNode(e){return G({},wd,e,[])}writeGetFeature(e){const t=J(Ai[this.version_],"GetFeature");t.setAttribute("service","WFS"),t.setAttribute("version",this.version_),e.handle&&t.setAttribute("handle",e.handle),e.outputFormat&&t.setAttribute("outputFormat",e.outputFormat),e.maxFeatures!==void 0&&t.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&t.setAttribute("resultType",e.resultType),e.startIndex!==void 0&&t.setAttribute("startIndex",String(e.startIndex)),e.count!==void 0&&t.setAttribute("count",String(e.count)),e.viewParams!==void 0&&t.setAttribute("viewParams",e.viewParams),t.setAttributeNS(Nr,"xsi:schemaLocation",this.schemaLocation_);const n={node:t};if(Object.assign(n,{version:this.version_,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,propertyNames:e.propertyNames?e.propertyNames:[]}),pt(Array.isArray(e.featureTypes),"`options.featureTypes` must be an Array"),typeof e.featureTypes[0]=="string"){let i=e.filter;e.bbox&&(pt(e.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),i=this.combineBboxAndFilter(e.geometryName,e.bbox,e.srsName,i)),Object.assign(n,{geometryName:e.geometryName,filter:i}),Bo(t,e.featureTypes,[n])}else e.featureTypes.forEach(i=>{const s=this.combineBboxAndFilter(i.geometryName,i.bbox,e.srsName,e.filter);Object.assign(n,{geometryName:i.geometryName,filter:s}),Bo(t,[i.name],[n])});return t}combineBboxAndFilter(e,t,n,i){const s=xd(e,t,n);return i?yd(i,s):s}writeTransaction(e,t,n,i){const s=[],o=i.version?i.version:this.version_,a=J(Ai[o],"Transaction");a.setAttribute("service","WFS"),a.setAttribute("version",o);let l;i&&(l=i.gmlOptions?i.gmlOptions:{},i.handle&&a.setAttribute("handle",i.handle)),a.setAttributeNS(Nr,"xsi:schemaLocation",wo[o]);const u=Rd(a,l,o,i);return e&&rn("Insert",e,s,u),t&&rn("Update",t,s,u),n&&rn("Delete",n,s,u),i.nativeElements&&rn("Native",i.nativeElements,s,u),a}readProjectionFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null}readProjectionFromNode(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild){e=e.firstElementChild.firstElementChild;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(!(t.childNodes.length===0||t.childNodes.length===1&&t.firstChild.nodeType===3)){const n=[{}];return this.gmlFormat_.readGeometryElement(t,n),_e(n.pop().srsName)}}return null}}function Rd(r,e,t,n){const i=n.featurePrefix?n.featurePrefix:Ka;let s;return t==="1.0.0"?s=2:t==="1.1.0"?s=3:t==="2.0.0"&&(s=3.2),Object.assign({node:r},{version:t,featureNS:n.featureNS,featureType:n.featureType,featurePrefix:i,gmlVersion:s,hasZ:n.hasZ,srsName:n.srsName},e)}function rn(r,e,t,n){xe(n,qa,Xe(r),e,t)}function To(r,e){return G({},Ed,r,e)}const bd={"http://www.opengis.net/ogc":{FeatureId:H(function(r,e){return r.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:H(function(r,e){return r.getAttribute("fid")})}};function vo(r,e){At(bd,r,e)}const Pd={"http://www.opengis.net/wfs":{Feature:vo},"http://www.opengis.net/wfs/2.0":{Feature:vo}};function So(r,e){return G([],Pd,r,e)}function Ro(r,e,t){const n=t[t.length-1],i=n.featureType,s=n.featureNS,o=n.gmlVersion,a=J(s,i);r.appendChild(a),o===2?ne.prototype.writeFeatureElement(a,e,t):o===3?re.prototype.writeFeatureElement(a,e,t):fs.prototype.writeFeatureElement(a,e,t)}function Qa(r,e,t){const i=t[t.length-1].version,s=ps[i],o=J(s,"Filter"),a=J(s,"FeatureId");o.appendChild(a),a.setAttribute("fid",e),r.appendChild(o)}function _s(r,e){r=r||Ka;const t=r+":";return e.startsWith(t)?e:t+e}function bo(r,e,t){const n=t[t.length-1];pt(e.getId()!==void 0,"Features must have an id set");const i=n.featureType,s=n.featurePrefix,o=n.featureNS,a=_s(s,i);r.setAttribute("typeName",a),r.setAttributeNS(ds,"xmlns:"+s,o);const l=e.getId();l!==void 0&&Qa(r,l,t)}function Po(r,e,t){const n=t[t.length-1];pt(e.getId()!==void 0,"Features must have an id set");const i=n.version,s=n.featureType,o=n.featurePrefix,a=n.featureNS,l=_s(o,s),u=e.getGeometryName();r.setAttribute("typeName",l),r.setAttributeNS(ds,"xmlns:"+o,a);const h=e.getId();if(h!==void 0){const f=e.getKeys(),d=[];for(let g=0,m=f.length;g<m;g++){const y=e.get(f[g]);if(y!==void 0){let x=f[g];y&&typeof y.getSimplifiedGeometry=="function"&&(x=u),d.push({name:x,value:y})}}xe({version:i,gmlVersion:n.gmlVersion,node:r,hasZ:n.hasZ,srsName:n.srsName},qa,Xe("Property"),d,t),Qa(r,h,t)}}function Ao(r,e,t){const n=t[t.length-1],i=n.version,s=Ai[i],a=J(s,i==="2.0.0"?"ValueReference":"Name"),l=n.gmlVersion;if(r.appendChild(a),se(a,e.name),e.value!==void 0&&e.value!==null){const u=J(s,"Value");r.appendChild(u),e.value&&typeof e.value.getSimplifiedGeometry=="function"?l===2?ne.prototype.writeGeometryElement(u,e.value,t):l===3?re.prototype.writeGeometryElement(u,e.value,t):fs.prototype.writeGeometryElement(u,e.value,t):se(u,e.value)}}function Io(r,e,t){e.vendorId&&r.setAttribute("vendorId",e.vendorId),e.safeToIgnore!==void 0&&r.setAttribute("safeToIgnore",String(e.safeToIgnore)),e.value!==void 0&&se(r,e.value)}const jn={"http://www.opengis.net/wfs":{Query:P(Lo)},"http://www.opengis.net/wfs/2.0":{Query:P(Lo)},"http://www.opengis.net/ogc":{During:P(Mo),And:P(nn),Or:P(nn),Not:P(Fo),BBOX:P(Co),Contains:P(Rt),Intersects:P(Rt),Within:P(Rt),DWithin:P(Oo),PropertyIsEqualTo:P(qe),PropertyIsNotEqualTo:P(qe),PropertyIsLessThan:P(qe),PropertyIsLessThanOrEqualTo:P(qe),PropertyIsGreaterThan:P(qe),PropertyIsGreaterThanOrEqualTo:P(qe),PropertyIsNull:P(No),PropertyIsBetween:P(Do),PropertyIsLike:P(Go)},"http://www.opengis.net/fes/2.0":{During:P(Mo),And:P(nn),Or:P(nn),Not:P(Fo),BBOX:P(Co),Contains:P(Rt),Disjoint:P(Rt),Intersects:P(Rt),ResourceId:P(Id),Within:P(Rt),DWithin:P(Oo),PropertyIsEqualTo:P(qe),PropertyIsNotEqualTo:P(qe),PropertyIsLessThan:P(qe),PropertyIsLessThanOrEqualTo:P(qe),PropertyIsGreaterThan:P(qe),PropertyIsGreaterThanOrEqualTo:P(qe),PropertyIsNull:P(No),PropertyIsBetween:P(Do),PropertyIsLike:P(Go)}};function Lo(r,e,t){const n=t[t.length-1],i=n.version,s=n.featurePrefix,o=n.featureNS,a=n.propertyNames,l=n.srsName;let u;s?u=_s(s,e):u=e;let h;i==="2.0.0"?h="typeNames":h="typeName",r.setAttribute(h,u),l&&r.setAttribute("srsName",l),o&&r.setAttributeNS(ds,"xmlns:"+s,o);const f=Object.assign({},n);f.node=r,xe(f,Td,Xe("PropertyName"),a,t);const d=n.filter;if(d){const g=J(Zn(i),"Filter");r.appendChild(g),Ad(g,d,t)}}function Ad(r,e,t){const n=t[t.length-1],i={node:r};Object.assign(i,{context:n}),xe(i,jn,Xe(e.getTagName()),[e],t)}function Co(r,e,t){const n=t[t.length-1],s=n.context.version;n.srsName=e.srsName;const o=ms[s];yr(s,r,e.geometryName),o.prototype.writeGeometryElement(r,e.extent,t)}function Id(r,e,t){r.setAttribute("rid",e.rid)}function Rt(r,e,t){const n=t[t.length-1],s=n.context.version;n.srsName=e.srsName;const o=ms[s];yr(s,r,e.geometryName),o.prototype.writeGeometryElement(r,e.geometry,t)}function Oo(r,e,t){const s=t[t.length-1].context.version;Rt(r,e,t);const o=J(Zn(s),"Distance");se(o,e.distance.toString()),s==="2.0.0"?o.setAttribute("uom",e.unit):o.setAttribute("units",e.unit),r.appendChild(o)}function Mo(r,e,t){const s=t[t.length-1].context.version;Sn(gs[s],"ValueReference",r,e.propertyName);const o=J(Et,"TimePeriod");r.appendChild(o);const a=J(Et,"begin");o.appendChild(a),Uo(a,e.begin);const l=J(Et,"end");o.appendChild(l),Uo(l,e.end)}function nn(r,e,t){const i=t[t.length-1].context,s={node:r};Object.assign(s,{context:i});const o=e.conditions;for(let a=0,l=o.length;a<l;++a){const u=o[a];xe(s,jn,Xe(u.getTagName()),[u],t)}}function Fo(r,e,t){const i=t[t.length-1].context,s={node:r};Object.assign(s,{context:i});const o=e.condition;xe(s,jn,Xe(o.getTagName()),[o],t)}function qe(r,e,t){const s=t[t.length-1].context.version;e.matchCase!==void 0&&r.setAttribute("matchCase",e.matchCase.toString()),yr(s,r,e.propertyName),Rn(s,r,""+e.expression)}function No(r,e,t){const s=t[t.length-1].context.version;yr(s,r,e.propertyName)}function Do(r,e,t){const s=t[t.length-1].context.version,o=Zn(s);yr(s,r,e.propertyName);const a=J(o,"LowerBoundary");r.appendChild(a),Rn(s,a,""+e.lowerBoundary);const l=J(o,"UpperBoundary");r.appendChild(l),Rn(s,l,""+e.upperBoundary)}function Go(r,e,t){const s=t[t.length-1].context.version;r.setAttribute("wildCard",e.wildCard),r.setAttribute("singleChar",e.singleChar),r.setAttribute("escapeChar",e.escapeChar),e.matchCase!==void 0&&r.setAttribute("matchCase",e.matchCase.toString()),yr(s,r,e.propertyName),Rn(s,r,""+e.pattern)}function Sn(r,e,t,n){const i=J(r,e);se(i,n),t.appendChild(i)}function Rn(r,e,t){Sn(Zn(r),"Literal",e,t)}function yr(r,e,t){r==="2.0.0"?Sn(gs[r],"ValueReference",e,t):Sn(ps[r],"PropertyName",e,t)}function Uo(r,e){const t=J(Et,"TimeInstant");r.appendChild(t);const n=J(Et,"timePosition");t.appendChild(n),se(n,e)}function Bo(r,e,t){const n=t[t.length-1],i=Object.assign({},n);i.node=r,xe(i,jn,Xe("Query"),e,t)}function Zn(r){let e;return r==="2.0.0"?e=gs[r]:e=ps[r],e}const Ld=Sd,me={POINT:1,LINE_STRING:2,POLYGON:3,MULTI_POINT:4,MULTI_LINE_STRING:5,MULTI_POLYGON:6,GEOMETRY_COLLECTION:7,POLYHEDRAL_SURFACE:15,TIN:16,TRIANGLE:17};class zo{constructor(e){this.view_=e,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_="XY"}readUint8(){return this.view_.getUint8(this.pos_++)}readUint32(e){return this.view_.getUint32((this.pos_+=4)-4,e!==void 0?e:this.isLittleEndian_)}readDouble(e){return this.view_.getFloat64((this.pos_+=8)-8,e!==void 0?e:this.isLittleEndian_)}readPoint(){const e=[];return e.push(this.readDouble()),e.push(this.readDouble()),this.hasZ_&&e.push(this.readDouble()),this.hasM_&&e.push(this.readDouble()),e}readLineString(){const e=this.readUint32(),t=[];for(let n=0;n<e;n++)t.push(this.readPoint());return t}readPolygon(){const e=this.readUint32(),t=[];for(let n=0;n<e;n++)t.push(this.readLineString());return t}readWkbHeader(e){const n=this.readUint8()>0,i=this.readUint32(n),s=Math.floor((i&268435455)/1e3),o=!!(i&2147483648)||s===1||s===3,a=!!(i&1073741824)||s===2||s===3,l=!!(i&536870912),u=(i&268435455)%1e3,h=["XY",o?"Z":"",a?"M":""].join(""),f=l?this.readUint32(n):null;if(e!==void 0&&e!==u)throw new Error("Unexpected WKB geometry type "+u);if(this.initialized_){if(this.isLittleEndian_!==n)throw new Error("Inconsistent endian");if(this.layout_!==h)throw new Error("Inconsistent geometry layout");if(f&&this.srid_!==f)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=n,this.hasZ_=o,this.hasM_=a,this.layout_=h,this.srid_=f,this.initialized_=!0;return u}readWkbPayload(e){switch(e){case me.POINT:return this.readPoint();case me.LINE_STRING:return this.readLineString();case me.POLYGON:case me.TRIANGLE:return this.readPolygon();case me.MULTI_POINT:return this.readMultiPoint();case me.MULTI_LINE_STRING:return this.readMultiLineString();case me.MULTI_POLYGON:case me.POLYHEDRAL_SURFACE:case me.TIN:return this.readMultiPolygon();case me.GEOMETRY_COLLECTION:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+e+" is found")}}readWkbBlock(e){return this.readWkbPayload(this.readWkbHeader(e))}readWkbCollection(e,t){const n=this.readUint32(),i=[];for(let s=0;s<n;s++){const o=e.call(this,t);o&&i.push(o)}return i}readMultiPoint(){return this.readWkbCollection(this.readWkbBlock,me.POINT)}readMultiLineString(){return this.readWkbCollection(this.readWkbBlock,me.LINE_STRING)}readMultiPolygon(){return this.readWkbCollection(this.readWkbBlock,me.POLYGON)}readGeometryCollection(){return this.readWkbCollection(this.readGeometry)}readGeometry(){const e=this.readWkbHeader(),t=this.readWkbPayload(e);switch(e){case me.POINT:return new rt(t,this.layout_);case me.LINE_STRING:return new dt(t,this.layout_);case me.POLYGON:case me.TRIANGLE:return new Xr(t,this.layout_);case me.MULTI_POINT:return new Mn(t,this.layout_);case me.MULTI_LINE_STRING:return new dr(t,this.layout_);case me.MULTI_POLYGON:case me.POLYHEDRAL_SURFACE:case me.TIN:return new Vr(t,this.layout_);case me.GEOMETRY_COLLECTION:return new Ct(t);default:return null}}getSrid(){return this.srid_}}class Cd{constructor(e){e=e||{},this.layout_=e.layout,this.isLittleEndian_=e.littleEndian!==!1,this.isEWKB_=e.ewkb!==!1,this.writeQueue_=[],this.nodata_=Object.assign({X:0,Y:0,Z:0,M:0},e.nodata)}writeUint8(e){this.writeQueue_.push([1,e])}writeUint32(e){this.writeQueue_.push([4,e])}writeDouble(e){this.writeQueue_.push([8,e])}writePoint(e,t){const n=Object.assign.apply(null,t.split("").map((i,s)=>({[i]:e[s]})));for(const i of this.layout_)this.writeDouble(i in n?n[i]:this.nodata_[i])}writeLineString(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writePoint(e[n],t)}writePolygon(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writeLineString(e[n],t)}writeWkbHeader(e,t){e%=1e3,this.layout_.includes("Z")&&(e+=this.isEWKB_?2147483648:1e3),this.layout_.includes("M")&&(e+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(t)&&(e|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(e),this.isEWKB_&&Number.isInteger(t)&&this.writeUint32(t)}writeMultiPoint(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writeWkbHeader(1),this.writePoint(e[n],t)}writeMultiLineString(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writeWkbHeader(2),this.writeLineString(e[n],t)}writeMultiPolygon(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writeWkbHeader(3),this.writePolygon(e[n],t)}writeGeometryCollection(e){this.writeUint32(e.length);for(let t=0;t<e.length;t++)this.writeGeometry(e[t])}findMinimumLayout(e,t="XYZM"){const n=(i,s)=>i===s?i:i==="XYZM"?s:s==="XYZM"?i:"XY";if(e instanceof io)return n(e.getLayout(),t);if(e instanceof Ct){const i=e.getGeometriesArray();for(let s=0;s<i.length&&t!=="XY";s++)t=this.findMinimumLayout(i[s],t)}return t}writeGeometry(e,t){const n={Point:me.POINT,LineString:me.LINE_STRING,Polygon:me.POLYGON,MultiPoint:me.MULTI_POINT,MultiLineString:me.MULTI_LINE_STRING,MultiPolygon:me.MULTI_POLYGON,GeometryCollection:me.GEOMETRY_COLLECTION},i=e.getType(),s=n[i];if(!s)throw new Error("GeometryType "+i+" is not supported");this.layout_||(this.layout_=this.findMinimumLayout(e)),this.writeWkbHeader(s,t),e instanceof io?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[i].call(this,e.getCoordinates(),e.getLayout()):e instanceof Ct&&this.writeGeometryCollection(e.getGeometriesArray())}getBuffer(){const e=this.writeQueue_.reduce((s,o)=>s+o[0],0),t=new ArrayBuffer(e),n=new DataView(t);let i=0;return this.writeQueue_.forEach(s=>{switch(s[0]){case 1:n.setUint8(i,s[1]);break;case 4:n.setUint32(i,s[1],this.isLittleEndian_);break;case 8:n.setFloat64(i,s[1],this.isLittleEndian_);break}i+=s[0]}),t}}class Od extends va{constructor(e){super(),e=e||{},this.splitCollection=!!e.splitCollection,this.viewCache_=null,this.hex_=e.hex!==!1,this.littleEndian_=e.littleEndian!==!1,this.ewkb_=e.ewkb!==!1,this.layout_=e.geometryLayout,this.nodataZ_=e.nodataZ||0,this.nodataM_=e.nodataM||0,this.srid_=e.srid}getType(){return this.hex_?"text":"arraybuffer"}readFeature(e,t){return new Ye({geometry:this.readGeometry(e,t)})}readFeatures(e,t){let n=[];const i=this.readGeometry(e,t);return this.splitCollection&&i instanceof Ct?n=i.getGeometriesArray():n=[i],n.map(s=>new Ye({geometry:s}))}readGeometry(e,t){const n=ko(e);if(!n)return null;const s=new zo(n).readGeometry();return this.viewCache_=n,t=this.getReadOptions(e,t),this.viewCache_=null,Ce(s,!1,t)}readProjection(e){const t=this.viewCache_||ko(e);if(!t)return;const n=new zo(t);return n.readWkbHeader(),n.getSrid()&&_e("EPSG:"+n.getSrid())||void 0}writeFeature(e,t){return this.writeGeometry(e.getGeometry(),t)}writeFeatures(e,t){return this.writeGeometry(new Ct(e.map(n=>n.getGeometry())),t)}writeGeometry(e,t){t=this.adaptOptions(t);const n=new Cd({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}});let i=Number.isInteger(this.srid_)?Number(this.srid_):null;if(this.srid_!==!1&&!Number.isInteger(this.srid_)){const o=t.dataProjection&&_e(t.dataProjection);if(o){const a=o.getCode();a.startsWith("EPSG:")&&(i=Number(a.substring(5)))}}n.writeGeometry(Ce(e,!0,t),i);const s=n.getBuffer();return this.hex_?Md(s):s}}function Md(r){const e=new Uint8Array(r);return Array.from(e.values()).map(t=>(t<16?"0":"")+Number(t).toString(16).toUpperCase()).join("")}function Fd(r){const e=new Uint8Array(r.length/2);for(let t=0;t<r.length/2;t++)e[t]=parseInt(r.substr(t*2,2),16);return new DataView(e.buffer)}function ko(r){return typeof r=="string"?Fd(r):ArrayBuffer.isView(r)?r instanceof DataView?r:new DataView(r.buffer,r.byteOffset,r.byteLength):r instanceof ArrayBuffer?new DataView(r):null}const Nd=Od,Dd={POINT:rt,LINESTRING:dt,POLYGON:Xr,MULTIPOINT:Mn,MULTILINESTRING:dr,MULTIPOLYGON:Vr},Ja="EMPTY",el="Z",tl="M",Gd="ZM",pe={START:0,TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6},Ud={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class Bd{constructor(e){this.wkt=e,this.index_=-1}isAlpha_(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}isNumeric_(e,t){return t=t!==void 0?t:!1,e>="0"&&e<="9"||e=="."&&!t}isWhiteSpace_(e){return e==" "||e=="	"||e=="\r"||e==`
`}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const e=this.nextChar_(),t=this.index_;let n=e,i;if(e=="(")i=pe.LEFT_PAREN;else if(e==",")i=pe.COMMA;else if(e==")")i=pe.RIGHT_PAREN;else if(this.isNumeric_(e)||e=="-")i=pe.NUMBER,n=this.readNumber_();else if(this.isAlpha_(e))i=pe.TEXT,n=this.readText_();else{if(this.isWhiteSpace_(e))return this.nextToken();if(e==="")i=pe.EOF;else throw new Error("Unexpected character: "+e)}return{position:t,value:n,type:i}}readNumber_(){let e;const t=this.index_;let n=!1,i=!1;do e=="."?n=!0:(e=="e"||e=="E")&&(i=!0),e=this.nextChar_();while(this.isNumeric_(e,n)||!i&&(e=="e"||e=="E")||i&&(e=="-"||e=="+"));return parseFloat(this.wkt.substring(t,this.index_--))}readText_(){let e;const t=this.index_;do e=this.nextChar_();while(this.isAlpha_(e));return this.wkt.substring(t,this.index_--).toUpperCase()}}class zd{constructor(e){this.lexer_=e,this.token_={position:0,type:pe.START},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(e){return this.token_.type==e}match(e){const t=this.isTokenType(e);return t&&this.consume_(),t}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let e="XY";const t=this.token_;if(this.isTokenType(pe.TEXT)){const n=t.value;n===el?e="XYZ":n===tl?e="XYM":n===Gd&&(e="XYZM"),e!=="XY"&&this.consume_()}return e}parseGeometryCollectionText_(){if(this.match(pe.LEFT_PAREN)){const e=[];do e.push(this.parseGeometry_());while(this.match(pe.COMMA));if(this.match(pe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(pe.LEFT_PAREN)){const e=this.parsePoint_();if(this.match(pe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(pe.LEFT_PAREN)){const e=this.parsePointList_();if(this.match(pe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(pe.LEFT_PAREN)){const e=this.parseLineStringTextList_();if(this.match(pe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(pe.LEFT_PAREN)){let e;if(this.token_.type==pe.LEFT_PAREN?e=this.parsePointTextList_():e=this.parsePointList_(),this.match(pe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(pe.LEFT_PAREN)){const e=this.parseLineStringTextList_();if(this.match(pe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(pe.LEFT_PAREN)){const e=this.parsePolygonTextList_();if(this.match(pe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePoint_(){const e=[],t=this.layout_.length;for(let n=0;n<t;++n){const i=this.token_;if(this.match(pe.NUMBER))e.push(i.value);else break}if(e.length==t)return e;throw new Error(this.formatErrorMessage_())}parsePointList_(){const e=[this.parsePoint_()];for(;this.match(pe.COMMA);)e.push(this.parsePoint_());return e}parsePointTextList_(){const e=[this.parsePointText_()];for(;this.match(pe.COMMA);)e.push(this.parsePointText_());return e}parseLineStringTextList_(){const e=[this.parseLineStringText_()];for(;this.match(pe.COMMA);)e.push(this.parseLineStringText_());return e}parsePolygonTextList_(){const e=[this.parsePolygonText_()];for(;this.match(pe.COMMA);)e.push(this.parsePolygonText_());return e}isEmptyGeometry_(){const e=this.isTokenType(pe.TEXT)&&this.token_.value==Ja;return e&&this.consume_(),e}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const e=this.token_;if(this.match(pe.TEXT)){const t=e.value;this.layout_=this.parseGeometryLayout_();const n=this.isEmptyGeometry_();if(t=="GEOMETRYCOLLECTION"){if(n)return new Ct([]);const o=this.parseGeometryCollectionText_();return new Ct(o)}const i=Dd[t];if(!i)throw new Error("Invalid geometry type: "+t);let s;if(n)t=="POINT"?s=[NaN,NaN]:s=[];else switch(t){case"POINT":{s=this.parsePointText_();break}case"LINESTRING":{s=this.parseLineStringText_();break}case"POLYGON":{s=this.parsePolygonText_();break}case"MULTIPOINT":{s=this.parseMultiPointText_();break}case"MULTILINESTRING":{s=this.parseMultiLineStringText_();break}case"MULTIPOLYGON":{s=this.parseMultiPolygonText_();break}}return new i(s,this.layout_)}throw new Error(this.formatErrorMessage_())}}class kd extends cs{constructor(e){super(),e=e||{},this.splitCollection_=e.splitCollection!==void 0?e.splitCollection:!1}parse_(e){const t=new Bd(e);return new zd(t).parse()}readFeatureFromText(e,t){const n=this.readGeometryFromText(e,t),i=new Ye;return i.setGeometry(n),i}readFeaturesFromText(e,t){let n=[];const i=this.readGeometryFromText(e,t);this.splitCollection_&&i.getType()=="GeometryCollection"?n=i.getGeometriesArray():n=[i];const s=[];for(let o=0,a=n.length;o<a;++o){const l=new Ye;l.setGeometry(n[o]),s.push(l)}return s}readGeometryFromText(e,t){const n=this.parse_(e);return Ce(n,!1,t)}writeFeatureText(e,t){const n=e.getGeometry();return n?this.writeGeometryText(n,t):""}writeFeaturesText(e,t){if(e.length==1)return this.writeFeatureText(e[0],t);const n=[];for(let s=0,o=e.length;s<o;++s)n.push(e[s].getGeometry());const i=new Ct(n);return this.writeGeometryText(i,t)}writeGeometryText(e,t){return il(Ce(e,!0,t))}}function rl(r){const e=r.getCoordinates();return e.length===0?"":e.join(" ")}function $d(r){const e=[],t=r.getPoints();for(let n=0,i=t.length;n<i;++n)e.push("("+rl(t[n])+")");return e.join(",")}function jd(r){const e=[],t=r.getGeometries();for(let n=0,i=t.length;n<i;++n)e.push(il(t[n]));return e.join(",")}function ys(r){const e=r.getCoordinates(),t=[];for(let n=0,i=e.length;n<i;++n)t.push(e[n].join(" "));return t.join(",")}function Zd(r){const e=[],t=r.getLineStrings();for(let n=0,i=t.length;n<i;++n)e.push("("+ys(t[n])+")");return e.join(",")}function nl(r){const e=[],t=r.getLinearRings();for(let n=0,i=t.length;n<i;++n)e.push("("+ys(t[n])+")");return e.join(",")}function Vd(r){const e=[],t=r.getPolygons();for(let n=0,i=t.length;n<i;++n)e.push("("+nl(t[n])+")");return e.join(",")}function Xd(r){const e=r.getLayout();let t="";return(e==="XYZ"||e==="XYZM")&&(t+=el),(e==="XYM"||e==="XYZM")&&(t+=tl),t}const Hd={Point:rl,LineString:ys,Polygon:nl,MultiPoint:$d,MultiLineString:Zd,MultiPolygon:Vd,GeometryCollection:jd};function il(r){const e=r.getType(),t=Hd[e],n=t(r);let i=Ud[e];if(typeof r.getFlatCoordinates=="function"){const s=Xd(r);s.length>0&&(i+=" "+s)}return n.length===0?i+" "+Ja:i+"("+n+")"}const Wd=kd,Me=[null,"http://www.opengis.net/wms"],Yd=$(Me,{Service:R(mp),Capability:R(gp)}),qd=$(Me,{Request:R(vp),Exception:R(Ep),Layer:R(wp)});class Kd extends hs{constructor(){super(),this.version=void 0}readFromNode(e){this.version=e.getAttribute("version").trim();const t=G({version:this.version},Yd,e,[]);return t||null}}const Qd=$(Me,{Name:R(D),Title:R(D),Abstract:R(D),KeywordList:R(ll),OnlineResource:R(_r),ContactInformation:R(_p),Fees:R(D),AccessConstraints:R(D),LayerLimit:R(Re),MaxWidth:R(Re),MaxHeight:R(Re)}),Jd=$(Me,{ContactPersonPrimary:R(yp),ContactPosition:R(D),ContactAddress:R(xp),ContactVoiceTelephone:R(D),ContactFacsimileTelephone:R(D),ContactElectronicMailAddress:R(D)}),ep=$(Me,{ContactPerson:R(D),ContactOrganization:R(D)}),tp=$(Me,{AddressType:R(D),Address:R(D),City:R(D),StateOrProvince:R(D),PostCode:R(D),Country:R(D)}),rp=$(Me,{Format:H(D)}),sl=$(Me,{Name:R(D),Title:R(D),Abstract:R(D),KeywordList:R(ll),CRS:Ee(D),EX_GeographicBoundingBox:R(pp),BoundingBox:Ee(dp),Dimension:Ee(Tp),Attribution:R(fp),AuthorityURL:Ee(bp),Identifier:Ee(D),MetadataURL:Ee(Pp),DataURL:Ee(Tt),FeatureListURL:Ee(Tt),Style:Ee(Ap),MinScaleDenominator:R(Ne),MaxScaleDenominator:R(Ne),Layer:Ee(ol)}),np=$(Me,{Title:R(D),OnlineResource:R(_r),LogoURL:R(al)}),ip=$(Me,{westBoundLongitude:R(Ne),eastBoundLongitude:R(Ne),southBoundLatitude:R(Ne),northBoundLatitude:R(Ne)}),sp=$(Me,{GetCapabilities:R(ii),GetMap:R(ii),GetFeatureInfo:R(ii)}),op=$(Me,{Format:Ee(D),DCPType:Ee(Sp)}),ap=$(Me,{HTTP:R(Rp)}),lp=$(Me,{Get:R(Tt),Post:R(Tt)}),up=$(Me,{Name:R(D),Title:R(D),Abstract:R(D),LegendURL:Ee(al),StyleSheetURL:R(Tt),StyleURL:R(Tt)}),cp=$(Me,{Format:R(D),OnlineResource:R(_r)}),hp=$(Me,{Keyword:H(D)});function fp(r,e){return G({},np,r,e)}function dp(r,e){const t=[bt(r.getAttribute("minx")),bt(r.getAttribute("miny")),bt(r.getAttribute("maxx")),bt(r.getAttribute("maxy"))],n=[bt(r.getAttribute("resx")),bt(r.getAttribute("resy"))];return{crs:r.getAttribute("CRS"),extent:t,res:n}}function pp(r,e){const t=G({},ip,r,e);if(!t)return;const n=t.westBoundLongitude,i=t.southBoundLatitude,s=t.eastBoundLongitude,o=t.northBoundLatitude;if(!(n===void 0||i===void 0||s===void 0||o===void 0))return[n,i,s,o]}function gp(r,e){return G({},qd,r,e)}function mp(r,e){return G({},Qd,r,e)}function _p(r,e){return G({},Jd,r,e)}function yp(r,e){return G({},ep,r,e)}function xp(r,e){return G({},tp,r,e)}function Ep(r,e){return G([],rp,r,e)}function wp(r,e){const t=G({},sl,r,e);return t.Layer===void 0?Object.assign(t,ol(r,e)):t}function ol(r,e){const t=e[e.length-1],n=G({},sl,r,e);if(!n)return;let i=sr(r.getAttribute("queryable"));i===void 0&&(i=t.queryable),n.queryable=i!==void 0?i:!1;let s=Pt(r.getAttribute("cascaded"));s===void 0&&(s=t.cascaded),n.cascaded=s;let o=sr(r.getAttribute("opaque"));o===void 0&&(o=t.opaque),n.opaque=o!==void 0?o:!1;let a=sr(r.getAttribute("noSubsets"));a===void 0&&(a=t.noSubsets),n.noSubsets=a!==void 0?a:!1;let l=bt(r.getAttribute("fixedWidth"));l||(l=t.fixedWidth),n.fixedWidth=l;let u=bt(r.getAttribute("fixedHeight"));return u||(u=t.fixedHeight),n.fixedHeight=u,["Style","CRS","AuthorityURL"].forEach(function(d){if(d in t){const g=n[d]||[];n[d]=g.concat(t[d])}}),["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"].forEach(function(d){if(!(d in n)){const g=t[d];n[d]=g}}),n}function Tp(r,e){return{name:r.getAttribute("name"),units:r.getAttribute("units"),unitSymbol:r.getAttribute("unitSymbol"),default:r.getAttribute("default"),multipleValues:sr(r.getAttribute("multipleValues")),nearestValue:sr(r.getAttribute("nearestValue")),current:sr(r.getAttribute("current")),values:D(r)}}function Tt(r,e){return G({},cp,r,e)}function vp(r,e){return G({},sp,r,e)}function Sp(r,e){return G({},ap,r,e)}function Rp(r,e){return G({},lp,r,e)}function ii(r,e){return G({},op,r,e)}function al(r,e){const t=Tt(r,e);if(t){const n=[Pt(r.getAttribute("width")),Pt(r.getAttribute("height"))];return t.size=n,t}}function bp(r,e){const t=Tt(r,e);if(t)return t.name=r.getAttribute("name"),t}function Pp(r,e){const t=Tt(r,e);if(t)return t.type=r.getAttribute("type"),t}function Ap(r,e){return G({},up,r,e)}function ll(r,e){return G([],hp,r,e)}const Ip=Kd,Lp="_feature",Cp="_layer";class Op extends Fn{constructor(e){super(),e=e||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new ne,this.layers_=e.layers?e.layers:null}getLayers(){return this.layers_}setLayers(e){this.layers_=e}readFeatures_(e,t){e.setAttribute("namespaceURI",this.featureNS_);const n=e.localName;let i=[];if(e.childNodes.length===0)return i;if(n=="msGMLOutput")for(let s=0,o=e.childNodes.length;s<o;s++){const a=e.childNodes[s];if(a.nodeType!==Node.ELEMENT_NODE)continue;const l=a,u=t[0],h=Cp,f=l.localName.replace(h,"");if(this.layers_&&!this.layers_.includes(f))continue;const d=f+Lp;u.featureType=d,u.featureNS=this.featureNS_;const g={};g[d]=H(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const m=$([u.featureNS,null],g);l.setAttribute("namespaceURI",this.featureNS_);const y=G([],m,l,t,this.gmlFormat_);y&&pn(i,y)}if(n=="FeatureCollection"){const s=G([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_);s&&(i=s)}return i}readFeaturesFromNode(e,t){const n={};return t&&Object.assign(n,this.getReadOptions(e,t)),this.readFeatures_(e,[n])}}const Mp=Op,gt=[null,"http://www.opengis.net/wmts/1.0"],xr=[null,"http://www.opengis.net/ows/1.1"],Fp=$(gt,{Contents:R(Vp)});let Np=class extends hs{constructor(){super(),this.owsParser_=new Wa}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let n=this.owsParser_.readFromNode(e);return n?(n.version=t,n=G(n,Fp,e,[]),n||null):null}};const Dp=$(gt,{Layer:Ee(Xp),TileMatrixSet:Ee(Hp)}),Gp=$(gt,{Style:Ee(Wp),Format:Ee(D),TileMatrixSetLink:Ee(Yp),Dimension:Ee(qp),ResourceURL:Ee(Kp)},$(xr,{Title:R(D),Abstract:R(D),WGS84BoundingBox:R(cl),BoundingBox:Ee(Qp),Identifier:R(D)})),Up=$(gt,{LegendURL:Ee(Jp)},$(xr,{Title:R(D),Identifier:R(D)})),Bp=$(gt,{TileMatrixSet:R(D),TileMatrixSetLimits:R(tg)}),zp=$(gt,{TileMatrixLimits:H(rg)}),kp=$(gt,{TileMatrix:R(D),MinTileRow:R(Re),MaxTileRow:R(Re),MinTileCol:R(Re),MaxTileCol:R(Re)}),$p=$(gt,{Default:R(D),Value:Ee(D)},$(xr,{Identifier:R(D)})),ul=$(xr,{LowerCorner:H(Ii),UpperCorner:H(Ii)}),jp=$(gt,{WellKnownScaleSet:R(D),TileMatrix:Ee(eg)},$(xr,{SupportedCRS:R(D),Identifier:R(D),BoundingBox:R(cl)})),Zp=$(gt,{TopLeftCorner:R(Ii),ScaleDenominator:R(Ne),TileWidth:R(Re),TileHeight:R(Re),MatrixWidth:R(Re),MatrixHeight:R(Re)},$(xr,{Identifier:R(D)}));function Vp(r,e){return G({},Dp,r,e)}function Xp(r,e){return G({},Gp,r,e)}function Hp(r,e){return G({},jp,r,e)}function Wp(r,e){const t=G({},Up,r,e);if(!t)return;const n=r.getAttribute("isDefault")==="true";return t.isDefault=n,t}function Yp(r,e){return G({},Bp,r,e)}function qp(r,e){return G({},$p,r,e)}function Kp(r,e){const t=r.getAttribute("format"),n=r.getAttribute("template"),i=r.getAttribute("resourceType"),s={};return t&&(s.format=t),n&&(s.template=n),i&&(s.resourceType=i),s}function cl(r,e){const t=G([],ul,r,e);if(t.length==2)return Xi(t)}function Qp(r,e){const t=r.getAttribute("crs"),n=G([],ul,r,e);if(n.length==2)return{extent:Xi(n),crs:t}}function Jp(r,e){const t={};return t.format=r.getAttribute("format"),t.href=_r(r),t}function Ii(r,e){const t=D(r).split(/\s+/);if(!t||t.length!=2)return;const n=+t[0],i=+t[1];if(!(isNaN(n)||isNaN(i)))return[n,i]}function eg(r,e){return G({},Zp,r,e)}function tg(r,e){return G([],zp,r,e)}function rg(r,e){return G({},kp,r,e)}const xs=Np,ng=Object.freeze(Object.defineProperty({__proto__:null,EsriJSON:Eh,GML:bh,GPX:df,GeoJSON:Sa,IGC:xf,IIIFInfo:bf,KML:Yu,MVT:Ra,OWS:Wa,Polyline:dd,TopoJSON:qu,WFS:Ld,WKB:Nd,WKT:Wd,WMSCapabilities:Ip,WMSGetFeatureInfo:Mp,WMTSCapabilities:xs},Symbol.toStringTag,{value:"Module"}));function ig(r){if(!(r.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const e=r.inversePixelTransform[0],t=r.inversePixelTransform[1],n=Math.sqrt(e*e+t*t),i=r.frameState,s=ba(r.inversePixelTransform.slice(),i.coordinateToPixelTransform),o=Ku(i.viewState.resolution,n);let a;return new Qu(r.context,n,i.extent,s,i.viewState.rotation,o,a)}function hl(r,e,t){const n=[];let i=r(0),s=r(1),o=e(i),a=e(s);const l=[s,i],u=[a,o],h=[1,0],f={};let d=1e5,g,m,y,x,w,E;for(;--d>0&&h.length>0;)y=h.pop(),i=l.pop(),o=u.pop(),E=y.toString(),E in f||(n.push(o[0],o[1]),f[E]=!0),x=h.pop(),s=l.pop(),a=u.pop(),w=(y+x)/2,g=r(w),m=e(g),Ju(m[0],m[1],o[0],o[1],a[0],a[1])<t?(n.push(a[0],a[1]),E=x.toString(),f[E]=!0):(h.push(x,w,w,y),u.push(a,m,m,o),l.push(s,g,g,i));return n}function sg(r,e,t,n,i){const s=_e("EPSG:4326");return hl(function(o){return[r,e+(t-e)*o]},yn(s,n),i)}function og(r,e,t,n,i){const s=_e("EPSG:4326");return hl(function(o){return[e+(t-e)*o,r]},yn(s,n),i)}const ag=new Dr({color:"rgba(0,0,0,0.2)"}),lg=[90,45,30,20,10,5,2,1,30/60,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600];class ug extends Hi{constructor(e){e=e||{};const t=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},e);delete t.maxLines,delete t.strokeStyle,delete t.targetSize,delete t.showLabels,delete t.lonLabelFormatter,delete t.latLabelFormatter,delete t.lonLabelPosition,delete t.latLabelPosition,delete t.lonLabelStyle,delete t.latLabelStyle,delete t.intervals,super(t),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=e.targetSize!==void 0?e.targetSize:100,this.maxLines_=e.maxLines!==void 0?e.maxLines:100,this.meridians_=[],this.parallels_=[],this.strokeStyle_=e.strokeStyle!==void 0?e.strokeStyle:ag,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,e.showLabels&&(this.lonLabelFormatter_=e.lonLabelFormatter==null?so.bind(this,"EW"):e.lonLabelFormatter,this.latLabelFormatter_=e.latLabelFormatter==null?so.bind(this,"NS"):e.latLabelFormatter,this.lonLabelPosition_=e.lonLabelPosition==null?0:e.lonLabelPosition,this.latLabelPosition_=e.latLabelPosition==null?1:e.latLabelPosition,this.lonLabelStyleBase_=new Or({text:e.lonLabelStyle!==void 0?e.lonLabelStyle.clone():new oo({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new vi({color:"rgba(0,0,0,1)"}),stroke:new Dr({color:"rgba(255,255,255,1)",width:3})})}),this.lonLabelStyle_=n=>{const i=n.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(i),this.lonLabelStyleBase_},this.latLabelStyleBase_=new Or({text:e.latLabelStyle!==void 0?e.latLabelStyle.clone():new oo({font:"12px Calibri,sans-serif",textAlign:"right",fill:new vi({color:"rgba(0,0,0,1)"}),stroke:new Dr({color:"rgba(255,255,255,1)",width:3})})}),this.latLabelStyle_=n=>{const i=n.get("graticule_label");return this.latLabelStyleBase_.getText().setText(i),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(Ut.POSTRENDER,this.drawLabels_.bind(this))),this.intervals_=e.intervals!==void 0?e.intervals:lg,this.setSource(new Dn({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new ec,overlaps:!1,useSpatialIndex:!1,wrapX:e.wrapX})),this.featurePool_=[],this.lineStyle_=new Or({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(e,t){let n=e.slice();return this.projection_&&this.getSource().getWrapX()&&tc(n,this.projection_),this.loadedExtent_&&(rc(this.loadedExtent_,n,t)?n=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[n]}loaderFunction(e,t,n){this.loadedExtent_=e;const i=this.getSource(),s=this.getExtent()||[-1/0,-1/0,1/0,1/0],o=ht(s,e);if(this.renderedExtent_&&xn(this.renderedExtent_,o)&&this.renderedResolution_===t||(this.renderedExtent_=o,this.renderedResolution_=t,Wi(o)))return;const a=It(o),l=t*t/4;(!this.projection_||!br(this.projection_,n))&&this.updateProjectionInfo_(n),this.createGraticule_(o,a,t,l);let h=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(h+=this.meridians_.length),this.parallelsLabels_&&(h+=this.parallels_.length);let f;for(;h>this.featurePool_.length;)f=new Ye,this.featurePool_.push(f);const d=i.getFeaturesCollection();d.clear();let g=0,m,y;for(m=0,y=this.meridians_.length;m<y;++m)f=this.featurePool_[g++],f.setGeometry(this.meridians_[m]),f.setStyle(this.lineStyle_),d.push(f);for(m=0,y=this.parallels_.length;m<y;++m)f=this.featurePool_[g++],f.setGeometry(this.parallels_[m]),f.setStyle(this.lineStyle_),d.push(f)}addMeridian_(e,t,n,i,s,o){const a=this.getMeridian_(e,t,n,i,o);if(ar(a.getExtent(),s)){if(this.meridiansLabels_){const l=this.lonLabelFormatter_(e);o in this.meridiansLabels_?this.meridiansLabels_[o].text=l:this.meridiansLabels_[o]={geom:new rt([]),text:l}}this.meridians_[o++]=a}return o}addParallel_(e,t,n,i,s,o){const a=this.getParallel_(e,t,n,i,o);if(ar(a.getExtent(),s)){if(this.parallelsLabels_){const l=this.latLabelFormatter_(e);o in this.parallelsLabels_?this.parallelsLabels_[o].text=l:this.parallelsLabels_[o]={geom:new rt([]),text:l}}this.parallels_[o++]=a}return o}drawLabels_(e){const t=e.frameState.viewState.rotation,n=e.frameState.viewState.resolution,i=e.frameState.size,s=e.frameState.extent,o=It(s);let a=s;if(t){const m=i[0]*n,y=i[1]*n;a=[o[0]-m/2,o[1]-y/2,o[0]+m/2,o[1]+y/2]}let l=0,u=0,h=this.latLabelPosition_<.5;const f=this.projection_.getExtent(),d=He(f);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!fn(f,s)){l=Math.floor((s[0]-f[0])/d),u=Math.ceil((s[2]-f[2])/d);const m=Math.abs(t)>Math.PI/2;h=h!==m}const g=ig(e);for(let m=l;m<=u;++m){let y=this.meridians_.length+this.parallels_.length,x,w,E,v;if(this.meridiansLabels_)for(w=0,E=this.meridiansLabels_.length;w<E;++w){const S=this.meridians_[w];if(!t&&m===0)v=this.getMeridianPoint_(S,s,w);else{const A=S.clone();A.translate(m*d,0),A.rotate(-t,o),v=this.getMeridianPoint_(A,a,w),v.rotate(t,o)}x=this.featurePool_[y++],x.setGeometry(v),x.set("graticule_label",this.meridiansLabels_[w].text),g.drawFeature(x,this.lonLabelStyle_(x))}if(this.parallelsLabels_&&(m===l&&h||m===u&&!h))for(w=0,E=this.parallels_.length;w<E;++w){const S=this.parallels_[w];if(!t&&m===0)v=this.getParallelPoint_(S,s,w);else{const A=S.clone();A.translate(m*d,0),A.rotate(-t,o),v=this.getParallelPoint_(A,a,w),v.rotate(t,o)}x=this.featurePool_[y++],x.setGeometry(v),x.set("graticule_label",this.parallelsLabels_[w].text),g.drawFeature(x,this.latLabelStyle_(x))}}}createGraticule_(e,t,n,i){const s=this.getInterval_(n);if(s==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}let o=!1;const a=this.projection_.getExtent(),l=He(a);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!fn(a,e)&&(He(e)>=l?(e[0]=a[0],e[2]=a[2]):o=!0);const u=[ve(t[0],this.minX_,this.maxX_),ve(t[1],this.minY_,this.maxY_)],h=this.toLonLatTransform_(u);isNaN(h[1])&&(h[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let f=ve(h[0],this.minLon_,this.maxLon_),d=ve(h[1],this.minLat_,this.maxLat_);const g=this.maxLines_;let m,y,x,w,E=e;o||(E=[ve(e[0],this.minX_,this.maxX_),ve(e[1],this.minY_,this.maxY_),ve(e[2],this.minX_,this.maxX_),ve(e[3],this.minY_,this.maxY_)]);const v=Gr(E,this.toLonLatTransform_,void 0,8);let S=v[3],A=v[2],O=v[1],L=v[0];if(o||(tr(E,this.bottomLeft_)&&(L=this.minLon_,O=this.minLat_),tr(E,this.bottomRight_)&&(A=this.maxLon_,O=this.minLat_),tr(E,this.topLeft_)&&(L=this.minLon_,S=this.maxLat_),tr(E,this.topRight_)&&(A=this.maxLon_,S=this.maxLat_),S=ve(S,d,this.maxLat_),A=ve(A,f,this.maxLon_),O=ve(O,this.minLat_,d),L=ve(L,this.minLon_,f)),f=Math.floor(f/s)*s,w=ve(f,this.minLon_,this.maxLon_),y=this.addMeridian_(w,O,S,i,e,0),m=0,o)for(;(w-=s)>=L&&m++<g;)y=this.addMeridian_(w,O,S,i,e,y);else for(;w!=this.minLon_&&m++<g;)w=Math.max(w-s,this.minLon_),y=this.addMeridian_(w,O,S,i,e,y);if(w=ve(f,this.minLon_,this.maxLon_),m=0,o)for(;(w+=s)<=A&&m++<g;)y=this.addMeridian_(w,O,S,i,e,y);else for(;w!=this.maxLon_&&m++<g;)w=Math.min(w+s,this.maxLon_),y=this.addMeridian_(w,O,S,i,e,y);for(this.meridians_.length=y,this.meridiansLabels_&&(this.meridiansLabels_.length=y),d=Math.floor(d/s)*s,x=ve(d,this.minLat_,this.maxLat_),y=this.addParallel_(x,L,A,i,e,0),m=0;x!=this.minLat_&&m++<g;)x=Math.max(x-s,this.minLat_),y=this.addParallel_(x,L,A,i,e,y);for(x=ve(d,this.minLat_,this.maxLat_),m=0;x!=this.maxLat_&&m++<g;)x=Math.min(x+s,this.maxLat_),y=this.addParallel_(x,L,A,i,e,y);this.parallels_.length=y,this.parallelsLabels_&&(this.parallelsLabels_.length=y)}getInterval_(e){const t=this.projectionCenterLonLat_[0],n=this.projectionCenterLonLat_[1];let i=-1;const s=Math.pow(this.targetSize_*e,2),o=[],a=[];for(let l=0,u=this.intervals_.length;l<u;++l){const h=ve(this.intervals_[l]/2,0,90),f=ve(n,-90+h,90-h);if(o[0]=t-h,o[1]=f-h,a[0]=t+h,a[1]=f+h,this.fromLonLatTransform_(o,o),this.fromLonLatTransform_(a,a),Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2)<=s)break;i=this.intervals_[l]}return i}getMeridian_(e,t,n,i,s){const o=sg(e,t,n,this.projection_,i);let a=this.meridians_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):(a=new dt(o,"XY"),this.meridians_[s]=a),a}getMeridianPoint_(e,t,n){const i=e.getFlatCoordinates();let s=1,o=i.length-1;i[s]>i[o]&&(s=o,o=1);const a=Math.max(t[1],i[s]),l=Math.min(t[3],i[o]),u=ve(t[1]+Math.abs(t[1]-t[3])*this.lonLabelPosition_,a,l),f=[i[s-1]+(i[o-1]-i[s-1])*(u-i[s])/(i[o]-i[s]),u],d=this.meridiansLabels_[n].geom;return d.setCoordinates(f),d}getMeridians(){return this.meridians_}getParallel_(e,t,n,i,s){const o=og(e,t,n,this.projection_,i);let a=this.parallels_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):a=new dt(o,"XY"),a}getParallelPoint_(e,t,n){const i=e.getFlatCoordinates();let s=0,o=i.length-2;i[s]>i[o]&&(s=o,o=0);const a=Math.max(t[0],i[s]),l=Math.min(t[2],i[o]),u=ve(t[0]+Math.abs(t[0]-t[2])*this.latLabelPosition_,a,l),h=i[s+1]+(i[o+1]-i[s+1])*(u-i[s])/(i[o]-i[s]),f=[u,h],d=this.parallelsLabels_[n].geom;return d.setCoordinates(f),d}getParallels(){return this.parallels_}updateProjectionInfo_(e){const t=_e("EPSG:4326"),n=e.getWorldExtent();this.maxLat_=n[3],this.maxLon_=n[2],this.minLat_=n[1],this.minLon_=n[0];const i=yn(e,t);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=i;else{const o=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(a,l,u){u=u||2;const h=i(a,l,u);for(let f=0,d=h.length;f<d;f+=u)h[f]<o&&(h[f]+=360);return h}}this.fromLonLatTransform_=yn(t,e);const s=Gr([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=s[0],this.maxX_=s[2],this.minY_=s[1],this.maxY_=s[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(It(e.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=e}}const cg=ug,Vn=34962,Xn=34963,hg=35040,Es=35044,Li=35048,fg=5121,dg=5123,pg=5125,fl=5126,$o=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function gg(r,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!nc},e);const t=$o.length;for(let n=0;n<t;++n)try{const i=r.getContext($o[n],e);if(i)return i}catch{}return null}const mg={STATIC_DRAW:Es,STREAM_DRAW:hg,DYNAMIC_DRAW:Li};class bn{constructor(e,t){this.array_=null,this.type_=e,pt(e===Vn||e===Xn,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=t!==void 0?t:mg.STATIC_DRAW}ofSize(e){return this.array_=new(si(this.type_))(e),this}fromArray(e){return this.array_=si(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(si(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function si(r){switch(r){case Vn:return Float32Array;case Xn:return Uint32Array;default:return Float32Array}}const sn={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},_g=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,yg=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class jo{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer(),this.depthBuffer_=t.createRenderbuffer();const n=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,e.vertexShader||_g),t.compileShader(n);const i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(i,e.fragmentShader||yg),t.compileShader(i),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,n),t.attachShader(this.renderTargetProgram_,i),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(o=>{this.uniforms_.push({value:e.uniforms[o],location:t.getUniformLocation(this.renderTargetProgram_,o)})})}getGL(){return this.gl_}init(e){const t=this.getGL(),n=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.getDepthBuffer()),t.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;const i=0,s=t.RGBA,o=0,a=t.RGBA,l=t.UNSIGNED_BYTE,u=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,i,s,n[0],n[1],o,a,l,u),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,n[0],n[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer_)}}apply(e,t,n,i){const s=this.getGL(),o=e.size;if(s.bindFramebuffer(s.FRAMEBUFFER,t?t.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!t){const l=Pe(s.canvas);if(!e.renderTargets[l]){const u=s.getContextAttributes();u&&u.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),e.renderTargets[l]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const a=e.layerStatesArray[e.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(e),n&&n(s,e),s.drawArrays(s.TRIANGLES,0,6),i&&i(s,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const t=this.getGL();let n,i=1;this.uniforms_.forEach(function(s){if(n=typeof s.value=="function"?s.value(e):s.value,n instanceof HTMLCanvasElement||n instanceof ImageData)s.texture||(s.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${i}`]),t.bindTexture(t.TEXTURE_2D,s.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,n.width,n.height,0,t.UNSIGNED_BYTE,new Uint8Array(n.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.uniform1i(s.location,i++);else if(Array.isArray(n))switch(n.length){case 2:t.uniform2f(s.location,n[0],n[1]);return;case 3:t.uniform3f(s.location,n[0],n[1],n[2]);return;case 4:t.uniform4f(s.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&t.uniform1f(s.location,n)})}}function dl(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function pl(r,e){return r[0]=e[0],r[1]=e[1],r[4]=e[2],r[5]=e[3],r[12]=e[4],r[13]=e[5],r}const _t={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},ut={UNSIGNED_BYTE:fg,UNSIGNED_SHORT:dg,UNSIGNED_INT:pg,FLOAT:fl},Pn={};function Zo(r){return"shared/"+r}let Vo=0;function xg(){const r="unique/"+Vo;return Vo+=1,r}function Eg(r){let e=Pn[r];if(!e){const t=document.createElement("canvas");t.width=1,t.height=1,t.style.position="absolute",t.style.left="0",e={users:0,context:gg(t)},Pn[r]=e}return e.users+=1,e.context}function wg(r){const e=Pn[r];if(!e||(e.users-=1,e.users>0))return;const t=e.context,n=t.getExtension("WEBGL_lose_context");n&&n.loseContext();const i=t.canvas;i.width=1,i.height=1,delete Pn[r]}class Tg extends Pa{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?Zo(e.canvasCacheKey):xg(),this.gl_=Eg(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const t=this.gl_.canvas;t.addEventListener(sn.LOST,this.boundHandleWebGLContextLost_),t.addEventListener(sn.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=nt(),this.offsetScaleMatrix_=nt(),this.tmpMat4_=dl(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(n=>new jo({webGlContext:this.gl_,scaleRatio:n.scaleRatio,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms})):[new jo({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===Zo(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}bindBuffer(e){const t=this.gl_,n=Pe(e);let i=this.bufferCache_[n];if(!i){const s=t.createBuffer();i={buffer:e,webGlBuffer:s},this.bufferCache_[n]=i}t.bindBuffer(e.getType(),i.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=this.gl_,n=Pe(e),i=this.bufferCache_[n];i&&!t.isContextLost()&&t.deleteBuffer(i.webGlBuffer),delete this.bufferCache_[n]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(sn.LOST,this.boundHandleWebGLContextLost_),e.removeEventListener(sn.RESTORED,this.boundHandleWebGLContextRestored_),wg(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,t,n){const i=this.gl_,s=this.getCanvas(),o=e.size,a=e.pixelRatio;(s.width!==o[0]*a||s.height!==o[1]*a)&&(s.width=o[0]*a,s.height=o[1]*a,s.style.width=o[0]+"px",s.style.height=o[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(e);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.depthRange(0,1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,t?i.ZERO:i.ONE_MINUS_SRC_ALPHA),n?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST)}bindTexture(e,t,n){const i=this.gl_;i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,e),i.uniform1i(this.getUniformLocation(n),t)}prepareDrawToRenderTarget(e,t,n,i){const s=this.gl_,o=t.getSize();s.bindFramebuffer(s.FRAMEBUFFER,t.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,t.getDepthbuffer()),s.viewport(0,0,o[0],o[1]),s.bindTexture(s.TEXTURE_2D,t.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,n?s.ZERO:s.ONE_MINUS_SRC_ALPHA),i?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(e,t){const n=this.gl_;this.getExtension("OES_element_index_uint");const i=n.UNSIGNED_INT,s=4,o=t-e,a=e*s;n.drawElements(n.TRIANGLES,o,i,a)}finalizeDraw(e,t,n){for(let i=0,s=this.postProcessPasses_.length;i<s;i++)i===s-1?this.postProcessPasses_[i].apply(e,null,t,n):this.postProcessPasses_[i].apply(e,this.postProcessPasses_[i+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const t=e.size,n=e.viewState.rotation,i=e.pixelRatio;this.setUniformFloatValue(_t.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(_t.ZOOM,e.viewState.zoom),this.setUniformFloatValue(_t.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(_t.PIXEL_RATIO,i),this.setUniformFloatVec2(_t.VIEWPORT_SIZE_PX,[t[0],t[1]]),this.setUniformFloatValue(_t.ROTATION,n)}applyHitDetectionUniform(e){const t=this.getUniformLocation(_t.HIT_DETECTION);this.getGL().uniform1i(t,e?1:0),e&&this.setUniformFloatValue(_t.PIXEL_RATIO,.5)}applyUniforms(e){const t=this.gl_;let n,i=0;this.uniforms_.forEach(s=>{if(n=typeof s.value=="function"?s.value(e):s.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData||n instanceof WebGLTexture){n instanceof WebGLTexture&&!s.texture?(s.prevValue=void 0,s.texture=n):s.texture||(s.prevValue=void 0,s.texture=t.createTexture()),this.bindTexture(s.texture,i,s.name),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const o=!(n instanceof HTMLImageElement)||n.complete;!(n instanceof WebGLTexture)&&o&&s.prevValue!==n&&(s.prevValue=n,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),i++}else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(s.name,pl(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:t.uniform2f(this.getUniformLocation(s.name),n[0],n[1]);return;case 3:t.uniform3f(this.getUniformLocation(s.name),n[0],n[1],n[2]);return;case 4:t.uniform4f(this.getUniformLocation(s.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&t.uniform1f(this.getUniformLocation(s.name),n)})}useProgram(e,t){this.gl_.useProgram(e),this.currentProgram_=e,this.applyFrameState(t),this.applyUniforms(t)}compileShader(e,t){const n=this.gl_,i=n.createShader(t);return n.shaderSource(i,e),n.compileShader(i),i}getProgram(e,t){const n=this.gl_,i=this.compileShader(e,n.FRAGMENT_SHADER),s=this.compileShader(t,n.VERTEX_SHADER),o=n.createProgram();if(n.attachShader(o,i),n.attachShader(o,s),n.linkProgram(o),!n.getShaderParameter(i,n.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${n.getShaderInfoLog(i)}`;throw new Error(a)}if(n.deleteShader(i),!n.getShaderParameter(s,n.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${n.getShaderInfoLog(s)}`;throw new Error(a)}if(n.deleteShader(s),!n.getProgramParameter(o,n.LINK_STATUS)){const a=`GL program linking failed: ${n.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(e){const t=Pe(this.currentProgram_);return this.uniformLocationsByProgram_[t]===void 0&&(this.uniformLocationsByProgram_[t]={}),this.uniformLocationsByProgram_[t][e]===void 0&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=Pe(this.currentProgram_);return this.attribLocationsByProgram_[t]===void 0&&(this.attribLocationsByProgram_[t]={}),this.attribLocationsByProgram_[t][e]===void 0&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const n=e.size,i=e.viewState.rotation,s=e.viewState.resolution,o=e.viewState.center;return Yi(t,0,0,2/(s*n[0]),2/(s*n[1]),-i,-o[0],-o[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}enableAttributeArray_(e,t,n,i,s){const o=this.getAttributeLocation(e);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,t,n,!1,i,s))}enableAttributes(e){const t=vg(e);let n=0;for(let i=0;i<e.length;i++){const s=e[i];this.enableAttributeArray_(s.name,s.size,s.type||fl,t,n),n+=s.size*gl(s.type)}}handleWebGLContextLost(e){ic(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,t,n){const i=this.gl_;n=n||i.createTexture();const s=0,o=i.RGBA,a=0,l=i.RGBA,u=i.UNSIGNED_BYTE;return i.bindTexture(i.TEXTURE_2D,n),t?i.texImage2D(i.TEXTURE_2D,s,o,l,u,t):i.texImage2D(i.TEXTURE_2D,s,o,e[0],e[1],a,l,u,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),n}}function vg(r){let e=0;for(let t=0;t<r.length;t++){const n=r[t];e+=n.size*gl(n.type)}return e}function gl(r){switch(r){case ut.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case ut.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case ut.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case ut.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class Hn extends sc{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=nt(),this.pixelContext_=null,this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,e.addChangeListener(Aa.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(Ut.PRECOMPOSE)){const i=new ti(Ut.PRECOMPOSE,void 0,t,e);n.dispatchEvent(i)}}dispatchPostComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(Ut.POSTCOMPOSE)){const i=new ti(Ut.POSTCOMPOSE,void 0,t,e);n.dispatchEvent(i)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t=!0,n=-1,i;for(let o=0,a=e.layerStatesArray.length;o<a;o++){const l=e.layerStatesArray[o].layer,u=l.getRenderer();if(!(u instanceof Hn)){t=!0;continue}const h=l.getClassName();if((t||h!==i)&&(n+=1,t=!1),i=h,u===this)break}const s="map/"+e.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new Tg({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),i&&(this.helper.getCanvas().className=i),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(e,t,n){const i=this.getLayer();if(i.hasListener(e)){Yi(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);const s=new ti(e,this.inversePixelTransform_,n,t);i.dispatchEvent(s)}}preRender(e,t){this.dispatchRenderEvent_(Ut.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(Ut.POSTRENDER,e,t)}}const st=new Uint8Array(4);class Sg{constructor(e,t){this.helper_=e;const n=e.getGL();this.texture_=n.createTexture(),this.framebuffer_=n.createFramebuffer(),this.depthbuffer_=n.createRenderbuffer(),this.size_=t||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(e){oc(e,this.size_)||(this.size_[0]=e[0],this.size_[1]=e[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const e=this.size_,t=this.helper_.getGL();t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.readPixels(0,0,e[0],e[1],t.RGBA,t.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(e,t){if(e<0||t<0||e>this.size_[0]||t>=this.size_[1])return st[0]=0,st[1]=0,st[2]=0,st[3]=0,st;this.readAll();const n=Math.floor(e)+(this.size_[1]-Math.floor(t)-1)*this.size_[0];return st[0]=this.data_[n*4],st[1]=this.data_[n*4+1],st[2]=this.data_[n*4+2],st[3]=this.data_[n*4+3],st}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const e=this.size_,t=this.helper_.getGL();this.texture_=this.helper_.createTexture(e,null,this.texture_),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.viewport(0,0,e[0],e[1]),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture_,0),t.bindRenderbuffer(t.RENDERBUFFER,this.depthbuffer_),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e[0],e[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(e[0]*e[1]*4)}}const Xo={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};var ml={exports:{}};ml.exports=Wn;ml.exports.default=Wn;function Wn(r,e,t){t=t||2;var n=e&&e.length,i=n?e[0]*t:r.length,s=_l(r,0,i,t,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,u,h,f,d,g;if(n&&(s=Ig(r,e,s,t)),r.length>80*t){a=u=r[0],l=h=r[1];for(var m=t;m<i;m+=t)f=r[m],d=r[m+1],f<a&&(a=f),d<l&&(l=d),f>u&&(u=f),d>h&&(h=d);g=Math.max(u-a,h-l),g=g!==0?32767/g:0}return zr(s,o,t,a,l,g,0),o}function _l(r,e,t,n,i){var s,o;if(i===Mi(r,e,t,n)>0)for(s=e;s<t;s+=n)o=Ho(s,r[s],r[s+1],o);else for(s=t-n;s>=e;s-=n)o=Ho(s,r[s],r[s+1],o);return o&&Yn(o,o.next)&&($r(o),o=o.next),o}function Zt(r,e){if(!r)return r;e||(e=r);var t=r,n;do if(n=!1,!t.steiner&&(Yn(t,t.next)||Se(t.prev,t,t.next)===0)){if($r(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function zr(r,e,t,n,i,s,o){if(r){!o&&s&&Fg(r,n,i,s);for(var a=r,l,u;r.prev!==r.next;){if(l=r.prev,u=r.next,s?bg(r,n,i,s):Rg(r)){e.push(l.i/t|0),e.push(r.i/t|0),e.push(u.i/t|0),$r(r),r=u.next,a=u.next;continue}if(r=u,r===a){o?o===1?(r=Pg(Zt(r),e,t),zr(r,e,t,n,i,s,2)):o===2&&Ag(r,e,t,n,i,s):zr(Zt(r),e,t,n,i,s,1);break}}}}function Rg(r){var e=r.prev,t=r,n=r.next;if(Se(e,t,n)>=0)return!1;for(var i=e.x,s=t.x,o=n.x,a=e.y,l=t.y,u=n.y,h=i<s?i<o?i:o:s<o?s:o,f=a<l?a<u?a:u:l<u?l:u,d=i>s?i>o?i:o:s>o?s:o,g=a>l?a>u?a:u:l>u?l:u,m=n.next;m!==e;){if(m.x>=h&&m.x<=d&&m.y>=f&&m.y<=g&&rr(i,a,s,l,o,u,m.x,m.y)&&Se(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function bg(r,e,t,n){var i=r.prev,s=r,o=r.next;if(Se(i,s,o)>=0)return!1;for(var a=i.x,l=s.x,u=o.x,h=i.y,f=s.y,d=o.y,g=a<l?a<u?a:u:l<u?l:u,m=h<f?h<d?h:d:f<d?f:d,y=a>l?a>u?a:u:l>u?l:u,x=h>f?h>d?h:d:f>d?f:d,w=Ci(g,m,e,t,n),E=Ci(y,x,e,t,n),v=r.prevZ,S=r.nextZ;v&&v.z>=w&&S&&S.z<=E;){if(v.x>=g&&v.x<=y&&v.y>=m&&v.y<=x&&v!==i&&v!==o&&rr(a,h,l,f,u,d,v.x,v.y)&&Se(v.prev,v,v.next)>=0||(v=v.prevZ,S.x>=g&&S.x<=y&&S.y>=m&&S.y<=x&&S!==i&&S!==o&&rr(a,h,l,f,u,d,S.x,S.y)&&Se(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;v&&v.z>=w;){if(v.x>=g&&v.x<=y&&v.y>=m&&v.y<=x&&v!==i&&v!==o&&rr(a,h,l,f,u,d,v.x,v.y)&&Se(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;S&&S.z<=E;){if(S.x>=g&&S.x<=y&&S.y>=m&&S.y<=x&&S!==i&&S!==o&&rr(a,h,l,f,u,d,S.x,S.y)&&Se(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function Pg(r,e,t){var n=r;do{var i=n.prev,s=n.next.next;!Yn(i,s)&&yl(i,n,n.next,s)&&kr(i,s)&&kr(s,i)&&(e.push(i.i/t|0),e.push(n.i/t|0),e.push(s.i/t|0),$r(n),$r(n.next),n=r=s),n=n.next}while(n!==r);return Zt(n)}function Ag(r,e,t,n,i,s){var o=r;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&Gg(o,a)){var l=xl(o,a);o=Zt(o,o.next),l=Zt(l,l.next),zr(o,e,t,n,i,s,0),zr(l,e,t,n,i,s,0);return}a=a.next}o=o.next}while(o!==r)}function Ig(r,e,t,n){var i=[],s,o,a,l,u;for(s=0,o=e.length;s<o;s++)a=e[s]*n,l=s<o-1?e[s+1]*n:r.length,u=_l(r,a,l,n,!1),u===u.next&&(u.steiner=!0),i.push(Dg(u));for(i.sort(Lg),s=0;s<i.length;s++)t=Cg(i[s],t);return t}function Lg(r,e){return r.x-e.x}function Cg(r,e){var t=Og(r,e);if(!t)return e;var n=xl(t,r);return Zt(n,n.next),Zt(t,t.next)}function Og(r,e){var t=e,n=r.x,i=r.y,s=-1/0,o;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){var a=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(a<=n&&a>s&&(s=a,o=t.x<t.next.x?t:t.next,a===n))return o}t=t.next}while(t!==e);if(!o)return null;var l=o,u=o.x,h=o.y,f=1/0,d;t=o;do n>=t.x&&t.x>=u&&n!==t.x&&rr(i<h?n:s,i,u,h,i<h?s:n,i,t.x,t.y)&&(d=Math.abs(i-t.y)/(n-t.x),kr(t,r)&&(d<f||d===f&&(t.x>o.x||t.x===o.x&&Mg(o,t)))&&(o=t,f=d)),t=t.next;while(t!==l);return o}function Mg(r,e){return Se(r.prev,r,e.prev)<0&&Se(e.next,r,r.next)<0}function Fg(r,e,t,n){var i=r;do i.z===0&&(i.z=Ci(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==r);i.prevZ.nextZ=null,i.prevZ=null,Ng(i)}function Ng(r){var e,t,n,i,s,o,a,l,u=1;do{for(t=r,r=null,s=null,o=0;t;){for(o++,n=t,a=0,e=0;e<u&&(a++,n=n.nextZ,!!n);e++);for(l=u;a>0||l>0&&n;)a!==0&&(l===0||!n||t.z<=n.z)?(i=t,t=t.nextZ,a--):(i=n,n=n.nextZ,l--),s?s.nextZ=i:r=i,i.prevZ=s,s=i;t=n}s.nextZ=null,u*=2}while(o>1);return r}function Ci(r,e,t,n,i){return r=(r-t)*i|0,e=(e-n)*i|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function Dg(r){var e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function rr(r,e,t,n,i,s,o,a){return(i-o)*(e-a)>=(r-o)*(s-a)&&(r-o)*(n-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(i-o)*(n-a)}function Gg(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!Ug(r,e)&&(kr(r,e)&&kr(e,r)&&Bg(r,e)&&(Se(r.prev,r,e.prev)||Se(r,e.prev,e))||Yn(r,e)&&Se(r.prev,r,r.next)>0&&Se(e.prev,e,e.next)>0)}function Se(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function Yn(r,e){return r.x===e.x&&r.y===e.y}function yl(r,e,t,n){var i=an(Se(r,e,t)),s=an(Se(r,e,n)),o=an(Se(t,n,r)),a=an(Se(t,n,e));return!!(i!==s&&o!==a||i===0&&on(r,t,e)||s===0&&on(r,n,e)||o===0&&on(t,r,n)||a===0&&on(t,e,n))}function on(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function an(r){return r>0?1:r<0?-1:0}function Ug(r,e){var t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&yl(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1}function kr(r,e){return Se(r.prev,r,r.next)<0?Se(r,e,r.next)>=0&&Se(r,r.prev,e)>=0:Se(r,e,r.prev)<0||Se(r,r.next,e)<0}function Bg(r,e){var t=r,n=!1,i=(r.x+e.x)/2,s=(r.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==r);return n}function xl(r,e){var t=new Oi(r.i,r.x,r.y),n=new Oi(e.i,e.x,e.y),i=r.next,s=e.prev;return r.next=e,e.prev=r,t.next=i,i.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n}function Ho(r,e,t,n){var i=new Oi(r,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function $r(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Oi(r,e,t){this.i=r,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Wn.deviation=function(r,e,t,n){var i=e&&e.length,s=i?e[0]*t:r.length,o=Math.abs(Mi(r,0,s,t));if(i)for(var a=0,l=e.length;a<l;a++){var u=e[a]*t,h=a<l-1?e[a+1]*t:r.length;o-=Math.abs(Mi(r,u,h,t))}var f=0;for(a=0;a<n.length;a+=3){var d=n[a]*t,g=n[a+1]*t,m=n[a+2]*t;f+=Math.abs((r[d]-r[m])*(r[g+1]-r[d+1])-(r[d]-r[g])*(r[m+1]-r[d+1]))}return o===0&&f===0?0:Math.abs((f-o)/o)};function Mi(r,e,t,n){for(var i=0,s=e,o=t-n;s<t;s+=n)i+=(r[o]-r[s])*(r[s+1]+r[o+1]),o=s;return i}Wn.flatten=function(r){for(var e=r[0][0].length,t={vertices:[],holes:[],dimensions:e},n=0,i=0;i<r.length;i++){for(var s=0;s<r[i].length;s++)for(var o=0;o<e;o++)t.vertices.push(r[i][s][o]);i>0&&(n+=r[i-1].length,t.holes.push(n))}return t};const Wo=.985;function zg(r,e){e=e||[];const t=256,n=t-1;return e[0]=Math.floor(r/t/t/t)/n,e[1]=Math.floor(r/t/t)%t/n,e[2]=Math.floor(r/t)%t/n,e[3]=r%t/n,e}function kg(r){let e=0;const t=256,n=t-1;return e+=Math.round(r[0]*t*t*t*n),e+=Math.round(r[1]*t*t*n),e+=Math.round(r[2]*t*n),e+=Math.round(r[3]*n),e}function $g(){const r='const e="GENERATE_POLYGON_BUFFERS",t="GENERATE_POINT_BUFFERS",n="GENERATE_LINE_STRING_BUFFERS";function r(e,t){const n=t[0],r=t[1];return t[0]=e[0]*n+e[2]*r+e[4],t[1]=e[1]*n+e[3]*r+e[5],t}function x(e,t){const n=(r=t)[0]*r[3]-r[1]*r[2];var r;!function(e,t){if(!e)throw new Error(t)}(0!==n,"Transformation matrix cannot be inverted");const x=t[0],i=t[1],u=t[2],o=t[3],f=t[4],s=t[5];return e[0]=o/n,e[1]=-i/n,e[2]=-u/n,e[3]=x/n,e[4]=(u*s-o*f)/n,e[5]=-(x*s-i*f)/n,e}function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}new Array(6);var u={exports:{}};function o(e,t,n){n=n||2;var r,x,i,u,o,s,l,v=t&&t.length,h=v?t[0]*n:e.length,c=f(e,0,h,n,!0),g=[];if(!c||c.next===c.prev)return g;if(v&&(c=function(e,t,n,r){var x,i,u,o=[];for(x=0,i=t.length;x<i;x++)(u=f(e,t[x]*r,x<i-1?t[x+1]*r:e.length,r,!1))===u.next&&(u.steiner=!0),o.push(d(u));for(o.sort(p),x=0;x<o.length;x++)n=y(o[x],n);return n}(e,t,c,n)),e.length>80*n){r=i=e[0],x=u=e[1];for(var b=n;b<h;b+=n)(o=e[b])<r&&(r=o),(s=e[b+1])<x&&(x=s),o>i&&(i=o),s>u&&(u=s);l=0!==(l=Math.max(i-r,u-x))?32767/l:0}return a(c,g,n,r,x,l,0),g}function f(e,t,n,r,x){var i,u;if(x===O(e,t,n,r)>0)for(i=t;i<n;i+=r)u=P(i,e[i],e[i+1],u);else for(i=n-r;i>=t;i-=r)u=P(i,e[i],e[i+1],u);return u&&m(u,u.next)&&(B(u),u=u.next),u}function s(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==w(r.prev,r,r.next))r=r.next;else{if(B(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function a(e,t,n,r,x,i,u){if(e){!u&&i&&function(e,t,n,r){var x=e;do{0===x.z&&(x.z=b(x.x,x.y,t,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==e);x.prevZ.nextZ=null,x.prevZ=null,function(e){var t,n,r,x,i,u,o,f,s=1;do{for(n=e,e=null,i=null,u=0;n;){for(u++,r=n,o=0,t=0;t<s&&(o++,r=r.nextZ);t++);for(f=s;o>0||f>0&&r;)0!==o&&(0===f||!r||n.z<=r.z)?(x=n,n=n.nextZ,o--):(x=r,r=r.nextZ,f--),i?i.nextZ=x:e=x,x.prevZ=i,i=x;n=r}i.nextZ=null,s*=2}while(u>1)}(x)}(e,r,x,i);for(var o,f,p=e;e.prev!==e.next;)if(o=e.prev,f=e.next,i?v(e,r,x,i):l(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(f.i/n|0),B(e),e=f.next,p=f.next;else if((e=f)===p){u?1===u?a(e=h(s(e),t,n),t,n,r,x,i,2):2===u&&c(e,t,n,r,x,i):a(s(e),t,n,r,x,i,1);break}}}function l(e){var t=e.prev,n=e,r=e.next;if(w(t,n,r)>=0)return!1;for(var x=t.x,i=n.x,u=r.x,o=t.y,f=n.y,s=r.y,a=x<i?x<u?x:u:i<u?i:u,l=o<f?o<s?o:s:f<s?f:s,v=x>i?x>u?x:u:i>u?i:u,h=o>f?o>s?o:s:f>s?f:s,c=r.next;c!==t;){if(c.x>=a&&c.x<=v&&c.y>=l&&c.y<=h&&M(x,o,i,f,u,s,c.x,c.y)&&w(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function v(e,t,n,r){var x=e.prev,i=e,u=e.next;if(w(x,i,u)>=0)return!1;for(var o=x.x,f=i.x,s=u.x,a=x.y,l=i.y,v=u.y,h=o<f?o<s?o:s:f<s?f:s,c=a<l?a<v?a:v:l<v?l:v,p=o>f?o>s?o:s:f>s?f:s,y=a>l?a>v?a:v:l>v?l:v,g=b(h,c,t,n,r),d=b(p,y,t,n,r),Z=e.prevZ,m=e.nextZ;Z&&Z.z>=g&&m&&m.z<=d;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;if(Z=Z.prevZ,m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;Z&&Z.z>=g;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;m&&m.z<=d;){if(m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function h(e,t,n){var r=e;do{var x=r.prev,i=r.next.next;!m(x,i)&&A(x,r,r.next,i)&&z(x,i)&&z(i,x)&&(t.push(x.i/n|0),t.push(r.i/n|0),t.push(i.i/n|0),B(r),B(r.next),r=e=i),r=r.next}while(r!==e);return s(r)}function c(e,t,n,r,x,i){var u=e;do{for(var o=u.next.next;o!==u.prev;){if(u.i!==o.i&&Z(u,o)){var f=F(u,o);return u=s(u,u.next),f=s(f,f.next),a(u,t,n,r,x,i,0),void a(f,t,n,r,x,i,0)}o=o.next}u=u.next}while(u!==e)}function p(e,t){return e.x-t.x}function y(e,t){var n=function(e,t){var n,r=t,x=e.x,i=e.y,u=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var o=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=x&&o>u&&(u=o,n=r.x<r.next.x?r:r.next,o===x))return n}r=r.next}while(r!==t);if(!n)return null;var f,s=n,a=n.x,l=n.y,v=1/0;r=n;do{x>=r.x&&r.x>=a&&x!==r.x&&M(i<l?x:u,i,a,l,i<l?u:x,i,r.x,r.y)&&(f=Math.abs(i-r.y)/(x-r.x),z(r,e)&&(f<v||f===v&&(r.x>n.x||r.x===n.x&&g(n,r)))&&(n=r,v=f)),r=r.next}while(r!==s);return n}(e,t);if(!n)return t;var r=F(n,e);return s(r,r.next),s(n,n.next)}function g(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function b(e,t,n,r,x){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function d(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function M(e,t,n,r,x,i,u,o){return(x-u)*(t-o)>=(e-u)*(i-o)&&(e-u)*(r-o)>=(n-u)*(t-o)&&(n-u)*(i-o)>=(x-u)*(r-o)}function Z(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&A(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(z(e,t)&&z(t,e)&&function(e,t){var n=e,r=!1,x=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!=n.next.y>i&&n.next.y!==n.y&&x<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||m(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function A(e,t,n,r){var x=I(w(e,t,n)),i=I(w(e,t,r)),u=I(w(n,r,e)),o=I(w(n,r,t));return x!==i&&u!==o||(!(0!==x||!E(e,n,t))||(!(0!==i||!E(e,r,t))||(!(0!==u||!E(n,e,r))||!(0!==o||!E(n,t,r)))))}function E(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function I(e){return e>0?1:e<0?-1:0}function z(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function F(e,t){var n=new _(e.i,e.x,e.y),r=new _(t.i,t.x,t.y),x=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=x,x.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function P(e,t,n,r){var x=new _(e,t,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function B(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function _(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(e,t,n,r){for(var x=0,i=t,u=n-r;i<n;i+=r)x+=(e[u]-e[i])*(e[i+1]+e[u+1]),u=i;return x}u.exports=o,u.exports.default=o,o.deviation=function(e,t,n,r){var x=t&&t.length,i=x?t[0]*n:e.length,u=Math.abs(O(e,0,i,n));if(x)for(var o=0,f=t.length;o<f;o++){var s=t[o]*n,a=o<f-1?t[o+1]*n:e.length;u-=Math.abs(O(e,s,a,n))}var l=0;for(o=0;o<r.length;o+=3){var v=r[o]*n,h=r[o+1]*n,c=r[o+2]*n;l+=Math.abs((e[v]-e[c])*(e[h+1]-e[v+1])-(e[v]-e[h])*(e[c+1]-e[v+1]))}return 0===u&&0===l?0:Math.abs((l-u)/u)},o.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,x=0;x<e.length;x++){for(var i=0;i<e[x].length;i++)for(var u=0;u<t;u++)n.vertices.push(e[x][i][u]);x>0&&(r+=e[x-1].length,n.holes.push(r))}return n};var N=i(u.exports);const R=[],S={vertexPosition:0,indexPosition:0};function T(e,t,n,r,x){e[t+0]=n,e[t+1]=r,e[t+2]=x}function U(e,t,n,r,x,i){const u=3+x,o=e[t+0],f=e[t+1],s=R;s.length=x;for(let n=0;n<s.length;n++)s[n]=e[t+2+n];let a=i?i.vertexPosition:0,l=i?i.indexPosition:0;const v=a/u;return T(n,a,o,f,0),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,1),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,2),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,3),s.length&&n.set(s,a+3),a+=u,r[l++]=v,r[l++]=v+1,r[l++]=v+3,r[l++]=v+1,r[l++]=v+2,r[l++]=v+3,S.vertexPosition=a,S.indexPosition=l,S}function k(e,t,n,x,i,u,o,f,s,a,l){const v=8+f.length,h=u.length/v,c=[e[t+0],e[t+1]],p=[e[n],e[n+1]],y=r(s,[...c]),g=r(s,[...p]);function b(e,t,n){const r=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),x=[(t[0]-e[0])/r,(t[1]-e[1])/r],i=[-x[1],x[0]],u=Math.sqrt((n[0]-e[0])*(n[0]-e[0])+(n[1]-e[1])*(n[1]-e[1])),o=[(n[0]-e[0])/u,(n[1]-e[1])/u],f=0===r||0===u?0:Math.acos((s=o[0]*x[0]+o[1]*x[1],a=-1,l=1,Math.min(Math.max(s,a),l)));var s,a,l;return o[0]*i[0]+o[1]*i[1]>0?f:2*Math.PI-f}let d=-1,M=-1,Z=l;const w=null!==i;if(null!==x){d=b(y,g,r(s,[...[e[x],e[x+1]]])),Math.cos(d)<=.985&&(Z+=Math.tan((d-Math.PI)/2))}if(w){M=b(g,y,r(s,[...[e[i],e[i+1]]])),Math.cos(M)<=.985&&(Z+=Math.tan((Math.PI-M)/2))}function m(e,t){return 0===t?1e4*e:Math.sign(t)*(1e4*e+Math.abs(t))}return u.push(c[0],c[1],p[0],p[1],d,M,a,m(0,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(1,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(2,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(3,l)),u.push(...f),o.push(h,h+1,h+2,h+1,h+3,h+2),{length:a+Math.sqrt((g[0]-y[0])*(g[0]-y[0])+(g[1]-y[1])*(g[1]-y[1])),angle:Z}}function G(e,t,n,r,x){const i=2+x;let u=t;const o=e.slice(u,u+x);u+=x;const f=e[u++];let s=0;const a=new Array(f-1);for(let t=0;t<f;t++)s+=e[u++],t<f-1&&(a[t]=s);const l=e.slice(u,u+2*s),v=N(l,a,2);for(let e=0;e<v.length;e++)r.push(v[e]+n.length/i);for(let e=0;e<l.length;e+=2)n.push(l[e],l[e+1],...o);return u+2*s}const j=self;j.onmessage=r=>{const i=r.data;switch(i.type){case t:{const e=3,t=2,n=i.customAttributesSize,r=t+n,x=new Float32Array(i.renderInstructions),u=x.length/r,o=4*u*(n+e),f=new Uint32Array(6*u),s=new Float32Array(o);let a;for(let e=0;e<x.length;e+=r)a=U(x,e,s,f,n,a);const l=Object.assign({vertexBuffer:s.buffer,indexBuffer:f.buffer,renderInstructions:x.buffer},i);j.postMessage(l,[s.buffer,f.buffer,x.buffer]);break}case n:{const e=[],t=[],n=i.customAttributesSize,r=2,u=new Float32Array(i.renderInstructions);let o=0;const f=[1,0,0,1,0,0];let s,a;for(x(f,i.renderInstructionsTransform);o<u.length;){a=Array.from(u.slice(o,o+n)),o+=n,s=u[o++];const x=o,i=o+(s-1)*r,l=u[x]===u[i]&&u[x+1]===u[i+1];let v=0,h=0;for(let n=0;n<s-1;n++){let c=null;n>0?c=o+(n-1)*r:l&&(c=i-r);let p=null;n<s-2?p=o+(n+2)*r:l&&(p=x+r);const y=k(u,o+n*r,o+(n+1)*r,c,p,e,t,a,f,v,h);v=y.length,h=y.angle}o+=s*r}const l=Uint32Array.from(t),v=Float32Array.from(e),h=Object.assign({vertexBuffer:v.buffer,indexBuffer:l.buffer,renderInstructions:u.buffer},i);j.postMessage(h,[v.buffer,l.buffer,u.buffer]);break}case e:{const e=[],t=[],n=i.customAttributesSize,r=new Float32Array(i.renderInstructions);let x=0;for(;x<r.length;)x=G(r,x,e,t,n);const u=Uint32Array.from(t),o=Float32Array.from(e),f=Object.assign({vertexBuffer:o.buffer,indexBuffer:u.buffer,renderInstructions:r.buffer},i);j.postMessage(f,[o.buffer,u.buffer,r.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(r,"binary").toString("base64"):URL.createObjectURL(new Blob([r],{type:"application/javascript"})))}function jg(r,e){const t=r.viewState.projection,i=e.getSource().getWrapX()&&t.canWrapX(),s=t.getExtent(),o=r.extent,a=i?He(s):null,l=i?Math.ceil((o[2]-s[2])/a)+1:1;return[i?Math.floor((o[0]-s[0])/a):0,l,a]}class El extends Hn{constructor(e,t){const n=t.uniforms||{},i=nt();n[_t.PROJECTION_MATRIX]=i,super(e,{uniforms:n,postProcesses:t.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new bn(Vn,Li),this.indicesBuffer_=new bn(Xn,Li),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.program_,this.hitDetectionEnabled_=t.hitDetectionEnabled??!0;const s=t.attributes?t.attributes.map(function(a){return{name:"a_prop_"+a.name,size:1,type:ut.FLOAT}}):[];this.attributes=[{name:"a_position",size:2,type:ut.FLOAT},{name:"a_index",size:1,type:ut.FLOAT}],this.hitDetectionEnabled_&&(this.attributes.push({name:"a_prop_hitColor",size:4,type:ut.FLOAT}),this.attributes.push({name:"a_featureUid",size:1,type:ut.FLOAT})),this.attributes.push(...s),this.customAttributes=t.attributes?t.attributes:[],this.previousExtent_=qi(),this.currentTransform_=i,this.renderTransform_=nt(),this.invertRenderTransform_=nt(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=$g(),this.worker_.addEventListener("message",a=>{const l=a.data;if(l.type===Xo.GENERATE_POINT_BUFFERS){const u=l.projectionTransform;this.verticesBuffer_.fromArrayBuffer(l.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.fromArrayBuffer(l.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=u,ac(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(a.data.renderInstructions),l.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const o=this.getLayer().getSource();this.sourceListenKeys_=[Pr(o,en.ADDFEATURE,this.handleSourceFeatureAdded_,this),Pr(o,en.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),Pr(o,en.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),Pr(o,en.CLEAR,this.handleSourceFeatureClear_,this)],o.forEachFeature(a=>{this.featureCache_[Pe(a)]={feature:a,properties:a.getProperties(),geometry:a.getGeometry()},this.featureCount_++})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new Sg(this.helper))}handleSourceFeatureAdded_(e){const t=e.feature;this.featureCache_[Pe(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(e){const t=e.feature;this.featureCache_[Pe(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()}}handleSourceFeatureDelete_(e){const t=e.feature;delete this.featureCache_[Pe(t)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[n,i,s]=jg(e,this.getLayer());return this.renderWorlds(e,!1,n,i,s),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,n,i,s),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),this.helper.getCanvas()}prepareFrameInternal(e){const t=this.getLayer(),n=t.getSource(),i=e.viewState,s=!e.viewHints[lr.ANIMATING]&&!e.viewHints[lr.INTERACTING],o=!xn(this.previousExtent_,e.extent),a=this.sourceRevision_<n.getRevision();if(a&&(this.sourceRevision_=n.getRevision()),s&&(o||a)){const l=i.projection,u=i.resolution,h=t instanceof Ki?t.getRenderBuffer():0,f=Ia(e.extent,h*u);n.loadFeatures(f,u,l),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.useProgram(this.program_,e),this.helper.prepareDraw(e),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(e){const t=nt();this.helper.makeProjectionTransform(e,t);const i=(this.hitDetectionEnabled_?7:2)+this.customAttributes.length,s=i*this.featureCount_;(!this.renderInstructions_||this.renderInstructions_.length!==s)&&(this.renderInstructions_=new Float32Array(s));let o,a;const l=[],u=[];let h=-1;for(const d in this.featureCache_)if(o=this.featureCache_[d],a=o.geometry,!(!a||a.getType()!=="Point")){if(l[0]=a.getFlatCoordinates()[0],l[1]=a.getFlatCoordinates()[1],Ur(t,l),this.renderInstructions_[++h]=l[0],this.renderInstructions_[++h]=l[1],this.hitDetectionEnabled_){const g=zg(h+5,u);this.renderInstructions_[++h]=g[0],this.renderInstructions_[++h]=g[1],this.renderInstructions_[++h]=g[2],this.renderInstructions_[++h]=g[3],this.renderInstructions_[++h]=Number(d)}for(let g=0;g<this.customAttributes.length;g++){const m=this.customAttributes[g].callback(o.feature,o.properties);this.renderInstructions_[++h]=m}}const f={id:++this.lastSentId,type:Xo.GENERATE_POINT_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesSize:i-2};f.projectionTransform=t,this.ready=!1,this.worker_.postMessage(f,[this.renderInstructions_.buffer]),this.renderInstructions_=null}forEachFeatureAtCoordinate(e,t,n,i,s){if(pt(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const o=Ur(t.coordinateToPixelTransform,e.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],u=kg(l),h=this.renderInstructions_[u],f=Math.floor(h).toString(),g=this.getLayer().getSource().getFeatureByUid(f);if(g)return i(g,this.getLayer(),null)}renderWorlds(e,t,n,i,s){let o=n;this.helper.useProgram(this.program_,e),t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0)),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes);do{this.helper.makeProjectionTransform(e,this.currentTransform_),La(this.currentTransform_,o*s,0),ba(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e),this.helper.applyHitDetectionUniform(t);const a=this.indicesBuffer_.getSize();this.helper.drawElements(0,a)}while(++o<i)}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach(function(e){Si(e)}),this.sourceListenKeys_=null,super.disposeInternal()}renderDeclutter(){}}class Zg{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}}function An(r){return r instanceof Image||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageBitmap?r:null}function Fi(r){return r instanceof Uint8Array||r instanceof Uint8ClampedArray||r instanceof Float32Array||r instanceof DataView?r:null}let Xt=null;function Vg(r){Xt||(Xt=wt(r.width,r.height,void 0,{willReadFrequently:!0}));const e=Xt.canvas,t=r.width;e.width!==t&&(e.width=t);const n=r.height;return e.height!==n&&(e.height=n),Xt.clearRect(0,0,t,n),Xt.drawImage(r,0,0),Xt.getImageData(0,0,t,n).data}const Xg=[256,256];class ws extends Ca{constructor(e){const t=q.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null}getSize(){if(this.size_)return this.size_;const e=An(this.data_);return e?[e.width,e.height]:Xg}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==q.IDLE&&this.state!==q.ERROR)return;this.state=q.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=q.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=q.ERROR,e.changed()})}}class Ts extends ws{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:e.interpolate,transition:e.transition}),this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const t=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),n=this.targetTileGrid_.getExtent();let i=this.sourceTileGrid_.getExtent();const s=n?ht(t,n):t;if(ao(s)===0){this.state=q.EMPTY;return}const o=e.sourceProj,a=o.getExtent();a&&(i?i=ht(i,a):i=a);const l=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),u=e.targetProj,h=uc(o,u,s,l);if(!isFinite(h)||h<=0){this.state=q.EMPTY;return}const f=e.errorThreshold!==void 0?e.errorThreshold:cc;if(this.triangulation_=new hc(o,u,s,i,h*f,l),this.triangulation_.getTriangles().length===0){this.state=q.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(h);let d=this.triangulation_.calculateSourceExtent();if(i&&(o.canWrapX()?(d[1]=ve(d[1],i[1],i[3]),d[3]=ve(d[3],i[1],i[3])):d=ht(d,i)),!ao(d))this.state=q.EMPTY;else{const g=this.sourceTileGrid_.getTileRangeForExtentAndZ(d,this.sourceZ_),m=e.getTileFunction;for(let y=g.minX;y<=g.maxX;y++)for(let x=g.minY;x<=g.maxY;x++){const w=m(this.sourceZ_,y,x,this.pixelRatio_);w&&this.sourceTiles_.push(w)}this.sourceTiles_.length===0&&(this.state=q.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{if(!t||t.getState()!==q.LOADED)return;const n=t.getSize(),i=this.gutter_;let s;const o=Fi(t.getData());o?s=o:s=Vg(An(t.getData()));const a=[n[0]+2*i,n[1]+2*i],l=s instanceof Float32Array,u=a[0]*a[1],h=l?Float32Array:Uint8Array,f=new h(s.buffer),d=h.BYTES_PER_ELEMENT,g=d*f.length/u,m=f.byteLength/a[1],y=Math.floor(m/d/a[0]),x=u*y;let w=f;if(f.length!==x){w=new h(x);let E=0,v=0;const S=a[0]*y;for(let A=0;A<a[1];++A){for(let O=0;O<S;++O)w[E++]=f[v+O];v+=m/d}}e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),data:new Uint8Array(w.buffer),dataType:h,bytesPerPixel:g,pixelSize:a})}),this.sourceTiles_.length=0,e.length===0)this.state=q.ERROR;else{const t=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(t),i=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let u,h;const f=e[0].bytesPerPixel,d=Math.ceil(f/3);for(let g=d-1;g>=0;--g){const m=[];for(let S=0,A=e.length;S<A;++S){const O=e[S],L=O.data,F=O.pixelSize,U=F[0],k=F[1],V=wt(U,k,ri),ee=V.createImageData(U,k),c=ee.data;let p=g*3;for(let _=0,T=c.length;_<T;_+=4)c[_]=L[p],c[_+1]=L[p+1],c[_+2]=L[p+2],c[_+3]=255,p+=f;V.putImageData(ee,0,0),m.push({extent:O.extent,image:V.canvas})}const y=lc(i,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,m,this.gutter_,!1,!1,!1,!0);for(let S=0,A=m.length;S<A;++S){const L=m[S].image.getContext("2d");lo(L),ri.push(L.canvas)}const x=y.getContext("2d"),w=x.getImageData(0,0,y.width,y.height);lo(x),ri.push(y),u||(h=new Uint8Array(f*w.width*w.height),u=new e[0].dataType(h.buffer));const E=w.data;let v=g*3;for(let S=0,A=E.length;S<A;S+=4)E[S+3]===255?(h[v]=E[S],h[v+1]=E[S+1],h[v+2]=E[S+2]):(h[v]=0,h[v+1]=0,h[v+2]=0),v+=f}this.reprojData_=u,this.reprojSize_=[Math.round(i*this.pixelRatio_),Math.round(s*this.pixelRatio_)],this.state=q.LOADED}this.changed()}load(){if(this.state!==q.IDLE&&this.state!==q.ERROR)return;this.state=q.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const n=t.getState();if(n!==q.IDLE&&n!==q.LOADING)return;e++;const i=Pr(t,$e.CHANGE,function(){const s=t.getState();(s==q.LOADED||s==q.ERROR||s==q.EMPTY)&&(Si(i),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(i)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t){t.getState()==q.IDLE&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(Si),this.sourcesListenerKeys_=null}}class Hg extends fc{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=e.gutter||0,this.helper_=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener($e.CHANGE,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===q.LOADED,this.loaded)this.uploadTile();else{if(e instanceof Qi){const t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener($e.CHANGE,this.handleTileChange_)}}uploadTile(){yt()}setReady(){this.ready=!0,this.dispatchEvent($e.CHANGE)}handleTileChange_(){this.tile.getState()===q.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener($e.CHANGE,this.handleTileChange_)}}function wl(r,e,t){const n=t?r.LINEAR:r.NEAREST;r.bindTexture(r.TEXTURE_2D,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,n)}function Wg(r,e,t,n){wl(r,e,n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)}function Yo(r,e,t,n,i,s){const o=r.getGL();let a,l;t instanceof Float32Array?(a=o.FLOAT,r.getExtension("OES_texture_float"),l=r.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),wl(o,e,s&&l);const u=t.byteLength/n[1];let h=1;u%8===0?h=8:u%4===0?h=4:u%2===0&&(h=2);let f;switch(i){case 1:{f=o.LUMINANCE;break}case 2:{f=o.LUMINANCE_ALPHA;break}case 3:{f=o.RGB;break}case 4:{f=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${i}`)}const d=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,h),o.texImage2D(o.TEXTURE_2D,0,f,n[0],n[1],0,f,a,t),o.pixelStorei(o.UNPACK_ALIGNMENT,d)}let Qt=null;function Yg(){Qt=wt(1,1,void 0,{willReadFrequently:!0})}class qg extends Hg{constructor(e){super(e),this.textures=[],this.renderSize_=ft(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const t=new bn(Vn,Es);t.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(t),this.coords=t,this.setTile(e.tile)}uploadTile(){const e=this.helper_,t=e.getGL(),n=this.tile;this.textures.length=0;let i;n instanceof Qi||n instanceof Ji?i=n.getImage():i=n.getData();const s=An(i);if(s){const E=t.createTexture();this.textures.push(E),this.bandCount=4,Wg(t,E,s,n.interpolate),this.setReady();return}i=Fi(i);const o=n.getSize(),a=[o[0]+2*this.gutter_,o[1]+2*this.gutter_],l=i instanceof Float32Array,u=a[0]*a[1],h=l?Float32Array:Uint8Array,f=h.BYTES_PER_ELEMENT,d=i.byteLength/a[1];this.bandCount=Math.floor(d/f/a[0]);const g=Math.ceil(this.bandCount/4);if(g===1){const E=t.createTexture();this.textures.push(E),Yo(e,E,i,a,this.bandCount,n.interpolate),this.setReady();return}const m=new Array(g);for(let E=0;E<g;++E){const v=t.createTexture();this.textures.push(v);const S=E<g-1?4:(this.bandCount-1)%4+1;m[E]=new h(u*S)}let y=0,x=0;const w=a[0]*this.bandCount;for(let E=0;E<a[1];++E){for(let v=0;v<w;++v){const S=i[x+v],A=Math.floor(y/this.bandCount),O=v%this.bandCount,L=Math.floor(O/4),F=m[L],U=F.length/u,k=O%4;F[A*U+k]=S,++y}x+=d/f}for(let E=0;E<g;++E){const v=this.textures[E],S=m[E],A=S.length/u;Yo(e,v,S,a,A,n.interpolate)}this.setReady()}disposeInternal(){const e=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let t=0;t<this.textures.length;++t)e.deleteTexture(this.textures[t]);this.tile.removeEventListener($e.CHANGE,this.handleTileChange_)}getImagePixelData_(e,t,n){const i=this.gutter_,s=this.renderSize_[0],o=this.renderSize_[1];Qt||Yg(),Qt.clearRect(0,0,1,1);const a=e.width,l=e.height,u=a-2*i,h=l-2*i,f=i+Math.floor(u*(t/s)),d=i+Math.floor(h*(n/o));let g;try{Qt.drawImage(e,f,d,1,1,0,0,1,1),g=Qt.getImageData(0,0,1,1).data}catch{return Qt=null,null}return g}getArrayPixelData_(e,t,n,i){const s=this.gutter_,o=this.renderSize_[0],a=this.renderSize_[1],l=t[0],u=t[1],h=l+2*s,f=u+2*s,d=s+Math.floor(l*(n/o)),g=s+Math.floor(u*(i/a));if(e instanceof DataView){const y=e.byteLength/(h*f),x=y*(g*h+d),w=e.buffer.slice(x,x+y);return new DataView(w)}const m=this.bandCount*(g*h+d);return e.slice(m,m+this.bandCount)}getPixelData(e,t){if(!this.loaded)return null;if(this.tile instanceof ws){const n=this.tile.getData(),i=Fi(n);if(i){const s=this.tile.getSize();return this.getArrayPixelData_(i,s,e,t)}return this.getImagePixelData_(An(n),e,t)}return this.getImagePixelData_(this.tile.getImage(),e,t)}}const Kg={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},Qg={};function qo(r){return 1/(r+2)}function Jg(){return{tileIds:new Set,representationsByZ:{}}}function Ko(r,e){return r.tileIds.has(Pe(e))}function Qo(r,e,t){const n=r.representationsByZ;t in n||(n[t]=new Set),n[t].add(e),r.tileIds.add(Pe(e.tile))}function oi(r,e){const t=r.layerStatesArray[r.layerIndex];t.extent&&(e=ht(e,Ma(t.extent,r.viewState.projection)));const n=t.layer.getRenderSource();if(!n.getWrapX()){const i=n.getTileGridForProjection(r.viewState.projection).getExtent();i&&(e=ht(e,i))}return e}function Ni(r,e){return`${r.getKey()},${Kt(e)}`}class em extends Hn{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=nt(),this.tempMat4=dl(),this.tempTileRange_=new dc(0,0,0,0),this.tempTileCoord_=Ri(0,0,0),this.tempSize_=[0,0];const n=t.cacheSize!==void 0?t.cacheSize:512;this.tileRepresentationCache=new Oa(n),this.frameState=null,this.projection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}isDrawableTile_(e){const t=this.getLayer(),n=e.getState(),i=t.getUseInterimTilesOnError();return n==q.LOADED||n==q.EMPTY||n==q.ERROR&&!i}prepareFrameInternal(e){this.projection_?e.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=e.viewState.projection):this.projection_=e.viewState.projection;const n=this.getLayer().getRenderSource();return!n||Wi(oi(e,e.extent))?!1:n.getState()==="ready"}createTileRepresentation(e){return yt()}enqueueTiles(e,t,n,i,s){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),u=l.getTileGridForProjection(o.projection),h=l.getGutterForProjection(o.projection),f=Pe(l);f in e.wantedTiles||(e.wantedTiles[f]={});const d=e.wantedTiles[f],g=this.tileRepresentationCache,m=a.getMapInternal(),y=Math.max(n-s,u.getMinZoom(),u.getZForResolution(Math.min(a.getMaxResolution(),m?m.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):u.getResolution(0)),l.zDirection));for(let x=n;x>=y;--x){const w=u.getTileRangeForExtentAndZ(t,x,this.tempTileRange_),E=u.getResolution(x);for(let v=w.minX;v<=w.maxX;++v)for(let S=w.minY;S<=w.maxY;++S){const A=Ri(x,v,S,this.tempTileCoord_),O=Ni(l,A);let L,F;if(g.containsKey(O)&&(L=g.get(O),F=L.tile),(!L||L.tile.key!==l.getKey())&&(F=l.getTile(x,v,S,e.pixelRatio,o.projection)),Ko(i,F))continue;if(!L)L=this.createTileRepresentation({tile:F,grid:u,helper:this.helper,gutter:h}),g.set(O,L);else if(this.isDrawableTile_(F))L.setTile(F);else{const k=F.getInterimTile();L.setTile(k)}Qo(i,L,x);const U=F.getKey();d[U]=!0,F.getState()===q.IDLE&&(e.tileQueue.isKeyQueued(U)||e.tileQueue.enqueue([F,f,u.getTileCoordCenter(A),E]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t,!0)}beforeTilesMaskRender(e){return!1}renderTile(e,t,n,i,s,o,a,l,u,h,f){}renderTileMask(e,t,n,i){}drawTile_(e,t,n,i,s,o,a){if(!t.ready)return;const u=t.tile.tileCoord,h=Kt(u),f=h in o?o[h]:1,d=a.getResolution(n),g=ft(a.getTileSize(n),this.tempSize_),m=a.getOrigin(n),y=a.getTileCoordExtent(u),x=f<1?-1:qo(n);f<1&&(e.animate=!0);const w=e.viewState,E=w.center[0],v=w.center[1],S=g[0]+2*i,A=g[1]+2*i,O=S/A,L=(E-m[0])/(g[0]*d),F=(m[1]-v)/(g[1]*d),U=w.resolution/d,k=u[1],V=u[2];pc(this.tileTransform_),uo(this.tileTransform_,2/(e.size[0]*U/S),-2/(e.size[1]*U/S)),gc(this.tileTransform_,w.rotation),uo(this.tileTransform_,1,1/O),La(this.tileTransform_,(g[0]*(k-L)-i)/S,(g[1]*(V-F)-i)/A),this.renderTile(t,this.tileTransform_,e,s,d,g,m,y,x,i,f)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const t=this.helper.getGL();this.preRender(t,e);const n=e.viewState,i=this.getLayer(),s=i.getRenderSource(),o=s.getTileGridForProjection(n.projection),a=s.getGutterForProjection(n.projection),l=oi(e,e.extent),u=o.getZForResolution(n.resolution,s.zDirection),h=Jg(),f=i.getPreload();if(e.nextExtent){const O=o.getZForResolution(n.nextResolution,s.zDirection),L=oi(e,e.nextExtent);this.enqueueTiles(e,L,O,h,f)}this.enqueueTiles(e,l,u,h,0),f>0&&setTimeout(()=>{this.enqueueTiles(e,l,u-1,h,f-1)},0);const d={},g=Pe(this),m=e.time;let y=!1;for(const O of h.representationsByZ[u]){const L=O.tile;if((L instanceof Ji||L instanceof Ts)&&L.getState()===q.EMPTY)continue;const F=L.tileCoord;if(O.ready){const V=L.getAlpha(g,m);if(V===1){L.endTransition(g);continue}y=!0;const ee=Kt(F);d[ee]=V}if(this.renderComplete=!1,this.findAltTiles_(o,F,u+1,h))continue;const k=o.getMinZoom();for(let V=u-1;V>=k&&!this.findAltTiles_(o,F,V,h);--V);}const x=h.representationsByZ,w=Object.keys(x).map(Number).sort(mc);if(this.beforeTilesMaskRender(e))for(let O=0,L=w.length;O<L;++O){const F=w[O];for(const U of x[F]){const k=U.tile.tileCoord;if(Kt(k)in d)continue;const ee=o.getTileCoordExtent(k);this.renderTileMask(U,F,ee,qo(F))}}this.beforeTilesRender(e,y);for(let O=0,L=w.length;O<L;++O){const F=w[O];for(const U of x[F]){const k=U.tile.tileCoord;Kt(k)in d||this.drawTile_(e,U,F,a,l,d,o)}}for(const O of x[u]){const L=O.tile.tileCoord;Kt(L)in d&&this.drawTile_(e,O,u,a,l,d,o)}this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const v=this.helper.getCanvas(),S=this.tileRepresentationCache;for(;S.canExpireCache();)S.pop().dispose();const A=function(O,L){s.updateCacheSize(.1,L.viewState.projection),s.expireCache(L.viewState.projection,Qg)};return e.postRenderFunctions.push(A),this.postRender(t,e),v}findAltTiles_(e,t,n,i){const s=e.getTileRangeForTileCoordAndZ(t,n,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let u=s.minX;u<=s.maxX;++u)for(let h=s.minY;h<=s.maxY;++h){const f=Ni(l,[n,u,h]);let d=!1;if(a.containsKey(f)){const g=a.get(f);g.ready&&!Ko(i,g.tile)&&(Qo(i,g,n),d=!0)}d||(o=!1)}return o}clearCache(){const e=this.tileRepresentationCache;e.forEach(t=>t.dispose()),e.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const Q={...Kg,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},cn={TEXTURE_COORD:"a_textureCoord"},tm=[{name:cn.TEXTURE_COORD,size:2,type:ut.FLOAT}];class rm extends em{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new bn(Xn,Es),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){super.reset(e),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(e){return new qg(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,n,i,s,o,a,l,u,h,f){const d=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(tm);let g=0;for(;g<e.textures.length;){const O=`${Q.TILE_TEXTURE_ARRAY}[${g}]`;this.helper.bindTexture(e.textures[g],g,O),++g}for(let O=0;O<this.paletteTextures_.length;++O){const L=this.paletteTextures_[O],F=L.getTexture(d);this.helper.bindTexture(F,g,L.name),++g}const m=n.viewState,y=o[0]+2*h,x=o[1]+2*h,E=e.tile.tileCoord,v=E[1],S=E[2];this.helper.setUniformMatrixValue(Q.TILE_TRANSFORM,pl(this.tempMat4,t)),this.helper.setUniformFloatValue(Q.TRANSITION_ALPHA,f),this.helper.setUniformFloatValue(Q.DEPTH,u);let A=i;h>0&&(A=l,ht(A,i,A)),this.helper.setUniformFloatVec4(Q.RENDER_EXTENT,A),this.helper.setUniformFloatValue(Q.RESOLUTION,m.resolution),this.helper.setUniformFloatValue(Q.ZOOM,m.zoom),this.helper.setUniformFloatValue(Q.TEXTURE_PIXEL_WIDTH,y),this.helper.setUniformFloatValue(Q.TEXTURE_PIXEL_HEIGHT,x),this.helper.setUniformFloatValue(Q.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(Q.TEXTURE_ORIGIN_X,a[0]+v*o[0]*s-h*s),this.helper.setUniformFloatValue(Q.TEXTURE_ORIGIN_Y,a[1]-S*o[1]*s+h*s),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;const n=this.frameState;if(!n)return null;const i=this.getLayer(),s=Ur(n.pixelToCoordinateTransform,e.slice()),o=n.viewState,a=i.getExtent();if(a&&!tr(Ma(a,o.projection),s))return null;const l=i.getSources(Xi([s]),o.resolution);let u,h,f;for(u=l.length-1;u>=0;--u)if(h=l[u],h.getState()==="ready"){if(f=h.getTileGridForProjection(o.projection),h.getWrapX())break;const g=f.getExtent();if(!g||tr(g,s))break}if(u<0)return null;const d=this.tileRepresentationCache;for(let g=f.getZForResolution(o.resolution);g>=f.getMinZoom();--g){const m=f.getTileCoordForCoordAndZ(s,g),y=Ni(h,m);if(!d.containsKey(y))continue;const x=d.get(y),w=x.tile;if((w instanceof Ji||w instanceof Ts)&&w.getState()===q.EMPTY)return null;if(!x.loaded)continue;const E=f.getOrigin(g),v=ft(f.getTileSize(g)),S=f.getResolution(g),A=(s[0]-E[0])/S-m[1]*v[0],O=(E[1]-s[1])/S-m[2]*v[1];return x.getPixelData(A,O)}return null}disposeInternal(){const e=this.helper;e&&(e.getGL().deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_}}function nm(r,e){return`operator_${r}_${Object.keys(e.functions).length}`}function kt(r){const e=r.toString();return e.includes(".")?e:e+".0"}function vs(r){if(r.length<2||r.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${r.length}(${r.map(kt).join(", ")})`}function hn(r){const e=Br(r),t=e.length>3?e[3]:1;return vs([e[0]/255*t,e[1]/255*t,e[2]/255*t,t])}const ai={};let im=0;function In(r){return r in ai||(ai[r]=im++),ai[r]}function xt(r){return kt(In(r))}function Ss(r){return"u_var_"+r}function sm(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{}}}const li="getBandValue",Tl="u_paletteTextures";function om(r,e,t,n){const i=_c(r,t,e);if(yc(i.type,wc))throw new Error("No matching type was found");if(!xc(e,i.type)){const s=bi(e),o=bi(i.type);throw new Error(`Expected expression to be of type ${s}, got ${o}`)}return Rs(i,e,n)}function fe(r){return(e,t,n)=>{const i=t.args.length,s=new Array(i);for(let o=0;o<i;++o)s[o]=Rs(t.args[o],n,e);return r(s,e)}}const am={[ie.Get]:(r,e)=>{const n=e.args[0].value;return n in r.properties||(r.properties[n]={name:n,type:e.type}),(r.inFragmentShader?"v_prop_":"a_prop_")+n},[ie.GeometryType]:(r,e,t)=>{const n="geometryType";return n in r.properties||(r.properties[n]={name:n,type:ur,evaluator:o=>Tc(o.getGeometry())}),(r.inFragmentShader?"v_prop_":"a_prop_")+n},[ie.Var]:(r,e)=>{const n=e.args[0].value;return n in r.variables||(r.variables[n]={name:n,type:e.type}),Ss(n)},[ie.Resolution]:()=>"u_resolution",[ie.Zoom]:()=>"u_zoom",[ie.Time]:()=>"u_time",[ie.Any]:fe(r=>`(${r.join(" || ")})`),[ie.All]:fe(r=>`(${r.join(" && ")})`),[ie.Not]:fe(([r])=>`(!${r})`),[ie.Equal]:fe(([r,e])=>`(${r} == ${e})`),[ie.NotEqual]:fe(([r,e])=>`(${r} != ${e})`),[ie.GreaterThan]:fe(([r,e])=>`(${r} > ${e})`),[ie.GreaterThanOrEqualTo]:fe(([r,e])=>`(${r} >= ${e})`),[ie.LessThan]:fe(([r,e])=>`(${r} < ${e})`),[ie.LessThanOrEqualTo]:fe(([r,e])=>`(${r} <= ${e})`),[ie.Multiply]:fe(r=>`(${r.join(" * ")})`),[ie.Divide]:fe(([r,e])=>`(${r} / ${e})`),[ie.Add]:fe(r=>`(${r.join(" + ")})`),[ie.Subtract]:fe(([r,e])=>`(${r} - ${e})`),[ie.Clamp]:fe(([r,e,t])=>`clamp(${r}, ${e}, ${t})`),[ie.Mod]:fe(([r,e])=>`mod(${r}, ${e})`),[ie.Pow]:fe(([r,e])=>`pow(${r}, ${e})`),[ie.Abs]:fe(([r])=>`abs(${r})`),[ie.Floor]:fe(([r])=>`floor(${r})`),[ie.Ceil]:fe(([r])=>`ceil(${r})`),[ie.Round]:fe(([r])=>`floor(${r} + 0.5)`),[ie.Sin]:fe(([r])=>`sin(${r})`),[ie.Cos]:fe(([r])=>`cos(${r})`),[ie.Atan]:fe(([r,e])=>e!==void 0?`atan(${r}, ${e})`:`atan(${r})`),[ie.Sqrt]:fe(([r])=>`sqrt(${r})`),[ie.Match]:fe(r=>{const e=r[0],t=r[r.length-1];let n=null;for(let i=r.length-3;i>=1;i-=2){const s=r[i],o=r[i+1];n=`(${e} == ${s} ? ${o} : ${n||t})`}return n}),[ie.Between]:fe(([r,e,t])=>`(${r} >= ${e} && ${r} <= ${t})`),[ie.Interpolate]:fe(([r,e,...t])=>{let n="";for(let i=0;i<t.length-2;i+=2){const s=t[i],o=n||t[i+1],a=t[i+2],l=t[i+3];let u;r===kt(1)?u=`(${e} - ${s}) / (${a} - ${s})`:u=`(pow(${r}, (${e} - ${s})) - 1.0) / (pow(${r}, (${a} - ${s})) - 1.0)`,n=`mix(${o}, ${l}, clamp(${u}, 0.0, 1.0))`}return n}),[ie.Case]:fe(r=>{const e=r[r.length-1];let t=null;for(let n=r.length-3;n>=0;n-=2){const i=r[n],s=r[n+1];t=`(${i} ? ${s} : ${t||e})`}return t}),[ie.In]:fe(([r,...e],t)=>{const n=nm("in",t),i=[];for(let s=0;s<e.length;s+=1)i.push(`  if (inputValue == ${e[s]}) { return true; }`);return t.functions[n]=`bool ${n}(float inputValue) {
${i.join(`
`)}
  return false;
}`,`${n}(${r})`}),[ie.Array]:fe(r=>`vec${r.length}(${r.join(", ")})`),[ie.Color]:fe(r=>{if(r.length===1)return`vec4(vec3(${r[0]} / 255.0), 1.0)`;if(r.length===2)return`(${r[1]} * vec4(vec3(${r[0]} / 255.0), 1.0))`;const e=r.slice(0,3).map(n=>`${n} / 255.0`);return r.length===3?`vec4(${e.join(", ")}, 1.0)`:`(${r[3]} * vec4(${e.join(", ")}, 1.0))`}),[ie.Band]:fe(([r,e,t],n)=>{if(!(li in n.functions)){let i="";const s=n.bandCount||1;for(let o=0;o<s;o++){const a=Math.floor(o/4);let l=o%4;o===s-1&&l===1&&(l=3);const u=`${Q.TILE_TEXTURE_ARRAY}[${a}]`;i+=`  if (band == ${o+1}.0) {
    return texture2D(${u}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}n.functions[li]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${Q.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${Q.TEXTURE_PIXEL_HEIGHT};
${i}
}`}return`${li}(${r}, ${e??"0.0"}, ${t??"0.0"})`}),[ie.Palette]:(r,e)=>{const[t,...n]=e.args,i=n.length,s=new Uint8Array(i*4);for(let u=0;u<n.length;u++){const h=n[u].value,f=Br(h),d=u*4;s[d]=f[0],s[d+1]=f[1],s[d+2]=f[2],s[d+3]=f[3]*255}r.paletteTextures||(r.paletteTextures=[]);const o=`${Tl}[${r.paletteTextures.length}]`,a=new Zg(o,s);r.paletteTextures.push(a);const l=Rs(t,he,r);return`texture2D(${o}, vec2((${l} + 0.5) / ${i}.0, 0.5))`}};function Rs(r,e,t){if(r instanceof Ec){const n=am[r.operator];if(n===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(r.operator)}`);return n(t,r,e)}if((r.type&he)>0)return kt(r.value);if((r.type&un)>0)return r.value.toString();if((r.type&ur)>0)return xt(r.value.toString());if((r.type&We)>0)return hn(r.value);if((r.type&Ke)>0)return vs(r.value);throw new Error(`Unexpected expression ${r.value} (expected type ${bi(e)})`)}function lm(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}const Ht=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;

// this used to produce an alpha-premultiplied color from a texture
vec4 samplePremultiplied(sampler2D sampler, vec2 texCoord) {
  vec4 color = texture2D(sampler, texCoord);
  return vec4(color.rgb * color.a, color.a);
}
`,Wt=lm();class vl{constructor(){this.uniforms_=[],this.attributes_=[],this.varyings_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${kt(Wt["circle-radius"])} + ${kt(Wt["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=hn(Wt["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=kt(Wt["stroke-width"]),this.strokeColorExpression_=hn(Wt["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=xt("round"),this.strokeJoinExpression_=xt("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.hasFill_=!1,this.fillColorExpression_=hn(Wt["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(e){return this.uniforms_.push(e),this}addAttribute(e){return this.attributes_.push(e),this}addVarying(e,t,n){return this.varyings_.push({name:e,type:t,expression:n}),this}setSymbolSizeExpression(e){return this.hasSymbol_=!0,this.symbolSizeExpression_=e,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(e){return this.symbolRotationExpression_=e,this}setSymbolOffsetExpression(e){return this.symbolOffsetExpression_=e,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(e){return this.hasSymbol_=!0,this.symbolColorExpression_=e,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(e){return this.texCoordExpression_=e,this}setFragmentDiscardExpression(e){return this.discardExpression_=e,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(e){return this.symbolRotateWithView_=e,this}setStrokeWidthExpression(e){return this.hasStroke_=!0,this.strokeWidthExpression_=e,this}setStrokeColorExpression(e){return this.hasStroke_=!0,this.strokeColorExpression_=e,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(e){return this.strokeOffsetExpression_=e,this}setStrokeCapExpression(e){return this.strokeCapExpression_=e,this}setStrokeJoinExpression(e){return this.strokeJoinExpression_=e,this}setStrokeMiterLimitExpression(e){return this.strokeMiterLimitExpression_=e,this}setStrokeDistanceFieldExpression(e){return this.strokeDistanceFieldExpression_=e,this}setFillColorExpression(e){return this.hasFill_=!0,this.fillColorExpression_=e,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(e){this.vertexShaderFunctions_.includes(e)||this.vertexShaderFunctions_.push(e)}addFragmentShaderFunction(e){this.fragmentShaderFunctions_.includes(e)||this.fragmentShaderFunctions_.push(e)}getSymbolVertexShader(){return this.hasSymbol_?`${Ht}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_prop_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx;
  if (a_index == 0.0) {
    offsetPx -= halfSizePx;
  } else if (a_index == 1.0) {
    offsetPx += halfSizePx * vec2(1., -1.);
  } else if (a_index == 2.0) {
    offsetPx += halfSizePx;
  } else {
    offsetPx += halfSizePx * vec2(-1., 1.);
  }
  float angle = ${this.symbolRotationExpression_};
  ${this.symbolRotateWithView_?"angle += u_rotation;":""}
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;
  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;
  v_texCoord = vec2(u, v);
  v_prop_hitColor = a_prop_hitColor;
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y); 
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${Ht}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_prop_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${Ht}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute float a_parameters;
attribute float a_distance;
attribute vec2 a_joinAngles;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_prop_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float vertexNumber = floor(abs(a_parameters) / 10000. + 0.5);
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)
  float angleTangentSum = fract(abs(a_parameters) / 10000.) * 10000. * sign(a_parameters);

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);
  
  // compute current vertex position
  float normalDir = vertexNumber < 0.5 || (vertexNumber > 1.5 && vertexNumber < 2.5) ? 1.0 : -1.0;
  float tangentDir = vertexNumber < 1.5 ? 1.0 : -1.0;
  float angle = vertexNumber < 1.5 ? v_angleStart : v_angleEnd;
  vec2 joinDirection;
  vec2 positionPx = vertexNumber < 1.5 ? segmentStartPx : segmentEndPx;
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${Wo} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStart = segmentStartPx;
  v_segmentEnd = segmentEndPx;
  v_width = lineWidth;
  v_prop_hitColor = a_prop_hitColor;
  v_distanceOffsetPx = a_distance / u_resolution - (lineOffsetPx * angleTangentSum);
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${Ht}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_prop_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${Wo}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${xt("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${xt("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${xt("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${xt("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

void main(void) {
  vec2 currentPoint = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPoint);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }

  float segmentLength = length(v_segmentEnd - v_segmentStart);
  vec2 segmentTangent = (v_segmentEnd - v_segmentStart) / segmentLength;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPoint = currentPoint - v_segmentStart;
  float currentLengthPx = max(0., min(dot(segmentTangent, startToPoint), segmentLength)) + v_distanceOffsetPx; 
  float currentRadiusPx = abs(dot(segmentNormal, startToPoint));
  float currentRadiusRatio = dot(segmentNormal, startToPoint) * 2. / v_width;
  vec4 color = ${this.strokeColorExpression_} * u_globalAlpha;
  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPoint, v_segmentStart, v_segmentEnd, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPoint, v_segmentEnd, v_segmentStart, v_width, v_angleEnd, capType, joinType);
  float distance = max(
    segmentDistanceField(currentPoint, v_segmentStart, v_segmentEnd, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distance = max(distance, ${this.strokeDistanceFieldExpression_});
  gl_FragColor = color * smoothstep(0.5, -0.5, distance);
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${Ht}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec4 v_prop_hitColor;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_prop_hitColor = a_prop_hitColor;
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${Ht}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec4 v_prop_hitColor;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_} * u_globalAlpha;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}}const Je={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},um=["#00f","#0ff","#0f0","#ff0","#f00"];class cm extends Ki{constructor(e){e=e||{};const t=Object.assign({},e);delete t.gradient,delete t.radius,delete t.blur,delete t.weight,super(t),this.gradient_=null,this.addChangeListener(Je.GRADIENT,this.handleGradientChanged_),this.setGradient(e.gradient?e.gradient:um),this.setBlur(e.blur!==void 0?e.blur:15),this.setRadius(e.radius!==void 0?e.radius:8);const n=e.weight?e.weight:"weight";typeof n=="string"?this.weightFunction_=function(i){return i.get(n)}:this.weightFunction_=n,this.setRenderOrder(null)}getBlur(){return this.get(Je.BLUR)}getGradient(){return this.get(Je.GRADIENT)}getRadius(){return this.get(Je.RADIUS)}handleGradientChanged_(){this.gradient_=hm(this.getGradient())}setBlur(e){this.set(Je.BLUR,e)}setGradient(e){this.set(Je.GRADIENT,e)}setRadius(e){this.set(Je.RADIUS,e)}createRenderer(){const e=new vl().addAttribute("float a_prop_weight").addVarying("v_prop_weight","float","a_prop_weight").addUniform("float u_size").addUniform("float u_blurSlope").setSymbolSizeExpression("vec2(u_size)").setSymbolColorExpression("vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * u_blurSlope) * v_prop_weight)");return new El(this,{className:this.getClassName(),attributes:[{name:"weight",callback:t=>{const n=this.weightFunction_(t);return n!==void 0?ve(n,0,1):1}}],uniforms:{u_size:()=>(this.get(Je.RADIUS)+this.get(Je.BLUR))*2,u_blurSlope:()=>this.get(Je.RADIUS)/Math.max(1,this.get(Je.BLUR))},hitDetectionEnabled:!0,vertexShader:e.getSymbolVertexShader(),fragmentShader:e.getSymbolFragmentShader(),postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}renderDeclutter(){}}function hm(r){const n=wt(1,256),i=n.createLinearGradient(0,0,1,256),s=1/(r.length-1);for(let o=0,a=r.length;o<a;++o)i.addColorStop(o*s,r[o]);return n.fillStyle=i,n.fillRect(0,0,1,256),n.canvas}const fm=cm;class bs extends Fa{constructor(e,t,n,i,s){const o=s!==void 0?Bt.IDLE:Bt.LOADED;super(e,t,n,o),this.loader_=s!==void 0?s:null,this.canvas_=i,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=Bt.ERROR):this.state=Bt.LOADED,this.changed()}load(){this.state==Bt.IDLE&&(this.state=Bt.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}class dm extends vc{constructor(e){super(e),this.vectorRenderer_=new Sc(e),this.layerImageRatio_=e.getImageRatio(),this.coordinateToVectorPixelTransform_=nt(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(e){if(!this.vectorRenderer_)return Promise.resolve([]);const t=Ur(this.coordinateToVectorPixelTransform_,Ur(this.renderedPixelToCoordinateTransform_,e.slice()));return this.vectorRenderer_.getFeatures(t)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(e){const t=e.pixelRatio,n=e.viewState,i=n.resolution,s=e.viewHints,o=this.vectorRenderer_;let a=e.extent;this.layerImageRatio_!==1&&(a=a.slice(0),Na(a,this.layerImageRatio_));const l=He(a)/i,u=Ot(a)/i;if(!s[lr.ANIMATING]&&!s[lr.INTERACTING]&&!Wi(a)){o.useContainer(null,null);const h=o.context,f=e.layerStatesArray[e.layerIndex],d=Object.assign({},f,{opacity:1}),g=Object.assign({},e,{extent:a,size:[l,u],viewState:Object.assign({},e.viewState,{rotation:0}),layerStatesArray:[d],layerIndex:0,declutter:null}),m=this.getLayer().getDeclutter();m&&(g.declutter={[m]:new Rc(9)});let y=!0;const x=new bs(a,i,t,h.canvas,function(w){o.prepareFrame(g)&&o.replayGroupChanged&&(o.clipping=!1,o.renderFrame(g,null)&&(o.renderDeclutter(g),o.renderDeferred(g),y=!1),w())});x.addEventListener($e.CHANGE,()=>{if(x.getState()!==Bt.LOADED)return;this.image_=y?null:x;const w=x.getPixelRatio(),E=bc(x.getResolution())*t/w;this.renderedResolution=E,this.coordinateToVectorPixelTransform_=Yi(this.coordinateToVectorPixelTransform_,l/2,u/2,1/E,-1/E,0,-n.center[0],-n.center[1])}),x.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!!this.image_}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(e,t,n,i,s){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,t,n,i,s):super.forEachFeatureAtCoordinate(e,t,n,i,s)}}class pm extends Ki{constructor(e){e=e||{};const t=Object.assign({},e);delete t.imageRatio,super(t),this.imageRatio_=e.imageRatio!==void 0?e.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new dm(this)}}const gm=pm;function K(r,e,t){const n=Pc();return n.style=r.style,om(e,t,n,r)}function Jo(r){const e=Br(r),t=e[0]*256,n=e[1],i=e[2]*256,s=Math.round(e[3]*255);return[t+n,i+s]}const mm=`vec4 unpackColor(vec2 packedColor) {
  return fract(packedColor[1] / 256.0) * vec4(
    fract(floor(packedColor[0] / 256.0) / 256.0),
    fract(packedColor[0] / 256.0),
    fract(floor(packedColor[1] / 256.0) / 256.0),
    1.0
  );
}`;function Sl(r){return r===We?2:r===Ke?4:1}function ui(r){const e=Sl(r);return e>1?`vec${e}`:"float"}function Ln(r){return(JSON.stringify(r).split("").reduce((t,n)=>(t<<5)-t+n.charCodeAt(0),0)>>>0).toString()}function Ps(r,e,t,n){if(`${n}radius`in r&&n!=="icon-"){let i=K(t,r[`${n}radius`],he);if(`${n}radius2`in r){const s=K(t,r[`${n}radius2`],he);i=`max(${i}, ${s})`}`${n}stroke-width`in r&&(i=`(${i} + ${K(t,r[`${n}stroke-width`],he)} * 0.5)`),e.setSymbolSizeExpression(`vec2(${i} * 2. + 0.5)`)}if(`${n}scale`in r){const i=K(t,r[`${n}scale`],he|Ke);e.setSymbolSizeExpression(`${e.getSymbolSizeExpression()} * ${i}`)}`${n}displacement`in r&&e.setSymbolOffsetExpression(K(t,r[`${n}displacement`],Ke)),`${n}rotation`in r&&e.setSymbolRotationExpression(K(t,r[`${n}rotation`],he)),`${n}rotate-with-view`in r&&e.setSymbolRotateWithView(!!r[`${n}rotate-with-view`])}function Rl(r,e,t,n,i){let s="vec4(0.)";if(e!==null&&(s=e),t!==null&&n!==null){const l=`smoothstep(-${n} + 0.63, -${n} - 0.58, ${r})`;s=`mix(${t}, ${s}, ${l})`}const o=`(1.0 - smoothstep(-0.63, 0.58, ${r}))`;let a=`${s} * ${o}`;return i!==null&&(a=`${a} * ${i}`),a}function As(r,e,t,n,i){const s=new Image;let o;return s.crossOrigin=r[`${n}cross-origin`]===void 0?"anonymous":r[`${n}cross-origin`],s.src=r[`${n}src`],s.complete&&s.width&&s.height?o=vs([s.width,s.height]):(t[`u_texture${i}_size`]=()=>s.complete?[s.width,s.height]:[0,0],e.addUniform(`vec2 u_texture${i}_size`),o=`u_texture${i}_size`),t[`u_texture${i}`]=s,e.addUniform(`sampler2D u_texture${i}`),o}function Is(r,e,t,n,i){let s=K(t,r[`${e}offset`],Ke);if(`${e}offset-origin`in r)switch(r[`${e}offset-origin`]){case"top-right":s=`vec2(${n}.x, 0.) + ${i} * vec2(-1., 0.) + ${s} * vec2(-1., 1.)`;break;case"bottom-left":s=`vec2(0., ${n}.y) + ${i} * vec2(0., -1.) + ${s} * vec2(1., -1.)`;break;case"bottom-right":s=`${n} - ${i} - ${s}`;break}return s}function _m(r,e,t,n,i){i.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,Ps(r,e,n,"circle-");let s=null;"circle-opacity"in r&&(s=K(i,r["circle-opacity"],he));let o="coordsPx";"circle-scale"in r&&(o=`coordsPx / ${K(i,r["circle-scale"],he|Ke)}`);let a=null;"circle-fill-color"in r&&(a=K(i,r["circle-fill-color"],We));let l=null;"circle-stroke-color"in r&&(l=K(i,r["circle-stroke-color"],We));let u=K(i,r["circle-radius"],he),h=null;"circle-stroke-width"in r&&(h=K(i,r["circle-stroke-width"],he),u=`(${u} + ${h} * 0.5)`);const f=`circleDistanceField(${o}, ${u})`,d=Rl(f,a,l,h,s);e.setSymbolColorExpression(d)}function ym(r,e,t,n,i){i.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,i.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,i.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,Ps(r,e,n,"shape-");let s=null;"shape-opacity"in r&&(s=K(i,r["shape-opacity"],he));let o="coordsPx";"shape-scale"in r&&(o=`coordsPx / ${K(i,r["shape-scale"],he|Ke)}`);let a=null;"shape-fill-color"in r&&(a=K(i,r["shape-fill-color"],We));let l=null;"shape-stroke-color"in r&&(l=K(i,r["shape-stroke-color"],We));let u=null;"shape-stroke-width"in r&&(u=K(i,r["shape-stroke-width"],he));const h=K(i,r["shape-points"],he);let f="0.";"shape-angle"in r&&(f=K(i,r["shape-angle"],he));let d,g=K(i,r["shape-radius"],he);if(u!==null&&(g=`${g} + ${u} * 0.5`),"shape-radius2"in r){let y=K(i,r["shape-radius2"],he);u!==null&&(y=`${y} + ${u} * 0.5`),d=`starDistanceField(${o}, ${h}, ${g}, ${y}, ${f})`}else d=`regularDistanceField(${o}, ${h}, ${g}, ${f})`;const m=Rl(d,a,l,u,s);e.setSymbolColorExpression(m)}function xm(r,e,t,n,i){let s="vec4(1.0)";"icon-color"in r&&(s=K(i,r["icon-color"],We)),"icon-opacity"in r&&(s=`${s} * ${K(i,r["icon-opacity"],he)}`);const o=Ln(r["icon-src"]),a=As(r,e,t,"icon-",o);if(e.setSymbolColorExpression(`${s} * samplePremultiplied(u_texture${o}, v_texCoord)`).setSymbolSizeExpression(a),"icon-width"in r&&"icon-height"in r&&e.setSymbolSizeExpression(`vec2(${K(n,r["icon-width"],he)}, ${K(n,r["icon-height"],he)})`),"icon-offset"in r&&"icon-size"in r){const l=K(n,r["icon-size"],Ke),u=e.getSymbolSizeExpression();e.setSymbolSizeExpression(l);const h=Is(r,"icon-",n,"v_quadSizePx",l);e.setTextureCoordinateExpression(`(vec4((${h}).xyxy) + vec4(0., 0., ${l})) / (${u}).xyxy`)}if(Ps(r,e,n,"icon-"),"icon-anchor"in r){const l=K(n,r["icon-anchor"],Ke);let u="1.0";"icon-scale"in r&&(u=K(n,r["icon-scale"],he|Ke));let h;r["icon-anchor-x-units"]==="pixels"&&r["icon-anchor-y-units"]==="pixels"?h=`${l} * ${u}`:r["icon-anchor-x-units"]==="pixels"?h=`${l} * vec2(vec2(${u}).x, v_quadSizePx.y)`:r["icon-anchor-y-units"]==="pixels"?h=`${l} * vec2(v_quadSizePx.x, vec2(${u}).x)`:h=`${l} * v_quadSizePx`;let f=`v_quadSizePx * vec2(0.5, -0.5) + ${h} * vec2(-1., 1.)`;if("icon-anchor-origin"in r)switch(r["icon-anchor-origin"]){case"top-right":f=`v_quadSizePx * -0.5 + ${h}`;break;case"bottom-left":f=`v_quadSizePx * 0.5 - ${h}`;break;case"bottom-right":f=`v_quadSizePx * vec2(-0.5, 0.5) + ${h} * vec2(1., -1.)`;break}e.setSymbolOffsetExpression(`${e.getSymbolOffsetExpression()} + ${f}`)}}function Em(r,e,t,n,i){if("stroke-color"in r&&e.setStrokeColorExpression(K(i,r["stroke-color"],We)),"stroke-pattern-src"in r){const s=Ln(r["stroke-pattern-src"]),o=As(r,e,t,"stroke-pattern-",s);let a=o,l="vec2(0.)";"stroke-pattern-offset"in r&&"stroke-pattern-size"in r&&(a=K(i,r["stroke-pattern-size"],Ke),l=Is(r,"stroke-pattern-",i,o,a));let u="0.";"stroke-pattern-spacing"in r&&(u=K(i,r["stroke-pattern-spacing"],he)),i.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = currentLengthPx * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return samplePremultiplied(texture, texCoord);
}`;const h=`u_texture${s}`;let f="1.";"stroke-color"in r&&(f=e.getStrokeColorExpression()),e.setStrokeColorExpression(`${f} * sampleStrokePattern(${h}, ${o}, ${l}, ${a}, ${u}, currentLengthPx, currentRadiusRatio, v_width)`)}if("stroke-width"in r&&e.setStrokeWidthExpression(K(n,r["stroke-width"],he)),"stroke-offset"in r&&e.setStrokeOffsetExpression(K(n,r["stroke-offset"],he)),"stroke-line-cap"in r&&e.setStrokeCapExpression(K(n,r["stroke-line-cap"],ur)),"stroke-line-join"in r&&e.setStrokeJoinExpression(K(n,r["stroke-line-join"],ur)),"stroke-miter-limit"in r&&e.setStrokeMiterLimitExpression(K(n,r["stroke-miter-limit"],he)),"stroke-line-dash"in r){i.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${xt("square")}) {
    distanceSegment -= v_width * 0.5;
  } else if (capType == ${xt("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - v_width * 0.5);
  }
  return distanceSegment;
}`;let s=r["stroke-line-dash"].map(g=>K(i,g,he));s.length%2===1&&(s=[...s,...s]);let o="0.";"stroke-line-dash-offset"in r&&(o=K(n,r["stroke-line-dash-offset"],he));const l=`dashDistanceField_${Ln(r["stroke-line-dash"])}`,u=s.map((g,m)=>`float dashLength${m} = ${g};`),h=s.map((g,m)=>`dashLength${m}`).join(" + ");let f="0.",d=`getSingleDashDistance(distance, radius, ${f}, dashLength0, totalDashLength, capType)`;for(let g=2;g<s.length;g+=2)f=`${f} + dashLength${g-2} + dashLength${g-1}`,d=`min(${d}, getSingleDashDistance(distance, radius, ${f}, dashLength${g}, totalDashLength, capType))`;i.functions[l]=`float ${l}(float distance, float radius, float capType) {
  ${u.join(`
  `)}
  float totalDashLength = ${h};
  return ${d};
}`,e.setStrokeDistanceFieldExpression(`${l}(currentLengthPx + ${o}, currentRadiusPx, capType)`)}}function wm(r,e,t,n,i){if("fill-color"in r&&e.setFillColorExpression(K(i,r["fill-color"],We)),"fill-pattern-src"in r){const s=Ln(r["fill-pattern-src"]),o=As(r,e,t,"fill-pattern-",s);let a=o,l="vec2(0.)";"fill-pattern-offset"in r&&"fill-pattern-size"in r&&(a=K(i,r["fill-pattern-size"],Ke),l=Is(r,"fill-pattern-",i,o,a)),i.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return samplePremultiplied(texture, (samplePos + textureOffset) / textureSize);
}`;const u=`u_texture${s}`;let h="1.";"fill-color"in r&&(h=e.getFillColorExpression()),e.setFillColorExpression(`${h} * sampleFillPattern(${u}, ${o}, ${l}, ${a}, pxOrigin, pxPos)`)}}function Tm(r){const e={inFragmentShader:!1,properties:{},variables:{},functions:{},style:r},t={inFragmentShader:!0,variables:e.variables,properties:{},functions:{},style:r},n=new vl,i={};if("icon-src"in r?xm(r,n,i,e,t):"shape-points"in r?ym(r,n,i,e,t):"circle-radius"in r&&_m(r,n,i,e,t),Em(r,n,i,e,t),wm(r,n,i,e,t),r.filter){const o=K(t,r.filter,un);n.setFragmentDiscardExpression(`!${o}`)}Object.keys(t.variables).forEach(function(o){const a=t.variables[o],l=Ss(a.name);n.addUniform(`${ui(a.type)} ${l}`);let u;a.type===ur?u=()=>In(r.variables[a.name]):a.type===We?u=()=>Jo([...Br(r.variables[a.name]||"#eee")]):a.type===un?u=()=>r.variables[a.name]?1:0:u=()=>r.variables[a.name],i[l]=u}),Object.keys(t.properties).forEach(function(o){const a=t.properties[o];e.properties[o]||(e.properties[o]=a);let l=ui(a.type),u=`a_prop_${a.name}`;a.type===We&&(l="vec4",u=`unpackColor(${u})`,n.addVertexShaderFunction(mm)),n.addVarying(`v_prop_${a.name}`,l,u)}),Object.keys(e.properties).forEach(function(o){const a=e.properties[o];n.addAttribute(`${ui(a.type)} a_prop_${a.name}`)});const s=Object.keys(e.properties).map(function(o){const a=e.properties[o];let l;return a.evaluator?l=a.evaluator:a.type===ur?l=u=>In(u.get(a.name)):a.type===We?l=u=>Jo([...Br(u.get(a.name)||"#eee")]):a.type===un?l=u=>u.get(a.name)?1:0:l=u=>u.get(a.name),{name:a.name,size:Sl(a.type),callback:l}});for(const o in e.functions)n.addVertexShaderFunction(e.functions[o]);for(const o in t.functions)n.addFragmentShaderFunction(t.functions[o]);return{builder:n,attributes:s.reduce((o,a)=>({...o,[a.name]:{callback:a.callback,size:a.size}}),{}),uniforms:i}}class vm extends Da{constructor(e){const t=Object.assign({},e);super(t),this.parseResult_=Tm(e.style),this.styleVariables_=e.style.variables||{},this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){const e=Object.keys(this.parseResult_.attributes).map(t=>({name:t,...this.parseResult_.attributes[t]}));return new El(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitDetectionEnabled:!this.hitDetectionDisabled_,uniforms:this.parseResult_.uniforms,attributes:e})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}const Sm=vm;function ea(r,e){const t=`
    attribute vec2 ${cn.TEXTURE_COORD};
    uniform mat4 ${Q.TILE_TRANSFORM};
    uniform float ${Q.TEXTURE_PIXEL_WIDTH};
    uniform float ${Q.TEXTURE_PIXEL_HEIGHT};
    uniform float ${Q.TEXTURE_RESOLUTION};
    uniform float ${Q.TEXTURE_ORIGIN_X};
    uniform float ${Q.TEXTURE_ORIGIN_Y};
    uniform float ${Q.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${cn.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${Q.TEXTURE_ORIGIN_X} + ${Q.TEXTURE_RESOLUTION} * ${Q.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${Q.TEXTURE_ORIGIN_Y} - ${Q.TEXTURE_RESOLUTION} * ${Q.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${Q.TILE_TRANSFORM} * vec4(${cn.TEXTURE_COORD}, ${Q.DEPTH}, 1.0);
    }
  `,n={...sm(),inFragmentShader:!0,bandCount:e,style:r},i=[];if(r.color!==void 0){const f=K(n,r.color,We);i.push(`color = ${f};`)}if(r.contrast!==void 0){const f=K(n,r.contrast,he);i.push(`color.rgb = clamp((${f} + 1.0) * color.rgb - (${f} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(r.exposure!==void 0){const f=K(n,r.exposure,he);i.push(`color.rgb = clamp((${f} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(r.saturation!==void 0){const f=K(n,r.saturation,he);i.push(`
      float saturation = ${f} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(r.gamma!==void 0){const f=K(n,r.gamma,he);i.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${f}));`)}if(r.brightness!==void 0){const f=K(n,r.brightness,he);i.push(`color.rgb = clamp(color.rgb + ${f}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=Object.keys(n.variables).length;if(o>1&&!r.variables)throw new Error(`Missing variables in style (expected ${n.variables})`);for(let f=0;f<o;++f){const d=n.variables[Object.keys(n.variables)[f]];if(!(d.name in r.variables))throw new Error(`Missing '${d.name}' in style variables`);const g=Ss(d.name);s[g]=function(){let m=r.variables[d.name];return typeof m=="string"&&(m=In(m)),m!==void 0?m:-9999999}}const a=Object.keys(s).map(function(f){return`uniform float ${f};`}),l=Math.ceil(e/4);a.push(`uniform sampler2D ${Q.TILE_TEXTURE_ARRAY}[${l}];`),n.paletteTextures&&a.push(`uniform sampler2D ${Tl}[${n.paletteTextures.length}];`);const u=Object.keys(n.functions).map(function(f){return n.functions[f]}),h=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${Q.RENDER_EXTENT};
    uniform float ${Q.TRANSITION_ALPHA};
    uniform float ${Q.TEXTURE_PIXEL_WIDTH};
    uniform float ${Q.TEXTURE_PIXEL_HEIGHT};
    uniform float ${Q.RESOLUTION};
    uniform float ${Q.ZOOM};

    ${a.join(`
`)}

    ${u.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${Q.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${Q.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${Q.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${Q.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${Q.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${i.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${Q.TRANSITION_ALPHA};
    }`;return{vertexShader:t,fragmentShader:h,uniforms:s,paletteTextures:n.paletteTextures}}class Cn extends Ac{constructor(e){e=e?Object.assign({},e):{};const t=e.style||{};delete e.style;const n=e.cacheSize;delete e.cacheSize,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.cacheSize_=n,this.styleVariables_=this.style_.variables||{},this.addChangeListener(Aa.SOURCE,this.handleSourceUpdate_)}getSources(e,t){const n=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(e,t):this.sources_:n?[n]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=ea(this.style_,this.getSourceBandCount_());return new rm(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.cacheSize_,paletteTextures:e.paletteTextures})}renderSources(e,t){const n=this.getRenderer();let i;for(let s=0,o=t.length;s<o;++s)this.renderedSource_=t[s],n.prepareFrame(e)&&(i=n.renderFrame(e));return i}render(e,t){this.rendered=!0;const n=e.viewState,i=this.getSources(e.extent,n.resolution);let s=!0;for(let a=0,l=i.length;a<l;++a){const u=i[a],h=u.getState();if(h=="loading"){const f=()=>{u.getState()=="ready"&&(u.removeEventListener("change",f),this.changed())};u.addEventListener("change",f)}s=s&&h=="ready"}const o=this.renderSources(e,i);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=n.resolution,o;if(this.renderedResolution_>.5*n.resolution){const a=this.getSources(e.extent,this.renderedResolution_).filter(l=>!i.includes(l));if(a.length>0)return this.renderSources(e,a)}return o}setStyle(e){this.styleVariables_=e.variables||{},this.style_=e;const t=ea(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}Cn.prototype.dispose;const Rm=Object.freeze(Object.defineProperty({__proto__:null,Graticule:cg,Group:Ga,Heatmap:fm,Image:es,Layer:Da,Tile:En,Vector:Hi,VectorImage:gm,VectorTile:Ua,WebGLPoints:Sm,WebGLTile:Cn},Symbol.toStringTag,{value:"Module"}));function bm(r){const e=r[0],t=new Array(e);let n=1<<e-1,i,s;for(i=0;i<e;++i)s=48,r[1]&n&&(s+=1),r[2]&n&&(s+=2),t[i]=String.fromCharCode(s),n>>=1;return t.join("")}const Pm='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>';class Am extends vt{constructor(e){const t=e.hidpi!==void 0?e.hidpi:!1;super({cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,opaque:!0,projection:_e("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.hidpi_=t,this.culture_=e.culture!==void 0?e.culture:"en-us",this.maxZoom_=e.maxZoom!==void 0?e.maxZoom:-1,this.apiKey_=e.key,this.imagerySet_=e.imagerySet,this.placeholderTiles_=e.placeholderTiles;const n="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(n).then(i=>i.json()).then(i=>this.handleImageryMetadataResponse(i))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(e){if(e.statusCode!=200||e.statusDescription!="OK"||e.authenticationResultCode!="ValidCredentials"||e.resourceSets.length!=1||e.resourceSets[0].resources.length!=1){this.setState("error");return}const t=e.resourceSets[0].resources[0],n=this.maxZoom_==-1?t.zoomMax:this.maxZoom_,i=this.getProjection(),s=Hr(i),o=this.hidpi_?2:1,a=t.imageWidth==t.imageHeight?t.imageWidth/o:[t.imageWidth/o,t.imageHeight/o],l=Wr({extent:s,minZoom:t.zoomMin,maxZoom:n,tileSize:a});this.tileGrid=l;const u=this.culture_,h=this.hidpi_,f=this.placeholderTiles_;if(this.tileUrlFunction=ts(t.imageUrlSubdomains.map(function(d){const g=[0,0,0],m=t.imageUrl.replace("{subdomain}",d).replace("{culture}",u);return function(y,x,w){if(!y)return;Ri(y[0],y[1],y[2],g);const E=new URL(m.replace("{quadkey}",bm(g))),v=E.searchParams;return h&&(v.set("dpi","d1"),v.set("device","mobile")),f===!0?v.delete("n"):f===!1&&v.set("n","z"),E.toString()}})),t.imageryProviders){const d=rs(_e("EPSG:4326"),this.getProjection());this.setAttributions(g=>{const m=[],y=g.viewState,x=this.getTileGrid(),w=x.getZForResolution(y.resolution,this.zDirection),v=x.getTileCoordForCoordAndZ(y.center,w)[0];return t.imageryProviders.map(function(S){let A=!1;const O=S.coverageAreas;for(let L=0,F=O.length;L<F;++L){const U=O[L];if(v>=U.zoomMin&&v<=U.zoomMax){const k=U.bbox,V=[k[1],k[0],k[3],k[2]],ee=Gr(V,d);if(ar(ee,g.extent)){A=!0;break}}}A&&m.push(S.attribution)}),m.push(Pm),m})}this.setState("ready")}}const Im=Am;class Lm extends cr{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,maxZoom:e.maxZoom!==void 0?e.maxZoom:18,minZoom:e.minZoom,projection:e.projection,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection}),this.account_=e.account,this.mapId_=e.map||"",this.config_=e.config||{},this.templateCache_={},this.initializeMap_()}getConfig(){return this.config_}updateConfig(e){Object.assign(this.config_,e),this.initializeMap_()}setConfig(e){this.config_=e||{},this.initializeMap_()}initializeMap_(){const e=JSON.stringify(this.config_);if(this.templateCache_[e]){this.applyTemplate_(this.templateCache_[e]);return}let t="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(t+="/named/"+this.mapId_);const n=new XMLHttpRequest;n.addEventListener("load",this.handleInitResponse_.bind(this,e)),n.addEventListener("error",this.handleInitError_.bind(this)),n.open("POST",t),n.setRequestHeader("Content-type","application/json"),n.send(JSON.stringify(this.config_))}handleInitResponse_(e,t){const n=t.target;if(!n.status||n.status>=200&&n.status<300){let i;try{i=JSON.parse(n.responseText)}catch{this.setState("error");return}this.applyTemplate_(i),this.templateCache_[e]=i,this.setState("ready")}else this.setState("error")}handleInitError_(e){this.setState("error")}applyTemplate_(e){const t="https://"+e.cdn_url.https+"/"+this.account_+"/api/v1/map/"+e.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(t)}}const Cm=Lm;class Om extends Dn{constructor(e){super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(t){const n=t.getGeometry();return pt(!n||n.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),n},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,t,n){this.source.loadFeatures(e,t,n),t!==this.resolution&&(this.resolution=t,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener($e.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener($e.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,t){const n=e===0?0:Math.min(t,e)/e,i=e!==this.distance||this.interpolationRatio!==n;this.distance=e,this.minDistance=t,this.interpolationRatio=n,i&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=qi(),t=this.distance*this.resolution,n=this.source.getFeatures(),i={};for(let s=0,o=n.length;s<o;s++){const a=n[s];if(!(Pe(a)in i)){const l=this.geometryFunction(a);if(l){const u=l.getCoordinates();Ic(u,e),Ia(e,t,e);const h=this.source.getFeaturesInExtent(e).filter(function(f){const d=Pe(f);return d in i?!1:(i[d]=!0,!0)});this.features.push(this.createCluster(h,e))}}}}createCluster(e,t){const n=[0,0];for(let a=e.length-1;a>=0;--a){const l=this.geometryFunction(e[a]);l?Lc(n,l.getCoordinates()):e.splice(a,1)}Cc(n,1/e.length);const i=It(t),s=this.interpolationRatio,o=new rt([n[0]*(1-s)+i[0]*s,n[1]*(1-s)+i[1]*s]);return this.createCustomCluster_?this.createCustomCluster_(o,e):new Ye({geometry:o,features:e})}}const Mm=Om;class Ls extends Gn{constructor(e){const t=e.projection===void 0?"EPSG:3857":e.projection;let n=e.tileGrid;n===void 0&&t&&(n=Wr({extent:Hr(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:n,opaque:e.opaque,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.tileSize_=e.tileSize?ft(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=e.bandCount===void 0?4:e.bandCount,this.tileGridForProjection_={},this.tileCacheForProjection_={}}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const t=this.getTileGrid();return t?ft(t.getTileSize(e)):[256,256]}getGutterForProjection(e){const t=this.getProjection();return!t||br(t,e)?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,t,n,i,s){const o=this.getTileCacheForProjection(i),a=wn(e,t,n);if(o.containsKey(a)){const x=o.get(a);if(x&&x.key==this.getKey())return x}const l=this.getTileGrid(),u=Math.max.apply(null,l.getResolutions().map((x,w)=>{const E=ft(l.getTileSize(w)),v=this.getTileSize(w);return Math.max(v[0]/E[0],v[1]/E[1])})),h=this.getTileGridForProjection(s),f=this.getTileGridForProjection(i),d=[e,t,n],g=this.getTileCoordForTileUrlFunction(d,i),m=Object.assign({sourceProj:s,sourceTileGrid:h,targetProj:i,targetTileGrid:f,tileCoord:d,wrappedTileCoord:g,pixelRatio:u,gutter:this.getGutterForProjection(s),getTileFunction:(x,w,E,v)=>this.getTile(x,w,E,v,s)},this.tileOptions),y=new Ts(m);return y.key=this.getKey(),y}getTile(e,t,n,i,s){const o=this.getProjection();if(o&&s&&!br(o,s))return this.getReprojTile_(e,t,n,s,o);const a=this.getTileSize(e),l=wn(e,t,n);if(this.tileCache.containsKey(l))return this.tileCache.get(l);const u=this.loader_;function h(){return Nc(function(){return u(e,t,n)})}const f=Object.assign({tileCoord:[e,t,n],loader:h,size:a},this.tileOptions),d=new ws(f);return d.key=this.getKey(),d.addEventListener($e.CHANGE,this.handleTileChange_),this.tileCache.set(l,d),d}handleTileChange_(e){const t=e.target,n=Pe(t),i=t.getState();let s;i==q.LOADING?(this.tileLoadingKeys_[n]=!0,s=ni.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=i==q.ERROR?ni.TILELOADERROR:i==q.LOADED?ni.TILELOADEND:void 0),s&&this.dispatchEvent(new Oc(s,t))}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||br(t,e)))return this.tileGrid;const n=Pe(e);return n in this.tileGridForProjection_||(this.tileGridForProjection_[n]=Mc(e)),this.tileGridForProjection_[n]}setTileGridForProjection(e,t){const n=_e(e);if(n){const i=Pe(n);i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=t)}}getTileCacheForProjection(e){const t=this.getProjection();if(!t||br(t,e))return this.tileCache;const n=Pe(e);return n in this.tileCacheForProjection_||(this.tileCacheForProjection_[n]=new Fc(.1)),this.tileCacheForProjection_[n]}expireCache(e,t){const n=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==n?t:{});for(const i in this.tileCacheForProjection_){const s=this.tileCacheForProjection_[i];s.expireCache(s==n?t:{})}}clear(){super.clear();for(const e in this.tileCacheForProjection_)this.tileCacheForProjection_[e].clear()}}function Fe(r){return(e,...t)=>Fm(r,e,t)}function Er(r,e){return Fe(bl(r,e).get)}const{apply:Fm,construct:Bx,defineProperty:zx,get:kx,getOwnPropertyDescriptor:bl,getPrototypeOf:Cs,has:$x,ownKeys:Nm,set:jx,setPrototypeOf:Zx}=Reflect,{iterator:Kr,species:Vx,toStringTag:Dm,for:Xx}=Symbol,Gm=Object,{create:Os,defineProperty:Um,freeze:Hx,is:Wx}=Gm,Bm=Array,zm=Bm.prototype,Pl=zm[Kr],km=Fe(Pl),Al=ArrayBuffer,$m=Al.prototype;Er($m,"byteLength");const ta=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;ta&&Er(ta.prototype,"byteLength");const Il=Cs(Uint8Array);Il.from;const Ue=Il.prototype;Ue[Kr];Fe(Ue.keys);Fe(Ue.values);Fe(Ue.entries);Fe(Ue.set);Fe(Ue.reverse);Fe(Ue.fill);Fe(Ue.copyWithin);Fe(Ue.sort);Fe(Ue.slice);Fe(Ue.subarray);Er(Ue,"buffer");Er(Ue,"byteOffset");Er(Ue,"length");Er(Ue,Dm);const jm=Uint8Array,Ll=Uint16Array,Ms=Uint32Array,Zm=Float32Array,jr=Cs([][Kr]()),Cl=Fe(jr.next),Vm=Fe(function*(){}().next),Xm=Cs(jr),Hm=DataView.prototype,Wm=Fe(Hm.getUint16),Fs=WeakMap,Ol=Fs.prototype,Ml=Fe(Ol.get),Ym=Fe(Ol.set),Fl=new Fs,qm=Os(null,{next:{value:function(){const e=Ml(Fl,this);return Cl(e)}},[Kr]:{value:function(){return this}}});function Km(r){if(r[Kr]===Pl&&jr.next===Cl)return r;const e=Os(qm);return Ym(Fl,e,km(r)),e}const Qm=new Fs,Jm=Os(Xm,{next:{value:function(){const e=Ml(Qm,this);return Vm(e)},writable:!0,configurable:!0}});for(const r of Nm(jr))r!=="next"&&Um(Jm,r,bl(jr,r));const Nl=new Al(4),e_=new Zm(Nl),t_=new Ms(Nl),ot=new Ll(512),at=new jm(512);for(let r=0;r<256;++r){const e=r-127;e<-27?(ot[r]=0,ot[r|256]=32768,at[r]=24,at[r|256]=24):e<-14?(ot[r]=1024>>-e-14,ot[r|256]=1024>>-e-14|32768,at[r]=-e-1,at[r|256]=-e-1):e<=15?(ot[r]=e+15<<10,ot[r|256]=e+15<<10|32768,at[r]=13,at[r|256]=13):e<128?(ot[r]=31744,ot[r|256]=64512,at[r]=24,at[r|256]=24):(ot[r]=31744,ot[r|256]=64512,at[r]=13,at[r|256]=13)}const Ns=new Ms(2048);for(let r=1;r<1024;++r){let e=r<<13,t=0;for(;!(e&8388608);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,Ns[r]=e|t}for(let r=1024;r<2048;++r)Ns[r]=939524096+(r-1024<<13);const wr=new Ms(64);for(let r=1;r<31;++r)wr[r]=r<<23;wr[31]=1199570944;wr[32]=2147483648;for(let r=33;r<63;++r)wr[r]=2147483648+(r-32<<23);wr[63]=3347054592;const Dl=new Ll(64);for(let r=1;r<64;++r)r!==32&&(Dl[r]=1024);function r_(r){const e=r>>10;return t_[0]=Ns[Dl[e]+(r&1023)]+wr[e],e_[0]}function Gl(r,e,...t){return r_(Wm(r,e,...Km(t)))}var Ds={exports:{}};function Ul(r,e,t){const n=t&&t.debug||!1;n&&console.log("[xml-utils] getting "+e+" in "+r);const i=typeof r=="object"?r.outer:r,s=i.slice(0,i.indexOf(">")+1),o=['"',"'"];for(let a=0;a<o.length;a++){const l=o[a],u=e+"\\="+l+"([^"+l+"]*)"+l;n&&console.log("[xml-utils] pattern:",u);const f=new RegExp(u).exec(s);if(n&&console.log("[xml-utils] match:",f),f)return f[1]}}Ds.exports=Ul;Ds.exports.default=Ul;var n_=Ds.exports;const ci=zn(n_);var Gs={exports:{}},Us={exports:{}},Bs={exports:{}};function Bl(r,e,t){const i=new RegExp(e).exec(r.slice(t));return i?t+i.index:-1}Bs.exports=Bl;Bs.exports.default=Bl;var i_=Bs.exports,zs={exports:{}};function zl(r,e,t){const i=new RegExp(e).exec(r.slice(t));return i?t+i.index+i[0].length-1:-1}zs.exports=zl;zs.exports.default=zl;var s_=zs.exports,ks={exports:{}};function kl(r,e){const t=new RegExp(e,"g"),n=r.match(t);return n?n.length:0}ks.exports=kl;ks.exports.default=kl;var o_=ks.exports;const a_=i_,hi=s_,ra=o_;function $l(r,e,t){const n=t&&t.debug||!1,i=!(t&&typeof t.nested===!1),s=t&&t.startIndex||0;n&&console.log("[xml-utils] starting findTagByName with",e," and ",t);const o=a_(r,`<${e}[ 
>/]`,s);if(n&&console.log("[xml-utils] start:",o),o===-1)return;const a=r.slice(o+e.length);let l=hi(a,"^[^<]*[ /]>",0);const u=l!==-1&&a[l-1]==="/";if(n&&console.log("[xml-utils] selfClosing:",u),u===!1)if(i){let g=0,m=1,y=0;for(;(l=hi(a,"[ /]"+e+">",g))!==-1;){const x=a.substring(g,l+1);if(m+=ra(x,"<"+e+`[ 
	>]`),y+=ra(x,"</"+e+">"),y>=m)break;g=l}}else l=hi(a,"[ /]"+e+">",0);const h=o+e.length+l+1;if(n&&console.log("[xml-utils] end:",h),h===-1)return;const f=r.slice(o,h);let d;return u?d=null:d=f.slice(f.indexOf(">")+1,f.lastIndexOf("<")),{inner:d,outer:f,start:o,end:h}}Us.exports=$l;Us.exports.default=$l;var l_=Us.exports;const u_=l_;function jl(r,e,t){const n=[],i=t&&t.debug||!1,s=t&&typeof t.nested=="boolean"?t.nested:!0;let o=t&&t.startIndex||0,a;for(;a=u_(r,e,{debug:i,startIndex:o});)s?o=a.start+1+e.length:o=a.end,n.push(a);return i&&console.log("findTagsByName found",n.length,"tags"),n}Gs.exports=jl;Gs.exports.default=jl;var c_=Gs.exports;const h_=zn(c_),Mr={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},lt={};for(const r in Mr)Mr.hasOwnProperty(r)&&(lt[Mr[r]]=parseInt(r,10));const f_=[lt.BitsPerSample,lt.ExtraSamples,lt.SampleFormat,lt.StripByteCounts,lt.StripOffsets,lt.StripRowCounts,lt.TileByteCounts,lt.TileOffsets,lt.SubIFDs],fi={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},te={};for(const r in fi)fi.hasOwnProperty(r)&&(te[fi[r]]=parseInt(r,10));const Be={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},d_={Unspecified:0,Assocalpha:1,Unassalpha:2},Yx={Version:0,AddCompression:1},qx={None:0,Deflate:1,Zstandard:2},p_={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function g_(r,e){const{width:t,height:n}=r,i=new Uint8Array(t*n*3);let s;for(let o=0,a=0;o<r.length;++o,a+=3)s=256-r[o]/e*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function m_(r,e){const{width:t,height:n}=r,i=new Uint8Array(t*n*3);let s;for(let o=0,a=0;o<r.length;++o,a+=3)s=r[o]/e*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function __(r,e){const{width:t,height:n}=r,i=new Uint8Array(t*n*3),s=e.length/3,o=e.length/3*2;for(let a=0,l=0;a<r.length;++a,l+=3){const u=r[a];i[l]=e[u]/65536*256,i[l+1]=e[u+s]/65536*256,i[l+2]=e[u+o]/65536*256}return i}function y_(r){const{width:e,height:t}=r,n=new Uint8Array(e*t*3);for(let i=0,s=0;i<r.length;i+=4,s+=3){const o=r[i],a=r[i+1],l=r[i+2],u=r[i+3];n[s]=255*((255-o)/256)*((255-u)/256),n[s+1]=255*((255-a)/256)*((255-u)/256),n[s+2]=255*((255-l)/256)*((255-u)/256)}return n}function x_(r){const{width:e,height:t}=r,n=new Uint8ClampedArray(e*t*3);for(let i=0,s=0;i<r.length;i+=3,s+=3){const o=r[i],a=r[i+1],l=r[i+2];n[s]=o+1.402*(l-128),n[s+1]=o-.34414*(a-128)-.71414*(l-128),n[s+2]=o+1.772*(a-128)}return n}const E_=.95047,w_=1,T_=1.08883;function v_(r){const{width:e,height:t}=r,n=new Uint8Array(e*t*3);for(let i=0,s=0;i<r.length;i+=3,s+=3){const o=r[i+0],a=r[i+1]<<24>>24,l=r[i+2]<<24>>24;let u=(o+16)/116,h=a/500+u,f=u-l/200,d,g,m;h=E_*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),u=w_*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),f=T_*(f*f*f>.008856?f*f*f:(f-16/116)/7.787),d=h*3.2406+u*-1.5372+f*-.4986,g=h*-.9689+u*1.8758+f*.0415,m=h*.0557+u*-.204+f*1.057,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,m=m>.0031308?1.055*m**(1/2.4)-.055:12.92*m,n[s]=Math.max(0,Math.min(1,d))*255,n[s+1]=Math.max(0,Math.min(1,g))*255,n[s+2]=Math.max(0,Math.min(1,m))*255}return n}const Zl=new Map;function Ft(r,e){Array.isArray(r)||(r=[r]),r.forEach(t=>Zl.set(t,e))}async function Vl(r){const e=Zl.get(r.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${r.Compression}`);const t=await e();return new t(r)}Ft([void 0,1],()=>Mt(()=>import("./raw-Dt1HMqYc.js"),__vite__mapDeps([0,1]),import.meta.url).then(r=>r.default));Ft(5,()=>Mt(()=>import("./lzw-DpvbRwG5.js"),__vite__mapDeps([2,1]),import.meta.url).then(r=>r.default));Ft(6,()=>{throw new Error("old style JPEG compression is not supported.")});Ft(7,()=>Mt(()=>import("./jpeg-CdeCw_eT.js"),__vite__mapDeps([3,1]),import.meta.url).then(r=>r.default));Ft([8,32946],()=>Mt(()=>import("./deflate-CUkHh1nh.js"),__vite__mapDeps([4,5,1]),import.meta.url).then(r=>r.default));Ft(32773,()=>Mt(()=>import("./packbits-DQnG8s9w.js"),__vite__mapDeps([6,1]),import.meta.url).then(r=>r.default));Ft(34887,()=>Mt(()=>import("./lerc-Bav3bQjX.js"),__vite__mapDeps([7,5,8,1,9,10,11,12,13]),import.meta.url).then(async r=>(await r.zstd.init(),r)).then(r=>r.default));Ft(50001,()=>Mt(()=>import("./webimage-BcnuJlio.js"),__vite__mapDeps([14,1]),import.meta.url).then(r=>r.default));function qn(r,e,t,n=1){return new(Object.getPrototypeOf(r)).constructor(e*t*n)}function S_(r,e,t,n,i){const s=e/n,o=t/i;return r.map(a=>{const l=qn(a,n,i);for(let u=0;u<i;++u){const h=Math.min(Math.round(o*u),t-1);for(let f=0;f<n;++f){const d=Math.min(Math.round(s*f),e-1),g=a[h*e+d];l[u*n+f]=g}}return l})}function or(r,e,t){return(1-t)*r+t*e}function R_(r,e,t,n,i){const s=e/n,o=t/i;return r.map(a=>{const l=qn(a,n,i);for(let u=0;u<i;++u){const h=o*u,f=Math.floor(h),d=Math.min(Math.ceil(h),t-1);for(let g=0;g<n;++g){const m=s*g,y=m%1,x=Math.floor(m),w=Math.min(Math.ceil(m),e-1),E=a[f*e+x],v=a[f*e+w],S=a[d*e+x],A=a[d*e+w],O=or(or(E,v,y),or(S,A,y),h%1);l[u*n+g]=O}}return l})}function b_(r,e,t,n,i,s="nearest"){switch(s.toLowerCase()){case"nearest":return S_(r,e,t,n,i);case"bilinear":case"linear":return R_(r,e,t,n,i);default:throw new Error(`Unsupported resampling method: '${s}'`)}}function P_(r,e,t,n,i,s){const o=e/n,a=t/i,l=qn(r,n,i,s);for(let u=0;u<i;++u){const h=Math.min(Math.round(a*u),t-1);for(let f=0;f<n;++f){const d=Math.min(Math.round(o*f),e-1);for(let g=0;g<s;++g){const m=r[h*e*s+d*s+g];l[u*n*s+f*s+g]=m}}}return l}function A_(r,e,t,n,i,s){const o=e/n,a=t/i,l=qn(r,n,i,s);for(let u=0;u<i;++u){const h=a*u,f=Math.floor(h),d=Math.min(Math.ceil(h),t-1);for(let g=0;g<n;++g){const m=o*g,y=m%1,x=Math.floor(m),w=Math.min(Math.ceil(m),e-1);for(let E=0;E<s;++E){const v=r[f*e*s+x*s+E],S=r[f*e*s+w*s+E],A=r[d*e*s+x*s+E],O=r[d*e*s+w*s+E],L=or(or(v,S,y),or(A,O,y),h%1);l[u*n*s+g*s+E]=L}}}return l}function I_(r,e,t,n,i,s,o="nearest"){switch(o.toLowerCase()){case"nearest":return P_(r,e,t,n,i,s);case"bilinear":case"linear":return A_(r,e,t,n,i,s);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function L_(r,e,t){let n=0;for(let i=e;i<t;++i)n+=r[i];return n}function Di(r,e,t){switch(r){case 1:if(e<=8)return new Uint8Array(t);if(e<=16)return new Uint16Array(t);if(e<=32)return new Uint32Array(t);break;case 2:if(e===8)return new Int8Array(t);if(e===16)return new Int16Array(t);if(e===32)return new Int32Array(t);break;case 3:switch(e){case 16:case 32:return new Float32Array(t);case 64:return new Float64Array(t)}break}throw Error("Unsupported data format/bitsPerSample")}function C_(r,e){return(r===1||r===2)&&e<=32&&e%8===0?!1:!(r===3&&(e===16||e===32||e===64))}function O_(r,e,t,n,i,s,o){const a=new DataView(r),l=t===2?o*s:o*s*n,u=t===2?1:n,h=Di(e,i,l),f=parseInt("1".repeat(i),2);if(e===1){let d;t===1?d=n*i:d=i;let g=s*d;g&7&&(g=g+7&-8);for(let m=0;m<o;++m){const y=m*g;for(let x=0;x<s;++x){const w=y+x*u*i;for(let E=0;E<u;++E){const v=w+E*i,S=(m*s+x)*u+E,A=Math.floor(v/8),O=v%8;if(O+i<=8)h[S]=a.getUint8(A)>>8-i-O&f;else if(O+i<=16)h[S]=a.getUint16(A)>>16-i-O&f;else if(O+i<=24){const L=a.getUint16(A)<<8|a.getUint8(A+2);h[S]=L>>24-i-O&f}else h[S]=a.getUint32(A)>>32-i-O&f}}}}return h.buffer}class Xl{constructor(e,t,n,i,s,o){this.fileDirectory=e,this.geoKeys=t,this.dataView=n,this.littleEndian=i,this.tiles=s?{}:null,this.isTiled=!e.StripOffsets;const a=e.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,n=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(n<=8)return DataView.prototype.getUint8;if(n<=16)return DataView.prototype.getUint16;if(n<=32)return DataView.prototype.getUint32;break;case 2:if(n<=8)return DataView.prototype.getInt8;if(n<=16)return DataView.prototype.getInt16;if(n<=32)return DataView.prototype.getInt32;break;case 3:switch(n){case 16:return function(i,s){return Gl(this,i,s)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const n=this.getSampleFormat(e),i=this.getBitsPerSample(e);return Di(n,i,t)}async getTileOrStrip(e,t,n,i,s){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:u}=this;this.planarConfiguration===1?l=t*o+e:this.planarConfiguration===2&&(l=n*o*a+t*o+e);let h,f;this.isTiled?(h=this.fileDirectory.TileOffsets[l],f=this.fileDirectory.TileByteCounts[l]):(h=this.fileDirectory.StripOffsets[l],f=this.fileDirectory.StripByteCounts[l]);const d=(await this.source.fetch([{offset:h,length:f}],s))[0];let g;return u===null||!u[l]?(g=(async()=>{let m=await i.decode(this.fileDirectory,d);const y=this.getSampleFormat(),x=this.getBitsPerSample();return C_(y,x)&&(m=O_(m,y,this.planarConfiguration,this.getSamplesPerPixel(),x,this.getTileWidth(),this.getBlockHeight(t))),m})(),u!==null&&(u[l]=g)):g=u[l],{x:e,y:t,sample:n,data:await g}}async _readRaster(e,t,n,i,s,o,a,l,u){const h=this.getTileWidth(),f=this.getTileHeight(),d=this.getWidth(),g=this.getHeight(),m=Math.max(Math.floor(e[0]/h),0),y=Math.min(Math.ceil(e[2]/h),Math.ceil(d/h)),x=Math.max(Math.floor(e[1]/f),0),w=Math.min(Math.ceil(e[3]/f),Math.ceil(g/f)),E=e[2]-e[0];let v=this.getBytesPerPixel();const S=[],A=[];for(let F=0;F<t.length;++F)this.planarConfiguration===1?S.push(L_(this.fileDirectory.BitsPerSample,0,t[F])/8):S.push(0),A.push(this.getReaderForSample(t[F]));const O=[],{littleEndian:L}=this;for(let F=x;F<w;++F)for(let U=m;U<y;++U){let k;this.planarConfiguration===1&&(k=this.getTileOrStrip(U,F,0,s,u));for(let V=0;V<t.length;++V){const ee=V,c=t[V];this.planarConfiguration===2&&(v=this.getSampleByteSize(c),k=this.getTileOrStrip(U,F,c,s,u));const p=k.then(_=>{const T=_.data,I=new DataView(T),C=this.getBlockHeight(_.y),M=_.y*f,N=_.x*h,z=M+C,X=(_.x+1)*h,ae=A[ee],oe=Math.min(C,C-(z-e[3]),g-M),ue=Math.min(h,h-(X-e[2]),d-N);for(let le=Math.max(0,e[1]-M);le<oe;++le)for(let ye=Math.max(0,e[0]-N);ye<ue;++ye){const Le=(le*h+ye)*v,be=ae.call(I,Le+S[ee],L);let Oe;i?(Oe=(le+M-e[1])*E*t.length+(ye+N-e[0])*t.length+ee,n[Oe]=be):(Oe=(le+M-e[1])*E+ye+N-e[0],n[ee][Oe]=be)}});O.push(p)}}if(await Promise.all(O),o&&e[2]-e[0]!==o||a&&e[3]-e[1]!==a){let F;return i?F=I_(n,e[2]-e[0],e[3]-e[1],o,a,t.length,l):F=b_(n,e[2]-e[0],e[3]-e[1],o,a,l),F.width=o,F.height=a,F}return n.width=o||e[2]-e[0],n.height=a||e[3]-e[1],n}async readRasters({window:e,samples:t=[],interleave:n,pool:i=null,width:s,height:o,resampleMethod:a,fillValue:l,signal:u}={}){const h=e||[0,0,this.getWidth(),this.getHeight()];if(h[0]>h[2]||h[1]>h[3])throw new Error("Invalid subsets");const f=h[2]-h[0],d=h[3]-h[1],g=f*d,m=this.getSamplesPerPixel();if(!t||!t.length)for(let E=0;E<m;++E)t.push(E);else for(let E=0;E<t.length;++E)if(t[E]>=m)return Promise.reject(new RangeError(`Invalid sample index '${t[E]}'.`));let y;if(n){const E=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,v=Math.max.apply(null,this.fileDirectory.BitsPerSample);y=Di(E,v,g*t.length),l&&y.fill(l)}else{y=[];for(let E=0;E<t.length;++E){const v=this.getArrayForSample(t[E],g);Array.isArray(l)&&E<l.length?v.fill(l[E]):l&&!Array.isArray(l)&&v.fill(l),y.push(v)}}const x=i||await Vl(this.fileDirectory);return await this._readRaster(h,t,y,n,x,s,o,a,u)}async readRGB({window:e,interleave:t=!0,pool:n=null,width:i,height:s,resampleMethod:o,enableAlpha:a=!1,signal:l}={}){const u=e||[0,0,this.getWidth(),this.getHeight()];if(u[0]>u[2]||u[1]>u[3])throw new Error("Invalid subsets");const h=this.fileDirectory.PhotometricInterpretation;if(h===Be.RGB){let w=[0,1,2];if(this.fileDirectory.ExtraSamples!==d_.Unspecified&&a){w=[];for(let E=0;E<this.fileDirectory.BitsPerSample.length;E+=1)w.push(E)}return this.readRasters({window:e,interleave:t,samples:w,pool:n,width:i,height:s,resampleMethod:o,signal:l})}let f;switch(h){case Be.WhiteIsZero:case Be.BlackIsZero:case Be.Palette:f=[0];break;case Be.CMYK:f=[0,1,2,3];break;case Be.YCbCr:case Be.CIELab:f=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const d={window:u,interleave:!0,samples:f,pool:n,width:i,height:s,resampleMethod:o,signal:l},{fileDirectory:g}=this,m=await this.readRasters(d),y=2**this.fileDirectory.BitsPerSample[0];let x;switch(h){case Be.WhiteIsZero:x=g_(m,y);break;case Be.BlackIsZero:x=m_(m,y);break;case Be.Palette:x=__(m,g.ColorMap);break;case Be.CMYK:x=y_(m);break;case Be.YCbCr:x=x_(m);break;case Be.CIELab:x=v_(m);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const w=new Uint8Array(x.length/3),E=new Uint8Array(x.length/3),v=new Uint8Array(x.length/3);for(let S=0,A=0;S<x.length;S+=3,++A)w[A]=x[S],E[A]=x[S+1],v[A]=x[S+2];x=[w,E,v]}return x.width=m.width,x.height=m.height,x}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const n=this.fileDirectory.GDAL_METADATA;let i=h_(n,"Item");e===null?i=i.filter(s=>ci(s,"sample")===void 0):i=i.filter(s=>Number(ci(s,"sample"))===e);for(let s=0;s<i.length;++s){const o=i[s];t[ci(o,"name")]=o.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,n=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(n)return[n[0],-n[5],n[10]];if(e){const[i,s,o]=e.getResolution();return[i*e.getWidth()/this.getWidth(),s*e.getHeight()/this.getHeight(),o*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(){const e=this.getHeight(),t=this.getWidth();if(this.fileDirectory.ModelTransformation){const[n,i,s,o,a,l,u,h]=this.fileDirectory.ModelTransformation,d=[[0,0],[0,e],[t,0],[t,e]].map(([y,x])=>[o+n*y+i*x,h+a*y+l*x]),g=d.map(y=>y[0]),m=d.map(y=>y[1]);return[Math.min(...g),Math.min(...m),Math.max(...g),Math.max(...m)]}else{const n=this.getOrigin(),i=this.getResolution(),s=n[0],o=n[1],a=s+i[0]*this.getWidth(),l=o+i[1]*this.getHeight();return[Math.min(s,a),Math.min(o,l),Math.max(s,a),Math.max(o,l)]}}}class M_{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const n=this.getUint32(e,t),i=this.getUint32(e+4,t);let s;if(t){if(s=n+2**32*i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*n+i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}getInt64(e,t){let n=0;const i=(this._dataView.getUint8(e+(t?7:0))&128)>0;let s=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(e+(t?o:7-o));i&&(s?a!==0&&(a=~(a-1)&255,s=!1):a=~a&255),n+=a*256**o}return i&&(n=-n),n}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return Gl(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class F_{constructor(e,t,n,i){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=n,this._bigTiff=i}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),n=this.readUint32(e+4);let i;if(this._littleEndian){if(i=t+2**32*n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*t+n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}readInt64(e){let t=0;const n=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let i=!0;for(let s=0;s<8;s++){let o=this._dataView.getUint8(e+(this._littleEndian?s:7-s));n&&(i?o!==0&&(o=~(o-1)&255,i=!1):o=~o&255),t+=o*256**s}return n&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const N_=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class D_{constructor(e=N_,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise(n=>{Mt(()=>import("./decoder-Ddo2r026.js"),__vite__mapDeps([15,8]),import.meta.url).then(i=>{n(i.create)})}),this._awaitingDecoder.then(n=>{this._awaitingDecoder=null,this.workers=[];for(let i=0;i<e;i++)this.workers.push({worker:n(),idle:!0})}))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?Vl(e).then(n=>n.decode(e,t)):new Promise(n=>{const i=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];i.idle=!1;const s=this.messageId++,o=a=>{a.data.id===s&&(i.idle=!0,n(a.data.decoded),i.worker.removeEventListener("message",o))};i.worker.addEventListener("message",o),i.worker.postMessage({fileDirectory:e,buffer:t,id:s},[t])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const na=`\r
\r
`;function Hl(r){if(typeof Object.fromEntries<"u")return Object.fromEntries(r);const e={};for(const[t,n]of r)e[t.toLowerCase()]=n;return e}function G_(r){const e=r.split(`\r
`).map(t=>{const n=t.split(":").map(i=>i.trim());return n[0]=n[0].toLowerCase(),n});return Hl(e)}function U_(r){const[e,...t]=r.split(";").map(i=>i.trim()),n=t.map(i=>i.split("="));return{type:e,params:Hl(n)}}function Gi(r){let e,t,n;return r&&([,e,t,n]=r.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),t=parseInt(t,10),n=parseInt(n,10)),{start:e,end:t,total:n}}function B_(r,e){let t=null;const n=new TextDecoder("ascii"),i=[],s=`--${e}`,o=`${s}--`;for(let a=0;a<10;++a)n.decode(new Uint8Array(r,a,s.length))===s&&(t=a);if(t===null)throw new Error("Could not find initial boundary");for(;t<r.byteLength;){const a=n.decode(new Uint8Array(r,t,Math.min(s.length+1024,r.byteLength-t)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(s))throw new Error("Part does not start with boundary");const l=a.substr(s.length+2);if(l.length===0)break;const u=l.indexOf(na),h=G_(l.substr(0,u)),{start:f,end:d,total:g}=Gi(h["content-range"]),m=t+s.length+u+na.length,y=parseInt(d,10)+1-parseInt(f,10);i.push({headers:h,data:r.slice(m,m+y),offset:f,length:y,fileSize:g}),t=m+y+4}return i}class $s{async fetch(e,t=void 0){return Promise.all(e.map(n=>this.fetchSlice(n,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class z_ extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,n]of e)this.onEviction(t,n.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const n=t.get(e);return this._getItemValue(e,n)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield e)}for(const e of this.cache){const[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:n=this.maxAge}={}){const i=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],n=t.length-e;n<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(n>0&&this._emitEvictions(t.slice(0,n)),this.oldCache=new Map(t.slice(n)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}for(const e of this.oldCache){const[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const n=e[t],[i,s]=n;this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const n=e[t],[i,s]=n;this.cache.has(i)||this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[n,i]of this.entriesAscending())e.call(t,i,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function k_(r){return new Promise(e=>setTimeout(e,r))}function $_(r,e){const t=Array.isArray(r)?r:Array.from(r),n=Array.isArray(e)?e:Array.from(e);return t.map((i,s)=>[i,n[s]])}class hr extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,hr),this.name="AbortError"}}class j_ extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}const Z_=j_;class V_{constructor(e,t,n=null){this.offset=e,this.length=t,this.data=n}get top(){return this.offset+this.length}}class ia{constructor(e,t,n){this.offset=e,this.length=t,this.blockIds=n}}class X_ extends $s{constructor(e,{blockSize:t=65536,cacheSize:n=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new z_({maxSize:n,onEviction:(i,s)=>{this.evictedBlocks.set(i,s)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){const n=[],i=[],s=[];this.evictedBlocks.clear();for(const{offset:d,length:g}of e){let m=d+g;const{fileSize:y}=this;y!==null&&(m=Math.min(m,y));const x=Math.floor(d/this.blockSize)*this.blockSize;for(let w=x;w<m;w+=this.blockSize){const E=Math.floor(w/this.blockSize);!this.blockCache.has(E)&&!this.blockRequests.has(E)&&(this.blockIdsToFetch.add(E),i.push(E)),this.blockRequests.has(E)&&n.push(this.blockRequests.get(E)),s.push(E)}}await k_(),this.fetchBlocks(t);const o=[];for(const d of i)this.blockRequests.has(d)&&o.push(this.blockRequests.get(d));await Promise.allSettled(n),await Promise.allSettled(o);const a=[],l=s.filter(d=>this.abortedBlockIds.has(d)||!this.blockCache.has(d));if(l.forEach(d=>this.blockIdsToFetch.add(d)),l.length>0&&t&&!t.aborted){this.fetchBlocks(null);for(const d of l){const g=this.blockRequests.get(d);if(!g)throw new Error(`Block ${d} is not in the block requests`);a.push(g)}await Promise.allSettled(a)}if(t&&t.aborted)throw new hr("Request was aborted");const u=s.map(d=>this.blockCache.get(d)||this.evictedBlocks.get(d)),h=u.filter(d=>!d);if(h.length)throw new Z_(h,"Request failed");const f=new Map($_(s,u));return this.readSliceData(e,f)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const t=this.groupBlocks(this.blockIdsToFetch),n=this.source.fetch(t,e);for(let i=0;i<t.length;++i){const s=t[i];for(const o of s.blockIds)this.blockRequests.set(o,(async()=>{try{const a=(await n)[i],l=o*this.blockSize,u=l-a.offset,h=Math.min(u+this.blockSize,a.data.byteLength),f=a.data.slice(u,h),d=new V_(l,f.byteLength,f,o);this.blockCache.set(o,d),this.abortedBlockIds.delete(o)}catch(a){if(a.name==="AbortError")a.signal=e,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw a}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const t=Array.from(e).sort((o,a)=>o-a);if(t.length===0)return[];let n=[],i=null;const s=[];for(const o of t)i===null||i+1===o?(n.push(o),i=o):(s.push(new ia(n[0]*this.blockSize,n.length*this.blockSize,n)),n=[o],i=o);return s.push(new ia(n[0]*this.blockSize,n.length*this.blockSize,n)),s}readSliceData(e,t){return e.map(n=>{let i=n.offset+n.length;this.fileSize!==null&&(i=Math.min(this.fileSize,i));const s=Math.floor(n.offset/this.blockSize),o=Math.floor(i/this.blockSize),a=new ArrayBuffer(n.length),l=new Uint8Array(a);for(let u=s;u<=o;++u){const h=t.get(u),f=h.offset-n.offset,d=h.top-i;let g=0,m=0,y;f<0?g=-f:f>0&&(m=f),d<0?y=h.length-g:y=i-h.offset-g;const x=new Uint8Array(h.data,g,y);l.set(x,m)}return a})}}class js{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class Zs{constructor(e){this.url=e}async request({headers:e,credentials:t,signal:n}={}){throw new Error("request is not implemented")}}class H_ extends js{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class W_ extends Zs{constructor(e,t){super(e),this.credentials=t}async request({headers:e,credentials:t,signal:n}={}){const i=await fetch(this.url,{headers:e,credentials:t,signal:n});return new H_(i)}}class Y_ extends js{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class q_ extends Zs{constructRequest(e,t){return new Promise((n,i)=>{const s=new XMLHttpRequest;s.open("GET",this.url),s.responseType="arraybuffer";for(const[o,a]of Object.entries(e))s.setRequestHeader(o,a);s.onload=()=>{const o=s.response;n(new Y_(s,o))},s.onerror=i,s.onabort=()=>i(new hr("Request aborted")),s.send(),t&&(t.aborted&&s.abort(),t.addEventListener("abort",()=>s.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}const di={};class K_ extends js{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class Q_ extends Zs{constructor(e){super(e),this.parsedUrl=di.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",di)}constructRequest(e,t){return new Promise((n,i)=>{const s=this.httpApi.get({...this.parsedUrl,headers:e},o=>{const a=new Promise(l=>{const u=[];o.on("data",h=>{u.push(h)}),o.on("end",()=>{const h=Buffer.concat(u).buffer;l(h)}),o.on("error",i)});n(new K_(o,a))});s.on("error",i),t&&(t.aborted&&s.destroy(new hr("Request aborted")),t.addEventListener("abort",()=>s.destroy(new hr("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class Vs extends $s{constructor(e,t,n,i){super(),this.client=e,this.headers=t,this.maxRanges=n,this.allowFullFile=i,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length>1,Promise.all(e.map(n=>this.fetchSlice(n,t))))}async fetchSlices(e,t){const n=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:i,length:s})=>`${i}-${i+s}`).join(",")}`},signal:t});if(n.ok)if(n.status===206){const{type:i,params:s}=U_(n.getHeader("content-type"));if(i==="multipart/byteranges"){const f=B_(await n.getData(),s.boundary);return this._fileSize=f[0].fileSize||null,f}const o=await n.getData(),{start:a,end:l,total:u}=Gi(n.getHeader("content-range"));this._fileSize=u||null;const h=[{data:o,offset:a,length:l-a}];if(e.length>1){const f=await Promise.all(e.slice(1).map(d=>this.fetchSlice(d,t)));return h.concat(f)}return h}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const i=await n.getData();return this._fileSize=i.byteLength,[{data:i,offset:0,length:i.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,t){const{offset:n,length:i}=e,s=await this.client.request({headers:{...this.headers,Range:`bytes=${n}-${n+i}`},signal:t});if(s.ok)if(s.status===206){const o=await s.getData(),{total:a}=Gi(s.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:n,length:i}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await s.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function Xs(r,{blockSize:e,cacheSize:t}){return e===null?r:new X_(r,{blockSize:e,cacheSize:t})}function J_(r,{headers:e={},credentials:t,maxRanges:n=0,allowFullFile:i=!1,...s}={}){const o=new W_(r,t),a=new Vs(o,e,n,i);return Xs(a,s)}function ey(r,{headers:e={},maxRanges:t=0,allowFullFile:n=!1,...i}={}){const s=new q_(r),o=new Vs(s,e,t,n);return Xs(o,i)}function ty(r,{headers:e={},maxRanges:t=0,allowFullFile:n=!1,...i}={}){const s=new Q_(r),o=new Vs(s,e,t,n);return Xs(o,i)}function Ui(r,{forceXHR:e=!1,...t}={}){return typeof fetch=="function"&&!e?J_(r,t):typeof XMLHttpRequest<"u"?ey(r,t):ty(r,t)}class ry extends $s{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise((n,i)=>{const s=this.file.slice(e.offset,e.offset+e.length),o=new FileReader;o.onload=a=>n(a.target.result),o.onerror=i,o.onabort=i,o.readAsArrayBuffer(s),t&&t.addEventListener("abort",()=>o.abort())})}}function ny(r){return new ry(r)}function Bi(r){switch(r){case te.BYTE:case te.ASCII:case te.SBYTE:case te.UNDEFINED:return 1;case te.SHORT:case te.SSHORT:return 2;case te.LONG:case te.SLONG:case te.FLOAT:case te.IFD:return 4;case te.RATIONAL:case te.SRATIONAL:case te.DOUBLE:case te.LONG8:case te.SLONG8:case te.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${r}`)}}function iy(r){const e=r.GeoKeyDirectory;if(!e)return null;const t={};for(let n=4;n<=e[3]*4;n+=4){const i=p_[e[n]],s=e[n+1]?Mr[e[n+1]]:null,o=e[n+2],a=e[n+3];let l=null;if(!s)l=a;else{if(l=r[s],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${i}'.`);typeof l=="string"?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),o===1&&(l=l[0]))}t[i]=l}return t}function Yt(r,e,t,n){let i=null,s=null;const o=Bi(e);switch(e){case te.BYTE:case te.ASCII:case te.UNDEFINED:i=new Uint8Array(t),s=r.readUint8;break;case te.SBYTE:i=new Int8Array(t),s=r.readInt8;break;case te.SHORT:i=new Uint16Array(t),s=r.readUint16;break;case te.SSHORT:i=new Int16Array(t),s=r.readInt16;break;case te.LONG:case te.IFD:i=new Uint32Array(t),s=r.readUint32;break;case te.SLONG:i=new Int32Array(t),s=r.readInt32;break;case te.LONG8:case te.IFD8:i=new Array(t),s=r.readUint64;break;case te.SLONG8:i=new Array(t),s=r.readInt64;break;case te.RATIONAL:i=new Uint32Array(t*2),s=r.readUint32;break;case te.SRATIONAL:i=new Int32Array(t*2),s=r.readInt32;break;case te.FLOAT:i=new Float32Array(t),s=r.readFloat32;break;case te.DOUBLE:i=new Float64Array(t),s=r.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===te.RATIONAL||e===te.SRATIONAL)for(let a=0;a<t;a+=2)i[a]=s.call(r,n+a*o),i[a+1]=s.call(r,n+(a*o+4));else for(let a=0;a<t;++a)i[a]=s.call(r,n+a*o);return e===te.ASCII?new TextDecoder("utf-8").decode(i):i}class sy{constructor(e,t,n){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=n}}class ln extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class Wl{async readRasters(e={}){const{window:t,width:n,height:i}=e;let{resX:s,resY:o,bbox:a}=e;const l=await this.getImage();let u=l;const h=await this.getImageCount(),f=l.getBoundingBox();if(t&&a)throw new Error('Both "bbox" and "window" passed.');if(n||i){if(t){const[m,y]=l.getOrigin(),[x,w]=l.getResolution();a=[m+t[0]*x,y+t[1]*w,m+t[2]*x,y+t[3]*w]}const g=a||f;if(n){if(s)throw new Error("Both width and resX passed");s=(g[2]-g[0])/n}if(i){if(o)throw new Error("Both width and resY passed");o=(g[3]-g[1])/i}}if(s||o){const g=[];for(let m=0;m<h;++m){const y=await this.getImage(m),{SubfileType:x,NewSubfileType:w}=y.fileDirectory;(m===0||x===2||w&1)&&g.push(y)}g.sort((m,y)=>m.getWidth()-y.getWidth());for(let m=0;m<g.length;++m){const y=g[m],x=(f[2]-f[0])/y.getWidth(),w=(f[3]-f[1])/y.getHeight();if(u=y,s&&s>x||o&&o>w)break}}let d=t;if(a){const[g,m]=l.getOrigin(),[y,x]=u.getResolution(l);d=[Math.round((a[0]-g)/y),Math.round((a[1]-m)/x),Math.round((a[2]-g)/y),Math.round((a[3]-m)/x)],d=[Math.min(d[0],d[2]),Math.min(d[1],d[3]),Math.max(d[0],d[2]),Math.max(d[1],d[3])]}return u.readRasters({...e,window:d})}}class fr extends Wl{constructor(e,t,n,i,s={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=n,this.firstIFDOffset=i,this.cache=s.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const n=this.bigTiff?4048:1024;return new F_((await this.source.fetch([{offset:e,length:typeof t<"u"?t:n}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,n=this.bigTiff?8:2;let i=await this.getSlice(e);const s=this.bigTiff?i.readUint64(e):i.readUint16(e),o=s*t+(this.bigTiff?16:6);i.covers(e,o)||(i=await this.getSlice(e,o));const a={};let l=e+(this.bigTiff?8:2);for(let f=0;f<s;l+=t,++f){const d=i.readUint16(l),g=i.readUint16(l+2),m=this.bigTiff?i.readUint64(l+4):i.readUint32(l+4);let y,x;const w=Bi(g),E=l+(this.bigTiff?12:8);if(w*m<=(this.bigTiff?8:4))y=Yt(i,g,m,E);else{const v=i.readOffset(E),S=Bi(g)*m;if(i.covers(v,S))y=Yt(i,g,m,v);else{const A=await this.getSlice(v,S);y=Yt(A,g,m,v)}}m===1&&f_.indexOf(d)===-1&&!(g===te.RATIONAL||g===te.SRATIONAL)?x=y[0]:x=y,a[Mr[d]]=x}const u=iy(a),h=i.readOffset(e+n+t*s);return new sy(a,u,h)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){throw t instanceof ln?new ln(e):t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(t.nextIFDByteOffset===0)throw new ln(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new Xl(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(n){if(n instanceof ln)t=!1;else throw n}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",n=t.length+100;let i=await this.getSlice(e,n);if(t===Yt(i,te.ASCII,t.length,e)){const o=Yt(i,te.ASCII,n,e).split(`
`)[0],a=Number(o.split("=")[1].split(" ")[0])+o.length;a>n&&(i=await this.getSlice(e,a));const l=Yt(i,te.ASCII,a,e);this.ghostValues={},l.split(`
`).filter(u=>u.length>0).map(u=>u.split("=")).forEach(([u,h])=>{this.ghostValues[u]=h})}return this.ghostValues}static async fromSource(e,t,n){const i=(await e.fetch([{offset:0,length:1024}],n))[0],s=new M_(i),o=s.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const l=s.getUint16(2,a);let u;if(l===42)u=!1;else if(l===43){if(u=!0,s.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const h=u?s.getUint64(8,a):s.getUint32(4,a);return new fr(e,a,u,h,t)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class oy extends Wl{constructor(e,t){super(),this.mainFile=e,this.overviewFiles=t,this.imageFiles=[e].concat(t),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(t=>t.parseFileDirectoryAt(t.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let t=0,n=0;for(let i=0;i<this.imageFiles.length;i++){const s=this.imageFiles[i];for(let o=0;o<this.imageCounts[i];o++){if(e===t){const a=await s.requestIFD(n);return new Xl(a.fileDirectory,a.geoKeyDirectory,s.dataView,s.littleEndian,s.cache,s.source)}t++,n++}n=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(t=>t.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((t,n)=>t+n,0),this.imageCount}}async function ay(r,e={},t){return fr.fromSource(Ui(r,e),t)}async function ly(r,e){return fr.fromSource(ny(r),e)}async function uy(r,e=[],t={},n){const i=await fr.fromSource(Ui(r,t),n),s=await Promise.all(e.map(o=>fr.fromSource(Ui(o,t))));return new oy(i,s)}function cy(r){return((r.fileDirectory.NewSubfileType||0)&4)===4}function hy(r,e){if(!r)return!1;if(r===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const t=e.fileDirectory.PhotometricInterpretation,n=Be;return t===n.CMYK||t===n.YCbCr||t===n.CIELab||t===n.ICCLab}const sa="STATISTICS_MAXIMUM",oa="STATISTICS_MINIMUM",pi=256;let gi;function fy(){return gi||(gi=new D_),gi}function dy(r){try{return r.getBoundingBox()}catch{return[0,0,r.getWidth(),r.getHeight()]}}function py(r){try{return r.getOrigin().slice(0,2)}catch{return[0,r.getHeight()]}}function gy(r,e){try{return r.getResolution(e)}catch{return[e.getWidth()/r.getWidth(),e.getHeight()/r.getHeight()]}}function my(r){const e=r.geoKeys;if(!e)return null;if(e.ProjectedCSTypeGeoKey&&e.ProjectedCSTypeGeoKey!==32767){const t="EPSG:"+e.ProjectedCSTypeGeoKey;let n=_e(t);if(!n){const i=co(e.ProjLinearUnitsGeoKey);i&&(n=new ho({code:t,units:i}))}return n}if(e.GeographicTypeGeoKey&&e.GeographicTypeGeoKey!==32767){const t="EPSG:"+e.GeographicTypeGeoKey;let n=_e(t);if(!n){const i=co(e.GeogAngularUnitsGeoKey);i&&(n=new ho({code:t,units:i}))}return n}return null}function _y(r){return r.getImageCount().then(function(e){const t=new Array(e);for(let n=0;n<e;++n)t[n]=r.getImage(n);return Promise.all(t)})}function yy(r,e){let t;return r.blob?t=ly(r.blob):r.overviews?t=uy(r.url,r.overviews,e):t=ay(r.url,e),t.then(_y)}function Ar(r,e,t,n,i){if(Array.isArray(r)){const s=r.length;if(!Array.isArray(e)||s!=e.length){const o=new Error(n);throw i(o),o}for(let o=0;o<s;++o)Ar(r[o],e[o],t,n,i);return}if(e=e,Math.abs(r-e)>t*r)throw new Error(n)}function xy(r){return r instanceof Int8Array?-128:r instanceof Int16Array?-32768:r instanceof Int32Array?-2147483648:r instanceof Float32Array?12e-39:0}function Ey(r){return r instanceof Int8Array?127:r instanceof Uint8Array||r instanceof Uint8ClampedArray?255:r instanceof Int16Array?32767:r instanceof Uint16Array?65535:r instanceof Int32Array?2147483647:r instanceof Uint32Array?4294967295:r instanceof Float32Array?34e37:255}class Hs extends Ls{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,opaque:e.opaque,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map(s=>s.url).join(","));const n=this,i=new Array(t);for(let s=0;s<t;++s)i[s]=yy(this.sourceInfo_[s],this.sourceOptions_);Promise.all(i).then(function(s){n.configure_(s)}).catch(function(s){Tn(s),n.error_=s,n.setState("error")})}getError(){return this.error_}determineProjection(e){const t=e[0];for(let n=t.length-1;n>=0;--n){const i=t[n],s=my(i);if(s){this.projection=s;break}}}configure_(e){let t,n,i,s,o;const a=new Array(e.length),l=new Array(e.length),u=new Array(e.length);let h=0;const f=e.length;for(let y=0;y<f;++y){const x=[],w=[];e[y].forEach(F=>{cy(F)?w.push(F):x.push(F)});const E=x.length;if(w.length>0&&w.length!==E)throw new Error(`Expected one mask per image found ${w.length} masks and ${E} images`);let v,S;const A=new Array(E),O=new Array(E),L=new Array(E);l[y]=new Array(E),u[y]=new Array(E);for(let F=0;F<E;++F){const U=x[F],k=U.getGDALNoData();u[y][F]=U.getGDALMetadata(0),l[y][F]=k;const V=this.sourceInfo_[y].bands;a[y]=V?V.length:U.getSamplesPerPixel();const ee=E-(F+1);v||(v=dy(U)),S||(S=py(U));const c=gy(U,x[0]);L[ee]=c[0];const p=[U.getTileWidth(),U.getTileHeight()];p[0]!==p[1]&&p[1]<pi&&(p[0]=pi,p[1]=pi),A[ee]=p;const _=c[0]/Math.abs(c[1]);O[ee]=[p[0],p[1]/_]}if(t?ht(t,v,t):t=v,!n)n=S;else{const F=`Origin mismatch for source ${y}, got [${S}] but expected [${n}]`;Ar(n,S,0,F,this.viewRejector)}if(!o)o=L,this.resolutionFactors_[y]=1;else{o.length-h>L.length&&(h=o.length-L.length);const F=o[o.length-1]/L[L.length-1];this.resolutionFactors_[y]=F;const U=L.map(V=>V*=F),k=`Resolution mismatch for source ${y}, got [${U}] but expected [${o}]`;Ar(o.slice(h,o.length),U,.02,k,this.viewRejector)}i?Ar(i.slice(h,i.length),O,.01,`Tile size mismatch for source ${y}`,this.viewRejector):i=O,s?Ar(s.slice(h,s.length),A,0,`Tile size mismatch for source ${y}`,this.viewRejector):s=A,this.sourceImagery_[y]=x.reverse(),this.sourceMasks_[y]=w.reverse()}for(let y=0,x=this.sourceImagery_.length;y<x;++y){const w=this.sourceImagery_[y];for(;w.length<o.length;)w.unshift(void 0)}this.getProjection()||this.determineProjection(e),this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=u;e:for(let y=0;y<f;++y){if(this.sourceInfo_[y].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[y].length){this.addAlpha_=!0;break}const x=l[y],w=this.sourceInfo_[y].bands;if(w){for(let E=0;E<w.length;++E)if(x[w[E]-1]!==null){this.addAlpha_=!0;break e}continue}for(let E=0;E<x.length;++E)if(x[E]!==null){this.addAlpha_=!0;break e}}let d=this.addAlpha_?1:0;for(let y=0;y<f;++y)d+=a[y];this.bandCount=d;const g=new Un({extent:t,minZoom:h,origin:n,resolutions:o,tileSizes:i});this.tileGrid=g,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const m=1;o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[o[0]*2,o[0],o[0]/2]),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:Dc(It(t),this.projection),extent:Gc(t,this.projection),zoom:m})}loadTile_(e,t,n){const i=this.getTileSize(e),s=this.sourceImagery_.length,o=new Array(s*2),a=this.nodataValues_,l=this.sourceInfo_,u=fy();for(let h=0;h<s;++h){const f=l[h],d=this.resolutionFactors_[h],g=[Math.round(t*(i[0]*d)),Math.round(n*(i[1]*d)),Math.round((t+1)*(i[0]*d)),Math.round((n+1)*(i[1]*d))],m=this.sourceImagery_[h][e];let y;f.bands&&(y=f.bands.map(function(S){return S-1}));let x;"nodata"in f&&f.nodata!==null?x=f.nodata:y?x=y.map(function(S){return a[h][S]}):x=a[h];const w={window:g,width:i[0],height:i[1],samples:y,fillValue:x,pool:u,interleave:!1};hy(this.convertToRGB_,m)?o[h]=m.readRGB(w):o[h]=m.readRasters(w);const E=s+h,v=this.sourceMasks_[h][e];if(!v){o[E]=Promise.resolve(null);continue}o[E]=v.readRasters({window:g,width:i[0],height:i[1],samples:[0],pool:u,interleave:!1})}return Promise.all(o).then(this.composeTile_.bind(this,i)).catch(function(h){throw Tn(h),h})}composeTile_(e,t){const n=this.metadata_,i=this.sourceInfo_,s=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,u=this.normalize_,h=this.addAlpha_,f=e[0]*e[1],d=f*o;let g;u?g=new Uint8Array(d):g=new Float32Array(d);let m=0;for(let y=0;y<f;++y){let x=h;for(let w=0;w<s;++w){const E=i[w];let v=E.min,S=E.max,A,O;if(u){const L=n[w][0];v===void 0&&(L&&oa in L?v=parseFloat(L[oa]):v=xy(t[w][0])),S===void 0&&(L&&sa in L?S=parseFloat(L[sa]):S=Ey(t[w][0])),A=255/(S-v),O=-v*A}for(let L=0;L<a[w];++L){const F=t[w][L][y];let U;if(u?U=ve(A*F+O,0,255):U=F,!h)g[m]=U;else{let k=E.nodata;if(k===void 0){let ee;E.bands?ee=E.bands[L]-1:ee=L,k=l[w][ee]}const V=isNaN(k);(!V&&F!==k||V&&!isNaN(F))&&(x=!1,g[m]=U)}m++}if(!x){const L=s+w,F=t[L];F&&!F[0][y]&&(x=!0)}}h&&(x||(g[m]=255),m++)}return g}}Hs.prototype.getView;const wy="https://tile.googleapis.com/v1/createSession",Ty="https://tile.googleapis.com/v1/2dtiles",vy="https://tile.googleapis.com/tile/v1/viewport",Sy=22;class Ry extends vt{constructor(e){const t=!!e.highDpi,n=e.overlay!==!0;super({attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,opaque:n,projection:"EPSG:3857",reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.apiKey_=e.key,this.error_=null;const i={mapType:e.mapType||"roadmap",language:e.language||"en-US",region:e.region||"US"};e.imageFormat&&(i.imageFormat=e.imageFormat),e.scale&&(i.scale=e.scale),t&&(i.highDpi=!0),e.layerTypes&&(i.layerTypes=e.layerTypes),e.styles&&(i.styles=e.styles),e.overlay===!0&&(i.overlay=!0),this.sessionTokenRequest_=i,this.sessionTokenValue_,this.sessionRefreshId_,this.previousViewportAttribution_,this.previousViewportExtent_,this.createSession_()}getError(){return this.error_}fetchSessionToken(e,t){return fetch(e,t)}async createSession_(){const e=wy+"?key="+this.apiKey_,t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.sessionTokenRequest_)},n=await this.fetchSessionToken(e,t);if(!n.ok){try{const f=await n.json();this.error_=new Error(f.error.message)}catch{this.error_=new Error("Error fetching session token")}this.setState("error");return}const i=await n.json(),s=this.getTilePixelRatio(1),o=[i.tileWidth/s,i.tileHeight/s];this.tileGrid=Wr({extent:Hr(this.getProjection()),maxZoom:Sy,tileSize:o});const a=i.session;this.sessionTokenValue_=a;const l=this.apiKey_;this.tileUrlFunction=function(f,d,g){const m=f[0],y=f[1],x=f[2];return`${Ty}/${m}/${y}/${x}?session=${a}&key=${l}`};const u=parseInt(i.expiry,10)*1e3,h=Math.max(u-Date.now()-60*1e3,1);this.sessionRefreshId_=setTimeout(()=>this.createSession_(),h),this.setAttributions(this.fetchAttributions_.bind(this)),this.setState("ready")}async fetchAttributions_(e){if(e.viewHints[lr.ANIMATING]||e.viewHints[lr.INTERACTING]||e.animate)return this.previousViewportAttribution_;const[t,n]=fo(Uc(e.extent),e.viewState.projection),[i,s]=fo(Bc(e.extent),e.viewState.projection),l=`zoom=${this.getTileGrid().getZForResolution(e.viewState.resolution,this.zDirection)}&north=${s}&south=${n}&east=${i}&west=${t}`;if(this.previousViewportExtent_==l)return this.previousViewportAttribution_;this.previousViewportExtent_=l;const u=this.sessionTokenValue_,h=this.apiKey_,f=`${vy}?session=${u}&key=${h}&${l}`;return this.previousViewportAttribution_=await fetch(f).then(d=>d.json()).then(d=>d.copyright),this.previousViewportAttribution_}disposeInternal(){clearTimeout(this.sessionRefreshId_),super.disposeInternal()}}const by=Ry;let Yl=class extends Qi{constructor(e,t,n,i,s,o,a){super(t,n,i,s,o,a),this.zoomifyImage_=null,this.tileSize_=e}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=super.getImage();if(this.state==q.LOADED){const t=this.tileSize_;if(e.width==t[0]&&e.height==t[1])return this.zoomifyImage_=e,e;const n=wt(t[0],t[1]);return n.drawImage(e,0,0),this.zoomifyImage_=n.canvas,n.canvas}return e}};class Py extends vt{constructor(e){const t=e.size,n=e.tierSizeCalculation!==void 0?e.tierSizeCalculation:"default",i=e.tilePixelRatio||1,s=t[0],o=t[1],a=[],l=e.tileSize||Pi;let u=l*i;switch(n){case"default":for(;s>u||o>u;)a.push([Math.ceil(s/u),Math.ceil(o/u)]),u+=u;break;case"truncated":let O=s,L=o;for(;O>u||L>u;)a.push([Math.ceil(O/u),Math.ceil(L/u)]),O>>=1,L>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}a.push([1,1]),a.reverse();const h=[i],f=[0];for(let O=1,L=a.length;O<L;O++)h.push(i<<O),f.push(a[O-1][0]*a[O-1][1]+f[O-1]);h.reverse();const d=new Un({tileSize:l,extent:e.extent||[0,-o,s,0],resolutions:h});let g=e.url;g&&!g.includes("{TileGroup}")&&!g.includes("{tileIndex}")&&(g+="{TileGroup}/{z}-{x}-{y}.jpg");const m=zc(g);let y=l*i;function x(O){return function(L,F,U){if(!L)return;const k=L[0],V=L[1],ee=L[2],c=V+ee*a[k][0],p=(c+f[k])/y|0,_={z:k,x:V,y:ee,tileIndex:c,TileGroup:"TileGroup"+p};return O.replace(/\{(\w+?)\}/g,function(T,I){return _[I]})}}const w=ts(m.map(x)),E=Yl.bind(null,ft(l*i));super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,tilePixelRatio:i,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:E,tileGrid:d,tileUrlFunction:w,transition:e.transition}),this.zDirection=e.zDirection;const v=d.getTileCoordForCoordAndResolution(It(d.getExtent()),h[h.length-1]),S=w(v,1,null),A=new Image;A.addEventListener("error",()=>{y=l,this.changed()}),A.src=S}}const Ay=Py;function vr(r){return r.toLocaleString("en",{maximumFractionDigits:10})}class Iy extends vt{constructor(e){const t=e||{};let n=t.url||"";n=n+(n.lastIndexOf("/")===n.length-1||n===""?"":"/");const i=t.version||Ae.VERSION2,s=t.sizes||[],o=t.size;pt(o!=null&&Array.isArray(o)&&o.length==2&&!isNaN(o[0])&&o[0]>0&&!isNaN(o[1])&&o[1]>0,"Missing or invalid `size`");const a=o[0],l=o[1],u=t.tileSize,h=t.tilePixelRatio||1,f=t.format||"jpg",d=t.quality||(t.version==Ae.VERSION1?"native":"default");let g=t.resolutions||[];const m=t.supports||[],y=t.extent||[0,-l,a,0],x=s!=null&&Array.isArray(s)&&s.length>0,w=u!==void 0&&(typeof u=="number"&&Number.isInteger(u)&&u>0||Array.isArray(u)&&u.length>0),E=m!=null&&Array.isArray(m)&&(m.includes("regionByPx")||m.includes("regionByPct"))&&(m.includes("sizeByWh")||m.includes("sizeByH")||m.includes("sizeByW")||m.includes("sizeByPct"));let v,S,A;if(g.sort(function(U,k){return k-U}),w||E)if(u!=null&&(typeof u=="number"&&Number.isInteger(u)&&u>0?(v=u,S=u):Array.isArray(u)&&u.length>0&&((u.length==1||u[1]==null&&Number.isInteger(u[0]))&&(v=u[0],S=u[0]),u.length==2&&(Number.isInteger(u[0])&&Number.isInteger(u[1])?(v=u[0],S=u[1]):u[0]==null&&Number.isInteger(u[1])&&(v=u[1],S=u[1])))),(v===void 0||S===void 0)&&(v=Pi,S=Pi),g.length==0){A=Math.max(Math.ceil(Math.log(a/v)/Math.LN2),Math.ceil(Math.log(l/S)/Math.LN2));for(let U=A;U>=0;U--)g.push(Math.pow(2,U))}else{const U=Math.max(...g);A=Math.round(Math.log(U)/Math.LN2)}else if(v=a,S=l,g=[],x){s.sort(function(k,V){return k[0]-V[0]}),A=-1;const U=[];for(let k=0;k<s.length;k++){const V=a/s[k][0];if(g.length>0&&g[g.length-1]==V){U.push(k);continue}g.push(V),A++}if(U.length>0)for(let k=0;k<U.length;k++)s.splice(U[k]-k,1)}else g.push(1),s.push([a,l]),A=0;const O=new Un({tileSize:[v,S],extent:y,origin:kc(y),resolutions:g}),L=function(U,k,V){let ee,c;const p=U[0];if(p>A)return;const _=U[1],T=U[2],I=g[p];if(!(_===void 0||T===void 0||I===void 0||_<0||Math.ceil(a/I/v)<=_||T<0||Math.ceil(l/I/S)<=T)){if(E||w){const C=_*v*I,M=T*S*I;let N=v*I,z=S*I,X=v,ae=S;if(C+N>a&&(N=a-C),M+z>l&&(z=l-M),C+v*I>a&&(X=Math.floor((a-C+I-1)/I)),M+S*I>l&&(ae=Math.floor((l-M+I-1)/I)),C==0&&N==a&&M==0&&z==l)ee="full";else if(!E||m.includes("regionByPx"))ee=C+","+M+","+N+","+z;else if(m.includes("regionByPct")){const oe=vr(C/a*100),ue=vr(M/l*100),le=vr(N/a*100),ye=vr(z/l*100);ee="pct:"+oe+","+ue+","+le+","+ye}i==Ae.VERSION3&&(!E||m.includes("sizeByWh"))?c=X+","+ae:!E||m.includes("sizeByW")?c=X+",":m.includes("sizeByH")?c=","+ae:m.includes("sizeByWh")?c=X+","+ae:m.includes("sizeByPct")&&(c="pct:"+vr(100/I))}else if(ee="full",x){const C=s[p][0],M=s[p][1];i==Ae.VERSION3?C==a&&M==l?c="max":c=C+","+M:C==a?c="full":c=C+","}else c=i==Ae.VERSION3?"max":"full";return n+ee+"/"+c+"/0/"+d+"."+f}},F=Yl.bind(null,ft(u||256).map(function(U){return U*h}));super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:t.state,tileClass:F,tileGrid:O,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:L,transition:t.transition}),this.zDirection=t.zDirection}}const Ly=Iy;function ql(r,e,t,n,i,s){const o=i.getCode().split(/:(?=\d+$)/).pop(),a=t/n,l=[po(He(e)/a,go),po(Ot(e)/a,go)];s.SIZE=l[0]+","+l[1],s.BBOX=e.join(","),s.BBOXSR=o,s.IMAGESR=o,s.DPI=Math.round(s.DPI?s.DPI*n:90*n);const u=r.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return vn(u,s)}function Kl(r){const e=r.load?r.load:gr,t=_e(r.projection||"EPSG:3857");return function(n,i,s){s=r.hidpi?s:1;const o={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(o,r.params),n=Ba(n,i,s,r.ratio);const a=ql(r.url,n,i,s,t,o),l=new Image;return r.crossOrigin!==null&&(l.crossOrigin=r.crossOrigin),e(l,a).then(u=>{const h=He(n)/u.width*s;return{image:u,extent:n,resolution:h,pixelRatio:s}})}}class Cy extends Vt{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:ns,this.params_=Object.assign({},e.params),this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,n,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=Kl({crossOrigin:this.crossOrigin_,params:this.params_,projection:i,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),gr(s))})),super.getImageInternal(e,t,n,i))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}const Oy=Cy;class My extends Vt{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions,state:e.state}),this.canvasFunction_=e.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5}getImageInternal(e,t,n,i){t=this.findNearestResolution(t);let s=this.canvas_;if(s&&this.renderedRevision_==this.getRevision()&&s.getResolution()==t&&s.getPixelRatio()==n&&fn(s.getExtent(),e))return s;e=e.slice(),Na(e,this.ratio_);const o=He(e)/t,a=Ot(e)/t,l=[o*n,a*n],u=this.canvasFunction_.call(this,e,t,n,l,i);return u&&(s=new bs(e,t,n,u)),this.canvas_=s,this.renderedRevision_=this.getRevision(),s}}const Fy=My;function Ny(r,e,t,n){const i=He(r),s=Ot(r),o=e[0],a=e[1],l=.0254/n;return a*i>o*s?i*t/(o*l):s*t/(a*l)}function Dy(r,e,t,n,i,s,o){const a=Ny(t,n,s,o),l=It(t),u={OPERATION:i?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:o,SETDISPLAYWIDTH:Math.round(n[0]),SETDISPLAYHEIGHT:Math.round(n[1]),SETVIEWSCALE:a,SETVIEWCENTERX:l[0],SETVIEWCENTERY:l[1]};return Object.assign(u,e),vn(r,u)}function Ql(r){const e=r.load||gr;return function(t,n,i){const s=new Image;r.crossOrigin!==null&&(s.crossOrigin=r.crossOrigin),t=Ba(t,n,i,r.ratio);const o=He(t)/n,a=Ot(t)/n,l=[o*i,a*i],u=Dy(r.url,r.params,t,l,r.useOverlay,r.metersPerUnit||1,r.displayDpi||96);return e(s,u).then(h=>({image:h,extent:t,pixelRatio:i}))}}class Gy extends Vt{constructor(e){super({interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.displayDpi_=e.displayDpi!==void 0?e.displayDpi:96,this.params_=Object.assign({},e.params),this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:ns,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.metersPerUnit_=e.metersPerUnit!==void 0?e.metersPerUnit:1,this.ratio_=e.ratio!==void 0?e.ratio:1,this.useOverlay_=e.useOverlay!==void 0?e.useOverlay:!1,this.renderedRevision_=0,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,n,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=Ql({crossOrigin:this.crossOrigin_,params:this.params_,hidpi:this.hidpi_,metersPerUnit:this.metersPerUnit_,url:this.url_,useOverlay:this.useOverlay_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),gr(s))})),super.getImageInternal(e,t,n,i))}getImageLoadFunction(){return this.imageLoadFunction_}updateParams(e){Object.assign(this.params_,e),this.changed()}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}changed(){this.image=null,super.changed()}}const Uy=Gy;function Jl(r){const e=r.load||gr,t=r.imageExtent,n=new Image;return r.crossOrigin!==null&&(n.crossOrigin=r.crossOrigin),()=>e(n,r.url).then(i=>{const s=He(t)/i.width,o=Ot(t)/i.height;return{image:i,extent:t,resolution:s!==o?[s,o]:o,pixelRatio:1}})}class eu extends Vt{constructor(e){const t=e.crossOrigin!==void 0?e.crossOrigin:null,n=e.imageLoadFunction!==void 0?e.imageLoadFunction:ns;super({attributions:e.attributions,interpolate:e.interpolate,projection:_e(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new Fa(this.imageExtent_,void 0,1,Jl({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(i,s)=>(this.image.setImage(i),n(this.image,s),gr(i))})),this.image.addEventListener($e.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,n,i){return ar(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}function Ws(r,e,t,n){const i=document.createElement("script"),s="olc_"+Pe(e);function o(){delete window[s],i.parentNode.removeChild(i)}i.async=!0,i.src=r+(r.includes("?")?"&":"?")+(n||"callback")+"="+s;const a=setTimeout(function(){o(),t&&t()},1e4);window[s]=function(l){clearTimeout(a),o(),e(l)},document.head.appendChild(i)}class By extends Error{constructor(e){const t="Unexpected response status: "+e.status;super(t),this.name="ResponseError",this.response=e}}class zy extends Error{constructor(e){super("Failed to issue request"),this.name="ClientError",this.client=e}}function tu(r){return new Promise(function(e,t){function n(o){const a=o.target;if(!a.status||a.status>=200&&a.status<300){let l;try{l=JSON.parse(a.responseText)}catch(u){const h="Error parsing response text as JSON: "+u.message;t(new Error(h));return}e(l);return}t(new By(a))}function i(o){t(new zy(o.target))}const s=new XMLHttpRequest;s.addEventListener("load",n),s.addEventListener("error",i),s.open("GET",r),s.setRequestHeader("Accept","application/json"),s.send()})}function ru(r,e){return e.includes("://")?e:new URL(e,r).href}const ky={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},$y={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function jy(r,e){let t,n;for(let i=0;i<r.length;++i){const s=r[i];if(s.rel==="item"){if(s.type===e){t=s.href;break}(ky[s.type]||!n&&s.type.startsWith("image/"))&&(n=s.href)}}if(!t)if(n)t=n;else throw new Error('Could not find "item" link');return t}function Zy(r,e,t){let n,i;const s={};for(let o=0;o<r.length;++o){const a=r[o];if(s[a.type]=a.href,a.rel==="item"){if(a.type===e){n=a.href;break}$y[a.type]&&(i=a.href)}}if(!n&&t)for(let o=0;o<t.length;++o){const a=t[o];if(s[a]){n=s[a];break}}if(!n)if(i)n=i;else throw new Error('Could not find "item" link');return n}function aa(r,e,t,n){let i=r.projection;if(!i&&(i=_e(e.crs),!i))throw new Error(`Unsupported CRS: ${e.crs}`);const s=e.orderedAxes,o=(s?s.slice(0,2).map(A=>A.replace(/E|X|Lon/i,"e").replace(/N|Y|Lat/i,"n")).join(""):i.getAxisOrientation().substr(0,2))!=="en",a=e.tileMatrices,l={};for(let A=0;A<a.length;++A){const O=a[A];l[O.id]=O}const u={},h=[];if(n)for(let A=0;A<n.length;++A){const O=n[A],L=O.tileMatrix;h.push(L),u[L]=O}else for(let A=0;A<a.length;++A){const O=a[A].id;h.push(O)}const f=h.length,d=new Array(f),g=new Array(f),m=new Array(f),y=new Array(f),x=[-1/0,-1/0,1/0,1/0];for(let A=0;A<f;++A){const O=h[A],L=l[O],F=L.pointOfOrigin;o?d[A]=[F[1],F[0]]:d[A]=F,g[A]=L.cellSize,m[A]=[L.matrixWidth,L.matrixHeight],y[A]=[L.tileWidth,L.tileHeight];const U=u[O];if(U){const k=L.cellSize*L.tileWidth,V=d[A][0]+U.minTileCol*k,ee=d[A][0]+(U.maxTileCol+1)*k,c=L.cellSize*L.tileHeight,p=L.cornerOfOrigin==="bottomLeft";let _,T;p?(_=d[A][1]+U.minTileRow*c,T=d[A][1]+(U.maxTileRow+1)*c):(_=d[A][1]-(U.maxTileRow+1)*c,T=d[A][1]-U.minTileRow*c),ht(x,[V,_,ee,T],x)}}const w=new Un({origins:d,resolutions:g,sizes:m,tileSizes:y,extent:n?x:void 0}),E=r.context,v=r.url;function S(A,O,L){if(!A)return;const F=h[A[0]],U=l[F],k=U.cornerOfOrigin==="bottomLeft",V={tileMatrix:F,tileCol:A[1],tileRow:k?-A[2]-1:A[2]};if(n){const c=u[U.id];if(V.tileCol<c.minTileCol||V.tileCol>c.maxTileCol||V.tileRow<c.minTileRow||V.tileRow>c.maxTileRow)return}Object.assign(V,E);const ee=t.replace(/\{(\w+?)\}/g,function(c,p){return V[p]});return ru(v,ee)}return{grid:w,urlTemplate:t,urlFunction:S}}function Vy(r,e){const t=e.tileMatrixSetLimits;let n;if(e.dataType==="map")n=jy(e.links,r.mediaType);else if(e.dataType==="vector")n=Zy(e.links,r.mediaType,r.supportedMediaTypes);else throw new Error('Expected tileset data type to be "map" or "vector"');if(e.tileMatrixSet)return aa(r,e.tileMatrixSet,n,t);const i=e.links.find(a=>a.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!i)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const s=i.href,o=ru(r.url,s);return tu(o).then(function(a){return aa(r,a,n,t)})}function nu(r){return tu(r.url).then(function(e){return Vy(r,e)})}class Xy extends vt{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition});const t={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,context:e.context||null};nu(t).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){Tn(e),this.setState("error")}}const Hy=Xy;class Wy extends Bn{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,format:e.format,overlaps:e.overlaps,projection:e.projection,tileClass:e.tileClass,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection,state:"loading"});const t={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,supportedMediaTypes:e.format.supportedMediaTypes,context:e.context||null};nu(t).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){Tn(e),this.setState("error")}}const Yy=Wy;let iu=!0;try{new ImageData(10,10)}catch{iu=!1}let mi;function qy(r,e,t){if(iu)return new ImageData(r,e,t);mi||(mi=document.createElement("canvas").getContext("2d"));const n=mi.createImageData(e,t);return n.data.set(r),n}function su(r){let e=!0;try{new ImageData(10,10)}catch{e=!1}function t(n,i,s){return e?new ImageData(n,i,s):{data:n,width:i,height:s}}return function(n){const i=n.buffers,s=n.meta,o=n.imageOps,a=n.width,l=n.height,u=i.length,h=i[0].byteLength;if(o){const m=new Array(u);for(let x=0;x<u;++x)m[x]=t(new Uint8ClampedArray(i[x]),a,l);return r(m,s).data.buffer}const f=new Uint8ClampedArray(h),d=new Array(u),g=new Array(u);for(let m=0;m<u;++m)d[m]=new Uint8ClampedArray(i[m]),g[m]=[0,0,0,0];for(let m=0;m<h;m+=4){for(let x=0;x<u;++x){const w=d[x];g[x][0]=w[m],g[x][1]=w[m+1],g[x][2]=w[m+2],g[x][3]=w[m+3]}const y=r(g,s);f[m]=y[0],f[m+1]=y[1],f[m+2]=y[2],f[m+3]=y[3]}return f.buffer}}function Ky(r,e){const n=Object.keys(r.lib||{}).map(function(s){return"const "+s+" = "+r.lib[s].toString()+";"}).concat(["const __minion__ = ("+su.toString()+")(",r.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),i=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(n.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(n,{type:"text/javascript"})));return i.addEventListener("message",e),i}function Qy(r,e){const t=su(r.operation);let n=!1;return{postMessage:function(i){setTimeout(function(){n||e({data:{buffer:t(i),meta:i.meta}})},0)},terminate:function(){n=!0}}}class Jy extends Pa{constructor(e){super(),this._imageOps=!!e.imageOps;let t;e.threads===0?t=0:this._imageOps?t=1:t=e.threads||1;const n=new Array(t);if(t)for(let i=0;i<t;++i)n[i]=Ky(e,this._onWorkerMessage.bind(this,i));else n[0]=Qy(e,this._onWorkerMessage.bind(this,0));this._workers=n,this._queue=[],this._maxQueueLength=e.queue||1/0,this._running=0,this._dataLookup={},this._job=null}process(e,t,n){this._enqueue({inputs:e,meta:t,callback:n}),this._dispatch()}_enqueue(e){for(this._queue.push(e);this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)}_dispatch(){if(this._running||this._queue.length===0)return;const e=this._queue.shift();this._job=e;const t=e.inputs[0].width,n=e.inputs[0].height,i=e.inputs.map(function(l){return l.data.buffer}),s=this._workers.length;if(this._running=s,s===1){this._workers[0].postMessage({buffers:i,meta:e.meta,imageOps:this._imageOps,width:t,height:n},i);return}const o=e.inputs[0].data.length,a=4*Math.ceil(o/4/s);for(let l=0;l<s;++l){const u=l*a,h=[];for(let f=0,d=i.length;f<d;++f)h.push(i[f].slice(u,u+a));this._workers[l].postMessage({buffers:h,meta:e.meta,imageOps:this._imageOps,width:t,height:n},h)}}_onWorkerMessage(e,t){this.disposed||(this._dataLookup[e]=t.data,--this._running,this._running===0&&this._resolveJob())}_resolveJob(){const e=this._job,t=this._workers.length;let n,i;if(t===1)n=new Uint8ClampedArray(this._dataLookup[0].buffer),i=this._dataLookup[0].meta;else{const s=e.inputs[0].data.length;n=new Uint8ClampedArray(s),i=new Array(t);const o=4*Math.ceil(s/4/t);for(let a=0;a<t;++a){const l=this._dataLookup[a].buffer,u=a*o;n.set(new Uint8ClampedArray(l),u),i[a]=this._dataLookup[a].meta}}this._job=null,this._dataLookup={},e.callback(null,qy(n,e.inputs[0].width,e.inputs[0].height),i),this._dispatch()}disposeInternal(){for(let e=0;e<this._workers.length;++e)this._workers[e].terminate();this._workers.length=0}}const la={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class ua extends za{constructor(e,t,n){super(e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=n}}class ou extends Vt{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=e.operationType!==void 0?e.operationType:"pixel",this.threads_=e.threads!==void 0?e.threads:1,this.layers_=r0(e.sources);const t=this.changed.bind(this);for(let n=0,i=this.layers_.length;n<i;++n)this.layers_[n].addEventListener($e.CHANGE,t);this.useResolutions_=e.resolutions!==null,this.tileQueue_=new $c(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:nt(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:t0(this.layers_),pixelRatio:1,pixelToCoordinateTransform:nt(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:Pe(this),renderTargets:{}},this.setAttributions(function(n){const i=[];for(let s=0,o=e.sources.length;s<o;++s){const a=e.sources[s],l=a instanceof is?a:a.getSource();if(!l)continue;const u=l.getAttributions();if(typeof u=="function"){const h=u(n);i.push.apply(i,h)}}return i.length!==0?i:null}),e.operation!==void 0&&this.setOperation(e.operation,e.lib)}setOperation(e,t){this.processor_&&this.processor_.dispose(),this.processor_=new Jy({operation:e,imageOps:this.operationType_==="image",queue:1,lib:t,threads:this.threads_}),this.changed()}updateFrameState_(e,t,n){const i=Object.assign({},this.frameState_);i.viewState=Object.assign({},i.viewState);const s=It(e);i.size[0]=Math.ceil(He(e)/t),i.size[1]=Math.ceil(Ot(e)/t),i.extent=[s[0]-i.size[0]*t/2,s[1]-i.size[1]*t/2,s[0]+i.size[0]*t/2,s[1]+i.size[1]*t/2],i.time=Date.now();const o=i.viewState;return o.center=s,o.projection=n,o.resolution=t,i}allSourcesReady_(){let e=!0,t;for(let n=0,i=this.layers_.length;n<i;++n)if(t=this.layers_[n].getSource(),!t||t.getState()!=="ready"){e=!1;break}return e}getImage(e,t,n,i){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),t=this.findNearestResolution(t);const s=this.updateFrameState_(e,t,i);if(this.requestedFrameState_=s,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();(t!==o||!xn(s.extent,a))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),s.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const e=this.requestedFrameState_,t=this.layers_.length,n=new Array(t);for(let s=0;s<t;++s){e.layerIndex=s,e.renderTargets={};const o=e0(this.layers_[s],e);if(o)n[s]=o;else return}const i={};this.dispatchEvent(new ua(la.BEFOREOPERATIONS,e,i)),this.processor_.process(n,i,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,t,n,i){if(t||!n)return;const s=e.extent,o=e.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!xn(s,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{const l=Math.round(He(s)/o),u=Math.round(Ot(s)/o);a=wt(l,u),this.renderedImageCanvas_=new bs(s,o,1,a.canvas)}a.putImageData(n,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new ua(la.AFTEROPERATIONS,e,i))}getResolutions(e){if(!this.useResolutions_)return null;let t=super.getResolutions();if(!t)for(let n=0,i=this.layers_.length;n<i&&(t=this.layers_[n].getSource().getResolutions(e),!t);++n);return t}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}ou.prototype.dispose;let Gt=null;function e0(r,e){const t=r.getRenderer();if(!t)throw new Error("Unsupported layer type: "+r);if(!t.prepareFrame(e))return null;const n=e.size[0],i=e.size[1];if(n===0||i===0)return null;const s=t.renderFrame(e,null);let o;if(s instanceof HTMLCanvasElement)o=s;else{if(s&&(o=s.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===n&&o.height===i)return o.getContext("2d").getImageData(0,0,n,i)}if(!Gt)Gt=wt(n,i,void 0,{willReadFrequently:!0});else{const a=Gt.canvas;a.width!==n||a.height!==i?Gt=wt(n,i,void 0,{willReadFrequently:!0}):Gt.clearRect(0,0,n,i)}return Gt.drawImage(o,0,0,n,i),Gt.getImageData(0,0,n,i)}function t0(r){return r.map(function(e){return e.getLayerState()})}function r0(r){const e=r.length,t=new Array(e);for(let n=0;n<e;++n)t[n]=n0(r[n]);return t}function n0(r){let e;return r instanceof is?r instanceof Gn?e=new En({source:r}):r instanceof Vt&&(e=new es({source:r})):e=r,e}const i0=ou,s0='&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>',o0='&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>',a0='&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>',l0={stamen_terrain:{extension:"png",opaque:!0},stamen_terrain_background:{extension:"png",opaque:!0},stamen_terrain_labels:{extension:"png",opaque:!1},stamen_terrain_lines:{extension:"png",opaque:!1},stamen_toner_background:{extension:"png",opaque:!0},stamen_toner:{extension:"png",opaque:!0},stamen_toner_labels:{extension:"png",opaque:!1},stamen_toner_lines:{extension:"png",opaque:!1},stamen_toner_lite:{extension:"png",opaque:!0},stamen_watercolor:{extension:"jpg",opaque:!0},alidade_smooth:{extension:"png",opaque:!0},alidade_smooth_dark:{extension:"png",opaque:!0},alidade_satellite:{extension:"png",opaque:!0},outdoors:{extension:"png",opaque:!0},osm_bright:{extension:"png",opaque:!0}},u0={stamen_terrain:{minZoom:0,maxZoom:18,retina:!0},stamen_toner:{minZoom:0,maxZoom:20,retina:!0},stamen_watercolor:{minZoom:1,maxZoom:18,retina:!1}};class c0 extends cr{constructor(e){const t=e.layer.indexOf("-"),n=t==-1?e.layer:e.layer.slice(0,t),i=u0[n]||{minZoom:0,maxZoom:20,retina:!0},s=l0[e.layer],o=e.apiKey?"?api_key="+e.apiKey:"",a=i.retina&&e.retina?"@2x":"",l=e.url!==void 0?e.url:"https://tiles.stadiamaps.com/tiles/"+e.layer+"/{z}/{x}/{y}"+a+"."+s.extension+o,u=[s0,o0,jc];e.layer.startsWith("stamen_")&&u.splice(1,0,a0),super({attributions:u,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:i.maxZoom,minZoom:e.minZoom!==void 0?e.minZoom:i.minZoom,opaque:s.opaque,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:l,tilePixelRatio:a?2:1,wrapX:e.wrapX,zDirection:e.zDirection})}}const h0=c0;class f0 extends vt{constructor(e){e=e||{},super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.params_=Object.assign({},e.params),this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=qi(),this.setKey(this.getKeyForParams_())}getKeyForParams_(){let e=0;const t=[];for(const n in this.params_)t[e++]=n+"-"+this.params_[n];return t.join("/")}getParams(){return this.params_}getRequestUrl_(e,t,n,i,s,o){const a=this.urls;if(!a)return;let l;if(a.length==1)l=a[0];else{const u=Zc(Vc(e),a.length);l=a[u]}return ql(l,n,(this.tileGrid||this.getTileGridForProjection(s)).getResolution(e[0]),i,s,o)}getTilePixelRatio(e){return this.hidpi_?e:1}updateParams(e){Object.assign(this.params_,e),this.setKey(this.getKeyForParams_())}tileUrlFunction(e,t,n){let i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(n)),i.getResolutions().length<=e[0])return;t!=1&&!this.hidpi_&&(t=1);const s=i.getTileCoordExtent(e,this.tmpExtent_);let o=ft(i.getTileSize(e[0]),this.tmpSize);t!=1&&(o=Xc(o,t,this.tmpSize));const a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(a,this.params_),this.getRequestUrl_(e,o,s,t,n,a)}}const d0=f0;class p0 extends cr{constructor(e){e=e||{},super({opaque:!1,projection:e.projection,tileGrid:e.tileGrid,wrapX:e.wrapX!==void 0?e.wrapX:!0,zDirection:e.zDirection,url:e.template||"z:{z} x:{x} y:{y}",tileLoadFunction:(t,n)=>{const i=t.getTileCoord()[0],s=ft(this.tileGrid.getTileSize(i)),o=wt(s[0],s[1]);o.strokeStyle="grey",o.strokeRect(.5,.5,s[0]+.5,s[1]+.5),o.fillStyle="grey",o.strokeStyle="white",o.textAlign="center",o.textBaseline="middle",o.font="24px sans-serif",o.lineWidth=4,o.strokeText(n,s[0]/2,s[1]/2,s[0]),o.fillText(n,s[0]/2,s[1]/2,s[0]),t.setImage(o.canvas)}})}}const g0=p0;class au extends vt{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:_e("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)Ws(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let n;try{n=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(n)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const t=_e("EPSG:4326"),n=this.getProjection();let i;if(e.bounds!==void 0){const u=rs(t,n);i=Gr(e.bounds,u)}const s=Hr(n),o=e.minzoom||0,a=e.maxzoom||22,l=Wr({extent:s,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=ka(e.tiles,l),e.attribution&&!this.getAttributions()){const u=i!==void 0?i:s;this.setAttributions(function(h){return ar(u,h.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}}class m0 extends Ca{constructor(e,t,n,i,s,o){super(e,t),this.src_=n,this.extent_=i,this.preemptive_=s,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=o}getImage(){return null}getData(e){if(!this.grid_||!this.keys_)return null;const t=(e[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),n=(e[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),i=this.grid_[Math.floor((1-n)*this.grid_.length)];if(typeof i!="string")return null;let s=i.charCodeAt(Math.floor(t*i.length));s>=93&&s--,s>=35&&s--,s-=32;let o=null;if(s in this.keys_){const a=this.keys_[s];this.data_&&a in this.data_?o=this.data_[a]:o=a}return o}forDataAtCoordinate(e,t,n){this.state==q.EMPTY&&n===!0?(this.state=q.IDLE,Wc(this,$e.CHANGE,function(i){t(this.getData(e))},this),this.loadInternal_()):n===!0?setTimeout(()=>{t(this.getData(e))},0):t(this.getData(e))}getKey(){return this.src_}handleError_(){this.state=q.ERROR,this.changed()}handleLoad_(e){this.grid_=e.grid,this.keys_=e.keys,this.data_=e.data,this.state=q.LOADED,this.changed()}loadInternal_(){if(this.state==q.IDLE)if(this.state=q.LOADING,this.jsonp_)Ws(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",this.src_),e.send()}}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let n;try{n=JSON.parse(t.responseText)}catch{this.handleError_();return}this.handleLoad_(n)}else this.handleError_()}onXHRError_(e){this.handleError_()}load(){this.preemptive_?this.loadInternal_():this.setState(q.EMPTY)}}class _0 extends Gn{constructor(e){if(super({projection:_e("EPSG:3857"),state:"loading",wrapX:e.wrapX!==void 0?e.wrapX:!0,zDirection:e.zDirection}),this.preemptive_=e.preemptive!==void 0?e.preemptive:!0,this.tileUrlFunction_=Hc,this.template_=void 0,this.jsonp_=e.jsonp||!1,e.url)if(this.jsonp_)Ws(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let n;try{n=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(n)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTemplate(){return this.template_}forDataAtCoordinateAndResolution(e,t,n,i){if(this.tileGrid){const s=this.tileGrid.getZForResolution(t,this.zDirection),o=this.tileGrid.getTileCoordForCoordAndZ(e,s);this.getTile(o[0],o[1],o[2],1,this.getProjection()).forDataAtCoordinate(e,n,i)}else i===!0?setTimeout(function(){n(null)},0):n(null)}handleTileJSONError(){this.setState("error")}handleTileJSONResponse(e){const t=_e("EPSG:4326"),n=this.getProjection();let i;if(e.bounds!==void 0){const h=rs(t,n);i=Gr(e.bounds,h)}const s=Hr(n),o=e.minzoom||0,a=e.maxzoom||22,l=Wr({extent:s,maxZoom:a,minZoom:o});this.tileGrid=l,this.template_=e.template;const u=e.grids;if(!u){this.setState("error");return}if(this.tileUrlFunction_=ka(u,l),e.attribution){const h=i!==void 0?i:s;this.setAttributions(function(f){return ar(h,f.extent)?[e.attribution]:null})}this.setState("ready")}getTile(e,t,n,i,s){const o=wn(e,t,n);if(this.tileCache.containsKey(o))return this.tileCache.get(o);const a=[e,t,n],l=this.getTileCoordForTileUrlFunction(a,s),u=this.tileUrlFunction_(l,i,s),h=new m0(a,u!==void 0?q.IDLE:q.EMPTY,u!==void 0?u:"",this.tileGrid.getTileCoordExtent(a),this.preemptive_,this.jsonp_);return this.tileCache.set(o,h),h}useTile(e,t,n){const i=wn(e,t,n);this.tileCache.containsKey(i)&&this.tileCache.get(i)}}const y0=_0;function x0(r,e){const t=new Oa(32),n=r.getExtent();return function(i,s){t.expireCache(),n&&(i=ht(n,i));const o=r.getZForResolution(s),a=[];return r.forEachTileCoord(i,o,l=>{const u=l.toString();if(!t.containsKey(u)){const h=e(l);t.set(u,h)}a.push(t.get(u))}),a}}const E0=Object.freeze(Object.defineProperty({__proto__:null,BingMaps:Im,CartoDB:Cm,Cluster:Mm,DataTile:Ls,GeoTIFF:Hs,Google:by,IIIF:Ly,Image:Vt,ImageArcGISRest:Oy,ImageCanvas:Fy,ImageMapGuide:Uy,ImageStatic:eu,ImageWMS:Yc,OGCMapTile:Hy,OGCVectorTile:Yy,OSM:qc,Raster:i0,Source:is,StadiaMaps:h0,Tile:Gn,TileArcGISRest:d0,TileDebug:g0,TileImage:vt,TileJSON:au,TileWMS:$a,UTFGrid:y0,UrlTile:Kc,Vector:Dn,VectorTile:Bn,WMTS:ja,XYZ:cr,Zoomify:Ay,createArcGISRestLoader:Kl,createMapGuideLoader:Ql,createStaticLoader:Jl,createWMSLoader:Qc,sourcesFromTileGrid:x0},Symbol.toStringTag,{value:"Module"}));window.eoxMapAdvancedOlFormats=ng;var Ge=(r,e,t)=>new Promise((n,i)=>{var s=l=>{try{a(t.next(l))}catch(u){i(u)}},o=l=>{try{a(t.throw(l))}catch(u){i(u)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(s,o);a((t=t.apply(r,e)).next())}),Ve=Uint8Array,nr=Uint16Array,w0=Int32Array,lu=new Ve([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),uu=new Ve([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),T0=new Ve([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),cu=function(r,e){for(var t=new nr(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new w0(t[30]),n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)i[s]=s-t[n]<<5|n;return{b:t,r:i}},hu=cu(lu,2),fu=hu.b,v0=hu.r;fu[28]=258,v0[258]=28;var S0=cu(uu,0),R0=S0.b,zi=new nr(32768);for(ge=0;ge<32768;++ge)mt=(ge&43690)>>1|(ge&21845)<<1,mt=(mt&52428)>>2|(mt&13107)<<2,mt=(mt&61680)>>4|(mt&3855)<<4,zi[ge]=((mt&65280)>>8|(mt&255)<<8)>>1;var mt,ge,Fr=function(r,e,t){for(var n=r.length,i=0,s=new nr(e);i<n;++i)r[i]&&++s[r[i]-1];var o=new nr(e);for(i=1;i<e;++i)o[i]=o[i-1]+s[i-1]<<1;var a;if(t){a=new nr(1<<e);var l=15-e;for(i=0;i<n;++i)if(r[i])for(var u=i<<4|r[i],h=e-r[i],f=o[r[i]-1]++<<h,d=f|(1<<h)-1;f<=d;++f)a[zi[f]>>l]=u}else for(a=new nr(n),i=0;i<n;++i)r[i]&&(a[i]=zi[o[r[i]-1]++]>>15-r[i]);return a},Qr=new Ve(288);for(ge=0;ge<144;++ge)Qr[ge]=8;var ge;for(ge=144;ge<256;++ge)Qr[ge]=9;var ge;for(ge=256;ge<280;++ge)Qr[ge]=7;var ge;for(ge=280;ge<288;++ge)Qr[ge]=8;var ge,du=new Ve(32);for(ge=0;ge<32;++ge)du[ge]=5;var ge,b0=Fr(Qr,9,1),P0=Fr(du,5,1),_i=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},et=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},yi=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},A0=function(r){return(r+7)/8|0},I0=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var n=new Ve(t-e);return n.set(r.subarray(e,t)),n},L0=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ze=function(r,e,t){var n=new Error(e||L0[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,Ze),!t)throw n;return n},Ys=function(r,e,t,n){var i=r.length,s=n?n.length:0;if(!i||e.f&&!e.l)return t||new Ve(0);var o=!t||e.i!=2,a=e.i;t||(t=new Ve(i*3));var l=function(Oe){var Ie=t.length;if(Oe>Ie){var De=new Ve(Math.max(Ie*2,Oe));De.set(t),t=De}},u=e.f||0,h=e.p||0,f=e.b||0,d=e.l,g=e.d,m=e.m,y=e.n,x=i*8;do{if(!d){u=et(r,h,1);var w=et(r,h+1,3);if(h+=3,w)if(w==1)d=b0,g=P0,m=9,y=5;else if(w==2){var A=et(r,h,31)+257,O=et(r,h+10,15)+4,L=A+et(r,h+5,31)+1;h+=14;for(var F=new Ve(L),U=new Ve(19),k=0;k<O;++k)U[T0[k]]=et(r,h+k*3,7);h+=O*3;for(var V=_i(U),ee=(1<<V)-1,c=Fr(U,V,1),k=0;k<L;){var p=c[et(r,h,ee)];h+=p&15;var E=p>>4;if(E<16)F[k++]=E;else{var _=0,T=0;for(E==16?(T=3+et(r,h,3),h+=2,_=F[k-1]):E==17?(T=3+et(r,h,7),h+=3):E==18&&(T=11+et(r,h,127),h+=7);T--;)F[k++]=_}}var I=F.subarray(0,A),C=F.subarray(A);m=_i(I),y=_i(C),d=Fr(I,m,1),g=Fr(C,y,1)}else Ze(1);else{var E=A0(h)+4,v=r[E-4]|r[E-3]<<8,S=E+v;if(S>i){a&&Ze(0);break}o&&l(f+v),t.set(r.subarray(E,S),f),e.b=f+=v,e.p=h=S*8,e.f=u;continue}if(h>x){a&&Ze(0);break}}o&&l(f+131072);for(var M=(1<<m)-1,N=(1<<y)-1,z=h;;z=h){var _=d[yi(r,h)&M],X=_>>4;if(h+=_&15,h>x){a&&Ze(0);break}if(_||Ze(2),X<256)t[f++]=X;else if(X==256){z=h,d=null;break}else{var ae=X-254;if(X>264){var k=X-257,oe=lu[k];ae=et(r,h,(1<<oe)-1)+fu[k],h+=oe}var ue=g[yi(r,h)&N],le=ue>>4;ue||Ze(3),h+=ue&15;var C=R0[le];if(le>3){var oe=uu[le];C+=yi(r,h)&(1<<oe)-1,h+=oe}if(h>x){a&&Ze(0);break}o&&l(f+131072);var ye=f+ae;if(f<C){var Le=s-C,be=Math.min(C,ye);for(Le+f<0&&Ze(3);f<be;++f)t[f]=n[Le+f]}for(;f<ye;f+=4)t[f]=t[f-C],t[f+1]=t[f+1-C],t[f+2]=t[f+2-C],t[f+3]=t[f+3-C];f=ye}}e.l=d,e.p=z,e.b=f,e.f=u,d&&(u=1,e.m=m,e.d=g,e.n=y)}while(!u);return f==t.length?t:I0(t,0,f)},C0=new Ve(0),O0=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Ze(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},M0=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},F0=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Ze(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&Ze(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function N0(r,e){return Ys(r,{i:2},e&&e.out,e&&e.dictionary)}function D0(r,e){var t=O0(r);return t+8>r.length&&Ze(6,"invalid gzip data"),Ys(r.subarray(t,-8),{i:2},e&&e.out||new Ve(M0(r)),e&&e.dictionary)}function G0(r,e){return Ys(r.subarray(F0(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function ki(r,e){return r[0]==31&&r[1]==139&&r[2]==8?D0(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?N0(r,e):G0(r,e)}var U0=typeof TextDecoder<"u"&&new TextDecoder,B0=0;try{U0.decode(C0,{stream:!0}),B0=1}catch{}var pu=(r,e)=>r*Math.pow(2,e),Sr=(r,e)=>Math.floor(r/Math.pow(2,e)),On=(r,e)=>pu(r.getUint16(e+1,!0),8)+r.getUint8(e),gu=(r,e)=>pu(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),z0=(r,e,t,n,i)=>{if(r!=n.getUint8(i))return r-n.getUint8(i);const s=On(n,i+1);if(e!=s)return e-s;const o=On(n,i+4);return t!=o?t-o:0},k0=(r,e,t,n)=>{const i=mu(r,e|128,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],is_dir:!0}:null},ca=(r,e,t,n)=>{const i=mu(r,e,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],is_dir:!1}:null},mu=(r,e,t,n)=>{let i=0,s=r.byteLength/17-1;for(;i<=s;){const o=s+i>>1,a=z0(e,t,n,r,o*17);if(a>0)i=o+1;else if(a<0)s=o-1;else return[gu(r,o*17+7),r.getUint32(o*17+13,!0)]}return null},$0=(r,e)=>r.is_dir&&!e.is_dir?1:!r.is_dir&&e.is_dir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,_u=(r,e)=>{const t=r.getUint8(e*17);return{z:t&127,x:On(r,e*17+1),y:On(r,e*17+4),offset:gu(r,e*17+7),length:r.getUint32(e*17+13,!0),is_dir:t>>7===1}},ha=r=>{const e=[],t=new DataView(r);for(let n=0;n<t.byteLength/17;n++)e.push(_u(t,n));return j0(e)},j0=r=>{r.sort($0);const e=new ArrayBuffer(17*r.length),t=new Uint8Array(e);for(let n=0;n<r.length;n++){const i=r[n];let s=i.z;i.is_dir&&(s=s|128),t[n*17]=s,t[n*17+1]=i.x&255,t[n*17+2]=i.x>>8&255,t[n*17+3]=i.x>>16&255,t[n*17+4]=i.y&255,t[n*17+5]=i.y>>8&255,t[n*17+6]=i.y>>16&255,t[n*17+7]=i.offset&255,t[n*17+8]=Sr(i.offset,8)&255,t[n*17+9]=Sr(i.offset,16)&255,t[n*17+10]=Sr(i.offset,24)&255,t[n*17+11]=Sr(i.offset,32)&255,t[n*17+12]=Sr(i.offset,48)&255,t[n*17+13]=i.length&255,t[n*17+14]=i.length>>8&255,t[n*17+15]=i.length>>16&255,t[n*17+16]=i.length>>24&255}return e},Z0=(r,e)=>{if(r.byteLength<17)return null;const t=r.byteLength/17,n=_u(r,t-1);if(n.is_dir){const i=n.z,s=e.z-i,o=Math.trunc(e.x/(1<<s)),a=Math.trunc(e.y/(1<<s));return{z:i,x:o,y:a}}return null};function V0(r){return Ge(this,null,function*(){const e=yield r.getBytes(0,512e3),t=new DataView(e.data),n=t.getUint32(4,!0),i=t.getUint16(8,!0),s=new TextDecoder("utf-8"),o=JSON.parse(s.decode(new DataView(e.data,10,n)));let a=0;o.compression==="gzip"&&(a=2);let l=0;"minzoom"in o&&(l=+o.minzoom);let u=0;"maxzoom"in o&&(u=+o.maxzoom);let h=0,f=0,d=0,g=-180,m=-85,y=180,x=85;if(o.bounds){const E=o.bounds.split(",");g=+E[0],m=+E[1],y=+E[2],x=+E[3]}if(o.center){const E=o.center.split(",");h=+E[0],f=+E[1],d=+E[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:i*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:l,maxZoom:u,minLon:g,minLat:m,maxLon:y,maxLat:x,centerZoom:d,centerLon:h,centerLat:f,etag:e.etag}})}function X0(r,e,t,n,i,s,o){return Ge(this,null,function*(){let a=yield t.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(a=ha(a));const l=ca(new DataView(a),n,i,s);if(l){let f=(yield e.getBytes(l.offset,l.length,o)).data;const d=new DataView(f);return d.getUint8(0)==31&&d.getUint8(1)==139&&(f=ki(new Uint8Array(f))),{data:f}}const u=Z0(new DataView(a),{z:n,x:i,y:s});if(u){const h=k0(new DataView(a),u.z,u.x,u.y);if(h){let f=yield t.getArrayBuffer(e,h.offset,h.length,r);r.specVersion===1&&(f=ha(f));const d=ca(new DataView(f),n,i,s);if(d){let m=(yield e.getBytes(d.offset,d.length,o)).data;const y=new DataView(m);return y.getUint8(0)==31&&y.getUint8(1)==139&&(m=ki(new Uint8Array(m))),{data:m}}}}})}var yu={getHeader:V0,getZxy:X0};function qt(r,e){return(e>>>0)*4294967296+(r>>>0)}function H0(r,e){const t=e.buf;let n,i;if(i=t[e.pos++],n=(i&112)>>4,i<128||(i=t[e.pos++],n|=(i&127)<<3,i<128)||(i=t[e.pos++],n|=(i&127)<<10,i<128)||(i=t[e.pos++],n|=(i&127)<<17,i<128)||(i=t[e.pos++],n|=(i&127)<<24,i<128)||(i=t[e.pos++],n|=(i&1)<<31,i<128))return qt(r,n);throw new Error("Expected varint not more than 10 bytes")}function Rr(r){const e=r.buf;let t,n;return n=e[r.pos++],t=n&127,n<128||(n=e[r.pos++],t|=(n&127)<<7,n<128)||(n=e[r.pos++],t|=(n&127)<<14,n<128)||(n=e[r.pos++],t|=(n&127)<<21,n<128)?t:(n=e[r.pos],t|=(n&15)<<28,H0(t,r))}function W0(r,e,t,n){if(n==0){t==1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}var Y0=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function q0(r,e,t){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,r)-1||t>Math.pow(2,r)-1)throw Error("tile x/y outside zoom level bounds");const n=Y0[r],i=Math.pow(2,r);let s=0,o=0,a=0;const l=[e,t];let u=i/2;for(;u>0;)s=(l[0]&u)>0?1:0,o=(l[1]&u)>0?1:0,a+=u*u*(3*s^o),W0(u,l,s,o),u=u/2;return n+a}function xu(r,e){return Ge(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return ki(new Uint8Array(r));{let n=new Response(r).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}}else throw Error("Compression method not supported")})}var Jt=(r=>(r[r.Unknown=0]="Unknown",r[r.Mvt=1]="Mvt",r[r.Png=2]="Png",r[r.Jpeg=3]="Jpeg",r[r.Webp=4]="Webp",r[r.Avif=5]="Avif",r))(Jt||{}),K0=127;function Q0(r,e){let t=0,n=r.length-1;for(;t<=n;){const i=n+t>>1,s=e-r[i].tileId;if(s>0)t=i+1;else if(s<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}var J0=class{constructor(r,e=new Headers){this.url=r,this.customHeaders=e}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,e,t){return Ge(this,null,function*(){let n;t||(n=new AbortController,t=n.signal);const i=new Headers(this.customHeaders);i.set("Range","bytes="+r+"-"+(r+e-1));let s=yield fetch(this.url,{signal:t,headers:i});if(s.status===416&&r===0){const l=s.headers.get("Content-Range");if(!l||!l.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const u=+l.substr(8);s=yield fetch(this.url,{signal:t,headers:{Range:"bytes=0-"+(u-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);const o=s.headers.get("Content-Length");if(s.status===200&&(!o||+o>e))throw n&&n.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function tt(r,e){const t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*Math.pow(2,32)+n}function ex(r,e){const t=new DataView(r),n=t.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:tt(t,8),rootDirectoryLength:tt(t,16),jsonMetadataOffset:tt(t,24),jsonMetadataLength:tt(t,32),leafDirectoryOffset:tt(t,40),leafDirectoryLength:tt(t,48),tileDataOffset:tt(t,56),tileDataLength:tt(t,64),numAddressedTiles:tt(t,72),numTileEntries:tt(t,80),numTileContents:tt(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function Eu(r){const e={buf:new Uint8Array(r),pos:0},t=Rr(e),n=[];let i=0;for(let s=0;s<t;s++){const o=Rr(e);n.push({tileId:i+o,offset:0,length:0,runLength:1}),i+=o}for(let s=0;s<t;s++)n[s].runLength=Rr(e);for(let s=0;s<t;s++)n[s].length=Rr(e);for(let s=0;s<t;s++){const o=Rr(e);o===0&&s>0?n[s].offset=n[s-1].offset+n[s-1].length:n[s].offset=o-1}return n}function tx(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var ir=class extends Error{};function rx(r,e,t,n){return Ge(this,null,function*(){const i=yield r.getBytes(0,16384);if(new DataView(i.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(tx(i.data)<3)return[yield yu.getHeader(r)];const o=i.data.slice(0,K0);let a=i.etag;n&&i.etag!=n&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+r.getKey()),a=void 0);const l=ex(o,a);if(t){const u=i.data.slice(l.rootDirectoryOffset,l.rootDirectoryOffset+l.rootDirectoryLength),h=r.getKey()+"|"+(l.etag||"")+"|"+l.rootDirectoryOffset+"|"+l.rootDirectoryLength,f=Eu(yield e(u,l.internalCompression));return[l,[h,f.length,f]]}return[l,void 0]})}function nx(r,e,t,n,i){return Ge(this,null,function*(){const s=yield r.getBytes(t,n);if(i.etag&&i.etag!==s.etag)throw new ir(s.etag);const o=yield e(s.data,i.internalCompression),a=Eu(o);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var ix=class{constructor(r=100,e=!0,t=xu){this.cache=new Map,this.maxCacheEntries=r,this.counter=1,this.prefetch=e,this.decompress=t}getHeader(r,e){return Ge(this,null,function*(){const t=r.getKey();if(this.cache.has(t))return this.cache.get(t).lastUsed=this.counter++,yield this.cache.get(t).data;const n=new Promise((i,s)=>{rx(r,this.decompress,this.prefetch,e).then(o=>{o[1]&&this.cache.set(o[1][0],{lastUsed:this.counter++,data:Promise.resolve(o[1][2])}),i(o[0]),this.prune()}).catch(o=>{s(o)})});return this.cache.set(t,{lastUsed:this.counter++,data:n}),n})}getDirectory(r,e,t,n){return Ge(this,null,function*(){const i=r.getKey()+"|"+(n.etag||"")+"|"+e+"|"+t;if(this.cache.has(i))return this.cache.get(i).lastUsed=this.counter++,yield this.cache.get(i).data;const s=new Promise((o,a)=>{nx(r,this.decompress,e,t,n).then(l=>{o(l),this.prune()}).catch(l=>{a(l)})});return this.cache.set(i,{lastUsed:this.counter++,data:s}),s})}getArrayBuffer(r,e,t,n){return Ge(this,null,function*(){const i=r.getKey()+"|"+(n.etag||"")+"|"+e+"|"+t;if(this.cache.has(i))return this.cache.get(i).lastUsed=this.counter++,yield this.cache.get(i).data;const s=new Promise((o,a)=>{r.getBytes(e,t).then(l=>{if(n.etag&&n.etag!==l.etag)throw new ir(l.etag);o(l.data),this.cache.has(i),this.prune()}).catch(l=>{a(l)})});return this.cache.set(i,{lastUsed:this.counter++,data:s}),s})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((t,n)=>{t.lastUsed<r&&(r=t.lastUsed,e=n)}),e&&this.cache.delete(e)}}invalidate(r,e){return Ge(this,null,function*(){this.cache.delete(r.getKey()),yield this.getHeader(r,e)})}},qs=class{constructor(r,e,t){typeof r=="string"?this.source=new J0(r):this.source=r,t?this.decompress=t:this.decompress=xu,e?this.cache=e:this.cache=new ix}getHeader(){return Ge(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,t,n){return Ge(this,null,function*(){const i=q0(r,e,t),s=yield this.cache.getHeader(this.source);if(s.specVersion<3)return yu.getZxy(s,this.source,this.cache,r,e,t,n);if(r<s.minZoom||r>s.maxZoom)return;let o=s.rootDirectoryOffset,a=s.rootDirectoryLength;for(let l=0;l<=3;l++){const u=yield this.cache.getDirectory(this.source,o,a,s),h=Q0(u,i);if(h)if(h.runLength>0){const f=yield this.source.getBytes(s.tileDataOffset+h.offset,h.length,n);if(s.etag&&s.etag!==f.etag)throw new ir(f.etag);return{data:yield this.decompress(f.data,s.tileCompression),cacheControl:f.cacheControl,expires:f.expires}}else o=s.leafDirectoryOffset+h.offset,a=h.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,t,n){return Ge(this,null,function*(){try{return yield this.getZxyAttempt(r,e,t,n)}catch(i){if(i instanceof ir)return this.cache.invalidate(this.source,i.message),yield this.getZxyAttempt(r,e,t,n);throw i}})}getMetadataAttempt(){return Ge(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength);if(r.etag&&r.etag!==e.etag)throw new ir(e.etag);const t=yield this.decompress(e.data,r.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(t))})}getMetadata(){return Ge(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof ir)return this.cache.invalidate(this.source,r.message),yield this.getMetadataAttempt();throw r}})}};class sx extends za{constructor(e){super($e.ERROR),this.error=e}}class we{constructor(e){this.name=e}toString(){return this.name}}we.GeoTIFF=new we("GeoTIFF");we.ImageStatic=new we("ImageStatic");we.PMTilesRaster=new we("PMTilesRaster");we.PMTilesVector=new we("PMTilesVector");we.TileJSON=new we("TileJSON");we.TileWMS=new we("TileWMS");we.WMTS=new we("WMTS");we.XYZ=new we("XYZ");var wu={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(zt,function(){var t=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function n(f,d){return f.indexOf(d)===-1?f.length:f.indexOf(d)}function i(f){var d=f.replace(/^v/,"").replace(/\+.*$/,""),g=n(d,"-"),m=d.substring(0,g).split(".");return m.push(d.substring(g+1)),m}function s(f){return isNaN(Number(f))?f:Number(f)}function o(f){if(typeof f!="string")throw new TypeError("Invalid argument expected string");if(!t.test(f))throw new Error("Invalid argument not valid semver ('"+f+"' received)")}function a(f,d){[f,d].forEach(o);for(var g=i(f),m=i(d),y=0;y<Math.max(g.length-1,m.length-1);y++){var x=parseInt(g[y]||0,10),w=parseInt(m[y]||0,10);if(x>w)return 1;if(w>x)return-1}var E=g[g.length-1],v=m[m.length-1];if(E&&v){var S=E.split(".").map(s),A=v.split(".").map(s);for(y=0;y<Math.max(S.length,A.length);y++){if(S[y]===void 0||typeof A[y]=="string"&&typeof S[y]=="number")return-1;if(A[y]===void 0||typeof S[y]=="string"&&typeof A[y]=="number"||S[y]>A[y])return 1;if(A[y]>S[y])return-1}}else if(E||v)return E?-1:1;return 0}var l=[">",">=","=","<","<="],u={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function h(f){if(typeof f!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof f);if(l.indexOf(f)===-1)throw new TypeError("Invalid operator, expected one of "+l.join("|"))}return a.validate=function(f){return typeof f=="string"&&t.test(f)},a.compare=function(f,d,g){h(g);var m=a(f,d);return u[g].indexOf(m)>-1},a})})(wu);var ox=wu.exports,$i=ox;const Ks="1.0.0",B=!0,W={classification:"https://stac-extensions.github.io/classification/v1.1.0/schema.json",datacube:"https://stac-extensions.github.io/datacube/v2.1.0/schema.json",eo:"https://stac-extensions.github.io/eo/v1.0.0/schema.json",file:"https://stac-extensions.github.io/file/v1.0.0/schema.json","item-assets":"https://stac-extensions.github.io/item-assets/v1.0.0/schema.json",label:"https://stac-extensions.github.io/label/v1.0.1/schema.json",pointcloud:"https://stac-extensions.github.io/pointcloud/v1.0.0/schema.json",processing:"https://stac-extensions.github.io/processing/v1.1.0/schema.json",projection:"https://stac-extensions.github.io/projection/v1.0.0/schema.json",raster:"https://stac-extensions.github.io/raster/v1.1.0/schema.json",sar:"https://stac-extensions.github.io/sar/v1.0.0/schema.json",sat:"https://stac-extensions.github.io/sat/v1.0.0/schema.json",scientific:"https://stac-extensions.github.io/scientific/v1.0.0/schema.json",table:"https://stac-extensions.github.io/table/v1.2.0/schema.json",timestamps:"https://stac-extensions.github.io/timestamps/v1.0.0/schema.json",version:"https://stac-extensions.github.io/version/v1.0.0/schema.json",view:"https://stac-extensions.github.io/view/v1.0.0/schema.json"},$t={itemAndCollection:{"cube:":W.datacube,"eo:":W.eo,"file:":W.file,"label:":W.label,"pc:":W.pointcloud,"processing:":W.processing,"proj:":W.projection,"raster:":W.raster,"sar:":W.sar,"sat:":W.sat,"sci:":W.scientific,"view:":W.view,version:W.version,deprecated:W.version,published:W.timestamps,expires:W.timestamps,unpublished:W.timestamps},catalog:{},collection:{item_assets:W["item-assets"]},item:{}};$t.collection=Object.assign($t.collection,$t.itemAndCollection);$t.item=Object.assign($t.item,$t.itemAndCollection);var Ir={parseUrl(r){let e=r.match(/^https?:\/\/stac-extensions.github.io\/([^\/]+)\/v([^\/]+)\/[^.]+.json$/i);if(e)return{id:e[1],version:e[2]}}},ce={version:Ks,extensions:{},set(r){if(typeof r.stac_version!="string"?ce.version="0.6.0":ce.version=r.stac_version,Array.isArray(r.stac_extensions))for(let e of r.stac_extensions){let t=Ir.parseUrl(e);t&&(ce.extensions[t.id]=t.version)}},before(r,e=null){let t=e?ce.extensions[e]:ce.version;return typeof t>"u"?!1:$i.compare(t,r,"<")}},b={type(r){let e=typeof r;if(e==="object"){if(r===null)return"null";if(Array.isArray(r))return"array"}return e},is(r,e){return b.type(r)===e},isDefined(r){return typeof r<"u"},isObject(r){return typeof r=="object"&&r===Object(r)&&!Array.isArray(r)},rename(r,e,t){return typeof r[e]<"u"&&typeof r[t]>"u"?(r[t]=r[e],delete r[e],!0):!1},forAll(r,e,t){if(r[e]&&typeof r[e]=="object")for(let n in r[e])t(r[e][n])},toArray(r,e){return typeof r[e]<"u"&&!Array.isArray(r[e])?(r[e]=[r[e]],!0):!1},flattenArray(r,e,t,n=!1){if(Array.isArray(r[e])){for(let i in r[e])if(typeof t[i]=="string"){let s=r[e][i];r[t[i]]=n?[s]:s}return delete r[e],!0}return!1},flattenOneElementArray(r,e,t=!1){return!t&&Array.isArray(r[e])?r[e].length===1?(r[e]=r[e][0],!0):!1:!0},removeFromArray(r,e,t){if(Array.isArray(r[e])){let n=r[e].indexOf(t);return n>-1&&r[e].splice(n,1),!0}return!1},ensure(r,e,t){return b.type(t)!==b.type(r[e])&&(r[e]=t),!0},upgradeExtension(r,e){let{id:t,version:n}=Ir.parseUrl(e),i=r.stac_extensions.findIndex(s=>{let o=Ir.parseUrl(s);return o&&o.id===t&&$i.compare(o.version,n,"<")});return i!==-1?(r.stac_extensions[i]=e,!0):!1},addExtension(r,e){let{id:t,version:n}=Ir.parseUrl(e),i=r.stac_extensions.findIndex(s=>{if(s===e)return!0;let o=Ir.parseUrl(s);return!!(o&&o.id===t&&$i.compare(o.version,n,"<"))});return i===-1?r.stac_extensions.push(e):r.stac_extensions[i]=e,r.stac_extensions.sort(),!0},removeExtension(r,e){return b.removeFromArray(r,"stac_extensions",e)},migrateExtensionShortnames(r){let e=Object.keys(W),t=Object.values(W);return b.mapValues(r,"stac_extensions",e,t)},populateExtensions(r,e){let t=[];(e=="catalog"||e=="collection")&&t.push(r),(e=="item"||e=="collection")&&b.isObject(r.assets)&&(t=t.concat(Object.values(r.assets))),e=="collection"&&b.isObject(r.item_assets)&&(t=t.concat(Object.values(r.item_assets))),e=="collection"&&b.isObject(r.summaries)&&t.push(r.summaries),e=="item"&&b.isObject(r.properties)&&t.push(r.properties);for(let n of t)Object.keys(n).forEach(i=>{let s=i.match(/^(\w+:|[^:]+$)/i);if(Array.isArray(s)){let o=$t[e][s[0]];b.is(o,"string")&&b.addExtension(r,o)}})},mapValues(r,e,t,n){let i=s=>{let o=t.indexOf(s);return o>=0?n[o]:s};return Array.isArray(r[e])?r[e]=r[e].map(i):typeof r[e]<"u"&&(r[e]=i(r[e])),!0},mapObject(r,e){for(let t in r)r[t]=e(r[t],t)},moveTo(r,e,t,n=!1,i=!1){let s;return n?i?s=o=>Array.isArray(o):s=o=>Array.isArray(o)&&o.length===1:s=b.isDefined,s(r[e])?(t[e]=n&&!i?r[e][0]:r[e],delete r[e],!0):!1},runAll(r,e,t,n){for(let i in r)i.startsWith("migrate")||r[i](e,t,n)},toUTC(r,e){if(typeof r[e]=="string")try{return r[e]=this.toISOString(r[e]),!0}catch{}return delete r[e],!1},toISOString(r){return r instanceof Date||(r=new Date(r)),r.toISOString().replace(".000","")}},ct={multihash:null,hexToUint8(r){if(r.length===0||r.length%2!==0)throw new Error(`The string "${r}" is not valid hex.`);return new Uint8Array(r.match(/.{1,2}/g).map(e=>parseInt(e,16)))},uint8ToHex(r){return r.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),"")},toMultihash(r,e,t){if(!ct.multihash||!b.is(r[e],"string"))return!1;try{const n=ct.multihash.encode(ct.hexToUint8(r[e]),t);return r[e]=ct.uint8ToHex(n),!0}catch(n){return console.warn(n),!1}}},Qs={migrate(r,e=!0){return ce.set(r),e&&(r.stac_version=Ks),r.type="Catalog",b.ensure(r,"stac_extensions",[]),ce.before("1.0.0-rc.1")&&b.migrateExtensionShortnames(r),b.ensure(r,"id",""),b.ensure(r,"description",""),b.ensure(r,"links",[]),b.runAll(Qs,r,r),ce.before("0.8.0")&&b.populateExtensions(r,"catalog"),r}},Js={migrate(r,e=!0){return Qs.migrate(r,e),r.type="Collection",ce.before("1.0.0-rc.1")&&b.migrateExtensionShortnames(r),b.ensure(r,"license","proprietary"),b.ensure(r,"extent",{spatial:{bbox:[]},temporal:{interval:[]}}),b.runAll(Js,r,r),b.isObject(r.properties)&&(b.removeFromArray(r,"stac_extensions","commons"),delete r.properties),ce.before("0.8.0")&&b.populateExtensions(r,"collection"),ce.before("1.0.0-beta.1")&&b.mapValues(r,"stac_extensions",["assets"],["item-assets"]),r},extent(r){if(b.ensure(r,"extent",{}),ce.before("0.8.0")&&(Array.isArray(r.extent.spatial)&&(r.extent.spatial={bbox:[r.extent.spatial]}),Array.isArray(r.extent.temporal)&&(r.extent.temporal={interval:[r.extent.temporal]})),b.ensure(r.extent,"spatial",{}),b.ensure(r.extent.spatial,"bbox",[]),b.ensure(r.extent,"temporal",{}),b.ensure(r.extent.temporal,"interval",[]),ce.before("1.0.0-rc.3")){if(r.extent.temporal.interval.length>1){let e,t;for(let n of r.extent.temporal.interval){if(n[0]===null)e=null;else if(typeof n[0]=="string"&&e!==null)try{let i=new Date(n[0]);(typeof e>"u"||i<e)&&(e=i)}catch{}if(n[1]===null)t=null;else if(typeof n[1]=="string"&&t!==null)try{let i=new Date(n[1]);(typeof t>"u"||i>t)&&(t=i)}catch{}}r.extent.temporal.interval.unshift([e?b.toISOString(e):null,t?b.toISOString(t):null])}if(r.extent.spatial.bbox.length>1){let e=r.extent.spatial.bbox.reduce((t,n)=>Array.isArray(n)?Math.max(n.length,t):t,4);if(e>=4){let t=new Array(e).fill(null),n=e/2;for(let i of r.extent.spatial.bbox){if(!Array.isArray(i)||i.length<4)break;for(let s in i){let o=i[s];t[s]===null?t[s]=o:s<n?t[s]=Math.min(o,t[s]):t[s]=Math.max(o,t[s])}}t.findIndex(i=>i===null)===-1&&r.extent.spatial.bbox.unshift(t)}}}},collectionAssets(r){ce.before("1.0.0-rc.1")&&b.removeExtension(r,"collection-assets"),Zr.migrateAll(r)},itemAsset(r){ce.before("1.0.0-beta.2")&&b.rename(r,"item_assets","assets"),Zr.migrateAll(r,"item_assets")},summaries(r){if(b.ensure(r,"summaries",{}),ce.before("0.8.0")&&b.isObject(r.other_properties)){for(let e in r.other_properties){let t=r.other_properties[e];Array.isArray(t.extent)&&t.extent.length===2?r.summaries[e]={minimum:t.extent[0],maximum:t.extent[1]}:Array.isArray(t.values)&&(t.values.filter(n=>Array.isArray(n)).length===t.values.length?r.summaries[e]=t.values.reduce((n,i)=>n.concat(i),[]):r.summaries[e]=t.values)}delete r.other_properties}if(ce.before("1.0.0-beta.1")&&b.isObject(r.properties)&&!r.links.find(e=>["child","item"].includes(e.rel)))for(let e in r.properties){let t=r.properties[e];Array.isArray(t)||(t=[t]),r.summaries[e]=t}ce.before("1.0.0-rc.1")&&b.mapObject(r.summaries,e=>(b.rename(e,"min","minimum"),b.rename(e,"max","maximum"),e)),Kn.migrate(r.summaries,r,!0),b.moveTo(r.summaries,"sci:doi",r,!0)&&b.addExtension(r,W.scientific),b.moveTo(r.summaries,"sci:publications",r,!0,!0)&&b.addExtension(r,W.scientific),b.moveTo(r.summaries,"sci:citation",r,!0)&&b.addExtension(r,W.scientific),b.moveTo(r.summaries,"cube:dimensions",r,!0)&&b.addExtension(r,W.datacube),Object.keys(r.summaries).length===0&&delete r.summaries}},eo={migrate(r,e=null,t=!0){ce.set(r),t&&(r.stac_version=Ks),b.ensure(r,"stac_extensions",[]),ce.before("1.0.0-rc.1")&&b.migrateExtensionShortnames(r),b.ensure(r,"id",""),b.ensure(r,"type","Feature"),b.isObject(r.geometry)||(r.geometry=null),r.geometry!==null&&b.ensure(r,"bbox",[]),b.ensure(r,"properties",{}),b.ensure(r,"links",[]),b.ensure(r,"assets",{});let n=!1;return b.isObject(e)&&b.isObject(e.properties)&&(b.removeFromArray(r,"stac_extensions","commons"),r.properties=Object.assign({},e.properties,r.properties),n=!0),b.runAll(eo,r,r),Kn.migrate(r.properties,r),Zr.migrateAll(r),(ce.before("0.8.0")||n)&&b.populateExtensions(r,"item"),r}},Tu={migrate(r,e=!0){return b.ensure(r,"collections",[]),b.ensure(r,"links",[]),b.runAll(Tu,r,r),r.collections=r.collections.map(t=>Js.migrate(t,e)),r}},vu={migrate(r,e=!0){return b.ensure(r,"type","FeatureCollection"),b.ensure(r,"features",[]),b.ensure(r,"links",[]),b.runAll(vu,r,r),r.features=r.features.map(t=>eo.migrate(t,null,e)),r}},Zr={migrateAll(r,e="assets"){for(let t in r[e])Zr.migrate(r[e][t],r)},migrate(r,e){return b.runAll(Zr,r,e),Kn.migrate(r,e),r},mediaTypes(r){b.is(r.type,"string")&&b.mapValues(r,"type",["image/vnd.stac.geotiff","image/vnd.stac.geotiff; cloud-optimized=true"],["image/tiff; application=geotiff","image/tiff; application=geotiff; profile=cloud-optimized"])},eo(r,e){let t=b.isObject(e.properties)&&Array.isArray(e.properties["eo:bands"])?e.properties["eo:bands"]:[];if(Array.isArray(r["eo:bands"]))for(let n in r["eo:bands"]){let i=r["eo:bands"][n];b.is(i,"number")&&b.isObject(t[i])?i=t[i]:b.isObject(i)||(i={}),r["eo:bands"][n]=i}}},Kn={migrate(r,e,t=!1){return b.runAll(Kn,r,e,t),r},_commonMetadata(r){ce.before("1.0.0-rc.3")&&(b.toUTC(r,"created"),b.toUTC(r,"updated"))},_timestamps(r,e){b.toUTC(r,"published"),b.toUTC(r,"expires"),b.toUTC(r,"unpublished"),b.upgradeExtension(e,W.timestamps)},_versioningIndicator(r,e){b.upgradeExtension(e,W.version)},checksum(r,e){ce.before("0.9.0")&&ct.multihash&&(b.rename(r,"checksum:md5","checksum:multihash")&&ct.toMultihash(r,"checksum:multihash","md5"),b.rename(r,"checksum:sha1","checksum:multihash")&&ct.toMultihash(r,"checksum:multihash","sha1"),b.rename(r,"checksum:sha2","checksum:multihash")&&ct.toMultihash(r,"checksum:multihash","sha2-256"),b.rename(r,"checksum:sha3","checksum:multihash")&&ct.toMultihash(r,"checksum:multihash","sha3-256")),ce.before("1.0.0-rc.1")&&b.rename(r,"checksum:multihash","file:checksum")&&b.addExtension(e,W.file),b.removeExtension(e,"checksum")},classification(r,e){ce.before("1.1.0","classification")&&b.forAll(r,"classification:classes",t=>b.rename(t,"color-hint","color_hint")),b.upgradeExtension(e,W.classification)},cube(r,e){b.upgradeExtension(e,W.datacube)},dtr(r,e){ce.before("0.9.0")&&(b.rename(r,"dtr:start_datetime","start_datetime"),b.rename(r,"dtr:end_datetime","end_datetime"),b.removeExtension(e,"datetime-range"))},eo(r,e){ce.before("0.9.0")&&(b.rename(r,"eo:epsg","proj:epsg")&&b.addExtension(e,W.projection),b.rename(r,"eo:platform","platform"),b.rename(r,"eo:instrument","instruments")&&b.toArray(r,"instruments"),b.rename(r,"eo:constellation","constellation"),b.rename(r,"eo:off_nadir","view:off_nadir")&&b.addExtension(e,W.view),b.rename(r,"eo:azimuth","view:azimuth")&&b.addExtension(e,W.view),b.rename(r,"eo:incidence_angle","view:incidence_angle")&&b.addExtension(e,W.view),b.rename(r,"eo:sun_azimuth","view:sun_azimuth")&&b.addExtension(e,W.view),b.rename(r,"eo:sun_elevation","view:sun_elevation")&&b.addExtension(e,W.view)),ce.before("1.0.0-beta.1")&&b.rename(r,"eo:gsd","gsd"),b.upgradeExtension(e,W.eo)},file(r,e){b.upgradeExtension(e,W.file)},label(r,e){ce.before("0.8.0")&&(b.rename(r,"label:property","label:properties"),b.rename(r,"label:task","label:tasks"),b.rename(r,"label:overview","label:overviews")&&b.toArray(r,"label:overviews"),b.rename(r,"label:method","label:methods"),b.toArray(r,"label:classes")),b.upgradeExtension(e,W.label)},pc(r,e){ce.before("0.8.0")&&b.rename(r,"pc:schema","pc:schemas"),b.upgradeExtension(e,W.pointcloud)},processing(r,e){b.upgradeExtension(e,W.processing)},proj(r,e){b.upgradeExtension(e,W.projection)},raster(r,e){b.upgradeExtension(e,W.raster)},sar(r,e,t){b.rename(r,"sar:incidence_angle","view:incidence_angle")&&b.addExtension(e,W.view),b.rename(r,"sar:pass_direction","sat:orbit_state")&&b.mapValues(r,"sat:orbit_state",[null],["geostationary"])&&b.addExtension(e,W.sat),ce.before("0.7.0")&&(b.flattenArray(r,"sar:resolution",["sar:resolution_range","sar:resolution_azimuth"],t),b.flattenArray(r,"sar:pixel_spacing",["sar:pixel_spacing_range","sar:pixel_spacing_azimuth"],t),b.flattenArray(r,"sar:looks",["sar:looks_range","sar:looks_azimuth","sar:looks_equivalent_number"],t),b.rename(r,"sar:off_nadir","view:off_nadir")&&b.addExtension(e,W.view)),ce.before("0.9.0")&&(b.rename(r,"sar:platform","platform"),b.rename(r,"sar:instrument","instruments")&&b.toArray(r,"instruments"),b.rename(r,"sar:constellation","constellation"),b.rename(r,"sar:type","sar:product_type"),b.rename(r,"sar:polarization","sar:polarizations"),b.flattenOneElementArray(r,"sar:absolute_orbit",t)&&b.rename(r,"sar:absolute_orbit","sat:absolute_orbit")&&b.addExtension(e,W.sat),b.flattenOneElementArray(r,"sar:relative_orbit",t)&&b.rename(r,"sar:relative_orbit","sat:relative_orbit")&&b.addExtension(e,W.sat)),b.upgradeExtension(e,W.sar)},sat(r,e){ce.before("0.9.0")&&(b.rename(r,"sat:off_nadir_angle","sat:off_nadir"),b.rename(r,"sat:azimuth_angle","sat:azimuth"),b.rename(r,"sat:sun_azimuth_angle","sat:sun_azimuth"),b.rename(r,"sat:sun_elevation_angle","sat:sun_elevation")),b.upgradeExtension(e,W.sat)},sci(r,e){b.upgradeExtension(e,W.scientific)},item(r){ce.before("0.8.0")&&(b.rename(r,"item:license","license"),b.rename(r,"item:providers","providers"))},table(r,e){b.upgradeExtension(e,W.table)},view(r,e){b.upgradeExtension(e,W.view)}},er={item(r,e=null,t=!0){return eo.migrate(r,e,t)},catalog(r,e=!0){return Qs.migrate(r,e)},collection(r,e=!0){return Js.migrate(r,e)},collectionCollection(r,e=!0){return Tu.migrate(r,e)},itemCollection(r,e=!0){return vu.migrate(r,e)},stac(r,e=!0){return r.type==="Feature"?er.item(r,null,e):r.type==="FeatureCollection"?er.itemCollection(r,e):r.type==="Collection"||!r.type&&b.isDefined(r.extent)&&b.isDefined(r.license)?er.collection(r,e):!r.type&&Array.isArray(r.collections)?er.collectionCollection(r,e):er.catalog(r,e)},enableMultihash(r){ct.multihash=r}},ax=er;const lx=zn(ax);function Tr(r){let e=r.length>=6,t=r[0],n=r[e?3:2],i=r[1],s=r[e?4:3],o={west:t,east:n,south:i,north:s};return e&&(o.base=r[2],o.height=r[5]),o}function xi(r){let{west:e,east:t,south:n,north:i}=Tr(r);return[[[e,i],[e,n],[t,n],[t,i],[e,i]]]}function ux(r){if(!it(r))return null;let e=Tr(r),t=[];if(Ru(r)){let n=(e.west+360+e.east)/2;n>180&&(n-=360),t.push(n)}else t.push((e.west+e.east)/2);return t.push((e.south+e.north)/2),typeof e.base<"u"&&t.push((e.base+e.height)/2),t}function Su(r){if(it(r)?r=[r]:Array.isArray(r)&&(r=r.filter(n=>it(n))),!Array.isArray(r)||r.length===0)return null;let e=r.reduce((n,i)=>{if(Ru(i)){let{west:s,east:o,south:a,north:l}=Tr(i);n.push(xi([-180,a,o,l])),n.push(xi([s,a,180,l]))}else n.push(xi(i));return n},[]),t=null;if(e.length===1?t={type:"Polygon",coordinates:e[0]}:e.length>1&&(t={type:"MultiPolygon",coordinates:e}),t)return{type:"Feature",geometry:t,properties:{}}}function it(r){if(!Array.isArray(r)||![4,6].includes(r.length)||r.some(s=>typeof s!="number"))return!1;let{west:e,east:t,south:n,north:i}=Tr(r);return n<=i&&e>=-180&&e<=180&&n>=-90&&t<=180&&t>=-180&&i<=90}function Ru(r){if(!it(r))return!1;let{west:e,east:t}=Tr(r);return e>t}function bu(r){if(!Array.isArray(r)||r.length===0)return null;let e={west:180,south:90,east:-180,north:-90};r.forEach(n=>{if(!it(n))return;let i=Tr(n),s=["west","south"];for(let o in i){let a=s.includes(o)?Math.min:Math.max;e[o]=a(e[o],i[o])}});let t=[e.west,e.south,e.east,e.north];return it(t)?t:null}function ke(r){return typeof r=="string"&&r.length>0}function ze(r){return typeof r=="object"&&r===Object(r)&&!Array.isArray(r)}function Pu(...r){if(r=r.filter(e=>Array.isArray(e)),r.length>1){let e=Math.max(...r.map(n=>n.length)),t=[];for(let n=0;n<e;n++)t.push(Object.assign({},...r.map(i=>i[n])));return t}else if(r.length===1)return r[0];return[]}function cx(r){switch(r){case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648}return r.startsWith("u")?0:null}function hx(r){switch(r){case"int8":return 127;case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295}return null}class Qn{constructor(e,t={},n=[]){if(!ze(e))throw new Error("Given data is not an object");if(e instanceof Qn){for(let i of n)this[i]=e[i];e=e.toJSON()}this._keyMap=t,this._privateKeys=["_keyMap","_privateKeys"].concat(n);for(let i in e)typeof this[i]>"u"&&(i in t?this[i]=t[i](e[i],this):this[i]=e[i])}isItem(){return this.type==="Feature"}isCatalog(){return this.type==="Catalog"}isCatalogLike(){return this.isCatalog()||this.isCollection()}isCollection(){return this.type==="Collection"}isItemCollection(){return this.type==="FeatureCollection"}isCollectionCollection(){return!1}isAsset(){return!1}isLink(){return!1}getObjectType(){}getAbsoluteUrl(){return null}getMetadata(e){return this[e]}toGeoJSON(){return null}getBoundingBox(){return null}getCenter(){return ux(this.getBoundingBox())}getBoundingBoxes(){return[]}toJSON(){let e={};return Object.keys(this).forEach(t=>{if(typeof this[t]=="function"||this._privateKeys.includes(t))return;let n=this[t];if(t in this._keyMap){let i=Array.isArray(n)?[]:{};for(let s in n)i[s]=n[s].toJSON();n=i}e[t]=n}),e}}var Au={exports:{}},Lr={exports:{}};/*! https://mths.be/punycode v1.4.0 by @mathias */Lr.exports;var fa;function fx(){return fa||(fa=1,function(r,e){(function(t){var n=e&&!e.nodeType&&e,i=r&&!r.nodeType&&r,s=typeof zt=="object"&&zt;(s.global===s||s.window===s||s.self===s)&&(t=s);var o,a=2147483647,l=36,u=1,h=26,f=38,d=700,g=72,m=128,y="-",x=/^xn--/,w=/[^\x20-\x7E]/,E=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},S=l-u,A=Math.floor,O=String.fromCharCode,L;function F(N){throw new RangeError(v[N])}function U(N,z){for(var X=N.length,ae=[];X--;)ae[X]=z(N[X]);return ae}function k(N,z){var X=N.split("@"),ae="";X.length>1&&(ae=X[0]+"@",N=X[1]),N=N.replace(E,".");var oe=N.split("."),ue=U(oe,z).join(".");return ae+ue}function V(N){for(var z=[],X=0,ae=N.length,oe,ue;X<ae;)oe=N.charCodeAt(X++),oe>=55296&&oe<=56319&&X<ae?(ue=N.charCodeAt(X++),(ue&64512)==56320?z.push(((oe&1023)<<10)+(ue&1023)+65536):(z.push(oe),X--)):z.push(oe);return z}function ee(N){return U(N,function(z){var X="";return z>65535&&(z-=65536,X+=O(z>>>10&1023|55296),z=56320|z&1023),X+=O(z),X}).join("")}function c(N){return N-48<10?N-22:N-65<26?N-65:N-97<26?N-97:l}function p(N,z){return N+22+75*(N<26)-((z!=0)<<5)}function _(N,z,X){var ae=0;for(N=X?A(N/d):N>>1,N+=A(N/z);N>S*h>>1;ae+=l)N=A(N/S);return A(ae+(S+1)*N/(N+f))}function T(N){var z=[],X=N.length,ae,oe=0,ue=m,le=g,ye,Le,be,Oe,Ie,De,Qe,St,Nt;for(ye=N.lastIndexOf(y),ye<0&&(ye=0),Le=0;Le<ye;++Le)N.charCodeAt(Le)>=128&&F("not-basic"),z.push(N.charCodeAt(Le));for(be=ye>0?ye+1:0;be<X;){for(Oe=oe,Ie=1,De=l;be>=X&&F("invalid-input"),Qe=c(N.charCodeAt(be++)),(Qe>=l||Qe>A((a-oe)/Ie))&&F("overflow"),oe+=Qe*Ie,St=De<=le?u:De>=le+h?h:De-le,!(Qe<St);De+=l)Nt=l-St,Ie>A(a/Nt)&&F("overflow"),Ie*=Nt;ae=z.length+1,le=_(oe-Oe,ae,Oe==0),A(oe/ae)>a-ue&&F("overflow"),ue+=A(oe/ae),oe%=ae,z.splice(oe++,0,ue)}return ee(z)}function I(N){var z,X,ae,oe,ue,le,ye,Le,be,Oe,Ie,De=[],Qe,St,Nt,Jn;for(N=V(N),Qe=N.length,z=m,X=0,ue=g,le=0;le<Qe;++le)Ie=N[le],Ie<128&&De.push(O(Ie));for(ae=oe=De.length,oe&&De.push(y);ae<Qe;){for(ye=a,le=0;le<Qe;++le)Ie=N[le],Ie>=z&&Ie<ye&&(ye=Ie);for(St=ae+1,ye-z>A((a-X)/St)&&F("overflow"),X+=(ye-z)*St,z=ye,le=0;le<Qe;++le)if(Ie=N[le],Ie<z&&++X>a&&F("overflow"),Ie==z){for(Le=X,be=l;Oe=be<=ue?u:be>=ue+h?h:be-ue,!(Le<Oe);be+=l)Jn=Le-Oe,Nt=l-Oe,De.push(O(p(Oe+Jn%Nt,0))),Le=A(Jn/Nt);De.push(O(p(Le,0))),ue=_(X,St,ae==oe),X=0,++ae}++X,++z}return De.join("")}function C(N){return k(N,function(z){return x.test(z)?T(z.slice(4).toLowerCase()):z})}function M(N){return k(N,function(z){return w.test(z)?"xn--"+I(z):z})}if(o={version:"1.3.2",ucs2:{decode:V,encode:ee},decode:T,encode:I,toASCII:M,toUnicode:C},n&&i)if(r.exports==n)i.exports=o;else for(L in o)o.hasOwnProperty(L)&&(n[L]=o[L]);else t.punycode=o})(zt)}(Lr,Lr.exports)),Lr.exports}var Ei={exports:{}};/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var da;function dx(){return da||(da=1,function(r){(function(e,t){r.exports?r.exports=t():e.IPv6=t(e)})(zt,function(e){var t=e&&e.IPv6;function n(s){var o=s.toLowerCase(),a=o.split(":"),l=a.length,u=8;a[0]===""&&a[1]===""&&a[2]===""?(a.shift(),a.shift()):a[0]===""&&a[1]===""?a.shift():a[l-1]===""&&a[l-2]===""&&a.pop(),l=a.length,a[l-1].indexOf(".")!==-1&&(u=7);var h;for(h=0;h<l&&a[h]!=="";h++);if(h<u)for(a.splice(h,1,"0000");a.length<u;)a.splice(h,0,"0000");for(var f,d=0;d<u;d++){f=a[d].split("");for(var g=0;g<3&&(f[0]==="0"&&f.length>1);g++)f.splice(0,1);a[d]=f.join("")}var m=-1,y=0,x=0,w=-1,E=!1;for(d=0;d<u;d++)E?a[d]==="0"?x+=1:(E=!1,x>y&&(m=w,y=x)):a[d]==="0"&&(E=!0,w=d,x=1);x>y&&(m=w,y=x),y>1&&a.splice(m,y,""),l=a.length;var v="";for(a[0]===""&&(v=":"),d=0;d<l&&(v+=a[d],d!==l-1);d++)v+=":";return a[l-1]===""&&(v+=":"),v}function i(){return e.IPv6===this&&(e.IPv6=t),this}return{best:n,noConflict:i}})}(Ei)),Ei.exports}var wi={exports:{}};/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var pa;function px(){return pa||(pa=1,function(r){(function(e,t){r.exports?r.exports=t():e.SecondLevelDomains=t(e)})(zt,function(e){var t=e&&e.SecondLevelDomains,n={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return!1;var o=i.lastIndexOf(".",s-1);if(o<=0||o>=s-1)return!1;var a=n.list[i.slice(s+1)];return a?a.indexOf(" "+i.slice(o+1,s)+" ")>=0:!1},is:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return!1;var o=i.lastIndexOf(".",s-1);if(o>=0)return!1;var a=n.list[i.slice(s+1)];return a?a.indexOf(" "+i.slice(0,s)+" ")>=0:!1},get:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return null;var o=i.lastIndexOf(".",s-1);if(o<=0||o>=s-1)return null;var a=n.list[i.slice(s+1)];return!a||a.indexOf(" "+i.slice(o+1,s)+" ")<0?null:i.slice(o+1)},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=t),this}};return n})}(wi)),wi.exports}/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(r){(function(e,t){r.exports?r.exports=t(fx(),dx(),px()):e.URI=t(e.punycode,e.IPv6,e.SecondLevelDomains,e)})(zt,function(e,t,n,i){var s=i&&i.URI;function o(c,p){var _=arguments.length>=1,T=arguments.length>=2;if(!(this instanceof o))return _?T?new o(c,p):new o(c):new o;if(c===void 0){if(_)throw new TypeError("undefined is not a valid argument for URI");typeof location<"u"?c=location.href+"":c=""}if(c===null&&_)throw new TypeError("null is not a valid argument for URI");return this.href(c),p!==void 0?this.absoluteTo(p):this}function a(c){return/^[0-9]+$/.test(c)}o.version="1.19.11";var l=o.prototype,u=Object.prototype.hasOwnProperty;function h(c){return c.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function f(c){return c===void 0?"Undefined":String(Object.prototype.toString.call(c)).slice(8,-1)}function d(c){return f(c)==="Array"}function g(c,p){var _={},T,I;if(f(p)==="RegExp")_=null;else if(d(p))for(T=0,I=p.length;T<I;T++)_[p[T]]=!0;else _[p]=!0;for(T=0,I=c.length;T<I;T++){var C=_&&_[c[T]]!==void 0||!_&&p.test(c[T]);C&&(c.splice(T,1),I--,T--)}return c}function m(c,p){var _,T;if(d(p)){for(_=0,T=p.length;_<T;_++)if(!m(c,p[_]))return!1;return!0}var I=f(p);for(_=0,T=c.length;_<T;_++)if(I==="RegExp"){if(typeof c[_]=="string"&&c[_].match(p))return!0}else if(c[_]===p)return!0;return!1}function y(c,p){if(!d(c)||!d(p)||c.length!==p.length)return!1;c.sort(),p.sort();for(var _=0,T=c.length;_<T;_++)if(c[_]!==p[_])return!1;return!0}function x(c){var p=/^\/+|\/+$/g;return c.replace(p,"")}o._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:o.preventInvalidHostname,duplicateQueryParameters:o.duplicateQueryParameters,escapeQuerySpace:o.escapeQuerySpace}},o.preventInvalidHostname=!1,o.duplicateQueryParameters=!1,o.escapeQuerySpace=!0,o.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,o.idn_expression=/[^a-z0-9\._-]/i,o.punycode_expression=/(xn--)/i,o.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,o.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig,o.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},o.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,o.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,o.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},o.hostProtocols=["http","https"],o.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,o.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},o.getDomAttribute=function(c){if(!(!c||!c.nodeName)){var p=c.nodeName.toLowerCase();if(!(p==="input"&&c.type!=="image"))return o.domAttributes[p]}};function w(c){return escape(c)}function E(c){return encodeURIComponent(c).replace(/[!'()*]/g,w).replace(/\*/g,"%2A")}o.encode=E,o.decode=decodeURIComponent,o.iso8859=function(){o.encode=escape,o.decode=unescape},o.unicode=function(){o.encode=E,o.decode=decodeURIComponent},o.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},o.encodeQuery=function(c,p){var _=o.encode(c+"");return p===void 0&&(p=o.escapeQuerySpace),p?_.replace(/%20/g,"+"):_},o.decodeQuery=function(c,p){c+="",p===void 0&&(p=o.escapeQuerySpace);try{return o.decode(p?c.replace(/\+/g,"%20"):c)}catch{return c}};var v={encode:"encode",decode:"decode"},S,A=function(c,p){return function(_){try{return o[p](_+"").replace(o.characters[c][p].expression,function(T){return o.characters[c][p].map[T]})}catch{return _}}};for(S in v)o[S+"PathSegment"]=A("pathname",v[S]),o[S+"UrnPathSegment"]=A("urnpath",v[S]);var O=function(c,p,_){return function(T){var I;_?I=function(z){return o[p](o[_](z))}:I=o[p];for(var C=(T+"").split(c),M=0,N=C.length;M<N;M++)C[M]=I(C[M]);return C.join(c)}};o.decodePath=O("/","decodePathSegment"),o.decodeUrnPath=O(":","decodeUrnPathSegment"),o.recodePath=O("/","encodePathSegment","decode"),o.recodeUrnPath=O(":","encodeUrnPathSegment","decode"),o.encodeReserved=A("reserved","encode"),o.parse=function(c,p){var _;return p||(p={preventInvalidHostname:o.preventInvalidHostname}),c=c.replace(o.leading_whitespace_expression,""),c=c.replace(o.ascii_tab_whitespace,""),_=c.indexOf("#"),_>-1&&(p.fragment=c.substring(_+1)||null,c=c.substring(0,_)),_=c.indexOf("?"),_>-1&&(p.query=c.substring(_+1)||null,c=c.substring(0,_)),c=c.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://"),c=c.replace(/^[/\\]{2,}/i,"//"),c.substring(0,2)==="//"?(p.protocol=null,c=c.substring(2),c=o.parseAuthority(c,p)):(_=c.indexOf(":"),_>-1&&(p.protocol=c.substring(0,_)||null,p.protocol&&!p.protocol.match(o.protocol_expression)?p.protocol=void 0:c.substring(_+1,_+3).replace(/\\/g,"/")==="//"?(c=c.substring(_+3),c=o.parseAuthority(c,p)):(c=c.substring(_+1),p.urn=!0))),p.path=c,p},o.parseHost=function(c,p){c||(c=""),c=c.replace(/\\/g,"/");var _=c.indexOf("/"),T,I;if(_===-1&&(_=c.length),c.charAt(0)==="[")T=c.indexOf("]"),p.hostname=c.substring(1,T)||null,p.port=c.substring(T+2,_)||null,p.port==="/"&&(p.port=null);else{var C=c.indexOf(":"),M=c.indexOf("/"),N=c.indexOf(":",C+1);N!==-1&&(M===-1||N<M)?(p.hostname=c.substring(0,_)||null,p.port=null):(I=c.substring(0,_).split(":"),p.hostname=I[0]||null,p.port=I[1]||null)}return p.hostname&&c.substring(_).charAt(0)!=="/"&&(_++,c="/"+c),p.preventInvalidHostname&&o.ensureValidHostname(p.hostname,p.protocol),p.port&&o.ensureValidPort(p.port),c.substring(_)||"/"},o.parseAuthority=function(c,p){return c=o.parseUserinfo(c,p),o.parseHost(c,p)},o.parseUserinfo=function(c,p){var _=c,T=c.indexOf("\\");T!==-1&&(c=c.replace(/\\/g,"/"));var I=c.indexOf("/"),C=c.lastIndexOf("@",I>-1?I:c.length-1),M;return C>-1&&(I===-1||C<I)?(M=c.substring(0,C).split(":"),p.username=M[0]?o.decode(M[0]):null,M.shift(),p.password=M[0]?o.decode(M.join(":")):null,c=_.substring(C+1)):(p.username=null,p.password=null),c},o.parseQuery=function(c,p){if(!c)return{};if(c=c.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!c)return{};for(var _={},T=c.split("&"),I=T.length,C,M,N,z=0;z<I;z++)C=T[z].split("="),M=o.decodeQuery(C.shift(),p),N=C.length?o.decodeQuery(C.join("="),p):null,M!=="__proto__"&&(u.call(_,M)?((typeof _[M]=="string"||_[M]===null)&&(_[M]=[_[M]]),_[M].push(N)):_[M]=N);return _},o.build=function(c){var p="",_=!1;return c.protocol&&(p+=c.protocol+":"),!c.urn&&(p||c.hostname)&&(p+="//",_=!0),p+=o.buildAuthority(c)||"",typeof c.path=="string"&&(c.path.charAt(0)!=="/"&&_&&(p+="/"),p+=c.path),typeof c.query=="string"&&c.query&&(p+="?"+c.query),typeof c.fragment=="string"&&c.fragment&&(p+="#"+c.fragment),p},o.buildHost=function(c){var p="";if(c.hostname)o.ip6_expression.test(c.hostname)?p+="["+c.hostname+"]":p+=c.hostname;else return"";return c.port&&(p+=":"+c.port),p},o.buildAuthority=function(c){return o.buildUserinfo(c)+o.buildHost(c)},o.buildUserinfo=function(c){var p="";return c.username&&(p+=o.encode(c.username)),c.password&&(p+=":"+o.encode(c.password)),p&&(p+="@"),p},o.buildQuery=function(c,p,_){var T="",I,C,M,N;for(C in c)if(C!=="__proto__"&&u.call(c,C))if(d(c[C]))for(I={},M=0,N=c[C].length;M<N;M++)c[C][M]!==void 0&&I[c[C][M]+""]===void 0&&(T+="&"+o.buildQueryParameter(C,c[C][M],_),p!==!0&&(I[c[C][M]+""]=!0));else c[C]!==void 0&&(T+="&"+o.buildQueryParameter(C,c[C],_));return T.substring(1)},o.buildQueryParameter=function(c,p,_){return o.encodeQuery(c,_)+(p!==null?"="+o.encodeQuery(p,_):"")},o.addQuery=function(c,p,_){if(typeof p=="object")for(var T in p)u.call(p,T)&&o.addQuery(c,T,p[T]);else if(typeof p=="string"){if(c[p]===void 0){c[p]=_;return}else typeof c[p]=="string"&&(c[p]=[c[p]]);d(_)||(_=[_]),c[p]=(c[p]||[]).concat(_)}else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")},o.setQuery=function(c,p,_){if(typeof p=="object")for(var T in p)u.call(p,T)&&o.setQuery(c,T,p[T]);else if(typeof p=="string")c[p]=_===void 0?null:_;else throw new TypeError("URI.setQuery() accepts an object, string as the name parameter")},o.removeQuery=function(c,p,_){var T,I,C;if(d(p))for(T=0,I=p.length;T<I;T++)c[p[T]]=void 0;else if(f(p)==="RegExp")for(C in c)p.test(C)&&(c[C]=void 0);else if(typeof p=="object")for(C in p)u.call(p,C)&&o.removeQuery(c,C,p[C]);else if(typeof p=="string")_!==void 0?f(_)==="RegExp"?!d(c[p])&&_.test(c[p])?c[p]=void 0:c[p]=g(c[p],_):c[p]===String(_)&&(!d(_)||_.length===1)?c[p]=void 0:d(c[p])&&(c[p]=g(c[p],_)):c[p]=void 0;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")},o.hasQuery=function(c,p,_,T){switch(f(p)){case"String":break;case"RegExp":for(var I in c)if(u.call(c,I)&&p.test(I)&&(_===void 0||o.hasQuery(c,I,_)))return!0;return!1;case"Object":for(var C in p)if(u.call(p,C)&&!o.hasQuery(c,C,p[C]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(f(_)){case"Undefined":return p in c;case"Boolean":var M=!!(d(c[p])?c[p].length:c[p]);return _===M;case"Function":return!!_(c[p],p,c);case"Array":if(!d(c[p]))return!1;var N=T?m:y;return N(c[p],_);case"RegExp":return d(c[p])?T?m(c[p],_):!1:!!(c[p]&&c[p].match(_));case"Number":_=String(_);case"String":return d(c[p])?T?m(c[p],_):!1:c[p]===_;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},o.joinPaths=function(){for(var c=[],p=[],_=0,T=0;T<arguments.length;T++){var I=new o(arguments[T]);c.push(I);for(var C=I.segment(),M=0;M<C.length;M++)typeof C[M]=="string"&&p.push(C[M]),C[M]&&_++}if(!p.length||!_)return new o("");var N=new o("").segment(p);return(c[0].path()===""||c[0].path().slice(0,1)==="/")&&N.path("/"+N.path()),N.normalize()},o.commonPath=function(c,p){var _=Math.min(c.length,p.length),T;for(T=0;T<_;T++)if(c.charAt(T)!==p.charAt(T)){T--;break}return T<1?c.charAt(0)===p.charAt(0)&&c.charAt(0)==="/"?"/":"":((c.charAt(T)!=="/"||p.charAt(T)!=="/")&&(T=c.substring(0,T).lastIndexOf("/")),c.substring(0,T+1))},o.withinString=function(c,p,_){_||(_={});var T=_.start||o.findUri.start,I=_.end||o.findUri.end,C=_.trim||o.findUri.trim,M=_.parens||o.findUri.parens,N=/[a-z0-9-]=["']?$/i;for(T.lastIndex=0;;){var z=T.exec(c);if(!z)break;var X=z.index;if(_.ignoreHtml){var ae=c.slice(Math.max(X-3,0),X);if(ae&&N.test(ae))continue}for(var oe=X+c.slice(X).search(I),ue=c.slice(X,oe),le=-1;;){var ye=M.exec(ue);if(!ye)break;var Le=ye.index+ye[0].length;le=Math.max(le,Le)}if(le>-1?ue=ue.slice(0,le)+ue.slice(le).replace(C,""):ue=ue.replace(C,""),!(ue.length<=z[0].length)&&!(_.ignore&&_.ignore.test(ue))){oe=X+ue.length;var be=p(ue,X,oe,c);if(be===void 0){T.lastIndex=oe;continue}be=String(be),c=c.slice(0,X)+be+c.slice(oe),T.lastIndex=X+be.length}}return T.lastIndex=0,c},o.ensureValidHostname=function(c,p){var _=!!c,T=!!p,I=!1;if(T&&(I=m(o.hostProtocols,p)),I&&!_)throw new TypeError("Hostname cannot be empty, if protocol is "+p);if(c&&c.match(o.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+c+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(c).match(o.invalid_hostname_characters))throw new TypeError('Hostname "'+c+'" contains characters other than [A-Z0-9.-:_]')}},o.ensureValidPort=function(c){if(c){var p=Number(c);if(!(a(p)&&p>0&&p<65536))throw new TypeError('Port "'+c+'" is not a valid port')}},o.noConflict=function(c){if(c){var p={URI:this.noConflict()};return i.URITemplate&&typeof i.URITemplate.noConflict=="function"&&(p.URITemplate=i.URITemplate.noConflict()),i.IPv6&&typeof i.IPv6.noConflict=="function"&&(p.IPv6=i.IPv6.noConflict()),i.SecondLevelDomains&&typeof i.SecondLevelDomains.noConflict=="function"&&(p.SecondLevelDomains=i.SecondLevelDomains.noConflict()),p}else i.URI===this&&(i.URI=s);return this},l.build=function(c){return c===!0?this._deferred_build=!0:(c===void 0||this._deferred_build)&&(this._string=o.build(this._parts),this._deferred_build=!1),this},l.clone=function(){return new o(this)},l.valueOf=l.toString=function(){return this.build(!1)._string};function L(c){return function(p,_){return p===void 0?this._parts[c]||"":(this._parts[c]=p||null,this.build(!_),this)}}function F(c,p){return function(_,T){return _===void 0?this._parts[c]||"":(_!==null&&(_=_+"",_.charAt(0)===p&&(_=_.substring(1))),this._parts[c]=_,this.build(!T),this)}}l.protocol=L("protocol"),l.username=L("username"),l.password=L("password"),l.hostname=L("hostname"),l.port=L("port"),l.query=F("query","?"),l.fragment=F("fragment","#"),l.search=function(c,p){var _=this.query(c,p);return typeof _=="string"&&_.length?"?"+_:_},l.hash=function(c,p){var _=this.fragment(c,p);return typeof _=="string"&&_.length?"#"+_:_},l.pathname=function(c,p){if(c===void 0||c===!0){var _=this._parts.path||(this._parts.hostname?"/":"");return c?(this._parts.urn?o.decodeUrnPath:o.decodePath)(_):_}else return this._parts.urn?this._parts.path=c?o.recodeUrnPath(c):"":this._parts.path=c?o.recodePath(c):"/",this.build(!p),this},l.path=l.pathname,l.href=function(c,p){var _;if(c===void 0)return this.toString();this._string="",this._parts=o._parts();var T=c instanceof o,I=typeof c=="object"&&(c.hostname||c.path||c.pathname);if(c.nodeName){var C=o.getDomAttribute(c);c=c[C]||"",I=!1}if(!T&&I&&c.pathname!==void 0&&(c=c.toString()),typeof c=="string"||c instanceof String)this._parts=o.parse(String(c),this._parts);else if(T||I){var M=T?c._parts:c;for(_ in M)_!=="query"&&u.call(this._parts,_)&&(this._parts[_]=M[_]);M.query&&this.query(M.query,!1)}else throw new TypeError("invalid input");return this.build(!p),this},l.is=function(c){var p=!1,_=!1,T=!1,I=!1,C=!1,M=!1,N=!1,z=!this._parts.urn;switch(this._parts.hostname&&(z=!1,_=o.ip4_expression.test(this._parts.hostname),T=o.ip6_expression.test(this._parts.hostname),p=_||T,I=!p,C=I&&n&&n.has(this._parts.hostname),M=I&&o.idn_expression.test(this._parts.hostname),N=I&&o.punycode_expression.test(this._parts.hostname)),c.toLowerCase()){case"relative":return z;case"absolute":return!z;case"domain":case"name":return I;case"sld":return C;case"ip":return p;case"ip4":case"ipv4":case"inet4":return _;case"ip6":case"ipv6":case"inet6":return T;case"idn":return M;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return N}return null};var U=l.protocol,k=l.port,V=l.hostname;l.protocol=function(c,p){if(c&&(c=c.replace(/:(\/\/)?$/,""),!c.match(o.protocol_expression)))throw new TypeError('Protocol "'+c+`" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]`);return U.call(this,c,p)},l.scheme=l.protocol,l.port=function(c,p){return this._parts.urn?c===void 0?"":this:(c!==void 0&&(c===0&&(c=null),c&&(c+="",c.charAt(0)===":"&&(c=c.substring(1)),o.ensureValidPort(c))),k.call(this,c,p))},l.hostname=function(c,p){if(this._parts.urn)return c===void 0?"":this;if(c!==void 0){var _={preventInvalidHostname:this._parts.preventInvalidHostname},T=o.parseHost(c,_);if(T!=="/")throw new TypeError('Hostname "'+c+'" contains characters other than [A-Z0-9.-]');c=_.hostname,this._parts.preventInvalidHostname&&o.ensureValidHostname(c,this._parts.protocol)}return V.call(this,c,p)},l.origin=function(c,p){if(this._parts.urn)return c===void 0?"":this;if(c===void 0){var _=this.protocol(),T=this.authority();return T?(_?_+"://":"")+this.authority():""}else{var I=o(c);return this.protocol(I.protocol()).authority(I.authority()).build(!p),this}},l.host=function(c,p){if(this._parts.urn)return c===void 0?"":this;if(c===void 0)return this._parts.hostname?o.buildHost(this._parts):"";var _=o.parseHost(c,this._parts);if(_!=="/")throw new TypeError('Hostname "'+c+'" contains characters other than [A-Z0-9.-]');return this.build(!p),this},l.authority=function(c,p){if(this._parts.urn)return c===void 0?"":this;if(c===void 0)return this._parts.hostname?o.buildAuthority(this._parts):"";var _=o.parseAuthority(c,this._parts);if(_!=="/")throw new TypeError('Hostname "'+c+'" contains characters other than [A-Z0-9.-]');return this.build(!p),this},l.userinfo=function(c,p){if(this._parts.urn)return c===void 0?"":this;if(c===void 0){var _=o.buildUserinfo(this._parts);return _&&_.substring(0,_.length-1)}else return c[c.length-1]!=="@"&&(c+="@"),o.parseUserinfo(c,this._parts),this.build(!p),this},l.resource=function(c,p){var _;return c===void 0?this.path()+this.search()+this.hash():(_=o.parse(c),this._parts.path=_.path,this._parts.query=_.query,this._parts.fragment=_.fragment,this.build(!p),this)},l.subdomain=function(c,p){if(this._parts.urn)return c===void 0?"":this;if(c===void 0){if(!this._parts.hostname||this.is("IP"))return"";var _=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,_)||""}else{var T=this._parts.hostname.length-this.domain().length,I=this._parts.hostname.substring(0,T),C=new RegExp("^"+h(I));if(c&&c.charAt(c.length-1)!=="."&&(c+="."),c.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return c&&o.ensureValidHostname(c,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(C,c),this.build(!p),this}},l.domain=function(c,p){if(this._parts.urn)return c===void 0?"":this;if(typeof c=="boolean"&&(p=c,c=void 0),c===void 0){if(!this._parts.hostname||this.is("IP"))return"";var _=this._parts.hostname.match(/\./g);if(_&&_.length<2)return this._parts.hostname;var T=this._parts.hostname.length-this.tld(p).length-1;return T=this._parts.hostname.lastIndexOf(".",T-1)+1,this._parts.hostname.substring(T)||""}else{if(!c)throw new TypeError("cannot set domain empty");if(c.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");if(o.ensureValidHostname(c,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=c;else{var I=new RegExp(h(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(I,c)}return this.build(!p),this}},l.tld=function(c,p){if(this._parts.urn)return c===void 0?"":this;if(typeof c=="boolean"&&(p=c,c=void 0),c===void 0){if(!this._parts.hostname||this.is("IP"))return"";var _=this._parts.hostname.lastIndexOf("."),T=this._parts.hostname.substring(_+1);return p!==!0&&n&&n.list[T.toLowerCase()]&&n.get(this._parts.hostname)||T}else{var I;if(c)if(c.match(/[^a-zA-Z0-9-]/))if(n&&n.is(c))I=new RegExp(h(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(I,c);else throw new TypeError('TLD "'+c+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");I=new RegExp(h(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(I,c)}else throw new TypeError("cannot set TLD empty");return this.build(!p),this}},l.directory=function(c,p){if(this._parts.urn)return c===void 0?"":this;if(c===void 0||c===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var _=this._parts.path.length-this.filename().length-1,T=this._parts.path.substring(0,_)||(this._parts.hostname?"/":"");return c?o.decodePath(T):T}else{var I=this._parts.path.length-this.filename().length,C=this._parts.path.substring(0,I),M=new RegExp("^"+h(C));return this.is("relative")||(c||(c="/"),c.charAt(0)!=="/"&&(c="/"+c)),c&&c.charAt(c.length-1)!=="/"&&(c+="/"),c=o.recodePath(c),this._parts.path=this._parts.path.replace(M,c),this.build(!p),this}},l.filename=function(c,p){if(this._parts.urn)return c===void 0?"":this;if(typeof c!="string"){if(!this._parts.path||this._parts.path==="/")return"";var _=this._parts.path.lastIndexOf("/"),T=this._parts.path.substring(_+1);return c?o.decodePathSegment(T):T}else{var I=!1;c.charAt(0)==="/"&&(c=c.substring(1)),c.match(/\.?\//)&&(I=!0);var C=new RegExp(h(this.filename())+"$");return c=o.recodePath(c),this._parts.path=this._parts.path.replace(C,c),I?this.normalizePath(p):this.build(!p),this}},l.suffix=function(c,p){if(this._parts.urn)return c===void 0?"":this;if(c===void 0||c===!0){if(!this._parts.path||this._parts.path==="/")return"";var _=this.filename(),T=_.lastIndexOf("."),I,C;return T===-1?"":(I=_.substring(T+1),C=/^[a-z0-9%]+$/i.test(I)?I:"",c?o.decodePathSegment(C):C)}else{c.charAt(0)==="."&&(c=c.substring(1));var M=this.suffix(),N;if(M)c?N=new RegExp(h(M)+"$"):N=new RegExp(h("."+M)+"$");else{if(!c)return this;this._parts.path+="."+o.recodePath(c)}return N&&(c=o.recodePath(c),this._parts.path=this._parts.path.replace(N,c)),this.build(!p),this}},l.segment=function(c,p,_){var T=this._parts.urn?":":"/",I=this.path(),C=I.substring(0,1)==="/",M=I.split(T);if(c!==void 0&&typeof c!="number"&&(_=p,p=c,c=void 0),c!==void 0&&typeof c!="number")throw new Error('Bad segment "'+c+'", must be 0-based integer');if(C&&M.shift(),c<0&&(c=Math.max(M.length+c,0)),p===void 0)return c===void 0?M:M[c];if(c===null||M[c]===void 0)if(d(p)){M=[];for(var N=0,z=p.length;N<z;N++)!p[N].length&&(!M.length||!M[M.length-1].length)||(M.length&&!M[M.length-1].length&&M.pop(),M.push(x(p[N])))}else(p||typeof p=="string")&&(p=x(p),M[M.length-1]===""?M[M.length-1]=p:M.push(p));else p?M[c]=x(p):M.splice(c,1);return C&&M.unshift(""),this.path(M.join(T),_)},l.segmentCoded=function(c,p,_){var T,I,C;if(typeof c!="number"&&(_=p,p=c,c=void 0),p===void 0){if(T=this.segment(c,p,_),!d(T))T=T!==void 0?o.decode(T):void 0;else for(I=0,C=T.length;I<C;I++)T[I]=o.decode(T[I]);return T}if(!d(p))p=typeof p=="string"||p instanceof String?o.encode(p):p;else for(I=0,C=p.length;I<C;I++)p[I]=o.encode(p[I]);return this.segment(c,p,_)};var ee=l.query;return l.query=function(c,p){if(c===!0)return o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof c=="function"){var _=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace),T=c.call(this,_);return this._parts.query=o.buildQuery(T||_,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!p),this}else return c!==void 0&&typeof c!="string"?(this._parts.query=o.buildQuery(c,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!p),this):ee.call(this,c,p)},l.setQuery=function(c,p,_){var T=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof c=="string"||c instanceof String)T[c]=p!==void 0?p:null;else if(typeof c=="object")for(var I in c)u.call(c,I)&&(T[I]=c[I]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=o.buildQuery(T,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof c!="string"&&(_=p),this.build(!_),this},l.addQuery=function(c,p,_){var T=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.addQuery(T,c,p===void 0?null:p),this._parts.query=o.buildQuery(T,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof c!="string"&&(_=p),this.build(!_),this},l.removeQuery=function(c,p,_){var T=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.removeQuery(T,c,p),this._parts.query=o.buildQuery(T,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof c!="string"&&(_=p),this.build(!_),this},l.hasQuery=function(c,p,_){var T=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.hasQuery(T,c,p,_)},l.setSearch=l.setQuery,l.addSearch=l.addQuery,l.removeSearch=l.removeQuery,l.hasSearch=l.hasQuery,l.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},l.normalizeProtocol=function(c){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!c)),this},l.normalizeHostname=function(c){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!c)),this},l.normalizePort=function(c){return typeof this._parts.protocol=="string"&&this._parts.port===o.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!c)),this},l.normalizePath=function(c){var p=this._parts.path;if(!p)return this;if(this._parts.urn)return this._parts.path=o.recodeUrnPath(this._parts.path),this.build(!c),this;if(this._parts.path==="/")return this;p=o.recodePath(p);var _,T="",I,C;for(p.charAt(0)!=="/"&&(_=!0,p="/"+p),(p.slice(-3)==="/.."||p.slice(-2)==="/.")&&(p+="/"),p=p.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),_&&(T=p.substring(1).match(/^(\.\.\/)+/)||"",T&&(T=T[0]));I=p.search(/\/\.\.(\/|$)/),I!==-1;){if(I===0){p=p.substring(3);continue}C=p.substring(0,I).lastIndexOf("/"),C===-1&&(C=I),p=p.substring(0,C)+p.substring(I+3)}return _&&this.is("relative")&&(p=T+p.substring(1)),this._parts.path=p,this.build(!c),this},l.normalizePathname=l.normalizePath,l.normalizeQuery=function(c){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(o.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!c)),this},l.normalizeFragment=function(c){return this._parts.fragment||(this._parts.fragment=null,this.build(!c)),this},l.normalizeSearch=l.normalizeQuery,l.normalizeHash=l.normalizeFragment,l.iso8859=function(){var c=o.encode,p=o.decode;o.encode=escape,o.decode=decodeURIComponent;try{this.normalize()}finally{o.encode=c,o.decode=p}return this},l.unicode=function(){var c=o.encode,p=o.decode;o.encode=E,o.decode=unescape;try{this.normalize()}finally{o.encode=c,o.decode=p}return this},l.readable=function(){var c=this.clone();c.username("").password("").normalize();var p="";if(c._parts.protocol&&(p+=c._parts.protocol+"://"),c._parts.hostname&&(c.is("punycode")&&e?(p+=e.toUnicode(c._parts.hostname),c._parts.port&&(p+=":"+c._parts.port)):p+=c.host()),c._parts.hostname&&c._parts.path&&c._parts.path.charAt(0)!=="/"&&(p+="/"),p+=c.path(!0),c._parts.query){for(var _="",T=0,I=c._parts.query.split("&"),C=I.length;T<C;T++){var M=(I[T]||"").split("=");_+="&"+o.decodeQuery(M[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),M[1]!==void 0&&(_+="="+o.decodeQuery(M[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}p+="?"+_.substring(1)}return p+=o.decodeQuery(c.hash(),!0),p},l.absoluteTo=function(c){var p=this.clone(),_=["protocol","username","password","hostname","port"],T,I,C;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(c instanceof o||(c=new o(c)),p._parts.protocol||(p._parts.protocol=c._parts.protocol,this._parts.hostname))return p;for(I=0;C=_[I];I++)p._parts[C]=c._parts[C];return p._parts.path?(p._parts.path.substring(-2)===".."&&(p._parts.path+="/"),p.path().charAt(0)!=="/"&&(T=c.directory(),T=T||(c.path().indexOf("/")===0?"/":""),p._parts.path=(T?T+"/":"")+p._parts.path,p.normalizePath())):(p._parts.path=c._parts.path,p._parts.query||(p._parts.query=c._parts.query)),p.build(),p},l.relativeTo=function(c){var p=this.clone().normalize(),_,T,I,C,M;if(p._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(c=new o(c).normalize(),_=p._parts,T=c._parts,C=p.path(),M=c.path(),C.charAt(0)!=="/")throw new Error("URI is already relative");if(M.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");if(_.protocol===T.protocol&&(_.protocol=null),_.username!==T.username||_.password!==T.password||_.protocol!==null||_.username!==null||_.password!==null)return p.build();if(_.hostname===T.hostname&&_.port===T.port)_.hostname=null,_.port=null;else return p.build();if(C===M)return _.path="",p.build();if(I=o.commonPath(C,M),!I)return p.build();var N=T.path.substring(I.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return _.path=N+_.path.substring(I.length)||"./",p.build()},l.equals=function(c){var p=this.clone(),_=new o(c),T={},I={},C={},M,N,z;if(p.normalize(),_.normalize(),p.toString()===_.toString())return!0;if(M=p.query(),N=_.query(),p.query(""),_.query(""),p.toString()!==_.toString()||M.length!==N.length)return!1;T=o.parseQuery(M,this._parts.escapeQuerySpace),I=o.parseQuery(N,this._parts.escapeQuerySpace);for(z in T)if(u.call(T,z)){if(d(T[z])){if(!y(T[z],I[z]))return!1}else if(T[z]!==I[z])return!1;C[z]=!0}for(z in I)if(u.call(I,z)&&!C[z])return!1;return!0},l.preventInvalidHostname=function(c){return this._parts.preventInvalidHostname=!!c,this},l.duplicateQueryParameters=function(c){return this._parts.duplicateQueryParameters=!!c,this},l.escapeQuerySpace=function(c){return this._parts.escapeQuerySpace=!!c,this},o})})(Au);var gx=Au.exports;const ji=zn(gx),ga=["http","https"];function mx(r){return typeof r=="string"&&r.startsWith("/vsi")&&!r.startsWith("/vsicurl/")}function _x(r,e,t=!0){return yx(r,e,!1,t)}function yx(r,e=null,t=!1,n=!0){typeof r=="string"&&r.startsWith("/vsicurl/")&&(r=r.replace(/^\/vsicurl\//,""));let i=ji(r);if(e&&i.is("relative")&&!mx(r)){let s=ji(e),o=s.path();!o.endsWith("/")&&!o.endsWith(".json")&&s.path(o+"/"),i=i.absoluteTo(s)}return i.normalize(),t&&(i.query(""),i.fragment("")),n?i.toString():i}const xx="application/geo+json",Ex=["application/json",xx,"text/json"],ma=["image/gif","image/jpeg","image/apng","image/png","image/webp"],Iu=["image/tiff; application=geotiff; profile=cloud-optimized","image/vnd.stac.geotiff; cloud-optimized=true"],Lu=["application/geotiff","image/tiff; application=geotiff","image/vnd.stac.geotiff"].concat(Iu);function to(r,e,t=!1){return Array.isArray(e)||(e=[e]),t&&typeof r>"u"?!0:typeof r!="string"?!1:(e=e.map(n=>n.toLowerCase()),e.includes(r.toLowerCase()))}function wx(r,e=!1){return to(r,Ex,e)}class Cu extends Qn{constructor(e,t=null,n={},i=[]){super(e,n,["_context"].concat(i)),this._context||(this._context=t)}getAbsoluteUrl(e=!0){return this._context?_x(this.href,this._context.getAbsoluteUrl(),e):this.href.includes("://")?this.href:null}getContext(){return this._context}canBrowserDisplayImage(e=!1){if(typeof this.href!="string")return!1;if(!e&&typeof this.type>"u")return!1;let t=new ji(this.href),n=t.protocol().toLowerCase(),i=t.suffix().toLowerCase();return ke(n)&&!ga.includes(n)?!1:ke(this.type)&&ma.includes(this.type.toLowerCase())?!0:!!(typeof this.type>"u"&&ke(i)&&(i==="jpg"||ma.includes("image/"+i)))}isType(e){return ke(this.type)&&to(this.type,e)}isGeoTIFF(){return this.isType(Lu)}isCOG(){return this.isType(Iu)}isHTTP(){let t=this.getAbsoluteUrl(!1).protocol().toLowerCase();return ke(t)&&ga.includes(t)}}class ro extends Cu{constructor(e,t=null){super(e,t)}isLink(){return!0}getObjectType(){return"Link"}static fromLinks(e,t=null){return Array.isArray(e)?e.map(n=>ze(n)?new ro(n,t):n):[]}}class Ou extends Qn{constructor(e,t=null,n={},i=[]){if(super(e,Object.assign({links:ro.fromLinks},n),["_url"].concat(i)),!this._url&&(this._url=t,!this._url)){let s=this.getSelfLink();s&&(this._url=s.href)}}getAbsoluteUrl(){return this._url}setAbsoluteUrl(e){this._url=e}getStacLinksWithRel(e,t=!0){return this.getLinksWithRels([e]).filter(n=>wx(n.type,t))}getStacLinkWithRel(e,t=!0){const n=this.getStacLinksWithRel(e,t);return n.length>0?n[0]:null}getLinks(){return Array.isArray(this.links)?this.links.filter(e=>ze(e)&&ke(e.href)):[]}getLinkWithRel(e){return this.getLinks().find(t=>t.rel===e)||null}getLinksWithRels(e){return this.getLinks().filter(t=>e.includes(t.rel))}getLinksWithOtherRels(e){return this.getLinks().filter(t=>!e.includes(t.rel))}getSelfLink(){return this.getStacLinkWithRel("self")}getRootLink(){return this.getStacLinkWithRel("root")}getParentLink(){return this.getStacLinkWithRel("parent")}}class Mu extends Ou{constructor(e,t=null,n={},i=[]){super(e,t,n,i)}getAll(){return[]}}class Lt extends Cu{constructor(e,t=null,n=null){super(e,n,{},["_key"]),this._key||(this._key=t)}getObjectType(){return"Asset"}isAsset(){return!0}getAbsoluteUrl(e=!0){return this.isDefinition()?null:super.getAbsoluteUrl(e)}getKey(){return this._key}getMetadata(e){if(typeof this[e]<"u")return this[e];if(this._context)return this._context.getMetadata(e)}getBands(){return Pu(this["eo:bands"],this["raster:bands"])}findVisualBands(){let e={red:null,green:null,blue:null},t=this.getBands();for(let i in t){let s=parseInt(i,10),o=t[s];ze(o)&&ke(o.common_name)&&o.common_name in e&&(e[o.common_name]={index:s,band:o})}return Object.values(e).every(i=>i!==null)?e:null}findBand(e,t="name",n=null){Array.isArray(e)||(e=[e]),ze(n)||(n=this.getBands());let i=n.findIndex(s=>ze(s)&&e.includes(s[t]));return i>=0?{index:i,band:n[i]}:null}getBand(e){return ze(e)||e===null?e:this.getBands()[e]||null}getMinMaxValues(e=null){e=this.getBand(e);const t={minimum:null,maximum:null},n=a=>a.minimum!==null&&a.maximum!==null;if(e&&(ze(e.statistics)&&(typeof e.statistics.minimum=="number"&&(t.minimum=e.statistics.minimum),typeof e.statistics.maximum=="number"&&(t.maximum=e.statistics.maximum),n(t))||ze(e.histogram)&&(typeof e.histogram.min=="number"&&(t.minimum=e.histogram.min),typeof e.histogram.max=="number"&&(t.maximum=e.histogram.max),n(t))))return t;let i=this.getMetadata("classification:classes");if(Array.isArray(i)&&(i.reduce((a,l)=>(a.minimum=Math.min(a.minimum,l.value),a.maximum=Math.max(a.maximum,l.value),a),t),n(t)))return t;let s=this.getMetadata("file:values");if(Array.isArray(s)&&(s.reduce((a,l)=>(a.minimum=Math.min(a.minimum,...l.values),a.maximum=Math.max(a.maximum,...l.values),a),t),n(t)))return t;let o=ze(e)&&e.data_type||this.getMetadata("file:data_type");return o&&(t.minimum=cx(o),t.maximum=hx(o)),t}getNoDataValues(e=null){e=this.getBand(e);let t=[];if(e&&typeof e.nodata<"u")t.push(e.nodata);else{let n=this.getMetadata("file:nodata");if(typeof n<"u")t=n;else{let i=this.getMetadata("classification:classes");Array.isArray(i)&&(t=i.filter(s=>!!s.nodata).map(s=>s.value))}}return t.map(n=>n==="nan"?NaN:n==="+inf"?1/0:n==="-inf"?-1/0:n)}isDefinition(){return!ke(this.href)}isHTTP(){return this.isDefinition()?null:super.isHTTP()}hasRole(e,t=!1){return Array.isArray(e)||(e=[e]),t&&e.includes(this.getKey())?!0:Array.isArray(this.roles)&&!!this.roles.find(n=>e.includes(n))}static fromAssets(e,t=null){let n={};if(ze(e))for(let i in e)n[i]=new Lt(e[i],i,t);return n}}class Jr extends Ou{constructor(e,t=null,n={},i=[]){super(e,t,n,i)}getTemporalExtent(){return null}getTemporalExtents(){return[]}getIcons(e=!0){return this.getLinksWithRels(["icon"]).filter(t=>t.canBrowserDisplayImage(e))}getThumbnails(e=!0,t=null){let n=this.getAssetsWithRoles(["thumbnail","overview"],!0);if(n.length===0&&(n=this.getLinksWithRels(["preview"])),e&&(n=n.filter(i=>i.canBrowserDisplayImage())),t&&n.length>1){let i=s=>Array.isArray(s.roles)&&s.roles.includes(t)||s.getKey()===t;n=n.filter(i).concat(n.filter(s=>!i(s)))}return n}getDefaultGeoTIFF(e=!0,t=!1){var i;return(i=this.rankGeoTIFFs(e,t)[0])==null?void 0:i.asset}rankGeoTIFFs(e=!0,t=!1,n=null,i=null){ze(n)||(n={data:1,visual:2,thumbnail:2,overview:3});let s=[],o=this.getAssetsByTypes(Lu);e&&(o=o.filter(l=>l.isHTTP()&&(!t||l.isCOG())));let a=Object.entries(n);for(let l of o){let u=0;if(a.length>0){let h=a.filter(([f])=>l.hasRole(f,!0)).map(([,f])=>f);h.length>0&&(u+=Math.max(...h))}!t&&l.isCOG()&&(u+=2),l.findVisualBands()&&(u+=1),typeof i=="function"&&(u+=i(l)),s.push({asset:l,score:u})}return s.sort((l,u)=>u.score-l.score),s}findVisualAssets(){let e={red:null,green:null,blue:null},t=Object.keys(e),n=this.getAssets();for(let s of n){let o=s.getBands();if(o.length!==1)continue;let a=s.findBand(t,"common_name",o);a&&(e[a.band.common_name]=s)}return Object.values(e).every(s=>s!==null)?e:null}getAsset(e){return ze(this.assets)&&this.assets[e]||null}getAssets(){return ze(this.assets)?Object.values(this.assets):[]}getAssetsWithRoles(e,t=!1){return this.getAssets().filter(n=>n.hasRole(e,t))}getAssetWithRole(e,t=!1){return this.getAssetsWithRoles([e],t)[0]||null}getAssetsByTypes(e){return this.getAssets().filter(t=>to(t.type,e))}equals(e){return this===e?!0:!(e instanceof Jr)||this.getObjectType()!==e.getObjectType()?!1:!!(this.id&&this.id===e.id)}}class Fu extends Jr{constructor(e,t=null,n={},i=[]){super(e,t,n,i)}getObjectType(){return this.type}getSearchLink(e=null){let t=this.getStacLinksWithRel("search");return e?t[0]||null:t.find(n=>n.method===e||!e&&!n.method)||null}getApiCollectionsLink(){return this.getStacLinkWithRel("data")}getApiItemsLink(){return this.getStacLinkWithRel("items")}getChildLinks(){return this.getStacLinksWithRel("child")}getItemLinks(){return this.getStacLinksWithRel("item")}}class Tx extends Fu{constructor(e,t=null){super(e,t)}}function Cr(r){if(ke(r)&&r.length>=10)try{let t=r.match(/^(-?\d{1,})-(\d\d)-(\d\d)[T ](\d\d):(\d\d):(\d\d)(?:\.(\d*))?(?:Z|[+-]00:00)?$/i).slice(1).map(n=>parseInt(n,10));return new Date(Date.UTC(t[0],t[1]-1,t[2],t[3],t[4],t[5],t[6]||0))}catch{return null}return null}function vx(r,e){return new Date(r.valueOf()+(e-r)/2)}function Nu(r){if(!Array.isArray(r)||r.length===0)return null;let e,t;const n=(i,s,o)=>typeof i>"u"?s:i===null||s===null?null:o(i,s);return r.forEach(([i,s])=>{e=n(e,i,Math.min),t=n(t,s,Math.max)}),[e===null?null:new Date(e),t===null?null:new Date(t)]}class Du extends Fu{constructor(e,t=null){const n={assets:Lt.fromAssets,item_assets:Lt.fromAssets};super(e,t,n)}toGeoJSON(){let e=Su(this.getBoundingBoxes());return e&&(e.id=this.id),e}getBoundingBox(){let e=this.getRawBoundingBoxes();return e.length>0&&it(e[0])?e[0]:null}getBoundingBoxes(){let e=this.getRawBoundingBoxes();return e.length===1&&it(e[0])?e:e.length>1?e.filter((t,n)=>n>0&&it(t)):[]}getRawBoundingBoxes(){var t,n;let e=(n=(t=this.extent)==null?void 0:t.spatial)==null?void 0:n.bbox;return Array.isArray(e)&&e.length>0?e:[]}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){var t,n;let e=(n=(t=this.extent)==null?void 0:t.temporal)==null?void 0:n.interval;return Array.isArray(e)&&e.length>0?e.filter(i=>Array.isArray(i)&&(ke(i[0])||ke(i[1]))).map(i=>i.map(s=>Cr(s))):[]}getSummary(e){return this.summaries[e]}getBands(){let e=this.getSummary("eo:bands"),t=this.getSummary("raster:bands"),n=[e,t].filter(i=>Array.isArray(i));return n.length>=2?Pu(...n):n.length===1?n[0]:[]}}class Sx extends Mu{constructor(e,t=null){const n={collections:i=>i.map(s=>new Du(s))};super(e,t,n)}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map(t=>t.toGeoJSON()).filter(t=>t!==null)}}getBoundingBox(){return bu(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map(e=>e.getBoundingBox())}getTemporalExtent(){return Nu(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map(e=>e.getTemporalExtent())}}class Gu extends Jr{constructor(e,t=null){super(e,t,{assets:Lt.fromAssets})}getObjectType(){return"Item"}toGeoJSON(){return this.toJSON()}getBoundingBox(){return it(this.bbox)?this.bbox:null}getBoundingBoxes(){return it(this.bbox)?[this.bbox]:[]}getDateTime(){let e=Cr(this.properties.datetime);if(!e){let t=Cr(this.properties.start_datetime),n=Cr(this.properties.end_datetime);return t&&n?vx(t,n):t||n}return e}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let e=[];return ke(this.properties.start_datetime)||ke(this.properties.end_datetime)?e=[[this.properties.start_datetime||null,this.properties.end_datetime||null]]:ke(this.properties.datetime)&&(e=[[this.properties.datetime,this.properties.datetime]]),e.map(t=>t.map(n=>Cr(n)))}getMetadata(e){return this.properties[e]}getBands(){let e=this.getMetadata("eo:bands");return Array.isArray(e)?e:[]}getCollectionLink(){return this.getStacLinkWithRel("collection")}}class Rx extends Mu{constructor(e,t=null){const n={features:i=>i.map(s=>new Gu(s))};super(e,t,n)}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return bu(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map(e=>e.getBoundingBox())}getTemporalExtent(){return Nu(this.getTemporalExtents())}getTemporalExtents(){return this.features.map(e=>e.getTemporalExtent())}}function bx(r,e=!0,t=!1){return e&&(r=lx.stac(r,t)),r.type==="Feature"?new Gu(r):r.type==="FeatureCollection"?new Rx(r):r.type==="Collection"||!r.type&&typeof r.extent<"u"&&typeof r.license<"u"?new Du(r):!r.type&&Array.isArray(r.collections)?new Sx(r):new Tx(r)}class _a extends Ls{constructor(t){super({...t,state:"loading"});ei(this,"loadImage",t=>new Promise((n,i)=>{const s=new Image;s.addEventListener("load",()=>n(s)),s.addEventListener("error",()=>i(new Error("load failed"))),s.src=t}));const n=new qs(t.url);n.getHeader().then(i=>{this.tileGrid.minZoom=i.minZoom,this.tileGrid.maxZoom=i.maxZoom,this.setLoader(async(s,o,a)=>{const l=await n.getZxy(s,o,a),u=URL.createObjectURL(new Blob([l.data])),h=await this.loadImage(u);return URL.revokeObjectURL(u),h}),this.setState("ready")})}}class Px extends Bn{constructor(t){super({...t,state:"loading",url:"pmtiles://"+t.url+"/{z}/{x}/{y}",format:new Ra});ei(this,"tileLoadFunction",(t,n)=>{const i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=n.match(i),o=+s[2],a=+s[3],l=+s[4];t.setLoader((u,h,f)=>{t.setState(q.LOADING),this.pmtiles_.getZxy(o,a,l).then(d=>{if(d){const g=t.getFormat();t.setFeatures(g.readFeatures(d.data,{extent:u,featureProjection:f})),t.setState(q.LOADED)}else t.setFeatures([]),t.setState(q.EMPTY)}).catch(d=>{t.setFeatures([]),t.setState(q.ERROR)})})});this.pmtiles_=new qs(t.url),this.pmtiles_.getHeader().then(n=>{this.tileGrid.minZoom=n.minZoom,this.tileGrid.maxZoom=n.maxZoom,this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}}const Ax=new Or({fill:new vi({color:"rgba(255,255,255,0.4)"}),stroke:new Dr({color:"#3399CC",width:3})}),Ix=new Or({stroke:new Dr({color:"#ff9933",width:1})});function Lx(r,e){const t={url:r.getAbsoluteUrl()};let n=null;r.getBands().length===1&&(n=0);const{minimum:i,maximum:s}=r.getMinMaxValues(n);typeof i=="number"&&(t.min=i),typeof s=="number"&&(t.max=s);const o=r.getNoDataValues(n);return o.length>0&&(t.nodata=o[0]),e.length>0&&(t.bands=e),t}async function ya(r,e=void 0){let t=e;if(Jc()){const n=r.getMetadata("proj:epsg");if(n)try{t=await eh(n)}catch{}}return t}function xa(r,e){const t=r.clone();return e.hasOnlyBounds()||t.setFill(null),t}function Cx(r){let e=r.href;if(e.includes("{s}"))if(Array.isArray(r["href:servers"])&&r["href:servers"].length>0){const t=Math.random()*r["href:servers"].length|0;e=e.replace("{s}",r["href:servers"][t])}else return null;return e}async function Ox(r){try{const e=new URL(r);e.searchParams.set("service","wmts"),e.searchParams.set("request","GetCapabilities");const t=await fetch(e);return new xs().read(await t.text())}catch{return null}}class no extends Ga{constructor(e){const t={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(n=>t[n]=e[n]),super(t),this.getSourceOptions_=e.getSourceOptions,this.data_,this.assets_=null,this.bands_=[],this.crossOrigin_=e.crossOrigin||null,this.displayFootprint_=e.displayFootprint!==!1,this.displayGeoTiffByDefault_=!!e.displayGeoTiffByDefault,this.displayPreview_=!!e.displayPreview,this.displayOverview_=e.displayOverview!==!1,this.displayWebMapLink_=e.displayWebMapLink||!1,this.buildTileUrlTemplate_=e.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=e.useTileLayerAsFallback||!1,this.boundsStyle_=e.boundsStyle||Ax,this.collectionStyle_=e.collectionStyle||Ix,this.boundsLayer_=null,e.data){try{this.configure_(e.data,e.url,e.assets,e.bands)}catch(n){this.handleError_(n)}return}if(!e.url)throw new Error("Either url or data must be provided");fetch(e.url).then(n=>n.json()).then(n=>this.configure_(n,e.url,e.assets,e.bands)).catch(n=>this.handleError_(n))}getBoundsLayer(){return this.boundsLayer_}handleError_(e){this.dispatchEvent(new sx(e))}configure_(e,t=null,n=null,i=[]){e instanceof Lt||e instanceof Jr?this.data_=e:this.data_=bx(e),t&&t.includes("://")&&this.data_.setAbsoluteUrl(t),this.bands_=i,this.boundsLayer_=this.addFootprint_();const s=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(xa(this.boundsStyle_,this))};this.getLayers().on("add",s),this.getLayers().on("remove",s),this.setAssets(n).then(()=>this.dispatchEvent("assetsready")).catch(o=>this.handleError_(o)),this.dispatchEvent("sourceready")}async addApiCollection_(){const e=this.getData().getAll().map(t=>{const n=new no({data:t,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_});return this.addLayer_(n),n});return await Promise.all(e)}async addStacAssets_(){let e=this.getAssets();if(e===null){e=[];const n=this.getData().getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);if(n)e.push(n);else{const i=this.getData().getThumbnails();i.length>0&&e.push(i[0])}}const t=e.map(n=>this.addImagery_(n));return await Promise.all(t)}async addImagery_(e){if(e){if(e.isGeoTIFF())return await this.addGeoTiff_(e);if(e.canBrowserDisplayImage())return await this.addThumbnail_(e)}}async addThumbnail_(e){if(!this.displayPreview_)return;let t={url:e.getAbsoluteUrl(),projection:await ya(e,"EPSG:4326"),imageExtent:e.getContext().getBoundingBox(),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(t=await this.getSourceOptions_(we.ImageStatic,t,e));const n=new es({source:new eu(t)});return this.addLayer_(n,e),n}async addWebMapLinks_(){const e=this.getWebMapLinks();if(e.length>0)return await this.addLayerForLink(e[0])}async addLayerForLink(e){const t=Cx(e);if(!t)return;const n={attributions:e.getMetadata("attribution")||this.data_.getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:t},i=async(o,a)=>(this.getSourceOptions_&&(a=await this.getSourceOptions_(o,a,e)),a),s=[];switch(e.rel){case"pmtiles":const a=await new qs(n.url).getHeader();let l;switch(a.tileType){case Jt.Mvt:l=new Px(await i(we.PMTilesVector,n));break;case Jt.Avif:case Jt.Jpeg:case Jt.Png:case Jt.Webp:l=new _a(await i(we.PMTilesRaster,n));break;default:return}s.push(l);break;case"tilejson":s.push(new au(await i(we.TileJSON,n)));break;case"wms":if(!Array.isArray(e["wms:layers"]))break;for(const f in e["wms:layers"]){const d=e["wms:layers"][f];let g;Array.isArray(e["wms:styles"])&&typeof e["wms:styles"][f]=="string"&&(g=e["wms:styles"][f]);const m=Object.assign({LAYERS:d,STYLES:g},e["wms:dimensions"]);typeof e["wms:transparent"]=="boolean"&&(m.TRANSPARENT=String(e["wms:transparent"])),typeof e.type=="string"&&e.type.startsWith("image/")&&(m.FORMAT=e.type);const y=await i(we.TileWMS,Object.assign({},n,{params:m}));s.push(new $a(y))}break;case"wmts":const u=await Ox(t);if(!u)return;const h=Array.isArray(e["wmts:layer"])?e["wmts:layer"]:[e["wmts:layer"]];for(const f of h){let d=Object.assign({},n,{layer:f});typeof e.type=="string"&&e.type.startsWith("image/")&&(d.format=e.type),d=await i(we.WMTS,d),s.push(new ja(Za(u,d)))}break;case"xyz":s.push(new cr(await i(we.XYZ,n)));break;default:return}return s.map(o=>{let a;return o instanceof Bn?a=new Ua({source:o,declutter:!0}):o instanceof _a?a=new Cn({source:o}):a=new En({source:o}),this.addLayer_(a,e),a})}async addGeoTiff_(e){if(!this.displayOverview_)return;if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);let n={sources:[Lx(e,this.bands_)]};const i=await ya(e);i&&(n.projection=i),this.getSourceOptions_&&(n=await this.getSourceOptions_(we.GeoTIFF,n,e));const s=async(o,a)=>(a&&this.getLayers().remove(a),await this.addTileLayerForImagery_(o));try{const o=new Hs(n),a=new Cn({source:o});if(this.useTileLayerAsFallback_){const l=()=>s(e,a);o.on("error",l),o.on("tileloaderror",l),o.on("change",()=>{o.getState()==="error"&&s(e,a)}),a.on("error",l),await o.getView()}return this.addLayer_(a,e),a}catch(o){if(this.useTileLayerAsFallback_)return await s(e,null);this.handleError_(o)}}async addTileLayerForImagery_(e){let t={crossOrigin:this.crossOrigin_,url:this.buildTileUrlTemplate_(e)};this.getSourceOptions_&&(t=await this.getSourceOptions_(we.XYZ,t,e));const n=new En({source:new cr(t)});return this.addLayer_(n,e),n}addLayer_(e,t,n=0){e.set("stac",t),e.setZIndex(n),this.getLayers().push(e)}addFootprint_(){let e=null;const t=this.getData();if(t.isItemCollection()||t.isCollectionCollection()?e=Su(t.getBoundingBox()):e=t.toGeoJSON(),e){const n=new Sa,i=new Dn({format:n,loader:(o,a,l)=>{const u=n.readFeatures(e,{featureProjection:l});i.addFeatures(u)}}),s=new Hi({source:i,style:xa(this.boundsStyle_,this),visible:this.displayFootprint_});return s.set("bounds",!0),this.addLayer_(s,t,1),s}return null}async updateLayers_(){const e=this.getLayers();for(let n=e.getLength()-1;n>=0;n--){const s=e.item(n).get("stac");s&&(s.isLink()||s.isAsset())&&e.removeAt(n)}const t=this.getData();t.isItemCollection()||t.isCollectionCollection()?await this.addApiCollection_():(t.isItem()||t.isCollection())&&await this.addStacAssets_(),this.displayWebMapLink_&&(Array.isArray(this.displayWebMapLink_)||this.hasOnlyBounds())&&await this.addWebMapLinks_()}hasOnlyBounds(){const e=this.getBoundsLayer();return typeof this.getLayersArray().find(n=>n!==e)>"u"}getWebMapLinks(){let e=["xyz","tilejson","pmtiles","wmts","wms"];typeof this.displayWebMapLink_=="string"&&(e=[this.displayWebMapLink_]);let t=this.data_.getLinksWithRels(e);return Array.isArray(this.displayWebMapLink_)?t=this.displayWebMapLink_.map(n=>{if(typeof n=="string"){const i=t.find(s=>s.id===n);return i||null}return n}).filter(n=>!!n):t.sort((n,i)=>{const s=e.indexOf(n.rel),o=e.indexOf(i.rel);return s-o}),t}async setAssets(e){Array.isArray(e)?this.assets_=e.map(t=>typeof t=="string"?this.getData().getAsset(t):t instanceof Lt?t:new Lt(t)):this.assets_=null,await this.updateLayers_()}getData(){return this.data_}getAssets(){return this.assets_}getExtent(){if(!this.boundsLayer_)return;const e=this.boundsLayer_.getMapInternal();if(!e)return;const t=e.getView();if(!t)return;const n=this.getData();if(!n)return;const i=n.getBoundingBox();if(i)return th(i,"EPSG:4326",t.getProjection())}}rh(nh);window.eoxMapAdvancedOlLayers={...Rm,STAC:no};class Mx extends vt{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,tilePixelRatio:e.tilePixelRatio,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection,wrapX:e.wrapX}),this.version_=e.version!==void 0?e==null?void 0:e.version:"1.0.0",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,fetch(e.url).then(t=>t.text()).then(t=>new window.DOMParser().parseFromString(t,"application/xml")).then(t=>{this.handleCapabilitiesResponse(t,e)})}handleCapabilitiesResponse(e,t){const i=new xs().read(e),s=Za(i,t);this.crossOrigin=s.crossOrigin,this.projection=s.projection,this.tileGrid=s.tileGrid,this.requestEncoding_=s.requestEncoding,this.matrixSet_=s.matrixSet,this.style_=s.style,this.format_=s.format,this.dimensions_=s.dimensions,this.setUrls(s.urls),this.urls&&this.urls.length>0&&(this.tileUrlFunction=ts(this.urls.map(this.createFromWMTSTemplate.bind(this)))),this.setState("ready")}createFromWMTSTemplate(e){const t=this.requestEncoding_,n={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t=="KVP"&&Object.assign(n,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=t=="KVP"?vn(e,n):e.replace(/\{(\w+?)\}/g,function(o,a){return a.toLowerCase()in n?n[a.toLowerCase()]:o});const i=this.tileGrid,s=this.dimensions_;return function(o){if(!o)return;const a={TileMatrix:i.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(a,s);let l=e;return t=="KVP"?l=vn(l,a):l=l.replace(/\{(\w+?)\}/g,function(u,h){return a[h]}),l}}}window.eoxMapAdvancedOlSources={...E0,WMTSCapabilities:Mx};export{Yx as L,qx as a};
