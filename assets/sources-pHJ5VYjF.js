var Kc=Object.defineProperty;var Qc=(t,e,r)=>e in t?Kc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var sn=(t,e,r)=>(Qc(t,typeof e!="symbol"?e+"":e,r),r);import{J as Jc,F as ct,g as de,i as ef,t as ke,d as tf,l as rf,c as cs,L as Pn,P as Et,a as Dt,M as Yr,b as Fs,e as Gi,f as Ui,X as Ds,m as Y,h as Q,p as $,j as sa,k as fs,n as sf,o as nf,q as Qt,s as ds,u as ih,v as ie,w as R,x as le,y as Me,z as lt,O as Kr,A as Kt,B as Si,C as sh,D as Z,E as P,H as B,I as Ne,K as Xe,N as na,Q as gs,R as nh,S as hr,U as af,V as aa,W as ah,Y as $t,Z as Gt,_ as An,$ as In,a0 as be,a1 as of,a2 as lf,a3 as rr,a4 as Mo,a5 as Yt,a6 as zr,a7 as oh,a8 as lh,a9 as hf,aa as hh,ab as uf,ac as uh,ad as cf,ae as ff,af as ps,ag as df,ah as Mi,ai as oa,aj as bo,ak as vi,al as Ro,am as Ln,an as cr,ao as Gs,ap as gf,aq as pf,ar as mf,as as Ct,at as ms,au as la,av as Jt,aw as ci,ax as qr,ay as ht,az as Pe,aA as bi,aB as Cr,aC as _f,aD as Fe,aE as ch,aF as wt,aG as ha,aH as yf,aI as xf,aJ as fh,aK as nn,aL as vf,aM as ua,aN as Ef,aO as fi,aP as Vi,aQ as _s,aR as ca,aS as dh,aT as Ri,aU as gh,aV as Cn,aW as ph,aX as ee,aY as Zt,aZ as Po,a_ as an,a$ as wf,b0 as Ao,b1 as it,b2 as Tf,b3 as Sf,b4 as Mf,b5 as bf,b6 as fa,b7 as Ot,b8 as da,b9 as Rr,ba as Rf,bb as On,bc as mh,bd as Pf,be as Io,bf as Af,bg as If,bh as _h,bi as Pi,bj as Lf,bk as Cf,bl as Of,bm as Nn,bn as Nf,bo as me,bp as ns,bq as Zr,br as ut,bs as mt,bt as Ff,bu as oe,bv as yh,bw as fr,bx as Df,by as Gf,bz as xh,bA as ir,bB as Uf,bC as Bf,bD as zf,bE as vh,bF as kf,G as Eh,bG as ga,bH as ys,bI as wh,bJ as vr,bK as Us,bL as Bs,bM as Th,bN as pa,bO as Wr,bP as $f,bQ as jf,bR as qf,bS as zs,bT as Zf,bU as Wf,bV as Xf,bW as xs,bX as Hf,bY as on,bZ as vs,b_ as ks,b$ as Vf,c0 as Yf,c1 as Lo,c2 as Fn,c3 as Dn,c4 as Kf,c5 as Qf,c6 as Qr,c7 as Sh,c8 as Co,c9 as Mh,ca as Oo,cb as Er,cc as ma,cd as $s,ce as Jf,cf as _a,cg as bh,ch as ed,ci as td,cj as rd,ck as id,cl as Rh,cm as sd,cn as nd,co as ad,cp as od,cq as Ph,cr as ld,cs as Ah,ct as hd,cu as ud,cv as cd,cw as fd,cx as dd,cy as No,cz as gd,cA as pd}from"./main-G_0A_pV2.js";import{g as js,c as dr}from"./_commonjsHelpers-4gQjN7DL.js";import{_ as ar}from"./iframe-Emvi5NNo.js";const md={Point:vd,LineString:Ed,Polygon:Md,MultiPoint:Td,MultiLineString:wd,MultiPolygon:Sd},_d={Point:bd,LineString:Rd,Polygon:Pd,MultiPoint:Id,MultiLineString:Ad,MultiPolygon:Ld};class yd extends Jc{constructor(e){e=e||{},super(),this.geometryName_=e.geometryName}readFeatureFromObject(e,r,i){const s=e,n=Fo(s.geometry,r),a=new ct;if(this.geometryName_&&a.setGeometryName(this.geometryName_),a.setGeometry(n),s.attributes){a.setProperties(s.attributes,!0);const o=s.attributes[i];o!==void 0&&a.setId(o)}return a}readFeaturesFromObject(e,r){if(r=r||{},e.features){const i=e,s=[],n=i.features;for(let a=0,o=n.length;a<o;++a)s.push(this.readFeatureFromObject(n[a],r,e.objectIdFieldName));return s}return[this.readFeatureFromObject(e,r)]}readGeometryFromObject(e,r){return Fo(e,r)}readProjectionFromObject(e){if(e.spatialReference&&e.spatialReference.wkid!==void 0){const i=e.spatialReference.wkid;return de("EPSG:"+i)}return null}writeGeometryObject(e,r){return Do(e,this.adaptOptions(r))}writeFeatureObject(e,r){r=this.adaptOptions(r);const i={};if(!e.hasProperties())return i.attributes={},i;const s=e.getProperties(),n=e.getGeometry();if(n){i.geometry=Do(n,r);const a=r&&(r.dataProjection||r.featureProjection);a&&(i.geometry.spatialReference={wkid:Number(de(a).getCode().split(":").pop())}),delete s[e.getGeometryName()]}return ef(s)?i.attributes={}:i.attributes=s,i}writeFeaturesObject(e,r){r=this.adaptOptions(r);const i=[];for(let s=0,n=e.length;s<n;++s)i.push(this.writeFeatureObject(e[s],r));return{features:i}}}function Fo(t,e){if(!t)return null;let r;if(typeof t.x=="number"&&typeof t.y=="number")r="Point";else if(t.points)r="MultiPoint";else if(t.paths)t.paths.length===1?r="LineString":r="MultiLineString";else if(t.rings){const s=t,n=Jr(s),a=xd(s.rings,n);a.length===1?(r="Polygon",t=Object.assign({},t,{rings:a[0]})):(r="MultiPolygon",t=Object.assign({},t,{rings:a}))}const i=md[r];return ke(i(t),!1,e)}function xd(t,e){const r=[],i=[],s=[];let n,a;for(n=0,a=t.length;n<a;++n)r.length=0,tf(r,0,t[n],e.length),rf(r,0,r.length,e.length)?i.push([t[n]]):s.push(t[n]);for(;s.length;){const o=s.shift();let l=!1;for(n=i.length-1;n>=0;n--){const h=i[n][0];if(cs(new Pn(h).getExtent(),new Pn(o).getExtent())){i[n].push(o),l=!0;break}}l||i.push([o.reverse()])}return i}function vd(t){let e;return t.m!==void 0&&t.z!==void 0?e=new Et([t.x,t.y,t.z,t.m],"XYZM"):t.z!==void 0?e=new Et([t.x,t.y,t.z],"XYZ"):t.m!==void 0?e=new Et([t.x,t.y,t.m],"XYM"):e=new Et([t.x,t.y]),e}function Ed(t){const e=Jr(t);return new Dt(t.paths[0],e)}function wd(t){const e=Jr(t);return new Yr(t.paths,e)}function Jr(t){let e="XY";return t.hasZ===!0&&t.hasM===!0?e="XYZM":t.hasZ===!0?e="XYZ":t.hasM===!0&&(e="XYM"),e}function Td(t){const e=Jr(t);return new Fs(t.points,e)}function Sd(t){const e=Jr(t);return new Gi(t.rings,e)}function Md(t){const e=Jr(t);return new Ui(t.rings,e)}function bd(t,e){const r=t.getCoordinates();let i;const s=t.getLayout();if(s==="XYZ")i={x:r[0],y:r[1],z:r[2]};else if(s==="XYM")i={x:r[0],y:r[1],m:r[2]};else if(s==="XYZM")i={x:r[0],y:r[1],z:r[2],m:r[3]};else if(s==="XY")i={x:r[0],y:r[1]};else throw new Error("Invalid geometry layout");return i}function Bi(t){const e=t.getLayout();return{hasZ:e==="XYZ"||e==="XYZM",hasM:e==="XYM"||e==="XYZM"}}function Rd(t,e){const r=Bi(t);return{hasZ:r.hasZ,hasM:r.hasM,paths:[t.getCoordinates()]}}function Pd(t,e){const r=Bi(t);return{hasZ:r.hasZ,hasM:r.hasM,rings:t.getCoordinates(!1)}}function Ad(t,e){const r=Bi(t);return{hasZ:r.hasZ,hasM:r.hasM,paths:t.getCoordinates()}}function Id(t,e){const r=Bi(t);return{hasZ:r.hasZ,hasM:r.hasM,points:t.getCoordinates()}}function Ld(t,e){const r=Bi(t),i=t.getCoordinates(!1),s=[];for(let n=0;n<i.length;n++)for(let a=i[n].length-1;a>=0;a--)s.push(i[n][a]);return{hasZ:r.hasZ,hasM:r.hasM,rings:s}}function Do(t,e){const r=_d[t.getType()];return r(ke(t,!0,e),e)}const Cd=yd,qt="http://www.opengis.net/gml",Od=/^\s*$/;class Le extends Ds{constructor(e){super(),e=e||{},this.featureType=e.featureType,this.featureNS=e.featureNS,this.srsName=e.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:Y(this.readFeaturesInternal),featureMembers:Q(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(e,r){const i=e.localName;let s=null;if(i=="FeatureCollection")s=$([],this.FEATURE_COLLECTION_PARSERS,e,r,this);else if(i=="featureMembers"||i=="featureMember"||i=="member"){const n=r[0];let a=n.featureType,o=n.featureNS;const l="p",h="p0";if(!a&&e.childNodes){a=[],o={};for(let d=0,p=e.childNodes.length;d<p;++d){const g=e.childNodes[d];if(g.nodeType===1){const _=g.nodeName.split(":").pop();if(!a.includes(_)){let y="",v=0;const E=g.namespaceURI;for(const T in o){if(o[T]===E){y=T;break}++v}y||(y=l+v,o[y]=E),a.push(y+":"+_)}}}i!="featureMember"&&(n.featureType=a,n.featureNS=o)}if(typeof o=="string"){const d=o;o={},o[h]=d}const c={},u=Array.isArray(a)?a:[a];for(const d in o){const p={};for(let g=0,_=u.length;g<_;++g)(u[g].includes(":")?u[g].split(":")[0]:h)===d&&(p[u[g].split(":").pop()]=i=="featureMembers"?Y(this.readFeatureElement,this):Q(this.readFeatureElement,this));c[o[d]]=p}i=="featureMember"||i=="member"?s=$(void 0,c,e,r):s=$([],c,e,r)}return s===null&&(s=[]),s}readGeometryOrExtent(e,r){const i=r[0];return i.srsName=e.firstElementChild.getAttribute("srsName"),i.srsDimension=e.firstElementChild.getAttribute("srsDimension"),$(null,this.GEOMETRY_PARSERS,e,r,this)}readExtentElement(e,r){const i=r[0],s=this.readGeometryOrExtent(e,r);return s?sa(s,i):void 0}readGeometryElement(e,r){const i=r[0],s=this.readGeometryOrExtent(e,r);return s?ke(s,!1,i):void 0}readFeatureElementInternal(e,r,i){let s;const n={};for(let l=e.firstElementChild;l;l=l.nextElementSibling){let h;const c=l.localName;l.childNodes.length===0||l.childNodes.length===1&&(l.firstChild.nodeType===3||l.firstChild.nodeType===4)?(h=fs(l,!1),Od.test(h)&&(h=void 0)):(i&&(h=c==="boundedBy"?this.readExtentElement(l,r):this.readGeometryElement(l,r)),h?c!=="boundedBy"&&(s=c):h=this.readFeatureElementInternal(l,r,!1));const u=l.attributes.length;if(u>0&&!(h instanceof sf)){h={_content_:h};for(let d=0;d<u;d++){const p=l.attributes[d].name;h[p]=l.attributes[d].value}}n[c]?(n[c]instanceof Array||(n[c]=[n[c]]),n[c].push(h)):n[c]=h}if(!i)return n;const a=new ct(n);s&&a.setGeometryName(s);const o=e.getAttribute("fid")||nf(e,this.namespace,"id");return o&&a.setId(o),a}readFeatureElement(e,r){return this.readFeatureElementInternal(e,r,!0)}readPoint(e,r){const i=this.readFlatCoordinatesFromNode(e,r);if(i)return new Et(i,"XYZ")}readMultiPoint(e,r){const i=$([],this.MULTIPOINT_PARSERS,e,r,this);if(i)return new Fs(i)}readMultiLineString(e,r){const i=$([],this.MULTILINESTRING_PARSERS,e,r,this);if(i)return new Yr(i)}readMultiPolygon(e,r){const i=$([],this.MULTIPOLYGON_PARSERS,e,r,this);if(i)return new Gi(i)}pointMemberParser(e,r){Qt(this.POINTMEMBER_PARSERS,e,r,this)}lineStringMemberParser(e,r){Qt(this.LINESTRINGMEMBER_PARSERS,e,r,this)}polygonMemberParser(e,r){Qt(this.POLYGONMEMBER_PARSERS,e,r,this)}readLineString(e,r){const i=this.readFlatCoordinatesFromNode(e,r);if(i)return new Dt(i,"XYZ")}readFlatLinearRing(e,r){const i=$(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,r,this);if(i)return i}readLinearRing(e,r){const i=this.readFlatCoordinatesFromNode(e,r);if(i)return new Pn(i,"XYZ")}readPolygon(e,r){const i=$([null],this.FLAT_LINEAR_RINGS_PARSERS,e,r,this);if(i&&i[0]){const s=i[0],n=[s.length];let a,o;for(a=1,o=i.length;a<o;++a)ds(s,i[a]),n.push(s.length);return new Ui(s,"XYZ",n)}}readFlatCoordinatesFromNode(e,r){return $(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,r,this)}readGeometryFromNode(e,r){const i=this.readGeometryElement(e,[this.getReadOptions(e,r||{})]);return i||null}readFeaturesFromNode(e,r){const i={featureType:this.featureType,featureNS:this.featureNS};return i&&Object.assign(i,this.getReadOptions(e,r)),this.readFeaturesInternal(e,[i])||[]}readProjectionFromNode(e){return de(this.srsName?this.srsName:e.firstElementChild.getAttribute("srsName"))}}Le.prototype.namespace=qt;Le.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};Le.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};Le.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};Le.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:Y(Le.prototype.pointMemberParser),pointMembers:Y(Le.prototype.pointMemberParser)}};Le.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:Y(Le.prototype.lineStringMemberParser),lineStringMembers:Y(Le.prototype.lineStringMemberParser)}};Le.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:Y(Le.prototype.polygonMemberParser),polygonMembers:Y(Le.prototype.polygonMemberParser)}};Le.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:Y(Le.prototype.readFlatCoordinatesFromNode)}};Le.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:Y(Le.prototype.readLineString)}};Le.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:Y(Le.prototype.readPolygon)}};Le.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:Q(Le.prototype.readFlatLinearRing)}};const ae=Le,Nd=qt+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",Fd={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class fe extends ae{constructor(e){e=e||{},super(e),this.FEATURE_COLLECTION_PARSERS[qt].featureMember=Y(this.readFeaturesInternal),this.schemaLocation=e.schemaLocation?e.schemaLocation:Nd}readFlatCoordinates(e,r){const i=fs(e,!1).replace(/^\s*|\s*$/g,""),n=r[0].srsName;let a="enu";if(n){const h=de(n);h&&(a=h.getAxisOrientation())}const o=i.trim().split(/\s+/),l=[];for(let h=0,c=o.length;h<c;h++){const u=o[h].split(/,+/),d=parseFloat(u[0]),p=parseFloat(u[1]),g=u.length===3?parseFloat(u[2]):0;a.substr(0,2)==="en"?l.push(d,p,g):l.push(p,d,g)}return l}readBox(e,r){const i=$([null],this.BOX_PARSERS_,e,r,this);return ih(i[1][0],i[1][1],i[1][3],i[1][4])}innerBoundaryIsParser(e,r){const i=$(void 0,this.RING_PARSERS,e,r,this);i&&r[r.length-1].push(i)}outerBoundaryIsParser(e,r){const i=$(void 0,this.RING_PARSERS,e,r,this);if(i){const s=r[r.length-1];s[0]=i}}GEOMETRY_NODE_FACTORY_(e,r,i){const s=r[r.length-1],n=s.multiSurface,a=s.surface,o=s.multiCurve;return Array.isArray(e)?i="Envelope":(i=e.getType(),i==="MultiPolygon"&&n===!0?i="MultiSurface":i==="Polygon"&&a===!0?i="Surface":i==="MultiLineString"&&o===!0&&(i="MultiCurve")),ie("http://www.opengis.net/gml",i)}writeFeatureElement(e,r,i){const s=r.getId();s&&e.setAttribute("fid",s);const n=i[i.length-1],a=n.featureNS,o=r.getGeometryName();n.serializers||(n.serializers={},n.serializers[a]={});const l=[],h=[];if(r.hasProperties()){const u=r.getProperties();for(const d in u){const p=u[d];p!==null&&(l.push(d),h.push(p),d==o||typeof p.getSimplifiedGeometry=="function"?d in n.serializers[a]||(n.serializers[a][d]=R(this.writeGeometryElement,this)):d in n.serializers[a]||(n.serializers[a][d]=R(le)))}}const c=Object.assign({},n);c.node=e,Me(c,n.serializers,lt(void 0,a),h,i,l)}writeCurveOrLineString(e,r,i){const n=i[i.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&n&&e.setAttribute("srsName",n),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a),this.writeCoordinates_(a,r,i)}else if(e.nodeName==="Curve"){const a=ie(e.namespaceURI,"segments");e.appendChild(a),this.writeCurveSegments_(a,r,i)}}writeLineStringOrCurveMember(e,r,i){const s=this.GEOMETRY_NODE_FACTORY_(r,i);s&&(e.appendChild(s),this.writeCurveOrLineString(s,r,i))}writeMultiCurveOrLineString(e,r,i){const s=i[i.length-1],n=s.hasZ,a=s.srsName,o=s.curve;a&&e.setAttribute("srsName",a);const l=r.getLineStrings();Me({node:e,hasZ:n,srsName:a,curve:o},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeGeometryElement(e,r,i){const s=i[i.length-1],n=Object.assign({},s);n.node=e;let a;Array.isArray(r)?a=sa(r,s):a=ke(r,!0,s),Me(n,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[a],i,void 0,this)}createCoordinatesNode_(e){const r=ie(e,"coordinates");return r.setAttribute("decimal","."),r.setAttribute("cs",","),r.setAttribute("ts"," "),r}writeCoordinates_(e,r,i){const s=i[i.length-1],n=s.hasZ,a=s.srsName,o=r.getCoordinates(),l=o.length,h=new Array(l);for(let c=0;c<l;++c){const u=o[c];h[c]=this.getCoords_(u,a,n)}le(e,h.join(" "))}writeCurveSegments_(e,r,i){const s=ie(e.namespaceURI,"LineStringSegment");e.appendChild(s),this.writeCurveOrLineString(s,r,i)}writeSurfaceOrPolygon(e,r,i){const s=i[i.length-1],n=s.hasZ,a=s.srsName;if(e.nodeName!=="PolygonPatch"&&a&&e.setAttribute("srsName",a),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const o=r.getLinearRings();Me({node:e,hasZ:n,srsName:a},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,o,i,void 0,this)}else if(e.nodeName==="Surface"){const o=ie(e.namespaceURI,"patches");e.appendChild(o),this.writeSurfacePatches_(o,r,i)}}RING_NODE_FACTORY_(e,r,i){const s=r[r.length-1],n=s.node,a=s.exteriorWritten;return a===void 0&&(s.exteriorWritten=!0),ie(n.namespaceURI,a!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(e,r,i){const s=ie(e.namespaceURI,"PolygonPatch");e.appendChild(s),this.writeSurfaceOrPolygon(s,r,i)}writeRing(e,r,i){const s=ie(e.namespaceURI,"LinearRing");e.appendChild(s),this.writeLinearRing(s,r,i)}getCoords_(e,r,i){let s="enu";r&&(s=de(r).getAxisOrientation());let n=s.substr(0,2)==="en"?e[0]+","+e[1]:e[1]+","+e[0];if(i){const a=e[2]||0;n+=","+a}return n}writePoint(e,r,i){const s=i[i.length-1],n=s.hasZ,a=s.srsName;a&&e.setAttribute("srsName",a);const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o);const l=r.getCoordinates(),h=this.getCoords_(l,a,n);le(o,h)}writeMultiPoint(e,r,i){const s=i[i.length-1],n=s.hasZ,a=s.srsName;a&&e.setAttribute("srsName",a);const o=r.getPoints();Me({node:e,hasZ:n,srsName:a},this.POINTMEMBER_SERIALIZERS,lt("pointMember"),o,i,void 0,this)}writePointMember(e,r,i){const s=ie(e.namespaceURI,"Point");e.appendChild(s),this.writePoint(s,r,i)}writeLinearRing(e,r,i){const n=i[i.length-1].srsName;n&&e.setAttribute("srsName",n);const a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a),this.writeCoordinates_(a,r,i)}writeMultiSurfaceOrPolygon(e,r,i){const s=i[i.length-1],n=s.hasZ,a=s.srsName,o=s.surface;a&&e.setAttribute("srsName",a);const l=r.getPolygons();Me({node:e,hasZ:n,srsName:a,surface:o},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeSurfaceOrPolygonMember(e,r,i){const s=this.GEOMETRY_NODE_FACTORY_(r,i);s&&(e.appendChild(s),this.writeSurfaceOrPolygon(s,r,i))}writeEnvelope(e,r,i){const n=i[i.length-1].srsName;n&&e.setAttribute("srsName",n);const a=["lowerCorner","upperCorner"],o=[r[0]+" "+r[1],r[2]+" "+r[3]];Me({node:e},this.ENVELOPE_SERIALIZERS,Kr,o,i,a,this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,r,i){const s=r[r.length-1].node;return ie("http://www.opengis.net/gml",Fd[s.nodeName])}}fe.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:Q(fe.prototype.readFlatCoordinates)}};fe.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:fe.prototype.innerBoundaryIsParser,outerBoundaryIs:fe.prototype.outerBoundaryIsParser}};fe.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:Y(fe.prototype.readFlatCoordinates)}};fe.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:Q(ae.prototype.readPoint),MultiPoint:Q(ae.prototype.readMultiPoint),LineString:Q(ae.prototype.readLineString),MultiLineString:Q(ae.prototype.readMultiLineString),LinearRing:Q(ae.prototype.readLinearRing),Polygon:Q(ae.prototype.readPolygon),MultiPolygon:Q(ae.prototype.readMultiPolygon),Box:Q(fe.prototype.readBox)}};fe.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:R(fe.prototype.writeCurveOrLineString),MultiCurve:R(fe.prototype.writeMultiCurveOrLineString),Point:R(fe.prototype.writePoint),MultiPoint:R(fe.prototype.writeMultiPoint),LineString:R(fe.prototype.writeCurveOrLineString),MultiLineString:R(fe.prototype.writeMultiCurveOrLineString),LinearRing:R(fe.prototype.writeLinearRing),Polygon:R(fe.prototype.writeSurfaceOrPolygon),MultiPolygon:R(fe.prototype.writeMultiSurfaceOrPolygon),Surface:R(fe.prototype.writeSurfaceOrPolygon),MultiSurface:R(fe.prototype.writeMultiSurfaceOrPolygon),Envelope:R(fe.prototype.writeEnvelope)}};fe.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:R(fe.prototype.writeLineStringOrCurveMember),curveMember:R(fe.prototype.writeLineStringOrCurveMember)}};fe.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:R(fe.prototype.writeRing),innerBoundaryIs:R(fe.prototype.writeRing)}};fe.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:R(fe.prototype.writePointMember)}};fe.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:R(fe.prototype.writeSurfaceOrPolygonMember),polygonMember:R(fe.prototype.writeSurfaceOrPolygonMember)}};fe.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:R(le),upperCorner:R(le)}};const ei=fe,Dd=qt+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",Gd={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class W extends ae{constructor(e){e=e||{},super(e),this.surface_=e.surface!==void 0?e.surface:!1,this.curve_=e.curve!==void 0?e.curve:!1,this.multiCurve_=e.multiCurve!==void 0?e.multiCurve:!0,this.multiSurface_=e.multiSurface!==void 0?e.multiSurface:!0,this.schemaLocation=e.schemaLocation?e.schemaLocation:Dd,this.hasZ=e.hasZ!==void 0?e.hasZ:!1}readMultiCurve(e,r){const i=$([],this.MULTICURVE_PARSERS,e,r,this);if(i)return new Yr(i)}readFlatCurveRing(e,r){const i=$([],this.MULTICURVE_PARSERS,e,r,this),s=[];for(let n=0,a=i.length;n<a;++n)ds(s,i[n].getFlatCoordinates());return s}readMultiSurface(e,r){const i=$([],this.MULTISURFACE_PARSERS,e,r,this);if(i)return new Gi(i)}curveMemberParser(e,r){Qt(this.CURVEMEMBER_PARSERS,e,r,this)}surfaceMemberParser(e,r){Qt(this.SURFACEMEMBER_PARSERS,e,r,this)}readPatch(e,r){return $([null],this.PATCHES_PARSERS,e,r,this)}readSegment(e,r){return $([],this.SEGMENTS_PARSERS,e,r,this)}readPolygonPatch(e,r){return $([null],this.FLAT_LINEAR_RINGS_PARSERS,e,r,this)}readLineStringSegment(e,r){return $([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,r,this)}interiorParser(e,r){const i=$(void 0,this.RING_PARSERS,e,r,this);i&&r[r.length-1].push(i)}exteriorParser(e,r){const i=$(void 0,this.RING_PARSERS,e,r,this);if(i){const s=r[r.length-1];s[0]=i}}readSurface(e,r){const i=$([null],this.SURFACE_PARSERS,e,r,this);if(i&&i[0]){const s=i[0],n=[s.length];let a,o;for(a=1,o=i.length;a<o;++a)ds(s,i[a]),n.push(s.length);return new Ui(s,"XYZ",n)}}readCurve(e,r){const i=$([null],this.CURVE_PARSERS,e,r,this);if(i)return new Dt(i,"XYZ")}readEnvelope(e,r){const i=$([null],this.ENVELOPE_PARSERS,e,r,this);return ih(i[1][0],i[1][1],i[2][0],i[2][1])}readFlatPos(e,r){let i=fs(e,!1);const s=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,n=[];let a;for(;a=s.exec(i);)n.push(parseFloat(a[1])),i=i.substr(a[0].length);if(i!=="")return;const l=r[0].srsName;let h="enu";if(l&&(h=de(l).getAxisOrientation()),h==="neu"){let u,d;for(u=0,d=n.length;u<d;u+=3){const p=n[u],g=n[u+1];n[u]=g,n[u+1]=p}}const c=n.length;if(c==2&&n.push(0),c!==0)return n}readFlatPosList(e,r){const i=fs(e,!1).replace(/^\s*|\s*$/g,""),s=r[0],n=s.srsName,a=s.srsDimension;let o="enu";n&&(o=de(n).getAxisOrientation());const l=i.split(/\s+/);let h=2;e.getAttribute("srsDimension")?h=Kt(e.getAttribute("srsDimension")):e.getAttribute("dimension")?h=Kt(e.getAttribute("dimension")):e.parentNode.getAttribute("srsDimension")?h=Kt(e.parentNode.getAttribute("srsDimension")):a&&(h=Kt(a));let c,u,d;const p=[];for(let g=0,_=l.length;g<_;g+=h)c=parseFloat(l[g]),u=parseFloat(l[g+1]),d=h===3?parseFloat(l[g+2]):0,o.substr(0,2)==="en"?p.push(c,u,d):p.push(u,c,d);return p}writePos_(e,r,i){const s=i[i.length-1],n=s.hasZ,a=n?"3":"2";e.setAttribute("srsDimension",a);const o=s.srsName;let l="enu";o&&(l=de(o).getAxisOrientation());const h=r.getCoordinates();let c;if(l.substr(0,2)==="en"?c=h[0]+" "+h[1]:c=h[1]+" "+h[0],n){const u=h[2]||0;c+=" "+u}le(e,c)}getCoords_(e,r,i){let s="enu";r&&(s=de(r).getAxisOrientation());let n=s.substr(0,2)==="en"?e[0]+" "+e[1]:e[1]+" "+e[0];if(i){const a=e[2]||0;n+=" "+a}return n}writePosList_(e,r,i){const s=i[i.length-1],n=s.hasZ,a=n?"3":"2";e.setAttribute("srsDimension",a);const o=s.srsName,l=r.getCoordinates(),h=l.length,c=new Array(h);let u;for(let d=0;d<h;++d)u=l[d],c[d]=this.getCoords_(u,o,n);le(e,c.join(" "))}writePoint(e,r,i){const n=i[i.length-1].srsName;n&&e.setAttribute("srsName",n);const a=ie(e.namespaceURI,"pos");e.appendChild(a),this.writePos_(a,r,i)}writeEnvelope(e,r,i){const n=i[i.length-1].srsName;n&&e.setAttribute("srsName",n);const a=["lowerCorner","upperCorner"],o=[r[0]+" "+r[1],r[2]+" "+r[3]];Me({node:e},this.ENVELOPE_SERIALIZERS,Kr,o,i,a,this)}writeLinearRing(e,r,i){const n=i[i.length-1].srsName;n&&e.setAttribute("srsName",n);const a=ie(e.namespaceURI,"posList");e.appendChild(a),this.writePosList_(a,r,i)}RING_NODE_FACTORY_(e,r,i){const s=r[r.length-1],n=s.node,a=s.exteriorWritten;return a===void 0&&(s.exteriorWritten=!0),ie(n.namespaceURI,a!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(e,r,i){const s=i[i.length-1],n=s.hasZ,a=s.srsName;if(e.nodeName!=="PolygonPatch"&&a&&e.setAttribute("srsName",a),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const o=r.getLinearRings();Me({node:e,hasZ:n,srsName:a},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,o,i,void 0,this)}else if(e.nodeName==="Surface"){const o=ie(e.namespaceURI,"patches");e.appendChild(o),this.writeSurfacePatches_(o,r,i)}}writeCurveOrLineString(e,r,i){const n=i[i.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&n&&e.setAttribute("srsName",n),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const a=ie(e.namespaceURI,"posList");e.appendChild(a),this.writePosList_(a,r,i)}else if(e.nodeName==="Curve"){const a=ie(e.namespaceURI,"segments");e.appendChild(a),this.writeCurveSegments_(a,r,i)}}writeMultiSurfaceOrPolygon(e,r,i){const s=i[i.length-1],n=s.hasZ,a=s.srsName,o=s.surface;a&&e.setAttribute("srsName",a);const l=r.getPolygons();Me({node:e,hasZ:n,srsName:a,surface:o},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeMultiPoint(e,r,i){const s=i[i.length-1],n=s.srsName,a=s.hasZ;n&&e.setAttribute("srsName",n);const o=r.getPoints();Me({node:e,hasZ:a,srsName:n},this.POINTMEMBER_SERIALIZERS,lt("pointMember"),o,i,void 0,this)}writeMultiCurveOrLineString(e,r,i){const s=i[i.length-1],n=s.hasZ,a=s.srsName,o=s.curve;a&&e.setAttribute("srsName",a);const l=r.getLineStrings();Me({node:e,hasZ:n,srsName:a,curve:o},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeRing(e,r,i){const s=ie(e.namespaceURI,"LinearRing");e.appendChild(s),this.writeLinearRing(s,r,i)}writeSurfaceOrPolygonMember(e,r,i){const s=this.GEOMETRY_NODE_FACTORY_(r,i);s&&(e.appendChild(s),this.writeSurfaceOrPolygon(s,r,i))}writePointMember(e,r,i){const s=ie(e.namespaceURI,"Point");e.appendChild(s),this.writePoint(s,r,i)}writeLineStringOrCurveMember(e,r,i){const s=this.GEOMETRY_NODE_FACTORY_(r,i);s&&(e.appendChild(s),this.writeCurveOrLineString(s,r,i))}writeSurfacePatches_(e,r,i){const s=ie(e.namespaceURI,"PolygonPatch");e.appendChild(s),this.writeSurfaceOrPolygon(s,r,i)}writeCurveSegments_(e,r,i){const s=ie(e.namespaceURI,"LineStringSegment");e.appendChild(s),this.writeCurveOrLineString(s,r,i)}writeGeometryElement(e,r,i){const s=i[i.length-1],n=Object.assign({},s);n.node=e;let a;Array.isArray(r)?a=sa(r,s):a=ke(r,!0,s),Me(n,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[a],i,void 0,this)}writeFeatureElement(e,r,i){const s=r.getId();s&&e.setAttribute("fid",s);const n=i[i.length-1],a=n.featureNS,o=r.getGeometryName();n.serializers||(n.serializers={},n.serializers[a]={});const l=[],h=[];if(r.hasProperties()){const u=r.getProperties();for(const d in u){const p=u[d];p!==null&&(l.push(d),h.push(p),d==o||typeof p.getSimplifiedGeometry=="function"?d in n.serializers[a]||(n.serializers[a][d]=R(this.writeGeometryElement,this)):d in n.serializers[a]||(n.serializers[a][d]=R(le)))}}const c=Object.assign({},n);c.node=e,Me(c,n.serializers,lt(void 0,a),h,i,l)}writeFeatureMembers_(e,r,i){const s=i[i.length-1],n=s.featureType,a=s.featureNS,o={};o[a]={},o[a][n]=R(this.writeFeatureElement,this);const l=Object.assign({},s);l.node=e,Me(l,o,lt(n,a),r,i)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,r,i){const s=r[r.length-1].node;return ie(this.namespace,Gd[s.nodeName])}GEOMETRY_NODE_FACTORY_(e,r,i){const s=r[r.length-1],n=s.multiSurface,a=s.surface,o=s.curve,l=s.multiCurve;return Array.isArray(e)?i="Envelope":(i=e.getType(),i==="MultiPolygon"&&n===!0?i="MultiSurface":i==="Polygon"&&a===!0?i="Surface":i==="LineString"&&o===!0?i="Curve":i==="MultiLineString"&&l===!0&&(i="MultiCurve")),ie(this.namespace,i)}writeGeometryNode(e,r){r=this.adaptOptions(r);const i=ie(this.namespace,"geom"),s={node:i,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return r&&Object.assign(s,r),this.writeGeometryElement(i,e,[s]),i}writeFeaturesNode(e,r){r=this.adaptOptions(r);const i=ie(this.namespace,"featureMembers");i.setAttributeNS(Si,"xsi:schemaLocation",this.schemaLocation);const s={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return r&&Object.assign(s,r),this.writeFeatureMembers_(i,e,[s]),i}}W.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:Q(W.prototype.readFlatPos),posList:Q(W.prototype.readFlatPosList),coordinates:Q(ei.prototype.readFlatCoordinates)}};W.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:W.prototype.interiorParser,exterior:W.prototype.exteriorParser}};W.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:Q(ae.prototype.readPoint),MultiPoint:Q(ae.prototype.readMultiPoint),LineString:Q(ae.prototype.readLineString),MultiLineString:Q(ae.prototype.readMultiLineString),LinearRing:Q(ae.prototype.readLinearRing),Polygon:Q(ae.prototype.readPolygon),MultiPolygon:Q(ae.prototype.readMultiPolygon),Surface:Q(W.prototype.readSurface),MultiSurface:Q(W.prototype.readMultiSurface),Curve:Q(W.prototype.readCurve),MultiCurve:Q(W.prototype.readMultiCurve),Envelope:Q(W.prototype.readEnvelope)}};W.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:Y(W.prototype.curveMemberParser),curveMembers:Y(W.prototype.curveMemberParser)}};W.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:Y(W.prototype.surfaceMemberParser),surfaceMembers:Y(W.prototype.surfaceMemberParser)}};W.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:Y(ae.prototype.readLineString),Curve:Y(W.prototype.readCurve)}};W.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:Y(ae.prototype.readPolygon),Surface:Y(W.prototype.readSurface)}};W.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:Q(W.prototype.readPatch)}};W.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:Q(W.prototype.readSegment)}};W.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:Y(W.prototype.readFlatPosList),upperCorner:Y(W.prototype.readFlatPosList)}};W.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:Q(W.prototype.readPolygonPatch)}};W.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:sh(W.prototype.readLineStringSegment)}};ae.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:Q(ae.prototype.readFlatLinearRing),Ring:Q(W.prototype.readFlatCurveRing)}};W.prototype.writeFeatures;W.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:R(W.prototype.writeRing),interior:R(W.prototype.writeRing)}};W.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:R(le),upperCorner:R(le)}};W.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:R(W.prototype.writeSurfaceOrPolygonMember),polygonMember:R(W.prototype.writeSurfaceOrPolygonMember)}};W.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:R(W.prototype.writePointMember)}};W.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:R(W.prototype.writeLineStringOrCurveMember),curveMember:R(W.prototype.writeLineStringOrCurveMember)}};W.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:R(W.prototype.writeCurveOrLineString),MultiCurve:R(W.prototype.writeMultiCurveOrLineString),Point:R(W.prototype.writePoint),MultiPoint:R(W.prototype.writeMultiPoint),LineString:R(W.prototype.writeCurveOrLineString),MultiLineString:R(W.prototype.writeMultiCurveOrLineString),LinearRing:R(W.prototype.writeLinearRing),Polygon:R(W.prototype.writeSurfaceOrPolygon),MultiPolygon:R(W.prototype.writeMultiSurfaceOrPolygon),Surface:R(W.prototype.writeSurfaceOrPolygon),MultiSurface:R(W.prototype.writeMultiSurfaceOrPolygon),Envelope:R(W.prototype.writeEnvelope)}};const ne=W,ya=ne;ya.prototype.writeFeatures;ya.prototype.writeFeaturesNode;const Ud=ya,Ge=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],Bd="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",zd={rte:Ih,trk:Lh,wpt:Ch},kd=Z(Ge,{rte:Y(Ih),trk:Y(Lh),wpt:Y(Ch)}),$d=Z(Ge,{text:P(B,"linkText"),type:P(B,"linkType")}),jd=Z(Ge,{rte:R(dg),trk:R(gg),wpt:R(mg)});class qd extends Ds{constructor(e){super(),e=e||{},this.dataProjection=de("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let r=0,i=e.length;r<i;++r){const s=e[r];if(this.readExtensions_){const n=s.get("extensionsNode_")||null;this.readExtensions_(s,n)}s.set("extensionsNode_",void 0)}}readFeatureFromNode(e,r){if(!Ge.includes(e.namespaceURI))return null;const i=zd[e.localName];if(!i)return null;const s=i(e,[this.getReadOptions(e,r)]);return s?(this.handleReadExtensions_([s]),s):null}readFeaturesFromNode(e,r){if(!Ge.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const i=$([],kd,e,[this.getReadOptions(e,r)]);return i?(this.handleReadExtensions_(i),i):[]}return[]}writeFeaturesNode(e,r){r=this.adaptOptions(r);const i=ie("http://www.topografix.com/GPX/1/1","gpx"),s="http://www.w3.org/2000/xmlns/";return i.setAttributeNS(s,"xmlns:xsi",Si),i.setAttributeNS(Si,"xsi:schemaLocation",Bd),i.setAttribute("version","1.1"),i.setAttribute("creator","OpenLayers"),Me({node:i},jd,hg,e,[r]),i}}const Zd=Z(Ge,{name:P(B),cmt:P(B),desc:P(B),src:P(B),link:Ea,number:P(Ne),extensions:wa,type:P(B),rtept:ug}),Wd=Z(Ge,{ele:P(Xe),time:P(na)}),Xd=Z(Ge,{name:P(B),cmt:P(B),desc:P(B),src:P(B),link:Ea,number:P(Ne),type:P(B),extensions:wa,trkseg:fg}),Hd=Z(Ge,{trkpt:cg}),Vd=Z(Ge,{ele:P(Xe),time:P(na)}),Yd=Z(Ge,{ele:P(Xe),time:P(na),magvar:P(Xe),geoidheight:P(Xe),name:P(B),cmt:P(B),desc:P(B),src:P(B),link:Ea,sym:P(B),type:P(B),fix:P(B),sat:P(Ne),hdop:P(Xe),vdop:P(Xe),pdop:P(Xe),ageofdgpsdata:P(Xe),dgpsid:P(Ne),extensions:wa}),Kd=["text","type"],Qd=Z(Ge,{text:R(le),type:R(le)}),Jd=Z(Ge,["name","cmt","desc","src","link","number","type","rtept"]),eg=Z(Ge,{name:R(le),cmt:R(le),desc:R(le),src:R(le),link:R(Ta),number:R(gs),type:R(le),rtept:nh(R(Sa))}),tg=Z(Ge,["ele","time"]),rg=Z(Ge,["name","cmt","desc","src","link","number","type","trkseg"]),ig=Z(Ge,{name:R(le),cmt:R(le),desc:R(le),src:R(le),link:R(Ta),number:R(gs),type:R(le),trkseg:nh(R(pg))}),sg=lt("trkpt"),ng=Z(Ge,{trkpt:R(Sa)}),ag=Z(Ge,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),og=Z(Ge,{ele:R(hr),time:R(af),magvar:R(hr),geoidheight:R(hr),name:R(le),cmt:R(le),desc:R(le),src:R(le),link:R(Ta),sym:R(le),type:R(le),fix:R(le),sat:R(gs),hdop:R(hr),vdop:R(hr),pdop:R(hr),ageofdgpsdata:R(hr),dgpsid:R(gs)}),lg={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function hg(t,e,r){const i=t.getGeometry();if(i){const s=lg[i.getType()];if(s){const n=e[e.length-1].node;return ie(n.namespaceURI,s)}}}function xa(t,e,r,i){return t.push(parseFloat(r.getAttribute("lon")),parseFloat(r.getAttribute("lat"))),"ele"in i?(t.push(i.ele),delete i.ele,e.hasZ=!0):t.push(0),"time"in i?(t.push(i.time),delete i.time,e.hasM=!0):t.push(0),t}function va(t,e,r){let i="XY",s=2;if(t.hasZ&&t.hasM?(i="XYZM",s=4):t.hasZ?(i="XYZ",s=3):t.hasM&&(i="XYM",s=3),s!==4){for(let n=0,a=e.length/4;n<a;n++)e[n*s]=e[n*4],e[n*s+1]=e[n*4+1],t.hasZ&&(e[n*s+2]=e[n*4+2]),t.hasM&&(e[n*s+2]=e[n*4+3]);if(e.length=e.length/4*s,r)for(let n=0,a=r.length;n<a;n++)r[n]=r[n]/4*s}return i}function Ea(t,e){const r=e[e.length-1],i=t.getAttribute("href");i!==null&&(r.link=i),Qt($d,t,e)}function wa(t,e){const r=e[e.length-1];r.extensionsNode_=t}function ug(t,e){const r=$({},Wd,t,e);if(r){const i=e[e.length-1],s=i.flatCoordinates,n=i.layoutOptions;xa(s,n,t,r)}}function cg(t,e){const r=$({},Vd,t,e);if(r){const i=e[e.length-1],s=i.flatCoordinates,n=i.layoutOptions;xa(s,n,t,r)}}function fg(t,e){const r=e[e.length-1];Qt(Hd,t,e);const i=r.flatCoordinates;r.ends.push(i.length)}function Ih(t,e){const r=e[0],i=$({flatCoordinates:[],layoutOptions:{}},Zd,t,e);if(!i)return;const s=i.flatCoordinates;delete i.flatCoordinates;const n=i.layoutOptions;delete i.layoutOptions;const a=va(n,s),o=new Dt(s,a);ke(o,!1,r);const l=new ct(o);return l.setProperties(i,!0),l}function Lh(t,e){const r=e[0],i=$({flatCoordinates:[],ends:[],layoutOptions:{}},Xd,t,e);if(!i)return;const s=i.flatCoordinates;delete i.flatCoordinates;const n=i.ends;delete i.ends;const a=i.layoutOptions;delete i.layoutOptions;const o=va(a,s,n),l=new Yr(s,o,n);ke(l,!1,r);const h=new ct(l);return h.setProperties(i,!0),h}function Ch(t,e){const r=e[0],i=$({},Yd,t,e);if(!i)return;const s={},n=xa([],s,t,i),a=va(s,n),o=new Et(n,a);ke(o,!1,r);const l=new ct(o);return l.setProperties(i,!0),l}function Ta(t,e,r){t.setAttribute("href",e);const s=r[r.length-1].properties,n=[s.linkText,s.linkType];Me({node:t},Qd,Kr,n,r,Kd)}function Sa(t,e,r){const i=r[r.length-1],n=i.node.namespaceURI,a=i.properties;switch(t.setAttributeNS(null,"lat",String(e[1])),t.setAttributeNS(null,"lon",String(e[0])),i.geometryLayout){case"XYZM":e[3]!==0&&(a.time=e[3]);case"XYZ":e[2]!==0&&(a.ele=e[2]);break;case"XYM":e[2]!==0&&(a.time=e[2]);break}const l=t.nodeName=="rtept"?tg[n]:ag[n],h=aa(a,l);Me({node:t,properties:a},og,Kr,h,r,l)}function dg(t,e,r){const i=r[0],s=e.getProperties(),n={node:t};n.properties=s;const a=e.getGeometry();if(a.getType()=="LineString"){const c=ke(a,!0,i);n.geometryLayout=c.getLayout(),s.rtept=c.getCoordinates()}const o=r[r.length-1].node,l=Jd[o.namespaceURI],h=aa(s,l);Me(n,eg,Kr,h,r,l)}function gg(t,e,r){const i=r[0],s=e.getProperties(),n={node:t};n.properties=s;const a=e.getGeometry();if(a.getType()=="MultiLineString"){const c=ke(a,!0,i);s.trkseg=c.getLineStrings()}const o=r[r.length-1].node,l=rg[o.namespaceURI],h=aa(s,l);Me(n,ig,Kr,h,r,l)}function pg(t,e,r){const i={node:t};i.geometryLayout=e.getLayout(),i.properties={},Me(i,ng,sg,e.getCoordinates(),r)}function mg(t,e,r){const i=r[0],s=r[r.length-1];s.properties=e.getProperties();const n=e.getGeometry();if(n.getType()=="Point"){const a=ke(n,!0,i);s.geometryLayout=a.getLayout(),Sa(t,a.getCoordinates(),r)}}const _g=qd;class yg extends ah{constructor(){super()}getType(){return"text"}readFeature(e,r){return this.readFeatureFromText(Yi(e),this.adaptOptions(r))}readFeatureFromText(e,r){return $t()}readFeatures(e,r){return this.readFeaturesFromText(Yi(e),this.adaptOptions(r))}readFeaturesFromText(e,r){return $t()}readGeometry(e,r){return this.readGeometryFromText(Yi(e),this.adaptOptions(r))}readGeometryFromText(e,r){return $t()}readProjection(e){return this.readProjectionFromText(Yi(e))}readProjectionFromText(e){return this.dataProjection}writeFeature(e,r){return this.writeFeatureText(e,this.adaptOptions(r))}writeFeatureText(e,r){return $t()}writeFeatures(e,r){return this.writeFeaturesText(e,this.adaptOptions(r))}writeFeaturesText(e,r){return $t()}writeGeometry(e,r){return this.writeGeometryText(e,this.adaptOptions(r))}writeGeometryText(e,r){return $t()}}function Yi(t){return typeof t=="string"?t:""}const Ma=yg,xg=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,vg=/^H.([A-Z]{3}).*?:(.*)/,Eg=/^HFDTE(\d{2})(\d{2})(\d{2})/,wg=/\r\n|\r|\n/;class Tg extends Ma{constructor(e){super(),e=e||{},this.dataProjection=de("EPSG:4326"),this.altitudeMode_=e.altitudeMode?e.altitudeMode:"none"}readFeatureFromText(e,r){const i=this.altitudeMode_,s=e.split(wg),n={},a=[];let o=2e3,l=0,h=1,c=-1,u,d;for(u=0,d=s.length;u<d;++u){const y=s[u];let v;if(y.charAt(0)=="B"){if(v=xg.exec(y),v){const E=parseInt(v[1],10),T=parseInt(v[2],10),w=parseInt(v[3],10);let b=parseInt(v[4],10)+parseInt(v[5],10)/6e4;v[6]=="S"&&(b=-b);let A=parseInt(v[7],10)+parseInt(v[8],10)/6e4;if(v[9]=="W"&&(A=-A),a.push(A,b),i!="none"){let C;i=="gps"?C=parseInt(v[11],10):i=="barometric"?C=parseInt(v[12],10):C=0,a.push(C)}let I=Date.UTC(o,l,h,E,T,w);I<c&&(I=Date.UTC(o,l,h+1,E,T,w)),a.push(I/1e3),c=I}}else y.charAt(0)=="H"&&(v=Eg.exec(y),v?(h=parseInt(v[1],10),l=parseInt(v[2],10)-1,o=2e3+parseInt(v[3],10)):(v=vg.exec(y),v&&(n[v[1]]=v[2].trim())))}if(a.length===0)return null;const p=i=="none"?"XYM":"XYZM",g=new Dt(a,p),_=new ct(ke(g,!1,r));return _.setProperties(n,!0),_}readFeaturesFromText(e,r){const i=this.readFeatureFromText(e,r);return i?[i]:[]}}const Sg=Tg,De={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"},mr={};mr[De.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}};mr[De.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}};mr[De.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}};mr.none={none:{supports:[],formats:[],qualities:[]}};const Mg=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,Go=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,bg=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function Rg(t){let e=t.getComplianceLevelSupportedFeatures();return e===void 0&&(e=mr[De.VERSION1].level0),{url:t.imageInfo["@id"]===void 0?void 0:t.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:e.supports,formats:[...e.formats,t.imageInfo.formats===void 0?[]:t.imageInfo.formats],qualities:[...e.qualities,t.imageInfo.qualities===void 0?[]:t.imageInfo.qualities],resolutions:t.imageInfo.scale_factors,tileSize:t.imageInfo.tile_width!==void 0?t.imageInfo.tile_height!==void 0?[t.imageInfo.tile_width,t.imageInfo.tile_height]:[t.imageInfo.tile_width,t.imageInfo.tile_width]:t.imageInfo.tile_height!=null?[t.imageInfo.tile_height,t.imageInfo.tile_height]:void 0}}function Pg(t){const e=t.getComplianceLevelSupportedFeatures(),r=Array.isArray(t.imageInfo.profile)&&t.imageInfo.profile.length>1,i=r&&t.imageInfo.profile[1].supports?t.imageInfo.profile[1].supports:[],s=r&&t.imageInfo.profile[1].formats?t.imageInfo.profile[1].formats:[],n=r&&t.imageInfo.profile[1].qualities?t.imageInfo.profile[1].qualities:[];return{url:t.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:t.imageInfo.sizes===void 0?void 0:t.imageInfo.sizes.map(function(a){return[a.width,a.height]}),tileSize:t.imageInfo.tiles===void 0?void 0:[t.imageInfo.tiles.map(function(a){return a.width})[0],t.imageInfo.tiles.map(function(a){return a.height===void 0?a.width:a.height})[0]],resolutions:t.imageInfo.tiles===void 0?void 0:t.imageInfo.tiles.map(function(a){return a.scaleFactors})[0],supports:[...e.supports,...i],formats:[...e.formats,...s],qualities:[...e.qualities,...n]}}function Ag(t){const e=t.getComplianceLevelSupportedFeatures(),r=t.imageInfo.extraFormats===void 0?e.formats:[...e.formats,...t.imageInfo.extraFormats],i=t.imageInfo.preferredFormats!==void 0&&Array.isArray(t.imageInfo.preferredFormats)&&t.imageInfo.preferredFormats.length>0?t.imageInfo.preferredFormats.filter(function(s){return["jpg","png","gif"].includes(s)}).reduce(function(s,n){return s===void 0&&r.includes(n)?n:s},void 0):void 0;return{url:t.imageInfo.id,sizes:t.imageInfo.sizes===void 0?void 0:t.imageInfo.sizes.map(function(s){return[s.width,s.height]}),tileSize:t.imageInfo.tiles===void 0?void 0:[t.imageInfo.tiles.map(function(s){return s.width})[0],t.imageInfo.tiles.map(function(s){return s.height})[0]],resolutions:t.imageInfo.tiles===void 0?void 0:t.imageInfo.tiles.map(function(s){return s.scaleFactors})[0],supports:t.imageInfo.extraFeatures===void 0?e.supports:[...e.supports,...t.imageInfo.extraFeatures],formats:r,qualities:t.imageInfo.extraQualities===void 0?e.qualities:[...e.qualities,...t.imageInfo.extraQualities],preferredFormat:i}}const qs={};qs[De.VERSION1]=Rg;qs[De.VERSION2]=Pg;qs[De.VERSION3]=Ag;class Ig{constructor(e){this.setImageInfo(e)}setImageInfo(e){typeof e=="string"?this.imageInfo=JSON.parse(e):this.imageInfo=e}getImageApiVersion(){if(this.imageInfo===void 0)return;let e=this.imageInfo["@context"]||"ol-no-context";typeof e=="string"&&(e=[e]);for(let r=0;r<e.length;r++)switch(e[r]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return De.VERSION1;case"http://iiif.io/api/image/2/context.json":return De.VERSION2;case"http://iiif.io/api/image/3/context.json":return De.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(De.VERSION1)&&this.imageInfo.identifier)return De.VERSION1;break}Gt(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(e){if(!(this.imageInfo===void 0||this.imageInfo.profile===void 0))switch(e===void 0&&(e=this.getImageApiVersion()),e){case De.VERSION1:if(Mg.test(this.imageInfo.profile))return this.imageInfo.profile;break;case De.VERSION3:if(bg.test(this.imageInfo.profile))return this.imageInfo.profile;break;case De.VERSION2:if(typeof this.imageInfo.profile=="string"&&Go.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&typeof this.imageInfo.profile[0]=="string"&&Go.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0];break}}getComplianceLevelFromProfile(e){const r=this.getComplianceLevelEntryFromProfile(e);if(r===void 0)return;const i=r.match(/level[0-2](?:\.json)?$/g);return Array.isArray(i)?i[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(this.imageInfo===void 0)return;const e=this.getImageApiVersion(),r=this.getComplianceLevelFromProfile(e);return r===void 0?mr.none.none:mr[e][r]}getTileSourceOptions(e){const r=e||{},i=this.getImageApiVersion();if(i===void 0)return;const s=i===void 0?void 0:qs[i](this);if(s!==void 0)return{url:s.url,version:i,size:[this.imageInfo.width,this.imageInfo.height],sizes:s.sizes,format:r.format!==void 0&&s.formats.includes(r.format)?r.format:s.preferredFormat!==void 0?s.preferredFormat:"jpg",supports:s.supports,quality:r.quality&&s.qualities.includes(r.quality)?r.quality:s.qualities.includes("native")?"native":"default",resolutions:Array.isArray(s.resolutions)?s.resolutions.sort(function(n,a){return a-n}):void 0,tileSize:s.tileSize}}}const Lg=Ig;class Cg{read(e){if(!e)return null;if(typeof e=="string"){const r=An(e);return this.readFromDocument(r)}return In(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let r=e.firstChild;r;r=r.nextSibling)if(r.nodeType==Node.ELEMENT_NODE)return this.readFromNode(r);return null}readFromNode(e){$t()}}const ba=Cg,Og="http://www.w3.org/1999/xlink";function ti(t){return t.getAttributeNS(Og,"href")}const st=[null,"http://www.opengis.net/ows/1.1"],Ng=Z(st,{ServiceIdentification:P(np),ServiceProvider:P(op),OperationsMetadata:P(ip)});class Fg extends ba{constructor(){super()}readFromNode(e){const r=$({},Ng,e,[]);return r||null}}const Dg=Z(st,{DeliveryPoint:P(B),City:P(B),AdministrativeArea:P(B),PostalCode:P(B),Country:P(B),ElectronicMailAddress:P(B)}),Gg=Z(st,{Value:be(lp)}),Ug=Z(st,{AllowedValues:P(Yg)}),Bg=Z(st,{Phone:P(sp),Address:P(Vg)}),zg=Z(st,{HTTP:P(tp)}),kg=Z(st,{Get:be(ep),Post:void 0}),$g=Z(st,{DCP:P(Jg)}),jg=Z(st,{Operation:rp}),qg=Z(st,{Voice:P(B),Facsimile:P(B)}),Zg=Z(st,{Constraint:be(Kg)}),Wg=Z(st,{IndividualName:P(B),PositionName:P(B),ContactInfo:P(Qg)}),Xg=Z(st,{Abstract:P(B),AccessConstraints:P(B),Fees:P(B),Title:P(B),ServiceTypeVersion:P(B),ServiceType:P(B)}),Hg=Z(st,{ProviderName:P(B),ProviderSite:P(ti),ServiceContact:P(ap)});function Vg(t,e){return $({},Dg,t,e)}function Yg(t,e){return $({},Gg,t,e)}function Kg(t,e){const r=t.getAttribute("name");if(r)return $({name:r},Ug,t,e)}function Qg(t,e){return $({},Bg,t,e)}function Jg(t,e){return $({},zg,t,e)}function ep(t,e){const r=ti(t);if(r)return $({href:r},Zg,t,e)}function tp(t,e){return $({},kg,t,e)}function rp(t,e){const r=t.getAttribute("name"),i=$({},$g,t,e);if(!i)return;const s=e[e.length-1];s[r]=i}function ip(t,e){return $({},jg,t,e)}function sp(t,e){return $({},qg,t,e)}function np(t,e){return $({},Xg,t,e)}function ap(t,e){return $({},Wg,t,e)}function op(t,e){return $({},Hg,t,e)}function lp(t,e){return B(t)}const Oh=Fg;function Uo(t,e,r,i,s,n){s!==void 0?(s=s,n=n!==void 0?n:0):(s=[],n=0);let a=e;for(;a<r;){const o=t[a++];s[n++]=t[a++],s[n++]=o;for(let l=2;l<i;++l)s[n++]=t[a++]}return s.length=n,s}class hp extends Ma{constructor(e){super(),e=e||{},this.dataProjection=de("EPSG:4326"),this.factor_=e.factor?e.factor:1e5,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY"}readFeatureFromText(e,r){const i=this.readGeometryFromText(e,r);return new ct(i)}readFeaturesFromText(e,r){return[this.readFeatureFromText(e,r)]}readGeometryFromText(e,r){const i=of(this.geometryLayout_),s=cp(e,i,this.factor_);Uo(s,0,s.length,i,s);const n=lf(s,0,s.length,i),a=new Dt(n,this.geometryLayout_);return ke(a,!1,this.adaptOptions(r))}writeFeatureText(e,r){const i=e.getGeometry();if(i)return this.writeGeometryText(i,r);throw new Error("Expected `feature` to have a geometry")}writeFeaturesText(e,r){return this.writeFeatureText(e[0],r)}writeGeometryText(e,r){e=ke(e,!0,this.adaptOptions(r));const i=e.getFlatCoordinates(),s=e.getStride();return Uo(i,0,i.length,s,i),up(i,s,this.factor_)}}function up(t,e,r){r=r||1e5;let i;const s=new Array(e);for(i=0;i<e;++i)s[i]=0;for(let n=0,a=t.length;n<a;)for(i=0;i<e;++i,++n){const o=t[n],l=o-s[i];s[i]=o,t[n]=l}return fp(t,r)}function cp(t,e,r){r=r||1e5;let i;const s=new Array(e);for(i=0;i<e;++i)s[i]=0;const n=dp(t,r);for(let a=0,o=n.length;a<o;)for(i=0;i<e;++i,++a)s[i]+=n[a],n[a]=s[i];return n}function fp(t,e){e=e||1e5;for(let r=0,i=t.length;r<i;++r)t[r]=Math.round(t[r]*e);return gp(t)}function dp(t,e){e=e||1e5;const r=pp(t);for(let i=0,s=r.length;i<s;++i)r[i]/=e;return r}function gp(t){for(let e=0,r=t.length;e<r;++e){const i=t[e];t[e]=i<0?~(i<<1):i<<1}return mp(t)}function pp(t){const e=_p(t);for(let r=0,i=e.length;r<i;++r){const s=e[r];e[r]=s&1?~(s>>1):s>>1}return e}function mp(t){let e="";for(let r=0,i=t.length;r<i;++r)e+=yp(t[r]);return e}function _p(t){const e=[];let r=0,i=0;for(let s=0,n=t.length;s<n;++s){const a=t.charCodeAt(s)-63;r|=(a&31)<<i,a<32?(e.push(r),r=0,i=0):i+=5}return e}function yp(t){let e,r="";for(;t>=32;)e=(32|t&31)+63,r+=String.fromCharCode(e),t>>=5;return e=t+63,r+=String.fromCharCode(e),r}const xp=hp;class ye extends ne{constructor(e){e=e||{},super(e),this.schemaLocation=e.schemaLocation?e.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(e,r,i){const s=i[i.length-1];i[i.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},s),super.writeGeometryElement(e,r,i)}}ye.prototype.namespace="http://www.opengis.net/gml/3.2";ye.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:Q(ne.prototype.readFlatPos),posList:Q(ne.prototype.readFlatPosList),coordinates:Q(ei.prototype.readFlatCoordinates)}};ye.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:ne.prototype.interiorParser,exterior:ne.prototype.exteriorParser}};ye.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:Q(ae.prototype.readPoint),MultiPoint:Q(ae.prototype.readMultiPoint),LineString:Q(ae.prototype.readLineString),MultiLineString:Q(ae.prototype.readMultiLineString),LinearRing:Q(ae.prototype.readLinearRing),Polygon:Q(ae.prototype.readPolygon),MultiPolygon:Q(ae.prototype.readMultiPolygon),Surface:Q(ye.prototype.readSurface),MultiSurface:Q(ne.prototype.readMultiSurface),Curve:Q(ye.prototype.readCurve),MultiCurve:Q(ne.prototype.readMultiCurve),Envelope:Q(ye.prototype.readEnvelope)}};ye.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:Y(ne.prototype.curveMemberParser),curveMembers:Y(ne.prototype.curveMemberParser)}};ye.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:Y(ne.prototype.surfaceMemberParser),surfaceMembers:Y(ne.prototype.surfaceMemberParser)}};ye.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:Y(ae.prototype.readLineString),Curve:Y(ne.prototype.readCurve)}};ye.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:Y(ae.prototype.readPolygon),Surface:Y(ne.prototype.readSurface)}};ye.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:Q(ne.prototype.readPatch)}};ye.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:Q(ne.prototype.readSegment)}};ye.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:Y(ne.prototype.readFlatPosList),upperCorner:Y(ne.prototype.readFlatPosList)}};ye.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:Q(ne.prototype.readPolygonPatch)}};ye.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:sh(ne.prototype.readLineStringSegment)}};ye.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:Y(ae.prototype.pointMemberParser),pointMembers:Y(ae.prototype.pointMemberParser)}};ye.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:Y(ae.prototype.lineStringMemberParser),lineStringMembers:Y(ae.prototype.lineStringMemberParser)}};ye.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:Y(ae.prototype.polygonMemberParser),polygonMembers:Y(ae.prototype.polygonMemberParser)}};ye.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:Y(ae.prototype.readFlatCoordinatesFromNode)}};ye.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:Y(ae.prototype.readLineString)}};ye.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:Y(ae.prototype.readPolygon)}};ye.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:Q(ae.prototype.readFlatLinearRing),Ring:Q(ye.prototype.readFlatCurveRing)}};ye.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:R(ne.prototype.writeRing),interior:R(ne.prototype.writeRing)}};ye.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:R(le),upperCorner:R(le)}};ye.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:R(ne.prototype.writeSurfaceOrPolygonMember),polygonMember:R(ne.prototype.writeSurfaceOrPolygonMember)}};ye.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:R(ne.prototype.writePointMember)}};ye.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:R(ne.prototype.writeLineStringOrCurveMember),curveMember:R(ne.prototype.writeLineStringOrCurveMember)}};ye.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:R(ne.prototype.writeCurveOrLineString),MultiCurve:R(ne.prototype.writeMultiCurveOrLineString),Point:R(ye.prototype.writePoint),MultiPoint:R(ne.prototype.writeMultiPoint),LineString:R(ne.prototype.writeCurveOrLineString),MultiLineString:R(ne.prototype.writeMultiCurveOrLineString),LinearRing:R(ne.prototype.writeLinearRing),Polygon:R(ne.prototype.writeSurfaceOrPolygon),MultiPolygon:R(ne.prototype.writeMultiSurfaceOrPolygon),Surface:R(ne.prototype.writeSurfaceOrPolygon),MultiSurface:R(ne.prototype.writeMultiSurfaceOrPolygon),Envelope:R(ne.prototype.writeEnvelope)}};const Ra=ye;class vp{constructor(e){this.tagName_=e}getTagName(){return this.tagName_}}const Nh=vp;class Ep extends Nh{constructor(e,r){super(e),this.conditions=r,Gt(this.conditions.length>=2,"At least 2 conditions are required")}}const wp=Ep;class Tp extends wp{constructor(e){super("And",Array.prototype.slice.call(arguments))}}const Sp=Tp;class Mp extends Nh{constructor(e,r,i){if(super("BBOX"),this.geometryName=e,this.extent=r,r.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=i}}const bp=Mp;function Rp(t){const e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(Sp,e))}function Pp(t,e,r){return new bp(t,e,r)}const Bo={"http://www.opengis.net/gml":{boundedBy:P(ae.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:Y(ae.prototype.readFeaturesInternal)}},Ap={"http://www.opengis.net/wfs":{totalInserted:P(Ne),totalUpdated:P(Ne),totalDeleted:P(Ne)},"http://www.opengis.net/wfs/2.0":{totalInserted:P(Ne),totalUpdated:P(Ne),totalDeleted:P(Ne)}},Ip={"http://www.opengis.net/wfs":{TransactionSummary:P(ko,"transactionSummary"),InsertResults:P(jo,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:P(ko,"transactionSummary"),InsertResults:P(jo,"insertIds")}},Lp={"http://www.opengis.net/wfs":{PropertyName:R(le)},"http://www.opengis.net/wfs/2.0":{PropertyName:R(le)}},Fh={"http://www.opengis.net/wfs":{Insert:R(qo),Update:R(Wo),Delete:R(Zo),Property:R(Xo),Native:R(Ho)},"http://www.opengis.net/wfs/2.0":{Insert:R(qo),Update:R(Wo),Delete:R(Zo),Property:R(Xo),Native:R(Ho)}},Dh="feature",Pa="http://www.w3.org/2000/xmlns/",Aa={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},Gn={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},Ia={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},zo={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},La={"2.0.0":Ra,"1.1.0":ne,"1.0.0":ei},Cp="1.1.0";class Op extends Ds{constructor(e){super(),e=e||{},this.version_=e.version?e.version:Cp,this.featureType_=e.featureType,this.featureNS_=e.featureNS,this.gmlFormat_=e.gmlFormat?e.gmlFormat:new La[this.version_],this.schemaLocation_=e.schemaLocation?e.schemaLocation:zo[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(e){this.featureType_=e}readFeaturesFromNode(e,r){const i={node:e};Object.assign(i,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(i,this.getReadOptions(e,r||{}));const s=[i];let n;this.version_==="2.0.0"?n=Bo:n=this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let a=$([],n,e,s,this.gmlFormat_);return a||(a=[]),a}readTransactionResponse(e){if(e){if(typeof e=="string"){const r=An(e);return this.readTransactionResponseFromDocument(r)}return In(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}}readFeatureCollectionMetadata(e){if(e){if(typeof e=="string"){const r=An(e);return this.readFeatureCollectionMetadataFromDocument(r)}return In(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}}readFeatureCollectionMetadataFromDocument(e){for(let r=e.firstChild;r;r=r.nextSibling)if(r.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(r)}readFeatureCollectionMetadataFromNode(e){const r={},i=Kt(e.getAttribute("numberOfFeatures"));return r.numberOfFeatures=i,$(r,Bo,e,[],this.gmlFormat_)}readTransactionResponseFromDocument(e){for(let r=e.firstChild;r;r=r.nextSibling)if(r.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(r)}readTransactionResponseFromNode(e){return $({},Ip,e,[])}writeGetFeature(e){const r=ie(Gn[this.version_],"GetFeature");r.setAttribute("service","WFS"),r.setAttribute("version",this.version_),e.handle&&r.setAttribute("handle",e.handle),e.outputFormat&&r.setAttribute("outputFormat",e.outputFormat),e.maxFeatures!==void 0&&r.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&r.setAttribute("resultType",e.resultType),e.startIndex!==void 0&&r.setAttribute("startIndex",String(e.startIndex)),e.count!==void 0&&r.setAttribute("count",String(e.count)),e.viewParams!==void 0&&r.setAttribute("viewParams",e.viewParams),r.setAttributeNS(Si,"xsi:schemaLocation",this.schemaLocation_);const i={node:r};if(Object.assign(i,{version:this.version_,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,propertyNames:e.propertyNames?e.propertyNames:[]}),Gt(Array.isArray(e.featureTypes),"`options.featureTypes` must be an Array"),typeof e.featureTypes[0]=="string"){let s=e.filter;e.bbox&&(Gt(e.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),s=this.combineBboxAndFilter(e.geometryName,e.bbox,e.srsName,s)),Object.assign(i,{geometryName:e.geometryName,filter:s}),sl(r,e.featureTypes,[i])}else e.featureTypes.forEach(s=>{const n=this.combineBboxAndFilter(s.geometryName,s.bbox,e.srsName,e.filter);Object.assign(i,{geometryName:s.geometryName,filter:n}),sl(r,[s.name],[i])});return r}combineBboxAndFilter(e,r,i,s){const n=Pp(e,r,i);return s?Rp(s,n):n}writeTransaction(e,r,i,s){const n=[],a=s.version?s.version:this.version_,o=ie(Gn[a],"Transaction");o.setAttribute("service","WFS"),o.setAttribute("version",a);let l;s&&(l=s.gmlOptions?s.gmlOptions:{},s.handle&&o.setAttribute("handle",s.handle)),o.setAttributeNS(Si,"xsi:schemaLocation",zo[a]);const h=Np(o,l,a,s);return e&&Ki("Insert",e,n,h),r&&Ki("Update",r,n,h),i&&Ki("Delete",i,n,h),s.nativeElements&&Ki("Native",s.nativeElements,n,h),o}readProjectionFromDocument(e){for(let r=e.firstChild;r;r=r.nextSibling)if(r.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(r);return null}readProjectionFromNode(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild){e=e.firstElementChild.firstElementChild;for(let r=e.firstElementChild;r;r=r.nextElementSibling)if(!(r.childNodes.length===0||r.childNodes.length===1&&r.firstChild.nodeType===3)){const i=[{}];return this.gmlFormat_.readGeometryElement(r,i),de(i.pop().srsName)}}return null}}function Np(t,e,r,i){const s=i.featurePrefix?i.featurePrefix:Dh;let n;return r==="1.0.0"?n=2:r==="1.1.0"?n=3:r==="2.0.0"&&(n=3.2),Object.assign({node:t},{version:r,featureNS:i.featureNS,featureType:i.featureType,featurePrefix:s,gmlVersion:n,hasZ:i.hasZ,srsName:i.srsName},e)}function Ki(t,e,r,i){Me(i,Fh,lt(t),e,r)}function ko(t,e){return $({},Ap,t,e)}const Fp={"http://www.opengis.net/ogc":{FeatureId:Y(function(t,e){return t.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:Y(function(t,e){return t.getAttribute("fid")})}};function $o(t,e){Qt(Fp,t,e)}const Dp={"http://www.opengis.net/wfs":{Feature:$o},"http://www.opengis.net/wfs/2.0":{Feature:$o}};function jo(t,e){return $([],Dp,t,e)}function qo(t,e,r){const i=r[r.length-1],s=i.featureType,n=i.featureNS,a=i.gmlVersion,o=ie(n,s);t.appendChild(o),a===2?ei.prototype.writeFeatureElement(o,e,r):a===3?ne.prototype.writeFeatureElement(o,e,r):Ra.prototype.writeFeatureElement(o,e,r)}function Gh(t,e,r){const s=r[r.length-1].version,n=Aa[s],a=ie(n,"Filter"),o=ie(n,"FeatureId");a.appendChild(o),o.setAttribute("fid",e),t.appendChild(a)}function Ca(t,e){t=t||Dh;const r=t+":";return e.startsWith(r)?e:r+e}function Zo(t,e,r){const i=r[r.length-1];Gt(e.getId()!==void 0,"Features must have an id set");const s=i.featureType,n=i.featurePrefix,a=i.featureNS,o=Ca(n,s);t.setAttribute("typeName",o),t.setAttributeNS(Pa,"xmlns:"+n,a);const l=e.getId();l!==void 0&&Gh(t,l,r)}function Wo(t,e,r){const i=r[r.length-1];Gt(e.getId()!==void 0,"Features must have an id set");const s=i.version,n=i.featureType,a=i.featurePrefix,o=i.featureNS,l=Ca(a,n),h=e.getGeometryName();t.setAttribute("typeName",l),t.setAttributeNS(Pa,"xmlns:"+a,o);const c=e.getId();if(c!==void 0){const u=e.getKeys(),d=[];for(let p=0,g=u.length;p<g;p++){const _=e.get(u[p]);if(_!==void 0){let y=u[p];_&&typeof _.getSimplifiedGeometry=="function"&&(y=h),d.push({name:y,value:_})}}Me({version:s,gmlVersion:i.gmlVersion,node:t,hasZ:i.hasZ,srsName:i.srsName},Fh,lt("Property"),d,r),Gh(t,c,r)}}function Xo(t,e,r){const i=r[r.length-1],s=i.version,n=Gn[s],o=ie(n,s==="2.0.0"?"ValueReference":"Name"),l=i.gmlVersion;if(t.appendChild(o),le(o,e.name),e.value!==void 0&&e.value!==null){const h=ie(n,"Value");t.appendChild(h),e.value&&typeof e.value.getSimplifiedGeometry=="function"?l===2?ei.prototype.writeGeometryElement(h,e.value,r):l===3?ne.prototype.writeGeometryElement(h,e.value,r):Ra.prototype.writeGeometryElement(h,e.value,r):le(h,e.value)}}function Ho(t,e,r){e.vendorId&&t.setAttribute("vendorId",e.vendorId),e.safeToIgnore!==void 0&&t.setAttribute("safeToIgnore",String(e.safeToIgnore)),e.value!==void 0&&le(t,e.value)}const Zs={"http://www.opengis.net/wfs":{Query:R(Vo)},"http://www.opengis.net/wfs/2.0":{Query:R(Vo)},"http://www.opengis.net/ogc":{During:R(Qo),And:R(Qi),Or:R(Qi),Not:R(Jo),BBOX:R(Yo),Contains:R(Vt),Intersects:R(Vt),Within:R(Vt),DWithin:R(Ko),PropertyIsEqualTo:R(dt),PropertyIsNotEqualTo:R(dt),PropertyIsLessThan:R(dt),PropertyIsLessThanOrEqualTo:R(dt),PropertyIsGreaterThan:R(dt),PropertyIsGreaterThanOrEqualTo:R(dt),PropertyIsNull:R(el),PropertyIsBetween:R(tl),PropertyIsLike:R(rl)},"http://www.opengis.net/fes/2.0":{During:R(Qo),And:R(Qi),Or:R(Qi),Not:R(Jo),BBOX:R(Yo),Contains:R(Vt),Disjoint:R(Vt),Intersects:R(Vt),ResourceId:R(Up),Within:R(Vt),DWithin:R(Ko),PropertyIsEqualTo:R(dt),PropertyIsNotEqualTo:R(dt),PropertyIsLessThan:R(dt),PropertyIsLessThanOrEqualTo:R(dt),PropertyIsGreaterThan:R(dt),PropertyIsGreaterThanOrEqualTo:R(dt),PropertyIsNull:R(el),PropertyIsBetween:R(tl),PropertyIsLike:R(rl)}};function Vo(t,e,r){const i=r[r.length-1],s=i.version,n=i.featurePrefix,a=i.featureNS,o=i.propertyNames,l=i.srsName;let h;n?h=Ca(n,e):h=e;let c;s==="2.0.0"?c="typeNames":c="typeName",t.setAttribute(c,h),l&&t.setAttribute("srsName",l),a&&t.setAttributeNS(Pa,"xmlns:"+n,a);const u=Object.assign({},i);u.node=t,Me(u,Lp,lt("PropertyName"),o,r);const d=i.filter;if(d){const p=ie(Ws(s),"Filter");t.appendChild(p),Gp(p,d,r)}}function Gp(t,e,r){const i=r[r.length-1],s={node:t};Object.assign(s,{context:i}),Me(s,Zs,lt(e.getTagName()),[e],r)}function Yo(t,e,r){const i=r[r.length-1],n=i.context.version;i.srsName=e.srsName;const a=La[n];ri(n,t,e.geometryName),a.prototype.writeGeometryElement(t,e.extent,r)}function Up(t,e,r){t.setAttribute("rid",e.rid)}function Vt(t,e,r){const i=r[r.length-1],n=i.context.version;i.srsName=e.srsName;const a=La[n];ri(n,t,e.geometryName),a.prototype.writeGeometryElement(t,e.geometry,r)}function Ko(t,e,r){const n=r[r.length-1].context.version;Vt(t,e,r);const a=ie(Ws(n),"Distance");le(a,e.distance.toString()),n==="2.0.0"?a.setAttribute("uom",e.unit):a.setAttribute("units",e.unit),t.appendChild(a)}function Qo(t,e,r){const n=r[r.length-1].context.version;Es(Ia[n],"ValueReference",t,e.propertyName);const a=ie(qt,"TimePeriod");t.appendChild(a);const o=ie(qt,"begin");a.appendChild(o),il(o,e.begin);const l=ie(qt,"end");a.appendChild(l),il(l,e.end)}function Qi(t,e,r){const s=r[r.length-1].context,n={node:t};Object.assign(n,{context:s});const a=e.conditions;for(let o=0,l=a.length;o<l;++o){const h=a[o];Me(n,Zs,lt(h.getTagName()),[h],r)}}function Jo(t,e,r){const s=r[r.length-1].context,n={node:t};Object.assign(n,{context:s});const a=e.condition;Me(n,Zs,lt(a.getTagName()),[a],r)}function dt(t,e,r){const n=r[r.length-1].context.version;e.matchCase!==void 0&&t.setAttribute("matchCase",e.matchCase.toString()),ri(n,t,e.propertyName),ws(n,t,""+e.expression)}function el(t,e,r){const n=r[r.length-1].context.version;ri(n,t,e.propertyName)}function tl(t,e,r){const n=r[r.length-1].context.version,a=Ws(n);ri(n,t,e.propertyName);const o=ie(a,"LowerBoundary");t.appendChild(o),ws(n,o,""+e.lowerBoundary);const l=ie(a,"UpperBoundary");t.appendChild(l),ws(n,l,""+e.upperBoundary)}function rl(t,e,r){const n=r[r.length-1].context.version;t.setAttribute("wildCard",e.wildCard),t.setAttribute("singleChar",e.singleChar),t.setAttribute("escapeChar",e.escapeChar),e.matchCase!==void 0&&t.setAttribute("matchCase",e.matchCase.toString()),ri(n,t,e.propertyName),ws(n,t,""+e.pattern)}function Es(t,e,r,i){const s=ie(t,e);le(s,i),r.appendChild(s)}function ws(t,e,r){Es(Ws(t),"Literal",e,r)}function ri(t,e,r){t==="2.0.0"?Es(Ia[t],"ValueReference",e,r):Es(Aa[t],"PropertyName",e,r)}function il(t,e){const r=ie(qt,"TimeInstant");t.appendChild(r);const i=ie(qt,"timePosition");r.appendChild(i),le(i,e)}function sl(t,e,r){const i=r[r.length-1],s=Object.assign({},i);s.node=t,Me(s,Zs,lt("Query"),e,r)}function Ws(t){let e;return t==="2.0.0"?e=Ia[t]:e=Aa[t],e}const Bp=Op,Ee={POINT:1,LINE_STRING:2,POLYGON:3,MULTI_POINT:4,MULTI_LINE_STRING:5,MULTI_POLYGON:6,GEOMETRY_COLLECTION:7,POLYHEDRAL_SURFACE:15,TIN:16,TRIANGLE:17};class nl{constructor(e){this.view_=e,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_="XY"}readUint8(){return this.view_.getUint8(this.pos_++)}readUint32(e){return this.view_.getUint32((this.pos_+=4)-4,e!==void 0?e:this.isLittleEndian_)}readDouble(e){return this.view_.getFloat64((this.pos_+=8)-8,e!==void 0?e:this.isLittleEndian_)}readPoint(){const e=[];return e.push(this.readDouble()),e.push(this.readDouble()),this.hasZ_&&e.push(this.readDouble()),this.hasM_&&e.push(this.readDouble()),e}readLineString(){const e=this.readUint32(),r=[];for(let i=0;i<e;i++)r.push(this.readPoint());return r}readPolygon(){const e=this.readUint32(),r=[];for(let i=0;i<e;i++)r.push(this.readLineString());return r}readWkbHeader(e){const i=this.readUint8()>0,s=this.readUint32(i),n=Math.floor((s&268435455)/1e3),a=!!(s&2147483648)||n===1||n===3,o=!!(s&1073741824)||n===2||n===3,l=!!(s&536870912),h=(s&268435455)%1e3,c=["XY",a?"Z":"",o?"M":""].join(""),u=l?this.readUint32(i):null;if(e!==void 0&&e!==h)throw new Error("Unexpected WKB geometry type "+h);if(this.initialized_){if(this.isLittleEndian_!==i)throw new Error("Inconsistent endian");if(this.layout_!==c)throw new Error("Inconsistent geometry layout");if(u&&this.srid_!==u)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=i,this.hasZ_=a,this.hasM_=o,this.layout_=c,this.srid_=u,this.initialized_=!0;return h}readWkbPayload(e){switch(e){case Ee.POINT:return this.readPoint();case Ee.LINE_STRING:return this.readLineString();case Ee.POLYGON:case Ee.TRIANGLE:return this.readPolygon();case Ee.MULTI_POINT:return this.readMultiPoint();case Ee.MULTI_LINE_STRING:return this.readMultiLineString();case Ee.MULTI_POLYGON:case Ee.POLYHEDRAL_SURFACE:case Ee.TIN:return this.readMultiPolygon();case Ee.GEOMETRY_COLLECTION:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+e+" is found")}}readWkbBlock(e){return this.readWkbPayload(this.readWkbHeader(e))}readWkbCollection(e,r){const i=this.readUint32(),s=[];for(let n=0;n<i;n++){const a=e.call(this,r);a&&s.push(a)}return s}readMultiPoint(){return this.readWkbCollection(this.readWkbBlock,Ee.POINT)}readMultiLineString(){return this.readWkbCollection(this.readWkbBlock,Ee.LINE_STRING)}readMultiPolygon(){return this.readWkbCollection(this.readWkbBlock,Ee.POLYGON)}readGeometryCollection(){return this.readWkbCollection(this.readGeometry)}readGeometry(){const e=this.readWkbHeader(),r=this.readWkbPayload(e);switch(e){case Ee.POINT:return new Et(r,this.layout_);case Ee.LINE_STRING:return new Dt(r,this.layout_);case Ee.POLYGON:case Ee.TRIANGLE:return new Ui(r,this.layout_);case Ee.MULTI_POINT:return new Fs(r,this.layout_);case Ee.MULTI_LINE_STRING:return new Yr(r,this.layout_);case Ee.MULTI_POLYGON:case Ee.POLYHEDRAL_SURFACE:case Ee.TIN:return new Gi(r,this.layout_);case Ee.GEOMETRY_COLLECTION:return new rr(r);default:return null}}getSrid(){return this.srid_}}class zp{constructor(e){e=e||{},this.layout_=e.layout,this.isLittleEndian_=e.littleEndian!==!1,this.isEWKB_=e.ewkb!==!1,this.writeQueue_=[],this.nodata_=Object.assign({X:0,Y:0,Z:0,M:0},e.nodata)}writeUint8(e){this.writeQueue_.push([1,e])}writeUint32(e){this.writeQueue_.push([4,e])}writeDouble(e){this.writeQueue_.push([8,e])}writePoint(e,r){const i=Object.assign.apply(null,r.split("").map((s,n)=>({[s]:e[n]})));for(const s of this.layout_)this.writeDouble(s in i?i[s]:this.nodata_[s])}writeLineString(e,r){this.writeUint32(e.length);for(let i=0;i<e.length;i++)this.writePoint(e[i],r)}writePolygon(e,r){this.writeUint32(e.length);for(let i=0;i<e.length;i++)this.writeLineString(e[i],r)}writeWkbHeader(e,r){e%=1e3,this.layout_.includes("Z")&&(e+=this.isEWKB_?2147483648:1e3),this.layout_.includes("M")&&(e+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(r)&&(e|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(e),this.isEWKB_&&Number.isInteger(r)&&this.writeUint32(r)}writeMultiPoint(e,r){this.writeUint32(e.length);for(let i=0;i<e.length;i++)this.writeWkbHeader(1),this.writePoint(e[i],r)}writeMultiLineString(e,r){this.writeUint32(e.length);for(let i=0;i<e.length;i++)this.writeWkbHeader(2),this.writeLineString(e[i],r)}writeMultiPolygon(e,r){this.writeUint32(e.length);for(let i=0;i<e.length;i++)this.writeWkbHeader(3),this.writePolygon(e[i],r)}writeGeometryCollection(e){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeGeometry(e[r])}findMinimumLayout(e,r="XYZM"){const i=(s,n)=>s===n?s:s==="XYZM"?n:n==="XYZM"?s:"XY";if(e instanceof Mo)return i(e.getLayout(),r);if(e instanceof rr){const s=e.getGeometriesArray();for(let n=0;n<s.length&&r!=="XY";n++)r=this.findMinimumLayout(s[n],r)}return r}writeGeometry(e,r){const i={Point:Ee.POINT,LineString:Ee.LINE_STRING,Polygon:Ee.POLYGON,MultiPoint:Ee.MULTI_POINT,MultiLineString:Ee.MULTI_LINE_STRING,MultiPolygon:Ee.MULTI_POLYGON,GeometryCollection:Ee.GEOMETRY_COLLECTION},s=e.getType(),n=i[s];if(!n)throw new Error("GeometryType "+s+" is not supported");this.layout_||(this.layout_=this.findMinimumLayout(e)),this.writeWkbHeader(n,r),e instanceof Mo?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[s].call(this,e.getCoordinates(),e.getLayout()):e instanceof rr&&this.writeGeometryCollection(e.getGeometriesArray())}getBuffer(){const e=this.writeQueue_.reduce((n,a)=>n+a[0],0),r=new ArrayBuffer(e),i=new DataView(r);let s=0;return this.writeQueue_.forEach(n=>{switch(n[0]){case 1:i.setUint8(s,n[1]);break;case 4:i.setUint32(s,n[1],this.isLittleEndian_);break;case 8:i.setFloat64(s,n[1],this.isLittleEndian_);break}s+=n[0]}),r}}class kp extends ah{constructor(e){super(),e=e||{},this.splitCollection=!!e.splitCollection,this.viewCache_=null,this.hex_=e.hex!==!1,this.littleEndian_=e.littleEndian!==!1,this.ewkb_=e.ewkb!==!1,this.layout_=e.geometryLayout,this.nodataZ_=e.nodataZ||0,this.nodataM_=e.nodataM||0,this.srid_=e.srid}getType(){return this.hex_?"text":"arraybuffer"}readFeature(e,r){return new ct({geometry:this.readGeometry(e,r)})}readFeatures(e,r){let i=[];const s=this.readGeometry(e,r);return this.splitCollection&&s instanceof rr?i=s.getGeometriesArray():i=[s],i.map(n=>new ct({geometry:n}))}readGeometry(e,r){const i=al(e);if(!i)return null;const n=new nl(i).readGeometry();return this.viewCache_=i,r=this.getReadOptions(e,r),this.viewCache_=null,ke(n,!1,r)}readProjection(e){const r=this.viewCache_||al(e);if(!r)return;const i=new nl(r);return i.readWkbHeader(),i.getSrid()&&de("EPSG:"+i.getSrid())||void 0}writeFeature(e,r){return this.writeGeometry(e.getGeometry(),r)}writeFeatures(e,r){return this.writeGeometry(new rr(e.map(i=>i.getGeometry())),r)}writeGeometry(e,r){r=this.adaptOptions(r);const i=new zp({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}});let s=Number.isInteger(this.srid_)?Number(this.srid_):null;if(this.srid_!==!1&&!Number.isInteger(this.srid_)){const a=r.dataProjection&&de(r.dataProjection);if(a){const o=a.getCode();o.startsWith("EPSG:")&&(s=Number(o.substring(5)))}}i.writeGeometry(ke(e,!0,r),s);const n=i.getBuffer();return this.hex_?$p(n):n}}function $p(t){const e=new Uint8Array(t);return Array.from(e.values()).map(r=>(r<16?"0":"")+Number(r).toString(16).toUpperCase()).join("")}function jp(t){const e=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)e[r]=parseInt(t.substr(r*2,2),16);return new DataView(e.buffer)}function al(t){return typeof t=="string"?jp(t):ArrayBuffer.isView(t)?t instanceof DataView?t:new DataView(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer?new DataView(t):null}const qp=kp,Zp={POINT:Et,LINESTRING:Dt,POLYGON:Ui,MULTIPOINT:Fs,MULTILINESTRING:Yr,MULTIPOLYGON:Gi},Uh="EMPTY",Bh="Z",zh="M",Wp="ZM",xe={START:0,TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6},Xp={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class Hp{constructor(e){this.wkt=e,this.index_=-1}isAlpha_(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}isNumeric_(e,r){return r=r!==void 0?r:!1,e>="0"&&e<="9"||e=="."&&!r}isWhiteSpace_(e){return e==" "||e=="	"||e=="\r"||e==`
`}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const e=this.nextChar_(),r=this.index_;let i=e,s;if(e=="(")s=xe.LEFT_PAREN;else if(e==",")s=xe.COMMA;else if(e==")")s=xe.RIGHT_PAREN;else if(this.isNumeric_(e)||e=="-")s=xe.NUMBER,i=this.readNumber_();else if(this.isAlpha_(e))s=xe.TEXT,i=this.readText_();else{if(this.isWhiteSpace_(e))return this.nextToken();if(e==="")s=xe.EOF;else throw new Error("Unexpected character: "+e)}return{position:r,value:i,type:s}}readNumber_(){let e;const r=this.index_;let i=!1,s=!1;do e=="."?i=!0:(e=="e"||e=="E")&&(s=!0),e=this.nextChar_();while(this.isNumeric_(e,i)||!s&&(e=="e"||e=="E")||s&&(e=="-"||e=="+"));return parseFloat(this.wkt.substring(r,this.index_--))}readText_(){let e;const r=this.index_;do e=this.nextChar_();while(this.isAlpha_(e));return this.wkt.substring(r,this.index_--).toUpperCase()}}let Vp=class{constructor(e){this.lexer_=e,this.token_={position:0,type:xe.START},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(e){return this.token_.type==e}match(e){const r=this.isTokenType(e);return r&&this.consume_(),r}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let e="XY";const r=this.token_;if(this.isTokenType(xe.TEXT)){const i=r.value;i===Bh?e="XYZ":i===zh?e="XYM":i===Wp&&(e="XYZM"),e!=="XY"&&this.consume_()}return e}parseGeometryCollectionText_(){if(this.match(xe.LEFT_PAREN)){const e=[];do e.push(this.parseGeometry_());while(this.match(xe.COMMA));if(this.match(xe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(xe.LEFT_PAREN)){const e=this.parsePoint_();if(this.match(xe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(xe.LEFT_PAREN)){const e=this.parsePointList_();if(this.match(xe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(xe.LEFT_PAREN)){const e=this.parseLineStringTextList_();if(this.match(xe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(xe.LEFT_PAREN)){let e;if(this.token_.type==xe.LEFT_PAREN?e=this.parsePointTextList_():e=this.parsePointList_(),this.match(xe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(xe.LEFT_PAREN)){const e=this.parseLineStringTextList_();if(this.match(xe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(xe.LEFT_PAREN)){const e=this.parsePolygonTextList_();if(this.match(xe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePoint_(){const e=[],r=this.layout_.length;for(let i=0;i<r;++i){const s=this.token_;if(this.match(xe.NUMBER))e.push(s.value);else break}if(e.length==r)return e;throw new Error(this.formatErrorMessage_())}parsePointList_(){const e=[this.parsePoint_()];for(;this.match(xe.COMMA);)e.push(this.parsePoint_());return e}parsePointTextList_(){const e=[this.parsePointText_()];for(;this.match(xe.COMMA);)e.push(this.parsePointText_());return e}parseLineStringTextList_(){const e=[this.parseLineStringText_()];for(;this.match(xe.COMMA);)e.push(this.parseLineStringText_());return e}parsePolygonTextList_(){const e=[this.parsePolygonText_()];for(;this.match(xe.COMMA);)e.push(this.parsePolygonText_());return e}isEmptyGeometry_(){const e=this.isTokenType(xe.TEXT)&&this.token_.value==Uh;return e&&this.consume_(),e}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const e=this.token_;if(this.match(xe.TEXT)){const r=e.value;this.layout_=this.parseGeometryLayout_();const i=this.isEmptyGeometry_();if(r=="GEOMETRYCOLLECTION"){if(i)return new rr([]);const a=this.parseGeometryCollectionText_();return new rr(a)}const s=Zp[r];if(!s)throw new Error("Invalid geometry type: "+r);let n;if(i)r=="POINT"?n=[NaN,NaN]:n=[];else switch(r){case"POINT":{n=this.parsePointText_();break}case"LINESTRING":{n=this.parseLineStringText_();break}case"POLYGON":{n=this.parsePolygonText_();break}case"MULTIPOINT":{n=this.parseMultiPointText_();break}case"MULTILINESTRING":{n=this.parseMultiLineStringText_();break}case"MULTIPOLYGON":{n=this.parseMultiPolygonText_();break}}return new s(n,this.layout_)}throw new Error(this.formatErrorMessage_())}};class Yp extends Ma{constructor(e){super(),e=e||{},this.splitCollection_=e.splitCollection!==void 0?e.splitCollection:!1}parse_(e){const r=new Hp(e);return new Vp(r).parse()}readFeatureFromText(e,r){const i=this.readGeometryFromText(e,r),s=new ct;return s.setGeometry(i),s}readFeaturesFromText(e,r){let i=[];const s=this.readGeometryFromText(e,r);this.splitCollection_&&s.getType()=="GeometryCollection"?i=s.getGeometriesArray():i=[s];const n=[];for(let a=0,o=i.length;a<o;++a){const l=new ct;l.setGeometry(i[a]),n.push(l)}return n}readGeometryFromText(e,r){const i=this.parse_(e);return ke(i,!1,r)}writeFeatureText(e,r){const i=e.getGeometry();return i?this.writeGeometryText(i,r):""}writeFeaturesText(e,r){if(e.length==1)return this.writeFeatureText(e[0],r);const i=[];for(let n=0,a=e.length;n<a;++n)i.push(e[n].getGeometry());const s=new rr(i);return this.writeGeometryText(s,r)}writeGeometryText(e,r){return jh(ke(e,!0,r))}}function kh(t){const e=t.getCoordinates();return e.length===0?"":e.join(" ")}function Kp(t){const e=[],r=t.getPoints();for(let i=0,s=r.length;i<s;++i)e.push("("+kh(r[i])+")");return e.join(",")}function Qp(t){const e=[],r=t.getGeometries();for(let i=0,s=r.length;i<s;++i)e.push(jh(r[i]));return e.join(",")}function Oa(t){const e=t.getCoordinates(),r=[];for(let i=0,s=e.length;i<s;++i)r.push(e[i].join(" "));return r.join(",")}function Jp(t){const e=[],r=t.getLineStrings();for(let i=0,s=r.length;i<s;++i)e.push("("+Oa(r[i])+")");return e.join(",")}function $h(t){const e=[],r=t.getLinearRings();for(let i=0,s=r.length;i<s;++i)e.push("("+Oa(r[i])+")");return e.join(",")}function em(t){const e=[],r=t.getPolygons();for(let i=0,s=r.length;i<s;++i)e.push("("+$h(r[i])+")");return e.join(",")}function tm(t){const e=t.getLayout();let r="";return(e==="XYZ"||e==="XYZM")&&(r+=Bh),(e==="XYM"||e==="XYZM")&&(r+=zh),r}const rm={Point:kh,LineString:Oa,Polygon:$h,MultiPoint:Kp,MultiLineString:Jp,MultiPolygon:em,GeometryCollection:Qp};function jh(t){const e=t.getType(),r=rm[e],i=r(t);let s=Xp[e];if(typeof t.getFlatCoordinates=="function"){const n=tm(t);n.length>0&&(s+=" "+n)}return i.length===0?s+" "+Uh:s+"("+i+")"}const im=Yp,qe=[null,"http://www.opengis.net/wms"],sm=Z(qe,{Service:P(Mm),Capability:P(Sm)}),nm=Z(qe,{Request:P(Cm),Exception:P(Am),Layer:P(Im)});class am extends ba{constructor(){super(),this.version=void 0}readFromNode(e){this.version=e.getAttribute("version").trim();const r=$({version:this.version},sm,e,[]);return r||null}}const om=Z(qe,{Name:P(B),Title:P(B),Abstract:P(B),KeywordList:P(Xh),OnlineResource:P(ti),ContactInformation:P(bm),Fees:P(B),AccessConstraints:P(B),LayerLimit:P(Ne),MaxWidth:P(Ne),MaxHeight:P(Ne)}),lm=Z(qe,{ContactPersonPrimary:P(Rm),ContactPosition:P(B),ContactAddress:P(Pm),ContactVoiceTelephone:P(B),ContactFacsimileTelephone:P(B),ContactElectronicMailAddress:P(B)}),hm=Z(qe,{ContactPerson:P(B),ContactOrganization:P(B)}),um=Z(qe,{AddressType:P(B),Address:P(B),City:P(B),StateOrProvince:P(B),PostCode:P(B),Country:P(B)}),cm=Z(qe,{Format:Y(B)}),qh=Z(qe,{Name:P(B),Title:P(B),Abstract:P(B),KeywordList:P(Xh),CRS:be(B),EX_GeographicBoundingBox:P(Tm),BoundingBox:be(wm),Dimension:be(Lm),Attribution:P(Em),AuthorityURL:be(Fm),Identifier:be(B),MetadataURL:be(Dm),DataURL:be(Wt),FeatureListURL:be(Wt),Style:be(Gm),MinScaleDenominator:P(Xe),MaxScaleDenominator:P(Xe),Layer:be(Zh)}),fm=Z(qe,{Title:P(B),OnlineResource:P(ti),LogoURL:P(Wh)}),dm=Z(qe,{westBoundLongitude:P(Xe),eastBoundLongitude:P(Xe),southBoundLatitude:P(Xe),northBoundLatitude:P(Xe)}),gm=Z(qe,{GetCapabilities:P(ln),GetMap:P(ln),GetFeatureInfo:P(ln)}),pm=Z(qe,{Format:be(B),DCPType:be(Om)}),mm=Z(qe,{HTTP:P(Nm)}),_m=Z(qe,{Get:P(Wt),Post:P(Wt)}),ym=Z(qe,{Name:P(B),Title:P(B),Abstract:P(B),LegendURL:be(Wh),StyleSheetURL:P(Wt),StyleURL:P(Wt)}),xm=Z(qe,{Format:P(B),OnlineResource:P(ti)}),vm=Z(qe,{Keyword:Y(B)});function Em(t,e){return $({},fm,t,e)}function wm(t,e){const r=[Yt(t.getAttribute("minx")),Yt(t.getAttribute("miny")),Yt(t.getAttribute("maxx")),Yt(t.getAttribute("maxy"))],i=[Yt(t.getAttribute("resx")),Yt(t.getAttribute("resy"))];return{crs:t.getAttribute("CRS"),extent:r,res:i}}function Tm(t,e){const r=$({},dm,t,e);if(!r)return;const i=r.westBoundLongitude,s=r.southBoundLatitude,n=r.eastBoundLongitude,a=r.northBoundLatitude;if(!(i===void 0||s===void 0||n===void 0||a===void 0))return[i,s,n,a]}function Sm(t,e){return $({},nm,t,e)}function Mm(t,e){return $({},om,t,e)}function bm(t,e){return $({},lm,t,e)}function Rm(t,e){return $({},hm,t,e)}function Pm(t,e){return $({},um,t,e)}function Am(t,e){return $([],cm,t,e)}function Im(t,e){const r=$({},qh,t,e);return r.Layer===void 0?Object.assign(r,Zh(t,e)):r}function Zh(t,e){const r=e[e.length-1],i=$({},qh,t,e);if(!i)return;let s=zr(t.getAttribute("queryable"));s===void 0&&(s=r.queryable),i.queryable=s!==void 0?s:!1;let n=Kt(t.getAttribute("cascaded"));n===void 0&&(n=r.cascaded),i.cascaded=n;let a=zr(t.getAttribute("opaque"));a===void 0&&(a=r.opaque),i.opaque=a!==void 0?a:!1;let o=zr(t.getAttribute("noSubsets"));o===void 0&&(o=r.noSubsets),i.noSubsets=o!==void 0?o:!1;let l=Yt(t.getAttribute("fixedWidth"));l||(l=r.fixedWidth),i.fixedWidth=l;let h=Yt(t.getAttribute("fixedHeight"));return h||(h=r.fixedHeight),i.fixedHeight=h,["Style","CRS","AuthorityURL"].forEach(function(d){if(d in r){const p=i[d]||[];i[d]=p.concat(r[d])}}),["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"].forEach(function(d){if(!(d in i)){const p=r[d];i[d]=p}}),i}function Lm(t,e){return{name:t.getAttribute("name"),units:t.getAttribute("units"),unitSymbol:t.getAttribute("unitSymbol"),default:t.getAttribute("default"),multipleValues:zr(t.getAttribute("multipleValues")),nearestValue:zr(t.getAttribute("nearestValue")),current:zr(t.getAttribute("current")),values:B(t)}}function Wt(t,e){return $({},xm,t,e)}function Cm(t,e){return $({},gm,t,e)}function Om(t,e){return $({},mm,t,e)}function Nm(t,e){return $({},_m,t,e)}function ln(t,e){return $({},pm,t,e)}function Wh(t,e){const r=Wt(t,e);if(r){const i=[Kt(t.getAttribute("width")),Kt(t.getAttribute("height"))];return r.size=i,r}}function Fm(t,e){const r=Wt(t,e);if(r)return r.name=t.getAttribute("name"),r}function Dm(t,e){const r=Wt(t,e);if(r)return r.type=t.getAttribute("type"),r}function Gm(t,e){return $({},ym,t,e)}function Xh(t,e){return $([],vm,t,e)}const Um=am,Bm="_feature",zm="_layer";class km extends Ds{constructor(e){super(),e=e||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new ei,this.layers_=e.layers?e.layers:null}getLayers(){return this.layers_}setLayers(e){this.layers_=e}readFeatures_(e,r){e.setAttribute("namespaceURI",this.featureNS_);const i=e.localName;let s=[];if(e.childNodes.length===0)return s;if(i=="msGMLOutput")for(let n=0,a=e.childNodes.length;n<a;n++){const o=e.childNodes[n];if(o.nodeType!==Node.ELEMENT_NODE)continue;const l=o,h=r[0],c=zm,u=l.localName.replace(c,"");if(this.layers_&&!this.layers_.includes(u))continue;const d=u+Bm;h.featureType=d,h.featureNS=this.featureNS_;const p={};p[d]=Y(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const g=Z([h.featureNS,null],p);l.setAttribute("namespaceURI",this.featureNS_);const _=$([],g,l,r,this.gmlFormat_);_&&ds(s,_)}if(i=="FeatureCollection"){const n=$([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_);n&&(s=n)}return s}readFeaturesFromNode(e,r){const i={};return r&&Object.assign(i,this.getReadOptions(e,r)),this.readFeatures_(e,[i])}}const $m=km,Bt=[null,"http://www.opengis.net/wmts/1.0"],ii=[null,"http://www.opengis.net/ows/1.1"],jm=Z(Bt,{Contents:P(t0)});class qm extends ba{constructor(){super(),this.owsParser_=new Oh}readFromNode(e){let r=e.getAttribute("version");r&&(r=r.trim());let i=this.owsParser_.readFromNode(e);return i?(i.version=r,i=$(i,jm,e,[]),i||null):null}}const Zm=Z(Bt,{Layer:be(r0),TileMatrixSet:be(i0)}),Wm=Z(Bt,{Style:be(s0),Format:be(B),TileMatrixSetLink:be(n0),Dimension:be(a0),ResourceURL:be(o0)},Z(ii,{Title:P(B),Abstract:P(B),WGS84BoundingBox:P(Hh),Identifier:P(B)})),Xm=Z(Bt,{LegendURL:be(l0)},Z(ii,{Title:P(B),Identifier:P(B)})),Hm=Z(Bt,{TileMatrixSet:P(B),TileMatrixSetLimits:P(u0)}),Vm=Z(Bt,{TileMatrixLimits:Y(c0)}),Ym=Z(Bt,{TileMatrix:P(B),MinTileRow:P(Ne),MaxTileRow:P(Ne),MinTileCol:P(Ne),MaxTileCol:P(Ne)}),Km=Z(Bt,{Default:P(B),Value:be(B)},Z(ii,{Identifier:P(B)})),Qm=Z(ii,{LowerCorner:Y(Un),UpperCorner:Y(Un)}),Jm=Z(Bt,{WellKnownScaleSet:P(B),TileMatrix:be(h0)},Z(ii,{SupportedCRS:P(B),Identifier:P(B),BoundingBox:P(Hh)})),e0=Z(Bt,{TopLeftCorner:P(Un),ScaleDenominator:P(Xe),TileWidth:P(Ne),TileHeight:P(Ne),MatrixWidth:P(Ne),MatrixHeight:P(Ne)},Z(ii,{Identifier:P(B)}));function t0(t,e){return $({},Zm,t,e)}function r0(t,e){return $({},Wm,t,e)}function i0(t,e){return $({},Jm,t,e)}function s0(t,e){const r=$({},Xm,t,e);if(!r)return;const i=t.getAttribute("isDefault")==="true";return r.isDefault=i,r}function n0(t,e){return $({},Hm,t,e)}function a0(t,e){return $({},Km,t,e)}function o0(t,e){const r=t.getAttribute("format"),i=t.getAttribute("template"),s=t.getAttribute("resourceType"),n={};return r&&(n.format=r),i&&(n.template=i),s&&(n.resourceType=s),n}function Hh(t,e){const r=$([],Qm,t,e);if(r.length==2)return oh(r)}function l0(t,e){const r={};return r.format=t.getAttribute("format"),r.href=ti(t),r}function Un(t,e){const r=B(t).split(/\s+/);if(!r||r.length!=2)return;const i=+r[0],s=+r[1];if(!(isNaN(i)||isNaN(s)))return[i,s]}function h0(t,e){return $({},e0,t,e)}function u0(t,e){return $([],Vm,t,e)}function c0(t,e){return $({},Ym,t,e)}const Vh=qm,f0=Object.freeze(Object.defineProperty({__proto__:null,EsriJSON:Cd,GML:Ud,GPX:_g,GeoJSON:lh,IGC:Sg,IIIFInfo:Lg,KML:hf,MVT:hh,OWS:Oh,Polyline:xp,TopoJSON:uf,WFS:Bp,WKB:qp,WKT:im,WMSCapabilities:Um,WMSGetFeatureInfo:$m,WMTSCapabilities:Vh},Symbol.toStringTag,{value:"Module"}));function d0(t){if(!(t.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const e=t.inversePixelTransform[0],r=t.inversePixelTransform[1],i=Math.sqrt(e*e+r*r),s=t.frameState,n=uh(t.inversePixelTransform.slice(),s.coordinateToPixelTransform),a=cf(s.viewState.resolution,i);let o;return new ff(t.context,i,s.extent,n,s.viewState.rotation,a,o)}function Yh(t,e,r){const i=[];let s=t(0),n=t(1),a=e(s),o=e(n);const l=[n,s],h=[o,a],c=[1,0],u={};let d=1e5,p,g,_,y,v,E;for(;--d>0&&c.length>0;)_=c.pop(),s=l.pop(),a=h.pop(),E=_.toString(),E in u||(i.push(a[0],a[1]),u[E]=!0),y=c.pop(),n=l.pop(),o=h.pop(),v=(_+y)/2,p=t(v),g=e(p),df(g[0],g[1],a[0],a[1],o[0],o[1])<r?(i.push(o[0],o[1]),E=y.toString(),u[E]=!0):(c.push(y,v,v,_),h.push(o,g,g,a),l.push(n,p,p,s));return i}function g0(t,e,r,i,s){const n=de("EPSG:4326");return Yh(function(a){return[t,e+(r-e)*a]},ps(n,i),s)}function p0(t,e,r,i,s){const n=de("EPSG:4326");return Yh(function(a){return[e+(r-e)*a,t]},ps(n,i),s)}const m0=new Mi({color:"rgba(0,0,0,0.2)"}),_0=[90,45,30,20,10,5,2,1,30/60,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600];class y0 extends oa{constructor(e){e=e||{};const r=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},e);delete r.maxLines,delete r.strokeStyle,delete r.targetSize,delete r.showLabels,delete r.lonLabelFormatter,delete r.latLabelFormatter,delete r.lonLabelPosition,delete r.latLabelPosition,delete r.lonLabelStyle,delete r.latLabelStyle,delete r.intervals,super(r),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=e.targetSize!==void 0?e.targetSize:100,this.maxLines_=e.maxLines!==void 0?e.maxLines:100,this.meridians_=[],this.parallels_=[],this.strokeStyle_=e.strokeStyle!==void 0?e.strokeStyle:m0,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,e.showLabels&&(this.lonLabelFormatter_=e.lonLabelFormatter==null?bo.bind(this,"EW"):e.lonLabelFormatter,this.latLabelFormatter_=e.latLabelFormatter==null?bo.bind(this,"NS"):e.latLabelFormatter,this.lonLabelPosition_=e.lonLabelPosition==null?0:e.lonLabelPosition,this.latLabelPosition_=e.latLabelPosition==null?1:e.latLabelPosition,this.lonLabelStyleBase_=new vi({text:e.lonLabelStyle!==void 0?e.lonLabelStyle.clone():new Ro({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new Ln({color:"rgba(0,0,0,1)"}),stroke:new Mi({color:"rgba(255,255,255,1)",width:3})})}),this.lonLabelStyle_=i=>{const s=i.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(s),this.lonLabelStyleBase_},this.latLabelStyleBase_=new vi({text:e.latLabelStyle!==void 0?e.latLabelStyle.clone():new Ro({font:"12px Calibri,sans-serif",textAlign:"right",fill:new Ln({color:"rgba(0,0,0,1)"}),stroke:new Mi({color:"rgba(255,255,255,1)",width:3})})}),this.latLabelStyle_=i=>{const s=i.get("graticule_label");return this.latLabelStyleBase_.getText().setText(s),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(cr.POSTRENDER,this.drawLabels_.bind(this))),this.intervals_=e.intervals!==void 0?e.intervals:_0,this.setSource(new Gs({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new gf,overlaps:!1,useSpatialIndex:!1,wrapX:e.wrapX})),this.featurePool_=[],this.lineStyle_=new vi({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(e,r){let i=e.slice();return this.projection_&&this.getSource().getWrapX()&&pf(i,this.projection_),this.loadedExtent_&&(mf(this.loadedExtent_,i,r)?i=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[i]}loaderFunction(e,r,i){this.loadedExtent_=e;const s=this.getSource(),n=this.getExtent()||[-1/0,-1/0,1/0,1/0],a=Ct(n,e);if(this.renderedExtent_&&ms(this.renderedExtent_,a)&&this.renderedResolution_===r||(this.renderedExtent_=a,this.renderedResolution_=r,la(a)))return;const o=Jt(a),l=r*r/4;(!this.projection_||!ci(this.projection_,i))&&this.updateProjectionInfo_(i),this.createGraticule_(a,o,r,l);let c=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(c+=this.meridians_.length),this.parallelsLabels_&&(c+=this.parallels_.length);let u;for(;c>this.featurePool_.length;)u=new ct,this.featurePool_.push(u);const d=s.getFeaturesCollection();d.clear();let p=0,g,_;for(g=0,_=this.meridians_.length;g<_;++g)u=this.featurePool_[p++],u.setGeometry(this.meridians_[g]),u.setStyle(this.lineStyle_),d.push(u);for(g=0,_=this.parallels_.length;g<_;++g)u=this.featurePool_[p++],u.setGeometry(this.parallels_[g]),u.setStyle(this.lineStyle_),d.push(u)}addMeridian_(e,r,i,s,n,a){const o=this.getMeridian_(e,r,i,s,a);if(qr(o.getExtent(),n)){if(this.meridiansLabels_){const l=this.lonLabelFormatter_(e);a in this.meridiansLabels_?this.meridiansLabels_[a].text=l:this.meridiansLabels_[a]={geom:new Et([]),text:l}}this.meridians_[a++]=o}return a}addParallel_(e,r,i,s,n,a){const o=this.getParallel_(e,r,i,s,a);if(qr(o.getExtent(),n)){if(this.parallelsLabels_){const l=this.latLabelFormatter_(e);a in this.parallelsLabels_?this.parallelsLabels_[a].text=l:this.parallelsLabels_[a]={geom:new Et([]),text:l}}this.parallels_[a++]=o}return a}drawLabels_(e){const r=e.frameState.viewState.rotation,i=e.frameState.viewState.resolution,s=e.frameState.size,n=e.frameState.extent,a=Jt(n);let o=n;if(r){const g=s[0]*i,_=s[1]*i;o=[a[0]-g/2,a[1]-_/2,a[0]+g/2,a[1]+_/2]}let l=0,h=0,c=this.latLabelPosition_<.5;const u=this.projection_.getExtent(),d=ht(u);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!cs(u,n)){l=Math.floor((n[0]-u[0])/d),h=Math.ceil((n[2]-u[2])/d);const g=Math.abs(r)>Math.PI/2;c=c!==g}const p=d0(e);for(let g=l;g<=h;++g){let _=this.meridians_.length+this.parallels_.length,y,v,E,T;if(this.meridiansLabels_)for(v=0,E=this.meridiansLabels_.length;v<E;++v){const w=this.meridians_[v];if(!r&&g===0)T=this.getMeridianPoint_(w,n,v);else{const b=w.clone();b.translate(g*d,0),b.rotate(-r,a),T=this.getMeridianPoint_(b,o,v),T.rotate(r,a)}y=this.featurePool_[_++],y.setGeometry(T),y.set("graticule_label",this.meridiansLabels_[v].text),p.drawFeature(y,this.lonLabelStyle_(y))}if(this.parallelsLabels_&&(g===l&&c||g===h&&!c))for(v=0,E=this.parallels_.length;v<E;++v){const w=this.parallels_[v];if(!r&&g===0)T=this.getParallelPoint_(w,n,v);else{const b=w.clone();b.translate(g*d,0),b.rotate(-r,a),T=this.getParallelPoint_(b,o,v),T.rotate(r,a)}y=this.featurePool_[_++],y.setGeometry(T),y.set("graticule_label",this.parallelsLabels_[v].text),p.drawFeature(y,this.latLabelStyle_(y))}}}createGraticule_(e,r,i,s){const n=this.getInterval_(i);if(n==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}let a=!1;const o=this.projection_.getExtent(),l=ht(o);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!cs(o,e)&&(ht(e)>=l?(e[0]=o[0],e[2]=o[2]):a=!0);const h=[Pe(r[0],this.minX_,this.maxX_),Pe(r[1],this.minY_,this.maxY_)],c=this.toLonLatTransform_(h);isNaN(c[1])&&(c[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let u=Pe(c[0],this.minLon_,this.maxLon_),d=Pe(c[1],this.minLat_,this.maxLat_);const p=this.maxLines_;let g,_,y,v,E=e;a||(E=[Pe(e[0],this.minX_,this.maxX_),Pe(e[1],this.minY_,this.maxY_),Pe(e[2],this.minX_,this.maxX_),Pe(e[3],this.minY_,this.maxY_)]);const T=bi(E,this.toLonLatTransform_,void 0,8);let w=T[3],b=T[2],A=T[1],I=T[0];if(a||(Cr(E,this.bottomLeft_)&&(I=this.minLon_,A=this.minLat_),Cr(E,this.bottomRight_)&&(b=this.maxLon_,A=this.minLat_),Cr(E,this.topLeft_)&&(I=this.minLon_,w=this.maxLat_),Cr(E,this.topRight_)&&(b=this.maxLon_,w=this.maxLat_),w=Pe(w,d,this.maxLat_),b=Pe(b,u,this.maxLon_),A=Pe(A,this.minLat_,d),I=Pe(I,this.minLon_,u)),u=Math.floor(u/n)*n,v=Pe(u,this.minLon_,this.maxLon_),_=this.addMeridian_(v,A,w,s,e,0),g=0,a)for(;(v-=n)>=I&&g++<p;)_=this.addMeridian_(v,A,w,s,e,_);else for(;v!=this.minLon_&&g++<p;)v=Math.max(v-n,this.minLon_),_=this.addMeridian_(v,A,w,s,e,_);if(v=Pe(u,this.minLon_,this.maxLon_),g=0,a)for(;(v+=n)<=b&&g++<p;)_=this.addMeridian_(v,A,w,s,e,_);else for(;v!=this.maxLon_&&g++<p;)v=Math.min(v+n,this.maxLon_),_=this.addMeridian_(v,A,w,s,e,_);for(this.meridians_.length=_,this.meridiansLabels_&&(this.meridiansLabels_.length=_),d=Math.floor(d/n)*n,y=Pe(d,this.minLat_,this.maxLat_),_=this.addParallel_(y,I,b,s,e,0),g=0;y!=this.minLat_&&g++<p;)y=Math.max(y-n,this.minLat_),_=this.addParallel_(y,I,b,s,e,_);for(y=Pe(d,this.minLat_,this.maxLat_),g=0;y!=this.maxLat_&&g++<p;)y=Math.min(y+n,this.maxLat_),_=this.addParallel_(y,I,b,s,e,_);this.parallels_.length=_,this.parallelsLabels_&&(this.parallelsLabels_.length=_)}getInterval_(e){const r=this.projectionCenterLonLat_[0],i=this.projectionCenterLonLat_[1];let s=-1;const n=Math.pow(this.targetSize_*e,2),a=[],o=[];for(let l=0,h=this.intervals_.length;l<h;++l){const c=Pe(this.intervals_[l]/2,0,90),u=Pe(i,-90+c,90-c);if(a[0]=r-c,a[1]=u-c,o[0]=r+c,o[1]=u+c,this.fromLonLatTransform_(a,a),this.fromLonLatTransform_(o,o),Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2)<=n)break;s=this.intervals_[l]}return s}getMeridian_(e,r,i,s,n){const a=g0(e,r,i,this.projection_,s);let o=this.meridians_[n];return o?(o.setFlatCoordinates("XY",a),o.changed()):(o=new Dt(a,"XY"),this.meridians_[n]=o),o}getMeridianPoint_(e,r,i){const s=e.getFlatCoordinates();let n=1,a=s.length-1;s[n]>s[a]&&(n=a,a=1);const o=Math.max(r[1],s[n]),l=Math.min(r[3],s[a]),h=Pe(r[1]+Math.abs(r[1]-r[3])*this.lonLabelPosition_,o,l),u=[s[n-1]+(s[a-1]-s[n-1])*(h-s[n])/(s[a]-s[n]),h],d=this.meridiansLabels_[i].geom;return d.setCoordinates(u),d}getMeridians(){return this.meridians_}getParallel_(e,r,i,s,n){const a=p0(e,r,i,this.projection_,s);let o=this.parallels_[n];return o?(o.setFlatCoordinates("XY",a),o.changed()):o=new Dt(a,"XY"),o}getParallelPoint_(e,r,i){const s=e.getFlatCoordinates();let n=0,a=s.length-2;s[n]>s[a]&&(n=a,a=0);const o=Math.max(r[0],s[n]),l=Math.min(r[2],s[a]),h=Pe(r[0]+Math.abs(r[0]-r[2])*this.latLabelPosition_,o,l),c=s[n+1]+(s[a+1]-s[n+1])*(h-s[n])/(s[a]-s[n]),u=[h,c],d=this.parallelsLabels_[i].geom;return d.setCoordinates(u),d}getParallels(){return this.parallels_}updateProjectionInfo_(e){const r=de("EPSG:4326"),i=e.getWorldExtent();this.maxLat_=i[3],this.maxLon_=i[2],this.minLat_=i[1],this.minLon_=i[0];const s=ps(e,r);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=s;else{const a=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(o,l,h){h=h||2;const c=s(o,l,h);for(let u=0,d=c.length;u<d;u+=h)c[u]<a&&(c[u]+=360);return c}}this.fromLonLatTransform_=ps(r,e);const n=bi([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=n[0],this.maxX_=n[2],this.minY_=n[1],this.maxY_=n[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(Jt(e.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=e}}const x0=y0,Xs=34962,Hs=34963,v0=35040,Na=35044,Bn=35048,E0=5121,w0=5123,T0=5125,Kh=5126,ol=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function S0(t,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!_f},e);const r=ol.length;for(let i=0;i<r;++i)try{const s=t.getContext(ol[i],e);if(s)return s}catch{}return null}const M0={STATIC_DRAW:Na,STREAM_DRAW:v0,DYNAMIC_DRAW:Bn};class b0{constructor(e,r){this.array_=null,this.type_=e,Gt(e===Xs||e===Hs,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=r!==void 0?r:M0.STATIC_DRAW}ofSize(e){return this.array_=new(hn(this.type_))(e),this}fromArray(e){return this.array_=hn(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(hn(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function hn(t){switch(t){case Xs:return Float32Array;case Hs:return Uint32Array;default:return Float32Array}}const Ts=b0,Ji={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},R0=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,P0=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class A0{constructor(e){this.gl_=e.webGlContext;const r=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=r.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=r.createFramebuffer(),this.depthBuffer_=r.createRenderbuffer();const i=r.createShader(r.VERTEX_SHADER);r.shaderSource(i,e.vertexShader||R0),r.compileShader(i);const s=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(s,e.fragmentShader||P0),r.compileShader(s),this.renderTargetProgram_=r.createProgram(),r.attachShader(this.renderTargetProgram_,i),r.attachShader(this.renderTargetProgram_,s),r.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=r.createBuffer();const n=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];r.bindBuffer(r.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),r.bufferData(r.ARRAY_BUFFER,new Float32Array(n),r.STATIC_DRAW),this.renderTargetAttribLocation_=r.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=r.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=r.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=r.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(a=>{this.uniforms_.push({value:e.uniforms[a],location:r.getUniformLocation(this.renderTargetProgram_,a)})})}getGL(){return this.gl_}init(e){const r=this.getGL(),i=[r.drawingBufferWidth*this.scaleRatio_,r.drawingBufferHeight*this.scaleRatio_];if(r.bindFramebuffer(r.FRAMEBUFFER,this.getFrameBuffer()),r.bindRenderbuffer(r.RENDERBUFFER,this.getDepthBuffer()),r.viewport(0,0,i[0],i[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==i[0]||this.renderTargetTextureSize_[1]!==i[1]){this.renderTargetTextureSize_=i;const s=0,n=r.RGBA,a=0,o=r.RGBA,l=r.UNSIGNED_BYTE,h=null;r.bindTexture(r.TEXTURE_2D,this.renderTargetTexture_),r.texImage2D(r.TEXTURE_2D,s,n,i[0],i[1],a,o,l,h),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.renderTargetTexture_,0),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,i[0],i[1]),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,this.depthBuffer_)}}apply(e,r,i,s){const n=this.getGL(),a=e.size;if(n.bindFramebuffer(n.FRAMEBUFFER,r?r.getFrameBuffer():null),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.renderTargetTexture_),!r){const l=Fe(n.canvas);if(!e.renderTargets[l]){const h=n.getContextAttributes();h&&h.preserveDrawingBuffer&&(n.clearColor(0,0,0,0),n.clearDepth(1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT)),e.renderTargets[l]=!0}}n.disable(n.DEPTH_TEST),n.enable(n.BLEND),n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),n.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),n.bindBuffer(n.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),n.useProgram(this.renderTargetProgram_),n.enableVertexAttribArray(this.renderTargetAttribLocation_),n.vertexAttribPointer(this.renderTargetAttribLocation_,2,n.FLOAT,!1,0,0),n.uniform2f(this.renderTargetUniformLocation_,a[0],a[1]),n.uniform1i(this.renderTargetTextureLocation_,0);const o=e.layerStatesArray[e.layerIndex].opacity;n.uniform1f(this.renderTargetOpacityLocation_,o),this.applyUniforms(e),i&&i(n,e),n.drawArrays(n.TRIANGLES,0,6),s&&s(n,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const r=this.getGL();let i,s=1;this.uniforms_.forEach(function(n){if(i=typeof n.value=="function"?n.value(e):n.value,i instanceof HTMLCanvasElement||i instanceof ImageData)n.texture||(n.texture=r.createTexture()),r.activeTexture(r[`TEXTURE${s}`]),r.bindTexture(r.TEXTURE_2D,n.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),i instanceof ImageData?r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,i.width,i.height,0,r.UNSIGNED_BYTE,new Uint8Array(i.data)):r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,i),r.uniform1i(n.location,s++);else if(Array.isArray(i))switch(i.length){case 2:r.uniform2f(n.location,i[0],i[1]);return;case 3:r.uniform3f(n.location,i[0],i[1],i[2]);return;case 4:r.uniform4f(n.location,i[0],i[1],i[2],i[3]);return;default:return}else typeof i=="number"&&r.uniform1f(n.location,i)})}}const ll=A0;function Qh(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Jh(t,e){return t[0]=e[0],t[1]=e[1],t[4]=e[2],t[5]=e[3],t[12]=e[4],t[13]=e[5],t}const kt={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},At={UNSIGNED_BYTE:E0,UNSIGNED_SHORT:w0,UNSIGNED_INT:T0,FLOAT:Kh},Ss={};function hl(t){return"shared/"+t}let ul=0;function I0(){const t="unique/"+ul;return ul+=1,t}function L0(t){let e=Ss[t];if(!e){const r=document.createElement("canvas");r.width=1,r.height=1,r.style.position="absolute",r.style.left="0",e={users:0,context:S0(r)},Ss[t]=e}return e.users+=1,e.context}function C0(t){const e=Ss[t];if(!e||(e.users-=1,e.users>0))return;const r=e.context,i=r.getExtension("WEBGL_lose_context");i&&i.loseContext();const s=r.canvas;s.width=1,s.height=1,delete Ss[t]}class O0 extends ch{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?hl(e.canvasCacheKey):I0(),this.gl_=L0(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const r=this.gl_.canvas;r.addEventListener(Ji.LOST,this.boundHandleWebGLContextLost_),r.addEventListener(Ji.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=wt(),this.offsetScaleMatrix_=wt(),this.tmpMat4_=Qh(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(i=>new ll({webGlContext:this.gl_,scaleRatio:i.scaleRatio,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,uniforms:i.uniforms})):[new ll({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const r in e)this.uniforms_.push({name:r,value:e[r]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===hl(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const r=this.gl_.getExtension(e);return this.extensionCache_[e]=r,r}bindBuffer(e){const r=this.gl_,i=Fe(e);let s=this.bufferCache_[i];if(!s){const n=r.createBuffer();s={buffer:e,webGlBuffer:n},this.bufferCache_[i]=s}r.bindBuffer(e.getType(),s.webGlBuffer)}flushBufferData(e){const r=this.gl_;this.bindBuffer(e),r.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const r=this.gl_,i=Fe(e),s=this.bufferCache_[i];s&&!r.isContextLost()&&r.deleteBuffer(s.webGlBuffer),delete this.bufferCache_[i]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(Ji.LOST,this.boundHandleWebGLContextLost_),e.removeEventListener(Ji.RESTORED,this.boundHandleWebGLContextRestored_),C0(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,r,i){const s=this.gl_,n=this.getCanvas(),a=e.size,o=e.pixelRatio;(n.width!==a[0]*o||n.height!==a[1]*o)&&(n.width=a[0]*o,n.height=a[1]*o,n.style.width=a[0]+"px",n.style.height=a[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(e);s.bindTexture(s.TEXTURE_2D,null),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,r?s.ZERO:s.ONE_MINUS_SRC_ALPHA),i?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}bindTexture(e,r,i){const s=this.gl_;s.activeTexture(s.TEXTURE0+r),s.bindTexture(s.TEXTURE_2D,e),s.uniform1i(this.getUniformLocation(i),r)}prepareDrawToRenderTarget(e,r,i,s){const n=this.gl_,a=r.getSize();n.bindFramebuffer(n.FRAMEBUFFER,r.getFramebuffer()),n.bindRenderbuffer(n.RENDERBUFFER,r.getDepthbuffer()),n.viewport(0,0,a[0],a[1]),n.bindTexture(n.TEXTURE_2D,r.getTexture()),n.clearColor(0,0,0,0),n.depthRange(0,1),n.clearDepth(1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,i?n.ZERO:n.ONE_MINUS_SRC_ALPHA),s?(n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL)):n.disable(n.DEPTH_TEST)}drawElements(e,r){const i=this.gl_;this.getExtension("OES_element_index_uint");const s=i.UNSIGNED_INT,n=4,a=r-e,o=e*n;i.drawElements(i.TRIANGLES,a,s,o)}finalizeDraw(e,r,i){for(let s=0,n=this.postProcessPasses_.length;s<n;s++)s===n-1?this.postProcessPasses_[s].apply(e,null,r,i):this.postProcessPasses_[s].apply(e,this.postProcessPasses_[s+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const r=e.size,i=e.viewState.rotation,s=e.pixelRatio;this.setUniformFloatValue(kt.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(kt.ZOOM,e.viewState.zoom),this.setUniformFloatValue(kt.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(kt.PIXEL_RATIO,s),this.setUniformFloatVec2(kt.VIEWPORT_SIZE_PX,[r[0],r[1]]),this.setUniformFloatValue(kt.ROTATION,i)}applyHitDetectionUniform(e){const r=this.getUniformLocation(kt.HIT_DETECTION);this.getGL().uniform1i(r,e?1:0),e&&this.setUniformFloatValue(kt.PIXEL_RATIO,.5)}applyUniforms(e){const r=this.gl_;let i,s=0;this.uniforms_.forEach(n=>{if(i=typeof n.value=="function"?n.value(e):n.value,i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof ImageData)n.texture||(n.prevValue=void 0,n.texture=r.createTexture()),this.bindTexture(n.texture,s,n.name),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),(!(i instanceof HTMLImageElement)||i.complete)&&n.prevValue!==i&&(n.prevValue=i,r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,i)),s++;else if(Array.isArray(i)&&i.length===6)this.setUniformMatrixValue(n.name,Jh(this.tmpMat4_,i));else if(Array.isArray(i)&&i.length<=4)switch(i.length){case 2:r.uniform2f(this.getUniformLocation(n.name),i[0],i[1]);return;case 3:r.uniform3f(this.getUniformLocation(n.name),i[0],i[1],i[2]);return;case 4:r.uniform4f(this.getUniformLocation(n.name),i[0],i[1],i[2],i[3]);return;default:return}else typeof i=="number"&&r.uniform1f(this.getUniformLocation(n.name),i)})}useProgram(e,r){this.gl_.useProgram(e),this.currentProgram_=e,this.applyFrameState(r),this.applyUniforms(r)}compileShader(e,r){const i=this.gl_,s=i.createShader(r);return i.shaderSource(s,e),i.compileShader(s),s}getProgram(e,r){const i=this.gl_,s=this.compileShader(e,i.FRAGMENT_SHADER),n=this.compileShader(r,i.VERTEX_SHADER),a=i.createProgram();if(i.attachShader(a,s),i.attachShader(a,n),i.linkProgram(a),!i.getShaderParameter(s,i.COMPILE_STATUS)){const o=`Fragment shader compilation failed: ${i.getShaderInfoLog(s)}`;throw new Error(o)}if(i.deleteShader(s),!i.getShaderParameter(n,i.COMPILE_STATUS)){const o=`Vertex shader compilation failed: ${i.getShaderInfoLog(n)}`;throw new Error(o)}if(i.deleteShader(n),!i.getProgramParameter(a,i.LINK_STATUS)){const o=`GL program linking failed: ${i.getProgramInfoLog(a)}`;throw new Error(o)}return a}getUniformLocation(e){const r=Fe(this.currentProgram_);return this.uniformLocationsByProgram_[r]===void 0&&(this.uniformLocationsByProgram_[r]={}),this.uniformLocationsByProgram_[r][e]===void 0&&(this.uniformLocationsByProgram_[r][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[r][e]}getAttributeLocation(e){const r=Fe(this.currentProgram_);return this.attribLocationsByProgram_[r]===void 0&&(this.attribLocationsByProgram_[r]={}),this.attribLocationsByProgram_[r][e]===void 0&&(this.attribLocationsByProgram_[r][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[r][e]}makeProjectionTransform(e,r){const i=e.size,s=e.viewState.rotation,n=e.viewState.resolution,a=e.viewState.center;return ha(r,0,0,2/(n*i[0]),2/(n*i[1]),-s,-a[0],-a[1]),r}setUniformFloatValue(e,r){this.gl_.uniform1f(this.getUniformLocation(e),r)}setUniformFloatVec2(e,r){this.gl_.uniform2fv(this.getUniformLocation(e),r)}setUniformFloatVec4(e,r){this.gl_.uniform4fv(this.getUniformLocation(e),r)}setUniformMatrixValue(e,r){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,r)}enableAttributeArray_(e,r,i,s,n){const a=this.getAttributeLocation(e);a<0||(this.gl_.enableVertexAttribArray(a),this.gl_.vertexAttribPointer(a,r,i,!1,s,n))}enableAttributes(e){const r=N0(e);let i=0;for(let s=0;s<e.length;s++){const n=e[s];this.enableAttributeArray_(n.name,n.size,n.type||Kh,r,i),i+=n.size*eu(n.type)}}handleWebGLContextLost(e){yf(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,r,i){const s=this.gl_;i=i||s.createTexture();const n=0,a=s.RGBA,o=0,l=s.RGBA,h=s.UNSIGNED_BYTE;return s.bindTexture(s.TEXTURE_2D,i),r?s.texImage2D(s.TEXTURE_2D,n,a,l,h,r):s.texImage2D(s.TEXTURE_2D,n,a,e[0],e[1],o,l,h,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),i}}function N0(t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];e+=i.size*eu(i.type)}return e}function eu(t){switch(t){case At.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case At.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case At.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case At.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class Fa extends xf{constructor(e,r){super(e),r=r||{},this.inversePixelTransform_=wt(),this.pixelContext_=null,this.postProcesses_=r.postProcesses,this.uniforms_=r.uniforms,this.helper,e.addChangeListener(fh.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,r){const i=this.getLayer();if(i.hasListener(cr.PRECOMPOSE)){const s=new nn(cr.PRECOMPOSE,void 0,r,e);i.dispatchEvent(s)}}dispatchPostComposeEvent(e,r){const i=this.getLayer();if(i.hasListener(cr.POSTCOMPOSE)){const s=new nn(cr.POSTCOMPOSE,void 0,r,e);i.dispatchEvent(s)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let r=!0,i=-1,s;for(let a=0,o=e.layerStatesArray.length;a<o;a++){const l=e.layerStatesArray[a].layer,h=l.getRenderer();if(!(h instanceof Fa)){r=!0;continue}const c=l.getClassName();if((r||c!==s)&&(i+=1,r=!1),s=c,h===this)break}const n="map/"+e.mapId+"/group/"+i;(!this.helper||!this.helper.canvasCacheKeyMatches(n)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new O0({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:n}),s&&(this.helper.getCanvas().className=s),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(e,r,i){const s=this.getLayer();if(s.hasListener(e)){ha(this.inversePixelTransform_,0,0,i.pixelRatio,-i.pixelRatio,0,0,-i.size[1]);const n=new nn(e,this.inversePixelTransform_,i,r);s.dispatchEvent(n)}}preRender(e,r){this.dispatchRenderEvent_(cr.PRERENDER,e,r)}postRender(e,r){this.dispatchRenderEvent_(cr.POSTRENDER,e,r)}}const tu=Fa,St=new Uint8Array(4);class F0{constructor(e,r){this.helper_=e;const i=e.getGL();this.texture_=i.createTexture(),this.framebuffer_=i.createFramebuffer(),this.depthbuffer_=i.createRenderbuffer(),this.size_=r||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(e){vf(e,this.size_)||(this.size_[0]=e[0],this.size_[1]=e[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const e=this.size_,r=this.helper_.getGL();r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer_),r.readPixels(0,0,e[0],e[1],r.RGBA,r.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(e,r){if(e<0||r<0||e>this.size_[0]||r>=this.size_[1])return St[0]=0,St[1]=0,St[2]=0,St[3]=0,St;this.readAll();const i=Math.floor(e)+(this.size_[1]-Math.floor(r)-1)*this.size_[0];return St[0]=this.data_[i*4],St[1]=this.data_[i*4+1],St[2]=this.data_[i*4+2],St[3]=this.data_[i*4+3],St}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const e=this.size_,r=this.helper_.getGL();this.texture_=this.helper_.createTexture(e,null,this.texture_),r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer_),r.viewport(0,0,e[0],e[1]),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.texture_,0),r.bindRenderbuffer(r.RENDERBUFFER,this.depthbuffer_),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e[0],e[1]),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(e[0]*e[1]*4)}}const D0=F0,cl={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};var ru={exports:{}};ru.exports=Vs;ru.exports.default=Vs;function Vs(t,e,r){r=r||2;var i=e&&e.length,s=i?e[0]*r:t.length,n=iu(t,0,s,r,!0),a=[];if(!n||n.next===n.prev)return a;var o,l,h,c,u,d,p;if(i&&(n=k0(t,e,n,r)),t.length>80*r){o=h=t[0],l=c=t[1];for(var g=r;g<s;g+=r)u=t[g],d=t[g+1],u<o&&(o=u),d<l&&(l=d),u>h&&(h=u),d>c&&(c=d);p=Math.max(h-o,c-l),p=p!==0?32767/p:0}return Ai(n,a,r,o,l,p,0),a}function iu(t,e,r,i,s){var n,a;if(s===$n(t,e,r,i)>0)for(n=e;n<r;n+=i)a=fl(n,t[n],t[n+1],a);else for(n=r-i;n>=e;n-=i)a=fl(n,t[n],t[n+1],a);return a&&Ys(a,a.next)&&(Li(a),a=a.next),a}function _r(t,e){if(!t)return t;e||(e=t);var r=t,i;do if(i=!1,!r.steiner&&(Ys(r,r.next)||Ie(r.prev,r,r.next)===0)){if(Li(r),r=e=r.prev,r===r.next)break;i=!0}else r=r.next;while(i||r!==e);return e}function Ai(t,e,r,i,s,n,a){if(t){!a&&n&&W0(t,i,s,n);for(var o=t,l,h;t.prev!==t.next;){if(l=t.prev,h=t.next,n?U0(t,i,s,n):G0(t)){e.push(l.i/r|0),e.push(t.i/r|0),e.push(h.i/r|0),Li(t),t=h.next,o=h.next;continue}if(t=h,t===o){a?a===1?(t=B0(_r(t),e,r),Ai(t,e,r,i,s,n,2)):a===2&&z0(t,e,r,i,s,n):Ai(_r(t),e,r,i,s,n,1);break}}}}function G0(t){var e=t.prev,r=t,i=t.next;if(Ie(e,r,i)>=0)return!1;for(var s=e.x,n=r.x,a=i.x,o=e.y,l=r.y,h=i.y,c=s<n?s<a?s:a:n<a?n:a,u=o<l?o<h?o:h:l<h?l:h,d=s>n?s>a?s:a:n>a?n:a,p=o>l?o>h?o:h:l>h?l:h,g=i.next;g!==e;){if(g.x>=c&&g.x<=d&&g.y>=u&&g.y<=p&&Or(s,o,n,l,a,h,g.x,g.y)&&Ie(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function U0(t,e,r,i){var s=t.prev,n=t,a=t.next;if(Ie(s,n,a)>=0)return!1;for(var o=s.x,l=n.x,h=a.x,c=s.y,u=n.y,d=a.y,p=o<l?o<h?o:h:l<h?l:h,g=c<u?c<d?c:d:u<d?u:d,_=o>l?o>h?o:h:l>h?l:h,y=c>u?c>d?c:d:u>d?u:d,v=zn(p,g,e,r,i),E=zn(_,y,e,r,i),T=t.prevZ,w=t.nextZ;T&&T.z>=v&&w&&w.z<=E;){if(T.x>=p&&T.x<=_&&T.y>=g&&T.y<=y&&T!==s&&T!==a&&Or(o,c,l,u,h,d,T.x,T.y)&&Ie(T.prev,T,T.next)>=0||(T=T.prevZ,w.x>=p&&w.x<=_&&w.y>=g&&w.y<=y&&w!==s&&w!==a&&Or(o,c,l,u,h,d,w.x,w.y)&&Ie(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;T&&T.z>=v;){if(T.x>=p&&T.x<=_&&T.y>=g&&T.y<=y&&T!==s&&T!==a&&Or(o,c,l,u,h,d,T.x,T.y)&&Ie(T.prev,T,T.next)>=0)return!1;T=T.prevZ}for(;w&&w.z<=E;){if(w.x>=p&&w.x<=_&&w.y>=g&&w.y<=y&&w!==s&&w!==a&&Or(o,c,l,u,h,d,w.x,w.y)&&Ie(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function B0(t,e,r){var i=t;do{var s=i.prev,n=i.next.next;!Ys(s,n)&&su(s,i,i.next,n)&&Ii(s,n)&&Ii(n,s)&&(e.push(s.i/r|0),e.push(i.i/r|0),e.push(n.i/r|0),Li(i),Li(i.next),i=t=n),i=i.next}while(i!==t);return _r(i)}function z0(t,e,r,i,s,n){var a=t;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&V0(a,o)){var l=nu(a,o);a=_r(a,a.next),l=_r(l,l.next),Ai(a,e,r,i,s,n,0),Ai(l,e,r,i,s,n,0);return}o=o.next}a=a.next}while(a!==t)}function k0(t,e,r,i){var s=[],n,a,o,l,h;for(n=0,a=e.length;n<a;n++)o=e[n]*i,l=n<a-1?e[n+1]*i:t.length,h=iu(t,o,l,i,!1),h===h.next&&(h.steiner=!0),s.push(H0(h));for(s.sort($0),n=0;n<s.length;n++)r=j0(s[n],r);return r}function $0(t,e){return t.x-e.x}function j0(t,e){var r=q0(t,e);if(!r)return e;var i=nu(r,t);return _r(i,i.next),_r(r,r.next)}function q0(t,e){var r=e,i=t.x,s=t.y,n=-1/0,a;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var o=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=i&&o>n&&(n=o,a=r.x<r.next.x?r:r.next,o===i))return a}r=r.next}while(r!==e);if(!a)return null;var l=a,h=a.x,c=a.y,u=1/0,d;r=a;do i>=r.x&&r.x>=h&&i!==r.x&&Or(s<c?i:n,s,h,c,s<c?n:i,s,r.x,r.y)&&(d=Math.abs(s-r.y)/(i-r.x),Ii(r,t)&&(d<u||d===u&&(r.x>a.x||r.x===a.x&&Z0(a,r)))&&(a=r,u=d)),r=r.next;while(r!==l);return a}function Z0(t,e){return Ie(t.prev,t,e.prev)<0&&Ie(e.next,t,t.next)<0}function W0(t,e,r,i){var s=t;do s.z===0&&(s.z=zn(s.x,s.y,e,r,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,X0(s)}function X0(t){var e,r,i,s,n,a,o,l,h=1;do{for(r=t,t=null,n=null,a=0;r;){for(a++,i=r,o=0,e=0;e<h&&(o++,i=i.nextZ,!!i);e++);for(l=h;o>0||l>0&&i;)o!==0&&(l===0||!i||r.z<=i.z)?(s=r,r=r.nextZ,o--):(s=i,i=i.nextZ,l--),n?n.nextZ=s:t=s,s.prevZ=n,n=s;r=i}n.nextZ=null,h*=2}while(a>1);return t}function zn(t,e,r,i,s){return t=(t-r)*s|0,e=(e-i)*s|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function H0(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function Or(t,e,r,i,s,n,a,o){return(s-a)*(e-o)>=(t-a)*(n-o)&&(t-a)*(i-o)>=(r-a)*(e-o)&&(r-a)*(n-o)>=(s-a)*(i-o)}function V0(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Y0(t,e)&&(Ii(t,e)&&Ii(e,t)&&K0(t,e)&&(Ie(t.prev,t,e.prev)||Ie(t,e.prev,e))||Ys(t,e)&&Ie(t.prev,t,t.next)>0&&Ie(e.prev,e,e.next)>0)}function Ie(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Ys(t,e){return t.x===e.x&&t.y===e.y}function su(t,e,r,i){var s=ts(Ie(t,e,r)),n=ts(Ie(t,e,i)),a=ts(Ie(r,i,t)),o=ts(Ie(r,i,e));return!!(s!==n&&a!==o||s===0&&es(t,r,e)||n===0&&es(t,i,e)||a===0&&es(r,t,i)||o===0&&es(r,e,i))}function es(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function ts(t){return t>0?1:t<0?-1:0}function Y0(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&su(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function Ii(t,e){return Ie(t.prev,t,t.next)<0?Ie(t,e,t.next)>=0&&Ie(t,t.prev,e)>=0:Ie(t,e,t.prev)<0||Ie(t,t.next,e)<0}function K0(t,e){var r=t,i=!1,s=(t.x+e.x)/2,n=(t.y+e.y)/2;do r.y>n!=r.next.y>n&&r.next.y!==r.y&&s<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==t);return i}function nu(t,e){var r=new kn(t.i,t.x,t.y),i=new kn(e.i,e.x,e.y),s=t.next,n=e.prev;return t.next=e,e.prev=t,r.next=s,s.prev=r,i.next=r,r.prev=i,n.next=i,i.prev=n,i}function fl(t,e,r,i){var s=new kn(t,e,r);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function Li(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function kn(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Vs.deviation=function(t,e,r,i){var s=e&&e.length,n=s?e[0]*r:t.length,a=Math.abs($n(t,0,n,r));if(s)for(var o=0,l=e.length;o<l;o++){var h=e[o]*r,c=o<l-1?e[o+1]*r:t.length;a-=Math.abs($n(t,h,c,r))}var u=0;for(o=0;o<i.length;o+=3){var d=i[o]*r,p=i[o+1]*r,g=i[o+2]*r;u+=Math.abs((t[d]-t[g])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[g+1]-t[d+1]))}return a===0&&u===0?0:Math.abs((u-a)/a)};function $n(t,e,r,i){for(var s=0,n=e,a=r-i;n<r;n+=i)s+=(t[a]-t[n])*(t[n+1]+t[a+1]),a=n;return s}Vs.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},i=0,s=0;s<t.length;s++){for(var n=0;n<t[s].length;n++)for(var a=0;a<e;a++)r.vertices.push(t[s][n][a]);s>0&&(i+=t[s-1].length,r.holes.push(i))}return r};const dl=.985;function Q0(t,e){e=e||[];const r=256,i=r-1;return e[0]=Math.floor(t/r/r/r)/i,e[1]=Math.floor(t/r/r)%r/i,e[2]=Math.floor(t/r)%r/i,e[3]=t%r/i,e}function J0(t){let e=0;const r=256,i=r-1;return e+=Math.round(t[0]*r*r*r*i),e+=Math.round(t[1]*r*r*i),e+=Math.round(t[2]*r*i),e+=Math.round(t[3]*i),e}function e_(){const t='const e="GENERATE_POLYGON_BUFFERS",t="GENERATE_POINT_BUFFERS",n="GENERATE_LINE_STRING_BUFFERS";function r(e,t){const n=t[0],r=t[1];return t[0]=e[0]*n+e[2]*r+e[4],t[1]=e[1]*n+e[3]*r+e[5],t}function x(e,t){const n=(r=t)[0]*r[3]-r[1]*r[2];var r;!function(e,t){if(!e)throw new Error(t)}(0!==n,"Transformation matrix cannot be inverted");const x=t[0],i=t[1],u=t[2],o=t[3],f=t[4],s=t[5];return e[0]=o/n,e[1]=-i/n,e[2]=-u/n,e[3]=x/n,e[4]=(u*s-o*f)/n,e[5]=-(x*s-i*f)/n,e}function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}new Array(6);var u={exports:{}};function o(e,t,n){n=n||2;var r,x,i,u,o,s,l,v=t&&t.length,h=v?t[0]*n:e.length,c=f(e,0,h,n,!0),g=[];if(!c||c.next===c.prev)return g;if(v&&(c=function(e,t,n,r){var x,i,u,o=[];for(x=0,i=t.length;x<i;x++)(u=f(e,t[x]*r,x<i-1?t[x+1]*r:e.length,r,!1))===u.next&&(u.steiner=!0),o.push(d(u));for(o.sort(p),x=0;x<o.length;x++)n=y(o[x],n);return n}(e,t,c,n)),e.length>80*n){r=i=e[0],x=u=e[1];for(var b=n;b<h;b+=n)(o=e[b])<r&&(r=o),(s=e[b+1])<x&&(x=s),o>i&&(i=o),s>u&&(u=s);l=0!==(l=Math.max(i-r,u-x))?32767/l:0}return a(c,g,n,r,x,l,0),g}function f(e,t,n,r,x){var i,u;if(x===O(e,t,n,r)>0)for(i=t;i<n;i+=r)u=P(i,e[i],e[i+1],u);else for(i=n-r;i>=t;i-=r)u=P(i,e[i],e[i+1],u);return u&&m(u,u.next)&&(B(u),u=u.next),u}function s(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==w(r.prev,r,r.next))r=r.next;else{if(B(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function a(e,t,n,r,x,i,u){if(e){!u&&i&&function(e,t,n,r){var x=e;do{0===x.z&&(x.z=b(x.x,x.y,t,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==e);x.prevZ.nextZ=null,x.prevZ=null,function(e){var t,n,r,x,i,u,o,f,s=1;do{for(n=e,e=null,i=null,u=0;n;){for(u++,r=n,o=0,t=0;t<s&&(o++,r=r.nextZ);t++);for(f=s;o>0||f>0&&r;)0!==o&&(0===f||!r||n.z<=r.z)?(x=n,n=n.nextZ,o--):(x=r,r=r.nextZ,f--),i?i.nextZ=x:e=x,x.prevZ=i,i=x;n=r}i.nextZ=null,s*=2}while(u>1)}(x)}(e,r,x,i);for(var o,f,p=e;e.prev!==e.next;)if(o=e.prev,f=e.next,i?v(e,r,x,i):l(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(f.i/n|0),B(e),e=f.next,p=f.next;else if((e=f)===p){u?1===u?a(e=h(s(e),t,n),t,n,r,x,i,2):2===u&&c(e,t,n,r,x,i):a(s(e),t,n,r,x,i,1);break}}}function l(e){var t=e.prev,n=e,r=e.next;if(w(t,n,r)>=0)return!1;for(var x=t.x,i=n.x,u=r.x,o=t.y,f=n.y,s=r.y,a=x<i?x<u?x:u:i<u?i:u,l=o<f?o<s?o:s:f<s?f:s,v=x>i?x>u?x:u:i>u?i:u,h=o>f?o>s?o:s:f>s?f:s,c=r.next;c!==t;){if(c.x>=a&&c.x<=v&&c.y>=l&&c.y<=h&&M(x,o,i,f,u,s,c.x,c.y)&&w(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function v(e,t,n,r){var x=e.prev,i=e,u=e.next;if(w(x,i,u)>=0)return!1;for(var o=x.x,f=i.x,s=u.x,a=x.y,l=i.y,v=u.y,h=o<f?o<s?o:s:f<s?f:s,c=a<l?a<v?a:v:l<v?l:v,p=o>f?o>s?o:s:f>s?f:s,y=a>l?a>v?a:v:l>v?l:v,g=b(h,c,t,n,r),d=b(p,y,t,n,r),Z=e.prevZ,m=e.nextZ;Z&&Z.z>=g&&m&&m.z<=d;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;if(Z=Z.prevZ,m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;Z&&Z.z>=g;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;m&&m.z<=d;){if(m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function h(e,t,n){var r=e;do{var x=r.prev,i=r.next.next;!m(x,i)&&A(x,r,r.next,i)&&z(x,i)&&z(i,x)&&(t.push(x.i/n|0),t.push(r.i/n|0),t.push(i.i/n|0),B(r),B(r.next),r=e=i),r=r.next}while(r!==e);return s(r)}function c(e,t,n,r,x,i){var u=e;do{for(var o=u.next.next;o!==u.prev;){if(u.i!==o.i&&Z(u,o)){var f=F(u,o);return u=s(u,u.next),f=s(f,f.next),a(u,t,n,r,x,i,0),void a(f,t,n,r,x,i,0)}o=o.next}u=u.next}while(u!==e)}function p(e,t){return e.x-t.x}function y(e,t){var n=function(e,t){var n,r=t,x=e.x,i=e.y,u=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var o=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=x&&o>u&&(u=o,n=r.x<r.next.x?r:r.next,o===x))return n}r=r.next}while(r!==t);if(!n)return null;var f,s=n,a=n.x,l=n.y,v=1/0;r=n;do{x>=r.x&&r.x>=a&&x!==r.x&&M(i<l?x:u,i,a,l,i<l?u:x,i,r.x,r.y)&&(f=Math.abs(i-r.y)/(x-r.x),z(r,e)&&(f<v||f===v&&(r.x>n.x||r.x===n.x&&g(n,r)))&&(n=r,v=f)),r=r.next}while(r!==s);return n}(e,t);if(!n)return t;var r=F(n,e);return s(r,r.next),s(n,n.next)}function g(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function b(e,t,n,r,x){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function d(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function M(e,t,n,r,x,i,u,o){return(x-u)*(t-o)>=(e-u)*(i-o)&&(e-u)*(r-o)>=(n-u)*(t-o)&&(n-u)*(i-o)>=(x-u)*(r-o)}function Z(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&A(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(z(e,t)&&z(t,e)&&function(e,t){var n=e,r=!1,x=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!=n.next.y>i&&n.next.y!==n.y&&x<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||m(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function A(e,t,n,r){var x=I(w(e,t,n)),i=I(w(e,t,r)),u=I(w(n,r,e)),o=I(w(n,r,t));return x!==i&&u!==o||(!(0!==x||!E(e,n,t))||(!(0!==i||!E(e,r,t))||(!(0!==u||!E(n,e,r))||!(0!==o||!E(n,t,r)))))}function E(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function I(e){return e>0?1:e<0?-1:0}function z(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function F(e,t){var n=new _(e.i,e.x,e.y),r=new _(t.i,t.x,t.y),x=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=x,x.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function P(e,t,n,r){var x=new _(e,t,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function B(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function _(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(e,t,n,r){for(var x=0,i=t,u=n-r;i<n;i+=r)x+=(e[u]-e[i])*(e[i+1]+e[u+1]),u=i;return x}u.exports=o,u.exports.default=o,o.deviation=function(e,t,n,r){var x=t&&t.length,i=x?t[0]*n:e.length,u=Math.abs(O(e,0,i,n));if(x)for(var o=0,f=t.length;o<f;o++){var s=t[o]*n,a=o<f-1?t[o+1]*n:e.length;u-=Math.abs(O(e,s,a,n))}var l=0;for(o=0;o<r.length;o+=3){var v=r[o]*n,h=r[o+1]*n,c=r[o+2]*n;l+=Math.abs((e[v]-e[c])*(e[h+1]-e[v+1])-(e[v]-e[h])*(e[c+1]-e[v+1]))}return 0===u&&0===l?0:Math.abs((l-u)/u)},o.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,x=0;x<e.length;x++){for(var i=0;i<e[x].length;i++)for(var u=0;u<t;u++)n.vertices.push(e[x][i][u]);x>0&&(r+=e[x-1].length,n.holes.push(r))}return n};var N=i(u.exports);const R=[],S={vertexPosition:0,indexPosition:0};function T(e,t,n,r,x){e[t+0]=n,e[t+1]=r,e[t+2]=x}function U(e,t,n,r,x,i){const u=3+x,o=e[t+0],f=e[t+1],s=R;s.length=x;for(let n=0;n<s.length;n++)s[n]=e[t+2+n];let a=i?i.vertexPosition:0,l=i?i.indexPosition:0;const v=a/u;return T(n,a,o,f,0),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,1),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,2),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,3),s.length&&n.set(s,a+3),a+=u,r[l++]=v,r[l++]=v+1,r[l++]=v+3,r[l++]=v+1,r[l++]=v+2,r[l++]=v+3,S.vertexPosition=a,S.indexPosition=l,S}function k(e,t,n,x,i,u,o,f,s,a,l){const v=8+f.length,h=u.length/v,c=[e[t+0],e[t+1]],p=[e[n],e[n+1]],y=r(s,[...c]),g=r(s,[...p]);function b(e,t,n){const r=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),x=[(t[0]-e[0])/r,(t[1]-e[1])/r],i=[-x[1],x[0]],u=Math.sqrt((n[0]-e[0])*(n[0]-e[0])+(n[1]-e[1])*(n[1]-e[1])),o=[(n[0]-e[0])/u,(n[1]-e[1])/u],f=0===r||0===u?0:Math.acos((s=o[0]*x[0]+o[1]*x[1],a=-1,l=1,Math.min(Math.max(s,a),l)));var s,a,l;return o[0]*i[0]+o[1]*i[1]>0?f:2*Math.PI-f}let d=-1,M=-1,Z=l;const w=null!==i;if(null!==x){d=b(y,g,r(s,[...[e[x],e[x+1]]])),Math.cos(d)<=.985&&(Z+=Math.tan((d-Math.PI)/2))}if(w){M=b(g,y,r(s,[...[e[i],e[i+1]]])),Math.cos(M)<=.985&&(Z+=Math.tan((Math.PI-M)/2))}function m(e,t){return 0===t?1e4*e:Math.sign(t)*(1e4*e+Math.abs(t))}return u.push(c[0],c[1],p[0],p[1],d,M,a,m(0,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(1,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(2,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(3,l)),u.push(...f),o.push(h,h+1,h+2,h+1,h+3,h+2),{length:a+Math.sqrt((g[0]-y[0])*(g[0]-y[0])+(g[1]-y[1])*(g[1]-y[1])),angle:Z}}function G(e,t,n,r,x){const i=2+x;let u=t;const o=e.slice(u,u+x);u+=x;const f=e[u++];let s=0;const a=new Array(f-1);for(let t=0;t<f;t++)s+=e[u++],t<f-1&&(a[t]=s);const l=e.slice(u,u+2*s),v=N(l,a,2);for(let e=0;e<v.length;e++)r.push(v[e]+n.length/i);for(let e=0;e<l.length;e+=2)n.push(l[e],l[e+1],...o);return u+2*s}const j=self;j.onmessage=r=>{const i=r.data;switch(i.type){case t:{const e=3,t=2,n=i.customAttributesSize,r=t+n,x=new Float32Array(i.renderInstructions),u=x.length/r,o=4*u*(n+e),f=new Uint32Array(6*u),s=new Float32Array(o);let a;for(let e=0;e<x.length;e+=r)a=U(x,e,s,f,n,a);const l=Object.assign({vertexBuffer:s.buffer,indexBuffer:f.buffer,renderInstructions:x.buffer},i);j.postMessage(l,[s.buffer,f.buffer,x.buffer]);break}case n:{const e=[],t=[],n=i.customAttributesSize,r=2,u=new Float32Array(i.renderInstructions);let o=0;const f=[1,0,0,1,0,0];let s,a;for(x(f,i.renderInstructionsTransform);o<u.length;){a=Array.from(u.slice(o,o+n)),o+=n,s=u[o++];const x=o,i=o+(s-1)*r,l=u[x]===u[i]&&u[x+1]===u[i+1];let v=0,h=0;for(let n=0;n<s-1;n++){let c=null;n>0?c=o+(n-1)*r:l&&(c=i-r);let p=null;n<s-2?p=o+(n+2)*r:l&&(p=x+r);const y=k(u,o+n*r,o+(n+1)*r,c,p,e,t,a,f,v,h);v=y.length,h=y.angle}o+=s*r}const l=Uint32Array.from(t),v=Float32Array.from(e),h=Object.assign({vertexBuffer:v.buffer,indexBuffer:l.buffer,renderInstructions:u.buffer},i);j.postMessage(h,[v.buffer,l.buffer,u.buffer]);break}case e:{const e=[],t=[],n=i.customAttributesSize,r=new Float32Array(i.renderInstructions);let x=0;for(;x<r.length;)x=G(r,x,e,t,n);const u=Uint32Array.from(t),o=Float32Array.from(e),f=Object.assign({vertexBuffer:o.buffer,indexBuffer:u.buffer,renderInstructions:r.buffer},i);j.postMessage(f,[o.buffer,u.buffer,r.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(t,"binary").toString("base64"):URL.createObjectURL(new Blob([t],{type:"application/javascript"})))}function t_(t,e){const r=t.viewState.projection,s=e.getSource().getWrapX()&&r.canWrapX(),n=r.getExtent(),a=t.extent,o=s?ht(n):null,l=s?Math.ceil((a[2]-n[2])/o)+1:1;return[s?Math.floor((a[0]-n[0])/o):0,l,o]}class r_ extends tu{constructor(e,r){const i=r.uniforms||{},s=wt();i[kt.PROJECTION_MATRIX]=s,super(e,{uniforms:i,postProcesses:r.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new Ts(Xs,Bn),this.indicesBuffer_=new Ts(Hs,Bn),this.vertexShader_=r.vertexShader,this.fragmentShader_=r.fragmentShader,this.program_,this.hitDetectionEnabled_=r.hitDetectionEnabled??!0;const n=r.attributes?r.attributes.map(function(o){return{name:"a_prop_"+o.name,size:1,type:At.FLOAT}}):[];this.attributes=[{name:"a_position",size:2,type:At.FLOAT},{name:"a_index",size:1,type:At.FLOAT}],this.hitDetectionEnabled_&&(this.attributes.push({name:"a_hitColor",size:4,type:At.FLOAT}),this.attributes.push({name:"a_featureUid",size:1,type:At.FLOAT})),this.attributes.push(...n),this.customAttributes=r.attributes?r.attributes:[],this.previousExtent_=ua(),this.currentTransform_=s,this.renderTransform_=wt(),this.invertRenderTransform_=wt(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=e_(),this.worker_.addEventListener("message",o=>{const l=o.data;if(l.type===cl.GENERATE_POINT_BUFFERS){const h=l.projectionTransform;this.verticesBuffer_.fromArrayBuffer(l.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.fromArrayBuffer(l.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=h,Ef(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(o.data.renderInstructions),l.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const a=this.getLayer().getSource();this.sourceListenKeys_=[fi(a,Vi.ADDFEATURE,this.handleSourceFeatureAdded_,this),fi(a,Vi.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),fi(a,Vi.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),fi(a,Vi.CLEAR,this.handleSourceFeatureClear_,this)],a.forEachFeature(o=>{this.featureCache_[Fe(o)]={feature:o,properties:o.getProperties(),geometry:o.getGeometry()},this.featureCount_++})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new D0(this.helper))}handleSourceFeatureAdded_(e){const r=e.feature;this.featureCache_[Fe(r)]={feature:r,properties:r.getProperties(),geometry:r.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(e){const r=e.feature;this.featureCache_[Fe(r)]={feature:r,properties:r.getProperties(),geometry:r.getGeometry()}}handleSourceFeatureDelete_(e){const r=e.feature;delete this.featureCache_[Fe(r)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(e){const r=this.helper.getGL();this.preRender(r,e);const[i,s,n]=t_(e,this.getLayer());return this.renderWorlds(e,!1,i,s,n),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,i,s,n),this.hitRenderTarget_.clearCachedData()),this.postRender(r,e),this.helper.getCanvas()}prepareFrameInternal(e){const r=this.getLayer(),i=r.getSource(),s=e.viewState,n=!e.viewHints[_s.ANIMATING]&&!e.viewHints[_s.INTERACTING],a=!ms(this.previousExtent_,e.extent),o=this.sourceRevision_<i.getRevision();if(o&&(this.sourceRevision_=i.getRevision()),n&&(a||o)){const l=s.projection,h=s.resolution,c=r instanceof ca?r.getRenderBuffer():0,u=dh(e.extent,c*h);i.loadFeatures(u,h,l),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.useProgram(this.program_,e),this.helper.prepareDraw(e),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(e){const r=wt();this.helper.makeProjectionTransform(e,r);const s=(this.hitDetectionEnabled_?7:2)+this.customAttributes.length,n=s*this.featureCount_;(!this.renderInstructions_||this.renderInstructions_.length!==n)&&(this.renderInstructions_=new Float32Array(n));let a,o;const l=[],h=[];let c=-1;for(const d in this.featureCache_)if(a=this.featureCache_[d],o=a.geometry,!(!o||o.getType()!=="Point")){if(l[0]=o.getFlatCoordinates()[0],l[1]=o.getFlatCoordinates()[1],Ri(r,l),this.renderInstructions_[++c]=l[0],this.renderInstructions_[++c]=l[1],this.hitDetectionEnabled_){const p=Q0(c+5,h);this.renderInstructions_[++c]=p[0],this.renderInstructions_[++c]=p[1],this.renderInstructions_[++c]=p[2],this.renderInstructions_[++c]=p[3],this.renderInstructions_[++c]=Number(d)}for(let p=0;p<this.customAttributes.length;p++){const g=this.customAttributes[p].callback(a.feature,a.properties);this.renderInstructions_[++c]=g}}const u={id:++this.lastSentId,type:cl.GENERATE_POINT_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesSize:s-2};u.projectionTransform=r,this.ready=!1,this.worker_.postMessage(u,[this.renderInstructions_.buffer]),this.renderInstructions_=null}forEachFeatureAtCoordinate(e,r,i,s,n){if(Gt(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const a=Ri(r.coordinateToPixelTransform,e.slice()),o=this.hitRenderTarget_.readPixel(a[0]/2,a[1]/2),l=[o[0]/255,o[1]/255,o[2]/255,o[3]/255],h=J0(l),c=this.renderInstructions_[h],u=Math.floor(c).toString(),p=this.getLayer().getSource().getFeatureByUid(u);if(p)return s(p,this.getLayer(),null)}renderWorlds(e,r,i,s,n){let a=i;this.helper.useProgram(this.program_,e),r&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0)),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes);do{this.helper.makeProjectionTransform(e,this.currentTransform_),gh(this.currentTransform_,a*n,0),uh(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e),this.helper.applyHitDetectionUniform(r);const o=this.indicesBuffer_.getSize();this.helper.drawElements(0,o)}while(++a<s)}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach(function(e){Cn(e)}),this.sourceListenKeys_=null,super.disposeInternal()}}const au=r_;class i_{constructor(e,r){this.name=e,this.data=r,this.texture_=null}getTexture(e){if(!this.texture_){const r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=r}return this.texture_}}const s_=i_;function Ms(t){return t instanceof Image||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageBitmap?t:null}function jn(t){return t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Float32Array||t instanceof DataView?t:null}let wr=null;function n_(t){wr||(wr=Zt(t.width,t.height,void 0,{willReadFrequently:!0}));const e=wr.canvas,r=t.width;e.width!==r&&(e.width=r);const i=t.height;return e.height!==i&&(e.height=i),wr.clearRect(0,0,r,i),wr.drawImage(t,0,0),wr.getImageData(0,0,r,i).data}const a_=[256,256];let o_=class extends ph{constructor(e){const r=ee.IDLE;super(e.tileCoord,r,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null}getSize(){if(this.size_)return this.size_;const e=Ms(this.data_);return e?[e.width,e.height]:a_}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==ee.IDLE&&this.state!==ee.ERROR)return;this.state=ee.LOADING,this.changed();const e=this;this.loader_().then(function(r){e.data_=r,e.state=ee.LOADED,e.changed()}).catch(function(r){e.error_=r,e.state=ee.ERROR,e.changed()})}};const Da=o_;class l_ extends Da{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:e.interpolate,transition:e.transition}),this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const r=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),i=this.targetTileGrid_.getExtent();let s=this.sourceTileGrid_.getExtent();const n=i?Ct(r,i):r;if(Po(n)===0){this.state=ee.EMPTY;return}const a=e.sourceProj,o=a.getExtent();o&&(s?s=Ct(s,o):s=o);const l=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),h=e.targetProj,c=Tf(a,h,n,l);if(!isFinite(c)||c<=0){this.state=ee.EMPTY;return}const u=e.errorThreshold!==void 0?e.errorThreshold:Sf;if(this.triangulation_=new Mf(a,h,n,s,c*u,l),this.triangulation_.getTriangles().length===0){this.state=ee.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(c);let d=this.triangulation_.calculateSourceExtent();if(s&&(a.canWrapX()?(d[1]=Pe(d[1],s[1],s[3]),d[3]=Pe(d[3],s[1],s[3])):d=Ct(d,s)),!Po(d))this.state=ee.EMPTY;else{const p=this.sourceTileGrid_.getTileRangeForExtentAndZ(d,this.sourceZ_),g=e.getTileFunction;for(let _=p.minX;_<=p.maxX;_++)for(let y=p.minY;y<=p.maxY;y++){const v=g(this.sourceZ_,_,y,this.pixelRatio_);v&&this.sourceTiles_.push(v)}this.sourceTiles_.length===0&&(this.state=ee.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];if(this.sourceTiles_.forEach(r=>{if(!r||r.getState()!==ee.LOADED)return;const i=r.getSize(),s=this.gutter_;let n;const a=jn(r.getData());a?n=a:n=n_(Ms(r.getData()));const o=[i[0]+2*s,i[1]+2*s],l=n instanceof Float32Array,h=o[0]*o[1],c=l?Float32Array:Uint8Array,u=new c(n.buffer),d=c.BYTES_PER_ELEMENT,p=d*u.length/h,g=u.byteLength/o[1],_=Math.floor(g/d/o[0]),y=h*_;let v=u;if(u.length!==y){v=new c(y);let E=0,T=0;const w=o[0]*_;for(let b=0;b<o[1];++b){for(let A=0;A<w;++A)v[E++]=u[T+A];T+=g/d}}e.push({extent:this.sourceTileGrid_.getTileCoordExtent(r.tileCoord),data:new Uint8Array(v.buffer),dataType:c,bytesPerPixel:p,pixelSize:o})}),this.sourceTiles_.length=0,e.length===0)this.state=ee.ERROR;else{const r=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(r),s=typeof i=="number"?i:i[0],n=typeof i=="number"?i:i[1],a=this.targetTileGrid_.getResolution(r),o=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let h,c;const u=e[0].bytesPerPixel,d=Math.ceil(u/3);for(let p=d-1;p>=0;--p){const g=[];for(let w=0,b=e.length;w<b;++w){const A=e[w],I=A.data,C=A.pixelSize,G=C[0],U=C[1],X=Zt(G,U,an),V=X.createImageData(G,U),f=V.data;let m=p*3;for(let x=0,S=f.length;x<S;x+=4)f[x]=I[m],f[x+1]=I[m+1],f[x+2]=I[m+2],f[x+3]=255,m+=u;X.putImageData(V,0,0),g.push({extent:A.extent,image:X.canvas})}const _=wf(s,n,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),a,l,this.triangulation_,g,this.gutter_,!1,!1);for(let w=0,b=g.length;w<b;++w){const I=g[w].image.getContext("2d");Ao(I),an.push(I.canvas)}const y=_.getContext("2d"),v=y.getImageData(0,0,_.width,_.height);Ao(y),an.push(_),h||(c=new Uint8Array(u*v.width*v.height),h=new e[0].dataType(c.buffer));const E=v.data;let T=p*3;for(let w=0,b=E.length;w<b;w+=4)E[w+3]===255?(c[T]=E[w],c[T+1]=E[w+1],c[T+2]=E[w+2]):(c[T]=0,c[T+1]=0,c[T+2]=0),T+=u}this.reprojData_=h,this.reprojSize_=[Math.round(s*this.pixelRatio_),Math.round(n*this.pixelRatio_)],this.state=ee.LOADED}this.changed()}load(){if(this.state!==ee.IDLE&&this.state!==ee.ERROR)return;this.state=ee.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(r=>{const i=r.getState();if(i!==ee.IDLE&&i!==ee.LOADING)return;e++;const s=fi(r,it.CHANGE,function(){const n=r.getState();(n==ee.LOADED||n==ee.ERROR||n==ee.EMPTY)&&(Cn(s),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(s)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(r){r.getState()==ee.IDLE&&r.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(Cn),this.sourcesListenerKeys_=null}}const Ga=l_;class h_ extends bf{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=e.gutter||0,this.helper_=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(it.CHANGE,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===ee.LOADED,this.loaded)this.uploadTile();else{if(e instanceof fa){const r=e.getImage();r instanceof Image&&!r.crossOrigin&&(r.crossOrigin="anonymous")}e.addEventListener(it.CHANGE,this.handleTileChange_)}}uploadTile(){$t()}setReady(){this.ready=!0,this.dispatchEvent(it.CHANGE)}handleTileChange_(){this.tile.getState()===ee.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(it.CHANGE,this.handleTileChange_)}}const u_=h_;function ou(t,e,r){const i=r?t.LINEAR:t.NEAREST;t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i)}function c_(t,e,r,i){ou(t,e,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}function gl(t,e,r,i,s,n){const a=t.getGL();let o,l;r instanceof Float32Array?(o=a.FLOAT,t.getExtension("OES_texture_float"),l=t.getExtension("OES_texture_float_linear")!==null):(o=a.UNSIGNED_BYTE,l=!0),ou(a,e,n&&l);const h=r.byteLength/i[1];let c=1;h%8===0?c=8:h%4===0?c=4:h%2===0&&(c=2);let u;switch(s){case 1:{u=a.LUMINANCE;break}case 2:{u=a.LUMINANCE_ALPHA;break}case 3:{u=a.RGB;break}case 4:{u=a.RGBA;break}default:throw new Error(`Unsupported number of bands: ${s}`)}const d=a.getParameter(a.UNPACK_ALIGNMENT);a.pixelStorei(a.UNPACK_ALIGNMENT,c),a.texImage2D(a.TEXTURE_2D,0,u,i[0],i[1],0,u,o,r),a.pixelStorei(a.UNPACK_ALIGNMENT,d)}let Pr=null;function f_(){Pr=Zt(1,1,void 0,{willReadFrequently:!0})}class d_ extends u_{constructor(e){super(e),this.textures=[],this.renderSize_=Ot(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const r=new Ts(Xs,Na);r.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(r),this.coords=r,this.setTile(e.tile)}uploadTile(){const e=this.helper_,r=e.getGL(),i=this.tile;this.textures.length=0;let s;i instanceof fa||i instanceof da?s=i.getImage():s=i.getData();const n=Ms(s);if(n){const E=r.createTexture();this.textures.push(E),this.bandCount=4,c_(r,E,n,i.interpolate),this.setReady();return}s=jn(s);const a=i.getSize(),o=[a[0]+2*this.gutter_,a[1]+2*this.gutter_],l=s instanceof Float32Array,h=o[0]*o[1],c=l?Float32Array:Uint8Array,u=c.BYTES_PER_ELEMENT,d=s.byteLength/o[1];this.bandCount=Math.floor(d/u/o[0]);const p=Math.ceil(this.bandCount/4);if(p===1){const E=r.createTexture();this.textures.push(E),gl(e,E,s,o,this.bandCount,i.interpolate),this.setReady();return}const g=new Array(p);for(let E=0;E<p;++E){const T=r.createTexture();this.textures.push(T);const w=E<p-1?4:(this.bandCount-1)%4+1;g[E]=new c(h*w)}let _=0,y=0;const v=o[0]*this.bandCount;for(let E=0;E<o[1];++E){for(let T=0;T<v;++T){const w=s[y+T],b=Math.floor(_/this.bandCount),A=T%this.bandCount,I=Math.floor(A/4),C=g[I],G=C.length/h,U=A%4;C[b*G+U]=w,++_}y+=d/u}for(let E=0;E<p;++E){const T=this.textures[E],w=g[E],b=w.length/h;gl(e,T,w,o,b,i.interpolate)}this.setReady()}disposeInternal(){const e=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let r=0;r<this.textures.length;++r)e.deleteTexture(this.textures[r]);this.tile.removeEventListener(it.CHANGE,this.handleTileChange_)}getImagePixelData_(e,r,i){const s=this.gutter_,n=this.renderSize_[0],a=this.renderSize_[1];Pr||f_(),Pr.clearRect(0,0,1,1);const o=e.width,l=e.height,h=o-2*s,c=l-2*s,u=s+Math.floor(h*(r/n)),d=s+Math.floor(c*(i/a));let p;try{Pr.drawImage(e,u,d,1,1,0,0,1,1),p=Pr.getImageData(0,0,1,1).data}catch{return Pr=null,null}return p}getArrayPixelData_(e,r,i,s){const n=this.gutter_,a=this.renderSize_[0],o=this.renderSize_[1],l=r[0],h=r[1],c=l+2*n,u=h+2*n,d=n+Math.floor(l*(i/a)),p=n+Math.floor(h*(s/o));if(e instanceof DataView){const _=e.byteLength/(c*u),y=_*(p*c+d),v=e.buffer.slice(y,y+_);return new DataView(v)}const g=this.bandCount*(p*c+d);return e.slice(g,g+this.bandCount)}getPixelData(e,r){if(!this.loaded)return null;if(this.tile instanceof Da){const i=this.tile.getData(),s=jn(i);if(s){const n=this.tile.getSize();return this.getArrayPixelData_(s,n,e,r)}return this.getImagePixelData_(Ms(i),e,r)}return this.getImagePixelData_(this.tile.getImage(),e,r)}}const g_=d_,p_={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},m_={};function pl(t){return 1/(t+2)}function __(){return{tileIds:new Set,representationsByZ:{}}}function ml(t,e){return t.tileIds.has(Fe(e))}function _l(t,e,r){const i=t.representationsByZ;r in i||(i[r]=new Set),i[r].add(e),t.tileIds.add(Fe(e.tile))}function un(t,e){const r=t.layerStatesArray[t.layerIndex];r.extent&&(e=Ct(e,_h(r.extent,t.viewState.projection)));const i=r.layer.getRenderSource();if(!i.getWrapX()){const s=i.getTileGridForProjection(t.viewState.projection).getExtent();s&&(e=Ct(e,s))}return e}function qn(t,e){return`${t.getKey()},${Rr(e)}`}class y_ extends tu{constructor(e,r){super(e,{uniforms:r.uniforms,postProcesses:r.postProcesses}),this.renderComplete=!1,this.tileTransform_=wt(),this.tempMat4=Qh(),this.tempTileRange_=new Rf(0,0,0,0),this.tempTileCoord_=On(0,0,0),this.tempSize_=[0,0];const i=r.cacheSize!==void 0?r.cacheSize:512;this.tileRepresentationCache=new mh(i),this.frameState=null,this.projection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}isDrawableTile_(e){const r=this.getLayer(),i=e.getState(),s=r.getUseInterimTilesOnError();return i==ee.LOADED||i==ee.EMPTY||i==ee.ERROR&&!s}prepareFrameInternal(e){this.projection_?e.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=e.viewState.projection):this.projection_=e.viewState.projection;const i=this.getLayer().getRenderSource();return!i||la(un(e,e.extent))?!1:i.getState()==="ready"}createTileRepresentation(e){return $t()}enqueueTiles(e,r,i,s,n){const a=e.viewState,o=this.getLayer(),l=o.getRenderSource(),h=l.getTileGridForProjection(a.projection),c=l.getGutterForProjection(a.projection),u=Fe(l);u in e.wantedTiles||(e.wantedTiles[u]={});const d=e.wantedTiles[u],p=this.tileRepresentationCache,g=o.getMapInternal(),_=Math.max(i-n,h.getMinZoom(),h.getZForResolution(Math.min(o.getMaxResolution(),g?g.getView().getResolutionForZoom(Math.max(o.getMinZoom(),0)):h.getResolution(0)),l.zDirection));for(let y=i;y>=_;--y){const v=h.getTileRangeForExtentAndZ(r,y,this.tempTileRange_),E=h.getResolution(y);for(let T=v.minX;T<=v.maxX;++T)for(let w=v.minY;w<=v.maxY;++w){const b=On(y,T,w,this.tempTileCoord_),A=qn(l,b);let I,C;if(p.containsKey(A)&&(I=p.get(A),C=I.tile),(!I||I.tile.key!==l.getKey())&&(C=l.getTile(y,T,w,e.pixelRatio,a.projection)),ml(s,C))continue;if(!I)I=this.createTileRepresentation({tile:C,grid:h,helper:this.helper,gutter:c}),p.set(A,I);else if(this.isDrawableTile_(C))I.setTile(C);else{const U=C.getInterimTile();I.setTile(U)}_l(s,I,y);const G=C.getKey();d[G]=!0,C.getState()===ee.IDLE&&(e.tileQueue.isKeyQueued(G)||e.tileQueue.enqueue([C,u,h.getTileCoordCenter(b),E]))}}}beforeTilesRender(e,r){this.helper.prepareDraw(this.frameState,!r,!0)}beforeTilesMaskRender(e){return!1}renderTile(e,r,i,s,n,a,o,l,h,c,u){}renderTileMask(e,r,i,s){}drawTile_(e,r,i,s,n,a,o){if(!r.ready)return;const h=r.tile.tileCoord,c=Rr(h),u=c in a?a[c]:1,d=o.getResolution(i),p=Ot(o.getTileSize(i),this.tempSize_),g=o.getOrigin(i),_=o.getTileCoordExtent(h),y=u<1?-1:pl(i);u<1&&(e.animate=!0);const v=e.viewState,E=v.center[0],T=v.center[1],w=p[0]+2*s,b=p[1]+2*s,A=w/b,I=(E-g[0])/(p[0]*d),C=(g[1]-T)/(p[1]*d),G=v.resolution/d,U=h[1],X=h[2];Pf(this.tileTransform_),Io(this.tileTransform_,2/(e.size[0]*G/w),-2/(e.size[1]*G/w)),Af(this.tileTransform_,v.rotation),Io(this.tileTransform_,1,1/A),gh(this.tileTransform_,(p[0]*(U-I)-s)/w,(p[1]*(X-C)-s)/b),this.renderTile(r,this.tileTransform_,e,n,d,p,g,_,y,s,u)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const r=this.helper.getGL();this.preRender(r,e);const i=e.viewState,s=this.getLayer(),n=s.getRenderSource(),a=n.getTileGridForProjection(i.projection),o=n.getGutterForProjection(i.projection),l=un(e,e.extent),h=a.getZForResolution(i.resolution,n.zDirection),c=__(),u=s.getPreload();if(e.nextExtent){const A=a.getZForResolution(i.nextResolution,n.zDirection),I=un(e,e.nextExtent);this.enqueueTiles(e,I,A,c,u)}this.enqueueTiles(e,l,h,c,0),u>0&&setTimeout(()=>{this.enqueueTiles(e,l,h-1,c,u-1)},0);const d={},p=Fe(this),g=e.time;let _=!1;for(const A of c.representationsByZ[h]){const I=A.tile;if((I instanceof da||I instanceof Ga)&&I.getState()===ee.EMPTY)continue;const C=I.tileCoord;if(A.ready){const X=I.getAlpha(p,g);if(X===1){I.endTransition(p);continue}_=!0;const V=Rr(C);d[V]=X}if(this.renderComplete=!1,this.findAltTiles_(a,C,h+1,c))continue;const U=a.getMinZoom();for(let X=h-1;X>=U&&!this.findAltTiles_(a,C,X,c);--X);}const y=c.representationsByZ,v=Object.keys(y).map(Number).sort(If);if(this.beforeTilesMaskRender(e))for(let A=0,I=v.length;A<I;++A){const C=v[A];for(const G of y[C]){const U=G.tile.tileCoord;if(Rr(U)in d)continue;const V=a.getTileCoordExtent(U);this.renderTileMask(G,C,V,pl(C))}}this.beforeTilesRender(e,_);for(let A=0,I=v.length;A<I;++A){const C=v[A];for(const G of y[C]){const U=G.tile.tileCoord;Rr(U)in d||this.drawTile_(e,G,C,o,l,d,a)}}for(const A of y[h]){const I=A.tile.tileCoord;Rr(I)in d&&this.drawTile_(e,A,h,o,l,d,a)}this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const T=this.helper.getCanvas(),w=this.tileRepresentationCache;for(;w.canExpireCache();)w.pop().dispose();const b=function(A,I){n.updateCacheSize(.1,I.viewState.projection),n.expireCache(I.viewState.projection,m_)};return e.postRenderFunctions.push(b),this.postRender(r,e),T}findAltTiles_(e,r,i,s){const n=e.getTileRangeForTileCoordAndZ(r,i,this.tempTileRange_);if(!n)return!1;let a=!0;const o=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let h=n.minX;h<=n.maxX;++h)for(let c=n.minY;c<=n.maxY;++c){const u=qn(l,[i,h,c]);let d=!1;if(o.containsKey(u)){const p=o.get(u);p.ready&&!ml(s,p.tile)&&(_l(s,p,i),d=!0)}d||(a=!1)}return a}clearCache(){const e=this.tileRepresentationCache;e.forEach(r=>r.dispose()),e.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const x_=y_,re={...p_,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},as={TEXTURE_COORD:"a_textureCoord"},v_=[{name:as.TEXTURE_COORD,size:2,type:At.FLOAT}];class E_ extends x_{constructor(e,r){super(e,r),this.program_,this.vertexShader_=r.vertexShader,this.fragmentShader_=r.fragmentShader,this.indices_=new Ts(Hs,Na),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=r.paletteTextures||[]}reset(e){super.reset(e),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(e){return new g_(e)}beforeTilesRender(e,r){super.beforeTilesRender(e,r),this.helper.useProgram(this.program_,e)}renderTile(e,r,i,s,n,a,o,l,h,c,u){const d=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(v_);let p=0;for(;p<e.textures.length;){const A=`${re.TILE_TEXTURE_ARRAY}[${p}]`;this.helper.bindTexture(e.textures[p],p,A),++p}for(let A=0;A<this.paletteTextures_.length;++A){const I=this.paletteTextures_[A],C=I.getTexture(d);this.helper.bindTexture(C,p,I.name),++p}const g=i.viewState,_=a[0]+2*c,y=a[1]+2*c,E=e.tile.tileCoord,T=E[1],w=E[2];this.helper.setUniformMatrixValue(re.TILE_TRANSFORM,Jh(this.tempMat4,r)),this.helper.setUniformFloatValue(re.TRANSITION_ALPHA,u),this.helper.setUniformFloatValue(re.DEPTH,h);let b=s;c>0&&(b=l,Ct(b,s,b)),this.helper.setUniformFloatVec4(re.RENDER_EXTENT,b),this.helper.setUniformFloatValue(re.RESOLUTION,g.resolution),this.helper.setUniformFloatValue(re.ZOOM,g.zoom),this.helper.setUniformFloatValue(re.TEXTURE_PIXEL_WIDTH,_),this.helper.setUniformFloatValue(re.TEXTURE_PIXEL_HEIGHT,y),this.helper.setUniformFloatValue(re.TEXTURE_RESOLUTION,n),this.helper.setUniformFloatValue(re.TEXTURE_ORIGIN_X,o[0]+T*a[0]*n-c*n),this.helper.setUniformFloatValue(re.TEXTURE_ORIGIN_Y,o[1]-w*a[1]*n+c*n),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;const i=this.frameState;if(!i)return null;const s=this.getLayer(),n=Ri(i.pixelToCoordinateTransform,e.slice()),a=i.viewState,o=s.getExtent();if(o&&!Cr(_h(o,a.projection),n))return null;const l=s.getSources(oh([n]),a.resolution);let h,c,u;for(h=l.length-1;h>=0;--h)if(c=l[h],c.getState()==="ready"){if(u=c.getTileGridForProjection(a.projection),c.getWrapX())break;const p=u.getExtent();if(!p||Cr(p,n))break}if(h<0)return null;const d=this.tileRepresentationCache;for(let p=u.getZForResolution(a.resolution);p>=u.getMinZoom();--p){const g=u.getTileCoordForCoordAndZ(n,p),_=qn(c,g);if(!d.containsKey(_))continue;const y=d.get(_),v=y.tile;if((v instanceof da||v instanceof Ga)&&v.getState()===ee.EMPTY)return null;if(!y.loaded)continue;const E=u.getOrigin(p),T=Ot(u.getTileSize(p)),w=u.getResolution(p),b=(n[0]-E[0])/w-g[1]*T[0],A=(E[1]-n[1])/w-g[2]*T[1];return y.getPixelData(b,A)}return null}disposeInternal(){const e=this.helper;e&&(e.getGL().deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_}}const w_=E_;function T_(t,e){return`operator_${t}_${Object.keys(e.functions).length}`}function gr(t){const e=t.toString();return e.includes(".")?e:e+".0"}function Ua(t){if(t.length<2||t.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${t.length}(${t.map(gr).join(", ")})`}function os(t){const e=Pi(t),r=e.length>3?e[3]:1;return Ua([e[0]/255*r,e[1]/255*r,e[2]/255*r,r])}const cn={};let S_=0;function bs(t){return t in cn||(cn[t]=S_++),cn[t]}function jt(t){return gr(bs(t))}function Ba(t){return"u_var_"+t}function M_(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{}}}const fn="getBandValue",lu="u_paletteTextures";function b_(t,e,r,i){const s=Lf(t,r,e);if(Cf(s.type,Ff))throw new Error("No matching type was found");if(!Of(e,s.type)){const n=Nn(e),a=Nn(s.type);throw new Error(`Expected expression to be of type ${n}, got ${a}`)}return za(s,e,i)}function _e(t){return(e,r,i)=>{const s=r.args.length,n=new Array(s);for(let a=0;a<s;++a)n[a]=za(r.args[a],i,e);return t(n,e)}}const R_={[oe.Get]:(t,e)=>{const i=e.args[0].value;return i in t.properties||(t.properties[i]={name:i,type:e.type}),(t.inFragmentShader?"v_prop_":"a_prop_")+i},[oe.GeometryType]:(t,e,r)=>{const i="geometryType",s=o=>{const l=o.getType();switch(l){case"Point":case"LineString":case"Polygon":return l;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return l.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return s(o.getGeometries()[0])}};return i in t.properties||(t.properties[i]={name:i,type:Zr,evaluator:o=>s(o.getGeometry())}),(t.inFragmentShader?"v_prop_":"a_prop_")+i},[oe.Var]:(t,e)=>{const i=e.args[0].value;return i in t.variables||(t.variables[i]={name:i,type:e.type}),Ba(i)},[oe.Resolution]:()=>"u_resolution",[oe.Zoom]:()=>"u_zoom",[oe.Time]:()=>"u_time",[oe.Any]:_e(t=>`(${t.join(" || ")})`),[oe.All]:_e(t=>`(${t.join(" && ")})`),[oe.Not]:_e(([t])=>`(!${t})`),[oe.Equal]:_e(([t,e])=>`(${t} == ${e})`),[oe.NotEqual]:_e(([t,e])=>`(${t} != ${e})`),[oe.GreaterThan]:_e(([t,e])=>`(${t} > ${e})`),[oe.GreaterThanOrEqualTo]:_e(([t,e])=>`(${t} >= ${e})`),[oe.LessThan]:_e(([t,e])=>`(${t} < ${e})`),[oe.LessThanOrEqualTo]:_e(([t,e])=>`(${t} <= ${e})`),[oe.Multiply]:_e(t=>`(${t.join(" * ")})`),[oe.Divide]:_e(([t,e])=>`(${t} / ${e})`),[oe.Add]:_e(t=>`(${t.join(" + ")})`),[oe.Subtract]:_e(([t,e])=>`(${t} - ${e})`),[oe.Clamp]:_e(([t,e,r])=>`clamp(${t}, ${e}, ${r})`),[oe.Mod]:_e(([t,e])=>`mod(${t}, ${e})`),[oe.Pow]:_e(([t,e])=>`pow(${t}, ${e})`),[oe.Abs]:_e(([t])=>`abs(${t})`),[oe.Floor]:_e(([t])=>`floor(${t})`),[oe.Ceil]:_e(([t])=>`ceil(${t})`),[oe.Round]:_e(([t])=>`floor(${t} + 0.5)`),[oe.Sin]:_e(([t])=>`sin(${t})`),[oe.Cos]:_e(([t])=>`cos(${t})`),[oe.Atan]:_e(([t,e])=>e!==void 0?`atan(${t}, ${e})`:`atan(${t})`),[oe.Sqrt]:_e(([t])=>`sqrt(${t})`),[oe.Match]:_e(t=>{const e=t[0],r=t[t.length-1];let i=null;for(let s=t.length-3;s>=1;s-=2){const n=t[s],a=t[s+1];i=`(${e} == ${n} ? ${a} : ${i||r})`}return i}),[oe.Between]:_e(([t,e,r])=>`(${t} >= ${e} && ${t} <= ${r})`),[oe.Interpolate]:_e(([t,e,...r])=>{let i="";for(let s=0;s<r.length-2;s+=2){const n=r[s],a=i||r[s+1],o=r[s+2],l=r[s+3];let h;t===gr(1)?h=`(${e} - ${n}) / (${o} - ${n})`:h=`(pow(${t}, (${e} - ${n})) - 1.0) / (pow(${t}, (${o} - ${n})) - 1.0)`,i=`mix(${a}, ${l}, clamp(${h}, 0.0, 1.0))`}return i}),[oe.Case]:_e(t=>{const e=t[t.length-1];let r=null;for(let i=t.length-3;i>=0;i-=2){const s=t[i],n=t[i+1];r=`(${s} ? ${n} : ${r||e})`}return r}),[oe.In]:_e(([t,...e],r)=>{const i=T_("in",r),s=[];for(let n=0;n<e.length;n+=1)s.push(`  if (inputValue == ${e[n]}) { return true; }`);return r.functions[i]=`bool ${i}(float inputValue) {
${s.join(`
`)}
  return false;
}`,`${i}(${t})`}),[oe.Array]:_e(t=>`vec${t.length}(${t.join(", ")})`),[oe.Color]:_e(t=>{const e=t.slice(0,3).map(i=>`${i} / 255.0`);return t.length===3?`vec4(${e.join(", ")}, 1.0)`:`(${t[3]} * vec4(${e.join(", ")}, 1.0))`}),[oe.Band]:_e(([t,e,r],i)=>{if(!(fn in i.functions)){let s="";const n=i.bandCount||1;for(let a=0;a<n;a++){const o=Math.floor(a/4);let l=a%4;a===n-1&&l===1&&(l=3);const h=`${re.TILE_TEXTURE_ARRAY}[${o}]`;s+=`  if (band == ${a+1}.0) {
    return texture2D(${h}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}i.functions[fn]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${re.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${re.TEXTURE_PIXEL_HEIGHT};
${s}
}`}return`${fn}(${t}, ${e??"0.0"}, ${r??"0.0"})`}),[oe.Palette]:(t,e)=>{const[r,...i]=e.args,s=i.length,n=new Uint8Array(s*4);for(let h=0;h<i.length;h++){const c=i[h].value,u=Pi(c),d=h*4;n[d]=u[0],n[d+1]=u[1],n[d+2]=u[2],n[d+3]=u[3]*255}t.paletteTextures||(t.paletteTextures=[]);const a=`${lu}[${t.paletteTextures.length}]`,o=new s_(a,n);t.paletteTextures.push(o);const l=za(r,me,t);return`texture2D(${a}, vec2((${l} + 0.5) / ${s}.0, 0.5))`}};function za(t,e,r){if(t instanceof Nf){const i=R_[t.operator];if(i===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(t.operator)}`);return i(r,t,e)}if((t.type&me)>0)return gr(t.value);if((t.type&ns)>0)return t.value.toString();if((t.type&Zr)>0)return jt(t.value.toString());if((t.type&ut)>0)return os(t.value);if((t.type&mt)>0)return Ua(t.value);throw new Error(`Unexpected expression ${t.value} (expected type ${Nn(e)})`)}function P_(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}const Tr=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;

// this used to produce an alpha-premultiplied color from a texture
vec4 samplePremultiplied(sampler2D sampler, vec2 texCoord) {
  vec4 color = texture2D(sampler, texCoord);
  return vec4(color.rgb * color.a, color.a);
}
`,Sr=P_();class hu{constructor(){this.uniforms_=[],this.attributes_=[],this.varyings_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${gr(Sr["circle-radius"])} + ${gr(Sr["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=os(Sr["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=gr(Sr["stroke-width"]),this.strokeColorExpression_=os(Sr["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=jt("round"),this.strokeJoinExpression_=jt("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.hasFill_=!1,this.fillColorExpression_=os(Sr["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(e){return this.uniforms_.push(e),this}addAttribute(e){return this.attributes_.push(e),this}addVarying(e,r,i){return this.varyings_.push({name:e,type:r,expression:i}),this}setSymbolSizeExpression(e){return this.hasSymbol_=!0,this.symbolSizeExpression_=e,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(e){return this.symbolRotationExpression_=e,this}setSymbolOffsetExpression(e){return this.symbolOffsetExpression_=e,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(e){return this.hasSymbol_=!0,this.symbolColorExpression_=e,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(e){return this.texCoordExpression_=e,this}setFragmentDiscardExpression(e){return this.discardExpression_=e,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(e){return this.symbolRotateWithView_=e,this}setStrokeWidthExpression(e){return this.hasStroke_=!0,this.strokeWidthExpression_=e,this}setStrokeColorExpression(e){return this.hasStroke_=!0,this.strokeColorExpression_=e,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(e){return this.strokeOffsetExpression_=e,this}setStrokeCapExpression(e){return this.strokeCapExpression_=e,this}setStrokeJoinExpression(e){return this.strokeJoinExpression_=e,this}setStrokeMiterLimitExpression(e){return this.strokeMiterLimitExpression_=e,this}setStrokeDistanceFieldExpression(e){return this.strokeDistanceFieldExpression_=e,this}setFillColorExpression(e){return this.hasFill_=!0,this.fillColorExpression_=e,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(e){this.vertexShaderFunctions_.includes(e)||this.vertexShaderFunctions_.push(e)}addFragmentShaderFunction(e){this.fragmentShaderFunctions_.includes(e)||this.fragmentShaderFunctions_.push(e)}getSymbolVertexShader(){return this.hasSymbol_?`${Tr}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec4 a_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx;
  if (a_index == 0.0) {
    offsetPx -= halfSizePx;
  } else if (a_index == 1.0) {
    offsetPx += halfSizePx * vec2(1., -1.);
  } else if (a_index == 2.0) {
    offsetPx += halfSizePx;
  } else {
    offsetPx += halfSizePx * vec2(-1., 1.);
  }
  float angle = ${this.symbolRotationExpression_};
  ${this.symbolRotateWithView_?"angle += u_rotation;":""}
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;
  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;
  v_texCoord = vec2(u, v);
  v_hitColor = a_hitColor;
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y); 
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${Tr}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${Tr}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute float a_parameters;
attribute float a_distance;
attribute vec2 a_joinAngles;
attribute vec4 a_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float vertexNumber = floor(abs(a_parameters) / 10000. + 0.5);
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)
  float angleTangentSum = fract(abs(a_parameters) / 10000.) * 10000. * sign(a_parameters);

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);
  
  // compute current vertex position
  float normalDir = vertexNumber < 0.5 || (vertexNumber > 1.5 && vertexNumber < 2.5) ? 1.0 : -1.0;
  float tangentDir = vertexNumber < 1.5 ? 1.0 : -1.0;
  float angle = vertexNumber < 1.5 ? v_angleStart : v_angleEnd;
  vec2 joinDirection;
  vec2 positionPx = vertexNumber < 1.5 ? segmentStartPx : segmentEndPx;
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${dl} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * lineWidth * 0.5;
  gl_Position = pxToScreen(positionPx);

  v_segmentStart = segmentStartPx;
  v_segmentEnd = segmentEndPx;
  v_width = lineWidth;
  v_hitColor = a_hitColor;
  v_distanceOffsetPx = a_distance / u_resolution - (lineOffsetPx * angleTangentSum);
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${Tr}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${dl}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${jt("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${jt("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${jt("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${jt("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

void main(void) {
  vec2 currentPoint = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPoint);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }

  float segmentLength = length(v_segmentEnd - v_segmentStart);
  vec2 segmentTangent = (v_segmentEnd - v_segmentStart) / segmentLength;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPoint = currentPoint - v_segmentStart;
  float currentLengthPx = max(0., min(dot(segmentTangent, startToPoint), segmentLength)) + v_distanceOffsetPx; 
  float currentRadiusPx = abs(dot(segmentNormal, startToPoint));
  float currentRadiusRatio = dot(segmentNormal, startToPoint) * 2. / v_width;
  vec4 color = ${this.strokeColorExpression_} * u_globalAlpha;
  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPoint, v_segmentStart, v_segmentEnd, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPoint, v_segmentEnd, v_segmentStart, v_width, v_angleEnd, capType, joinType);
  float distance = max(
    segmentDistanceField(currentPoint, v_segmentStart, v_segmentEnd, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distance = max(distance, ${this.strokeDistanceFieldExpression_});
  gl_FragColor = color * smoothstep(0., -1., distance);
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${Tr}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute vec4 a_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec4 v_hitColor;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_hitColor = a_hitColor;
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${Tr}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec4 v_hitColor;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_} * u_globalAlpha;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}}const yt={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},A_=["#00f","#0ff","#0f0","#ff0","#f00"];class I_ extends ca{constructor(e){e=e||{};const r=Object.assign({},e);delete r.gradient,delete r.radius,delete r.blur,delete r.weight,super(r),this.gradient_=null,this.addChangeListener(yt.GRADIENT,this.handleGradientChanged_),this.setGradient(e.gradient?e.gradient:A_),this.setBlur(e.blur!==void 0?e.blur:15),this.setRadius(e.radius!==void 0?e.radius:8);const i=e.weight?e.weight:"weight";typeof i=="string"?this.weightFunction_=function(s){return s.get(i)}:this.weightFunction_=i,this.setRenderOrder(null)}getBlur(){return this.get(yt.BLUR)}getGradient(){return this.get(yt.GRADIENT)}getRadius(){return this.get(yt.RADIUS)}handleGradientChanged_(){this.gradient_=L_(this.getGradient())}setBlur(e){this.set(yt.BLUR,e)}setGradient(e){this.set(yt.GRADIENT,e)}setRadius(e){this.set(yt.RADIUS,e)}createRenderer(){const e=new hu().addAttribute("float a_prop_weight").addVarying("v_prop_weight","float","a_prop_weight").addUniform("float u_size").addUniform("float u_blurSlope").setSymbolSizeExpression("vec2(u_size)").setSymbolColorExpression("vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * u_blurSlope) * v_prop_weight)");return new au(this,{className:this.getClassName(),attributes:[{name:"weight",callback:r=>{const i=this.weightFunction_(r);return i!==void 0?Pe(i,0,1):1}}],uniforms:{u_size:()=>(this.get(yt.RADIUS)+this.get(yt.BLUR))*2,u_blurSlope:()=>this.get(yt.RADIUS)/Math.max(1,this.get(yt.BLUR))},hitDetectionEnabled:!0,vertexShader:e.getSymbolVertexShader(),fragmentShader:e.getSymbolFragmentShader(),postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}renderDeclutter(){}}function L_(t){const i=Zt(1,256),s=i.createLinearGradient(0,0,1,256),n=1/(t.length-1);for(let a=0,o=t.length;a<o;++a)s.addColorStop(a*n,t[a]);return i.fillStyle=s,i.fillRect(0,0,1,256),i.canvas}const C_=I_;class O_ extends yh{constructor(e,r,i,s,n){const a=n!==void 0?fr.IDLE:fr.LOADED;super(e,r,i,a),this.loader_=n!==void 0?n:null,this.canvas_=s,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=fr.ERROR):this.state=fr.LOADED,this.changed()}load(){this.state==fr.IDLE&&(this.state=fr.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}const ka=O_;class N_ extends Df{constructor(e){super(e),this.vectorRenderer_=new Gf(e),this.layerImageRatio_=e.getImageRatio(),this.coordinateToVectorPixelTransform_=wt(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(e){if(!this.vectorRenderer_)return Promise.resolve([]);const r=Ri(this.coordinateToVectorPixelTransform_,Ri(this.renderedPixelToCoordinateTransform_,e.slice()));return this.vectorRenderer_.getFeatures(r)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(e){const r=e.pixelRatio,i=e.viewState,s=i.resolution,n=e.viewHints,a=this.vectorRenderer_;let o=e.extent;this.layerImageRatio_!==1&&(o=o.slice(0),xh(o,this.layerImageRatio_));const l=ht(o)/s,h=ir(o)/s;if(!n[_s.ANIMATING]&&!n[_s.INTERACTING]&&!la(o)){a.useContainer(null,null);const c=a.context,u=e.layerStatesArray[e.layerIndex],d=Object.assign({},u,{opacity:1}),p=Object.assign({},e,{declutterTree:new Uf(9),extent:o,size:[l,h],viewState:Object.assign({},e.viewState,{rotation:0}),layerStatesArray:[d],layerIndex:0});let g=!0;const _=new ka(o,s,r,c.canvas,function(y){a.prepareFrame(p)&&a.replayGroupChanged&&(a.clipping=!1,a.renderFrame(p,null)&&(a.renderDeclutter(p),g=!1),y())});_.addEventListener(it.CHANGE,()=>{if(_.getState()!==fr.LOADED)return;this.image_=g?null:_;const y=_.getPixelRatio(),v=Bf(_.getResolution())*r/y;this.renderedResolution=v,this.coordinateToVectorPixelTransform_=ha(this.coordinateToVectorPixelTransform_,l/2,h/2,1/v,-1/v,0,-i.center[0],-i.center[1])}),_.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!!this.image_}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(e,r,i,s,n){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,r,i,s,n):super.forEachFeatureAtCoordinate(e,r,i,s,n)}}const F_=N_;class D_ extends ca{constructor(e){e=e||{};const r=Object.assign({},e);delete r.imageRatio,super(r),this.imageRatio_=e.imageRatio!==void 0?e.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new F_(this)}}const G_=D_;function J(t,e,r){const i=zf();return i.style=t.style,b_(e,r,i,t)}function yl(t){const e=Pi(t),r=e[0]*256,i=e[1],s=e[2]*256,n=Math.round(e[3]*255);return[r+i,s+n]}const U_=`vec4 unpackColor(vec2 packedColor) {
  return fract(packedColor[1] / 256.0) * vec4(
    fract(floor(packedColor[0] / 256.0) / 256.0),
    fract(packedColor[0] / 256.0),
    fract(floor(packedColor[1] / 256.0) / 256.0),
    1.0
  );
}`;function uu(t){return t===ut?2:t===mt?4:1}function dn(t){const e=uu(t);return e>1?`vec${e}`:"float"}function Rs(t){return(JSON.stringify(t).split("").reduce((r,i)=>(r<<5)-r+i.charCodeAt(0),0)>>>0).toString()}function $a(t,e,r,i){let s;if(`${i}radius`in t&&i!=="icon-"?s=J(r,t[`${i}radius`],me):`${i}radius1`in t&&i==="shape-"&&(s=J(r,t[`${i}radius1`],me)),s!==void 0&&(`${i}stroke-width`in t&&(s=`(${s} + ${J(r,t[`${i}stroke-width`],me)} * 0.5)`),e.setSymbolSizeExpression(`vec2(${s} * 2. + 0.5)`)),`${i}scale`in t){const n=J(r,t[`${i}scale`],me|mt);e.setSymbolSizeExpression(`${e.getSymbolSizeExpression()} * ${n}`)}`${i}displacement`in t&&e.setSymbolOffsetExpression(J(r,t[`${i}displacement`],mt)),`${i}rotation`in t&&e.setSymbolRotationExpression(J(r,t[`${i}rotation`],me)),`${i}rotate-with-view`in t&&e.setSymbolRotateWithView(!!t[`${i}rotate-with-view`])}function cu(t,e,r,i,s){let n="vec4(0.)";if(e!==null&&(n=e),r!==null&&i!==null){const l=`smoothstep(-${i} + 0.63, -${i} - 0.58, ${t})`;n=`mix(${r}, ${n}, ${l})`}const a=`(1.0 - smoothstep(-0.63, 0.58, ${t}))`;let o=`${n} * ${a}`;return s!==null&&(o=`${o} * ${s}`),o}function ja(t,e,r,i,s){const n=new Image;let a;return n.crossOrigin=t[`${i}cross-origin`]===void 0?"anonymous":t[`${i}cross-origin`],n.src=t[`${i}src`],n.complete&&n.width&&n.height?a=Ua([n.width,n.height]):(r[`u_texture${s}_size`]=()=>n.complete?[n.width,n.height]:[0,0],e.addUniform(`vec2 u_texture${s}_size`),a=`u_texture${s}_size`),r[`u_texture${s}`]=n,e.addUniform(`sampler2D u_texture${s}`),a}function qa(t,e,r,i,s){let n=J(r,t[`${e}offset`],mt);if(`${e}offset-origin`in t)switch(t[`${e}offset-origin`]){case"top-right":n=`vec2(${i}.x, 0.) + ${s} * vec2(-1., 0.) + ${n} * vec2(-1., 1.)`;break;case"bottom-left":n=`vec2(0., ${i}.y) + ${s} * vec2(0., -1.) + ${n} * vec2(1., -1.)`;break;case"bottom-right":n=`${i} - ${s} - ${n}`;break}return n}function B_(t,e,r,i,s){s.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,$a(t,e,i,"circle-");let n=null;"circle-opacity"in t&&(n=J(s,t["circle-opacity"],me));let a="coordsPx";"circle-scale"in t&&(a=`coordsPx / ${J(s,t["circle-scale"],me|mt)}`);let o=null;"circle-fill-color"in t&&(o=J(s,t["circle-fill-color"],ut));let l=null;"circle-stroke-color"in t&&(l=J(s,t["circle-stroke-color"],ut));let h=J(s,t["circle-radius"],me),c=null;"circle-stroke-width"in t&&(c=J(s,t["circle-stroke-width"],me),h=`(${h} + ${c} * 0.5)`);const u=`circleDistanceField(${a}, ${h})`,d=cu(u,o,l,c,n);e.setSymbolColorExpression(d)}function z_(t,e,r,i,s){s.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,s.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radiusIn, float radiusOut, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y); 
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radiusOut, 0.);
  vec2 edgeNormal = vec2(radiusIn * sin(alpha * 0.5), -radiusIn * cos(alpha * 0.5) + radiusOut);
  return dot(normalize(edgeNormal), tipToPoint);
}`,s.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y); 
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,$a(t,e,i,"shape-");let n=null;"shape-opacity"in t&&(n=J(s,t["shape-opacity"],me));let a="coordsPx";"shape-scale"in t&&(a=`coordsPx / ${J(s,t["shape-scale"],me|mt)}`);let o=null;"shape-fill-color"in t&&(o=J(s,t["shape-fill-color"],ut));let l=null;"shape-stroke-color"in t&&(l=J(s,t["shape-stroke-color"],ut));let h=null;"shape-stroke-width"in t&&(h=J(s,t["shape-stroke-width"],me));const c=J(s,t["shape-points"],me);let u="0.";"shape-angle"in t&&(u=J(s,t["shape-angle"],me));let d;if("shape-radius"in t){let g=J(s,t["shape-radius"],me);h!==null&&(g=`${g} + ${h} * 0.5`),d=`regularDistanceField(${a}, ${c}, ${g}, ${u})`}else{let g=J(s,t["shape-radius1"],me),_=J(s,t["shape-radius2"],me);h!==null&&(g=`${g} + ${h} * 0.5`,_=`${_} + ${h} * 0.5`),d=`starDistanceField(${a}, ${c}, ${_}, ${g}, ${u})`}const p=cu(d,o,l,h,n);e.setSymbolColorExpression(p)}function k_(t,e,r,i,s){let n="vec4(1.0)";"icon-color"in t&&(n=J(s,t["icon-color"],ut)),"icon-opacity"in t&&(n=`${n} * ${J(s,t["icon-opacity"],me)}`);const a=Rs(t["icon-src"]),o=ja(t,e,r,"icon-",a);if(e.setSymbolColorExpression(`${n} * samplePremultiplied(u_texture${a}, v_texCoord)`).setSymbolSizeExpression(o),"icon-width"in t&&"icon-height"in t&&e.setSymbolSizeExpression(`vec2(${J(i,t["icon-width"],me)}, ${J(i,t["icon-height"],me)})`),"icon-offset"in t&&"icon-size"in t){const l=J(i,t["icon-size"],mt),h=e.getSymbolSizeExpression();e.setSymbolSizeExpression(l);const c=qa(t,"icon-",i,"v_quadSizePx",l);e.setTextureCoordinateExpression(`(vec4((${c}).xyxy) + vec4(0., 0., ${l})) / (${h}).xyxy`)}if($a(t,e,i,"icon-"),"icon-anchor"in t){const l=J(i,t["icon-anchor"],mt);let h="1.0";"icon-scale"in t&&(h=J(i,t["icon-scale"],me|mt));let c;t["icon-anchor-x-units"]==="pixels"&&t["icon-anchor-y-units"]==="pixels"?c=`${l} * ${h}`:t["icon-anchor-x-units"]==="pixels"?c=`${l} * vec2(vec2(${h}).x, v_quadSizePx.y)`:t["icon-anchor-y-units"]==="pixels"?c=`${l} * vec2(v_quadSizePx.x, vec2(${h}).x)`:c=`${l} * v_quadSizePx`;let u=`v_quadSizePx * vec2(0.5, -0.5) + ${c} * vec2(-1., 1.)`;if("icon-anchor-origin"in t)switch(t["icon-anchor-origin"]){case"top-right":u=`v_quadSizePx * -0.5 + ${c}`;break;case"bottom-left":u=`v_quadSizePx * 0.5 - ${c}`;break;case"bottom-right":u=`v_quadSizePx * vec2(-0.5, 0.5) + ${c} * vec2(1., -1.)`;break}e.setSymbolOffsetExpression(`${e.getSymbolOffsetExpression()} + ${u}`)}}function $_(t,e,r,i,s){if("stroke-color"in t&&e.setStrokeColorExpression(J(s,t["stroke-color"],ut)),"stroke-pattern-src"in t){const n=Rs(t["stroke-pattern-src"]),a=ja(t,e,r,"stroke-pattern-",n);let o=a,l="vec2(0.)";"stroke-pattern-offset"in t&&"stroke-pattern-size"in t&&(o=J(s,t["stroke-pattern-size"],mt),l=qa(t,"stroke-pattern-",s,a,o));let h="0.";"stroke-pattern-spacing"in t&&(h=J(s,t["stroke-pattern-spacing"],me)),s.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float currentLengthPx, float currentRadiusRatio) {
      float currentLengthScaled = currentLengthPx * sampleSize.y / v_width;
      float spacingScaled = spacingPx * sampleSize.y / v_width;
      float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
      float vCoordPx = (currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
      vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
      return uCoordPx > sampleSize.x ? vec4(0.) : samplePremultiplied(texture, texCoord);
    }`;const c=`u_texture${n}`;let u="1.";"stroke-color"in t&&(u=e.getStrokeColorExpression()),e.setStrokeColorExpression(`${u} * sampleStrokePattern(${c}, ${a}, ${l}, ${o}, ${h}, currentLengthPx, currentRadiusRatio)`)}if("stroke-width"in t&&e.setStrokeWidthExpression(J(i,t["stroke-width"],me)),"stroke-offset"in t&&e.setStrokeOffsetExpression(J(i,t["stroke-offset"],me)),"stroke-line-cap"in t&&e.setStrokeCapExpression(J(i,t["stroke-line-cap"],Zr)),"stroke-line-join"in t&&e.setStrokeJoinExpression(J(i,t["stroke-line-join"],Zr)),"stroke-miter-limit"in t&&e.setStrokeMiterLimitExpression(J(i,t["stroke-miter-limit"],me)),"stroke-line-dash"in t){s.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${jt("square")}) {
    distanceSegment -= v_width * 0.5;
  } else if (capType == ${jt("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - v_width * 0.5);
  }
  return distanceSegment;
}`;let n=t["stroke-line-dash"].map(p=>J(s,p,me));n.length%2===1&&(n=[...n,...n]);let a="0.";"stroke-line-dash-offset"in t&&(a=J(i,t["stroke-line-dash-offset"],me));const l=`dashDistanceField_${Rs(t["stroke-line-dash"])}`,h=n.map((p,g)=>`float dashLength${g} = ${p};`),c=n.map((p,g)=>`dashLength${g}`).join(" + ");let u="0.",d=`getSingleDashDistance(distance, radius, ${u}, dashLength0, totalDashLength, capType)`;for(let p=2;p<n.length;p+=2)u=`${u} + dashLength${p-2} + dashLength${p-1}`,d=`min(${d}, getSingleDashDistance(distance, radius, ${u}, dashLength${p}, totalDashLength, capType))`;s.functions[l]=`float ${l}(float distance, float radius, float capType) {
  ${h.join(`
  `)}
  float totalDashLength = ${c};
  return ${d};
}`,e.setStrokeDistanceFieldExpression(`${l}(currentLengthPx + ${a}, currentRadiusPx, capType)`)}}function j_(t,e,r,i,s){if("fill-color"in t&&e.setFillColorExpression(J(s,t["fill-color"],ut)),"fill-pattern-src"in t){const n=Rs(t["fill-pattern-src"]),a=ja(t,e,r,"fill-pattern-",n);let o=a,l="vec2(0.)";"fill-pattern-offset"in t&&"fill-pattern-size"in t&&(o=J(s,t["fill-pattern-size"],mt),l=qa(t,"fill-pattern-",s,a,o)),s.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 samplePos = mod((pxPosition - pxOrigin) / scaleRatio, sampleSize);
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return samplePremultiplied(texture, (samplePos + textureOffset) / textureSize);
}`;const h=`u_texture${n}`;let c="1.";"fill-color"in t&&(c=e.getFillColorExpression()),e.setFillColorExpression(`${c} * sampleFillPattern(${h}, ${a}, ${l}, ${o}, pxOrigin, pxPos)`)}}function q_(t){const e={inFragmentShader:!1,properties:{},variables:{},functions:{},style:t},r={inFragmentShader:!0,variables:e.variables,properties:{},functions:{},style:t},i=new hu,s={};if("icon-src"in t?k_(t,i,s,e,r):"shape-points"in t?z_(t,i,s,e,r):"circle-radius"in t&&B_(t,i,s,e,r),$_(t,i,s,e,r),j_(t,i,s,e,r),t.filter){const a=J(r,t.filter,ns);i.setFragmentDiscardExpression(`!${a}`)}Object.keys(r.variables).forEach(function(a){const o=r.variables[a],l=Ba(o.name);i.addUniform(`${dn(o.type)} ${l}`);let h;o.type===Zr?h=()=>bs(t.variables[o.name]):o.type===ut?h=()=>yl([...Pi(t.variables[o.name]||"#eee")]):o.type===ns?h=()=>t.variables[o.name]?1:0:h=()=>t.variables[o.name],s[l]=h}),Object.keys(r.properties).forEach(function(a){const o=r.properties[a];e.properties[a]||(e.properties[a]=o);let l=dn(o.type),h=`a_prop_${o.name}`;o.type===ut&&(l="vec4",h=`unpackColor(${h})`,i.addVertexShaderFunction(U_)),i.addVarying(`v_prop_${o.name}`,l,h)}),Object.keys(e.properties).forEach(function(a){const o=e.properties[a];i.addAttribute(`${dn(o.type)} a_prop_${o.name}`)});const n=Object.keys(e.properties).map(function(a){const o=e.properties[a];let l;return o.evaluator?l=o.evaluator:o.type===Zr?l=h=>bs(h.get(o.name)):o.type===ut?l=h=>yl([...Pi(h.get(o.name)||"#eee")]):o.type===ns?l=h=>h.get(o.name)?1:0:l=h=>h.get(o.name),{name:o.name,size:uu(o.type),callback:l}});for(const a in e.functions)i.addVertexShaderFunction(e.functions[a]);for(const a in r.functions)i.addFragmentShaderFunction(r.functions[a]);return{builder:i,attributes:n.reduce((a,o)=>({...a,[o.name]:{callback:o.callback,size:o.size}}),{}),uniforms:s}}class Z_ extends vh{constructor(e){const r=Object.assign({},e);super(r),this.parseResult_=q_(e.style),this.styleVariables_=e.style.variables||{},this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){const e=Object.keys(this.parseResult_.attributes).map(r=>({name:r,...this.parseResult_.attributes[r]}));return new au(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitDetectionEnabled:!this.hitDetectionDisabled_,uniforms:this.parseResult_.uniforms,attributes:e})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}const W_=Z_;function xl(t,e){const r=`
    attribute vec2 ${as.TEXTURE_COORD};
    uniform mat4 ${re.TILE_TRANSFORM};
    uniform float ${re.TEXTURE_PIXEL_WIDTH};
    uniform float ${re.TEXTURE_PIXEL_HEIGHT};
    uniform float ${re.TEXTURE_RESOLUTION};
    uniform float ${re.TEXTURE_ORIGIN_X};
    uniform float ${re.TEXTURE_ORIGIN_Y};
    uniform float ${re.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${as.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${re.TEXTURE_ORIGIN_X} + ${re.TEXTURE_RESOLUTION} * ${re.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${re.TEXTURE_ORIGIN_Y} - ${re.TEXTURE_RESOLUTION} * ${re.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${re.TILE_TRANSFORM} * vec4(${as.TEXTURE_COORD}, ${re.DEPTH}, 1.0);
    }
  `,i={...M_(),inFragmentShader:!0,bandCount:e,style:t},s=[];if(t.color!==void 0){const u=J(i,t.color,ut);s.push(`color = ${u};`)}if(t.contrast!==void 0){const u=J(i,t.contrast,me);s.push(`color.rgb = clamp((${u} + 1.0) * color.rgb - (${u} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(t.exposure!==void 0){const u=J(i,t.exposure,me);s.push(`color.rgb = clamp((${u} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(t.saturation!==void 0){const u=J(i,t.saturation,me);s.push(`
      float saturation = ${u} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(t.gamma!==void 0){const u=J(i,t.gamma,me);s.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${u}));`)}if(t.brightness!==void 0){const u=J(i,t.brightness,me);s.push(`color.rgb = clamp(color.rgb + ${u}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const n={},a=Object.keys(i.variables).length;if(a>1&&!t.variables)throw new Error(`Missing variables in style (expected ${i.variables})`);for(let u=0;u<a;++u){const d=i.variables[Object.keys(i.variables)[u]];if(!(d.name in t.variables))throw new Error(`Missing '${d.name}' in style variables`);const p=Ba(d.name);n[p]=function(){let g=t.variables[d.name];return typeof g=="string"&&(g=bs(g)),g!==void 0?g:-9999999}}const o=Object.keys(n).map(function(u){return`uniform float ${u};`}),l=Math.ceil(e/4);o.push(`uniform sampler2D ${re.TILE_TEXTURE_ARRAY}[${l}];`),i.paletteTextures&&o.push(`uniform sampler2D ${lu}[${i.paletteTextures.length}];`);const h=Object.keys(i.functions).map(function(u){return i.functions[u]}),c=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${re.RENDER_EXTENT};
    uniform float ${re.TRANSITION_ALPHA};
    uniform float ${re.TEXTURE_PIXEL_WIDTH};
    uniform float ${re.TEXTURE_PIXEL_HEIGHT};
    uniform float ${re.RESOLUTION};
    uniform float ${re.ZOOM};

    ${o.join(`
`)}

    ${h.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${re.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${re.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${re.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${re.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${re.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${s.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${re.TRANSITION_ALPHA};
    }`;return{vertexShader:r,fragmentShader:c,uniforms:n,paletteTextures:i.paletteTextures}}class fu extends kf{constructor(e){e=e?Object.assign({},e):{};const r=e.style||{};delete e.style;const i=e.cacheSize;delete e.cacheSize,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=r,this.cacheSize_=i,this.styleVariables_=this.style_.variables||{},this.addChangeListener(fh.SOURCE,this.handleSourceUpdate_)}getSources(e,r){const i=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(e,r):this.sources_:i?[i]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,r=this.getSources([-e,-e,e,e],e);return r&&r.length&&"bandCount"in r[0]?r[0].bandCount:4}createRenderer(){const e=xl(this.style_,this.getSourceBandCount_());return new w_(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.cacheSize_,paletteTextures:e.paletteTextures})}renderSources(e,r){const i=this.getRenderer();let s;for(let n=0,a=r.length;n<a;++n)this.renderedSource_=r[n],i.prepareFrame(e)&&(s=i.renderFrame(e));return s}render(e,r){this.rendered=!0;const i=e.viewState,s=this.getSources(e.extent,i.resolution);let n=!0;for(let o=0,l=s.length;o<l;++o){const h=s[o],c=h.getState();if(c=="loading"){const u=()=>{h.getState()=="ready"&&(h.removeEventListener("change",u),this.changed())};h.addEventListener("change",u)}n=n&&c=="ready"}const a=this.renderSources(e,s);if(this.getRenderer().renderComplete&&n)return this.renderedResolution_=i.resolution,a;if(this.renderedResolution_>.5*i.resolution){const o=this.getSources(e.extent,this.renderedResolution_).filter(l=>!s.includes(l));if(o.length>0)return this.renderSources(e,o)}return a}setStyle(e){this.styleVariables_=e.variables||{},this.style_=e;const r=xl(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,uniforms:r.uniforms,paletteTextures:r.paletteTextures}),this.changed()}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}fu.prototype.dispose;const Zn=fu,X_=Object.freeze(Object.defineProperty({__proto__:null,Graticule:x0,Group:Eh,Heatmap:C_,Image:ga,Layer:vh,Tile:ys,Vector:oa,VectorImage:G_,VectorTile:wh,WebGLPoints:W_,WebGLTile:Zn},Symbol.toStringTag,{value:"Module"}));function H_(t){const e=t[0],r=new Array(e);let i=1<<e-1,s,n;for(s=0;s<e;++s)n=48,t[1]&i&&(n+=1),t[2]&i&&(n+=2),r[s]=String.fromCharCode(n),i>>=1;return r.join("")}const V_='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>';class Y_ extends vr{constructor(e){const r=e.hidpi!==void 0?e.hidpi:!1;super({cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,opaque:!0,projection:de("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:r?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.hidpi_=r,this.culture_=e.culture!==void 0?e.culture:"en-us",this.maxZoom_=e.maxZoom!==void 0?e.maxZoom:-1,this.apiKey_=e.key,this.imagerySet_=e.imagerySet,this.placeholderTiles_=e.placeholderTiles;const i="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(i).then(s=>s.json()).then(s=>this.handleImageryMetadataResponse(s))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(e){if(e.statusCode!=200||e.statusDescription!="OK"||e.authenticationResultCode!="ValidCredentials"||e.resourceSets.length!=1||e.resourceSets[0].resources.length!=1){this.setState("error");return}const r=e.resourceSets[0].resources[0],i=this.maxZoom_==-1?r.zoomMax:this.maxZoom_,s=this.getProjection(),n=Us(s),a=this.hidpi_?2:1,o=r.imageWidth==r.imageHeight?r.imageWidth/a:[r.imageWidth/a,r.imageHeight/a],l=Bs({extent:n,minZoom:r.zoomMin,maxZoom:i,tileSize:o});this.tileGrid=l;const h=this.culture_,c=this.hidpi_,u=this.placeholderTiles_;if(this.tileUrlFunction=Th(r.imageUrlSubdomains.map(function(d){const p=[0,0,0],g=r.imageUrl.replace("{subdomain}",d).replace("{culture}",h);return function(_,y,v){if(!_)return;On(_[0],_[1],_[2],p);const E=new URL(g.replace("{quadkey}",H_(p))),T=E.searchParams;return c&&(T.set("dpi","d1"),T.set("device","mobile")),u===!0?T.delete("n"):u===!1&&T.set("n","z"),E.toString()}})),r.imageryProviders){const d=pa(de("EPSG:4326"),this.getProjection());this.setAttributions(p=>{const g=[],_=p.viewState,y=this.getTileGrid(),v=y.getZForResolution(_.resolution,this.zDirection),T=y.getTileCoordForCoordAndZ(_.center,v)[0];return r.imageryProviders.map(function(w){let b=!1;const A=w.coverageAreas;for(let I=0,C=A.length;I<C;++I){const G=A[I];if(T>=G.zoomMin&&T<=G.zoomMax){const U=G.bbox,X=[U[1],U[0],U[3],U[2]],V=bi(X,d);if(qr(V,p.extent)){b=!0;break}}}b&&g.push(w.attribution)}),g.push(V_),g})}this.setState("ready")}}const K_=Y_;class Q_ extends Wr{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,maxZoom:e.maxZoom!==void 0?e.maxZoom:18,minZoom:e.minZoom,projection:e.projection,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection}),this.account_=e.account,this.mapId_=e.map||"",this.config_=e.config||{},this.templateCache_={},this.initializeMap_()}getConfig(){return this.config_}updateConfig(e){Object.assign(this.config_,e),this.initializeMap_()}setConfig(e){this.config_=e||{},this.initializeMap_()}initializeMap_(){const e=JSON.stringify(this.config_);if(this.templateCache_[e]){this.applyTemplate_(this.templateCache_[e]);return}let r="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(r+="/named/"+this.mapId_);const i=new XMLHttpRequest;i.addEventListener("load",this.handleInitResponse_.bind(this,e)),i.addEventListener("error",this.handleInitError_.bind(this)),i.open("POST",r),i.setRequestHeader("Content-type","application/json"),i.send(JSON.stringify(this.config_))}handleInitResponse_(e,r){const i=r.target;if(!i.status||i.status>=200&&i.status<300){let s;try{s=JSON.parse(i.responseText)}catch{this.setState("error");return}this.applyTemplate_(s),this.templateCache_[e]=s,this.setState("ready")}else this.setState("error")}handleInitError_(e){this.setState("error")}applyTemplate_(e){const r="https://"+e.cdn_url.https+"/"+this.account_+"/api/v1/map/"+e.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(r)}}const J_=Q_;class ey extends Gs{constructor(e){super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(r){const i=r.getGeometry();return Gt(!i||i.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),i},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,r,i){this.source.loadFeatures(e,r,i),r!==this.resolution&&(this.resolution=r,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(it.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(it.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,r){const i=e===0?0:Math.min(r,e)/e,s=e!==this.distance||this.interpolationRatio!==i;this.distance=e,this.minDistance=r,this.interpolationRatio=i,s&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=ua(),r=this.distance*this.resolution,i=this.source.getFeatures(),s={};for(let n=0,a=i.length;n<a;n++){const o=i[n];if(!(Fe(o)in s)){const l=this.geometryFunction(o);if(l){const h=l.getCoordinates();$f(h,e),dh(e,r,e);const c=this.source.getFeaturesInExtent(e).filter(function(u){const d=Fe(u);return d in s?!1:(s[d]=!0,!0)});this.features.push(this.createCluster(c,e))}}}}createCluster(e,r){const i=[0,0];for(let o=e.length-1;o>=0;--o){const l=this.geometryFunction(e[o]);l?jf(i,l.getCoordinates()):e.splice(o,1)}qf(i,1/e.length);const s=Jt(r),n=this.interpolationRatio,a=new Et([i[0]*(1-n)+s[0]*n,i[1]*(1-n)+s[1]*n]);return this.createCustomCluster_?this.createCustomCluster_(a,e):new ct({geometry:a,features:e})}}const ty=ey;class ry extends zs{constructor(e){const r=e.projection===void 0?"EPSG:3857":e.projection;let i=e.tileGrid;i===void 0&&r&&(i=Bs({extent:Us(r),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:r,tileGrid:i,opaque:e.opaque,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.tileSize_=e.tileSize?Ot(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=e.bandCount===void 0?4:e.bandCount,this.tileGridForProjection_={},this.tileCacheForProjection_={}}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const r=this.getTileGrid();return r?Ot(r.getTileSize(e)):[256,256]}getGutterForProjection(e){const r=this.getProjection();return!r||ci(r,e)?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,r,i,s,n){const a=this.getTileCacheForProjection(s),o=xs(e,r,i);if(a.containsKey(o)){const y=a.get(o);if(y&&y.key==this.getKey())return y}const l=this.getTileGrid(),h=Math.max.apply(null,l.getResolutions().map((y,v)=>{const E=Ot(l.getTileSize(v)),T=this.getTileSize(v);return Math.max(T[0]/E[0],T[1]/E[1])})),c=this.getTileGridForProjection(n),u=this.getTileGridForProjection(s),d=[e,r,i],p=this.getTileCoordForTileUrlFunction(d,s),g=Object.assign({sourceProj:n,sourceTileGrid:c,targetProj:s,targetTileGrid:u,tileCoord:d,wrappedTileCoord:p,pixelRatio:h,gutter:this.getGutterForProjection(n),getTileFunction:(y,v,E,T)=>this.getTile(y,v,E,T,n)},this.tileOptions),_=new Ga(g);return _.key=this.getKey(),_}getTile(e,r,i,s,n){const a=this.getProjection();if(a&&n&&!ci(a,n))return this.getReprojTile_(e,r,i,n,a);const o=this.getTileSize(e),l=xs(e,r,i);if(this.tileCache.containsKey(l))return this.tileCache.get(l);const h=this.loader_;function c(){return Hf(function(){return h(e,r,i)})}const u=Object.assign({tileCoord:[e,r,i],loader:c,size:o},this.tileOptions),d=new Da(u);return d.key=this.getKey(),d.addEventListener(it.CHANGE,this.handleTileChange_),this.tileCache.set(l,d),d}handleTileChange_(e){const r=e.target,i=Fe(r),s=r.getState();let n;s==ee.LOADING?(this.tileLoadingKeys_[i]=!0,n=on.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],n=s==ee.ERROR?on.TILELOADERROR:s==ee.LOADED?on.TILELOADEND:void 0),n&&this.dispatchEvent(new Zf(n,r))}getTileGridForProjection(e){const r=this.getProjection();if(this.tileGrid&&(!r||ci(r,e)))return this.tileGrid;const i=Fe(e);return i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=Wf(e)),this.tileGridForProjection_[i]}setTileGridForProjection(e,r){const i=de(e);if(i){const s=Fe(i);s in this.tileGridForProjection_||(this.tileGridForProjection_[s]=r)}}getTileCacheForProjection(e){const r=this.getProjection();if(!r||ci(r,e))return this.tileCache;const i=Fe(e);return i in this.tileCacheForProjection_||(this.tileCacheForProjection_[i]=new Xf(.1)),this.tileCacheForProjection_[i]}expireCache(e,r){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?r:{});for(const s in this.tileCacheForProjection_){const n=this.tileCacheForProjection_[s];n.expireCache(n==i?r:{})}}clear(){super.clear();for(const e in this.tileCacheForProjection_)this.tileCacheForProjection_[e].clear()}}const Za=ry;function Ze(t){return(e,...r)=>iy(t,e,r)}function si(t,e){return Ze(du(t,e).get)}const{apply:iy,construct:$M,defineProperty:jM,get:qM,getOwnPropertyDescriptor:du,getPrototypeOf:Wa,has:ZM,ownKeys:sy,set:WM,setPrototypeOf:XM}=Reflect,{iterator:zi,species:HM,toStringTag:ny,for:VM}=Symbol,ay=Object,{create:Xa,defineProperty:oy,freeze:YM,is:KM}=ay,ly=Array,hy=ly.prototype,gu=hy[zi],uy=Ze(gu),pu=ArrayBuffer,cy=pu.prototype;si(cy,"byteLength");const vl=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;vl&&si(vl.prototype,"byteLength");const mu=Wa(Uint8Array);mu.from;const Qe=mu.prototype;Qe[zi];Ze(Qe.keys);Ze(Qe.values);Ze(Qe.entries);Ze(Qe.set);Ze(Qe.reverse);Ze(Qe.fill);Ze(Qe.copyWithin);Ze(Qe.sort);Ze(Qe.slice);Ze(Qe.subarray);si(Qe,"buffer");si(Qe,"byteOffset");si(Qe,"length");si(Qe,ny);const fy=Uint8Array,_u=Uint16Array,Ha=Uint32Array,dy=Float32Array,Ci=Wa([][zi]()),yu=Ze(Ci.next),gy=Ze(function*(){}().next),py=Wa(Ci),my=DataView.prototype,_y=Ze(my.getUint16),Va=WeakMap,xu=Va.prototype,vu=Ze(xu.get),yy=Ze(xu.set),Eu=new Va,xy=Xa(null,{next:{value:function(){const e=vu(Eu,this);return yu(e)}},[zi]:{value:function(){return this}}});function vy(t){if(t[zi]===gu&&Ci.next===yu)return t;const e=Xa(xy);return yy(Eu,e,uy(t)),e}const Ey=new Va,wy=Xa(py,{next:{value:function(){const e=vu(Ey,this);return gy(e)},writable:!0,configurable:!0}});for(const t of sy(Ci))t!=="next"&&oy(wy,t,du(Ci,t));const wu=new pu(4),Ty=new dy(wu),Sy=new Ha(wu),Mt=new _u(512),bt=new fy(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(Mt[t]=0,Mt[t|256]=32768,bt[t]=24,bt[t|256]=24):e<-14?(Mt[t]=1024>>-e-14,Mt[t|256]=1024>>-e-14|32768,bt[t]=-e-1,bt[t|256]=-e-1):e<=15?(Mt[t]=e+15<<10,Mt[t|256]=e+15<<10|32768,bt[t]=13,bt[t|256]=13):e<128?(Mt[t]=31744,Mt[t|256]=64512,bt[t]=24,bt[t|256]=24):(Mt[t]=31744,Mt[t|256]=64512,bt[t]=13,bt[t|256]=13)}const Ya=new Ha(2048);for(let t=1;t<1024;++t){let e=t<<13,r=0;for(;!(e&8388608);)e<<=1,r-=8388608;e&=-8388609,r+=947912704,Ya[t]=e|r}for(let t=1024;t<2048;++t)Ya[t]=939524096+(t-1024<<13);const ni=new Ha(64);for(let t=1;t<31;++t)ni[t]=t<<23;ni[31]=1199570944;ni[32]=2147483648;for(let t=33;t<63;++t)ni[t]=2147483648+(t-32<<23);ni[63]=3347054592;const Tu=new _u(64);for(let t=1;t<64;++t)t!==32&&(Tu[t]=1024);function My(t){const e=t>>10;return Sy[0]=Ya[Tu[e]+(t&1023)]+ni[e],Ty[0]}function Su(t,e,...r){return My(_y(t,e,...vy(r)))}var Ka={exports:{}};function Mu(t,e,r){const i=r&&r.debug||!1;i&&console.log("[xml-utils] getting "+e+" in "+t);const s=typeof t=="object"?t.outer:t,n=s.slice(0,s.indexOf(">")+1),a=['"',"'"];for(let o=0;o<a.length;o++){const l=a[o],h=e+"\\="+l+"([^"+l+"]*)"+l;i&&console.log("[xml-utils] pattern:",h);const u=new RegExp(h).exec(n);if(i&&console.log("[xml-utils] match:",u),u)return u[1]}}Ka.exports=Mu;Ka.exports.default=Mu;var by=Ka.exports;const gn=js(by);var Qa={exports:{}},Ja={exports:{}},eo={exports:{}};function bu(t,e,r){const s=new RegExp(e).exec(t.slice(r));return s?r+s.index:-1}eo.exports=bu;eo.exports.default=bu;var Ry=eo.exports,to={exports:{}};function Ru(t,e,r){const s=new RegExp(e).exec(t.slice(r));return s?r+s.index+s[0].length-1:-1}to.exports=Ru;to.exports.default=Ru;var Py=to.exports,ro={exports:{}};function Pu(t,e){const r=new RegExp(e,"g"),i=t.match(r);return i?i.length:0}ro.exports=Pu;ro.exports.default=Pu;var Ay=ro.exports;const Iy=Ry,pn=Py,El=Ay;function Au(t,e,r){const i=r&&r.debug||!1,s=!(r&&typeof r.nested===!1),n=r&&r.startIndex||0;i&&console.log("[xml-utils] starting findTagByName with",e," and ",r);const a=Iy(t,`<${e}[ 
>/]`,n);if(i&&console.log("[xml-utils] start:",a),a===-1)return;const o=t.slice(a+e.length);let l=pn(o,"^[^<]*[ /]>",0);const h=l!==-1&&o[l-1]==="/";if(i&&console.log("[xml-utils] selfClosing:",h),h===!1)if(s){let p=0,g=1,_=0;for(;(l=pn(o,"[ /]"+e+">",p))!==-1;){const y=o.substring(p,l+1);if(g+=El(y,"<"+e+`[ 
	>]`),_+=El(y,"</"+e+">"),_>=g)break;p=l}}else l=pn(o,"[ /]"+e+">",0);const c=a+e.length+l+1;if(i&&console.log("[xml-utils] end:",c),c===-1)return;const u=t.slice(a,c);let d;return h?d=null:d=u.slice(u.indexOf(">")+1,u.lastIndexOf("<")),{inner:d,outer:u,start:a,end:c}}Ja.exports=Au;Ja.exports.default=Au;var Ly=Ja.exports;const Cy=Ly;function Iu(t,e,r){const i=[],s=r&&r.debug||!1,n=r&&typeof r.nested=="boolean"?r.nested:!0;let a=r&&r.startIndex||0,o;for(;o=Cy(t,e,{debug:s,startIndex:a});)n?a=o.start+1+e.length:a=o.end,i.push(o);return s&&console.log("findTagsByName found",i.length,"tags"),i}Qa.exports=Iu;Qa.exports.default=Iu;var Oy=Qa.exports;const Ny=js(Oy),Ei={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},Pt={};for(const t in Ei)Ei.hasOwnProperty(t)&&(Pt[Ei[t]]=parseInt(t,10));const Fy=[Pt.BitsPerSample,Pt.ExtraSamples,Pt.SampleFormat,Pt.StripByteCounts,Pt.StripOffsets,Pt.StripRowCounts,Pt.TileByteCounts,Pt.TileOffsets,Pt.SubIFDs],mn={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},se={};for(const t in mn)mn.hasOwnProperty(t)&&(se[mn[t]]=parseInt(t,10));const Je={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},Dy={Unspecified:0,Assocalpha:1,Unassalpha:2},QM={Version:0,AddCompression:1},JM={None:0,Deflate:1,Zstandard:2},Gy={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function Uy(t,e){const{width:r,height:i}=t,s=new Uint8Array(r*i*3);let n;for(let a=0,o=0;a<t.length;++a,o+=3)n=256-t[a]/e*256,s[o]=n,s[o+1]=n,s[o+2]=n;return s}function By(t,e){const{width:r,height:i}=t,s=new Uint8Array(r*i*3);let n;for(let a=0,o=0;a<t.length;++a,o+=3)n=t[a]/e*256,s[o]=n,s[o+1]=n,s[o+2]=n;return s}function zy(t,e){const{width:r,height:i}=t,s=new Uint8Array(r*i*3),n=e.length/3,a=e.length/3*2;for(let o=0,l=0;o<t.length;++o,l+=3){const h=t[o];s[l]=e[h]/65536*256,s[l+1]=e[h+n]/65536*256,s[l+2]=e[h+a]/65536*256}return s}function ky(t){const{width:e,height:r}=t,i=new Uint8Array(e*r*3);for(let s=0,n=0;s<t.length;s+=4,n+=3){const a=t[s],o=t[s+1],l=t[s+2],h=t[s+3];i[n]=255*((255-a)/256)*((255-h)/256),i[n+1]=255*((255-o)/256)*((255-h)/256),i[n+2]=255*((255-l)/256)*((255-h)/256)}return i}function $y(t){const{width:e,height:r}=t,i=new Uint8ClampedArray(e*r*3);for(let s=0,n=0;s<t.length;s+=3,n+=3){const a=t[s],o=t[s+1],l=t[s+2];i[n]=a+1.402*(l-128),i[n+1]=a-.34414*(o-128)-.71414*(l-128),i[n+2]=a+1.772*(o-128)}return i}const jy=.95047,qy=1,Zy=1.08883;function Wy(t){const{width:e,height:r}=t,i=new Uint8Array(e*r*3);for(let s=0,n=0;s<t.length;s+=3,n+=3){const a=t[s+0],o=t[s+1]<<24>>24,l=t[s+2]<<24>>24;let h=(a+16)/116,c=o/500+h,u=h-l/200,d,p,g;c=jy*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),h=qy*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),u=Zy*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),d=c*3.2406+h*-1.5372+u*-.4986,p=c*-.9689+h*1.8758+u*.0415,g=c*.0557+h*-.204+u*1.057,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,i[n]=Math.max(0,Math.min(1,d))*255,i[n+1]=Math.max(0,Math.min(1,p))*255,i[n+2]=Math.max(0,Math.min(1,g))*255}return i}const Lu=new Map;function or(t,e){Array.isArray(t)||(t=[t]),t.forEach(r=>Lu.set(r,e))}async function Cu(t){const e=Lu.get(t.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${t.Compression}`);const r=await e();return new r(t)}or([void 0,1],()=>ar(()=>import("./raw-FjKAlyiw.js"),__vite__mapDeps([0,1]),import.meta.url).then(t=>t.default));or(5,()=>ar(()=>import("./lzw-NamZKYVt.js"),__vite__mapDeps([2,1]),import.meta.url).then(t=>t.default));or(6,()=>{throw new Error("old style JPEG compression is not supported.")});or(7,()=>ar(()=>import("./jpeg-rjh0axXg.js"),__vite__mapDeps([3,1]),import.meta.url).then(t=>t.default));or([8,32946],()=>ar(()=>import("./deflate-EZWV29Lt.js"),__vite__mapDeps([4,5,1]),import.meta.url).then(t=>t.default));or(32773,()=>ar(()=>import("./packbits-65YHJGuf.js"),__vite__mapDeps([6,1]),import.meta.url).then(t=>t.default));or(34887,()=>ar(()=>import("./lerc-24Mh-EFR.js"),__vite__mapDeps([7,5,8,1,9,10,11,12,13]),import.meta.url).then(async t=>(await t.zstd.init(),t)).then(t=>t.default));or(50001,()=>ar(()=>import("./webimage-NiQ987z3.js"),__vite__mapDeps([14,1]),import.meta.url).then(t=>t.default));function Ks(t,e,r,i=1){return new(Object.getPrototypeOf(t)).constructor(e*r*i)}function Xy(t,e,r,i,s){const n=e/i,a=r/s;return t.map(o=>{const l=Ks(o,i,s);for(let h=0;h<s;++h){const c=Math.min(Math.round(a*h),r-1);for(let u=0;u<i;++u){const d=Math.min(Math.round(n*u),e-1),p=o[c*e+d];l[h*i+u]=p}}return l})}function kr(t,e,r){return(1-r)*t+r*e}function Hy(t,e,r,i,s){const n=e/i,a=r/s;return t.map(o=>{const l=Ks(o,i,s);for(let h=0;h<s;++h){const c=a*h,u=Math.floor(c),d=Math.min(Math.ceil(c),r-1);for(let p=0;p<i;++p){const g=n*p,_=g%1,y=Math.floor(g),v=Math.min(Math.ceil(g),e-1),E=o[u*e+y],T=o[u*e+v],w=o[d*e+y],b=o[d*e+v],A=kr(kr(E,T,_),kr(w,b,_),c%1);l[h*i+p]=A}}return l})}function Vy(t,e,r,i,s,n="nearest"){switch(n.toLowerCase()){case"nearest":return Xy(t,e,r,i,s);case"bilinear":case"linear":return Hy(t,e,r,i,s);default:throw new Error(`Unsupported resampling method: '${n}'`)}}function Yy(t,e,r,i,s,n){const a=e/i,o=r/s,l=Ks(t,i,s,n);for(let h=0;h<s;++h){const c=Math.min(Math.round(o*h),r-1);for(let u=0;u<i;++u){const d=Math.min(Math.round(a*u),e-1);for(let p=0;p<n;++p){const g=t[c*e*n+d*n+p];l[h*i*n+u*n+p]=g}}}return l}function Ky(t,e,r,i,s,n){const a=e/i,o=r/s,l=Ks(t,i,s,n);for(let h=0;h<s;++h){const c=o*h,u=Math.floor(c),d=Math.min(Math.ceil(c),r-1);for(let p=0;p<i;++p){const g=a*p,_=g%1,y=Math.floor(g),v=Math.min(Math.ceil(g),e-1);for(let E=0;E<n;++E){const T=t[u*e*n+y*n+E],w=t[u*e*n+v*n+E],b=t[d*e*n+y*n+E],A=t[d*e*n+v*n+E],I=kr(kr(T,w,_),kr(b,A,_),c%1);l[h*i*n+p*n+E]=I}}}return l}function Qy(t,e,r,i,s,n,a="nearest"){switch(a.toLowerCase()){case"nearest":return Yy(t,e,r,i,s,n);case"bilinear":case"linear":return Ky(t,e,r,i,s,n);default:throw new Error(`Unsupported resampling method: '${a}'`)}}function Jy(t,e,r){let i=0;for(let s=e;s<r;++s)i+=t[s];return i}function Wn(t,e,r){switch(t){case 1:if(e<=8)return new Uint8Array(r);if(e<=16)return new Uint16Array(r);if(e<=32)return new Uint32Array(r);break;case 2:if(e===8)return new Int8Array(r);if(e===16)return new Int16Array(r);if(e===32)return new Int32Array(r);break;case 3:switch(e){case 16:case 32:return new Float32Array(r);case 64:return new Float64Array(r)}break}throw Error("Unsupported data format/bitsPerSample")}function ex(t,e){return(t===1||t===2)&&e<=32&&e%8===0?!1:!(t===3&&(e===16||e===32||e===64))}function tx(t,e,r,i,s,n,a){const o=new DataView(t),l=r===2?a*n:a*n*i,h=r===2?1:i,c=Wn(e,s,l),u=parseInt("1".repeat(s),2);if(e===1){let d;r===1?d=i*s:d=s;let p=n*d;p&7&&(p=p+7&-8);for(let g=0;g<a;++g){const _=g*p;for(let y=0;y<n;++y){const v=_+y*h*s;for(let E=0;E<h;++E){const T=v+E*s,w=(g*n+y)*h+E,b=Math.floor(T/8),A=T%8;if(A+s<=8)c[w]=o.getUint8(b)>>8-s-A&u;else if(A+s<=16)c[w]=o.getUint16(b)>>16-s-A&u;else if(A+s<=24){const I=o.getUint16(b)<<8|o.getUint8(b+2);c[w]=I>>24-s-A&u}else c[w]=o.getUint32(b)>>32-s-A&u}}}}return c.buffer}class rx{constructor(e,r,i,s,n,a){this.fileDirectory=e,this.geoKeys=r,this.dataView=i,this.littleEndian=s,this.tiles=n?{}:null,this.isTiled=!e.StripOffsets;const o=e.PlanarConfiguration;if(this.planarConfiguration=typeof o>"u"?1:o,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=a}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let r=0;r<this.fileDirectory.BitsPerSample.length;++r)e+=this.getSampleByteSize(r);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const r=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,i=this.fileDirectory.BitsPerSample[e];switch(r){case 1:if(i<=8)return DataView.prototype.getUint8;if(i<=16)return DataView.prototype.getUint16;if(i<=32)return DataView.prototype.getUint32;break;case 2:if(i<=8)return DataView.prototype.getInt8;if(i<=16)return DataView.prototype.getInt16;if(i<=32)return DataView.prototype.getInt32;break;case 3:switch(i){case 16:return function(s,n){return Su(this,s,n)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,r){const i=this.getSampleFormat(e),s=this.getBitsPerSample(e);return Wn(i,s,r)}async getTileOrStrip(e,r,i,s,n){const a=Math.ceil(this.getWidth()/this.getTileWidth()),o=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:h}=this;this.planarConfiguration===1?l=r*a+e:this.planarConfiguration===2&&(l=i*a*o+r*a+e);let c,u;this.isTiled?(c=this.fileDirectory.TileOffsets[l],u=this.fileDirectory.TileByteCounts[l]):(c=this.fileDirectory.StripOffsets[l],u=this.fileDirectory.StripByteCounts[l]);const d=(await this.source.fetch([{offset:c,length:u}],n))[0];let p;return h===null||!h[l]?(p=(async()=>{let g=await s.decode(this.fileDirectory,d);const _=this.getSampleFormat(),y=this.getBitsPerSample();return ex(_,y)&&(g=tx(g,_,this.planarConfiguration,this.getSamplesPerPixel(),y,this.getTileWidth(),this.getBlockHeight(r))),g})(),h!==null&&(h[l]=p)):p=h[l],{x:e,y:r,sample:i,data:await p}}async _readRaster(e,r,i,s,n,a,o,l,h){const c=this.getTileWidth(),u=this.getTileHeight(),d=this.getWidth(),p=this.getHeight(),g=Math.max(Math.floor(e[0]/c),0),_=Math.min(Math.ceil(e[2]/c),Math.ceil(d/c)),y=Math.max(Math.floor(e[1]/u),0),v=Math.min(Math.ceil(e[3]/u),Math.ceil(p/u)),E=e[2]-e[0];let T=this.getBytesPerPixel();const w=[],b=[];for(let C=0;C<r.length;++C)this.planarConfiguration===1?w.push(Jy(this.fileDirectory.BitsPerSample,0,r[C])/8):w.push(0),b.push(this.getReaderForSample(r[C]));const A=[],{littleEndian:I}=this;for(let C=y;C<v;++C)for(let G=g;G<_;++G){let U;this.planarConfiguration===1&&(U=this.getTileOrStrip(G,C,0,n,h));for(let X=0;X<r.length;++X){const V=X,f=r[X];this.planarConfiguration===2&&(T=this.getSampleByteSize(f),U=this.getTileOrStrip(G,C,f,n,h));const m=U.then(x=>{const S=x.data,L=new DataView(S),O=this.getBlockHeight(x.y),N=x.y*u,F=x.x*c,k=N+O,H=(x.x+1)*c,ue=b[V],he=Math.min(O,O-(k-e[3]),p-N),ge=Math.min(c,c-(H-e[2]),d-F);for(let ce=Math.max(0,e[1]-N);ce<he;++ce)for(let Se=Math.max(0,e[0]-F);Se<ge;++Se){const ze=(ce*c+Se)*T,Ce=ue.call(L,ze+w[V],I);let $e;s?($e=(ce+N-e[1])*E*r.length+(Se+F-e[0])*r.length+V,i[$e]=Ce):($e=(ce+N-e[1])*E+Se+F-e[0],i[V][$e]=Ce)}});A.push(m)}}if(await Promise.all(A),a&&e[2]-e[0]!==a||o&&e[3]-e[1]!==o){let C;return s?C=Qy(i,e[2]-e[0],e[3]-e[1],a,o,r.length,l):C=Vy(i,e[2]-e[0],e[3]-e[1],a,o,l),C.width=a,C.height=o,C}return i.width=a||e[2]-e[0],i.height=o||e[3]-e[1],i}async readRasters({window:e,samples:r=[],interleave:i,pool:s=null,width:n,height:a,resampleMethod:o,fillValue:l,signal:h}={}){const c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const u=c[2]-c[0],d=c[3]-c[1],p=u*d,g=this.getSamplesPerPixel();if(!r||!r.length)for(let E=0;E<g;++E)r.push(E);else for(let E=0;E<r.length;++E)if(r[E]>=g)return Promise.reject(new RangeError(`Invalid sample index '${r[E]}'.`));let _;if(i){const E=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,T=Math.max.apply(null,this.fileDirectory.BitsPerSample);_=Wn(E,T,p*r.length),l&&_.fill(l)}else{_=[];for(let E=0;E<r.length;++E){const T=this.getArrayForSample(r[E],p);Array.isArray(l)&&E<l.length?T.fill(l[E]):l&&!Array.isArray(l)&&T.fill(l),_.push(T)}}const y=s||await Cu(this.fileDirectory);return await this._readRaster(c,r,_,i,y,n,a,o,h)}async readRGB({window:e,interleave:r=!0,pool:i=null,width:s,height:n,resampleMethod:a,enableAlpha:o=!1,signal:l}={}){const h=e||[0,0,this.getWidth(),this.getHeight()];if(h[0]>h[2]||h[1]>h[3])throw new Error("Invalid subsets");const c=this.fileDirectory.PhotometricInterpretation;if(c===Je.RGB){let v=[0,1,2];if(this.fileDirectory.ExtraSamples!==Dy.Unspecified&&o){v=[];for(let E=0;E<this.fileDirectory.BitsPerSample.length;E+=1)v.push(E)}return this.readRasters({window:e,interleave:r,samples:v,pool:i,width:s,height:n,resampleMethod:a,signal:l})}let u;switch(c){case Je.WhiteIsZero:case Je.BlackIsZero:case Je.Palette:u=[0];break;case Je.CMYK:u=[0,1,2,3];break;case Je.YCbCr:case Je.CIELab:u=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const d={window:h,interleave:!0,samples:u,pool:i,width:s,height:n,resampleMethod:a,signal:l},{fileDirectory:p}=this,g=await this.readRasters(d),_=2**this.fileDirectory.BitsPerSample[0];let y;switch(c){case Je.WhiteIsZero:y=Uy(g,_);break;case Je.BlackIsZero:y=By(g,_);break;case Je.Palette:y=zy(g,p.ColorMap);break;case Je.CMYK:y=ky(g);break;case Je.YCbCr:y=$y(g);break;case Je.CIELab:y=Wy(g);break;default:throw new Error("Unsupported photometric interpretation.")}if(!r){const v=new Uint8Array(y.length/3),E=new Uint8Array(y.length/3),T=new Uint8Array(y.length/3);for(let w=0,b=0;w<y.length;w+=3,++b)v[b]=y[w],E[b]=y[w+1],T[b]=y[w+2];y=[v,E,T]}return y.width=g.width,y.height=g.height,y}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let r=0;r<this.fileDirectory.ModelTiepoint.length;r+=6)e.push({i:this.fileDirectory.ModelTiepoint[r],j:this.fileDirectory.ModelTiepoint[r+1],k:this.fileDirectory.ModelTiepoint[r+2],x:this.fileDirectory.ModelTiepoint[r+3],y:this.fileDirectory.ModelTiepoint[r+4],z:this.fileDirectory.ModelTiepoint[r+5]});return e}getGDALMetadata(e=null){const r={};if(!this.fileDirectory.GDAL_METADATA)return null;const i=this.fileDirectory.GDAL_METADATA;let s=Ny(i,"Item");e===null?s=s.filter(n=>gn(n,"sample")===void 0):s=s.filter(n=>Number(gn(n,"sample"))===e);for(let n=0;n<s.length;++n){const a=s[n];r[gn(a,"name")]=a.inner}return r}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,r=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(r)return[r[3],r[7],r[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const r=this.fileDirectory.ModelPixelScale,i=this.fileDirectory.ModelTransformation;if(r)return[r[0],-r[1],r[2]];if(i)return[i[0],-i[5],i[10]];if(e){const[s,n,a]=e.getResolution();return[s*e.getWidth()/this.getWidth(),n*e.getHeight()/this.getHeight(),a*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(){const e=this.getHeight(),r=this.getWidth();if(this.fileDirectory.ModelTransformation){const[i,s,n,a,o,l,h,c]=this.fileDirectory.ModelTransformation,d=[[0,0],[0,e],[r,0],[r,e]].map(([_,y])=>[a+i*_+s*y,c+o*_+l*y]),p=d.map(_=>_[0]),g=d.map(_=>_[1]);return[Math.min(...p),Math.min(...g),Math.max(...p),Math.max(...g)]}else{const i=this.getOrigin(),s=this.getResolution(),n=i[0],a=i[1],o=n+s[0]*this.getWidth(),l=a+s[1]*this.getHeight();return[Math.min(n,o),Math.min(a,l),Math.max(n,o),Math.max(a,l)]}}}const Ou=rx;class ix{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,r){const i=this.getUint32(e,r),s=this.getUint32(e+4,r);let n;if(r){if(n=i+2**32*s,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}if(n=2**32*i+s,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}getInt64(e,r){let i=0;const s=(this._dataView.getUint8(e+(r?7:0))&128)>0;let n=!0;for(let a=0;a<8;a++){let o=this._dataView.getUint8(e+(r?a:7-a));s&&(n?o!==0&&(o=~(o-1)&255,n=!1):o=~o&255),i+=o*256**a}return s&&(i=-i),i}getUint8(e,r){return this._dataView.getUint8(e,r)}getInt8(e,r){return this._dataView.getInt8(e,r)}getUint16(e,r){return this._dataView.getUint16(e,r)}getInt16(e,r){return this._dataView.getInt16(e,r)}getUint32(e,r){return this._dataView.getUint32(e,r)}getInt32(e,r){return this._dataView.getInt32(e,r)}getFloat16(e,r){return Su(this._dataView,e,r)}getFloat32(e,r){return this._dataView.getFloat32(e,r)}getFloat64(e,r){return this._dataView.getFloat64(e,r)}}class sx{constructor(e,r,i,s){this._dataView=new DataView(e),this._sliceOffset=r,this._littleEndian=i,this._bigTiff=s}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,r){return this.sliceOffset<=e&&this.sliceTop>=e+r}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const r=this.readUint32(e),i=this.readUint32(e+4);let s;if(this._littleEndian){if(s=r+2**32*i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*r+i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}readInt64(e){let r=0;const i=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let s=!0;for(let n=0;n<8;n++){let a=this._dataView.getUint8(e+(this._littleEndian?n:7-n));i&&(s?a!==0&&(a=~(a-1)&255,s=!1):a=~a&255),r+=a*256**n}return i&&(r=-r),r}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const nx=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class ax{constructor(e=nx,r){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=r?Promise.resolve(r):new Promise(i=>{ar(()=>import("./decoder-YCn7QQ1o.js"),__vite__mapDeps([15,8]),import.meta.url).then(s=>{i(s.create)})}),this._awaitingDecoder.then(i=>{this._awaitingDecoder=null,this.workers=[];for(let s=0;s<e;s++)this.workers.push({worker:i(),idle:!0})}))}async decode(e,r){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?Cu(e).then(i=>i.decode(e,r)):new Promise(i=>{const s=this.workers.find(o=>o.idle)||this.workers[Math.floor(Math.random()*this.size)];s.idle=!1;const n=this.messageId++,a=o=>{o.data.id===n&&(s.idle=!0,i(o.data.decoded),s.worker.removeEventListener("message",a))};s.worker.addEventListener("message",a),s.worker.postMessage({fileDirectory:e,buffer:r,id:n},[r])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const ox=ax,wl=`\r
\r
`;function Nu(t){if(typeof Object.fromEntries<"u")return Object.fromEntries(t);const e={};for(const[r,i]of t)e[r.toLowerCase()]=i;return e}function lx(t){const e=t.split(`\r
`).map(r=>{const i=r.split(":").map(s=>s.trim());return i[0]=i[0].toLowerCase(),i});return Nu(e)}function hx(t){const[e,...r]=t.split(";").map(s=>s.trim()),i=r.map(s=>s.split("="));return{type:e,params:Nu(i)}}function Xn(t){let e,r,i;return t&&([,e,r,i]=t.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),r=parseInt(r,10),i=parseInt(i,10)),{start:e,end:r,total:i}}function ux(t,e){let r=null;const i=new TextDecoder("ascii"),s=[],n=`--${e}`,a=`${n}--`;for(let o=0;o<10;++o)i.decode(new Uint8Array(t,o,n.length))===n&&(r=o);if(r===null)throw new Error("Could not find initial boundary");for(;r<t.byteLength;){const o=i.decode(new Uint8Array(t,r,Math.min(n.length+1024,t.byteLength-r)));if(o.length===0||o.startsWith(a))break;if(!o.startsWith(n))throw new Error("Part does not start with boundary");const l=o.substr(n.length+2);if(l.length===0)break;const h=l.indexOf(wl),c=lx(l.substr(0,h)),{start:u,end:d,total:p}=Xn(c["content-range"]),g=r+n.length+h+wl.length,_=parseInt(d,10)+1-parseInt(u,10);s.push({headers:c,data:t.slice(g,g+_),offset:u,length:_,fileSize:p}),r=g+_+4}return s}class io{async fetch(e,r=void 0){return Promise.all(e.map(i=>this.fetchSlice(i,r)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class cx extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[r,i]of e)this.onEviction(r,i.value)}_deleteIfExpired(e,r){return typeof r.expiry=="number"&&r.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,r.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,r){if(this._deleteIfExpired(e,r)===!1)return r.value}_getItemValue(e,r){return r.expiry?this._getOrDeleteIfExpired(e,r):r.value}_peek(e,r){const i=r.get(e);return this._getItemValue(e,i)}_set(e,r){this.cache.set(e,r),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,r){this.oldCache.delete(e),this._set(e,r)}*_entriesAscending(){for(const e of this.oldCache){const[r,i]=e;this.cache.has(r)||this._deleteIfExpired(r,i)===!1&&(yield e)}for(const e of this.cache){const[r,i]=e;this._deleteIfExpired(r,i)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const r=this.cache.get(e);return this._getItemValue(e,r)}if(this.oldCache.has(e)){const r=this.oldCache.get(e);if(this._deleteIfExpired(e,r)===!1)return this._moveToRecent(e,r),r.value}}set(e,r,{maxAge:i=this.maxAge}={}){const s=typeof i=="number"&&i!==Number.POSITIVE_INFINITY?Date.now()+i:void 0;return this.cache.has(e)?this.cache.set(e,{value:r,expiry:s}):this._set(e,{value:r,expiry:s}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const r=this.cache.delete(e);return r&&this._size--,this.oldCache.delete(e)||r}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const r=[...this._entriesAscending()],i=r.length-e;i<0?(this.cache=new Map(r),this.oldCache=new Map,this._size=r.length):(i>0&&this._emitEvictions(r.slice(0,i)),this.oldCache=new Map(r.slice(i)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[r,i]=e;this._deleteIfExpired(r,i)===!1&&(yield[r,i.value])}for(const e of this.oldCache){const[r,i]=e;this.cache.has(r)||this._deleteIfExpired(r,i)===!1&&(yield[r,i.value])}}*entriesDescending(){let e=[...this.cache];for(let r=e.length-1;r>=0;--r){const i=e[r],[s,n]=i;this._deleteIfExpired(s,n)===!1&&(yield[s,n.value])}e=[...this.oldCache];for(let r=e.length-1;r>=0;--r){const i=e[r],[s,n]=i;this.cache.has(s)||this._deleteIfExpired(s,n)===!1&&(yield[s,n.value])}}*entriesAscending(){for(const[e,r]of this._entriesAscending())yield[e,r.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const r of this.oldCache.keys())this.cache.has(r)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,r=this){for(const[i,s]of this.entriesAscending())e.call(r,s,i,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function fx(t){return new Promise(e=>setTimeout(e,t))}function dx(t,e){const r=Array.isArray(t)?t:Array.from(t),i=Array.isArray(e)?e:Array.from(e);return r.map((s,n)=>[s,i[n]])}class Xr extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,Xr),this.name="AbortError"}}class gx extends Error{constructor(e,r){super(r),this.errors=e,this.message=r,this.name="AggregateError"}}const px=gx;class mx{constructor(e,r,i=null){this.offset=e,this.length=r,this.data=i}get top(){return this.offset+this.length}}class Tl{constructor(e,r,i){this.offset=e,this.length=r,this.blockIds=i}}class _x extends io{constructor(e,{blockSize:r=65536,cacheSize:i=100}={}){super(),this.source=e,this.blockSize=r,this.blockCache=new cx({maxSize:i,onEviction:(s,n)=>{this.evictedBlocks.set(s,n)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,r){const i=[],s=[],n=[];this.evictedBlocks.clear();for(const{offset:d,length:p}of e){let g=d+p;const{fileSize:_}=this;_!==null&&(g=Math.min(g,_));const y=Math.floor(d/this.blockSize)*this.blockSize;for(let v=y;v<g;v+=this.blockSize){const E=Math.floor(v/this.blockSize);!this.blockCache.has(E)&&!this.blockRequests.has(E)&&(this.blockIdsToFetch.add(E),s.push(E)),this.blockRequests.has(E)&&i.push(this.blockRequests.get(E)),n.push(E)}}await fx(),this.fetchBlocks(r);const a=[];for(const d of s)this.blockRequests.has(d)&&a.push(this.blockRequests.get(d));await Promise.allSettled(i),await Promise.allSettled(a);const o=[],l=n.filter(d=>this.abortedBlockIds.has(d)||!this.blockCache.has(d));if(l.forEach(d=>this.blockIdsToFetch.add(d)),l.length>0&&r&&!r.aborted){this.fetchBlocks(null);for(const d of l){const p=this.blockRequests.get(d);if(!p)throw new Error(`Block ${d} is not in the block requests`);o.push(p)}await Promise.allSettled(o)}if(r&&r.aborted)throw new Xr("Request was aborted");const h=n.map(d=>this.blockCache.get(d)||this.evictedBlocks.get(d)),c=h.filter(d=>!d);if(c.length)throw new px(c,"Request failed");const u=new Map(dx(n,h));return this.readSliceData(e,u)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const r=this.groupBlocks(this.blockIdsToFetch),i=this.source.fetch(r,e);for(let s=0;s<r.length;++s){const n=r[s];for(const a of n.blockIds)this.blockRequests.set(a,(async()=>{try{const o=(await i)[s],l=a*this.blockSize,h=l-o.offset,c=Math.min(h+this.blockSize,o.data.byteLength),u=o.data.slice(h,c),d=new mx(l,u.byteLength,u,a);this.blockCache.set(a,d),this.abortedBlockIds.delete(a)}catch(o){if(o.name==="AbortError")o.signal=e,this.blockCache.delete(a),this.abortedBlockIds.add(a);else throw o}finally{this.blockRequests.delete(a)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const r=Array.from(e).sort((a,o)=>a-o);if(r.length===0)return[];let i=[],s=null;const n=[];for(const a of r)s===null||s+1===a?(i.push(a),s=a):(n.push(new Tl(i[0]*this.blockSize,i.length*this.blockSize,i)),i=[a],s=a);return n.push(new Tl(i[0]*this.blockSize,i.length*this.blockSize,i)),n}readSliceData(e,r){return e.map(i=>{let s=i.offset+i.length;this.fileSize!==null&&(s=Math.min(this.fileSize,s));const n=Math.floor(i.offset/this.blockSize),a=Math.floor(s/this.blockSize),o=new ArrayBuffer(i.length),l=new Uint8Array(o);for(let h=n;h<=a;++h){const c=r.get(h),u=c.offset-i.offset,d=c.top-s;let p=0,g=0,_;u<0?p=-u:u>0&&(g=u),d<0?_=c.length-p:_=s-c.offset-p;const y=new Uint8Array(c.data,p,_);l.set(y,g)}return o})}}class so{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class no{constructor(e){this.url=e}async request({headers:e,credentials:r,signal:i}={}){throw new Error("request is not implemented")}}class yx extends so{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class xx extends no{constructor(e,r){super(e),this.credentials=r}async request({headers:e,credentials:r,signal:i}={}){const s=await fetch(this.url,{headers:e,credentials:r,signal:i});return new yx(s)}}class vx extends so{constructor(e,r){super(),this.xhr=e,this.data=r}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class Ex extends no{constructRequest(e,r){return new Promise((i,s)=>{const n=new XMLHttpRequest;n.open("GET",this.url),n.responseType="arraybuffer";for(const[a,o]of Object.entries(e))n.setRequestHeader(a,o);n.onload=()=>{const a=n.response;i(new vx(n,a))},n.onerror=s,n.onabort=()=>s(new Xr("Request aborted")),n.send(),r&&(r.aborted&&n.abort(),r.addEventListener("abort",()=>n.abort()))})}async request({headers:e,signal:r}={}){return await this.constructRequest(e,r)}}const _n={};class wx extends so{constructor(e,r){super(),this.response=e,this.dataPromise=r}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class Tx extends no{constructor(e){super(e),this.parsedUrl=_n.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",_n)}constructRequest(e,r){return new Promise((i,s)=>{const n=this.httpApi.get({...this.parsedUrl,headers:e},a=>{const o=new Promise(l=>{const h=[];a.on("data",c=>{h.push(c)}),a.on("end",()=>{const c=Buffer.concat(h).buffer;l(c)}),a.on("error",s)});i(new wx(a,o))});n.on("error",s),r&&(r.aborted&&n.destroy(new Xr("Request aborted")),r.addEventListener("abort",()=>n.destroy(new Xr("Request aborted"))))})}async request({headers:e,signal:r}={}){return await this.constructRequest(e,r)}}class ao extends io{constructor(e,r,i,s){super(),this.client=e,this.headers=r,this.maxRanges=i,this.allowFullFile=s,this._fileSize=null}async fetch(e,r){return this.maxRanges>=e.length?this.fetchSlices(e,r):(this.maxRanges>0&&e.length>1,Promise.all(e.map(i=>this.fetchSlice(i,r))))}async fetchSlices(e,r){const i=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:s,length:n})=>`${s}-${s+n}`).join(",")}`},signal:r});if(i.ok)if(i.status===206){const{type:s,params:n}=hx(i.getHeader("content-type"));if(s==="multipart/byteranges"){const u=ux(await i.getData(),n.boundary);return this._fileSize=u[0].fileSize||null,u}const a=await i.getData(),{start:o,end:l,total:h}=Xn(i.getHeader("content-range"));this._fileSize=h||null;const c=[{data:a,offset:o,length:l-o}];if(e.length>1){const u=await Promise.all(e.slice(1).map(d=>this.fetchSlice(d,r)));return c.concat(u)}return c}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const s=await i.getData();return this._fileSize=s.byteLength,[{data:s,offset:0,length:s.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,r){const{offset:i,length:s}=e,n=await this.client.request({headers:{...this.headers,Range:`bytes=${i}-${i+s}`},signal:r});if(n.ok)if(n.status===206){const a=await n.getData(),{total:o}=Xn(n.getHeader("content-range"));return this._fileSize=o||null,{data:a,offset:i,length:s}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const a=await n.getData();return this._fileSize=a.byteLength,{data:a,offset:0,length:a.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function oo(t,{blockSize:e,cacheSize:r}){return e===null?t:new _x(t,{blockSize:e,cacheSize:r})}function Sx(t,{headers:e={},credentials:r,maxRanges:i=0,allowFullFile:s=!1,...n}={}){const a=new xx(t,r),o=new ao(a,e,i,s);return oo(o,n)}function Mx(t,{headers:e={},maxRanges:r=0,allowFullFile:i=!1,...s}={}){const n=new Ex(t),a=new ao(n,e,r,i);return oo(a,s)}function bx(t,{headers:e={},maxRanges:r=0,allowFullFile:i=!1,...s}={}){const n=new Tx(t),a=new ao(n,e,r,i);return oo(a,s)}function Hn(t,{forceXHR:e=!1,...r}={}){return typeof fetch=="function"&&!e?Sx(t,r):typeof XMLHttpRequest<"u"?Mx(t,r):bx(t,r)}class Rx extends io{constructor(e){super(),this.file=e}async fetchSlice(e,r){return new Promise((i,s)=>{const n=this.file.slice(e.offset,e.offset+e.length),a=new FileReader;a.onload=o=>i(o.target.result),a.onerror=s,a.onabort=s,a.readAsArrayBuffer(n),r&&r.addEventListener("abort",()=>a.abort())})}}function Px(t){return new Rx(t)}function Vn(t){switch(t){case se.BYTE:case se.ASCII:case se.SBYTE:case se.UNDEFINED:return 1;case se.SHORT:case se.SSHORT:return 2;case se.LONG:case se.SLONG:case se.FLOAT:case se.IFD:return 4;case se.RATIONAL:case se.SRATIONAL:case se.DOUBLE:case se.LONG8:case se.SLONG8:case se.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${t}`)}}function Ax(t){const e=t.GeoKeyDirectory;if(!e)return null;const r={};for(let i=4;i<=e[3]*4;i+=4){const s=Gy[e[i]],n=e[i+1]?Ei[e[i+1]]:null,a=e[i+2],o=e[i+3];let l=null;if(!n)l=o;else{if(l=t[n],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${s}'.`);typeof l=="string"?l=l.substring(o,o+a-1):l.subarray&&(l=l.subarray(o,o+a),a===1&&(l=l[0]))}r[s]=l}return r}function Mr(t,e,r,i){let s=null,n=null;const a=Vn(e);switch(e){case se.BYTE:case se.ASCII:case se.UNDEFINED:s=new Uint8Array(r),n=t.readUint8;break;case se.SBYTE:s=new Int8Array(r),n=t.readInt8;break;case se.SHORT:s=new Uint16Array(r),n=t.readUint16;break;case se.SSHORT:s=new Int16Array(r),n=t.readInt16;break;case se.LONG:case se.IFD:s=new Uint32Array(r),n=t.readUint32;break;case se.SLONG:s=new Int32Array(r),n=t.readInt32;break;case se.LONG8:case se.IFD8:s=new Array(r),n=t.readUint64;break;case se.SLONG8:s=new Array(r),n=t.readInt64;break;case se.RATIONAL:s=new Uint32Array(r*2),n=t.readUint32;break;case se.SRATIONAL:s=new Int32Array(r*2),n=t.readInt32;break;case se.FLOAT:s=new Float32Array(r),n=t.readFloat32;break;case se.DOUBLE:s=new Float64Array(r),n=t.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===se.RATIONAL||e===se.SRATIONAL)for(let o=0;o<r;o+=2)s[o]=n.call(t,i+o*a),s[o+1]=n.call(t,i+(o*a+4));else for(let o=0;o<r;++o)s[o]=n.call(t,i+o*a);return e===se.ASCII?new TextDecoder("utf-8").decode(s):s}class Ix{constructor(e,r,i){this.fileDirectory=e,this.geoKeyDirectory=r,this.nextIFDByteOffset=i}}class rs extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class Fu{async readRasters(e={}){const{window:r,width:i,height:s}=e;let{resX:n,resY:a,bbox:o}=e;const l=await this.getImage();let h=l;const c=await this.getImageCount(),u=l.getBoundingBox();if(r&&o)throw new Error('Both "bbox" and "window" passed.');if(i||s){if(r){const[g,_]=l.getOrigin(),[y,v]=l.getResolution();o=[g+r[0]*y,_+r[1]*v,g+r[2]*y,_+r[3]*v]}const p=o||u;if(i){if(n)throw new Error("Both width and resX passed");n=(p[2]-p[0])/i}if(s){if(a)throw new Error("Both width and resY passed");a=(p[3]-p[1])/s}}if(n||a){const p=[];for(let g=0;g<c;++g){const _=await this.getImage(g),{SubfileType:y,NewSubfileType:v}=_.fileDirectory;(g===0||y===2||v&1)&&p.push(_)}p.sort((g,_)=>g.getWidth()-_.getWidth());for(let g=0;g<p.length;++g){const _=p[g],y=(u[2]-u[0])/_.getWidth(),v=(u[3]-u[1])/_.getHeight();if(h=_,n&&n>y||a&&a>v)break}}let d=r;if(o){const[p,g]=l.getOrigin(),[_,y]=h.getResolution(l);d=[Math.round((o[0]-p)/_),Math.round((o[1]-g)/y),Math.round((o[2]-p)/_),Math.round((o[3]-g)/y)],d=[Math.min(d[0],d[2]),Math.min(d[1],d[3]),Math.max(d[0],d[2]),Math.max(d[1],d[3])]}return h.readRasters({...e,window:d})}}let Ps=class Du extends Fu{constructor(e,r,i,s,n={}){super(),this.source=e,this.littleEndian=r,this.bigTiff=i,this.firstIFDOffset=s,this.cache=n.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,r){const i=this.bigTiff?4048:1024;return new sx((await this.source.fetch([{offset:e,length:typeof r<"u"?r:i}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const r=this.bigTiff?20:12,i=this.bigTiff?8:2;let s=await this.getSlice(e);const n=this.bigTiff?s.readUint64(e):s.readUint16(e),a=n*r+(this.bigTiff?16:6);s.covers(e,a)||(s=await this.getSlice(e,a));const o={};let l=e+(this.bigTiff?8:2);for(let u=0;u<n;l+=r,++u){const d=s.readUint16(l),p=s.readUint16(l+2),g=this.bigTiff?s.readUint64(l+4):s.readUint32(l+4);let _,y;const v=Vn(p),E=l+(this.bigTiff?12:8);if(v*g<=(this.bigTiff?8:4))_=Mr(s,p,g,E);else{const T=s.readOffset(E),w=Vn(p)*g;if(s.covers(T,w))_=Mr(s,p,g,T);else{const b=await this.getSlice(T,w);_=Mr(b,p,g,T)}}g===1&&Fy.indexOf(d)===-1&&!(p===se.RATIONAL||p===se.SRATIONAL)?y=_[0]:y=_,o[Ei[d]]=y}const h=Ax(o),c=s.readOffset(e+i+r*n);return new Ix(o,h,c)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(r){throw r instanceof rs?new rs(e):r}return this.ifdRequests[e]=(async()=>{const r=await this.ifdRequests[e-1];if(r.nextIFDByteOffset===0)throw new rs(e);return this.parseFileDirectoryAt(r.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const r=await this.requestIFD(e);return new Ou(r.fileDirectory,r.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,r=!0;for(;r;)try{await this.requestIFD(e),++e}catch(i){if(i instanceof rs)r=!1;else throw i}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const r="GDAL_STRUCTURAL_METADATA_SIZE=",i=r.length+100;let s=await this.getSlice(e,i);if(r===Mr(s,se.ASCII,r.length,e)){const a=Mr(s,se.ASCII,i,e).split(`
`)[0],o=Number(a.split("=")[1].split(" ")[0])+a.length;o>i&&(s=await this.getSlice(e,o));const l=Mr(s,se.ASCII,o,e);this.ghostValues={},l.split(`
`).filter(h=>h.length>0).map(h=>h.split("=")).forEach(([h,c])=>{this.ghostValues[h]=c})}return this.ghostValues}static async fromSource(e,r,i){const s=(await e.fetch([{offset:0,length:1024}],i))[0],n=new ix(s),a=n.getUint16(0,0);let o;if(a===18761)o=!0;else if(a===19789)o=!1;else throw new TypeError("Invalid byte order value.");const l=n.getUint16(2,o);let h;if(l===42)h=!1;else if(l===43){if(h=!0,n.getUint16(4,o)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const c=h?n.getUint64(8,o):n.getUint32(4,o);return new Du(e,o,h,c,r)}close(){return typeof this.source.close=="function"?this.source.close():!1}};class Lx extends Fu{constructor(e,r){super(),this.mainFile=e,this.overviewFiles=r,this.imageFiles=[e].concat(r),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(r=>r.parseFileDirectoryAt(r.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let r=0,i=0;for(let s=0;s<this.imageFiles.length;s++){const n=this.imageFiles[s];for(let a=0;a<this.imageCounts[s];a++){if(e===r){const o=await n.requestIFD(i);return new Ou(o.fileDirectory,o.geoKeyDirectory,n.dataView,n.littleEndian,n.cache,n.source)}r++,i++}i=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(r=>r.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((r,i)=>r+i,0),this.imageCount}}async function Cx(t,e={},r){return Ps.fromSource(Hn(t,e),r)}async function Ox(t,e){return Ps.fromSource(Px(t),e)}async function Nx(t,e=[],r={},i){const s=await Ps.fromSource(Hn(t,r),i),n=await Promise.all(e.map(a=>Ps.fromSource(Hn(a,r))));return new Lx(s,n)}function Fx(t){return((t.fileDirectory.NewSubfileType||0)&4)===4}function Dx(t,e){if(!t)return!1;if(t===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const r=e.fileDirectory.PhotometricInterpretation,i=Je;return r===i.CMYK||r===i.YCbCr||r===i.CIELab||r===i.ICCLab}const Sl="STATISTICS_MAXIMUM",Ml="STATISTICS_MINIMUM",yn=256;let xn;function Gx(){return xn||(xn=new ox),xn}function Ux(t){try{return t.getBoundingBox()}catch{return[0,0,t.getWidth(),t.getHeight()]}}function Bx(t){try{return t.getOrigin().slice(0,2)}catch{return[0,t.getHeight()]}}function zx(t,e){try{return t.getResolution(e)}catch{return[e.getWidth()/t.getWidth(),e.getHeight()/t.getHeight()]}}function kx(t){const e=t.geoKeys;if(!e)return null;if(e.ProjectedCSTypeGeoKey&&e.ProjectedCSTypeGeoKey!==32767){const r="EPSG:"+e.ProjectedCSTypeGeoKey;let i=de(r);if(!i){const s=Lo(e.ProjLinearUnitsGeoKey);s&&(i=new Fn({code:r,units:s}))}return i}if(e.GeographicTypeGeoKey&&e.GeographicTypeGeoKey!==32767){const r="EPSG:"+e.GeographicTypeGeoKey;let i=de(r);if(!i){const s=Lo(e.GeogAngularUnitsGeoKey);s&&(i=new Fn({code:r,units:s}))}return i}return null}function $x(t){return t.getImageCount().then(function(e){const r=new Array(e);for(let i=0;i<e;++i)r[i]=t.getImage(i);return Promise.all(r)})}function jx(t,e){let r;return t.blob?r=Ox(t.blob):t.overviews?r=Nx(t.url,t.overviews,e):r=Cx(t.url,e),r.then($x)}function di(t,e,r,i,s){if(Array.isArray(t)){const n=t.length;if(!Array.isArray(e)||n!=e.length){const a=new Error(i);throw s(a),a}for(let a=0;a<n;++a)di(t[a],e[a],r,i,s);return}if(e=e,Math.abs(t-e)>r*t)throw new Error(i)}function qx(t){return t instanceof Int8Array?-128:t instanceof Int16Array?-32768:t instanceof Int32Array?-2147483648:t instanceof Float32Array?12e-39:0}function Zx(t){return t instanceof Int8Array?127:t instanceof Uint8Array||t instanceof Uint8ClampedArray?255:t instanceof Int16Array?32767:t instanceof Uint16Array?65535:t instanceof Int32Array?2147483647:t instanceof Uint32Array?4294967295:t instanceof Float32Array?34e37:255}class Gu extends Za{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,opaque:e.opaque,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const r=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(r),this.sourceMasks_=new Array(r),this.resolutionFactors_=new Array(r),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map(n=>n.url).join(","));const i=this,s=new Array(r);for(let n=0;n<r;++n)s[n]=jx(this.sourceInfo_[n],this.sourceOptions_);Promise.all(s).then(function(n){i.configure_(n)}).catch(function(n){vs(n),i.error_=n,i.setState("error")})}getError(){return this.error_}determineProjection(e){const r=e[0];for(let i=r.length-1;i>=0;--i){const s=r[i],n=kx(s);if(n){this.projection=n;break}}}configure_(e){let r,i,s,n,a;const o=new Array(e.length),l=new Array(e.length),h=new Array(e.length);let c=0;const u=e.length;for(let _=0;_<u;++_){const y=[],v=[];e[_].forEach(C=>{Fx(C)?v.push(C):y.push(C)});const E=y.length;if(v.length>0&&v.length!==E)throw new Error(`Expected one mask per image found ${v.length} masks and ${E} images`);let T,w;const b=new Array(E),A=new Array(E),I=new Array(E);l[_]=new Array(E),h[_]=new Array(E);for(let C=0;C<E;++C){const G=y[C],U=G.getGDALNoData();h[_][C]=G.getGDALMetadata(0),l[_][C]=U;const X=this.sourceInfo_[_].bands;o[_]=X?X.length:G.getSamplesPerPixel();const V=E-(C+1);T||(T=Ux(G)),w||(w=Bx(G));const f=zx(G,y[0]);I[V]=f[0];const m=[G.getTileWidth(),G.getTileHeight()];m[0]!==m[1]&&m[1]<yn&&(m[0]=yn,m[1]=yn),b[V]=m;const x=f[0]/Math.abs(f[1]);A[V]=[m[0],m[1]/x]}if(r?Ct(r,T,r):r=T,!i)i=w;else{const C=`Origin mismatch for source ${_}, got [${w}] but expected [${i}]`;di(i,w,0,C,this.viewRejector)}if(!a)a=I,this.resolutionFactors_[_]=1;else{a.length-c>I.length&&(c=a.length-I.length);const C=a[a.length-1]/I[I.length-1];this.resolutionFactors_[_]=C;const G=I.map(X=>X*=C),U=`Resolution mismatch for source ${_}, got [${G}] but expected [${a}]`;di(a.slice(c,a.length),G,.02,U,this.viewRejector)}s?di(s.slice(c,s.length),A,.01,`Tile size mismatch for source ${_}`,this.viewRejector):s=A,n?di(n.slice(c,n.length),b,0,`Tile size mismatch for source ${_}`,this.viewRejector):n=b,this.sourceImagery_[_]=y.reverse(),this.sourceMasks_[_]=v.reverse()}for(let _=0,y=this.sourceImagery_.length;_<y;++_){const v=this.sourceImagery_[_];for(;v.length<a.length;)v.unshift(void 0)}this.getProjection()||this.determineProjection(e),this.samplesPerPixel_=o,this.nodataValues_=l,this.metadata_=h;e:for(let _=0;_<u;++_){if(this.sourceInfo_[_].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[_].length){this.addAlpha_=!0;break}const y=l[_],v=this.sourceInfo_[_].bands;if(v){for(let E=0;E<v.length;++E)if(y[v[E]-1]!==null){this.addAlpha_=!0;break e}continue}for(let E=0;E<y.length;++E)if(y[E]!==null){this.addAlpha_=!0;break e}}let d=this.addAlpha_?1:0;for(let _=0;_<u;++_)d+=o[_];this.bandCount=d;const p=new ks({extent:r,minZoom:c,origin:i,resolutions:a,tileSizes:s});this.tileGrid=p,this.setTileSizes(n),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const g=1;a.length===2?a=[a[0],a[1],a[1]/2]:a.length===1&&(a=[a[0]*2,a[0],a[0]/2]),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:a,center:Vf(Jt(r),this.projection),extent:Yf(r,this.projection),zoom:g})}loadTile_(e,r,i){const s=this.getTileSize(e),n=this.sourceImagery_.length,a=new Array(n*2),o=this.nodataValues_,l=this.sourceInfo_,h=Gx();for(let c=0;c<n;++c){const u=l[c],d=this.resolutionFactors_[c],p=[Math.round(r*(s[0]*d)),Math.round(i*(s[1]*d)),Math.round((r+1)*(s[0]*d)),Math.round((i+1)*(s[1]*d))],g=this.sourceImagery_[c][e];let _;u.bands&&(_=u.bands.map(function(w){return w-1}));let y;"nodata"in u&&u.nodata!==null?y=u.nodata:_?y=_.map(function(w){return o[c][w]}):y=o[c];const v={window:p,width:s[0],height:s[1],samples:_,fillValue:y,pool:h,interleave:!1};Dx(this.convertToRGB_,g)?a[c]=g.readRGB(v):a[c]=g.readRasters(v);const E=n+c,T=this.sourceMasks_[c][e];if(!T){a[E]=Promise.resolve(null);continue}a[E]=T.readRasters({window:p,width:s[0],height:s[1],samples:[0],pool:h,interleave:!1})}return Promise.all(a).then(this.composeTile_.bind(this,s)).catch(function(c){throw vs(c),c})}composeTile_(e,r){const i=this.metadata_,s=this.sourceInfo_,n=this.sourceImagery_.length,a=this.bandCount,o=this.samplesPerPixel_,l=this.nodataValues_,h=this.normalize_,c=this.addAlpha_,u=e[0]*e[1],d=u*a;let p;h?p=new Uint8Array(d):p=new Float32Array(d);let g=0;for(let _=0;_<u;++_){let y=c;for(let v=0;v<n;++v){const E=s[v];let T=E.min,w=E.max,b,A;if(h){const I=i[v][0];T===void 0&&(I&&Ml in I?T=parseFloat(I[Ml]):T=qx(r[v][0])),w===void 0&&(I&&Sl in I?w=parseFloat(I[Sl]):w=Zx(r[v][0])),b=255/(w-T),A=-T*b}for(let I=0;I<o[v];++I){const C=r[v][I][_];let G;if(h?G=Pe(b*C+A,0,255):G=C,!c)p[g]=G;else{let U=E.nodata;if(U===void 0){let V;E.bands?V=E.bands[I]-1:V=I,U=l[v][V]}const X=isNaN(U);(!X&&C!==U||X&&!isNaN(C))&&(y=!1,p[g]=G)}g++}if(!y){const I=n+v,C=r[I];C&&!C[0][_]&&(y=!0)}}c&&(y||(p[g]=255),g++)}return p}}Gu.prototype.getView;const Uu=Gu;let Bu=class extends fa{constructor(e,r,i,s,n,a,o){super(r,i,s,n,a,o),this.zoomifyImage_=null,this.tileSize_=e}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=super.getImage();if(this.state==ee.LOADED){const r=this.tileSize_;if(e.width==r[0]&&e.height==r[1])return this.zoomifyImage_=e,e;const i=Zt(r[0],r[1]);return i.drawImage(e,0,0),this.zoomifyImage_=i.canvas,i.canvas}return e}};class Wx extends vr{constructor(e){const r=e.size,i=e.tierSizeCalculation!==void 0?e.tierSizeCalculation:"default",s=e.tilePixelRatio||1,n=r[0],a=r[1],o=[],l=e.tileSize||Dn;let h=l*s;switch(i){case"default":for(;n>h||a>h;)o.push([Math.ceil(n/h),Math.ceil(a/h)]),h+=h;break;case"truncated":let A=n,I=a;for(;A>h||I>h;)o.push([Math.ceil(A/h),Math.ceil(I/h)]),A>>=1,I>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}o.push([1,1]),o.reverse();const c=[s],u=[0];for(let A=1,I=o.length;A<I;A++)c.push(s<<A),u.push(o[A-1][0]*o[A-1][1]+u[A-1]);c.reverse();const d=new ks({tileSize:l,extent:e.extent||[0,-a,n,0],resolutions:c});let p=e.url;p&&!p.includes("{TileGroup}")&&!p.includes("{tileIndex}")&&(p+="{TileGroup}/{z}-{x}-{y}.jpg");const g=Kf(p);let _=l*s;function y(A){return function(I,C,G){if(!I)return;const U=I[0],X=I[1],V=I[2],f=X+V*o[U][0],m=(f+u[U])/_|0,x={z:U,x:X,y:V,tileIndex:f,TileGroup:"TileGroup"+m};return A.replace(/\{(\w+?)\}/g,function(S,L){return x[L]})}}const v=Th(g.map(y)),E=Bu.bind(null,Ot(l*s));super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,tilePixelRatio:s,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:E,tileGrid:d,tileUrlFunction:v,transition:e.transition}),this.zDirection=e.zDirection;const T=d.getTileCoordForCoordAndResolution(Jt(d.getExtent()),c[c.length-1]),w=v(T,1,null),b=new Image;b.addEventListener("error",()=>{_=l,this.changed()}),b.src=w}}const Xx=Wx;function oi(t){return t.toLocaleString("en",{maximumFractionDigits:10})}class Hx extends vr{constructor(e){const r=e||{};let i=r.url||"";i=i+(i.lastIndexOf("/")===i.length-1||i===""?"":"/");const s=r.version||De.VERSION2,n=r.sizes||[],a=r.size;Gt(a!=null&&Array.isArray(a)&&a.length==2&&!isNaN(a[0])&&a[0]>0&&!isNaN(a[1])&&a[1]>0,"Missing or invalid `size`");const o=a[0],l=a[1],h=r.tileSize,c=r.tilePixelRatio||1,u=r.format||"jpg",d=r.quality||(r.version==De.VERSION1?"native":"default");let p=r.resolutions||[];const g=r.supports||[],_=r.extent||[0,-l,o,0],y=n!=null&&Array.isArray(n)&&n.length>0,v=h!==void 0&&(typeof h=="number"&&Number.isInteger(h)&&h>0||Array.isArray(h)&&h.length>0),E=g!=null&&Array.isArray(g)&&(g.includes("regionByPx")||g.includes("regionByPct"))&&(g.includes("sizeByWh")||g.includes("sizeByH")||g.includes("sizeByW")||g.includes("sizeByPct"));let T,w,b;if(p.sort(function(G,U){return U-G}),v||E)if(h!=null&&(typeof h=="number"&&Number.isInteger(h)&&h>0?(T=h,w=h):Array.isArray(h)&&h.length>0&&((h.length==1||h[1]==null&&Number.isInteger(h[0]))&&(T=h[0],w=h[0]),h.length==2&&(Number.isInteger(h[0])&&Number.isInteger(h[1])?(T=h[0],w=h[1]):h[0]==null&&Number.isInteger(h[1])&&(T=h[1],w=h[1])))),(T===void 0||w===void 0)&&(T=Dn,w=Dn),p.length==0){b=Math.max(Math.ceil(Math.log(o/T)/Math.LN2),Math.ceil(Math.log(l/w)/Math.LN2));for(let G=b;G>=0;G--)p.push(Math.pow(2,G))}else{const G=Math.max(...p);b=Math.round(Math.log(G)/Math.LN2)}else if(T=o,w=l,p=[],y){n.sort(function(U,X){return U[0]-X[0]}),b=-1;const G=[];for(let U=0;U<n.length;U++){const X=o/n[U][0];if(p.length>0&&p[p.length-1]==X){G.push(U);continue}p.push(X),b++}if(G.length>0)for(let U=0;U<G.length;U++)n.splice(G[U]-U,1)}else p.push(1),n.push([o,l]),b=0;const A=new ks({tileSize:[T,w],extent:_,origin:Qf(_),resolutions:p}),I=function(G,U,X){let V,f;const m=G[0];if(m>b)return;const x=G[1],S=G[2],L=p[m];if(!(x===void 0||S===void 0||L===void 0||x<0||Math.ceil(o/L/T)<=x||S<0||Math.ceil(l/L/w)<=S)){if(E||v){const O=x*T*L,N=S*w*L;let F=T*L,k=w*L,H=T,ue=w;if(O+F>o&&(F=o-O),N+k>l&&(k=l-N),O+T*L>o&&(H=Math.floor((o-O+L-1)/L)),N+w*L>l&&(ue=Math.floor((l-N+L-1)/L)),O==0&&F==o&&N==0&&k==l)V="full";else if(!E||g.includes("regionByPx"))V=O+","+N+","+F+","+k;else if(g.includes("regionByPct")){const he=oi(O/o*100),ge=oi(N/l*100),ce=oi(F/o*100),Se=oi(k/l*100);V="pct:"+he+","+ge+","+ce+","+Se}s==De.VERSION3&&(!E||g.includes("sizeByWh"))?f=H+","+ue:!E||g.includes("sizeByW")?f=H+",":g.includes("sizeByH")?f=","+ue:g.includes("sizeByWh")?f=H+","+ue:g.includes("sizeByPct")&&(f="pct:"+oi(100/L))}else if(V="full",y){const O=n[m][0],N=n[m][1];s==De.VERSION3?O==o&&N==l?f="max":f=O+","+N:O==o?f="full":f=O+","}else f=s==De.VERSION3?"max":"full";return i+V+"/"+f+"/0/"+d+"."+u}},C=Bu.bind(null,Ot(h||256).map(function(G){return G*c}));super({attributions:r.attributions,attributionsCollapsible:r.attributionsCollapsible,cacheSize:r.cacheSize,crossOrigin:r.crossOrigin,interpolate:r.interpolate,projection:r.projection,reprojectionErrorThreshold:r.reprojectionErrorThreshold,state:r.state,tileClass:C,tileGrid:A,tilePixelRatio:r.tilePixelRatio,tileUrlFunction:I,transition:r.transition}),this.zDirection=r.zDirection}}const Vx=Hx;function zu(t,e,r,i,s,n){const a=s.getCode().split(/:(?=\d+$)/).pop(),o=r/i,l=[Co(ht(e)/o,Oo),Co(ir(e)/o,Oo)];n.SIZE=l[0]+","+l[1],n.BBOX=e.join(","),n.BBOXSR=a,n.IMAGESR=a,n.DPI=Math.round(n.DPI?n.DPI*i:90*i);const h=t.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");if(h==t)throw new Error("`options.featureTypes` should be an Array");return Mh(h,n)}function ku(t){const e=t.load?t.load:Qr,r=de(t.projection||"EPSG:3857");return function(i,s,n){n=t.hidpi?n:1;const a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(a,t.params),i=Sh(i,s,n,t.ratio);const o=zu(t.url,i,s,n,r,a),l=new Image;return t.crossOrigin!==null&&(l.crossOrigin=t.crossOrigin),e(l,o).then(h=>{const c=ht(i)/h.width*n;return{image:h,extent:i,resolution:c,pixelRatio:n}})}}class Yx extends Er{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:ma,this.params_=e.params||{},this.image_=null,this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,r,i,s){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==s)&&(this.loaderProjection_=s,this.loader=ku({crossOrigin:this.crossOrigin_,params:this.params_,projection:s,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(n,a)=>(this.image.setImage(n),this.imageLoadFunction_(this.image,a),Qr(n))})),super.getImageInternal(e,r,i,s))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.image_=null,this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.image_=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.image_=null,this.changed()}}const Kx=Yx;class Qx extends Er{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions,state:e.state}),this.canvasFunction_=e.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5}getImageInternal(e,r,i,s){r=this.findNearestResolution(r);let n=this.canvas_;if(n&&this.renderedRevision_==this.getRevision()&&n.getResolution()==r&&n.getPixelRatio()==i&&cs(n.getExtent(),e))return n;e=e.slice(),xh(e,this.ratio_);const a=ht(e)/r,o=ir(e)/r,l=[a*i,o*i],h=this.canvasFunction_.call(this,e,r,i,l,s);return h&&(n=new ka(e,r,i,h)),this.canvas_=n,this.renderedRevision_=this.getRevision(),n}}const Jx=Qx;function e1(t,e,r,i){const s=ht(t),n=ir(t),a=e[0],o=e[1],l=.0254/i;return o*s>a*n?s*r/(a*l):n*r/(o*l)}function t1(t,e,r,i,s,n,a){const o=e1(r,i,n,a),l=Jt(r),h={OPERATION:s?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:a,SETDISPLAYWIDTH:Math.round(i[0]),SETDISPLAYHEIGHT:Math.round(i[1]),SETVIEWSCALE:o,SETVIEWCENTERX:l[0],SETVIEWCENTERY:l[1]};return Object.assign(h,e),Mh(t,h)}function $u(t){const e=t.load||Qr;return function(r,i,s){const n=new Image;t.crossOrigin!==null&&(n.crossOrigin=t.crossOrigin),r=Sh(r,i,s,t.ratio);const a=ht(r)/i,o=ir(r)/i,l=[a*s,o*s],h=t1(t.url,t.params,r,l,t.useOverlay,t.metersPerUnit||1,t.displayDpi||96);return e(n,h).then(c=>({image:c,extent:r,pixelRatio:s}))}}class r1 extends Er{constructor(e){super({interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.displayDpi_=e.displayDpi!==void 0?e.displayDpi:96,this.params_=e.params||{},this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:ma,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.metersPerUnit_=e.metersPerUnit!==void 0?e.metersPerUnit:1,this.ratio_=e.ratio!==void 0?e.ratio:1,this.useOverlay_=e.useOverlay!==void 0?e.useOverlay:!1,this.image_=null,this.renderedRevision_=0,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,r,i,s){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==s)&&(this.loaderProjection_=s,this.loader=$u({crossOrigin:this.crossOrigin_,params:this.params_,hidpi:this.hidpi_,metersPerUnit:this.metersPerUnit_,url:this.url_,useOverlay:this.useOverlay_,ratio:this.ratio_,load:(n,a)=>(this.image.setImage(n),this.imageLoadFunction_(this.image,a),Qr(n))})),super.getImageInternal(e,r,i,s))}getImageLoadFunction(){return this.imageLoadFunction_}updateParams(e){Object.assign(this.params_,e),this.changed()}setImageLoadFunction(e){this.image_=null,this.imageLoadFunction_=e,this.changed()}}const i1=r1;function ju(t){const e=t.load||Qr,r=t.imageExtent,i=new Image;return t.crossOrigin!==null&&(i.crossOrigin=t.crossOrigin),()=>e(i,t.url).then(s=>{const n=ht(r)/s.width,a=ir(r)/s.height;return{image:s,extent:r,resolution:n!==a?[n,a]:a,pixelRatio:1}})}class s1 extends Er{constructor(e){const r=e.crossOrigin!==void 0?e.crossOrigin:null,i=e.imageLoadFunction!==void 0?e.imageLoadFunction:ma;super({attributions:e.attributions,interpolate:e.interpolate,projection:de(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new yh(this.imageExtent_,void 0,1,ju({url:e.url,imageExtent:e.imageExtent,crossOrigin:r,load:(s,n)=>(this.image.setImage(s),i(this.image,n),Qr(s))})),this.image.addEventListener(it.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,r,i,s){return qr(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}const qu=s1;function lo(t,e,r,i){const s=document.createElement("script"),n="olc_"+Fe(e);function a(){delete window[n],s.parentNode.removeChild(s)}s.async=!0,s.src=t+(t.includes("?")?"&":"?")+(i||"callback")+"="+n;const o=setTimeout(function(){a(),r&&r()},1e4);window[n]=function(l){clearTimeout(o),a(),e(l)},document.head.appendChild(s)}class n1 extends Error{constructor(e){const r="Unexpected response status: "+e.status;super(r),this.name="ResponseError",this.response=e}}class a1 extends Error{constructor(e){super("Failed to issue request"),this.name="ClientError",this.client=e}}function Zu(t){return new Promise(function(e,r){function i(a){const o=a.target;if(!o.status||o.status>=200&&o.status<300){let l;try{l=JSON.parse(o.responseText)}catch(h){const c="Error parsing response text as JSON: "+h.message;r(new Error(c));return}e(l);return}r(new n1(o))}function s(a){r(new a1(a.target))}const n=new XMLHttpRequest;n.addEventListener("load",i),n.addEventListener("error",s),n.open("GET",t),n.setRequestHeader("Accept","application/json"),n.send()})}function Wu(t,e){return e.includes("://")?e:new URL(e,t).href}const o1={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},l1={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function h1(t,e){let r,i;for(let s=0;s<t.length;++s){const n=t[s];if(n.rel==="item"){if(n.type===e){r=n.href;break}(o1[n.type]||!i&&n.type.startsWith("image/"))&&(i=n.href)}}if(!r)if(i)r=i;else throw new Error('Could not find "item" link');return r}function u1(t,e,r){let i,s;const n={};for(let a=0;a<t.length;++a){const o=t[a];if(n[o.type]=o.href,o.rel==="item"){if(o.type===e){i=o.href;break}l1[o.type]&&(s=o.href)}}if(!i&&r)for(let a=0;a<r.length;++a){const o=r[a];if(n[o]){i=n[o];break}}if(!i)if(s)i=s;else throw new Error('Could not find "item" link');return i}function bl(t,e,r,i){let s=t.projection;if(!s&&(s=de(e.crs),!s))throw new Error(`Unsupported CRS: ${e.crs}`);const n=s.getAxisOrientation().substr(0,2)!=="en",a=e.tileMatrices,o={};for(let w=0;w<a.length;++w){const b=a[w];o[b.id]=b}const l={},h=[];if(i)for(let w=0;w<i.length;++w){const b=i[w],A=b.tileMatrix;h.push(A),l[A]=b}else for(let w=0;w<a.length;++w){const b=a[w].id;h.push(b)}const c=h.length,u=new Array(c),d=new Array(c),p=new Array(c),g=new Array(c),_=[-1/0,-1/0,1/0,1/0];for(let w=0;w<c;++w){const b=h[w],A=o[b],I=A.pointOfOrigin;n?u[w]=[I[1],I[0]]:u[w]=I,d[w]=A.cellSize,p[w]=[A.matrixWidth,A.matrixHeight],g[w]=[A.tileWidth,A.tileHeight];const C=l[b];if(C){const G=A.cellSize*A.tileWidth,U=u[w][0]+C.minTileCol*G,X=u[w][0]+(C.maxTileCol+1)*G,V=A.cellSize*A.tileHeight,f=A.cornerOfOrigin==="bottomLeft";let m,x;f?(m=u[w][1]+C.minTileRow*V,x=u[w][1]+(C.maxTileRow+1)*V):(m=u[w][1]-(C.maxTileRow+1)*V,x=u[w][1]-C.minTileRow*V),Ct(_,[U,m,X,x],_)}}const y=new ks({origins:u,resolutions:d,sizes:p,tileSizes:g,extent:i?_:void 0}),v=t.context,E=t.url;function T(w,b,A){if(!w)return;const I=h[w[0]],C=o[I],G=C.cornerOfOrigin==="bottomLeft",U={tileMatrix:I,tileCol:w[1],tileRow:G?-w[2]-1:w[2]};if(i){const V=l[C.id];if(U.tileCol<V.minTileCol||U.tileCol>V.maxTileCol||U.tileRow<V.minTileRow||U.tileRow>V.maxTileRow)return}Object.assign(U,v);const X=r.replace(/\{(\w+?)\}/g,function(V,f){return U[f]});return Wu(E,X)}return{grid:y,urlTemplate:r,urlFunction:T}}function c1(t,e){const r=e.tileMatrixSetLimits;let i;if(e.dataType==="map")i=h1(e.links,t.mediaType);else if(e.dataType==="vector")i=u1(e.links,t.mediaType,t.supportedMediaTypes);else throw new Error('Expected tileset data type to be "map" or "vector"');if(e.tileMatrixSet)return bl(t,e.tileMatrixSet,i,r);const s=e.links.find(o=>o.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!s)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const n=s.href,a=Wu(t.url,n);return Zu(a).then(function(o){return bl(t,o,i,r)})}function Xu(t){return Zu(t.url).then(function(e){return c1(t,e)})}class f1 extends vr{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition});const r={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,context:e.context||null};Xu(r).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){vs(e),this.setState("error")}}const d1=f1;class g1 extends $s{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,format:e.format,overlaps:e.overlaps,projection:e.projection,tileClass:e.tileClass,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection,state:"loading"});const r={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,supportedMediaTypes:e.format.supportedMediaTypes,context:e.context||null};Xu(r).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){vs(e),this.setState("error")}}const p1=g1;let Hu=!0;try{new ImageData(10,10)}catch{Hu=!1}let vn;function m1(t,e,r){if(Hu)return new ImageData(t,e,r);vn||(vn=document.createElement("canvas").getContext("2d"));const i=vn.createImageData(e,r);return i.data.set(t),i}function Vu(t){let e=!0;try{new ImageData(10,10)}catch{e=!1}function r(i,s,n){return e?new ImageData(i,s,n):{data:i,width:s,height:n}}return function(i){const s=i.buffers,n=i.meta,a=i.imageOps,o=i.width,l=i.height,h=s.length,c=s[0].byteLength;if(a){const g=new Array(h);for(let y=0;y<h;++y)g[y]=r(new Uint8ClampedArray(s[y]),o,l);return t(g,n).data.buffer}const u=new Uint8ClampedArray(c),d=new Array(h),p=new Array(h);for(let g=0;g<h;++g)d[g]=new Uint8ClampedArray(s[g]),p[g]=[0,0,0,0];for(let g=0;g<c;g+=4){for(let y=0;y<h;++y){const v=d[y];p[y][0]=v[g],p[y][1]=v[g+1],p[y][2]=v[g+2],p[y][3]=v[g+3]}const _=t(p,n);u[g]=_[0],u[g+1]=_[1],u[g+2]=_[2],u[g+3]=_[3]}return u.buffer}}function _1(t,e){const i=Object.keys(t.lib||{}).map(function(n){return"const "+n+" = "+t.lib[n].toString()+";"}).concat(["const __minion__ = ("+Vu.toString()+")(",t.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),s=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(i.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(i,{type:"text/javascript"})));return s.addEventListener("message",e),s}function y1(t,e){const r=Vu(t.operation);let i=!1;return{postMessage:function(s){setTimeout(function(){i||e({data:{buffer:r(s),meta:s.meta}})},0)},terminate:function(){i=!0}}}class x1 extends ch{constructor(e){super(),this._imageOps=!!e.imageOps;let r;e.threads===0?r=0:this._imageOps?r=1:r=e.threads||1;const i=new Array(r);if(r)for(let s=0;s<r;++s)i[s]=_1(e,this._onWorkerMessage.bind(this,s));else i[0]=y1(e,this._onWorkerMessage.bind(this,0));this._workers=i,this._queue=[],this._maxQueueLength=e.queue||1/0,this._running=0,this._dataLookup={},this._job=null}process(e,r,i){this._enqueue({inputs:e,meta:r,callback:i}),this._dispatch()}_enqueue(e){for(this._queue.push(e);this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)}_dispatch(){if(this._running||this._queue.length===0)return;const e=this._queue.shift();this._job=e;const r=e.inputs[0].width,i=e.inputs[0].height,s=e.inputs.map(function(l){return l.data.buffer}),n=this._workers.length;if(this._running=n,n===1){this._workers[0].postMessage({buffers:s,meta:e.meta,imageOps:this._imageOps,width:r,height:i},s);return}const a=e.inputs[0].data.length,o=4*Math.ceil(a/4/n);for(let l=0;l<n;++l){const h=l*o,c=[];for(let u=0,d=s.length;u<d;++u)c.push(s[u].slice(h,h+o));this._workers[l].postMessage({buffers:c,meta:e.meta,imageOps:this._imageOps,width:r,height:i},c)}}_onWorkerMessage(e,r){this.disposed||(this._dataLookup[e]=r.data,--this._running,this._running===0&&this._resolveJob())}_resolveJob(){const e=this._job,r=this._workers.length;let i,s;if(r===1)i=new Uint8ClampedArray(this._dataLookup[0].buffer),s=this._dataLookup[0].meta;else{const n=e.inputs[0].data.length;i=new Uint8ClampedArray(n),s=new Array(r);const a=4*Math.ceil(n/4/r);for(let o=0;o<r;++o){const l=this._dataLookup[o].buffer,h=o*a;i.set(new Uint8ClampedArray(l),h),s[o]=this._dataLookup[o].meta}}this._job=null,this._dataLookup={},e.callback(null,m1(i,e.inputs[0].width,e.inputs[0].height),s),this._dispatch()}disposeInternal(){for(let e=0;e<this._workers.length;++e)this._workers[e].terminate();this._workers.length=0}}const Rl={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class Pl extends bh{constructor(e,r,i){super(e),this.extent=r.extent,this.resolution=r.viewState.resolution/r.pixelRatio,this.data=i}}class Yu extends Er{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=e.operationType!==void 0?e.operationType:"pixel",this.threads_=e.threads!==void 0?e.threads:1,this.layers_=w1(e.sources);const r=this.changed.bind(this);for(let i=0,s=this.layers_.length;i<s;++i)this.layers_[i].addEventListener(it.CHANGE,r);this.useResolutions_=e.resolutions!==null,this.tileQueue_=new Jf(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:wt(),declutterTree:null,extent:null,index:0,layerIndex:0,layerStatesArray:E1(this.layers_),pixelRatio:1,pixelToCoordinateTransform:wt(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:Fe(this),renderTargets:{}},this.setAttributions(function(i){const s=[];for(let n=0,a=e.sources.length;n<a;++n){const o=e.sources[n],l=o instanceof _a?o:o.getSource();if(!l)continue;const h=l.getAttributions();if(typeof h=="function"){const c=h(i);s.push.apply(s,c)}}return s.length!==0?s:null}),e.operation!==void 0&&this.setOperation(e.operation,e.lib)}setOperation(e,r){this.processor_&&this.processor_.dispose(),this.processor_=new x1({operation:e,imageOps:this.operationType_==="image",queue:1,lib:r,threads:this.threads_}),this.changed()}updateFrameState_(e,r,i){const s=Object.assign({},this.frameState_);s.viewState=Object.assign({},s.viewState);const n=Jt(e);s.size[0]=Math.ceil(ht(e)/r),s.size[1]=Math.ceil(ir(e)/r),s.extent=[n[0]-s.size[0]*r/2,n[1]-s.size[1]*r/2,n[0]+s.size[0]*r/2,n[1]+s.size[1]*r/2],s.time=Date.now();const a=s.viewState;return a.center=n,a.projection=i,a.resolution=r,s}allSourcesReady_(){let e=!0,r;for(let i=0,s=this.layers_.length;i<s;++i)if(r=this.layers_[i].getSource(),!r||r.getState()!=="ready"){e=!1;break}return e}getImage(e,r,i,s){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),r=this.findNearestResolution(r);const n=this.updateFrameState_(e,r,s);if(this.requestedFrameState_=n,this.renderedImageCanvas_){const a=this.renderedImageCanvas_.getResolution(),o=this.renderedImageCanvas_.getExtent();(r!==a||!ms(n.extent,o))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),n.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const e=this.requestedFrameState_,r=this.layers_.length,i=new Array(r);for(let n=0;n<r;++n){e.layerIndex=n,e.renderTargets={};const a=v1(this.layers_[n],e);if(a)i[n]=a;else return}const s={};this.dispatchEvent(new Pl(Rl.BEFOREOPERATIONS,e,s)),this.processor_.process(i,s,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,r,i,s){if(r||!i)return;const n=e.extent,a=e.viewState.resolution;if(a!==this.requestedFrameState_.viewState.resolution||!ms(n,this.requestedFrameState_.extent))return;let o;if(this.renderedImageCanvas_)o=this.renderedImageCanvas_.getImage().getContext("2d");else{const l=Math.round(ht(n)/a),h=Math.round(ir(n)/a);o=Zt(l,h),this.renderedImageCanvas_=new ka(n,a,1,o.canvas)}o.putImageData(i,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new Pl(Rl.AFTEROPERATIONS,e,s))}getResolutions(e){if(!this.useResolutions_)return null;let r=super.getResolutions();if(!r)for(let i=0,s=this.layers_.length;i<s&&(r=this.layers_[i].getSource().getResolutions(e),!r);++i);return r}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}Yu.prototype.dispose;let ur=null;function v1(t,e){const r=t.getRenderer();if(!r)throw new Error("Unsupported layer type: "+t);if(!r.prepareFrame(e))return null;const i=e.size[0],s=e.size[1];if(i===0||s===0)return null;const n=r.renderFrame(e,null);let a;if(n instanceof HTMLCanvasElement)a=n;else{if(n&&(a=n.firstElementChild),!(a instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+a);if(a.width===i&&a.height===s)return a.getContext("2d").getImageData(0,0,i,s)}if(!ur)ur=Zt(i,s,void 0,{willReadFrequently:!0});else{const o=ur.canvas;o.width!==i||o.height!==s?ur=Zt(i,s,void 0,{willReadFrequently:!0}):ur.clearRect(0,0,i,s)}return ur.drawImage(a,0,0,i,s),ur.getImageData(0,0,i,s)}function E1(t){return t.map(function(e){return e.getLayerState()})}function w1(t){const e=t.length,r=new Array(e);for(let i=0;i<e;++i)r[i]=T1(t[i]);return r}function T1(t){let e;return t instanceof _a?t instanceof zs?e=new ys({source:t}):t instanceof Er&&(e=new ga({source:t})):e=t,e}const S1=Yu,M1='&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>',b1='&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>',R1='&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>',P1={stamen_terrain:{extension:"png",opaque:!0},stamen_terrain_background:{extension:"png",opaque:!0},stamen_terrain_labels:{extension:"png",opaque:!1},stamen_terrain_lines:{extension:"png",opaque:!1},stamen_toner_background:{extension:"png",opaque:!0},stamen_toner:{extension:"png",opaque:!0},stamen_toner_labels:{extension:"png",opaque:!1},stamen_toner_lines:{extension:"png",opaque:!1},stamen_toner_lite:{extension:"png",opaque:!0},stamen_watercolor:{extension:"jpg",opaque:!0},alidade_smooth:{extension:"png",opaque:!0},alidade_smooth_dark:{extension:"png",opaque:!0},outdoors:{extension:"png",opaque:!0},osm_bright:{extension:"png",opaque:!0}},A1={stamen_terrain:{minZoom:0,maxZoom:18,retina:!0},stamen_toner:{minZoom:0,maxZoom:20,retina:!0},stamen_watercolor:{minZoom:1,maxZoom:18,retina:!1}};class I1 extends Wr{constructor(e){const r=e.layer.indexOf("-"),i=r==-1?e.layer:e.layer.slice(0,r),s=A1[i]||{minZoom:0,maxZoom:20,retina:!0},n=P1[e.layer],a=e.apiKey?"?api_key="+e.apiKey:"",o=s.retina&&e.retina?"@2x":"",l=e.url!==void 0?e.url:"https://tiles.stadiamaps.com/tiles/"+e.layer+"/{z}/{x}/{y}"+o+"."+n.extension+a,h=[M1,b1,ed];e.layer.startsWith("stamen_")&&h.splice(1,0,R1),super({attributions:h,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:s.maxZoom,minZoom:e.minZoom!==void 0?e.minZoom:s.minZoom,opaque:n.opaque,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:l,tilePixelRatio:o?2:1,wrapX:e.wrapX,zDirection:e.zDirection})}}const L1=I1;class C1 extends vr{constructor(e){e=e||{},super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.params_=e.params||{},this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=ua(),this.setKey(this.getKeyForParams_())}getKeyForParams_(){let e=0;const r=[];for(const i in this.params_)r[e++]=i+"-"+this.params_[i];return r.join("/")}getParams(){return this.params_}getRequestUrl_(e,r,i,s,n,a){const o=this.urls;if(!o)return;let l;if(o.length==1)l=o[0];else{const h=td(rd(e),o.length);l=o[h]}return zu(l,i,(this.tileGrid||this.getTileGridForProjection(n)).getResolution(e[0]),s,n,a)}getTilePixelRatio(e){return this.hidpi_?e:1}updateParams(e){Object.assign(this.params_,e),this.setKey(this.getKeyForParams_())}tileUrlFunction(e,r,i){let s=this.getTileGrid();if(s||(s=this.getTileGridForProjection(i)),s.getResolutions().length<=e[0])return;r!=1&&!this.hidpi_&&(r=1);const n=s.getTileCoordExtent(e,this.tmpExtent_);let a=Ot(s.getTileSize(e[0]),this.tmpSize);r!=1&&(a=id(a,r,this.tmpSize));const o={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(o,this.params_),this.getRequestUrl_(e,a,n,r,i,o)}}const O1=C1;class N1 extends Wr{constructor(e){e=e||{},super({opaque:!1,projection:e.projection,tileGrid:e.tileGrid,wrapX:e.wrapX!==void 0?e.wrapX:!0,zDirection:e.zDirection,url:e.template||"z:{z} x:{x} y:{y}",tileLoadFunction:(r,i)=>{const s=r.getTileCoord()[0],n=Ot(this.tileGrid.getTileSize(s)),a=Zt(n[0],n[1]);a.strokeStyle="grey",a.strokeRect(.5,.5,n[0]+.5,n[1]+.5),a.fillStyle="grey",a.strokeStyle="white",a.textAlign="center",a.textBaseline="middle",a.font="24px sans-serif",a.lineWidth=4,a.strokeText(i,n[0]/2,n[1]/2,n[0]),a.fillText(i,n[0]/2,n[1]/2,n[0]),r.setImage(a.canvas)}})}}const F1=N1;class D1 extends vr{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:de("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)lo(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const r=new XMLHttpRequest;r.addEventListener("load",this.onXHRLoad_.bind(this)),r.addEventListener("error",this.onXHRError_.bind(this)),r.open("GET",e.url),r.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const r=e.target;if(!r.status||r.status>=200&&r.status<300){let i;try{i=JSON.parse(r.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(i)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const r=de("EPSG:4326"),i=this.getProjection();let s;if(e.bounds!==void 0){const h=pa(r,i);s=bi(e.bounds,h)}const n=Us(i),a=e.minzoom||0,o=e.maxzoom||22,l=Bs({extent:n,maxZoom:o,minZoom:a,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=Rh(e.tiles,l),e.attribution&&!this.getAttributions()){const h=s!==void 0?s:n;this.setAttributions(function(c){return qr(h,c.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}}const Ku=D1;class G1 extends ph{constructor(e,r,i,s,n,a){super(e,r),this.src_=i,this.extent_=s,this.preemptive_=n,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=a}getImage(){return null}getData(e){if(!this.grid_||!this.keys_)return null;const r=(e[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),i=(e[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),s=this.grid_[Math.floor((1-i)*this.grid_.length)];if(typeof s!="string")return null;let n=s.charCodeAt(Math.floor(r*s.length));n>=93&&n--,n>=35&&n--,n-=32;let a=null;if(n in this.keys_){const o=this.keys_[n];this.data_&&o in this.data_?a=this.data_[o]:a=o}return a}forDataAtCoordinate(e,r,i){this.state==ee.EMPTY&&i===!0?(this.state=ee.IDLE,nd(this,it.CHANGE,function(s){r(this.getData(e))},this),this.loadInternal_()):i===!0?setTimeout(()=>{r(this.getData(e))},0):r(this.getData(e))}getKey(){return this.src_}handleError_(){this.state=ee.ERROR,this.changed()}handleLoad_(e){this.grid_=e.grid,this.keys_=e.keys,this.data_=e.data,this.state=ee.LOADED,this.changed()}loadInternal_(){if(this.state==ee.IDLE)if(this.state=ee.LOADING,this.jsonp_)lo(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",this.src_),e.send()}}onXHRLoad_(e){const r=e.target;if(!r.status||r.status>=200&&r.status<300){let i;try{i=JSON.parse(r.responseText)}catch{this.handleError_();return}this.handleLoad_(i)}else this.handleError_()}onXHRError_(e){this.handleError_()}load(){this.preemptive_?this.loadInternal_():this.setState(ee.EMPTY)}}class U1 extends zs{constructor(e){if(super({projection:de("EPSG:3857"),state:"loading",zDirection:e.zDirection}),this.preemptive_=e.preemptive!==void 0?e.preemptive:!0,this.tileUrlFunction_=sd,this.template_=void 0,this.jsonp_=e.jsonp||!1,e.url)if(this.jsonp_)lo(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const r=new XMLHttpRequest;r.addEventListener("load",this.onXHRLoad_.bind(this)),r.addEventListener("error",this.onXHRError_.bind(this)),r.open("GET",e.url),r.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const r=e.target;if(!r.status||r.status>=200&&r.status<300){let i;try{i=JSON.parse(r.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(i)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTemplate(){return this.template_}forDataAtCoordinateAndResolution(e,r,i,s){if(this.tileGrid){const n=this.tileGrid.getZForResolution(r,this.zDirection),a=this.tileGrid.getTileCoordForCoordAndZ(e,n);this.getTile(a[0],a[1],a[2],1,this.getProjection()).forDataAtCoordinate(e,i,s)}else s===!0?setTimeout(function(){i(null)},0):i(null)}handleTileJSONError(){this.setState("error")}handleTileJSONResponse(e){const r=de("EPSG:4326"),i=this.getProjection();let s;if(e.bounds!==void 0){const c=pa(r,i);s=bi(e.bounds,c)}const n=Us(i),a=e.minzoom||0,o=e.maxzoom||22,l=Bs({extent:n,maxZoom:o,minZoom:a});this.tileGrid=l,this.template_=e.template;const h=e.grids;if(!h){this.setState("error");return}if(this.tileUrlFunction_=Rh(h,l),e.attribution!==void 0){const c=s!==void 0?s:n;this.setAttributions(function(u){return qr(c,u.extent)?[e.attribution]:null})}this.setState("ready")}getTile(e,r,i,s,n){const a=xs(e,r,i);if(this.tileCache.containsKey(a))return this.tileCache.get(a);const o=[e,r,i],l=this.getTileCoordForTileUrlFunction(o,n),h=this.tileUrlFunction_(l,s,n),c=new G1(o,h!==void 0?ee.IDLE:ee.EMPTY,h!==void 0?h:"",this.tileGrid.getTileCoordExtent(o),this.preemptive_,this.jsonp_);return this.tileCache.set(a,c),c}useTile(e,r,i){const s=xs(e,r,i);this.tileCache.containsKey(s)&&this.tileCache.get(s)}}const B1=U1;function z1(t,e){const r=new mh(32),i=t.getExtent();return function(s,n){r.expireCache(),i&&(s=Ct(i,s));const a=t.getZForResolution(n),o=[];return t.forEachTileCoord(s,a,l=>{const h=l.toString();if(!r.containsKey(h)){const c=e(l);r.set(h,c)}o.push(r.get(h))}),o}}const k1=Object.freeze(Object.defineProperty({__proto__:null,BingMaps:K_,CartoDB:J_,Cluster:ty,DataTile:Za,GeoTIFF:Uu,IIIF:Vx,Image:Er,ImageArcGISRest:Kx,ImageCanvas:Jx,ImageMapGuide:i1,ImageStatic:qu,ImageWMS:ad,OGCMapTile:d1,OGCVectorTile:p1,OSM:od,Raster:S1,Source:_a,StadiaMaps:L1,Tile:zs,TileArcGISRest:O1,TileDebug:F1,TileImage:vr,TileJSON:Ku,TileWMS:Ph,UTFGrid:B1,UrlTile:ld,Vector:Gs,VectorTile:$s,WMTS:Ah,XYZ:Wr,Zoomify:Xx,createArcGISRestLoader:ku,createMapGuideLoader:$u,createStaticLoader:ju,createWMSLoader:hd,sourcesFromTileGrid:z1},Symbol.toStringTag,{value:"Module"}));window.eoxMapAdvancedOlFormats=f0;var Ye=(t,e,r)=>new Promise((i,s)=>{var n=l=>{try{o(r.next(l))}catch(h){s(h)}},a=l=>{try{o(r.throw(l))}catch(h){s(h)}},o=l=>l.done?i(l.value):Promise.resolve(l.value).then(n,a);o((r=r.apply(t,e)).next())}),ot=Uint8Array,Nr=Uint16Array,$1=Int32Array,Qu=new ot([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ju=new ot([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),j1=new ot([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ec=function(t,e){for(var r=new Nr(31),i=0;i<31;++i)r[i]=e+=1<<t[i-1];for(var s=new $1(r[30]),i=1;i<30;++i)for(var n=r[i];n<r[i+1];++n)s[n]=n-r[i]<<5|i;return{b:r,r:s}},tc=ec(Qu,2),rc=tc.b,q1=tc.r;rc[28]=258,q1[258]=28;var Z1=ec(Ju,0),W1=Z1.b,Yn=new Nr(32768);for(ve=0;ve<32768;++ve)zt=(ve&43690)>>1|(ve&21845)<<1,zt=(zt&52428)>>2|(zt&13107)<<2,zt=(zt&61680)>>4|(zt&3855)<<4,Yn[ve]=((zt&65280)>>8|(zt&255)<<8)>>1;var zt,ve,wi=function(t,e,r){for(var i=t.length,s=0,n=new Nr(e);s<i;++s)t[s]&&++n[t[s]-1];var a=new Nr(e);for(s=1;s<e;++s)a[s]=a[s-1]+n[s-1]<<1;var o;if(r){o=new Nr(1<<e);var l=15-e;for(s=0;s<i;++s)if(t[s])for(var h=s<<4|t[s],c=e-t[s],u=a[t[s]-1]++<<c,d=u|(1<<c)-1;u<=d;++u)o[Yn[u]>>l]=h}else for(o=new Nr(i),s=0;s<i;++s)t[s]&&(o[s]=Yn[a[t[s]-1]++]>>15-t[s]);return o},ki=new ot(288);for(ve=0;ve<144;++ve)ki[ve]=8;var ve;for(ve=144;ve<256;++ve)ki[ve]=9;var ve;for(ve=256;ve<280;++ve)ki[ve]=7;var ve;for(ve=280;ve<288;++ve)ki[ve]=8;var ve,ic=new ot(32);for(ve=0;ve<32;++ve)ic[ve]=5;var ve,X1=wi(ki,9,1),H1=wi(ic,5,1),En=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},xt=function(t,e,r){var i=e/8|0;return(t[i]|t[i+1]<<8)>>(e&7)&r},wn=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(e&7)},V1=function(t){return(t+7)/8|0},Y1=function(t,e,r){(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length);var i=new ot(r-e);return i.set(t.subarray(e,r)),i},K1=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],at=function(t,e,r){var i=new Error(e||K1[t]);if(i.code=t,Error.captureStackTrace&&Error.captureStackTrace(i,at),!r)throw i;return i},ho=function(t,e,r,i){var s=t.length,n=i?i.length:0;if(!s||e.f&&!e.l)return r||new ot(0);var a=!r||e.i!=2,o=e.i;r||(r=new ot(s*3));var l=function($e){var Ue=r.length;if($e>Ue){var He=new ot(Math.max(Ue*2,$e));He.set(r),r=He}},h=e.f||0,c=e.p||0,u=e.b||0,d=e.l,p=e.d,g=e.m,_=e.n,y=s*8;do{if(!d){h=xt(t,c,1);var v=xt(t,c+1,3);if(c+=3,v)if(v==1)d=X1,p=H1,g=9,_=5;else if(v==2){var b=xt(t,c,31)+257,A=xt(t,c+10,15)+4,I=b+xt(t,c+5,31)+1;c+=14;for(var C=new ot(I),G=new ot(19),U=0;U<A;++U)G[j1[U]]=xt(t,c+U*3,7);c+=A*3;for(var X=En(G),V=(1<<X)-1,f=wi(G,X,1),U=0;U<I;){var m=f[xt(t,c,V)];c+=m&15;var E=m>>4;if(E<16)C[U++]=E;else{var x=0,S=0;for(E==16?(S=3+xt(t,c,3),c+=2,x=C[U-1]):E==17?(S=3+xt(t,c,7),c+=3):E==18&&(S=11+xt(t,c,127),c+=7);S--;)C[U++]=x}}var L=C.subarray(0,b),O=C.subarray(b);g=En(L),_=En(O),d=wi(L,g,1),p=wi(O,_,1)}else at(1);else{var E=V1(c)+4,T=t[E-4]|t[E-3]<<8,w=E+T;if(w>s){o&&at(0);break}a&&l(u+T),r.set(t.subarray(E,w),u),e.b=u+=T,e.p=c=w*8,e.f=h;continue}if(c>y){o&&at(0);break}}a&&l(u+131072);for(var N=(1<<g)-1,F=(1<<_)-1,k=c;;k=c){var x=d[wn(t,c)&N],H=x>>4;if(c+=x&15,c>y){o&&at(0);break}if(x||at(2),H<256)r[u++]=H;else if(H==256){k=c,d=null;break}else{var ue=H-254;if(H>264){var U=H-257,he=Qu[U];ue=xt(t,c,(1<<he)-1)+rc[U],c+=he}var ge=p[wn(t,c)&F],ce=ge>>4;ge||at(3),c+=ge&15;var O=W1[ce];if(ce>3){var he=Ju[ce];O+=wn(t,c)&(1<<he)-1,c+=he}if(c>y){o&&at(0);break}a&&l(u+131072);var Se=u+ue;if(u<O){var ze=n-O,Ce=Math.min(O,Se);for(ze+u<0&&at(3);u<Ce;++u)r[u]=i[ze+u]}for(;u<Se;u+=4)r[u]=r[u-O],r[u+1]=r[u+1-O],r[u+2]=r[u+2-O],r[u+3]=r[u+3-O];u=Se}}e.l=d,e.p=k,e.b=u,e.f=h,d&&(h=1,e.m=g,e.d=p,e.n=_)}while(!h);return u==r.length?r:Y1(r,0,u)},Q1=new ot(0),J1=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&at(6,"invalid gzip data");var e=t[3],r=10;e&4&&(r+=(t[10]|t[11]<<8)+2);for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!t[r++]);return r+(e&2)},ev=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},tv=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&at(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&at(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function rv(t,e){return ho(t,{i:2},e&&e.out,e&&e.dictionary)}function iv(t,e){var r=J1(t);return r+8>t.length&&at(6,"invalid gzip data"),ho(t.subarray(r,-8),{i:2},e&&e.out||new ot(ev(t)),e&&e.dictionary)}function sv(t,e){return ho(t.subarray(tv(t,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Kn(t,e){return t[0]==31&&t[1]==139&&t[2]==8?iv(t,e):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?rv(t,e):sv(t,e)}var nv=typeof TextDecoder<"u"&&new TextDecoder,av=0;try{nv.decode(Q1,{stream:!0}),av=1}catch{}var sc=(t,e)=>t*Math.pow(2,e),li=(t,e)=>Math.floor(t/Math.pow(2,e)),As=(t,e)=>sc(t.getUint16(e+1,!0),8)+t.getUint8(e),nc=(t,e)=>sc(t.getUint32(e+2,!0),16)+t.getUint16(e,!0),ov=(t,e,r,i,s)=>{if(t!=i.getUint8(s))return t-i.getUint8(s);const n=As(i,s+1);if(e!=n)return e-n;const a=As(i,s+4);return r!=a?r-a:0},lv=(t,e,r,i)=>{const s=ac(t,e|128,r,i);return s?{z:e,x:r,y:i,offset:s[0],length:s[1],is_dir:!0}:null},Al=(t,e,r,i)=>{const s=ac(t,e,r,i);return s?{z:e,x:r,y:i,offset:s[0],length:s[1],is_dir:!1}:null},ac=(t,e,r,i)=>{let s=0,n=t.byteLength/17-1;for(;s<=n;){const a=n+s>>1,o=ov(e,r,i,t,a*17);if(o>0)s=a+1;else if(o<0)n=a-1;else return[nc(t,a*17+7),t.getUint32(a*17+13,!0)]}return null},hv=(t,e)=>t.is_dir&&!e.is_dir?1:!t.is_dir&&e.is_dir?-1:t.z!==e.z?t.z-e.z:t.x!==e.x?t.x-e.x:t.y-e.y,oc=(t,e)=>{const r=t.getUint8(e*17);return{z:r&127,x:As(t,e*17+1),y:As(t,e*17+4),offset:nc(t,e*17+7),length:t.getUint32(e*17+13,!0),is_dir:r>>7===1}},Il=t=>{const e=[],r=new DataView(t);for(let i=0;i<r.byteLength/17;i++)e.push(oc(r,i));return uv(e)},uv=t=>{t.sort(hv);const e=new ArrayBuffer(17*t.length),r=new Uint8Array(e);for(let i=0;i<t.length;i++){const s=t[i];let n=s.z;s.is_dir&&(n=n|128),r[i*17]=n,r[i*17+1]=s.x&255,r[i*17+2]=s.x>>8&255,r[i*17+3]=s.x>>16&255,r[i*17+4]=s.y&255,r[i*17+5]=s.y>>8&255,r[i*17+6]=s.y>>16&255,r[i*17+7]=s.offset&255,r[i*17+8]=li(s.offset,8)&255,r[i*17+9]=li(s.offset,16)&255,r[i*17+10]=li(s.offset,24)&255,r[i*17+11]=li(s.offset,32)&255,r[i*17+12]=li(s.offset,48)&255,r[i*17+13]=s.length&255,r[i*17+14]=s.length>>8&255,r[i*17+15]=s.length>>16&255,r[i*17+16]=s.length>>24&255}return e},cv=(t,e)=>{if(t.byteLength<17)return null;const r=t.byteLength/17,i=oc(t,r-1);if(i.is_dir){const s=i.z,n=e.z-s,a=Math.trunc(e.x/(1<<n)),o=Math.trunc(e.y/(1<<n));return{z:s,x:a,y:o}}return null};function fv(t){return Ye(this,null,function*(){const e=yield t.getBytes(0,512e3),r=new DataView(e.data),i=r.getUint32(4,!0),s=r.getUint16(8,!0),n=new TextDecoder("utf-8"),a=JSON.parse(n.decode(new DataView(e.data,10,i)));let o=0;a.compression==="gzip"&&(o=2);let l=0;"minzoom"in a&&(l=+a.minzoom);let h=0;"maxzoom"in a&&(h=+a.maxzoom);let c=0,u=0,d=0,p=-180,g=-85,_=180,y=85;if(a.bounds){const E=a.bounds.split(",");p=+E[0],g=+E[1],_=+E[2],y=+E[3]}if(a.center){const E=a.center.split(",");c=+E[0],u=+E[1],d=+E[2]}return{specVersion:r.getUint16(2,!0),rootDirectoryOffset:10+i,rootDirectoryLength:s*17,jsonMetadataOffset:10,jsonMetadataLength:i,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:o,tileType:1,minZoom:l,maxZoom:h,minLon:p,minLat:g,maxLon:_,maxLat:y,centerZoom:d,centerLon:c,centerLat:u,etag:e.etag}})}function dv(t,e,r,i,s,n,a){return Ye(this,null,function*(){let o=yield r.getArrayBuffer(e,t.rootDirectoryOffset,t.rootDirectoryLength,t);t.specVersion===1&&(o=Il(o));const l=Al(new DataView(o),i,s,n);if(l){let u=(yield e.getBytes(l.offset,l.length,a)).data;const d=new DataView(u);return d.getUint8(0)==31&&d.getUint8(1)==139&&(u=Kn(new Uint8Array(u))),{data:u}}const h=cv(new DataView(o),{z:i,x:s,y:n});if(h){const c=lv(new DataView(o),h.z,h.x,h.y);if(c){let u=yield r.getArrayBuffer(e,c.offset,c.length,t);t.specVersion===1&&(u=Il(u));const d=Al(new DataView(u),i,s,n);if(d){let g=(yield e.getBytes(d.offset,d.length,a)).data;const _=new DataView(g);return _.getUint8(0)==31&&_.getUint8(1)==139&&(g=Kn(new Uint8Array(g))),{data:g}}}}})}var lc={getHeader:fv,getZxy:dv};function br(t,e){return(e>>>0)*4294967296+(t>>>0)}function gv(t,e){const r=e.buf;let i,s;if(s=r[e.pos++],i=(s&112)>>4,s<128||(s=r[e.pos++],i|=(s&127)<<3,s<128)||(s=r[e.pos++],i|=(s&127)<<10,s<128)||(s=r[e.pos++],i|=(s&127)<<17,s<128)||(s=r[e.pos++],i|=(s&127)<<24,s<128)||(s=r[e.pos++],i|=(s&1)<<31,s<128))return br(t,i);throw new Error("Expected varint not more than 10 bytes")}function hi(t){const e=t.buf;let r,i;return i=e[t.pos++],r=i&127,i<128||(i=e[t.pos++],r|=(i&127)<<7,i<128)||(i=e[t.pos++],r|=(i&127)<<14,i<128)||(i=e[t.pos++],r|=(i&127)<<21,i<128)?r:(i=e[t.pos],r|=(i&15)<<28,gv(r,t))}function pv(t,e,r,i){if(i==0){r==1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const s=e[0];e[0]=e[1],e[1]=s}}var mv=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function _v(t,e,r){if(t>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,t)-1||r>Math.pow(2,t)-1)throw Error("tile x/y outside zoom level bounds");const i=mv[t],s=Math.pow(2,t);let n=0,a=0,o=0;const l=[e,r];let h=s/2;for(;h>0;)n=(l[0]&h)>0?1:0,a=(l[1]&h)>0?1:0,o+=h*h*(3*n^a),pv(h,l,n,a),h=h/2;return i+o}function hc(t,e){return Ye(this,null,function*(){if(e===1||e===0)return t;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Kn(new Uint8Array(t));{let i=new Response(t).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(i).arrayBuffer()}}else throw Error("Compression method not supported")})}var Ar=(t=>(t[t.Unknown=0]="Unknown",t[t.Mvt=1]="Mvt",t[t.Png=2]="Png",t[t.Jpeg=3]="Jpeg",t[t.Webp=4]="Webp",t[t.Avif=5]="Avif",t))(Ar||{}),yv=127;function xv(t,e){let r=0,i=t.length-1;for(;r<=i;){const s=i+r>>1,n=e-t[s].tileId;if(n>0)r=s+1;else if(n<0)i=s-1;else return t[s]}return i>=0&&(t[i].runLength===0||e-t[i].tileId<t[i].runLength)?t[i]:null}var vv=class{constructor(t,e=new Headers){this.url=t,this.customHeaders=e}getKey(){return this.url}setHeaders(t){this.customHeaders=t}getBytes(t,e,r){return Ye(this,null,function*(){let i;r||(i=new AbortController,r=i.signal);const s=new Headers(this.customHeaders);s.set("Range","bytes="+t+"-"+(t+e-1));let n=yield fetch(this.url,{signal:r,headers:s});if(n.status===416&&t===0){const l=n.headers.get("Content-Range");if(!l||!l.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const h=+l.substr(8);n=yield fetch(this.url,{signal:r,headers:{Range:"bytes=0-"+(h-1)}})}if(n.status>=300)throw Error("Bad response code: "+n.status);const a=n.headers.get("Content-Length");if(n.status===200&&(!a||+a>e))throw i&&i.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield n.arrayBuffer(),etag:n.headers.get("ETag")||void 0,cacheControl:n.headers.get("Cache-Control")||void 0,expires:n.headers.get("Expires")||void 0}})}};function vt(t,e){const r=t.getUint32(e+4,!0),i=t.getUint32(e+0,!0);return r*Math.pow(2,32)+i}function Ev(t,e){const r=new DataView(t),i=r.getUint8(7);if(i>3)throw Error(`Archive is spec version ${i} but this library supports up to spec version 3`);return{specVersion:i,rootDirectoryOffset:vt(r,8),rootDirectoryLength:vt(r,16),jsonMetadataOffset:vt(r,24),jsonMetadataLength:vt(r,32),leafDirectoryOffset:vt(r,40),leafDirectoryLength:vt(r,48),tileDataOffset:vt(r,56),tileDataLength:vt(r,64),numAddressedTiles:vt(r,72),numTileEntries:vt(r,80),numTileContents:vt(r,88),clustered:r.getUint8(96)===1,internalCompression:r.getUint8(97),tileCompression:r.getUint8(98),tileType:r.getUint8(99),minZoom:r.getUint8(100),maxZoom:r.getUint8(101),minLon:r.getInt32(102,!0)/1e7,minLat:r.getInt32(106,!0)/1e7,maxLon:r.getInt32(110,!0)/1e7,maxLat:r.getInt32(114,!0)/1e7,centerZoom:r.getUint8(118),centerLon:r.getInt32(119,!0)/1e7,centerLat:r.getInt32(123,!0)/1e7,etag:e}}function uc(t){const e={buf:new Uint8Array(t),pos:0},r=hi(e),i=[];let s=0;for(let n=0;n<r;n++){const a=hi(e);i.push({tileId:s+a,offset:0,length:0,runLength:1}),s+=a}for(let n=0;n<r;n++)i[n].runLength=hi(e);for(let n=0;n<r;n++)i[n].length=hi(e);for(let n=0;n<r;n++){const a=hi(e);a===0&&n>0?i[n].offset=i[n-1].offset+i[n-1].length:i[n].offset=a-1}return i}function wv(t){const e=new DataView(t);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var Fr=class extends Error{};function Tv(t,e,r,i){return Ye(this,null,function*(){const s=yield t.getBytes(0,16384);if(new DataView(s.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(wv(s.data)<3)return[yield lc.getHeader(t)];const a=s.data.slice(0,yv);let o=s.etag;i&&s.etag!=i&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+t.getKey()),o=void 0);const l=Ev(a,o);if(r){const h=s.data.slice(l.rootDirectoryOffset,l.rootDirectoryOffset+l.rootDirectoryLength),c=t.getKey()+"|"+(l.etag||"")+"|"+l.rootDirectoryOffset+"|"+l.rootDirectoryLength,u=uc(yield e(h,l.internalCompression));return[l,[c,u.length,u]]}return[l,void 0]})}function Sv(t,e,r,i,s){return Ye(this,null,function*(){const n=yield t.getBytes(r,i);if(s.etag&&s.etag!==n.etag)throw new Fr(n.etag);const a=yield e(n.data,s.internalCompression),o=uc(a);if(o.length===0)throw new Error("Empty directory is invalid");return o})}var Mv=class{constructor(t=100,e=!0,r=hc){this.cache=new Map,this.maxCacheEntries=t,this.counter=1,this.prefetch=e,this.decompress=r}getHeader(t,e){return Ye(this,null,function*(){const r=t.getKey();if(this.cache.has(r))return this.cache.get(r).lastUsed=this.counter++,yield this.cache.get(r).data;const i=new Promise((s,n)=>{Tv(t,this.decompress,this.prefetch,e).then(a=>{a[1]&&this.cache.set(a[1][0],{lastUsed:this.counter++,data:Promise.resolve(a[1][2])}),s(a[0]),this.prune()}).catch(a=>{n(a)})});return this.cache.set(r,{lastUsed:this.counter++,data:i}),i})}getDirectory(t,e,r,i){return Ye(this,null,function*(){const s=t.getKey()+"|"+(i.etag||"")+"|"+e+"|"+r;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const n=new Promise((a,o)=>{Sv(t,this.decompress,e,r,i).then(l=>{a(l),this.prune()}).catch(l=>{o(l)})});return this.cache.set(s,{lastUsed:this.counter++,data:n}),n})}getArrayBuffer(t,e,r,i){return Ye(this,null,function*(){const s=t.getKey()+"|"+(i.etag||"")+"|"+e+"|"+r;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const n=new Promise((a,o)=>{t.getBytes(e,r).then(l=>{if(i.etag&&i.etag!==l.etag)throw new Fr(l.etag);a(l.data),this.cache.has(s),this.prune()}).catch(l=>{o(l)})});return this.cache.set(s,{lastUsed:this.counter++,data:n}),n})}prune(){if(this.cache.size>=this.maxCacheEntries){let t=1/0,e;this.cache.forEach((r,i)=>{r.lastUsed<t&&(t=r.lastUsed,e=i)}),e&&this.cache.delete(e)}}invalidate(t,e){return Ye(this,null,function*(){this.cache.delete(t.getKey()),yield this.getHeader(t,e)})}},uo=class{constructor(t,e,r){typeof t=="string"?this.source=new vv(t):this.source=t,r?this.decompress=r:this.decompress=hc,e?this.cache=e:this.cache=new Mv}getHeader(){return Ye(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(t,e,r,i){return Ye(this,null,function*(){const s=_v(t,e,r),n=yield this.cache.getHeader(this.source);if(n.specVersion<3)return lc.getZxy(n,this.source,this.cache,t,e,r,i);if(t<n.minZoom||t>n.maxZoom)return;let a=n.rootDirectoryOffset,o=n.rootDirectoryLength;for(let l=0;l<=3;l++){const h=yield this.cache.getDirectory(this.source,a,o,n),c=xv(h,s);if(c)if(c.runLength>0){const u=yield this.source.getBytes(n.tileDataOffset+c.offset,c.length,i);if(n.etag&&n.etag!==u.etag)throw new Fr(u.etag);return{data:yield this.decompress(u.data,n.tileCompression),cacheControl:u.cacheControl,expires:u.expires}}else a=n.leafDirectoryOffset+c.offset,o=c.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(t,e,r,i){return Ye(this,null,function*(){try{return yield this.getZxyAttempt(t,e,r,i)}catch(s){if(s instanceof Fr)return this.cache.invalidate(this.source,s.message),yield this.getZxyAttempt(t,e,r,i);throw s}})}getMetadataAttempt(){return Ye(this,null,function*(){const t=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(t.jsonMetadataOffset,t.jsonMetadataLength);if(t.etag&&t.etag!==e.etag)throw new Fr(e.etag);const r=yield this.decompress(e.data,t.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(r))})}getMetadata(){return Ye(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(t){if(t instanceof Fr)return this.cache.invalidate(this.source,t.message),yield this.getMetadataAttempt();throw t}})}};class bv extends bh{constructor(e){super(it.ERROR),this.error=e}}class Rv extends Uu{constructor(e){super(e),e.projection&&(this.projection=e.projection)}}class Re{constructor(e){this.name=e}toString(){return this.name}}Re.GeoTIFF=new Re("GeoTIFF");Re.ImageStatic=new Re("ImageStatic");Re.PMTilesRaster=new Re("PMTilesRaster");Re.PMTilesVector=new Re("PMTilesVector");Re.TileJSON=new Re("TileJSON");Re.TileWMS=new Re("TileWMS");Re.WMTS=new Re("WMTS");Re.XYZ=new Re("XYZ");var cc={exports:{}};(function(t,e){(function(r,i){t.exports=i()})(dr,function(){var r=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function i(u,d){return u.indexOf(d)===-1?u.length:u.indexOf(d)}function s(u){var d=u.replace(/^v/,"").replace(/\+.*$/,""),p=i(d,"-"),g=d.substring(0,p).split(".");return g.push(d.substring(p+1)),g}function n(u){return isNaN(Number(u))?u:Number(u)}function a(u){if(typeof u!="string")throw new TypeError("Invalid argument expected string");if(!r.test(u))throw new Error("Invalid argument not valid semver ('"+u+"' received)")}function o(u,d){[u,d].forEach(a);for(var p=s(u),g=s(d),_=0;_<Math.max(p.length-1,g.length-1);_++){var y=parseInt(p[_]||0,10),v=parseInt(g[_]||0,10);if(y>v)return 1;if(v>y)return-1}var E=p[p.length-1],T=g[g.length-1];if(E&&T){var w=E.split(".").map(n),b=T.split(".").map(n);for(_=0;_<Math.max(w.length,b.length);_++){if(w[_]===void 0||typeof b[_]=="string"&&typeof w[_]=="number")return-1;if(b[_]===void 0||typeof w[_]=="string"&&typeof b[_]=="number"||w[_]>b[_])return 1;if(b[_]>w[_])return-1}}else if(E||T)return E?-1:1;return 0}var l=[">",">=","=","<","<="],h={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function c(u){if(typeof u!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof u);if(l.indexOf(u)===-1)throw new TypeError("Invalid operator, expected one of "+l.join("|"))}return o.validate=function(u){return typeof u=="string"&&r.test(u)},o.compare=function(u,d,p){c(p);var g=o(u,d);return h[p].indexOf(g)>-1},o})})(cc);var Pv=cc.exports,Qn=Pv;const co="1.0.0",z=!0,K={classification:"https://stac-extensions.github.io/classification/v1.1.0/schema.json",datacube:"https://stac-extensions.github.io/datacube/v2.1.0/schema.json",eo:"https://stac-extensions.github.io/eo/v1.0.0/schema.json",file:"https://stac-extensions.github.io/file/v1.0.0/schema.json","item-assets":"https://stac-extensions.github.io/item-assets/v1.0.0/schema.json",label:"https://stac-extensions.github.io/label/v1.0.1/schema.json",pointcloud:"https://stac-extensions.github.io/pointcloud/v1.0.0/schema.json",processing:"https://stac-extensions.github.io/processing/v1.1.0/schema.json",projection:"https://stac-extensions.github.io/projection/v1.0.0/schema.json",raster:"https://stac-extensions.github.io/raster/v1.1.0/schema.json",sar:"https://stac-extensions.github.io/sar/v1.0.0/schema.json",sat:"https://stac-extensions.github.io/sat/v1.0.0/schema.json",scientific:"https://stac-extensions.github.io/scientific/v1.0.0/schema.json",table:"https://stac-extensions.github.io/table/v1.2.0/schema.json",timestamps:"https://stac-extensions.github.io/timestamps/v1.0.0/schema.json",version:"https://stac-extensions.github.io/version/v1.0.0/schema.json",view:"https://stac-extensions.github.io/view/v1.0.0/schema.json"},pr={itemAndCollection:{"cube:":K.datacube,"eo:":K.eo,"file:":K.file,"label:":K.label,"pc:":K.pointcloud,"processing:":K.processing,"proj:":K.projection,"raster:":K.raster,"sar:":K.sar,"sat:":K.sat,"sci:":K.scientific,"view:":K.view,version:K.version,deprecated:K.version,published:K.timestamps,expires:K.timestamps,unpublished:K.timestamps},catalog:{},collection:{item_assets:K["item-assets"]},item:{}};pr.collection=Object.assign(pr.collection,pr.itemAndCollection);pr.item=Object.assign(pr.item,pr.itemAndCollection);var gi={parseUrl(t){let e=t.match(/^https?:\/\/stac-extensions.github.io\/([^\/]+)\/v([^\/]+)\/[^.]+.json$/i);if(e)return{id:e[1],version:e[2]}}},pe={version:co,extensions:{},set(t){if(typeof t.stac_version!="string"?pe.version="0.6.0":pe.version=t.stac_version,Array.isArray(t.stac_extensions))for(let e of t.stac_extensions){let r=gi.parseUrl(e);r&&(pe.extensions[r.id]=r.version)}},before(t,e=null){let r=e?pe.extensions[e]:pe.version;return typeof r>"u"?!1:Qn.compare(r,t,"<")}},M={type(t){let e=typeof t;if(e==="object"){if(t===null)return"null";if(Array.isArray(t))return"array"}return e},is(t,e){return M.type(t)===e},isDefined(t){return typeof t<"u"},isObject(t){return typeof t=="object"&&t===Object(t)&&!Array.isArray(t)},rename(t,e,r){return typeof t[e]<"u"&&typeof t[r]>"u"?(t[r]=t[e],delete t[e],!0):!1},forAll(t,e,r){if(t[e]&&typeof t[e]=="object")for(let i in t[e])r(t[e][i])},toArray(t,e){return typeof t[e]<"u"&&!Array.isArray(t[e])?(t[e]=[t[e]],!0):!1},flattenArray(t,e,r,i=!1){if(Array.isArray(t[e])){for(let s in t[e])if(typeof r[s]=="string"){let n=t[e][s];t[r[s]]=i?[n]:n}return delete t[e],!0}return!1},flattenOneElementArray(t,e,r=!1){return!r&&Array.isArray(t[e])?t[e].length===1?(t[e]=t[e][0],!0):!1:!0},removeFromArray(t,e,r){if(Array.isArray(t[e])){let i=t[e].indexOf(r);return i>-1&&t[e].splice(i,1),!0}return!1},ensure(t,e,r){return M.type(r)!==M.type(t[e])&&(t[e]=r),!0},upgradeExtension(t,e){let{id:r,version:i}=gi.parseUrl(e),s=t.stac_extensions.findIndex(n=>{let a=gi.parseUrl(n);return a&&a.id===r&&Qn.compare(a.version,i,"<")});return s!==-1?(t.stac_extensions[s]=e,!0):!1},addExtension(t,e){let{id:r,version:i}=gi.parseUrl(e),s=t.stac_extensions.findIndex(n=>{if(n===e)return!0;let a=gi.parseUrl(n);return!!(a&&a.id===r&&Qn.compare(a.version,i,"<"))});return s===-1?t.stac_extensions.push(e):t.stac_extensions[s]=e,t.stac_extensions.sort(),!0},removeExtension(t,e){return M.removeFromArray(t,"stac_extensions",e)},migrateExtensionShortnames(t){let e=Object.keys(K),r=Object.values(K);return M.mapValues(t,"stac_extensions",e,r)},populateExtensions(t,e){let r=[];(e=="catalog"||e=="collection")&&r.push(t),(e=="item"||e=="collection")&&M.isObject(t.assets)&&(r=r.concat(Object.values(t.assets))),e=="collection"&&M.isObject(t.item_assets)&&(r=r.concat(Object.values(t.item_assets))),e=="collection"&&M.isObject(t.summaries)&&r.push(t.summaries),e=="item"&&M.isObject(t.properties)&&r.push(t.properties);for(let i of r)Object.keys(i).forEach(s=>{let n=s.match(/^(\w+:|[^:]+$)/i);if(Array.isArray(n)){let a=pr[e][n[0]];M.is(a,"string")&&M.addExtension(t,a)}})},mapValues(t,e,r,i){let s=n=>{let a=r.indexOf(n);return a>=0?i[a]:n};return Array.isArray(t[e])?t[e]=t[e].map(s):typeof t[e]<"u"&&(t[e]=s(t[e])),!0},mapObject(t,e){for(let r in t)t[r]=e(t[r],r)},moveTo(t,e,r,i=!1,s=!1){let n;return i?s?n=a=>Array.isArray(a):n=a=>Array.isArray(a)&&a.length===1:n=M.isDefined,n(t[e])?(r[e]=i&&!s?t[e][0]:t[e],delete t[e],!0):!1},runAll(t,e,r,i){for(let s in t)s.startsWith("migrate")||t[s](e,r,i)},toUTC(t,e){if(typeof t[e]=="string")try{return t[e]=this.toISOString(t[e]),!0}catch{}return delete t[e],!1},toISOString(t){return t instanceof Date||(t=new Date(t)),t.toISOString().replace(".000","")}},It={multihash:null,hexToUint8(t){if(t.length===0||t.length%2!==0)throw new Error(`The string "${t}" is not valid hex.`);return new Uint8Array(t.match(/.{1,2}/g).map(e=>parseInt(e,16)))},uint8ToHex(t){return t.reduce((e,r)=>e+r.toString(16).padStart(2,"0"),"")},toMultihash(t,e,r){if(!It.multihash||!M.is(t[e],"string"))return!1;try{const i=It.multihash.encode(It.hexToUint8(t[e]),r);return t[e]=It.uint8ToHex(i),!0}catch(i){return console.warn(i),!1}}},fo={migrate(t,e=!0){return pe.set(t),e&&(t.stac_version=co),t.type="Catalog",M.ensure(t,"stac_extensions",[]),pe.before("1.0.0-rc.1")&&M.migrateExtensionShortnames(t),M.ensure(t,"id",""),M.ensure(t,"description",""),M.ensure(t,"links",[]),M.runAll(fo,t,t),pe.before("0.8.0")&&M.populateExtensions(t,"catalog"),t}},go={migrate(t,e=!0){return fo.migrate(t,e),t.type="Collection",pe.before("1.0.0-rc.1")&&M.migrateExtensionShortnames(t),M.ensure(t,"license","proprietary"),M.ensure(t,"extent",{spatial:{bbox:[]},temporal:{interval:[]}}),M.runAll(go,t,t),M.isObject(t.properties)&&(M.removeFromArray(t,"stac_extensions","commons"),delete t.properties),pe.before("0.8.0")&&M.populateExtensions(t,"collection"),pe.before("1.0.0-beta.1")&&M.mapValues(t,"stac_extensions",["assets"],["item-assets"]),t},extent(t){if(M.ensure(t,"extent",{}),pe.before("0.8.0")&&(Array.isArray(t.extent.spatial)&&(t.extent.spatial={bbox:[t.extent.spatial]}),Array.isArray(t.extent.temporal)&&(t.extent.temporal={interval:[t.extent.temporal]})),M.ensure(t.extent,"spatial",{}),M.ensure(t.extent.spatial,"bbox",[]),M.ensure(t.extent,"temporal",{}),M.ensure(t.extent.temporal,"interval",[]),pe.before("1.0.0-rc.3")){if(t.extent.temporal.interval.length>1){let e,r;for(let i of t.extent.temporal.interval){if(i[0]===null)e=null;else if(typeof i[0]=="string"&&e!==null)try{let s=new Date(i[0]);(typeof e>"u"||s<e)&&(e=s)}catch{}if(i[1]===null)r=null;else if(typeof i[1]=="string"&&r!==null)try{let s=new Date(i[1]);(typeof r>"u"||s>r)&&(r=s)}catch{}}t.extent.temporal.interval.unshift([e?M.toISOString(e):null,r?M.toISOString(r):null])}if(t.extent.spatial.bbox.length>1){let e=t.extent.spatial.bbox.reduce((r,i)=>Array.isArray(i)?Math.max(i.length,r):r,4);if(e>=4){let r=new Array(e).fill(null),i=e/2;for(let s of t.extent.spatial.bbox){if(!Array.isArray(s)||s.length<4)break;for(let n in s){let a=s[n];r[n]===null?r[n]=a:n<i?r[n]=Math.min(a,r[n]):r[n]=Math.max(a,r[n])}}r.findIndex(s=>s===null)===-1&&t.extent.spatial.bbox.unshift(r)}}}},collectionAssets(t){pe.before("1.0.0-rc.1")&&M.removeExtension(t,"collection-assets"),Oi.migrateAll(t)},itemAsset(t){pe.before("1.0.0-beta.2")&&M.rename(t,"item_assets","assets"),Oi.migrateAll(t,"item_assets")},summaries(t){if(M.ensure(t,"summaries",{}),pe.before("0.8.0")&&M.isObject(t.other_properties)){for(let e in t.other_properties){let r=t.other_properties[e];Array.isArray(r.extent)&&r.extent.length===2?t.summaries[e]={minimum:r.extent[0],maximum:r.extent[1]}:Array.isArray(r.values)&&(r.values.filter(i=>Array.isArray(i)).length===r.values.length?t.summaries[e]=r.values.reduce((i,s)=>i.concat(s),[]):t.summaries[e]=r.values)}delete t.other_properties}if(pe.before("1.0.0-beta.1")&&M.isObject(t.properties)&&!t.links.find(e=>["child","item"].includes(e.rel)))for(let e in t.properties){let r=t.properties[e];Array.isArray(r)||(r=[r]),t.summaries[e]=r}pe.before("1.0.0-rc.1")&&M.mapObject(t.summaries,e=>(M.rename(e,"min","minimum"),M.rename(e,"max","maximum"),e)),Qs.migrate(t.summaries,t,!0),M.moveTo(t.summaries,"sci:doi",t,!0)&&M.addExtension(t,K.scientific),M.moveTo(t.summaries,"sci:publications",t,!0,!0)&&M.addExtension(t,K.scientific),M.moveTo(t.summaries,"sci:citation",t,!0)&&M.addExtension(t,K.scientific),M.moveTo(t.summaries,"cube:dimensions",t,!0)&&M.addExtension(t,K.datacube),Object.keys(t.summaries).length===0&&delete t.summaries}},po={migrate(t,e=null,r=!0){pe.set(t),r&&(t.stac_version=co),M.ensure(t,"stac_extensions",[]),pe.before("1.0.0-rc.1")&&M.migrateExtensionShortnames(t),M.ensure(t,"id",""),M.ensure(t,"type","Feature"),M.isObject(t.geometry)||(t.geometry=null),t.geometry!==null&&M.ensure(t,"bbox",[]),M.ensure(t,"properties",{}),M.ensure(t,"links",[]),M.ensure(t,"assets",{});let i=!1;return M.isObject(e)&&M.isObject(e.properties)&&(M.removeFromArray(t,"stac_extensions","commons"),t.properties=Object.assign({},e.properties,t.properties),i=!0),M.runAll(po,t,t),Qs.migrate(t.properties,t),Oi.migrateAll(t),(pe.before("0.8.0")||i)&&M.populateExtensions(t,"item"),t}},fc={migrate(t,e=!0){return M.ensure(t,"collections",[]),M.ensure(t,"links",[]),M.runAll(fc,t,t),t.collections=t.collections.map(r=>go.migrate(r,e)),t}},dc={migrate(t,e=!0){return M.ensure(t,"type","FeatureCollection"),M.ensure(t,"features",[]),M.ensure(t,"links",[]),M.runAll(dc,t,t),t.features=t.features.map(r=>po.migrate(r,null,e)),t}},Oi={migrateAll(t,e="assets"){for(let r in t[e])Oi.migrate(t[e][r],t)},migrate(t,e){return M.runAll(Oi,t,e),Qs.migrate(t,e),t},mediaTypes(t){M.is(t.type,"string")&&M.mapValues(t,"type",["image/vnd.stac.geotiff","image/vnd.stac.geotiff; cloud-optimized=true"],["image/tiff; application=geotiff","image/tiff; application=geotiff; profile=cloud-optimized"])},eo(t,e){let r=M.isObject(e.properties)&&Array.isArray(e.properties["eo:bands"])?e.properties["eo:bands"]:[];if(Array.isArray(t["eo:bands"]))for(let i in t["eo:bands"]){let s=t["eo:bands"][i];M.is(s,"number")&&M.isObject(r[s])?s=r[s]:M.isObject(s)||(s={}),t["eo:bands"][i]=s}}},Qs={migrate(t,e,r=!1){return M.runAll(Qs,t,e,r),t},_commonMetadata(t){pe.before("1.0.0-rc.3")&&(M.toUTC(t,"created"),M.toUTC(t,"updated"))},_timestamps(t,e){M.toUTC(t,"published"),M.toUTC(t,"expires"),M.toUTC(t,"unpublished"),M.upgradeExtension(e,K.timestamps)},_versioningIndicator(t,e){M.upgradeExtension(e,K.version)},checksum(t,e){pe.before("0.9.0")&&It.multihash&&(M.rename(t,"checksum:md5","checksum:multihash")&&It.toMultihash(t,"checksum:multihash","md5"),M.rename(t,"checksum:sha1","checksum:multihash")&&It.toMultihash(t,"checksum:multihash","sha1"),M.rename(t,"checksum:sha2","checksum:multihash")&&It.toMultihash(t,"checksum:multihash","sha2-256"),M.rename(t,"checksum:sha3","checksum:multihash")&&It.toMultihash(t,"checksum:multihash","sha3-256")),pe.before("1.0.0-rc.1")&&M.rename(t,"checksum:multihash","file:checksum")&&M.addExtension(e,K.file),M.removeExtension(e,"checksum")},classification(t,e){pe.before("1.1.0","classification")&&M.forAll(t,"classification:classes",r=>M.rename(r,"color-hint","color_hint")),M.upgradeExtension(e,K.classification)},cube(t,e){M.upgradeExtension(e,K.datacube)},dtr(t,e){pe.before("0.9.0")&&(M.rename(t,"dtr:start_datetime","start_datetime"),M.rename(t,"dtr:end_datetime","end_datetime"),M.removeExtension(e,"datetime-range"))},eo(t,e){pe.before("0.9.0")&&(M.rename(t,"eo:epsg","proj:epsg")&&M.addExtension(e,K.projection),M.rename(t,"eo:platform","platform"),M.rename(t,"eo:instrument","instruments")&&M.toArray(t,"instruments"),M.rename(t,"eo:constellation","constellation"),M.rename(t,"eo:off_nadir","view:off_nadir")&&M.addExtension(e,K.view),M.rename(t,"eo:azimuth","view:azimuth")&&M.addExtension(e,K.view),M.rename(t,"eo:incidence_angle","view:incidence_angle")&&M.addExtension(e,K.view),M.rename(t,"eo:sun_azimuth","view:sun_azimuth")&&M.addExtension(e,K.view),M.rename(t,"eo:sun_elevation","view:sun_elevation")&&M.addExtension(e,K.view)),pe.before("1.0.0-beta.1")&&M.rename(t,"eo:gsd","gsd"),M.upgradeExtension(e,K.eo)},file(t,e){M.upgradeExtension(e,K.file)},label(t,e){pe.before("0.8.0")&&(M.rename(t,"label:property","label:properties"),M.rename(t,"label:task","label:tasks"),M.rename(t,"label:overview","label:overviews")&&M.toArray(t,"label:overviews"),M.rename(t,"label:method","label:methods"),M.toArray(t,"label:classes")),M.upgradeExtension(e,K.label)},pc(t,e){pe.before("0.8.0")&&M.rename(t,"pc:schema","pc:schemas"),M.upgradeExtension(e,K.pointcloud)},processing(t,e){M.upgradeExtension(e,K.processing)},proj(t,e){M.upgradeExtension(e,K.projection)},raster(t,e){M.upgradeExtension(e,K.raster)},sar(t,e,r){M.rename(t,"sar:incidence_angle","view:incidence_angle")&&M.addExtension(e,K.view),M.rename(t,"sar:pass_direction","sat:orbit_state")&&M.mapValues(t,"sat:orbit_state",[null],["geostationary"])&&M.addExtension(e,K.sat),pe.before("0.7.0")&&(M.flattenArray(t,"sar:resolution",["sar:resolution_range","sar:resolution_azimuth"],r),M.flattenArray(t,"sar:pixel_spacing",["sar:pixel_spacing_range","sar:pixel_spacing_azimuth"],r),M.flattenArray(t,"sar:looks",["sar:looks_range","sar:looks_azimuth","sar:looks_equivalent_number"],r),M.rename(t,"sar:off_nadir","view:off_nadir")&&M.addExtension(e,K.view)),pe.before("0.9.0")&&(M.rename(t,"sar:platform","platform"),M.rename(t,"sar:instrument","instruments")&&M.toArray(t,"instruments"),M.rename(t,"sar:constellation","constellation"),M.rename(t,"sar:type","sar:product_type"),M.rename(t,"sar:polarization","sar:polarizations"),M.flattenOneElementArray(t,"sar:absolute_orbit",r)&&M.rename(t,"sar:absolute_orbit","sat:absolute_orbit")&&M.addExtension(e,K.sat),M.flattenOneElementArray(t,"sar:relative_orbit",r)&&M.rename(t,"sar:relative_orbit","sat:relative_orbit")&&M.addExtension(e,K.sat)),M.upgradeExtension(e,K.sar)},sat(t,e){pe.before("0.9.0")&&(M.rename(t,"sat:off_nadir_angle","sat:off_nadir"),M.rename(t,"sat:azimuth_angle","sat:azimuth"),M.rename(t,"sat:sun_azimuth_angle","sat:sun_azimuth"),M.rename(t,"sat:sun_elevation_angle","sat:sun_elevation")),M.upgradeExtension(e,K.sat)},sci(t,e){M.upgradeExtension(e,K.scientific)},item(t){pe.before("0.8.0")&&(M.rename(t,"item:license","license"),M.rename(t,"item:providers","providers"))},table(t,e){M.upgradeExtension(e,K.table)},view(t,e){M.upgradeExtension(e,K.view)}},Ir={item(t,e=null,r=!0){return po.migrate(t,e,r)},catalog(t,e=!0){return fo.migrate(t,e)},collection(t,e=!0){return go.migrate(t,e)},collectionCollection(t,e=!0){return fc.migrate(t,e)},itemCollection(t,e=!0){return dc.migrate(t,e)},stac(t,e=!0){return t.type==="Feature"?Ir.item(t,null,e):t.type==="FeatureCollection"?Ir.itemCollection(t,e):t.type==="Collection"||!t.type&&M.isDefined(t.extent)&&M.isDefined(t.license)?Ir.collection(t,e):!t.type&&Array.isArray(t.collections)?Ir.collectionCollection(t,e):Ir.catalog(t,e)},enableMultihash(t){It.multihash=t}},Av=Ir;const Iv=js(Av);function rt(t){return typeof t=="string"&&t.length>0}function tt(t){return typeof t=="object"&&t===Object(t)&&!Array.isArray(t)}function gc(...t){if(t=t.filter(e=>Array.isArray(e)),t.length>1){let e=Math.max(...t.map(i=>i.length)),r=[];for(let i=0;i<e;i++)r.push(Object.assign({},...t.map(s=>s[i])));return r}else if(t.length===1)return t[0];return[]}function Lv(t){switch(t){case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648}return t.startsWith("u")?0:null}function Cv(t){switch(t){case"int8":return 127;case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295}return null}class Js{constructor(e,r={},i=[]){if(!tt(e))throw new Error("Given data is not an object");if(e instanceof Js){for(let s of i)this[s]=e[s];e=e.toJSON()}this._keyMap=r,this._privateKeys=["_keyMap","_privateKeys"].concat(i);for(let s in e)typeof this[s]>"u"&&(s in r?this[s]=r[s](e[s],this):this[s]=e[s])}isItem(){return this.type==="Feature"}isCatalog(){return this.type==="Catalog"}isCatalogLike(){return this.isCatalog()||this.isCollection()}isCollection(){return this.type==="Collection"}isItemCollection(){return this.type==="FeatureCollection"}isCollectionCollection(){return!1}isAsset(){return!1}isLink(){return!1}getObjectType(){}getAbsoluteUrl(){return null}getMetadata(e){return this[e]}toGeoJSON(){return null}getBoundingBox(){return null}getBoundingBoxes(){return[]}toJSON(){let e={};return Object.keys(this).forEach(r=>{if(typeof this[r]=="function"||this._privateKeys.includes(r))return;let i=this[r];if(r in this._keyMap){let s=Array.isArray(i)?[]:{};for(let n in i)s[n]=i[n].toJSON();i=s}e[r]=i}),e}}var pc={exports:{}},pi={exports:{}};/*! https://mths.be/punycode v1.4.0 by @mathias */pi.exports;var Ll;function Ov(){return Ll||(Ll=1,function(t,e){(function(r){var i=e&&!e.nodeType&&e,s=t&&!t.nodeType&&t,n=typeof dr=="object"&&dr;(n.global===n||n.window===n||n.self===n)&&(r=n);var a,o=2147483647,l=36,h=1,c=26,u=38,d=700,p=72,g=128,_="-",y=/^xn--/,v=/[^\x20-\x7E]/,E=/[\x2E\u3002\uFF0E\uFF61]/g,T={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=l-h,b=Math.floor,A=String.fromCharCode,I;function C(F){throw new RangeError(T[F])}function G(F,k){for(var H=F.length,ue=[];H--;)ue[H]=k(F[H]);return ue}function U(F,k){var H=F.split("@"),ue="";H.length>1&&(ue=H[0]+"@",F=H[1]),F=F.replace(E,".");var he=F.split("."),ge=G(he,k).join(".");return ue+ge}function X(F){for(var k=[],H=0,ue=F.length,he,ge;H<ue;)he=F.charCodeAt(H++),he>=55296&&he<=56319&&H<ue?(ge=F.charCodeAt(H++),(ge&64512)==56320?k.push(((he&1023)<<10)+(ge&1023)+65536):(k.push(he),H--)):k.push(he);return k}function V(F){return G(F,function(k){var H="";return k>65535&&(k-=65536,H+=A(k>>>10&1023|55296),k=56320|k&1023),H+=A(k),H}).join("")}function f(F){return F-48<10?F-22:F-65<26?F-65:F-97<26?F-97:l}function m(F,k){return F+22+75*(F<26)-((k!=0)<<5)}function x(F,k,H){var ue=0;for(F=H?b(F/d):F>>1,F+=b(F/k);F>w*c>>1;ue+=l)F=b(F/w);return b(ue+(w+1)*F/(F+u))}function S(F){var k=[],H=F.length,ue,he=0,ge=g,ce=p,Se,ze,Ce,$e,Ue,He,_t,Ht,lr;for(Se=F.lastIndexOf(_),Se<0&&(Se=0),ze=0;ze<Se;++ze)F.charCodeAt(ze)>=128&&C("not-basic"),k.push(F.charCodeAt(ze));for(Ce=Se>0?Se+1:0;Ce<H;){for($e=he,Ue=1,He=l;Ce>=H&&C("invalid-input"),_t=f(F.charCodeAt(Ce++)),(_t>=l||_t>b((o-he)/Ue))&&C("overflow"),he+=_t*Ue,Ht=He<=ce?h:He>=ce+c?c:He-ce,!(_t<Ht);He+=l)lr=l-Ht,Ue>b(o/lr)&&C("overflow"),Ue*=lr;ue=k.length+1,ce=x(he-$e,ue,$e==0),b(he/ue)>o-ge&&C("overflow"),ge+=b(he/ue),he%=ue,k.splice(he++,0,ge)}return V(k)}function L(F){var k,H,ue,he,ge,ce,Se,ze,Ce,$e,Ue,He=[],_t,Ht,lr,rn;for(F=X(F),_t=F.length,k=g,H=0,ge=p,ce=0;ce<_t;++ce)Ue=F[ce],Ue<128&&He.push(A(Ue));for(ue=he=He.length,he&&He.push(_);ue<_t;){for(Se=o,ce=0;ce<_t;++ce)Ue=F[ce],Ue>=k&&Ue<Se&&(Se=Ue);for(Ht=ue+1,Se-k>b((o-H)/Ht)&&C("overflow"),H+=(Se-k)*Ht,k=Se,ce=0;ce<_t;++ce)if(Ue=F[ce],Ue<k&&++H>o&&C("overflow"),Ue==k){for(ze=H,Ce=l;$e=Ce<=ge?h:Ce>=ge+c?c:Ce-ge,!(ze<$e);Ce+=l)rn=ze-$e,lr=l-$e,He.push(A(m($e+rn%lr,0))),ze=b(rn/lr);He.push(A(m(ze,0))),ge=x(H,Ht,ue==he),H=0,++ue}++H,++k}return He.join("")}function O(F){return U(F,function(k){return y.test(k)?S(k.slice(4).toLowerCase()):k})}function N(F){return U(F,function(k){return v.test(k)?"xn--"+L(k):k})}if(a={version:"1.3.2",ucs2:{decode:X,encode:V},decode:S,encode:L,toASCII:N,toUnicode:O},i&&s)if(t.exports==i)s.exports=a;else for(I in a)a.hasOwnProperty(I)&&(i[I]=a[I]);else r.punycode=a})(dr)}(pi,pi.exports)),pi.exports}var Tn={exports:{}};/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var Cl;function Nv(){return Cl||(Cl=1,function(t){(function(e,r){t.exports?t.exports=r():e.IPv6=r(e)})(dr,function(e){var r=e&&e.IPv6;function i(n){var a=n.toLowerCase(),o=a.split(":"),l=o.length,h=8;o[0]===""&&o[1]===""&&o[2]===""?(o.shift(),o.shift()):o[0]===""&&o[1]===""?o.shift():o[l-1]===""&&o[l-2]===""&&o.pop(),l=o.length,o[l-1].indexOf(".")!==-1&&(h=7);var c;for(c=0;c<l&&o[c]!=="";c++);if(c<h)for(o.splice(c,1,"0000");o.length<h;)o.splice(c,0,"0000");for(var u,d=0;d<h;d++){u=o[d].split("");for(var p=0;p<3&&(u[0]==="0"&&u.length>1);p++)u.splice(0,1);o[d]=u.join("")}var g=-1,_=0,y=0,v=-1,E=!1;for(d=0;d<h;d++)E?o[d]==="0"?y+=1:(E=!1,y>_&&(g=v,_=y)):o[d]==="0"&&(E=!0,v=d,y=1);y>_&&(g=v,_=y),_>1&&o.splice(g,_,""),l=o.length;var T="";for(o[0]===""&&(T=":"),d=0;d<l&&(T+=o[d],d!==l-1);d++)T+=":";return o[l-1]===""&&(T+=":"),T}function s(){return e.IPv6===this&&(e.IPv6=r),this}return{best:i,noConflict:s}})}(Tn)),Tn.exports}var Sn={exports:{}};/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var Ol;function Fv(){return Ol||(Ol=1,function(t){(function(e,r){t.exports?t.exports=r():e.SecondLevelDomains=r(e)})(dr,function(e){var r=e&&e.SecondLevelDomains,i={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(s){var n=s.lastIndexOf(".");if(n<=0||n>=s.length-1)return!1;var a=s.lastIndexOf(".",n-1);if(a<=0||a>=n-1)return!1;var o=i.list[s.slice(n+1)];return o?o.indexOf(" "+s.slice(a+1,n)+" ")>=0:!1},is:function(s){var n=s.lastIndexOf(".");if(n<=0||n>=s.length-1)return!1;var a=s.lastIndexOf(".",n-1);if(a>=0)return!1;var o=i.list[s.slice(n+1)];return o?o.indexOf(" "+s.slice(0,n)+" ")>=0:!1},get:function(s){var n=s.lastIndexOf(".");if(n<=0||n>=s.length-1)return null;var a=s.lastIndexOf(".",n-1);if(a<=0||a>=n-1)return null;var o=i.list[s.slice(n+1)];return!o||o.indexOf(" "+s.slice(a+1,n)+" ")<0?null:s.slice(a+1)},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=r),this}};return i})}(Sn)),Sn.exports}/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(t){(function(e,r){t.exports?t.exports=r(Ov(),Nv(),Fv()):e.URI=r(e.punycode,e.IPv6,e.SecondLevelDomains,e)})(dr,function(e,r,i,s){var n=s&&s.URI;function a(f,m){var x=arguments.length>=1,S=arguments.length>=2;if(!(this instanceof a))return x?S?new a(f,m):new a(f):new a;if(f===void 0){if(x)throw new TypeError("undefined is not a valid argument for URI");typeof location<"u"?f=location.href+"":f=""}if(f===null&&x)throw new TypeError("null is not a valid argument for URI");return this.href(f),m!==void 0?this.absoluteTo(m):this}function o(f){return/^[0-9]+$/.test(f)}a.version="1.19.11";var l=a.prototype,h=Object.prototype.hasOwnProperty;function c(f){return f.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function u(f){return f===void 0?"Undefined":String(Object.prototype.toString.call(f)).slice(8,-1)}function d(f){return u(f)==="Array"}function p(f,m){var x={},S,L;if(u(m)==="RegExp")x=null;else if(d(m))for(S=0,L=m.length;S<L;S++)x[m[S]]=!0;else x[m]=!0;for(S=0,L=f.length;S<L;S++){var O=x&&x[f[S]]!==void 0||!x&&m.test(f[S]);O&&(f.splice(S,1),L--,S--)}return f}function g(f,m){var x,S;if(d(m)){for(x=0,S=m.length;x<S;x++)if(!g(f,m[x]))return!1;return!0}var L=u(m);for(x=0,S=f.length;x<S;x++)if(L==="RegExp"){if(typeof f[x]=="string"&&f[x].match(m))return!0}else if(f[x]===m)return!0;return!1}function _(f,m){if(!d(f)||!d(m)||f.length!==m.length)return!1;f.sort(),m.sort();for(var x=0,S=f.length;x<S;x++)if(f[x]!==m[x])return!1;return!0}function y(f){var m=/^\/+|\/+$/g;return f.replace(m,"")}a._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:a.preventInvalidHostname,duplicateQueryParameters:a.duplicateQueryParameters,escapeQuerySpace:a.escapeQuerySpace}},a.preventInvalidHostname=!1,a.duplicateQueryParameters=!1,a.escapeQuerySpace=!0,a.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,a.idn_expression=/[^a-z0-9\._-]/i,a.punycode_expression=/(xn--)/i,a.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,a.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,a.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig,a.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},a.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,a.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,a.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},a.hostProtocols=["http","https"],a.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,a.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},a.getDomAttribute=function(f){if(!(!f||!f.nodeName)){var m=f.nodeName.toLowerCase();if(!(m==="input"&&f.type!=="image"))return a.domAttributes[m]}};function v(f){return escape(f)}function E(f){return encodeURIComponent(f).replace(/[!'()*]/g,v).replace(/\*/g,"%2A")}a.encode=E,a.decode=decodeURIComponent,a.iso8859=function(){a.encode=escape,a.decode=unescape},a.unicode=function(){a.encode=E,a.decode=decodeURIComponent},a.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},a.encodeQuery=function(f,m){var x=a.encode(f+"");return m===void 0&&(m=a.escapeQuerySpace),m?x.replace(/%20/g,"+"):x},a.decodeQuery=function(f,m){f+="",m===void 0&&(m=a.escapeQuerySpace);try{return a.decode(m?f.replace(/\+/g,"%20"):f)}catch{return f}};var T={encode:"encode",decode:"decode"},w,b=function(f,m){return function(x){try{return a[m](x+"").replace(a.characters[f][m].expression,function(S){return a.characters[f][m].map[S]})}catch{return x}}};for(w in T)a[w+"PathSegment"]=b("pathname",T[w]),a[w+"UrnPathSegment"]=b("urnpath",T[w]);var A=function(f,m,x){return function(S){var L;x?L=function(k){return a[m](a[x](k))}:L=a[m];for(var O=(S+"").split(f),N=0,F=O.length;N<F;N++)O[N]=L(O[N]);return O.join(f)}};a.decodePath=A("/","decodePathSegment"),a.decodeUrnPath=A(":","decodeUrnPathSegment"),a.recodePath=A("/","encodePathSegment","decode"),a.recodeUrnPath=A(":","encodeUrnPathSegment","decode"),a.encodeReserved=b("reserved","encode"),a.parse=function(f,m){var x;return m||(m={preventInvalidHostname:a.preventInvalidHostname}),f=f.replace(a.leading_whitespace_expression,""),f=f.replace(a.ascii_tab_whitespace,""),x=f.indexOf("#"),x>-1&&(m.fragment=f.substring(x+1)||null,f=f.substring(0,x)),x=f.indexOf("?"),x>-1&&(m.query=f.substring(x+1)||null,f=f.substring(0,x)),f=f.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://"),f=f.replace(/^[/\\]{2,}/i,"//"),f.substring(0,2)==="//"?(m.protocol=null,f=f.substring(2),f=a.parseAuthority(f,m)):(x=f.indexOf(":"),x>-1&&(m.protocol=f.substring(0,x)||null,m.protocol&&!m.protocol.match(a.protocol_expression)?m.protocol=void 0:f.substring(x+1,x+3).replace(/\\/g,"/")==="//"?(f=f.substring(x+3),f=a.parseAuthority(f,m)):(f=f.substring(x+1),m.urn=!0))),m.path=f,m},a.parseHost=function(f,m){f||(f=""),f=f.replace(/\\/g,"/");var x=f.indexOf("/"),S,L;if(x===-1&&(x=f.length),f.charAt(0)==="[")S=f.indexOf("]"),m.hostname=f.substring(1,S)||null,m.port=f.substring(S+2,x)||null,m.port==="/"&&(m.port=null);else{var O=f.indexOf(":"),N=f.indexOf("/"),F=f.indexOf(":",O+1);F!==-1&&(N===-1||F<N)?(m.hostname=f.substring(0,x)||null,m.port=null):(L=f.substring(0,x).split(":"),m.hostname=L[0]||null,m.port=L[1]||null)}return m.hostname&&f.substring(x).charAt(0)!=="/"&&(x++,f="/"+f),m.preventInvalidHostname&&a.ensureValidHostname(m.hostname,m.protocol),m.port&&a.ensureValidPort(m.port),f.substring(x)||"/"},a.parseAuthority=function(f,m){return f=a.parseUserinfo(f,m),a.parseHost(f,m)},a.parseUserinfo=function(f,m){var x=f,S=f.indexOf("\\");S!==-1&&(f=f.replace(/\\/g,"/"));var L=f.indexOf("/"),O=f.lastIndexOf("@",L>-1?L:f.length-1),N;return O>-1&&(L===-1||O<L)?(N=f.substring(0,O).split(":"),m.username=N[0]?a.decode(N[0]):null,N.shift(),m.password=N[0]?a.decode(N.join(":")):null,f=x.substring(O+1)):(m.username=null,m.password=null),f},a.parseQuery=function(f,m){if(!f)return{};if(f=f.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!f)return{};for(var x={},S=f.split("&"),L=S.length,O,N,F,k=0;k<L;k++)O=S[k].split("="),N=a.decodeQuery(O.shift(),m),F=O.length?a.decodeQuery(O.join("="),m):null,N!=="__proto__"&&(h.call(x,N)?((typeof x[N]=="string"||x[N]===null)&&(x[N]=[x[N]]),x[N].push(F)):x[N]=F);return x},a.build=function(f){var m="",x=!1;return f.protocol&&(m+=f.protocol+":"),!f.urn&&(m||f.hostname)&&(m+="//",x=!0),m+=a.buildAuthority(f)||"",typeof f.path=="string"&&(f.path.charAt(0)!=="/"&&x&&(m+="/"),m+=f.path),typeof f.query=="string"&&f.query&&(m+="?"+f.query),typeof f.fragment=="string"&&f.fragment&&(m+="#"+f.fragment),m},a.buildHost=function(f){var m="";if(f.hostname)a.ip6_expression.test(f.hostname)?m+="["+f.hostname+"]":m+=f.hostname;else return"";return f.port&&(m+=":"+f.port),m},a.buildAuthority=function(f){return a.buildUserinfo(f)+a.buildHost(f)},a.buildUserinfo=function(f){var m="";return f.username&&(m+=a.encode(f.username)),f.password&&(m+=":"+a.encode(f.password)),m&&(m+="@"),m},a.buildQuery=function(f,m,x){var S="",L,O,N,F;for(O in f)if(O!=="__proto__"&&h.call(f,O))if(d(f[O]))for(L={},N=0,F=f[O].length;N<F;N++)f[O][N]!==void 0&&L[f[O][N]+""]===void 0&&(S+="&"+a.buildQueryParameter(O,f[O][N],x),m!==!0&&(L[f[O][N]+""]=!0));else f[O]!==void 0&&(S+="&"+a.buildQueryParameter(O,f[O],x));return S.substring(1)},a.buildQueryParameter=function(f,m,x){return a.encodeQuery(f,x)+(m!==null?"="+a.encodeQuery(m,x):"")},a.addQuery=function(f,m,x){if(typeof m=="object")for(var S in m)h.call(m,S)&&a.addQuery(f,S,m[S]);else if(typeof m=="string"){if(f[m]===void 0){f[m]=x;return}else typeof f[m]=="string"&&(f[m]=[f[m]]);d(x)||(x=[x]),f[m]=(f[m]||[]).concat(x)}else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")},a.setQuery=function(f,m,x){if(typeof m=="object")for(var S in m)h.call(m,S)&&a.setQuery(f,S,m[S]);else if(typeof m=="string")f[m]=x===void 0?null:x;else throw new TypeError("URI.setQuery() accepts an object, string as the name parameter")},a.removeQuery=function(f,m,x){var S,L,O;if(d(m))for(S=0,L=m.length;S<L;S++)f[m[S]]=void 0;else if(u(m)==="RegExp")for(O in f)m.test(O)&&(f[O]=void 0);else if(typeof m=="object")for(O in m)h.call(m,O)&&a.removeQuery(f,O,m[O]);else if(typeof m=="string")x!==void 0?u(x)==="RegExp"?!d(f[m])&&x.test(f[m])?f[m]=void 0:f[m]=p(f[m],x):f[m]===String(x)&&(!d(x)||x.length===1)?f[m]=void 0:d(f[m])&&(f[m]=p(f[m],x)):f[m]=void 0;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")},a.hasQuery=function(f,m,x,S){switch(u(m)){case"String":break;case"RegExp":for(var L in f)if(h.call(f,L)&&m.test(L)&&(x===void 0||a.hasQuery(f,L,x)))return!0;return!1;case"Object":for(var O in m)if(h.call(m,O)&&!a.hasQuery(f,O,m[O]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(u(x)){case"Undefined":return m in f;case"Boolean":var N=!!(d(f[m])?f[m].length:f[m]);return x===N;case"Function":return!!x(f[m],m,f);case"Array":if(!d(f[m]))return!1;var F=S?g:_;return F(f[m],x);case"RegExp":return d(f[m])?S?g(f[m],x):!1:!!(f[m]&&f[m].match(x));case"Number":x=String(x);case"String":return d(f[m])?S?g(f[m],x):!1:f[m]===x;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},a.joinPaths=function(){for(var f=[],m=[],x=0,S=0;S<arguments.length;S++){var L=new a(arguments[S]);f.push(L);for(var O=L.segment(),N=0;N<O.length;N++)typeof O[N]=="string"&&m.push(O[N]),O[N]&&x++}if(!m.length||!x)return new a("");var F=new a("").segment(m);return(f[0].path()===""||f[0].path().slice(0,1)==="/")&&F.path("/"+F.path()),F.normalize()},a.commonPath=function(f,m){var x=Math.min(f.length,m.length),S;for(S=0;S<x;S++)if(f.charAt(S)!==m.charAt(S)){S--;break}return S<1?f.charAt(0)===m.charAt(0)&&f.charAt(0)==="/"?"/":"":((f.charAt(S)!=="/"||m.charAt(S)!=="/")&&(S=f.substring(0,S).lastIndexOf("/")),f.substring(0,S+1))},a.withinString=function(f,m,x){x||(x={});var S=x.start||a.findUri.start,L=x.end||a.findUri.end,O=x.trim||a.findUri.trim,N=x.parens||a.findUri.parens,F=/[a-z0-9-]=["']?$/i;for(S.lastIndex=0;;){var k=S.exec(f);if(!k)break;var H=k.index;if(x.ignoreHtml){var ue=f.slice(Math.max(H-3,0),H);if(ue&&F.test(ue))continue}for(var he=H+f.slice(H).search(L),ge=f.slice(H,he),ce=-1;;){var Se=N.exec(ge);if(!Se)break;var ze=Se.index+Se[0].length;ce=Math.max(ce,ze)}if(ce>-1?ge=ge.slice(0,ce)+ge.slice(ce).replace(O,""):ge=ge.replace(O,""),!(ge.length<=k[0].length)&&!(x.ignore&&x.ignore.test(ge))){he=H+ge.length;var Ce=m(ge,H,he,f);if(Ce===void 0){S.lastIndex=he;continue}Ce=String(Ce),f=f.slice(0,H)+Ce+f.slice(he),S.lastIndex=H+Ce.length}}return S.lastIndex=0,f},a.ensureValidHostname=function(f,m){var x=!!f,S=!!m,L=!1;if(S&&(L=g(a.hostProtocols,m)),L&&!x)throw new TypeError("Hostname cannot be empty, if protocol is "+m);if(f&&f.match(a.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+f+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(f).match(a.invalid_hostname_characters))throw new TypeError('Hostname "'+f+'" contains characters other than [A-Z0-9.-:_]')}},a.ensureValidPort=function(f){if(f){var m=Number(f);if(!(o(m)&&m>0&&m<65536))throw new TypeError('Port "'+f+'" is not a valid port')}},a.noConflict=function(f){if(f){var m={URI:this.noConflict()};return s.URITemplate&&typeof s.URITemplate.noConflict=="function"&&(m.URITemplate=s.URITemplate.noConflict()),s.IPv6&&typeof s.IPv6.noConflict=="function"&&(m.IPv6=s.IPv6.noConflict()),s.SecondLevelDomains&&typeof s.SecondLevelDomains.noConflict=="function"&&(m.SecondLevelDomains=s.SecondLevelDomains.noConflict()),m}else s.URI===this&&(s.URI=n);return this},l.build=function(f){return f===!0?this._deferred_build=!0:(f===void 0||this._deferred_build)&&(this._string=a.build(this._parts),this._deferred_build=!1),this},l.clone=function(){return new a(this)},l.valueOf=l.toString=function(){return this.build(!1)._string};function I(f){return function(m,x){return m===void 0?this._parts[f]||"":(this._parts[f]=m||null,this.build(!x),this)}}function C(f,m){return function(x,S){return x===void 0?this._parts[f]||"":(x!==null&&(x=x+"",x.charAt(0)===m&&(x=x.substring(1))),this._parts[f]=x,this.build(!S),this)}}l.protocol=I("protocol"),l.username=I("username"),l.password=I("password"),l.hostname=I("hostname"),l.port=I("port"),l.query=C("query","?"),l.fragment=C("fragment","#"),l.search=function(f,m){var x=this.query(f,m);return typeof x=="string"&&x.length?"?"+x:x},l.hash=function(f,m){var x=this.fragment(f,m);return typeof x=="string"&&x.length?"#"+x:x},l.pathname=function(f,m){if(f===void 0||f===!0){var x=this._parts.path||(this._parts.hostname?"/":"");return f?(this._parts.urn?a.decodeUrnPath:a.decodePath)(x):x}else return this._parts.urn?this._parts.path=f?a.recodeUrnPath(f):"":this._parts.path=f?a.recodePath(f):"/",this.build(!m),this},l.path=l.pathname,l.href=function(f,m){var x;if(f===void 0)return this.toString();this._string="",this._parts=a._parts();var S=f instanceof a,L=typeof f=="object"&&(f.hostname||f.path||f.pathname);if(f.nodeName){var O=a.getDomAttribute(f);f=f[O]||"",L=!1}if(!S&&L&&f.pathname!==void 0&&(f=f.toString()),typeof f=="string"||f instanceof String)this._parts=a.parse(String(f),this._parts);else if(S||L){var N=S?f._parts:f;for(x in N)x!=="query"&&h.call(this._parts,x)&&(this._parts[x]=N[x]);N.query&&this.query(N.query,!1)}else throw new TypeError("invalid input");return this.build(!m),this},l.is=function(f){var m=!1,x=!1,S=!1,L=!1,O=!1,N=!1,F=!1,k=!this._parts.urn;switch(this._parts.hostname&&(k=!1,x=a.ip4_expression.test(this._parts.hostname),S=a.ip6_expression.test(this._parts.hostname),m=x||S,L=!m,O=L&&i&&i.has(this._parts.hostname),N=L&&a.idn_expression.test(this._parts.hostname),F=L&&a.punycode_expression.test(this._parts.hostname)),f.toLowerCase()){case"relative":return k;case"absolute":return!k;case"domain":case"name":return L;case"sld":return O;case"ip":return m;case"ip4":case"ipv4":case"inet4":return x;case"ip6":case"ipv6":case"inet6":return S;case"idn":return N;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return F}return null};var G=l.protocol,U=l.port,X=l.hostname;l.protocol=function(f,m){if(f&&(f=f.replace(/:(\/\/)?$/,""),!f.match(a.protocol_expression)))throw new TypeError('Protocol "'+f+`" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]`);return G.call(this,f,m)},l.scheme=l.protocol,l.port=function(f,m){return this._parts.urn?f===void 0?"":this:(f!==void 0&&(f===0&&(f=null),f&&(f+="",f.charAt(0)===":"&&(f=f.substring(1)),a.ensureValidPort(f))),U.call(this,f,m))},l.hostname=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(f!==void 0){var x={preventInvalidHostname:this._parts.preventInvalidHostname},S=a.parseHost(f,x);if(S!=="/")throw new TypeError('Hostname "'+f+'" contains characters other than [A-Z0-9.-]');f=x.hostname,this._parts.preventInvalidHostname&&a.ensureValidHostname(f,this._parts.protocol)}return X.call(this,f,m)},l.origin=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(f===void 0){var x=this.protocol(),S=this.authority();return S?(x?x+"://":"")+this.authority():""}else{var L=a(f);return this.protocol(L.protocol()).authority(L.authority()).build(!m),this}},l.host=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(f===void 0)return this._parts.hostname?a.buildHost(this._parts):"";var x=a.parseHost(f,this._parts);if(x!=="/")throw new TypeError('Hostname "'+f+'" contains characters other than [A-Z0-9.-]');return this.build(!m),this},l.authority=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(f===void 0)return this._parts.hostname?a.buildAuthority(this._parts):"";var x=a.parseAuthority(f,this._parts);if(x!=="/")throw new TypeError('Hostname "'+f+'" contains characters other than [A-Z0-9.-]');return this.build(!m),this},l.userinfo=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(f===void 0){var x=a.buildUserinfo(this._parts);return x&&x.substring(0,x.length-1)}else return f[f.length-1]!=="@"&&(f+="@"),a.parseUserinfo(f,this._parts),this.build(!m),this},l.resource=function(f,m){var x;return f===void 0?this.path()+this.search()+this.hash():(x=a.parse(f),this._parts.path=x.path,this._parts.query=x.query,this._parts.fragment=x.fragment,this.build(!m),this)},l.subdomain=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(f===void 0){if(!this._parts.hostname||this.is("IP"))return"";var x=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,x)||""}else{var S=this._parts.hostname.length-this.domain().length,L=this._parts.hostname.substring(0,S),O=new RegExp("^"+c(L));if(f&&f.charAt(f.length-1)!=="."&&(f+="."),f.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return f&&a.ensureValidHostname(f,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(O,f),this.build(!m),this}},l.domain=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(typeof f=="boolean"&&(m=f,f=void 0),f===void 0){if(!this._parts.hostname||this.is("IP"))return"";var x=this._parts.hostname.match(/\./g);if(x&&x.length<2)return this._parts.hostname;var S=this._parts.hostname.length-this.tld(m).length-1;return S=this._parts.hostname.lastIndexOf(".",S-1)+1,this._parts.hostname.substring(S)||""}else{if(!f)throw new TypeError("cannot set domain empty");if(f.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");if(a.ensureValidHostname(f,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=f;else{var L=new RegExp(c(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(L,f)}return this.build(!m),this}},l.tld=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(typeof f=="boolean"&&(m=f,f=void 0),f===void 0){if(!this._parts.hostname||this.is("IP"))return"";var x=this._parts.hostname.lastIndexOf("."),S=this._parts.hostname.substring(x+1);return m!==!0&&i&&i.list[S.toLowerCase()]&&i.get(this._parts.hostname)||S}else{var L;if(f)if(f.match(/[^a-zA-Z0-9-]/))if(i&&i.is(f))L=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(L,f);else throw new TypeError('TLD "'+f+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");L=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(L,f)}else throw new TypeError("cannot set TLD empty");return this.build(!m),this}},l.directory=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(f===void 0||f===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var x=this._parts.path.length-this.filename().length-1,S=this._parts.path.substring(0,x)||(this._parts.hostname?"/":"");return f?a.decodePath(S):S}else{var L=this._parts.path.length-this.filename().length,O=this._parts.path.substring(0,L),N=new RegExp("^"+c(O));return this.is("relative")||(f||(f="/"),f.charAt(0)!=="/"&&(f="/"+f)),f&&f.charAt(f.length-1)!=="/"&&(f+="/"),f=a.recodePath(f),this._parts.path=this._parts.path.replace(N,f),this.build(!m),this}},l.filename=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(typeof f!="string"){if(!this._parts.path||this._parts.path==="/")return"";var x=this._parts.path.lastIndexOf("/"),S=this._parts.path.substring(x+1);return f?a.decodePathSegment(S):S}else{var L=!1;f.charAt(0)==="/"&&(f=f.substring(1)),f.match(/\.?\//)&&(L=!0);var O=new RegExp(c(this.filename())+"$");return f=a.recodePath(f),this._parts.path=this._parts.path.replace(O,f),L?this.normalizePath(m):this.build(!m),this}},l.suffix=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(f===void 0||f===!0){if(!this._parts.path||this._parts.path==="/")return"";var x=this.filename(),S=x.lastIndexOf("."),L,O;return S===-1?"":(L=x.substring(S+1),O=/^[a-z0-9%]+$/i.test(L)?L:"",f?a.decodePathSegment(O):O)}else{f.charAt(0)==="."&&(f=f.substring(1));var N=this.suffix(),F;if(N)f?F=new RegExp(c(N)+"$"):F=new RegExp(c("."+N)+"$");else{if(!f)return this;this._parts.path+="."+a.recodePath(f)}return F&&(f=a.recodePath(f),this._parts.path=this._parts.path.replace(F,f)),this.build(!m),this}},l.segment=function(f,m,x){var S=this._parts.urn?":":"/",L=this.path(),O=L.substring(0,1)==="/",N=L.split(S);if(f!==void 0&&typeof f!="number"&&(x=m,m=f,f=void 0),f!==void 0&&typeof f!="number")throw new Error('Bad segment "'+f+'", must be 0-based integer');if(O&&N.shift(),f<0&&(f=Math.max(N.length+f,0)),m===void 0)return f===void 0?N:N[f];if(f===null||N[f]===void 0)if(d(m)){N=[];for(var F=0,k=m.length;F<k;F++)!m[F].length&&(!N.length||!N[N.length-1].length)||(N.length&&!N[N.length-1].length&&N.pop(),N.push(y(m[F])))}else(m||typeof m=="string")&&(m=y(m),N[N.length-1]===""?N[N.length-1]=m:N.push(m));else m?N[f]=y(m):N.splice(f,1);return O&&N.unshift(""),this.path(N.join(S),x)},l.segmentCoded=function(f,m,x){var S,L,O;if(typeof f!="number"&&(x=m,m=f,f=void 0),m===void 0){if(S=this.segment(f,m,x),!d(S))S=S!==void 0?a.decode(S):void 0;else for(L=0,O=S.length;L<O;L++)S[L]=a.decode(S[L]);return S}if(!d(m))m=typeof m=="string"||m instanceof String?a.encode(m):m;else for(L=0,O=m.length;L<O;L++)m[L]=a.encode(m[L]);return this.segment(f,m,x)};var V=l.query;return l.query=function(f,m){if(f===!0)return a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof f=="function"){var x=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace),S=f.call(this,x);return this._parts.query=a.buildQuery(S||x,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!m),this}else return f!==void 0&&typeof f!="string"?(this._parts.query=a.buildQuery(f,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!m),this):V.call(this,f,m)},l.setQuery=function(f,m,x){var S=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof f=="string"||f instanceof String)S[f]=m!==void 0?m:null;else if(typeof f=="object")for(var L in f)h.call(f,L)&&(S[L]=f[L]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=a.buildQuery(S,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof f!="string"&&(x=m),this.build(!x),this},l.addQuery=function(f,m,x){var S=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return a.addQuery(S,f,m===void 0?null:m),this._parts.query=a.buildQuery(S,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof f!="string"&&(x=m),this.build(!x),this},l.removeQuery=function(f,m,x){var S=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return a.removeQuery(S,f,m),this._parts.query=a.buildQuery(S,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof f!="string"&&(x=m),this.build(!x),this},l.hasQuery=function(f,m,x){var S=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return a.hasQuery(S,f,m,x)},l.setSearch=l.setQuery,l.addSearch=l.addQuery,l.removeSearch=l.removeQuery,l.hasSearch=l.hasQuery,l.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},l.normalizeProtocol=function(f){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!f)),this},l.normalizeHostname=function(f){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&r&&(this._parts.hostname=r.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!f)),this},l.normalizePort=function(f){return typeof this._parts.protocol=="string"&&this._parts.port===a.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!f)),this},l.normalizePath=function(f){var m=this._parts.path;if(!m)return this;if(this._parts.urn)return this._parts.path=a.recodeUrnPath(this._parts.path),this.build(!f),this;if(this._parts.path==="/")return this;m=a.recodePath(m);var x,S="",L,O;for(m.charAt(0)!=="/"&&(x=!0,m="/"+m),(m.slice(-3)==="/.."||m.slice(-2)==="/.")&&(m+="/"),m=m.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),x&&(S=m.substring(1).match(/^(\.\.\/)+/)||"",S&&(S=S[0]));L=m.search(/\/\.\.(\/|$)/),L!==-1;){if(L===0){m=m.substring(3);continue}O=m.substring(0,L).lastIndexOf("/"),O===-1&&(O=L),m=m.substring(0,O)+m.substring(L+3)}return x&&this.is("relative")&&(m=S+m.substring(1)),this._parts.path=m,this.build(!f),this},l.normalizePathname=l.normalizePath,l.normalizeQuery=function(f){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(a.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!f)),this},l.normalizeFragment=function(f){return this._parts.fragment||(this._parts.fragment=null,this.build(!f)),this},l.normalizeSearch=l.normalizeQuery,l.normalizeHash=l.normalizeFragment,l.iso8859=function(){var f=a.encode,m=a.decode;a.encode=escape,a.decode=decodeURIComponent;try{this.normalize()}finally{a.encode=f,a.decode=m}return this},l.unicode=function(){var f=a.encode,m=a.decode;a.encode=E,a.decode=unescape;try{this.normalize()}finally{a.encode=f,a.decode=m}return this},l.readable=function(){var f=this.clone();f.username("").password("").normalize();var m="";if(f._parts.protocol&&(m+=f._parts.protocol+"://"),f._parts.hostname&&(f.is("punycode")&&e?(m+=e.toUnicode(f._parts.hostname),f._parts.port&&(m+=":"+f._parts.port)):m+=f.host()),f._parts.hostname&&f._parts.path&&f._parts.path.charAt(0)!=="/"&&(m+="/"),m+=f.path(!0),f._parts.query){for(var x="",S=0,L=f._parts.query.split("&"),O=L.length;S<O;S++){var N=(L[S]||"").split("=");x+="&"+a.decodeQuery(N[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),N[1]!==void 0&&(x+="="+a.decodeQuery(N[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}m+="?"+x.substring(1)}return m+=a.decodeQuery(f.hash(),!0),m},l.absoluteTo=function(f){var m=this.clone(),x=["protocol","username","password","hostname","port"],S,L,O;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(f instanceof a||(f=new a(f)),m._parts.protocol||(m._parts.protocol=f._parts.protocol,this._parts.hostname))return m;for(L=0;O=x[L];L++)m._parts[O]=f._parts[O];return m._parts.path?(m._parts.path.substring(-2)===".."&&(m._parts.path+="/"),m.path().charAt(0)!=="/"&&(S=f.directory(),S=S||(f.path().indexOf("/")===0?"/":""),m._parts.path=(S?S+"/":"")+m._parts.path,m.normalizePath())):(m._parts.path=f._parts.path,m._parts.query||(m._parts.query=f._parts.query)),m.build(),m},l.relativeTo=function(f){var m=this.clone().normalize(),x,S,L,O,N;if(m._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(f=new a(f).normalize(),x=m._parts,S=f._parts,O=m.path(),N=f.path(),O.charAt(0)!=="/")throw new Error("URI is already relative");if(N.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");if(x.protocol===S.protocol&&(x.protocol=null),x.username!==S.username||x.password!==S.password||x.protocol!==null||x.username!==null||x.password!==null)return m.build();if(x.hostname===S.hostname&&x.port===S.port)x.hostname=null,x.port=null;else return m.build();if(O===N)return x.path="",m.build();if(L=a.commonPath(O,N),!L)return m.build();var F=S.path.substring(L.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return x.path=F+x.path.substring(L.length)||"./",m.build()},l.equals=function(f){var m=this.clone(),x=new a(f),S={},L={},O={},N,F,k;if(m.normalize(),x.normalize(),m.toString()===x.toString())return!0;if(N=m.query(),F=x.query(),m.query(""),x.query(""),m.toString()!==x.toString()||N.length!==F.length)return!1;S=a.parseQuery(N,this._parts.escapeQuerySpace),L=a.parseQuery(F,this._parts.escapeQuerySpace);for(k in S)if(h.call(S,k)){if(d(S[k])){if(!_(S[k],L[k]))return!1}else if(S[k]!==L[k])return!1;O[k]=!0}for(k in L)if(h.call(L,k)&&!O[k])return!1;return!0},l.preventInvalidHostname=function(f){return this._parts.preventInvalidHostname=!!f,this},l.duplicateQueryParameters=function(f){return this._parts.duplicateQueryParameters=!!f,this},l.escapeQuerySpace=function(f){return this._parts.escapeQuerySpace=!!f,this},a})})(pc);var Dv=pc.exports;const Jn=js(Dv),Nl=["http","https"];function Gv(t){return typeof t=="string"&&t.startsWith("/vsi")&&!t.startsWith("/vsicurl/")}function Uv(t,e,r=!0){return Bv(t,e,!1,r)}function Bv(t,e=null,r=!1,i=!0){typeof t=="string"&&t.startsWith("/vsicurl/")&&(t=t.replace(/^\/vsicurl\//,""));let s=Jn(t);if(e&&s.is("relative")&&!Gv(t)){let n=Jn(e),a=n.path();!a.endsWith("/")&&!a.endsWith(".json")&&n.path(a+"/"),s=s.absoluteTo(n)}return s.normalize(),r&&(s.query(""),s.fragment("")),i?s.toString():s}const zv="application/geo+json",kv=["application/json",zv,"text/json"],Fl=["image/gif","image/jpeg","image/apng","image/png","image/webp"],mc=["image/tiff; application=geotiff; profile=cloud-optimized","image/vnd.stac.geotiff; cloud-optimized=true"],_c=["application/geotiff","image/tiff; application=geotiff","image/vnd.stac.geotiff"].concat(mc);function mo(t,e,r=!1){return Array.isArray(e)||(e=[e]),r&&typeof t>"u"?!0:typeof t!="string"?!1:(e=e.map(i=>i.toLowerCase()),e.includes(t.toLowerCase()))}function $v(t,e=!1){return mo(t,kv,e)}class yc extends Js{constructor(e,r=null,i={},s=[]){super(e,i,["_context"].concat(s)),this._context||(this._context=r)}getAbsoluteUrl(e=!0){return this._context?Uv(this.href,this._context.getAbsoluteUrl(),e):this.href.includes("://")?this.href:null}getContext(){return this._context}canBrowserDisplayImage(e=!1){if(typeof this.href!="string")return!1;if(!e&&typeof this.type>"u")return!1;let r=new Jn(this.href),i=r.protocol().toLowerCase(),s=r.suffix().toLowerCase();return rt(i)&&!Nl.includes(i)?!1:rt(this.type)&&Fl.includes(this.type.toLowerCase())?!0:!!(typeof this.type>"u"&&rt(s)&&(s==="jpg"||Fl.includes("image/"+s)))}isType(e){return rt(this.type)&&mo(this.type,e)}isGeoTIFF(){return this.isType(_c)}isCOG(){return this.isType(mc)}isHTTP(){let r=this.getAbsoluteUrl(!1).protocol().toLowerCase();return rt(r)&&Nl.includes(r)}}class _o extends yc{constructor(e,r=null){super(e,r)}isLink(){return!0}getObjectType(){return"Link"}static fromLinks(e,r=null){return Array.isArray(e)?e.map(i=>tt(i)?new _o(i,r):i):[]}}class xc extends Js{constructor(e,r=null,i={},s=[]){if(super(e,Object.assign({links:_o.fromLinks},i),["_url"].concat(s)),!this._url&&(this._url=r,!this._url)){let n=this.getSelfLink();n&&(this._url=n.href)}}getAbsoluteUrl(){return this._url}setAbsoluteUrl(e){this._url=e}getStacLinksWithRel(e,r=!0){return this.getLinksWithRels([e]).filter(i=>$v(i.type,r))}getStacLinkWithRel(e,r=!0){const i=this.getStacLinksWithRel(e,r);return i.length>0?i[0]:null}getLinks(){return Array.isArray(this.links)?this.links.filter(e=>tt(e)&&rt(e.href)):[]}getLinkWithRel(e){return this.getLinks().find(r=>r.rel===e)||null}getLinksWithRels(e){return this.getLinks().filter(r=>e.includes(r.rel))}getLinksWithOtherRels(e){return this.getLinks().filter(r=>!e.includes(r.rel))}getSelfLink(){return this.getStacLinkWithRel("self")}getRootLink(){return this.getStacLinkWithRel("root")}getParentLink(){return this.getStacLinkWithRel("parent")}}class vc extends xc{constructor(e,r=null,i={},s=[]){super(e,r,i,s)}getAll(){return[]}}class er extends yc{constructor(e,r=null,i=null){super(e,i,{},["_key"]),this._key||(this._key=r)}getObjectType(){return"Asset"}isAsset(){return!0}getAbsoluteUrl(e=!0){return this.isDefintion()?null:super.getAbsoluteUrl(e)}getKey(){return this._key}getMetadata(e){if(typeof this[e]<"u")return this[e];if(this._context)return this._context.getMetadata(e)}getBands(){return gc(this["eo:bands"],this["raster:bands"])}findVisualBands(){let e={red:null,green:null,blue:null},r=this.getBands();for(let s in r){let n=parseInt(s,10),a=r[n];tt(a)&&rt(a.common_name)&&a.common_name in e&&(e[a.common_name]={index:n,band:a})}return Object.values(e).every(s=>s!==null)?e:null}findBand(e,r="name",i=null){Array.isArray(e)||(e=[e]),tt(i)||(i=this.getBands());let s=i.findIndex(n=>tt(n)&&e.includes(n[r]));return s>=0?{index:s,band:i[s]}:null}getBand(e){return tt(e)||e===null?e:this.getBands()[e]||null}getMinMaxValues(e=null){e=this.getBand(e);const r={minimum:null,maximum:null},i=o=>o.minimum!==null&&o.maximum!==null;if(e&&(tt(e.statistics)&&(typeof e.statistics.minimum=="number"&&(r.minimum=e.statistics.minimum),typeof e.statistics.maximum=="number"&&(r.maximum=e.statistics.maximum),i(r))||tt(e.histogram)&&(typeof e.histogram.min=="number"&&(r.minimum=e.histogram.min),typeof e.histogram.max=="number"&&(r.maximum=e.histogram.max),i(r))))return r;let s=this.getMetadata("classification:classes");if(Array.isArray(s)&&(s.reduce((o,l)=>(o.minimum=Math.min(o.minimum,l.value),o.maximum=Math.max(o.maximum,l.value),o),r),i(r)))return r;let n=this.getMetadata("file:values");if(Array.isArray(n)&&(n.reduce((o,l)=>(o.minimum=Math.min(o.minimum,...l.values),o.maximum=Math.max(o.maximum,...l.values),o),r),i(r)))return r;let a=tt(e)&&e.data_type||this.getMetadata("file:data_type");return a&&(r.minimum=Lv(a),r.maximum=Cv(a)),r}getNoDataValues(e=null){e=this.getBand(e);let r=[];if(e&&typeof e.nodata<"u")r.push(e.nodata);else{let i=this.getMetadata("file:nodata");if(typeof i<"u")r=i;else{let s=this.getMetadata("classification:classes");Array.isArray(s)&&(r=s.filter(n=>!!n.nodata).map(n=>n.value))}}return r.map(i=>i==="nan"?NaN:i==="+inf"?1/0:i==="-inf"?-1/0:i)}isDefintion(){return!rt(this.href)}isHTTP(){return this.isDefintion()?null:super.isHTTP()}hasRole(e,r=!1){return Array.isArray(e)||(e=[e]),r&&e.includes(this.getKey())?!0:Array.isArray(this.roles)&&!!this.roles.find(i=>e.includes(i))}static fromAssets(e,r=null){let i={};if(tt(e))for(let s in e)i[s]=new er(e[s],s,r);return i}}class $i extends xc{constructor(e,r=null,i={},s=[]){super(e,r,i,s)}getTemporalExtent(){return null}getTemporalExtents(){return[]}getIcons(e=!0){return this.getLinksWithRels(["icon"]).filter(r=>r.canBrowserDisplayImage(e))}getThumbnails(e=!0,r=null){let i=this.getAssetsWithRoles(["thumbnail","overview"],!0);return r&&i.length>1&&i.sort(s=>Array.isArray(s.roles)&&s.roles.includes(r)||s.getKey()===r?-1:1),i.length===0&&(i=this.getLinksWithRels(["preview"])),e&&(i=i.filter(s=>s.canBrowserDisplayImage())),i}getDefaultGeoTIFF(e=!0,r=!1){var s;return(s=this.rankGeoTIFFs(e,r)[0])==null?void 0:s.asset}rankGeoTIFFs(e=!0,r=!1,i=null,s=null){tt(i)||(i={data:1,visual:2,thumbnail:2,overview:3});let n=[],a=this.getAssetsByTypes(_c);e&&(a=a.filter(l=>l.isHTTP()&&(!r||l.isCOG())));let o=Object.entries(i);for(let l of a){let h=0;if(o.length>0){let c=o.filter(([u])=>l.hasRole(u,!0)).map(([,u])=>u);c.length>0&&(h+=Math.max(...c))}!r&&l.isCOG()&&(h+=2),l.findVisualBands()&&(h+=1),typeof s=="function"&&(h+=s(l)),n.push({asset:l,score:h})}return n.sort((l,h)=>h.score-l.score),n}findVisualAssets(){let e={red:null,green:null,blue:null},r=Object.keys(e),i=this.getAssets();for(let n of i){let a=n.getBands();if(a.length!==1)continue;let o=n.findBand(r,"common_name",a);o&&(e[o.band.common_name]=n)}return Object.values(e).every(n=>n!==null)?e:null}getAsset(e){return tt(this.assets)&&this.assets[e]||null}getAssets(){return tt(this.assets)?Object.values(this.assets):[]}getAssetsWithRoles(e,r=!1){return this.getAssets().filter(i=>i.hasRole(e,r))}getAssetWithRole(e,r=!1){return this.getAssetsWithRoles([e],r)[0]||null}getAssetsByTypes(e){return this.getAssets().filter(r=>mo(r.type,e))}equals(e){return this===e?!0:!(e instanceof $i)||this.getObjectType()!==e.getObjectType()?!1:!!(this.id&&this.id===e.id)}}class Ec extends $i{constructor(e,r=null,i={},s=[]){super(e,r,i,s)}getObjectType(){return this.type}getSearchLink(e=null){let r=this.getStacLinksWithRel("search");return e?r[0]||null:r.find(i=>i.method===e||!e&&!i.method)||null}getApiCollectionsLink(){return this.getStacLinkWithRel("data")}getApiItemsLink(){return this.getStacLinkWithRel("items")}getChildLinks(){return this.getStacLinksWithRel("child")}getItemLinks(){return this.getStacLinksWithRel("item")}}class jv extends Ec{constructor(e,r=null){super(e,r)}}function mi(t){if(rt(t)&&t.length>=10)try{let r=t.match(/^(-?\d{1,})-(\d\d)-(\d\d)[T ](\d\d):(\d\d):(\d\d)(?:\.(\d*))?(?:Z|[+-]00:00)?$/i).slice(1).map(i=>parseInt(i,10));return new Date(Date.UTC(r[0],r[1]-1,r[2],r[3],r[4],r[5],r[6]||0))}catch{return null}return null}function qv(t,e){return new Date(t.valueOf()+(e-t)/2)}function wc(t){if(!Array.isArray(t)||t.length===0)return null;let e,r;const i=(s,n,a)=>typeof s>"u"?n:s===null||n===null?null:a(s,n);return t.forEach(([s,n])=>{e=i(e,s,Math.min),r=i(r,n,Math.max)}),[e===null?null:new Date(e),r===null?null:new Date(r)]}function ji(t){let e=t.length>4,r=t[0],i=t[e?3:2],s=t[1],n=t[e?4:3];return{west:r,east:i,south:s,north:n}}function Mn(t){let{west:e,east:r,south:i,north:s}=ji(t);return[[[e,s],[e,i],[r,i],[r,s],[e,s]]]}function Tc(t){if(Nt(t)?t=[t]:Array.isArray(t)&&(t=t.filter(i=>Nt(i))),!Array.isArray(t)||t.length===0)return null;let e=t.reduce((i,s)=>{if(Zv(s)){let{west:n,east:a,south:o,north:l}=ji(s);i.push(Mn([-180,o,a,l])),i.push(Mn([n,o,180,l]))}else i.push(Mn(s));return i},[]),r=null;if(e.length===1?r={type:"Polygon",coordinates:e[0]}:e.length>1&&(r={type:"MultiPolygon",coordinates:e}),r)return{type:"Feature",geometry:r,properties:{}}}function Nt(t){if(!Array.isArray(t)||![4,6].includes(t.length)||t.some(n=>typeof n!="number"))return!1;let{west:e,east:r,south:i,north:s}=ji(t);return i<=s&&e>=-180&&e<=180&&i>=-90&&r<=180&&r>=-180&&s<=90}function Zv(t){if(!Nt(t))return!1;let{west:e,east:r}=ji(t);return e>r}function Sc(t){if(!Array.isArray(t)||t.length===0)return null;let e={west:180,south:90,east:-180,north:-90};t.forEach(i=>{if(!Nt(i))return;let s=ji(i),n=["west","south"];for(let a in s){let o=n.includes(a)?Math.min:Math.max;e[a]=o(e[a],s[a])}});let r=[e.west,e.south,e.east,e.north];return Nt(r)?r:null}class Mc extends Ec{constructor(e,r=null){const i={assets:er.fromAssets,item_assets:er.fromAssets};super(e,r,i)}toGeoJSON(){let e=Tc(this.getBoundingBoxes());return e&&(e.id=this.id),e}getBoundingBox(){let e=this.getRawBoundingBoxes();return e.length>0&&Nt(e[0])?e[0]:null}getBoundingBoxes(){let e=this.getRawBoundingBoxes();return e.length===1&&Nt(e[0])?e:e.length>1?e.filter((r,i)=>i>0&&Nt(r)):[]}getRawBoundingBoxes(){var r,i;let e=(i=(r=this.extent)==null?void 0:r.spatial)==null?void 0:i.bbox;return Array.isArray(e)&&e.length>0?e:[]}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){var r,i;let e=(i=(r=this.extent)==null?void 0:r.temporal)==null?void 0:i.interval;return Array.isArray(e)&&e.length>0?e.filter(s=>Array.isArray(s)&&(rt(s[0])||rt(s[1]))).map(s=>s.map(n=>mi(n))):[]}getSummary(e){return this.summaries[e]}getBands(){let e=this.getSummary("eo:bands"),r=this.getSummary("raster:bands"),i=[e,r].filter(s=>Array.isArray(s));return i.length>=2?gc(...i):i.length===1?i[0]:[]}}class Wv extends vc{constructor(e,r=null){const i={collections:s=>s.map(n=>new Mc(n))};super(e,r,i)}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map(r=>r.toGeoJSON()).filter(r=>r!==null)}}getBoundingBox(){return Sc(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map(e=>e.getBoundingBox())}getTemporalExtent(){return wc(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map(e=>e.getTemporalExtent())}}class bc extends $i{constructor(e,r=null){super(e,r,{assets:er.fromAssets})}getObjectType(){return"Item"}toGeoJSON(){return this.toJSON()}getBoundingBox(){return Nt(this.bbox)?this.bbox:null}getBoundingBoxes(){return Nt(this.bbox)?[this.bbox]:[]}getDateTime(){let e=mi(this.properties.datetime);if(!e){let r=mi(this.properties.start_datetime),i=mi(this.properties.end_datetime);return r&&i?qv(r,i):r||i}return e}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let e=[];return rt(this.properties.start_datetime)||rt(this.properties.end_datetime)?e=[[this.properties.start_datetime||null,this.properties.end_datetime||null]]:rt(this.properties.datetime)&&(e=[[this.properties.datetime,this.properties.datetime]]),e.map(r=>r.map(i=>mi(i)))}getMetadata(e){return this.properties[e]}getBands(){let e=this.getMetadata("eo:bands");return Array.isArray(e)?e:[]}getCollectionLink(){return this.getStacLinkWithRel("collection")}}class Xv extends vc{constructor(e,r=null){const i={features:s=>s.map(n=>new bc(n))};super(e,r,i)}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return Sc(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map(e=>e.getBoundingBox())}getTemporalExtent(){return wc(this.getTemporalExtents())}getTemporalExtents(){return this.features.map(e=>e.getTemporalExtent())}}function Hv(t,e=!0,r=!1){return e&&(t=Iv.stac(t,r)),t.type==="Feature"?new bc(t):t.type==="FeatureCollection"?new Xv(t):t.type==="Collection"||!t.type&&typeof t.extent<"u"&&typeof t.license<"u"?new Mc(t):!t.type&&Array.isArray(t.collections)?new Wv(t):new jv(t)}class Dl extends Za{constructor(r){super({...r,state:"loading"});sn(this,"loadImage",r=>new Promise((i,s)=>{const n=new Image;n.addEventListener("load",()=>i(n)),n.addEventListener("error",()=>s(new Error("load failed"))),n.src=r}));const i=new uo(r.url);i.getHeader().then(s=>{this.tileGrid.minZoom=s.minZoom,this.tileGrid.maxZoom=s.maxZoom,this.setLoader(async(n,a,o)=>{const l=await i.getZxy(n,a,o),h=URL.createObjectURL(new Blob([l.data])),c=await this.loadImage(h);return URL.revokeObjectURL(h),c}),this.setState("ready")})}}class Vv extends $s{constructor(r){super({...r,state:"loading",url:"pmtiles://"+r.url+"/{z}/{x}/{y}",format:new hh});sn(this,"tileLoadFunction",(r,i)=>{const s=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),n=i.match(s),a=+n[2],o=+n[3],l=+n[4];r.setLoader((h,c,u)=>{r.setState(ee.LOADING),this.pmtiles_.getZxy(a,o,l).then(d=>{if(d){const p=r.getFormat();r.setFeatures(p.readFeatures(d.data,{extent:h,featureProjection:u})),r.setState(ee.LOADED)}else r.setFeatures([]),r.setState(ee.EMPTY)}).catch(d=>{r.setFeatures([]),r.setState(ee.ERROR)})})});this.pmtiles_=new uo(r.url),this.pmtiles_.getHeader().then(i=>{this.tileGrid.minZoom=i.minZoom,this.tileGrid.maxZoom=i.maxZoom,this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}}let yo=null;function Yv(){return!!yo}function Rc(t){yo=t;const e=Object.keys(t.defs),r=e.length;let i,s;for(i=0;i<r;++i){const n=e[i];if(!de(n)){const a=t.defs(n);let o=a.units;!o&&a.projName==="longlat"&&(o="degrees"),ud(new Fn({code:n,axisOrientation:a.axis,metersPerUnit:a.to_meter,units:o}))}}for(i=0;i<r;++i){const n=e[i],a=de(n);for(s=0;s<r;++s){const o=e[s],l=de(o);if(!cd(n,o))if(t.defs[n]===t.defs[o])fd([a,l]);else{const h=t(n,o);dd(a,l,No(a,l,h.forward),No(l,a,h.inverse))}}}}let Kv=async function(t){const e=await fetch(`https://epsg.io/${t}.proj4`);if(!e.ok)throw new Error(`Unexpected response from epsg.io: ${e.status}`);return e.text()};async function Qv(t){typeof t=="string"&&(t=parseInt(t.split(":").pop(),10));const e=yo;if(!e)throw new Error("Proj4 must be registered first with register(proj4)");const r="EPSG:"+t;return e.defs(r)?de(r):(e.defs(r,await Kv(t)),Rc(e),de(r))}const Jv=new vi({fill:new Ln({color:"rgba(255,255,255,0.4)"}),stroke:new Mi({color:"#3399CC",width:3})}),eE=new vi({stroke:new Mi({color:"#ff9933",width:1})});function tE(t,e){const r={url:t.getAbsoluteUrl()};let i=null;t.getBands().length===1&&(i=0);const{minimum:s,maximum:n}=t.getMinMaxValues(i);typeof s=="number"&&(r.min=s),typeof n=="number"&&(r.max=n);const a=t.getNoDataValues(i);return a.length>0&&(r.nodata=a[0]),e.length>0&&(r.bands=e),r}async function Gl(t,e=void 0){let r=e;if(Yv()){const i=t.getMetadata("proj:epsg");if(i)try{r=await Qv(i)}catch{}}return r}function Ul(t,e){const r=t.clone();return e.hasOnlyBounds()||r.setFill(null),r}function rE(t){let e=t.href;if(e.includes("{s}"))if(Array.isArray(t["href:servers"])&&t["href:servers"].length>0){const r=Math.random()*t["href:servers"].length|0;e=e.replace("{s}",t["href:servers"][r])}else return null;return e}async function iE(t){try{const e=new URL(t);e.searchParams.set("service","wmts"),e.searchParams.set("request","GetCapabilities");const r=await fetch(e);return new Vh().read(await r.text())}catch{return null}}class xo extends Eh{constructor(e){const r={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(i=>r[i]=e[i]),super(r),this.getSourceOptions_=e.getSourceOptions,this.data_,this.assets_=null,this.bands_=[],this.crossOrigin_=e.crossOrigin||null,this.displayFootprint_=e.displayFootprint!==!1,this.displayGeoTiffByDefault_=!!e.displayGeoTiffByDefault,this.displayPreview_=!!e.displayPreview,this.displayOverview_=e.displayOverview!==!1,this.displayWebMapLink_=e.displayWebMapLink||!1,this.buildTileUrlTemplate_=e.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=e.useTileLayerAsFallback||!1,this.boundsStyle_=e.boundsStyle||Jv,this.collectionStyle_=e.collectionStyle||eE,this.boundsLayer_=null,e.data){try{this.configure_(e.data,e.url,e.assets,e.bands)}catch(i){this.handleError_(i)}return}if(!e.url)throw new Error("Either url or data must be provided");fetch(e.url).then(i=>i.json()).then(i=>this.configure_(i,e.url,e.assets,e.bands)).catch(i=>this.handleError_(i))}getBoundsLayer(){return this.boundsLayer_}handleError_(e){this.dispatchEvent(new bv(e))}configure_(e,r=null,i=null,s=[]){e instanceof er||e instanceof $i?this.data_=e:this.data_=Hv(e),r&&r.includes("://")&&this.data_.setAbsoluteUrl(r),this.bands_=s,this.boundsLayer_=this.addFootprint_();const n=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(Ul(this.boundsStyle_,this))};this.getLayers().on("add",n),this.getLayers().on("remove",n),this.setAssets(i).then(()=>this.dispatchEvent("assetsready")).catch(a=>this.handleError_(a)),this.dispatchEvent("sourceready")}async addApiCollection_(){const e=this.getData().getAll().map(r=>{const i=new xo({data:r,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_});return this.addLayer_(i),i});return await Promise.all(e)}async addStacAssets_(){let e=this.getAssets();if(e===null){e=[];const i=this.getData().getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);if(i)e.push(i);else{const s=this.getData().getThumbnails();s.length>0&&e.push(s[0])}}const r=e.map(i=>this.addImagery_(i));return await Promise.all(r)}async addImagery_(e){if(e){if(e.isGeoTIFF())return await this.addGeoTiff_(e);if(e.canBrowserDisplayImage())return await this.addThumbnail_(e)}}async addThumbnail_(e){if(!this.displayPreview_)return;let r={url:e.getAbsoluteUrl(),projection:await Gl(e,"EPSG:4326"),imageExtent:e.getContext().getBoundingBox(),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(r=await this.getSourceOptions_(Re.ImageStatic,r,e));const i=new ga({source:new qu(r)});return this.addLayer_(i,e),i}async addWebMapLinks_(){const e=this.getWebMapLinks();if(e.length>0)return await this.addLayerForLink(e[0])}async addLayerForLink(e){const r=rE(e);if(!r)return;const i={attributions:e.getMetadata("attribution")||this.data_.getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:r},s=async(a,o)=>(this.getSourceOptions_&&(o=await this.getSourceOptions_(a,o,e)),o),n=[];switch(e.rel){case"pmtiles":const o=await new uo(i.url).getHeader();let l;switch(o.tileType){case Ar.Mvt:l=new Vv(await s(Re.PMTilesVector,i));break;case Ar.Avif:case Ar.Jpeg:case Ar.Png:case Ar.Webp:l=new Dl(await s(Re.PMTilesRaster,i));break;default:return}n.push(l);break;case"tilejson":n.push(new Ku(await s(Re.TileJSON,i)));break;case"wms":if(!Array.isArray(e["wms:layers"]))break;for(const u in e["wms:layers"]){const d=e["wms:layers"][u];let p;Array.isArray(e["wms:styles"])&&typeof e["wms:styles"][u]=="string"&&(p=e["wms:styles"][u]);const g=Object.assign({LAYERS:d,STYLES:p},e["wms:dimensions"]);typeof e["wms:transparent"]=="boolean"&&(g.TRANSPARENT=String(e["wms:transparent"])),typeof e.type=="string"&&e.type.startsWith("image/")&&(g.FORMAT=e.type);const _=await s(Re.TileWMS,Object.assign({},i,{params:g}));n.push(new Ph(_))}break;case"wmts":const h=await iE(r);if(!h)return;const c=Array.isArray(e["wmts:layer"])?e["wmts:layer"]:[e["wmts:layer"]];for(const u of c){let d=Object.assign({},i,{layer:u});typeof e.type=="string"&&e.type.startsWith("image/")&&(d.format=e.type),d=await s(Re.WMTS,d),n.push(new Ah(gd(h,d)))}break;case"xyz":n.push(new Wr(await s(Re.XYZ,i)));break;default:return}return n.map(a=>{let o;return a instanceof $s?o=new wh({source:a,declutter:!0}):a instanceof Dl?o=new Zn({source:a}):o=new ys({source:a}),this.addLayer_(o,e),o})}async addGeoTiff_(e){if(!this.displayOverview_)return;if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);let i={sources:[tE(e,this.bands_)]};const s=await Gl(e);s&&(i.projection=s),this.getSourceOptions_&&(i=await this.getSourceOptions_(Re.GeoTIFF,i,e));const n=async(a,o)=>(o&&this.getLayers().remove(o),await this.addTileLayerForImagery_(a));try{const a=new Rv(i),o=new Zn({source:a});if(this.useTileLayerAsFallback_){const l=()=>n(e,o);a.on("error",l),a.on("tileloaderror",l),a.on("change",()=>{a.getState()==="error"&&n(e,o)}),o.on("error",l),await a.getView()}return this.addLayer_(o,e),o}catch(a){if(this.useTileLayerAsFallback_)return await n(e,null);this.handleError_(a)}}async addTileLayerForImagery_(e){let r={crossOrigin:this.crossOrigin_,url:this.buildTileUrlTemplate_(e)};this.getSourceOptions_&&(r=await this.getSourceOptions_(Re.XYZ,r,e));const i=new ys({source:new Wr(r)});return this.addLayer_(i,e),i}addLayer_(e,r,i=0){e.set("stac",r),e.setZIndex(i),this.getLayers().push(e)}addFootprint_(){let e=null;const r=this.getData();if(r.isItemCollection()||r.isCollectionCollection()?e=Tc(r.getBoundingBox()):e=r.toGeoJSON(),e){const i=new lh,s=new Gs({format:i,loader:(a,o,l)=>{const h=i.readFeatures(e,{featureProjection:l});s.addFeatures(h)}}),n=new oa({source:s,style:Ul(this.boundsStyle_,this),visible:this.displayFootprint_});return n.set("bounds",!0),this.addLayer_(n,r,1),n}return null}async updateLayers_(){const e=this.getLayers();for(let i=e.getLength()-1;i>=0;i--){const n=e.item(i).get("stac");n&&(n.isLink()||n.isAsset())&&e.removeAt(i)}const r=this.getData();r.isItemCollection()||r.isCollectionCollection()?await this.addApiCollection_():(r.isItem()||r.isCollection())&&await this.addStacAssets_(),this.displayWebMapLink_&&this.hasOnlyBounds()&&await this.addWebMapLinks_()}hasOnlyBounds(){const e=this.getBoundsLayer();return typeof this.getLayersArray().find(i=>i!==e)>"u"}getWebMapLinks(){let e=["xyz","tilejson","pmtiles","wmts","wms"];typeof this.displayWebMapLink_=="string"&&(e=[this.displayWebMapLink_]);const r=this.data_.getLinksWithRels(e);return r.sort((i,s)=>{const n=e.indexOf(i.rel),a=e.indexOf(s.rel);return n-a}),r}async setAssets(e){Array.isArray(e)?this.assets_=e.map(r=>typeof r=="string"?this.getData().getAsset(r):r instanceof er?r:new er(r)):this.assets_=null,await this.updateLayers_()}getData(){return this.data_}getAssets(){return this.assets_}getExtent(){if(!this.boundsLayer_)return;const e=this.boundsLayer_.getMapInternal();if(!e)return;const r=e.getView();if(!r)return;const i=this.getData();if(!i)return;const s=i.getBoundingBox();if(s)return pd(s,"EPSG:4326",r.getProjection())}}function sE(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}var yr=1,xr=2,$r=3,nE=4,ea=5,Bl=6378137,aE=6356752314e-3,zl=.0066943799901413165,Ti=484813681109536e-20,D=Math.PI/2,oE=.16666666666666666,lE=.04722222222222222,hE=.022156084656084655,j=1e-10,je=.017453292519943295,Lt=57.29577951308232,we=Math.PI/4,Ni=Math.PI*2,Oe=3.14159265359,nt={};nt.greenwich=0;nt.lisbon=-9.131906111111;nt.paris=2.337229166667;nt.bogota=-74.080916666667;nt.madrid=-3.687938888889;nt.rome=12.452333333333;nt.bern=7.439583333333;nt.jakarta=106.807719444444;nt.ferro=-17.666666666667;nt.brussels=4.367975;nt.stockholm=18.058277777778;nt.athens=23.7163375;nt.oslo=10.722916666667;const uE={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var kl=/[\s_\-\/\(\)]/g;function sr(t,e){if(t[e])return t[e];for(var r=Object.keys(t),i=e.toLowerCase().replace(kl,""),s=-1,n,a;++s<r.length;)if(n=r[s],a=n.toLowerCase().replace(kl,""),a===i)return t[n]}function ta(t){var e={},r=t.split("+").map(function(o){return o.trim()}).filter(function(o){return o}).reduce(function(o,l){var h=l.split("=");return h.push(!0),o[h[0].toLowerCase()]=h[1],o},{}),i,s,n,a={proj:"projName",datum:"datumCode",rf:function(o){e.rf=parseFloat(o)},lat_0:function(o){e.lat0=o*je},lat_1:function(o){e.lat1=o*je},lat_2:function(o){e.lat2=o*je},lat_ts:function(o){e.lat_ts=o*je},lon_0:function(o){e.long0=o*je},lon_1:function(o){e.long1=o*je},lon_2:function(o){e.long2=o*je},alpha:function(o){e.alpha=parseFloat(o)*je},gamma:function(o){e.rectified_grid_angle=parseFloat(o)},lonc:function(o){e.longc=o*je},x_0:function(o){e.x0=parseFloat(o)},y_0:function(o){e.y0=parseFloat(o)},k_0:function(o){e.k0=parseFloat(o)},k:function(o){e.k0=parseFloat(o)},a:function(o){e.a=parseFloat(o)},b:function(o){e.b=parseFloat(o)},r_a:function(){e.R_A=!0},zone:function(o){e.zone=parseInt(o,10)},south:function(){e.utmSouth=!0},towgs84:function(o){e.datum_params=o.split(",").map(function(l){return parseFloat(l)})},to_meter:function(o){e.to_meter=parseFloat(o)},units:function(o){e.units=o;var l=sr(uE,o);l&&(e.to_meter=l.to_meter)},from_greenwich:function(o){e.from_greenwich=o*je},pm:function(o){var l=sr(nt,o);e.from_greenwich=(l||parseFloat(o))*je},nadgrids:function(o){o==="@null"?e.datumCode="none":e.nadgrids=o},axis:function(o){var l="ewnsud";o.length===3&&l.indexOf(o.substr(0,1))!==-1&&l.indexOf(o.substr(1,1))!==-1&&l.indexOf(o.substr(2,1))!==-1&&(e.axis=o)},approx:function(){e.approx=!0}};for(i in r)s=r[i],i in a?(n=a[i],typeof n=="function"?n(s):e[n]=s):e[i]=s;return typeof e.datumCode=="string"&&e.datumCode!=="WGS84"&&(e.datumCode=e.datumCode.toLowerCase()),e}var Fi=1,Pc=2,Ac=3,Is=4,Ic=5,vo=-1,cE=/\s/,fE=/[A-Za-z]/,dE=/[A-Za-z84_]/,en=/[,\]]/,Lc=/[\d\.E\-\+]/;function Xt(t){if(typeof t!="string")throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Fi}Xt.prototype.readCharicter=function(){var t=this.text[this.place++];if(this.state!==Is)for(;cE.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case Fi:return this.neutral(t);case Pc:return this.keyword(t);case Is:return this.quoted(t);case Ic:return this.afterquote(t);case Ac:return this.number(t);case vo:return}};Xt.prototype.afterquote=function(t){if(t==='"'){this.word+='"',this.state=Is;return}if(en.test(t)){this.word=this.word.trim(),this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in afterquote yet, index '+this.place)};Xt.prototype.afterItem=function(t){if(t===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=Fi;return}if(t==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Fi,this.currentObject=this.stack.pop(),this.currentObject||(this.state=vo);return}};Xt.prototype.number=function(t){if(Lc.test(t)){this.word+=t;return}if(en.test(t)){this.word=parseFloat(this.word),this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in number yet, index '+this.place)};Xt.prototype.quoted=function(t){if(t==='"'){this.state=Ic;return}this.word+=t};Xt.prototype.keyword=function(t){if(dE.test(t)){this.word+=t;return}if(t==="["){var e=[];e.push(this.word),this.level++,this.root===null?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,this.state=Fi;return}if(en.test(t)){this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in keyword yet, index '+this.place)};Xt.prototype.neutral=function(t){if(fE.test(t)){this.word=t,this.state=Pc;return}if(t==='"'){this.word="",this.state=Is;return}if(Lc.test(t)){this.word=t,this.state=Ac;return}if(en.test(t)){this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in neutral yet, index '+this.place)};Xt.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===vo)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function gE(t){var e=new Xt(t);return e.output()}function $l(t,e,r){Array.isArray(e)&&(r.unshift(e),e=null);var i=e?{}:t,s=r.reduce(function(n,a){return Dr(a,n),n},i);e&&(t[e]=s)}function Dr(t,e){if(!Array.isArray(t)){e[t]=!0;return}var r=t.shift();if(r==="PARAMETER"&&(r=t.shift()),t.length===1){if(Array.isArray(t[0])){e[r]={},Dr(t[0],e[r]);return}e[r]=t[0];return}if(!t.length){e[r]=!0;return}if(r==="TOWGS84"){e[r]=t;return}if(r==="AXIS"){r in e||(e[r]=[]),e[r].push(t);return}Array.isArray(r)||(e[r]={});var i;switch(r){case"UNIT":case"PRIMEM":case"VERT_DATUM":e[r]={name:t[0].toLowerCase(),convert:t[1]},t.length===3&&Dr(t[2],e[r]);return;case"SPHEROID":case"ELLIPSOID":e[r]={name:t[0],a:t[1],rf:t[2]},t.length===4&&Dr(t[3],e[r]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":t[0]=["name",t[0]],$l(e,r,t);return;default:for(i=-1;++i<t.length;)if(!Array.isArray(t[i]))return Dr(t,e[r]);return $l(e,r,t)}}var pE=.017453292519943295;function mE(t,e){var r=e[0],i=e[1];!(r in t)&&i in t&&(t[r]=t[i],e.length===3&&(t[r]=e[2](t[r])))}function Rt(t){return t*pE}function _E(t){if(t.type==="GEOGCS"?t.projName="longlat":t.type==="LOCAL_CS"?(t.projName="identity",t.local=!0):typeof t.PROJECTION=="object"?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var e="",r=0,i=t.AXIS.length;r<i;++r){var s=[t.AXIS[r][0].toLowerCase(),t.AXIS[r][1].toLowerCase()];s[0].indexOf("north")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="north"?e+="n":s[0].indexOf("south")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="south"?e+="s":s[0].indexOf("east")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="east"?e+="e":(s[0].indexOf("west")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="west")&&(e+="w")}e.length===2&&(e+="u"),e.length===3&&(t.axis=e)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),t.units==="metre"&&(t.units="meter"),t.UNIT.convert&&(t.type==="GEOGCS"?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var n=t.GEOGCS;t.type==="GEOGCS"&&(n=t),n&&(n.DATUM?t.datumCode=n.DATUM.name.toLowerCase():t.datumCode=n.name.toLowerCase(),t.datumCode.slice(0,2)==="d_"&&(t.datumCode=t.datumCode.slice(2)),(t.datumCode==="new_zealand_geodetic_datum_1949"||t.datumCode==="new_zealand_1949")&&(t.datumCode="nzgd49"),(t.datumCode==="wgs_1984"||t.datumCode==="world_geodetic_system_1984")&&(t.PROJECTION==="Mercator_Auxiliary_Sphere"&&(t.sphere=!0),t.datumCode="wgs84"),t.datumCode.slice(-6)==="_ferro"&&(t.datumCode=t.datumCode.slice(0,-6)),t.datumCode.slice(-8)==="_jakarta"&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),n.DATUM&&n.DATUM.SPHEROID&&(t.ellps=n.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),t.ellps.toLowerCase().slice(0,13)==="international"&&(t.ellps="intl"),t.a=n.DATUM.SPHEROID.a,t.rf=parseFloat(n.DATUM.SPHEROID.rf,10)),n.DATUM&&n.DATUM.TOWGS84&&(t.datum_params=n.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),t.datumCode==="ch1903+"&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a);function a(h){var c=t.to_meter||1;return h*c}var o=function(h){return mE(t,h)},l=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Rt],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Rt],["x0","false_easting",a],["y0","false_northing",a],["long0","central_meridian",Rt],["lat0","latitude_of_origin",Rt],["lat0","standard_parallel_1",Rt],["lat1","standard_parallel_1",Rt],["lat2","standard_parallel_2",Rt],["azimuth","Azimuth"],["alpha","azimuth",Rt],["srsCode","name"]];l.forEach(o),!t.long0&&t.longc&&(t.projName==="Albers_Conic_Equal_Area"||t.projName==="Lambert_Azimuthal_Equal_Area")&&(t.long0=t.longc),!t.lat_ts&&t.lat1&&(t.projName==="Stereographic_South_Pole"||t.projName==="Polar Stereographic (variant B)")?(t.lat0=Rt(t.lat1>0?90:-90),t.lat_ts=t.lat1):!t.lat_ts&&t.lat0&&t.projName==="Polar_Stereographic"&&(t.lat_ts=t.lat0,t.lat0=Rt(t.lat0>0?90:-90))}function Cc(t){var e=gE(t),r=e.shift(),i=e.shift();e.unshift(["name",i]),e.unshift(["type",r]);var s={};return Dr(e,s),_E(s),s}function Ve(t){var e=this;if(arguments.length===2){var r=arguments[1];typeof r=="string"?r.charAt(0)==="+"?Ve[t]=ta(arguments[1]):Ve[t]=Cc(arguments[1]):Ve[t]=r}else if(arguments.length===1){if(Array.isArray(t))return t.map(function(i){Array.isArray(i)?Ve.apply(e,i):Ve(i)});if(typeof t=="string"){if(t in Ve)return Ve[t]}else"EPSG"in t?Ve["EPSG:"+t.EPSG]=t:"ESRI"in t?Ve["ESRI:"+t.ESRI]=t:"IAU2000"in t?Ve["IAU2000:"+t.IAU2000]=t:console.log(t);return}}sE(Ve);function yE(t){return typeof t=="string"}function xE(t){return t in Ve}var vE=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function EE(t){return vE.some(function(e){return t.indexOf(e)>-1})}var wE=["3857","900913","3785","102113"];function TE(t){var e=sr(t,"authority");if(e){var r=sr(e,"epsg");return r&&wE.indexOf(r)>-1}}function SE(t){var e=sr(t,"extension");if(e)return sr(e,"proj4")}function ME(t){return t[0]==="+"}function bE(t){if(yE(t)){if(xE(t))return Ve[t];if(EE(t)){var e=Cc(t);if(TE(e))return Ve["EPSG:3857"];var r=SE(e);return r?ta(r):e}if(ME(t))return ta(t)}else return t}function jl(t,e){t=t||{};var r,i;if(!e)return t;for(i in e)r=e[i],r!==void 0&&(t[i]=r);return t}function Ut(t,e,r){var i=t*e;return r/Math.sqrt(1-i*i)}function qi(t){return t<0?-1:1}function q(t){return Math.abs(t)<=Oe?t:t-qi(t)*Ni}function Tt(t,e,r){var i=t*r,s=.5*t;return i=Math.pow((1-i)/(1+i),s),Math.tan(.5*(D-e))/i}function Di(t,e){for(var r=.5*t,i,s,n=D-2*Math.atan(e),a=0;a<=15;a++)if(i=t*Math.sin(n),s=D-2*Math.atan(e*Math.pow((1-i)/(1+i),r))-n,n+=s,Math.abs(s)<=1e-10)return n;return-9999}function RE(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Ut(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function PE(t){var e=t.x,r=t.y;if(r*Lt>90&&r*Lt<-90&&e*Lt>180&&e*Lt<-180)return null;var i,s;if(Math.abs(Math.abs(r)-D)<=j)return null;if(this.sphere)i=this.x0+this.a*this.k0*q(e-this.long0),s=this.y0+this.a*this.k0*Math.log(Math.tan(we+.5*r));else{var n=Math.sin(r),a=Tt(this.e,r,n);i=this.x0+this.a*this.k0*q(e-this.long0),s=this.y0-this.a*this.k0*Math.log(a)}return t.x=i,t.y=s,t}function AE(t){var e=t.x-this.x0,r=t.y-this.y0,i,s;if(this.sphere)s=D-2*Math.atan(Math.exp(-r/(this.a*this.k0)));else{var n=Math.exp(-r/(this.a*this.k0));if(s=Di(this.e,n),s===-9999)return null}return i=q(this.long0+e/(this.a*this.k0)),t.x=i,t.y=s,t}var IE=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const LE={init:RE,forward:PE,inverse:AE,names:IE};function CE(){}function ql(t){return t}var OE=["longlat","identity"];const NE={init:CE,forward:ql,inverse:ql,names:OE};var FE=[LE,NE],ls={},Ls=[];function Oc(t,e){var r=Ls.length;return t.names?(Ls[r]=t,t.names.forEach(function(i){ls[i.toLowerCase()]=r}),this):(console.log(e),!0)}function DE(t){if(!t)return!1;var e=t.toLowerCase();if(typeof ls[e]<"u"&&Ls[ls[e]])return Ls[ls[e]]}function GE(){FE.forEach(Oc)}const UE={start:GE,add:Oc,get:DE};var te={};te.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};te.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};te.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};te.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};te.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};te.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};te.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};te.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};te.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};te.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};te.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};te.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};te.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};te.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};te.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};te.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};te.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};te.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};te.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};te.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};te.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};te.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};te.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};te.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};te.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};te.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};te.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};te.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};te.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};te.hough={a:6378270,rf:297,ellipseName:"Hough"};te.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};te.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};te.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};te.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};te.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};te.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};te.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};te.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};te.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};te.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};te.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};te.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var BE=te.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};te.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function zE(t,e,r,i){var s=t*t,n=e*e,a=(s-n)/s,o=0;i?(t*=1-a*(oE+a*(lE+a*hE)),s=t*t,a=0):o=Math.sqrt(a);var l=(s-n)/n;return{es:a,e:o,ep2:l}}function kE(t,e,r,i,s){if(!t){var n=sr(te,i);n||(n=BE),t=n.a,e=n.b,r=n.rf}return r&&!e&&(e=(1-1/r)*t),(r===0||Math.abs(t-e)<j)&&(s=!0,e=t),{a:t,b:e,rf:r,sphere:s}}var Be={};Be.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};Be.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};Be.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};Be.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};Be.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};Be.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};Be.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};Be.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};Be.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"};Be.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};Be.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};Be.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};Be.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};Be.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};Be.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};Be.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};Be.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};Be.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function $E(t,e,r,i,s,n,a){var o={};return t===void 0||t==="none"?o.datum_type=ea:o.datum_type=nE,e&&(o.datum_params=e.map(parseFloat),(o.datum_params[0]!==0||o.datum_params[1]!==0||o.datum_params[2]!==0)&&(o.datum_type=yr),o.datum_params.length>3&&(o.datum_params[3]!==0||o.datum_params[4]!==0||o.datum_params[5]!==0||o.datum_params[6]!==0)&&(o.datum_type=xr,o.datum_params[3]*=Ti,o.datum_params[4]*=Ti,o.datum_params[5]*=Ti,o.datum_params[6]=o.datum_params[6]/1e6+1)),a&&(o.datum_type=$r,o.grids=a),o.a=r,o.b=i,o.es=s,o.ep2=n,o}var Nc={};function jE(t,e){var r=new DataView(e),i=WE(r),s=XE(r,i),n=HE(r,s,i),a={header:s,subgrids:n};return Nc[t]=a,a}function qE(t){if(t===void 0)return null;var e=t.split(",");return e.map(ZE)}function ZE(t){if(t.length===0)return null;var e=t[0]==="@";return e&&(t=t.slice(1)),t==="null"?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:t,mandatory:!e,grid:Nc[t]||null,isNull:!1}}function Gr(t){return t/3600*Math.PI/180}function WE(t){var e=t.getInt32(8,!1);return e===11?!1:(e=t.getInt32(8,!0),e!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function XE(t,e){return{nFields:t.getInt32(8,e),nSubgridFields:t.getInt32(24,e),nSubgrids:t.getInt32(40,e),shiftType:ra(t,56,64).trim(),fromSemiMajorAxis:t.getFloat64(120,e),fromSemiMinorAxis:t.getFloat64(136,e),toSemiMajorAxis:t.getFloat64(152,e),toSemiMinorAxis:t.getFloat64(168,e)}}function ra(t,e,r){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(e,r)))}function HE(t,e,r){for(var i=176,s=[],n=0;n<e.nSubgrids;n++){var a=YE(t,i,r),o=KE(t,i,a,r),l=Math.round(1+(a.upperLongitude-a.lowerLongitude)/a.longitudeInterval),h=Math.round(1+(a.upperLatitude-a.lowerLatitude)/a.latitudeInterval);s.push({ll:[Gr(a.lowerLongitude),Gr(a.lowerLatitude)],del:[Gr(a.longitudeInterval),Gr(a.latitudeInterval)],lim:[l,h],count:a.gridNodeCount,cvs:VE(o)}),i+=176+a.gridNodeCount*16}return s}function VE(t){return t.map(function(e){return[Gr(e.longitudeShift),Gr(e.latitudeShift)]})}function YE(t,e,r){return{name:ra(t,e+8,e+16).trim(),parent:ra(t,e+24,e+24+8).trim(),lowerLatitude:t.getFloat64(e+72,r),upperLatitude:t.getFloat64(e+88,r),lowerLongitude:t.getFloat64(e+104,r),upperLongitude:t.getFloat64(e+120,r),latitudeInterval:t.getFloat64(e+136,r),longitudeInterval:t.getFloat64(e+152,r),gridNodeCount:t.getInt32(e+168,r)}}function KE(t,e,r,i){for(var s=e+176,n=16,a=[],o=0;o<r.gridNodeCount;o++){var l={latitudeShift:t.getFloat32(s+o*n,i),longitudeShift:t.getFloat32(s+o*n+4,i),latitudeAccuracy:t.getFloat32(s+o*n+8,i),longitudeAccuracy:t.getFloat32(s+o*n+12,i)};a.push(l)}return a}function Ft(t,e){if(!(this instanceof Ft))return new Ft(t);e=e||function(h){if(h)throw h};var r=bE(t);if(typeof r!="object"){e(t);return}var i=Ft.projections.get(r.projName);if(!i){e(t);return}if(r.datumCode&&r.datumCode!=="none"){var s=sr(Be,r.datumCode);s&&(r.datum_params=r.datum_params||(s.towgs84?s.towgs84.split(","):null),r.ellps=s.ellipse,r.datumName=s.datumName?s.datumName:r.datumCode)}r.k0=r.k0||1,r.axis=r.axis||"enu",r.ellps=r.ellps||"wgs84",r.lat1=r.lat1||r.lat0;var n=kE(r.a,r.b,r.rf,r.ellps,r.sphere),a=zE(n.a,n.b,n.rf,r.R_A),o=qE(r.nadgrids),l=r.datum||$E(r.datumCode,r.datum_params,n.a,n.b,a.es,a.ep2,o);jl(this,r),jl(this,i),this.a=n.a,this.b=n.b,this.rf=n.rf,this.sphere=n.sphere,this.es=a.es,this.e=a.e,this.ep2=a.ep2,this.datum=l,this.init(),e(null,this)}Ft.projections=UE;Ft.projections.start();function QE(t,e){return t.datum_type!==e.datum_type||t.a!==e.a||Math.abs(t.es-e.es)>5e-11?!1:t.datum_type===yr?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:t.datum_type===xr?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6]:!0}function Fc(t,e,r){var i=t.x,s=t.y,n=t.z?t.z:0,a,o,l,h;if(s<-D&&s>-1.001*D)s=-D;else if(s>D&&s<1.001*D)s=D;else{if(s<-D)return{x:-1/0,y:-1/0,z:t.z};if(s>D)return{x:1/0,y:1/0,z:t.z}}return i>Math.PI&&(i-=2*Math.PI),o=Math.sin(s),h=Math.cos(s),l=o*o,a=r/Math.sqrt(1-e*l),{x:(a+n)*h*Math.cos(i),y:(a+n)*h*Math.sin(i),z:(a*(1-e)+n)*o}}function Dc(t,e,r,i){var s=1e-12,n=s*s,a=30,o,l,h,c,u,d,p,g,_,y,v,E,T,w=t.x,b=t.y,A=t.z?t.z:0,I,C,G;if(o=Math.sqrt(w*w+b*b),l=Math.sqrt(w*w+b*b+A*A),o/r<s){if(I=0,l/r<s)return C=D,G=-i,{x:t.x,y:t.y,z:t.z}}else I=Math.atan2(b,w);h=A/l,c=o/l,u=1/Math.sqrt(1-e*(2-e)*c*c),g=c*(1-e)*u,_=h*u,T=0;do T++,p=r/Math.sqrt(1-e*_*_),G=o*g+A*_-p*(1-e*_*_),d=e*p/(p+G),u=1/Math.sqrt(1-d*(2-d)*c*c),y=c*(1-d)*u,v=h*u,E=v*g-y*_,g=y,_=v;while(E*E>n&&T<a);return C=Math.atan(v/Math.abs(y)),{x:I,y:C,z:G}}function JE(t,e,r){if(e===yr)return{x:t.x+r[0],y:t.y+r[1],z:t.z+r[2]};if(e===xr){var i=r[0],s=r[1],n=r[2],a=r[3],o=r[4],l=r[5],h=r[6];return{x:h*(t.x-l*t.y+o*t.z)+i,y:h*(l*t.x+t.y-a*t.z)+s,z:h*(-o*t.x+a*t.y+t.z)+n}}}function ew(t,e,r){if(e===yr)return{x:t.x-r[0],y:t.y-r[1],z:t.z-r[2]};if(e===xr){var i=r[0],s=r[1],n=r[2],a=r[3],o=r[4],l=r[5],h=r[6],c=(t.x-i)/h,u=(t.y-s)/h,d=(t.z-n)/h;return{x:c+l*u-o*d,y:-l*c+u+a*d,z:o*c-a*u+d}}}function is(t){return t===yr||t===xr}function tw(t,e,r){if(QE(t,e)||t.datum_type===ea||e.datum_type===ea)return r;var i=t.a,s=t.es;if(t.datum_type===$r){var n=Zl(t,!1,r);if(n!==0)return;i=Bl,s=zl}var a=e.a,o=e.b,l=e.es;if(e.datum_type===$r&&(a=Bl,o=aE,l=zl),s===l&&i===a&&!is(t.datum_type)&&!is(e.datum_type))return r;if(r=Fc(r,s,i),is(t.datum_type)&&(r=JE(r,t.datum_type,t.datum_params)),is(e.datum_type)&&(r=ew(r,e.datum_type,e.datum_params)),r=Dc(r,l,a,o),e.datum_type===$r){var h=Zl(e,!0,r);if(h!==0)return}return r}function Zl(t,e,r){if(t.grids===null||t.grids.length===0)return console.log("Grid shift grids not found"),-1;var i={x:-r.x,y:r.y},s={x:Number.NaN,y:Number.NaN},n=[];e:for(var a=0;a<t.grids.length;a++){var o=t.grids[a];if(n.push(o.name),o.isNull){s=i;break}if(o.mandatory,o.grid===null){if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1;continue}for(var l=o.grid.subgrids,h=0,c=l.length;h<c;h++){var u=l[h],d=(Math.abs(u.del[1])+Math.abs(u.del[0]))/1e4,p=u.ll[0]-d,g=u.ll[1]-d,_=u.ll[0]+(u.lim[0]-1)*u.del[0]+d,y=u.ll[1]+(u.lim[1]-1)*u.del[1]+d;if(!(g>i.y||p>i.x||y<i.y||_<i.x)&&(s=rw(i,e,u),!isNaN(s.x)))break e}}return isNaN(s.x)?(console.log("Failed to find a grid shift table for location '"+-i.x*Lt+" "+i.y*Lt+" tried: '"+n+"'"),-1):(r.x=-s.x,r.y=s.y,0)}function rw(t,e,r){var i={x:Number.NaN,y:Number.NaN};if(isNaN(t.x))return i;var s={x:t.x,y:t.y};s.x-=r.ll[0],s.y-=r.ll[1],s.x=q(s.x-Math.PI)+Math.PI;var n=Wl(s,r);if(e){if(isNaN(n.x))return i;n.x=s.x-n.x,n.y=s.y-n.y;var a=9,o=1e-12,l,h;do{if(h=Wl(n,r),isNaN(h.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}l={x:s.x-(h.x+n.x),y:s.y-(h.y+n.y)},n.x+=l.x,n.y+=l.y}while(a--&&Math.abs(l.x)>o&&Math.abs(l.y)>o);if(a<0)return console.log("Inverse grid shift iterator failed to converge."),i;i.x=q(n.x+r.ll[0]),i.y=n.y+r.ll[1]}else isNaN(n.x)||(i.x=t.x+n.x,i.y=t.y+n.y);return i}function Wl(t,e){var r={x:t.x/e.del[0],y:t.y/e.del[1]},i={x:Math.floor(r.x),y:Math.floor(r.y)},s={x:r.x-1*i.x,y:r.y-1*i.y},n={x:Number.NaN,y:Number.NaN},a;if(i.x<0||i.x>=e.lim[0]||i.y<0||i.y>=e.lim[1])return n;a=i.y*e.lim[0]+i.x;var o={x:e.cvs[a][0],y:e.cvs[a][1]};a++;var l={x:e.cvs[a][0],y:e.cvs[a][1]};a+=e.lim[0];var h={x:e.cvs[a][0],y:e.cvs[a][1]};a--;var c={x:e.cvs[a][0],y:e.cvs[a][1]},u=s.x*s.y,d=s.x*(1-s.y),p=(1-s.x)*(1-s.y),g=(1-s.x)*s.y;return n.x=p*o.x+d*l.x+g*c.x+u*h.x,n.y=p*o.y+d*l.y+g*c.y+u*h.y,n}function Xl(t,e,r){var i=r.x,s=r.y,n=r.z||0,a,o,l,h={};for(l=0;l<3;l++)if(!(e&&l===2&&r.z===void 0))switch(l===0?(a=i,"ew".indexOf(t.axis[l])!==-1?o="x":o="y"):l===1?(a=s,"ns".indexOf(t.axis[l])!==-1?o="y":o="x"):(a=n,o="z"),t.axis[l]){case"e":h[o]=a;break;case"w":h[o]=-a;break;case"n":h[o]=a;break;case"s":h[o]=-a;break;case"u":r[o]!==void 0&&(h.z=a);break;case"d":r[o]!==void 0&&(h.z=-a);break;default:return null}return h}function Gc(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}function iw(t){Hl(t.x),Hl(t.y)}function Hl(t){if(typeof Number.isFinite=="function"){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if(typeof t!="number"||t!==t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function sw(t,e){return(t.datum.datum_type===yr||t.datum.datum_type===xr||t.datum.datum_type===$r)&&e.datumCode!=="WGS84"||(e.datum.datum_type===yr||e.datum.datum_type===xr||e.datum.datum_type===$r)&&t.datumCode!=="WGS84"}function Cs(t,e,r,i){var s;Array.isArray(r)?r=Gc(r):r={x:r.x,y:r.y,z:r.z,m:r.m};var n=r.z!==void 0;if(iw(r),t.datum&&e.datum&&sw(t,e)&&(s=new Ft("WGS84"),r=Cs(t,s,r,i),t=s),i&&t.axis!=="enu"&&(r=Xl(t,!1,r)),t.projName==="longlat")r={x:r.x*je,y:r.y*je,z:r.z||0};else if(t.to_meter&&(r={x:r.x*t.to_meter,y:r.y*t.to_meter,z:r.z||0}),r=t.inverse(r),!r)return;if(t.from_greenwich&&(r.x+=t.from_greenwich),r=tw(t.datum,e.datum,r),!!r)return e.from_greenwich&&(r={x:r.x-e.from_greenwich,y:r.y,z:r.z||0}),e.projName==="longlat"?r={x:r.x*Lt,y:r.y*Lt,z:r.z||0}:(r=e.forward(r),e.to_meter&&(r={x:r.x/e.to_meter,y:r.y/e.to_meter,z:r.z||0})),i&&e.axis!=="enu"?Xl(e,!0,r):(r&&!n&&delete r.z,r)}var Vl=Ft("WGS84");function bn(t,e,r,i){var s,n,a;return Array.isArray(r)?(s=Cs(t,e,r,i)||{x:NaN,y:NaN},r.length>2?typeof t.name<"u"&&t.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"?typeof s.z=="number"?[s.x,s.y,s.z].concat(r.splice(3)):[s.x,s.y,r[2]].concat(r.splice(3)):[s.x,s.y].concat(r.splice(2)):[s.x,s.y]):(n=Cs(t,e,r,i),a=Object.keys(r),a.length===2||a.forEach(function(o){if(typeof t.name<"u"&&t.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"){if(o==="x"||o==="y"||o==="z")return}else if(o==="x"||o==="y")return;n[o]=r[o]}),n)}function Yl(t){return t instanceof Ft?t:t.oProj?t.oProj:Ft(t)}function ft(t,e,r){t=Yl(t);var i=!1,s;return typeof e>"u"?(e=t,t=Vl,i=!0):(typeof e.x<"u"||Array.isArray(e))&&(r=e,e=t,t=Vl,i=!0),e=Yl(e),r?bn(t,e,r):(s={forward:function(n,a){return bn(t,e,n,a)},inverse:function(n,a){return bn(e,t,n,a)}},i&&(s.oProj=e),s)}var Kl=6,Uc="AJSAJS",Bc="AFAFAF",Ur=65,et=73,gt=79,_i=86,yi=90;const nw={forward:zc,inverse:aw,toPoint:kc};function zc(t,e){return e=e||5,hw(ow({lat:t[1],lon:t[0]}),e)}function aw(t){var e=Eo(jc(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]}function kc(t){var e=Eo(jc(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function Rn(t){return t*(Math.PI/180)}function Ql(t){return 180*(t/Math.PI)}function ow(t){var e=t.lat,r=t.lon,i=6378137,s=.00669438,n=.9996,a,o,l,h,c,u,d,p=Rn(e),g=Rn(r),_,y;y=Math.floor((r+180)/6)+1,r===180&&(y=60),e>=56&&e<64&&r>=3&&r<12&&(y=32),e>=72&&e<84&&(r>=0&&r<9?y=31:r>=9&&r<21?y=33:r>=21&&r<33?y=35:r>=33&&r<42&&(y=37)),a=(y-1)*6-180+3,_=Rn(a),o=s/(1-s),l=i/Math.sqrt(1-s*Math.sin(p)*Math.sin(p)),h=Math.tan(p)*Math.tan(p),c=o*Math.cos(p)*Math.cos(p),u=Math.cos(p)*(g-_),d=i*((1-s/4-3*s*s/64-5*s*s*s/256)*p-(3*s/8+3*s*s/32+45*s*s*s/1024)*Math.sin(2*p)+(15*s*s/256+45*s*s*s/1024)*Math.sin(4*p)-35*s*s*s/3072*Math.sin(6*p));var v=n*l*(u+(1-h+c)*u*u*u/6+(5-18*h+h*h+72*c-58*o)*u*u*u*u*u/120)+5e5,E=n*(d+l*Math.tan(p)*(u*u/2+(5-h+9*c+4*c*c)*u*u*u*u/24+(61-58*h+h*h+600*c-330*o)*u*u*u*u*u*u/720));return e<0&&(E+=1e7),{northing:Math.round(E),easting:Math.round(v),zoneNumber:y,zoneLetter:lw(e)}}function Eo(t){var e=t.northing,r=t.easting,i=t.zoneLetter,s=t.zoneNumber;if(s<0||s>60)return null;var n=.9996,a=6378137,o=.00669438,l,h=(1-Math.sqrt(1-o))/(1+Math.sqrt(1-o)),c,u,d,p,g,_,y,v,E,T=r-5e5,w=e;i<"N"&&(w-=1e7),y=(s-1)*6-180+3,l=o/(1-o),_=w/n,v=_/(a*(1-o/4-3*o*o/64-5*o*o*o/256)),E=v+(3*h/2-27*h*h*h/32)*Math.sin(2*v)+(21*h*h/16-55*h*h*h*h/32)*Math.sin(4*v)+151*h*h*h/96*Math.sin(6*v),c=a/Math.sqrt(1-o*Math.sin(E)*Math.sin(E)),u=Math.tan(E)*Math.tan(E),d=l*Math.cos(E)*Math.cos(E),p=a*(1-o)/Math.pow(1-o*Math.sin(E)*Math.sin(E),1.5),g=T/(c*n);var b=E-c*Math.tan(E)/p*(g*g/2-(5+3*u+10*d-4*d*d-9*l)*g*g*g*g/24+(61+90*u+298*d+45*u*u-252*l-3*d*d)*g*g*g*g*g*g/720);b=Ql(b);var A=(g-(1+2*u+d)*g*g*g/6+(5-2*d+28*u-3*d*d+8*l+24*u*u)*g*g*g*g*g/120)/Math.cos(E);A=y+Ql(A);var I;if(t.accuracy){var C=Eo({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});I={top:C.lat,right:C.lon,bottom:b,left:A}}else I={lat:b,lon:A};return I}function lw(t){var e="Z";return 84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C"),e}function hw(t,e){var r="00000"+t.easting,i="00000"+t.northing;return t.zoneNumber+t.zoneLetter+uw(t.easting,t.northing,t.zoneNumber)+r.substr(r.length-5,e)+i.substr(i.length-5,e)}function uw(t,e,r){var i=$c(r),s=Math.floor(t/1e5),n=Math.floor(e/1e5)%20;return cw(s,n,i)}function $c(t){var e=t%Kl;return e===0&&(e=Kl),e}function cw(t,e,r){var i=r-1,s=Uc.charCodeAt(i),n=Bc.charCodeAt(i),a=s+t-1,o=n+e,l=!1;a>yi&&(a=a-yi+Ur-1,l=!0),(a===et||s<et&&a>et||(a>et||s<et)&&l)&&a++,(a===gt||s<gt&&a>gt||(a>gt||s<gt)&&l)&&(a++,a===et&&a++),a>yi&&(a=a-yi+Ur-1),o>_i?(o=o-_i+Ur-1,l=!0):l=!1,(o===et||n<et&&o>et||(o>et||n<et)&&l)&&o++,(o===gt||n<gt&&o>gt||(o>gt||n<gt)&&l)&&(o++,o===et&&o++),o>_i&&(o=o-_i+Ur-1);var h=String.fromCharCode(a)+String.fromCharCode(o);return h}function jc(t){if(t&&t.length===0)throw"MGRSPoint coverting from nothing";for(var e=t.length,r=null,i="",s,n=0;!/[A-Z]/.test(s=t.charAt(n));){if(n>=2)throw"MGRSPoint bad conversion from: "+t;i+=s,n++}var a=parseInt(i,10);if(n===0||n+3>e)throw"MGRSPoint bad conversion from: "+t;var o=t.charAt(n++);if(o<="A"||o==="B"||o==="Y"||o>="Z"||o==="I"||o==="O")throw"MGRSPoint zone letter "+o+" not handled: "+t;r=t.substring(n,n+=2);for(var l=$c(a),h=fw(r.charAt(0),l),c=dw(r.charAt(1),l);c<gw(o);)c+=2e6;var u=e-n;if(u%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+t;var d=u/2,p=0,g=0,_,y,v,E,T;return d>0&&(_=1e5/Math.pow(10,d),y=t.substring(n,n+d),p=parseFloat(y)*_,v=t.substring(n+d),g=parseFloat(v)*_),E=p+h,T=g+c,{easting:E,northing:T,zoneLetter:o,zoneNumber:a,accuracy:_}}function fw(t,e){for(var r=Uc.charCodeAt(e-1),i=1e5,s=!1;r!==t.charCodeAt(0);){if(r++,r===et&&r++,r===gt&&r++,r>yi){if(s)throw"Bad character: "+t;r=Ur,s=!0}i+=1e5}return i}function dw(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var r=Bc.charCodeAt(e-1),i=0,s=!1;r!==t.charCodeAt(0);){if(r++,r===et&&r++,r===gt&&r++,r>_i){if(s)throw"Bad character: "+t;r=Ur,s=!0}i+=1e5}return i}function gw(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}function Hr(t,e,r){if(!(this instanceof Hr))return new Hr(t,e,r);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if(typeof t=="object")this.x=t.x,this.y=t.y,this.z=t.z||0;else if(typeof t=="string"&&typeof e>"u"){var i=t.split(",");this.x=parseFloat(i[0],10),this.y=parseFloat(i[1],10),this.z=parseFloat(i[2],10)||0}else this.x=t,this.y=e,this.z=r||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Hr.fromMGRS=function(t){return new Hr(kc(t))};Hr.prototype.toMGRS=function(t){return zc([this.x,this.y],t)};var pw=1,mw=.25,Jl=.046875,eh=.01953125,th=.01068115234375,_w=.75,yw=.46875,xw=.013020833333333334,vw=.007120768229166667,Ew=.3645833333333333,ww=.005696614583333333,Tw=.3076171875;function qc(t){var e=[];e[0]=pw-t*(mw+t*(Jl+t*(eh+t*th))),e[1]=t*(_w-t*(Jl+t*(eh+t*th)));var r=t*t;return e[2]=r*(yw-t*(xw+t*vw)),r*=t,e[3]=r*(Ew-t*ww),e[4]=r*t*Tw,e}function tn(t,e,r,i){return r*=e,e*=e,i[0]*t-r*(i[1]+e*(i[2]+e*(i[3]+e*i[4])))}var Sw=20;function Zc(t,e,r){for(var i=1/(1-e),s=t,n=Sw;n;--n){var a=Math.sin(s),o=1-e*a*a;if(o=(tn(s,a,Math.cos(s),r)-t)*(o*Math.sqrt(o))*i,s-=o,Math.abs(o)<j)return s}return s}function Mw(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=qc(this.es),this.ml0=tn(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function bw(t){var e=t.x,r=t.y,i=q(e-this.long0),s,n,a,o=Math.sin(r),l=Math.cos(r);if(this.es){var c=l*i,u=Math.pow(c,2),d=this.ep2*Math.pow(l,2),p=Math.pow(d,2),g=Math.abs(l)>j?Math.tan(r):0,_=Math.pow(g,2),y=Math.pow(_,2);s=1-this.es*Math.pow(o,2),c=c/Math.sqrt(s);var v=tn(r,o,l,this.en);n=this.a*(this.k0*c*(1+u/6*(1-_+d+u/20*(5-18*_+y+14*d-58*_*d+u/42*(61+179*y-y*_-479*_)))))+this.x0,a=this.a*(this.k0*(v-this.ml0+o*i*c/2*(1+u/12*(5-_+9*d+4*p+u/30*(61+y-58*_+270*d-330*_*d+u/56*(1385+543*y-y*_-3111*_))))))+this.y0}else{var h=l*Math.sin(i);if(Math.abs(Math.abs(h)-1)<j)return 93;if(n=.5*this.a*this.k0*Math.log((1+h)/(1-h))+this.x0,a=l*Math.cos(i)/Math.sqrt(1-Math.pow(h,2)),h=Math.abs(a),h>=1){if(h-1>j)return 93;a=0}else a=Math.acos(a);r<0&&(a=-a),a=this.a*this.k0*(a-this.lat0)+this.y0}return t.x=n,t.y=a,t}function Rw(t){var e,r,i,s,n=(t.x-this.x0)*(1/this.a),a=(t.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+a/this.k0,r=Zc(e,this.es,this.en),Math.abs(r)<D){var u=Math.sin(r),d=Math.cos(r),p=Math.abs(d)>j?Math.tan(r):0,g=this.ep2*Math.pow(d,2),_=Math.pow(g,2),y=Math.pow(p,2),v=Math.pow(y,2);e=1-this.es*Math.pow(u,2);var E=n*Math.sqrt(e)/this.k0,T=Math.pow(E,2);e=e*p,i=r-e*T/(1-this.es)*.5*(1-T/12*(5+3*y-9*g*y+g-4*_-T/30*(61+90*y-252*g*y+45*v+46*g-T/56*(1385+3633*y+4095*v+1574*v*y)))),s=q(this.long0+E*(1-T/6*(1+2*y+g-T/20*(5+28*y+24*v+8*g*y+6*g-T/42*(61+662*y+1320*v+720*v*y))))/d)}else i=D*qi(a),s=0;else{var o=Math.exp(n/this.k0),l=.5*(o-1/o),h=this.lat0+a/this.k0,c=Math.cos(h);e=Math.sqrt((1-Math.pow(c,2))/(1+Math.pow(l,2))),i=Math.asin(e),a<0&&(i=-i),l===0&&c===0?s=0:s=q(Math.atan2(l,c)+this.long0)}return t.x=s,t.y=i,t}var Pw=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const hs={init:Mw,forward:bw,inverse:Rw,names:Pw};function Wc(t){var e=Math.exp(t);return e=(e-1/e)/2,e}function pt(t,e){t=Math.abs(t),e=Math.abs(e);var r=Math.max(t,e),i=Math.min(t,e)/(r||1);return r*Math.sqrt(1+Math.pow(i,2))}function Aw(t){var e=1+t,r=e-1;return r===0?t:t*Math.log(e)/r}function Iw(t){var e=Math.abs(t);return e=Aw(e*(1+e/(pt(1,e)+1))),t<0?-e:e}function wo(t,e){for(var r=2*Math.cos(2*e),i=t.length-1,s=t[i],n=0,a;--i>=0;)a=-n+r*s+t[i],n=s,s=a;return e+a*Math.sin(2*e)}function Lw(t,e){for(var r=2*Math.cos(e),i=t.length-1,s=t[i],n=0,a;--i>=0;)a=-n+r*s+t[i],n=s,s=a;return Math.sin(e)*a}function Cw(t){var e=Math.exp(t);return e=(e+1/e)/2,e}function Xc(t,e,r){for(var i=Math.sin(e),s=Math.cos(e),n=Wc(r),a=Cw(r),o=2*s*a,l=-2*i*n,h=t.length-1,c=t[h],u=0,d=0,p=0,g,_;--h>=0;)g=d,_=u,d=c,u=p,c=-g+o*d-l*u+t[h],p=-_+l*d+o*u;return o=i*a,l=s*n,[o*c-l*p,o*p+l*c]}function Ow(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(hs.init.apply(this),this.forward=hs.forward,this.inverse=hs.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),r=e;this.cgb[0]=e*(2+e*(-2/3+e*(-2+e*(116/45+e*(26/45+e*(-2854/675)))))),this.cbg[0]=e*(-2+e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))),r=r*e,this.cgb[1]=r*(7/3+e*(-8/5+e*(-227/45+e*(2704/315+e*(2323/945))))),this.cbg[1]=r*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),r=r*e,this.cgb[2]=r*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=r*(-26/15+e*(34/21+e*(8/5+e*(-12686/2835)))),r=r*e,this.cgb[3]=r*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=r*(1237/630+e*(-12/5+e*(-24832/14175))),r=r*e,this.cgb[4]=r*(4174/315+e*(-144838/6237)),this.cbg[4]=r*(-734/315+e*(109598/31185)),r=r*e,this.cgb[5]=r*(601676/22275),this.cbg[5]=r*(444337/155925),r=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+r*(1/4+r*(1/64+r/256))),this.utg[0]=e*(-.5+e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=r*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=r*(13/48+e*(-3/5+e*(557/1440+e*(281/630+e*(-1983433/1935360))))),r=r*e,this.utg[2]=r*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=r*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),r=r*e,this.utg[3]=r*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=r*(49561/161280+e*(-179/168+e*(6601661/7257600))),r=r*e,this.utg[4]=r*(-4583/161280+e*(108847/3991680)),this.gtu[4]=r*(34729/80640+e*(-3418889/1995840)),r=r*e,this.utg[5]=r*(-20648693/638668800),this.gtu[5]=r*(212378941/319334400);var i=wo(this.cbg,this.lat0);this.Zb=-this.Qn*(i+Lw(this.gtu,2*i))}function Nw(t){var e=q(t.x-this.long0),r=t.y;r=wo(this.cbg,r);var i=Math.sin(r),s=Math.cos(r),n=Math.sin(e),a=Math.cos(e);r=Math.atan2(i,a*s),e=Math.atan2(n*s,pt(i,s*a)),e=Iw(Math.tan(e));var o=Xc(this.gtu,2*r,2*e);r=r+o[0],e=e+o[1];var l,h;return Math.abs(e)<=2.623395162778?(l=this.a*(this.Qn*e)+this.x0,h=this.a*(this.Qn*r+this.Zb)+this.y0):(l=1/0,h=1/0),t.x=l,t.y=h,t}function Fw(t){var e=(t.x-this.x0)*(1/this.a),r=(t.y-this.y0)*(1/this.a);r=(r-this.Zb)/this.Qn,e=e/this.Qn;var i,s;if(Math.abs(e)<=2.623395162778){var n=Xc(this.utg,2*r,2*e);r=r+n[0],e=e+n[1],e=Math.atan(Wc(e));var a=Math.sin(r),o=Math.cos(r),l=Math.sin(e),h=Math.cos(e);r=Math.atan2(a*h,pt(l,h*o)),e=Math.atan2(l,h*o),i=q(e+this.long0),s=wo(this.cgb,r)}else i=1/0,s=1/0;return t.x=i,t.y=s,t}var Dw=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const us={init:Ow,forward:Nw,inverse:Fw,names:Dw};function Gw(t,e){if(t===void 0){if(t=Math.floor((q(e)+Math.PI)*30/Math.PI)+1,t<0)return 0;if(t>60)return 60}return t}var Uw="etmerc";function Bw(){var t=Gw(this.zone,this.long0);if(t===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*je,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,us.init.apply(this),this.forward=us.forward,this.inverse=us.inverse}var zw=["Universal Transverse Mercator System","utm"];const kw={init:Bw,names:zw,dependsOn:Uw};function To(t,e){return Math.pow((1-t)/(1+t),e)}var $w=20;function jw(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+we)/(Math.pow(Math.tan(.5*this.lat0+we),this.C)*To(this.e*t,this.ratexp))}function qw(t){var e=t.x,r=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*r+we),this.C)*To(this.e*Math.sin(r),this.ratexp))-D,t.x=this.C*e,t}function Zw(t){for(var e=1e-14,r=t.x/this.C,i=t.y,s=Math.pow(Math.tan(.5*i+we)/this.K,1/this.C),n=$w;n>0&&(i=2*Math.atan(s*To(this.e*Math.sin(t.y),-.5*this.e))-D,!(Math.abs(i-t.y)<e));--n)t.y=i;return n?(t.x=r,t.y=i,t):null}var Ww=["gauss"];const So={init:jw,forward:qw,inverse:Zw,names:Ww};function Xw(){So.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function Hw(t){var e,r,i,s;return t.x=q(t.x-this.long0),So.forward.apply(this,[t]),e=Math.sin(t.y),r=Math.cos(t.y),i=Math.cos(t.x),s=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*r*i),t.x=s*r*Math.sin(t.x),t.y=s*(this.cosc0*e-this.sinc0*r*i),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function Vw(t){var e,r,i,s,n;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,n=pt(t.x,t.y)){var a=2*Math.atan2(n,this.R2);e=Math.sin(a),r=Math.cos(a),s=Math.asin(r*this.sinc0+t.y*e*this.cosc0/n),i=Math.atan2(t.x*e,n*this.cosc0*r-t.y*this.sinc0*e)}else s=this.phic0,i=0;return t.x=i,t.y=s,So.inverse.apply(this,[t]),t.x=q(t.x+this.long0),t}var Yw=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const Kw={init:Xw,forward:Hw,inverse:Vw,names:Yw};function Qw(t,e,r){return e*=r,Math.tan(.5*(D+t))*Math.pow((1-e)/(1+e),.5*r)}function Jw(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=j&&(this.k0=.5*(1+qi(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=j&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=j&&Math.abs(Math.cos(this.lat_ts))>j&&(this.k0=.5*this.cons*Ut(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Tt(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Ut(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-D,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function eT(t){var e=t.x,r=t.y,i=Math.sin(r),s=Math.cos(r),n,a,o,l,h,c,u=q(e-this.long0);return Math.abs(Math.abs(e-this.long0)-Math.PI)<=j&&Math.abs(r+this.lat0)<=j?(t.x=NaN,t.y=NaN,t):this.sphere?(n=2*this.k0/(1+this.sinlat0*i+this.coslat0*s*Math.cos(u)),t.x=this.a*n*s*Math.sin(u)+this.x0,t.y=this.a*n*(this.coslat0*i-this.sinlat0*s*Math.cos(u))+this.y0,t):(a=2*Math.atan(this.ssfn_(r,i,this.e))-D,l=Math.cos(a),o=Math.sin(a),Math.abs(this.coslat0)<=j?(h=Tt(this.e,r*this.con,this.con*i),c=2*this.a*this.k0*h/this.cons,t.x=this.x0+c*Math.sin(e-this.long0),t.y=this.y0-this.con*c*Math.cos(e-this.long0),t):(Math.abs(this.sinlat0)<j?(n=2*this.a*this.k0/(1+l*Math.cos(u)),t.y=n*o):(n=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*o+this.cosX0*l*Math.cos(u))),t.y=n*(this.cosX0*o-this.sinX0*l*Math.cos(u))+this.y0),t.x=n*l*Math.sin(u)+this.x0,t))}function tT(t){t.x-=this.x0,t.y-=this.y0;var e,r,i,s,n,a=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var o=2*Math.atan(a/(2*this.a*this.k0));return e=this.long0,r=this.lat0,a<=j?(t.x=e,t.y=r,t):(r=Math.asin(Math.cos(o)*this.sinlat0+t.y*Math.sin(o)*this.coslat0/a),Math.abs(this.coslat0)<j?this.lat0>0?e=q(this.long0+Math.atan2(t.x,-1*t.y)):e=q(this.long0+Math.atan2(t.x,t.y)):e=q(this.long0+Math.atan2(t.x*Math.sin(o),a*this.coslat0*Math.cos(o)-t.y*this.sinlat0*Math.sin(o))),t.x=e,t.y=r,t)}else if(Math.abs(this.coslat0)<=j){if(a<=j)return r=this.lat0,e=this.long0,t.x=e,t.y=r,t;t.x*=this.con,t.y*=this.con,i=a*this.cons/(2*this.a*this.k0),r=this.con*Di(this.e,i),e=this.con*q(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else s=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,a<=j?n=this.X0:(n=Math.asin(Math.cos(s)*this.sinX0+t.y*Math.sin(s)*this.cosX0/a),e=q(this.long0+Math.atan2(t.x*Math.sin(s),a*this.cosX0*Math.cos(s)-t.y*this.sinX0*Math.sin(s)))),r=-1*Di(this.e,Math.tan(.5*(D+n)));return t.x=e,t.y=r,t}var rT=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const iT={init:Jw,forward:eT,inverse:tT,names:rT,ssfn_:Qw};function sT(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),r=this.a,i=this.rf,s=1/i,n=2*s-Math.pow(s,2),a=this.e=Math.sqrt(n);this.R=this.k0*r*Math.sqrt(1-n)/(1-n*Math.pow(e,2)),this.alpha=Math.sqrt(1+n/(1-n)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),l=Math.log(Math.tan(Math.PI/4+t/2)),h=Math.log((1+a*e)/(1-a*e));this.K=o-this.alpha*l+this.alpha*a/2*h}function nT(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),r=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),i=-this.alpha*(e+r)+this.K,s=2*(Math.atan(Math.exp(i))-Math.PI/4),n=this.alpha*(t.x-this.lambda0),a=Math.atan(Math.sin(n)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(n))),o=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(n));return t.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,t.x=this.R*a+this.x0,t}function aT(t){for(var e=t.x-this.x0,r=t.y-this.y0,i=e/this.R,s=2*(Math.atan(Math.exp(r/this.R))-Math.PI/4),n=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(i)),a=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(s))),o=this.lambda0+a/this.alpha,l=0,h=n,c=-1e3,u=0;Math.abs(h-c)>1e-7;){if(++u>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+n/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),c=h,h=2*Math.atan(Math.exp(l))-Math.PI/2}return t.x=o,t.y=h,t}var oT=["somerc"];const lT={init:sT,forward:nT,inverse:aT,names:oT};var Lr=1e-7;function hT(t){var e=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],r=typeof t.PROJECTION=="object"?Object.keys(t.PROJECTION)[0]:t.PROJECTION;return"no_uoff"in t||"no_off"in t||e.indexOf(r)!==-1}function uT(){var t,e,r,i,s,n,a,o,l,h,c=0,u,d=0,p=0,g=0,_=0,y=0,v=0;this.no_off=hT(this),this.no_rot="no_rot"in this;var E=!1;"alpha"in this&&(E=!0);var T=!1;if("rectified_grid_angle"in this&&(T=!0),E&&(v=this.alpha),T&&(c=this.rectified_grid_angle*je),E||T)d=this.longc;else if(p=this.long1,_=this.lat1,g=this.long2,y=this.lat2,Math.abs(_-y)<=Lr||(t=Math.abs(_))<=Lr||Math.abs(t-D)<=Lr||Math.abs(Math.abs(this.lat0)-D)<=Lr||Math.abs(Math.abs(y)-D)<=Lr)throw new Error;var w=1-this.es;e=Math.sqrt(w),Math.abs(this.lat0)>j?(o=Math.sin(this.lat0),r=Math.cos(this.lat0),t=1-this.es*o*o,this.B=r*r,this.B=Math.sqrt(1+this.es*this.B*this.B/w),this.A=this.B*this.k0*e/t,i=this.B*e/(r*Math.sqrt(t)),s=i*i-1,s<=0?s=0:(s=Math.sqrt(s),this.lat0<0&&(s=-s)),this.E=s+=i,this.E*=Math.pow(Tt(this.e,this.lat0,o),this.B)):(this.B=1/e,this.A=this.k0,this.E=i=s=1),E||T?(E?(u=Math.asin(Math.sin(v)/i),T||(c=v)):(u=c,v=Math.asin(i*Math.sin(u))),this.lam0=d-Math.asin(.5*(s-1/s)*Math.tan(u))/this.B):(n=Math.pow(Tt(this.e,_,Math.sin(_)),this.B),a=Math.pow(Tt(this.e,y,Math.sin(y)),this.B),s=this.E/n,l=(a-n)/(a+n),h=this.E*this.E,h=(h-a*n)/(h+a*n),t=p-g,t<-Math.pi?g-=Ni:t>Math.pi&&(g+=Ni),this.lam0=q(.5*(p+g)-Math.atan(h*Math.tan(.5*this.B*(p-g))/l)/this.B),u=Math.atan(2*Math.sin(this.B*q(p-this.lam0))/(s-1/s)),c=v=Math.asin(i*Math.sin(u))),this.singam=Math.sin(u),this.cosgam=Math.cos(u),this.sinrot=Math.sin(c),this.cosrot=Math.cos(c),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(i*i-1)/Math.cos(v))),this.lat0<0&&(this.u_0=-this.u_0)),s=.5*u,this.v_pole_n=this.ArB*Math.log(Math.tan(we-s)),this.v_pole_s=this.ArB*Math.log(Math.tan(we+s))}function cT(t){var e={},r,i,s,n,a,o,l,h;if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-D)>j){if(a=this.E/Math.pow(Tt(this.e,t.y,Math.sin(t.y)),this.B),o=1/a,r=.5*(a-o),i=.5*(a+o),n=Math.sin(this.B*t.x),s=(r*this.singam-n*this.cosgam)/i,Math.abs(Math.abs(s)-1)<j)throw new Error;h=.5*this.ArB*Math.log((1-s)/(1+s)),o=Math.cos(this.B*t.x),Math.abs(o)<Lr?l=this.A*t.x:l=this.ArB*Math.atan2(r*this.cosgam+n*this.singam,o)}else h=t.y>0?this.v_pole_n:this.v_pole_s,l=this.ArB*t.y;return this.no_rot?(e.x=l,e.y=h):(l-=this.u_0,e.x=h*this.cosrot+l*this.sinrot,e.y=l*this.cosrot-h*this.sinrot),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function fT(t){var e,r,i,s,n,a,o,l={};if(t.x=(t.x-this.x0)*(1/this.a),t.y=(t.y-this.y0)*(1/this.a),this.no_rot?(r=t.y,e=t.x):(r=t.x*this.cosrot-t.y*this.sinrot,e=t.y*this.cosrot+t.x*this.sinrot+this.u_0),i=Math.exp(-this.BrA*r),s=.5*(i-1/i),n=.5*(i+1/i),a=Math.sin(this.BrA*e),o=(a*this.cosgam+s*this.singam)/n,Math.abs(Math.abs(o)-1)<j)l.x=0,l.y=o<0?-D:D;else{if(l.y=this.E/Math.sqrt((1+o)/(1-o)),l.y=Di(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(s*this.cosgam-a*this.singam,Math.cos(this.BrA*e))}return l.x+=this.lam0,l}var dT=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const gT={init:uT,forward:cT,inverse:fT,names:dT};function pT(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<j)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),r=Math.cos(this.lat1),i=Ut(this.e,e,r),s=Tt(this.e,this.lat1,e),n=Math.sin(this.lat2),a=Math.cos(this.lat2),o=Ut(this.e,n,a),l=Tt(this.e,this.lat2,n),h=Tt(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>j?this.ns=Math.log(i/o)/Math.log(s/l):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=i/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function mT(t){var e=t.x,r=t.y;Math.abs(2*Math.abs(r)-Math.PI)<=j&&(r=qi(r)*(D-2*j));var i=Math.abs(Math.abs(r)-D),s,n;if(i>j)s=Tt(this.e,r,Math.sin(r)),n=this.a*this.f0*Math.pow(s,this.ns);else{if(i=r*this.ns,i<=0)return null;n=0}var a=this.ns*q(e-this.long0);return t.x=this.k0*(n*Math.sin(a))+this.x0,t.y=this.k0*(this.rh-n*Math.cos(a))+this.y0,t}function _T(t){var e,r,i,s,n,a=(t.x-this.x0)/this.k0,o=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(a*a+o*o),r=1):(e=-Math.sqrt(a*a+o*o),r=-1);var l=0;if(e!==0&&(l=Math.atan2(r*a,r*o)),e!==0||this.ns>0){if(r=1/this.ns,i=Math.pow(e/(this.a*this.f0),r),s=Di(this.e,i),s===-9999)return null}else s=-D;return n=q(l/this.ns+this.long0),t.x=n,t.y=s,t}var yT=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const xT={init:pT,forward:mT,inverse:_T,names:yT};function vT(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function ET(t){var e,r,i,s,n,a,o,l=t.x,h=t.y,c=q(l-this.long0);return e=Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.alfa*this.e/2),r=2*(Math.atan(this.k*Math.pow(Math.tan(h/2+this.s45),this.alfa)/e)-this.s45),i=-c*this.alfa,s=Math.asin(Math.cos(this.ad)*Math.sin(r)+Math.sin(this.ad)*Math.cos(r)*Math.cos(i)),n=Math.asin(Math.cos(r)*Math.sin(i)/Math.cos(s)),a=this.n*n,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n),t.y=o*Math.cos(a)/1,t.x=o*Math.sin(a)/1,this.czech||(t.y*=-1,t.x*=-1),t}function wT(t){var e,r,i,s,n,a,o,l,h=t.x;t.x=t.y,t.y=h,this.czech||(t.y*=-1,t.x*=-1),a=Math.sqrt(t.x*t.x+t.y*t.y),n=Math.atan2(t.y,t.x),s=n/Math.sin(this.s0),i=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(i)-Math.sin(this.ad)*Math.cos(i)*Math.cos(s)),r=Math.asin(Math.cos(i)*Math.sin(s)/Math.cos(e)),t.x=this.long0-r/this.alfa,o=e,l=0;var c=0;do t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-t.y)<1e-10&&(l=1),o=t.y,c+=1;while(l===0&&c<15);return c>=15?null:t}var TT=["Krovak","krovak"];const ST={init:vT,forward:ET,inverse:wT,names:TT};function Ke(t,e,r,i,s){return t*s-e*Math.sin(2*s)+r*Math.sin(4*s)-i*Math.sin(6*s)}function Zi(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function Wi(t){return .375*t*(1+.25*t*(1+.46875*t))}function Xi(t){return .05859375*t*t*(1+.75*t)}function Hi(t){return t*t*t*(35/3072)}function Vr(t,e,r){var i=e*r;return t/Math.sqrt(1-i*i)}function ai(t){return Math.abs(t)<D?t:t-qi(t)*Math.PI}function Os(t,e,r,i,s){var n,a;n=t/e;for(var o=0;o<15;o++)if(a=(t-(e*n-r*Math.sin(2*n)+i*Math.sin(4*n)-s*Math.sin(6*n)))/(e-2*r*Math.cos(2*n)+4*i*Math.cos(4*n)-6*s*Math.cos(6*n)),n+=a,Math.abs(a)<=1e-10)return n;return NaN}function MT(){this.sphere||(this.e0=Zi(this.es),this.e1=Wi(this.es),this.e2=Xi(this.es),this.e3=Hi(this.es),this.ml0=this.a*Ke(this.e0,this.e1,this.e2,this.e3,this.lat0))}function bT(t){var e,r,i=t.x,s=t.y;if(i=q(i-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(s)*Math.sin(i)),r=this.a*(Math.atan2(Math.tan(s),Math.cos(i))-this.lat0);else{var n=Math.sin(s),a=Math.cos(s),o=Vr(this.a,this.e,n),l=Math.tan(s)*Math.tan(s),h=i*Math.cos(s),c=h*h,u=this.es*a*a/(1-this.es),d=this.a*Ke(this.e0,this.e1,this.e2,this.e3,s);e=o*h*(1-c*l*(1/6-(8-l+8*u)*c/120)),r=d-this.ml0+o*n/a*c*(.5+(5-l+6*u)*c/24)}return t.x=e+this.x0,t.y=r+this.y0,t}function RT(t){t.x-=this.x0,t.y-=this.y0;var e=t.x/this.a,r=t.y/this.a,i,s;if(this.sphere){var n=r+this.lat0;i=Math.asin(Math.sin(n)*Math.cos(e)),s=Math.atan2(Math.tan(e),Math.cos(n))}else{var a=this.ml0/this.a+r,o=Os(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-D)<=j)return t.x=this.long0,t.y=D,r<0&&(t.y*=-1),t;var l=Vr(this.a,this.e,Math.sin(o)),h=l*l*l/this.a/this.a*(1-this.es),c=Math.pow(Math.tan(o),2),u=e*this.a/l,d=u*u;i=o-l*Math.tan(o)/h*u*u*(.5-(1+3*c)*u*u/24),s=u*(1-d*(c/3+(1+3*c)*c*d/15))/Math.cos(o)}return t.x=q(s+this.long0),t.y=ai(i),t}var PT=["Cassini","Cassini_Soldner","cass"];const AT={init:MT,forward:bT,inverse:RT,names:PT};function tr(t,e){var r;return t>1e-7?(r=t*e,(1-t*t)*(e/(1-r*r)-.5/t*Math.log((1-r)/(1+r)))):2*e}var IT=1,LT=2,CT=3,OT=4;function NT(){var t=Math.abs(this.lat0);if(Math.abs(t-D)<j?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<j?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var e;switch(this.qp=tr(this.e,1),this.mmf=.5/(1-this.es),this.apa=jT(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=tr(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function FT(t){var e,r,i,s,n,a,o,l,h,c,u=t.x,d=t.y;if(u=q(u-this.long0),this.sphere){if(n=Math.sin(d),c=Math.cos(d),i=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(r=this.mode===this.EQUIT?1+c*i:1+this.sinph0*n+this.cosph0*c*i,r<=j)return null;r=Math.sqrt(2/r),e=r*c*Math.sin(u),r*=this.mode===this.EQUIT?n:this.cosph0*n-this.sinph0*c*i}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),Math.abs(d+this.lat0)<j)return null;r=we-d*.5,r=2*(this.mode===this.S_POLE?Math.cos(r):Math.sin(r)),e=r*Math.sin(u),r*=i}}else{switch(o=0,l=0,h=0,i=Math.cos(u),s=Math.sin(u),n=Math.sin(d),a=tr(this.e,n),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(o=a/this.qp,l=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:h=1+this.sinb1*o+this.cosb1*l*i;break;case this.EQUIT:h=1+l*i;break;case this.N_POLE:h=D+d,a=this.qp-a;break;case this.S_POLE:h=d-D,a=this.qp+a;break}if(Math.abs(h)<j)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),this.mode===this.OBLIQ?r=this.ymf*h*(this.cosb1*o-this.sinb1*l*i):r=(h=Math.sqrt(2/(1+l*i)))*o*this.ymf,e=this.xmf*h*l*s;break;case this.N_POLE:case this.S_POLE:a>=0?(e=(h=Math.sqrt(a))*s,r=i*(this.mode===this.S_POLE?h:-h)):e=r=0;break}}return t.x=this.a*e+this.x0,t.y=this.a*r+this.y0,t}function DT(t){t.x-=this.x0,t.y-=this.y0;var e=t.x/this.a,r=t.y/this.a,i,s,n,a,o,l,h;if(this.sphere){var c=0,u,d=0;if(u=Math.sqrt(e*e+r*r),s=u*.5,s>1)return null;switch(s=2*Math.asin(s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(d=Math.sin(s),c=Math.cos(s)),this.mode){case this.EQUIT:s=Math.abs(u)<=j?0:Math.asin(r*d/u),e*=d,r=c*u;break;case this.OBLIQ:s=Math.abs(u)<=j?this.lat0:Math.asin(c*this.sinph0+r*d*this.cosph0/u),e*=d*this.cosph0,r=(c-Math.sin(s)*this.sinph0)*u;break;case this.N_POLE:r=-r,s=D-s;break;case this.S_POLE:s-=D;break}i=r===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(e,r)}else{if(h=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e/=this.dd,r*=this.dd,l=Math.sqrt(e*e+r*r),l<j)return t.x=this.long0,t.y=this.lat0,t;a=2*Math.asin(.5*l/this.rq),n=Math.cos(a),e*=a=Math.sin(a),this.mode===this.OBLIQ?(h=n*this.sinb1+r*a*this.cosb1/l,o=this.qp*h,r=l*this.cosb1*n-r*this.sinb1*a):(h=r*a/l,o=this.qp*h,r=l*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(r=-r),o=e*e+r*r,!o)return t.x=this.long0,t.y=this.lat0,t;h=1-o/this.qp,this.mode===this.S_POLE&&(h=-h)}i=Math.atan2(e,r),s=qT(Math.asin(h),this.apa)}return t.x=q(this.long0+i),t.y=s,t}var GT=.3333333333333333,UT=.17222222222222222,BT=.10257936507936508,zT=.06388888888888888,kT=.0664021164021164,$T=.016415012942191543;function jT(t){var e,r=[];return r[0]=t*GT,e=t*t,r[0]+=e*UT,r[1]=e*zT,e*=t,r[0]+=e*BT,r[1]+=e*kT,r[2]=e*$T,r}function qT(t,e){var r=t+t;return t+e[0]*Math.sin(r)+e[1]*Math.sin(r+r)+e[2]*Math.sin(r+r+r)}var ZT=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const WT={init:NT,forward:FT,inverse:DT,names:ZT,S_POLE:IT,N_POLE:LT,EQUIT:CT,OBLIQ:OT};function nr(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}function XT(){Math.abs(this.lat1+this.lat2)<j||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Ut(this.e3,this.sin_po,this.cos_po),this.qs1=tr(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Ut(this.e3,this.sin_po,this.cos_po),this.qs2=tr(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=tr(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>j?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function HT(t){var e=t.x,r=t.y;this.sin_phi=Math.sin(r),this.cos_phi=Math.cos(r);var i=tr(this.e3,this.sin_phi),s=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,n=this.ns0*q(e-this.long0),a=s*Math.sin(n)+this.x0,o=this.rh-s*Math.cos(n)+this.y0;return t.x=a,t.y=o,t}function VT(t){var e,r,i,s,n,a;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),i=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),i=-1),s=0,e!==0&&(s=Math.atan2(i*t.x,i*t.y)),i=e*this.ns0/this.a,this.sphere?a=Math.asin((this.c-i*i)/(2*this.ns0)):(r=(this.c-i*i)/this.ns0,a=this.phi1z(this.e3,r)),n=q(s/this.ns0+this.long0),t.x=n,t.y=a,t}function YT(t,e){var r,i,s,n,a,o=nr(.5*e);if(t<j)return o;for(var l=t*t,h=1;h<=25;h++)if(r=Math.sin(o),i=Math.cos(o),s=t*r,n=1-s*s,a=.5*n*n/i*(e/(1-l)-r/n+.5/t*Math.log((1-s)/(1+s))),o=o+a,Math.abs(a)<=1e-7)return o;return null}var KT=["Albers_Conic_Equal_Area","Albers","aea"];const QT={init:XT,forward:HT,inverse:VT,names:KT,phi1z:YT};function JT(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function eS(t){var e,r,i,s,n,a,o,l,h=t.x,c=t.y;return i=q(h-this.long0),e=Math.sin(c),r=Math.cos(c),s=Math.cos(i),a=this.sin_p14*e+this.cos_p14*r*s,n=1,a>0||Math.abs(a)<=j?(o=this.x0+this.a*n*r*Math.sin(i)/a,l=this.y0+this.a*n*(this.cos_p14*e-this.sin_p14*r*s)/a):(o=this.x0+this.infinity_dist*r*Math.sin(i),l=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*r*s)),t.x=o,t.y=l,t}function tS(t){var e,r,i,s,n,a;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(s=Math.atan2(e,this.rc),r=Math.sin(s),i=Math.cos(s),a=nr(i*this.sin_p14+t.y*r*this.cos_p14/e),n=Math.atan2(t.x*r,e*this.cos_p14*i-t.y*this.sin_p14*r),n=q(this.long0+n)):(a=this.phic0,n=0),t.x=n,t.y=a,t}var rS=["gnom"];const iS={init:JT,forward:eS,inverse:tS,names:rS};function sS(t,e){var r=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-r)<1e-6)return e<0?-1*D:D;for(var i=Math.asin(.5*e),s,n,a,o,l=0;l<30;l++)if(n=Math.sin(i),a=Math.cos(i),o=t*n,s=Math.pow(1-o*o,2)/(2*a)*(e/(1-t*t)-n/(1-o*o)+.5/t*Math.log((1-o)/(1+o))),i+=s,Math.abs(s)<=1e-10)return i;return NaN}function nS(){this.sphere||(this.k0=Ut(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function aS(t){var e=t.x,r=t.y,i,s,n=q(e-this.long0);if(this.sphere)i=this.x0+this.a*n*Math.cos(this.lat_ts),s=this.y0+this.a*Math.sin(r)/Math.cos(this.lat_ts);else{var a=tr(this.e,Math.sin(r));i=this.x0+this.a*this.k0*n,s=this.y0+this.a*a*.5/this.k0}return t.x=i,t.y=s,t}function oS(t){t.x-=this.x0,t.y-=this.y0;var e,r;return this.sphere?(e=q(this.long0+t.x/this.a/Math.cos(this.lat_ts)),r=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(r=sS(this.e,2*t.y*this.k0/this.a),e=q(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=r,t}var lS=["cea"];const hS={init:nS,forward:aS,inverse:oS,names:lS};function uS(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function cS(t){var e=t.x,r=t.y,i=q(e-this.long0),s=ai(r-this.lat0);return t.x=this.x0+this.a*i*this.rc,t.y=this.y0+this.a*s,t}function fS(t){var e=t.x,r=t.y;return t.x=q(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=ai(this.lat0+(r-this.y0)/this.a),t}var dS=["Equirectangular","Equidistant_Cylindrical","eqc"];const gS={init:uS,forward:cS,inverse:fS,names:dS};var rh=20;function pS(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Zi(this.es),this.e1=Wi(this.es),this.e2=Xi(this.es),this.e3=Hi(this.es),this.ml0=this.a*Ke(this.e0,this.e1,this.e2,this.e3,this.lat0)}function mS(t){var e=t.x,r=t.y,i,s,n,a=q(e-this.long0);if(n=a*Math.sin(r),this.sphere)Math.abs(r)<=j?(i=this.a*a,s=-1*this.a*this.lat0):(i=this.a*Math.sin(n)/Math.tan(r),s=this.a*(ai(r-this.lat0)+(1-Math.cos(n))/Math.tan(r)));else if(Math.abs(r)<=j)i=this.a*a,s=-1*this.ml0;else{var o=Vr(this.a,this.e,Math.sin(r))/Math.tan(r);i=o*Math.sin(n),s=this.a*Ke(this.e0,this.e1,this.e2,this.e3,r)-this.ml0+o*(1-Math.cos(n))}return t.x=i+this.x0,t.y=s+this.y0,t}function _S(t){var e,r,i,s,n,a,o,l,h;if(i=t.x-this.x0,s=t.y-this.y0,this.sphere)if(Math.abs(s+this.a*this.lat0)<=j)e=q(i/this.a+this.long0),r=0;else{a=this.lat0+s/this.a,o=i*i/this.a/this.a+a*a,l=a;var c;for(n=rh;n;--n)if(c=Math.tan(l),h=-1*(a*(l*c+1)-l-.5*(l*l+o)*c)/((l-a)/c-1),l+=h,Math.abs(h)<=j){r=l;break}e=q(this.long0+Math.asin(i*Math.tan(l)/this.a)/Math.sin(r))}else if(Math.abs(s+this.ml0)<=j)r=0,e=q(this.long0+i/this.a);else{a=(this.ml0+s)/this.a,o=i*i/this.a/this.a+a*a,l=a;var u,d,p,g,_;for(n=rh;n;--n)if(_=this.e*Math.sin(l),u=Math.sqrt(1-_*_)*Math.tan(l),d=this.a*Ke(this.e0,this.e1,this.e2,this.e3,l),p=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),g=d/this.a,h=(a*(u*g+1)-g-.5*u*(g*g+o))/(this.es*Math.sin(2*l)*(g*g+o-2*a*g)/(4*u)+(a-g)*(u*p-2/Math.sin(2*l))-p),l-=h,Math.abs(h)<=j){r=l;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(r),2))*Math.tan(r),e=q(this.long0+Math.asin(i*u/this.a)/Math.sin(r))}return t.x=e,t.y=r,t}var yS=["Polyconic","poly"];const xS={init:pS,forward:mS,inverse:_S,names:yS};function vS(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function ES(t){var e,r=t.x,i=t.y,s=i-this.lat0,n=r-this.long0,a=s/Ti*1e-5,o=n,l=1,h=0;for(e=1;e<=10;e++)l=l*a,h=h+this.A[e]*l;var c=h,u=o,d=1,p=0,g,_,y=0,v=0;for(e=1;e<=6;e++)g=d*c-p*u,_=p*c+d*u,d=g,p=_,y=y+this.B_re[e]*d-this.B_im[e]*p,v=v+this.B_im[e]*d+this.B_re[e]*p;return t.x=v*this.a+this.x0,t.y=y*this.a+this.y0,t}function wS(t){var e,r=t.x,i=t.y,s=r-this.x0,n=i-this.y0,a=n/this.a,o=s/this.a,l=1,h=0,c,u,d=0,p=0;for(e=1;e<=6;e++)c=l*a-h*o,u=h*a+l*o,l=c,h=u,d=d+this.C_re[e]*l-this.C_im[e]*h,p=p+this.C_im[e]*l+this.C_re[e]*h;for(var g=0;g<this.iterations;g++){var _=d,y=p,v,E,T=a,w=o;for(e=2;e<=6;e++)v=_*d-y*p,E=y*d+_*p,_=v,y=E,T=T+(e-1)*(this.B_re[e]*_-this.B_im[e]*y),w=w+(e-1)*(this.B_im[e]*_+this.B_re[e]*y);_=1,y=0;var b=this.B_re[1],A=this.B_im[1];for(e=2;e<=6;e++)v=_*d-y*p,E=y*d+_*p,_=v,y=E,b=b+e*(this.B_re[e]*_-this.B_im[e]*y),A=A+e*(this.B_im[e]*_+this.B_re[e]*y);var I=b*b+A*A;d=(T*b+w*A)/I,p=(w*b-T*A)/I}var C=d,G=p,U=1,X=0;for(e=1;e<=9;e++)U=U*C,X=X+this.D[e]*U;var V=this.lat0+X*Ti*1e5,f=this.long0+G;return t.x=f,t.y=V,t}var TS=["New_Zealand_Map_Grid","nzmg"];const SS={init:vS,forward:ES,inverse:wS,names:TS};function MS(){}function bS(t){var e=t.x,r=t.y,i=q(e-this.long0),s=this.x0+this.a*i,n=this.y0+this.a*Math.log(Math.tan(Math.PI/4+r/2.5))*1.25;return t.x=s,t.y=n,t}function RS(t){t.x-=this.x0,t.y-=this.y0;var e=q(this.long0+t.x/this.a),r=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=r,t}var PS=["Miller_Cylindrical","mill"];const AS={init:MS,forward:bS,inverse:RS,names:PS};var IS=20;function LS(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=qc(this.es)}function CS(t){var e,r,i=t.x,s=t.y;if(i=q(i-this.long0),this.sphere){if(!this.m)s=this.n!==1?Math.asin(this.n*Math.sin(s)):s;else for(var n=this.n*Math.sin(s),a=IS;a;--a){var o=(this.m*s+Math.sin(s)-n)/(this.m+Math.cos(s));if(s-=o,Math.abs(o)<j)break}e=this.a*this.C_x*i*(this.m+Math.cos(s)),r=this.a*this.C_y*s}else{var l=Math.sin(s),h=Math.cos(s);r=this.a*tn(s,l,h,this.en),e=this.a*i*h/Math.sqrt(1-this.es*l*l)}return t.x=e,t.y=r,t}function OS(t){var e,r,i,s;return t.x-=this.x0,i=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,i=i/(this.C_x*(this.m+Math.cos(e))),this.m?e=nr((this.m*e+Math.sin(e))/this.n):this.n!==1&&(e=nr(Math.sin(e)/this.n)),i=q(i+this.long0),e=ai(e)):(e=Zc(t.y/this.a,this.es,this.en),s=Math.abs(e),s<D?(s=Math.sin(e),r=this.long0+t.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(e)),i=q(r)):s-j<D&&(i=this.long0)),t.x=i,t.y=e,t}var NS=["Sinusoidal","sinu"];const FS={init:LS,forward:CS,inverse:OS,names:NS};function DS(){}function GS(t){for(var e=t.x,r=t.y,i=q(e-this.long0),s=r,n=Math.PI*Math.sin(r);;){var a=-(s+Math.sin(s)-n)/(1+Math.cos(s));if(s+=a,Math.abs(a)<j)break}s/=2,Math.PI/2-Math.abs(r)<j&&(i=0);var o=.900316316158*this.a*i*Math.cos(s)+this.x0,l=1.4142135623731*this.a*Math.sin(s)+this.y0;return t.x=o,t.y=l,t}function US(t){var e,r;t.x-=this.x0,t.y-=this.y0,r=t.y/(1.4142135623731*this.a),Math.abs(r)>.999999999999&&(r=.999999999999),e=Math.asin(r);var i=q(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));i<-Math.PI&&(i=-Math.PI),i>Math.PI&&(i=Math.PI),r=(2*e+Math.sin(2*e))/Math.PI,Math.abs(r)>1&&(r=1);var s=Math.asin(r);return t.x=i,t.y=s,t}var BS=["Mollweide","moll"];const zS={init:DS,forward:GS,inverse:US,names:BS};function kS(){Math.abs(this.lat1+this.lat2)<j||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Zi(this.es),this.e1=Wi(this.es),this.e2=Xi(this.es),this.e3=Hi(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Ut(this.e,this.sinphi,this.cosphi),this.ml1=Ke(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<j?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Ut(this.e,this.sinphi,this.cosphi),this.ml2=Ke(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Ke(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function $S(t){var e=t.x,r=t.y,i;if(this.sphere)i=this.a*(this.g-r);else{var s=Ke(this.e0,this.e1,this.e2,this.e3,r);i=this.a*(this.g-s)}var n=this.ns*q(e-this.long0),a=this.x0+i*Math.sin(n),o=this.y0+this.rh-i*Math.cos(n);return t.x=a,t.y=o,t}function jS(t){t.x-=this.x0,t.y=this.rh-t.y+this.y0;var e,r,i,s;this.ns>=0?(r=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(r=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var n=0;if(r!==0&&(n=Math.atan2(e*t.x,e*t.y)),this.sphere)return s=q(this.long0+n/this.ns),i=ai(this.g-r/this.a),t.x=s,t.y=i,t;var a=this.g-r/this.a;return i=Os(a,this.e0,this.e1,this.e2,this.e3),s=q(this.long0+n/this.ns),t.x=s,t.y=i,t}var qS=["Equidistant_Conic","eqdc"];const ZS={init:kS,forward:$S,inverse:jS,names:qS};function WS(){this.R=this.a}function XS(t){var e=t.x,r=t.y,i=q(e-this.long0),s,n;Math.abs(r)<=j&&(s=this.x0+this.R*i,n=this.y0);var a=nr(2*Math.abs(r/Math.PI));(Math.abs(i)<=j||Math.abs(Math.abs(r)-D)<=j)&&(s=this.x0,r>=0?n=this.y0+Math.PI*this.R*Math.tan(.5*a):n=this.y0+Math.PI*this.R*-Math.tan(.5*a));var o=.5*Math.abs(Math.PI/i-i/Math.PI),l=o*o,h=Math.sin(a),c=Math.cos(a),u=c/(h+c-1),d=u*u,p=u*(2/h-1),g=p*p,_=Math.PI*this.R*(o*(u-g)+Math.sqrt(l*(u-g)*(u-g)-(g+l)*(d-g)))/(g+l);i<0&&(_=-_),s=this.x0+_;var y=l+u;return _=Math.PI*this.R*(p*y-o*Math.sqrt((g+l)*(l+1)-y*y))/(g+l),r>=0?n=this.y0+_:n=this.y0-_,t.x=s,t.y=n,t}function HS(t){var e,r,i,s,n,a,o,l,h,c,u,d,p;return t.x-=this.x0,t.y-=this.y0,u=Math.PI*this.R,i=t.x/u,s=t.y/u,n=i*i+s*s,a=-Math.abs(s)*(1+n),o=a-2*s*s+i*i,l=-2*a+1+2*s*s+n*n,p=s*s/l+(2*o*o*o/l/l/l-9*a*o/l/l)/27,h=(a-o*o/3/l)/l,c=2*Math.sqrt(-h/3),u=3*p/h/c,Math.abs(u)>1&&(u>=0?u=1:u=-1),d=Math.acos(u)/3,t.y>=0?r=(-c*Math.cos(d+Math.PI/3)-o/3/l)*Math.PI:r=-(-c*Math.cos(d+Math.PI/3)-o/3/l)*Math.PI,Math.abs(i)<j?e=this.long0:e=q(this.long0+Math.PI*(n-1+Math.sqrt(1+2*(i*i-s*s)+n*n))/2/i),t.x=e,t.y=r,t}var VS=["Van_der_Grinten_I","VanDerGrinten","vandg"];const YS={init:WS,forward:XS,inverse:HS,names:VS};function KS(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function QS(t){var e=t.x,r=t.y,i=Math.sin(t.y),s=Math.cos(t.y),n=q(e-this.long0),a,o,l,h,c,u,d,p,g,_,y,v,E,T,w,b,A,I,C,G,U,X,V;return this.sphere?Math.abs(this.sin_p12-1)<=j?(t.x=this.x0+this.a*(D-r)*Math.sin(n),t.y=this.y0-this.a*(D-r)*Math.cos(n),t):Math.abs(this.sin_p12+1)<=j?(t.x=this.x0+this.a*(D+r)*Math.sin(n),t.y=this.y0+this.a*(D+r)*Math.cos(n),t):(I=this.sin_p12*i+this.cos_p12*s*Math.cos(n),b=Math.acos(I),A=b?b/Math.sin(b):1,t.x=this.x0+this.a*A*s*Math.sin(n),t.y=this.y0+this.a*A*(this.cos_p12*i-this.sin_p12*s*Math.cos(n)),t):(a=Zi(this.es),o=Wi(this.es),l=Xi(this.es),h=Hi(this.es),Math.abs(this.sin_p12-1)<=j?(c=this.a*Ke(a,o,l,h,D),u=this.a*Ke(a,o,l,h,r),t.x=this.x0+(c-u)*Math.sin(n),t.y=this.y0-(c-u)*Math.cos(n),t):Math.abs(this.sin_p12+1)<=j?(c=this.a*Ke(a,o,l,h,D),u=this.a*Ke(a,o,l,h,r),t.x=this.x0+(c+u)*Math.sin(n),t.y=this.y0+(c+u)*Math.cos(n),t):(d=i/s,p=Vr(this.a,this.e,this.sin_p12),g=Vr(this.a,this.e,i),_=Math.atan((1-this.es)*d+this.es*p*this.sin_p12/(g*s)),y=Math.atan2(Math.sin(n),this.cos_p12*Math.tan(_)-this.sin_p12*Math.cos(n)),y===0?C=Math.asin(this.cos_p12*Math.sin(_)-this.sin_p12*Math.cos(_)):Math.abs(Math.abs(y)-Math.PI)<=j?C=-Math.asin(this.cos_p12*Math.sin(_)-this.sin_p12*Math.cos(_)):C=Math.asin(Math.sin(n)*Math.cos(_)/Math.sin(y)),v=this.e*this.sin_p12/Math.sqrt(1-this.es),E=this.e*this.cos_p12*Math.cos(y)/Math.sqrt(1-this.es),T=v*E,w=E*E,G=C*C,U=G*C,X=U*C,V=X*C,b=p*C*(1-G*w*(1-w)/6+U/8*T*(1-2*w)+X/120*(w*(4-7*w)-3*v*v*(1-7*w))-V/48*T),t.x=this.x0+b*Math.sin(y),t.y=this.y0+b*Math.cos(y),t))}function JS(t){t.x-=this.x0,t.y-=this.y0;var e,r,i,s,n,a,o,l,h,c,u,d,p,g,_,y,v,E,T,w,b,A,I,C;return this.sphere?(e=Math.sqrt(t.x*t.x+t.y*t.y),e>2*D*this.a?void 0:(r=e/this.a,i=Math.sin(r),s=Math.cos(r),n=this.long0,Math.abs(e)<=j?a=this.lat0:(a=nr(s*this.sin_p12+t.y*i*this.cos_p12/e),o=Math.abs(this.lat0)-D,Math.abs(o)<=j?this.lat0>=0?n=q(this.long0+Math.atan2(t.x,-t.y)):n=q(this.long0-Math.atan2(-t.x,t.y)):n=q(this.long0+Math.atan2(t.x*i,e*this.cos_p12*s-t.y*this.sin_p12*i))),t.x=n,t.y=a,t)):(l=Zi(this.es),h=Wi(this.es),c=Xi(this.es),u=Hi(this.es),Math.abs(this.sin_p12-1)<=j?(d=this.a*Ke(l,h,c,u,D),e=Math.sqrt(t.x*t.x+t.y*t.y),p=d-e,a=Os(p/this.a,l,h,c,u),n=q(this.long0+Math.atan2(t.x,-1*t.y)),t.x=n,t.y=a,t):Math.abs(this.sin_p12+1)<=j?(d=this.a*Ke(l,h,c,u,D),e=Math.sqrt(t.x*t.x+t.y*t.y),p=e-d,a=Os(p/this.a,l,h,c,u),n=q(this.long0+Math.atan2(t.x,t.y)),t.x=n,t.y=a,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),y=Math.atan2(t.x,t.y),g=Vr(this.a,this.e,this.sin_p12),v=Math.cos(y),E=this.e*this.cos_p12*v,T=-E*E/(1-this.es),w=3*this.es*(1-T)*this.sin_p12*this.cos_p12*v/(1-this.es),b=e/g,A=b-T*(1+T)*Math.pow(b,3)/6-w*(1+3*T)*Math.pow(b,4)/24,I=1-T*A*A/2-b*A*A*A/6,_=Math.asin(this.sin_p12*Math.cos(A)+this.cos_p12*Math.sin(A)*v),n=q(this.long0+Math.asin(Math.sin(y)*Math.sin(A)/Math.cos(_))),C=Math.sin(_),a=Math.atan2((C-this.es*I*this.sin_p12)*Math.tan(_),C*(1-this.es)),t.x=n,t.y=a,t))}var eM=["Azimuthal_Equidistant","aeqd"];const tM={init:KS,forward:QS,inverse:JS,names:eM};function rM(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function iM(t){var e,r,i,s,n,a,o,l,h=t.x,c=t.y;return i=q(h-this.long0),e=Math.sin(c),r=Math.cos(c),s=Math.cos(i),a=this.sin_p14*e+this.cos_p14*r*s,n=1,(a>0||Math.abs(a)<=j)&&(o=this.a*n*r*Math.sin(i),l=this.y0+this.a*n*(this.cos_p14*e-this.sin_p14*r*s)),t.x=o,t.y=l,t}function sM(t){var e,r,i,s,n,a,o;return t.x-=this.x0,t.y-=this.y0,e=Math.sqrt(t.x*t.x+t.y*t.y),r=nr(e/this.a),i=Math.sin(r),s=Math.cos(r),a=this.long0,Math.abs(e)<=j?(o=this.lat0,t.x=a,t.y=o,t):(o=nr(s*this.sin_p14+t.y*i*this.cos_p14/e),n=Math.abs(this.lat0)-D,Math.abs(n)<=j?(this.lat0>=0?a=q(this.long0+Math.atan2(t.x,-t.y)):a=q(this.long0-Math.atan2(-t.x,t.y)),t.x=a,t.y=o,t):(a=q(this.long0+Math.atan2(t.x*i,e*this.cos_p14*s-t.y*this.sin_p14*i)),t.x=a,t.y=o,t))}var nM=["ortho"];const aM={init:rM,forward:iM,inverse:sM,names:nM};var Ae={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},Te={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function oM(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=D-we/2?this.face=Ae.TOP:this.lat0<=-(D-we/2)?this.face=Ae.BOTTOM:Math.abs(this.long0)<=we?this.face=Ae.FRONT:Math.abs(this.long0)<=D+we?this.face=this.long0>0?Ae.RIGHT:Ae.LEFT:this.face=Ae.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function lM(t){var e={x:0,y:0},r,i,s,n,a,o,l={value:0};if(t.x-=this.long0,this.es!==0?r=Math.atan(this.one_minus_f_squared*Math.tan(t.y)):r=t.y,i=t.x,this.face===Ae.TOP)n=D-r,i>=we&&i<=D+we?(l.value=Te.AREA_0,s=i-D):i>D+we||i<=-(D+we)?(l.value=Te.AREA_1,s=i>0?i-Oe:i+Oe):i>-(D+we)&&i<=-we?(l.value=Te.AREA_2,s=i+D):(l.value=Te.AREA_3,s=i);else if(this.face===Ae.BOTTOM)n=D+r,i>=we&&i<=D+we?(l.value=Te.AREA_0,s=-i+D):i<we&&i>=-we?(l.value=Te.AREA_1,s=-i):i<-we&&i>=-(D+we)?(l.value=Te.AREA_2,s=-i-D):(l.value=Te.AREA_3,s=i>0?-i+Oe:-i-Oe);else{var h,c,u,d,p,g,_;this.face===Ae.RIGHT?i=jr(i,+D):this.face===Ae.BACK?i=jr(i,+Oe):this.face===Ae.LEFT&&(i=jr(i,-D)),d=Math.sin(r),p=Math.cos(r),g=Math.sin(i),_=Math.cos(i),h=p*_,c=p*g,u=d,this.face===Ae.FRONT?(n=Math.acos(h),s=ss(n,u,c,l)):this.face===Ae.RIGHT?(n=Math.acos(c),s=ss(n,u,-h,l)):this.face===Ae.BACK?(n=Math.acos(-h),s=ss(n,u,-c,l)):this.face===Ae.LEFT?(n=Math.acos(-c),s=ss(n,u,h,l)):(n=s=0,l.value=Te.AREA_0)}return o=Math.atan(12/Oe*(s+Math.acos(Math.sin(s)*Math.cos(we))-D)),a=Math.sqrt((1-Math.cos(n))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(s))))),l.value===Te.AREA_1?o+=D:l.value===Te.AREA_2?o+=Oe:l.value===Te.AREA_3&&(o+=1.5*Oe),e.x=a*Math.cos(o),e.y=a*Math.sin(o),e.x=e.x*this.a+this.x0,e.y=e.y*this.a+this.y0,t.x=e.x,t.y=e.y,t}function hM(t){var e={lam:0,phi:0},r,i,s,n,a,o,l,h,c,u={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,i=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),r=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?u.value=Te.AREA_0:t.y>=0&&t.y>=Math.abs(t.x)?(u.value=Te.AREA_1,r-=D):t.x<0&&-t.x>=Math.abs(t.y)?(u.value=Te.AREA_2,r=r<0?r+Oe:r-Oe):(u.value=Te.AREA_3,r+=D),c=Oe/12*Math.tan(r),a=Math.sin(c)/(Math.cos(c)-1/Math.sqrt(2)),o=Math.atan(a),s=Math.cos(r),n=Math.tan(i),l=1-s*s*n*n*(1-Math.cos(Math.atan(1/Math.cos(o)))),l<-1?l=-1:l>1&&(l=1),this.face===Ae.TOP)h=Math.acos(l),e.phi=D-h,u.value===Te.AREA_0?e.lam=o+D:u.value===Te.AREA_1?e.lam=o<0?o+Oe:o-Oe:u.value===Te.AREA_2?e.lam=o-D:e.lam=o;else if(this.face===Ae.BOTTOM)h=Math.acos(l),e.phi=h-D,u.value===Te.AREA_0?e.lam=-o+D:u.value===Te.AREA_1?e.lam=-o:u.value===Te.AREA_2?e.lam=-o-D:e.lam=o<0?-o-Oe:-o+Oe;else{var d,p,g;d=l,c=d*d,c>=1?g=0:g=Math.sqrt(1-c)*Math.sin(o),c+=g*g,c>=1?p=0:p=Math.sqrt(1-c),u.value===Te.AREA_1?(c=p,p=-g,g=c):u.value===Te.AREA_2?(p=-p,g=-g):u.value===Te.AREA_3&&(c=p,p=g,g=-c),this.face===Ae.RIGHT?(c=d,d=-p,p=c):this.face===Ae.BACK?(d=-d,p=-p):this.face===Ae.LEFT&&(c=d,d=p,p=-c),e.phi=Math.acos(-g)-D,e.lam=Math.atan2(p,d),this.face===Ae.RIGHT?e.lam=jr(e.lam,-D):this.face===Ae.BACK?e.lam=jr(e.lam,-Oe):this.face===Ae.LEFT&&(e.lam=jr(e.lam,+D))}if(this.es!==0){var _,y,v;_=e.phi<0?1:0,y=Math.tan(e.phi),v=this.b/Math.sqrt(y*y+this.one_minus_f_squared),e.phi=Math.atan(Math.sqrt(this.a*this.a-v*v)/(this.one_minus_f*v)),_&&(e.phi=-e.phi)}return e.lam+=this.long0,t.x=e.lam,t.y=e.phi,t}function ss(t,e,r,i){var s;return t<j?(i.value=Te.AREA_0,s=0):(s=Math.atan2(e,r),Math.abs(s)<=we?i.value=Te.AREA_0:s>we&&s<=D+we?(i.value=Te.AREA_1,s-=D):s>D+we||s<=-(D+we)?(i.value=Te.AREA_2,s=s>=0?s-Oe:s+Oe):(i.value=Te.AREA_3,s+=D)),s}function jr(t,e){var r=t+e;return r<-Oe?r+=Ni:r>+Oe&&(r-=Ni),r}var uM=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const cM={init:oM,forward:lM,inverse:hM,names:uM};var ia=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],xi=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Hc=.8487,Vc=1.3523,Yc=Lt/5,fM=1/Yc,Br=18,Ns=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))},dM=function(t,e){return t[1]+e*(2*t[2]+e*3*t[3])};function gM(t,e,r,i){for(var s=e;i;--i){var n=t(s);if(s-=n,Math.abs(n)<r)break}return s}function pM(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function mM(t){var e=q(t.x-this.long0),r=Math.abs(t.y),i=Math.floor(r*Yc);i<0?i=0:i>=Br&&(i=Br-1),r=Lt*(r-fM*i);var s={x:Ns(ia[i],r)*e,y:Ns(xi[i],r)};return t.y<0&&(s.y=-s.y),s.x=s.x*this.a*Hc+this.x0,s.y=s.y*this.a*Vc+this.y0,s}function _M(t){var e={x:(t.x-this.x0)/(this.a*Hc),y:Math.abs(t.y-this.y0)/(this.a*Vc)};if(e.y>=1)e.x/=ia[Br][0],e.y=t.y<0?-D:D;else{var r=Math.floor(e.y*Br);for(r<0?r=0:r>=Br&&(r=Br-1);;)if(xi[r][0]>e.y)--r;else if(xi[r+1][0]<=e.y)++r;else break;var i=xi[r],s=5*(e.y-i[0])/(xi[r+1][0]-i[0]);s=gM(function(n){return(Ns(i,n)-e.y)/dM(i,n)},s,j,100),e.x/=Ns(ia[r],s),e.y=(5*r+s)*je,t.y<0&&(e.y=-e.y)}return e.x=q(e.x+this.long0),e}var yM=["Robinson","robin"];const xM={init:pM,forward:mM,inverse:_M,names:yM};function vM(){this.name="geocent"}function EM(t){var e=Fc(t,this.es,this.a);return e}function wM(t){var e=Dc(t,this.es,this.a,this.b);return e}var TM=["Geocentric","geocentric","geocent","Geocent"];const SM={init:vM,forward:EM,inverse:wM,names:TM};var We={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},ui={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function MM(){if(Object.keys(ui).forEach((function(r){if(typeof this[r]>"u")this[r]=ui[r].def;else{if(ui[r].num&&isNaN(this[r]))throw new Error("Invalid parameter value, must be numeric "+r+" = "+this[r]);ui[r].num&&(this[r]=parseFloat(this[r]))}ui[r].degrees&&(this[r]=this[r]*je)}).bind(this)),Math.abs(Math.abs(this.lat0)-D)<j?this.mode=this.lat0<0?We.S_POLE:We.N_POLE:Math.abs(this.lat0)<j?this.mode=We.EQUIT:(this.mode=We.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(t),this.sw=Math.sin(t)}function bM(t){t.x-=this.long0;var e=Math.sin(t.y),r=Math.cos(t.y),i=Math.cos(t.x),s,n;switch(this.mode){case We.OBLIQ:n=this.sinph0*e+this.cosph0*r*i;break;case We.EQUIT:n=r*i;break;case We.S_POLE:n=-e;break;case We.N_POLE:n=e;break}switch(n=this.pn1/(this.p-n),s=n*r*Math.sin(t.x),this.mode){case We.OBLIQ:n*=this.cosph0*e-this.sinph0*r*i;break;case We.EQUIT:n*=e;break;case We.N_POLE:n*=-(r*i);break;case We.S_POLE:n*=r*i;break}var a,o;return a=n*this.cg+s*this.sg,o=1/(a*this.sw*this.h1+this.cw),s=(s*this.cg-n*this.sg)*this.cw*o,n=a*o,t.x=s*this.a,t.y=n*this.a,t}function RM(t){t.x/=this.a,t.y/=this.a;var e={x:t.x,y:t.y},r,i,s;s=1/(this.pn1-t.y*this.sw),r=this.pn1*t.x*s,i=this.pn1*t.y*this.cw*s,t.x=r*this.cg+i*this.sg,t.y=i*this.cg-r*this.sg;var n=pt(t.x,t.y);if(Math.abs(n)<j)e.x=0,e.y=t.y;else{var a,o;switch(o=1-n*n*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/n+n/this.pn1),a=Math.sqrt(1-o*o),this.mode){case We.OBLIQ:e.y=Math.asin(a*this.sinph0+t.y*o*this.cosph0/n),t.y=(a-this.sinph0*Math.sin(e.y))*n,t.x*=o*this.cosph0;break;case We.EQUIT:e.y=Math.asin(t.y*o/n),t.y=a*n,t.x*=o;break;case We.N_POLE:e.y=Math.asin(a),t.y=-t.y;break;case We.S_POLE:e.y=-Math.asin(a);break}e.x=Math.atan2(t.x,t.y)}return t.x=e.x+this.long0,t.y=e.y,t}var PM=["Tilted_Perspective","tpers"];const AM={init:MM,forward:bM,inverse:RM,names:PM};function IM(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var t=1-this.es,e=1/t;this.radius_p=Math.sqrt(t),this.radius_p2=t,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function LM(t){var e=t.x,r=t.y,i,s,n,a;if(e=e-this.long0,this.shape==="ellipse"){r=Math.atan(this.radius_p2*Math.tan(r));var o=this.radius_p/pt(this.radius_p*Math.cos(r),Math.sin(r));if(s=o*Math.cos(e)*Math.cos(r),n=o*Math.sin(e)*Math.cos(r),a=o*Math.sin(r),(this.radius_g-s)*s-n*n-a*a*this.radius_p_inv2<0)return t.x=Number.NaN,t.y=Number.NaN,t;i=this.radius_g-s,this.flip_axis?(t.x=this.radius_g_1*Math.atan(n/pt(a,i)),t.y=this.radius_g_1*Math.atan(a/i)):(t.x=this.radius_g_1*Math.atan(n/i),t.y=this.radius_g_1*Math.atan(a/pt(n,i)))}else this.shape==="sphere"&&(i=Math.cos(r),s=Math.cos(e)*i,n=Math.sin(e)*i,a=Math.sin(r),i=this.radius_g-s,this.flip_axis?(t.x=this.radius_g_1*Math.atan(n/pt(a,i)),t.y=this.radius_g_1*Math.atan(a/i)):(t.x=this.radius_g_1*Math.atan(n/i),t.y=this.radius_g_1*Math.atan(a/pt(n,i))));return t.x=t.x*this.a,t.y=t.y*this.a,t}function CM(t){var e=-1,r=0,i=0,s,n,a,o;if(t.x=t.x/this.a,t.y=t.y/this.a,this.shape==="ellipse"){this.flip_axis?(i=Math.tan(t.y/this.radius_g_1),r=Math.tan(t.x/this.radius_g_1)*pt(1,i)):(r=Math.tan(t.x/this.radius_g_1),i=Math.tan(t.y/this.radius_g_1)*pt(1,r));var l=i/this.radius_p;if(s=r*r+l*l+e*e,n=2*this.radius_g*e,a=n*n-4*s*this.C,a<0)return t.x=Number.NaN,t.y=Number.NaN,t;o=(-n-Math.sqrt(a))/(2*s),e=this.radius_g+o*e,r*=o,i*=o,t.x=Math.atan2(r,e),t.y=Math.atan(i*Math.cos(t.x)/e),t.y=Math.atan(this.radius_p_inv2*Math.tan(t.y))}else if(this.shape==="sphere"){if(this.flip_axis?(i=Math.tan(t.y/this.radius_g_1),r=Math.tan(t.x/this.radius_g_1)*Math.sqrt(1+i*i)):(r=Math.tan(t.x/this.radius_g_1),i=Math.tan(t.y/this.radius_g_1)*Math.sqrt(1+r*r)),s=r*r+i*i+e*e,n=2*this.radius_g*e,a=n*n-4*s*this.C,a<0)return t.x=Number.NaN,t.y=Number.NaN,t;o=(-n-Math.sqrt(a))/(2*s),e=this.radius_g+o*e,r*=o,i*=o,t.x=Math.atan2(r,e),t.y=Math.atan(i*Math.cos(t.x)/e)}return t.x=t.x+this.long0,t}var OM=["Geostationary Satellite View","Geostationary_Satellite","geos"];const NM={init:IM,forward:LM,inverse:CM,names:OM};function FM(t){t.Proj.projections.add(hs),t.Proj.projections.add(us),t.Proj.projections.add(kw),t.Proj.projections.add(Kw),t.Proj.projections.add(iT),t.Proj.projections.add(lT),t.Proj.projections.add(gT),t.Proj.projections.add(xT),t.Proj.projections.add(ST),t.Proj.projections.add(AT),t.Proj.projections.add(WT),t.Proj.projections.add(QT),t.Proj.projections.add(iS),t.Proj.projections.add(hS),t.Proj.projections.add(gS),t.Proj.projections.add(xS),t.Proj.projections.add(SS),t.Proj.projections.add(AS),t.Proj.projections.add(FS),t.Proj.projections.add(zS),t.Proj.projections.add(ZS),t.Proj.projections.add(YS),t.Proj.projections.add(tM),t.Proj.projections.add(aM),t.Proj.projections.add(cM),t.Proj.projections.add(xM),t.Proj.projections.add(SM),t.Proj.projections.add(AM),t.Proj.projections.add(NM)}ft.defaultDatum="WGS84";ft.Proj=Ft;ft.WGS84=new ft.Proj("WGS84");ft.Point=Hr;ft.toPoint=Gc;ft.defs=Ve;ft.nadgrid=jE;ft.transform=Cs;ft.mgrs=nw;ft.version="__VERSION__";FM(ft);Rc(ft);window.eoxMapAdvancedOlLayers={...X_,STAC:xo};window.eoxMapAdvancedOlSources=k1;export{QM as L,JM as a};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./raw-FjKAlyiw.js","./basedecoder-ZA-T3ZBw.js","./lzw-NamZKYVt.js","./jpeg-rjh0axXg.js","./deflate-EZWV29Lt.js","./pako.esm-1A7OWKUb.js","./packbits-65YHJGuf.js","./lerc-24Mh-EFR.js","./_commonjsHelpers-4gQjN7DL.js","./main-G_0A_pV2.js","./lit-element-uhisBW42.js","./state-729Pchtv.js","./index-EySAwWXj.js","./iframe-Emvi5NNo.js","./webimage-NiQ987z3.js","./decoder-YCn7QQ1o.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
