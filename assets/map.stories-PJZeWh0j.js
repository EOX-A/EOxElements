function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./raw-FjKAlyiw.js","./basedecoder-ZA-T3ZBw.js","./lzw-NamZKYVt.js","./jpeg-rjh0axXg.js","./deflate-EZWV29Lt.js","./pako.esm-1A7OWKUb.js","./packbits-65YHJGuf.js","./lerc-H1mRrgE4.js","./_commonjsHelpers-4gQjN7DL.js","./lit-element-uhisBW42.js","./main-oCk-xVEg.js","./state-729Pchtv.js","./index-EySAwWXj.js","./iframe-oAdoaxl4.js","./webimage-NiQ987z3.js","./decoder-YCn7QQ1o.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
var oh=Object.defineProperty;var ah=(r,e,t)=>e in r?oh(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var mi=(r,e,t)=>(ah(r,typeof e!="symbol"?e+"":e,t),t);import{x as Mt}from"./lit-element-uhisBW42.js";import{J as lh,F as qe,g as ye,i as ch,t as Oe,d as uh,l as hh,c as Ln,L as Ui,P as nt,a as pt,M as yr,b as qn,e as ln,f as cn,X as Kn,m as W,h as X,p as G,j as as,k as In,n as fh,o as dh,q as At,s as Cn,u as Nl,v as Q,w as P,x as ie,y as xe,z as He,O as _r,A as Pt,B as Kr,C as Dl,D as $,E as On,H as Mn,I as R,K as D,N as Qn,Q as Re,R as De,S as Fn,U as Gl,V as Ut,W as ph,Y as ls,Z as Ul,_ as xt,$ as gt,a0 as Ee,a1 as gh,a2 as mh,a3 as Ct,a4 as xo,a5 as bt,a6 as hr,a7 as cs,a8 as kl,a9 as yh,aa as zl,ab as _h,ac as Bl,ad as xh,ae as Eh,af as Nn,ag as wh,ah as Qr,ai as us,aj as Eo,ak as Xr,al as wo,am as ki,an as zt,ao as Jn,ap as Th,aq as vh,ar as Sh,as as ht,at as Dn,au as hs,av as Lt,aw as Ir,ax as dr,ay as Xe,az as ve,aA as Jr,aB as ar,aC as Rh,aD as Ae,aE as $l,aF as it,aG as fs,aH as bh,aI as Ph,aJ as jl,aK as yi,aL as Ah,aM as ds,aN as Lh,aO as Cr,aP as _n,aQ as Gn,aR as ps,aS as Vl,aT as en,aU as Zl,aV as zi,aW as Wl,aX as Y,aY as Tt,aZ as To,a_ as _i,a$ as Ih,b0 as vo,b1 as je,b2 as Ch,b3 as Oh,b4 as Mh,b5 as Fh,b6 as gs,b7 as ft,b8 as ms,b9 as Jt,ba as Nh,bb as Bi,bc as Hl,bd as Dh,be as So,bf as Gh,bg as Uh,bh as Xl,bi as tn,bj as kh,bk as zh,bl as Bh,bm as $i,bn as $h,bo as he,bp as bn,bq as pr,br as Ye,bs as Qe,bt as jh,bu as ne,bv as Vh,bw as Yl,bx as Bt,by as Zh,bz as Wh,bA as ql,bB as Ot,bC as Hh,bD as Xh,bE as Yh,bF as Kl,bG as qh,G as Ql,bH as ys,bI as Un,bJ as Jl,bK as Ft,bL as un,bM as hn,bN as ec,bO as _s,bP as gr,bQ as Kh,bR as Qh,bS as Jh,bT as ei,bU as ef,bV as tf,bW as rf,bX as kn,bY as nf,bZ as xi,b_ as zn,b$ as ti,c0 as sf,c1 as of,c2 as Ro,c3 as bo,c4 as ji,c5 as af,c6 as lf,c7 as xr,c8 as tc,c9 as Po,ca as rc,cb as Ao,cc as Ht,cd as xs,ce as ri,cf,cg as Es,ch as nc,ci as uf,cj as hf,ck as ff,cl as df,cm as ic,cn as pf,co as gf,cp as mf,cq as yf,cr as sc,cs as _f,ct as oc,cu as xf,cv as Ef,cw as wf,cx as Tf,cy as vf,cz as Sf,cA as Rf}from"./main-oCk-xVEg.js";import{g as ni,c as $t}from"./_commonjsHelpers-4gQjN7DL.js";import{_ as Nt}from"./iframe-oAdoaxl4.js";const bf={Point:If,LineString:Cf,Polygon:Nf,MultiPoint:Mf,MultiLineString:Of,MultiPolygon:Ff},Pf={Point:Df,LineString:Gf,Polygon:Uf,MultiPoint:zf,MultiLineString:kf,MultiPolygon:Bf};class Af extends lh{constructor(e){e=e||{},super(),this.geometryName_=e.geometryName}readFeatureFromObject(e,t,n){const i=e,s=Lo(i.geometry,t),o=new qe;if(this.geometryName_&&o.setGeometryName(this.geometryName_),o.setGeometry(s),i.attributes){o.setProperties(i.attributes,!0);const a=i.attributes[n];a!==void 0&&o.setId(a)}return o}readFeaturesFromObject(e,t){if(t=t||{},e.features){const n=e,i=[],s=n.features;for(let o=0,a=s.length;o<a;++o)i.push(this.readFeatureFromObject(s[o],t,e.objectIdFieldName));return i}return[this.readFeatureFromObject(e,t)]}readGeometryFromObject(e,t){return Lo(e,t)}readProjectionFromObject(e){if(e.spatialReference&&e.spatialReference.wkid!==void 0){const n=e.spatialReference.wkid;return ye("EPSG:"+n)}return null}writeGeometryObject(e,t){return Io(e,this.adaptOptions(t))}writeFeatureObject(e,t){t=this.adaptOptions(t);const n={};if(!e.hasProperties())return n.attributes={},n;const i=e.getProperties(),s=e.getGeometry();if(s){n.geometry=Io(s,t);const o=t&&(t.dataProjection||t.featureProjection);o&&(n.geometry.spatialReference={wkid:Number(ye(o).getCode().split(":").pop())}),delete i[e.getGeometryName()]}return ch(i)?n.attributes={}:n.attributes=i,n}writeFeaturesObject(e,t){t=this.adaptOptions(t);const n=[];for(let i=0,s=e.length;i<s;++i)n.push(this.writeFeatureObject(e[i],t));return{features:n}}}function Lo(r,e){if(!r)return null;let t;if(typeof r.x=="number"&&typeof r.y=="number")t="Point";else if(r.points)t="MultiPoint";else if(r.paths)r.paths.length===1?t="LineString":t="MultiLineString";else if(r.rings){const i=r,s=Er(i),o=Lf(i.rings,s);o.length===1?(t="Polygon",r=Object.assign({},r,{rings:o[0]})):(t="MultiPolygon",r=Object.assign({},r,{rings:o}))}const n=bf[t];return Oe(n(r),!1,e)}function Lf(r,e){const t=[],n=[],i=[];let s,o;for(s=0,o=r.length;s<o;++s)t.length=0,uh(t,0,r[s],e.length),hh(t,0,t.length,e.length)?n.push([r[s]]):i.push(r[s]);for(;i.length;){const a=i.shift();let l=!1;for(s=n.length-1;s>=0;s--){const c=n[s][0];if(Ln(new Ui(c).getExtent(),new Ui(a).getExtent())){n[s].push(a),l=!0;break}}l||n.push([a.reverse()])}return n}function If(r){let e;return r.m!==void 0&&r.z!==void 0?e=new nt([r.x,r.y,r.z,r.m],"XYZM"):r.z!==void 0?e=new nt([r.x,r.y,r.z],"XYZ"):r.m!==void 0?e=new nt([r.x,r.y,r.m],"XYM"):e=new nt([r.x,r.y]),e}function Cf(r){const e=Er(r);return new pt(r.paths[0],e)}function Of(r){const e=Er(r);return new yr(r.paths,e)}function Er(r){let e="XY";return r.hasZ===!0&&r.hasM===!0?e="XYZM":r.hasZ===!0?e="XYZ":r.hasM===!0&&(e="XYM"),e}function Mf(r){const e=Er(r);return new qn(r.points,e)}function Ff(r){const e=Er(r);return new ln(r.rings,e)}function Nf(r){const e=Er(r);return new cn(r.rings,e)}function Df(r,e){const t=r.getCoordinates();let n;const i=r.getLayout();if(i==="XYZ")n={x:t[0],y:t[1],z:t[2]};else if(i==="XYM")n={x:t[0],y:t[1],m:t[2]};else if(i==="XYZM")n={x:t[0],y:t[1],z:t[2],m:t[3]};else if(i==="XY")n={x:t[0],y:t[1]};else throw new Error("Invalid geometry layout");return n}function fn(r){const e=r.getLayout();return{hasZ:e==="XYZ"||e==="XYZM",hasM:e==="XYM"||e==="XYZM"}}function Gf(r,e){const t=fn(r);return{hasZ:t.hasZ,hasM:t.hasM,paths:[r.getCoordinates()]}}function Uf(r,e){const t=fn(r);return{hasZ:t.hasZ,hasM:t.hasM,rings:r.getCoordinates(!1)}}function kf(r,e){const t=fn(r);return{hasZ:t.hasZ,hasM:t.hasM,paths:r.getCoordinates()}}function zf(r,e){const t=fn(r);return{hasZ:t.hasZ,hasM:t.hasM,points:r.getCoordinates()}}function Bf(r,e){const t=fn(r),n=r.getCoordinates(!1),i=[];for(let s=0;s<n.length;s++)for(let o=n[s].length-1;o>=0;o--)i.push(n[s][o]);return{hasZ:t.hasZ,hasM:t.hasM,rings:i}}function Io(r,e){const t=Pf[r.getType()];return t(Oe(r,!0,e),e)}const $f=Af,wt="http://www.opengis.net/gml",jf=/^\s*$/;class be extends Kn{constructor(e){super(),e=e||{},this.featureType=e.featureType,this.featureNS=e.featureNS,this.srsName=e.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:W(this.readFeaturesInternal),featureMembers:X(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(e,t){const n=e.localName;let i=null;if(n=="FeatureCollection")i=G([],this.FEATURE_COLLECTION_PARSERS,e,t,this);else if(n=="featureMembers"||n=="featureMember"||n=="member"){const s=t[0];let o=s.featureType,a=s.featureNS;const l="p",c="p0";if(!o&&e.childNodes){o=[],a={};for(let d=0,g=e.childNodes.length;d<g;++d){const m=e.childNodes[d];if(m.nodeType===1){const _=m.nodeName.split(":").pop();if(!o.includes(_)){let x="",w=0;const E=m.namespaceURI;for(const v in a){if(a[v]===E){x=v;break}++w}x||(x=l+w,a[x]=E),o.push(x+":"+_)}}}n!="featureMember"&&(s.featureType=o,s.featureNS=a)}if(typeof a=="string"){const d=a;a={},a[c]=d}const h={},f=Array.isArray(o)?o:[o];for(const d in a){const g={};for(let m=0,_=f.length;m<_;++m)(f[m].includes(":")?f[m].split(":")[0]:c)===d&&(g[f[m].split(":").pop()]=n=="featureMembers"?W(this.readFeatureElement,this):X(this.readFeatureElement,this));h[a[d]]=g}n=="featureMember"||n=="member"?i=G(void 0,h,e,t):i=G([],h,e,t)}return i===null&&(i=[]),i}readGeometryOrExtent(e,t){const n=t[0];return n.srsName=e.firstElementChild.getAttribute("srsName"),n.srsDimension=e.firstElementChild.getAttribute("srsDimension"),G(null,this.GEOMETRY_PARSERS,e,t,this)}readExtentElement(e,t){const n=t[0],i=this.readGeometryOrExtent(e,t);return i?as(i,n):void 0}readGeometryElement(e,t){const n=t[0],i=this.readGeometryOrExtent(e,t);return i?Oe(i,!1,n):void 0}readFeatureElementInternal(e,t,n){let i;const s={};for(let l=e.firstElementChild;l;l=l.nextElementSibling){let c;const h=l.localName;l.childNodes.length===0||l.childNodes.length===1&&(l.firstChild.nodeType===3||l.firstChild.nodeType===4)?(c=In(l,!1),jf.test(c)&&(c=void 0)):(n&&(c=h==="boundedBy"?this.readExtentElement(l,t):this.readGeometryElement(l,t)),c?h!=="boundedBy"&&(i=h):c=this.readFeatureElementInternal(l,t,!1));const f=l.attributes.length;if(f>0&&!(c instanceof fh)){c={_content_:c};for(let d=0;d<f;d++){const g=l.attributes[d].name;c[g]=l.attributes[d].value}}s[h]?(s[h]instanceof Array||(s[h]=[s[h]]),s[h].push(c)):s[h]=c}if(!n)return s;const o=new qe(s);i&&o.setGeometryName(i);const a=e.getAttribute("fid")||dh(e,this.namespace,"id");return a&&o.setId(a),o}readFeatureElement(e,t){return this.readFeatureElementInternal(e,t,!0)}readPoint(e,t){const n=this.readFlatCoordinatesFromNode(e,t);if(n)return new nt(n,"XYZ")}readMultiPoint(e,t){const n=G([],this.MULTIPOINT_PARSERS,e,t,this);if(n)return new qn(n)}readMultiLineString(e,t){const n=G([],this.MULTILINESTRING_PARSERS,e,t,this);if(n)return new yr(n)}readMultiPolygon(e,t){const n=G([],this.MULTIPOLYGON_PARSERS,e,t,this);if(n)return new ln(n)}pointMemberParser(e,t){At(this.POINTMEMBER_PARSERS,e,t,this)}lineStringMemberParser(e,t){At(this.LINESTRINGMEMBER_PARSERS,e,t,this)}polygonMemberParser(e,t){At(this.POLYGONMEMBER_PARSERS,e,t,this)}readLineString(e,t){const n=this.readFlatCoordinatesFromNode(e,t);if(n)return new pt(n,"XYZ")}readFlatLinearRing(e,t){const n=G(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this);if(n)return n}readLinearRing(e,t){const n=this.readFlatCoordinatesFromNode(e,t);if(n)return new Ui(n,"XYZ")}readPolygon(e,t){const n=G([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this);if(n&&n[0]){const i=n[0],s=[i.length];let o,a;for(o=1,a=n.length;o<a;++o)Cn(i,n[o]),s.push(i.length);return new cn(i,"XYZ",s)}}readFlatCoordinatesFromNode(e,t){return G(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}readGeometryFromNode(e,t){const n=this.readGeometryElement(e,[this.getReadOptions(e,t||{})]);return n||null}readFeaturesFromNode(e,t){const n={featureType:this.featureType,featureNS:this.featureNS};return n&&Object.assign(n,this.getReadOptions(e,t)),this.readFeaturesInternal(e,[n])||[]}readProjectionFromNode(e){return ye(this.srsName?this.srsName:e.firstElementChild.getAttribute("srsName"))}}be.prototype.namespace=wt;be.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};be.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};be.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};be.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:W(be.prototype.pointMemberParser),pointMembers:W(be.prototype.pointMemberParser)}};be.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:W(be.prototype.lineStringMemberParser),lineStringMembers:W(be.prototype.lineStringMemberParser)}};be.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:W(be.prototype.polygonMemberParser),polygonMembers:W(be.prototype.polygonMemberParser)}};be.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:W(be.prototype.readFlatCoordinatesFromNode)}};be.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:W(be.prototype.readLineString)}};be.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:W(be.prototype.readPolygon)}};be.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:X(be.prototype.readFlatLinearRing)}};const re=be,Vf=wt+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",Zf={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class le extends re{constructor(e){e=e||{},super(e),this.FEATURE_COLLECTION_PARSERS[wt].featureMember=W(this.readFeaturesInternal),this.schemaLocation=e.schemaLocation?e.schemaLocation:Vf}readFlatCoordinates(e,t){const n=In(e,!1).replace(/^\s*|\s*$/g,""),s=t[0].srsName;let o="enu";if(s){const c=ye(s);c&&(o=c.getAxisOrientation())}const a=n.trim().split(/\s+/),l=[];for(let c=0,h=a.length;c<h;c++){const f=a[c].split(/,+/),d=parseFloat(f[0]),g=parseFloat(f[1]),m=f.length===3?parseFloat(f[2]):0;o.substr(0,2)==="en"?l.push(d,g,m):l.push(g,d,m)}return l}readBox(e,t){const n=G([null],this.BOX_PARSERS_,e,t,this);return Nl(n[1][0],n[1][1],n[1][3],n[1][4])}innerBoundaryIsParser(e,t){const n=G(void 0,this.RING_PARSERS,e,t,this);n&&t[t.length-1].push(n)}outerBoundaryIsParser(e,t){const n=G(void 0,this.RING_PARSERS,e,t,this);if(n){const i=t[t.length-1];i[0]=n}}GEOMETRY_NODE_FACTORY_(e,t,n){const i=t[t.length-1],s=i.multiSurface,o=i.surface,a=i.multiCurve;return Array.isArray(e)?n="Envelope":(n=e.getType(),n==="MultiPolygon"&&s===!0?n="MultiSurface":n==="Polygon"&&o===!0?n="Surface":n==="MultiLineString"&&a===!0&&(n="MultiCurve")),Q("http://www.opengis.net/gml",n)}writeFeatureElement(e,t,n){const i=t.getId();i&&e.setAttribute("fid",i);const s=n[n.length-1],o=s.featureNS,a=t.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],c=[];if(t.hasProperties()){const f=t.getProperties();for(const d in f){const g=f[d];g!==null&&(l.push(d),c.push(g),d==a||typeof g.getSimplifiedGeometry=="function"?d in s.serializers[o]||(s.serializers[o][d]=P(this.writeGeometryElement,this)):d in s.serializers[o]||(s.serializers[o][d]=P(ie)))}}const h=Object.assign({},s);h.node=e,xe(h,s.serializers,He(void 0,o),c,n,l)}writeCurveOrLineString(e,t,n){const s=n[n.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,n)}else if(e.nodeName==="Curve"){const o=Q(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,n)}}writeLineStringOrCurveMember(e,t,n){const i=this.GEOMETRY_NODE_FACTORY_(t,n);i&&(e.appendChild(i),this.writeCurveOrLineString(i,t,n))}writeMultiCurveOrLineString(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.curve;o&&e.setAttribute("srsName",o);const l=t.getLineStrings();xe({node:e,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeGeometryElement(e,t,n){const i=n[n.length-1],s=Object.assign({},i);s.node=e;let o;Array.isArray(t)?o=as(t,i):o=Oe(t,!0,i),xe(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],n,void 0,this)}createCoordinatesNode_(e){const t=Q(e,"coordinates");return t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," "),t}writeCoordinates_(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=t.getCoordinates(),l=a.length,c=new Array(l);for(let h=0;h<l;++h){const f=a[h];c[h]=this.getCoords_(f,o,s)}ie(e,c.join(" "))}writeCurveSegments_(e,t,n){const i=Q(e.namespaceURI,"LineStringSegment");e.appendChild(i),this.writeCurveOrLineString(i,t,n)}writeSurfaceOrPolygon(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();xe({node:e,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,n,void 0,this)}else if(e.nodeName==="Surface"){const a=Q(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,n)}}RING_NODE_FACTORY_(e,t,n){const i=t[t.length-1],s=i.node,o=i.exteriorWritten;return o===void 0&&(i.exteriorWritten=!0),Q(s.namespaceURI,o!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(e,t,n){const i=Q(e.namespaceURI,"PolygonPatch");e.appendChild(i),this.writeSurfaceOrPolygon(i,t,n)}writeRing(e,t,n){const i=Q(e.namespaceURI,"LinearRing");e.appendChild(i),this.writeLinearRing(i,t,n)}getCoords_(e,t,n){let i="enu";t&&(i=ye(t).getAxisOrientation());let s=i.substr(0,2)==="en"?e[0]+","+e[1]:e[1]+","+e[0];if(n){const o=e[2]||0;s+=","+o}return s}writePoint(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;o&&e.setAttribute("srsName",o);const a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a);const l=t.getCoordinates(),c=this.getCoords_(l,o,s);ie(a,c)}writeMultiPoint(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;o&&e.setAttribute("srsName",o);const a=t.getPoints();xe({node:e,hasZ:s,srsName:o},this.POINTMEMBER_SERIALIZERS,He("pointMember"),a,n,void 0,this)}writePointMember(e,t,n){const i=Q(e.namespaceURI,"Point");e.appendChild(i),this.writePoint(i,t,n)}writeLinearRing(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,n)}writeMultiSurfaceOrPolygon(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.surface;o&&e.setAttribute("srsName",o);const l=t.getPolygons();xe({node:e,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeSurfaceOrPolygonMember(e,t,n){const i=this.GEOMETRY_NODE_FACTORY_(t,n);i&&(e.appendChild(i),this.writeSurfaceOrPolygon(i,t,n))}writeEnvelope(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];xe({node:e},this.ENVELOPE_SERIALIZERS,_r,a,n,o,this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,n){const i=t[t.length-1].node;return Q("http://www.opengis.net/gml",Zf[i.nodeName])}}le.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:X(le.prototype.readFlatCoordinates)}};le.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:le.prototype.innerBoundaryIsParser,outerBoundaryIs:le.prototype.outerBoundaryIsParser}};le.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:W(le.prototype.readFlatCoordinates)}};le.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:X(re.prototype.readPoint),MultiPoint:X(re.prototype.readMultiPoint),LineString:X(re.prototype.readLineString),MultiLineString:X(re.prototype.readMultiLineString),LinearRing:X(re.prototype.readLinearRing),Polygon:X(re.prototype.readPolygon),MultiPolygon:X(re.prototype.readMultiPolygon),Box:X(le.prototype.readBox)}};le.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:P(le.prototype.writeCurveOrLineString),MultiCurve:P(le.prototype.writeMultiCurveOrLineString),Point:P(le.prototype.writePoint),MultiPoint:P(le.prototype.writeMultiPoint),LineString:P(le.prototype.writeCurveOrLineString),MultiLineString:P(le.prototype.writeMultiCurveOrLineString),LinearRing:P(le.prototype.writeLinearRing),Polygon:P(le.prototype.writeSurfaceOrPolygon),MultiPolygon:P(le.prototype.writeMultiSurfaceOrPolygon),Surface:P(le.prototype.writeSurfaceOrPolygon),MultiSurface:P(le.prototype.writeMultiSurfaceOrPolygon),Envelope:P(le.prototype.writeEnvelope)}};le.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:P(le.prototype.writeLineStringOrCurveMember),curveMember:P(le.prototype.writeLineStringOrCurveMember)}};le.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:P(le.prototype.writeRing),innerBoundaryIs:P(le.prototype.writeRing)}};le.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:P(le.prototype.writePointMember)}};le.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:P(le.prototype.writeSurfaceOrPolygonMember),polygonMember:P(le.prototype.writeSurfaceOrPolygonMember)}};le.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:P(ie),upperCorner:P(ie)}};const wr=le,Wf=wt+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",Hf={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class j extends re{constructor(e){e=e||{},super(e),this.surface_=e.surface!==void 0?e.surface:!1,this.curve_=e.curve!==void 0?e.curve:!1,this.multiCurve_=e.multiCurve!==void 0?e.multiCurve:!0,this.multiSurface_=e.multiSurface!==void 0?e.multiSurface:!0,this.schemaLocation=e.schemaLocation?e.schemaLocation:Wf,this.hasZ=e.hasZ!==void 0?e.hasZ:!1}readMultiCurve(e,t){const n=G([],this.MULTICURVE_PARSERS,e,t,this);if(n)return new yr(n)}readFlatCurveRing(e,t){const n=G([],this.MULTICURVE_PARSERS,e,t,this),i=[];for(let s=0,o=n.length;s<o;++s)Cn(i,n[s].getFlatCoordinates());return i}readMultiSurface(e,t){const n=G([],this.MULTISURFACE_PARSERS,e,t,this);if(n)return new ln(n)}curveMemberParser(e,t){At(this.CURVEMEMBER_PARSERS,e,t,this)}surfaceMemberParser(e,t){At(this.SURFACEMEMBER_PARSERS,e,t,this)}readPatch(e,t){return G([null],this.PATCHES_PARSERS,e,t,this)}readSegment(e,t){return G([],this.SEGMENTS_PARSERS,e,t,this)}readPolygonPatch(e,t){return G([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this)}readLineStringSegment(e,t){return G([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}interiorParser(e,t){const n=G(void 0,this.RING_PARSERS,e,t,this);n&&t[t.length-1].push(n)}exteriorParser(e,t){const n=G(void 0,this.RING_PARSERS,e,t,this);if(n){const i=t[t.length-1];i[0]=n}}readSurface(e,t){const n=G([null],this.SURFACE_PARSERS,e,t,this);if(n&&n[0]){const i=n[0],s=[i.length];let o,a;for(o=1,a=n.length;o<a;++o)Cn(i,n[o]),s.push(i.length);return new cn(i,"XYZ",s)}}readCurve(e,t){const n=G([null],this.CURVE_PARSERS,e,t,this);if(n)return new pt(n,"XYZ")}readEnvelope(e,t){const n=G([null],this.ENVELOPE_PARSERS,e,t,this);return Nl(n[1][0],n[1][1],n[2][0],n[2][1])}readFlatPos(e,t){let n=In(e,!1);const i=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,s=[];let o;for(;o=i.exec(n);)s.push(parseFloat(o[1])),n=n.substr(o[0].length);if(n!=="")return;const l=t[0].srsName;let c="enu";if(l&&(c=ye(l).getAxisOrientation()),c==="neu"){let f,d;for(f=0,d=s.length;f<d;f+=3){const g=s[f],m=s[f+1];s[f]=m,s[f+1]=g}}const h=s.length;if(h==2&&s.push(0),h!==0)return s}readFlatPosList(e,t){const n=In(e,!1).replace(/^\s*|\s*$/g,""),i=t[0],s=i.srsName,o=i.srsDimension;let a="enu";s&&(a=ye(s).getAxisOrientation());const l=n.split(/\s+/);let c=2;e.getAttribute("srsDimension")?c=Pt(e.getAttribute("srsDimension")):e.getAttribute("dimension")?c=Pt(e.getAttribute("dimension")):e.parentNode.getAttribute("srsDimension")?c=Pt(e.parentNode.getAttribute("srsDimension")):o&&(c=Pt(o));let h,f,d;const g=[];for(let m=0,_=l.length;m<_;m+=c)h=parseFloat(l[m]),f=parseFloat(l[m+1]),d=c===3?parseFloat(l[m+2]):0,a.substr(0,2)==="en"?g.push(h,f,d):g.push(f,h,d);return g}writePos_(e,t,n){const i=n[n.length-1],s=i.hasZ,o=s?"3":"2";e.setAttribute("srsDimension",o);const a=i.srsName;let l="enu";a&&(l=ye(a).getAxisOrientation());const c=t.getCoordinates();let h;if(l.substr(0,2)==="en"?h=c[0]+" "+c[1]:h=c[1]+" "+c[0],s){const f=c[2]||0;h+=" "+f}ie(e,h)}getCoords_(e,t,n){let i="enu";t&&(i=ye(t).getAxisOrientation());let s=i.substr(0,2)==="en"?e[0]+" "+e[1]:e[1]+" "+e[0];if(n){const o=e[2]||0;s+=" "+o}return s}writePosList_(e,t,n){const i=n[n.length-1],s=i.hasZ,o=s?"3":"2";e.setAttribute("srsDimension",o);const a=i.srsName,l=t.getCoordinates(),c=l.length,h=new Array(c);let f;for(let d=0;d<c;++d)f=l[d],h[d]=this.getCoords_(f,a,s);ie(e,h.join(" "))}writePoint(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=Q(e.namespaceURI,"pos");e.appendChild(o),this.writePos_(o,t,n)}writeEnvelope(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];xe({node:e},this.ENVELOPE_SERIALIZERS,_r,a,n,o,this)}writeLinearRing(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=Q(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,n)}RING_NODE_FACTORY_(e,t,n){const i=t[t.length-1],s=i.node,o=i.exteriorWritten;return o===void 0&&(i.exteriorWritten=!0),Q(s.namespaceURI,o!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();xe({node:e,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,n,void 0,this)}else if(e.nodeName==="Surface"){const a=Q(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,n)}}writeCurveOrLineString(e,t,n){const s=n[n.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=Q(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,n)}else if(e.nodeName==="Curve"){const o=Q(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,n)}}writeMultiSurfaceOrPolygon(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.surface;o&&e.setAttribute("srsName",o);const l=t.getPolygons();xe({node:e,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeMultiPoint(e,t,n){const i=n[n.length-1],s=i.srsName,o=i.hasZ;s&&e.setAttribute("srsName",s);const a=t.getPoints();xe({node:e,hasZ:o,srsName:s},this.POINTMEMBER_SERIALIZERS,He("pointMember"),a,n,void 0,this)}writeMultiCurveOrLineString(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.curve;o&&e.setAttribute("srsName",o);const l=t.getLineStrings();xe({node:e,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,n,void 0,this)}writeRing(e,t,n){const i=Q(e.namespaceURI,"LinearRing");e.appendChild(i),this.writeLinearRing(i,t,n)}writeSurfaceOrPolygonMember(e,t,n){const i=this.GEOMETRY_NODE_FACTORY_(t,n);i&&(e.appendChild(i),this.writeSurfaceOrPolygon(i,t,n))}writePointMember(e,t,n){const i=Q(e.namespaceURI,"Point");e.appendChild(i),this.writePoint(i,t,n)}writeLineStringOrCurveMember(e,t,n){const i=this.GEOMETRY_NODE_FACTORY_(t,n);i&&(e.appendChild(i),this.writeCurveOrLineString(i,t,n))}writeSurfacePatches_(e,t,n){const i=Q(e.namespaceURI,"PolygonPatch");e.appendChild(i),this.writeSurfaceOrPolygon(i,t,n)}writeCurveSegments_(e,t,n){const i=Q(e.namespaceURI,"LineStringSegment");e.appendChild(i),this.writeCurveOrLineString(i,t,n)}writeGeometryElement(e,t,n){const i=n[n.length-1],s=Object.assign({},i);s.node=e;let o;Array.isArray(t)?o=as(t,i):o=Oe(t,!0,i),xe(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],n,void 0,this)}writeFeatureElement(e,t,n){const i=t.getId();i&&e.setAttribute("fid",i);const s=n[n.length-1],o=s.featureNS,a=t.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],c=[];if(t.hasProperties()){const f=t.getProperties();for(const d in f){const g=f[d];g!==null&&(l.push(d),c.push(g),d==a||typeof g.getSimplifiedGeometry=="function"?d in s.serializers[o]||(s.serializers[o][d]=P(this.writeGeometryElement,this)):d in s.serializers[o]||(s.serializers[o][d]=P(ie)))}}const h=Object.assign({},s);h.node=e,xe(h,s.serializers,He(void 0,o),c,n,l)}writeFeatureMembers_(e,t,n){const i=n[n.length-1],s=i.featureType,o=i.featureNS,a={};a[o]={},a[o][s]=P(this.writeFeatureElement,this);const l=Object.assign({},i);l.node=e,xe(l,a,He(s,o),t,n)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,n){const i=t[t.length-1].node;return Q(this.namespace,Hf[i.nodeName])}GEOMETRY_NODE_FACTORY_(e,t,n){const i=t[t.length-1],s=i.multiSurface,o=i.surface,a=i.curve,l=i.multiCurve;return Array.isArray(e)?n="Envelope":(n=e.getType(),n==="MultiPolygon"&&s===!0?n="MultiSurface":n==="Polygon"&&o===!0?n="Surface":n==="LineString"&&a===!0?n="Curve":n==="MultiLineString"&&l===!0&&(n="MultiCurve")),Q(this.namespace,n)}writeGeometryNode(e,t){t=this.adaptOptions(t);const n=Q(this.namespace,"geom"),i={node:n,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return t&&Object.assign(i,t),this.writeGeometryElement(n,e,[i]),n}writeFeaturesNode(e,t){t=this.adaptOptions(t);const n=Q(this.namespace,"featureMembers");n.setAttributeNS(Kr,"xsi:schemaLocation",this.schemaLocation);const i={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return t&&Object.assign(i,t),this.writeFeatureMembers_(n,e,[i]),n}}j.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:X(j.prototype.readFlatPos),posList:X(j.prototype.readFlatPosList),coordinates:X(wr.prototype.readFlatCoordinates)}};j.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:j.prototype.interiorParser,exterior:j.prototype.exteriorParser}};j.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:X(re.prototype.readPoint),MultiPoint:X(re.prototype.readMultiPoint),LineString:X(re.prototype.readLineString),MultiLineString:X(re.prototype.readMultiLineString),LinearRing:X(re.prototype.readLinearRing),Polygon:X(re.prototype.readPolygon),MultiPolygon:X(re.prototype.readMultiPolygon),Surface:X(j.prototype.readSurface),MultiSurface:X(j.prototype.readMultiSurface),Curve:X(j.prototype.readCurve),MultiCurve:X(j.prototype.readMultiCurve),Envelope:X(j.prototype.readEnvelope)}};j.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:W(j.prototype.curveMemberParser),curveMembers:W(j.prototype.curveMemberParser)}};j.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:W(j.prototype.surfaceMemberParser),surfaceMembers:W(j.prototype.surfaceMemberParser)}};j.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:W(re.prototype.readLineString),Curve:W(j.prototype.readCurve)}};j.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:W(re.prototype.readPolygon),Surface:W(j.prototype.readSurface)}};j.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:X(j.prototype.readPatch)}};j.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:X(j.prototype.readSegment)}};j.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:W(j.prototype.readFlatPosList),upperCorner:W(j.prototype.readFlatPosList)}};j.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:X(j.prototype.readPolygonPatch)}};j.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:Dl(j.prototype.readLineStringSegment)}};re.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:X(re.prototype.readFlatLinearRing),Ring:X(j.prototype.readFlatCurveRing)}};j.prototype.writeFeatures;j.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:P(j.prototype.writeRing),interior:P(j.prototype.writeRing)}};j.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:P(ie),upperCorner:P(ie)}};j.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:P(j.prototype.writeSurfaceOrPolygonMember),polygonMember:P(j.prototype.writeSurfaceOrPolygonMember)}};j.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:P(j.prototype.writePointMember)}};j.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:P(j.prototype.writeLineStringOrCurveMember),curveMember:P(j.prototype.writeLineStringOrCurveMember)}};j.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:P(j.prototype.writeCurveOrLineString),MultiCurve:P(j.prototype.writeMultiCurveOrLineString),Point:P(j.prototype.writePoint),MultiPoint:P(j.prototype.writeMultiPoint),LineString:P(j.prototype.writeCurveOrLineString),MultiLineString:P(j.prototype.writeMultiCurveOrLineString),LinearRing:P(j.prototype.writeLinearRing),Polygon:P(j.prototype.writeSurfaceOrPolygon),MultiPolygon:P(j.prototype.writeMultiSurfaceOrPolygon),Surface:P(j.prototype.writeSurfaceOrPolygon),MultiSurface:P(j.prototype.writeMultiSurfaceOrPolygon),Envelope:P(j.prototype.writeEnvelope)}};const te=j,ws=te;ws.prototype.writeFeatures;ws.prototype.writeFeaturesNode;const Xf=ws,Te=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],Yf="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",qf={rte:ac,trk:lc,wpt:cc},Kf=$(Te,{rte:W(ac),trk:W(lc),wpt:W(cc)}),Qf=$(Te,{text:R(D,"linkText"),type:R(D,"linkType")}),Jf=$(Te,{name:R(D),email:bd,link:dn}),ed=$(Te,{name:R(D),desc:R(D),author:R(vd),copyright:R(Sd),link:dn,time:R(Qn),keywords:R(D),bounds:Rd,extensions:ii}),td=$(Te,{year:R(Re),license:R(D)}),rd=$(Te,{rte:P(Id),trk:P(Cd),wpt:P(Md)});class nd extends Kn{constructor(e){super(),e=e||{},this.dataProjection=ye("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let t=0,n=e.length;t<n;++t){const i=e[t];if(this.readExtensions_){const s=i.get("extensionsNode_")||null;this.readExtensions_(i,s)}i.set("extensionsNode_",void 0)}}readMetadata(e){return e?typeof e=="string"?this.readMetadataFromDocument(On(e)):Mn(e)?this.readMetadataFromDocument(e):this.readMetadataFromNode(e):null}readMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType===Node.ELEMENT_NODE){const n=this.readMetadataFromNode(t);if(n)return n}return null}readMetadataFromNode(e){if(!Te.includes(e.namespaceURI))return null;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(Te.includes(t.namespaceURI)&&t.localName==="metadata")return G({},ed,t,[]);return null}readFeatureFromNode(e,t){if(!Te.includes(e.namespaceURI))return null;const n=qf[e.localName];if(!n)return null;const i=n(e,[this.getReadOptions(e,t)]);return i?(this.handleReadExtensions_([i]),i):null}readFeaturesFromNode(e,t){if(!Te.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const n=G([],Kf,e,[this.getReadOptions(e,t)]);return n?(this.handleReadExtensions_(n),n):[]}return[]}writeFeaturesNode(e,t){t=this.adaptOptions(t);const n=Q("http://www.topografix.com/GPX/1/1","gpx"),i="http://www.w3.org/2000/xmlns/";return n.setAttributeNS(i,"xmlns:xsi",Kr),n.setAttributeNS(Kr,"xsi:schemaLocation",Yf),n.setAttribute("version","1.1"),n.setAttribute("creator","OpenLayers"),xe({node:n},rd,Td,e,[t]),n}}const id=$(Te,{name:R(D),cmt:R(D),desc:R(D),src:R(D),link:dn,number:R(Re),extensions:ii,type:R(D),rtept:Pd}),sd=$(Te,{ele:R(De),time:R(Qn)}),od=$(Te,{name:R(D),cmt:R(D),desc:R(D),src:R(D),link:dn,number:R(Re),type:R(D),extensions:ii,trkseg:Ld}),ad=$(Te,{trkpt:Ad}),ld=$(Te,{ele:R(De),time:R(Qn)}),cd=$(Te,{ele:R(De),time:R(Qn),magvar:R(De),geoidheight:R(De),name:R(D),cmt:R(D),desc:R(D),src:R(D),link:dn,sym:R(D),type:R(D),fix:R(D),sat:R(Re),hdop:R(De),vdop:R(De),pdop:R(De),ageofdgpsdata:R(De),dgpsid:R(Re),extensions:ii}),ud=["text","type"],hd=$(Te,{text:P(ie),type:P(ie)}),fd=$(Te,["name","cmt","desc","src","link","number","type","rtept"]),dd=$(Te,{name:P(ie),cmt:P(ie),desc:P(ie),src:P(ie),link:P(Ss),number:P(Fn),type:P(ie),rtept:Gl(P(Rs))}),pd=$(Te,["ele","time"]),gd=$(Te,["name","cmt","desc","src","link","number","type","trkseg"]),md=$(Te,{name:P(ie),cmt:P(ie),desc:P(ie),src:P(ie),link:P(Ss),number:P(Fn),type:P(ie),trkseg:Gl(P(Od))}),yd=He("trkpt"),_d=$(Te,{trkpt:P(Rs)}),xd=$(Te,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),Ed=$(Te,{ele:P(Ut),time:P(ph),magvar:P(Ut),geoidheight:P(Ut),name:P(ie),cmt:P(ie),desc:P(ie),src:P(ie),link:P(Ss),sym:P(ie),type:P(ie),fix:P(ie),sat:P(Fn),hdop:P(Ut),vdop:P(Ut),pdop:P(Ut),ageofdgpsdata:P(Ut),dgpsid:P(Fn)}),wd={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function Td(r,e,t){const n=r.getGeometry();if(n){const i=wd[n.getType()];if(i){const s=e[e.length-1].node;return Q(s.namespaceURI,i)}}}function Ts(r,e,t,n){return r.push(parseFloat(t.getAttribute("lon")),parseFloat(t.getAttribute("lat"))),"ele"in n?(r.push(n.ele),delete n.ele,e.hasZ=!0):r.push(0),"time"in n?(r.push(n.time),delete n.time,e.hasM=!0):r.push(0),r}function vs(r,e,t){let n="XY",i=2;if(r.hasZ&&r.hasM?(n="XYZM",i=4):r.hasZ?(n="XYZ",i=3):r.hasM&&(n="XYM",i=3),i!==4){for(let s=0,o=e.length/4;s<o;s++)e[s*i]=e[s*4],e[s*i+1]=e[s*4+1],r.hasZ&&(e[s*i+2]=e[s*4+2]),r.hasM&&(e[s*i+2]=e[s*4+3]);if(e.length=e.length/4*i,t)for(let s=0,o=t.length;s<o;s++)t[s]=t[s]/4*i}return n}function vd(r,e){const t=G({},Jf,r,e);if(t)return t}function Sd(r,e){const t=G({},td,r,e);if(t){const n=r.getAttribute("author");return n!==null&&(t.author=n),t}}function Rd(r,e){const t=e[e.length-1],n=r.getAttribute("minlat"),i=r.getAttribute("minlon"),s=r.getAttribute("maxlat"),o=r.getAttribute("maxlon");i!==null&&n!==null&&o!==null&&s!==null&&(t.bounds=[[parseFloat(i),parseFloat(n)],[parseFloat(o),parseFloat(s)]])}function bd(r,e){const t=e[e.length-1],n=r.getAttribute("id"),i=r.getAttribute("domain");n!==null&&i!==null&&(t.email=`${n}@${i}`)}function dn(r,e){const t=e[e.length-1],n=r.getAttribute("href");n!==null&&(t.link=n),At(Qf,r,e)}function ii(r,e){const t=e[e.length-1];t.extensionsNode_=r}function Pd(r,e){const t=G({},sd,r,e);if(t){const n=e[e.length-1],i=n.flatCoordinates,s=n.layoutOptions;Ts(i,s,r,t)}}function Ad(r,e){const t=G({},ld,r,e);if(t){const n=e[e.length-1],i=n.flatCoordinates,s=n.layoutOptions;Ts(i,s,r,t)}}function Ld(r,e){const t=e[e.length-1];At(ad,r,e);const n=t.flatCoordinates;t.ends.push(n.length)}function ac(r,e){const t=e[0],n=G({flatCoordinates:[],layoutOptions:{}},id,r,e);if(!n)return;const i=n.flatCoordinates;delete n.flatCoordinates;const s=n.layoutOptions;delete n.layoutOptions;const o=vs(s,i),a=new pt(i,o);Oe(a,!1,t);const l=new qe(a);return l.setProperties(n,!0),l}function lc(r,e){const t=e[0],n=G({flatCoordinates:[],ends:[],layoutOptions:{}},od,r,e);if(!n)return;const i=n.flatCoordinates;delete n.flatCoordinates;const s=n.ends;delete n.ends;const o=n.layoutOptions;delete n.layoutOptions;const a=vs(o,i,s),l=new yr(i,a,s);Oe(l,!1,t);const c=new qe(l);return c.setProperties(n,!0),c}function cc(r,e){const t=e[0],n=G({},cd,r,e);if(!n)return;const i={},s=Ts([],i,r,n),o=vs(i,s),a=new nt(s,o);Oe(a,!1,t);const l=new qe(a);return l.setProperties(n,!0),l}function Ss(r,e,t){r.setAttribute("href",e);const i=t[t.length-1].properties,s=[i.linkText,i.linkType];xe({node:r},hd,_r,s,t,ud)}function Rs(r,e,t){const n=t[t.length-1],s=n.node.namespaceURI,o=n.properties;switch(r.setAttributeNS(null,"lat",String(e[1])),r.setAttributeNS(null,"lon",String(e[0])),n.geometryLayout){case"XYZM":e[3]!==0&&(o.time=e[3]);case"XYZ":e[2]!==0&&(o.ele=e[2]);break;case"XYM":e[2]!==0&&(o.time=e[2]);break}const l=r.nodeName=="rtept"?pd[s]:xd[s],c=ls(o,l);xe({node:r,properties:o},Ed,_r,c,t,l)}function Id(r,e,t){const n=t[0],i=e.getProperties(),s={node:r};s.properties=i;const o=e.getGeometry();if(o.getType()=="LineString"){const h=Oe(o,!0,n);s.geometryLayout=h.getLayout(),i.rtept=h.getCoordinates()}const a=t[t.length-1].node,l=fd[a.namespaceURI],c=ls(i,l);xe(s,dd,_r,c,t,l)}function Cd(r,e,t){const n=t[0],i=e.getProperties(),s={node:r};s.properties=i;const o=e.getGeometry();if(o.getType()=="MultiLineString"){const h=Oe(o,!0,n);i.trkseg=h.getLineStrings()}const a=t[t.length-1].node,l=gd[a.namespaceURI],c=ls(i,l);xe(s,md,_r,c,t,l)}function Od(r,e,t){const n={node:r};n.geometryLayout=e.getLayout(),n.properties={},xe(n,_d,yd,e.getCoordinates(),t)}function Md(r,e,t){const n=t[0],i=t[t.length-1];i.properties=e.getProperties();const s=e.getGeometry();if(s.getType()=="Point"){const o=Oe(s,!0,n);i.geometryLayout=o.getLayout(),Rs(r,o.getCoordinates(),t)}}const Fd=nd;class Nd extends Ul{constructor(){super()}getType(){return"text"}readFeature(e,t){return this.readFeatureFromText(xn(e),this.adaptOptions(t))}readFeatureFromText(e,t){return xt()}readFeatures(e,t){return this.readFeaturesFromText(xn(e),this.adaptOptions(t))}readFeaturesFromText(e,t){return xt()}readGeometry(e,t){return this.readGeometryFromText(xn(e),this.adaptOptions(t))}readGeometryFromText(e,t){return xt()}readProjection(e){return this.readProjectionFromText(xn(e))}readProjectionFromText(e){return this.dataProjection}writeFeature(e,t){return this.writeFeatureText(e,this.adaptOptions(t))}writeFeatureText(e,t){return xt()}writeFeatures(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))}writeFeaturesText(e,t){return xt()}writeGeometry(e,t){return this.writeGeometryText(e,this.adaptOptions(t))}writeGeometryText(e,t){return xt()}}function xn(r){return typeof r=="string"?r:""}const bs=Nd,Dd=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,Gd=/^H.([A-Z]{3}).*?:(.*)/,Ud=/^HFDTE(\d{2})(\d{2})(\d{2})/,kd=/\r\n|\r|\n/;class zd extends bs{constructor(e){super(),e=e||{},this.dataProjection=ye("EPSG:4326"),this.altitudeMode_=e.altitudeMode?e.altitudeMode:"none"}readFeatureFromText(e,t){const n=this.altitudeMode_,i=e.split(kd),s={},o=[];let a=2e3,l=0,c=1,h=-1,f,d;for(f=0,d=i.length;f<d;++f){const x=i[f];let w;if(x.charAt(0)=="B"){if(w=Dd.exec(x),w){const E=parseInt(w[1],10),v=parseInt(w[2],10),S=parseInt(w[3],10);let A=parseInt(w[4],10)+parseInt(w[5],10)/6e4;w[6]=="S"&&(A=-A);let O=parseInt(w[7],10)+parseInt(w[8],10)/6e4;if(w[9]=="W"&&(O=-O),o.push(O,A),n!="none"){let F;n=="gps"?F=parseInt(w[11],10):n=="barometric"?F=parseInt(w[12],10):F=0,o.push(F)}let I=Date.UTC(a,l,c,E,v,S);I<h&&(I=Date.UTC(a,l,c+1,E,v,S)),o.push(I/1e3),h=I}}else x.charAt(0)=="H"&&(w=Ud.exec(x),w?(c=parseInt(w[1],10),l=parseInt(w[2],10)-1,a=2e3+parseInt(w[3],10)):(w=Gd.exec(x),w&&(s[w[1]]=w[2].trim())))}if(o.length===0)return null;const g=n=="none"?"XYM":"XYZM",m=new pt(o,g),_=new qe(Oe(m,!1,t));return _.setProperties(s,!0),_}readFeaturesFromText(e,t){const n=this.readFeatureFromText(e,t);return n?[n]:[]}}const Bd=zd,Le={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"},Zt={};Zt[Le.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}};Zt[Le.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}};Zt[Le.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}};Zt.none={none:{supports:[],formats:[],qualities:[]}};const $d=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,Co=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,jd=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function Vd(r){let e=r.getComplianceLevelSupportedFeatures();return e===void 0&&(e=Zt[Le.VERSION1].level0),{url:r.imageInfo["@id"]===void 0?void 0:r.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:e.supports,formats:[...e.formats,r.imageInfo.formats===void 0?[]:r.imageInfo.formats],qualities:[...e.qualities,r.imageInfo.qualities===void 0?[]:r.imageInfo.qualities],resolutions:r.imageInfo.scale_factors,tileSize:r.imageInfo.tile_width!==void 0?r.imageInfo.tile_height!==void 0?[r.imageInfo.tile_width,r.imageInfo.tile_height]:[r.imageInfo.tile_width,r.imageInfo.tile_width]:r.imageInfo.tile_height!=null?[r.imageInfo.tile_height,r.imageInfo.tile_height]:void 0}}function Zd(r){const e=r.getComplianceLevelSupportedFeatures(),t=Array.isArray(r.imageInfo.profile)&&r.imageInfo.profile.length>1,n=t&&r.imageInfo.profile[1].supports?r.imageInfo.profile[1].supports:[],i=t&&r.imageInfo.profile[1].formats?r.imageInfo.profile[1].formats:[],s=t&&r.imageInfo.profile[1].qualities?r.imageInfo.profile[1].qualities:[];return{url:r.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:r.imageInfo.sizes===void 0?void 0:r.imageInfo.sizes.map(function(o){return[o.width,o.height]}),tileSize:r.imageInfo.tiles===void 0?void 0:[r.imageInfo.tiles.map(function(o){return o.width})[0],r.imageInfo.tiles.map(function(o){return o.height===void 0?o.width:o.height})[0]],resolutions:r.imageInfo.tiles===void 0?void 0:r.imageInfo.tiles.map(function(o){return o.scaleFactors})[0],supports:[...e.supports,...n],formats:[...e.formats,...i],qualities:[...e.qualities,...s]}}function Wd(r){const e=r.getComplianceLevelSupportedFeatures(),t=r.imageInfo.extraFormats===void 0?e.formats:[...e.formats,...r.imageInfo.extraFormats],n=r.imageInfo.preferredFormats!==void 0&&Array.isArray(r.imageInfo.preferredFormats)&&r.imageInfo.preferredFormats.length>0?r.imageInfo.preferredFormats.filter(function(i){return["jpg","png","gif"].includes(i)}).reduce(function(i,s){return i===void 0&&t.includes(s)?s:i},void 0):void 0;return{url:r.imageInfo.id,sizes:r.imageInfo.sizes===void 0?void 0:r.imageInfo.sizes.map(function(i){return[i.width,i.height]}),tileSize:r.imageInfo.tiles===void 0?void 0:[r.imageInfo.tiles.map(function(i){return i.width})[0],r.imageInfo.tiles.map(function(i){return i.height})[0]],resolutions:r.imageInfo.tiles===void 0?void 0:r.imageInfo.tiles.map(function(i){return i.scaleFactors})[0],supports:r.imageInfo.extraFeatures===void 0?e.supports:[...e.supports,...r.imageInfo.extraFeatures],formats:t,qualities:r.imageInfo.extraQualities===void 0?e.qualities:[...e.qualities,...r.imageInfo.extraQualities],preferredFormat:n}}const si={};si[Le.VERSION1]=Vd;si[Le.VERSION2]=Zd;si[Le.VERSION3]=Wd;class Hd{constructor(e){this.setImageInfo(e)}setImageInfo(e){typeof e=="string"?this.imageInfo=JSON.parse(e):this.imageInfo=e}getImageApiVersion(){if(this.imageInfo===void 0)return;let e=this.imageInfo["@context"]||"ol-no-context";typeof e=="string"&&(e=[e]);for(let t=0;t<e.length;t++)switch(e[t]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return Le.VERSION1;case"http://iiif.io/api/image/2/context.json":return Le.VERSION2;case"http://iiif.io/api/image/3/context.json":return Le.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(Le.VERSION1)&&this.imageInfo.identifier)return Le.VERSION1;break}gt(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(e){if(!(this.imageInfo===void 0||this.imageInfo.profile===void 0))switch(e===void 0&&(e=this.getImageApiVersion()),e){case Le.VERSION1:if($d.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Le.VERSION3:if(jd.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Le.VERSION2:if(typeof this.imageInfo.profile=="string"&&Co.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&typeof this.imageInfo.profile[0]=="string"&&Co.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0];break}}getComplianceLevelFromProfile(e){const t=this.getComplianceLevelEntryFromProfile(e);if(t===void 0)return;const n=t.match(/level[0-2](?:\.json)?$/g);return Array.isArray(n)?n[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(this.imageInfo===void 0)return;const e=this.getImageApiVersion(),t=this.getComplianceLevelFromProfile(e);return t===void 0?Zt.none.none:Zt[e][t]}getTileSourceOptions(e){const t=e||{},n=this.getImageApiVersion();if(n===void 0)return;const i=n===void 0?void 0:si[n](this);if(i!==void 0)return{url:i.url,version:n,size:[this.imageInfo.width,this.imageInfo.height],sizes:i.sizes,format:t.format!==void 0&&i.formats.includes(t.format)?t.format:i.preferredFormat!==void 0?i.preferredFormat:"jpg",supports:i.supports,quality:t.quality&&i.qualities.includes(t.quality)?t.quality:i.qualities.includes("native")?"native":"default",resolutions:Array.isArray(i.resolutions)?i.resolutions.sort(function(s,o){return o-s}):void 0,tileSize:i.tileSize}}}const Xd=Hd;class Yd{read(e){if(!e)return null;if(typeof e=="string"){const t=On(e);return this.readFromDocument(t)}return Mn(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){xt()}}const Ps=Yd,qd="http://www.w3.org/1999/xlink";function Tr(r){return r.getAttributeNS(qd,"href")}const Ve=[null,"http://www.opengis.net/ows/1.1"],Kd=$(Ve,{ServiceIdentification:R(Tp),ServiceProvider:R(Sp),OperationsMetadata:R(Ep)});class Qd extends Ps{constructor(){super()}readFromNode(e){const t=G({},Kd,e,[]);return t||null}}const Jd=$(Ve,{DeliveryPoint:R(D),City:R(D),AdministrativeArea:R(D),PostalCode:R(D),Country:R(D),ElectronicMailAddress:R(D)}),ep=$(Ve,{Value:Ee(Rp)}),tp=$(Ve,{AllowedValues:R(dp)}),rp=$(Ve,{Phone:R(wp),Address:R(fp)}),np=$(Ve,{HTTP:R(_p)}),ip=$(Ve,{Get:Ee(yp),Post:void 0}),sp=$(Ve,{DCP:R(mp)}),op=$(Ve,{Operation:xp}),ap=$(Ve,{Voice:R(D),Facsimile:R(D)}),lp=$(Ve,{Constraint:Ee(pp)}),cp=$(Ve,{IndividualName:R(D),PositionName:R(D),ContactInfo:R(gp)}),up=$(Ve,{Abstract:R(D),AccessConstraints:R(D),Fees:R(D),Title:R(D),ServiceTypeVersion:R(D),ServiceType:R(D)}),hp=$(Ve,{ProviderName:R(D),ProviderSite:R(Tr),ServiceContact:R(vp)});function fp(r,e){return G({},Jd,r,e)}function dp(r,e){return G({},ep,r,e)}function pp(r,e){const t=r.getAttribute("name");if(t)return G({name:t},tp,r,e)}function gp(r,e){return G({},rp,r,e)}function mp(r,e){return G({},np,r,e)}function yp(r,e){const t=Tr(r);if(t)return G({href:t},lp,r,e)}function _p(r,e){return G({},ip,r,e)}function xp(r,e){const t=r.getAttribute("name"),n=G({},sp,r,e);if(!n)return;const i=e[e.length-1];i[t]=n}function Ep(r,e){return G({},op,r,e)}function wp(r,e){return G({},ap,r,e)}function Tp(r,e){return G({},up,r,e)}function vp(r,e){return G({},cp,r,e)}function Sp(r,e){return G({},hp,r,e)}function Rp(r,e){return D(r)}const uc=Qd;function Oo(r,e,t,n,i,s){i!==void 0?(i=i,s=s!==void 0?s:0):(i=[],s=0);let o=e;for(;o<t;){const a=r[o++];i[s++]=r[o++],i[s++]=a;for(let l=2;l<n;++l)i[s++]=r[o++]}return i.length=s,i}class bp extends bs{constructor(e){super(),e=e||{},this.dataProjection=ye("EPSG:4326"),this.factor_=e.factor?e.factor:1e5,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY"}readFeatureFromText(e,t){const n=this.readGeometryFromText(e,t);return new qe(n)}readFeaturesFromText(e,t){return[this.readFeatureFromText(e,t)]}readGeometryFromText(e,t){const n=gh(this.geometryLayout_),i=Ap(e,n,this.factor_);Oo(i,0,i.length,n,i);const s=mh(i,0,i.length,n),o=new pt(s,this.geometryLayout_);return Oe(o,!1,this.adaptOptions(t))}writeFeatureText(e,t){const n=e.getGeometry();if(n)return this.writeGeometryText(n,t);throw new Error("Expected `feature` to have a geometry")}writeFeaturesText(e,t){return this.writeFeatureText(e[0],t)}writeGeometryText(e,t){e=Oe(e,!0,this.adaptOptions(t));const n=e.getFlatCoordinates(),i=e.getStride();return Oo(n,0,n.length,i,n),Pp(n,i,this.factor_)}}function Pp(r,e,t){t=t||1e5;let n;const i=new Array(e);for(n=0;n<e;++n)i[n]=0;for(let s=0,o=r.length;s<o;)for(n=0;n<e;++n,++s){const a=r[s],l=a-i[n];i[n]=a,r[s]=l}return Lp(r,t)}function Ap(r,e,t){t=t||1e5;let n;const i=new Array(e);for(n=0;n<e;++n)i[n]=0;const s=Ip(r,t);for(let o=0,a=s.length;o<a;)for(n=0;n<e;++n,++o)i[n]+=s[o],s[o]=i[n];return s}function Lp(r,e){e=e||1e5;for(let t=0,n=r.length;t<n;++t)r[t]=Math.round(r[t]*e);return Cp(r)}function Ip(r,e){e=e||1e5;const t=Op(r);for(let n=0,i=t.length;n<i;++n)t[n]/=e;return t}function Cp(r){for(let e=0,t=r.length;e<t;++e){const n=r[e];r[e]=n<0?~(n<<1):n<<1}return Mp(r)}function Op(r){const e=Fp(r);for(let t=0,n=e.length;t<n;++t){const i=e[t];e[t]=i&1?~(i>>1):i>>1}return e}function Mp(r){let e="";for(let t=0,n=r.length;t<n;++t)e+=Np(r[t]);return e}function Fp(r){const e=[];let t=0,n=0;for(let i=0,s=r.length;i<s;++i){const o=r.charCodeAt(i)-63;t|=(o&31)<<n,o<32?(e.push(t),t=0,n=0):n+=5}return e}function Np(r){let e,t="";for(;r>=32;)e=(32|r&31)+63,t+=String.fromCharCode(e),r>>=5;return e=r+63,t+=String.fromCharCode(e),t}const Dp=bp;class de extends te{constructor(e){e=e||{},super(e),this.schemaLocation=e.schemaLocation?e.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(e,t,n){const i=n[n.length-1];n[n.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},i),super.writeGeometryElement(e,t,n)}}de.prototype.namespace="http://www.opengis.net/gml/3.2";de.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:X(te.prototype.readFlatPos),posList:X(te.prototype.readFlatPosList),coordinates:X(wr.prototype.readFlatCoordinates)}};de.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:te.prototype.interiorParser,exterior:te.prototype.exteriorParser}};de.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:X(re.prototype.readPoint),MultiPoint:X(re.prototype.readMultiPoint),LineString:X(re.prototype.readLineString),MultiLineString:X(re.prototype.readMultiLineString),LinearRing:X(re.prototype.readLinearRing),Polygon:X(re.prototype.readPolygon),MultiPolygon:X(re.prototype.readMultiPolygon),Surface:X(de.prototype.readSurface),MultiSurface:X(te.prototype.readMultiSurface),Curve:X(de.prototype.readCurve),MultiCurve:X(te.prototype.readMultiCurve),Envelope:X(de.prototype.readEnvelope)}};de.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:W(te.prototype.curveMemberParser),curveMembers:W(te.prototype.curveMemberParser)}};de.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:W(te.prototype.surfaceMemberParser),surfaceMembers:W(te.prototype.surfaceMemberParser)}};de.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:W(re.prototype.readLineString),Curve:W(te.prototype.readCurve)}};de.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:W(re.prototype.readPolygon),Surface:W(te.prototype.readSurface)}};de.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:X(te.prototype.readPatch)}};de.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:X(te.prototype.readSegment)}};de.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:W(te.prototype.readFlatPosList),upperCorner:W(te.prototype.readFlatPosList)}};de.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:X(te.prototype.readPolygonPatch)}};de.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:Dl(te.prototype.readLineStringSegment)}};de.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:W(re.prototype.pointMemberParser),pointMembers:W(re.prototype.pointMemberParser)}};de.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:W(re.prototype.lineStringMemberParser),lineStringMembers:W(re.prototype.lineStringMemberParser)}};de.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:W(re.prototype.polygonMemberParser),polygonMembers:W(re.prototype.polygonMemberParser)}};de.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:W(re.prototype.readFlatCoordinatesFromNode)}};de.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:W(re.prototype.readLineString)}};de.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:W(re.prototype.readPolygon)}};de.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:X(re.prototype.readFlatLinearRing),Ring:X(de.prototype.readFlatCurveRing)}};de.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:P(te.prototype.writeRing),interior:P(te.prototype.writeRing)}};de.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:P(ie),upperCorner:P(ie)}};de.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:P(te.prototype.writeSurfaceOrPolygonMember),polygonMember:P(te.prototype.writeSurfaceOrPolygonMember)}};de.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:P(te.prototype.writePointMember)}};de.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:P(te.prototype.writeLineStringOrCurveMember),curveMember:P(te.prototype.writeLineStringOrCurveMember)}};de.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:P(te.prototype.writeCurveOrLineString),MultiCurve:P(te.prototype.writeMultiCurveOrLineString),Point:P(de.prototype.writePoint),MultiPoint:P(te.prototype.writeMultiPoint),LineString:P(te.prototype.writeCurveOrLineString),MultiLineString:P(te.prototype.writeMultiCurveOrLineString),LinearRing:P(te.prototype.writeLinearRing),Polygon:P(te.prototype.writeSurfaceOrPolygon),MultiPolygon:P(te.prototype.writeMultiSurfaceOrPolygon),Surface:P(te.prototype.writeSurfaceOrPolygon),MultiSurface:P(te.prototype.writeMultiSurfaceOrPolygon),Envelope:P(te.prototype.writeEnvelope)}};const As=de;class Gp{constructor(e){this.tagName_=e}getTagName(){return this.tagName_}}const hc=Gp;class Up extends hc{constructor(e,t){super(e),this.conditions=t,gt(this.conditions.length>=2,"At least 2 conditions are required")}}const kp=Up;class zp extends kp{constructor(e){super("And",Array.prototype.slice.call(arguments))}}const Bp=zp;class $p extends hc{constructor(e,t,n){if(super("BBOX"),this.geometryName=e,this.extent=t,t.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=n}}const jp=$p;function Vp(r){const e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(Bp,e))}function Zp(r,e,t){return new jp(r,e,t)}const Mo={"http://www.opengis.net/gml":{boundedBy:R(re.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:W(re.prototype.readFeaturesInternal)}},Wp={"http://www.opengis.net/wfs":{totalInserted:R(Re),totalUpdated:R(Re),totalDeleted:R(Re)},"http://www.opengis.net/wfs/2.0":{totalInserted:R(Re),totalUpdated:R(Re),totalDeleted:R(Re)}},Hp={"http://www.opengis.net/wfs":{TransactionSummary:R(No,"transactionSummary"),InsertResults:R(Go,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:R(No,"transactionSummary"),InsertResults:R(Go,"insertIds")}},Xp={"http://www.opengis.net/wfs":{PropertyName:P(ie)},"http://www.opengis.net/wfs/2.0":{PropertyName:P(ie)}},fc={"http://www.opengis.net/wfs":{Insert:P(Uo),Update:P(zo),Delete:P(ko),Property:P(Bo),Native:P($o)},"http://www.opengis.net/wfs/2.0":{Insert:P(Uo),Update:P(zo),Delete:P(ko),Property:P(Bo),Native:P($o)}},dc="feature",Ls="http://www.w3.org/2000/xmlns/",Is={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},Vi={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},Cs={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},Fo={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},Os={"2.0.0":As,"1.1.0":te,"1.0.0":wr},Yp="1.1.0";class qp extends Kn{constructor(e){super(),e=e||{},this.version_=e.version?e.version:Yp,this.featureType_=e.featureType,this.featureNS_=e.featureNS,this.gmlFormat_=e.gmlFormat?e.gmlFormat:new Os[this.version_],this.schemaLocation_=e.schemaLocation?e.schemaLocation:Fo[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(e){this.featureType_=e}readFeaturesFromNode(e,t){const n={node:e};Object.assign(n,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(n,this.getReadOptions(e,t||{}));const i=[n];let s;this.version_==="2.0.0"?s=Mo:s=this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let o=G([],s,e,i,this.gmlFormat_);return o||(o=[]),o}readTransactionResponse(e){if(e){if(typeof e=="string"){const t=On(e);return this.readTransactionResponseFromDocument(t)}return Mn(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}}readFeatureCollectionMetadata(e){if(e){if(typeof e=="string"){const t=On(e);return this.readFeatureCollectionMetadataFromDocument(t)}return Mn(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}}readFeatureCollectionMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)}readFeatureCollectionMetadataFromNode(e){const t={},n=Pt(e.getAttribute("numberOfFeatures"));return t.numberOfFeatures=n,G(t,Mo,e,[],this.gmlFormat_)}readTransactionResponseFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)}readTransactionResponseFromNode(e){return G({},Hp,e,[])}writeGetFeature(e){const t=Q(Vi[this.version_],"GetFeature");t.setAttribute("service","WFS"),t.setAttribute("version",this.version_),e.handle&&t.setAttribute("handle",e.handle),e.outputFormat&&t.setAttribute("outputFormat",e.outputFormat),e.maxFeatures!==void 0&&t.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&t.setAttribute("resultType",e.resultType),e.startIndex!==void 0&&t.setAttribute("startIndex",String(e.startIndex)),e.count!==void 0&&t.setAttribute("count",String(e.count)),e.viewParams!==void 0&&t.setAttribute("viewParams",e.viewParams),t.setAttributeNS(Kr,"xsi:schemaLocation",this.schemaLocation_);const n={node:t};if(Object.assign(n,{version:this.version_,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,propertyNames:e.propertyNames?e.propertyNames:[]}),gt(Array.isArray(e.featureTypes),"`options.featureTypes` must be an Array"),typeof e.featureTypes[0]=="string"){let i=e.filter;e.bbox&&(gt(e.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),i=this.combineBboxAndFilter(e.geometryName,e.bbox,e.srsName,i)),Object.assign(n,{geometryName:e.geometryName,filter:i}),Qo(t,e.featureTypes,[n])}else e.featureTypes.forEach(i=>{const s=this.combineBboxAndFilter(i.geometryName,i.bbox,e.srsName,e.filter);Object.assign(n,{geometryName:i.geometryName,filter:s}),Qo(t,[i.name],[n])});return t}combineBboxAndFilter(e,t,n,i){const s=Zp(e,t,n);return i?Vp(i,s):s}writeTransaction(e,t,n,i){const s=[],o=i.version?i.version:this.version_,a=Q(Vi[o],"Transaction");a.setAttribute("service","WFS"),a.setAttribute("version",o);let l;i&&(l=i.gmlOptions?i.gmlOptions:{},i.handle&&a.setAttribute("handle",i.handle)),a.setAttributeNS(Kr,"xsi:schemaLocation",Fo[o]);const c=Kp(a,l,o,i);return e&&En("Insert",e,s,c),t&&En("Update",t,s,c),n&&En("Delete",n,s,c),i.nativeElements&&En("Native",i.nativeElements,s,c),a}readProjectionFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null}readProjectionFromNode(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild){e=e.firstElementChild.firstElementChild;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(!(t.childNodes.length===0||t.childNodes.length===1&&t.firstChild.nodeType===3)){const n=[{}];return this.gmlFormat_.readGeometryElement(t,n),ye(n.pop().srsName)}}return null}}function Kp(r,e,t,n){const i=n.featurePrefix?n.featurePrefix:dc;let s;return t==="1.0.0"?s=2:t==="1.1.0"?s=3:t==="2.0.0"&&(s=3.2),Object.assign({node:r},{version:t,featureNS:n.featureNS,featureType:n.featureType,featurePrefix:i,gmlVersion:s,hasZ:n.hasZ,srsName:n.srsName},e)}function En(r,e,t,n){xe(n,fc,He(r),e,t)}function No(r,e){return G({},Wp,r,e)}const Qp={"http://www.opengis.net/ogc":{FeatureId:W(function(r,e){return r.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:W(function(r,e){return r.getAttribute("fid")})}};function Do(r,e){At(Qp,r,e)}const Jp={"http://www.opengis.net/wfs":{Feature:Do},"http://www.opengis.net/wfs/2.0":{Feature:Do}};function Go(r,e){return G([],Jp,r,e)}function Uo(r,e,t){const n=t[t.length-1],i=n.featureType,s=n.featureNS,o=n.gmlVersion,a=Q(s,i);r.appendChild(a),o===2?wr.prototype.writeFeatureElement(a,e,t):o===3?te.prototype.writeFeatureElement(a,e,t):As.prototype.writeFeatureElement(a,e,t)}function pc(r,e,t){const i=t[t.length-1].version,s=Is[i],o=Q(s,"Filter"),a=Q(s,"FeatureId");o.appendChild(a),a.setAttribute("fid",e),r.appendChild(o)}function Ms(r,e){r=r||dc;const t=r+":";return e.startsWith(t)?e:t+e}function ko(r,e,t){const n=t[t.length-1];gt(e.getId()!==void 0,"Features must have an id set");const i=n.featureType,s=n.featurePrefix,o=n.featureNS,a=Ms(s,i);r.setAttribute("typeName",a),r.setAttributeNS(Ls,"xmlns:"+s,o);const l=e.getId();l!==void 0&&pc(r,l,t)}function zo(r,e,t){const n=t[t.length-1];gt(e.getId()!==void 0,"Features must have an id set");const i=n.version,s=n.featureType,o=n.featurePrefix,a=n.featureNS,l=Ms(o,s),c=e.getGeometryName();r.setAttribute("typeName",l),r.setAttributeNS(Ls,"xmlns:"+o,a);const h=e.getId();if(h!==void 0){const f=e.getKeys(),d=[];for(let g=0,m=f.length;g<m;g++){const _=e.get(f[g]);if(_!==void 0){let x=f[g];_&&typeof _.getSimplifiedGeometry=="function"&&(x=c),d.push({name:x,value:_})}}xe({version:i,gmlVersion:n.gmlVersion,node:r,hasZ:n.hasZ,srsName:n.srsName},fc,He("Property"),d,t),pc(r,h,t)}}function Bo(r,e,t){const n=t[t.length-1],i=n.version,s=Vi[i],a=Q(s,i==="2.0.0"?"ValueReference":"Name"),l=n.gmlVersion;if(r.appendChild(a),ie(a,e.name),e.value!==void 0&&e.value!==null){const c=Q(s,"Value");r.appendChild(c),e.value&&typeof e.value.getSimplifiedGeometry=="function"?l===2?wr.prototype.writeGeometryElement(c,e.value,t):l===3?te.prototype.writeGeometryElement(c,e.value,t):As.prototype.writeGeometryElement(c,e.value,t):ie(c,e.value)}}function $o(r,e,t){e.vendorId&&r.setAttribute("vendorId",e.vendorId),e.safeToIgnore!==void 0&&r.setAttribute("safeToIgnore",String(e.safeToIgnore)),e.value!==void 0&&ie(r,e.value)}const oi={"http://www.opengis.net/wfs":{Query:P(jo)},"http://www.opengis.net/wfs/2.0":{Query:P(jo)},"http://www.opengis.net/ogc":{During:P(Wo),And:P(wn),Or:P(wn),Not:P(Ho),BBOX:P(Vo),Contains:P(Rt),Intersects:P(Rt),Within:P(Rt),DWithin:P(Zo),PropertyIsEqualTo:P(Ke),PropertyIsNotEqualTo:P(Ke),PropertyIsLessThan:P(Ke),PropertyIsLessThanOrEqualTo:P(Ke),PropertyIsGreaterThan:P(Ke),PropertyIsGreaterThanOrEqualTo:P(Ke),PropertyIsNull:P(Xo),PropertyIsBetween:P(Yo),PropertyIsLike:P(qo)},"http://www.opengis.net/fes/2.0":{During:P(Wo),And:P(wn),Or:P(wn),Not:P(Ho),BBOX:P(Vo),Contains:P(Rt),Disjoint:P(Rt),Intersects:P(Rt),ResourceId:P(tg),Within:P(Rt),DWithin:P(Zo),PropertyIsEqualTo:P(Ke),PropertyIsNotEqualTo:P(Ke),PropertyIsLessThan:P(Ke),PropertyIsLessThanOrEqualTo:P(Ke),PropertyIsGreaterThan:P(Ke),PropertyIsGreaterThanOrEqualTo:P(Ke),PropertyIsNull:P(Xo),PropertyIsBetween:P(Yo),PropertyIsLike:P(qo)}};function jo(r,e,t){const n=t[t.length-1],i=n.version,s=n.featurePrefix,o=n.featureNS,a=n.propertyNames,l=n.srsName;let c;s?c=Ms(s,e):c=e;let h;i==="2.0.0"?h="typeNames":h="typeName",r.setAttribute(h,c),l&&r.setAttribute("srsName",l),o&&r.setAttributeNS(Ls,"xmlns:"+s,o);const f=Object.assign({},n);f.node=r,xe(f,Xp,He("PropertyName"),a,t);const d=n.filter;if(d){const g=Q(ai(i),"Filter");r.appendChild(g),eg(g,d,t)}}function eg(r,e,t){const n=t[t.length-1],i={node:r};Object.assign(i,{context:n}),xe(i,oi,He(e.getTagName()),[e],t)}function Vo(r,e,t){const n=t[t.length-1],s=n.context.version;n.srsName=e.srsName;const o=Os[s];vr(s,r,e.geometryName),o.prototype.writeGeometryElement(r,e.extent,t)}function tg(r,e,t){r.setAttribute("rid",e.rid)}function Rt(r,e,t){const n=t[t.length-1],s=n.context.version;n.srsName=e.srsName;const o=Os[s];vr(s,r,e.geometryName),o.prototype.writeGeometryElement(r,e.geometry,t)}function Zo(r,e,t){const s=t[t.length-1].context.version;Rt(r,e,t);const o=Q(ai(s),"Distance");ie(o,e.distance.toString()),s==="2.0.0"?o.setAttribute("uom",e.unit):o.setAttribute("units",e.unit),r.appendChild(o)}function Wo(r,e,t){const s=t[t.length-1].context.version;Bn(Cs[s],"ValueReference",r,e.propertyName);const o=Q(wt,"TimePeriod");r.appendChild(o);const a=Q(wt,"begin");o.appendChild(a),Ko(a,e.begin);const l=Q(wt,"end");o.appendChild(l),Ko(l,e.end)}function wn(r,e,t){const i=t[t.length-1].context,s={node:r};Object.assign(s,{context:i});const o=e.conditions;for(let a=0,l=o.length;a<l;++a){const c=o[a];xe(s,oi,He(c.getTagName()),[c],t)}}function Ho(r,e,t){const i=t[t.length-1].context,s={node:r};Object.assign(s,{context:i});const o=e.condition;xe(s,oi,He(o.getTagName()),[o],t)}function Ke(r,e,t){const s=t[t.length-1].context.version;e.matchCase!==void 0&&r.setAttribute("matchCase",e.matchCase.toString()),vr(s,r,e.propertyName),$n(s,r,""+e.expression)}function Xo(r,e,t){const s=t[t.length-1].context.version;vr(s,r,e.propertyName)}function Yo(r,e,t){const s=t[t.length-1].context.version,o=ai(s);vr(s,r,e.propertyName);const a=Q(o,"LowerBoundary");r.appendChild(a),$n(s,a,""+e.lowerBoundary);const l=Q(o,"UpperBoundary");r.appendChild(l),$n(s,l,""+e.upperBoundary)}function qo(r,e,t){const s=t[t.length-1].context.version;r.setAttribute("wildCard",e.wildCard),r.setAttribute("singleChar",e.singleChar),r.setAttribute("escapeChar",e.escapeChar),e.matchCase!==void 0&&r.setAttribute("matchCase",e.matchCase.toString()),vr(s,r,e.propertyName),$n(s,r,""+e.pattern)}function Bn(r,e,t,n){const i=Q(r,e);ie(i,n),t.appendChild(i)}function $n(r,e,t){Bn(ai(r),"Literal",e,t)}function vr(r,e,t){r==="2.0.0"?Bn(Cs[r],"ValueReference",e,t):Bn(Is[r],"PropertyName",e,t)}function Ko(r,e){const t=Q(wt,"TimeInstant");r.appendChild(t);const n=Q(wt,"timePosition");t.appendChild(n),ie(n,e)}function Qo(r,e,t){const n=t[t.length-1],i=Object.assign({},n);i.node=r,xe(i,oi,He("Query"),e,t)}function ai(r){let e;return r==="2.0.0"?e=Cs[r]:e=Is[r],e}const rg=qp,me={POINT:1,LINE_STRING:2,POLYGON:3,MULTI_POINT:4,MULTI_LINE_STRING:5,MULTI_POLYGON:6,GEOMETRY_COLLECTION:7,POLYHEDRAL_SURFACE:15,TIN:16,TRIANGLE:17};class Jo{constructor(e){this.view_=e,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_="XY"}readUint8(){return this.view_.getUint8(this.pos_++)}readUint32(e){return this.view_.getUint32((this.pos_+=4)-4,e!==void 0?e:this.isLittleEndian_)}readDouble(e){return this.view_.getFloat64((this.pos_+=8)-8,e!==void 0?e:this.isLittleEndian_)}readPoint(){const e=[];return e.push(this.readDouble()),e.push(this.readDouble()),this.hasZ_&&e.push(this.readDouble()),this.hasM_&&e.push(this.readDouble()),e}readLineString(){const e=this.readUint32(),t=[];for(let n=0;n<e;n++)t.push(this.readPoint());return t}readPolygon(){const e=this.readUint32(),t=[];for(let n=0;n<e;n++)t.push(this.readLineString());return t}readWkbHeader(e){const n=this.readUint8()>0,i=this.readUint32(n),s=Math.floor((i&268435455)/1e3),o=!!(i&2147483648)||s===1||s===3,a=!!(i&1073741824)||s===2||s===3,l=!!(i&536870912),c=(i&268435455)%1e3,h=["XY",o?"Z":"",a?"M":""].join(""),f=l?this.readUint32(n):null;if(e!==void 0&&e!==c)throw new Error("Unexpected WKB geometry type "+c);if(this.initialized_){if(this.isLittleEndian_!==n)throw new Error("Inconsistent endian");if(this.layout_!==h)throw new Error("Inconsistent geometry layout");if(f&&this.srid_!==f)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=n,this.hasZ_=o,this.hasM_=a,this.layout_=h,this.srid_=f,this.initialized_=!0;return c}readWkbPayload(e){switch(e){case me.POINT:return this.readPoint();case me.LINE_STRING:return this.readLineString();case me.POLYGON:case me.TRIANGLE:return this.readPolygon();case me.MULTI_POINT:return this.readMultiPoint();case me.MULTI_LINE_STRING:return this.readMultiLineString();case me.MULTI_POLYGON:case me.POLYHEDRAL_SURFACE:case me.TIN:return this.readMultiPolygon();case me.GEOMETRY_COLLECTION:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+e+" is found")}}readWkbBlock(e){return this.readWkbPayload(this.readWkbHeader(e))}readWkbCollection(e,t){const n=this.readUint32(),i=[];for(let s=0;s<n;s++){const o=e.call(this,t);o&&i.push(o)}return i}readMultiPoint(){return this.readWkbCollection(this.readWkbBlock,me.POINT)}readMultiLineString(){return this.readWkbCollection(this.readWkbBlock,me.LINE_STRING)}readMultiPolygon(){return this.readWkbCollection(this.readWkbBlock,me.POLYGON)}readGeometryCollection(){return this.readWkbCollection(this.readGeometry)}readGeometry(){const e=this.readWkbHeader(),t=this.readWkbPayload(e);switch(e){case me.POINT:return new nt(t,this.layout_);case me.LINE_STRING:return new pt(t,this.layout_);case me.POLYGON:case me.TRIANGLE:return new cn(t,this.layout_);case me.MULTI_POINT:return new qn(t,this.layout_);case me.MULTI_LINE_STRING:return new yr(t,this.layout_);case me.MULTI_POLYGON:case me.POLYHEDRAL_SURFACE:case me.TIN:return new ln(t,this.layout_);case me.GEOMETRY_COLLECTION:return new Ct(t);default:return null}}getSrid(){return this.srid_}}class ng{constructor(e){e=e||{},this.layout_=e.layout,this.isLittleEndian_=e.littleEndian!==!1,this.isEWKB_=e.ewkb!==!1,this.writeQueue_=[],this.nodata_=Object.assign({X:0,Y:0,Z:0,M:0},e.nodata)}writeUint8(e){this.writeQueue_.push([1,e])}writeUint32(e){this.writeQueue_.push([4,e])}writeDouble(e){this.writeQueue_.push([8,e])}writePoint(e,t){const n=Object.assign.apply(null,t.split("").map((i,s)=>({[i]:e[s]})));for(const i of this.layout_)this.writeDouble(i in n?n[i]:this.nodata_[i])}writeLineString(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writePoint(e[n],t)}writePolygon(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writeLineString(e[n],t)}writeWkbHeader(e,t){e%=1e3,this.layout_.includes("Z")&&(e+=this.isEWKB_?2147483648:1e3),this.layout_.includes("M")&&(e+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(t)&&(e|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(e),this.isEWKB_&&Number.isInteger(t)&&this.writeUint32(t)}writeMultiPoint(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writeWkbHeader(1),this.writePoint(e[n],t)}writeMultiLineString(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writeWkbHeader(2),this.writeLineString(e[n],t)}writeMultiPolygon(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writeWkbHeader(3),this.writePolygon(e[n],t)}writeGeometryCollection(e){this.writeUint32(e.length);for(let t=0;t<e.length;t++)this.writeGeometry(e[t])}findMinimumLayout(e,t="XYZM"){const n=(i,s)=>i===s?i:i==="XYZM"?s:s==="XYZM"?i:"XY";if(e instanceof xo)return n(e.getLayout(),t);if(e instanceof Ct){const i=e.getGeometriesArray();for(let s=0;s<i.length&&t!=="XY";s++)t=this.findMinimumLayout(i[s],t)}return t}writeGeometry(e,t){const n={Point:me.POINT,LineString:me.LINE_STRING,Polygon:me.POLYGON,MultiPoint:me.MULTI_POINT,MultiLineString:me.MULTI_LINE_STRING,MultiPolygon:me.MULTI_POLYGON,GeometryCollection:me.GEOMETRY_COLLECTION},i=e.getType(),s=n[i];if(!s)throw new Error("GeometryType "+i+" is not supported");this.layout_||(this.layout_=this.findMinimumLayout(e)),this.writeWkbHeader(s,t),e instanceof xo?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[i].call(this,e.getCoordinates(),e.getLayout()):e instanceof Ct&&this.writeGeometryCollection(e.getGeometriesArray())}getBuffer(){const e=this.writeQueue_.reduce((s,o)=>s+o[0],0),t=new ArrayBuffer(e),n=new DataView(t);let i=0;return this.writeQueue_.forEach(s=>{switch(s[0]){case 1:n.setUint8(i,s[1]);break;case 4:n.setUint32(i,s[1],this.isLittleEndian_);break;case 8:n.setFloat64(i,s[1],this.isLittleEndian_);break}i+=s[0]}),t}}class ig extends Ul{constructor(e){super(),e=e||{},this.splitCollection=!!e.splitCollection,this.viewCache_=null,this.hex_=e.hex!==!1,this.littleEndian_=e.littleEndian!==!1,this.ewkb_=e.ewkb!==!1,this.layout_=e.geometryLayout,this.nodataZ_=e.nodataZ||0,this.nodataM_=e.nodataM||0,this.srid_=e.srid}getType(){return this.hex_?"text":"arraybuffer"}readFeature(e,t){return new qe({geometry:this.readGeometry(e,t)})}readFeatures(e,t){let n=[];const i=this.readGeometry(e,t);return this.splitCollection&&i instanceof Ct?n=i.getGeometriesArray():n=[i],n.map(s=>new qe({geometry:s}))}readGeometry(e,t){const n=ea(e);if(!n)return null;const s=new Jo(n).readGeometry();return this.viewCache_=n,t=this.getReadOptions(e,t),this.viewCache_=null,Oe(s,!1,t)}readProjection(e){const t=this.viewCache_||ea(e);if(!t)return;const n=new Jo(t);return n.readWkbHeader(),n.getSrid()&&ye("EPSG:"+n.getSrid())||void 0}writeFeature(e,t){return this.writeGeometry(e.getGeometry(),t)}writeFeatures(e,t){return this.writeGeometry(new Ct(e.map(n=>n.getGeometry())),t)}writeGeometry(e,t){t=this.adaptOptions(t);const n=new ng({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}});let i=Number.isInteger(this.srid_)?Number(this.srid_):null;if(this.srid_!==!1&&!Number.isInteger(this.srid_)){const o=t.dataProjection&&ye(t.dataProjection);if(o){const a=o.getCode();a.startsWith("EPSG:")&&(i=Number(a.substring(5)))}}n.writeGeometry(Oe(e,!0,t),i);const s=n.getBuffer();return this.hex_?sg(s):s}}function sg(r){const e=new Uint8Array(r);return Array.from(e.values()).map(t=>(t<16?"0":"")+Number(t).toString(16).toUpperCase()).join("")}function og(r){const e=new Uint8Array(r.length/2);for(let t=0;t<r.length/2;t++)e[t]=parseInt(r.substr(t*2,2),16);return new DataView(e.buffer)}function ea(r){return typeof r=="string"?og(r):ArrayBuffer.isView(r)?r instanceof DataView?r:new DataView(r.buffer,r.byteOffset,r.byteLength):r instanceof ArrayBuffer?new DataView(r):null}const ag=ig,lg={POINT:nt,LINESTRING:pt,POLYGON:cn,MULTIPOINT:qn,MULTILINESTRING:yr,MULTIPOLYGON:ln},gc="EMPTY",mc="Z",yc="M",cg="ZM",pe={START:0,TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6},ug={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class hg{constructor(e){this.wkt=e,this.index_=-1}isAlpha_(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}isNumeric_(e,t){return t=t!==void 0?t:!1,e>="0"&&e<="9"||e=="."&&!t}isWhiteSpace_(e){return e==" "||e=="	"||e=="\r"||e==`
`}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const e=this.nextChar_(),t=this.index_;let n=e,i;if(e=="(")i=pe.LEFT_PAREN;else if(e==",")i=pe.COMMA;else if(e==")")i=pe.RIGHT_PAREN;else if(this.isNumeric_(e)||e=="-")i=pe.NUMBER,n=this.readNumber_();else if(this.isAlpha_(e))i=pe.TEXT,n=this.readText_();else{if(this.isWhiteSpace_(e))return this.nextToken();if(e==="")i=pe.EOF;else throw new Error("Unexpected character: "+e)}return{position:t,value:n,type:i}}readNumber_(){let e;const t=this.index_;let n=!1,i=!1;do e=="."?n=!0:(e=="e"||e=="E")&&(i=!0),e=this.nextChar_();while(this.isNumeric_(e,n)||!i&&(e=="e"||e=="E")||i&&(e=="-"||e=="+"));return parseFloat(this.wkt.substring(t,this.index_--))}readText_(){let e;const t=this.index_;do e=this.nextChar_();while(this.isAlpha_(e));return this.wkt.substring(t,this.index_--).toUpperCase()}}class fg{constructor(e){this.lexer_=e,this.token_={position:0,type:pe.START},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(e){return this.token_.type==e}match(e){const t=this.isTokenType(e);return t&&this.consume_(),t}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let e="XY";const t=this.token_;if(this.isTokenType(pe.TEXT)){const n=t.value;n===mc?e="XYZ":n===yc?e="XYM":n===cg&&(e="XYZM"),e!=="XY"&&this.consume_()}return e}parseGeometryCollectionText_(){if(this.match(pe.LEFT_PAREN)){const e=[];do e.push(this.parseGeometry_());while(this.match(pe.COMMA));if(this.match(pe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(pe.LEFT_PAREN)){const e=this.parsePoint_();if(this.match(pe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(pe.LEFT_PAREN)){const e=this.parsePointList_();if(this.match(pe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(pe.LEFT_PAREN)){const e=this.parseLineStringTextList_();if(this.match(pe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(pe.LEFT_PAREN)){let e;if(this.token_.type==pe.LEFT_PAREN?e=this.parsePointTextList_():e=this.parsePointList_(),this.match(pe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(pe.LEFT_PAREN)){const e=this.parseLineStringTextList_();if(this.match(pe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(pe.LEFT_PAREN)){const e=this.parsePolygonTextList_();if(this.match(pe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePoint_(){const e=[],t=this.layout_.length;for(let n=0;n<t;++n){const i=this.token_;if(this.match(pe.NUMBER))e.push(i.value);else break}if(e.length==t)return e;throw new Error(this.formatErrorMessage_())}parsePointList_(){const e=[this.parsePoint_()];for(;this.match(pe.COMMA);)e.push(this.parsePoint_());return e}parsePointTextList_(){const e=[this.parsePointText_()];for(;this.match(pe.COMMA);)e.push(this.parsePointText_());return e}parseLineStringTextList_(){const e=[this.parseLineStringText_()];for(;this.match(pe.COMMA);)e.push(this.parseLineStringText_());return e}parsePolygonTextList_(){const e=[this.parsePolygonText_()];for(;this.match(pe.COMMA);)e.push(this.parsePolygonText_());return e}isEmptyGeometry_(){const e=this.isTokenType(pe.TEXT)&&this.token_.value==gc;return e&&this.consume_(),e}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const e=this.token_;if(this.match(pe.TEXT)){const t=e.value;this.layout_=this.parseGeometryLayout_();const n=this.isEmptyGeometry_();if(t=="GEOMETRYCOLLECTION"){if(n)return new Ct([]);const o=this.parseGeometryCollectionText_();return new Ct(o)}const i=lg[t];if(!i)throw new Error("Invalid geometry type: "+t);let s;if(n)t=="POINT"?s=[NaN,NaN]:s=[];else switch(t){case"POINT":{s=this.parsePointText_();break}case"LINESTRING":{s=this.parseLineStringText_();break}case"POLYGON":{s=this.parsePolygonText_();break}case"MULTIPOINT":{s=this.parseMultiPointText_();break}case"MULTILINESTRING":{s=this.parseMultiLineStringText_();break}case"MULTIPOLYGON":{s=this.parseMultiPolygonText_();break}}return new i(s,this.layout_)}throw new Error(this.formatErrorMessage_())}}class dg extends bs{constructor(e){super(),e=e||{},this.splitCollection_=e.splitCollection!==void 0?e.splitCollection:!1}parse_(e){const t=new hg(e);return new fg(t).parse()}readFeatureFromText(e,t){const n=this.readGeometryFromText(e,t),i=new qe;return i.setGeometry(n),i}readFeaturesFromText(e,t){let n=[];const i=this.readGeometryFromText(e,t);this.splitCollection_&&i.getType()=="GeometryCollection"?n=i.getGeometriesArray():n=[i];const s=[];for(let o=0,a=n.length;o<a;++o){const l=new qe;l.setGeometry(n[o]),s.push(l)}return s}readGeometryFromText(e,t){const n=this.parse_(e);return Oe(n,!1,t)}writeFeatureText(e,t){const n=e.getGeometry();return n?this.writeGeometryText(n,t):""}writeFeaturesText(e,t){if(e.length==1)return this.writeFeatureText(e[0],t);const n=[];for(let s=0,o=e.length;s<o;++s)n.push(e[s].getGeometry());const i=new Ct(n);return this.writeGeometryText(i,t)}writeGeometryText(e,t){return Ec(Oe(e,!0,t))}}function _c(r){const e=r.getCoordinates();return e.length===0?"":e.join(" ")}function pg(r){const e=[],t=r.getPoints();for(let n=0,i=t.length;n<i;++n)e.push("("+_c(t[n])+")");return e.join(",")}function gg(r){const e=[],t=r.getGeometries();for(let n=0,i=t.length;n<i;++n)e.push(Ec(t[n]));return e.join(",")}function Fs(r){const e=r.getCoordinates(),t=[];for(let n=0,i=e.length;n<i;++n)t.push(e[n].join(" "));return t.join(",")}function mg(r){const e=[],t=r.getLineStrings();for(let n=0,i=t.length;n<i;++n)e.push("("+Fs(t[n])+")");return e.join(",")}function xc(r){const e=[],t=r.getLinearRings();for(let n=0,i=t.length;n<i;++n)e.push("("+Fs(t[n])+")");return e.join(",")}function yg(r){const e=[],t=r.getPolygons();for(let n=0,i=t.length;n<i;++n)e.push("("+xc(t[n])+")");return e.join(",")}function _g(r){const e=r.getLayout();let t="";return(e==="XYZ"||e==="XYZM")&&(t+=mc),(e==="XYM"||e==="XYZM")&&(t+=yc),t}const xg={Point:_c,LineString:Fs,Polygon:xc,MultiPoint:pg,MultiLineString:mg,MultiPolygon:yg,GeometryCollection:gg};function Ec(r){const e=r.getType(),t=xg[e],n=t(r);let i=ug[e];if(typeof r.getFlatCoordinates=="function"){const s=_g(r);s.length>0&&(i+=" "+s)}return n.length===0?i+" "+gc:i+"("+n+")"}const Eg=dg,Fe=[null,"http://www.opengis.net/wms"],wg=$(Fe,{Service:R($g),Capability:R(Bg)}),Tg=$(Fe,{Request:R(Yg),Exception:R(Wg),Layer:R(Hg)});class vg extends Ps{constructor(){super(),this.version=void 0}readFromNode(e){this.version=e.getAttribute("version").trim();const t=G({version:this.version},wg,e,[]);return t||null}}const Sg=$(Fe,{Name:R(D),Title:R(D),Abstract:R(D),KeywordList:R(Sc),OnlineResource:R(Tr),ContactInformation:R(jg),Fees:R(D),AccessConstraints:R(D),LayerLimit:R(Re),MaxWidth:R(Re),MaxHeight:R(Re)}),Rg=$(Fe,{ContactPersonPrimary:R(Vg),ContactPosition:R(D),ContactAddress:R(Zg),ContactVoiceTelephone:R(D),ContactFacsimileTelephone:R(D),ContactElectronicMailAddress:R(D)}),bg=$(Fe,{ContactPerson:R(D),ContactOrganization:R(D)}),Pg=$(Fe,{AddressType:R(D),Address:R(D),City:R(D),StateOrProvince:R(D),PostCode:R(D),Country:R(D)}),Ag=$(Fe,{Format:W(D)}),wc=$(Fe,{Name:R(D),Title:R(D),Abstract:R(D),KeywordList:R(Sc),CRS:Ee(D),EX_GeographicBoundingBox:R(zg),BoundingBox:Ee(kg),Dimension:Ee(Xg),Attribution:R(Ug),AuthorityURL:Ee(Qg),Identifier:Ee(D),MetadataURL:Ee(Jg),DataURL:Ee(vt),FeatureListURL:Ee(vt),Style:Ee(em),MinScaleDenominator:R(De),MaxScaleDenominator:R(De),Layer:Ee(Tc)}),Lg=$(Fe,{Title:R(D),OnlineResource:R(Tr),LogoURL:R(vc)}),Ig=$(Fe,{westBoundLongitude:R(De),eastBoundLongitude:R(De),southBoundLatitude:R(De),northBoundLatitude:R(De)}),Cg=$(Fe,{GetCapabilities:R(Ei),GetMap:R(Ei),GetFeatureInfo:R(Ei)}),Og=$(Fe,{Format:Ee(D),DCPType:Ee(qg)}),Mg=$(Fe,{HTTP:R(Kg)}),Fg=$(Fe,{Get:R(vt),Post:R(vt)}),Ng=$(Fe,{Name:R(D),Title:R(D),Abstract:R(D),LegendURL:Ee(vc),StyleSheetURL:R(vt),StyleURL:R(vt)}),Dg=$(Fe,{Format:R(D),OnlineResource:R(Tr)}),Gg=$(Fe,{Keyword:W(D)});function Ug(r,e){return G({},Lg,r,e)}function kg(r,e){const t=[bt(r.getAttribute("minx")),bt(r.getAttribute("miny")),bt(r.getAttribute("maxx")),bt(r.getAttribute("maxy"))],n=[bt(r.getAttribute("resx")),bt(r.getAttribute("resy"))];return{crs:r.getAttribute("CRS"),extent:t,res:n}}function zg(r,e){const t=G({},Ig,r,e);if(!t)return;const n=t.westBoundLongitude,i=t.southBoundLatitude,s=t.eastBoundLongitude,o=t.northBoundLatitude;if(!(n===void 0||i===void 0||s===void 0||o===void 0))return[n,i,s,o]}function Bg(r,e){return G({},Tg,r,e)}function $g(r,e){return G({},Sg,r,e)}function jg(r,e){return G({},Rg,r,e)}function Vg(r,e){return G({},bg,r,e)}function Zg(r,e){return G({},Pg,r,e)}function Wg(r,e){return G([],Ag,r,e)}function Hg(r,e){const t=G({},wc,r,e);return t.Layer===void 0?Object.assign(t,Tc(r,e)):t}function Tc(r,e){const t=e[e.length-1],n=G({},wc,r,e);if(!n)return;let i=hr(r.getAttribute("queryable"));i===void 0&&(i=t.queryable),n.queryable=i!==void 0?i:!1;let s=Pt(r.getAttribute("cascaded"));s===void 0&&(s=t.cascaded),n.cascaded=s;let o=hr(r.getAttribute("opaque"));o===void 0&&(o=t.opaque),n.opaque=o!==void 0?o:!1;let a=hr(r.getAttribute("noSubsets"));a===void 0&&(a=t.noSubsets),n.noSubsets=a!==void 0?a:!1;let l=bt(r.getAttribute("fixedWidth"));l||(l=t.fixedWidth),n.fixedWidth=l;let c=bt(r.getAttribute("fixedHeight"));return c||(c=t.fixedHeight),n.fixedHeight=c,["Style","CRS","AuthorityURL"].forEach(function(d){if(d in t){const g=n[d]||[];n[d]=g.concat(t[d])}}),["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"].forEach(function(d){if(!(d in n)){const g=t[d];n[d]=g}}),n}function Xg(r,e){return{name:r.getAttribute("name"),units:r.getAttribute("units"),unitSymbol:r.getAttribute("unitSymbol"),default:r.getAttribute("default"),multipleValues:hr(r.getAttribute("multipleValues")),nearestValue:hr(r.getAttribute("nearestValue")),current:hr(r.getAttribute("current")),values:D(r)}}function vt(r,e){return G({},Dg,r,e)}function Yg(r,e){return G({},Cg,r,e)}function qg(r,e){return G({},Mg,r,e)}function Kg(r,e){return G({},Fg,r,e)}function Ei(r,e){return G({},Og,r,e)}function vc(r,e){const t=vt(r,e);if(t){const n=[Pt(r.getAttribute("width")),Pt(r.getAttribute("height"))];return t.size=n,t}}function Qg(r,e){const t=vt(r,e);if(t)return t.name=r.getAttribute("name"),t}function Jg(r,e){const t=vt(r,e);if(t)return t.type=r.getAttribute("type"),t}function em(r,e){return G({},Ng,r,e)}function Sc(r,e){return G([],Gg,r,e)}const tm=vg,rm="_feature",nm="_layer";class im extends Kn{constructor(e){super(),e=e||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new wr,this.layers_=e.layers?e.layers:null}getLayers(){return this.layers_}setLayers(e){this.layers_=e}readFeatures_(e,t){e.setAttribute("namespaceURI",this.featureNS_);const n=e.localName;let i=[];if(e.childNodes.length===0)return i;if(n=="msGMLOutput")for(let s=0,o=e.childNodes.length;s<o;s++){const a=e.childNodes[s];if(a.nodeType!==Node.ELEMENT_NODE)continue;const l=a,c=t[0],h=nm,f=l.localName.replace(h,"");if(this.layers_&&!this.layers_.includes(f))continue;const d=f+rm;c.featureType=d,c.featureNS=this.featureNS_;const g={};g[d]=W(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const m=$([c.featureNS,null],g);l.setAttribute("namespaceURI",this.featureNS_);const _=G([],m,l,t,this.gmlFormat_);_&&Cn(i,_)}if(n=="FeatureCollection"){const s=G([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_);s&&(i=s)}return i}readFeaturesFromNode(e,t){const n={};return t&&Object.assign(n,this.getReadOptions(e,t)),this.readFeatures_(e,[n])}}const sm=im,mt=[null,"http://www.opengis.net/wmts/1.0"],Sr=[null,"http://www.opengis.net/ows/1.1"],om=$(mt,{Contents:R(ym)});class am extends Ps{constructor(){super(),this.owsParser_=new uc}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let n=this.owsParser_.readFromNode(e);return n?(n.version=t,n=G(n,om,e,[]),n||null):null}}const lm=$(mt,{Layer:Ee(_m),TileMatrixSet:Ee(xm)}),cm=$(mt,{Style:Ee(Em),Format:Ee(D),TileMatrixSetLink:Ee(wm),Dimension:Ee(Tm),ResourceURL:Ee(vm)},$(Sr,{Title:R(D),Abstract:R(D),WGS84BoundingBox:R(bc),BoundingBox:Ee(Sm),Identifier:R(D)})),um=$(mt,{LegendURL:Ee(Rm)},$(Sr,{Title:R(D),Identifier:R(D)})),hm=$(mt,{TileMatrixSet:R(D),TileMatrixSetLimits:R(Pm)}),fm=$(mt,{TileMatrixLimits:W(Am)}),dm=$(mt,{TileMatrix:R(D),MinTileRow:R(Re),MaxTileRow:R(Re),MinTileCol:R(Re),MaxTileCol:R(Re)}),pm=$(mt,{Default:R(D),Value:Ee(D)},$(Sr,{Identifier:R(D)})),Rc=$(Sr,{LowerCorner:W(Zi),UpperCorner:W(Zi)}),gm=$(mt,{WellKnownScaleSet:R(D),TileMatrix:Ee(bm)},$(Sr,{SupportedCRS:R(D),Identifier:R(D),BoundingBox:R(bc)})),mm=$(mt,{TopLeftCorner:R(Zi),ScaleDenominator:R(De),TileWidth:R(Re),TileHeight:R(Re),MatrixWidth:R(Re),MatrixHeight:R(Re)},$(Sr,{Identifier:R(D)}));function ym(r,e){return G({},lm,r,e)}function _m(r,e){return G({},cm,r,e)}function xm(r,e){return G({},gm,r,e)}function Em(r,e){const t=G({},um,r,e);if(!t)return;const n=r.getAttribute("isDefault")==="true";return t.isDefault=n,t}function wm(r,e){return G({},hm,r,e)}function Tm(r,e){return G({},pm,r,e)}function vm(r,e){const t=r.getAttribute("format"),n=r.getAttribute("template"),i=r.getAttribute("resourceType"),s={};return t&&(s.format=t),n&&(s.template=n),i&&(s.resourceType=i),s}function bc(r,e){const t=G([],Rc,r,e);if(t.length==2)return cs(t)}function Sm(r,e){const t=r.getAttribute("crs"),n=G([],Rc,r,e);if(n.length==2)return{extent:cs(n),crs:t}}function Rm(r,e){const t={};return t.format=r.getAttribute("format"),t.href=Tr(r),t}function Zi(r,e){const t=D(r).split(/\s+/);if(!t||t.length!=2)return;const n=+t[0],i=+t[1];if(!(isNaN(n)||isNaN(i)))return[n,i]}function bm(r,e){return G({},mm,r,e)}function Pm(r,e){return G([],fm,r,e)}function Am(r,e){return G({},dm,r,e)}const Pc=am,Lm=Object.freeze(Object.defineProperty({__proto__:null,EsriJSON:$f,GML:Xf,GPX:Fd,GeoJSON:kl,IGC:Bd,IIIFInfo:Xd,KML:yh,MVT:zl,OWS:uc,Polyline:Dp,TopoJSON:_h,WFS:rg,WKB:ag,WKT:Eg,WMSCapabilities:tm,WMSGetFeatureInfo:sm,WMTSCapabilities:Pc},Symbol.toStringTag,{value:"Module"}));function Im(r){if(!(r.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const e=r.inversePixelTransform[0],t=r.inversePixelTransform[1],n=Math.sqrt(e*e+t*t),i=r.frameState,s=Bl(r.inversePixelTransform.slice(),i.coordinateToPixelTransform),o=xh(i.viewState.resolution,n);let a;return new Eh(r.context,n,i.extent,s,i.viewState.rotation,o,a)}function Ac(r,e,t){const n=[];let i=r(0),s=r(1),o=e(i),a=e(s);const l=[s,i],c=[a,o],h=[1,0],f={};let d=1e5,g,m,_,x,w,E;for(;--d>0&&h.length>0;)_=h.pop(),i=l.pop(),o=c.pop(),E=_.toString(),E in f||(n.push(o[0],o[1]),f[E]=!0),x=h.pop(),s=l.pop(),a=c.pop(),w=(_+x)/2,g=r(w),m=e(g),wh(m[0],m[1],o[0],o[1],a[0],a[1])<t?(n.push(a[0],a[1]),E=x.toString(),f[E]=!0):(h.push(x,w,w,_),c.push(a,m,m,o),l.push(s,g,g,i));return n}function Cm(r,e,t,n,i){const s=ye("EPSG:4326");return Ac(function(o){return[r,e+(t-e)*o]},Nn(s,n),i)}function Om(r,e,t,n,i){const s=ye("EPSG:4326");return Ac(function(o){return[e+(t-e)*o,r]},Nn(s,n),i)}const Mm=new Qr({color:"rgba(0,0,0,0.2)"}),Fm=[90,45,30,20,10,5,2,1,30/60,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600];class Nm extends us{constructor(e){e=e||{};const t=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},e);delete t.maxLines,delete t.strokeStyle,delete t.targetSize,delete t.showLabels,delete t.lonLabelFormatter,delete t.latLabelFormatter,delete t.lonLabelPosition,delete t.latLabelPosition,delete t.lonLabelStyle,delete t.latLabelStyle,delete t.intervals,super(t),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=e.targetSize!==void 0?e.targetSize:100,this.maxLines_=e.maxLines!==void 0?e.maxLines:100,this.meridians_=[],this.parallels_=[],this.strokeStyle_=e.strokeStyle!==void 0?e.strokeStyle:Mm,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,e.showLabels&&(this.lonLabelFormatter_=e.lonLabelFormatter==null?Eo.bind(this,"EW"):e.lonLabelFormatter,this.latLabelFormatter_=e.latLabelFormatter==null?Eo.bind(this,"NS"):e.latLabelFormatter,this.lonLabelPosition_=e.lonLabelPosition==null?0:e.lonLabelPosition,this.latLabelPosition_=e.latLabelPosition==null?1:e.latLabelPosition,this.lonLabelStyleBase_=new Xr({text:e.lonLabelStyle!==void 0?e.lonLabelStyle.clone():new wo({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new ki({color:"rgba(0,0,0,1)"}),stroke:new Qr({color:"rgba(255,255,255,1)",width:3})})}),this.lonLabelStyle_=n=>{const i=n.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(i),this.lonLabelStyleBase_},this.latLabelStyleBase_=new Xr({text:e.latLabelStyle!==void 0?e.latLabelStyle.clone():new wo({font:"12px Calibri,sans-serif",textAlign:"right",fill:new ki({color:"rgba(0,0,0,1)"}),stroke:new Qr({color:"rgba(255,255,255,1)",width:3})})}),this.latLabelStyle_=n=>{const i=n.get("graticule_label");return this.latLabelStyleBase_.getText().setText(i),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(zt.POSTRENDER,this.drawLabels_.bind(this))),this.intervals_=e.intervals!==void 0?e.intervals:Fm,this.setSource(new Jn({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new Th,overlaps:!1,useSpatialIndex:!1,wrapX:e.wrapX})),this.featurePool_=[],this.lineStyle_=new Xr({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(e,t){let n=e.slice();return this.projection_&&this.getSource().getWrapX()&&vh(n,this.projection_),this.loadedExtent_&&(Sh(this.loadedExtent_,n,t)?n=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[n]}loaderFunction(e,t,n){this.loadedExtent_=e;const i=this.getSource(),s=this.getExtent()||[-1/0,-1/0,1/0,1/0],o=ht(s,e);if(this.renderedExtent_&&Dn(this.renderedExtent_,o)&&this.renderedResolution_===t||(this.renderedExtent_=o,this.renderedResolution_=t,hs(o)))return;const a=Lt(o),l=t*t/4;(!this.projection_||!Ir(this.projection_,n))&&this.updateProjectionInfo_(n),this.createGraticule_(o,a,t,l);let h=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(h+=this.meridians_.length),this.parallelsLabels_&&(h+=this.parallels_.length);let f;for(;h>this.featurePool_.length;)f=new qe,this.featurePool_.push(f);const d=i.getFeaturesCollection();d.clear();let g=0,m,_;for(m=0,_=this.meridians_.length;m<_;++m)f=this.featurePool_[g++],f.setGeometry(this.meridians_[m]),f.setStyle(this.lineStyle_),d.push(f);for(m=0,_=this.parallels_.length;m<_;++m)f=this.featurePool_[g++],f.setGeometry(this.parallels_[m]),f.setStyle(this.lineStyle_),d.push(f)}addMeridian_(e,t,n,i,s,o){const a=this.getMeridian_(e,t,n,i,o);if(dr(a.getExtent(),s)){if(this.meridiansLabels_){const l=this.lonLabelFormatter_(e);o in this.meridiansLabels_?this.meridiansLabels_[o].text=l:this.meridiansLabels_[o]={geom:new nt([]),text:l}}this.meridians_[o++]=a}return o}addParallel_(e,t,n,i,s,o){const a=this.getParallel_(e,t,n,i,o);if(dr(a.getExtent(),s)){if(this.parallelsLabels_){const l=this.latLabelFormatter_(e);o in this.parallelsLabels_?this.parallelsLabels_[o].text=l:this.parallelsLabels_[o]={geom:new nt([]),text:l}}this.parallels_[o++]=a}return o}drawLabels_(e){const t=e.frameState.viewState.rotation,n=e.frameState.viewState.resolution,i=e.frameState.size,s=e.frameState.extent,o=Lt(s);let a=s;if(t){const m=i[0]*n,_=i[1]*n;a=[o[0]-m/2,o[1]-_/2,o[0]+m/2,o[1]+_/2]}let l=0,c=0,h=this.latLabelPosition_<.5;const f=this.projection_.getExtent(),d=Xe(f);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!Ln(f,s)){l=Math.floor((s[0]-f[0])/d),c=Math.ceil((s[2]-f[2])/d);const m=Math.abs(t)>Math.PI/2;h=h!==m}const g=Im(e);for(let m=l;m<=c;++m){let _=this.meridians_.length+this.parallels_.length,x,w,E,v;if(this.meridiansLabels_)for(w=0,E=this.meridiansLabels_.length;w<E;++w){const S=this.meridians_[w];if(!t&&m===0)v=this.getMeridianPoint_(S,s,w);else{const A=S.clone();A.translate(m*d,0),A.rotate(-t,o),v=this.getMeridianPoint_(A,a,w),v.rotate(t,o)}x=this.featurePool_[_++],x.setGeometry(v),x.set("graticule_label",this.meridiansLabels_[w].text),g.drawFeature(x,this.lonLabelStyle_(x))}if(this.parallelsLabels_&&(m===l&&h||m===c&&!h))for(w=0,E=this.parallels_.length;w<E;++w){const S=this.parallels_[w];if(!t&&m===0)v=this.getParallelPoint_(S,s,w);else{const A=S.clone();A.translate(m*d,0),A.rotate(-t,o),v=this.getParallelPoint_(A,a,w),v.rotate(t,o)}x=this.featurePool_[_++],x.setGeometry(v),x.set("graticule_label",this.parallelsLabels_[w].text),g.drawFeature(x,this.latLabelStyle_(x))}}}createGraticule_(e,t,n,i){const s=this.getInterval_(n);if(s==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}let o=!1;const a=this.projection_.getExtent(),l=Xe(a);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!Ln(a,e)&&(Xe(e)>=l?(e[0]=a[0],e[2]=a[2]):o=!0);const c=[ve(t[0],this.minX_,this.maxX_),ve(t[1],this.minY_,this.maxY_)],h=this.toLonLatTransform_(c);isNaN(h[1])&&(h[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let f=ve(h[0],this.minLon_,this.maxLon_),d=ve(h[1],this.minLat_,this.maxLat_);const g=this.maxLines_;let m,_,x,w,E=e;o||(E=[ve(e[0],this.minX_,this.maxX_),ve(e[1],this.minY_,this.maxY_),ve(e[2],this.minX_,this.maxX_),ve(e[3],this.minY_,this.maxY_)]);const v=Jr(E,this.toLonLatTransform_,void 0,8);let S=v[3],A=v[2],O=v[1],I=v[0];if(o||(ar(E,this.bottomLeft_)&&(I=this.minLon_,O=this.minLat_),ar(E,this.bottomRight_)&&(A=this.maxLon_,O=this.minLat_),ar(E,this.topLeft_)&&(I=this.minLon_,S=this.maxLat_),ar(E,this.topRight_)&&(A=this.maxLon_,S=this.maxLat_),S=ve(S,d,this.maxLat_),A=ve(A,f,this.maxLon_),O=ve(O,this.minLat_,d),I=ve(I,this.minLon_,f)),f=Math.floor(f/s)*s,w=ve(f,this.minLon_,this.maxLon_),_=this.addMeridian_(w,O,S,i,e,0),m=0,o)for(;(w-=s)>=I&&m++<g;)_=this.addMeridian_(w,O,S,i,e,_);else for(;w!=this.minLon_&&m++<g;)w=Math.max(w-s,this.minLon_),_=this.addMeridian_(w,O,S,i,e,_);if(w=ve(f,this.minLon_,this.maxLon_),m=0,o)for(;(w+=s)<=A&&m++<g;)_=this.addMeridian_(w,O,S,i,e,_);else for(;w!=this.maxLon_&&m++<g;)w=Math.min(w+s,this.maxLon_),_=this.addMeridian_(w,O,S,i,e,_);for(this.meridians_.length=_,this.meridiansLabels_&&(this.meridiansLabels_.length=_),d=Math.floor(d/s)*s,x=ve(d,this.minLat_,this.maxLat_),_=this.addParallel_(x,I,A,i,e,0),m=0;x!=this.minLat_&&m++<g;)x=Math.max(x-s,this.minLat_),_=this.addParallel_(x,I,A,i,e,_);for(x=ve(d,this.minLat_,this.maxLat_),m=0;x!=this.maxLat_&&m++<g;)x=Math.min(x+s,this.maxLat_),_=this.addParallel_(x,I,A,i,e,_);this.parallels_.length=_,this.parallelsLabels_&&(this.parallelsLabels_.length=_)}getInterval_(e){const t=this.projectionCenterLonLat_[0],n=this.projectionCenterLonLat_[1];let i=-1;const s=Math.pow(this.targetSize_*e,2),o=[],a=[];for(let l=0,c=this.intervals_.length;l<c;++l){const h=ve(this.intervals_[l]/2,0,90),f=ve(n,-90+h,90-h);if(o[0]=t-h,o[1]=f-h,a[0]=t+h,a[1]=f+h,this.fromLonLatTransform_(o,o),this.fromLonLatTransform_(a,a),Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2)<=s)break;i=this.intervals_[l]}return i}getMeridian_(e,t,n,i,s){const o=Cm(e,t,n,this.projection_,i);let a=this.meridians_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):(a=new pt(o,"XY"),this.meridians_[s]=a),a}getMeridianPoint_(e,t,n){const i=e.getFlatCoordinates();let s=1,o=i.length-1;i[s]>i[o]&&(s=o,o=1);const a=Math.max(t[1],i[s]),l=Math.min(t[3],i[o]),c=ve(t[1]+Math.abs(t[1]-t[3])*this.lonLabelPosition_,a,l),f=[i[s-1]+(i[o-1]-i[s-1])*(c-i[s])/(i[o]-i[s]),c],d=this.meridiansLabels_[n].geom;return d.setCoordinates(f),d}getMeridians(){return this.meridians_}getParallel_(e,t,n,i,s){const o=Om(e,t,n,this.projection_,i);let a=this.parallels_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):a=new pt(o,"XY"),a}getParallelPoint_(e,t,n){const i=e.getFlatCoordinates();let s=0,o=i.length-2;i[s]>i[o]&&(s=o,o=0);const a=Math.max(t[0],i[s]),l=Math.min(t[2],i[o]),c=ve(t[0]+Math.abs(t[0]-t[2])*this.latLabelPosition_,a,l),h=i[s+1]+(i[o+1]-i[s+1])*(c-i[s])/(i[o]-i[s]),f=[c,h],d=this.parallelsLabels_[n].geom;return d.setCoordinates(f),d}getParallels(){return this.parallels_}updateProjectionInfo_(e){const t=ye("EPSG:4326"),n=e.getWorldExtent();this.maxLat_=n[3],this.maxLon_=n[2],this.minLat_=n[1],this.minLon_=n[0];const i=Nn(e,t);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=i;else{const o=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(a,l,c){c=c||2;const h=i(a,l,c);for(let f=0,d=h.length;f<d;f+=c)h[f]<o&&(h[f]+=360);return h}}this.fromLonLatTransform_=Nn(t,e);const s=Jr([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=s[0],this.maxX_=s[2],this.minY_=s[1],this.maxY_=s[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(Lt(e.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=e}}const Dm=Nm,li=34962,ci=34963,Gm=35040,Ns=35044,Wi=35048,Um=5121,km=5123,zm=5125,Lc=5126,ta=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function Bm(r,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!Rh},e);const t=ta.length;for(let n=0;n<t;++n)try{const i=r.getContext(ta[n],e);if(i)return i}catch{}return null}const $m={STATIC_DRAW:Ns,STREAM_DRAW:Gm,DYNAMIC_DRAW:Wi};class jm{constructor(e,t){this.array_=null,this.type_=e,gt(e===li||e===ci,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=t!==void 0?t:$m.STATIC_DRAW}ofSize(e){return this.array_=new(wi(this.type_))(e),this}fromArray(e){return this.array_=wi(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(wi(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function wi(r){switch(r){case li:return Float32Array;case ci:return Uint32Array;default:return Float32Array}}const jn=jm,Tn={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},Vm=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,Zm=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class Wm{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer(),this.depthBuffer_=t.createRenderbuffer();const n=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,e.vertexShader||Vm),t.compileShader(n);const i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(i,e.fragmentShader||Zm),t.compileShader(i),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,n),t.attachShader(this.renderTargetProgram_,i),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(o=>{this.uniforms_.push({value:e.uniforms[o],location:t.getUniformLocation(this.renderTargetProgram_,o)})})}getGL(){return this.gl_}init(e){const t=this.getGL(),n=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.getDepthBuffer()),t.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;const i=0,s=t.RGBA,o=0,a=t.RGBA,l=t.UNSIGNED_BYTE,c=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,i,s,n[0],n[1],o,a,l,c),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,n[0],n[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer_)}}apply(e,t,n,i){const s=this.getGL(),o=e.size;if(s.bindFramebuffer(s.FRAMEBUFFER,t?t.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!t){const l=Ae(s.canvas);if(!e.renderTargets[l]){const c=s.getContextAttributes();c&&c.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),e.renderTargets[l]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const a=e.layerStatesArray[e.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(e),n&&n(s,e),s.drawArrays(s.TRIANGLES,0,6),i&&i(s,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const t=this.getGL();let n,i=1;this.uniforms_.forEach(function(s){if(n=typeof s.value=="function"?s.value(e):s.value,n instanceof HTMLCanvasElement||n instanceof ImageData)s.texture||(s.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${i}`]),t.bindTexture(t.TEXTURE_2D,s.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,n.width,n.height,0,t.UNSIGNED_BYTE,new Uint8Array(n.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.uniform1i(s.location,i++);else if(Array.isArray(n))switch(n.length){case 2:t.uniform2f(s.location,n[0],n[1]);return;case 3:t.uniform3f(s.location,n[0],n[1],n[2]);return;case 4:t.uniform4f(s.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&t.uniform1f(s.location,n)})}}const ra=Wm;function Ic(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Cc(r,e){return r[0]=e[0],r[1]=e[1],r[4]=e[2],r[5]=e[3],r[12]=e[4],r[13]=e[5],r}const _t={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},ct={UNSIGNED_BYTE:Um,UNSIGNED_SHORT:km,UNSIGNED_INT:zm,FLOAT:Lc},Vn={};function na(r){return"shared/"+r}let ia=0;function Hm(){const r="unique/"+ia;return ia+=1,r}function Xm(r){let e=Vn[r];if(!e){const t=document.createElement("canvas");t.width=1,t.height=1,t.style.position="absolute",t.style.left="0",e={users:0,context:Bm(t)},Vn[r]=e}return e.users+=1,e.context}function Ym(r){const e=Vn[r];if(!e||(e.users-=1,e.users>0))return;const t=e.context,n=t.getExtension("WEBGL_lose_context");n&&n.loseContext();const i=t.canvas;i.width=1,i.height=1,delete Vn[r]}class qm extends $l{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?na(e.canvasCacheKey):Hm(),this.gl_=Xm(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const t=this.gl_.canvas;t.addEventListener(Tn.LOST,this.boundHandleWebGLContextLost_),t.addEventListener(Tn.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=it(),this.offsetScaleMatrix_=it(),this.tmpMat4_=Ic(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(n=>new ra({webGlContext:this.gl_,scaleRatio:n.scaleRatio,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms})):[new ra({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===na(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}bindBuffer(e){const t=this.gl_,n=Ae(e);let i=this.bufferCache_[n];if(!i){const s=t.createBuffer();i={buffer:e,webGlBuffer:s},this.bufferCache_[n]=i}t.bindBuffer(e.getType(),i.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=this.gl_,n=Ae(e),i=this.bufferCache_[n];i&&!t.isContextLost()&&t.deleteBuffer(i.webGlBuffer),delete this.bufferCache_[n]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(Tn.LOST,this.boundHandleWebGLContextLost_),e.removeEventListener(Tn.RESTORED,this.boundHandleWebGLContextRestored_),Ym(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,t,n){const i=this.gl_,s=this.getCanvas(),o=e.size,a=e.pixelRatio;(s.width!==o[0]*a||s.height!==o[1]*a)&&(s.width=o[0]*a,s.height=o[1]*a,s.style.width=o[0]+"px",s.style.height=o[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(e);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.depthRange(0,1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,t?i.ZERO:i.ONE_MINUS_SRC_ALPHA),n?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST)}bindTexture(e,t,n){const i=this.gl_;i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,e),i.uniform1i(this.getUniformLocation(n),t)}prepareDrawToRenderTarget(e,t,n,i){const s=this.gl_,o=t.getSize();s.bindFramebuffer(s.FRAMEBUFFER,t.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,t.getDepthbuffer()),s.viewport(0,0,o[0],o[1]),s.bindTexture(s.TEXTURE_2D,t.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,n?s.ZERO:s.ONE_MINUS_SRC_ALPHA),i?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(e,t){const n=this.gl_;this.getExtension("OES_element_index_uint");const i=n.UNSIGNED_INT,s=4,o=t-e,a=e*s;n.drawElements(n.TRIANGLES,o,i,a)}finalizeDraw(e,t,n){for(let i=0,s=this.postProcessPasses_.length;i<s;i++)i===s-1?this.postProcessPasses_[i].apply(e,null,t,n):this.postProcessPasses_[i].apply(e,this.postProcessPasses_[i+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const t=e.size,n=e.viewState.rotation,i=e.pixelRatio;this.setUniformFloatValue(_t.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(_t.ZOOM,e.viewState.zoom),this.setUniformFloatValue(_t.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(_t.PIXEL_RATIO,i),this.setUniformFloatVec2(_t.VIEWPORT_SIZE_PX,[t[0],t[1]]),this.setUniformFloatValue(_t.ROTATION,n)}applyHitDetectionUniform(e){const t=this.getUniformLocation(_t.HIT_DETECTION);this.getGL().uniform1i(t,e?1:0),e&&this.setUniformFloatValue(_t.PIXEL_RATIO,.5)}applyUniforms(e){const t=this.gl_;let n,i=0;this.uniforms_.forEach(s=>{if(n=typeof s.value=="function"?s.value(e):s.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData||n instanceof WebGLTexture){n instanceof WebGLTexture&&!s.texture?(s.prevValue=void 0,s.texture=n):s.texture||(s.prevValue=void 0,s.texture=t.createTexture()),this.bindTexture(s.texture,i,s.name),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const o=!(n instanceof HTMLImageElement)||n.complete;!(n instanceof WebGLTexture)&&o&&s.prevValue!==n&&(s.prevValue=n,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),i++}else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(s.name,Cc(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:t.uniform2f(this.getUniformLocation(s.name),n[0],n[1]);return;case 3:t.uniform3f(this.getUniformLocation(s.name),n[0],n[1],n[2]);return;case 4:t.uniform4f(this.getUniformLocation(s.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&t.uniform1f(this.getUniformLocation(s.name),n)})}useProgram(e,t){this.gl_.useProgram(e),this.currentProgram_=e,this.applyFrameState(t),this.applyUniforms(t)}compileShader(e,t){const n=this.gl_,i=n.createShader(t);return n.shaderSource(i,e),n.compileShader(i),i}getProgram(e,t){const n=this.gl_,i=this.compileShader(e,n.FRAGMENT_SHADER),s=this.compileShader(t,n.VERTEX_SHADER),o=n.createProgram();if(n.attachShader(o,i),n.attachShader(o,s),n.linkProgram(o),!n.getShaderParameter(i,n.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${n.getShaderInfoLog(i)}`;throw new Error(a)}if(n.deleteShader(i),!n.getShaderParameter(s,n.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${n.getShaderInfoLog(s)}`;throw new Error(a)}if(n.deleteShader(s),!n.getProgramParameter(o,n.LINK_STATUS)){const a=`GL program linking failed: ${n.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(e){const t=Ae(this.currentProgram_);return this.uniformLocationsByProgram_[t]===void 0&&(this.uniformLocationsByProgram_[t]={}),this.uniformLocationsByProgram_[t][e]===void 0&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=Ae(this.currentProgram_);return this.attribLocationsByProgram_[t]===void 0&&(this.attribLocationsByProgram_[t]={}),this.attribLocationsByProgram_[t][e]===void 0&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const n=e.size,i=e.viewState.rotation,s=e.viewState.resolution,o=e.viewState.center;return fs(t,0,0,2/(s*n[0]),2/(s*n[1]),-i,-o[0],-o[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}enableAttributeArray_(e,t,n,i,s){const o=this.getAttributeLocation(e);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,t,n,!1,i,s))}enableAttributes(e){const t=Km(e);let n=0;for(let i=0;i<e.length;i++){const s=e[i];this.enableAttributeArray_(s.name,s.size,s.type||Lc,t,n),n+=s.size*Oc(s.type)}}handleWebGLContextLost(e){bh(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,t,n){const i=this.gl_;n=n||i.createTexture();const s=0,o=i.RGBA,a=0,l=i.RGBA,c=i.UNSIGNED_BYTE;return i.bindTexture(i.TEXTURE_2D,n),t?i.texImage2D(i.TEXTURE_2D,s,o,l,c,t):i.texImage2D(i.TEXTURE_2D,s,o,e[0],e[1],a,l,c,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),n}}function Km(r){let e=0;for(let t=0;t<r.length;t++){const n=r[t];e+=n.size*Oc(n.type)}return e}function Oc(r){switch(r){case ct.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case ct.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case ct.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case ct.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class Ds extends Ph{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=it(),this.pixelContext_=null,this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,e.addChangeListener(jl.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(zt.PRECOMPOSE)){const i=new yi(zt.PRECOMPOSE,void 0,t,e);n.dispatchEvent(i)}}dispatchPostComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(zt.POSTCOMPOSE)){const i=new yi(zt.POSTCOMPOSE,void 0,t,e);n.dispatchEvent(i)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t=!0,n=-1,i;for(let o=0,a=e.layerStatesArray.length;o<a;o++){const l=e.layerStatesArray[o].layer,c=l.getRenderer();if(!(c instanceof Ds)){t=!0;continue}const h=l.getClassName();if((t||h!==i)&&(n+=1,t=!1),i=h,c===this)break}const s="map/"+e.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new qm({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),i&&(this.helper.getCanvas().className=i),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(e,t,n){const i=this.getLayer();if(i.hasListener(e)){fs(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);const s=new yi(e,this.inversePixelTransform_,n,t);i.dispatchEvent(s)}}preRender(e,t){this.dispatchRenderEvent_(zt.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(zt.POSTRENDER,e,t)}}const Mc=Ds,st=new Uint8Array(4);class Qm{constructor(e,t){this.helper_=e;const n=e.getGL();this.texture_=n.createTexture(),this.framebuffer_=n.createFramebuffer(),this.depthbuffer_=n.createRenderbuffer(),this.size_=t||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(e){Ah(e,this.size_)||(this.size_[0]=e[0],this.size_[1]=e[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const e=this.size_,t=this.helper_.getGL();t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.readPixels(0,0,e[0],e[1],t.RGBA,t.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(e,t){if(e<0||t<0||e>this.size_[0]||t>=this.size_[1])return st[0]=0,st[1]=0,st[2]=0,st[3]=0,st;this.readAll();const n=Math.floor(e)+(this.size_[1]-Math.floor(t)-1)*this.size_[0];return st[0]=this.data_[n*4],st[1]=this.data_[n*4+1],st[2]=this.data_[n*4+2],st[3]=this.data_[n*4+3],st}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const e=this.size_,t=this.helper_.getGL();this.texture_=this.helper_.createTexture(e,null,this.texture_),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.viewport(0,0,e[0],e[1]),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture_,0),t.bindRenderbuffer(t.RENDERBUFFER,this.depthbuffer_),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e[0],e[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(e[0]*e[1]*4)}}const Jm=Qm,sa={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};var Fc={exports:{}};Fc.exports=ui;Fc.exports.default=ui;function ui(r,e,t){t=t||2;var n=e&&e.length,i=n?e[0]*t:r.length,s=Nc(r,0,i,t,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,c,h,f,d,g;if(n&&(s=iy(r,e,s,t)),r.length>80*t){a=c=r[0],l=h=r[1];for(var m=t;m<i;m+=t)f=r[m],d=r[m+1],f<a&&(a=f),d<l&&(l=d),f>c&&(c=f),d>h&&(h=d);g=Math.max(c-a,h-l),g=g!==0?32767/g:0}return rn(s,o,t,a,l,g,0),o}function Nc(r,e,t,n,i){var s,o;if(i===Yi(r,e,t,n)>0)for(s=e;s<t;s+=n)o=oa(s,r[s],r[s+1],o);else for(s=t-n;s>=e;s-=n)o=oa(s,r[s],r[s+1],o);return o&&hi(o,o.next)&&(sn(o),o=o.next),o}function Wt(r,e){if(!r)return r;e||(e=r);var t=r,n;do if(n=!1,!t.steiner&&(hi(t,t.next)||Se(t.prev,t,t.next)===0)){if(sn(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function rn(r,e,t,n,i,s,o){if(r){!o&&s&&cy(r,n,i,s);for(var a=r,l,c;r.prev!==r.next;){if(l=r.prev,c=r.next,s?ty(r,n,i,s):ey(r)){e.push(l.i/t|0),e.push(r.i/t|0),e.push(c.i/t|0),sn(r),r=c.next,a=c.next;continue}if(r=c,r===a){o?o===1?(r=ry(Wt(r),e,t),rn(r,e,t,n,i,s,2)):o===2&&ny(r,e,t,n,i,s):rn(Wt(r),e,t,n,i,s,1);break}}}}function ey(r){var e=r.prev,t=r,n=r.next;if(Se(e,t,n)>=0)return!1;for(var i=e.x,s=t.x,o=n.x,a=e.y,l=t.y,c=n.y,h=i<s?i<o?i:o:s<o?s:o,f=a<l?a<c?a:c:l<c?l:c,d=i>s?i>o?i:o:s>o?s:o,g=a>l?a>c?a:c:l>c?l:c,m=n.next;m!==e;){if(m.x>=h&&m.x<=d&&m.y>=f&&m.y<=g&&lr(i,a,s,l,o,c,m.x,m.y)&&Se(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function ty(r,e,t,n){var i=r.prev,s=r,o=r.next;if(Se(i,s,o)>=0)return!1;for(var a=i.x,l=s.x,c=o.x,h=i.y,f=s.y,d=o.y,g=a<l?a<c?a:c:l<c?l:c,m=h<f?h<d?h:d:f<d?f:d,_=a>l?a>c?a:c:l>c?l:c,x=h>f?h>d?h:d:f>d?f:d,w=Hi(g,m,e,t,n),E=Hi(_,x,e,t,n),v=r.prevZ,S=r.nextZ;v&&v.z>=w&&S&&S.z<=E;){if(v.x>=g&&v.x<=_&&v.y>=m&&v.y<=x&&v!==i&&v!==o&&lr(a,h,l,f,c,d,v.x,v.y)&&Se(v.prev,v,v.next)>=0||(v=v.prevZ,S.x>=g&&S.x<=_&&S.y>=m&&S.y<=x&&S!==i&&S!==o&&lr(a,h,l,f,c,d,S.x,S.y)&&Se(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;v&&v.z>=w;){if(v.x>=g&&v.x<=_&&v.y>=m&&v.y<=x&&v!==i&&v!==o&&lr(a,h,l,f,c,d,v.x,v.y)&&Se(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;S&&S.z<=E;){if(S.x>=g&&S.x<=_&&S.y>=m&&S.y<=x&&S!==i&&S!==o&&lr(a,h,l,f,c,d,S.x,S.y)&&Se(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function ry(r,e,t){var n=r;do{var i=n.prev,s=n.next.next;!hi(i,s)&&Dc(i,n,n.next,s)&&nn(i,s)&&nn(s,i)&&(e.push(i.i/t|0),e.push(n.i/t|0),e.push(s.i/t|0),sn(n),sn(n.next),n=r=s),n=n.next}while(n!==r);return Wt(n)}function ny(r,e,t,n,i,s){var o=r;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&fy(o,a)){var l=Gc(o,a);o=Wt(o,o.next),l=Wt(l,l.next),rn(o,e,t,n,i,s,0),rn(l,e,t,n,i,s,0);return}a=a.next}o=o.next}while(o!==r)}function iy(r,e,t,n){var i=[],s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*n,l=s<o-1?e[s+1]*n:r.length,c=Nc(r,a,l,n,!1),c===c.next&&(c.steiner=!0),i.push(hy(c));for(i.sort(sy),s=0;s<i.length;s++)t=oy(i[s],t);return t}function sy(r,e){return r.x-e.x}function oy(r,e){var t=ay(r,e);if(!t)return e;var n=Gc(t,r);return Wt(n,n.next),Wt(t,t.next)}function ay(r,e){var t=e,n=r.x,i=r.y,s=-1/0,o;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){var a=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(a<=n&&a>s&&(s=a,o=t.x<t.next.x?t:t.next,a===n))return o}t=t.next}while(t!==e);if(!o)return null;var l=o,c=o.x,h=o.y,f=1/0,d;t=o;do n>=t.x&&t.x>=c&&n!==t.x&&lr(i<h?n:s,i,c,h,i<h?s:n,i,t.x,t.y)&&(d=Math.abs(i-t.y)/(n-t.x),nn(t,r)&&(d<f||d===f&&(t.x>o.x||t.x===o.x&&ly(o,t)))&&(o=t,f=d)),t=t.next;while(t!==l);return o}function ly(r,e){return Se(r.prev,r,e.prev)<0&&Se(e.next,r,r.next)<0}function cy(r,e,t,n){var i=r;do i.z===0&&(i.z=Hi(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==r);i.prevZ.nextZ=null,i.prevZ=null,uy(i)}function uy(r){var e,t,n,i,s,o,a,l,c=1;do{for(t=r,r=null,s=null,o=0;t;){for(o++,n=t,a=0,e=0;e<c&&(a++,n=n.nextZ,!!n);e++);for(l=c;a>0||l>0&&n;)a!==0&&(l===0||!n||t.z<=n.z)?(i=t,t=t.nextZ,a--):(i=n,n=n.nextZ,l--),s?s.nextZ=i:r=i,i.prevZ=s,s=i;t=n}s.nextZ=null,c*=2}while(o>1);return r}function Hi(r,e,t,n,i){return r=(r-t)*i|0,e=(e-n)*i|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function hy(r){var e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function lr(r,e,t,n,i,s,o,a){return(i-o)*(e-a)>=(r-o)*(s-a)&&(r-o)*(n-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(i-o)*(n-a)}function fy(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!dy(r,e)&&(nn(r,e)&&nn(e,r)&&py(r,e)&&(Se(r.prev,r,e.prev)||Se(r,e.prev,e))||hi(r,e)&&Se(r.prev,r,r.next)>0&&Se(e.prev,e,e.next)>0)}function Se(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function hi(r,e){return r.x===e.x&&r.y===e.y}function Dc(r,e,t,n){var i=Sn(Se(r,e,t)),s=Sn(Se(r,e,n)),o=Sn(Se(t,n,r)),a=Sn(Se(t,n,e));return!!(i!==s&&o!==a||i===0&&vn(r,t,e)||s===0&&vn(r,n,e)||o===0&&vn(t,r,n)||a===0&&vn(t,e,n))}function vn(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function Sn(r){return r>0?1:r<0?-1:0}function dy(r,e){var t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&Dc(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1}function nn(r,e){return Se(r.prev,r,r.next)<0?Se(r,e,r.next)>=0&&Se(r,r.prev,e)>=0:Se(r,e,r.prev)<0||Se(r,r.next,e)<0}function py(r,e){var t=r,n=!1,i=(r.x+e.x)/2,s=(r.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==r);return n}function Gc(r,e){var t=new Xi(r.i,r.x,r.y),n=new Xi(e.i,e.x,e.y),i=r.next,s=e.prev;return r.next=e,e.prev=r,t.next=i,i.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n}function oa(r,e,t,n){var i=new Xi(r,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function sn(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Xi(r,e,t){this.i=r,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}ui.deviation=function(r,e,t,n){var i=e&&e.length,s=i?e[0]*t:r.length,o=Math.abs(Yi(r,0,s,t));if(i)for(var a=0,l=e.length;a<l;a++){var c=e[a]*t,h=a<l-1?e[a+1]*t:r.length;o-=Math.abs(Yi(r,c,h,t))}var f=0;for(a=0;a<n.length;a+=3){var d=n[a]*t,g=n[a+1]*t,m=n[a+2]*t;f+=Math.abs((r[d]-r[m])*(r[g+1]-r[d+1])-(r[d]-r[g])*(r[m+1]-r[d+1]))}return o===0&&f===0?0:Math.abs((f-o)/o)};function Yi(r,e,t,n){for(var i=0,s=e,o=t-n;s<t;s+=n)i+=(r[o]-r[s])*(r[s+1]+r[o+1]),o=s;return i}ui.flatten=function(r){for(var e=r[0][0].length,t={vertices:[],holes:[],dimensions:e},n=0,i=0;i<r.length;i++){for(var s=0;s<r[i].length;s++)for(var o=0;o<e;o++)t.vertices.push(r[i][s][o]);i>0&&(n+=r[i-1].length,t.holes.push(n))}return t};const aa=.985;function gy(r,e){e=e||[];const t=256,n=t-1;return e[0]=Math.floor(r/t/t/t)/n,e[1]=Math.floor(r/t/t)%t/n,e[2]=Math.floor(r/t)%t/n,e[3]=r%t/n,e}function my(r){let e=0;const t=256,n=t-1;return e+=Math.round(r[0]*t*t*t*n),e+=Math.round(r[1]*t*t*n),e+=Math.round(r[2]*t*n),e+=Math.round(r[3]*n),e}function yy(){const r='const e="GENERATE_POLYGON_BUFFERS",t="GENERATE_POINT_BUFFERS",n="GENERATE_LINE_STRING_BUFFERS";function r(e,t){const n=t[0],r=t[1];return t[0]=e[0]*n+e[2]*r+e[4],t[1]=e[1]*n+e[3]*r+e[5],t}function x(e,t){const n=(r=t)[0]*r[3]-r[1]*r[2];var r;!function(e,t){if(!e)throw new Error(t)}(0!==n,"Transformation matrix cannot be inverted");const x=t[0],i=t[1],u=t[2],o=t[3],f=t[4],s=t[5];return e[0]=o/n,e[1]=-i/n,e[2]=-u/n,e[3]=x/n,e[4]=(u*s-o*f)/n,e[5]=-(x*s-i*f)/n,e}function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}new Array(6);var u={exports:{}};function o(e,t,n){n=n||2;var r,x,i,u,o,s,l,v=t&&t.length,h=v?t[0]*n:e.length,c=f(e,0,h,n,!0),g=[];if(!c||c.next===c.prev)return g;if(v&&(c=function(e,t,n,r){var x,i,u,o=[];for(x=0,i=t.length;x<i;x++)(u=f(e,t[x]*r,x<i-1?t[x+1]*r:e.length,r,!1))===u.next&&(u.steiner=!0),o.push(d(u));for(o.sort(p),x=0;x<o.length;x++)n=y(o[x],n);return n}(e,t,c,n)),e.length>80*n){r=i=e[0],x=u=e[1];for(var b=n;b<h;b+=n)(o=e[b])<r&&(r=o),(s=e[b+1])<x&&(x=s),o>i&&(i=o),s>u&&(u=s);l=0!==(l=Math.max(i-r,u-x))?32767/l:0}return a(c,g,n,r,x,l,0),g}function f(e,t,n,r,x){var i,u;if(x===O(e,t,n,r)>0)for(i=t;i<n;i+=r)u=P(i,e[i],e[i+1],u);else for(i=n-r;i>=t;i-=r)u=P(i,e[i],e[i+1],u);return u&&m(u,u.next)&&(B(u),u=u.next),u}function s(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==w(r.prev,r,r.next))r=r.next;else{if(B(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function a(e,t,n,r,x,i,u){if(e){!u&&i&&function(e,t,n,r){var x=e;do{0===x.z&&(x.z=b(x.x,x.y,t,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==e);x.prevZ.nextZ=null,x.prevZ=null,function(e){var t,n,r,x,i,u,o,f,s=1;do{for(n=e,e=null,i=null,u=0;n;){for(u++,r=n,o=0,t=0;t<s&&(o++,r=r.nextZ);t++);for(f=s;o>0||f>0&&r;)0!==o&&(0===f||!r||n.z<=r.z)?(x=n,n=n.nextZ,o--):(x=r,r=r.nextZ,f--),i?i.nextZ=x:e=x,x.prevZ=i,i=x;n=r}i.nextZ=null,s*=2}while(u>1)}(x)}(e,r,x,i);for(var o,f,p=e;e.prev!==e.next;)if(o=e.prev,f=e.next,i?v(e,r,x,i):l(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(f.i/n|0),B(e),e=f.next,p=f.next;else if((e=f)===p){u?1===u?a(e=h(s(e),t,n),t,n,r,x,i,2):2===u&&c(e,t,n,r,x,i):a(s(e),t,n,r,x,i,1);break}}}function l(e){var t=e.prev,n=e,r=e.next;if(w(t,n,r)>=0)return!1;for(var x=t.x,i=n.x,u=r.x,o=t.y,f=n.y,s=r.y,a=x<i?x<u?x:u:i<u?i:u,l=o<f?o<s?o:s:f<s?f:s,v=x>i?x>u?x:u:i>u?i:u,h=o>f?o>s?o:s:f>s?f:s,c=r.next;c!==t;){if(c.x>=a&&c.x<=v&&c.y>=l&&c.y<=h&&M(x,o,i,f,u,s,c.x,c.y)&&w(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function v(e,t,n,r){var x=e.prev,i=e,u=e.next;if(w(x,i,u)>=0)return!1;for(var o=x.x,f=i.x,s=u.x,a=x.y,l=i.y,v=u.y,h=o<f?o<s?o:s:f<s?f:s,c=a<l?a<v?a:v:l<v?l:v,p=o>f?o>s?o:s:f>s?f:s,y=a>l?a>v?a:v:l>v?l:v,g=b(h,c,t,n,r),d=b(p,y,t,n,r),Z=e.prevZ,m=e.nextZ;Z&&Z.z>=g&&m&&m.z<=d;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;if(Z=Z.prevZ,m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;Z&&Z.z>=g;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;m&&m.z<=d;){if(m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function h(e,t,n){var r=e;do{var x=r.prev,i=r.next.next;!m(x,i)&&A(x,r,r.next,i)&&z(x,i)&&z(i,x)&&(t.push(x.i/n|0),t.push(r.i/n|0),t.push(i.i/n|0),B(r),B(r.next),r=e=i),r=r.next}while(r!==e);return s(r)}function c(e,t,n,r,x,i){var u=e;do{for(var o=u.next.next;o!==u.prev;){if(u.i!==o.i&&Z(u,o)){var f=F(u,o);return u=s(u,u.next),f=s(f,f.next),a(u,t,n,r,x,i,0),void a(f,t,n,r,x,i,0)}o=o.next}u=u.next}while(u!==e)}function p(e,t){return e.x-t.x}function y(e,t){var n=function(e,t){var n,r=t,x=e.x,i=e.y,u=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var o=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=x&&o>u&&(u=o,n=r.x<r.next.x?r:r.next,o===x))return n}r=r.next}while(r!==t);if(!n)return null;var f,s=n,a=n.x,l=n.y,v=1/0;r=n;do{x>=r.x&&r.x>=a&&x!==r.x&&M(i<l?x:u,i,a,l,i<l?u:x,i,r.x,r.y)&&(f=Math.abs(i-r.y)/(x-r.x),z(r,e)&&(f<v||f===v&&(r.x>n.x||r.x===n.x&&g(n,r)))&&(n=r,v=f)),r=r.next}while(r!==s);return n}(e,t);if(!n)return t;var r=F(n,e);return s(r,r.next),s(n,n.next)}function g(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function b(e,t,n,r,x){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function d(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function M(e,t,n,r,x,i,u,o){return(x-u)*(t-o)>=(e-u)*(i-o)&&(e-u)*(r-o)>=(n-u)*(t-o)&&(n-u)*(i-o)>=(x-u)*(r-o)}function Z(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&A(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(z(e,t)&&z(t,e)&&function(e,t){var n=e,r=!1,x=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!=n.next.y>i&&n.next.y!==n.y&&x<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||m(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function A(e,t,n,r){var x=I(w(e,t,n)),i=I(w(e,t,r)),u=I(w(n,r,e)),o=I(w(n,r,t));return x!==i&&u!==o||(!(0!==x||!E(e,n,t))||(!(0!==i||!E(e,r,t))||(!(0!==u||!E(n,e,r))||!(0!==o||!E(n,t,r)))))}function E(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function I(e){return e>0?1:e<0?-1:0}function z(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function F(e,t){var n=new _(e.i,e.x,e.y),r=new _(t.i,t.x,t.y),x=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=x,x.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function P(e,t,n,r){var x=new _(e,t,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function B(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function _(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(e,t,n,r){for(var x=0,i=t,u=n-r;i<n;i+=r)x+=(e[u]-e[i])*(e[i+1]+e[u+1]),u=i;return x}u.exports=o,u.exports.default=o,o.deviation=function(e,t,n,r){var x=t&&t.length,i=x?t[0]*n:e.length,u=Math.abs(O(e,0,i,n));if(x)for(var o=0,f=t.length;o<f;o++){var s=t[o]*n,a=o<f-1?t[o+1]*n:e.length;u-=Math.abs(O(e,s,a,n))}var l=0;for(o=0;o<r.length;o+=3){var v=r[o]*n,h=r[o+1]*n,c=r[o+2]*n;l+=Math.abs((e[v]-e[c])*(e[h+1]-e[v+1])-(e[v]-e[h])*(e[c+1]-e[v+1]))}return 0===u&&0===l?0:Math.abs((l-u)/u)},o.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,x=0;x<e.length;x++){for(var i=0;i<e[x].length;i++)for(var u=0;u<t;u++)n.vertices.push(e[x][i][u]);x>0&&(r+=e[x-1].length,n.holes.push(r))}return n};var N=i(u.exports);const R=[],S={vertexPosition:0,indexPosition:0};function T(e,t,n,r,x){e[t+0]=n,e[t+1]=r,e[t+2]=x}function U(e,t,n,r,x,i){const u=3+x,o=e[t+0],f=e[t+1],s=R;s.length=x;for(let n=0;n<s.length;n++)s[n]=e[t+2+n];let a=i?i.vertexPosition:0,l=i?i.indexPosition:0;const v=a/u;return T(n,a,o,f,0),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,1),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,2),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,3),s.length&&n.set(s,a+3),a+=u,r[l++]=v,r[l++]=v+1,r[l++]=v+3,r[l++]=v+1,r[l++]=v+2,r[l++]=v+3,S.vertexPosition=a,S.indexPosition=l,S}function k(e,t,n,x,i,u,o,f,s,a,l){const v=8+f.length,h=u.length/v,c=[e[t+0],e[t+1]],p=[e[n],e[n+1]],y=r(s,[...c]),g=r(s,[...p]);function b(e,t,n){const r=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),x=[(t[0]-e[0])/r,(t[1]-e[1])/r],i=[-x[1],x[0]],u=Math.sqrt((n[0]-e[0])*(n[0]-e[0])+(n[1]-e[1])*(n[1]-e[1])),o=[(n[0]-e[0])/u,(n[1]-e[1])/u],f=0===r||0===u?0:Math.acos((s=o[0]*x[0]+o[1]*x[1],a=-1,l=1,Math.min(Math.max(s,a),l)));var s,a,l;return o[0]*i[0]+o[1]*i[1]>0?f:2*Math.PI-f}let d=-1,M=-1,Z=l;const w=null!==i;if(null!==x){d=b(y,g,r(s,[...[e[x],e[x+1]]])),Math.cos(d)<=.985&&(Z+=Math.tan((d-Math.PI)/2))}if(w){M=b(g,y,r(s,[...[e[i],e[i+1]]])),Math.cos(M)<=.985&&(Z+=Math.tan((Math.PI-M)/2))}function m(e,t){return 0===t?1e4*e:Math.sign(t)*(1e4*e+Math.abs(t))}return u.push(c[0],c[1],p[0],p[1],d,M,a,m(0,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(1,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(2,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(3,l)),u.push(...f),o.push(h,h+1,h+2,h+1,h+3,h+2),{length:a+Math.sqrt((g[0]-y[0])*(g[0]-y[0])+(g[1]-y[1])*(g[1]-y[1])),angle:Z}}function G(e,t,n,r,x){const i=2+x;let u=t;const o=e.slice(u,u+x);u+=x;const f=e[u++];let s=0;const a=new Array(f-1);for(let t=0;t<f;t++)s+=e[u++],t<f-1&&(a[t]=s);const l=e.slice(u,u+2*s),v=N(l,a,2);for(let e=0;e<v.length;e++)r.push(v[e]+n.length/i);for(let e=0;e<l.length;e+=2)n.push(l[e],l[e+1],...o);return u+2*s}const j=self;j.onmessage=r=>{const i=r.data;switch(i.type){case t:{const e=3,t=2,n=i.customAttributesSize,r=t+n,x=new Float32Array(i.renderInstructions),u=x.length/r,o=4*u*(n+e),f=new Uint32Array(6*u),s=new Float32Array(o);let a;for(let e=0;e<x.length;e+=r)a=U(x,e,s,f,n,a);const l=Object.assign({vertexBuffer:s.buffer,indexBuffer:f.buffer,renderInstructions:x.buffer},i);j.postMessage(l,[s.buffer,f.buffer,x.buffer]);break}case n:{const e=[],t=[],n=i.customAttributesSize,r=2,u=new Float32Array(i.renderInstructions);let o=0;const f=[1,0,0,1,0,0];let s,a;for(x(f,i.renderInstructionsTransform);o<u.length;){a=Array.from(u.slice(o,o+n)),o+=n,s=u[o++];const x=o,i=o+(s-1)*r,l=u[x]===u[i]&&u[x+1]===u[i+1];let v=0,h=0;for(let n=0;n<s-1;n++){let c=null;n>0?c=o+(n-1)*r:l&&(c=i-r);let p=null;n<s-2?p=o+(n+2)*r:l&&(p=x+r);const y=k(u,o+n*r,o+(n+1)*r,c,p,e,t,a,f,v,h);v=y.length,h=y.angle}o+=s*r}const l=Uint32Array.from(t),v=Float32Array.from(e),h=Object.assign({vertexBuffer:v.buffer,indexBuffer:l.buffer,renderInstructions:u.buffer},i);j.postMessage(h,[v.buffer,l.buffer,u.buffer]);break}case e:{const e=[],t=[],n=i.customAttributesSize,r=new Float32Array(i.renderInstructions);let x=0;for(;x<r.length;)x=G(r,x,e,t,n);const u=Uint32Array.from(t),o=Float32Array.from(e),f=Object.assign({vertexBuffer:o.buffer,indexBuffer:u.buffer,renderInstructions:r.buffer},i);j.postMessage(f,[o.buffer,u.buffer,r.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(r,"binary").toString("base64"):URL.createObjectURL(new Blob([r],{type:"application/javascript"})))}function _y(r,e){const t=r.viewState.projection,i=e.getSource().getWrapX()&&t.canWrapX(),s=t.getExtent(),o=r.extent,a=i?Xe(s):null,l=i?Math.ceil((o[2]-s[2])/a)+1:1;return[i?Math.floor((o[0]-s[0])/a):0,l,a]}class xy extends Mc{constructor(e,t){const n=t.uniforms||{},i=it();n[_t.PROJECTION_MATRIX]=i,super(e,{uniforms:n,postProcesses:t.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new jn(li,Wi),this.indicesBuffer_=new jn(ci,Wi),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.program_,this.hitDetectionEnabled_=t.hitDetectionEnabled??!0;const s=t.attributes?t.attributes.map(function(a){return{name:"a_prop_"+a.name,size:1,type:ct.FLOAT}}):[];this.attributes=[{name:"a_position",size:2,type:ct.FLOAT},{name:"a_index",size:1,type:ct.FLOAT}],this.hitDetectionEnabled_&&(this.attributes.push({name:"a_prop_hitColor",size:4,type:ct.FLOAT}),this.attributes.push({name:"a_featureUid",size:1,type:ct.FLOAT})),this.attributes.push(...s),this.customAttributes=t.attributes?t.attributes:[],this.previousExtent_=ds(),this.currentTransform_=i,this.renderTransform_=it(),this.invertRenderTransform_=it(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=yy(),this.worker_.addEventListener("message",a=>{const l=a.data;if(l.type===sa.GENERATE_POINT_BUFFERS){const c=l.projectionTransform;this.verticesBuffer_.fromArrayBuffer(l.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.fromArrayBuffer(l.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=c,Lh(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(a.data.renderInstructions),l.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const o=this.getLayer().getSource();this.sourceListenKeys_=[Cr(o,_n.ADDFEATURE,this.handleSourceFeatureAdded_,this),Cr(o,_n.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),Cr(o,_n.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),Cr(o,_n.CLEAR,this.handleSourceFeatureClear_,this)],o.forEachFeature(a=>{this.featureCache_[Ae(a)]={feature:a,properties:a.getProperties(),geometry:a.getGeometry()},this.featureCount_++})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new Jm(this.helper))}handleSourceFeatureAdded_(e){const t=e.feature;this.featureCache_[Ae(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(e){const t=e.feature;this.featureCache_[Ae(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()}}handleSourceFeatureDelete_(e){const t=e.feature;delete this.featureCache_[Ae(t)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[n,i,s]=_y(e,this.getLayer());return this.renderWorlds(e,!1,n,i,s),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,n,i,s),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),this.helper.getCanvas()}prepareFrameInternal(e){const t=this.getLayer(),n=t.getSource(),i=e.viewState,s=!e.viewHints[Gn.ANIMATING]&&!e.viewHints[Gn.INTERACTING],o=!Dn(this.previousExtent_,e.extent),a=this.sourceRevision_<n.getRevision();if(a&&(this.sourceRevision_=n.getRevision()),s&&(o||a)){const l=i.projection,c=i.resolution,h=t instanceof ps?t.getRenderBuffer():0,f=Vl(e.extent,h*c);n.loadFeatures(f,c,l),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.useProgram(this.program_,e),this.helper.prepareDraw(e),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(e){const t=it();this.helper.makeProjectionTransform(e,t);const i=(this.hitDetectionEnabled_?7:2)+this.customAttributes.length,s=i*this.featureCount_;(!this.renderInstructions_||this.renderInstructions_.length!==s)&&(this.renderInstructions_=new Float32Array(s));let o,a;const l=[],c=[];let h=-1;for(const d in this.featureCache_)if(o=this.featureCache_[d],a=o.geometry,!(!a||a.getType()!=="Point")){if(l[0]=a.getFlatCoordinates()[0],l[1]=a.getFlatCoordinates()[1],en(t,l),this.renderInstructions_[++h]=l[0],this.renderInstructions_[++h]=l[1],this.hitDetectionEnabled_){const g=gy(h+5,c);this.renderInstructions_[++h]=g[0],this.renderInstructions_[++h]=g[1],this.renderInstructions_[++h]=g[2],this.renderInstructions_[++h]=g[3],this.renderInstructions_[++h]=Number(d)}for(let g=0;g<this.customAttributes.length;g++){const m=this.customAttributes[g].callback(o.feature,o.properties);this.renderInstructions_[++h]=m}}const f={id:++this.lastSentId,type:sa.GENERATE_POINT_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesSize:i-2};f.projectionTransform=t,this.ready=!1,this.worker_.postMessage(f,[this.renderInstructions_.buffer]),this.renderInstructions_=null}forEachFeatureAtCoordinate(e,t,n,i,s){if(gt(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const o=en(t.coordinateToPixelTransform,e.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],c=my(l),h=this.renderInstructions_[c],f=Math.floor(h).toString(),g=this.getLayer().getSource().getFeatureByUid(f);if(g)return i(g,this.getLayer(),null)}renderWorlds(e,t,n,i,s){let o=n;this.helper.useProgram(this.program_,e),t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0)),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes);do{this.helper.makeProjectionTransform(e,this.currentTransform_),Zl(this.currentTransform_,o*s,0),Bl(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e),this.helper.applyHitDetectionUniform(t);const a=this.indicesBuffer_.getSize();this.helper.drawElements(0,a)}while(++o<i)}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach(function(e){zi(e)}),this.sourceListenKeys_=null,super.disposeInternal()}renderDeclutter(){}}const Uc=xy;class Ey{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}}const wy=Ey;function Zn(r){return r instanceof Image||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageBitmap?r:null}function qi(r){return r instanceof Uint8Array||r instanceof Uint8ClampedArray||r instanceof Float32Array||r instanceof DataView?r:null}let Xt=null;function Ty(r){Xt||(Xt=Tt(r.width,r.height,void 0,{willReadFrequently:!0}));const e=Xt.canvas,t=r.width;e.width!==t&&(e.width=t);const n=r.height;return e.height!==n&&(e.height=n),Xt.clearRect(0,0,t,n),Xt.drawImage(r,0,0),Xt.getImageData(0,0,t,n).data}const vy=[256,256];let Sy=class extends Wl{constructor(e){const t=Y.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null}getSize(){if(this.size_)return this.size_;const e=Zn(this.data_);return e?[e.width,e.height]:vy}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==Y.IDLE&&this.state!==Y.ERROR)return;this.state=Y.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=Y.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=Y.ERROR,e.changed()})}};const Gs=Sy;class Ry extends Gs{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:e.interpolate,transition:e.transition}),this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const t=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),n=this.targetTileGrid_.getExtent();let i=this.sourceTileGrid_.getExtent();const s=n?ht(t,n):t;if(To(s)===0){this.state=Y.EMPTY;return}const o=e.sourceProj,a=o.getExtent();a&&(i?i=ht(i,a):i=a);const l=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),c=e.targetProj,h=Ch(o,c,s,l);if(!isFinite(h)||h<=0){this.state=Y.EMPTY;return}const f=e.errorThreshold!==void 0?e.errorThreshold:Oh;if(this.triangulation_=new Mh(o,c,s,i,h*f,l),this.triangulation_.getTriangles().length===0){this.state=Y.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(h);let d=this.triangulation_.calculateSourceExtent();if(i&&(o.canWrapX()?(d[1]=ve(d[1],i[1],i[3]),d[3]=ve(d[3],i[1],i[3])):d=ht(d,i)),!To(d))this.state=Y.EMPTY;else{const g=this.sourceTileGrid_.getTileRangeForExtentAndZ(d,this.sourceZ_),m=e.getTileFunction;for(let _=g.minX;_<=g.maxX;_++)for(let x=g.minY;x<=g.maxY;x++){const w=m(this.sourceZ_,_,x,this.pixelRatio_);w&&this.sourceTiles_.push(w)}this.sourceTiles_.length===0&&(this.state=Y.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{if(!t||t.getState()!==Y.LOADED)return;const n=t.getSize(),i=this.gutter_;let s;const o=qi(t.getData());o?s=o:s=Ty(Zn(t.getData()));const a=[n[0]+2*i,n[1]+2*i],l=s instanceof Float32Array,c=a[0]*a[1],h=l?Float32Array:Uint8Array,f=new h(s.buffer),d=h.BYTES_PER_ELEMENT,g=d*f.length/c,m=f.byteLength/a[1],_=Math.floor(m/d/a[0]),x=c*_;let w=f;if(f.length!==x){w=new h(x);let E=0,v=0;const S=a[0]*_;for(let A=0;A<a[1];++A){for(let O=0;O<S;++O)w[E++]=f[v+O];v+=m/d}}e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),data:new Uint8Array(w.buffer),dataType:h,bytesPerPixel:g,pixelSize:a})}),this.sourceTiles_.length=0,e.length===0)this.state=Y.ERROR;else{const t=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(t),i=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let c,h;const f=e[0].bytesPerPixel,d=Math.ceil(f/3);for(let g=d-1;g>=0;--g){const m=[];for(let S=0,A=e.length;S<A;++S){const O=e[S],I=O.data,F=O.pixelSize,U=F[0],B=F[1],V=Tt(U,B,_i),J=V.createImageData(U,B),u=J.data;let p=g*3;for(let y=0,T=u.length;y<T;y+=4)u[y]=I[p],u[y+1]=I[p+1],u[y+2]=I[p+2],u[y+3]=255,p+=f;V.putImageData(J,0,0),m.push({extent:O.extent,image:V.canvas})}const _=Ih(i,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,m,this.gutter_,!1,!1,!1,!0);for(let S=0,A=m.length;S<A;++S){const I=m[S].image.getContext("2d");vo(I),_i.push(I.canvas)}const x=_.getContext("2d"),w=x.getImageData(0,0,_.width,_.height);vo(x),_i.push(_),c||(h=new Uint8Array(f*w.width*w.height),c=new e[0].dataType(h.buffer));const E=w.data;let v=g*3;for(let S=0,A=E.length;S<A;S+=4)E[S+3]===255?(h[v]=E[S],h[v+1]=E[S+1],h[v+2]=E[S+2]):(h[v]=0,h[v+1]=0,h[v+2]=0),v+=f}this.reprojData_=c,this.reprojSize_=[Math.round(i*this.pixelRatio_),Math.round(s*this.pixelRatio_)],this.state=Y.LOADED}this.changed()}load(){if(this.state!==Y.IDLE&&this.state!==Y.ERROR)return;this.state=Y.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const n=t.getState();if(n!==Y.IDLE&&n!==Y.LOADING)return;e++;const i=Cr(t,je.CHANGE,function(){const s=t.getState();(s==Y.LOADED||s==Y.ERROR||s==Y.EMPTY)&&(zi(i),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(i)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t){t.getState()==Y.IDLE&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(zi),this.sourcesListenerKeys_=null}}const Us=Ry;class by extends Fh{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=e.gutter||0,this.helper_=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(je.CHANGE,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===Y.LOADED,this.loaded)this.uploadTile();else{if(e instanceof gs){const t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(je.CHANGE,this.handleTileChange_)}}uploadTile(){xt()}setReady(){this.ready=!0,this.dispatchEvent(je.CHANGE)}handleTileChange_(){this.tile.getState()===Y.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(je.CHANGE,this.handleTileChange_)}}const Py=by;function kc(r,e,t){const n=t?r.LINEAR:r.NEAREST;r.bindTexture(r.TEXTURE_2D,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,n)}function Ay(r,e,t,n){kc(r,e,n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)}function la(r,e,t,n,i,s){const o=r.getGL();let a,l;t instanceof Float32Array?(a=o.FLOAT,r.getExtension("OES_texture_float"),l=r.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),kc(o,e,s&&l);const c=t.byteLength/n[1];let h=1;c%8===0?h=8:c%4===0?h=4:c%2===0&&(h=2);let f;switch(i){case 1:{f=o.LUMINANCE;break}case 2:{f=o.LUMINANCE_ALPHA;break}case 3:{f=o.RGB;break}case 4:{f=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${i}`)}const d=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,h),o.texImage2D(o.TEXTURE_2D,0,f,n[0],n[1],0,f,a,t),o.pixelStorei(o.UNPACK_ALIGNMENT,d)}let er=null;function Ly(){er=Tt(1,1,void 0,{willReadFrequently:!0})}class Iy extends Py{constructor(e){super(e),this.textures=[],this.renderSize_=ft(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const t=new jn(li,Ns);t.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(t),this.coords=t,this.setTile(e.tile)}uploadTile(){const e=this.helper_,t=e.getGL(),n=this.tile;this.textures.length=0;let i;n instanceof gs||n instanceof ms?i=n.getImage():i=n.getData();const s=Zn(i);if(s){const E=t.createTexture();this.textures.push(E),this.bandCount=4,Ay(t,E,s,n.interpolate),this.setReady();return}i=qi(i);const o=n.getSize(),a=[o[0]+2*this.gutter_,o[1]+2*this.gutter_],l=i instanceof Float32Array,c=a[0]*a[1],h=l?Float32Array:Uint8Array,f=h.BYTES_PER_ELEMENT,d=i.byteLength/a[1];this.bandCount=Math.floor(d/f/a[0]);const g=Math.ceil(this.bandCount/4);if(g===1){const E=t.createTexture();this.textures.push(E),la(e,E,i,a,this.bandCount,n.interpolate),this.setReady();return}const m=new Array(g);for(let E=0;E<g;++E){const v=t.createTexture();this.textures.push(v);const S=E<g-1?4:(this.bandCount-1)%4+1;m[E]=new h(c*S)}let _=0,x=0;const w=a[0]*this.bandCount;for(let E=0;E<a[1];++E){for(let v=0;v<w;++v){const S=i[x+v],A=Math.floor(_/this.bandCount),O=v%this.bandCount,I=Math.floor(O/4),F=m[I],U=F.length/c,B=O%4;F[A*U+B]=S,++_}x+=d/f}for(let E=0;E<g;++E){const v=this.textures[E],S=m[E],A=S.length/c;la(e,v,S,a,A,n.interpolate)}this.setReady()}disposeInternal(){const e=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let t=0;t<this.textures.length;++t)e.deleteTexture(this.textures[t]);this.tile.removeEventListener(je.CHANGE,this.handleTileChange_)}getImagePixelData_(e,t,n){const i=this.gutter_,s=this.renderSize_[0],o=this.renderSize_[1];er||Ly(),er.clearRect(0,0,1,1);const a=e.width,l=e.height,c=a-2*i,h=l-2*i,f=i+Math.floor(c*(t/s)),d=i+Math.floor(h*(n/o));let g;try{er.drawImage(e,f,d,1,1,0,0,1,1),g=er.getImageData(0,0,1,1).data}catch{return er=null,null}return g}getArrayPixelData_(e,t,n,i){const s=this.gutter_,o=this.renderSize_[0],a=this.renderSize_[1],l=t[0],c=t[1],h=l+2*s,f=c+2*s,d=s+Math.floor(l*(n/o)),g=s+Math.floor(c*(i/a));if(e instanceof DataView){const _=e.byteLength/(h*f),x=_*(g*h+d),w=e.buffer.slice(x,x+_);return new DataView(w)}const m=this.bandCount*(g*h+d);return e.slice(m,m+this.bandCount)}getPixelData(e,t){if(!this.loaded)return null;if(this.tile instanceof Gs){const n=this.tile.getData(),i=qi(n);if(i){const s=this.tile.getSize();return this.getArrayPixelData_(i,s,e,t)}return this.getImagePixelData_(Zn(n),e,t)}return this.getImagePixelData_(this.tile.getImage(),e,t)}}const Cy=Iy,Oy={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},My={};function ca(r){return 1/(r+2)}function Fy(){return{tileIds:new Set,representationsByZ:{}}}function ua(r,e){return r.tileIds.has(Ae(e))}function ha(r,e,t){const n=r.representationsByZ;t in n||(n[t]=new Set),n[t].add(e),r.tileIds.add(Ae(e.tile))}function Ti(r,e){const t=r.layerStatesArray[r.layerIndex];t.extent&&(e=ht(e,Xl(t.extent,r.viewState.projection)));const n=t.layer.getRenderSource();if(!n.getWrapX()){const i=n.getTileGridForProjection(r.viewState.projection).getExtent();i&&(e=ht(e,i))}return e}function Ki(r,e){return`${r.getKey()},${Jt(e)}`}class Ny extends Mc{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=it(),this.tempMat4=Ic(),this.tempTileRange_=new Nh(0,0,0,0),this.tempTileCoord_=Bi(0,0,0),this.tempSize_=[0,0];const n=t.cacheSize!==void 0?t.cacheSize:512;this.tileRepresentationCache=new Hl(n),this.frameState=null,this.projection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}isDrawableTile_(e){const t=this.getLayer(),n=e.getState(),i=t.getUseInterimTilesOnError();return n==Y.LOADED||n==Y.EMPTY||n==Y.ERROR&&!i}prepareFrameInternal(e){this.projection_?e.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=e.viewState.projection):this.projection_=e.viewState.projection;const n=this.getLayer().getRenderSource();return!n||hs(Ti(e,e.extent))?!1:n.getState()==="ready"}createTileRepresentation(e){return xt()}enqueueTiles(e,t,n,i,s){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),c=l.getTileGridForProjection(o.projection),h=l.getGutterForProjection(o.projection),f=Ae(l);f in e.wantedTiles||(e.wantedTiles[f]={});const d=e.wantedTiles[f],g=this.tileRepresentationCache,m=a.getMapInternal(),_=Math.max(n-s,c.getMinZoom(),c.getZForResolution(Math.min(a.getMaxResolution(),m?m.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):c.getResolution(0)),l.zDirection));for(let x=n;x>=_;--x){const w=c.getTileRangeForExtentAndZ(t,x,this.tempTileRange_),E=c.getResolution(x);for(let v=w.minX;v<=w.maxX;++v)for(let S=w.minY;S<=w.maxY;++S){const A=Bi(x,v,S,this.tempTileCoord_),O=Ki(l,A);let I,F;if(g.containsKey(O)&&(I=g.get(O),F=I.tile),(!I||I.tile.key!==l.getKey())&&(F=l.getTile(x,v,S,e.pixelRatio,o.projection)),ua(i,F))continue;if(!I)I=this.createTileRepresentation({tile:F,grid:c,helper:this.helper,gutter:h}),g.set(O,I);else if(this.isDrawableTile_(F))I.setTile(F);else{const B=F.getInterimTile();I.setTile(B)}ha(i,I,x);const U=F.getKey();d[U]=!0,F.getState()===Y.IDLE&&(e.tileQueue.isKeyQueued(U)||e.tileQueue.enqueue([F,f,c.getTileCoordCenter(A),E]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t,!0)}beforeTilesMaskRender(e){return!1}renderTile(e,t,n,i,s,o,a,l,c,h,f){}renderTileMask(e,t,n,i){}drawTile_(e,t,n,i,s,o,a){if(!t.ready)return;const c=t.tile.tileCoord,h=Jt(c),f=h in o?o[h]:1,d=a.getResolution(n),g=ft(a.getTileSize(n),this.tempSize_),m=a.getOrigin(n),_=a.getTileCoordExtent(c),x=f<1?-1:ca(n);f<1&&(e.animate=!0);const w=e.viewState,E=w.center[0],v=w.center[1],S=g[0]+2*i,A=g[1]+2*i,O=S/A,I=(E-m[0])/(g[0]*d),F=(m[1]-v)/(g[1]*d),U=w.resolution/d,B=c[1],V=c[2];Dh(this.tileTransform_),So(this.tileTransform_,2/(e.size[0]*U/S),-2/(e.size[1]*U/S)),Gh(this.tileTransform_,w.rotation),So(this.tileTransform_,1,1/O),Zl(this.tileTransform_,(g[0]*(B-I)-i)/S,(g[1]*(V-F)-i)/A),this.renderTile(t,this.tileTransform_,e,s,d,g,m,_,x,i,f)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const t=this.helper.getGL();this.preRender(t,e);const n=e.viewState,i=this.getLayer(),s=i.getRenderSource(),o=s.getTileGridForProjection(n.projection),a=s.getGutterForProjection(n.projection),l=Ti(e,e.extent),c=o.getZForResolution(n.resolution,s.zDirection),h=Fy(),f=i.getPreload();if(e.nextExtent){const O=o.getZForResolution(n.nextResolution,s.zDirection),I=Ti(e,e.nextExtent);this.enqueueTiles(e,I,O,h,f)}this.enqueueTiles(e,l,c,h,0),f>0&&setTimeout(()=>{this.enqueueTiles(e,l,c-1,h,f-1)},0);const d={},g=Ae(this),m=e.time;let _=!1;for(const O of h.representationsByZ[c]){const I=O.tile;if((I instanceof ms||I instanceof Us)&&I.getState()===Y.EMPTY)continue;const F=I.tileCoord;if(O.ready){const V=I.getAlpha(g,m);if(V===1){I.endTransition(g);continue}_=!0;const J=Jt(F);d[J]=V}if(this.renderComplete=!1,this.findAltTiles_(o,F,c+1,h))continue;const B=o.getMinZoom();for(let V=c-1;V>=B&&!this.findAltTiles_(o,F,V,h);--V);}const x=h.representationsByZ,w=Object.keys(x).map(Number).sort(Uh);if(this.beforeTilesMaskRender(e))for(let O=0,I=w.length;O<I;++O){const F=w[O];for(const U of x[F]){const B=U.tile.tileCoord;if(Jt(B)in d)continue;const J=o.getTileCoordExtent(B);this.renderTileMask(U,F,J,ca(F))}}this.beforeTilesRender(e,_);for(let O=0,I=w.length;O<I;++O){const F=w[O];for(const U of x[F]){const B=U.tile.tileCoord;Jt(B)in d||this.drawTile_(e,U,F,a,l,d,o)}}for(const O of x[c]){const I=O.tile.tileCoord;Jt(I)in d&&this.drawTile_(e,O,c,a,l,d,o)}this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const v=this.helper.getCanvas(),S=this.tileRepresentationCache;for(;S.canExpireCache();)S.pop().dispose();const A=function(O,I){s.updateCacheSize(.1,I.viewState.projection),s.expireCache(I.viewState.projection,My)};return e.postRenderFunctions.push(A),this.postRender(t,e),v}findAltTiles_(e,t,n,i){const s=e.getTileRangeForTileCoordAndZ(t,n,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let c=s.minX;c<=s.maxX;++c)for(let h=s.minY;h<=s.maxY;++h){const f=Ki(l,[n,c,h]);let d=!1;if(a.containsKey(f)){const g=a.get(f);g.ready&&!ua(i,g.tile)&&(ha(i,g,n),d=!0)}d||(o=!1)}return o}clearCache(){const e=this.tileRepresentationCache;e.forEach(t=>t.dispose()),e.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const Dy=Ny,K={...Oy,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},Pn={TEXTURE_COORD:"a_textureCoord"},Gy=[{name:Pn.TEXTURE_COORD,size:2,type:ct.FLOAT}];class Uy extends Dy{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new jn(ci,Ns),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){super.reset(e),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(e){return new Cy(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,n,i,s,o,a,l,c,h,f){const d=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(Gy);let g=0;for(;g<e.textures.length;){const O=`${K.TILE_TEXTURE_ARRAY}[${g}]`;this.helper.bindTexture(e.textures[g],g,O),++g}for(let O=0;O<this.paletteTextures_.length;++O){const I=this.paletteTextures_[O],F=I.getTexture(d);this.helper.bindTexture(F,g,I.name),++g}const m=n.viewState,_=o[0]+2*h,x=o[1]+2*h,E=e.tile.tileCoord,v=E[1],S=E[2];this.helper.setUniformMatrixValue(K.TILE_TRANSFORM,Cc(this.tempMat4,t)),this.helper.setUniformFloatValue(K.TRANSITION_ALPHA,f),this.helper.setUniformFloatValue(K.DEPTH,c);let A=i;h>0&&(A=l,ht(A,i,A)),this.helper.setUniformFloatVec4(K.RENDER_EXTENT,A),this.helper.setUniformFloatValue(K.RESOLUTION,m.resolution),this.helper.setUniformFloatValue(K.ZOOM,m.zoom),this.helper.setUniformFloatValue(K.TEXTURE_PIXEL_WIDTH,_),this.helper.setUniformFloatValue(K.TEXTURE_PIXEL_HEIGHT,x),this.helper.setUniformFloatValue(K.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(K.TEXTURE_ORIGIN_X,a[0]+v*o[0]*s-h*s),this.helper.setUniformFloatValue(K.TEXTURE_ORIGIN_Y,a[1]-S*o[1]*s+h*s),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;const n=this.frameState;if(!n)return null;const i=this.getLayer(),s=en(n.pixelToCoordinateTransform,e.slice()),o=n.viewState,a=i.getExtent();if(a&&!ar(Xl(a,o.projection),s))return null;const l=i.getSources(cs([s]),o.resolution);let c,h,f;for(c=l.length-1;c>=0;--c)if(h=l[c],h.getState()==="ready"){if(f=h.getTileGridForProjection(o.projection),h.getWrapX())break;const g=f.getExtent();if(!g||ar(g,s))break}if(c<0)return null;const d=this.tileRepresentationCache;for(let g=f.getZForResolution(o.resolution);g>=f.getMinZoom();--g){const m=f.getTileCoordForCoordAndZ(s,g),_=Ki(h,m);if(!d.containsKey(_))continue;const x=d.get(_),w=x.tile;if((w instanceof ms||w instanceof Us)&&w.getState()===Y.EMPTY)return null;if(!x.loaded)continue;const E=f.getOrigin(g),v=ft(f.getTileSize(g)),S=f.getResolution(g),A=(s[0]-E[0])/S-m[1]*v[0],O=(E[1]-s[1])/S-m[2]*v[1];return x.getPixelData(A,O)}return null}disposeInternal(){const e=this.helper;e&&(e.getGL().deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_}}const ky=Uy;function zy(r,e){return`operator_${r}_${Object.keys(e.functions).length}`}function jt(r){const e=r.toString();return e.includes(".")?e:e+".0"}function ks(r){if(r.length<2||r.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${r.length}(${r.map(jt).join(", ")})`}function An(r){const e=tn(r),t=e.length>3?e[3]:1;return ks([e[0]/255*t,e[1]/255*t,e[2]/255*t,t])}const vi={};let By=0;function Wn(r){return r in vi||(vi[r]=By++),vi[r]}function Et(r){return jt(Wn(r))}function zs(r){return"u_var_"+r}function $y(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{}}}const Si="getBandValue",zc="u_paletteTextures";function jy(r,e,t,n){const i=kh(r,t,e);if(zh(i.type,jh))throw new Error("No matching type was found");if(!Bh(e,i.type)){const s=$i(e),o=$i(i.type);throw new Error(`Expected expression to be of type ${s}, got ${o}`)}return Bs(i,e,n)}function fe(r){return(e,t,n)=>{const i=t.args.length,s=new Array(i);for(let o=0;o<i;++o)s[o]=Bs(t.args[o],n,e);return r(s,e)}}const Vy={[ne.Get]:(r,e)=>{const n=e.args[0].value;return n in r.properties||(r.properties[n]={name:n,type:e.type}),(r.inFragmentShader?"v_prop_":"a_prop_")+n},[ne.GeometryType]:(r,e,t)=>{const n="geometryType";return n in r.properties||(r.properties[n]={name:n,type:pr,evaluator:o=>Vh(o.getGeometry())}),(r.inFragmentShader?"v_prop_":"a_prop_")+n},[ne.Var]:(r,e)=>{const n=e.args[0].value;return n in r.variables||(r.variables[n]={name:n,type:e.type}),zs(n)},[ne.Resolution]:()=>"u_resolution",[ne.Zoom]:()=>"u_zoom",[ne.Time]:()=>"u_time",[ne.Any]:fe(r=>`(${r.join(" || ")})`),[ne.All]:fe(r=>`(${r.join(" && ")})`),[ne.Not]:fe(([r])=>`(!${r})`),[ne.Equal]:fe(([r,e])=>`(${r} == ${e})`),[ne.NotEqual]:fe(([r,e])=>`(${r} != ${e})`),[ne.GreaterThan]:fe(([r,e])=>`(${r} > ${e})`),[ne.GreaterThanOrEqualTo]:fe(([r,e])=>`(${r} >= ${e})`),[ne.LessThan]:fe(([r,e])=>`(${r} < ${e})`),[ne.LessThanOrEqualTo]:fe(([r,e])=>`(${r} <= ${e})`),[ne.Multiply]:fe(r=>`(${r.join(" * ")})`),[ne.Divide]:fe(([r,e])=>`(${r} / ${e})`),[ne.Add]:fe(r=>`(${r.join(" + ")})`),[ne.Subtract]:fe(([r,e])=>`(${r} - ${e})`),[ne.Clamp]:fe(([r,e,t])=>`clamp(${r}, ${e}, ${t})`),[ne.Mod]:fe(([r,e])=>`mod(${r}, ${e})`),[ne.Pow]:fe(([r,e])=>`pow(${r}, ${e})`),[ne.Abs]:fe(([r])=>`abs(${r})`),[ne.Floor]:fe(([r])=>`floor(${r})`),[ne.Ceil]:fe(([r])=>`ceil(${r})`),[ne.Round]:fe(([r])=>`floor(${r} + 0.5)`),[ne.Sin]:fe(([r])=>`sin(${r})`),[ne.Cos]:fe(([r])=>`cos(${r})`),[ne.Atan]:fe(([r,e])=>e!==void 0?`atan(${r}, ${e})`:`atan(${r})`),[ne.Sqrt]:fe(([r])=>`sqrt(${r})`),[ne.Match]:fe(r=>{const e=r[0],t=r[r.length-1];let n=null;for(let i=r.length-3;i>=1;i-=2){const s=r[i],o=r[i+1];n=`(${e} == ${s} ? ${o} : ${n||t})`}return n}),[ne.Between]:fe(([r,e,t])=>`(${r} >= ${e} && ${r} <= ${t})`),[ne.Interpolate]:fe(([r,e,...t])=>{let n="";for(let i=0;i<t.length-2;i+=2){const s=t[i],o=n||t[i+1],a=t[i+2],l=t[i+3];let c;r===jt(1)?c=`(${e} - ${s}) / (${a} - ${s})`:c=`(pow(${r}, (${e} - ${s})) - 1.0) / (pow(${r}, (${a} - ${s})) - 1.0)`,n=`mix(${o}, ${l}, clamp(${c}, 0.0, 1.0))`}return n}),[ne.Case]:fe(r=>{const e=r[r.length-1];let t=null;for(let n=r.length-3;n>=0;n-=2){const i=r[n],s=r[n+1];t=`(${i} ? ${s} : ${t||e})`}return t}),[ne.In]:fe(([r,...e],t)=>{const n=zy("in",t),i=[];for(let s=0;s<e.length;s+=1)i.push(`  if (inputValue == ${e[s]}) { return true; }`);return t.functions[n]=`bool ${n}(float inputValue) {
${i.join(`
`)}
  return false;
}`,`${n}(${r})`}),[ne.Array]:fe(r=>`vec${r.length}(${r.join(", ")})`),[ne.Color]:fe(r=>{if(r.length===1)return`vec4(vec3(${r[0]} / 255.0), 1.0)`;if(r.length===2)return`(${r[1]} * vec4(vec3(${r[0]} / 255.0), 1.0))`;const e=r.slice(0,3).map(n=>`${n} / 255.0`);return r.length===3?`vec4(${e.join(", ")}, 1.0)`:`(${r[3]} * vec4(${e.join(", ")}, 1.0))`}),[ne.Band]:fe(([r,e,t],n)=>{if(!(Si in n.functions)){let i="";const s=n.bandCount||1;for(let o=0;o<s;o++){const a=Math.floor(o/4);let l=o%4;o===s-1&&l===1&&(l=3);const c=`${K.TILE_TEXTURE_ARRAY}[${a}]`;i+=`  if (band == ${o+1}.0) {
    return texture2D(${c}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}n.functions[Si]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${K.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${K.TEXTURE_PIXEL_HEIGHT};
${i}
}`}return`${Si}(${r}, ${e??"0.0"}, ${t??"0.0"})`}),[ne.Palette]:(r,e)=>{const[t,...n]=e.args,i=n.length,s=new Uint8Array(i*4);for(let c=0;c<n.length;c++){const h=n[c].value,f=tn(h),d=c*4;s[d]=f[0],s[d+1]=f[1],s[d+2]=f[2],s[d+3]=f[3]*255}r.paletteTextures||(r.paletteTextures=[]);const o=`${zc}[${r.paletteTextures.length}]`,a=new wy(o,s);r.paletteTextures.push(a);const l=Bs(t,he,r);return`texture2D(${o}, vec2((${l} + 0.5) / ${i}.0, 0.5))`}};function Bs(r,e,t){if(r instanceof $h){const n=Vy[r.operator];if(n===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(r.operator)}`);return n(t,r,e)}if((r.type&he)>0)return jt(r.value);if((r.type&bn)>0)return r.value.toString();if((r.type&pr)>0)return Et(r.value.toString());if((r.type&Ye)>0)return An(r.value);if((r.type&Qe)>0)return ks(r.value);throw new Error(`Unexpected expression ${r.value} (expected type ${$i(e)})`)}function Zy(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}const Yt=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;

// this used to produce an alpha-premultiplied color from a texture
vec4 samplePremultiplied(sampler2D sampler, vec2 texCoord) {
  vec4 color = texture2D(sampler, texCoord);
  return vec4(color.rgb * color.a, color.a);
}
`,qt=Zy();class Bc{constructor(){this.uniforms_=[],this.attributes_=[],this.varyings_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${jt(qt["circle-radius"])} + ${jt(qt["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=An(qt["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=jt(qt["stroke-width"]),this.strokeColorExpression_=An(qt["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=Et("round"),this.strokeJoinExpression_=Et("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.hasFill_=!1,this.fillColorExpression_=An(qt["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(e){return this.uniforms_.push(e),this}addAttribute(e){return this.attributes_.push(e),this}addVarying(e,t,n){return this.varyings_.push({name:e,type:t,expression:n}),this}setSymbolSizeExpression(e){return this.hasSymbol_=!0,this.symbolSizeExpression_=e,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(e){return this.symbolRotationExpression_=e,this}setSymbolOffsetExpression(e){return this.symbolOffsetExpression_=e,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(e){return this.hasSymbol_=!0,this.symbolColorExpression_=e,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(e){return this.texCoordExpression_=e,this}setFragmentDiscardExpression(e){return this.discardExpression_=e,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(e){return this.symbolRotateWithView_=e,this}setStrokeWidthExpression(e){return this.hasStroke_=!0,this.strokeWidthExpression_=e,this}setStrokeColorExpression(e){return this.hasStroke_=!0,this.strokeColorExpression_=e,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(e){return this.strokeOffsetExpression_=e,this}setStrokeCapExpression(e){return this.strokeCapExpression_=e,this}setStrokeJoinExpression(e){return this.strokeJoinExpression_=e,this}setStrokeMiterLimitExpression(e){return this.strokeMiterLimitExpression_=e,this}setStrokeDistanceFieldExpression(e){return this.strokeDistanceFieldExpression_=e,this}setFillColorExpression(e){return this.hasFill_=!0,this.fillColorExpression_=e,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(e){this.vertexShaderFunctions_.includes(e)||this.vertexShaderFunctions_.push(e)}addFragmentShaderFunction(e){this.fragmentShaderFunctions_.includes(e)||this.fragmentShaderFunctions_.push(e)}getSymbolVertexShader(){return this.hasSymbol_?`${Yt}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_prop_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx;
  if (a_index == 0.0) {
    offsetPx -= halfSizePx;
  } else if (a_index == 1.0) {
    offsetPx += halfSizePx * vec2(1., -1.);
  } else if (a_index == 2.0) {
    offsetPx += halfSizePx;
  } else {
    offsetPx += halfSizePx * vec2(-1., 1.);
  }
  float angle = ${this.symbolRotationExpression_};
  ${this.symbolRotateWithView_?"angle += u_rotation;":""}
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;
  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;
  v_texCoord = vec2(u, v);
  v_prop_hitColor = a_prop_hitColor;
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y); 
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${Yt}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_prop_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${Yt}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute float a_parameters;
attribute float a_distance;
attribute vec2 a_joinAngles;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_prop_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float vertexNumber = floor(abs(a_parameters) / 10000. + 0.5);
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)
  float angleTangentSum = fract(abs(a_parameters) / 10000.) * 10000. * sign(a_parameters);

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);
  
  // compute current vertex position
  float normalDir = vertexNumber < 0.5 || (vertexNumber > 1.5 && vertexNumber < 2.5) ? 1.0 : -1.0;
  float tangentDir = vertexNumber < 1.5 ? 1.0 : -1.0;
  float angle = vertexNumber < 1.5 ? v_angleStart : v_angleEnd;
  vec2 joinDirection;
  vec2 positionPx = vertexNumber < 1.5 ? segmentStartPx : segmentEndPx;
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${aa} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStart = segmentStartPx;
  v_segmentEnd = segmentEndPx;
  v_width = lineWidth;
  v_prop_hitColor = a_prop_hitColor;
  v_distanceOffsetPx = a_distance / u_resolution - (lineOffsetPx * angleTangentSum);
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${Yt}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_prop_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${aa}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${Et("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${Et("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${Et("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${Et("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

void main(void) {
  vec2 currentPoint = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPoint);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }

  float segmentLength = length(v_segmentEnd - v_segmentStart);
  vec2 segmentTangent = (v_segmentEnd - v_segmentStart) / segmentLength;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPoint = currentPoint - v_segmentStart;
  float currentLengthPx = max(0., min(dot(segmentTangent, startToPoint), segmentLength)) + v_distanceOffsetPx; 
  float currentRadiusPx = abs(dot(segmentNormal, startToPoint));
  float currentRadiusRatio = dot(segmentNormal, startToPoint) * 2. / v_width;
  vec4 color = ${this.strokeColorExpression_} * u_globalAlpha;
  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPoint, v_segmentStart, v_segmentEnd, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPoint, v_segmentEnd, v_segmentStart, v_width, v_angleEnd, capType, joinType);
  float distance = max(
    segmentDistanceField(currentPoint, v_segmentStart, v_segmentEnd, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distance = max(distance, ${this.strokeDistanceFieldExpression_});
  gl_FragColor = color * smoothstep(0.5, -0.5, distance);
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${Yt}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec4 v_prop_hitColor;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_prop_hitColor = a_prop_hitColor;
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${Yt}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec4 v_prop_hitColor;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_} * u_globalAlpha;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}}const et={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},Wy=["#00f","#0ff","#0f0","#ff0","#f00"];class Hy extends ps{constructor(e){e=e||{};const t=Object.assign({},e);delete t.gradient,delete t.radius,delete t.blur,delete t.weight,super(t),this.gradient_=null,this.addChangeListener(et.GRADIENT,this.handleGradientChanged_),this.setGradient(e.gradient?e.gradient:Wy),this.setBlur(e.blur!==void 0?e.blur:15),this.setRadius(e.radius!==void 0?e.radius:8);const n=e.weight?e.weight:"weight";typeof n=="string"?this.weightFunction_=function(i){return i.get(n)}:this.weightFunction_=n,this.setRenderOrder(null)}getBlur(){return this.get(et.BLUR)}getGradient(){return this.get(et.GRADIENT)}getRadius(){return this.get(et.RADIUS)}handleGradientChanged_(){this.gradient_=Xy(this.getGradient())}setBlur(e){this.set(et.BLUR,e)}setGradient(e){this.set(et.GRADIENT,e)}setRadius(e){this.set(et.RADIUS,e)}createRenderer(){const e=new Bc().addAttribute("float a_prop_weight").addVarying("v_prop_weight","float","a_prop_weight").addUniform("float u_size").addUniform("float u_blurSlope").setSymbolSizeExpression("vec2(u_size)").setSymbolColorExpression("vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * u_blurSlope) * v_prop_weight)");return new Uc(this,{className:this.getClassName(),attributes:[{name:"weight",callback:t=>{const n=this.weightFunction_(t);return n!==void 0?ve(n,0,1):1}}],uniforms:{u_size:()=>(this.get(et.RADIUS)+this.get(et.BLUR))*2,u_blurSlope:()=>this.get(et.RADIUS)/Math.max(1,this.get(et.BLUR))},hitDetectionEnabled:!0,vertexShader:e.getSymbolVertexShader(),fragmentShader:e.getSymbolFragmentShader(),postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}renderDeclutter(){}}function Xy(r){const n=Tt(1,256),i=n.createLinearGradient(0,0,1,256),s=1/(r.length-1);for(let o=0,a=r.length;o<a;++o)i.addColorStop(o*s,r[o]);return n.fillStyle=i,n.fillRect(0,0,1,256),n.canvas}const Yy=Hy;class qy extends Yl{constructor(e,t,n,i,s){const o=s!==void 0?Bt.IDLE:Bt.LOADED;super(e,t,n,o),this.loader_=s!==void 0?s:null,this.canvas_=i,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=Bt.ERROR):this.state=Bt.LOADED,this.changed()}load(){this.state==Bt.IDLE&&(this.state=Bt.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}const $s=qy;class Ky extends Zh{constructor(e){super(e),this.vectorRenderer_=new Wh(e),this.layerImageRatio_=e.getImageRatio(),this.coordinateToVectorPixelTransform_=it(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(e){if(!this.vectorRenderer_)return Promise.resolve([]);const t=en(this.coordinateToVectorPixelTransform_,en(this.renderedPixelToCoordinateTransform_,e.slice()));return this.vectorRenderer_.getFeatures(t)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(e){const t=e.pixelRatio,n=e.viewState,i=n.resolution,s=e.viewHints,o=this.vectorRenderer_;let a=e.extent;this.layerImageRatio_!==1&&(a=a.slice(0),ql(a,this.layerImageRatio_));const l=Xe(a)/i,c=Ot(a)/i;if(!s[Gn.ANIMATING]&&!s[Gn.INTERACTING]&&!hs(a)){o.useContainer(null,null);const h=o.context,f=e.layerStatesArray[e.layerIndex],d=Object.assign({},f,{opacity:1}),g=Object.assign({},e,{extent:a,size:[l,c],viewState:Object.assign({},e.viewState,{rotation:0}),layerStatesArray:[d],layerIndex:0,declutter:null}),m=this.getLayer().getDeclutter();m&&(g.declutter={[m]:new Hh(9)});let _=!0;const x=new $s(a,i,t,h.canvas,function(w){o.prepareFrame(g)&&o.replayGroupChanged&&(o.clipping=!1,o.renderFrame(g,null)&&(o.renderDeclutter(g),o.renderDeferred(g),_=!1),w())});x.addEventListener(je.CHANGE,()=>{if(x.getState()!==Bt.LOADED)return;this.image_=_?null:x;const w=x.getPixelRatio(),E=Xh(x.getResolution())*t/w;this.renderedResolution=E,this.coordinateToVectorPixelTransform_=fs(this.coordinateToVectorPixelTransform_,l/2,c/2,1/E,-1/E,0,-n.center[0],-n.center[1])}),x.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!!this.image_}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(e,t,n,i,s){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,t,n,i,s):super.forEachFeatureAtCoordinate(e,t,n,i,s)}}const Qy=Ky;class Jy extends ps{constructor(e){e=e||{};const t=Object.assign({},e);delete t.imageRatio,super(t),this.imageRatio_=e.imageRatio!==void 0?e.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new Qy(this)}}const e_=Jy;function q(r,e,t){const n=Yh();return n.style=r.style,jy(e,t,n,r)}function fa(r){const e=tn(r),t=e[0]*256,n=e[1],i=e[2]*256,s=Math.round(e[3]*255);return[t+n,i+s]}const t_=`vec4 unpackColor(vec2 packedColor) {
  return fract(packedColor[1] / 256.0) * vec4(
    fract(floor(packedColor[0] / 256.0) / 256.0),
    fract(packedColor[0] / 256.0),
    fract(floor(packedColor[1] / 256.0) / 256.0),
    1.0
  );
}`;function $c(r){return r===Ye?2:r===Qe?4:1}function Ri(r){const e=$c(r);return e>1?`vec${e}`:"float"}function Hn(r){return(JSON.stringify(r).split("").reduce((t,n)=>(t<<5)-t+n.charCodeAt(0),0)>>>0).toString()}function js(r,e,t,n){if(`${n}radius`in r&&n!=="icon-"){let i=q(t,r[`${n}radius`],he);if(`${n}radius2`in r){const s=q(t,r[`${n}radius2`],he);i=`max(${i}, ${s})`}`${n}stroke-width`in r&&(i=`(${i} + ${q(t,r[`${n}stroke-width`],he)} * 0.5)`),e.setSymbolSizeExpression(`vec2(${i} * 2. + 0.5)`)}if(`${n}scale`in r){const i=q(t,r[`${n}scale`],he|Qe);e.setSymbolSizeExpression(`${e.getSymbolSizeExpression()} * ${i}`)}`${n}displacement`in r&&e.setSymbolOffsetExpression(q(t,r[`${n}displacement`],Qe)),`${n}rotation`in r&&e.setSymbolRotationExpression(q(t,r[`${n}rotation`],he)),`${n}rotate-with-view`in r&&e.setSymbolRotateWithView(!!r[`${n}rotate-with-view`])}function jc(r,e,t,n,i){let s="vec4(0.)";if(e!==null&&(s=e),t!==null&&n!==null){const l=`smoothstep(-${n} + 0.63, -${n} - 0.58, ${r})`;s=`mix(${t}, ${s}, ${l})`}const o=`(1.0 - smoothstep(-0.63, 0.58, ${r}))`;let a=`${s} * ${o}`;return i!==null&&(a=`${a} * ${i}`),a}function Vs(r,e,t,n,i){const s=new Image;let o;return s.crossOrigin=r[`${n}cross-origin`]===void 0?"anonymous":r[`${n}cross-origin`],s.src=r[`${n}src`],s.complete&&s.width&&s.height?o=ks([s.width,s.height]):(t[`u_texture${i}_size`]=()=>s.complete?[s.width,s.height]:[0,0],e.addUniform(`vec2 u_texture${i}_size`),o=`u_texture${i}_size`),t[`u_texture${i}`]=s,e.addUniform(`sampler2D u_texture${i}`),o}function Zs(r,e,t,n,i){let s=q(t,r[`${e}offset`],Qe);if(`${e}offset-origin`in r)switch(r[`${e}offset-origin`]){case"top-right":s=`vec2(${n}.x, 0.) + ${i} * vec2(-1., 0.) + ${s} * vec2(-1., 1.)`;break;case"bottom-left":s=`vec2(0., ${n}.y) + ${i} * vec2(0., -1.) + ${s} * vec2(1., -1.)`;break;case"bottom-right":s=`${n} - ${i} - ${s}`;break}return s}function r_(r,e,t,n,i){i.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,js(r,e,n,"circle-");let s=null;"circle-opacity"in r&&(s=q(i,r["circle-opacity"],he));let o="coordsPx";"circle-scale"in r&&(o=`coordsPx / ${q(i,r["circle-scale"],he|Qe)}`);let a=null;"circle-fill-color"in r&&(a=q(i,r["circle-fill-color"],Ye));let l=null;"circle-stroke-color"in r&&(l=q(i,r["circle-stroke-color"],Ye));let c=q(i,r["circle-radius"],he),h=null;"circle-stroke-width"in r&&(h=q(i,r["circle-stroke-width"],he),c=`(${c} + ${h} * 0.5)`);const f=`circleDistanceField(${o}, ${c})`,d=jc(f,a,l,h,s);e.setSymbolColorExpression(d)}function n_(r,e,t,n,i){i.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,i.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,i.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,js(r,e,n,"shape-");let s=null;"shape-opacity"in r&&(s=q(i,r["shape-opacity"],he));let o="coordsPx";"shape-scale"in r&&(o=`coordsPx / ${q(i,r["shape-scale"],he|Qe)}`);let a=null;"shape-fill-color"in r&&(a=q(i,r["shape-fill-color"],Ye));let l=null;"shape-stroke-color"in r&&(l=q(i,r["shape-stroke-color"],Ye));let c=null;"shape-stroke-width"in r&&(c=q(i,r["shape-stroke-width"],he));const h=q(i,r["shape-points"],he);let f="0.";"shape-angle"in r&&(f=q(i,r["shape-angle"],he));let d,g=q(i,r["shape-radius"],he);if(c!==null&&(g=`${g} + ${c} * 0.5`),"shape-radius2"in r){let _=q(i,r["shape-radius2"],he);c!==null&&(_=`${_} + ${c} * 0.5`),d=`starDistanceField(${o}, ${h}, ${g}, ${_}, ${f})`}else d=`regularDistanceField(${o}, ${h}, ${g}, ${f})`;const m=jc(d,a,l,c,s);e.setSymbolColorExpression(m)}function i_(r,e,t,n,i){let s="vec4(1.0)";"icon-color"in r&&(s=q(i,r["icon-color"],Ye)),"icon-opacity"in r&&(s=`${s} * ${q(i,r["icon-opacity"],he)}`);const o=Hn(r["icon-src"]),a=Vs(r,e,t,"icon-",o);if(e.setSymbolColorExpression(`${s} * samplePremultiplied(u_texture${o}, v_texCoord)`).setSymbolSizeExpression(a),"icon-width"in r&&"icon-height"in r&&e.setSymbolSizeExpression(`vec2(${q(n,r["icon-width"],he)}, ${q(n,r["icon-height"],he)})`),"icon-offset"in r&&"icon-size"in r){const l=q(n,r["icon-size"],Qe),c=e.getSymbolSizeExpression();e.setSymbolSizeExpression(l);const h=Zs(r,"icon-",n,"v_quadSizePx",l);e.setTextureCoordinateExpression(`(vec4((${h}).xyxy) + vec4(0., 0., ${l})) / (${c}).xyxy`)}if(js(r,e,n,"icon-"),"icon-anchor"in r){const l=q(n,r["icon-anchor"],Qe);let c="1.0";"icon-scale"in r&&(c=q(n,r["icon-scale"],he|Qe));let h;r["icon-anchor-x-units"]==="pixels"&&r["icon-anchor-y-units"]==="pixels"?h=`${l} * ${c}`:r["icon-anchor-x-units"]==="pixels"?h=`${l} * vec2(vec2(${c}).x, v_quadSizePx.y)`:r["icon-anchor-y-units"]==="pixels"?h=`${l} * vec2(v_quadSizePx.x, vec2(${c}).x)`:h=`${l} * v_quadSizePx`;let f=`v_quadSizePx * vec2(0.5, -0.5) + ${h} * vec2(-1., 1.)`;if("icon-anchor-origin"in r)switch(r["icon-anchor-origin"]){case"top-right":f=`v_quadSizePx * -0.5 + ${h}`;break;case"bottom-left":f=`v_quadSizePx * 0.5 - ${h}`;break;case"bottom-right":f=`v_quadSizePx * vec2(-0.5, 0.5) + ${h} * vec2(1., -1.)`;break}e.setSymbolOffsetExpression(`${e.getSymbolOffsetExpression()} + ${f}`)}}function s_(r,e,t,n,i){if("stroke-color"in r&&e.setStrokeColorExpression(q(i,r["stroke-color"],Ye)),"stroke-pattern-src"in r){const s=Hn(r["stroke-pattern-src"]),o=Vs(r,e,t,"stroke-pattern-",s);let a=o,l="vec2(0.)";"stroke-pattern-offset"in r&&"stroke-pattern-size"in r&&(a=q(i,r["stroke-pattern-size"],Qe),l=Zs(r,"stroke-pattern-",i,o,a));let c="0.";"stroke-pattern-spacing"in r&&(c=q(i,r["stroke-pattern-spacing"],he)),i.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = currentLengthPx * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return samplePremultiplied(texture, texCoord);
}`;const h=`u_texture${s}`;let f="1.";"stroke-color"in r&&(f=e.getStrokeColorExpression()),e.setStrokeColorExpression(`${f} * sampleStrokePattern(${h}, ${o}, ${l}, ${a}, ${c}, currentLengthPx, currentRadiusRatio, v_width)`)}if("stroke-width"in r&&e.setStrokeWidthExpression(q(n,r["stroke-width"],he)),"stroke-offset"in r&&e.setStrokeOffsetExpression(q(n,r["stroke-offset"],he)),"stroke-line-cap"in r&&e.setStrokeCapExpression(q(n,r["stroke-line-cap"],pr)),"stroke-line-join"in r&&e.setStrokeJoinExpression(q(n,r["stroke-line-join"],pr)),"stroke-miter-limit"in r&&e.setStrokeMiterLimitExpression(q(n,r["stroke-miter-limit"],he)),"stroke-line-dash"in r){i.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${Et("square")}) {
    distanceSegment -= v_width * 0.5;
  } else if (capType == ${Et("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - v_width * 0.5);
  }
  return distanceSegment;
}`;let s=r["stroke-line-dash"].map(g=>q(i,g,he));s.length%2===1&&(s=[...s,...s]);let o="0.";"stroke-line-dash-offset"in r&&(o=q(n,r["stroke-line-dash-offset"],he));const l=`dashDistanceField_${Hn(r["stroke-line-dash"])}`,c=s.map((g,m)=>`float dashLength${m} = ${g};`),h=s.map((g,m)=>`dashLength${m}`).join(" + ");let f="0.",d=`getSingleDashDistance(distance, radius, ${f}, dashLength0, totalDashLength, capType)`;for(let g=2;g<s.length;g+=2)f=`${f} + dashLength${g-2} + dashLength${g-1}`,d=`min(${d}, getSingleDashDistance(distance, radius, ${f}, dashLength${g}, totalDashLength, capType))`;i.functions[l]=`float ${l}(float distance, float radius, float capType) {
  ${c.join(`
  `)}
  float totalDashLength = ${h};
  return ${d};
}`,e.setStrokeDistanceFieldExpression(`${l}(currentLengthPx + ${o}, currentRadiusPx, capType)`)}}function o_(r,e,t,n,i){if("fill-color"in r&&e.setFillColorExpression(q(i,r["fill-color"],Ye)),"fill-pattern-src"in r){const s=Hn(r["fill-pattern-src"]),o=Vs(r,e,t,"fill-pattern-",s);let a=o,l="vec2(0.)";"fill-pattern-offset"in r&&"fill-pattern-size"in r&&(a=q(i,r["fill-pattern-size"],Qe),l=Zs(r,"fill-pattern-",i,o,a)),i.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return samplePremultiplied(texture, (samplePos + textureOffset) / textureSize);
}`;const c=`u_texture${s}`;let h="1.";"fill-color"in r&&(h=e.getFillColorExpression()),e.setFillColorExpression(`${h} * sampleFillPattern(${c}, ${o}, ${l}, ${a}, pxOrigin, pxPos)`)}}function a_(r){const e={inFragmentShader:!1,properties:{},variables:{},functions:{},style:r},t={inFragmentShader:!0,variables:e.variables,properties:{},functions:{},style:r},n=new Bc,i={};if("icon-src"in r?i_(r,n,i,e,t):"shape-points"in r?n_(r,n,i,e,t):"circle-radius"in r&&r_(r,n,i,e,t),s_(r,n,i,e,t),o_(r,n,i,e,t),r.filter){const o=q(t,r.filter,bn);n.setFragmentDiscardExpression(`!${o}`)}Object.keys(t.variables).forEach(function(o){const a=t.variables[o],l=zs(a.name);n.addUniform(`${Ri(a.type)} ${l}`);let c;a.type===pr?c=()=>Wn(r.variables[a.name]):a.type===Ye?c=()=>fa([...tn(r.variables[a.name]||"#eee")]):a.type===bn?c=()=>r.variables[a.name]?1:0:c=()=>r.variables[a.name],i[l]=c}),Object.keys(t.properties).forEach(function(o){const a=t.properties[o];e.properties[o]||(e.properties[o]=a);let l=Ri(a.type),c=`a_prop_${a.name}`;a.type===Ye&&(l="vec4",c=`unpackColor(${c})`,n.addVertexShaderFunction(t_)),n.addVarying(`v_prop_${a.name}`,l,c)}),Object.keys(e.properties).forEach(function(o){const a=e.properties[o];n.addAttribute(`${Ri(a.type)} a_prop_${a.name}`)});const s=Object.keys(e.properties).map(function(o){const a=e.properties[o];let l;return a.evaluator?l=a.evaluator:a.type===pr?l=c=>Wn(c.get(a.name)):a.type===Ye?l=c=>fa([...tn(c.get(a.name)||"#eee")]):a.type===bn?l=c=>c.get(a.name)?1:0:l=c=>c.get(a.name),{name:a.name,size:$c(a.type),callback:l}});for(const o in e.functions)n.addVertexShaderFunction(e.functions[o]);for(const o in t.functions)n.addFragmentShaderFunction(t.functions[o]);return{builder:n,attributes:s.reduce((o,a)=>({...o,[a.name]:{callback:a.callback,size:a.size}}),{}),uniforms:i}}class l_ extends Kl{constructor(e){const t=Object.assign({},e);super(t),this.parseResult_=a_(e.style),this.styleVariables_=e.style.variables||{},this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){const e=Object.keys(this.parseResult_.attributes).map(t=>({name:t,...this.parseResult_.attributes[t]}));return new Uc(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitDetectionEnabled:!this.hitDetectionDisabled_,uniforms:this.parseResult_.uniforms,attributes:e})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}const c_=l_;function da(r,e){const t=`
    attribute vec2 ${Pn.TEXTURE_COORD};
    uniform mat4 ${K.TILE_TRANSFORM};
    uniform float ${K.TEXTURE_PIXEL_WIDTH};
    uniform float ${K.TEXTURE_PIXEL_HEIGHT};
    uniform float ${K.TEXTURE_RESOLUTION};
    uniform float ${K.TEXTURE_ORIGIN_X};
    uniform float ${K.TEXTURE_ORIGIN_Y};
    uniform float ${K.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${Pn.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${K.TEXTURE_ORIGIN_X} + ${K.TEXTURE_RESOLUTION} * ${K.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${K.TEXTURE_ORIGIN_Y} - ${K.TEXTURE_RESOLUTION} * ${K.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${K.TILE_TRANSFORM} * vec4(${Pn.TEXTURE_COORD}, ${K.DEPTH}, 1.0);
    }
  `,n={...$y(),inFragmentShader:!0,bandCount:e,style:r},i=[];if(r.color!==void 0){const f=q(n,r.color,Ye);i.push(`color = ${f};`)}if(r.contrast!==void 0){const f=q(n,r.contrast,he);i.push(`color.rgb = clamp((${f} + 1.0) * color.rgb - (${f} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(r.exposure!==void 0){const f=q(n,r.exposure,he);i.push(`color.rgb = clamp((${f} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(r.saturation!==void 0){const f=q(n,r.saturation,he);i.push(`
      float saturation = ${f} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(r.gamma!==void 0){const f=q(n,r.gamma,he);i.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${f}));`)}if(r.brightness!==void 0){const f=q(n,r.brightness,he);i.push(`color.rgb = clamp(color.rgb + ${f}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=Object.keys(n.variables).length;if(o>1&&!r.variables)throw new Error(`Missing variables in style (expected ${n.variables})`);for(let f=0;f<o;++f){const d=n.variables[Object.keys(n.variables)[f]];if(!(d.name in r.variables))throw new Error(`Missing '${d.name}' in style variables`);const g=zs(d.name);s[g]=function(){let m=r.variables[d.name];return typeof m=="string"&&(m=Wn(m)),m!==void 0?m:-9999999}}const a=Object.keys(s).map(function(f){return`uniform float ${f};`}),l=Math.ceil(e/4);a.push(`uniform sampler2D ${K.TILE_TEXTURE_ARRAY}[${l}];`),n.paletteTextures&&a.push(`uniform sampler2D ${zc}[${n.paletteTextures.length}];`);const c=Object.keys(n.functions).map(function(f){return n.functions[f]}),h=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${K.RENDER_EXTENT};
    uniform float ${K.TRANSITION_ALPHA};
    uniform float ${K.TEXTURE_PIXEL_WIDTH};
    uniform float ${K.TEXTURE_PIXEL_HEIGHT};
    uniform float ${K.RESOLUTION};
    uniform float ${K.ZOOM};

    ${a.join(`
`)}

    ${c.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${K.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${K.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${K.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${K.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${K.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${i.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${K.TRANSITION_ALPHA};
    }`;return{vertexShader:t,fragmentShader:h,uniforms:s,paletteTextures:n.paletteTextures}}class Vc extends qh{constructor(e){e=e?Object.assign({},e):{};const t=e.style||{};delete e.style;const n=e.cacheSize;delete e.cacheSize,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.cacheSize_=n,this.styleVariables_=this.style_.variables||{},this.addChangeListener(jl.SOURCE,this.handleSourceUpdate_)}getSources(e,t){const n=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(e,t):this.sources_:n?[n]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=da(this.style_,this.getSourceBandCount_());return new ky(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.cacheSize_,paletteTextures:e.paletteTextures})}renderSources(e,t){const n=this.getRenderer();let i;for(let s=0,o=t.length;s<o;++s)this.renderedSource_=t[s],n.prepareFrame(e)&&(i=n.renderFrame(e));return i}render(e,t){this.rendered=!0;const n=e.viewState,i=this.getSources(e.extent,n.resolution);let s=!0;for(let a=0,l=i.length;a<l;++a){const c=i[a],h=c.getState();if(h=="loading"){const f=()=>{c.getState()=="ready"&&(c.removeEventListener("change",f),this.changed())};c.addEventListener("change",f)}s=s&&h=="ready"}const o=this.renderSources(e,i);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=n.resolution,o;if(this.renderedResolution_>.5*n.resolution){const a=this.getSources(e.extent,this.renderedResolution_).filter(l=>!i.includes(l));if(a.length>0)return this.renderSources(e,a)}return o}setStyle(e){this.styleVariables_=e.variables||{},this.style_=e;const t=da(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}Vc.prototype.dispose;const Qi=Vc,u_=Object.freeze(Object.defineProperty({__proto__:null,Graticule:Dm,Group:Ql,Heatmap:Yy,Image:ys,Layer:Kl,Tile:Un,Vector:us,VectorImage:e_,VectorTile:Jl,WebGLPoints:c_,WebGLTile:Qi},Symbol.toStringTag,{value:"Module"}));function h_(r){const e=r[0],t=new Array(e);let n=1<<e-1,i,s;for(i=0;i<e;++i)s=48,r[1]&n&&(s+=1),r[2]&n&&(s+=2),t[i]=String.fromCharCode(s),n>>=1;return t.join("")}const f_='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>';class d_ extends Ft{constructor(e){const t=e.hidpi!==void 0?e.hidpi:!1;super({cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,opaque:!0,projection:ye("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.hidpi_=t,this.culture_=e.culture!==void 0?e.culture:"en-us",this.maxZoom_=e.maxZoom!==void 0?e.maxZoom:-1,this.apiKey_=e.key,this.imagerySet_=e.imagerySet,this.placeholderTiles_=e.placeholderTiles;const n="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(n).then(i=>i.json()).then(i=>this.handleImageryMetadataResponse(i))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(e){if(e.statusCode!=200||e.statusDescription!="OK"||e.authenticationResultCode!="ValidCredentials"||e.resourceSets.length!=1||e.resourceSets[0].resources.length!=1){this.setState("error");return}const t=e.resourceSets[0].resources[0],n=this.maxZoom_==-1?t.zoomMax:this.maxZoom_,i=this.getProjection(),s=un(i),o=this.hidpi_?2:1,a=t.imageWidth==t.imageHeight?t.imageWidth/o:[t.imageWidth/o,t.imageHeight/o],l=hn({extent:s,minZoom:t.zoomMin,maxZoom:n,tileSize:a});this.tileGrid=l;const c=this.culture_,h=this.hidpi_,f=this.placeholderTiles_;if(this.tileUrlFunction=ec(t.imageUrlSubdomains.map(function(d){const g=[0,0,0],m=t.imageUrl.replace("{subdomain}",d).replace("{culture}",c);return function(_,x,w){if(!_)return;Bi(_[0],_[1],_[2],g);const E=new URL(m.replace("{quadkey}",h_(g))),v=E.searchParams;return h&&(v.set("dpi","d1"),v.set("device","mobile")),f===!0?v.delete("n"):f===!1&&v.set("n","z"),E.toString()}})),t.imageryProviders){const d=_s(ye("EPSG:4326"),this.getProjection());this.setAttributions(g=>{const m=[],_=g.viewState,x=this.getTileGrid(),w=x.getZForResolution(_.resolution,this.zDirection),v=x.getTileCoordForCoordAndZ(_.center,w)[0];return t.imageryProviders.map(function(S){let A=!1;const O=S.coverageAreas;for(let I=0,F=O.length;I<F;++I){const U=O[I];if(v>=U.zoomMin&&v<=U.zoomMax){const B=U.bbox,V=[B[1],B[0],B[3],B[2]],J=Jr(V,d);if(dr(J,g.extent)){A=!0;break}}}A&&m.push(S.attribution)}),m.push(f_),m})}this.setState("ready")}}const p_=d_;class g_ extends gr{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,maxZoom:e.maxZoom!==void 0?e.maxZoom:18,minZoom:e.minZoom,projection:e.projection,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection}),this.account_=e.account,this.mapId_=e.map||"",this.config_=e.config||{},this.templateCache_={},this.initializeMap_()}getConfig(){return this.config_}updateConfig(e){Object.assign(this.config_,e),this.initializeMap_()}setConfig(e){this.config_=e||{},this.initializeMap_()}initializeMap_(){const e=JSON.stringify(this.config_);if(this.templateCache_[e]){this.applyTemplate_(this.templateCache_[e]);return}let t="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(t+="/named/"+this.mapId_);const n=new XMLHttpRequest;n.addEventListener("load",this.handleInitResponse_.bind(this,e)),n.addEventListener("error",this.handleInitError_.bind(this)),n.open("POST",t),n.setRequestHeader("Content-type","application/json"),n.send(JSON.stringify(this.config_))}handleInitResponse_(e,t){const n=t.target;if(!n.status||n.status>=200&&n.status<300){let i;try{i=JSON.parse(n.responseText)}catch{this.setState("error");return}this.applyTemplate_(i),this.templateCache_[e]=i,this.setState("ready")}else this.setState("error")}handleInitError_(e){this.setState("error")}applyTemplate_(e){const t="https://"+e.cdn_url.https+"/"+this.account_+"/api/v1/map/"+e.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(t)}}const m_=g_;class y_ extends Jn{constructor(e){super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(t){const n=t.getGeometry();return gt(!n||n.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),n},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,t,n){this.source.loadFeatures(e,t,n),t!==this.resolution&&(this.resolution=t,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(je.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(je.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,t){const n=e===0?0:Math.min(t,e)/e,i=e!==this.distance||this.interpolationRatio!==n;this.distance=e,this.minDistance=t,this.interpolationRatio=n,i&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=ds(),t=this.distance*this.resolution,n=this.source.getFeatures(),i={};for(let s=0,o=n.length;s<o;s++){const a=n[s];if(!(Ae(a)in i)){const l=this.geometryFunction(a);if(l){const c=l.getCoordinates();Kh(c,e),Vl(e,t,e);const h=this.source.getFeaturesInExtent(e).filter(function(f){const d=Ae(f);return d in i?!1:(i[d]=!0,!0)});this.features.push(this.createCluster(h,e))}}}}createCluster(e,t){const n=[0,0];for(let a=e.length-1;a>=0;--a){const l=this.geometryFunction(e[a]);l?Qh(n,l.getCoordinates()):e.splice(a,1)}Jh(n,1/e.length);const i=Lt(t),s=this.interpolationRatio,o=new nt([n[0]*(1-s)+i[0]*s,n[1]*(1-s)+i[1]*s]);return this.createCustomCluster_?this.createCustomCluster_(o,e):new qe({geometry:o,features:e})}}const __=y_;class x_ extends ei{constructor(e){const t=e.projection===void 0?"EPSG:3857":e.projection;let n=e.tileGrid;n===void 0&&t&&(n=hn({extent:un(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:n,opaque:e.opaque,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.tileSize_=e.tileSize?ft(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=e.bandCount===void 0?4:e.bandCount,this.tileGridForProjection_={},this.tileCacheForProjection_={}}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const t=this.getTileGrid();return t?ft(t.getTileSize(e)):[256,256]}getGutterForProjection(e){const t=this.getProjection();return!t||Ir(t,e)?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,t,n,i,s){const o=this.getTileCacheForProjection(i),a=kn(e,t,n);if(o.containsKey(a)){const x=o.get(a);if(x&&x.key==this.getKey())return x}const l=this.getTileGrid(),c=Math.max.apply(null,l.getResolutions().map((x,w)=>{const E=ft(l.getTileSize(w)),v=this.getTileSize(w);return Math.max(v[0]/E[0],v[1]/E[1])})),h=this.getTileGridForProjection(s),f=this.getTileGridForProjection(i),d=[e,t,n],g=this.getTileCoordForTileUrlFunction(d,i),m=Object.assign({sourceProj:s,sourceTileGrid:h,targetProj:i,targetTileGrid:f,tileCoord:d,wrappedTileCoord:g,pixelRatio:c,gutter:this.getGutterForProjection(s),getTileFunction:(x,w,E,v)=>this.getTile(x,w,E,v,s)},this.tileOptions),_=new Us(m);return _.key=this.getKey(),_}getTile(e,t,n,i,s){const o=this.getProjection();if(o&&s&&!Ir(o,s))return this.getReprojTile_(e,t,n,s,o);const a=this.getTileSize(e),l=kn(e,t,n);if(this.tileCache.containsKey(l))return this.tileCache.get(l);const c=this.loader_;function h(){return nf(function(){return c(e,t,n)})}const f=Object.assign({tileCoord:[e,t,n],loader:h,size:a},this.tileOptions),d=new Gs(f);return d.key=this.getKey(),d.addEventListener(je.CHANGE,this.handleTileChange_),this.tileCache.set(l,d),d}handleTileChange_(e){const t=e.target,n=Ae(t),i=t.getState();let s;i==Y.LOADING?(this.tileLoadingKeys_[n]=!0,s=xi.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=i==Y.ERROR?xi.TILELOADERROR:i==Y.LOADED?xi.TILELOADEND:void 0),s&&this.dispatchEvent(new ef(s,t))}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||Ir(t,e)))return this.tileGrid;const n=Ae(e);return n in this.tileGridForProjection_||(this.tileGridForProjection_[n]=tf(e)),this.tileGridForProjection_[n]}setTileGridForProjection(e,t){const n=ye(e);if(n){const i=Ae(n);i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=t)}}getTileCacheForProjection(e){const t=this.getProjection();if(!t||Ir(t,e))return this.tileCache;const n=Ae(e);return n in this.tileCacheForProjection_||(this.tileCacheForProjection_[n]=new rf(.1)),this.tileCacheForProjection_[n]}expireCache(e,t){const n=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==n?t:{});for(const i in this.tileCacheForProjection_){const s=this.tileCacheForProjection_[i];s.expireCache(s==n?t:{})}}clear(){super.clear();for(const e in this.tileCacheForProjection_)this.tileCacheForProjection_[e].clear()}}const Ws=x_;function Ne(r){return(e,...t)=>E_(r,e,t)}function Rr(r,e){return Ne(Zc(r,e).get)}const{apply:E_,construct:Mw,defineProperty:Fw,get:Nw,getOwnPropertyDescriptor:Zc,getPrototypeOf:Hs,has:Dw,ownKeys:w_,set:Gw,setPrototypeOf:Uw}=Reflect,{iterator:pn,species:kw,toStringTag:T_,for:zw}=Symbol,v_=Object,{create:Xs,defineProperty:S_,freeze:Bw,is:$w}=v_,R_=Array,b_=R_.prototype,Wc=b_[pn],P_=Ne(Wc),Hc=ArrayBuffer,A_=Hc.prototype;Rr(A_,"byteLength");const pa=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;pa&&Rr(pa.prototype,"byteLength");const Xc=Hs(Uint8Array);Xc.from;const ke=Xc.prototype;ke[pn];Ne(ke.keys);Ne(ke.values);Ne(ke.entries);Ne(ke.set);Ne(ke.reverse);Ne(ke.fill);Ne(ke.copyWithin);Ne(ke.sort);Ne(ke.slice);Ne(ke.subarray);Rr(ke,"buffer");Rr(ke,"byteOffset");Rr(ke,"length");Rr(ke,T_);const L_=Uint8Array,Yc=Uint16Array,Ys=Uint32Array,I_=Float32Array,on=Hs([][pn]()),qc=Ne(on.next),C_=Ne(function*(){}().next),O_=Hs(on),M_=DataView.prototype,F_=Ne(M_.getUint16),qs=WeakMap,Kc=qs.prototype,Qc=Ne(Kc.get),N_=Ne(Kc.set),Jc=new qs,D_=Xs(null,{next:{value:function(){const e=Qc(Jc,this);return qc(e)}},[pn]:{value:function(){return this}}});function G_(r){if(r[pn]===Wc&&on.next===qc)return r;const e=Xs(D_);return N_(Jc,e,P_(r)),e}const U_=new qs,k_=Xs(O_,{next:{value:function(){const e=Qc(U_,this);return C_(e)},writable:!0,configurable:!0}});for(const r of w_(on))r!=="next"&&S_(k_,r,Zc(on,r));const eu=new Hc(4),z_=new I_(eu),B_=new Ys(eu),ot=new Yc(512),at=new L_(512);for(let r=0;r<256;++r){const e=r-127;e<-27?(ot[r]=0,ot[r|256]=32768,at[r]=24,at[r|256]=24):e<-14?(ot[r]=1024>>-e-14,ot[r|256]=1024>>-e-14|32768,at[r]=-e-1,at[r|256]=-e-1):e<=15?(ot[r]=e+15<<10,ot[r|256]=e+15<<10|32768,at[r]=13,at[r|256]=13):e<128?(ot[r]=31744,ot[r|256]=64512,at[r]=24,at[r|256]=24):(ot[r]=31744,ot[r|256]=64512,at[r]=13,at[r|256]=13)}const Ks=new Ys(2048);for(let r=1;r<1024;++r){let e=r<<13,t=0;for(;!(e&8388608);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,Ks[r]=e|t}for(let r=1024;r<2048;++r)Ks[r]=939524096+(r-1024<<13);const br=new Ys(64);for(let r=1;r<31;++r)br[r]=r<<23;br[31]=1199570944;br[32]=2147483648;for(let r=33;r<63;++r)br[r]=2147483648+(r-32<<23);br[63]=3347054592;const tu=new Yc(64);for(let r=1;r<64;++r)r!==32&&(tu[r]=1024);function $_(r){const e=r>>10;return B_[0]=Ks[tu[e]+(r&1023)]+br[e],z_[0]}function ru(r,e,...t){return $_(F_(r,e,...G_(t)))}var Qs={exports:{}};function nu(r,e,t){const n=t&&t.debug||!1;n&&console.log("[xml-utils] getting "+e+" in "+r);const i=typeof r=="object"?r.outer:r,s=i.slice(0,i.indexOf(">")+1),o=['"',"'"];for(let a=0;a<o.length;a++){const l=o[a],c=e+"\\="+l+"([^"+l+"]*)"+l;n&&console.log("[xml-utils] pattern:",c);const f=new RegExp(c).exec(s);if(n&&console.log("[xml-utils] match:",f),f)return f[1]}}Qs.exports=nu;Qs.exports.default=nu;var j_=Qs.exports;const bi=ni(j_);var Js={exports:{}},eo={exports:{}},to={exports:{}};function iu(r,e,t){const i=new RegExp(e).exec(r.slice(t));return i?t+i.index:-1}to.exports=iu;to.exports.default=iu;var V_=to.exports,ro={exports:{}};function su(r,e,t){const i=new RegExp(e).exec(r.slice(t));return i?t+i.index+i[0].length-1:-1}ro.exports=su;ro.exports.default=su;var Z_=ro.exports,no={exports:{}};function ou(r,e){const t=new RegExp(e,"g"),n=r.match(t);return n?n.length:0}no.exports=ou;no.exports.default=ou;var W_=no.exports;const H_=V_,Pi=Z_,ga=W_;function au(r,e,t){const n=t&&t.debug||!1,i=!(t&&typeof t.nested===!1),s=t&&t.startIndex||0;n&&console.log("[xml-utils] starting findTagByName with",e," and ",t);const o=H_(r,`<${e}[ 
>/]`,s);if(n&&console.log("[xml-utils] start:",o),o===-1)return;const a=r.slice(o+e.length);let l=Pi(a,"^[^<]*[ /]>",0);const c=l!==-1&&a[l-1]==="/";if(n&&console.log("[xml-utils] selfClosing:",c),c===!1)if(i){let g=0,m=1,_=0;for(;(l=Pi(a,"[ /]"+e+">",g))!==-1;){const x=a.substring(g,l+1);if(m+=ga(x,"<"+e+`[ 
	>]`),_+=ga(x,"</"+e+">"),_>=m)break;g=l}}else l=Pi(a,"[ /]"+e+">",0);const h=o+e.length+l+1;if(n&&console.log("[xml-utils] end:",h),h===-1)return;const f=r.slice(o,h);let d;return c?d=null:d=f.slice(f.indexOf(">")+1,f.lastIndexOf("<")),{inner:d,outer:f,start:o,end:h}}eo.exports=au;eo.exports.default=au;var X_=eo.exports;const Y_=X_;function lu(r,e,t){const n=[],i=t&&t.debug||!1,s=t&&typeof t.nested=="boolean"?t.nested:!0;let o=t&&t.startIndex||0,a;for(;a=Y_(r,e,{debug:i,startIndex:o});)s?o=a.start+1+e.length:o=a.end,n.push(a);return i&&console.log("findTagsByName found",n.length,"tags"),n}Js.exports=lu;Js.exports.default=lu;var q_=Js.exports;const K_=ni(q_),Yr={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},lt={};for(const r in Yr)Yr.hasOwnProperty(r)&&(lt[Yr[r]]=parseInt(r,10));const Q_=[lt.BitsPerSample,lt.ExtraSamples,lt.SampleFormat,lt.StripByteCounts,lt.StripOffsets,lt.StripRowCounts,lt.TileByteCounts,lt.TileOffsets,lt.SubIFDs],Ai={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},ee={};for(const r in Ai)Ai.hasOwnProperty(r)&&(ee[Ai[r]]=parseInt(r,10));const ze={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},J_={Unspecified:0,Assocalpha:1,Unassalpha:2},jw={Version:0,AddCompression:1},Vw={None:0,Deflate:1,Zstandard:2},e0={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function t0(r,e){const{width:t,height:n}=r,i=new Uint8Array(t*n*3);let s;for(let o=0,a=0;o<r.length;++o,a+=3)s=256-r[o]/e*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function r0(r,e){const{width:t,height:n}=r,i=new Uint8Array(t*n*3);let s;for(let o=0,a=0;o<r.length;++o,a+=3)s=r[o]/e*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function n0(r,e){const{width:t,height:n}=r,i=new Uint8Array(t*n*3),s=e.length/3,o=e.length/3*2;for(let a=0,l=0;a<r.length;++a,l+=3){const c=r[a];i[l]=e[c]/65536*256,i[l+1]=e[c+s]/65536*256,i[l+2]=e[c+o]/65536*256}return i}function i0(r){const{width:e,height:t}=r,n=new Uint8Array(e*t*3);for(let i=0,s=0;i<r.length;i+=4,s+=3){const o=r[i],a=r[i+1],l=r[i+2],c=r[i+3];n[s]=255*((255-o)/256)*((255-c)/256),n[s+1]=255*((255-a)/256)*((255-c)/256),n[s+2]=255*((255-l)/256)*((255-c)/256)}return n}function s0(r){const{width:e,height:t}=r,n=new Uint8ClampedArray(e*t*3);for(let i=0,s=0;i<r.length;i+=3,s+=3){const o=r[i],a=r[i+1],l=r[i+2];n[s]=o+1.402*(l-128),n[s+1]=o-.34414*(a-128)-.71414*(l-128),n[s+2]=o+1.772*(a-128)}return n}const o0=.95047,a0=1,l0=1.08883;function c0(r){const{width:e,height:t}=r,n=new Uint8Array(e*t*3);for(let i=0,s=0;i<r.length;i+=3,s+=3){const o=r[i+0],a=r[i+1]<<24>>24,l=r[i+2]<<24>>24;let c=(o+16)/116,h=a/500+c,f=c-l/200,d,g,m;h=o0*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),c=a0*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),f=l0*(f*f*f>.008856?f*f*f:(f-16/116)/7.787),d=h*3.2406+c*-1.5372+f*-.4986,g=h*-.9689+c*1.8758+f*.0415,m=h*.0557+c*-.204+f*1.057,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,m=m>.0031308?1.055*m**(1/2.4)-.055:12.92*m,n[s]=Math.max(0,Math.min(1,d))*255,n[s+1]=Math.max(0,Math.min(1,g))*255,n[s+2]=Math.max(0,Math.min(1,m))*255}return n}const cu=new Map;function Dt(r,e){Array.isArray(r)||(r=[r]),r.forEach(t=>cu.set(t,e))}async function uu(r){const e=cu.get(r.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${r.Compression}`);const t=await e();return new t(r)}Dt([void 0,1],()=>Nt(()=>import("./raw-FjKAlyiw.js"),__vite__mapDeps([0,1]),import.meta.url).then(r=>r.default));Dt(5,()=>Nt(()=>import("./lzw-NamZKYVt.js"),__vite__mapDeps([2,1]),import.meta.url).then(r=>r.default));Dt(6,()=>{throw new Error("old style JPEG compression is not supported.")});Dt(7,()=>Nt(()=>import("./jpeg-rjh0axXg.js"),__vite__mapDeps([3,1]),import.meta.url).then(r=>r.default));Dt([8,32946],()=>Nt(()=>import("./deflate-EZWV29Lt.js"),__vite__mapDeps([4,5,1]),import.meta.url).then(r=>r.default));Dt(32773,()=>Nt(()=>import("./packbits-65YHJGuf.js"),__vite__mapDeps([6,1]),import.meta.url).then(r=>r.default));Dt(34887,()=>Nt(()=>import("./lerc-H1mRrgE4.js"),__vite__mapDeps([7,5,8,1,9,10,11,12,13]),import.meta.url).then(async r=>(await r.zstd.init(),r)).then(r=>r.default));Dt(50001,()=>Nt(()=>import("./webimage-NiQ987z3.js"),__vite__mapDeps([14,1]),import.meta.url).then(r=>r.default));function fi(r,e,t,n=1){return new(Object.getPrototypeOf(r)).constructor(e*t*n)}function u0(r,e,t,n,i){const s=e/n,o=t/i;return r.map(a=>{const l=fi(a,n,i);for(let c=0;c<i;++c){const h=Math.min(Math.round(o*c),t-1);for(let f=0;f<n;++f){const d=Math.min(Math.round(s*f),e-1),g=a[h*e+d];l[c*n+f]=g}}return l})}function fr(r,e,t){return(1-t)*r+t*e}function h0(r,e,t,n,i){const s=e/n,o=t/i;return r.map(a=>{const l=fi(a,n,i);for(let c=0;c<i;++c){const h=o*c,f=Math.floor(h),d=Math.min(Math.ceil(h),t-1);for(let g=0;g<n;++g){const m=s*g,_=m%1,x=Math.floor(m),w=Math.min(Math.ceil(m),e-1),E=a[f*e+x],v=a[f*e+w],S=a[d*e+x],A=a[d*e+w],O=fr(fr(E,v,_),fr(S,A,_),h%1);l[c*n+g]=O}}return l})}function f0(r,e,t,n,i,s="nearest"){switch(s.toLowerCase()){case"nearest":return u0(r,e,t,n,i);case"bilinear":case"linear":return h0(r,e,t,n,i);default:throw new Error(`Unsupported resampling method: '${s}'`)}}function d0(r,e,t,n,i,s){const o=e/n,a=t/i,l=fi(r,n,i,s);for(let c=0;c<i;++c){const h=Math.min(Math.round(a*c),t-1);for(let f=0;f<n;++f){const d=Math.min(Math.round(o*f),e-1);for(let g=0;g<s;++g){const m=r[h*e*s+d*s+g];l[c*n*s+f*s+g]=m}}}return l}function p0(r,e,t,n,i,s){const o=e/n,a=t/i,l=fi(r,n,i,s);for(let c=0;c<i;++c){const h=a*c,f=Math.floor(h),d=Math.min(Math.ceil(h),t-1);for(let g=0;g<n;++g){const m=o*g,_=m%1,x=Math.floor(m),w=Math.min(Math.ceil(m),e-1);for(let E=0;E<s;++E){const v=r[f*e*s+x*s+E],S=r[f*e*s+w*s+E],A=r[d*e*s+x*s+E],O=r[d*e*s+w*s+E],I=fr(fr(v,S,_),fr(A,O,_),h%1);l[c*n*s+g*s+E]=I}}}return l}function g0(r,e,t,n,i,s,o="nearest"){switch(o.toLowerCase()){case"nearest":return d0(r,e,t,n,i,s);case"bilinear":case"linear":return p0(r,e,t,n,i,s);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function m0(r,e,t){let n=0;for(let i=e;i<t;++i)n+=r[i];return n}function Ji(r,e,t){switch(r){case 1:if(e<=8)return new Uint8Array(t);if(e<=16)return new Uint16Array(t);if(e<=32)return new Uint32Array(t);break;case 2:if(e===8)return new Int8Array(t);if(e===16)return new Int16Array(t);if(e===32)return new Int32Array(t);break;case 3:switch(e){case 16:case 32:return new Float32Array(t);case 64:return new Float64Array(t)}break}throw Error("Unsupported data format/bitsPerSample")}function y0(r,e){return(r===1||r===2)&&e<=32&&e%8===0?!1:!(r===3&&(e===16||e===32||e===64))}function _0(r,e,t,n,i,s,o){const a=new DataView(r),l=t===2?o*s:o*s*n,c=t===2?1:n,h=Ji(e,i,l),f=parseInt("1".repeat(i),2);if(e===1){let d;t===1?d=n*i:d=i;let g=s*d;g&7&&(g=g+7&-8);for(let m=0;m<o;++m){const _=m*g;for(let x=0;x<s;++x){const w=_+x*c*i;for(let E=0;E<c;++E){const v=w+E*i,S=(m*s+x)*c+E,A=Math.floor(v/8),O=v%8;if(O+i<=8)h[S]=a.getUint8(A)>>8-i-O&f;else if(O+i<=16)h[S]=a.getUint16(A)>>16-i-O&f;else if(O+i<=24){const I=a.getUint16(A)<<8|a.getUint8(A+2);h[S]=I>>24-i-O&f}else h[S]=a.getUint32(A)>>32-i-O&f}}}}return h.buffer}class x0{constructor(e,t,n,i,s,o){this.fileDirectory=e,this.geoKeys=t,this.dataView=n,this.littleEndian=i,this.tiles=s?{}:null,this.isTiled=!e.StripOffsets;const a=e.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,n=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(n<=8)return DataView.prototype.getUint8;if(n<=16)return DataView.prototype.getUint16;if(n<=32)return DataView.prototype.getUint32;break;case 2:if(n<=8)return DataView.prototype.getInt8;if(n<=16)return DataView.prototype.getInt16;if(n<=32)return DataView.prototype.getInt32;break;case 3:switch(n){case 16:return function(i,s){return ru(this,i,s)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const n=this.getSampleFormat(e),i=this.getBitsPerSample(e);return Ji(n,i,t)}async getTileOrStrip(e,t,n,i,s){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:c}=this;this.planarConfiguration===1?l=t*o+e:this.planarConfiguration===2&&(l=n*o*a+t*o+e);let h,f;this.isTiled?(h=this.fileDirectory.TileOffsets[l],f=this.fileDirectory.TileByteCounts[l]):(h=this.fileDirectory.StripOffsets[l],f=this.fileDirectory.StripByteCounts[l]);const d=(await this.source.fetch([{offset:h,length:f}],s))[0];let g;return c===null||!c[l]?(g=(async()=>{let m=await i.decode(this.fileDirectory,d);const _=this.getSampleFormat(),x=this.getBitsPerSample();return y0(_,x)&&(m=_0(m,_,this.planarConfiguration,this.getSamplesPerPixel(),x,this.getTileWidth(),this.getBlockHeight(t))),m})(),c!==null&&(c[l]=g)):g=c[l],{x:e,y:t,sample:n,data:await g}}async _readRaster(e,t,n,i,s,o,a,l,c){const h=this.getTileWidth(),f=this.getTileHeight(),d=this.getWidth(),g=this.getHeight(),m=Math.max(Math.floor(e[0]/h),0),_=Math.min(Math.ceil(e[2]/h),Math.ceil(d/h)),x=Math.max(Math.floor(e[1]/f),0),w=Math.min(Math.ceil(e[3]/f),Math.ceil(g/f)),E=e[2]-e[0];let v=this.getBytesPerPixel();const S=[],A=[];for(let F=0;F<t.length;++F)this.planarConfiguration===1?S.push(m0(this.fileDirectory.BitsPerSample,0,t[F])/8):S.push(0),A.push(this.getReaderForSample(t[F]));const O=[],{littleEndian:I}=this;for(let F=x;F<w;++F)for(let U=m;U<_;++U){let B;this.planarConfiguration===1&&(B=this.getTileOrStrip(U,F,0,s,c));for(let V=0;V<t.length;++V){const J=V,u=t[V];this.planarConfiguration===2&&(v=this.getSampleByteSize(u),B=this.getTileOrStrip(U,F,u,s,c));const p=B.then(y=>{const T=y.data,L=new DataView(T),C=this.getBlockHeight(y.y),M=y.y*f,N=y.x*h,z=M+C,Z=(y.x+1)*h,oe=A[J],se=Math.min(C,C-(z-e[3]),g-M),ce=Math.min(h,h-(Z-e[2]),d-N);for(let ae=Math.max(0,e[1]-M);ae<se;++ae)for(let _e=Math.max(0,e[0]-N);_e<ce;++_e){const Ce=(ae*h+_e)*v,Pe=oe.call(L,Ce+S[J],I);let Me;i?(Me=(ae+M-e[1])*E*t.length+(_e+N-e[0])*t.length+J,n[Me]=Pe):(Me=(ae+M-e[1])*E+_e+N-e[0],n[J][Me]=Pe)}});O.push(p)}}if(await Promise.all(O),o&&e[2]-e[0]!==o||a&&e[3]-e[1]!==a){let F;return i?F=g0(n,e[2]-e[0],e[3]-e[1],o,a,t.length,l):F=f0(n,e[2]-e[0],e[3]-e[1],o,a,l),F.width=o,F.height=a,F}return n.width=o||e[2]-e[0],n.height=a||e[3]-e[1],n}async readRasters({window:e,samples:t=[],interleave:n,pool:i=null,width:s,height:o,resampleMethod:a,fillValue:l,signal:c}={}){const h=e||[0,0,this.getWidth(),this.getHeight()];if(h[0]>h[2]||h[1]>h[3])throw new Error("Invalid subsets");const f=h[2]-h[0],d=h[3]-h[1],g=f*d,m=this.getSamplesPerPixel();if(!t||!t.length)for(let E=0;E<m;++E)t.push(E);else for(let E=0;E<t.length;++E)if(t[E]>=m)return Promise.reject(new RangeError(`Invalid sample index '${t[E]}'.`));let _;if(n){const E=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,v=Math.max.apply(null,this.fileDirectory.BitsPerSample);_=Ji(E,v,g*t.length),l&&_.fill(l)}else{_=[];for(let E=0;E<t.length;++E){const v=this.getArrayForSample(t[E],g);Array.isArray(l)&&E<l.length?v.fill(l[E]):l&&!Array.isArray(l)&&v.fill(l),_.push(v)}}const x=i||await uu(this.fileDirectory);return await this._readRaster(h,t,_,n,x,s,o,a,c)}async readRGB({window:e,interleave:t=!0,pool:n=null,width:i,height:s,resampleMethod:o,enableAlpha:a=!1,signal:l}={}){const c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const h=this.fileDirectory.PhotometricInterpretation;if(h===ze.RGB){let w=[0,1,2];if(this.fileDirectory.ExtraSamples!==J_.Unspecified&&a){w=[];for(let E=0;E<this.fileDirectory.BitsPerSample.length;E+=1)w.push(E)}return this.readRasters({window:e,interleave:t,samples:w,pool:n,width:i,height:s,resampleMethod:o,signal:l})}let f;switch(h){case ze.WhiteIsZero:case ze.BlackIsZero:case ze.Palette:f=[0];break;case ze.CMYK:f=[0,1,2,3];break;case ze.YCbCr:case ze.CIELab:f=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const d={window:c,interleave:!0,samples:f,pool:n,width:i,height:s,resampleMethod:o,signal:l},{fileDirectory:g}=this,m=await this.readRasters(d),_=2**this.fileDirectory.BitsPerSample[0];let x;switch(h){case ze.WhiteIsZero:x=t0(m,_);break;case ze.BlackIsZero:x=r0(m,_);break;case ze.Palette:x=n0(m,g.ColorMap);break;case ze.CMYK:x=i0(m);break;case ze.YCbCr:x=s0(m);break;case ze.CIELab:x=c0(m);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const w=new Uint8Array(x.length/3),E=new Uint8Array(x.length/3),v=new Uint8Array(x.length/3);for(let S=0,A=0;S<x.length;S+=3,++A)w[A]=x[S],E[A]=x[S+1],v[A]=x[S+2];x=[w,E,v]}return x.width=m.width,x.height=m.height,x}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const n=this.fileDirectory.GDAL_METADATA;let i=K_(n,"Item");e===null?i=i.filter(s=>bi(s,"sample")===void 0):i=i.filter(s=>Number(bi(s,"sample"))===e);for(let s=0;s<i.length;++s){const o=i[s];t[bi(o,"name")]=o.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,n=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(n)return[n[0],-n[5],n[10]];if(e){const[i,s,o]=e.getResolution();return[i*e.getWidth()/this.getWidth(),s*e.getHeight()/this.getHeight(),o*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(){const e=this.getHeight(),t=this.getWidth();if(this.fileDirectory.ModelTransformation){const[n,i,s,o,a,l,c,h]=this.fileDirectory.ModelTransformation,d=[[0,0],[0,e],[t,0],[t,e]].map(([_,x])=>[o+n*_+i*x,h+a*_+l*x]),g=d.map(_=>_[0]),m=d.map(_=>_[1]);return[Math.min(...g),Math.min(...m),Math.max(...g),Math.max(...m)]}else{const n=this.getOrigin(),i=this.getResolution(),s=n[0],o=n[1],a=s+i[0]*this.getWidth(),l=o+i[1]*this.getHeight();return[Math.min(s,a),Math.min(o,l),Math.max(s,a),Math.max(o,l)]}}}const hu=x0;class E0{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const n=this.getUint32(e,t),i=this.getUint32(e+4,t);let s;if(t){if(s=n+2**32*i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*n+i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}getInt64(e,t){let n=0;const i=(this._dataView.getUint8(e+(t?7:0))&128)>0;let s=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(e+(t?o:7-o));i&&(s?a!==0&&(a=~(a-1)&255,s=!1):a=~a&255),n+=a*256**o}return i&&(n=-n),n}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return ru(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class w0{constructor(e,t,n,i){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=n,this._bigTiff=i}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),n=this.readUint32(e+4);let i;if(this._littleEndian){if(i=t+2**32*n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*t+n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}readInt64(e){let t=0;const n=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let i=!0;for(let s=0;s<8;s++){let o=this._dataView.getUint8(e+(this._littleEndian?s:7-s));n&&(i?o!==0&&(o=~(o-1)&255,i=!1):o=~o&255),t+=o*256**s}return n&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const T0=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class v0{constructor(e=T0,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise(n=>{Nt(()=>import("./decoder-YCn7QQ1o.js"),__vite__mapDeps([15,8]),import.meta.url).then(i=>{n(i.create)})}),this._awaitingDecoder.then(n=>{this._awaitingDecoder=null,this.workers=[];for(let i=0;i<e;i++)this.workers.push({worker:n(),idle:!0})}))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?uu(e).then(n=>n.decode(e,t)):new Promise(n=>{const i=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];i.idle=!1;const s=this.messageId++,o=a=>{a.data.id===s&&(i.idle=!0,n(a.data.decoded),i.worker.removeEventListener("message",o))};i.worker.addEventListener("message",o),i.worker.postMessage({fileDirectory:e,buffer:t,id:s},[t])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const S0=v0,ma=`\r
\r
`;function fu(r){if(typeof Object.fromEntries<"u")return Object.fromEntries(r);const e={};for(const[t,n]of r)e[t.toLowerCase()]=n;return e}function R0(r){const e=r.split(`\r
`).map(t=>{const n=t.split(":").map(i=>i.trim());return n[0]=n[0].toLowerCase(),n});return fu(e)}function b0(r){const[e,...t]=r.split(";").map(i=>i.trim()),n=t.map(i=>i.split("="));return{type:e,params:fu(n)}}function es(r){let e,t,n;return r&&([,e,t,n]=r.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),t=parseInt(t,10),n=parseInt(n,10)),{start:e,end:t,total:n}}function P0(r,e){let t=null;const n=new TextDecoder("ascii"),i=[],s=`--${e}`,o=`${s}--`;for(let a=0;a<10;++a)n.decode(new Uint8Array(r,a,s.length))===s&&(t=a);if(t===null)throw new Error("Could not find initial boundary");for(;t<r.byteLength;){const a=n.decode(new Uint8Array(r,t,Math.min(s.length+1024,r.byteLength-t)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(s))throw new Error("Part does not start with boundary");const l=a.substr(s.length+2);if(l.length===0)break;const c=l.indexOf(ma),h=R0(l.substr(0,c)),{start:f,end:d,total:g}=es(h["content-range"]),m=t+s.length+c+ma.length,_=parseInt(d,10)+1-parseInt(f,10);i.push({headers:h,data:r.slice(m,m+_),offset:f,length:_,fileSize:g}),t=m+_+4}return i}class io{async fetch(e,t=void 0){return Promise.all(e.map(n=>this.fetchSlice(n,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class A0 extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,n]of e)this.onEviction(t,n.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const n=t.get(e);return this._getItemValue(e,n)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield e)}for(const e of this.cache){const[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:n=this.maxAge}={}){const i=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],n=t.length-e;n<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(n>0&&this._emitEvictions(t.slice(0,n)),this.oldCache=new Map(t.slice(n)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}for(const e of this.oldCache){const[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const n=e[t],[i,s]=n;this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const n=e[t],[i,s]=n;this.cache.has(i)||this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[n,i]of this.entriesAscending())e.call(t,i,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function L0(r){return new Promise(e=>setTimeout(e,r))}function I0(r,e){const t=Array.isArray(r)?r:Array.from(r),n=Array.isArray(e)?e:Array.from(e);return t.map((i,s)=>[i,n[s]])}class mr extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,mr),this.name="AbortError"}}class C0 extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}const O0=C0;class M0{constructor(e,t,n=null){this.offset=e,this.length=t,this.data=n}get top(){return this.offset+this.length}}class ya{constructor(e,t,n){this.offset=e,this.length=t,this.blockIds=n}}class F0 extends io{constructor(e,{blockSize:t=65536,cacheSize:n=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new A0({maxSize:n,onEviction:(i,s)=>{this.evictedBlocks.set(i,s)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){const n=[],i=[],s=[];this.evictedBlocks.clear();for(const{offset:d,length:g}of e){let m=d+g;const{fileSize:_}=this;_!==null&&(m=Math.min(m,_));const x=Math.floor(d/this.blockSize)*this.blockSize;for(let w=x;w<m;w+=this.blockSize){const E=Math.floor(w/this.blockSize);!this.blockCache.has(E)&&!this.blockRequests.has(E)&&(this.blockIdsToFetch.add(E),i.push(E)),this.blockRequests.has(E)&&n.push(this.blockRequests.get(E)),s.push(E)}}await L0(),this.fetchBlocks(t);const o=[];for(const d of i)this.blockRequests.has(d)&&o.push(this.blockRequests.get(d));await Promise.allSettled(n),await Promise.allSettled(o);const a=[],l=s.filter(d=>this.abortedBlockIds.has(d)||!this.blockCache.has(d));if(l.forEach(d=>this.blockIdsToFetch.add(d)),l.length>0&&t&&!t.aborted){this.fetchBlocks(null);for(const d of l){const g=this.blockRequests.get(d);if(!g)throw new Error(`Block ${d} is not in the block requests`);a.push(g)}await Promise.allSettled(a)}if(t&&t.aborted)throw new mr("Request was aborted");const c=s.map(d=>this.blockCache.get(d)||this.evictedBlocks.get(d)),h=c.filter(d=>!d);if(h.length)throw new O0(h,"Request failed");const f=new Map(I0(s,c));return this.readSliceData(e,f)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const t=this.groupBlocks(this.blockIdsToFetch),n=this.source.fetch(t,e);for(let i=0;i<t.length;++i){const s=t[i];for(const o of s.blockIds)this.blockRequests.set(o,(async()=>{try{const a=(await n)[i],l=o*this.blockSize,c=l-a.offset,h=Math.min(c+this.blockSize,a.data.byteLength),f=a.data.slice(c,h),d=new M0(l,f.byteLength,f,o);this.blockCache.set(o,d),this.abortedBlockIds.delete(o)}catch(a){if(a.name==="AbortError")a.signal=e,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw a}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const t=Array.from(e).sort((o,a)=>o-a);if(t.length===0)return[];let n=[],i=null;const s=[];for(const o of t)i===null||i+1===o?(n.push(o),i=o):(s.push(new ya(n[0]*this.blockSize,n.length*this.blockSize,n)),n=[o],i=o);return s.push(new ya(n[0]*this.blockSize,n.length*this.blockSize,n)),s}readSliceData(e,t){return e.map(n=>{let i=n.offset+n.length;this.fileSize!==null&&(i=Math.min(this.fileSize,i));const s=Math.floor(n.offset/this.blockSize),o=Math.floor(i/this.blockSize),a=new ArrayBuffer(n.length),l=new Uint8Array(a);for(let c=s;c<=o;++c){const h=t.get(c),f=h.offset-n.offset,d=h.top-i;let g=0,m=0,_;f<0?g=-f:f>0&&(m=f),d<0?_=h.length-g:_=i-h.offset-g;const x=new Uint8Array(h.data,g,_);l.set(x,m)}return a})}}class so{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class oo{constructor(e){this.url=e}async request({headers:e,credentials:t,signal:n}={}){throw new Error("request is not implemented")}}class N0 extends so{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class D0 extends oo{constructor(e,t){super(e),this.credentials=t}async request({headers:e,credentials:t,signal:n}={}){const i=await fetch(this.url,{headers:e,credentials:t,signal:n});return new N0(i)}}class G0 extends so{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class U0 extends oo{constructRequest(e,t){return new Promise((n,i)=>{const s=new XMLHttpRequest;s.open("GET",this.url),s.responseType="arraybuffer";for(const[o,a]of Object.entries(e))s.setRequestHeader(o,a);s.onload=()=>{const o=s.response;n(new G0(s,o))},s.onerror=i,s.onabort=()=>i(new mr("Request aborted")),s.send(),t&&(t.aborted&&s.abort(),t.addEventListener("abort",()=>s.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}const Li={};class k0 extends so{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class z0 extends oo{constructor(e){super(e),this.parsedUrl=Li.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",Li)}constructRequest(e,t){return new Promise((n,i)=>{const s=this.httpApi.get({...this.parsedUrl,headers:e},o=>{const a=new Promise(l=>{const c=[];o.on("data",h=>{c.push(h)}),o.on("end",()=>{const h=Buffer.concat(c).buffer;l(h)}),o.on("error",i)});n(new k0(o,a))});s.on("error",i),t&&(t.aborted&&s.destroy(new mr("Request aborted")),t.addEventListener("abort",()=>s.destroy(new mr("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class ao extends io{constructor(e,t,n,i){super(),this.client=e,this.headers=t,this.maxRanges=n,this.allowFullFile=i,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length>1,Promise.all(e.map(n=>this.fetchSlice(n,t))))}async fetchSlices(e,t){const n=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:i,length:s})=>`${i}-${i+s}`).join(",")}`},signal:t});if(n.ok)if(n.status===206){const{type:i,params:s}=b0(n.getHeader("content-type"));if(i==="multipart/byteranges"){const f=P0(await n.getData(),s.boundary);return this._fileSize=f[0].fileSize||null,f}const o=await n.getData(),{start:a,end:l,total:c}=es(n.getHeader("content-range"));this._fileSize=c||null;const h=[{data:o,offset:a,length:l-a}];if(e.length>1){const f=await Promise.all(e.slice(1).map(d=>this.fetchSlice(d,t)));return h.concat(f)}return h}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const i=await n.getData();return this._fileSize=i.byteLength,[{data:i,offset:0,length:i.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,t){const{offset:n,length:i}=e,s=await this.client.request({headers:{...this.headers,Range:`bytes=${n}-${n+i}`},signal:t});if(s.ok)if(s.status===206){const o=await s.getData(),{total:a}=es(s.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:n,length:i}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await s.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function lo(r,{blockSize:e,cacheSize:t}){return e===null?r:new F0(r,{blockSize:e,cacheSize:t})}function B0(r,{headers:e={},credentials:t,maxRanges:n=0,allowFullFile:i=!1,...s}={}){const o=new D0(r,t),a=new ao(o,e,n,i);return lo(a,s)}function $0(r,{headers:e={},maxRanges:t=0,allowFullFile:n=!1,...i}={}){const s=new U0(r),o=new ao(s,e,t,n);return lo(o,i)}function j0(r,{headers:e={},maxRanges:t=0,allowFullFile:n=!1,...i}={}){const s=new z0(r),o=new ao(s,e,t,n);return lo(o,i)}function ts(r,{forceXHR:e=!1,...t}={}){return typeof fetch=="function"&&!e?B0(r,t):typeof XMLHttpRequest<"u"?$0(r,t):j0(r,t)}class V0 extends io{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise((n,i)=>{const s=this.file.slice(e.offset,e.offset+e.length),o=new FileReader;o.onload=a=>n(a.target.result),o.onerror=i,o.onabort=i,o.readAsArrayBuffer(s),t&&t.addEventListener("abort",()=>o.abort())})}}function Z0(r){return new V0(r)}function rs(r){switch(r){case ee.BYTE:case ee.ASCII:case ee.SBYTE:case ee.UNDEFINED:return 1;case ee.SHORT:case ee.SSHORT:return 2;case ee.LONG:case ee.SLONG:case ee.FLOAT:case ee.IFD:return 4;case ee.RATIONAL:case ee.SRATIONAL:case ee.DOUBLE:case ee.LONG8:case ee.SLONG8:case ee.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${r}`)}}function W0(r){const e=r.GeoKeyDirectory;if(!e)return null;const t={};for(let n=4;n<=e[3]*4;n+=4){const i=e0[e[n]],s=e[n+1]?Yr[e[n+1]]:null,o=e[n+2],a=e[n+3];let l=null;if(!s)l=a;else{if(l=r[s],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${i}'.`);typeof l=="string"?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),o===1&&(l=l[0]))}t[i]=l}return t}function Kt(r,e,t,n){let i=null,s=null;const o=rs(e);switch(e){case ee.BYTE:case ee.ASCII:case ee.UNDEFINED:i=new Uint8Array(t),s=r.readUint8;break;case ee.SBYTE:i=new Int8Array(t),s=r.readInt8;break;case ee.SHORT:i=new Uint16Array(t),s=r.readUint16;break;case ee.SSHORT:i=new Int16Array(t),s=r.readInt16;break;case ee.LONG:case ee.IFD:i=new Uint32Array(t),s=r.readUint32;break;case ee.SLONG:i=new Int32Array(t),s=r.readInt32;break;case ee.LONG8:case ee.IFD8:i=new Array(t),s=r.readUint64;break;case ee.SLONG8:i=new Array(t),s=r.readInt64;break;case ee.RATIONAL:i=new Uint32Array(t*2),s=r.readUint32;break;case ee.SRATIONAL:i=new Int32Array(t*2),s=r.readInt32;break;case ee.FLOAT:i=new Float32Array(t),s=r.readFloat32;break;case ee.DOUBLE:i=new Float64Array(t),s=r.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===ee.RATIONAL||e===ee.SRATIONAL)for(let a=0;a<t;a+=2)i[a]=s.call(r,n+a*o),i[a+1]=s.call(r,n+(a*o+4));else for(let a=0;a<t;++a)i[a]=s.call(r,n+a*o);return e===ee.ASCII?new TextDecoder("utf-8").decode(i):i}class H0{constructor(e,t,n){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=n}}class Rn extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class du{async readRasters(e={}){const{window:t,width:n,height:i}=e;let{resX:s,resY:o,bbox:a}=e;const l=await this.getImage();let c=l;const h=await this.getImageCount(),f=l.getBoundingBox();if(t&&a)throw new Error('Both "bbox" and "window" passed.');if(n||i){if(t){const[m,_]=l.getOrigin(),[x,w]=l.getResolution();a=[m+t[0]*x,_+t[1]*w,m+t[2]*x,_+t[3]*w]}const g=a||f;if(n){if(s)throw new Error("Both width and resX passed");s=(g[2]-g[0])/n}if(i){if(o)throw new Error("Both width and resY passed");o=(g[3]-g[1])/i}}if(s||o){const g=[];for(let m=0;m<h;++m){const _=await this.getImage(m),{SubfileType:x,NewSubfileType:w}=_.fileDirectory;(m===0||x===2||w&1)&&g.push(_)}g.sort((m,_)=>m.getWidth()-_.getWidth());for(let m=0;m<g.length;++m){const _=g[m],x=(f[2]-f[0])/_.getWidth(),w=(f[3]-f[1])/_.getHeight();if(c=_,s&&s>x||o&&o>w)break}}let d=t;if(a){const[g,m]=l.getOrigin(),[_,x]=c.getResolution(l);d=[Math.round((a[0]-g)/_),Math.round((a[1]-m)/x),Math.round((a[2]-g)/_),Math.round((a[3]-m)/x)],d=[Math.min(d[0],d[2]),Math.min(d[1],d[3]),Math.max(d[0],d[2]),Math.max(d[1],d[3])]}return c.readRasters({...e,window:d})}}let Xn=class pu extends du{constructor(e,t,n,i,s={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=n,this.firstIFDOffset=i,this.cache=s.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const n=this.bigTiff?4048:1024;return new w0((await this.source.fetch([{offset:e,length:typeof t<"u"?t:n}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,n=this.bigTiff?8:2;let i=await this.getSlice(e);const s=this.bigTiff?i.readUint64(e):i.readUint16(e),o=s*t+(this.bigTiff?16:6);i.covers(e,o)||(i=await this.getSlice(e,o));const a={};let l=e+(this.bigTiff?8:2);for(let f=0;f<s;l+=t,++f){const d=i.readUint16(l),g=i.readUint16(l+2),m=this.bigTiff?i.readUint64(l+4):i.readUint32(l+4);let _,x;const w=rs(g),E=l+(this.bigTiff?12:8);if(w*m<=(this.bigTiff?8:4))_=Kt(i,g,m,E);else{const v=i.readOffset(E),S=rs(g)*m;if(i.covers(v,S))_=Kt(i,g,m,v);else{const A=await this.getSlice(v,S);_=Kt(A,g,m,v)}}m===1&&Q_.indexOf(d)===-1&&!(g===ee.RATIONAL||g===ee.SRATIONAL)?x=_[0]:x=_,a[Yr[d]]=x}const c=W0(a),h=i.readOffset(e+n+t*s);return new H0(a,c,h)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){throw t instanceof Rn?new Rn(e):t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(t.nextIFDByteOffset===0)throw new Rn(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new hu(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(n){if(n instanceof Rn)t=!1;else throw n}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",n=t.length+100;let i=await this.getSlice(e,n);if(t===Kt(i,ee.ASCII,t.length,e)){const o=Kt(i,ee.ASCII,n,e).split(`
`)[0],a=Number(o.split("=")[1].split(" ")[0])+o.length;a>n&&(i=await this.getSlice(e,a));const l=Kt(i,ee.ASCII,a,e);this.ghostValues={},l.split(`
`).filter(c=>c.length>0).map(c=>c.split("=")).forEach(([c,h])=>{this.ghostValues[c]=h})}return this.ghostValues}static async fromSource(e,t,n){const i=(await e.fetch([{offset:0,length:1024}],n))[0],s=new E0(i),o=s.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const l=s.getUint16(2,a);let c;if(l===42)c=!1;else if(l===43){if(c=!0,s.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const h=c?s.getUint64(8,a):s.getUint32(4,a);return new pu(e,a,c,h,t)}close(){return typeof this.source.close=="function"?this.source.close():!1}};class X0 extends du{constructor(e,t){super(),this.mainFile=e,this.overviewFiles=t,this.imageFiles=[e].concat(t),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(t=>t.parseFileDirectoryAt(t.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let t=0,n=0;for(let i=0;i<this.imageFiles.length;i++){const s=this.imageFiles[i];for(let o=0;o<this.imageCounts[i];o++){if(e===t){const a=await s.requestIFD(n);return new hu(a.fileDirectory,a.geoKeyDirectory,s.dataView,s.littleEndian,s.cache,s.source)}t++,n++}n=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(t=>t.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((t,n)=>t+n,0),this.imageCount}}async function Y0(r,e={},t){return Xn.fromSource(ts(r,e),t)}async function q0(r,e){return Xn.fromSource(Z0(r),e)}async function K0(r,e=[],t={},n){const i=await Xn.fromSource(ts(r,t),n),s=await Promise.all(e.map(o=>Xn.fromSource(ts(o,t))));return new X0(i,s)}function Q0(r){return((r.fileDirectory.NewSubfileType||0)&4)===4}function J0(r,e){if(!r)return!1;if(r===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const t=e.fileDirectory.PhotometricInterpretation,n=ze;return t===n.CMYK||t===n.YCbCr||t===n.CIELab||t===n.ICCLab}const _a="STATISTICS_MAXIMUM",xa="STATISTICS_MINIMUM",Ii=256;let Ci;function ex(){return Ci||(Ci=new S0),Ci}function tx(r){try{return r.getBoundingBox()}catch{return[0,0,r.getWidth(),r.getHeight()]}}function rx(r){try{return r.getOrigin().slice(0,2)}catch{return[0,r.getHeight()]}}function nx(r,e){try{return r.getResolution(e)}catch{return[e.getWidth()/r.getWidth(),e.getHeight()/r.getHeight()]}}function ix(r){const e=r.geoKeys;if(!e)return null;if(e.ProjectedCSTypeGeoKey&&e.ProjectedCSTypeGeoKey!==32767){const t="EPSG:"+e.ProjectedCSTypeGeoKey;let n=ye(t);if(!n){const i=Ro(e.ProjLinearUnitsGeoKey);i&&(n=new bo({code:t,units:i}))}return n}if(e.GeographicTypeGeoKey&&e.GeographicTypeGeoKey!==32767){const t="EPSG:"+e.GeographicTypeGeoKey;let n=ye(t);if(!n){const i=Ro(e.GeogAngularUnitsGeoKey);i&&(n=new bo({code:t,units:i}))}return n}return null}function sx(r){return r.getImageCount().then(function(e){const t=new Array(e);for(let n=0;n<e;++n)t[n]=r.getImage(n);return Promise.all(t)})}function ox(r,e){let t;return r.blob?t=q0(r.blob):r.overviews?t=K0(r.url,r.overviews,e):t=Y0(r.url,e),t.then(sx)}function Or(r,e,t,n,i){if(Array.isArray(r)){const s=r.length;if(!Array.isArray(e)||s!=e.length){const o=new Error(n);throw i(o),o}for(let o=0;o<s;++o)Or(r[o],e[o],t,n,i);return}if(e=e,Math.abs(r-e)>t*r)throw new Error(n)}function ax(r){return r instanceof Int8Array?-128:r instanceof Int16Array?-32768:r instanceof Int32Array?-2147483648:r instanceof Float32Array?12e-39:0}function lx(r){return r instanceof Int8Array?127:r instanceof Uint8Array||r instanceof Uint8ClampedArray?255:r instanceof Int16Array?32767:r instanceof Uint16Array?65535:r instanceof Int32Array?2147483647:r instanceof Uint32Array?4294967295:r instanceof Float32Array?34e37:255}class gu extends Ws{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,opaque:e.opaque,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map(s=>s.url).join(","));const n=this,i=new Array(t);for(let s=0;s<t;++s)i[s]=ox(this.sourceInfo_[s],this.sourceOptions_);Promise.all(i).then(function(s){n.configure_(s)}).catch(function(s){zn(s),n.error_=s,n.setState("error")})}getError(){return this.error_}determineProjection(e){const t=e[0];for(let n=t.length-1;n>=0;--n){const i=t[n],s=ix(i);if(s){this.projection=s;break}}}configure_(e){let t,n,i,s,o;const a=new Array(e.length),l=new Array(e.length),c=new Array(e.length);let h=0;const f=e.length;for(let _=0;_<f;++_){const x=[],w=[];e[_].forEach(F=>{Q0(F)?w.push(F):x.push(F)});const E=x.length;if(w.length>0&&w.length!==E)throw new Error(`Expected one mask per image found ${w.length} masks and ${E} images`);let v,S;const A=new Array(E),O=new Array(E),I=new Array(E);l[_]=new Array(E),c[_]=new Array(E);for(let F=0;F<E;++F){const U=x[F],B=U.getGDALNoData();c[_][F]=U.getGDALMetadata(0),l[_][F]=B;const V=this.sourceInfo_[_].bands;a[_]=V?V.length:U.getSamplesPerPixel();const J=E-(F+1);v||(v=tx(U)),S||(S=rx(U));const u=nx(U,x[0]);I[J]=u[0];const p=[U.getTileWidth(),U.getTileHeight()];p[0]!==p[1]&&p[1]<Ii&&(p[0]=Ii,p[1]=Ii),A[J]=p;const y=u[0]/Math.abs(u[1]);O[J]=[p[0],p[1]/y]}if(t?ht(t,v,t):t=v,!n)n=S;else{const F=`Origin mismatch for source ${_}, got [${S}] but expected [${n}]`;Or(n,S,0,F,this.viewRejector)}if(!o)o=I,this.resolutionFactors_[_]=1;else{o.length-h>I.length&&(h=o.length-I.length);const F=o[o.length-1]/I[I.length-1];this.resolutionFactors_[_]=F;const U=I.map(V=>V*=F),B=`Resolution mismatch for source ${_}, got [${U}] but expected [${o}]`;Or(o.slice(h,o.length),U,.02,B,this.viewRejector)}i?Or(i.slice(h,i.length),O,.01,`Tile size mismatch for source ${_}`,this.viewRejector):i=O,s?Or(s.slice(h,s.length),A,0,`Tile size mismatch for source ${_}`,this.viewRejector):s=A,this.sourceImagery_[_]=x.reverse(),this.sourceMasks_[_]=w.reverse()}for(let _=0,x=this.sourceImagery_.length;_<x;++_){const w=this.sourceImagery_[_];for(;w.length<o.length;)w.unshift(void 0)}this.getProjection()||this.determineProjection(e),this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=c;e:for(let _=0;_<f;++_){if(this.sourceInfo_[_].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[_].length){this.addAlpha_=!0;break}const x=l[_],w=this.sourceInfo_[_].bands;if(w){for(let E=0;E<w.length;++E)if(x[w[E]-1]!==null){this.addAlpha_=!0;break e}continue}for(let E=0;E<x.length;++E)if(x[E]!==null){this.addAlpha_=!0;break e}}let d=this.addAlpha_?1:0;for(let _=0;_<f;++_)d+=a[_];this.bandCount=d;const g=new ti({extent:t,minZoom:h,origin:n,resolutions:o,tileSizes:i});this.tileGrid=g,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const m=1;o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[o[0]*2,o[0],o[0]/2]),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:sf(Lt(t),this.projection),extent:of(t,this.projection),zoom:m})}loadTile_(e,t,n){const i=this.getTileSize(e),s=this.sourceImagery_.length,o=new Array(s*2),a=this.nodataValues_,l=this.sourceInfo_,c=ex();for(let h=0;h<s;++h){const f=l[h],d=this.resolutionFactors_[h],g=[Math.round(t*(i[0]*d)),Math.round(n*(i[1]*d)),Math.round((t+1)*(i[0]*d)),Math.round((n+1)*(i[1]*d))],m=this.sourceImagery_[h][e];let _;f.bands&&(_=f.bands.map(function(S){return S-1}));let x;"nodata"in f&&f.nodata!==null?x=f.nodata:_?x=_.map(function(S){return a[h][S]}):x=a[h];const w={window:g,width:i[0],height:i[1],samples:_,fillValue:x,pool:c,interleave:!1};J0(this.convertToRGB_,m)?o[h]=m.readRGB(w):o[h]=m.readRasters(w);const E=s+h,v=this.sourceMasks_[h][e];if(!v){o[E]=Promise.resolve(null);continue}o[E]=v.readRasters({window:g,width:i[0],height:i[1],samples:[0],pool:c,interleave:!1})}return Promise.all(o).then(this.composeTile_.bind(this,i)).catch(function(h){throw zn(h),h})}composeTile_(e,t){const n=this.metadata_,i=this.sourceInfo_,s=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,c=this.normalize_,h=this.addAlpha_,f=e[0]*e[1],d=f*o;let g;c?g=new Uint8Array(d):g=new Float32Array(d);let m=0;for(let _=0;_<f;++_){let x=h;for(let w=0;w<s;++w){const E=i[w];let v=E.min,S=E.max,A,O;if(c){const I=n[w][0];v===void 0&&(I&&xa in I?v=parseFloat(I[xa]):v=ax(t[w][0])),S===void 0&&(I&&_a in I?S=parseFloat(I[_a]):S=lx(t[w][0])),A=255/(S-v),O=-v*A}for(let I=0;I<a[w];++I){const F=t[w][I][_];let U;if(c?U=ve(A*F+O,0,255):U=F,!h)g[m]=U;else{let B=E.nodata;if(B===void 0){let J;E.bands?J=E.bands[I]-1:J=I,B=l[w][J]}const V=isNaN(B);(!V&&F!==B||V&&!isNaN(F))&&(x=!1,g[m]=U)}m++}if(!x){const I=s+w,F=t[I];F&&!F[0][_]&&(x=!0)}}h&&(x||(g[m]=255),m++)}return g}}gu.prototype.getView;const mu=gu,cx='Google Maps<a class="ol-attribution-google-tos" href="https://cloud.google.com/maps-platform/terms/" target="_blank">Terms of Use</a> and <a class="ol-attribution-google-tos" href="https://policies.google.com/privacy" target="_blank">Privacy Policy</a>',ux="https://tile.googleapis.com/v1/createSession",hx="https://tile.googleapis.com/v1/2dtiles",fx=22;class dx extends Ft{constructor(e){const t=!!e.highDpi,n=e.overlay!==!0,i=e.attributions||[cx];super({attributions:i,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,opaque:n,projection:"EPSG:3857",reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.apiKey_=e.key,this.error_=null;const s={mapType:e.mapType||"roadmap",language:e.language||"en-US",region:e.region||"US"};e.imageFormat&&(s.imageFormat=e.imageFormat),e.scale&&(s.scale=e.scale),t&&(s.highDpi=!0),e.layerTypes&&(s.layerTypes=e.layerTypes),e.styles&&(s.styles=e.styles),e.overlay===!0&&(s.overlay=!0),this.sessionTokenRequest_=s,this.sessionRefreshId_,this.createSession_()}getError(){return this.error_}fetchSessionToken(e,t){return fetch(e,t)}async createSession_(){const e=ux+"?key="+this.apiKey_,t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.sessionTokenRequest_)},n=await this.fetchSessionToken(e,t);if(!n.ok){try{const f=await n.json();this.error_=new Error(f.error.message)}catch{this.error_=new Error("Error fetching session token")}this.setState("error");return}const i=await n.json(),s=this.getTilePixelRatio(1),o=[i.tileWidth/s,i.tileHeight/s];this.tileGrid=hn({extent:un(this.getProjection()),maxZoom:fx,tileSize:o});const a=i.session,l=this.apiKey_;this.tileUrlFunction=function(f,d,g){const m=f[0],_=f[1],x=f[2];return`${hx}/${m}/${_}/${x}?session=${a}&key=${l}`};const c=parseInt(i.expiry,10)*1e3,h=Math.max(c-Date.now()-60*1e3,1);this.sessionRefreshId_=setTimeout(()=>this.createSession_(),h),this.setState("ready")}disposeInternal(){clearTimeout(this.sessionRefreshId_),super.disposeInternal()}}const px=dx;let yu=class extends gs{constructor(e,t,n,i,s,o,a){super(t,n,i,s,o,a),this.zoomifyImage_=null,this.tileSize_=e}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=super.getImage();if(this.state==Y.LOADED){const t=this.tileSize_;if(e.width==t[0]&&e.height==t[1])return this.zoomifyImage_=e,e;const n=Tt(t[0],t[1]);return n.drawImage(e,0,0),this.zoomifyImage_=n.canvas,n.canvas}return e}};class gx extends Ft{constructor(e){const t=e.size,n=e.tierSizeCalculation!==void 0?e.tierSizeCalculation:"default",i=e.tilePixelRatio||1,s=t[0],o=t[1],a=[],l=e.tileSize||ji;let c=l*i;switch(n){case"default":for(;s>c||o>c;)a.push([Math.ceil(s/c),Math.ceil(o/c)]),c+=c;break;case"truncated":let O=s,I=o;for(;O>c||I>c;)a.push([Math.ceil(O/c),Math.ceil(I/c)]),O>>=1,I>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}a.push([1,1]),a.reverse();const h=[i],f=[0];for(let O=1,I=a.length;O<I;O++)h.push(i<<O),f.push(a[O-1][0]*a[O-1][1]+f[O-1]);h.reverse();const d=new ti({tileSize:l,extent:e.extent||[0,-o,s,0],resolutions:h});let g=e.url;g&&!g.includes("{TileGroup}")&&!g.includes("{tileIndex}")&&(g+="{TileGroup}/{z}-{x}-{y}.jpg");const m=af(g);let _=l*i;function x(O){return function(I,F,U){if(!I)return;const B=I[0],V=I[1],J=I[2],u=V+J*a[B][0],p=(u+f[B])/_|0,y={z:B,x:V,y:J,tileIndex:u,TileGroup:"TileGroup"+p};return O.replace(/\{(\w+?)\}/g,function(T,L){return y[L]})}}const w=ec(m.map(x)),E=yu.bind(null,ft(l*i));super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,tilePixelRatio:i,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:E,tileGrid:d,tileUrlFunction:w,transition:e.transition}),this.zDirection=e.zDirection;const v=d.getTileCoordForCoordAndResolution(Lt(d.getExtent()),h[h.length-1]),S=w(v,1,null),A=new Image;A.addEventListener("error",()=>{_=l,this.changed()}),A.src=S}}const mx=gx;function Pr(r){return r.toLocaleString("en",{maximumFractionDigits:10})}class yx extends Ft{constructor(e){const t=e||{};let n=t.url||"";n=n+(n.lastIndexOf("/")===n.length-1||n===""?"":"/");const i=t.version||Le.VERSION2,s=t.sizes||[],o=t.size;gt(o!=null&&Array.isArray(o)&&o.length==2&&!isNaN(o[0])&&o[0]>0&&!isNaN(o[1])&&o[1]>0,"Missing or invalid `size`");const a=o[0],l=o[1],c=t.tileSize,h=t.tilePixelRatio||1,f=t.format||"jpg",d=t.quality||(t.version==Le.VERSION1?"native":"default");let g=t.resolutions||[];const m=t.supports||[],_=t.extent||[0,-l,a,0],x=s!=null&&Array.isArray(s)&&s.length>0,w=c!==void 0&&(typeof c=="number"&&Number.isInteger(c)&&c>0||Array.isArray(c)&&c.length>0),E=m!=null&&Array.isArray(m)&&(m.includes("regionByPx")||m.includes("regionByPct"))&&(m.includes("sizeByWh")||m.includes("sizeByH")||m.includes("sizeByW")||m.includes("sizeByPct"));let v,S,A;if(g.sort(function(U,B){return B-U}),w||E)if(c!=null&&(typeof c=="number"&&Number.isInteger(c)&&c>0?(v=c,S=c):Array.isArray(c)&&c.length>0&&((c.length==1||c[1]==null&&Number.isInteger(c[0]))&&(v=c[0],S=c[0]),c.length==2&&(Number.isInteger(c[0])&&Number.isInteger(c[1])?(v=c[0],S=c[1]):c[0]==null&&Number.isInteger(c[1])&&(v=c[1],S=c[1])))),(v===void 0||S===void 0)&&(v=ji,S=ji),g.length==0){A=Math.max(Math.ceil(Math.log(a/v)/Math.LN2),Math.ceil(Math.log(l/S)/Math.LN2));for(let U=A;U>=0;U--)g.push(Math.pow(2,U))}else{const U=Math.max(...g);A=Math.round(Math.log(U)/Math.LN2)}else if(v=a,S=l,g=[],x){s.sort(function(B,V){return B[0]-V[0]}),A=-1;const U=[];for(let B=0;B<s.length;B++){const V=a/s[B][0];if(g.length>0&&g[g.length-1]==V){U.push(B);continue}g.push(V),A++}if(U.length>0)for(let B=0;B<U.length;B++)s.splice(U[B]-B,1)}else g.push(1),s.push([a,l]),A=0;const O=new ti({tileSize:[v,S],extent:_,origin:lf(_),resolutions:g}),I=function(U,B,V){let J,u;const p=U[0];if(p>A)return;const y=U[1],T=U[2],L=g[p];if(!(y===void 0||T===void 0||L===void 0||y<0||Math.ceil(a/L/v)<=y||T<0||Math.ceil(l/L/S)<=T)){if(E||w){const C=y*v*L,M=T*S*L;let N=v*L,z=S*L,Z=v,oe=S;if(C+N>a&&(N=a-C),M+z>l&&(z=l-M),C+v*L>a&&(Z=Math.floor((a-C+L-1)/L)),M+S*L>l&&(oe=Math.floor((l-M+L-1)/L)),C==0&&N==a&&M==0&&z==l)J="full";else if(!E||m.includes("regionByPx"))J=C+","+M+","+N+","+z;else if(m.includes("regionByPct")){const se=Pr(C/a*100),ce=Pr(M/l*100),ae=Pr(N/a*100),_e=Pr(z/l*100);J="pct:"+se+","+ce+","+ae+","+_e}i==Le.VERSION3&&(!E||m.includes("sizeByWh"))?u=Z+","+oe:!E||m.includes("sizeByW")?u=Z+",":m.includes("sizeByH")?u=","+oe:m.includes("sizeByWh")?u=Z+","+oe:m.includes("sizeByPct")&&(u="pct:"+Pr(100/L))}else if(J="full",x){const C=s[p][0],M=s[p][1];i==Le.VERSION3?C==a&&M==l?u="max":u=C+","+M:C==a?u="full":u=C+","}else u=i==Le.VERSION3?"max":"full";return n+J+"/"+u+"/0/"+d+"."+f}},F=yu.bind(null,ft(c||256).map(function(U){return U*h}));super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:t.state,tileClass:F,tileGrid:O,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:I,transition:t.transition}),this.zDirection=t.zDirection}}const _x=yx;function _u(r,e,t,n,i,s){const o=i.getCode().split(/:(?=\d+$)/).pop(),a=t/n,l=[Po(Xe(e)/a,Ao),Po(Ot(e)/a,Ao)];s.SIZE=l[0]+","+l[1],s.BBOX=e.join(","),s.BBOXSR=o,s.IMAGESR=o,s.DPI=Math.round(s.DPI?s.DPI*n:90*n);const c=r.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return rc(c,s)}function xu(r){const e=r.load?r.load:xr,t=ye(r.projection||"EPSG:3857");return function(n,i,s){s=r.hidpi?s:1;const o={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(o,r.params),n=tc(n,i,s,r.ratio);const a=_u(r.url,n,i,s,t,o),l=new Image;return r.crossOrigin!==null&&(l.crossOrigin=r.crossOrigin),e(l,a).then(c=>{const h=Xe(n)/c.width*s;return{image:c,extent:n,resolution:h,pixelRatio:s}})}}class xx extends Ht{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:xs,this.params_=Object.assign({},e.params),this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,n,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=xu({crossOrigin:this.crossOrigin_,params:this.params_,projection:i,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),xr(s))})),super.getImageInternal(e,t,n,i))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}const Ex=xx;class wx extends Ht{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions,state:e.state}),this.canvasFunction_=e.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5}getImageInternal(e,t,n,i){t=this.findNearestResolution(t);let s=this.canvas_;if(s&&this.renderedRevision_==this.getRevision()&&s.getResolution()==t&&s.getPixelRatio()==n&&Ln(s.getExtent(),e))return s;e=e.slice(),ql(e,this.ratio_);const o=Xe(e)/t,a=Ot(e)/t,l=[o*n,a*n],c=this.canvasFunction_.call(this,e,t,n,l,i);return c&&(s=new $s(e,t,n,c)),this.canvas_=s,this.renderedRevision_=this.getRevision(),s}}const Tx=wx;function vx(r,e,t,n){const i=Xe(r),s=Ot(r),o=e[0],a=e[1],l=.0254/n;return a*i>o*s?i*t/(o*l):s*t/(a*l)}function Sx(r,e,t,n,i,s,o){const a=vx(t,n,s,o),l=Lt(t),c={OPERATION:i?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:o,SETDISPLAYWIDTH:Math.round(n[0]),SETDISPLAYHEIGHT:Math.round(n[1]),SETVIEWSCALE:a,SETVIEWCENTERX:l[0],SETVIEWCENTERY:l[1]};return Object.assign(c,e),rc(r,c)}function Eu(r){const e=r.load||xr;return function(t,n,i){const s=new Image;r.crossOrigin!==null&&(s.crossOrigin=r.crossOrigin),t=tc(t,n,i,r.ratio);const o=Xe(t)/n,a=Ot(t)/n,l=[o*i,a*i],c=Sx(r.url,r.params,t,l,r.useOverlay,r.metersPerUnit||1,r.displayDpi||96);return e(s,c).then(h=>({image:h,extent:t,pixelRatio:i}))}}class Rx extends Ht{constructor(e){super({interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.displayDpi_=e.displayDpi!==void 0?e.displayDpi:96,this.params_=Object.assign({},e.params),this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:xs,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.metersPerUnit_=e.metersPerUnit!==void 0?e.metersPerUnit:1,this.ratio_=e.ratio!==void 0?e.ratio:1,this.useOverlay_=e.useOverlay!==void 0?e.useOverlay:!1,this.renderedRevision_=0,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,n,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=Eu({crossOrigin:this.crossOrigin_,params:this.params_,hidpi:this.hidpi_,metersPerUnit:this.metersPerUnit_,url:this.url_,useOverlay:this.useOverlay_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),xr(s))})),super.getImageInternal(e,t,n,i))}getImageLoadFunction(){return this.imageLoadFunction_}updateParams(e){Object.assign(this.params_,e),this.changed()}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}changed(){this.image=null,super.changed()}}const bx=Rx;function wu(r){const e=r.load||xr,t=r.imageExtent,n=new Image;return r.crossOrigin!==null&&(n.crossOrigin=r.crossOrigin),()=>e(n,r.url).then(i=>{const s=Xe(t)/i.width,o=Ot(t)/i.height;return{image:i,extent:t,resolution:s!==o?[s,o]:o,pixelRatio:1}})}class Px extends Ht{constructor(e){const t=e.crossOrigin!==void 0?e.crossOrigin:null,n=e.imageLoadFunction!==void 0?e.imageLoadFunction:xs;super({attributions:e.attributions,interpolate:e.interpolate,projection:ye(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new Yl(this.imageExtent_,void 0,1,wu({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(i,s)=>(this.image.setImage(i),n(this.image,s),xr(i))})),this.image.addEventListener(je.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,n,i){return dr(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}const Tu=Px;function co(r,e,t,n){const i=document.createElement("script"),s="olc_"+Ae(e);function o(){delete window[s],i.parentNode.removeChild(i)}i.async=!0,i.src=r+(r.includes("?")?"&":"?")+(n||"callback")+"="+s;const a=setTimeout(function(){o(),t&&t()},1e4);window[s]=function(l){clearTimeout(a),o(),e(l)},document.head.appendChild(i)}class Ax extends Error{constructor(e){const t="Unexpected response status: "+e.status;super(t),this.name="ResponseError",this.response=e}}class Lx extends Error{constructor(e){super("Failed to issue request"),this.name="ClientError",this.client=e}}function vu(r){return new Promise(function(e,t){function n(o){const a=o.target;if(!a.status||a.status>=200&&a.status<300){let l;try{l=JSON.parse(a.responseText)}catch(c){const h="Error parsing response text as JSON: "+c.message;t(new Error(h));return}e(l);return}t(new Ax(a))}function i(o){t(new Lx(o.target))}const s=new XMLHttpRequest;s.addEventListener("load",n),s.addEventListener("error",i),s.open("GET",r),s.setRequestHeader("Accept","application/json"),s.send()})}function Su(r,e){return e.includes("://")?e:new URL(e,r).href}const Ix={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},Cx={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function Ox(r,e){let t,n;for(let i=0;i<r.length;++i){const s=r[i];if(s.rel==="item"){if(s.type===e){t=s.href;break}(Ix[s.type]||!n&&s.type.startsWith("image/"))&&(n=s.href)}}if(!t)if(n)t=n;else throw new Error('Could not find "item" link');return t}function Mx(r,e,t){let n,i;const s={};for(let o=0;o<r.length;++o){const a=r[o];if(s[a.type]=a.href,a.rel==="item"){if(a.type===e){n=a.href;break}Cx[a.type]&&(i=a.href)}}if(!n&&t)for(let o=0;o<t.length;++o){const a=t[o];if(s[a]){n=s[a];break}}if(!n)if(i)n=i;else throw new Error('Could not find "item" link');return n}function Ea(r,e,t,n){let i=r.projection;if(!i&&(i=ye(e.crs),!i))throw new Error(`Unsupported CRS: ${e.crs}`);const s=e.orderedAxes,o=(s?s.slice(0,2).map(A=>A.replace(/E|X|Lon/i,"e").replace(/N|Y|Lat/i,"n")).join(""):i.getAxisOrientation().substr(0,2))!=="en",a=e.tileMatrices,l={};for(let A=0;A<a.length;++A){const O=a[A];l[O.id]=O}const c={},h=[];if(n)for(let A=0;A<n.length;++A){const O=n[A],I=O.tileMatrix;h.push(I),c[I]=O}else for(let A=0;A<a.length;++A){const O=a[A].id;h.push(O)}const f=h.length,d=new Array(f),g=new Array(f),m=new Array(f),_=new Array(f),x=[-1/0,-1/0,1/0,1/0];for(let A=0;A<f;++A){const O=h[A],I=l[O],F=I.pointOfOrigin;o?d[A]=[F[1],F[0]]:d[A]=F,g[A]=I.cellSize,m[A]=[I.matrixWidth,I.matrixHeight],_[A]=[I.tileWidth,I.tileHeight];const U=c[O];if(U){const B=I.cellSize*I.tileWidth,V=d[A][0]+U.minTileCol*B,J=d[A][0]+(U.maxTileCol+1)*B,u=I.cellSize*I.tileHeight,p=I.cornerOfOrigin==="bottomLeft";let y,T;p?(y=d[A][1]+U.minTileRow*u,T=d[A][1]+(U.maxTileRow+1)*u):(y=d[A][1]-(U.maxTileRow+1)*u,T=d[A][1]-U.minTileRow*u),ht(x,[V,y,J,T],x)}}const w=new ti({origins:d,resolutions:g,sizes:m,tileSizes:_,extent:n?x:void 0}),E=r.context,v=r.url;function S(A,O,I){if(!A)return;const F=h[A[0]],U=l[F],B=U.cornerOfOrigin==="bottomLeft",V={tileMatrix:F,tileCol:A[1],tileRow:B?-A[2]-1:A[2]};if(n){const u=c[U.id];if(V.tileCol<u.minTileCol||V.tileCol>u.maxTileCol||V.tileRow<u.minTileRow||V.tileRow>u.maxTileRow)return}Object.assign(V,E);const J=t.replace(/\{(\w+?)\}/g,function(u,p){return V[p]});return Su(v,J)}return{grid:w,urlTemplate:t,urlFunction:S}}function Fx(r,e){const t=e.tileMatrixSetLimits;let n;if(e.dataType==="map")n=Ox(e.links,r.mediaType);else if(e.dataType==="vector")n=Mx(e.links,r.mediaType,r.supportedMediaTypes);else throw new Error('Expected tileset data type to be "map" or "vector"');if(e.tileMatrixSet)return Ea(r,e.tileMatrixSet,n,t);const i=e.links.find(a=>a.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!i)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const s=i.href,o=Su(r.url,s);return vu(o).then(function(a){return Ea(r,a,n,t)})}function Ru(r){return vu(r.url).then(function(e){return Fx(r,e)})}class Nx extends Ft{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition});const t={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,context:e.context||null};Ru(t).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){zn(e),this.setState("error")}}const Dx=Nx;class Gx extends ri{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,format:e.format,overlaps:e.overlaps,projection:e.projection,tileClass:e.tileClass,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection,state:"loading"});const t={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,supportedMediaTypes:e.format.supportedMediaTypes,context:e.context||null};Ru(t).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){zn(e),this.setState("error")}}const Ux=Gx;let bu=!0;try{new ImageData(10,10)}catch{bu=!1}let Oi;function kx(r,e,t){if(bu)return new ImageData(r,e,t);Oi||(Oi=document.createElement("canvas").getContext("2d"));const n=Oi.createImageData(e,t);return n.data.set(r),n}function Pu(r){let e=!0;try{new ImageData(10,10)}catch{e=!1}function t(n,i,s){return e?new ImageData(n,i,s):{data:n,width:i,height:s}}return function(n){const i=n.buffers,s=n.meta,o=n.imageOps,a=n.width,l=n.height,c=i.length,h=i[0].byteLength;if(o){const m=new Array(c);for(let x=0;x<c;++x)m[x]=t(new Uint8ClampedArray(i[x]),a,l);return r(m,s).data.buffer}const f=new Uint8ClampedArray(h),d=new Array(c),g=new Array(c);for(let m=0;m<c;++m)d[m]=new Uint8ClampedArray(i[m]),g[m]=[0,0,0,0];for(let m=0;m<h;m+=4){for(let x=0;x<c;++x){const w=d[x];g[x][0]=w[m],g[x][1]=w[m+1],g[x][2]=w[m+2],g[x][3]=w[m+3]}const _=r(g,s);f[m]=_[0],f[m+1]=_[1],f[m+2]=_[2],f[m+3]=_[3]}return f.buffer}}function zx(r,e){const n=Object.keys(r.lib||{}).map(function(s){return"const "+s+" = "+r.lib[s].toString()+";"}).concat(["const __minion__ = ("+Pu.toString()+")(",r.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),i=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(n.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(n,{type:"text/javascript"})));return i.addEventListener("message",e),i}function Bx(r,e){const t=Pu(r.operation);let n=!1;return{postMessage:function(i){setTimeout(function(){n||e({data:{buffer:t(i),meta:i.meta}})},0)},terminate:function(){n=!0}}}class $x extends $l{constructor(e){super(),this._imageOps=!!e.imageOps;let t;e.threads===0?t=0:this._imageOps?t=1:t=e.threads||1;const n=new Array(t);if(t)for(let i=0;i<t;++i)n[i]=zx(e,this._onWorkerMessage.bind(this,i));else n[0]=Bx(e,this._onWorkerMessage.bind(this,0));this._workers=n,this._queue=[],this._maxQueueLength=e.queue||1/0,this._running=0,this._dataLookup={},this._job=null}process(e,t,n){this._enqueue({inputs:e,meta:t,callback:n}),this._dispatch()}_enqueue(e){for(this._queue.push(e);this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)}_dispatch(){if(this._running||this._queue.length===0)return;const e=this._queue.shift();this._job=e;const t=e.inputs[0].width,n=e.inputs[0].height,i=e.inputs.map(function(l){return l.data.buffer}),s=this._workers.length;if(this._running=s,s===1){this._workers[0].postMessage({buffers:i,meta:e.meta,imageOps:this._imageOps,width:t,height:n},i);return}const o=e.inputs[0].data.length,a=4*Math.ceil(o/4/s);for(let l=0;l<s;++l){const c=l*a,h=[];for(let f=0,d=i.length;f<d;++f)h.push(i[f].slice(c,c+a));this._workers[l].postMessage({buffers:h,meta:e.meta,imageOps:this._imageOps,width:t,height:n},h)}}_onWorkerMessage(e,t){this.disposed||(this._dataLookup[e]=t.data,--this._running,this._running===0&&this._resolveJob())}_resolveJob(){const e=this._job,t=this._workers.length;let n,i;if(t===1)n=new Uint8ClampedArray(this._dataLookup[0].buffer),i=this._dataLookup[0].meta;else{const s=e.inputs[0].data.length;n=new Uint8ClampedArray(s),i=new Array(t);const o=4*Math.ceil(s/4/t);for(let a=0;a<t;++a){const l=this._dataLookup[a].buffer,c=a*o;n.set(new Uint8ClampedArray(l),c),i[a]=this._dataLookup[a].meta}}this._job=null,this._dataLookup={},e.callback(null,kx(n,e.inputs[0].width,e.inputs[0].height),i),this._dispatch()}disposeInternal(){for(let e=0;e<this._workers.length;++e)this._workers[e].terminate();this._workers.length=0}}const wa={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class Ta extends nc{constructor(e,t,n){super(e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=n}}class Au extends Ht{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=e.operationType!==void 0?e.operationType:"pixel",this.threads_=e.threads!==void 0?e.threads:1,this.layers_=Zx(e.sources);const t=this.changed.bind(this);for(let n=0,i=this.layers_.length;n<i;++n)this.layers_[n].addEventListener(je.CHANGE,t);this.useResolutions_=e.resolutions!==null,this.tileQueue_=new cf(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:it(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:Vx(this.layers_),pixelRatio:1,pixelToCoordinateTransform:it(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:Ae(this),renderTargets:{}},this.setAttributions(function(n){const i=[];for(let s=0,o=e.sources.length;s<o;++s){const a=e.sources[s],l=a instanceof Es?a:a.getSource();if(!l)continue;const c=l.getAttributions();if(typeof c=="function"){const h=c(n);i.push.apply(i,h)}}return i.length!==0?i:null}),e.operation!==void 0&&this.setOperation(e.operation,e.lib)}setOperation(e,t){this.processor_&&this.processor_.dispose(),this.processor_=new $x({operation:e,imageOps:this.operationType_==="image",queue:1,lib:t,threads:this.threads_}),this.changed()}updateFrameState_(e,t,n){const i=Object.assign({},this.frameState_);i.viewState=Object.assign({},i.viewState);const s=Lt(e);i.size[0]=Math.ceil(Xe(e)/t),i.size[1]=Math.ceil(Ot(e)/t),i.extent=[s[0]-i.size[0]*t/2,s[1]-i.size[1]*t/2,s[0]+i.size[0]*t/2,s[1]+i.size[1]*t/2],i.time=Date.now();const o=i.viewState;return o.center=s,o.projection=n,o.resolution=t,i}allSourcesReady_(){let e=!0,t;for(let n=0,i=this.layers_.length;n<i;++n)if(t=this.layers_[n].getSource(),!t||t.getState()!=="ready"){e=!1;break}return e}getImage(e,t,n,i){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),t=this.findNearestResolution(t);const s=this.updateFrameState_(e,t,i);if(this.requestedFrameState_=s,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();(t!==o||!Dn(s.extent,a))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),s.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const e=this.requestedFrameState_,t=this.layers_.length,n=new Array(t);for(let s=0;s<t;++s){e.layerIndex=s,e.renderTargets={};const o=jx(this.layers_[s],e);if(o)n[s]=o;else return}const i={};this.dispatchEvent(new Ta(wa.BEFOREOPERATIONS,e,i)),this.processor_.process(n,i,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,t,n,i){if(t||!n)return;const s=e.extent,o=e.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!Dn(s,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{const l=Math.round(Xe(s)/o),c=Math.round(Ot(s)/o);a=Tt(l,c),this.renderedImageCanvas_=new $s(s,o,1,a.canvas)}a.putImageData(n,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new Ta(wa.AFTEROPERATIONS,e,i))}getResolutions(e){if(!this.useResolutions_)return null;let t=super.getResolutions();if(!t)for(let n=0,i=this.layers_.length;n<i&&(t=this.layers_[n].getSource().getResolutions(e),!t);++n);return t}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}Au.prototype.dispose;let kt=null;function jx(r,e){const t=r.getRenderer();if(!t)throw new Error("Unsupported layer type: "+r);if(!t.prepareFrame(e))return null;const n=e.size[0],i=e.size[1];if(n===0||i===0)return null;const s=t.renderFrame(e,null);let o;if(s instanceof HTMLCanvasElement)o=s;else{if(s&&(o=s.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===n&&o.height===i)return o.getContext("2d").getImageData(0,0,n,i)}if(!kt)kt=Tt(n,i,void 0,{willReadFrequently:!0});else{const a=kt.canvas;a.width!==n||a.height!==i?kt=Tt(n,i,void 0,{willReadFrequently:!0}):kt.clearRect(0,0,n,i)}return kt.drawImage(o,0,0,n,i),kt.getImageData(0,0,n,i)}function Vx(r){return r.map(function(e){return e.getLayerState()})}function Zx(r){const e=r.length,t=new Array(e);for(let n=0;n<e;++n)t[n]=Wx(r[n]);return t}function Wx(r){let e;return r instanceof Es?r instanceof ei?e=new Un({source:r}):r instanceof Ht&&(e=new ys({source:r})):e=r,e}const Hx=Au,Xx='&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>',Yx='&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>',qx='&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>',Kx={stamen_terrain:{extension:"png",opaque:!0},stamen_terrain_background:{extension:"png",opaque:!0},stamen_terrain_labels:{extension:"png",opaque:!1},stamen_terrain_lines:{extension:"png",opaque:!1},stamen_toner_background:{extension:"png",opaque:!0},stamen_toner:{extension:"png",opaque:!0},stamen_toner_labels:{extension:"png",opaque:!1},stamen_toner_lines:{extension:"png",opaque:!1},stamen_toner_lite:{extension:"png",opaque:!0},stamen_watercolor:{extension:"jpg",opaque:!0},alidade_smooth:{extension:"png",opaque:!0},alidade_smooth_dark:{extension:"png",opaque:!0},outdoors:{extension:"png",opaque:!0},osm_bright:{extension:"png",opaque:!0}},Qx={stamen_terrain:{minZoom:0,maxZoom:18,retina:!0},stamen_toner:{minZoom:0,maxZoom:20,retina:!0},stamen_watercolor:{minZoom:1,maxZoom:18,retina:!1}};class Jx extends gr{constructor(e){const t=e.layer.indexOf("-"),n=t==-1?e.layer:e.layer.slice(0,t),i=Qx[n]||{minZoom:0,maxZoom:20,retina:!0},s=Kx[e.layer],o=e.apiKey?"?api_key="+e.apiKey:"",a=i.retina&&e.retina?"@2x":"",l=e.url!==void 0?e.url:"https://tiles.stadiamaps.com/tiles/"+e.layer+"/{z}/{x}/{y}"+a+"."+s.extension+o,c=[Xx,Yx,uf];e.layer.startsWith("stamen_")&&c.splice(1,0,qx),super({attributions:c,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:i.maxZoom,minZoom:e.minZoom!==void 0?e.minZoom:i.minZoom,opaque:s.opaque,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:l,tilePixelRatio:a?2:1,wrapX:e.wrapX,zDirection:e.zDirection})}}const eE=Jx;class tE extends Ft{constructor(e){e=e||{},super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.params_=Object.assign({},e.params),this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=ds(),this.setKey(this.getKeyForParams_())}getKeyForParams_(){let e=0;const t=[];for(const n in this.params_)t[e++]=n+"-"+this.params_[n];return t.join("/")}getParams(){return this.params_}getRequestUrl_(e,t,n,i,s,o){const a=this.urls;if(!a)return;let l;if(a.length==1)l=a[0];else{const c=hf(ff(e),a.length);l=a[c]}return _u(l,n,(this.tileGrid||this.getTileGridForProjection(s)).getResolution(e[0]),i,s,o)}getTilePixelRatio(e){return this.hidpi_?e:1}updateParams(e){Object.assign(this.params_,e),this.setKey(this.getKeyForParams_())}tileUrlFunction(e,t,n){let i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(n)),i.getResolutions().length<=e[0])return;t!=1&&!this.hidpi_&&(t=1);const s=i.getTileCoordExtent(e,this.tmpExtent_);let o=ft(i.getTileSize(e[0]),this.tmpSize);t!=1&&(o=df(o,t,this.tmpSize));const a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(a,this.params_),this.getRequestUrl_(e,o,s,t,n,a)}}const rE=tE;class nE extends gr{constructor(e){e=e||{},super({opaque:!1,projection:e.projection,tileGrid:e.tileGrid,wrapX:e.wrapX!==void 0?e.wrapX:!0,zDirection:e.zDirection,url:e.template||"z:{z} x:{x} y:{y}",tileLoadFunction:(t,n)=>{const i=t.getTileCoord()[0],s=ft(this.tileGrid.getTileSize(i)),o=Tt(s[0],s[1]);o.strokeStyle="grey",o.strokeRect(.5,.5,s[0]+.5,s[1]+.5),o.fillStyle="grey",o.strokeStyle="white",o.textAlign="center",o.textBaseline="middle",o.font="24px sans-serif",o.lineWidth=4,o.strokeText(n,s[0]/2,s[1]/2,s[0]),o.fillText(n,s[0]/2,s[1]/2,s[0]),t.setImage(o.canvas)}})}}const iE=nE;class sE extends Ft{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:ye("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)co(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let n;try{n=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(n)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const t=ye("EPSG:4326"),n=this.getProjection();let i;if(e.bounds!==void 0){const c=_s(t,n);i=Jr(e.bounds,c)}const s=un(n),o=e.minzoom||0,a=e.maxzoom||22,l=hn({extent:s,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=ic(e.tiles,l),e.attribution&&!this.getAttributions()){const c=i!==void 0?i:s;this.setAttributions(function(h){return dr(c,h.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}}const Lu=sE;class oE extends Wl{constructor(e,t,n,i,s,o){super(e,t),this.src_=n,this.extent_=i,this.preemptive_=s,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=o}getImage(){return null}getData(e){if(!this.grid_||!this.keys_)return null;const t=(e[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),n=(e[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),i=this.grid_[Math.floor((1-n)*this.grid_.length)];if(typeof i!="string")return null;let s=i.charCodeAt(Math.floor(t*i.length));s>=93&&s--,s>=35&&s--,s-=32;let o=null;if(s in this.keys_){const a=this.keys_[s];this.data_&&a in this.data_?o=this.data_[a]:o=a}return o}forDataAtCoordinate(e,t,n){this.state==Y.EMPTY&&n===!0?(this.state=Y.IDLE,gf(this,je.CHANGE,function(i){t(this.getData(e))},this),this.loadInternal_()):n===!0?setTimeout(()=>{t(this.getData(e))},0):t(this.getData(e))}getKey(){return this.src_}handleError_(){this.state=Y.ERROR,this.changed()}handleLoad_(e){this.grid_=e.grid,this.keys_=e.keys,this.data_=e.data,this.state=Y.LOADED,this.changed()}loadInternal_(){if(this.state==Y.IDLE)if(this.state=Y.LOADING,this.jsonp_)co(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",this.src_),e.send()}}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let n;try{n=JSON.parse(t.responseText)}catch{this.handleError_();return}this.handleLoad_(n)}else this.handleError_()}onXHRError_(e){this.handleError_()}load(){this.preemptive_?this.loadInternal_():this.setState(Y.EMPTY)}}class aE extends ei{constructor(e){if(super({projection:ye("EPSG:3857"),state:"loading",zDirection:e.zDirection}),this.preemptive_=e.preemptive!==void 0?e.preemptive:!0,this.tileUrlFunction_=pf,this.template_=void 0,this.jsonp_=e.jsonp||!1,e.url)if(this.jsonp_)co(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let n;try{n=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(n)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTemplate(){return this.template_}forDataAtCoordinateAndResolution(e,t,n,i){if(this.tileGrid){const s=this.tileGrid.getZForResolution(t,this.zDirection),o=this.tileGrid.getTileCoordForCoordAndZ(e,s);this.getTile(o[0],o[1],o[2],1,this.getProjection()).forDataAtCoordinate(e,n,i)}else i===!0?setTimeout(function(){n(null)},0):n(null)}handleTileJSONError(){this.setState("error")}handleTileJSONResponse(e){const t=ye("EPSG:4326"),n=this.getProjection();let i;if(e.bounds!==void 0){const h=_s(t,n);i=Jr(e.bounds,h)}const s=un(n),o=e.minzoom||0,a=e.maxzoom||22,l=hn({extent:s,maxZoom:a,minZoom:o});this.tileGrid=l,this.template_=e.template;const c=e.grids;if(!c){this.setState("error");return}if(this.tileUrlFunction_=ic(c,l),e.attribution!==void 0){const h=i!==void 0?i:s;this.setAttributions(function(f){return dr(h,f.extent)?[e.attribution]:null})}this.setState("ready")}getTile(e,t,n,i,s){const o=kn(e,t,n);if(this.tileCache.containsKey(o))return this.tileCache.get(o);const a=[e,t,n],l=this.getTileCoordForTileUrlFunction(a,s),c=this.tileUrlFunction_(l,i,s),h=new oE(a,c!==void 0?Y.IDLE:Y.EMPTY,c!==void 0?c:"",this.tileGrid.getTileCoordExtent(a),this.preemptive_,this.jsonp_);return this.tileCache.set(o,h),h}useTile(e,t,n){const i=kn(e,t,n);this.tileCache.containsKey(i)&&this.tileCache.get(i)}}const lE=aE;function cE(r,e){const t=new Hl(32),n=r.getExtent();return function(i,s){t.expireCache(),n&&(i=ht(n,i));const o=r.getZForResolution(s),a=[];return r.forEachTileCoord(i,o,l=>{const c=l.toString();if(!t.containsKey(c)){const h=e(l);t.set(c,h)}a.push(t.get(c))}),a}}const uE=Object.freeze(Object.defineProperty({__proto__:null,BingMaps:p_,CartoDB:m_,Cluster:__,DataTile:Ws,GeoTIFF:mu,Google:px,IIIF:_x,Image:Ht,ImageArcGISRest:Ex,ImageCanvas:Tx,ImageMapGuide:bx,ImageStatic:Tu,ImageWMS:mf,OGCMapTile:Dx,OGCVectorTile:Ux,OSM:yf,Raster:Hx,Source:Es,StadiaMaps:eE,Tile:ei,TileArcGISRest:rE,TileDebug:iE,TileImage:Ft,TileJSON:Lu,TileWMS:sc,UTFGrid:lE,UrlTile:_f,Vector:Jn,VectorTile:ri,WMTS:oc,XYZ:gr,Zoomify:mx,createArcGISRestLoader:xu,createMapGuideLoader:Eu,createStaticLoader:wu,createWMSLoader:xf,sourcesFromTileGrid:cE},Symbol.toStringTag,{value:"Module"}));window.eoxMapAdvancedOlFormats=Lm;var Ue=(r,e,t)=>new Promise((n,i)=>{var s=l=>{try{a(t.next(l))}catch(c){i(c)}},o=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(s,o);a((t=t.apply(r,e)).next())}),We=Uint8Array,cr=Uint16Array,hE=Int32Array,Iu=new We([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Cu=new We([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),fE=new We([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ou=function(r,e){for(var t=new cr(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new hE(t[30]),n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)i[s]=s-t[n]<<5|n;return{b:t,r:i}},Mu=Ou(Iu,2),Fu=Mu.b,dE=Mu.r;Fu[28]=258,dE[258]=28;var pE=Ou(Cu,0),gE=pE.b,ns=new cr(32768);for(ge=0;ge<32768;++ge)yt=(ge&43690)>>1|(ge&21845)<<1,yt=(yt&52428)>>2|(yt&13107)<<2,yt=(yt&61680)>>4|(yt&3855)<<4,ns[ge]=((yt&65280)>>8|(yt&255)<<8)>>1;var yt,ge,qr=function(r,e,t){for(var n=r.length,i=0,s=new cr(e);i<n;++i)r[i]&&++s[r[i]-1];var o=new cr(e);for(i=1;i<e;++i)o[i]=o[i-1]+s[i-1]<<1;var a;if(t){a=new cr(1<<e);var l=15-e;for(i=0;i<n;++i)if(r[i])for(var c=i<<4|r[i],h=e-r[i],f=o[r[i]-1]++<<h,d=f|(1<<h)-1;f<=d;++f)a[ns[f]>>l]=c}else for(a=new cr(n),i=0;i<n;++i)r[i]&&(a[i]=ns[o[r[i]-1]++]>>15-r[i]);return a},gn=new We(288);for(ge=0;ge<144;++ge)gn[ge]=8;var ge;for(ge=144;ge<256;++ge)gn[ge]=9;var ge;for(ge=256;ge<280;++ge)gn[ge]=7;var ge;for(ge=280;ge<288;++ge)gn[ge]=8;var ge,Nu=new We(32);for(ge=0;ge<32;++ge)Nu[ge]=5;var ge,mE=qr(gn,9,1),yE=qr(Nu,5,1),Mi=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},tt=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},Fi=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},_E=function(r){return(r+7)/8|0},xE=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var n=new We(t-e);return n.set(r.subarray(e,t)),n},EE=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ze=function(r,e,t){var n=new Error(e||EE[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,Ze),!t)throw n;return n},uo=function(r,e,t,n){var i=r.length,s=n?n.length:0;if(!i||e.f&&!e.l)return t||new We(0);var o=!t||e.i!=2,a=e.i;t||(t=new We(i*3));var l=function(Me){var Ie=t.length;if(Me>Ie){var Ge=new We(Math.max(Ie*2,Me));Ge.set(t),t=Ge}},c=e.f||0,h=e.p||0,f=e.b||0,d=e.l,g=e.d,m=e.m,_=e.n,x=i*8;do{if(!d){c=tt(r,h,1);var w=tt(r,h+1,3);if(h+=3,w)if(w==1)d=mE,g=yE,m=9,_=5;else if(w==2){var A=tt(r,h,31)+257,O=tt(r,h+10,15)+4,I=A+tt(r,h+5,31)+1;h+=14;for(var F=new We(I),U=new We(19),B=0;B<O;++B)U[fE[B]]=tt(r,h+B*3,7);h+=O*3;for(var V=Mi(U),J=(1<<V)-1,u=qr(U,V,1),B=0;B<I;){var p=u[tt(r,h,J)];h+=p&15;var E=p>>4;if(E<16)F[B++]=E;else{var y=0,T=0;for(E==16?(T=3+tt(r,h,3),h+=2,y=F[B-1]):E==17?(T=3+tt(r,h,7),h+=3):E==18&&(T=11+tt(r,h,127),h+=7);T--;)F[B++]=y}}var L=F.subarray(0,A),C=F.subarray(A);m=Mi(L),_=Mi(C),d=qr(L,m,1),g=qr(C,_,1)}else Ze(1);else{var E=_E(h)+4,v=r[E-4]|r[E-3]<<8,S=E+v;if(S>i){a&&Ze(0);break}o&&l(f+v),t.set(r.subarray(E,S),f),e.b=f+=v,e.p=h=S*8,e.f=c;continue}if(h>x){a&&Ze(0);break}}o&&l(f+131072);for(var M=(1<<m)-1,N=(1<<_)-1,z=h;;z=h){var y=d[Fi(r,h)&M],Z=y>>4;if(h+=y&15,h>x){a&&Ze(0);break}if(y||Ze(2),Z<256)t[f++]=Z;else if(Z==256){z=h,d=null;break}else{var oe=Z-254;if(Z>264){var B=Z-257,se=Iu[B];oe=tt(r,h,(1<<se)-1)+Fu[B],h+=se}var ce=g[Fi(r,h)&N],ae=ce>>4;ce||Ze(3),h+=ce&15;var C=gE[ae];if(ae>3){var se=Cu[ae];C+=Fi(r,h)&(1<<se)-1,h+=se}if(h>x){a&&Ze(0);break}o&&l(f+131072);var _e=f+oe;if(f<C){var Ce=s-C,Pe=Math.min(C,_e);for(Ce+f<0&&Ze(3);f<Pe;++f)t[f]=n[Ce+f]}for(;f<_e;f+=4)t[f]=t[f-C],t[f+1]=t[f+1-C],t[f+2]=t[f+2-C],t[f+3]=t[f+3-C];f=_e}}e.l=d,e.p=z,e.b=f,e.f=c,d&&(c=1,e.m=m,e.d=g,e.n=_)}while(!c);return f==t.length?t:xE(t,0,f)},wE=new We(0),TE=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Ze(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},vE=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},SE=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Ze(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&Ze(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function RE(r,e){return uo(r,{i:2},e&&e.out,e&&e.dictionary)}function bE(r,e){var t=TE(r);return t+8>r.length&&Ze(6,"invalid gzip data"),uo(r.subarray(t,-8),{i:2},e&&e.out||new We(vE(r)),e&&e.dictionary)}function PE(r,e){return uo(r.subarray(SE(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function is(r,e){return r[0]==31&&r[1]==139&&r[2]==8?bE(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?RE(r,e):PE(r,e)}var AE=typeof TextDecoder<"u"&&new TextDecoder,LE=0;try{AE.decode(wE,{stream:!0}),LE=1}catch{}var Du=(r,e)=>r*Math.pow(2,e),Ar=(r,e)=>Math.floor(r/Math.pow(2,e)),Yn=(r,e)=>Du(r.getUint16(e+1,!0),8)+r.getUint8(e),Gu=(r,e)=>Du(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),IE=(r,e,t,n,i)=>{if(r!=n.getUint8(i))return r-n.getUint8(i);const s=Yn(n,i+1);if(e!=s)return e-s;const o=Yn(n,i+4);return t!=o?t-o:0},CE=(r,e,t,n)=>{const i=Uu(r,e|128,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],is_dir:!0}:null},va=(r,e,t,n)=>{const i=Uu(r,e,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],is_dir:!1}:null},Uu=(r,e,t,n)=>{let i=0,s=r.byteLength/17-1;for(;i<=s;){const o=s+i>>1,a=IE(e,t,n,r,o*17);if(a>0)i=o+1;else if(a<0)s=o-1;else return[Gu(r,o*17+7),r.getUint32(o*17+13,!0)]}return null},OE=(r,e)=>r.is_dir&&!e.is_dir?1:!r.is_dir&&e.is_dir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,ku=(r,e)=>{const t=r.getUint8(e*17);return{z:t&127,x:Yn(r,e*17+1),y:Yn(r,e*17+4),offset:Gu(r,e*17+7),length:r.getUint32(e*17+13,!0),is_dir:t>>7===1}},Sa=r=>{const e=[],t=new DataView(r);for(let n=0;n<t.byteLength/17;n++)e.push(ku(t,n));return ME(e)},ME=r=>{r.sort(OE);const e=new ArrayBuffer(17*r.length),t=new Uint8Array(e);for(let n=0;n<r.length;n++){const i=r[n];let s=i.z;i.is_dir&&(s=s|128),t[n*17]=s,t[n*17+1]=i.x&255,t[n*17+2]=i.x>>8&255,t[n*17+3]=i.x>>16&255,t[n*17+4]=i.y&255,t[n*17+5]=i.y>>8&255,t[n*17+6]=i.y>>16&255,t[n*17+7]=i.offset&255,t[n*17+8]=Ar(i.offset,8)&255,t[n*17+9]=Ar(i.offset,16)&255,t[n*17+10]=Ar(i.offset,24)&255,t[n*17+11]=Ar(i.offset,32)&255,t[n*17+12]=Ar(i.offset,48)&255,t[n*17+13]=i.length&255,t[n*17+14]=i.length>>8&255,t[n*17+15]=i.length>>16&255,t[n*17+16]=i.length>>24&255}return e},FE=(r,e)=>{if(r.byteLength<17)return null;const t=r.byteLength/17,n=ku(r,t-1);if(n.is_dir){const i=n.z,s=e.z-i,o=Math.trunc(e.x/(1<<s)),a=Math.trunc(e.y/(1<<s));return{z:i,x:o,y:a}}return null};function NE(r){return Ue(this,null,function*(){const e=yield r.getBytes(0,512e3),t=new DataView(e.data),n=t.getUint32(4,!0),i=t.getUint16(8,!0),s=new TextDecoder("utf-8"),o=JSON.parse(s.decode(new DataView(e.data,10,n)));let a=0;o.compression==="gzip"&&(a=2);let l=0;"minzoom"in o&&(l=+o.minzoom);let c=0;"maxzoom"in o&&(c=+o.maxzoom);let h=0,f=0,d=0,g=-180,m=-85,_=180,x=85;if(o.bounds){const E=o.bounds.split(",");g=+E[0],m=+E[1],_=+E[2],x=+E[3]}if(o.center){const E=o.center.split(",");h=+E[0],f=+E[1],d=+E[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:i*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:l,maxZoom:c,minLon:g,minLat:m,maxLon:_,maxLat:x,centerZoom:d,centerLon:h,centerLat:f,etag:e.etag}})}function DE(r,e,t,n,i,s,o){return Ue(this,null,function*(){let a=yield t.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(a=Sa(a));const l=va(new DataView(a),n,i,s);if(l){let f=(yield e.getBytes(l.offset,l.length,o)).data;const d=new DataView(f);return d.getUint8(0)==31&&d.getUint8(1)==139&&(f=is(new Uint8Array(f))),{data:f}}const c=FE(new DataView(a),{z:n,x:i,y:s});if(c){const h=CE(new DataView(a),c.z,c.x,c.y);if(h){let f=yield t.getArrayBuffer(e,h.offset,h.length,r);r.specVersion===1&&(f=Sa(f));const d=va(new DataView(f),n,i,s);if(d){let m=(yield e.getBytes(d.offset,d.length,o)).data;const _=new DataView(m);return _.getUint8(0)==31&&_.getUint8(1)==139&&(m=is(new Uint8Array(m))),{data:m}}}}})}var zu={getHeader:NE,getZxy:DE};function Qt(r,e){return(e>>>0)*4294967296+(r>>>0)}function GE(r,e){const t=e.buf;let n,i;if(i=t[e.pos++],n=(i&112)>>4,i<128||(i=t[e.pos++],n|=(i&127)<<3,i<128)||(i=t[e.pos++],n|=(i&127)<<10,i<128)||(i=t[e.pos++],n|=(i&127)<<17,i<128)||(i=t[e.pos++],n|=(i&127)<<24,i<128)||(i=t[e.pos++],n|=(i&1)<<31,i<128))return Qt(r,n);throw new Error("Expected varint not more than 10 bytes")}function Lr(r){const e=r.buf;let t,n;return n=e[r.pos++],t=n&127,n<128||(n=e[r.pos++],t|=(n&127)<<7,n<128)||(n=e[r.pos++],t|=(n&127)<<14,n<128)||(n=e[r.pos++],t|=(n&127)<<21,n<128)?t:(n=e[r.pos],t|=(n&15)<<28,GE(t,r))}function UE(r,e,t,n){if(n==0){t==1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}var kE=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function zE(r,e,t){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,r)-1||t>Math.pow(2,r)-1)throw Error("tile x/y outside zoom level bounds");const n=kE[r],i=Math.pow(2,r);let s=0,o=0,a=0;const l=[e,t];let c=i/2;for(;c>0;)s=(l[0]&c)>0?1:0,o=(l[1]&c)>0?1:0,a+=c*c*(3*s^o),UE(c,l,s,o),c=c/2;return n+a}function Bu(r,e){return Ue(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return is(new Uint8Array(r));{let n=new Response(r).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}}else throw Error("Compression method not supported")})}var tr=(r=>(r[r.Unknown=0]="Unknown",r[r.Mvt=1]="Mvt",r[r.Png=2]="Png",r[r.Jpeg=3]="Jpeg",r[r.Webp=4]="Webp",r[r.Avif=5]="Avif",r))(tr||{}),BE=127;function $E(r,e){let t=0,n=r.length-1;for(;t<=n;){const i=n+t>>1,s=e-r[i].tileId;if(s>0)t=i+1;else if(s<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}var jE=class{constructor(r,e=new Headers){this.url=r,this.customHeaders=e}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,e,t){return Ue(this,null,function*(){let n;t||(n=new AbortController,t=n.signal);const i=new Headers(this.customHeaders);i.set("Range","bytes="+r+"-"+(r+e-1));let s=yield fetch(this.url,{signal:t,headers:i});if(s.status===416&&r===0){const l=s.headers.get("Content-Range");if(!l||!l.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const c=+l.substr(8);s=yield fetch(this.url,{signal:t,headers:{Range:"bytes=0-"+(c-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);const o=s.headers.get("Content-Length");if(s.status===200&&(!o||+o>e))throw n&&n.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function rt(r,e){const t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*Math.pow(2,32)+n}function VE(r,e){const t=new DataView(r),n=t.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:rt(t,8),rootDirectoryLength:rt(t,16),jsonMetadataOffset:rt(t,24),jsonMetadataLength:rt(t,32),leafDirectoryOffset:rt(t,40),leafDirectoryLength:rt(t,48),tileDataOffset:rt(t,56),tileDataLength:rt(t,64),numAddressedTiles:rt(t,72),numTileEntries:rt(t,80),numTileContents:rt(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function $u(r){const e={buf:new Uint8Array(r),pos:0},t=Lr(e),n=[];let i=0;for(let s=0;s<t;s++){const o=Lr(e);n.push({tileId:i+o,offset:0,length:0,runLength:1}),i+=o}for(let s=0;s<t;s++)n[s].runLength=Lr(e);for(let s=0;s<t;s++)n[s].length=Lr(e);for(let s=0;s<t;s++){const o=Lr(e);o===0&&s>0?n[s].offset=n[s-1].offset+n[s-1].length:n[s].offset=o-1}return n}function ZE(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var ur=class extends Error{};function WE(r,e,t,n){return Ue(this,null,function*(){const i=yield r.getBytes(0,16384);if(new DataView(i.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(ZE(i.data)<3)return[yield zu.getHeader(r)];const o=i.data.slice(0,BE);let a=i.etag;n&&i.etag!=n&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+r.getKey()),a=void 0);const l=VE(o,a);if(t){const c=i.data.slice(l.rootDirectoryOffset,l.rootDirectoryOffset+l.rootDirectoryLength),h=r.getKey()+"|"+(l.etag||"")+"|"+l.rootDirectoryOffset+"|"+l.rootDirectoryLength,f=$u(yield e(c,l.internalCompression));return[l,[h,f.length,f]]}return[l,void 0]})}function HE(r,e,t,n,i){return Ue(this,null,function*(){const s=yield r.getBytes(t,n);if(i.etag&&i.etag!==s.etag)throw new ur(s.etag);const o=yield e(s.data,i.internalCompression),a=$u(o);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var XE=class{constructor(r=100,e=!0,t=Bu){this.cache=new Map,this.maxCacheEntries=r,this.counter=1,this.prefetch=e,this.decompress=t}getHeader(r,e){return Ue(this,null,function*(){const t=r.getKey();if(this.cache.has(t))return this.cache.get(t).lastUsed=this.counter++,yield this.cache.get(t).data;const n=new Promise((i,s)=>{WE(r,this.decompress,this.prefetch,e).then(o=>{o[1]&&this.cache.set(o[1][0],{lastUsed:this.counter++,data:Promise.resolve(o[1][2])}),i(o[0]),this.prune()}).catch(o=>{s(o)})});return this.cache.set(t,{lastUsed:this.counter++,data:n}),n})}getDirectory(r,e,t,n){return Ue(this,null,function*(){const i=r.getKey()+"|"+(n.etag||"")+"|"+e+"|"+t;if(this.cache.has(i))return this.cache.get(i).lastUsed=this.counter++,yield this.cache.get(i).data;const s=new Promise((o,a)=>{HE(r,this.decompress,e,t,n).then(l=>{o(l),this.prune()}).catch(l=>{a(l)})});return this.cache.set(i,{lastUsed:this.counter++,data:s}),s})}getArrayBuffer(r,e,t,n){return Ue(this,null,function*(){const i=r.getKey()+"|"+(n.etag||"")+"|"+e+"|"+t;if(this.cache.has(i))return this.cache.get(i).lastUsed=this.counter++,yield this.cache.get(i).data;const s=new Promise((o,a)=>{r.getBytes(e,t).then(l=>{if(n.etag&&n.etag!==l.etag)throw new ur(l.etag);o(l.data),this.cache.has(i),this.prune()}).catch(l=>{a(l)})});return this.cache.set(i,{lastUsed:this.counter++,data:s}),s})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((t,n)=>{t.lastUsed<r&&(r=t.lastUsed,e=n)}),e&&this.cache.delete(e)}}invalidate(r,e){return Ue(this,null,function*(){this.cache.delete(r.getKey()),yield this.getHeader(r,e)})}},ho=class{constructor(r,e,t){typeof r=="string"?this.source=new jE(r):this.source=r,t?this.decompress=t:this.decompress=Bu,e?this.cache=e:this.cache=new XE}getHeader(){return Ue(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,t,n){return Ue(this,null,function*(){const i=zE(r,e,t),s=yield this.cache.getHeader(this.source);if(s.specVersion<3)return zu.getZxy(s,this.source,this.cache,r,e,t,n);if(r<s.minZoom||r>s.maxZoom)return;let o=s.rootDirectoryOffset,a=s.rootDirectoryLength;for(let l=0;l<=3;l++){const c=yield this.cache.getDirectory(this.source,o,a,s),h=$E(c,i);if(h)if(h.runLength>0){const f=yield this.source.getBytes(s.tileDataOffset+h.offset,h.length,n);if(s.etag&&s.etag!==f.etag)throw new ur(f.etag);return{data:yield this.decompress(f.data,s.tileCompression),cacheControl:f.cacheControl,expires:f.expires}}else o=s.leafDirectoryOffset+h.offset,a=h.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,t,n){return Ue(this,null,function*(){try{return yield this.getZxyAttempt(r,e,t,n)}catch(i){if(i instanceof ur)return this.cache.invalidate(this.source,i.message),yield this.getZxyAttempt(r,e,t,n);throw i}})}getMetadataAttempt(){return Ue(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength);if(r.etag&&r.etag!==e.etag)throw new ur(e.etag);const t=yield this.decompress(e.data,r.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(t))})}getMetadata(){return Ue(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof ur)return this.cache.invalidate(this.source,r.message),yield this.getMetadataAttempt();throw r}})}};class YE extends nc{constructor(e){super(je.ERROR),this.error=e}}class qE extends mu{constructor(e){super(e),e.projection&&(this.projection=e.projection)}}class we{constructor(e){this.name=e}toString(){return this.name}}we.GeoTIFF=new we("GeoTIFF");we.ImageStatic=new we("ImageStatic");we.PMTilesRaster=new we("PMTilesRaster");we.PMTilesVector=new we("PMTilesVector");we.TileJSON=new we("TileJSON");we.TileWMS=new we("TileWMS");we.WMTS=new we("WMTS");we.XYZ=new we("XYZ");var ju={exports:{}};(function(r,e){(function(t,n){r.exports=n()})($t,function(){var t=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function n(f,d){return f.indexOf(d)===-1?f.length:f.indexOf(d)}function i(f){var d=f.replace(/^v/,"").replace(/\+.*$/,""),g=n(d,"-"),m=d.substring(0,g).split(".");return m.push(d.substring(g+1)),m}function s(f){return isNaN(Number(f))?f:Number(f)}function o(f){if(typeof f!="string")throw new TypeError("Invalid argument expected string");if(!t.test(f))throw new Error("Invalid argument not valid semver ('"+f+"' received)")}function a(f,d){[f,d].forEach(o);for(var g=i(f),m=i(d),_=0;_<Math.max(g.length-1,m.length-1);_++){var x=parseInt(g[_]||0,10),w=parseInt(m[_]||0,10);if(x>w)return 1;if(w>x)return-1}var E=g[g.length-1],v=m[m.length-1];if(E&&v){var S=E.split(".").map(s),A=v.split(".").map(s);for(_=0;_<Math.max(S.length,A.length);_++){if(S[_]===void 0||typeof A[_]=="string"&&typeof S[_]=="number")return-1;if(A[_]===void 0||typeof S[_]=="string"&&typeof A[_]=="number"||S[_]>A[_])return 1;if(A[_]>S[_])return-1}}else if(E||v)return E?-1:1;return 0}var l=[">",">=","=","<","<="],c={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function h(f){if(typeof f!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof f);if(l.indexOf(f)===-1)throw new TypeError("Invalid operator, expected one of "+l.join("|"))}return a.validate=function(f){return typeof f=="string"&&t.test(f)},a.compare=function(f,d,g){h(g);var m=a(f,d);return c[g].indexOf(m)>-1},a})})(ju);var KE=ju.exports,ss=KE;const fo="1.0.0",k=!0,H={classification:"https://stac-extensions.github.io/classification/v1.1.0/schema.json",datacube:"https://stac-extensions.github.io/datacube/v2.1.0/schema.json",eo:"https://stac-extensions.github.io/eo/v1.0.0/schema.json",file:"https://stac-extensions.github.io/file/v1.0.0/schema.json","item-assets":"https://stac-extensions.github.io/item-assets/v1.0.0/schema.json",label:"https://stac-extensions.github.io/label/v1.0.1/schema.json",pointcloud:"https://stac-extensions.github.io/pointcloud/v1.0.0/schema.json",processing:"https://stac-extensions.github.io/processing/v1.1.0/schema.json",projection:"https://stac-extensions.github.io/projection/v1.0.0/schema.json",raster:"https://stac-extensions.github.io/raster/v1.1.0/schema.json",sar:"https://stac-extensions.github.io/sar/v1.0.0/schema.json",sat:"https://stac-extensions.github.io/sat/v1.0.0/schema.json",scientific:"https://stac-extensions.github.io/scientific/v1.0.0/schema.json",table:"https://stac-extensions.github.io/table/v1.2.0/schema.json",timestamps:"https://stac-extensions.github.io/timestamps/v1.0.0/schema.json",version:"https://stac-extensions.github.io/version/v1.0.0/schema.json",view:"https://stac-extensions.github.io/view/v1.0.0/schema.json"},Vt={itemAndCollection:{"cube:":H.datacube,"eo:":H.eo,"file:":H.file,"label:":H.label,"pc:":H.pointcloud,"processing:":H.processing,"proj:":H.projection,"raster:":H.raster,"sar:":H.sar,"sat:":H.sat,"sci:":H.scientific,"view:":H.view,version:H.version,deprecated:H.version,published:H.timestamps,expires:H.timestamps,unpublished:H.timestamps},catalog:{},collection:{item_assets:H["item-assets"]},item:{}};Vt.collection=Object.assign(Vt.collection,Vt.itemAndCollection);Vt.item=Object.assign(Vt.item,Vt.itemAndCollection);var Mr={parseUrl(r){let e=r.match(/^https?:\/\/stac-extensions.github.io\/([^\/]+)\/v([^\/]+)\/[^.]+.json$/i);if(e)return{id:e[1],version:e[2]}}},ue={version:fo,extensions:{},set(r){if(typeof r.stac_version!="string"?ue.version="0.6.0":ue.version=r.stac_version,Array.isArray(r.stac_extensions))for(let e of r.stac_extensions){let t=Mr.parseUrl(e);t&&(ue.extensions[t.id]=t.version)}},before(r,e=null){let t=e?ue.extensions[e]:ue.version;return typeof t>"u"?!1:ss.compare(t,r,"<")}},b={type(r){let e=typeof r;if(e==="object"){if(r===null)return"null";if(Array.isArray(r))return"array"}return e},is(r,e){return b.type(r)===e},isDefined(r){return typeof r<"u"},isObject(r){return typeof r=="object"&&r===Object(r)&&!Array.isArray(r)},rename(r,e,t){return typeof r[e]<"u"&&typeof r[t]>"u"?(r[t]=r[e],delete r[e],!0):!1},forAll(r,e,t){if(r[e]&&typeof r[e]=="object")for(let n in r[e])t(r[e][n])},toArray(r,e){return typeof r[e]<"u"&&!Array.isArray(r[e])?(r[e]=[r[e]],!0):!1},flattenArray(r,e,t,n=!1){if(Array.isArray(r[e])){for(let i in r[e])if(typeof t[i]=="string"){let s=r[e][i];r[t[i]]=n?[s]:s}return delete r[e],!0}return!1},flattenOneElementArray(r,e,t=!1){return!t&&Array.isArray(r[e])?r[e].length===1?(r[e]=r[e][0],!0):!1:!0},removeFromArray(r,e,t){if(Array.isArray(r[e])){let n=r[e].indexOf(t);return n>-1&&r[e].splice(n,1),!0}return!1},ensure(r,e,t){return b.type(t)!==b.type(r[e])&&(r[e]=t),!0},upgradeExtension(r,e){let{id:t,version:n}=Mr.parseUrl(e),i=r.stac_extensions.findIndex(s=>{let o=Mr.parseUrl(s);return o&&o.id===t&&ss.compare(o.version,n,"<")});return i!==-1?(r.stac_extensions[i]=e,!0):!1},addExtension(r,e){let{id:t,version:n}=Mr.parseUrl(e),i=r.stac_extensions.findIndex(s=>{if(s===e)return!0;let o=Mr.parseUrl(s);return!!(o&&o.id===t&&ss.compare(o.version,n,"<"))});return i===-1?r.stac_extensions.push(e):r.stac_extensions[i]=e,r.stac_extensions.sort(),!0},removeExtension(r,e){return b.removeFromArray(r,"stac_extensions",e)},migrateExtensionShortnames(r){let e=Object.keys(H),t=Object.values(H);return b.mapValues(r,"stac_extensions",e,t)},populateExtensions(r,e){let t=[];(e=="catalog"||e=="collection")&&t.push(r),(e=="item"||e=="collection")&&b.isObject(r.assets)&&(t=t.concat(Object.values(r.assets))),e=="collection"&&b.isObject(r.item_assets)&&(t=t.concat(Object.values(r.item_assets))),e=="collection"&&b.isObject(r.summaries)&&t.push(r.summaries),e=="item"&&b.isObject(r.properties)&&t.push(r.properties);for(let n of t)Object.keys(n).forEach(i=>{let s=i.match(/^(\w+:|[^:]+$)/i);if(Array.isArray(s)){let o=Vt[e][s[0]];b.is(o,"string")&&b.addExtension(r,o)}})},mapValues(r,e,t,n){let i=s=>{let o=t.indexOf(s);return o>=0?n[o]:s};return Array.isArray(r[e])?r[e]=r[e].map(i):typeof r[e]<"u"&&(r[e]=i(r[e])),!0},mapObject(r,e){for(let t in r)r[t]=e(r[t],t)},moveTo(r,e,t,n=!1,i=!1){let s;return n?i?s=o=>Array.isArray(o):s=o=>Array.isArray(o)&&o.length===1:s=b.isDefined,s(r[e])?(t[e]=n&&!i?r[e][0]:r[e],delete r[e],!0):!1},runAll(r,e,t,n){for(let i in r)i.startsWith("migrate")||r[i](e,t,n)},toUTC(r,e){if(typeof r[e]=="string")try{return r[e]=this.toISOString(r[e]),!0}catch{}return delete r[e],!1},toISOString(r){return r instanceof Date||(r=new Date(r)),r.toISOString().replace(".000","")}},ut={multihash:null,hexToUint8(r){if(r.length===0||r.length%2!==0)throw new Error(`The string "${r}" is not valid hex.`);return new Uint8Array(r.match(/.{1,2}/g).map(e=>parseInt(e,16)))},uint8ToHex(r){return r.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),"")},toMultihash(r,e,t){if(!ut.multihash||!b.is(r[e],"string"))return!1;try{const n=ut.multihash.encode(ut.hexToUint8(r[e]),t);return r[e]=ut.uint8ToHex(n),!0}catch(n){return console.warn(n),!1}}},po={migrate(r,e=!0){return ue.set(r),e&&(r.stac_version=fo),r.type="Catalog",b.ensure(r,"stac_extensions",[]),ue.before("1.0.0-rc.1")&&b.migrateExtensionShortnames(r),b.ensure(r,"id",""),b.ensure(r,"description",""),b.ensure(r,"links",[]),b.runAll(po,r,r),ue.before("0.8.0")&&b.populateExtensions(r,"catalog"),r}},go={migrate(r,e=!0){return po.migrate(r,e),r.type="Collection",ue.before("1.0.0-rc.1")&&b.migrateExtensionShortnames(r),b.ensure(r,"license","proprietary"),b.ensure(r,"extent",{spatial:{bbox:[]},temporal:{interval:[]}}),b.runAll(go,r,r),b.isObject(r.properties)&&(b.removeFromArray(r,"stac_extensions","commons"),delete r.properties),ue.before("0.8.0")&&b.populateExtensions(r,"collection"),ue.before("1.0.0-beta.1")&&b.mapValues(r,"stac_extensions",["assets"],["item-assets"]),r},extent(r){if(b.ensure(r,"extent",{}),ue.before("0.8.0")&&(Array.isArray(r.extent.spatial)&&(r.extent.spatial={bbox:[r.extent.spatial]}),Array.isArray(r.extent.temporal)&&(r.extent.temporal={interval:[r.extent.temporal]})),b.ensure(r.extent,"spatial",{}),b.ensure(r.extent.spatial,"bbox",[]),b.ensure(r.extent,"temporal",{}),b.ensure(r.extent.temporal,"interval",[]),ue.before("1.0.0-rc.3")){if(r.extent.temporal.interval.length>1){let e,t;for(let n of r.extent.temporal.interval){if(n[0]===null)e=null;else if(typeof n[0]=="string"&&e!==null)try{let i=new Date(n[0]);(typeof e>"u"||i<e)&&(e=i)}catch{}if(n[1]===null)t=null;else if(typeof n[1]=="string"&&t!==null)try{let i=new Date(n[1]);(typeof t>"u"||i>t)&&(t=i)}catch{}}r.extent.temporal.interval.unshift([e?b.toISOString(e):null,t?b.toISOString(t):null])}if(r.extent.spatial.bbox.length>1){let e=r.extent.spatial.bbox.reduce((t,n)=>Array.isArray(n)?Math.max(n.length,t):t,4);if(e>=4){let t=new Array(e).fill(null),n=e/2;for(let i of r.extent.spatial.bbox){if(!Array.isArray(i)||i.length<4)break;for(let s in i){let o=i[s];t[s]===null?t[s]=o:s<n?t[s]=Math.min(o,t[s]):t[s]=Math.max(o,t[s])}}t.findIndex(i=>i===null)===-1&&r.extent.spatial.bbox.unshift(t)}}}},collectionAssets(r){ue.before("1.0.0-rc.1")&&b.removeExtension(r,"collection-assets"),an.migrateAll(r)},itemAsset(r){ue.before("1.0.0-beta.2")&&b.rename(r,"item_assets","assets"),an.migrateAll(r,"item_assets")},summaries(r){if(b.ensure(r,"summaries",{}),ue.before("0.8.0")&&b.isObject(r.other_properties)){for(let e in r.other_properties){let t=r.other_properties[e];Array.isArray(t.extent)&&t.extent.length===2?r.summaries[e]={minimum:t.extent[0],maximum:t.extent[1]}:Array.isArray(t.values)&&(t.values.filter(n=>Array.isArray(n)).length===t.values.length?r.summaries[e]=t.values.reduce((n,i)=>n.concat(i),[]):r.summaries[e]=t.values)}delete r.other_properties}if(ue.before("1.0.0-beta.1")&&b.isObject(r.properties)&&!r.links.find(e=>["child","item"].includes(e.rel)))for(let e in r.properties){let t=r.properties[e];Array.isArray(t)||(t=[t]),r.summaries[e]=t}ue.before("1.0.0-rc.1")&&b.mapObject(r.summaries,e=>(b.rename(e,"min","minimum"),b.rename(e,"max","maximum"),e)),di.migrate(r.summaries,r,!0),b.moveTo(r.summaries,"sci:doi",r,!0)&&b.addExtension(r,H.scientific),b.moveTo(r.summaries,"sci:publications",r,!0,!0)&&b.addExtension(r,H.scientific),b.moveTo(r.summaries,"sci:citation",r,!0)&&b.addExtension(r,H.scientific),b.moveTo(r.summaries,"cube:dimensions",r,!0)&&b.addExtension(r,H.datacube),Object.keys(r.summaries).length===0&&delete r.summaries}},mo={migrate(r,e=null,t=!0){ue.set(r),t&&(r.stac_version=fo),b.ensure(r,"stac_extensions",[]),ue.before("1.0.0-rc.1")&&b.migrateExtensionShortnames(r),b.ensure(r,"id",""),b.ensure(r,"type","Feature"),b.isObject(r.geometry)||(r.geometry=null),r.geometry!==null&&b.ensure(r,"bbox",[]),b.ensure(r,"properties",{}),b.ensure(r,"links",[]),b.ensure(r,"assets",{});let n=!1;return b.isObject(e)&&b.isObject(e.properties)&&(b.removeFromArray(r,"stac_extensions","commons"),r.properties=Object.assign({},e.properties,r.properties),n=!0),b.runAll(mo,r,r),di.migrate(r.properties,r),an.migrateAll(r),(ue.before("0.8.0")||n)&&b.populateExtensions(r,"item"),r}},Vu={migrate(r,e=!0){return b.ensure(r,"collections",[]),b.ensure(r,"links",[]),b.runAll(Vu,r,r),r.collections=r.collections.map(t=>go.migrate(t,e)),r}},Zu={migrate(r,e=!0){return b.ensure(r,"type","FeatureCollection"),b.ensure(r,"features",[]),b.ensure(r,"links",[]),b.runAll(Zu,r,r),r.features=r.features.map(t=>mo.migrate(t,null,e)),r}},an={migrateAll(r,e="assets"){for(let t in r[e])an.migrate(r[e][t],r)},migrate(r,e){return b.runAll(an,r,e),di.migrate(r,e),r},mediaTypes(r){b.is(r.type,"string")&&b.mapValues(r,"type",["image/vnd.stac.geotiff","image/vnd.stac.geotiff; cloud-optimized=true"],["image/tiff; application=geotiff","image/tiff; application=geotiff; profile=cloud-optimized"])},eo(r,e){let t=b.isObject(e.properties)&&Array.isArray(e.properties["eo:bands"])?e.properties["eo:bands"]:[];if(Array.isArray(r["eo:bands"]))for(let n in r["eo:bands"]){let i=r["eo:bands"][n];b.is(i,"number")&&b.isObject(t[i])?i=t[i]:b.isObject(i)||(i={}),r["eo:bands"][n]=i}}},di={migrate(r,e,t=!1){return b.runAll(di,r,e,t),r},_commonMetadata(r){ue.before("1.0.0-rc.3")&&(b.toUTC(r,"created"),b.toUTC(r,"updated"))},_timestamps(r,e){b.toUTC(r,"published"),b.toUTC(r,"expires"),b.toUTC(r,"unpublished"),b.upgradeExtension(e,H.timestamps)},_versioningIndicator(r,e){b.upgradeExtension(e,H.version)},checksum(r,e){ue.before("0.9.0")&&ut.multihash&&(b.rename(r,"checksum:md5","checksum:multihash")&&ut.toMultihash(r,"checksum:multihash","md5"),b.rename(r,"checksum:sha1","checksum:multihash")&&ut.toMultihash(r,"checksum:multihash","sha1"),b.rename(r,"checksum:sha2","checksum:multihash")&&ut.toMultihash(r,"checksum:multihash","sha2-256"),b.rename(r,"checksum:sha3","checksum:multihash")&&ut.toMultihash(r,"checksum:multihash","sha3-256")),ue.before("1.0.0-rc.1")&&b.rename(r,"checksum:multihash","file:checksum")&&b.addExtension(e,H.file),b.removeExtension(e,"checksum")},classification(r,e){ue.before("1.1.0","classification")&&b.forAll(r,"classification:classes",t=>b.rename(t,"color-hint","color_hint")),b.upgradeExtension(e,H.classification)},cube(r,e){b.upgradeExtension(e,H.datacube)},dtr(r,e){ue.before("0.9.0")&&(b.rename(r,"dtr:start_datetime","start_datetime"),b.rename(r,"dtr:end_datetime","end_datetime"),b.removeExtension(e,"datetime-range"))},eo(r,e){ue.before("0.9.0")&&(b.rename(r,"eo:epsg","proj:epsg")&&b.addExtension(e,H.projection),b.rename(r,"eo:platform","platform"),b.rename(r,"eo:instrument","instruments")&&b.toArray(r,"instruments"),b.rename(r,"eo:constellation","constellation"),b.rename(r,"eo:off_nadir","view:off_nadir")&&b.addExtension(e,H.view),b.rename(r,"eo:azimuth","view:azimuth")&&b.addExtension(e,H.view),b.rename(r,"eo:incidence_angle","view:incidence_angle")&&b.addExtension(e,H.view),b.rename(r,"eo:sun_azimuth","view:sun_azimuth")&&b.addExtension(e,H.view),b.rename(r,"eo:sun_elevation","view:sun_elevation")&&b.addExtension(e,H.view)),ue.before("1.0.0-beta.1")&&b.rename(r,"eo:gsd","gsd"),b.upgradeExtension(e,H.eo)},file(r,e){b.upgradeExtension(e,H.file)},label(r,e){ue.before("0.8.0")&&(b.rename(r,"label:property","label:properties"),b.rename(r,"label:task","label:tasks"),b.rename(r,"label:overview","label:overviews")&&b.toArray(r,"label:overviews"),b.rename(r,"label:method","label:methods"),b.toArray(r,"label:classes")),b.upgradeExtension(e,H.label)},pc(r,e){ue.before("0.8.0")&&b.rename(r,"pc:schema","pc:schemas"),b.upgradeExtension(e,H.pointcloud)},processing(r,e){b.upgradeExtension(e,H.processing)},proj(r,e){b.upgradeExtension(e,H.projection)},raster(r,e){b.upgradeExtension(e,H.raster)},sar(r,e,t){b.rename(r,"sar:incidence_angle","view:incidence_angle")&&b.addExtension(e,H.view),b.rename(r,"sar:pass_direction","sat:orbit_state")&&b.mapValues(r,"sat:orbit_state",[null],["geostationary"])&&b.addExtension(e,H.sat),ue.before("0.7.0")&&(b.flattenArray(r,"sar:resolution",["sar:resolution_range","sar:resolution_azimuth"],t),b.flattenArray(r,"sar:pixel_spacing",["sar:pixel_spacing_range","sar:pixel_spacing_azimuth"],t),b.flattenArray(r,"sar:looks",["sar:looks_range","sar:looks_azimuth","sar:looks_equivalent_number"],t),b.rename(r,"sar:off_nadir","view:off_nadir")&&b.addExtension(e,H.view)),ue.before("0.9.0")&&(b.rename(r,"sar:platform","platform"),b.rename(r,"sar:instrument","instruments")&&b.toArray(r,"instruments"),b.rename(r,"sar:constellation","constellation"),b.rename(r,"sar:type","sar:product_type"),b.rename(r,"sar:polarization","sar:polarizations"),b.flattenOneElementArray(r,"sar:absolute_orbit",t)&&b.rename(r,"sar:absolute_orbit","sat:absolute_orbit")&&b.addExtension(e,H.sat),b.flattenOneElementArray(r,"sar:relative_orbit",t)&&b.rename(r,"sar:relative_orbit","sat:relative_orbit")&&b.addExtension(e,H.sat)),b.upgradeExtension(e,H.sar)},sat(r,e){ue.before("0.9.0")&&(b.rename(r,"sat:off_nadir_angle","sat:off_nadir"),b.rename(r,"sat:azimuth_angle","sat:azimuth"),b.rename(r,"sat:sun_azimuth_angle","sat:sun_azimuth"),b.rename(r,"sat:sun_elevation_angle","sat:sun_elevation")),b.upgradeExtension(e,H.sat)},sci(r,e){b.upgradeExtension(e,H.scientific)},item(r){ue.before("0.8.0")&&(b.rename(r,"item:license","license"),b.rename(r,"item:providers","providers"))},table(r,e){b.upgradeExtension(e,H.table)},view(r,e){b.upgradeExtension(e,H.view)}},rr={item(r,e=null,t=!0){return mo.migrate(r,e,t)},catalog(r,e=!0){return po.migrate(r,e)},collection(r,e=!0){return go.migrate(r,e)},collectionCollection(r,e=!0){return Vu.migrate(r,e)},itemCollection(r,e=!0){return Zu.migrate(r,e)},stac(r,e=!0){return r.type==="Feature"?rr.item(r,null,e):r.type==="FeatureCollection"?rr.itemCollection(r,e):r.type==="Collection"||!r.type&&b.isDefined(r.extent)&&b.isDefined(r.license)?rr.collection(r,e):!r.type&&Array.isArray(r.collections)?rr.collectionCollection(r,e):rr.catalog(r,e)},enableMultihash(r){ut.multihash=r}},QE=rr;const JE=ni(QE);function $e(r){return typeof r=="string"&&r.length>0}function Be(r){return typeof r=="object"&&r===Object(r)&&!Array.isArray(r)}function Wu(...r){if(r=r.filter(e=>Array.isArray(e)),r.length>1){let e=Math.max(...r.map(n=>n.length)),t=[];for(let n=0;n<e;n++)t.push(Object.assign({},...r.map(i=>i[n])));return t}else if(r.length===1)return r[0];return[]}function ew(r){switch(r){case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648}return r.startsWith("u")?0:null}function tw(r){switch(r){case"int8":return 127;case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295}return null}class pi{constructor(e,t={},n=[]){if(!Be(e))throw new Error("Given data is not an object");if(e instanceof pi){for(let i of n)this[i]=e[i];e=e.toJSON()}this._keyMap=t,this._privateKeys=["_keyMap","_privateKeys"].concat(n);for(let i in e)typeof this[i]>"u"&&(i in t?this[i]=t[i](e[i],this):this[i]=e[i])}isItem(){return this.type==="Feature"}isCatalog(){return this.type==="Catalog"}isCatalogLike(){return this.isCatalog()||this.isCollection()}isCollection(){return this.type==="Collection"}isItemCollection(){return this.type==="FeatureCollection"}isCollectionCollection(){return!1}isAsset(){return!1}isLink(){return!1}getObjectType(){}getAbsoluteUrl(){return null}getMetadata(e){return this[e]}toGeoJSON(){return null}getBoundingBox(){return null}getBoundingBoxes(){return[]}toJSON(){let e={};return Object.keys(this).forEach(t=>{if(typeof this[t]=="function"||this._privateKeys.includes(t))return;let n=this[t];if(t in this._keyMap){let i=Array.isArray(n)?[]:{};for(let s in n)i[s]=n[s].toJSON();n=i}e[t]=n}),e}}var Hu={exports:{}},Fr={exports:{}};/*! https://mths.be/punycode v1.4.0 by @mathias */Fr.exports;var Ra;function rw(){return Ra||(Ra=1,function(r,e){(function(t){var n=e&&!e.nodeType&&e,i=r&&!r.nodeType&&r,s=typeof $t=="object"&&$t;(s.global===s||s.window===s||s.self===s)&&(t=s);var o,a=2147483647,l=36,c=1,h=26,f=38,d=700,g=72,m=128,_="-",x=/^xn--/,w=/[^\x20-\x7E]/,E=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},S=l-c,A=Math.floor,O=String.fromCharCode,I;function F(N){throw new RangeError(v[N])}function U(N,z){for(var Z=N.length,oe=[];Z--;)oe[Z]=z(N[Z]);return oe}function B(N,z){var Z=N.split("@"),oe="";Z.length>1&&(oe=Z[0]+"@",N=Z[1]),N=N.replace(E,".");var se=N.split("."),ce=U(se,z).join(".");return oe+ce}function V(N){for(var z=[],Z=0,oe=N.length,se,ce;Z<oe;)se=N.charCodeAt(Z++),se>=55296&&se<=56319&&Z<oe?(ce=N.charCodeAt(Z++),(ce&64512)==56320?z.push(((se&1023)<<10)+(ce&1023)+65536):(z.push(se),Z--)):z.push(se);return z}function J(N){return U(N,function(z){var Z="";return z>65535&&(z-=65536,Z+=O(z>>>10&1023|55296),z=56320|z&1023),Z+=O(z),Z}).join("")}function u(N){return N-48<10?N-22:N-65<26?N-65:N-97<26?N-97:l}function p(N,z){return N+22+75*(N<26)-((z!=0)<<5)}function y(N,z,Z){var oe=0;for(N=Z?A(N/d):N>>1,N+=A(N/z);N>S*h>>1;oe+=l)N=A(N/S);return A(oe+(S+1)*N/(N+f))}function T(N){var z=[],Z=N.length,oe,se=0,ce=m,ae=g,_e,Ce,Pe,Me,Ie,Ge,Je,St,Gt;for(_e=N.lastIndexOf(_),_e<0&&(_e=0),Ce=0;Ce<_e;++Ce)N.charCodeAt(Ce)>=128&&F("not-basic"),z.push(N.charCodeAt(Ce));for(Pe=_e>0?_e+1:0;Pe<Z;){for(Me=se,Ie=1,Ge=l;Pe>=Z&&F("invalid-input"),Je=u(N.charCodeAt(Pe++)),(Je>=l||Je>A((a-se)/Ie))&&F("overflow"),se+=Je*Ie,St=Ge<=ae?c:Ge>=ae+h?h:Ge-ae,!(Je<St);Ge+=l)Gt=l-St,Ie>A(a/Gt)&&F("overflow"),Ie*=Gt;oe=z.length+1,ae=y(se-Me,oe,Me==0),A(se/oe)>a-ce&&F("overflow"),ce+=A(se/oe),se%=oe,z.splice(se++,0,ce)}return J(z)}function L(N){var z,Z,oe,se,ce,ae,_e,Ce,Pe,Me,Ie,Ge=[],Je,St,Gt,gi;for(N=V(N),Je=N.length,z=m,Z=0,ce=g,ae=0;ae<Je;++ae)Ie=N[ae],Ie<128&&Ge.push(O(Ie));for(oe=se=Ge.length,se&&Ge.push(_);oe<Je;){for(_e=a,ae=0;ae<Je;++ae)Ie=N[ae],Ie>=z&&Ie<_e&&(_e=Ie);for(St=oe+1,_e-z>A((a-Z)/St)&&F("overflow"),Z+=(_e-z)*St,z=_e,ae=0;ae<Je;++ae)if(Ie=N[ae],Ie<z&&++Z>a&&F("overflow"),Ie==z){for(Ce=Z,Pe=l;Me=Pe<=ce?c:Pe>=ce+h?h:Pe-ce,!(Ce<Me);Pe+=l)gi=Ce-Me,Gt=l-Me,Ge.push(O(p(Me+gi%Gt,0))),Ce=A(gi/Gt);Ge.push(O(p(Ce,0))),ce=y(Z,St,oe==se),Z=0,++oe}++Z,++z}return Ge.join("")}function C(N){return B(N,function(z){return x.test(z)?T(z.slice(4).toLowerCase()):z})}function M(N){return B(N,function(z){return w.test(z)?"xn--"+L(z):z})}if(o={version:"1.3.2",ucs2:{decode:V,encode:J},decode:T,encode:L,toASCII:M,toUnicode:C},n&&i)if(r.exports==n)i.exports=o;else for(I in o)o.hasOwnProperty(I)&&(n[I]=o[I]);else t.punycode=o})($t)}(Fr,Fr.exports)),Fr.exports}var Ni={exports:{}};/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var ba;function nw(){return ba||(ba=1,function(r){(function(e,t){r.exports?r.exports=t():e.IPv6=t(e)})($t,function(e){var t=e&&e.IPv6;function n(s){var o=s.toLowerCase(),a=o.split(":"),l=a.length,c=8;a[0]===""&&a[1]===""&&a[2]===""?(a.shift(),a.shift()):a[0]===""&&a[1]===""?a.shift():a[l-1]===""&&a[l-2]===""&&a.pop(),l=a.length,a[l-1].indexOf(".")!==-1&&(c=7);var h;for(h=0;h<l&&a[h]!=="";h++);if(h<c)for(a.splice(h,1,"0000");a.length<c;)a.splice(h,0,"0000");for(var f,d=0;d<c;d++){f=a[d].split("");for(var g=0;g<3&&(f[0]==="0"&&f.length>1);g++)f.splice(0,1);a[d]=f.join("")}var m=-1,_=0,x=0,w=-1,E=!1;for(d=0;d<c;d++)E?a[d]==="0"?x+=1:(E=!1,x>_&&(m=w,_=x)):a[d]==="0"&&(E=!0,w=d,x=1);x>_&&(m=w,_=x),_>1&&a.splice(m,_,""),l=a.length;var v="";for(a[0]===""&&(v=":"),d=0;d<l&&(v+=a[d],d!==l-1);d++)v+=":";return a[l-1]===""&&(v+=":"),v}function i(){return e.IPv6===this&&(e.IPv6=t),this}return{best:n,noConflict:i}})}(Ni)),Ni.exports}var Di={exports:{}};/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var Pa;function iw(){return Pa||(Pa=1,function(r){(function(e,t){r.exports?r.exports=t():e.SecondLevelDomains=t(e)})($t,function(e){var t=e&&e.SecondLevelDomains,n={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return!1;var o=i.lastIndexOf(".",s-1);if(o<=0||o>=s-1)return!1;var a=n.list[i.slice(s+1)];return a?a.indexOf(" "+i.slice(o+1,s)+" ")>=0:!1},is:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return!1;var o=i.lastIndexOf(".",s-1);if(o>=0)return!1;var a=n.list[i.slice(s+1)];return a?a.indexOf(" "+i.slice(0,s)+" ")>=0:!1},get:function(i){var s=i.lastIndexOf(".");if(s<=0||s>=i.length-1)return null;var o=i.lastIndexOf(".",s-1);if(o<=0||o>=s-1)return null;var a=n.list[i.slice(s+1)];return!a||a.indexOf(" "+i.slice(o+1,s)+" ")<0?null:i.slice(o+1)},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=t),this}};return n})}(Di)),Di.exports}/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(r){(function(e,t){r.exports?r.exports=t(rw(),nw(),iw()):e.URI=t(e.punycode,e.IPv6,e.SecondLevelDomains,e)})($t,function(e,t,n,i){var s=i&&i.URI;function o(u,p){var y=arguments.length>=1,T=arguments.length>=2;if(!(this instanceof o))return y?T?new o(u,p):new o(u):new o;if(u===void 0){if(y)throw new TypeError("undefined is not a valid argument for URI");typeof location<"u"?u=location.href+"":u=""}if(u===null&&y)throw new TypeError("null is not a valid argument for URI");return this.href(u),p!==void 0?this.absoluteTo(p):this}function a(u){return/^[0-9]+$/.test(u)}o.version="1.19.11";var l=o.prototype,c=Object.prototype.hasOwnProperty;function h(u){return u.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function f(u){return u===void 0?"Undefined":String(Object.prototype.toString.call(u)).slice(8,-1)}function d(u){return f(u)==="Array"}function g(u,p){var y={},T,L;if(f(p)==="RegExp")y=null;else if(d(p))for(T=0,L=p.length;T<L;T++)y[p[T]]=!0;else y[p]=!0;for(T=0,L=u.length;T<L;T++){var C=y&&y[u[T]]!==void 0||!y&&p.test(u[T]);C&&(u.splice(T,1),L--,T--)}return u}function m(u,p){var y,T;if(d(p)){for(y=0,T=p.length;y<T;y++)if(!m(u,p[y]))return!1;return!0}var L=f(p);for(y=0,T=u.length;y<T;y++)if(L==="RegExp"){if(typeof u[y]=="string"&&u[y].match(p))return!0}else if(u[y]===p)return!0;return!1}function _(u,p){if(!d(u)||!d(p)||u.length!==p.length)return!1;u.sort(),p.sort();for(var y=0,T=u.length;y<T;y++)if(u[y]!==p[y])return!1;return!0}function x(u){var p=/^\/+|\/+$/g;return u.replace(p,"")}o._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:o.preventInvalidHostname,duplicateQueryParameters:o.duplicateQueryParameters,escapeQuerySpace:o.escapeQuerySpace}},o.preventInvalidHostname=!1,o.duplicateQueryParameters=!1,o.escapeQuerySpace=!0,o.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,o.idn_expression=/[^a-z0-9\._-]/i,o.punycode_expression=/(xn--)/i,o.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,o.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig,o.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},o.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,o.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,o.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},o.hostProtocols=["http","https"],o.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,o.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},o.getDomAttribute=function(u){if(!(!u||!u.nodeName)){var p=u.nodeName.toLowerCase();if(!(p==="input"&&u.type!=="image"))return o.domAttributes[p]}};function w(u){return escape(u)}function E(u){return encodeURIComponent(u).replace(/[!'()*]/g,w).replace(/\*/g,"%2A")}o.encode=E,o.decode=decodeURIComponent,o.iso8859=function(){o.encode=escape,o.decode=unescape},o.unicode=function(){o.encode=E,o.decode=decodeURIComponent},o.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},o.encodeQuery=function(u,p){var y=o.encode(u+"");return p===void 0&&(p=o.escapeQuerySpace),p?y.replace(/%20/g,"+"):y},o.decodeQuery=function(u,p){u+="",p===void 0&&(p=o.escapeQuerySpace);try{return o.decode(p?u.replace(/\+/g,"%20"):u)}catch{return u}};var v={encode:"encode",decode:"decode"},S,A=function(u,p){return function(y){try{return o[p](y+"").replace(o.characters[u][p].expression,function(T){return o.characters[u][p].map[T]})}catch{return y}}};for(S in v)o[S+"PathSegment"]=A("pathname",v[S]),o[S+"UrnPathSegment"]=A("urnpath",v[S]);var O=function(u,p,y){return function(T){var L;y?L=function(z){return o[p](o[y](z))}:L=o[p];for(var C=(T+"").split(u),M=0,N=C.length;M<N;M++)C[M]=L(C[M]);return C.join(u)}};o.decodePath=O("/","decodePathSegment"),o.decodeUrnPath=O(":","decodeUrnPathSegment"),o.recodePath=O("/","encodePathSegment","decode"),o.recodeUrnPath=O(":","encodeUrnPathSegment","decode"),o.encodeReserved=A("reserved","encode"),o.parse=function(u,p){var y;return p||(p={preventInvalidHostname:o.preventInvalidHostname}),u=u.replace(o.leading_whitespace_expression,""),u=u.replace(o.ascii_tab_whitespace,""),y=u.indexOf("#"),y>-1&&(p.fragment=u.substring(y+1)||null,u=u.substring(0,y)),y=u.indexOf("?"),y>-1&&(p.query=u.substring(y+1)||null,u=u.substring(0,y)),u=u.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://"),u=u.replace(/^[/\\]{2,}/i,"//"),u.substring(0,2)==="//"?(p.protocol=null,u=u.substring(2),u=o.parseAuthority(u,p)):(y=u.indexOf(":"),y>-1&&(p.protocol=u.substring(0,y)||null,p.protocol&&!p.protocol.match(o.protocol_expression)?p.protocol=void 0:u.substring(y+1,y+3).replace(/\\/g,"/")==="//"?(u=u.substring(y+3),u=o.parseAuthority(u,p)):(u=u.substring(y+1),p.urn=!0))),p.path=u,p},o.parseHost=function(u,p){u||(u=""),u=u.replace(/\\/g,"/");var y=u.indexOf("/"),T,L;if(y===-1&&(y=u.length),u.charAt(0)==="[")T=u.indexOf("]"),p.hostname=u.substring(1,T)||null,p.port=u.substring(T+2,y)||null,p.port==="/"&&(p.port=null);else{var C=u.indexOf(":"),M=u.indexOf("/"),N=u.indexOf(":",C+1);N!==-1&&(M===-1||N<M)?(p.hostname=u.substring(0,y)||null,p.port=null):(L=u.substring(0,y).split(":"),p.hostname=L[0]||null,p.port=L[1]||null)}return p.hostname&&u.substring(y).charAt(0)!=="/"&&(y++,u="/"+u),p.preventInvalidHostname&&o.ensureValidHostname(p.hostname,p.protocol),p.port&&o.ensureValidPort(p.port),u.substring(y)||"/"},o.parseAuthority=function(u,p){return u=o.parseUserinfo(u,p),o.parseHost(u,p)},o.parseUserinfo=function(u,p){var y=u,T=u.indexOf("\\");T!==-1&&(u=u.replace(/\\/g,"/"));var L=u.indexOf("/"),C=u.lastIndexOf("@",L>-1?L:u.length-1),M;return C>-1&&(L===-1||C<L)?(M=u.substring(0,C).split(":"),p.username=M[0]?o.decode(M[0]):null,M.shift(),p.password=M[0]?o.decode(M.join(":")):null,u=y.substring(C+1)):(p.username=null,p.password=null),u},o.parseQuery=function(u,p){if(!u)return{};if(u=u.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!u)return{};for(var y={},T=u.split("&"),L=T.length,C,M,N,z=0;z<L;z++)C=T[z].split("="),M=o.decodeQuery(C.shift(),p),N=C.length?o.decodeQuery(C.join("="),p):null,M!=="__proto__"&&(c.call(y,M)?((typeof y[M]=="string"||y[M]===null)&&(y[M]=[y[M]]),y[M].push(N)):y[M]=N);return y},o.build=function(u){var p="",y=!1;return u.protocol&&(p+=u.protocol+":"),!u.urn&&(p||u.hostname)&&(p+="//",y=!0),p+=o.buildAuthority(u)||"",typeof u.path=="string"&&(u.path.charAt(0)!=="/"&&y&&(p+="/"),p+=u.path),typeof u.query=="string"&&u.query&&(p+="?"+u.query),typeof u.fragment=="string"&&u.fragment&&(p+="#"+u.fragment),p},o.buildHost=function(u){var p="";if(u.hostname)o.ip6_expression.test(u.hostname)?p+="["+u.hostname+"]":p+=u.hostname;else return"";return u.port&&(p+=":"+u.port),p},o.buildAuthority=function(u){return o.buildUserinfo(u)+o.buildHost(u)},o.buildUserinfo=function(u){var p="";return u.username&&(p+=o.encode(u.username)),u.password&&(p+=":"+o.encode(u.password)),p&&(p+="@"),p},o.buildQuery=function(u,p,y){var T="",L,C,M,N;for(C in u)if(C!=="__proto__"&&c.call(u,C))if(d(u[C]))for(L={},M=0,N=u[C].length;M<N;M++)u[C][M]!==void 0&&L[u[C][M]+""]===void 0&&(T+="&"+o.buildQueryParameter(C,u[C][M],y),p!==!0&&(L[u[C][M]+""]=!0));else u[C]!==void 0&&(T+="&"+o.buildQueryParameter(C,u[C],y));return T.substring(1)},o.buildQueryParameter=function(u,p,y){return o.encodeQuery(u,y)+(p!==null?"="+o.encodeQuery(p,y):"")},o.addQuery=function(u,p,y){if(typeof p=="object")for(var T in p)c.call(p,T)&&o.addQuery(u,T,p[T]);else if(typeof p=="string"){if(u[p]===void 0){u[p]=y;return}else typeof u[p]=="string"&&(u[p]=[u[p]]);d(y)||(y=[y]),u[p]=(u[p]||[]).concat(y)}else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")},o.setQuery=function(u,p,y){if(typeof p=="object")for(var T in p)c.call(p,T)&&o.setQuery(u,T,p[T]);else if(typeof p=="string")u[p]=y===void 0?null:y;else throw new TypeError("URI.setQuery() accepts an object, string as the name parameter")},o.removeQuery=function(u,p,y){var T,L,C;if(d(p))for(T=0,L=p.length;T<L;T++)u[p[T]]=void 0;else if(f(p)==="RegExp")for(C in u)p.test(C)&&(u[C]=void 0);else if(typeof p=="object")for(C in p)c.call(p,C)&&o.removeQuery(u,C,p[C]);else if(typeof p=="string")y!==void 0?f(y)==="RegExp"?!d(u[p])&&y.test(u[p])?u[p]=void 0:u[p]=g(u[p],y):u[p]===String(y)&&(!d(y)||y.length===1)?u[p]=void 0:d(u[p])&&(u[p]=g(u[p],y)):u[p]=void 0;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")},o.hasQuery=function(u,p,y,T){switch(f(p)){case"String":break;case"RegExp":for(var L in u)if(c.call(u,L)&&p.test(L)&&(y===void 0||o.hasQuery(u,L,y)))return!0;return!1;case"Object":for(var C in p)if(c.call(p,C)&&!o.hasQuery(u,C,p[C]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(f(y)){case"Undefined":return p in u;case"Boolean":var M=!!(d(u[p])?u[p].length:u[p]);return y===M;case"Function":return!!y(u[p],p,u);case"Array":if(!d(u[p]))return!1;var N=T?m:_;return N(u[p],y);case"RegExp":return d(u[p])?T?m(u[p],y):!1:!!(u[p]&&u[p].match(y));case"Number":y=String(y);case"String":return d(u[p])?T?m(u[p],y):!1:u[p]===y;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},o.joinPaths=function(){for(var u=[],p=[],y=0,T=0;T<arguments.length;T++){var L=new o(arguments[T]);u.push(L);for(var C=L.segment(),M=0;M<C.length;M++)typeof C[M]=="string"&&p.push(C[M]),C[M]&&y++}if(!p.length||!y)return new o("");var N=new o("").segment(p);return(u[0].path()===""||u[0].path().slice(0,1)==="/")&&N.path("/"+N.path()),N.normalize()},o.commonPath=function(u,p){var y=Math.min(u.length,p.length),T;for(T=0;T<y;T++)if(u.charAt(T)!==p.charAt(T)){T--;break}return T<1?u.charAt(0)===p.charAt(0)&&u.charAt(0)==="/"?"/":"":((u.charAt(T)!=="/"||p.charAt(T)!=="/")&&(T=u.substring(0,T).lastIndexOf("/")),u.substring(0,T+1))},o.withinString=function(u,p,y){y||(y={});var T=y.start||o.findUri.start,L=y.end||o.findUri.end,C=y.trim||o.findUri.trim,M=y.parens||o.findUri.parens,N=/[a-z0-9-]=["']?$/i;for(T.lastIndex=0;;){var z=T.exec(u);if(!z)break;var Z=z.index;if(y.ignoreHtml){var oe=u.slice(Math.max(Z-3,0),Z);if(oe&&N.test(oe))continue}for(var se=Z+u.slice(Z).search(L),ce=u.slice(Z,se),ae=-1;;){var _e=M.exec(ce);if(!_e)break;var Ce=_e.index+_e[0].length;ae=Math.max(ae,Ce)}if(ae>-1?ce=ce.slice(0,ae)+ce.slice(ae).replace(C,""):ce=ce.replace(C,""),!(ce.length<=z[0].length)&&!(y.ignore&&y.ignore.test(ce))){se=Z+ce.length;var Pe=p(ce,Z,se,u);if(Pe===void 0){T.lastIndex=se;continue}Pe=String(Pe),u=u.slice(0,Z)+Pe+u.slice(se),T.lastIndex=Z+Pe.length}}return T.lastIndex=0,u},o.ensureValidHostname=function(u,p){var y=!!u,T=!!p,L=!1;if(T&&(L=m(o.hostProtocols,p)),L&&!y)throw new TypeError("Hostname cannot be empty, if protocol is "+p);if(u&&u.match(o.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+u+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(u).match(o.invalid_hostname_characters))throw new TypeError('Hostname "'+u+'" contains characters other than [A-Z0-9.-:_]')}},o.ensureValidPort=function(u){if(u){var p=Number(u);if(!(a(p)&&p>0&&p<65536))throw new TypeError('Port "'+u+'" is not a valid port')}},o.noConflict=function(u){if(u){var p={URI:this.noConflict()};return i.URITemplate&&typeof i.URITemplate.noConflict=="function"&&(p.URITemplate=i.URITemplate.noConflict()),i.IPv6&&typeof i.IPv6.noConflict=="function"&&(p.IPv6=i.IPv6.noConflict()),i.SecondLevelDomains&&typeof i.SecondLevelDomains.noConflict=="function"&&(p.SecondLevelDomains=i.SecondLevelDomains.noConflict()),p}else i.URI===this&&(i.URI=s);return this},l.build=function(u){return u===!0?this._deferred_build=!0:(u===void 0||this._deferred_build)&&(this._string=o.build(this._parts),this._deferred_build=!1),this},l.clone=function(){return new o(this)},l.valueOf=l.toString=function(){return this.build(!1)._string};function I(u){return function(p,y){return p===void 0?this._parts[u]||"":(this._parts[u]=p||null,this.build(!y),this)}}function F(u,p){return function(y,T){return y===void 0?this._parts[u]||"":(y!==null&&(y=y+"",y.charAt(0)===p&&(y=y.substring(1))),this._parts[u]=y,this.build(!T),this)}}l.protocol=I("protocol"),l.username=I("username"),l.password=I("password"),l.hostname=I("hostname"),l.port=I("port"),l.query=F("query","?"),l.fragment=F("fragment","#"),l.search=function(u,p){var y=this.query(u,p);return typeof y=="string"&&y.length?"?"+y:y},l.hash=function(u,p){var y=this.fragment(u,p);return typeof y=="string"&&y.length?"#"+y:y},l.pathname=function(u,p){if(u===void 0||u===!0){var y=this._parts.path||(this._parts.hostname?"/":"");return u?(this._parts.urn?o.decodeUrnPath:o.decodePath)(y):y}else return this._parts.urn?this._parts.path=u?o.recodeUrnPath(u):"":this._parts.path=u?o.recodePath(u):"/",this.build(!p),this},l.path=l.pathname,l.href=function(u,p){var y;if(u===void 0)return this.toString();this._string="",this._parts=o._parts();var T=u instanceof o,L=typeof u=="object"&&(u.hostname||u.path||u.pathname);if(u.nodeName){var C=o.getDomAttribute(u);u=u[C]||"",L=!1}if(!T&&L&&u.pathname!==void 0&&(u=u.toString()),typeof u=="string"||u instanceof String)this._parts=o.parse(String(u),this._parts);else if(T||L){var M=T?u._parts:u;for(y in M)y!=="query"&&c.call(this._parts,y)&&(this._parts[y]=M[y]);M.query&&this.query(M.query,!1)}else throw new TypeError("invalid input");return this.build(!p),this},l.is=function(u){var p=!1,y=!1,T=!1,L=!1,C=!1,M=!1,N=!1,z=!this._parts.urn;switch(this._parts.hostname&&(z=!1,y=o.ip4_expression.test(this._parts.hostname),T=o.ip6_expression.test(this._parts.hostname),p=y||T,L=!p,C=L&&n&&n.has(this._parts.hostname),M=L&&o.idn_expression.test(this._parts.hostname),N=L&&o.punycode_expression.test(this._parts.hostname)),u.toLowerCase()){case"relative":return z;case"absolute":return!z;case"domain":case"name":return L;case"sld":return C;case"ip":return p;case"ip4":case"ipv4":case"inet4":return y;case"ip6":case"ipv6":case"inet6":return T;case"idn":return M;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return N}return null};var U=l.protocol,B=l.port,V=l.hostname;l.protocol=function(u,p){if(u&&(u=u.replace(/:(\/\/)?$/,""),!u.match(o.protocol_expression)))throw new TypeError('Protocol "'+u+`" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]`);return U.call(this,u,p)},l.scheme=l.protocol,l.port=function(u,p){return this._parts.urn?u===void 0?"":this:(u!==void 0&&(u===0&&(u=null),u&&(u+="",u.charAt(0)===":"&&(u=u.substring(1)),o.ensureValidPort(u))),B.call(this,u,p))},l.hostname=function(u,p){if(this._parts.urn)return u===void 0?"":this;if(u!==void 0){var y={preventInvalidHostname:this._parts.preventInvalidHostname},T=o.parseHost(u,y);if(T!=="/")throw new TypeError('Hostname "'+u+'" contains characters other than [A-Z0-9.-]');u=y.hostname,this._parts.preventInvalidHostname&&o.ensureValidHostname(u,this._parts.protocol)}return V.call(this,u,p)},l.origin=function(u,p){if(this._parts.urn)return u===void 0?"":this;if(u===void 0){var y=this.protocol(),T=this.authority();return T?(y?y+"://":"")+this.authority():""}else{var L=o(u);return this.protocol(L.protocol()).authority(L.authority()).build(!p),this}},l.host=function(u,p){if(this._parts.urn)return u===void 0?"":this;if(u===void 0)return this._parts.hostname?o.buildHost(this._parts):"";var y=o.parseHost(u,this._parts);if(y!=="/")throw new TypeError('Hostname "'+u+'" contains characters other than [A-Z0-9.-]');return this.build(!p),this},l.authority=function(u,p){if(this._parts.urn)return u===void 0?"":this;if(u===void 0)return this._parts.hostname?o.buildAuthority(this._parts):"";var y=o.parseAuthority(u,this._parts);if(y!=="/")throw new TypeError('Hostname "'+u+'" contains characters other than [A-Z0-9.-]');return this.build(!p),this},l.userinfo=function(u,p){if(this._parts.urn)return u===void 0?"":this;if(u===void 0){var y=o.buildUserinfo(this._parts);return y&&y.substring(0,y.length-1)}else return u[u.length-1]!=="@"&&(u+="@"),o.parseUserinfo(u,this._parts),this.build(!p),this},l.resource=function(u,p){var y;return u===void 0?this.path()+this.search()+this.hash():(y=o.parse(u),this._parts.path=y.path,this._parts.query=y.query,this._parts.fragment=y.fragment,this.build(!p),this)},l.subdomain=function(u,p){if(this._parts.urn)return u===void 0?"":this;if(u===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,y)||""}else{var T=this._parts.hostname.length-this.domain().length,L=this._parts.hostname.substring(0,T),C=new RegExp("^"+h(L));if(u&&u.charAt(u.length-1)!=="."&&(u+="."),u.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return u&&o.ensureValidHostname(u,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(C,u),this.build(!p),this}},l.domain=function(u,p){if(this._parts.urn)return u===void 0?"":this;if(typeof u=="boolean"&&(p=u,u=void 0),u===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.match(/\./g);if(y&&y.length<2)return this._parts.hostname;var T=this._parts.hostname.length-this.tld(p).length-1;return T=this._parts.hostname.lastIndexOf(".",T-1)+1,this._parts.hostname.substring(T)||""}else{if(!u)throw new TypeError("cannot set domain empty");if(u.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");if(o.ensureValidHostname(u,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=u;else{var L=new RegExp(h(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(L,u)}return this.build(!p),this}},l.tld=function(u,p){if(this._parts.urn)return u===void 0?"":this;if(typeof u=="boolean"&&(p=u,u=void 0),u===void 0){if(!this._parts.hostname||this.is("IP"))return"";var y=this._parts.hostname.lastIndexOf("."),T=this._parts.hostname.substring(y+1);return p!==!0&&n&&n.list[T.toLowerCase()]&&n.get(this._parts.hostname)||T}else{var L;if(u)if(u.match(/[^a-zA-Z0-9-]/))if(n&&n.is(u))L=new RegExp(h(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(L,u);else throw new TypeError('TLD "'+u+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");L=new RegExp(h(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(L,u)}else throw new TypeError("cannot set TLD empty");return this.build(!p),this}},l.directory=function(u,p){if(this._parts.urn)return u===void 0?"":this;if(u===void 0||u===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var y=this._parts.path.length-this.filename().length-1,T=this._parts.path.substring(0,y)||(this._parts.hostname?"/":"");return u?o.decodePath(T):T}else{var L=this._parts.path.length-this.filename().length,C=this._parts.path.substring(0,L),M=new RegExp("^"+h(C));return this.is("relative")||(u||(u="/"),u.charAt(0)!=="/"&&(u="/"+u)),u&&u.charAt(u.length-1)!=="/"&&(u+="/"),u=o.recodePath(u),this._parts.path=this._parts.path.replace(M,u),this.build(!p),this}},l.filename=function(u,p){if(this._parts.urn)return u===void 0?"":this;if(typeof u!="string"){if(!this._parts.path||this._parts.path==="/")return"";var y=this._parts.path.lastIndexOf("/"),T=this._parts.path.substring(y+1);return u?o.decodePathSegment(T):T}else{var L=!1;u.charAt(0)==="/"&&(u=u.substring(1)),u.match(/\.?\//)&&(L=!0);var C=new RegExp(h(this.filename())+"$");return u=o.recodePath(u),this._parts.path=this._parts.path.replace(C,u),L?this.normalizePath(p):this.build(!p),this}},l.suffix=function(u,p){if(this._parts.urn)return u===void 0?"":this;if(u===void 0||u===!0){if(!this._parts.path||this._parts.path==="/")return"";var y=this.filename(),T=y.lastIndexOf("."),L,C;return T===-1?"":(L=y.substring(T+1),C=/^[a-z0-9%]+$/i.test(L)?L:"",u?o.decodePathSegment(C):C)}else{u.charAt(0)==="."&&(u=u.substring(1));var M=this.suffix(),N;if(M)u?N=new RegExp(h(M)+"$"):N=new RegExp(h("."+M)+"$");else{if(!u)return this;this._parts.path+="."+o.recodePath(u)}return N&&(u=o.recodePath(u),this._parts.path=this._parts.path.replace(N,u)),this.build(!p),this}},l.segment=function(u,p,y){var T=this._parts.urn?":":"/",L=this.path(),C=L.substring(0,1)==="/",M=L.split(T);if(u!==void 0&&typeof u!="number"&&(y=p,p=u,u=void 0),u!==void 0&&typeof u!="number")throw new Error('Bad segment "'+u+'", must be 0-based integer');if(C&&M.shift(),u<0&&(u=Math.max(M.length+u,0)),p===void 0)return u===void 0?M:M[u];if(u===null||M[u]===void 0)if(d(p)){M=[];for(var N=0,z=p.length;N<z;N++)!p[N].length&&(!M.length||!M[M.length-1].length)||(M.length&&!M[M.length-1].length&&M.pop(),M.push(x(p[N])))}else(p||typeof p=="string")&&(p=x(p),M[M.length-1]===""?M[M.length-1]=p:M.push(p));else p?M[u]=x(p):M.splice(u,1);return C&&M.unshift(""),this.path(M.join(T),y)},l.segmentCoded=function(u,p,y){var T,L,C;if(typeof u!="number"&&(y=p,p=u,u=void 0),p===void 0){if(T=this.segment(u,p,y),!d(T))T=T!==void 0?o.decode(T):void 0;else for(L=0,C=T.length;L<C;L++)T[L]=o.decode(T[L]);return T}if(!d(p))p=typeof p=="string"||p instanceof String?o.encode(p):p;else for(L=0,C=p.length;L<C;L++)p[L]=o.encode(p[L]);return this.segment(u,p,y)};var J=l.query;return l.query=function(u,p){if(u===!0)return o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof u=="function"){var y=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace),T=u.call(this,y);return this._parts.query=o.buildQuery(T||y,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!p),this}else return u!==void 0&&typeof u!="string"?(this._parts.query=o.buildQuery(u,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!p),this):J.call(this,u,p)},l.setQuery=function(u,p,y){var T=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof u=="string"||u instanceof String)T[u]=p!==void 0?p:null;else if(typeof u=="object")for(var L in u)c.call(u,L)&&(T[L]=u[L]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=o.buildQuery(T,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof u!="string"&&(y=p),this.build(!y),this},l.addQuery=function(u,p,y){var T=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.addQuery(T,u,p===void 0?null:p),this._parts.query=o.buildQuery(T,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof u!="string"&&(y=p),this.build(!y),this},l.removeQuery=function(u,p,y){var T=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.removeQuery(T,u,p),this._parts.query=o.buildQuery(T,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof u!="string"&&(y=p),this.build(!y),this},l.hasQuery=function(u,p,y){var T=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.hasQuery(T,u,p,y)},l.setSearch=l.setQuery,l.addSearch=l.addQuery,l.removeSearch=l.removeQuery,l.hasSearch=l.hasQuery,l.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},l.normalizeProtocol=function(u){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!u)),this},l.normalizeHostname=function(u){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!u)),this},l.normalizePort=function(u){return typeof this._parts.protocol=="string"&&this._parts.port===o.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!u)),this},l.normalizePath=function(u){var p=this._parts.path;if(!p)return this;if(this._parts.urn)return this._parts.path=o.recodeUrnPath(this._parts.path),this.build(!u),this;if(this._parts.path==="/")return this;p=o.recodePath(p);var y,T="",L,C;for(p.charAt(0)!=="/"&&(y=!0,p="/"+p),(p.slice(-3)==="/.."||p.slice(-2)==="/.")&&(p+="/"),p=p.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),y&&(T=p.substring(1).match(/^(\.\.\/)+/)||"",T&&(T=T[0]));L=p.search(/\/\.\.(\/|$)/),L!==-1;){if(L===0){p=p.substring(3);continue}C=p.substring(0,L).lastIndexOf("/"),C===-1&&(C=L),p=p.substring(0,C)+p.substring(L+3)}return y&&this.is("relative")&&(p=T+p.substring(1)),this._parts.path=p,this.build(!u),this},l.normalizePathname=l.normalizePath,l.normalizeQuery=function(u){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(o.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!u)),this},l.normalizeFragment=function(u){return this._parts.fragment||(this._parts.fragment=null,this.build(!u)),this},l.normalizeSearch=l.normalizeQuery,l.normalizeHash=l.normalizeFragment,l.iso8859=function(){var u=o.encode,p=o.decode;o.encode=escape,o.decode=decodeURIComponent;try{this.normalize()}finally{o.encode=u,o.decode=p}return this},l.unicode=function(){var u=o.encode,p=o.decode;o.encode=E,o.decode=unescape;try{this.normalize()}finally{o.encode=u,o.decode=p}return this},l.readable=function(){var u=this.clone();u.username("").password("").normalize();var p="";if(u._parts.protocol&&(p+=u._parts.protocol+"://"),u._parts.hostname&&(u.is("punycode")&&e?(p+=e.toUnicode(u._parts.hostname),u._parts.port&&(p+=":"+u._parts.port)):p+=u.host()),u._parts.hostname&&u._parts.path&&u._parts.path.charAt(0)!=="/"&&(p+="/"),p+=u.path(!0),u._parts.query){for(var y="",T=0,L=u._parts.query.split("&"),C=L.length;T<C;T++){var M=(L[T]||"").split("=");y+="&"+o.decodeQuery(M[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),M[1]!==void 0&&(y+="="+o.decodeQuery(M[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}p+="?"+y.substring(1)}return p+=o.decodeQuery(u.hash(),!0),p},l.absoluteTo=function(u){var p=this.clone(),y=["protocol","username","password","hostname","port"],T,L,C;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(u instanceof o||(u=new o(u)),p._parts.protocol||(p._parts.protocol=u._parts.protocol,this._parts.hostname))return p;for(L=0;C=y[L];L++)p._parts[C]=u._parts[C];return p._parts.path?(p._parts.path.substring(-2)===".."&&(p._parts.path+="/"),p.path().charAt(0)!=="/"&&(T=u.directory(),T=T||(u.path().indexOf("/")===0?"/":""),p._parts.path=(T?T+"/":"")+p._parts.path,p.normalizePath())):(p._parts.path=u._parts.path,p._parts.query||(p._parts.query=u._parts.query)),p.build(),p},l.relativeTo=function(u){var p=this.clone().normalize(),y,T,L,C,M;if(p._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(u=new o(u).normalize(),y=p._parts,T=u._parts,C=p.path(),M=u.path(),C.charAt(0)!=="/")throw new Error("URI is already relative");if(M.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");if(y.protocol===T.protocol&&(y.protocol=null),y.username!==T.username||y.password!==T.password||y.protocol!==null||y.username!==null||y.password!==null)return p.build();if(y.hostname===T.hostname&&y.port===T.port)y.hostname=null,y.port=null;else return p.build();if(C===M)return y.path="",p.build();if(L=o.commonPath(C,M),!L)return p.build();var N=T.path.substring(L.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return y.path=N+y.path.substring(L.length)||"./",p.build()},l.equals=function(u){var p=this.clone(),y=new o(u),T={},L={},C={},M,N,z;if(p.normalize(),y.normalize(),p.toString()===y.toString())return!0;if(M=p.query(),N=y.query(),p.query(""),y.query(""),p.toString()!==y.toString()||M.length!==N.length)return!1;T=o.parseQuery(M,this._parts.escapeQuerySpace),L=o.parseQuery(N,this._parts.escapeQuerySpace);for(z in T)if(c.call(T,z)){if(d(T[z])){if(!_(T[z],L[z]))return!1}else if(T[z]!==L[z])return!1;C[z]=!0}for(z in L)if(c.call(L,z)&&!C[z])return!1;return!0},l.preventInvalidHostname=function(u){return this._parts.preventInvalidHostname=!!u,this},l.duplicateQueryParameters=function(u){return this._parts.duplicateQueryParameters=!!u,this},l.escapeQuerySpace=function(u){return this._parts.escapeQuerySpace=!!u,this},o})})(Hu);var sw=Hu.exports;const os=ni(sw),Aa=["http","https"];function ow(r){return typeof r=="string"&&r.startsWith("/vsi")&&!r.startsWith("/vsicurl/")}function aw(r,e,t=!0){return lw(r,e,!1,t)}function lw(r,e=null,t=!1,n=!0){typeof r=="string"&&r.startsWith("/vsicurl/")&&(r=r.replace(/^\/vsicurl\//,""));let i=os(r);if(e&&i.is("relative")&&!ow(r)){let s=os(e),o=s.path();!o.endsWith("/")&&!o.endsWith(".json")&&s.path(o+"/"),i=i.absoluteTo(s)}return i.normalize(),t&&(i.query(""),i.fragment("")),n?i.toString():i}const cw="application/geo+json",uw=["application/json",cw,"text/json"],La=["image/gif","image/jpeg","image/apng","image/png","image/webp"],Xu=["image/tiff; application=geotiff; profile=cloud-optimized","image/vnd.stac.geotiff; cloud-optimized=true"],Yu=["application/geotiff","image/tiff; application=geotiff","image/vnd.stac.geotiff"].concat(Xu);function yo(r,e,t=!1){return Array.isArray(e)||(e=[e]),t&&typeof r>"u"?!0:typeof r!="string"?!1:(e=e.map(n=>n.toLowerCase()),e.includes(r.toLowerCase()))}function hw(r,e=!1){return yo(r,uw,e)}class qu extends pi{constructor(e,t=null,n={},i=[]){super(e,n,["_context"].concat(i)),this._context||(this._context=t)}getAbsoluteUrl(e=!0){return this._context?aw(this.href,this._context.getAbsoluteUrl(),e):this.href.includes("://")?this.href:null}getContext(){return this._context}canBrowserDisplayImage(e=!1){if(typeof this.href!="string")return!1;if(!e&&typeof this.type>"u")return!1;let t=new os(this.href),n=t.protocol().toLowerCase(),i=t.suffix().toLowerCase();return $e(n)&&!Aa.includes(n)?!1:$e(this.type)&&La.includes(this.type.toLowerCase())?!0:!!(typeof this.type>"u"&&$e(i)&&(i==="jpg"||La.includes("image/"+i)))}isType(e){return $e(this.type)&&yo(this.type,e)}isGeoTIFF(){return this.isType(Yu)}isCOG(){return this.isType(Xu)}isHTTP(){let t=this.getAbsoluteUrl(!1).protocol().toLowerCase();return $e(t)&&Aa.includes(t)}}class _o extends qu{constructor(e,t=null){super(e,t)}isLink(){return!0}getObjectType(){return"Link"}static fromLinks(e,t=null){return Array.isArray(e)?e.map(n=>Be(n)?new _o(n,t):n):[]}}class Ku extends pi{constructor(e,t=null,n={},i=[]){if(super(e,Object.assign({links:_o.fromLinks},n),["_url"].concat(i)),!this._url&&(this._url=t,!this._url)){let s=this.getSelfLink();s&&(this._url=s.href)}}getAbsoluteUrl(){return this._url}setAbsoluteUrl(e){this._url=e}getStacLinksWithRel(e,t=!0){return this.getLinksWithRels([e]).filter(n=>hw(n.type,t))}getStacLinkWithRel(e,t=!0){const n=this.getStacLinksWithRel(e,t);return n.length>0?n[0]:null}getLinks(){return Array.isArray(this.links)?this.links.filter(e=>Be(e)&&$e(e.href)):[]}getLinkWithRel(e){return this.getLinks().find(t=>t.rel===e)||null}getLinksWithRels(e){return this.getLinks().filter(t=>e.includes(t.rel))}getLinksWithOtherRels(e){return this.getLinks().filter(t=>!e.includes(t.rel))}getSelfLink(){return this.getStacLinkWithRel("self")}getRootLink(){return this.getStacLinkWithRel("root")}getParentLink(){return this.getStacLinkWithRel("parent")}}class Qu extends Ku{constructor(e,t=null,n={},i=[]){super(e,t,n,i)}getAll(){return[]}}class It extends qu{constructor(e,t=null,n=null){super(e,n,{},["_key"]),this._key||(this._key=t)}getObjectType(){return"Asset"}isAsset(){return!0}getAbsoluteUrl(e=!0){return this.isDefintion()?null:super.getAbsoluteUrl(e)}getKey(){return this._key}getMetadata(e){if(typeof this[e]<"u")return this[e];if(this._context)return this._context.getMetadata(e)}getBands(){return Wu(this["eo:bands"],this["raster:bands"])}findVisualBands(){let e={red:null,green:null,blue:null},t=this.getBands();for(let i in t){let s=parseInt(i,10),o=t[s];Be(o)&&$e(o.common_name)&&o.common_name in e&&(e[o.common_name]={index:s,band:o})}return Object.values(e).every(i=>i!==null)?e:null}findBand(e,t="name",n=null){Array.isArray(e)||(e=[e]),Be(n)||(n=this.getBands());let i=n.findIndex(s=>Be(s)&&e.includes(s[t]));return i>=0?{index:i,band:n[i]}:null}getBand(e){return Be(e)||e===null?e:this.getBands()[e]||null}getMinMaxValues(e=null){e=this.getBand(e);const t={minimum:null,maximum:null},n=a=>a.minimum!==null&&a.maximum!==null;if(e&&(Be(e.statistics)&&(typeof e.statistics.minimum=="number"&&(t.minimum=e.statistics.minimum),typeof e.statistics.maximum=="number"&&(t.maximum=e.statistics.maximum),n(t))||Be(e.histogram)&&(typeof e.histogram.min=="number"&&(t.minimum=e.histogram.min),typeof e.histogram.max=="number"&&(t.maximum=e.histogram.max),n(t))))return t;let i=this.getMetadata("classification:classes");if(Array.isArray(i)&&(i.reduce((a,l)=>(a.minimum=Math.min(a.minimum,l.value),a.maximum=Math.max(a.maximum,l.value),a),t),n(t)))return t;let s=this.getMetadata("file:values");if(Array.isArray(s)&&(s.reduce((a,l)=>(a.minimum=Math.min(a.minimum,...l.values),a.maximum=Math.max(a.maximum,...l.values),a),t),n(t)))return t;let o=Be(e)&&e.data_type||this.getMetadata("file:data_type");return o&&(t.minimum=ew(o),t.maximum=tw(o)),t}getNoDataValues(e=null){e=this.getBand(e);let t=[];if(e&&typeof e.nodata<"u")t.push(e.nodata);else{let n=this.getMetadata("file:nodata");if(typeof n<"u")t=n;else{let i=this.getMetadata("classification:classes");Array.isArray(i)&&(t=i.filter(s=>!!s.nodata).map(s=>s.value))}}return t.map(n=>n==="nan"?NaN:n==="+inf"?1/0:n==="-inf"?-1/0:n)}isDefintion(){return!$e(this.href)}isHTTP(){return this.isDefintion()?null:super.isHTTP()}hasRole(e,t=!1){return Array.isArray(e)||(e=[e]),t&&e.includes(this.getKey())?!0:Array.isArray(this.roles)&&!!this.roles.find(n=>e.includes(n))}static fromAssets(e,t=null){let n={};if(Be(e))for(let i in e)n[i]=new It(e[i],i,t);return n}}class mn extends Ku{constructor(e,t=null,n={},i=[]){super(e,t,n,i)}getTemporalExtent(){return null}getTemporalExtents(){return[]}getIcons(e=!0){return this.getLinksWithRels(["icon"]).filter(t=>t.canBrowserDisplayImage(e))}getThumbnails(e=!0,t=null){let n=this.getAssetsWithRoles(["thumbnail","overview"],!0);return t&&n.length>1&&n.sort(i=>Array.isArray(i.roles)&&i.roles.includes(t)||i.getKey()===t?-1:1),n.length===0&&(n=this.getLinksWithRels(["preview"])),e&&(n=n.filter(i=>i.canBrowserDisplayImage())),n}getDefaultGeoTIFF(e=!0,t=!1){var i;return(i=this.rankGeoTIFFs(e,t)[0])==null?void 0:i.asset}rankGeoTIFFs(e=!0,t=!1,n=null,i=null){Be(n)||(n={data:1,visual:2,thumbnail:2,overview:3});let s=[],o=this.getAssetsByTypes(Yu);e&&(o=o.filter(l=>l.isHTTP()&&(!t||l.isCOG())));let a=Object.entries(n);for(let l of o){let c=0;if(a.length>0){let h=a.filter(([f])=>l.hasRole(f,!0)).map(([,f])=>f);h.length>0&&(c+=Math.max(...h))}!t&&l.isCOG()&&(c+=2),l.findVisualBands()&&(c+=1),typeof i=="function"&&(c+=i(l)),s.push({asset:l,score:c})}return s.sort((l,c)=>c.score-l.score),s}findVisualAssets(){let e={red:null,green:null,blue:null},t=Object.keys(e),n=this.getAssets();for(let s of n){let o=s.getBands();if(o.length!==1)continue;let a=s.findBand(t,"common_name",o);a&&(e[a.band.common_name]=s)}return Object.values(e).every(s=>s!==null)?e:null}getAsset(e){return Be(this.assets)&&this.assets[e]||null}getAssets(){return Be(this.assets)?Object.values(this.assets):[]}getAssetsWithRoles(e,t=!1){return this.getAssets().filter(n=>n.hasRole(e,t))}getAssetWithRole(e,t=!1){return this.getAssetsWithRoles([e],t)[0]||null}getAssetsByTypes(e){return this.getAssets().filter(t=>yo(t.type,e))}equals(e){return this===e?!0:!(e instanceof mn)||this.getObjectType()!==e.getObjectType()?!1:!!(this.id&&this.id===e.id)}}class Ju extends mn{constructor(e,t=null,n={},i=[]){super(e,t,n,i)}getObjectType(){return this.type}getSearchLink(e=null){let t=this.getStacLinksWithRel("search");return e?t[0]||null:t.find(n=>n.method===e||!e&&!n.method)||null}getApiCollectionsLink(){return this.getStacLinkWithRel("data")}getApiItemsLink(){return this.getStacLinkWithRel("items")}getChildLinks(){return this.getStacLinksWithRel("child")}getItemLinks(){return this.getStacLinksWithRel("item")}}class fw extends Ju{constructor(e,t=null){super(e,t)}}function Nr(r){if($e(r)&&r.length>=10)try{let t=r.match(/^(-?\d{1,})-(\d\d)-(\d\d)[T ](\d\d):(\d\d):(\d\d)(?:\.(\d*))?(?:Z|[+-]00:00)?$/i).slice(1).map(n=>parseInt(n,10));return new Date(Date.UTC(t[0],t[1]-1,t[2],t[3],t[4],t[5],t[6]||0))}catch{return null}return null}function dw(r,e){return new Date(r.valueOf()+(e-r)/2)}function eh(r){if(!Array.isArray(r)||r.length===0)return null;let e,t;const n=(i,s,o)=>typeof i>"u"?s:i===null||s===null?null:o(i,s);return r.forEach(([i,s])=>{e=n(e,i,Math.min),t=n(t,s,Math.max)}),[e===null?null:new Date(e),t===null?null:new Date(t)]}function yn(r){let e=r.length>4,t=r[0],n=r[e?3:2],i=r[1],s=r[e?4:3];return{west:t,east:n,south:i,north:s}}function Gi(r){let{west:e,east:t,south:n,north:i}=yn(r);return[[[e,i],[e,n],[t,n],[t,i],[e,i]]]}function th(r){if(dt(r)?r=[r]:Array.isArray(r)&&(r=r.filter(n=>dt(n))),!Array.isArray(r)||r.length===0)return null;let e=r.reduce((n,i)=>{if(pw(i)){let{west:s,east:o,south:a,north:l}=yn(i);n.push(Gi([-180,a,o,l])),n.push(Gi([s,a,180,l]))}else n.push(Gi(i));return n},[]),t=null;if(e.length===1?t={type:"Polygon",coordinates:e[0]}:e.length>1&&(t={type:"MultiPolygon",coordinates:e}),t)return{type:"Feature",geometry:t,properties:{}}}function dt(r){if(!Array.isArray(r)||![4,6].includes(r.length)||r.some(s=>typeof s!="number"))return!1;let{west:e,east:t,south:n,north:i}=yn(r);return n<=i&&e>=-180&&e<=180&&n>=-90&&t<=180&&t>=-180&&i<=90}function pw(r){if(!dt(r))return!1;let{west:e,east:t}=yn(r);return e>t}function rh(r){if(!Array.isArray(r)||r.length===0)return null;let e={west:180,south:90,east:-180,north:-90};r.forEach(n=>{if(!dt(n))return;let i=yn(n),s=["west","south"];for(let o in i){let a=s.includes(o)?Math.min:Math.max;e[o]=a(e[o],i[o])}});let t=[e.west,e.south,e.east,e.north];return dt(t)?t:null}class nh extends Ju{constructor(e,t=null){const n={assets:It.fromAssets,item_assets:It.fromAssets};super(e,t,n)}toGeoJSON(){let e=th(this.getBoundingBoxes());return e&&(e.id=this.id),e}getBoundingBox(){let e=this.getRawBoundingBoxes();return e.length>0&&dt(e[0])?e[0]:null}getBoundingBoxes(){let e=this.getRawBoundingBoxes();return e.length===1&&dt(e[0])?e:e.length>1?e.filter((t,n)=>n>0&&dt(t)):[]}getRawBoundingBoxes(){var t,n;let e=(n=(t=this.extent)==null?void 0:t.spatial)==null?void 0:n.bbox;return Array.isArray(e)&&e.length>0?e:[]}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){var t,n;let e=(n=(t=this.extent)==null?void 0:t.temporal)==null?void 0:n.interval;return Array.isArray(e)&&e.length>0?e.filter(i=>Array.isArray(i)&&($e(i[0])||$e(i[1]))).map(i=>i.map(s=>Nr(s))):[]}getSummary(e){return this.summaries[e]}getBands(){let e=this.getSummary("eo:bands"),t=this.getSummary("raster:bands"),n=[e,t].filter(i=>Array.isArray(i));return n.length>=2?Wu(...n):n.length===1?n[0]:[]}}class gw extends Qu{constructor(e,t=null){const n={collections:i=>i.map(s=>new nh(s))};super(e,t,n)}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map(t=>t.toGeoJSON()).filter(t=>t!==null)}}getBoundingBox(){return rh(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map(e=>e.getBoundingBox())}getTemporalExtent(){return eh(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map(e=>e.getTemporalExtent())}}class ih extends mn{constructor(e,t=null){super(e,t,{assets:It.fromAssets})}getObjectType(){return"Item"}toGeoJSON(){return this.toJSON()}getBoundingBox(){return dt(this.bbox)?this.bbox:null}getBoundingBoxes(){return dt(this.bbox)?[this.bbox]:[]}getDateTime(){let e=Nr(this.properties.datetime);if(!e){let t=Nr(this.properties.start_datetime),n=Nr(this.properties.end_datetime);return t&&n?dw(t,n):t||n}return e}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let e=[];return $e(this.properties.start_datetime)||$e(this.properties.end_datetime)?e=[[this.properties.start_datetime||null,this.properties.end_datetime||null]]:$e(this.properties.datetime)&&(e=[[this.properties.datetime,this.properties.datetime]]),e.map(t=>t.map(n=>Nr(n)))}getMetadata(e){return this.properties[e]}getBands(){let e=this.getMetadata("eo:bands");return Array.isArray(e)?e:[]}getCollectionLink(){return this.getStacLinkWithRel("collection")}}class mw extends Qu{constructor(e,t=null){const n={features:i=>i.map(s=>new ih(s))};super(e,t,n)}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return rh(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map(e=>e.getBoundingBox())}getTemporalExtent(){return eh(this.getTemporalExtents())}getTemporalExtents(){return this.features.map(e=>e.getTemporalExtent())}}function yw(r,e=!0,t=!1){return e&&(r=JE.stac(r,t)),r.type==="Feature"?new ih(r):r.type==="FeatureCollection"?new mw(r):r.type==="Collection"||!r.type&&typeof r.extent<"u"&&typeof r.license<"u"?new nh(r):!r.type&&Array.isArray(r.collections)?new gw(r):new fw(r)}class Ia extends Ws{constructor(t){super({...t,state:"loading"});mi(this,"loadImage",t=>new Promise((n,i)=>{const s=new Image;s.addEventListener("load",()=>n(s)),s.addEventListener("error",()=>i(new Error("load failed"))),s.src=t}));const n=new ho(t.url);n.getHeader().then(i=>{this.tileGrid.minZoom=i.minZoom,this.tileGrid.maxZoom=i.maxZoom,this.setLoader(async(s,o,a)=>{const l=await n.getZxy(s,o,a),c=URL.createObjectURL(new Blob([l.data])),h=await this.loadImage(c);return URL.revokeObjectURL(c),h}),this.setState("ready")})}}class _w extends ri{constructor(t){super({...t,state:"loading",url:"pmtiles://"+t.url+"/{z}/{x}/{y}",format:new zl});mi(this,"tileLoadFunction",(t,n)=>{const i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=n.match(i),o=+s[2],a=+s[3],l=+s[4];t.setLoader((c,h,f)=>{t.setState(Y.LOADING),this.pmtiles_.getZxy(o,a,l).then(d=>{if(d){const g=t.getFormat();t.setFeatures(g.readFeatures(d.data,{extent:c,featureProjection:f})),t.setState(Y.LOADED)}else t.setFeatures([]),t.setState(Y.EMPTY)}).catch(d=>{t.setFeatures([]),t.setState(Y.ERROR)})})});this.pmtiles_=new ho(t.url),this.pmtiles_.getHeader().then(n=>{this.tileGrid.minZoom=n.minZoom,this.tileGrid.maxZoom=n.maxZoom,this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}}const xw=new Xr({fill:new ki({color:"rgba(255,255,255,0.4)"}),stroke:new Qr({color:"#3399CC",width:3})}),Ew=new Xr({stroke:new Qr({color:"#ff9933",width:1})});function ww(r,e){const t={url:r.getAbsoluteUrl()};let n=null;r.getBands().length===1&&(n=0);const{minimum:i,maximum:s}=r.getMinMaxValues(n);typeof i=="number"&&(t.min=i),typeof s=="number"&&(t.max=s);const o=r.getNoDataValues(n);return o.length>0&&(t.nodata=o[0]),e.length>0&&(t.bands=e),t}async function Ca(r,e=void 0){let t=e;if(Ef()){const n=r.getMetadata("proj:epsg");if(n)try{t=await wf(n)}catch{}}return t}function Oa(r,e){const t=r.clone();return e.hasOnlyBounds()||t.setFill(null),t}function Tw(r){let e=r.href;if(e.includes("{s}"))if(Array.isArray(r["href:servers"])&&r["href:servers"].length>0){const t=Math.random()*r["href:servers"].length|0;e=e.replace("{s}",r["href:servers"][t])}else return null;return e}async function vw(r){try{const e=new URL(r);e.searchParams.set("service","wmts"),e.searchParams.set("request","GetCapabilities");const t=await fetch(e);return new Pc().read(await t.text())}catch{return null}}let Sw=class sh extends Ql{constructor(e){const t={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(n=>t[n]=e[n]),super(t),this.getSourceOptions_=e.getSourceOptions,this.data_,this.assets_=null,this.bands_=[],this.crossOrigin_=e.crossOrigin||null,this.displayFootprint_=e.displayFootprint!==!1,this.displayGeoTiffByDefault_=!!e.displayGeoTiffByDefault,this.displayPreview_=!!e.displayPreview,this.displayOverview_=e.displayOverview!==!1,this.displayWebMapLink_=e.displayWebMapLink||!1,this.buildTileUrlTemplate_=e.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=e.useTileLayerAsFallback||!1,this.boundsStyle_=e.boundsStyle||xw,this.collectionStyle_=e.collectionStyle||Ew,this.boundsLayer_=null,e.data){try{this.configure_(e.data,e.url,e.assets,e.bands)}catch(n){this.handleError_(n)}return}if(!e.url)throw new Error("Either url or data must be provided");fetch(e.url).then(n=>n.json()).then(n=>this.configure_(n,e.url,e.assets,e.bands)).catch(n=>this.handleError_(n))}getBoundsLayer(){return this.boundsLayer_}handleError_(e){this.dispatchEvent(new YE(e))}configure_(e,t=null,n=null,i=[]){e instanceof It||e instanceof mn?this.data_=e:this.data_=yw(e),t&&t.includes("://")&&this.data_.setAbsoluteUrl(t),this.bands_=i,this.boundsLayer_=this.addFootprint_();const s=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(Oa(this.boundsStyle_,this))};this.getLayers().on("add",s),this.getLayers().on("remove",s),this.setAssets(n).then(()=>this.dispatchEvent("assetsready")).catch(o=>this.handleError_(o)),this.dispatchEvent("sourceready")}async addApiCollection_(){const e=this.getData().getAll().map(t=>{const n=new sh({data:t,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_});return this.addLayer_(n),n});return await Promise.all(e)}async addStacAssets_(){let e=this.getAssets();if(e===null){e=[];const n=this.getData().getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);if(n)e.push(n);else{const i=this.getData().getThumbnails();i.length>0&&e.push(i[0])}}const t=e.map(n=>this.addImagery_(n));return await Promise.all(t)}async addImagery_(e){if(e){if(e.isGeoTIFF())return await this.addGeoTiff_(e);if(e.canBrowserDisplayImage())return await this.addThumbnail_(e)}}async addThumbnail_(e){if(!this.displayPreview_)return;let t={url:e.getAbsoluteUrl(),projection:await Ca(e,"EPSG:4326"),imageExtent:e.getContext().getBoundingBox(),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(t=await this.getSourceOptions_(we.ImageStatic,t,e));const n=new ys({source:new Tu(t)});return this.addLayer_(n,e),n}async addWebMapLinks_(){const e=this.getWebMapLinks();if(e.length>0)return await this.addLayerForLink(e[0])}async addLayerForLink(e){const t=Tw(e);if(!t)return;const n={attributions:e.getMetadata("attribution")||this.data_.getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:t},i=async(o,a)=>(this.getSourceOptions_&&(a=await this.getSourceOptions_(o,a,e)),a),s=[];switch(e.rel){case"pmtiles":const a=await new ho(n.url).getHeader();let l;switch(a.tileType){case tr.Mvt:l=new _w(await i(we.PMTilesVector,n));break;case tr.Avif:case tr.Jpeg:case tr.Png:case tr.Webp:l=new Ia(await i(we.PMTilesRaster,n));break;default:return}s.push(l);break;case"tilejson":s.push(new Lu(await i(we.TileJSON,n)));break;case"wms":if(!Array.isArray(e["wms:layers"]))break;for(const f in e["wms:layers"]){const d=e["wms:layers"][f];let g;Array.isArray(e["wms:styles"])&&typeof e["wms:styles"][f]=="string"&&(g=e["wms:styles"][f]);const m=Object.assign({LAYERS:d,STYLES:g},e["wms:dimensions"]);typeof e["wms:transparent"]=="boolean"&&(m.TRANSPARENT=String(e["wms:transparent"])),typeof e.type=="string"&&e.type.startsWith("image/")&&(m.FORMAT=e.type);const _=await i(we.TileWMS,Object.assign({},n,{params:m}));s.push(new sc(_))}break;case"wmts":const c=await vw(t);if(!c)return;const h=Array.isArray(e["wmts:layer"])?e["wmts:layer"]:[e["wmts:layer"]];for(const f of h){let d=Object.assign({},n,{layer:f});typeof e.type=="string"&&e.type.startsWith("image/")&&(d.format=e.type),d=await i(we.WMTS,d),s.push(new oc(Tf(c,d)))}break;case"xyz":s.push(new gr(await i(we.XYZ,n)));break;default:return}return s.map(o=>{let a;return o instanceof ri?a=new Jl({source:o,declutter:!0}):o instanceof Ia?a=new Qi({source:o}):a=new Un({source:o}),this.addLayer_(a,e),a})}async addGeoTiff_(e){if(!this.displayOverview_)return;if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);let n={sources:[ww(e,this.bands_)]};const i=await Ca(e);i&&(n.projection=i),this.getSourceOptions_&&(n=await this.getSourceOptions_(we.GeoTIFF,n,e));const s=async(o,a)=>(a&&this.getLayers().remove(a),await this.addTileLayerForImagery_(o));try{const o=new qE(n),a=new Qi({source:o});if(this.useTileLayerAsFallback_){const l=()=>s(e,a);o.on("error",l),o.on("tileloaderror",l),o.on("change",()=>{o.getState()==="error"&&s(e,a)}),a.on("error",l),await o.getView()}return this.addLayer_(a,e),a}catch(o){if(this.useTileLayerAsFallback_)return await s(e,null);this.handleError_(o)}}async addTileLayerForImagery_(e){let t={crossOrigin:this.crossOrigin_,url:this.buildTileUrlTemplate_(e)};this.getSourceOptions_&&(t=await this.getSourceOptions_(we.XYZ,t,e));const n=new Un({source:new gr(t)});return this.addLayer_(n,e),n}addLayer_(e,t,n=0){e.set("stac",t),e.setZIndex(n),this.getLayers().push(e)}addFootprint_(){let e=null;const t=this.getData();if(t.isItemCollection()||t.isCollectionCollection()?e=th(t.getBoundingBox()):e=t.toGeoJSON(),e){const n=new kl,i=new Jn({format:n,loader:(o,a,l)=>{const c=n.readFeatures(e,{featureProjection:l});i.addFeatures(c)}}),s=new us({source:i,style:Oa(this.boundsStyle_,this),visible:this.displayFootprint_});return s.set("bounds",!0),this.addLayer_(s,t,1),s}return null}async updateLayers_(){const e=this.getLayers();for(let n=e.getLength()-1;n>=0;n--){const s=e.item(n).get("stac");s&&(s.isLink()||s.isAsset())&&e.removeAt(n)}const t=this.getData();t.isItemCollection()||t.isCollectionCollection()?await this.addApiCollection_():(t.isItem()||t.isCollection())&&await this.addStacAssets_(),this.displayWebMapLink_&&this.hasOnlyBounds()&&await this.addWebMapLinks_()}hasOnlyBounds(){const e=this.getBoundsLayer();return typeof this.getLayersArray().find(n=>n!==e)>"u"}getWebMapLinks(){let e=["xyz","tilejson","pmtiles","wmts","wms"];typeof this.displayWebMapLink_=="string"&&(e=[this.displayWebMapLink_]);const t=this.data_.getLinksWithRels(e);return t.sort((n,i)=>{const s=e.indexOf(n.rel),o=e.indexOf(i.rel);return s-o}),t}async setAssets(e){Array.isArray(e)?this.assets_=e.map(t=>typeof t=="string"?this.getData().getAsset(t):t instanceof It?t:new It(t)):this.assets_=null,await this.updateLayers_()}getData(){return this.data_}getAssets(){return this.assets_}getExtent(){if(!this.boundsLayer_)return;const e=this.boundsLayer_.getMapInternal();if(!e)return;const t=e.getView();if(!t)return;const n=this.getData();if(!n)return;const i=n.getBoundingBox();if(i)return vf(i,"EPSG:4326",t.getProjection())}};Sf(Rf);window.eoxMapAdvancedOlLayers={...u_,STAC:Sw};window.eoxMapAdvancedOlSources=uE;const Rw={title:"Elements/eox-map",tags:["autodocs"],component:"eox-map",render:r=>Mt`
      <eox-map
        style="width: 100%; height: 300px;"
        .center=${r.center}
        .controls=${r.controls}
        .layers=${r.layers}
        .zoom=${r.zoom}
      ></eox-map>
    `},Dr={args:{center:[15,48],layers:[{type:"Tile",source:{type:"OSM"}}],zoom:7}},Gr={args:{layers:[{type:"Vector",background:"#1366dd",properties:{id:"regions"},source:{type:"Vector",url:"https://openlayers.org/data/vector/ecoregions.json",format:"GeoJSON",attributions:"Regions: @ openlayers.org"},style:{"stroke-color":"#232323","stroke-width":1,"fill-color":["string",["get","COLOR"],"#eee"]}}]}},Ur={args:{layers:[{type:"VectorTile",background:"#1a2b39",declutter:!0,properties:{id:"countries"},source:{type:"VectorTile",url:"https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG%3A900913@pbf/{z}/{x}/{-y}.pbf",format:"MVT",tileGrid:{}},style:{"fill-color":"yellow","stroke-color":"#232323","stroke-width":1}}]}},kr={args:{center:[-10997148,4569099],layers:[{type:"Tile",properties:{id:"customId"},source:{type:"TileWMS",url:"https://ahocevar.com/geoserver/wms",params:{LAYERS:"topp:states",TILED:!0},ratio:1,serverType:"geoserver"}}],zoom:3}},zr={args:{center:[-122.38,46.1],layers:[{type:"STAC",properties:{id:"stacLayer"},url:"https://s3.us-west-2.amazonaws.com/sentinel-cogs/sentinel-s2-l2a-cogs/10/T/ES/2022/7/S2A_10TES_20220726_0_L2A/S2A_10TES_20220726_0_L2A.json"},{type:"Tile",properties:{id:"customId"},source:{type:"OSM"}}],zoom:7}},Br={args:{layers:[{type:"Group",properties:{id:"group"},layers:[{type:"Vector",properties:{id:"regions"},source:{type:"Vector",url:"https://openlayers.org/data/vector/ecoregions.json",format:"GeoJSON"}},{type:"Group",properties:{id:"groupLayerInsideGroup"},layers:[{type:"Tile",properties:{id:"layerInsideGroupInsideGroup"},source:{type:"OSM"}}]}]}]}},$r={args:{controls:{Zoom:{},Attribution:{},FullScreen:{},OverviewMap:{layers:[{type:"Tile",properties:{id:"overviewMap"},source:{type:"OSM"}}]}},layers:[{type:"Tile",properties:{id:"customId"},source:{type:"OSM"}}]}},jr={args:{layers:[{type:"Vector",source:{type:"Vector",url:"https://openlayers.org/data/vector/ecoregions.json",format:"GeoJSON"},interactions:[{type:"select",options:{id:"selectInteraction",condition:"pointermove",layer:{type:"Vector",properties:{id:"selectLayer"},source:{type:"Vector"},style:{"stroke-color":"red","stroke-width":3}}}}]}]}},Vr={args:{layers:[{type:"Vector",background:"#1366dd",properties:{id:"regions"},source:{type:"Vector",url:"https://openlayers.org/data/vector/ecoregions.json",format:"GeoJSON",attributions:"Regions: @ openlayers.org"},style:{"stroke-color":"black","stroke-width":1,"fill-color":"red"},interactions:[{type:"select",options:{id:"selectInteraction",condition:"click",style:{"stroke-color":"white","stroke-width":3}}}]}]}},nr={args:{layers:[{type:"Vector",source:{type:"Vector",url:"https://openlayers.org/data/vector/ecoregions.json",format:"GeoJSON"},interactions:[{type:"select",options:{id:"selectInteraction",condition:"pointermove",style:{"stroke-color":"red","stroke-width":3}}}]}],center:[15,48],zoom:4},render:r=>Mt`
      <eox-map
        id="tooltipTest"
        style="width: 100%; height: 300px;"
        .center=${r.center}
        .controls=${r.controls}
        .layers=${r.layers}
        .zoom=${r.zoom}
      >
        <eox-map-tooltip></eox-map-tooltip>
      </eox-map>
    `},ir={args:{layers:[{type:"Vector",source:{type:"Vector",url:"https://openlayers.org/data/vector/ecoregions.json",format:"GeoJSON"},interactions:[{type:"select",options:{id:"selectInteraction",condition:"pointermove",style:{"stroke-color":"red","stroke-width":3}}}]}],center:[15,48],zoom:4},render:r=>Mt`
      <eox-map
        id="tooltipTest"
        style="width: 100%; height: 300px;"
        .center=${r.center}
        .controls=${r.controls}
        .layers=${r.layers}
        .zoom=${r.zoom}
      >
        <eox-map-tooltip
          .propertyTransform=${({key:e,value:t},n)=>{if(console.log(n),e.includes("COLOR"))return{key:e.toLowerCase(),value:t}}}
        ></eox-map-tooltip>
      </eox-map>
    `},Zr={args:{layers:[{type:"Tile",properties:{id:"osm",title:"Background"},source:{type:"OSM"}}]},render:r=>Mt`
      <style>
        eox-map-compare,
        eox-map {
          width: 50%;
          height: 300px;
        }
        .container {
          display: flex;
        }
      </style>
      <div class="container">
        <eox-map id="a" .layers=${r.layers}> </eox-map>
        <eox-map id="b" sync="#a" .layers=${r.layers}></eox-map>
      </div>
    `},Wr={args:{layersA:[{type:"Tile",source:{type:"OSM"}}],layersB:[{type:"Tile",source:{type:"TileWMS",url:"https://services.sentinel-hub.com/ogc/wms/0635c213-17a1-48ee-aef7-9d1731695a54",params:{LAYERS:"AWS_VIS_WIND_V_10M"}}}]},render:r=>Mt`
      <style>
        eox-map-compare,
        eox-map {
          width: 100%;
          height: 300px;
        }
      </style>
      <eox-map-compare>
        <eox-map slot="first" id="compareA" .layers=${r.layersA}></eox-map>
        <eox-map
          slot="second"
          sync="eox-map#compareA"
          .layers=${r.layersB}
        ></eox-map>
      </eox-map-compare>
    `},Hr={args:{config:{controls:{Zoom:{}},layers:[{type:"Tile",source:{type:"OSM"}}],view:{center:[16.8,48.2],zoom:9}}},render:r=>Mt`
      <eox-map
        style="width: 100%; height: 300px;"
        .config=${r.config}
      ></eox-map>
    `},sr={args:{layers:[{type:"Vector",source:{type:"Vector",url:"https://openlayers.org/data/vector/ecoregions.json",format:"GeoJSON"}},{type:"Tile",properties:{id:"osm",title:"Background"},source:{type:"OSM"}}],center:[16.8,48.2],zoom:7},render:r=>Mt`
      <eox-map
        id="projectionMap"
        style="width: 100%; height: 300px;"
        .center=${r.center}
        .controls=${r.controls}
        .layers=${r.layers}
        .zoom=${r.zoom}
      >
      </eox-map>
      <button
        @click=${()=>{const e=document.querySelector("#projectionMap");e.setAttribute("projection",e.map.getView().getProjection().getCode()==="EPSG:4326"?"EPSG:3857":"EPSG:4326")}}
      >
        change projection
      </button>
    `},or={args:{config:{controls:{Zoom:{}},layers:[{type:"Tile",source:{type:"OSM"}}],view:{center:[16.8,48.2],zoom:9},preventScroll:!0}},render:r=>Mt`
      <eox-map
        style="width: 100%; height: 300px;"
        .config=${r.config}
      ></eox-map>
    `};var Ma,Fa,Na;Dr.parameters={...Dr.parameters,docs:{...(Ma=Dr.parameters)==null?void 0:Ma.docs,source:{originalSource:`{
  args: {
    center: [15, 48],
    layers: [{
      type: "Tile",
      source: {
        type: "OSM"
      }
    }],
    zoom: 7
  }
}`,...(Na=(Fa=Dr.parameters)==null?void 0:Fa.docs)==null?void 0:Na.source}}};var Da,Ga,Ua;Gr.parameters={...Gr.parameters,docs:{...(Da=Gr.parameters)==null?void 0:Da.docs,source:{originalSource:`{
  args: {
    layers: [{
      type: "Vector",
      background: "#1366dd",
      properties: {
        id: "regions"
      },
      source: {
        type: "Vector",
        url: "https://openlayers.org/data/vector/ecoregions.json",
        format: "GeoJSON",
        attributions: "Regions: @ openlayers.org"
      },
      style: {
        "stroke-color": "#232323",
        "stroke-width": 1,
        "fill-color": ["string", ["get", "COLOR"], "#eee"]
      }
    }]
  }
}`,...(Ua=(Ga=Gr.parameters)==null?void 0:Ga.docs)==null?void 0:Ua.source}}};var ka,za,Ba;Ur.parameters={...Ur.parameters,docs:{...(ka=Ur.parameters)==null?void 0:ka.docs,source:{originalSource:`{
  args: {
    layers: [{
      type: "VectorTile",
      background: "#1a2b39",
      declutter: true,
      properties: {
        id: "countries"
      },
      source: {
        type: "VectorTile",
        url: "https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG%3A900913@pbf/{z}/{x}/{-y}.pbf",
        format: "MVT",
        tileGrid: {}
      },
      style: {
        "fill-color": "yellow",
        "stroke-color": "#232323",
        "stroke-width": 1
      }
    }]
  }
}`,...(Ba=(za=Ur.parameters)==null?void 0:za.docs)==null?void 0:Ba.source}}};var $a,ja,Va;kr.parameters={...kr.parameters,docs:{...($a=kr.parameters)==null?void 0:$a.docs,source:{originalSource:`{
  args: {
    center: [-10997148, 4569099],
    layers: [{
      type: "Tile",
      properties: {
        id: "customId"
      },
      source: {
        type: "TileWMS",
        url: "https://ahocevar.com/geoserver/wms",
        params: {
          LAYERS: "topp:states",
          TILED: true
        },
        ratio: 1,
        serverType: "geoserver"
      }
    }],
    zoom: 3
  }
}`,...(Va=(ja=kr.parameters)==null?void 0:ja.docs)==null?void 0:Va.source}}};var Za,Wa,Ha;zr.parameters={...zr.parameters,docs:{...(Za=zr.parameters)==null?void 0:Za.docs,source:{originalSource:`{
  args: {
    center: [-122.38, 46.1],
    layers: [{
      type: "STAC",
      properties: {
        id: "stacLayer"
      },
      url: "https://s3.us-west-2.amazonaws.com/sentinel-cogs/sentinel-s2-l2a-cogs/10/T/ES/2022/7/S2A_10TES_20220726_0_L2A/S2A_10TES_20220726_0_L2A.json"
    }, {
      type: "Tile",
      properties: {
        id: "customId"
      },
      source: {
        type: "OSM"
      }
    }],
    zoom: 7
  }
}`,...(Ha=(Wa=zr.parameters)==null?void 0:Wa.docs)==null?void 0:Ha.source}}};var Xa,Ya,qa;Br.parameters={...Br.parameters,docs:{...(Xa=Br.parameters)==null?void 0:Xa.docs,source:{originalSource:`{
  args: {
    layers: [{
      type: "Group",
      properties: {
        id: "group"
      },
      layers: [{
        type: "Vector",
        properties: {
          id: "regions"
        },
        source: {
          type: "Vector",
          url: "https://openlayers.org/data/vector/ecoregions.json",
          format: "GeoJSON"
        }
      }, {
        type: "Group",
        properties: {
          id: "groupLayerInsideGroup"
        },
        layers: [{
          type: "Tile",
          properties: {
            id: "layerInsideGroupInsideGroup"
          },
          source: {
            type: "OSM"
          }
        }]
      }]
    }]
  }
}`,...(qa=(Ya=Br.parameters)==null?void 0:Ya.docs)==null?void 0:qa.source}}};var Ka,Qa,Ja;$r.parameters={...$r.parameters,docs:{...(Ka=$r.parameters)==null?void 0:Ka.docs,source:{originalSource:`{
  args: {
    controls: {
      Zoom: {},
      Attribution: {},
      FullScreen: {},
      OverviewMap: {
        layers: [{
          type: "Tile",
          properties: {
            id: "overviewMap"
          },
          source: {
            type: "OSM"
          }
        }]
      }
    },
    layers: [{
      type: "Tile",
      properties: {
        id: "customId"
      },
      source: {
        type: "OSM"
      }
    }]
  }
}`,...(Ja=(Qa=$r.parameters)==null?void 0:Qa.docs)==null?void 0:Ja.source}}};var el,tl,rl;jr.parameters={...jr.parameters,docs:{...(el=jr.parameters)==null?void 0:el.docs,source:{originalSource:`{
  args: {
    layers: [{
      type: "Vector",
      source: {
        type: "Vector",
        url: "https://openlayers.org/data/vector/ecoregions.json",
        format: "GeoJSON"
      },
      interactions: [{
        type: "select",
        options: {
          id: "selectInteraction",
          condition: "pointermove",
          layer: {
            type: "Vector",
            properties: {
              id: "selectLayer"
            },
            source: {
              type: "Vector"
            },
            style: {
              "stroke-color": "red",
              "stroke-width": 3
            }
          }
        }
      }]
    }]
  }
}`,...(rl=(tl=jr.parameters)==null?void 0:tl.docs)==null?void 0:rl.source}}};var nl,il,sl;Vr.parameters={...Vr.parameters,docs:{...(nl=Vr.parameters)==null?void 0:nl.docs,source:{originalSource:`{
  args: {
    layers: [{
      type: "Vector",
      background: "#1366dd",
      properties: {
        id: "regions"
      },
      source: {
        type: "Vector",
        url: "https://openlayers.org/data/vector/ecoregions.json",
        format: "GeoJSON",
        attributions: "Regions: @ openlayers.org"
      },
      style: {
        "stroke-color": "black",
        "stroke-width": 1,
        "fill-color": "red"
      },
      interactions: [{
        type: "select",
        options: {
          id: "selectInteraction",
          condition: "click",
          style: {
            "stroke-color": "white",
            "stroke-width": 3
          }
        }
      }]
    }]
  }
}`,...(sl=(il=Vr.parameters)==null?void 0:il.docs)==null?void 0:sl.source}}};var ol,al,ll,cl,ul;nr.parameters={...nr.parameters,docs:{...(ol=nr.parameters)==null?void 0:ol.docs,source:{originalSource:`{
  args: {
    layers: [{
      type: "Vector",
      source: {
        type: "Vector",
        url: "https://openlayers.org/data/vector/ecoregions.json",
        format: "GeoJSON"
      },
      interactions: [{
        type: "select",
        options: {
          id: "selectInteraction",
          condition: "pointermove",
          style: {
            "stroke-color": "red",
            "stroke-width": 3
          }
        }
      }]
    }],
    center: [15, 48],
    zoom: 4
  },
  render: args => html\`
      <eox-map
        id="tooltipTest"
        style="width: 100%; height: 300px;"
        .center=\${args.center}
        .controls=\${args.controls}
        .layers=\${args.layers}
        .zoom=\${args.zoom}
      >
        <eox-map-tooltip></eox-map-tooltip>
      </eox-map>
    \`
}`,...(ll=(al=nr.parameters)==null?void 0:al.docs)==null?void 0:ll.source},description:{story:"`eox-map` offers a built-in tooltip, which needs to be placed inside the default slot:\n```\n<eox-map [...]>\n  <eox-map-tooltip></eox-map-tooltip>\n</eox-map>\n```\nThis renders a list of all feature properties of the currently selected feature.\nNote that if multiple interactions are registered (e.g. `pointermove` and `singleclick`),\nthe `pointermove` interaction will have higher priority for the tooltip.",...(ul=(cl=nr.parameters)==null?void 0:cl.docs)==null?void 0:ul.description}}};var hl,fl,dl,pl,gl;ir.parameters={...ir.parameters,docs:{...(hl=ir.parameters)==null?void 0:hl.docs,source:{originalSource:`{
  args: {
    layers: [{
      type: "Vector",
      source: {
        type: "Vector",
        url: "https://openlayers.org/data/vector/ecoregions.json",
        format: "GeoJSON"
      },
      interactions: [{
        type: "select",
        options: {
          id: "selectInteraction",
          condition: "pointermove",
          style: {
            "stroke-color": "red",
            "stroke-width": 3
          }
        }
      }]
    }],
    center: [15, 48],
    zoom: 4
  },
  render: args => html\`
      <eox-map
        id="tooltipTest"
        style="width: 100%; height: 300px;"
        .center=\${args.center}
        .controls=\${args.controls}
        .layers=\${args.layers}
        .zoom=\${args.zoom}
      >
        <eox-map-tooltip
          .propertyTransform=\${({
    key,
    value
  }, hoverFeature) => {
    console.log(hoverFeature);
    if (key.includes("COLOR")) {
      return {
        key: key.toLowerCase(),
        value
      };
    }
  }}
        ></eox-map-tooltip>
      </eox-map>
    \`
}`,...(dl=(fl=ir.parameters)==null?void 0:fl.docs)==null?void 0:dl.source},description:{story:'The rendering of feature properties inside the tooltip can be transformed\nby passing a `propertyTransform` function to the tooltip element which applies to each property in the rendering loop:\n```\n<eox-map [...]>\n  <eox-map-tooltip\n    .propertyTransform=${({key, value}, feature) => key.includes("COLOR") ? { key: key.toLowerCase(), value }}\n  ></eox-map-tooltip>\n</eox-map>\n```\n\nThe first argument are `key` and `value` of the current feature property; this object needs to be\nreturned in order to render the property in the list.\nAdditionally, the entire feature is passed as a second argument, for cases of more advanced property\ntransformation in which needs access to the entire feature.',...(gl=(pl=ir.parameters)==null?void 0:pl.docs)==null?void 0:gl.description}}};var ml,yl,_l;Zr.parameters={...Zr.parameters,docs:{...(ml=Zr.parameters)==null?void 0:ml.docs,source:{originalSource:`{
  args: {
    layers: [{
      type: "Tile",
      properties: {
        id: "osm",
        title: "Background"
      },
      source: {
        type: "OSM"
      }
    }]
  },
  render: args => html\`
      <style>
        eox-map-compare,
        eox-map {
          width: 50%;
          height: 300px;
        }
        .container {
          display: flex;
        }
      </style>
      <div class="container">
        <eox-map id="a" .layers=\${args.layers}> </eox-map>
        <eox-map id="b" sync="#a" .layers=\${args.layers}></eox-map>
      </div>
    \`
}`,...(_l=(yl=Zr.parameters)==null?void 0:yl.docs)==null?void 0:_l.source}}};var xl,El,wl;Wr.parameters={...Wr.parameters,docs:{...(xl=Wr.parameters)==null?void 0:xl.docs,source:{originalSource:`{
  args: {
    layersA: [{
      type: "Tile",
      source: {
        type: "OSM"
      }
    }],
    layersB: [{
      type: "Tile",
      source: {
        type: "TileWMS",
        url: "https://services.sentinel-hub.com/ogc/wms/0635c213-17a1-48ee-aef7-9d1731695a54",
        params: {
          LAYERS: "AWS_VIS_WIND_V_10M"
        }
      }
    }]
  },
  render: args => html\`
      <style>
        eox-map-compare,
        eox-map {
          width: 100%;
          height: 300px;
        }
      </style>
      <eox-map-compare>
        <eox-map slot="first" id="compareA" .layers=\${args.layersA}></eox-map>
        <eox-map
          slot="second"
          sync="eox-map#compareA"
          .layers=\${args.layersB}
        ></eox-map>
      </eox-map-compare>
    \`
}`,...(wl=(El=Wr.parameters)==null?void 0:El.docs)==null?void 0:wl.source}}};var Tl,vl,Sl;Hr.parameters={...Hr.parameters,docs:{...(Tl=Hr.parameters)==null?void 0:Tl.docs,source:{originalSource:`{
  args: {
    config: {
      controls: {
        Zoom: {}
      },
      layers: [{
        type: "Tile",
        source: {
          type: "OSM"
        }
      }],
      view: {
        center: [16.8, 48.2],
        zoom: 9
      }
    }
  },
  render: args => html\`
      <eox-map
        style="width: 100%; height: 300px;"
        .config=\${args.config}
      ></eox-map>
    \`
}`,...(Sl=(vl=Hr.parameters)==null?void 0:vl.docs)==null?void 0:Sl.source}}};var Rl,bl,Pl,Al,Ll;sr.parameters={...sr.parameters,docs:{...(Rl=sr.parameters)==null?void 0:Rl.docs,source:{originalSource:`{
  args: {
    layers: [{
      type: "Vector",
      source: {
        type: "Vector",
        url: "https://openlayers.org/data/vector/ecoregions.json",
        format: "GeoJSON"
      }
    }, {
      type: "Tile",
      properties: {
        id: "osm",
        title: "Background"
      },
      source: {
        type: "OSM"
      }
    }],
    center: [16.8, 48.2],
    zoom: 7
  },
  render: args => html\`
      <eox-map
        id="projectionMap"
        style="width: 100%; height: 300px;"
        .center=\${args.center}
        .controls=\${args.controls}
        .layers=\${args.layers}
        .zoom=\${args.zoom}
      >
      </eox-map>
      <button
        @click=\${() => {
    const eoxMap = document.querySelector("#projectionMap");
    eoxMap.setAttribute("projection", eoxMap.map.getView().getProjection().getCode() === "EPSG:4326" ? "EPSG:3857" : "EPSG:4326");
  }}
      >
        change projection
      </button>
    \`
}`,...(Pl=(bl=sr.parameters)==null?void 0:bl.docs)==null?void 0:Pl.source},description:{story:"The projection of the view can be changed via the `projection`-attribute.\nOut-of-the-box the projections EPSG:3857 (default) and EPSG:4326 (geographic coordinates)\nare included, additional projections can be used by registering them via the `registerProjection` or\n`registerProjectionFromCode` helper functions beforehand.",...(Ll=(Al=sr.parameters)==null?void 0:Al.docs)==null?void 0:Ll.description}}};var Il,Cl,Ol,Ml,Fl;or.parameters={...or.parameters,docs:{...(Il=or.parameters)==null?void 0:Il.docs,source:{originalSource:`{
  args: {
    config: {
      controls: {
        Zoom: {}
      },
      layers: [{
        type: "Tile",
        source: {
          type: "OSM"
        }
      }],
      view: {
        center: [16.8, 48.2],
        zoom: 9
      },
      preventScroll: true
    }
  },
  render: args => html\`
      <eox-map
        style="width: 100%; height: 300px;"
        .config=\${args.config}
      ></eox-map>
    \`
}`,...(Ol=(Cl=or.parameters)==null?void 0:Cl.docs)==null?void 0:Ol.source},description:{story:"By setting the `prevent-scroll` attribute or by setting `preventScroll` property to `true` (either on the element or within the config object),\nthe map doesnt mouse-scroll (on desktop) or drag-touch (on tab/mobile). Pressing the platform modifier key (ctrl/cmd) will enable scrolling.\nUseful for maps embedded in scrollable websites.",...(Fl=(Ml=or.parameters)==null?void 0:Ml.docs)==null?void 0:Fl.description}}};const bw=["Primary","VectorLayer","VectorTileLayer","WMSLayer","STACLayer","GroupLayer","Controls","HoverSelect","ClickSelect","Tooltip","TooltipWithPropertyTransform","MapSync","ABCompare","ConfigObject","Projection","PreventScroll"],Ww=Object.freeze(Object.defineProperty({__proto__:null,ABCompare:Wr,ClickSelect:Vr,ConfigObject:Hr,Controls:$r,GroupLayer:Br,HoverSelect:jr,MapSync:Zr,PreventScroll:or,Primary:Dr,Projection:sr,STACLayer:zr,Tooltip:nr,TooltipWithPropertyTransform:ir,VectorLayer:Gr,VectorTileLayer:Ur,WMSLayer:kr,__namedExportsOrder:bw,default:Rw},Symbol.toStringTag,{value:"Module"}));export{jw as L,Vw as a,Ww as m};
