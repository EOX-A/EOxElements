{"version":3,"file":"drawtools.stories-034a6da2.js","sources":["../../elements/drawtools/src/style.js","../../elements/drawtools/src/style.eox.js","../../elements/drawtools/src/main.js"],"sourcesContent":["export const style = `\n:host {\n  display: block;\n}\n`;\n","import { button } from \"../../../utils/styles/button\";\n\nexport const styleEOX = `\n* {\n  font-family: Roboto, sans-serif;\n}\n\n${button}\n\nbutton.discard:before {\n  content: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23FF5252' viewBox='0 0 24 24'%3E%3Ctitle%3Etrash-can-outline%3C/title%3E%3Cpath d='M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z' /%3E%3C/svg%3E\")\n}\n\nbutton.polygon:before {\n  content: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23004170' viewBox='0 0 24 24'%3E%3Ctitle%3Eshape-polygon-plus%3C/title%3E%3Cpath d='M17,15.7V13H19V17L10,21L3,14L7,5H11V7H8.3L5.4,13.6L10.4,18.6L17,15.7M22,5V7H19V10H17V7H14V5H17V2H19V5H22Z' /%3E%3C/svg%3E\");\n}\n`;\n","import { LitElement, html, nothing } from \"lit\";\nimport { style } from \"./style\";\nimport { styleEOX } from \"./style.eox\";\n\n/**\n * Manage drawn features on a map\n * @element eox-drawtools\n */\nexport class EOxDrawTools extends LitElement {\n  static get properties() {\n    return {\n      for: { type: String },\n      currentlyDrawing: { attribute: false, state: true, type: Boolean },\n      draw: { attribute: false, state: true },\n      drawLayer: { attribute: false, state: true },\n      drawnFeatures: { attribute: false, state: true, type: Array },\n      layer: { type: String },\n      modify: { attribute: false, state: true },\n      multipleFeatures: { attribute: \"multiple-features\", type: Boolean },\n      unstyled: { type: Boolean },\n    };\n  }\n\n  /**\n   * @type import(\"../../map/main\").EOxMap\n   */\n  #eoxMap;\n\n  /**\n   * @type import(\"ol\").Map\n   */\n  #olMap;\n\n  constructor() {\n    super();\n\n    /**\n     * The query selector for the map\n     * @default eox-map\n     */\n    this.for = \"eox-map\";\n\n    /**\n     * Whether the user is currently in the process of drawing or not\n     */\n    this.currentlyDrawing = false;\n\n    /**\n     * The current native OpenLayers `draw` interaction\n     * @type import(\"ol/interaction\").Draw\n     */\n\n    this.draw = null;\n\n    /**\n     * The current native OpenLayers draw `layer`\n     * @type import(\"ol/layer\").Vector<import(\"ol/source\").Vector>\n     */\n\n    this.drawLayer = null;\n\n    /**\n     * The array of drawn native OpenLayers features. Normally includes only one feature, until multiple feature drawing is enabled.\n     * @type Array<import(\"ol\").Feature>\n     */\n    this.drawnFeatures = [];\n\n    /**\n     * The layer id of the draw layer\n     * @default draw\n     */\n    this.layer = \"draw\";\n\n    /**\n     * The current native OpenLayers `modify` interaction\n     * @type import(\"ol/interaction\").Modify\n     */\n\n    this.modify = null;\n\n    /**\n     * Allow adding more than one feature at a time\n     */\n    this.multipleFeatures = false;\n\n    /**\n     * Render the element without additional styles\n     */\n    this.unstyled = false;\n  }\n\n  startDrawing() {\n    this.#eoxMap.addDraw(this.layer, {\n      id: \"drawInteraction\",\n      type: \"Polygon\",\n      stopClick: true,\n    });\n    this.draw = /** @type {import(\"ol/interaction\").Draw} */ (\n      /** @type {unknown} */ (this.#eoxMap.interactions[\"drawInteraction\"])\n    );\n    this.modify = /** @type {import(\"ol/interaction\").Modify} */ (\n      /** @type {unknown} */ (\n        this.#eoxMap.interactions[\"drawInteractionmodify\"]\n      )\n    );\n    this.draw?.on(\"drawend\", (evt) => this.onDrawEnd(evt));\n    this.modify?.on(\"modifyend\", (evt) => this.onModifyEnd(evt));\n    this.currentlyDrawing = true;\n    this.requestUpdate();\n  }\n\n  discardDrawing() {\n    this.drawnFeatures = [];\n    this.#eoxMap.removeInteraction(\"drawInteraction\");\n    this.drawLayer.getSource().clear();\n    this.emitDrawnFeatures();\n    this.currentlyDrawing = false;\n    this.requestUpdate();\n  }\n\n  /**\n   *\n   * @param {import(\"ol/interaction/Draw\").DrawEvent} evt\n   */\n  onDrawEnd() {\n    this.emitDrawnFeatures();\n    this.#eoxMap.removeInteraction(\"drawInteraction\");\n    this.currentlyDrawing = false;\n    this.requestUpdate();\n  }\n\n  /**\n   *\n   * @param {import(\"ol/interaction/Modify\").ModifyEvent} evt\n   */\n  onModifyEnd() {\n    this.emitDrawnFeatures();\n  }\n\n  emitDrawnFeatures() {\n    setTimeout(() => {\n      this.drawnFeatures = this.drawLayer.getSource().getFeatures();\n      this.requestUpdate();\n      /**\n       * Fires whenever features are added, modified or discarded, where the event detail\n       * is the `drawnFeatures` array\n       * @type Array<import(\"ol\").Feature>\n       */\n      this.dispatchEvent(\n        new CustomEvent(\"drawupdate\", {\n          detail: this.drawnFeatures,\n        })\n      );\n    }, 0);\n  }\n\n  render() {\n    const mapQuery = document.querySelector(this.for);\n\n    this.#eoxMap = /** @type {import(\"@eox/map/main\").EOxMap} */ (mapQuery);\n    // @ts-ignore\n    this.#olMap = /** @type {import(\"ol\").Map} */ this.#eoxMap.map;\n\n    this.drawLayer =\n      /** @type {import(\"ol/layer\").Vector<import(\"ol/source\").Vector>} */ (\n        this.#olMap\n          .getLayers()\n          .getArray()\n          .find((l) => l.get(\"id\") === this.layer)\n      );\n    this.requestUpdate();\n\n    return html`\n      <style>\n        ${style}\n        ${!this.unstyled && styleEOX}\n      </style>\n      <div>\n        <slot></slot>\n        <button\n          data-cy=\"drawBtn\"\n          class=\"polygon icon\"\n          disabled=\"${(!this.multipleFeatures &&\n            this.drawnFeatures?.length > 0) ||\n          this.currentlyDrawing ||\n          nothing}\"\n          @click=\"${() => this.startDrawing()}\"\n        >\n          ${this.currentlyDrawing ? \"drawing\" : \"draw\"}\n        </button>\n        <button\n          data-cy=\"discardBtn\"\n          class=\"discard icon\"\n          disabled=\"${(!this.drawnFeatures?.length && !this.currentlyDrawing) ||\n          nothing}\"\n          @click=\"${() => this.discardDrawing()}\"\n        >\n          discard\n        </button>\n      </div>\n    `;\n  }\n}\n\ncustomElements.define(\"eox-drawtools\", EOxDrawTools);\n"],"names":["style","styleEOX","button","EOxDrawTools","LitElement","__privateAdd","_eoxMap","_olMap","__privateGet","_a","evt","_b","mapQuery","__privateSet","l","html","nothing"],"mappings":"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"}