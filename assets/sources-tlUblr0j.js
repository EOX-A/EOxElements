var ud=Object.defineProperty;var cd=(r,e,t)=>e in r?ud(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Ls=(r,e,t)=>(cd(r,typeof e!="symbol"?e+"":e,t),t);import{J as qh,F as it,g as de,i as fd,t as ze,d as dd,l as gd,c as Fn,L as sa,P as _t,a as Et,M as or,b as yi,e as Dr,f as vr,h as Le,j as Ga,k as $t,m as Ua,G as md,p as Pi,n as Xh,o as Yt,q as rt,S as Ft,s as li,I as Hh,u as mr,v as Dn,w as Mt,x as hi,y as pd,z as yd,A as _d,B as ll,C as Wh,D as Vh,E as Yh,H as Kh,K as xd,N as vd,O as Gn,Q as Ed,V as Ba,R as hl,U as Mr,W as os,X as wd,Y as Sd,Z as Td,_ as Xt,$ as Un,a0 as za,a1 as fr,a2 as Oi,a3 as ui,a4 as xt,a5 as Ie,a6 as Wi,a7 as Vr,a8 as Md,a9 as Be,aa as Qh,ab as Ct,ac as ka,ad as Rd,ae as bd,af as Jh,ag as Cs,ah as Pd,ai as $a,aj as Ad,ak as Ni,al as pn,am as Bn,an as ja,ao as eu,ap as Vi,aq as tu,ar as aa,as as ru,at as ie,au as sr,av as ul,aw as Os,ax as Id,ay as cl,az as ct,aA as Ld,aB as Cd,aC as Od,aD as Nd,aE as Za,aF as Ht,aG as qa,aH as Zr,aI as Fd,aJ as oa,aK as iu,aL as Dd,aM as fl,aN as Gd,aO as Ud,aP as nu,aQ as Bd,aR as zd,aS as kd,aT as la,aU as $d,aV as xe,aW as bn,aX as ci,aY as vt,aZ as bt,a_ as jd,a$ as ue,b0 as su,b1 as Zd,b2 as qd,b3 as au,b4 as pr,b5 as Xd,b6 as Hd,b7 as Wd,b8 as ou,b9 as Vd,ba as lu,bb as Xa,bc as zn,bd as hu,be as Gr,bf as ls,bg as hs,bh as uu,bi as Ha,bj as fi,bk as Yd,bl as Kd,bm as Qd,bn as us,bo as Jd,bp as eg,bq as tg,br as kn,bs as rg,bt as Ns,bu as $n,bv as cs,bw as ig,bx as ng,by as dl,bz as ha,bA as ua,bB as sg,bC as ag,bD as _i,bE as cu,bF as gl,bG as fu,bH as ml,bI as Ur,bJ as Wa,bK as fs,bL as og,bM as Va,bN as du,bO as lg,bP as hg,bQ as ug,bR as cg,bS as gu,bT as fg,bU as dg,bV as gg,bW as mg,bX as mu,bY as pg,bZ as pu,b_ as yg,b$ as _g,c0 as xg,c1 as vg,c2 as Eg,c3 as pl,c4 as wg,c5 as Sg}from"./main-Alx_PdZX.js";import{g as ds,c as br}from"./_commonjsHelpers-4gQjN7DL.js";import{_ as Er}from"./iframe-W89OKkhr.js";const Tg={Point:Pg,LineString:Ag,Polygon:Og,MultiPoint:Lg,MultiLineString:Ig,MultiPolygon:Cg},Mg={Point:Ng,LineString:Fg,Polygon:Dg,MultiPoint:Ug,MultiLineString:Gg,MultiPolygon:Bg};class Rg extends qh{constructor(e){e=e||{},super(),this.geometryName_=e.geometryName}readFeatureFromObject(e,t,i){const n=e,s=yl(n.geometry,t),a=new it;if(this.geometryName_&&a.setGeometryName(this.geometryName_),a.setGeometry(s),n.attributes){a.setProperties(n.attributes,!0);const o=n.attributes[i];o!==void 0&&a.setId(o)}return a}readFeaturesFromObject(e,t){if(t=t||{},e.features){const i=e,n=[],s=i.features;for(let a=0,o=s.length;a<o;++a)n.push(this.readFeatureFromObject(s[a],t,e.objectIdFieldName));return n}return[this.readFeatureFromObject(e,t)]}readGeometryFromObject(e,t){return yl(e,t)}readProjectionFromObject(e){if(e.spatialReference&&e.spatialReference.wkid!==void 0){const i=e.spatialReference.wkid;return de("EPSG:"+i)}return null}writeGeometryObject(e,t){return _l(e,this.adaptOptions(t))}writeFeatureObject(e,t){t=this.adaptOptions(t);const i={};if(!e.hasProperties())return i.attributes={},i;const n=e.getProperties(),s=e.getGeometry();if(s){i.geometry=_l(s,t);const a=t&&(t.dataProjection||t.featureProjection);a&&(i.geometry.spatialReference={wkid:Number(de(a).getCode().split(":").pop())}),delete n[e.getGeometryName()]}return fd(n)?i.attributes={}:i.attributes=n,i}writeFeaturesObject(e,t){t=this.adaptOptions(t);const i=[];for(let n=0,s=e.length;n<s;++n)i.push(this.writeFeatureObject(e[n],t));return{features:i}}}function yl(r,e){if(!r)return null;let t;if(typeof r.x=="number"&&typeof r.y=="number")t="Point";else if(r.points)t="MultiPoint";else if(r.paths)r.paths.length===1?t="LineString":t="MultiLineString";else if(r.rings){const n=r,s=xi(n),a=bg(n.rings,s);a.length===1?(t="Polygon",r=Object.assign({},r,{rings:a[0]})):(t="MultiPolygon",r=Object.assign({},r,{rings:a}))}const i=Tg[t];return ze(i(r),!1,e)}function bg(r,e){const t=[],i=[],n=[];let s,a;for(s=0,a=r.length;s<a;++s)t.length=0,dd(t,0,r[s],e.length),gd(t,0,t.length,e.length)?i.push([r[s]]):n.push(r[s]);for(;n.length;){const o=n.shift();let l=!1;for(s=i.length-1;s>=0;s--){const h=i[s][0];if(Fn(new sa(h).getExtent(),new sa(o).getExtent())){i[s].push(o),l=!0;break}}l||i.push([o.reverse()])}return i}function Pg(r){let e;return r.m!==void 0&&r.z!==void 0?e=new _t([r.x,r.y,r.z,r.m],"XYZM"):r.z!==void 0?e=new _t([r.x,r.y,r.z],"XYZ"):r.m!==void 0?e=new _t([r.x,r.y,r.m],"XYM"):e=new _t([r.x,r.y]),e}function Ag(r){const e=xi(r);return new Et(r.paths[0],e)}function Ig(r){const e=xi(r);return new or(r.paths,e)}function xi(r){let e="XY";return r.hasZ===!0&&r.hasM===!0?e="XYZM":r.hasZ===!0?e="XYZ":r.hasM===!0&&(e="XYM"),e}function Lg(r){const e=xi(r);return new yi(r.points,e)}function Cg(r){const e=xi(r);return new Dr(r.rings,e)}function Og(r){const e=xi(r);return new vr(r.rings,e)}function Ng(r,e){const t=r.getCoordinates();let i;const n=r.getLayout();if(n==="XYZ")i={x:t[0],y:t[1],z:t[2]};else if(n==="XYM")i={x:t[0],y:t[1],m:t[2]};else if(n==="XYZM")i={x:t[0],y:t[1],z:t[2],m:t[3]};else if(n==="XY")i={x:t[0],y:t[1]};else throw new Error("Invalid geometry layout");return i}function sn(r){const e=r.getLayout();return{hasZ:e==="XYZ"||e==="XYZM",hasM:e==="XYM"||e==="XYZM"}}function Fg(r,e){const t=sn(r);return{hasZ:t.hasZ,hasM:t.hasM,paths:[r.getCoordinates()]}}function Dg(r,e){const t=sn(r);return{hasZ:t.hasZ,hasM:t.hasM,rings:r.getCoordinates(!1)}}function Gg(r,e){const t=sn(r);return{hasZ:t.hasZ,hasM:t.hasM,paths:r.getCoordinates()}}function Ug(r,e){const t=sn(r);return{hasZ:t.hasZ,hasM:t.hasM,points:r.getCoordinates()}}function Bg(r,e){const t=sn(r),i=r.getCoordinates(!1),n=[];for(let s=0;s<i.length;s++)for(let a=i[s].length-1;a>=0;a--)n.push(i[s][a]);return{hasZ:t.hasZ,hasM:t.hasM,rings:n}}function _l(r,e){const t=Mg[r.getType()];return t(ze(r,!0,e),e)}const zg=Rg,Lr="http://www.w3.org/2001/XMLSchema-instance";function ne(r,e){return vi().createElementNS(r,e)}function nt(r,e){return yu(r,e,[]).join("")}function yu(r,e,t){if(r.nodeType==Node.CDATA_SECTION_NODE||r.nodeType==Node.TEXT_NODE)e?t.push(String(r.nodeValue).replace(/(\r\n|\r|\n)/g,"")):t.push(r.nodeValue);else{let i;for(i=r.firstChild;i;i=i.nextSibling)yu(i,e,t)}return t}function Ot(r){return"documentElement"in r}function kg(r,e,t){return r.getAttributeNS(e,t)||""}function Nt(r){return new DOMParser().parseFromString(r,"application/xml")}function jn(r,e){return function(t,i){const n=r.call(e!==void 0?e:this,t,i);if(n!==void 0){const s=i[i.length-1];Le(s,n)}}}function X(r,e){return function(t,i){const n=r.call(e!==void 0?e:this,t,i);n!==void 0&&i[i.length-1].push(n)}}function Q(r,e){return function(t,i){const n=r.call(e!==void 0?e:this,t,i);n!==void 0&&(i[i.length-1]=n)}}function Pe(r,e,t){return function(i,n){const s=r.call(t!==void 0?t:this,i,n);if(s!==void 0){const a=n[n.length-1],o=e!==void 0?e:i.localName;let l;o in a?l=a[o]:(l=[],a[o]=l),l.push(s)}}}function T(r,e,t){return function(i,n){const s=r.call(t!==void 0?t:this,i,n);if(s!==void 0){const a=n[n.length-1],o=e!==void 0?e:i.localName;a[o]=s}}}function M(r,e){return function(t,i,n){r.call(e!==void 0?e:this,t,i,n),n[n.length-1].node.appendChild(t)}}function _u(r,e){let t,i;return function(n,s,a){if(t===void 0){t={};const o={};o[n.localName]=r,t[n.namespaceURI]=o,i=Ne(n.localName)}xu(t,i,s,a)}}function Ne(r,e){return function(t,i,n){const a=i[i.length-1].node;let o=r;o===void 0&&(o=n);const l=e!==void 0?e:a.namespaceURI;return ne(l,o)}}const Xe=Ne();function dt(r,e){const t=e.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=r[e[n]];return i}function N(r,e,t){t=t!==void 0?t:{};let i,n;for(i=0,n=r.length;i<n;++i)t[r[i]]=e;return t}function ft(r,e,t,i){let n;for(n=e.firstElementChild;n;n=n.nextElementSibling){const s=r[n.namespaceURI];if(s!==void 0){const a=s[n.localName];a!==void 0&&a.call(i,n,t)}}}function D(r,e,t,i,n){return i.push(r),ft(e,t,i,n),i.pop()}function xu(r,e,t,i,n,s){const a=(n!==void 0?n:t).length;let o,l;for(let h=0;h<a;++h)o=t[h],o!==void 0&&(l=e.call(s!==void 0?s:this,o,i,n!==void 0?n[h]:void 0),l!==void 0&&r[l.namespaceURI][l.localName].call(s,l,o,i))}function re(r,e,t,i,n,s,a){return n.push(r),xu(e,t,i,n,s,a),n.pop()}let Fs;function $g(){return Fs===void 0&&typeof XMLSerializer<"u"&&(Fs=new XMLSerializer),Fs}let Ds;function vi(){return Ds===void 0&&typeof document<"u"&&(Ds=document.implementation.createDocument("","",null)),Ds}class jg extends Ga{constructor(){super(),this.xmlSerializer_=$g()}getType(){return"xml"}readFeature(e,t){if(!e)return null;if(typeof e=="string"){const i=Nt(e);return this.readFeatureFromDocument(i,t)}return Ot(e)?this.readFeatureFromDocument(e,t):this.readFeatureFromNode(e,t)}readFeatureFromDocument(e,t){const i=this.readFeaturesFromDocument(e,t);return i.length>0?i[0]:null}readFeatureFromNode(e,t){return null}readFeatures(e,t){if(!e)return[];if(typeof e=="string"){const i=Nt(e);return this.readFeaturesFromDocument(i,t)}return Ot(e)?this.readFeaturesFromDocument(e,t):this.readFeaturesFromNode(e,t)}readFeaturesFromDocument(e,t){const i=[];for(let n=e.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&Le(i,this.readFeaturesFromNode(n,t));return i}readFeaturesFromNode(e,t){return $t()}readGeometry(e,t){if(!e)return null;if(typeof e=="string"){const i=Nt(e);return this.readGeometryFromDocument(i,t)}return Ot(e)?this.readGeometryFromDocument(e,t):this.readGeometryFromNode(e,t)}readGeometryFromDocument(e,t){return null}readGeometryFromNode(e,t){return null}readProjection(e){if(!e)return null;if(typeof e=="string"){const t=Nt(e);return this.readProjectionFromDocument(t)}return Ot(e)?this.readProjectionFromDocument(e):this.readProjectionFromNode(e)}readProjectionFromDocument(e){return this.dataProjection}readProjectionFromNode(e){return this.dataProjection}writeFeature(e,t){const i=this.writeFeatureNode(e,t);return this.xmlSerializer_.serializeToString(i)}writeFeatureNode(e,t){return null}writeFeatures(e,t){const i=this.writeFeaturesNode(e,t);return this.xmlSerializer_.serializeToString(i)}writeFeaturesNode(e,t){return null}writeGeometry(e,t){const i=this.writeGeometryNode(e,t);return this.xmlSerializer_.serializeToString(i)}writeGeometryNode(e,t){return null}}const an=jg,nr="http://www.opengis.net/gml",Zg=/^\s*$/;class Fe extends an{constructor(e){super(),e=e||{},this.featureType=e.featureType,this.featureNS=e.featureNS,this.srsName=e.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:X(this.readFeaturesInternal),featureMembers:Q(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(e,t){const i=e.localName;let n=null;if(i=="FeatureCollection")n=D([],this.FEATURE_COLLECTION_PARSERS,e,t,this);else if(i=="featureMembers"||i=="featureMember"||i=="member"){const s=t[0];let a=s.featureType,o=s.featureNS;const l="p",h="p0";if(!a&&e.childNodes){a=[],o={};for(let d=0,m=e.childNodes.length;d<m;++d){const g=e.childNodes[d];if(g.nodeType===1){const y=g.nodeName.split(":").pop();if(!a.includes(y)){let _="",v=0;const E=g.namespaceURI;for(const S in o){if(o[S]===E){_=S;break}++v}_||(_=l+v,o[_]=E),a.push(_+":"+y)}}}i!="featureMember"&&(s.featureType=a,s.featureNS=o)}if(typeof o=="string"){const d=o;o={},o[h]=d}const c={},u=Array.isArray(a)?a:[a];for(const d in o){const m={};for(let g=0,y=u.length;g<y;++g)(u[g].includes(":")?u[g].split(":")[0]:h)===d&&(m[u[g].split(":").pop()]=i=="featureMembers"?X(this.readFeatureElement,this):Q(this.readFeatureElement,this));c[o[d]]=m}i=="featureMember"||i=="member"?n=D(void 0,c,e,t):n=D([],c,e,t)}return n===null&&(n=[]),n}readGeometryOrExtent(e,t){const i=t[0];return i.srsName=e.firstElementChild.getAttribute("srsName"),i.srsDimension=e.firstElementChild.getAttribute("srsDimension"),D(null,this.GEOMETRY_PARSERS,e,t,this)}readExtentElement(e,t){const i=t[0],n=this.readGeometryOrExtent(e,t);return n?Ua(n,i):void 0}readGeometryElement(e,t){const i=t[0],n=this.readGeometryOrExtent(e,t);return n?ze(n,!1,i):void 0}readFeatureElementInternal(e,t,i){let n;const s={};for(let l=e.firstElementChild;l;l=l.nextElementSibling){let h;const c=l.localName;l.childNodes.length===0||l.childNodes.length===1&&(l.firstChild.nodeType===3||l.firstChild.nodeType===4)?(h=nt(l,!1),Zg.test(h)&&(h=void 0)):(i&&(h=c==="boundedBy"?this.readExtentElement(l,t):this.readGeometryElement(l,t)),h?c!=="boundedBy"&&(n=c):h=this.readFeatureElementInternal(l,t,!1));const u=l.attributes.length;if(u>0&&!(h instanceof md)){h={_content_:h};for(let d=0;d<u;d++){const m=l.attributes[d].name;h[m]=l.attributes[d].value}}s[c]?(s[c]instanceof Array||(s[c]=[s[c]]),s[c].push(h)):s[c]=h}if(!i)return s;const a=new it(s);n&&a.setGeometryName(n);const o=e.getAttribute("fid")||kg(e,this.namespace,"id");return o&&a.setId(o),a}readFeatureElement(e,t){return this.readFeatureElementInternal(e,t,!0)}readPoint(e,t){const i=this.readFlatCoordinatesFromNode(e,t);if(i)return new _t(i,"XYZ")}readMultiPoint(e,t){const i=D([],this.MULTIPOINT_PARSERS,e,t,this);if(i)return new yi(i)}readMultiLineString(e,t){const i=D([],this.MULTILINESTRING_PARSERS,e,t,this);if(i)return new or(i)}readMultiPolygon(e,t){const i=D([],this.MULTIPOLYGON_PARSERS,e,t,this);if(i)return new Dr(i)}pointMemberParser(e,t){ft(this.POINTMEMBER_PARSERS,e,t,this)}lineStringMemberParser(e,t){ft(this.LINESTRINGMEMBER_PARSERS,e,t,this)}polygonMemberParser(e,t){ft(this.POLYGONMEMBER_PARSERS,e,t,this)}readLineString(e,t){const i=this.readFlatCoordinatesFromNode(e,t);if(i)return new Et(i,"XYZ")}readFlatLinearRing(e,t){const i=D(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this);if(i)return i}readLinearRing(e,t){const i=this.readFlatCoordinatesFromNode(e,t);if(i)return new sa(i,"XYZ")}readPolygon(e,t){const i=D([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this);if(i&&i[0]){const n=i[0],s=[n.length];let a,o;for(a=1,o=i.length;a<o;++a)Le(n,i[a]),s.push(n.length);return new vr(n,"XYZ",s)}}readFlatCoordinatesFromNode(e,t){return D(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}readGeometryFromNode(e,t){const i=this.readGeometryElement(e,[this.getReadOptions(e,t||{})]);return i||null}readFeaturesFromNode(e,t){const i={featureType:this.featureType,featureNS:this.featureNS};return i&&Object.assign(i,this.getReadOptions(e,t)),this.readFeaturesInternal(e,[i])||[]}readProjectionFromNode(e){return de(this.srsName?this.srsName:e.firstElementChild.getAttribute("srsName"))}}Fe.prototype.namespace=nr;Fe.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};Fe.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};Fe.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};Fe.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:X(Fe.prototype.pointMemberParser),pointMembers:X(Fe.prototype.pointMemberParser)}};Fe.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:X(Fe.prototype.lineStringMemberParser),lineStringMembers:X(Fe.prototype.lineStringMemberParser)}};Fe.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:X(Fe.prototype.polygonMemberParser),polygonMembers:X(Fe.prototype.polygonMemberParser)}};Fe.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:X(Fe.prototype.readFlatCoordinatesFromNode)}};Fe.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:X(Fe.prototype.readLineString)}};Fe.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:X(Fe.prototype.readPolygon)}};Fe.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:Q(Fe.prototype.readFlatLinearRing)}};const he=Fe;function yr(r){const e=nt(r,!1);return Pr(e)}function Pr(r){const e=/^\s*(true|1)|(false|0)\s*$/.exec(r);if(e)return e[1]!==void 0||!1}function Ya(r){const e=nt(r,!1),t=Date.parse(e);return isNaN(t)?void 0:t/1e3}function ce(r){const e=nt(r,!1);return tr(e)}function tr(r){const e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(r);if(e)return parseFloat(e[1])}function Ue(r){const e=nt(r,!1);return ir(e)}function ir(r){const e=/^\s*(\d+)\s*$/.exec(r);if(e)return parseInt(e[1],10)}function U(r){return nt(r,!1).trim()}function di(r,e){ee(r,e?"1":"0")}function qg(r,e){r.appendChild(vi().createCDATASection(e))}function Xg(r,e){const t=new Date(e*1e3),i=t.getUTCFullYear()+"-"+Pi(t.getUTCMonth()+1,2)+"-"+Pi(t.getUTCDate(),2)+"T"+Pi(t.getUTCHours(),2)+":"+Pi(t.getUTCMinutes(),2)+":"+Pi(t.getUTCSeconds(),2)+"Z";r.appendChild(vi().createTextNode(i))}function ht(r,e){const t=e.toPrecision();r.appendChild(vi().createTextNode(t))}function Zn(r,e){const t=e.toString();r.appendChild(vi().createTextNode(t))}function ee(r,e){r.appendChild(vi().createTextNode(e))}const Hg=nr+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",Wg={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class pe extends he{constructor(e){e=e||{},super(e),this.FEATURE_COLLECTION_PARSERS[nr].featureMember=X(this.readFeaturesInternal),this.schemaLocation=e.schemaLocation?e.schemaLocation:Hg}readFlatCoordinates(e,t){const i=nt(e,!1).replace(/^\s*|\s*$/g,""),s=t[0].srsName;let a="enu";if(s){const h=de(s);h&&(a=h.getAxisOrientation())}const o=i.trim().split(/\s+/),l=[];for(let h=0,c=o.length;h<c;h++){const u=o[h].split(/,+/),d=parseFloat(u[0]),m=parseFloat(u[1]),g=u.length===3?parseFloat(u[2]):0;a.substr(0,2)==="en"?l.push(d,m,g):l.push(m,d,g)}return l}readBox(e,t){const i=D([null],this.BOX_PARSERS_,e,t,this);return Xh(i[1][0],i[1][1],i[1][3],i[1][4])}innerBoundaryIsParser(e,t){const i=D(void 0,this.RING_PARSERS,e,t,this);i&&t[t.length-1].push(i)}outerBoundaryIsParser(e,t){const i=D(void 0,this.RING_PARSERS,e,t,this);if(i){const n=t[t.length-1];n[0]=i}}GEOMETRY_NODE_FACTORY_(e,t,i){const n=t[t.length-1],s=n.multiSurface,a=n.surface,o=n.multiCurve;return Array.isArray(e)?i="Envelope":(i=e.getType(),i==="MultiPolygon"&&s===!0?i="MultiSurface":i==="Polygon"&&a===!0?i="Surface":i==="MultiLineString"&&o===!0&&(i="MultiCurve")),ne("http://www.opengis.net/gml",i)}writeFeatureElement(e,t,i){const n=t.getId();n&&e.setAttribute("fid",n);const s=i[i.length-1],a=s.featureNS,o=t.getGeometryName();s.serializers||(s.serializers={},s.serializers[a]={});const l=[],h=[];if(t.hasProperties()){const u=t.getProperties();for(const d in u){const m=u[d];m!==null&&(l.push(d),h.push(m),d==o||typeof m.getSimplifiedGeometry=="function"?d in s.serializers[a]||(s.serializers[a][d]=M(this.writeGeometryElement,this)):d in s.serializers[a]||(s.serializers[a][d]=M(ee)))}}const c=Object.assign({},s);c.node=e,re(c,s.serializers,Ne(void 0,a),h,i,l)}writeCurveOrLineString(e,t,i){const s=i[i.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a),this.writeCoordinates_(a,t,i)}else if(e.nodeName==="Curve"){const a=ne(e.namespaceURI,"segments");e.appendChild(a),this.writeCurveSegments_(a,t,i)}}writeLineStringOrCurveMember(e,t,i){const n=this.GEOMETRY_NODE_FACTORY_(t,i);n&&(e.appendChild(n),this.writeCurveOrLineString(n,t,i))}writeMultiCurveOrLineString(e,t,i){const n=i[i.length-1],s=n.hasZ,a=n.srsName,o=n.curve;a&&e.setAttribute("srsName",a);const l=t.getLineStrings();re({node:e,hasZ:s,srsName:a,curve:o},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeGeometryElement(e,t,i){const n=i[i.length-1],s=Object.assign({},n);s.node=e;let a;Array.isArray(t)?a=Ua(t,n):a=ze(t,!0,n),re(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[a],i,void 0,this)}createCoordinatesNode_(e){const t=ne(e,"coordinates");return t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," "),t}writeCoordinates_(e,t,i){const n=i[i.length-1],s=n.hasZ,a=n.srsName,o=t.getCoordinates(),l=o.length,h=new Array(l);for(let c=0;c<l;++c){const u=o[c];h[c]=this.getCoords_(u,a,s)}ee(e,h.join(" "))}writeCurveSegments_(e,t,i){const n=ne(e.namespaceURI,"LineStringSegment");e.appendChild(n),this.writeCurveOrLineString(n,t,i)}writeSurfaceOrPolygon(e,t,i){const n=i[i.length-1],s=n.hasZ,a=n.srsName;if(e.nodeName!=="PolygonPatch"&&a&&e.setAttribute("srsName",a),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const o=t.getLinearRings();re({node:e,hasZ:s,srsName:a},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,o,i,void 0,this)}else if(e.nodeName==="Surface"){const o=ne(e.namespaceURI,"patches");e.appendChild(o),this.writeSurfacePatches_(o,t,i)}}RING_NODE_FACTORY_(e,t,i){const n=t[t.length-1],s=n.node,a=n.exteriorWritten;return a===void 0&&(n.exteriorWritten=!0),ne(s.namespaceURI,a!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(e,t,i){const n=ne(e.namespaceURI,"PolygonPatch");e.appendChild(n),this.writeSurfaceOrPolygon(n,t,i)}writeRing(e,t,i){const n=ne(e.namespaceURI,"LinearRing");e.appendChild(n),this.writeLinearRing(n,t,i)}getCoords_(e,t,i){let n="enu";t&&(n=de(t).getAxisOrientation());let s=n.substr(0,2)==="en"?e[0]+","+e[1]:e[1]+","+e[0];if(i){const a=e[2]||0;s+=","+a}return s}writePoint(e,t,i){const n=i[i.length-1],s=n.hasZ,a=n.srsName;a&&e.setAttribute("srsName",a);const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o);const l=t.getCoordinates(),h=this.getCoords_(l,a,s);ee(o,h)}writeMultiPoint(e,t,i){const n=i[i.length-1],s=n.hasZ,a=n.srsName;a&&e.setAttribute("srsName",a);const o=t.getPoints();re({node:e,hasZ:s,srsName:a},this.POINTMEMBER_SERIALIZERS,Ne("pointMember"),o,i,void 0,this)}writePointMember(e,t,i){const n=ne(e.namespaceURI,"Point");e.appendChild(n),this.writePoint(n,t,i)}writeLinearRing(e,t,i){const s=i[i.length-1].srsName;s&&e.setAttribute("srsName",s);const a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a),this.writeCoordinates_(a,t,i)}writeMultiSurfaceOrPolygon(e,t,i){const n=i[i.length-1],s=n.hasZ,a=n.srsName,o=n.surface;a&&e.setAttribute("srsName",a);const l=t.getPolygons();re({node:e,hasZ:s,srsName:a,surface:o},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeSurfaceOrPolygonMember(e,t,i){const n=this.GEOMETRY_NODE_FACTORY_(t,i);n&&(e.appendChild(n),this.writeSurfaceOrPolygon(n,t,i))}writeEnvelope(e,t,i){const s=i[i.length-1].srsName;s&&e.setAttribute("srsName",s);const a=["lowerCorner","upperCorner"],o=[t[0]+" "+t[1],t[2]+" "+t[3]];re({node:e},this.ENVELOPE_SERIALIZERS,Xe,o,i,a,this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,i){const n=t[t.length-1].node;return ne("http://www.opengis.net/gml",Wg[n.nodeName])}}pe.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:Q(pe.prototype.readFlatCoordinates)}};pe.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:pe.prototype.innerBoundaryIsParser,outerBoundaryIs:pe.prototype.outerBoundaryIsParser}};pe.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:X(pe.prototype.readFlatCoordinates)}};pe.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:Q(he.prototype.readPoint),MultiPoint:Q(he.prototype.readMultiPoint),LineString:Q(he.prototype.readLineString),MultiLineString:Q(he.prototype.readMultiLineString),LinearRing:Q(he.prototype.readLinearRing),Polygon:Q(he.prototype.readPolygon),MultiPolygon:Q(he.prototype.readMultiPolygon),Box:Q(pe.prototype.readBox)}};pe.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:M(pe.prototype.writeCurveOrLineString),MultiCurve:M(pe.prototype.writeMultiCurveOrLineString),Point:M(pe.prototype.writePoint),MultiPoint:M(pe.prototype.writeMultiPoint),LineString:M(pe.prototype.writeCurveOrLineString),MultiLineString:M(pe.prototype.writeMultiCurveOrLineString),LinearRing:M(pe.prototype.writeLinearRing),Polygon:M(pe.prototype.writeSurfaceOrPolygon),MultiPolygon:M(pe.prototype.writeMultiSurfaceOrPolygon),Surface:M(pe.prototype.writeSurfaceOrPolygon),MultiSurface:M(pe.prototype.writeMultiSurfaceOrPolygon),Envelope:M(pe.prototype.writeEnvelope)}};pe.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:M(pe.prototype.writeLineStringOrCurveMember),curveMember:M(pe.prototype.writeLineStringOrCurveMember)}};pe.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:M(pe.prototype.writeRing),innerBoundaryIs:M(pe.prototype.writeRing)}};pe.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:M(pe.prototype.writePointMember)}};pe.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:M(pe.prototype.writeSurfaceOrPolygonMember),polygonMember:M(pe.prototype.writeSurfaceOrPolygonMember)}};pe.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:M(ee),upperCorner:M(ee)}};const Ei=pe,Vg=nr+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",Yg={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class W extends he{constructor(e){e=e||{},super(e),this.surface_=e.surface!==void 0?e.surface:!1,this.curve_=e.curve!==void 0?e.curve:!1,this.multiCurve_=e.multiCurve!==void 0?e.multiCurve:!0,this.multiSurface_=e.multiSurface!==void 0?e.multiSurface:!0,this.schemaLocation=e.schemaLocation?e.schemaLocation:Vg,this.hasZ=e.hasZ!==void 0?e.hasZ:!1}readMultiCurve(e,t){const i=D([],this.MULTICURVE_PARSERS,e,t,this);if(i)return new or(i)}readFlatCurveRing(e,t){const i=D([],this.MULTICURVE_PARSERS,e,t,this),n=[];for(let s=0,a=i.length;s<a;++s)Le(n,i[s].getFlatCoordinates());return n}readMultiSurface(e,t){const i=D([],this.MULTISURFACE_PARSERS,e,t,this);if(i)return new Dr(i)}curveMemberParser(e,t){ft(this.CURVEMEMBER_PARSERS,e,t,this)}surfaceMemberParser(e,t){ft(this.SURFACEMEMBER_PARSERS,e,t,this)}readPatch(e,t){return D([null],this.PATCHES_PARSERS,e,t,this)}readSegment(e,t){return D([],this.SEGMENTS_PARSERS,e,t,this)}readPolygonPatch(e,t){return D([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this)}readLineStringSegment(e,t){return D([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}interiorParser(e,t){const i=D(void 0,this.RING_PARSERS,e,t,this);i&&t[t.length-1].push(i)}exteriorParser(e,t){const i=D(void 0,this.RING_PARSERS,e,t,this);if(i){const n=t[t.length-1];n[0]=i}}readSurface(e,t){const i=D([null],this.SURFACE_PARSERS,e,t,this);if(i&&i[0]){const n=i[0],s=[n.length];let a,o;for(a=1,o=i.length;a<o;++a)Le(n,i[a]),s.push(n.length);return new vr(n,"XYZ",s)}}readCurve(e,t){const i=D([null],this.CURVE_PARSERS,e,t,this);if(i)return new Et(i,"XYZ")}readEnvelope(e,t){const i=D([null],this.ENVELOPE_PARSERS,e,t,this);return Xh(i[1][0],i[1][1],i[2][0],i[2][1])}readFlatPos(e,t){let i=nt(e,!1);const n=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,s=[];let a;for(;a=n.exec(i);)s.push(parseFloat(a[1])),i=i.substr(a[0].length);if(i!=="")return;const l=t[0].srsName;let h="enu";if(l&&(h=de(l).getAxisOrientation()),h==="neu"){let u,d;for(u=0,d=s.length;u<d;u+=3){const m=s[u],g=s[u+1];s[u]=g,s[u+1]=m}}const c=s.length;if(c==2&&s.push(0),c!==0)return s}readFlatPosList(e,t){const i=nt(e,!1).replace(/^\s*|\s*$/g,""),n=t[0],s=n.srsName,a=n.srsDimension;let o="enu";s&&(o=de(s).getAxisOrientation());const l=i.split(/\s+/);let h=2;e.getAttribute("srsDimension")?h=ir(e.getAttribute("srsDimension")):e.getAttribute("dimension")?h=ir(e.getAttribute("dimension")):e.parentNode.getAttribute("srsDimension")?h=ir(e.parentNode.getAttribute("srsDimension")):a&&(h=ir(a));let c,u,d;const m=[];for(let g=0,y=l.length;g<y;g+=h)c=parseFloat(l[g]),u=parseFloat(l[g+1]),d=h===3?parseFloat(l[g+2]):0,o.substr(0,2)==="en"?m.push(c,u,d):m.push(u,c,d);return m}writePos_(e,t,i){const n=i[i.length-1],s=n.hasZ,a=s?"3":"2";e.setAttribute("srsDimension",a);const o=n.srsName;let l="enu";o&&(l=de(o).getAxisOrientation());const h=t.getCoordinates();let c;if(l.substr(0,2)==="en"?c=h[0]+" "+h[1]:c=h[1]+" "+h[0],s){const u=h[2]||0;c+=" "+u}ee(e,c)}getCoords_(e,t,i){let n="enu";t&&(n=de(t).getAxisOrientation());let s=n.substr(0,2)==="en"?e[0]+" "+e[1]:e[1]+" "+e[0];if(i){const a=e[2]||0;s+=" "+a}return s}writePosList_(e,t,i){const n=i[i.length-1],s=n.hasZ,a=s?"3":"2";e.setAttribute("srsDimension",a);const o=n.srsName,l=t.getCoordinates(),h=l.length,c=new Array(h);let u;for(let d=0;d<h;++d)u=l[d],c[d]=this.getCoords_(u,o,s);ee(e,c.join(" "))}writePoint(e,t,i){const s=i[i.length-1].srsName;s&&e.setAttribute("srsName",s);const a=ne(e.namespaceURI,"pos");e.appendChild(a),this.writePos_(a,t,i)}writeEnvelope(e,t,i){const s=i[i.length-1].srsName;s&&e.setAttribute("srsName",s);const a=["lowerCorner","upperCorner"],o=[t[0]+" "+t[1],t[2]+" "+t[3]];re({node:e},this.ENVELOPE_SERIALIZERS,Xe,o,i,a,this)}writeLinearRing(e,t,i){const s=i[i.length-1].srsName;s&&e.setAttribute("srsName",s);const a=ne(e.namespaceURI,"posList");e.appendChild(a),this.writePosList_(a,t,i)}RING_NODE_FACTORY_(e,t,i){const n=t[t.length-1],s=n.node,a=n.exteriorWritten;return a===void 0&&(n.exteriorWritten=!0),ne(s.namespaceURI,a!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(e,t,i){const n=i[i.length-1],s=n.hasZ,a=n.srsName;if(e.nodeName!=="PolygonPatch"&&a&&e.setAttribute("srsName",a),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const o=t.getLinearRings();re({node:e,hasZ:s,srsName:a},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,o,i,void 0,this)}else if(e.nodeName==="Surface"){const o=ne(e.namespaceURI,"patches");e.appendChild(o),this.writeSurfacePatches_(o,t,i)}}writeCurveOrLineString(e,t,i){const s=i[i.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const a=ne(e.namespaceURI,"posList");e.appendChild(a),this.writePosList_(a,t,i)}else if(e.nodeName==="Curve"){const a=ne(e.namespaceURI,"segments");e.appendChild(a),this.writeCurveSegments_(a,t,i)}}writeMultiSurfaceOrPolygon(e,t,i){const n=i[i.length-1],s=n.hasZ,a=n.srsName,o=n.surface;a&&e.setAttribute("srsName",a);const l=t.getPolygons();re({node:e,hasZ:s,srsName:a,surface:o},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeMultiPoint(e,t,i){const n=i[i.length-1],s=n.srsName,a=n.hasZ;s&&e.setAttribute("srsName",s);const o=t.getPoints();re({node:e,hasZ:a,srsName:s},this.POINTMEMBER_SERIALIZERS,Ne("pointMember"),o,i,void 0,this)}writeMultiCurveOrLineString(e,t,i){const n=i[i.length-1],s=n.hasZ,a=n.srsName,o=n.curve;a&&e.setAttribute("srsName",a);const l=t.getLineStrings();re({node:e,hasZ:s,srsName:a,curve:o},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeRing(e,t,i){const n=ne(e.namespaceURI,"LinearRing");e.appendChild(n),this.writeLinearRing(n,t,i)}writeSurfaceOrPolygonMember(e,t,i){const n=this.GEOMETRY_NODE_FACTORY_(t,i);n&&(e.appendChild(n),this.writeSurfaceOrPolygon(n,t,i))}writePointMember(e,t,i){const n=ne(e.namespaceURI,"Point");e.appendChild(n),this.writePoint(n,t,i)}writeLineStringOrCurveMember(e,t,i){const n=this.GEOMETRY_NODE_FACTORY_(t,i);n&&(e.appendChild(n),this.writeCurveOrLineString(n,t,i))}writeSurfacePatches_(e,t,i){const n=ne(e.namespaceURI,"PolygonPatch");e.appendChild(n),this.writeSurfaceOrPolygon(n,t,i)}writeCurveSegments_(e,t,i){const n=ne(e.namespaceURI,"LineStringSegment");e.appendChild(n),this.writeCurveOrLineString(n,t,i)}writeGeometryElement(e,t,i){const n=i[i.length-1],s=Object.assign({},n);s.node=e;let a;Array.isArray(t)?a=Ua(t,n):a=ze(t,!0,n),re(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[a],i,void 0,this)}writeFeatureElement(e,t,i){const n=t.getId();n&&e.setAttribute("fid",n);const s=i[i.length-1],a=s.featureNS,o=t.getGeometryName();s.serializers||(s.serializers={},s.serializers[a]={});const l=[],h=[];if(t.hasProperties()){const u=t.getProperties();for(const d in u){const m=u[d];m!==null&&(l.push(d),h.push(m),d==o||typeof m.getSimplifiedGeometry=="function"?d in s.serializers[a]||(s.serializers[a][d]=M(this.writeGeometryElement,this)):d in s.serializers[a]||(s.serializers[a][d]=M(ee)))}}const c=Object.assign({},s);c.node=e,re(c,s.serializers,Ne(void 0,a),h,i,l)}writeFeatureMembers_(e,t,i){const n=i[i.length-1],s=n.featureType,a=n.featureNS,o={};o[a]={},o[a][s]=M(this.writeFeatureElement,this);const l=Object.assign({},n);l.node=e,re(l,o,Ne(s,a),t,i)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,i){const n=t[t.length-1].node;return ne(this.namespace,Yg[n.nodeName])}GEOMETRY_NODE_FACTORY_(e,t,i){const n=t[t.length-1],s=n.multiSurface,a=n.surface,o=n.curve,l=n.multiCurve;return Array.isArray(e)?i="Envelope":(i=e.getType(),i==="MultiPolygon"&&s===!0?i="MultiSurface":i==="Polygon"&&a===!0?i="Surface":i==="LineString"&&o===!0?i="Curve":i==="MultiLineString"&&l===!0&&(i="MultiCurve")),ne(this.namespace,i)}writeGeometryNode(e,t){t=this.adaptOptions(t);const i=ne(this.namespace,"geom"),n={node:i,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return t&&Object.assign(n,t),this.writeGeometryElement(i,e,[n]),i}writeFeaturesNode(e,t){t=this.adaptOptions(t);const i=ne(this.namespace,"featureMembers");i.setAttributeNS(Lr,"xsi:schemaLocation",this.schemaLocation);const n={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return t&&Object.assign(n,t),this.writeFeatureMembers_(i,e,[n]),i}}W.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:Q(W.prototype.readFlatPos),posList:Q(W.prototype.readFlatPosList),coordinates:Q(Ei.prototype.readFlatCoordinates)}};W.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:W.prototype.interiorParser,exterior:W.prototype.exteriorParser}};W.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:Q(he.prototype.readPoint),MultiPoint:Q(he.prototype.readMultiPoint),LineString:Q(he.prototype.readLineString),MultiLineString:Q(he.prototype.readMultiLineString),LinearRing:Q(he.prototype.readLinearRing),Polygon:Q(he.prototype.readPolygon),MultiPolygon:Q(he.prototype.readMultiPolygon),Surface:Q(W.prototype.readSurface),MultiSurface:Q(W.prototype.readMultiSurface),Curve:Q(W.prototype.readCurve),MultiCurve:Q(W.prototype.readMultiCurve),Envelope:Q(W.prototype.readEnvelope)}};W.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:X(W.prototype.curveMemberParser),curveMembers:X(W.prototype.curveMemberParser)}};W.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:X(W.prototype.surfaceMemberParser),surfaceMembers:X(W.prototype.surfaceMemberParser)}};W.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:X(he.prototype.readLineString),Curve:X(W.prototype.readCurve)}};W.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:X(he.prototype.readPolygon),Surface:X(W.prototype.readSurface)}};W.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:Q(W.prototype.readPatch)}};W.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:Q(W.prototype.readSegment)}};W.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:X(W.prototype.readFlatPosList),upperCorner:X(W.prototype.readFlatPosList)}};W.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:Q(W.prototype.readPolygonPatch)}};W.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:jn(W.prototype.readLineStringSegment)}};he.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:Q(he.prototype.readFlatLinearRing),Ring:Q(W.prototype.readFlatCurveRing)}};W.prototype.writeFeatures;W.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:M(W.prototype.writeRing),interior:M(W.prototype.writeRing)}};W.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:M(ee),upperCorner:M(ee)}};W.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:M(W.prototype.writeSurfaceOrPolygonMember),polygonMember:M(W.prototype.writeSurfaceOrPolygonMember)}};W.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:M(W.prototype.writePointMember)}};W.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:M(W.prototype.writeLineStringOrCurveMember),curveMember:M(W.prototype.writeLineStringOrCurveMember)}};W.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:M(W.prototype.writeCurveOrLineString),MultiCurve:M(W.prototype.writeMultiCurveOrLineString),Point:M(W.prototype.writePoint),MultiPoint:M(W.prototype.writeMultiPoint),LineString:M(W.prototype.writeCurveOrLineString),MultiLineString:M(W.prototype.writeMultiCurveOrLineString),LinearRing:M(W.prototype.writeLinearRing),Polygon:M(W.prototype.writeSurfaceOrPolygon),MultiPolygon:M(W.prototype.writeMultiSurfaceOrPolygon),Surface:M(W.prototype.writeSurfaceOrPolygon),MultiSurface:M(W.prototype.writeMultiSurfaceOrPolygon),Envelope:M(W.prototype.writeEnvelope)}};const le=W,Ka=le;Ka.prototype.writeFeatures;Ka.prototype.writeFeaturesNode;const Kg=Ka,$e=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],Qg="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",Jg={rte:vu,trk:Eu,wpt:wu},em=N($e,{rte:X(vu),trk:X(Eu),wpt:X(wu)}),tm=N($e,{text:T(U,"linkText"),type:T(U,"linkType")}),rm=N($e,{rte:M(Rm),trk:M(bm),wpt:M(Am)});class im extends an{constructor(e){super(),e=e||{},this.dataProjection=de("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let t=0,i=e.length;t<i;++t){const n=e[t];if(this.readExtensions_){const s=n.get("extensionsNode_")||null;this.readExtensions_(n,s)}n.set("extensionsNode_",void 0)}}readFeatureFromNode(e,t){if(!$e.includes(e.namespaceURI))return null;const i=Jg[e.localName];if(!i)return null;const n=i(e,[this.getReadOptions(e,t)]);return n?(this.handleReadExtensions_([n]),n):null}readFeaturesFromNode(e,t){if(!$e.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const i=D([],em,e,[this.getReadOptions(e,t)]);return i?(this.handleReadExtensions_(i),i):[]}return[]}writeFeaturesNode(e,t){t=this.adaptOptions(t);const i=ne("http://www.topografix.com/GPX/1/1","gpx"),n="http://www.w3.org/2000/xmlns/";return i.setAttributeNS(n,"xmlns:xsi",Lr),i.setAttributeNS(Lr,"xsi:schemaLocation",Qg),i.setAttribute("version","1.1"),i.setAttribute("creator","OpenLayers"),re({node:i},rm,wm,e,[t]),i}}const nm=N($e,{name:T(U),cmt:T(U),desc:T(U),src:T(U),link:eo,number:T(Ue),extensions:to,type:T(U),rtept:Sm}),sm=N($e,{ele:T(ce),time:T(Ya)}),am=N($e,{name:T(U),cmt:T(U),desc:T(U),src:T(U),link:eo,number:T(Ue),type:T(U),extensions:to,trkseg:Mm}),om=N($e,{trkpt:Tm}),lm=N($e,{ele:T(ce),time:T(Ya)}),hm=N($e,{ele:T(ce),time:T(Ya),magvar:T(ce),geoidheight:T(ce),name:T(U),cmt:T(U),desc:T(U),src:T(U),link:eo,sym:T(U),type:T(U),fix:T(U),sat:T(Ue),hdop:T(ce),vdop:T(ce),pdop:T(ce),ageofdgpsdata:T(ce),dgpsid:T(Ue),extensions:to}),um=["text","type"],cm=N($e,{text:M(ee),type:M(ee)}),fm=N($e,["name","cmt","desc","src","link","number","type","rtept"]),dm=N($e,{name:M(ee),cmt:M(ee),desc:M(ee),src:M(ee),link:M(ro),number:M(Zn),type:M(ee),rtept:_u(M(io))}),gm=N($e,["ele","time"]),mm=N($e,["name","cmt","desc","src","link","number","type","trkseg"]),pm=N($e,{name:M(ee),cmt:M(ee),desc:M(ee),src:M(ee),link:M(ro),number:M(Zn),type:M(ee),trkseg:_u(M(Pm))}),ym=Ne("trkpt"),_m=N($e,{trkpt:M(io)}),xm=N($e,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),vm=N($e,{ele:M(ht),time:M(Xg),magvar:M(ht),geoidheight:M(ht),name:M(ee),cmt:M(ee),desc:M(ee),src:M(ee),link:M(ro),sym:M(ee),type:M(ee),fix:M(ee),sat:M(Zn),hdop:M(ht),vdop:M(ht),pdop:M(ht),ageofdgpsdata:M(ht),dgpsid:M(Zn)}),Em={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function wm(r,e,t){const i=r.getGeometry();if(i){const n=Em[i.getType()];if(n){const s=e[e.length-1].node;return ne(s.namespaceURI,n)}}}function Qa(r,e,t,i){return r.push(parseFloat(t.getAttribute("lon")),parseFloat(t.getAttribute("lat"))),"ele"in i?(r.push(i.ele),delete i.ele,e.hasZ=!0):r.push(0),"time"in i?(r.push(i.time),delete i.time,e.hasM=!0):r.push(0),r}function Ja(r,e,t){let i="XY",n=2;if(r.hasZ&&r.hasM?(i="XYZM",n=4):r.hasZ?(i="XYZ",n=3):r.hasM&&(i="XYM",n=3),n!==4){for(let s=0,a=e.length/4;s<a;s++)e[s*n]=e[s*4],e[s*n+1]=e[s*4+1],r.hasZ&&(e[s*n+2]=e[s*4+2]),r.hasM&&(e[s*n+2]=e[s*4+3]);if(e.length=e.length/4*n,t)for(let s=0,a=t.length;s<a;s++)t[s]=t[s]/4*n}return i}function eo(r,e){const t=e[e.length-1],i=r.getAttribute("href");i!==null&&(t.link=i),ft(tm,r,e)}function to(r,e){const t=e[e.length-1];t.extensionsNode_=r}function Sm(r,e){const t=D({},sm,r,e);if(t){const i=e[e.length-1],n=i.flatCoordinates,s=i.layoutOptions;Qa(n,s,r,t)}}function Tm(r,e){const t=D({},lm,r,e);if(t){const i=e[e.length-1],n=i.flatCoordinates,s=i.layoutOptions;Qa(n,s,r,t)}}function Mm(r,e){const t=e[e.length-1];ft(om,r,e);const i=t.flatCoordinates;t.ends.push(i.length)}function vu(r,e){const t=e[0],i=D({flatCoordinates:[],layoutOptions:{}},nm,r,e);if(!i)return;const n=i.flatCoordinates;delete i.flatCoordinates;const s=i.layoutOptions;delete i.layoutOptions;const a=Ja(s,n),o=new Et(n,a);ze(o,!1,t);const l=new it(o);return l.setProperties(i,!0),l}function Eu(r,e){const t=e[0],i=D({flatCoordinates:[],ends:[],layoutOptions:{}},am,r,e);if(!i)return;const n=i.flatCoordinates;delete i.flatCoordinates;const s=i.ends;delete i.ends;const a=i.layoutOptions;delete i.layoutOptions;const o=Ja(a,n,s),l=new or(n,o,s);ze(l,!1,t);const h=new it(l);return h.setProperties(i,!0),h}function wu(r,e){const t=e[0],i=D({},hm,r,e);if(!i)return;const n={},s=Qa([],n,r,i),a=Ja(n,s),o=new _t(s,a);ze(o,!1,t);const l=new it(o);return l.setProperties(i,!0),l}function ro(r,e,t){r.setAttribute("href",e);const n=t[t.length-1].properties,s=[n.linkText,n.linkType];re({node:r},cm,Xe,s,t,um)}function io(r,e,t){const i=t[t.length-1],s=i.node.namespaceURI,a=i.properties;switch(r.setAttributeNS(null,"lat",String(e[1])),r.setAttributeNS(null,"lon",String(e[0])),i.geometryLayout){case"XYZM":e[3]!==0&&(a.time=e[3]);case"XYZ":e[2]!==0&&(a.ele=e[2]);break;case"XYM":e[2]!==0&&(a.time=e[2]);break}const l=r.nodeName=="rtept"?gm[s]:xm[s],h=dt(a,l);re({node:r,properties:a},vm,Xe,h,t,l)}function Rm(r,e,t){const i=t[0],n=e.getProperties(),s={node:r};s.properties=n;const a=e.getGeometry();if(a.getType()=="LineString"){const c=ze(a,!0,i);s.geometryLayout=c.getLayout(),n.rtept=c.getCoordinates()}const o=t[t.length-1].node,l=fm[o.namespaceURI],h=dt(n,l);re(s,dm,Xe,h,t,l)}function bm(r,e,t){const i=t[0],n=e.getProperties(),s={node:r};s.properties=n;const a=e.getGeometry();if(a.getType()=="MultiLineString"){const c=ze(a,!0,i);n.trkseg=c.getLineStrings()}const o=t[t.length-1].node,l=mm[o.namespaceURI],h=dt(n,l);re(s,pm,Xe,h,t,l)}function Pm(r,e,t){const i={node:r};i.geometryLayout=e.getLayout(),i.properties={},re(i,_m,ym,e.getCoordinates(),t)}function Am(r,e,t){const i=t[0],n=t[t.length-1];n.properties=e.getProperties();const s=e.getGeometry();if(s.getType()=="Point"){const a=ze(s,!0,i);n.geometryLayout=a.getLayout(),io(r,a.getCoordinates(),t)}}const Im=im;class Lm extends Ga{constructor(){super()}getType(){return"text"}readFeature(e,t){return this.readFeatureFromText(yn(e),this.adaptOptions(t))}readFeatureFromText(e,t){return $t()}readFeatures(e,t){return this.readFeaturesFromText(yn(e),this.adaptOptions(t))}readFeaturesFromText(e,t){return $t()}readGeometry(e,t){return this.readGeometryFromText(yn(e),this.adaptOptions(t))}readGeometryFromText(e,t){return $t()}readProjection(e){return this.readProjectionFromText(yn(e))}readProjectionFromText(e){return this.dataProjection}writeFeature(e,t){return this.writeFeatureText(e,this.adaptOptions(t))}writeFeatureText(e,t){return $t()}writeFeatures(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))}writeFeaturesText(e,t){return $t()}writeGeometry(e,t){return this.writeGeometryText(e,this.adaptOptions(t))}writeGeometryText(e,t){return $t()}}function yn(r){return typeof r=="string"?r:""}const no=Lm,Cm=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,Om=/^H.([A-Z]{3}).*?:(.*)/,Nm=/^HFDTE(\d{2})(\d{2})(\d{2})/,Fm=/\r\n|\r|\n/;class Dm extends no{constructor(e){super(),e=e||{},this.dataProjection=de("EPSG:4326"),this.altitudeMode_=e.altitudeMode?e.altitudeMode:"none"}readFeatureFromText(e,t){const i=this.altitudeMode_,n=e.split(Fm),s={},a=[];let o=2e3,l=0,h=1,c=-1,u,d;for(u=0,d=n.length;u<d;++u){const _=n[u];let v;if(_.charAt(0)=="B"){if(v=Cm.exec(_),v){const E=parseInt(v[1],10),S=parseInt(v[2],10),w=parseInt(v[3],10);let P=parseInt(v[4],10)+parseInt(v[5],10)/6e4;v[6]=="S"&&(P=-P);let A=parseInt(v[7],10)+parseInt(v[8],10)/6e4;if(v[9]=="W"&&(A=-A),a.push(A,P),i!="none"){let C;i=="gps"?C=parseInt(v[11],10):i=="barometric"?C=parseInt(v[12],10):C=0,a.push(C)}let I=Date.UTC(o,l,h,E,S,w);I<c&&(I=Date.UTC(o,l,h+1,E,S,w)),a.push(I/1e3),c=I}}else _.charAt(0)=="H"&&(v=Nm.exec(_),v?(h=parseInt(v[1],10),l=parseInt(v[2],10)-1,o=2e3+parseInt(v[3],10)):(v=Om.exec(_),v&&(s[v[1]]=v[2].trim())))}if(a.length===0)return null;const m=i=="none"?"XYM":"XYZM",g=new Et(a,m),y=new it(ze(g,!1,t));return y.setProperties(s,!0),y}readFeaturesFromText(e,t){const i=this.readFeatureFromText(e,t);return i?[i]:[]}}const Gm=Dm,ke={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"},Cr={};Cr[ke.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}};Cr[ke.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}};Cr[ke.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}};Cr.none={none:{supports:[],formats:[],qualities:[]}};const Um=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,xl=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,Bm=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function zm(r){let e=r.getComplianceLevelSupportedFeatures();return e===void 0&&(e=Cr[ke.VERSION1].level0),{url:r.imageInfo["@id"]===void 0?void 0:r.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:e.supports,formats:[...e.formats,r.imageInfo.formats===void 0?[]:r.imageInfo.formats],qualities:[...e.qualities,r.imageInfo.qualities===void 0?[]:r.imageInfo.qualities],resolutions:r.imageInfo.scale_factors,tileSize:r.imageInfo.tile_width!==void 0?r.imageInfo.tile_height!==void 0?[r.imageInfo.tile_width,r.imageInfo.tile_height]:[r.imageInfo.tile_width,r.imageInfo.tile_width]:r.imageInfo.tile_height!=null?[r.imageInfo.tile_height,r.imageInfo.tile_height]:void 0}}function km(r){const e=r.getComplianceLevelSupportedFeatures(),t=Array.isArray(r.imageInfo.profile)&&r.imageInfo.profile.length>1,i=t&&r.imageInfo.profile[1].supports?r.imageInfo.profile[1].supports:[],n=t&&r.imageInfo.profile[1].formats?r.imageInfo.profile[1].formats:[],s=t&&r.imageInfo.profile[1].qualities?r.imageInfo.profile[1].qualities:[];return{url:r.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:r.imageInfo.sizes===void 0?void 0:r.imageInfo.sizes.map(function(a){return[a.width,a.height]}),tileSize:r.imageInfo.tiles===void 0?void 0:[r.imageInfo.tiles.map(function(a){return a.width})[0],r.imageInfo.tiles.map(function(a){return a.height===void 0?a.width:a.height})[0]],resolutions:r.imageInfo.tiles===void 0?void 0:r.imageInfo.tiles.map(function(a){return a.scaleFactors})[0],supports:[...e.supports,...i],formats:[...e.formats,...n],qualities:[...e.qualities,...s]}}function $m(r){const e=r.getComplianceLevelSupportedFeatures(),t=r.imageInfo.extraFormats===void 0?e.formats:[...e.formats,...r.imageInfo.extraFormats],i=r.imageInfo.preferredFormats!==void 0&&Array.isArray(r.imageInfo.preferredFormats)&&r.imageInfo.preferredFormats.length>0?r.imageInfo.preferredFormats.filter(function(n){return["jpg","png","gif"].includes(n)}).reduce(function(n,s){return n===void 0&&t.includes(s)?s:n},void 0):void 0;return{url:r.imageInfo.id,sizes:r.imageInfo.sizes===void 0?void 0:r.imageInfo.sizes.map(function(n){return[n.width,n.height]}),tileSize:r.imageInfo.tiles===void 0?void 0:[r.imageInfo.tiles.map(function(n){return n.width})[0],r.imageInfo.tiles.map(function(n){return n.height})[0]],resolutions:r.imageInfo.tiles===void 0?void 0:r.imageInfo.tiles.map(function(n){return n.scaleFactors})[0],supports:r.imageInfo.extraFeatures===void 0?e.supports:[...e.supports,...r.imageInfo.extraFeatures],formats:t,qualities:r.imageInfo.extraQualities===void 0?e.qualities:[...e.qualities,...r.imageInfo.extraQualities],preferredFormat:i}}const gs={};gs[ke.VERSION1]=zm;gs[ke.VERSION2]=km;gs[ke.VERSION3]=$m;class jm{constructor(e){this.setImageInfo(e)}setImageInfo(e){typeof e=="string"?this.imageInfo=JSON.parse(e):this.imageInfo=e}getImageApiVersion(){if(this.imageInfo===void 0)return;let e=this.imageInfo["@context"]||"ol-no-context";typeof e=="string"&&(e=[e]);for(let t=0;t<e.length;t++)switch(e[t]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return ke.VERSION1;case"http://iiif.io/api/image/2/context.json":return ke.VERSION2;case"http://iiif.io/api/image/3/context.json":return ke.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(ke.VERSION1)&&this.imageInfo.identifier)return ke.VERSION1;break}Yt(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(e){if(!(this.imageInfo===void 0||this.imageInfo.profile===void 0))switch(e===void 0&&(e=this.getImageApiVersion()),e){case ke.VERSION1:if(Um.test(this.imageInfo.profile))return this.imageInfo.profile;break;case ke.VERSION3:if(Bm.test(this.imageInfo.profile))return this.imageInfo.profile;break;case ke.VERSION2:if(typeof this.imageInfo.profile=="string"&&xl.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&typeof this.imageInfo.profile[0]=="string"&&xl.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0];break}}getComplianceLevelFromProfile(e){const t=this.getComplianceLevelEntryFromProfile(e);if(t===void 0)return;const i=t.match(/level[0-2](?:\.json)?$/g);return Array.isArray(i)?i[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(this.imageInfo===void 0)return;const e=this.getImageApiVersion(),t=this.getComplianceLevelFromProfile(e);return t===void 0?Cr.none.none:Cr[e][t]}getTileSourceOptions(e){const t=e||{},i=this.getImageApiVersion();if(i===void 0)return;const n=i===void 0?void 0:gs[i](this);if(n!==void 0)return{url:n.url,version:i,size:[this.imageInfo.width,this.imageInfo.height],sizes:n.sizes,format:t.format!==void 0&&n.formats.includes(t.format)?t.format:n.preferredFormat!==void 0?n.preferredFormat:"jpg",supports:n.supports,quality:t.quality&&n.qualities.includes(t.quality)?t.quality:n.qualities.includes("native")?"native":"default",resolutions:Array.isArray(n.resolutions)?n.resolutions.sort(function(s,a){return a-s}):void 0,tileSize:n.tileSize}}}const Zm=jm,lr=["http://www.google.com/kml/ext/2.2"],V=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],qm="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",vl={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},Xm=N(V,{ExtendedData:Gu,Region:Uu,MultiGeometry:T(Nu,"geometry"),LineString:T(Cu,"geometry"),LinearRing:T(Ou,"geometry"),Point:T(Fu,"geometry"),Polygon:T(Du,"geometry"),Style:T(oo),StyleMap:Ap,address:T(U),description:T(U),name:T(U),open:T(yr),phoneNumber:T(U),styleUrl:T(bu),visibility:T(yr)},N(lr,{MultiTrack:T(pp,"geometry"),Track:T(Lu,"geometry")})),Hm=N(V,{ExtendedData:Gu,Region:Uu,Link:kp,address:T(U),description:T(U),name:T(U),open:T(yr),phoneNumber:T(U),visibility:T(yr)}),Wm=N(V,{href:T(Ru)}),Vm=N(V,{Altitude:T(ce),Longitude:T(ce),Latitude:T(ce),Tilt:T(ce),AltitudeMode:T(U),Heading:T(ce),Roll:T(ce)}),Su=N(V,{LatLonAltBox:Np,Lod:Dp}),Ym=N(V,["Document","Placemark"]),Km=N(V,{Document:M(Vp),Placemark:M(ku)});let ii,Pn=null,ca,$i,ji,Zi,qn,fa=null,so,da=null,ga,Rr=null,El=null,ma=null;function Xn(r){return 32/Math.min(r[0],r[1])}function Qm(){ii=[255,255,255,1],Pn=new li({color:ii}),ca=[20,2],$i="pixels",ji="pixels",Zi=[64,64],qn="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",fa=new Hh({anchor:ca,anchorOrigin:"bottom-left",anchorXUnits:$i,anchorYUnits:ji,crossOrigin:"anonymous",rotation:0,scale:Xn(Zi),size:Zi,src:qn}),so="NO_IMAGE",da=new mr({color:ii,width:1}),ga=new mr({color:[51,51,51,1],width:2}),Rr=new Dn({font:"bold 16px Helvetica",fill:Pn,stroke:ga,scale:.8}),El=new Ft({fill:Pn,image:fa,text:Rr,stroke:da,zIndex:0}),ma=[El]}let _n;function Jm(r){return r}class ep extends an{constructor(e){super(),e=e||{},ma||Qm(),this.dataProjection=de("EPSG:4326"),this.defaultStyle_=e.defaultStyle?e.defaultStyle:ma,this.extractStyles_=e.extractStyles!==void 0?e.extractStyles:!0,this.writeStyles_=e.writeStyles!==void 0?e.writeStyles:!0,this.sharedStyles_={},this.showPointNames_=e.showPointNames!==void 0?e.showPointNames:!0,this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",this.iconUrlFunction_=e.iconUrlFunction?e.iconUrlFunction:Jm,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(e,t){const i=N(V,{Document:jn(this.readDocumentOrFolder_,this),Folder:jn(this.readDocumentOrFolder_,this),Placemark:X(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),n=D([],i,e,t,this);if(n)return n}readPlacemark_(e,t){const i=D({geometry:null},Xm,e,t,this);if(!i)return;const n=new it,s=e.getAttribute("id");s!==null&&n.setId(s);const a=t[0],o=i.geometry;if(o&&ze(o,!1,a),n.setGeometry(o),delete i.geometry,this.extractStyles_){const l=i.Style,h=i.styleUrl,c=rp(l,h,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);n.setStyle(c)}return delete i.Style,n.setProperties(i,!0),n}readSharedStyle_(e,t){const i=e.getAttribute("id");if(i!==null){const n=oo.call(this,e,t);if(n){let s,a=e.baseURI;(!a||a=="about:blank")&&(a=window.location.href),a?s=new URL("#"+i,a).href:s="#"+i,this.sharedStyles_[s]=n}}}readSharedStyleMap_(e,t){const i=e.getAttribute("id");if(i===null)return;const n=Au.call(this,e,t);if(!n)return;let s,a=e.baseURI;(!a||a=="about:blank")&&(a=window.location.href),a?s=new URL("#"+i,a).href:s="#"+i,this.sharedStyles_[s]=n}readFeatureFromNode(e,t){if(!V.includes(e.namespaceURI))return null;const i=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return i||null}readFeaturesFromNode(e,t){if(!V.includes(e.namespaceURI))return[];let i;const n=e.localName;if(n=="Document"||n=="Folder")return i=this.readDocumentOrFolder_(e,[this.getReadOptions(e,t)]),i||[];if(n=="Placemark"){const s=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return s?[s]:[]}if(n=="kml"){i=[];for(let s=e.firstElementChild;s;s=s.nextElementSibling){const a=this.readFeaturesFromNode(s,t);a&&Le(i,a)}return i}return[]}readName(e){if(e){if(typeof e=="string"){const t=Nt(e);return this.readNameFromDocument(t)}return Ot(e)?this.readNameFromDocument(e):this.readNameFromNode(e)}}readNameFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE){const i=this.readNameFromNode(t);if(i)return i}}readNameFromNode(e){for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(V.includes(t.namespaceURI)&&t.localName=="name")return U(t);for(let t=e.firstElementChild;t;t=t.nextElementSibling){const i=t.localName;if(V.includes(t.namespaceURI)&&(i=="Document"||i=="Folder"||i=="Placemark"||i=="kml")){const n=this.readNameFromNode(t);if(n)return n}}}readNetworkLinks(e){const t=[];if(typeof e=="string"){const i=Nt(e);Le(t,this.readNetworkLinksFromDocument(i))}else Ot(e)?Le(t,this.readNetworkLinksFromDocument(e)):Le(t,this.readNetworkLinksFromNode(e));return t}readNetworkLinksFromDocument(e){const t=[];for(let i=e.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&Le(t,this.readNetworkLinksFromNode(i));return t}readNetworkLinksFromNode(e){const t=[];for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(V.includes(i.namespaceURI)&&i.localName=="NetworkLink"){const n=D({},Hm,i,[]);t.push(n)}for(let i=e.firstElementChild;i;i=i.nextElementSibling){const n=i.localName;V.includes(i.namespaceURI)&&(n=="Document"||n=="Folder"||n=="kml")&&Le(t,this.readNetworkLinksFromNode(i))}return t}readRegion(e){const t=[];if(typeof e=="string"){const i=Nt(e);Le(t,this.readRegionFromDocument(i))}else Ot(e)?Le(t,this.readRegionFromDocument(e)):Le(t,this.readRegionFromNode(e));return t}readRegionFromDocument(e){const t=[];for(let i=e.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&Le(t,this.readRegionFromNode(i));return t}readRegionFromNode(e){const t=[];for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(V.includes(i.namespaceURI)&&i.localName=="Region"){const n=D({},Su,i,[]);t.push(n)}for(let i=e.firstElementChild;i;i=i.nextElementSibling){const n=i.localName;V.includes(i.namespaceURI)&&(n=="Document"||n=="Folder"||n=="kml")&&Le(t,this.readRegionFromNode(i))}return t}readCamera(e){const t=[];if(typeof e=="string"){const i=Nt(e);Le(t,this.readCameraFromDocument(i))}else Ot(e)?Le(t,this.readCameraFromDocument(e)):Le(t,this.readCameraFromNode(e));return t}readCameraFromDocument(e){const t=[];for(let i=e.firstChild;i;i=i.nextSibling)i.nodeType===Node.ELEMENT_NODE&&Le(t,this.readCameraFromNode(i));return t}readCameraFromNode(e){const t=[];for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(V.includes(i.namespaceURI)&&i.localName==="Camera"){const n=D({},Vm,i,[]);t.push(n)}for(let i=e.firstElementChild;i;i=i.nextElementSibling){const n=i.localName;V.includes(i.namespaceURI)&&(n==="Document"||n==="Folder"||n==="Placemark"||n==="kml")&&Le(t,this.readCameraFromNode(i))}return t}writeFeaturesNode(e,t){t=this.adaptOptions(t);const i=ne(V[4],"kml"),n="http://www.w3.org/2000/xmlns/";i.setAttributeNS(n,"xmlns:gx",lr[0]),i.setAttributeNS(n,"xmlns:xsi",Lr),i.setAttributeNS(Lr,"xsi:schemaLocation",qm);const s={node:i},a={};e.length>1?a.Document=e:e.length==1&&(a.Placemark=e[0]);const o=Ym[i.namespaceURI],l=dt(a,o);return re(s,Km,Xe,l,[t],o,this),i}}function tp(r,e){const t=[0,0];let i="start";const n=r.getImage();if(n){const o=n.getSize();if(o&&o.length==2){const l=n.getScaleArray(),h=n.getAnchor();t[0]=l[0]*(o[0]-h[0]),t[1]=l[1]*(o[1]/2-h[1]),i="left"}}let s=r.getText();return s?(s=s.clone(),s.setFont(s.getFont()||Rr.getFont()),s.setScale(s.getScale()||Rr.getScale()),s.setFill(s.getFill()||Rr.getFill()),s.setStroke(s.getStroke()||ga)):s=Rr.clone(),s.setText(e),s.setOffsetX(t[0]),s.setOffsetY(t[1]),s.setTextAlign(i),new Ft({image:n,text:s})}function rp(r,e,t,i,n){return function(s,a){let o=n,l="",h=[];if(o){const u=s.getGeometry();if(u)if(u instanceof rt)h=u.getGeometriesArrayRecursive().filter(function(d){const m=d.getType();return m==="Point"||m==="MultiPoint"}),o=h.length>0;else{const d=u.getType();o=d==="Point"||d==="MultiPoint"}}o&&(l=s.get("name"),o=o&&!!l,o&&/&[^&]+;/.test(l)&&(_n||(_n=document.createElement("textarea")),_n.innerHTML=l,l=_n.value));let c=t;if(r?c=r:e&&(c=Tu(e,t,i)),o){const u=tp(c[0],l);if(h.length>0){u.setGeometry(new rt(h));const d=new Ft({geometry:c[0].getGeometry(),image:null,fill:c[0].getFill(),stroke:c[0].getStroke(),text:null});return[u,d].concat(c.slice(1))}return u}return c}}function Tu(r,e,t){return Array.isArray(r)?r:typeof r=="string"?Tu(t[r],e,t):e}function ms(r){const e=nt(r,!1),t=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(e);if(t){const i=t[1];return[parseInt(i.substr(6,2),16),parseInt(i.substr(4,2),16),parseInt(i.substr(2,2),16),parseInt(i.substr(0,2),16)/255]}}function Mu(r){let e=nt(r,!1);const t=[];e=e.replace(/\s*,\s*/g,",");const i=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;let n;for(;n=i.exec(e);){const s=parseFloat(n[1]),a=parseFloat(n[2]),o=n[3]?parseFloat(n[3]):0;t.push(s,a,o),e=e.substr(n[0].length)}if(e==="")return t}function Ru(r){const e=nt(r,!1).trim();let t=r.baseURI;return(!t||t=="about:blank")&&(t=window.location.href),t?new URL(e,t).href:e}function bu(r){const e=nt(r,!1).trim().replace(/^(?!.*#)/,"#");let t=r.baseURI;return(!t||t=="about:blank")&&(t=window.location.href),t?new URL(e,t).href:e}function ip(r){const e=r.getAttribute("xunits"),t=r.getAttribute("yunits");let i;return e!=="insetPixels"?t!=="insetPixels"?i="bottom-left":i="top-left":t!=="insetPixels"?i="bottom-right":i="top-right",{x:parseFloat(r.getAttribute("x")),xunits:vl[e],y:parseFloat(r.getAttribute("y")),yunits:vl[t],origin:i}}function Pu(r){return ce(r)}const np=N(V,{Pair:Pp});function Au(r,e){return D(void 0,np,r,e,this)}const sp=N(V,{Icon:T(xp),color:T(ms),heading:T(ce),hotSpot:T(ip),scale:T(Pu)});function ap(r,e){const t=D({},sp,r,e);if(!t)return;const i=e[e.length-1],n="Icon"in t?t.Icon:{},s=!("Icon"in t)||Object.keys(n).length>0;let a;const o=n.href;o?a=o:s&&(a=qn);let l,h,c,u="bottom-left";const d=t.hotSpot;d?(l=[d.x,d.y],h=d.xunits,c=d.yunits,u=d.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(a)&&(a.includes("pushpin")?(l=ca,h=$i,c=ji):a.includes("arrow-reverse")?(l=[54,42],h=$i,c=ji):a.includes("paddle")&&(l=[32,1],h=$i,c=ji));let m;const g=n.x,y=n.y;g!==void 0&&y!==void 0&&(m=[g,y]);let _;const v=n.w,E=n.h;v!==void 0&&E!==void 0&&(_=[v,E]);let S;const w=t.heading;w!==void 0&&(S=pd(w));const P=t.scale,A=t.color;if(s){a==qn&&(_=Zi);const I=new Hh({anchor:l,anchorOrigin:u,anchorXUnits:h,anchorYUnits:c,crossOrigin:this.crossOrigin_,offset:m,offsetOrigin:"bottom-left",rotation:S,scale:P,size:_,src:this.iconUrlFunction_(a),color:A}),C=I.getScaleArray()[0],k=I.getSize();if(k===null){const B=I.getImageState();if(B===Mt.IDLE||B===Mt.LOADING){const H=function(){const Y=I.getImageState();if(!(Y===Mt.IDLE||Y===Mt.LOADING)){const f=I.getSize();if(f&&f.length==2){const p=Xn(f);I.setScale(C*p)}I.unlistenImageChange(H)}};I.listenImageChange(H),B===Mt.IDLE&&I.load()}}else if(k.length==2){const B=Xn(k);I.setScale(C*B)}i.imageStyle=I}else i.imageStyle=so}const op=N(V,{color:T(ms),scale:T(Pu)});function lp(r,e){const t=D({},op,r,e);if(!t)return;const i=e[e.length-1],n=new Dn({fill:new li({color:"color"in t?t.color:ii}),scale:t.scale});i.textStyle=n}const hp=N(V,{color:T(ms),width:T(ce)});function up(r,e){const t=D({},hp,r,e);if(!t)return;const i=e[e.length-1],n=new mr({color:"color"in t?t.color:ii,width:"width"in t?t.width:1});i.strokeStyle=n}const cp=N(V,{color:T(ms),fill:T(yr),outline:T(yr)});function fp(r,e){const t=D({},cp,r,e);if(!t)return;const i=e[e.length-1],n=new li({color:"color"in t?t.color:ii});i.fillStyle=n;const s=t.fill;s!==void 0&&(i.fill=s);const a=t.outline;a!==void 0&&(i.outline=a)}const dp=N(V,{coordinates:Q(Mu)});function Iu(r,e){return D(null,dp,r,e)}function gp(r,e){const i=e[e.length-1].coordinates,n=nt(r,!1),a=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(n);if(a){const o=parseFloat(a[1]),l=parseFloat(a[2]),h=parseFloat(a[3]);i.push([o,l,h])}else i.push([])}const mp=N(lr,{Track:X(Lu)});function pp(r,e){const t=D([],mp,r,e);if(t)return new or(t)}const yp=N(V,{when:$p},N(lr,{coord:gp}));function Lu(r,e){const t=D({coordinates:[],whens:[]},yp,r,e);if(!t)return;const i=[],n=t.coordinates,s=t.whens;for(let a=0,o=Math.min(n.length,s.length);a<o;++a)n[a].length==3&&i.push(n[a][0],n[a][1],n[a][2],s[a]);return new Et(i,"XYZM")}const _p=N(V,{href:T(Ru)},N(lr,{x:T(ce),y:T(ce),w:T(ce),h:T(ce)}));function xp(r,e){const t=D({},_p,r,e);return t||null}const vp=N(V,{coordinates:Q(Mu)});function ao(r,e){return D(null,vp,r,e)}const ps=N(V,{extrude:T(yr),tessellate:T(yr),altitudeMode:T(U)});function Cu(r,e){const t=D({},ps,r,e),i=ao(r,e);if(i){const n=new Et(i,"XYZ");return n.setProperties(t,!0),n}}function Ou(r,e){const t=D({},ps,r,e),i=ao(r,e);if(i){const n=new vr(i,"XYZ",[i.length]);return n.setProperties(t,!0),n}}const Ep=N(V,{LineString:X(Cu),LinearRing:X(Ou),MultiGeometry:X(Nu),Point:X(Fu),Polygon:X(Du)});function Nu(r,e){const t=D([],Ep,r,e);if(!t)return null;if(t.length===0)return new rt(t);let i,n=!0;const s=t[0].getType();let a;for(let o=1,l=t.length;o<l;++o)if(a=t[o],a.getType()!=s){n=!1;break}if(n){let o,l;if(s=="Point"){const h=t[0];o=h.getLayout(),l=h.getFlatCoordinates();for(let c=1,u=t.length;c<u;++c)a=t[c],Le(l,a.getFlatCoordinates());i=new yi(l,o),Gs(i,t)}else if(s=="LineString")i=new or(t),Gs(i,t);else if(s=="Polygon")i=new Dr(t),Gs(i,t);else if(s=="GeometryCollection")i=new rt(t);else throw new Error("Unknown geometry type found")}else i=new rt(t);return i}function Fu(r,e){const t=D({},ps,r,e),i=ao(r,e);if(i){const n=new _t(i,"XYZ");return n.setProperties(t,!0),n}}const wp=N(V,{innerBoundaryIs:Up,outerBoundaryIs:zp});function Du(r,e){const t=D({},ps,r,e),i=D([null],wp,r,e);if(i&&i[0]){const n=i[0],s=[n.length];for(let o=1,l=i.length;o<l;++o)Le(n,i[o]),s.push(n.length);const a=new vr(n,"XYZ",s);return a.setProperties(t,!0),a}}const Sp=N(V,{IconStyle:ap,LabelStyle:lp,LineStyle:up,PolyStyle:fp});function oo(r,e){const t=D({},Sp,r,e,this);if(!t)return null;let i="fillStyle"in t?t.fillStyle:Pn;const n=t.fill;n!==void 0&&!n&&(i=null);let s;"imageStyle"in t?t.imageStyle!=so&&(s=t.imageStyle):s=fa;const a="textStyle"in t?t.textStyle:Rr,o="strokeStyle"in t?t.strokeStyle:da,l=t.outline;return l!==void 0&&!l?[new Ft({geometry:function(h){const c=h.getGeometry(),u=c.getType();if(u==="GeometryCollection"){const d=c;return new rt(d.getGeometriesArrayRecursive().filter(function(m){const g=m.getType();return g!=="Polygon"&&g!=="MultiPolygon"}))}if(u!=="Polygon"&&u!=="MultiPolygon")return c},fill:i,image:s,stroke:o,text:a,zIndex:void 0}),new Ft({geometry:function(h){const c=h.getGeometry(),u=c.getType();if(u==="GeometryCollection"){const d=c;return new rt(d.getGeometriesArrayRecursive().filter(function(m){const g=m.getType();return g==="Polygon"||g==="MultiPolygon"}))}if(u==="Polygon"||u==="MultiPolygon")return c},fill:i,stroke:null,zIndex:void 0})]:[new Ft({fill:i,image:s,stroke:o,text:a,zIndex:void 0})]}function Gs(r,e){const t=e.length,i=new Array(e.length),n=new Array(e.length),s=new Array(e.length);let a,o,l;a=!1,o=!1,l=!1;for(let h=0;h<t;++h){const c=e[h];i[h]=c.get("extrude"),n[h]=c.get("tessellate"),s[h]=c.get("altitudeMode"),a=a||i[h]!==void 0,o=o||n[h]!==void 0,l=l||s[h]}a&&r.set("extrude",i),o&&r.set("tessellate",n),l&&r.set("altitudeMode",s)}const Tp=N(V,{displayName:T(U),value:T(U)});function Mp(r,e){const t=r.getAttribute("name");ft(Tp,r,e);const i=e[e.length-1];t&&i.displayName?i[t]={value:i.value,displayName:i.displayName,toString:function(){return i.value}}:t!==null?i[t]=i.value:i.displayName!==null&&(i[i.displayName]=i.value),delete i.value}const Rp=N(V,{Data:Mp,SchemaData:Lp});function Gu(r,e){ft(Rp,r,e)}function Uu(r,e){ft(Su,r,e)}const bp=N(V,{Style:T(oo),key:T(U),styleUrl:T(bu)});function Pp(r,e){const t=D({},bp,r,e,this);if(!t)return;const i=t.key;if(i&&i=="normal"){const n=t.styleUrl;n&&(e[e.length-1]=n);const s=t.Style;s&&(e[e.length-1]=s)}}function Ap(r,e){const t=Au.call(this,r,e);if(!t)return;const i=e[e.length-1];if(Array.isArray(t))i.Style=t;else if(typeof t=="string")i.styleUrl=t;else throw new Error("`styleMapValue` has an unknown type")}const Ip=N(V,{SimpleData:Cp});function Lp(r,e){ft(Ip,r,e)}function Cp(r,e){const t=r.getAttribute("name");if(t!==null){const i=U(r),n=e[e.length-1];n[t]=i}}const Op=N(V,{altitudeMode:T(U),minAltitude:T(ce),maxAltitude:T(ce),north:T(ce),south:T(ce),east:T(ce),west:T(ce)});function Np(r,e){const t=D({},Op,r,e);if(!t)return;const i=e[e.length-1],n=[parseFloat(t.west),parseFloat(t.south),parseFloat(t.east),parseFloat(t.north)];i.extent=n,i.altitudeMode=t.altitudeMode,i.minAltitude=parseFloat(t.minAltitude),i.maxAltitude=parseFloat(t.maxAltitude)}const Fp=N(V,{minLodPixels:T(ce),maxLodPixels:T(ce),minFadeExtent:T(ce),maxFadeExtent:T(ce)});function Dp(r,e){const t=D({},Fp,r,e);if(!t)return;const i=e[e.length-1];i.minLodPixels=parseFloat(t.minLodPixels),i.maxLodPixels=parseFloat(t.maxLodPixels),i.minFadeExtent=parseFloat(t.minFadeExtent),i.maxFadeExtent=parseFloat(t.maxFadeExtent)}const Gp=N(V,{LinearRing:X(Iu)});function Up(r,e){const t=D([],Gp,r,e);t.length>0&&e[e.length-1].push(...t)}const Bp=N(V,{LinearRing:Q(Iu)});function zp(r,e){const t=D(void 0,Bp,r,e);if(t){const i=e[e.length-1];i[0]=t}}function kp(r,e){ft(Wm,r,e)}function $p(r,e){const i=e[e.length-1].whens,n=nt(r,!1),s=Date.parse(n);i.push(isNaN(s)?0:s)}function ys(r,e){const t=hi(e),n=[(t.length==4?t[3]:1)*255,t[2],t[1],t[0]];for(let s=0;s<4;++s){const a=Math.floor(n[s]).toString(16);n[s]=a.length==1?"0"+a:a}ee(r,n.join(""))}function jp(r,e,t){const i=t[t.length-1],n=i.layout,s=i.stride;let a;if(n=="XY"||n=="XYM")a=2;else if(n=="XYZ"||n=="XYZM")a=3;else throw new Error("Invalid geometry layout");const o=e.length;let l="";if(o>0){l+=e[0];for(let h=1;h<a;++h)l+=","+e[h];for(let h=s;h<o;h+=s){l+=" "+e[h];for(let c=1;c<a;++c)l+=","+e[h+c]}}ee(r,l)}const An=N(V,{Data:M(Zp),value:M(Xp),displayName:M(qp)});function Zp(r,e,t){r.setAttribute("name",e.name);const i={node:r},n=e.value;typeof n=="object"?(n!==null&&n.displayName&&re(i,An,Xe,[n.displayName],t,["displayName"]),n!==null&&n.value&&re(i,An,Xe,[n.value],t,["value"])):re(i,An,Xe,[n],t,["value"])}function qp(r,e){qg(r,e)}function Xp(r,e){ee(r,e)}const Hp=N(V,{Placemark:M(ku)}),Wp=function(r,e,t){const i=e[e.length-1].node;return ne(i.namespaceURI,"Placemark")};function Vp(r,e,t){re({node:r},Hp,Wp,e,t,void 0,this)}const Yp=Ne("Data");function Kp(r,e,t){const i={node:r},n=e.names,s=e.values,a=n.length;for(let o=0;o<a;o++)re(i,An,Yp,[{name:n[o],value:s[o]}],t)}const wl=N(V,["href"],N(lr,["x","y","w","h"])),Sl=N(V,{href:M(ee)},N(lr,{x:M(ht),y:M(ht),w:M(ht),h:M(ht)})),Qp=function(r,e,t){return ne(lr[0],"gx:"+t)};function Jp(r,e,t){const i={node:r},n=t[t.length-1].node;let s=wl[n.namespaceURI],a=dt(e,s);re(i,Sl,Xe,a,t,s),s=wl[lr[0]],a=dt(e,s),re(i,Sl,Qp,a,t,s)}const e0=N(V,["scale","heading","Icon","color","hotSpot"]),t0=N(V,{Icon:M(Jp),color:M(ys),heading:M(ht),hotSpot:M(P0),scale:M(ju)});function r0(r,e,t){const i={node:r},n={},s=e.getSrc(),a=e.getSize(),o=e.getImageSize(),l={href:s};if(a){l.w=a[0],l.h=a[1];const _=e.getAnchor(),v=e.getOrigin();if(v&&o&&v[0]!==0&&v[1]!==a[1]&&(l.x=v[0],l.y=o[1]-(v[1]+a[1])),_&&(_[0]!==a[0]/2||_[1]!==a[1]/2)){const E={x:_[0],xunits:"pixels",y:a[1]-_[1],yunits:"pixels"};n.hotSpot=E}}n.Icon=l;let h=e.getScaleArray()[0],c=a;if(c===null&&(c=Zi),c.length==2){const _=Xn(c);h=h/_}h!==1&&(n.scale=h);const u=e.getRotation();u!==0&&(n.heading=u);const d=e.getColor();d&&(n.color=d);const m=t[t.length-1].node,g=e0[m.namespaceURI],y=dt(n,g);re(i,t0,Xe,y,t,g)}const i0=N(V,["color","scale"]),n0=N(V,{color:M(ys),scale:M(ju)});function s0(r,e,t){const i={node:r},n={},s=e.getFill();s&&(n.color=s.getColor());const a=e.getScale();a&&a!==1&&(n.scale=a);const o=t[t.length-1].node,l=i0[o.namespaceURI],h=dt(n,l);re(i,n0,Xe,h,t,l)}const a0=N(V,["color","width"]),o0=N(V,{color:M(ys),width:M(ht)});function l0(r,e,t){const i={node:r},n={color:e.getColor(),width:Number(e.getWidth())||1},s=t[t.length-1].node,a=a0[s.namespaceURI],o=dt(n,a);re(i,o0,Xe,o,t,a)}const h0={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},Bu=function(r,e,t){if(r){const i=e[e.length-1].node;return ne(i.namespaceURI,h0[r.getType()])}},u0=Ne("Point"),c0=Ne("LineString"),f0=Ne("LinearRing"),d0=Ne("Polygon"),g0=N(V,{LineString:M(ni),Point:M(ni),Polygon:M($u),GeometryCollection:M(zu)});function zu(r,e,t){const i={node:r},n=e.getType();let s=[],a;if(n==="GeometryCollection")e.getGeometriesArrayRecursive().forEach(function(o){const l=o.getType();if(l==="MultiPoint")s=s.concat(o.getPoints());else if(l==="MultiLineString")s=s.concat(o.getLineStrings());else if(l==="MultiPolygon")s=s.concat(o.getPolygons());else if(l==="Point"||l==="LineString"||l==="Polygon")s.push(o);else throw new Error("Unknown geometry type")}),a=Bu;else if(n==="MultiPoint")s=e.getPoints(),a=u0;else if(n==="MultiLineString")s=e.getLineStrings(),a=c0;else if(n==="MultiPolygon")s=e.getPolygons(),a=d0;else throw new Error("Unknown geometry type");re(i,g0,a,s,t)}const m0=N(V,{LinearRing:M(ni)});function Tl(r,e,t){re({node:r},m0,f0,[e],t)}const Us=N(V,{ExtendedData:M(Kp),MultiGeometry:M(zu),LineString:M(ni),LinearRing:M(ni),Point:M(ni),Polygon:M($u),Style:M(b0),address:M(ee),description:M(ee),name:M(ee),open:M(di),phoneNumber:M(ee),styleUrl:M(ee),visibility:M(di)}),p0=N(V,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),y0=Ne("ExtendedData");function ku(r,e,t){const i={node:r};e.getId()&&r.setAttribute("id",e.getId());const n=e.getProperties(),s={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};s[e.getGeometryName()]=1;const a=Object.keys(n||{}).sort().filter(function(m){return!s[m]}),o=e.getStyleFunction();if(o){const m=o(e,0);if(m){const g=Array.isArray(m)?m:[m];let y=g;if(e.getGeometry()&&(y=g.filter(function(_){const v=_.getGeometryFunction()(e);if(v){const E=v.getType();return E==="GeometryCollection"?v.getGeometriesArrayRecursive().filter(function(S){const w=S.getType();return w==="Point"||w==="MultiPoint"}).length:E==="Point"||E==="MultiPoint"}})),this.writeStyles_){let _=g,v=g;e.getGeometry()&&(_=g.filter(function(E){const S=E.getGeometryFunction()(e);if(S){const w=S.getType();return w==="GeometryCollection"?S.getGeometriesArrayRecursive().filter(function(P){const A=P.getType();return A==="LineString"||A==="MultiLineString"}).length:w==="LineString"||w==="MultiLineString"}}),v=g.filter(function(E){const S=E.getGeometryFunction()(e);if(S){const w=S.getType();return w==="GeometryCollection"?S.getGeometriesArrayRecursive().filter(function(P){const A=P.getType();return A==="Polygon"||A==="MultiPolygon"}).length:w==="Polygon"||w==="MultiPolygon"}})),n.Style={pointStyles:y,lineStyles:_,polyStyles:v}}if(y.length&&n.name===void 0){const _=y[0].getText();_&&(n.name=_.getText())}}}const l=t[t.length-1].node,h=p0[l.namespaceURI],c=dt(n,h);if(re(i,Us,Xe,c,t,h),a.length>0){const m=dt(n,a);re(i,Us,y0,[{names:a,values:m}],t)}const u=t[0];let d=e.getGeometry();d&&(d=ze(d,!0,u)),re(i,Us,Bu,[d],t)}const _0=N(V,["extrude","tessellate","altitudeMode","coordinates"]),x0=N(V,{extrude:M(di),tessellate:M(di),altitudeMode:M(ee),coordinates:M(jp)});function ni(r,e,t){const i=e.getFlatCoordinates(),n={node:r};n.layout=e.getLayout(),n.stride=e.getStride();const s=e.getProperties();s.coordinates=i;const a=t[t.length-1].node,o=_0[a.namespaceURI],l=dt(s,o);re(n,x0,Xe,l,t,o)}const v0=N(V,["color","fill","outline"]),Ml=N(V,{outerBoundaryIs:M(Tl),innerBoundaryIs:M(Tl)}),E0=Ne("innerBoundaryIs"),w0=Ne("outerBoundaryIs");function $u(r,e,t){const i=e.getLinearRings(),n=i.shift(),s={node:r};re(s,Ml,E0,i,t),re(s,Ml,w0,[n],t)}const S0=N(V,{color:M(ys),fill:M(di),outline:M(di)});function T0(r,e,t){const i={node:r},n=e.getFill(),s=e.getStroke(),a={color:n?n.getColor():void 0,fill:n?void 0:!1,outline:s?void 0:!1},o=t[t.length-1].node,l=v0[o.namespaceURI],h=dt(a,l);re(i,S0,Xe,h,t,l)}function ju(r,e){ht(r,Math.round(e*1e6)/1e6)}const M0=N(V,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),R0=N(V,{IconStyle:M(r0),LabelStyle:M(s0),LineStyle:M(l0),PolyStyle:M(T0)});function b0(r,e,t){const i={node:r},n={};if(e.pointStyles.length){const l=e.pointStyles[0].getText();l&&(n.LabelStyle=l);const h=e.pointStyles[0].getImage();h&&typeof h.getSrc=="function"&&(n.IconStyle=h)}if(e.lineStyles.length){const l=e.lineStyles[0].getStroke();l&&(n.LineStyle=l)}if(e.polyStyles.length){const l=e.polyStyles[0].getStroke();l&&!n.LineStyle&&(n.LineStyle=l),n.PolyStyle=e.polyStyles[0]}const s=t[t.length-1].node,a=M0[s.namespaceURI],o=dt(n,a);re(i,R0,Xe,o,t,a)}function P0(r,e){r.setAttribute("x",String(e.x)),r.setAttribute("y",String(e.y)),r.setAttribute("xunits",e.xunits),r.setAttribute("yunits",e.yunits)}const A0=ep;class I0{read(e){if(!e)return null;if(typeof e=="string"){const t=Nt(e);return this.readFromDocument(t)}return Ot(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){$t()}}const lo=I0,L0="http://www.w3.org/1999/xlink";function wi(r){return r.getAttributeNS(L0,"href")}const gt=[null,"http://www.opengis.net/ows/1.1"],C0=N(gt,{ServiceIdentification:T(iy),ServiceProvider:T(sy),OperationsMetadata:T(ty)});class O0 extends lo{constructor(){super()}readFromNode(e){const t=D({},C0,e,[]);return t||null}}const N0=N(gt,{DeliveryPoint:T(U),City:T(U),AdministrativeArea:T(U),PostalCode:T(U),Country:T(U),ElectronicMailAddress:T(U)}),F0=N(gt,{Value:Pe(ay)}),D0=N(gt,{AllowedValues:T(W0)}),G0=N(gt,{Phone:T(ry),Address:T(H0)}),U0=N(gt,{HTTP:T(J0)}),B0=N(gt,{Get:Pe(Q0),Post:void 0}),z0=N(gt,{DCP:T(K0)}),k0=N(gt,{Operation:ey}),$0=N(gt,{Voice:T(U),Facsimile:T(U)}),j0=N(gt,{Constraint:Pe(V0)}),Z0=N(gt,{IndividualName:T(U),PositionName:T(U),ContactInfo:T(Y0)}),q0=N(gt,{Abstract:T(U),AccessConstraints:T(U),Fees:T(U),Title:T(U),ServiceTypeVersion:T(U),ServiceType:T(U)}),X0=N(gt,{ProviderName:T(U),ProviderSite:T(wi),ServiceContact:T(ny)});function H0(r,e){return D({},N0,r,e)}function W0(r,e){return D({},F0,r,e)}function V0(r,e){const t=r.getAttribute("name");if(t)return D({name:t},D0,r,e)}function Y0(r,e){return D({},G0,r,e)}function K0(r,e){return D({},U0,r,e)}function Q0(r,e){const t=wi(r);if(t)return D({href:t},j0,r,e)}function J0(r,e){return D({},B0,r,e)}function ey(r,e){const t=r.getAttribute("name"),i=D({},z0,r,e);if(!i)return;const n=e[e.length-1];n[t]=i}function ty(r,e){return D({},k0,r,e)}function ry(r,e){return D({},$0,r,e)}function iy(r,e){return D({},q0,r,e)}function ny(r,e){return D({},Z0,r,e)}function sy(r,e){return D({},X0,r,e)}function ay(r,e){return U(r)}const Zu=O0;function Rl(r,e,t,i,n,s){n!==void 0?(n=n,s=s!==void 0?s:0):(n=[],s=0);let a=e;for(;a<t;){const o=r[a++];n[s++]=r[a++],n[s++]=o;for(let l=2;l<i;++l)n[s++]=r[a++]}return n.length=s,n}class oy extends no{constructor(e){super(),e=e||{},this.dataProjection=de("EPSG:4326"),this.factor_=e.factor?e.factor:1e5,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY"}readFeatureFromText(e,t){const i=this.readGeometryFromText(e,t);return new it(i)}readFeaturesFromText(e,t){return[this.readFeatureFromText(e,t)]}readGeometryFromText(e,t){const i=yd(this.geometryLayout_),n=hy(e,i,this.factor_);Rl(n,0,n.length,i,n);const s=_d(n,0,n.length,i),a=new Et(s,this.geometryLayout_);return ze(a,!1,this.adaptOptions(t))}writeFeatureText(e,t){const i=e.getGeometry();if(i)return this.writeGeometryText(i,t);throw new Error("Expected `feature` to have a geometry")}writeFeaturesText(e,t){return this.writeFeatureText(e[0],t)}writeGeometryText(e,t){e=ze(e,!0,this.adaptOptions(t));const i=e.getFlatCoordinates(),n=e.getStride();return Rl(i,0,i.length,n,i),ly(i,n,this.factor_)}}function ly(r,e,t){t=t||1e5;let i;const n=new Array(e);for(i=0;i<e;++i)n[i]=0;for(let s=0,a=r.length;s<a;)for(i=0;i<e;++i,++s){const o=r[s],l=o-n[i];n[i]=o,r[s]=l}return uy(r,t)}function hy(r,e,t){t=t||1e5;let i;const n=new Array(e);for(i=0;i<e;++i)n[i]=0;const s=cy(r,t);for(let a=0,o=s.length;a<o;)for(i=0;i<e;++i,++a)n[i]+=s[a],s[a]=n[i];return s}function uy(r,e){e=e||1e5;for(let t=0,i=r.length;t<i;++t)r[t]=Math.round(r[t]*e);return fy(r)}function cy(r,e){e=e||1e5;const t=dy(r);for(let i=0,n=t.length;i<n;++i)t[i]/=e;return t}function fy(r){for(let e=0,t=r.length;e<t;++e){const i=r[e];r[e]=i<0?~(i<<1):i<<1}return gy(r)}function dy(r){const e=my(r);for(let t=0,i=e.length;t<i;++t){const n=e[t];e[t]=n&1?~(n>>1):n>>1}return e}function gy(r){let e="";for(let t=0,i=r.length;t<i;++t)e+=py(r[t]);return e}function my(r){const e=[];let t=0,i=0;for(let n=0,s=r.length;n<s;++n){const a=r.charCodeAt(n)-63;t|=(a&31)<<i,a<32?(e.push(t),t=0,i=0):i+=5}return e}function py(r){let e,t="";for(;r>=32;)e=(32|r&31)+63,t+=String.fromCharCode(e),r>>=5;return e=r+63,t+=String.fromCharCode(e),t}const yy=oy;class _y extends qh{constructor(e){super(),e=e||{},this.layerName_=e.layerName,this.layers_=e.layers?e.layers:null,this.dataProjection=de(e.dataProjection?e.dataProjection:"EPSG:4326")}readFeaturesFromObject(e,t){if(e.type=="Topology"){const i=e;let n,s=null,a=null;i.transform&&(n=i.transform,s=n.scale,a=n.translate);const o=i.arcs;n&&by(o,s,a);const l=[],h=i.objects,c=this.layerName_;let u;for(const d in h)this.layers_&&!this.layers_.includes(d)||(h[d].type==="GeometryCollection"?(u=h[d],l.push.apply(l,Ry(u,o,s,a,c,d,t))):(u=h[d],l.push(qu(u,o,s,a,c,d,t))));return l}return[]}readProjectionFromObject(e){return this.dataProjection}}const xy={Point:vy,LineString:wy,Polygon:Ty,MultiPoint:Ey,MultiLineString:Sy,MultiPolygon:My};function _s(r,e){const t=[];let i;for(let n=0,s=r.length;n<s;++n)if(i=r[n],n>0&&t.pop(),i>=0){const a=e[i];for(let o=0,l=a.length;o<l;++o)t.push(a[o].slice(0))}else{const a=e[~i];for(let o=a.length-1;o>=0;--o)t.push(a[o].slice(0))}return t}function vy(r,e,t){const i=r.coordinates;return e&&t&&ho(i,e,t),new _t(i)}function Ey(r,e,t){const i=r.coordinates;if(e&&t)for(let n=0,s=i.length;n<s;++n)ho(i[n],e,t);return new yi(i)}function wy(r,e){const t=_s(r.arcs,e);return new Et(t)}function Sy(r,e){const t=[];for(let i=0,n=r.arcs.length;i<n;++i)t[i]=_s(r.arcs[i],e);return new or(t)}function Ty(r,e){const t=[];for(let i=0,n=r.arcs.length;i<n;++i)t[i]=_s(r.arcs[i],e);return new vr(t)}function My(r,e){const t=[];for(let i=0,n=r.arcs.length;i<n;++i){const s=r.arcs[i],a=[];for(let o=0,l=s.length;o<l;++o)a[o]=_s(s[o],e);t[i]=a}return new Dr(t)}function Ry(r,e,t,i,n,s,a){const o=r.geometries,l=[];for(let h=0,c=o.length;h<c;++h)l[h]=qu(o[h],e,t,i,n,s,a);return l}function qu(r,e,t,i,n,s,a){let o=null;const l=r.type;if(l){const u=xy[l];l==="Point"||l==="MultiPoint"?o=u(r,t,i):o=u(r,e),o=ze(o,!1,a)}const h=new it({geometry:o});r.id!==void 0&&h.setId(r.id);let c=r.properties;return n&&(c||(c={}),c[n]=s),c&&h.setProperties(c,!0),h}function by(r,e,t){for(let i=0,n=r.length;i<n;++i)Py(r[i],e,t)}function Py(r,e,t){let i=0,n=0;for(let s=0,a=r.length;s<a;++s){const o=r[s];i+=o[0],n+=o[1],o[0]=i,o[1]=n,ho(o,e,t)}}function ho(r,e,t){r[0]=r[0]*e[0]+t[0],r[1]=r[1]*e[1]+t[1]}const Ay=_y;class Ee extends le{constructor(e){e=e||{},super(e),this.schemaLocation=e.schemaLocation?e.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(e,t,i){const n=i[i.length-1];i[i.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},n),super.writeGeometryElement(e,t,i)}}Ee.prototype.namespace="http://www.opengis.net/gml/3.2";Ee.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:Q(le.prototype.readFlatPos),posList:Q(le.prototype.readFlatPosList),coordinates:Q(Ei.prototype.readFlatCoordinates)}};Ee.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:le.prototype.interiorParser,exterior:le.prototype.exteriorParser}};Ee.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:Q(he.prototype.readPoint),MultiPoint:Q(he.prototype.readMultiPoint),LineString:Q(he.prototype.readLineString),MultiLineString:Q(he.prototype.readMultiLineString),LinearRing:Q(he.prototype.readLinearRing),Polygon:Q(he.prototype.readPolygon),MultiPolygon:Q(he.prototype.readMultiPolygon),Surface:Q(Ee.prototype.readSurface),MultiSurface:Q(le.prototype.readMultiSurface),Curve:Q(Ee.prototype.readCurve),MultiCurve:Q(le.prototype.readMultiCurve),Envelope:Q(Ee.prototype.readEnvelope)}};Ee.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:X(le.prototype.curveMemberParser),curveMembers:X(le.prototype.curveMemberParser)}};Ee.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:X(le.prototype.surfaceMemberParser),surfaceMembers:X(le.prototype.surfaceMemberParser)}};Ee.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:X(he.prototype.readLineString),Curve:X(le.prototype.readCurve)}};Ee.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:X(he.prototype.readPolygon),Surface:X(le.prototype.readSurface)}};Ee.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:Q(le.prototype.readPatch)}};Ee.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:Q(le.prototype.readSegment)}};Ee.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:X(le.prototype.readFlatPosList),upperCorner:X(le.prototype.readFlatPosList)}};Ee.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:Q(le.prototype.readPolygonPatch)}};Ee.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:jn(le.prototype.readLineStringSegment)}};Ee.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:X(he.prototype.pointMemberParser),pointMembers:X(he.prototype.pointMemberParser)}};Ee.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:X(he.prototype.lineStringMemberParser),lineStringMembers:X(he.prototype.lineStringMemberParser)}};Ee.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:X(he.prototype.polygonMemberParser),polygonMembers:X(he.prototype.polygonMemberParser)}};Ee.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:X(he.prototype.readFlatCoordinatesFromNode)}};Ee.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:X(he.prototype.readLineString)}};Ee.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:X(he.prototype.readPolygon)}};Ee.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:Q(he.prototype.readFlatLinearRing),Ring:Q(Ee.prototype.readFlatCurveRing)}};Ee.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:M(le.prototype.writeRing),interior:M(le.prototype.writeRing)}};Ee.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:M(ee),upperCorner:M(ee)}};Ee.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:M(le.prototype.writeSurfaceOrPolygonMember),polygonMember:M(le.prototype.writeSurfaceOrPolygonMember)}};Ee.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:M(le.prototype.writePointMember)}};Ee.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:M(le.prototype.writeLineStringOrCurveMember),curveMember:M(le.prototype.writeLineStringOrCurveMember)}};Ee.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:M(le.prototype.writeCurveOrLineString),MultiCurve:M(le.prototype.writeMultiCurveOrLineString),Point:M(Ee.prototype.writePoint),MultiPoint:M(le.prototype.writeMultiPoint),LineString:M(le.prototype.writeCurveOrLineString),MultiLineString:M(le.prototype.writeMultiCurveOrLineString),LinearRing:M(le.prototype.writeLinearRing),Polygon:M(le.prototype.writeSurfaceOrPolygon),MultiPolygon:M(le.prototype.writeMultiSurfaceOrPolygon),Surface:M(le.prototype.writeSurfaceOrPolygon),MultiSurface:M(le.prototype.writeMultiSurfaceOrPolygon),Envelope:M(le.prototype.writeEnvelope)}};const uo=Ee;class Iy{constructor(e){this.tagName_=e}getTagName(){return this.tagName_}}const Xu=Iy;class Ly extends Xu{constructor(e,t){super(e),this.conditions=t,Yt(this.conditions.length>=2,"At least 2 conditions are required")}}const Cy=Ly;class Oy extends Cy{constructor(e){super("And",Array.prototype.slice.call(arguments))}}const Ny=Oy;class Fy extends Xu{constructor(e,t,i){if(super("BBOX"),this.geometryName=e,this.extent=t,t.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=i}}const Dy=Fy;function Gy(r){const e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(Ny,e))}function Uy(r,e,t){return new Dy(r,e,t)}const bl={"http://www.opengis.net/gml":{boundedBy:T(he.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:X(he.prototype.readFeaturesInternal)}},By={"http://www.opengis.net/wfs":{totalInserted:T(Ue),totalUpdated:T(Ue),totalDeleted:T(Ue)},"http://www.opengis.net/wfs/2.0":{totalInserted:T(Ue),totalUpdated:T(Ue),totalDeleted:T(Ue)}},zy={"http://www.opengis.net/wfs":{TransactionSummary:T(Al,"transactionSummary"),InsertResults:T(Ll,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:T(Al,"transactionSummary"),InsertResults:T(Ll,"insertIds")}},ky={"http://www.opengis.net/wfs":{PropertyName:M(ee)},"http://www.opengis.net/wfs/2.0":{PropertyName:M(ee)}},Hu={"http://www.opengis.net/wfs":{Insert:M(Cl),Update:M(Nl),Delete:M(Ol),Property:M(Fl),Native:M(Dl)},"http://www.opengis.net/wfs/2.0":{Insert:M(Cl),Update:M(Nl),Delete:M(Ol),Property:M(Fl),Native:M(Dl)}},Wu="feature",co="http://www.w3.org/2000/xmlns/",fo={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},pa={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},go={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},Pl={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},mo={"2.0.0":uo,"1.1.0":le,"1.0.0":Ei},$y="1.1.0";class jy extends an{constructor(e){super(),e=e||{},this.version_=e.version?e.version:$y,this.featureType_=e.featureType,this.featureNS_=e.featureNS,this.gmlFormat_=e.gmlFormat?e.gmlFormat:new mo[this.version_],this.schemaLocation_=e.schemaLocation?e.schemaLocation:Pl[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(e){this.featureType_=e}readFeaturesFromNode(e,t){const i={node:e};Object.assign(i,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(i,this.getReadOptions(e,t||{}));const n=[i];let s;this.version_==="2.0.0"?s=bl:s=this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let a=D([],s,e,n,this.gmlFormat_);return a||(a=[]),a}readTransactionResponse(e){if(e){if(typeof e=="string"){const t=Nt(e);return this.readTransactionResponseFromDocument(t)}return Ot(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}}readFeatureCollectionMetadata(e){if(e){if(typeof e=="string"){const t=Nt(e);return this.readFeatureCollectionMetadataFromDocument(t)}return Ot(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}}readFeatureCollectionMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)}readFeatureCollectionMetadataFromNode(e){const t={},i=ir(e.getAttribute("numberOfFeatures"));return t.numberOfFeatures=i,D(t,bl,e,[],this.gmlFormat_)}readTransactionResponseFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)}readTransactionResponseFromNode(e){return D({},zy,e,[])}writeGetFeature(e){const t=ne(pa[this.version_],"GetFeature");t.setAttribute("service","WFS"),t.setAttribute("version",this.version_),e.handle&&t.setAttribute("handle",e.handle),e.outputFormat&&t.setAttribute("outputFormat",e.outputFormat),e.maxFeatures!==void 0&&t.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&t.setAttribute("resultType",e.resultType),e.startIndex!==void 0&&t.setAttribute("startIndex",String(e.startIndex)),e.count!==void 0&&t.setAttribute("count",String(e.count)),e.viewParams!==void 0&&t.setAttribute("viewParams",e.viewParams),t.setAttributeNS(Lr,"xsi:schemaLocation",this.schemaLocation_);const i={node:t};if(Object.assign(i,{version:this.version_,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,propertyNames:e.propertyNames?e.propertyNames:[]}),Yt(Array.isArray(e.featureTypes),"`options.featureTypes` must be an Array"),typeof e.featureTypes[0]=="string"){let n=e.filter;e.bbox&&(Yt(e.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),n=this.combineBboxAndFilter(e.geometryName,e.bbox,e.srsName,n)),Object.assign(i,{geometryName:e.geometryName,filter:n}),Xl(t,e.featureTypes,[i])}else e.featureTypes.forEach(n=>{const s=this.combineBboxAndFilter(n.geometryName,n.bbox,e.srsName,e.filter);Object.assign(i,{geometryName:n.geometryName,filter:s}),Xl(t,[n.name],[i])});return t}combineBboxAndFilter(e,t,i,n){const s=Uy(e,t,i);return n?Gy(n,s):s}writeTransaction(e,t,i,n){const s=[],a=n.version?n.version:this.version_,o=ne(pa[a],"Transaction");o.setAttribute("service","WFS"),o.setAttribute("version",a);let l;n&&(l=n.gmlOptions?n.gmlOptions:{},n.handle&&o.setAttribute("handle",n.handle)),o.setAttributeNS(Lr,"xsi:schemaLocation",Pl[a]);const h=Zy(o,l,a,n);return e&&xn("Insert",e,s,h),t&&xn("Update",t,s,h),i&&xn("Delete",i,s,h),n.nativeElements&&xn("Native",n.nativeElements,s,h),o}readProjectionFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null}readProjectionFromNode(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild){e=e.firstElementChild.firstElementChild;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(!(t.childNodes.length===0||t.childNodes.length===1&&t.firstChild.nodeType===3)){const i=[{}];return this.gmlFormat_.readGeometryElement(t,i),de(i.pop().srsName)}}return null}}function Zy(r,e,t,i){const n=i.featurePrefix?i.featurePrefix:Wu;let s;return t==="1.0.0"?s=2:t==="1.1.0"?s=3:t==="2.0.0"&&(s=3.2),Object.assign({node:r},{version:t,featureNS:i.featureNS,featureType:i.featureType,featurePrefix:n,gmlVersion:s,hasZ:i.hasZ,srsName:i.srsName},e)}function xn(r,e,t,i){re(i,Hu,Ne(r),e,t)}function Al(r,e){return D({},By,r,e)}const qy={"http://www.opengis.net/ogc":{FeatureId:X(function(r,e){return r.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:X(function(r,e){return r.getAttribute("fid")})}};function Il(r,e){ft(qy,r,e)}const Xy={"http://www.opengis.net/wfs":{Feature:Il},"http://www.opengis.net/wfs/2.0":{Feature:Il}};function Ll(r,e){return D([],Xy,r,e)}function Cl(r,e,t){const i=t[t.length-1],n=i.featureType,s=i.featureNS,a=i.gmlVersion,o=ne(s,n);r.appendChild(o),a===2?Ei.prototype.writeFeatureElement(o,e,t):a===3?le.prototype.writeFeatureElement(o,e,t):uo.prototype.writeFeatureElement(o,e,t)}function Vu(r,e,t){const n=t[t.length-1].version,s=fo[n],a=ne(s,"Filter"),o=ne(s,"FeatureId");a.appendChild(o),o.setAttribute("fid",e),r.appendChild(a)}function po(r,e){r=r||Wu;const t=r+":";return e.startsWith(t)?e:t+e}function Ol(r,e,t){const i=t[t.length-1];Yt(e.getId()!==void 0,"Features must have an id set");const n=i.featureType,s=i.featurePrefix,a=i.featureNS,o=po(s,n);r.setAttribute("typeName",o),r.setAttributeNS(co,"xmlns:"+s,a);const l=e.getId();l!==void 0&&Vu(r,l,t)}function Nl(r,e,t){const i=t[t.length-1];Yt(e.getId()!==void 0,"Features must have an id set");const n=i.version,s=i.featureType,a=i.featurePrefix,o=i.featureNS,l=po(a,s),h=e.getGeometryName();r.setAttribute("typeName",l),r.setAttributeNS(co,"xmlns:"+a,o);const c=e.getId();if(c!==void 0){const u=e.getKeys(),d=[];for(let m=0,g=u.length;m<g;m++){const y=e.get(u[m]);if(y!==void 0){let _=u[m];y&&typeof y.getSimplifiedGeometry=="function"&&(_=h),d.push({name:_,value:y})}}re({version:n,gmlVersion:i.gmlVersion,node:r,hasZ:i.hasZ,srsName:i.srsName},Hu,Ne("Property"),d,t),Vu(r,c,t)}}function Fl(r,e,t){const i=t[t.length-1],n=i.version,s=pa[n],o=ne(s,n==="2.0.0"?"ValueReference":"Name"),l=i.gmlVersion;if(r.appendChild(o),ee(o,e.name),e.value!==void 0&&e.value!==null){const h=ne(s,"Value");r.appendChild(h),e.value&&typeof e.value.getSimplifiedGeometry=="function"?l===2?Ei.prototype.writeGeometryElement(h,e.value,t):l===3?le.prototype.writeGeometryElement(h,e.value,t):uo.prototype.writeGeometryElement(h,e.value,t):ee(h,e.value)}}function Dl(r,e,t){e.vendorId&&r.setAttribute("vendorId",e.vendorId),e.safeToIgnore!==void 0&&r.setAttribute("safeToIgnore",String(e.safeToIgnore)),e.value!==void 0&&ee(r,e.value)}const xs={"http://www.opengis.net/wfs":{Query:M(Gl)},"http://www.opengis.net/wfs/2.0":{Query:M(Gl)},"http://www.opengis.net/ogc":{During:M(zl),And:M(vn),Or:M(vn),Not:M(kl),BBOX:M(Ul),Contains:M(cr),Intersects:M(cr),Within:M(cr),DWithin:M(Bl),PropertyIsEqualTo:M(St),PropertyIsNotEqualTo:M(St),PropertyIsLessThan:M(St),PropertyIsLessThanOrEqualTo:M(St),PropertyIsGreaterThan:M(St),PropertyIsGreaterThanOrEqualTo:M(St),PropertyIsNull:M($l),PropertyIsBetween:M(jl),PropertyIsLike:M(Zl)},"http://www.opengis.net/fes/2.0":{During:M(zl),And:M(vn),Or:M(vn),Not:M(kl),BBOX:M(Ul),Contains:M(cr),Disjoint:M(cr),Intersects:M(cr),ResourceId:M(Wy),Within:M(cr),DWithin:M(Bl),PropertyIsEqualTo:M(St),PropertyIsNotEqualTo:M(St),PropertyIsLessThan:M(St),PropertyIsLessThanOrEqualTo:M(St),PropertyIsGreaterThan:M(St),PropertyIsGreaterThanOrEqualTo:M(St),PropertyIsNull:M($l),PropertyIsBetween:M(jl),PropertyIsLike:M(Zl)}};function Gl(r,e,t){const i=t[t.length-1],n=i.version,s=i.featurePrefix,a=i.featureNS,o=i.propertyNames,l=i.srsName;let h;s?h=po(s,e):h=e;let c;n==="2.0.0"?c="typeNames":c="typeName",r.setAttribute(c,h),l&&r.setAttribute("srsName",l),a&&r.setAttributeNS(co,"xmlns:"+s,a);const u=Object.assign({},i);u.node=r,re(u,ky,Ne("PropertyName"),o,t);const d=i.filter;if(d){const m=ne(vs(n),"Filter");r.appendChild(m),Hy(m,d,t)}}function Hy(r,e,t){const i=t[t.length-1],n={node:r};Object.assign(n,{context:i}),re(n,xs,Ne(e.getTagName()),[e],t)}function Ul(r,e,t){const i=t[t.length-1],s=i.context.version;i.srsName=e.srsName;const a=mo[s];Si(s,r,e.geometryName),a.prototype.writeGeometryElement(r,e.extent,t)}function Wy(r,e,t){r.setAttribute("rid",e.rid)}function cr(r,e,t){const i=t[t.length-1],s=i.context.version;i.srsName=e.srsName;const a=mo[s];Si(s,r,e.geometryName),a.prototype.writeGeometryElement(r,e.geometry,t)}function Bl(r,e,t){const s=t[t.length-1].context.version;cr(r,e,t);const a=ne(vs(s),"Distance");ee(a,e.distance.toString()),s==="2.0.0"?a.setAttribute("uom",e.unit):a.setAttribute("units",e.unit),r.appendChild(a)}function zl(r,e,t){const s=t[t.length-1].context.version;Hn(go[s],"ValueReference",r,e.propertyName);const a=ne(nr,"TimePeriod");r.appendChild(a);const o=ne(nr,"begin");a.appendChild(o),ql(o,e.begin);const l=ne(nr,"end");a.appendChild(l),ql(l,e.end)}function vn(r,e,t){const n=t[t.length-1].context,s={node:r};Object.assign(s,{context:n});const a=e.conditions;for(let o=0,l=a.length;o<l;++o){const h=a[o];re(s,xs,Ne(h.getTagName()),[h],t)}}function kl(r,e,t){const n=t[t.length-1].context,s={node:r};Object.assign(s,{context:n});const a=e.condition;re(s,xs,Ne(a.getTagName()),[a],t)}function St(r,e,t){const s=t[t.length-1].context.version;e.matchCase!==void 0&&r.setAttribute("matchCase",e.matchCase.toString()),Si(s,r,e.propertyName),Wn(s,r,""+e.expression)}function $l(r,e,t){const s=t[t.length-1].context.version;Si(s,r,e.propertyName)}function jl(r,e,t){const s=t[t.length-1].context.version,a=vs(s);Si(s,r,e.propertyName);const o=ne(a,"LowerBoundary");r.appendChild(o),Wn(s,o,""+e.lowerBoundary);const l=ne(a,"UpperBoundary");r.appendChild(l),Wn(s,l,""+e.upperBoundary)}function Zl(r,e,t){const s=t[t.length-1].context.version;r.setAttribute("wildCard",e.wildCard),r.setAttribute("singleChar",e.singleChar),r.setAttribute("escapeChar",e.escapeChar),e.matchCase!==void 0&&r.setAttribute("matchCase",e.matchCase.toString()),Si(s,r,e.propertyName),Wn(s,r,""+e.pattern)}function Hn(r,e,t,i){const n=ne(r,e);ee(n,i),t.appendChild(n)}function Wn(r,e,t){Hn(vs(r),"Literal",e,t)}function Si(r,e,t){r==="2.0.0"?Hn(go[r],"ValueReference",e,t):Hn(fo[r],"PropertyName",e,t)}function ql(r,e){const t=ne(nr,"TimeInstant");r.appendChild(t);const i=ne(nr,"timePosition");t.appendChild(i),ee(i,e)}function Xl(r,e,t){const i=t[t.length-1],n=Object.assign({},i);n.node=r,re(n,xs,Ne("Query"),e,t)}function vs(r){let e;return r==="2.0.0"?e=go[r]:e=fo[r],e}const Vy=jy,Te={POINT:1,LINE_STRING:2,POLYGON:3,MULTI_POINT:4,MULTI_LINE_STRING:5,MULTI_POLYGON:6,GEOMETRY_COLLECTION:7,POLYHEDRAL_SURFACE:15,TIN:16,TRIANGLE:17};class Hl{constructor(e){this.view_=e,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_="XY"}readUint8(){return this.view_.getUint8(this.pos_++)}readUint32(e){return this.view_.getUint32((this.pos_+=4)-4,e!==void 0?e:this.isLittleEndian_)}readDouble(e){return this.view_.getFloat64((this.pos_+=8)-8,e!==void 0?e:this.isLittleEndian_)}readPoint(){const e=[];return e.push(this.readDouble()),e.push(this.readDouble()),this.hasZ_&&e.push(this.readDouble()),this.hasM_&&e.push(this.readDouble()),e}readLineString(){const e=this.readUint32(),t=[];for(let i=0;i<e;i++)t.push(this.readPoint());return t}readPolygon(){const e=this.readUint32(),t=[];for(let i=0;i<e;i++)t.push(this.readLineString());return t}readWkbHeader(e){const i=this.readUint8()>0,n=this.readUint32(i),s=Math.floor((n&268435455)/1e3),a=!!(n&2147483648)||s===1||s===3,o=!!(n&1073741824)||s===2||s===3,l=!!(n&536870912),h=(n&268435455)%1e3,c=["XY",a?"Z":"",o?"M":""].join(""),u=l?this.readUint32(i):null;if(e!==void 0&&e!==h)throw new Error("Unexpected WKB geometry type "+h);if(this.initialized_){if(this.isLittleEndian_!==i)throw new Error("Inconsistent endian");if(this.layout_!==c)throw new Error("Inconsistent geometry layout");if(u&&this.srid_!==u)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=i,this.hasZ_=a,this.hasM_=o,this.layout_=c,this.srid_=u,this.initialized_=!0;return h}readWkbPayload(e){switch(e){case Te.POINT:return this.readPoint();case Te.LINE_STRING:return this.readLineString();case Te.POLYGON:case Te.TRIANGLE:return this.readPolygon();case Te.MULTI_POINT:return this.readMultiPoint();case Te.MULTI_LINE_STRING:return this.readMultiLineString();case Te.MULTI_POLYGON:case Te.POLYHEDRAL_SURFACE:case Te.TIN:return this.readMultiPolygon();case Te.GEOMETRY_COLLECTION:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+e+" is found")}}readWkbBlock(e){return this.readWkbPayload(this.readWkbHeader(e))}readWkbCollection(e,t){const i=this.readUint32(),n=[];for(let s=0;s<i;s++){const a=e.call(this,t);a&&n.push(a)}return n}readMultiPoint(){return this.readWkbCollection(this.readWkbBlock,Te.POINT)}readMultiLineString(){return this.readWkbCollection(this.readWkbBlock,Te.LINE_STRING)}readMultiPolygon(){return this.readWkbCollection(this.readWkbBlock,Te.POLYGON)}readGeometryCollection(){return this.readWkbCollection(this.readGeometry)}readGeometry(){const e=this.readWkbHeader(),t=this.readWkbPayload(e);switch(e){case Te.POINT:return new _t(t,this.layout_);case Te.LINE_STRING:return new Et(t,this.layout_);case Te.POLYGON:case Te.TRIANGLE:return new vr(t,this.layout_);case Te.MULTI_POINT:return new yi(t,this.layout_);case Te.MULTI_LINE_STRING:return new or(t,this.layout_);case Te.MULTI_POLYGON:case Te.POLYHEDRAL_SURFACE:case Te.TIN:return new Dr(t,this.layout_);case Te.GEOMETRY_COLLECTION:return new rt(t);default:return null}}getSrid(){return this.srid_}}class Yy{constructor(e){e=e||{},this.layout_=e.layout,this.isLittleEndian_=e.littleEndian!==!1,this.isEWKB_=e.ewkb!==!1,this.writeQueue_=[],this.nodata_=Object.assign({X:0,Y:0,Z:0,M:0},e.nodata)}writeUint8(e){this.writeQueue_.push([1,e])}writeUint32(e){this.writeQueue_.push([4,e])}writeDouble(e){this.writeQueue_.push([8,e])}writePoint(e,t){const i=Object.assign.apply(null,t.split("").map((n,s)=>({[n]:e[s]})));for(const n of this.layout_)this.writeDouble(n in i?i[n]:this.nodata_[n])}writeLineString(e,t){this.writeUint32(e.length);for(let i=0;i<e.length;i++)this.writePoint(e[i],t)}writePolygon(e,t){this.writeUint32(e.length);for(let i=0;i<e.length;i++)this.writeLineString(e[i],t)}writeWkbHeader(e,t){e%=1e3,this.layout_.includes("Z")&&(e+=this.isEWKB_?2147483648:1e3),this.layout_.includes("M")&&(e+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(t)&&(e|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(e),this.isEWKB_&&Number.isInteger(t)&&this.writeUint32(t)}writeMultiPoint(e,t){this.writeUint32(e.length);for(let i=0;i<e.length;i++)this.writeWkbHeader(1),this.writePoint(e[i],t)}writeMultiLineString(e,t){this.writeUint32(e.length);for(let i=0;i<e.length;i++)this.writeWkbHeader(2),this.writeLineString(e[i],t)}writeMultiPolygon(e,t){this.writeUint32(e.length);for(let i=0;i<e.length;i++)this.writeWkbHeader(3),this.writePolygon(e[i],t)}writeGeometryCollection(e){this.writeUint32(e.length);for(let t=0;t<e.length;t++)this.writeGeometry(e[t])}findMinimumLayout(e,t="XYZM"){const i=(n,s)=>n===s?n:n==="XYZM"?s:s==="XYZM"?n:"XY";if(e instanceof ll)return i(e.getLayout(),t);if(e instanceof rt){const n=e.getGeometriesArray();for(let s=0;s<n.length&&t!=="XY";s++)t=this.findMinimumLayout(n[s],t)}return t}writeGeometry(e,t){const i={Point:Te.POINT,LineString:Te.LINE_STRING,Polygon:Te.POLYGON,MultiPoint:Te.MULTI_POINT,MultiLineString:Te.MULTI_LINE_STRING,MultiPolygon:Te.MULTI_POLYGON,GeometryCollection:Te.GEOMETRY_COLLECTION},n=e.getType(),s=i[n];if(!s)throw new Error("GeometryType "+n+" is not supported");this.layout_||(this.layout_=this.findMinimumLayout(e)),this.writeWkbHeader(s,t),e instanceof ll?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[n].call(this,e.getCoordinates(),e.getLayout()):e instanceof rt&&this.writeGeometryCollection(e.getGeometriesArray())}getBuffer(){const e=this.writeQueue_.reduce((s,a)=>s+a[0],0),t=new ArrayBuffer(e),i=new DataView(t);let n=0;return this.writeQueue_.forEach(s=>{switch(s[0]){case 1:i.setUint8(n,s[1]);break;case 4:i.setUint32(n,s[1],this.isLittleEndian_);break;case 8:i.setFloat64(n,s[1],this.isLittleEndian_);break}n+=s[0]}),t}}class Ky extends Ga{constructor(e){super(),e=e||{},this.splitCollection=!!e.splitCollection,this.viewCache_=null,this.hex_=e.hex!==!1,this.littleEndian_=e.littleEndian!==!1,this.ewkb_=e.ewkb!==!1,this.layout_=e.geometryLayout,this.nodataZ_=e.nodataZ||0,this.nodataM_=e.nodataM||0,this.srid_=e.srid}getType(){return this.hex_?"text":"arraybuffer"}readFeature(e,t){return new it({geometry:this.readGeometry(e,t)})}readFeatures(e,t){let i=[];const n=this.readGeometry(e,t);return this.splitCollection&&n instanceof rt?i=n.getGeometriesArray():i=[n],i.map(s=>new it({geometry:s}))}readGeometry(e,t){const i=Wl(e);if(!i)return null;const s=new Hl(i).readGeometry();return this.viewCache_=i,t=this.getReadOptions(e,t),this.viewCache_=null,ze(s,!1,t)}readProjection(e){const t=this.viewCache_||Wl(e);if(!t)return;const i=new Hl(t);return i.readWkbHeader(),i.getSrid()&&de("EPSG:"+i.getSrid())||void 0}writeFeature(e,t){return this.writeGeometry(e.getGeometry(),t)}writeFeatures(e,t){return this.writeGeometry(new rt(e.map(i=>i.getGeometry())),t)}writeGeometry(e,t){t=this.adaptOptions(t);const i=new Yy({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}});let n=Number.isInteger(this.srid_)?Number(this.srid_):null;if(this.srid_!==!1&&!Number.isInteger(this.srid_)){const a=t.dataProjection&&de(t.dataProjection);if(a){const o=a.getCode();o.startsWith("EPSG:")&&(n=Number(o.substring(5)))}}i.writeGeometry(ze(e,!0,t),n);const s=i.getBuffer();return this.hex_?Qy(s):s}}function Qy(r){const e=new Uint8Array(r);return Array.from(e.values()).map(t=>(t<16?"0":"")+Number(t).toString(16).toUpperCase()).join("")}function Jy(r){const e=new Uint8Array(r.length/2);for(let t=0;t<r.length/2;t++)e[t]=parseInt(r.substr(t*2,2),16);return new DataView(e.buffer)}function Wl(r){return typeof r=="string"?Jy(r):ArrayBuffer.isView(r)?r instanceof DataView?r:new DataView(r.buffer,r.byteOffset,r.byteLength):r instanceof ArrayBuffer?new DataView(r):null}const e_=Ky,t_={POINT:_t,LINESTRING:Et,POLYGON:vr,MULTIPOINT:yi,MULTILINESTRING:or,MULTIPOLYGON:Dr},Yu="EMPTY",Ku="Z",Qu="M",r_="ZM",we={START:0,TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6},i_={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class n_{constructor(e){this.wkt=e,this.index_=-1}isAlpha_(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}isNumeric_(e,t){return t=t!==void 0?t:!1,e>="0"&&e<="9"||e=="."&&!t}isWhiteSpace_(e){return e==" "||e=="	"||e=="\r"||e==`
`}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const e=this.nextChar_(),t=this.index_;let i=e,n;if(e=="(")n=we.LEFT_PAREN;else if(e==",")n=we.COMMA;else if(e==")")n=we.RIGHT_PAREN;else if(this.isNumeric_(e)||e=="-")n=we.NUMBER,i=this.readNumber_();else if(this.isAlpha_(e))n=we.TEXT,i=this.readText_();else{if(this.isWhiteSpace_(e))return this.nextToken();if(e==="")n=we.EOF;else throw new Error("Unexpected character: "+e)}return{position:t,value:i,type:n}}readNumber_(){let e;const t=this.index_;let i=!1,n=!1;do e=="."?i=!0:(e=="e"||e=="E")&&(n=!0),e=this.nextChar_();while(this.isNumeric_(e,i)||!n&&(e=="e"||e=="E")||n&&(e=="-"||e=="+"));return parseFloat(this.wkt.substring(t,this.index_--))}readText_(){let e;const t=this.index_;do e=this.nextChar_();while(this.isAlpha_(e));return this.wkt.substring(t,this.index_--).toUpperCase()}}let s_=class{constructor(e){this.lexer_=e,this.token_={position:0,type:we.START},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(e){return this.token_.type==e}match(e){const t=this.isTokenType(e);return t&&this.consume_(),t}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let e="XY";const t=this.token_;if(this.isTokenType(we.TEXT)){const i=t.value;i===Ku?e="XYZ":i===Qu?e="XYM":i===r_&&(e="XYZM"),e!=="XY"&&this.consume_()}return e}parseGeometryCollectionText_(){if(this.match(we.LEFT_PAREN)){const e=[];do e.push(this.parseGeometry_());while(this.match(we.COMMA));if(this.match(we.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(we.LEFT_PAREN)){const e=this.parsePoint_();if(this.match(we.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(we.LEFT_PAREN)){const e=this.parsePointList_();if(this.match(we.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(we.LEFT_PAREN)){const e=this.parseLineStringTextList_();if(this.match(we.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(we.LEFT_PAREN)){let e;if(this.token_.type==we.LEFT_PAREN?e=this.parsePointTextList_():e=this.parsePointList_(),this.match(we.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(we.LEFT_PAREN)){const e=this.parseLineStringTextList_();if(this.match(we.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(we.LEFT_PAREN)){const e=this.parsePolygonTextList_();if(this.match(we.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePoint_(){const e=[],t=this.layout_.length;for(let i=0;i<t;++i){const n=this.token_;if(this.match(we.NUMBER))e.push(n.value);else break}if(e.length==t)return e;throw new Error(this.formatErrorMessage_())}parsePointList_(){const e=[this.parsePoint_()];for(;this.match(we.COMMA);)e.push(this.parsePoint_());return e}parsePointTextList_(){const e=[this.parsePointText_()];for(;this.match(we.COMMA);)e.push(this.parsePointText_());return e}parseLineStringTextList_(){const e=[this.parseLineStringText_()];for(;this.match(we.COMMA);)e.push(this.parseLineStringText_());return e}parsePolygonTextList_(){const e=[this.parsePolygonText_()];for(;this.match(we.COMMA);)e.push(this.parsePolygonText_());return e}isEmptyGeometry_(){const e=this.isTokenType(we.TEXT)&&this.token_.value==Yu;return e&&this.consume_(),e}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const e=this.token_;if(this.match(we.TEXT)){const t=e.value;this.layout_=this.parseGeometryLayout_();const i=this.isEmptyGeometry_();if(t=="GEOMETRYCOLLECTION"){if(i)return new rt([]);const a=this.parseGeometryCollectionText_();return new rt(a)}const n=t_[t];if(!n)throw new Error("Invalid geometry type: "+t);let s;if(i)t=="POINT"?s=[NaN,NaN]:s=[];else switch(t){case"POINT":{s=this.parsePointText_();break}case"LINESTRING":{s=this.parseLineStringText_();break}case"POLYGON":{s=this.parsePolygonText_();break}case"MULTIPOINT":{s=this.parseMultiPointText_();break}case"MULTILINESTRING":{s=this.parseMultiLineStringText_();break}case"MULTIPOLYGON":{s=this.parseMultiPolygonText_();break}}return new n(s,this.layout_)}throw new Error(this.formatErrorMessage_())}};class a_ extends no{constructor(e){super(),e=e||{},this.splitCollection_=e.splitCollection!==void 0?e.splitCollection:!1}parse_(e){const t=new n_(e);return new s_(t).parse()}readFeatureFromText(e,t){const i=this.readGeometryFromText(e,t),n=new it;return n.setGeometry(i),n}readFeaturesFromText(e,t){let i=[];const n=this.readGeometryFromText(e,t);this.splitCollection_&&n.getType()=="GeometryCollection"?i=n.getGeometriesArray():i=[n];const s=[];for(let a=0,o=i.length;a<o;++a){const l=new it;l.setGeometry(i[a]),s.push(l)}return s}readGeometryFromText(e,t){const i=this.parse_(e);return ze(i,!1,t)}writeFeatureText(e,t){const i=e.getGeometry();return i?this.writeGeometryText(i,t):""}writeFeaturesText(e,t){if(e.length==1)return this.writeFeatureText(e[0],t);const i=[];for(let s=0,a=e.length;s<a;++s)i.push(e[s].getGeometry());const n=new rt(i);return this.writeGeometryText(n,t)}writeGeometryText(e,t){return tc(ze(e,!0,t))}}function Ju(r){const e=r.getCoordinates();return e.length===0?"":e.join(" ")}function o_(r){const e=[],t=r.getPoints();for(let i=0,n=t.length;i<n;++i)e.push("("+Ju(t[i])+")");return e.join(",")}function l_(r){const e=[],t=r.getGeometries();for(let i=0,n=t.length;i<n;++i)e.push(tc(t[i]));return e.join(",")}function yo(r){const e=r.getCoordinates(),t=[];for(let i=0,n=e.length;i<n;++i)t.push(e[i].join(" "));return t.join(",")}function h_(r){const e=[],t=r.getLineStrings();for(let i=0,n=t.length;i<n;++i)e.push("("+yo(t[i])+")");return e.join(",")}function ec(r){const e=[],t=r.getLinearRings();for(let i=0,n=t.length;i<n;++i)e.push("("+yo(t[i])+")");return e.join(",")}function u_(r){const e=[],t=r.getPolygons();for(let i=0,n=t.length;i<n;++i)e.push("("+ec(t[i])+")");return e.join(",")}function c_(r){const e=r.getLayout();let t="";return(e==="XYZ"||e==="XYZM")&&(t+=Ku),(e==="XYM"||e==="XYZM")&&(t+=Qu),t}const f_={Point:Ju,LineString:yo,Polygon:ec,MultiPoint:o_,MultiLineString:h_,MultiPolygon:u_,GeometryCollection:l_};function tc(r){const e=r.getType(),t=f_[e],i=t(r);let n=i_[e];if(typeof r.getFlatCoordinates=="function"){const s=c_(r);s.length>0&&(n+=" "+s)}return i.length===0?n+" "+Yu:n+"("+i+")"}const d_=a_,Ve=[null,"http://www.opengis.net/wms"],g_=N(Ve,{Service:T(F_),Capability:T(N_)}),m_=N(Ve,{Request:T($_),Exception:T(B_),Layer:T(z_)});class p_ extends lo{constructor(){super(),this.version=void 0}readFromNode(e){this.version=e.getAttribute("version").trim();const t=D({version:this.version},g_,e,[]);return t||null}}const y_=N(Ve,{Name:T(U),Title:T(U),Abstract:T(U),KeywordList:T(sc),OnlineResource:T(wi),ContactInformation:T(D_),Fees:T(U),AccessConstraints:T(U),LayerLimit:T(Ue),MaxWidth:T(Ue),MaxHeight:T(Ue)}),__=N(Ve,{ContactPersonPrimary:T(G_),ContactPosition:T(U),ContactAddress:T(U_),ContactVoiceTelephone:T(U),ContactFacsimileTelephone:T(U),ContactElectronicMailAddress:T(U)}),x_=N(Ve,{ContactPerson:T(U),ContactOrganization:T(U)}),v_=N(Ve,{AddressType:T(U),Address:T(U),City:T(U),StateOrProvince:T(U),PostCode:T(U),Country:T(U)}),E_=N(Ve,{Format:X(U)}),rc=N(Ve,{Name:T(U),Title:T(U),Abstract:T(U),KeywordList:T(sc),CRS:Pe(U),EX_GeographicBoundingBox:T(O_),BoundingBox:Pe(C_),Dimension:Pe(k_),Attribution:T(L_),AuthorityURL:Pe(q_),Identifier:Pe(U),MetadataURL:Pe(X_),DataURL:Pe(ar),FeatureListURL:Pe(ar),Style:Pe(H_),MinScaleDenominator:T(ce),MaxScaleDenominator:T(ce),Layer:Pe(ic)}),w_=N(Ve,{Title:T(U),OnlineResource:T(wi),LogoURL:T(nc)}),S_=N(Ve,{westBoundLongitude:T(ce),eastBoundLongitude:T(ce),southBoundLatitude:T(ce),northBoundLatitude:T(ce)}),T_=N(Ve,{GetCapabilities:T(Bs),GetMap:T(Bs),GetFeatureInfo:T(Bs)}),M_=N(Ve,{Format:Pe(U),DCPType:Pe(j_)}),R_=N(Ve,{HTTP:T(Z_)}),b_=N(Ve,{Get:T(ar),Post:T(ar)}),P_=N(Ve,{Name:T(U),Title:T(U),Abstract:T(U),LegendURL:Pe(nc),StyleSheetURL:T(ar),StyleURL:T(ar)}),A_=N(Ve,{Format:T(U),OnlineResource:T(wi)}),I_=N(Ve,{Keyword:X(U)});function L_(r,e){return D({},w_,r,e)}function C_(r,e){const t=[tr(r.getAttribute("minx")),tr(r.getAttribute("miny")),tr(r.getAttribute("maxx")),tr(r.getAttribute("maxy"))],i=[tr(r.getAttribute("resx")),tr(r.getAttribute("resy"))];return{crs:r.getAttribute("CRS"),extent:t,res:i}}function O_(r,e){const t=D({},S_,r,e);if(!t)return;const i=t.westBoundLongitude,n=t.southBoundLatitude,s=t.eastBoundLongitude,a=t.northBoundLatitude;if(!(i===void 0||n===void 0||s===void 0||a===void 0))return[i,n,s,a]}function N_(r,e){return D({},m_,r,e)}function F_(r,e){return D({},y_,r,e)}function D_(r,e){return D({},__,r,e)}function G_(r,e){return D({},x_,r,e)}function U_(r,e){return D({},v_,r,e)}function B_(r,e){return D([],E_,r,e)}function z_(r,e){const t=D({},rc,r,e);return t.Layer===void 0?Object.assign(t,ic(r,e)):t}function ic(r,e){const t=e[e.length-1],i=D({},rc,r,e);if(!i)return;let n=Pr(r.getAttribute("queryable"));n===void 0&&(n=t.queryable),i.queryable=n!==void 0?n:!1;let s=ir(r.getAttribute("cascaded"));s===void 0&&(s=t.cascaded),i.cascaded=s;let a=Pr(r.getAttribute("opaque"));a===void 0&&(a=t.opaque),i.opaque=a!==void 0?a:!1;let o=Pr(r.getAttribute("noSubsets"));o===void 0&&(o=t.noSubsets),i.noSubsets=o!==void 0?o:!1;let l=tr(r.getAttribute("fixedWidth"));l||(l=t.fixedWidth),i.fixedWidth=l;let h=tr(r.getAttribute("fixedHeight"));return h||(h=t.fixedHeight),i.fixedHeight=h,["Style","CRS","AuthorityURL"].forEach(function(d){if(d in t){const m=i[d]||[];i[d]=m.concat(t[d])}}),["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"].forEach(function(d){if(!(d in i)){const m=t[d];i[d]=m}}),i}function k_(r,e){return{name:r.getAttribute("name"),units:r.getAttribute("units"),unitSymbol:r.getAttribute("unitSymbol"),default:r.getAttribute("default"),multipleValues:Pr(r.getAttribute("multipleValues")),nearestValue:Pr(r.getAttribute("nearestValue")),current:Pr(r.getAttribute("current")),values:U(r)}}function ar(r,e){return D({},A_,r,e)}function $_(r,e){return D({},T_,r,e)}function j_(r,e){return D({},R_,r,e)}function Z_(r,e){return D({},b_,r,e)}function Bs(r,e){return D({},M_,r,e)}function nc(r,e){const t=ar(r,e);if(t){const i=[ir(r.getAttribute("width")),ir(r.getAttribute("height"))];return t.size=i,t}}function q_(r,e){const t=ar(r,e);if(t)return t.name=r.getAttribute("name"),t}function X_(r,e){const t=ar(r,e);if(t)return t.type=r.getAttribute("type"),t}function H_(r,e){return D({},P_,r,e)}function sc(r,e){return D([],I_,r,e)}const W_=p_,V_="_feature",Y_="_layer";class K_ extends an{constructor(e){super(),e=e||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new Ei,this.layers_=e.layers?e.layers:null}getLayers(){return this.layers_}setLayers(e){this.layers_=e}readFeatures_(e,t){e.setAttribute("namespaceURI",this.featureNS_);const i=e.localName;let n=[];if(e.childNodes.length===0)return n;if(i=="msGMLOutput")for(let s=0,a=e.childNodes.length;s<a;s++){const o=e.childNodes[s];if(o.nodeType!==Node.ELEMENT_NODE)continue;const l=o,h=t[0],c=Y_,u=l.localName.replace(c,"");if(this.layers_&&!this.layers_.includes(u))continue;const d=u+V_;h.featureType=d,h.featureNS=this.featureNS_;const m={};m[d]=X(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const g=N([h.featureNS,null],m);l.setAttribute("namespaceURI",this.featureNS_);const y=D([],g,l,t,this.gmlFormat_);y&&Le(n,y)}if(i=="FeatureCollection"){const s=D([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_);s&&(n=s)}return n}readFeaturesFromNode(e,t){const i={};return t&&Object.assign(i,this.getReadOptions(e,t)),this.readFeatures_(e,[i])}}const Q_=K_,Qt=[null,"http://www.opengis.net/wmts/1.0"],Ti=[null,"http://www.opengis.net/ows/1.1"],J_=N(Qt,{Contents:T(cx)});class ex extends lo{constructor(){super(),this.owsParser_=new Zu}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let i=this.owsParser_.readFromNode(e);return i?(i.version=t,i=D(i,J_,e,[]),i||null):null}}const tx=N(Qt,{Layer:Pe(fx),TileMatrixSet:Pe(dx)}),rx=N(Qt,{Style:Pe(gx),Format:Pe(U),TileMatrixSetLink:Pe(mx),Dimension:Pe(px),ResourceURL:Pe(yx)},N(Ti,{Title:T(U),Abstract:T(U),WGS84BoundingBox:T(ac),Identifier:T(U)})),ix=N(Qt,{LegendURL:Pe(_x)},N(Ti,{Title:T(U),Identifier:T(U)})),nx=N(Qt,{TileMatrixSet:T(U),TileMatrixSetLimits:T(vx)}),sx=N(Qt,{TileMatrixLimits:X(Ex)}),ax=N(Qt,{TileMatrix:T(U),MinTileRow:T(Ue),MaxTileRow:T(Ue),MinTileCol:T(Ue),MaxTileCol:T(Ue)}),ox=N(Qt,{Default:T(U),Value:Pe(U)},N(Ti,{Identifier:T(U)})),lx=N(Ti,{LowerCorner:X(ya),UpperCorner:X(ya)}),hx=N(Qt,{WellKnownScaleSet:T(U),TileMatrix:Pe(xx)},N(Ti,{SupportedCRS:T(U),Identifier:T(U),BoundingBox:T(ac)})),ux=N(Qt,{TopLeftCorner:T(ya),ScaleDenominator:T(ce),TileWidth:T(Ue),TileHeight:T(Ue),MatrixWidth:T(Ue),MatrixHeight:T(Ue)},N(Ti,{Identifier:T(U)}));function cx(r,e){return D({},tx,r,e)}function fx(r,e){return D({},rx,r,e)}function dx(r,e){return D({},hx,r,e)}function gx(r,e){const t=D({},ix,r,e);if(!t)return;const i=r.getAttribute("isDefault")==="true";return t.isDefault=i,t}function mx(r,e){return D({},nx,r,e)}function px(r,e){return D({},ox,r,e)}function yx(r,e){const t=r.getAttribute("format"),i=r.getAttribute("template"),n=r.getAttribute("resourceType"),s={};return t&&(s.format=t),i&&(s.template=i),n&&(s.resourceType=n),s}function ac(r,e){const t=D([],lx,r,e);if(t.length==2)return Wh(t)}function _x(r,e){const t={};return t.format=r.getAttribute("format"),t.href=wi(r),t}function ya(r,e){const t=U(r).split(/\s+/);if(!t||t.length!=2)return;const i=+t[0],n=+t[1];if(!(isNaN(i)||isNaN(n)))return[i,n]}function xx(r,e){return D({},ux,r,e)}function vx(r,e){return D([],sx,r,e)}function Ex(r,e){return D({},ax,r,e)}const oc=ex,wx=Object.freeze(Object.defineProperty({__proto__:null,EsriJSON:zg,GML:Kg,GPX:Im,GeoJSON:Vh,IGC:Gm,IIIFInfo:Zm,KML:A0,MVT:Yh,OWS:Zu,Polyline:yy,TopoJSON:Ay,WFS:Vy,WKB:e_,WKT:d_,WMSCapabilities:W_,WMSGetFeatureInfo:Q_,WMTSCapabilities:oc},Symbol.toStringTag,{value:"Module"}));function Sx(r){if(!(r.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const e=r.inversePixelTransform[0],t=r.inversePixelTransform[1],i=Math.sqrt(e*e+t*t),n=r.frameState,s=Kh(r.inversePixelTransform.slice(),n.coordinateToPixelTransform),a=xd(n.viewState.resolution,i);let o;return new vd(r.context,i,n.extent,s,n.viewState.rotation,a,o)}function lc(r,e,t){const i=[];let n=r(0),s=r(1),a=e(n),o=e(s);const l=[s,n],h=[o,a],c=[1,0],u={};let d=1e5,m,g,y,_,v,E;for(;--d>0&&c.length>0;)y=c.pop(),n=l.pop(),a=h.pop(),E=y.toString(),E in u||(i.push(a[0],a[1]),u[E]=!0),_=c.pop(),s=l.pop(),o=h.pop(),v=(y+_)/2,m=r(v),g=e(m),Ed(g[0],g[1],a[0],a[1],o[0],o[1])<t?(i.push(o[0],o[1]),E=_.toString(),u[E]=!0):(c.push(_,v,v,y),h.push(o,g,g,a),l.push(s,m,m,n));return i}function Tx(r,e,t,i,n){const s=de("EPSG:4326");return lc(function(a){return[r,e+(t-e)*a]},Gn(s,i),n)}function Mx(r,e,t,i,n){const s=de("EPSG:4326");return lc(function(a){return[e+(t-e)*a,r]},Gn(s,i),n)}const Rx=new mr({color:"rgba(0,0,0,0.2)"}),bx=[90,45,30,20,10,5,2,1,30/60,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600];class Px extends Ba{constructor(e){e=e||{};const t=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},e);delete t.maxLines,delete t.strokeStyle,delete t.targetSize,delete t.showLabels,delete t.lonLabelFormatter,delete t.latLabelFormatter,delete t.lonLabelPosition,delete t.latLabelPosition,delete t.lonLabelStyle,delete t.latLabelStyle,delete t.intervals,super(t),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=e.targetSize!==void 0?e.targetSize:100,this.maxLines_=e.maxLines!==void 0?e.maxLines:100,this.meridians_=[],this.parallels_=[],this.strokeStyle_=e.strokeStyle!==void 0?e.strokeStyle:Rx,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,e.showLabels&&(this.lonLabelFormatter_=e.lonLabelFormatter==null?hl.bind(this,"EW"):e.lonLabelFormatter,this.latLabelFormatter_=e.latLabelFormatter==null?hl.bind(this,"NS"):e.latLabelFormatter,this.lonLabelPosition_=e.lonLabelPosition==null?0:e.lonLabelPosition,this.latLabelPosition_=e.latLabelPosition==null?1:e.latLabelPosition,this.lonLabelStyleBase_=new Ft({text:e.lonLabelStyle!==void 0?e.lonLabelStyle.clone():new Dn({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new li({color:"rgba(0,0,0,1)"}),stroke:new mr({color:"rgba(255,255,255,1)",width:3})})}),this.lonLabelStyle_=i=>{const n=i.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(n),this.lonLabelStyleBase_},this.latLabelStyleBase_=new Ft({text:e.latLabelStyle!==void 0?e.latLabelStyle.clone():new Dn({font:"12px Calibri,sans-serif",textAlign:"right",fill:new li({color:"rgba(0,0,0,1)"}),stroke:new mr({color:"rgba(255,255,255,1)",width:3})})}),this.latLabelStyle_=i=>{const n=i.get("graticule_label");return this.latLabelStyleBase_.getText().setText(n),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(Mr.POSTRENDER,this.drawLabels_.bind(this))),this.intervals_=e.intervals!==void 0?e.intervals:bx,this.setSource(new os({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new wd,overlaps:!1,useSpatialIndex:!1,wrapX:e.wrapX})),this.featurePool_=[],this.lineStyle_=new Ft({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(e,t){let i=e.slice();return this.projection_&&this.getSource().getWrapX()&&Sd(i,this.projection_),this.loadedExtent_&&(Td(this.loadedExtent_,i,t)?i=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[i]}loaderFunction(e,t,i){this.loadedExtent_=e;const n=this.getSource(),s=this.getExtent()||[-1/0,-1/0,1/0,1/0],a=Xt(s,e);if(this.renderedExtent_&&Un(this.renderedExtent_,a)&&this.renderedResolution_===t||(this.renderedExtent_=a,this.renderedResolution_=t,za(a)))return;const o=fr(a),l=t*t/4;(!this.projection_||!Oi(this.projection_,i))&&this.updateProjectionInfo_(i),this.createGraticule_(a,o,t,l);let c=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(c+=this.meridians_.length),this.parallelsLabels_&&(c+=this.parallels_.length);let u;for(;c>this.featurePool_.length;)u=new it,this.featurePool_.push(u);const d=n.getFeaturesCollection();d.clear();let m=0,g,y;for(g=0,y=this.meridians_.length;g<y;++g)u=this.featurePool_[m++],u.setGeometry(this.meridians_[g]),u.setStyle(this.lineStyle_),d.push(u);for(g=0,y=this.parallels_.length;g<y;++g)u=this.featurePool_[m++],u.setGeometry(this.parallels_[g]),u.setStyle(this.lineStyle_),d.push(u)}addMeridian_(e,t,i,n,s,a){const o=this.getMeridian_(e,t,i,n,a);if(ui(o.getExtent(),s)){if(this.meridiansLabels_){const l=this.lonLabelFormatter_(e);a in this.meridiansLabels_?this.meridiansLabels_[a].text=l:this.meridiansLabels_[a]={geom:new _t([]),text:l}}this.meridians_[a++]=o}return a}addParallel_(e,t,i,n,s,a){const o=this.getParallel_(e,t,i,n,a);if(ui(o.getExtent(),s)){if(this.parallelsLabels_){const l=this.latLabelFormatter_(e);a in this.parallelsLabels_?this.parallelsLabels_[a].text=l:this.parallelsLabels_[a]={geom:new _t([]),text:l}}this.parallels_[a++]=o}return a}drawLabels_(e){const t=e.frameState.viewState.rotation,i=e.frameState.viewState.resolution,n=e.frameState.size,s=e.frameState.extent,a=fr(s);let o=s;if(t){const g=n[0]*i,y=n[1]*i;o=[a[0]-g/2,a[1]-y/2,a[0]+g/2,a[1]+y/2]}let l=0,h=0,c=this.latLabelPosition_<.5;const u=this.projection_.getExtent(),d=xt(u);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!Fn(u,s)){l=Math.floor((s[0]-u[0])/d),h=Math.ceil((s[2]-u[2])/d);const g=Math.abs(t)>Math.PI/2;c=c!==g}const m=Sx(e);for(let g=l;g<=h;++g){let y=this.meridians_.length+this.parallels_.length,_,v,E,S;if(this.meridiansLabels_)for(v=0,E=this.meridiansLabels_.length;v<E;++v){const w=this.meridians_[v];if(!t&&g===0)S=this.getMeridianPoint_(w,s,v);else{const P=w.clone();P.translate(g*d,0),P.rotate(-t,a),S=this.getMeridianPoint_(P,o,v),S.rotate(t,a)}_=this.featurePool_[y++],_.setGeometry(S),_.set("graticule_label",this.meridiansLabels_[v].text),m.drawFeature(_,this.lonLabelStyle_(_))}if(this.parallelsLabels_&&(g===l&&c||g===h&&!c))for(v=0,E=this.parallels_.length;v<E;++v){const w=this.parallels_[v];if(!t&&g===0)S=this.getParallelPoint_(w,s,v);else{const P=w.clone();P.translate(g*d,0),P.rotate(-t,a),S=this.getParallelPoint_(P,o,v),S.rotate(t,a)}_=this.featurePool_[y++],_.setGeometry(S),_.set("graticule_label",this.parallelsLabels_[v].text),m.drawFeature(_,this.latLabelStyle_(_))}}}createGraticule_(e,t,i,n){const s=this.getInterval_(i);if(s==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}let a=!1;const o=this.projection_.getExtent(),l=xt(o);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!Fn(o,e)&&(xt(e)>=l?(e[0]=o[0],e[2]=o[2]):a=!0);const h=[Ie(t[0],this.minX_,this.maxX_),Ie(t[1],this.minY_,this.maxY_)],c=this.toLonLatTransform_(h);isNaN(c[1])&&(c[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let u=Ie(c[0],this.minLon_,this.maxLon_),d=Ie(c[1],this.minLat_,this.maxLat_);const m=this.maxLines_;let g,y,_,v,E=e;a||(E=[Ie(e[0],this.minX_,this.maxX_),Ie(e[1],this.minY_,this.maxY_),Ie(e[2],this.minX_,this.maxX_),Ie(e[3],this.minY_,this.maxY_)]);const S=Wi(E,this.toLonLatTransform_,void 0,8);let w=S[3],P=S[2],A=S[1],I=S[0];if(a||(Vr(E,this.bottomLeft_)&&(I=this.minLon_,A=this.minLat_),Vr(E,this.bottomRight_)&&(P=this.maxLon_,A=this.minLat_),Vr(E,this.topLeft_)&&(I=this.minLon_,w=this.maxLat_),Vr(E,this.topRight_)&&(P=this.maxLon_,w=this.maxLat_),w=Ie(w,d,this.maxLat_),P=Ie(P,u,this.maxLon_),A=Ie(A,this.minLat_,d),I=Ie(I,this.minLon_,u)),u=Math.floor(u/s)*s,v=Ie(u,this.minLon_,this.maxLon_),y=this.addMeridian_(v,A,w,n,e,0),g=0,a)for(;(v-=s)>=I&&g++<m;)y=this.addMeridian_(v,A,w,n,e,y);else for(;v!=this.minLon_&&g++<m;)v=Math.max(v-s,this.minLon_),y=this.addMeridian_(v,A,w,n,e,y);if(v=Ie(u,this.minLon_,this.maxLon_),g=0,a)for(;(v+=s)<=P&&g++<m;)y=this.addMeridian_(v,A,w,n,e,y);else for(;v!=this.maxLon_&&g++<m;)v=Math.min(v+s,this.maxLon_),y=this.addMeridian_(v,A,w,n,e,y);for(this.meridians_.length=y,this.meridiansLabels_&&(this.meridiansLabels_.length=y),d=Math.floor(d/s)*s,_=Ie(d,this.minLat_,this.maxLat_),y=this.addParallel_(_,I,P,n,e,0),g=0;_!=this.minLat_&&g++<m;)_=Math.max(_-s,this.minLat_),y=this.addParallel_(_,I,P,n,e,y);for(_=Ie(d,this.minLat_,this.maxLat_),g=0;_!=this.maxLat_&&g++<m;)_=Math.min(_+s,this.maxLat_),y=this.addParallel_(_,I,P,n,e,y);this.parallels_.length=y,this.parallelsLabels_&&(this.parallelsLabels_.length=y)}getInterval_(e){const t=this.projectionCenterLonLat_[0],i=this.projectionCenterLonLat_[1];let n=-1;const s=Math.pow(this.targetSize_*e,2),a=[],o=[];for(let l=0,h=this.intervals_.length;l<h;++l){const c=Ie(this.intervals_[l]/2,0,90),u=Ie(i,-90+c,90-c);if(a[0]=t-c,a[1]=u-c,o[0]=t+c,o[1]=u+c,this.fromLonLatTransform_(a,a),this.fromLonLatTransform_(o,o),Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2)<=s)break;n=this.intervals_[l]}return n}getMeridian_(e,t,i,n,s){const a=Tx(e,t,i,this.projection_,n);let o=this.meridians_[s];return o?(o.setFlatCoordinates("XY",a),o.changed()):(o=new Et(a,"XY"),this.meridians_[s]=o),o}getMeridianPoint_(e,t,i){const n=e.getFlatCoordinates();let s=1,a=n.length-1;n[s]>n[a]&&(s=a,a=1);const o=Math.max(t[1],n[s]),l=Math.min(t[3],n[a]),h=Ie(t[1]+Math.abs(t[1]-t[3])*this.lonLabelPosition_,o,l),u=[n[s-1]+(n[a-1]-n[s-1])*(h-n[s])/(n[a]-n[s]),h],d=this.meridiansLabels_[i].geom;return d.setCoordinates(u),d}getMeridians(){return this.meridians_}getParallel_(e,t,i,n,s){const a=Mx(e,t,i,this.projection_,n);let o=this.parallels_[s];return o?(o.setFlatCoordinates("XY",a),o.changed()):o=new Et(a,"XY"),o}getParallelPoint_(e,t,i){const n=e.getFlatCoordinates();let s=0,a=n.length-2;n[s]>n[a]&&(s=a,a=0);const o=Math.max(t[0],n[s]),l=Math.min(t[2],n[a]),h=Ie(t[0]+Math.abs(t[0]-t[2])*this.latLabelPosition_,o,l),c=n[s+1]+(n[a+1]-n[s+1])*(h-n[s])/(n[a]-n[s]),u=[h,c],d=this.parallelsLabels_[i].geom;return d.setCoordinates(u),d}getParallels(){return this.parallels_}updateProjectionInfo_(e){const t=de("EPSG:4326"),i=e.getWorldExtent();this.maxLat_=i[3],this.maxLon_=i[2],this.minLat_=i[1],this.minLon_=i[0];const n=Gn(e,t);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=n;else{const a=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(o,l,h){h=h||2;const c=n(o,l,h);for(let u=0,d=c.length;u<d;u+=h)c[u]<a&&(c[u]+=360);return c}}this.fromLonLatTransform_=Gn(t,e);const s=Wi([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=s[0],this.maxX_=s[2],this.minY_=s[1],this.maxY_=s[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(fr(e.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=e}}const Ax=Px,Es=34962,ws=34963,Ix=35040,_o=35044,_a=35048,Lx=5121,Cx=5123,Ox=5125,hc=5126,Vl=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function Nx(r,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!Md},e);const t=Vl.length;for(let i=0;i<t;++i)try{const n=r.getContext(Vl[i],e);if(n)return n}catch{}return null}const Fx={STATIC_DRAW:_o,STREAM_DRAW:Ix,DYNAMIC_DRAW:_a};class Dx{constructor(e,t){this.array_=null,this.type_=e,Yt(e===Es||e===ws,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=t!==void 0?t:Fx.STATIC_DRAW}ofSize(e){return this.array_=new(zs(this.type_))(e),this}fromArray(e){return this.array_=zs(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(zs(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function zs(r){switch(r){case Es:return Float32Array;case ws:return Uint32Array;default:return Float32Array}}const Vn=Dx,En={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},Gx=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,Ux=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class Bx{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer(),this.depthBuffer_=t.createRenderbuffer();const i=t.createShader(t.VERTEX_SHADER);t.shaderSource(i,e.vertexShader||Gx),t.compileShader(i);const n=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,e.fragmentShader||Ux),t.compileShader(n),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,i),t.attachShader(this.renderTargetProgram_,n),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(a=>{this.uniforms_.push({value:e.uniforms[a],location:t.getUniformLocation(this.renderTargetProgram_,a)})})}getGL(){return this.gl_}init(e){const t=this.getGL(),i=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.getDepthBuffer()),t.viewport(0,0,i[0],i[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==i[0]||this.renderTargetTextureSize_[1]!==i[1]){this.renderTargetTextureSize_=i;const n=0,s=t.RGBA,a=0,o=t.RGBA,l=t.UNSIGNED_BYTE,h=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,n,s,i[0],i[1],a,o,l,h),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,i[0],i[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer_)}}apply(e,t,i,n){const s=this.getGL(),a=e.size;if(s.bindFramebuffer(s.FRAMEBUFFER,t?t.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!t){const l=Be(s.canvas);if(!e.renderTargets[l]){const h=s.getContextAttributes();h&&h.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),e.renderTargets[l]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,a[0],a[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const o=e.layerStatesArray[e.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,o),this.applyUniforms(e),i&&i(s,e),s.drawArrays(s.TRIANGLES,0,6),n&&n(s,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const t=this.getGL();let i,n=1;this.uniforms_.forEach(function(s){if(i=typeof s.value=="function"?s.value(e):s.value,i instanceof HTMLCanvasElement||i instanceof ImageData)s.texture||(s.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${n}`]),t.bindTexture(t.TEXTURE_2D,s.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,i.width,i.height,0,t.UNSIGNED_BYTE,new Uint8Array(i.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),t.uniform1i(s.location,n++);else if(Array.isArray(i))switch(i.length){case 2:t.uniform2f(s.location,i[0],i[1]);return;case 3:t.uniform3f(s.location,i[0],i[1],i[2]);return;case 4:t.uniform4f(s.location,i[0],i[1],i[2],i[3]);return;default:return}else typeof i=="number"&&t.uniform1f(s.location,i)})}}const Yl=Bx;function uc(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function cc(r,e){return r[0]=e[0],r[1]=e[1],r[4]=e[2],r[5]=e[3],r[12]=e[4],r[13]=e[5],r}const er={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},jt={UNSIGNED_BYTE:Lx,UNSIGNED_SHORT:Cx,UNSIGNED_INT:Ox,FLOAT:hc},Yn={};function Kl(r){return"shared/"+r}let Ql=0;function zx(){const r="unique/"+Ql;return Ql+=1,r}function kx(r){let e=Yn[r];if(!e){const t=document.createElement("canvas");t.width=1,t.height=1,t.style.position="absolute",t.style.left="0",e={users:0,context:Nx(t)},Yn[r]=e}return e.users+=1,e.context}function $x(r){const e=Yn[r];if(!e||(e.users-=1,e.users>0))return;const t=e.context,i=t.getExtension("WEBGL_lose_context");i&&i.loseContext();const n=t.canvas;n.width=1,n.height=1,delete Yn[r]}class jx extends Qh{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?Kl(e.canvasCacheKey):zx(),this.gl_=kx(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const t=this.gl_.canvas;t.addEventListener(En.LOST,this.boundHandleWebGLContextLost_),t.addEventListener(En.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=Ct(),this.offsetScaleMatrix_=Ct(),this.tmpMat4_=uc(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(i=>new Yl({webGlContext:this.gl_,scaleRatio:i.scaleRatio,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,uniforms:i.uniforms})):[new Yl({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===Kl(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}bindBuffer(e){const t=this.gl_,i=Be(e);let n=this.bufferCache_[i];if(!n){const s=t.createBuffer();n={buffer:e,webGlBuffer:s},this.bufferCache_[i]=n}t.bindBuffer(e.getType(),n.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=this.gl_,i=Be(e),n=this.bufferCache_[i];n&&!t.isContextLost()&&t.deleteBuffer(n.webGlBuffer),delete this.bufferCache_[i]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(En.LOST,this.boundHandleWebGLContextLost_),e.removeEventListener(En.RESTORED,this.boundHandleWebGLContextRestored_),$x(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,t,i){const n=this.gl_,s=this.getCanvas(),a=e.size,o=e.pixelRatio;(s.width!==a[0]*o||s.height!==a[1]*o)&&(s.width=a[0]*o,s.height=a[1]*o,s.style.width=a[0]+"px",s.style.height=a[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(e);n.bindTexture(n.TEXTURE_2D,null),n.clearColor(0,0,0,0),n.depthRange(0,1),n.clearDepth(1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,t?n.ZERO:n.ONE_MINUS_SRC_ALPHA),i?(n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL)):n.disable(n.DEPTH_TEST)}bindTexture(e,t,i){const n=this.gl_;n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_2D,e),n.uniform1i(this.getUniformLocation(i),t)}prepareDrawToRenderTarget(e,t,i,n){const s=this.gl_,a=t.getSize();s.bindFramebuffer(s.FRAMEBUFFER,t.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,t.getDepthbuffer()),s.viewport(0,0,a[0],a[1]),s.bindTexture(s.TEXTURE_2D,t.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,i?s.ZERO:s.ONE_MINUS_SRC_ALPHA),n?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(e,t){const i=this.gl_;this.getExtension("OES_element_index_uint");const n=i.UNSIGNED_INT,s=4,a=t-e,o=e*s;i.drawElements(i.TRIANGLES,a,n,o)}finalizeDraw(e,t,i){for(let n=0,s=this.postProcessPasses_.length;n<s;n++)n===s-1?this.postProcessPasses_[n].apply(e,null,t,i):this.postProcessPasses_[n].apply(e,this.postProcessPasses_[n+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const t=e.size,i=e.viewState.rotation,n=e.pixelRatio;this.setUniformFloatValue(er.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(er.ZOOM,e.viewState.zoom),this.setUniformFloatValue(er.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(er.PIXEL_RATIO,n),this.setUniformFloatVec2(er.VIEWPORT_SIZE_PX,[t[0],t[1]]),this.setUniformFloatValue(er.ROTATION,i)}applyHitDetectionUniform(e){const t=this.getUniformLocation(er.HIT_DETECTION);this.getGL().uniform1i(t,e?1:0),e&&this.setUniformFloatValue(er.PIXEL_RATIO,.5)}applyUniforms(e){const t=this.gl_;let i,n=0;this.uniforms_.forEach(s=>{if(i=typeof s.value=="function"?s.value(e):s.value,i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof ImageData)s.texture||(s.prevValue=void 0,s.texture=t.createTexture()),this.bindTexture(s.texture,n,s.name),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),(!(i instanceof HTMLImageElement)||i.complete)&&s.prevValue!==i&&(s.prevValue=i,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i)),n++;else if(Array.isArray(i)&&i.length===6)this.setUniformMatrixValue(s.name,cc(this.tmpMat4_,i));else if(Array.isArray(i)&&i.length<=4)switch(i.length){case 2:t.uniform2f(this.getUniformLocation(s.name),i[0],i[1]);return;case 3:t.uniform3f(this.getUniformLocation(s.name),i[0],i[1],i[2]);return;case 4:t.uniform4f(this.getUniformLocation(s.name),i[0],i[1],i[2],i[3]);return;default:return}else typeof i=="number"&&t.uniform1f(this.getUniformLocation(s.name),i)})}useProgram(e,t){this.gl_.useProgram(e),this.currentProgram_=e,this.applyFrameState(t),this.applyUniforms(t)}compileShader(e,t){const i=this.gl_,n=i.createShader(t);return i.shaderSource(n,e),i.compileShader(n),n}getProgram(e,t){const i=this.gl_,n=this.compileShader(e,i.FRAGMENT_SHADER),s=this.compileShader(t,i.VERTEX_SHADER),a=i.createProgram();if(i.attachShader(a,n),i.attachShader(a,s),i.linkProgram(a),!i.getShaderParameter(n,i.COMPILE_STATUS)){const o=`Fragment shader compilation failed: ${i.getShaderInfoLog(n)}`;throw new Error(o)}if(i.deleteShader(n),!i.getShaderParameter(s,i.COMPILE_STATUS)){const o=`Vertex shader compilation failed: ${i.getShaderInfoLog(s)}`;throw new Error(o)}if(i.deleteShader(s),!i.getProgramParameter(a,i.LINK_STATUS)){const o=`GL program linking failed: ${i.getProgramInfoLog(a)}`;throw new Error(o)}return a}getUniformLocation(e){const t=Be(this.currentProgram_);return this.uniformLocationsByProgram_[t]===void 0&&(this.uniformLocationsByProgram_[t]={}),this.uniformLocationsByProgram_[t][e]===void 0&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=Be(this.currentProgram_);return this.attribLocationsByProgram_[t]===void 0&&(this.attribLocationsByProgram_[t]={}),this.attribLocationsByProgram_[t][e]===void 0&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const i=e.size,n=e.viewState.rotation,s=e.viewState.resolution,a=e.viewState.center;return ka(t,0,0,2/(s*i[0]),2/(s*i[1]),-n,-a[0],-a[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}enableAttributeArray_(e,t,i,n,s){const a=this.getAttributeLocation(e);a<0||(this.gl_.enableVertexAttribArray(a),this.gl_.vertexAttribPointer(a,t,i,!1,n,s))}enableAttributes(e){const t=Zx(e);let i=0;for(let n=0;n<e.length;n++){const s=e[n];this.enableAttributeArray_(s.name,s.size,s.type||hc,t,i),i+=s.size*fc(s.type)}}handleWebGLContextLost(e){Rd(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,t,i){const n=this.gl_;i=i||n.createTexture();const s=0,a=n.RGBA,o=0,l=n.RGBA,h=n.UNSIGNED_BYTE;return n.bindTexture(n.TEXTURE_2D,i),t?n.texImage2D(n.TEXTURE_2D,s,a,l,h,t):n.texImage2D(n.TEXTURE_2D,s,a,e[0],e[1],o,l,h,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),i}}function Zx(r){let e=0;for(let t=0;t<r.length;t++){const i=r[t];e+=i.size*fc(i.type)}return e}function fc(r){switch(r){case jt.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case jt.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case jt.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case jt.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class xo extends bd{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=Ct(),this.pixelContext_=null,this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,e.addChangeListener(Jh.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const i=this.getLayer();if(i.hasListener(Mr.PRECOMPOSE)){const n=new Cs(Mr.PRECOMPOSE,void 0,t,e);i.dispatchEvent(n)}}dispatchPostComposeEvent(e,t){const i=this.getLayer();if(i.hasListener(Mr.POSTCOMPOSE)){const n=new Cs(Mr.POSTCOMPOSE,void 0,t,e);i.dispatchEvent(n)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t=!0,i=-1,n;for(let a=0,o=e.layerStatesArray.length;a<o;a++){const l=e.layerStatesArray[a].layer,h=l.getRenderer();if(!(h instanceof xo)){t=!0;continue}const c=l.getClassName();if((t||c!==n)&&(i+=1,t=!1),n=c,h===this)break}const s="map/"+e.mapId+"/group/"+i;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new jx({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),n&&(this.helper.getCanvas().className=n),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(e,t,i){const n=this.getLayer();if(n.hasListener(e)){ka(this.inversePixelTransform_,0,0,i.pixelRatio,-i.pixelRatio,0,0,-i.size[1]);const s=new Cs(e,this.inversePixelTransform_,i,t);n.dispatchEvent(s)}}preRender(e,t){this.dispatchRenderEvent_(Mr.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(Mr.POSTRENDER,e,t)}}const dc=xo,Gt=new Uint8Array(4);class qx{constructor(e,t){this.helper_=e;const i=e.getGL();this.texture_=i.createTexture(),this.framebuffer_=i.createFramebuffer(),this.depthbuffer_=i.createRenderbuffer(),this.size_=t||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(e){Pd(e,this.size_)||(this.size_[0]=e[0],this.size_[1]=e[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const e=this.size_,t=this.helper_.getGL();t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.readPixels(0,0,e[0],e[1],t.RGBA,t.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(e,t){if(e<0||t<0||e>this.size_[0]||t>=this.size_[1])return Gt[0]=0,Gt[1]=0,Gt[2]=0,Gt[3]=0,Gt;this.readAll();const i=Math.floor(e)+(this.size_[1]-Math.floor(t)-1)*this.size_[0];return Gt[0]=this.data_[i*4],Gt[1]=this.data_[i*4+1],Gt[2]=this.data_[i*4+2],Gt[3]=this.data_[i*4+3],Gt}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const e=this.size_,t=this.helper_.getGL();this.texture_=this.helper_.createTexture(e,null,this.texture_),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.viewport(0,0,e[0],e[1]),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture_,0),t.bindRenderbuffer(t.RENDERBUFFER,this.depthbuffer_),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e[0],e[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(e[0]*e[1]*4)}}const Xx=qx,Jl={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};var gc={exports:{}};gc.exports=Ss;gc.exports.default=Ss;function Ss(r,e,t){t=t||2;var i=e&&e.length,n=i?e[0]*t:r.length,s=mc(r,0,n,t,!0),a=[];if(!s||s.next===s.prev)return a;var o,l,h,c,u,d,m;if(i&&(s=Kx(r,e,s,t)),r.length>80*t){o=h=r[0],l=c=r[1];for(var g=t;g<n;g+=t)u=r[g],d=r[g+1],u<o&&(o=u),d<l&&(l=d),u>h&&(h=u),d>c&&(c=d);m=Math.max(h-o,c-l),m=m!==0?32767/m:0}return Yi(s,a,t,o,l,m,0),a}function mc(r,e,t,i,n){var s,a;if(n===Ea(r,e,t,i)>0)for(s=e;s<t;s+=i)a=eh(s,r[s],r[s+1],a);else for(s=t-i;s>=e;s-=i)a=eh(s,r[s],r[s+1],a);return a&&Ts(a,a.next)&&(Qi(a),a=a.next),a}function Or(r,e){if(!r)return r;e||(e=r);var t=r,i;do if(i=!1,!t.steiner&&(Ts(t,t.next)||Oe(t.prev,t,t.next)===0)){if(Qi(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Yi(r,e,t,i,n,s,a){if(r){!a&&s&&r1(r,i,n,s);for(var o=r,l,h;r.prev!==r.next;){if(l=r.prev,h=r.next,s?Wx(r,i,n,s):Hx(r)){e.push(l.i/t|0),e.push(r.i/t|0),e.push(h.i/t|0),Qi(r),r=h.next,o=h.next;continue}if(r=h,r===o){a?a===1?(r=Vx(Or(r),e,t),Yi(r,e,t,i,n,s,2)):a===2&&Yx(r,e,t,i,n,s):Yi(Or(r),e,t,i,n,s,1);break}}}}function Hx(r){var e=r.prev,t=r,i=r.next;if(Oe(e,t,i)>=0)return!1;for(var n=e.x,s=t.x,a=i.x,o=e.y,l=t.y,h=i.y,c=n<s?n<a?n:a:s<a?s:a,u=o<l?o<h?o:h:l<h?l:h,d=n>s?n>a?n:a:s>a?s:a,m=o>l?o>h?o:h:l>h?l:h,g=i.next;g!==e;){if(g.x>=c&&g.x<=d&&g.y>=u&&g.y<=m&&Yr(n,o,s,l,a,h,g.x,g.y)&&Oe(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function Wx(r,e,t,i){var n=r.prev,s=r,a=r.next;if(Oe(n,s,a)>=0)return!1;for(var o=n.x,l=s.x,h=a.x,c=n.y,u=s.y,d=a.y,m=o<l?o<h?o:h:l<h?l:h,g=c<u?c<d?c:d:u<d?u:d,y=o>l?o>h?o:h:l>h?l:h,_=c>u?c>d?c:d:u>d?u:d,v=xa(m,g,e,t,i),E=xa(y,_,e,t,i),S=r.prevZ,w=r.nextZ;S&&S.z>=v&&w&&w.z<=E;){if(S.x>=m&&S.x<=y&&S.y>=g&&S.y<=_&&S!==n&&S!==a&&Yr(o,c,l,u,h,d,S.x,S.y)&&Oe(S.prev,S,S.next)>=0||(S=S.prevZ,w.x>=m&&w.x<=y&&w.y>=g&&w.y<=_&&w!==n&&w!==a&&Yr(o,c,l,u,h,d,w.x,w.y)&&Oe(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;S&&S.z>=v;){if(S.x>=m&&S.x<=y&&S.y>=g&&S.y<=_&&S!==n&&S!==a&&Yr(o,c,l,u,h,d,S.x,S.y)&&Oe(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;w&&w.z<=E;){if(w.x>=m&&w.x<=y&&w.y>=g&&w.y<=_&&w!==n&&w!==a&&Yr(o,c,l,u,h,d,w.x,w.y)&&Oe(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function Vx(r,e,t){var i=r;do{var n=i.prev,s=i.next.next;!Ts(n,s)&&pc(n,i,i.next,s)&&Ki(n,s)&&Ki(s,n)&&(e.push(n.i/t|0),e.push(i.i/t|0),e.push(s.i/t|0),Qi(i),Qi(i.next),i=r=s),i=i.next}while(i!==r);return Or(i)}function Yx(r,e,t,i,n,s){var a=r;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&s1(a,o)){var l=yc(a,o);a=Or(a,a.next),l=Or(l,l.next),Yi(a,e,t,i,n,s,0),Yi(l,e,t,i,n,s,0);return}o=o.next}a=a.next}while(a!==r)}function Kx(r,e,t,i){var n=[],s,a,o,l,h;for(s=0,a=e.length;s<a;s++)o=e[s]*i,l=s<a-1?e[s+1]*i:r.length,h=mc(r,o,l,i,!1),h===h.next&&(h.steiner=!0),n.push(n1(h));for(n.sort(Qx),s=0;s<n.length;s++)t=Jx(n[s],t);return t}function Qx(r,e){return r.x-e.x}function Jx(r,e){var t=e1(r,e);if(!t)return e;var i=yc(t,r);return Or(i,i.next),Or(t,t.next)}function e1(r,e){var t=e,i=r.x,n=r.y,s=-1/0,a;do{if(n<=t.y&&n>=t.next.y&&t.next.y!==t.y){var o=t.x+(n-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(o<=i&&o>s&&(s=o,a=t.x<t.next.x?t:t.next,o===i))return a}t=t.next}while(t!==e);if(!a)return null;var l=a,h=a.x,c=a.y,u=1/0,d;t=a;do i>=t.x&&t.x>=h&&i!==t.x&&Yr(n<c?i:s,n,h,c,n<c?s:i,n,t.x,t.y)&&(d=Math.abs(n-t.y)/(i-t.x),Ki(t,r)&&(d<u||d===u&&(t.x>a.x||t.x===a.x&&t1(a,t)))&&(a=t,u=d)),t=t.next;while(t!==l);return a}function t1(r,e){return Oe(r.prev,r,e.prev)<0&&Oe(e.next,r,r.next)<0}function r1(r,e,t,i){var n=r;do n.z===0&&(n.z=xa(n.x,n.y,e,t,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==r);n.prevZ.nextZ=null,n.prevZ=null,i1(n)}function i1(r){var e,t,i,n,s,a,o,l,h=1;do{for(t=r,r=null,s=null,a=0;t;){for(a++,i=t,o=0,e=0;e<h&&(o++,i=i.nextZ,!!i);e++);for(l=h;o>0||l>0&&i;)o!==0&&(l===0||!i||t.z<=i.z)?(n=t,t=t.nextZ,o--):(n=i,i=i.nextZ,l--),s?s.nextZ=n:r=n,n.prevZ=s,s=n;t=i}s.nextZ=null,h*=2}while(a>1);return r}function xa(r,e,t,i,n){return r=(r-t)*n|0,e=(e-i)*n|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function n1(r){var e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function Yr(r,e,t,i,n,s,a,o){return(n-a)*(e-o)>=(r-a)*(s-o)&&(r-a)*(i-o)>=(t-a)*(e-o)&&(t-a)*(s-o)>=(n-a)*(i-o)}function s1(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!a1(r,e)&&(Ki(r,e)&&Ki(e,r)&&o1(r,e)&&(Oe(r.prev,r,e.prev)||Oe(r,e.prev,e))||Ts(r,e)&&Oe(r.prev,r,r.next)>0&&Oe(e.prev,e,e.next)>0)}function Oe(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function Ts(r,e){return r.x===e.x&&r.y===e.y}function pc(r,e,t,i){var n=Sn(Oe(r,e,t)),s=Sn(Oe(r,e,i)),a=Sn(Oe(t,i,r)),o=Sn(Oe(t,i,e));return!!(n!==s&&a!==o||n===0&&wn(r,t,e)||s===0&&wn(r,i,e)||a===0&&wn(t,r,i)||o===0&&wn(t,e,i))}function wn(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function Sn(r){return r>0?1:r<0?-1:0}function a1(r,e){var t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&pc(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1}function Ki(r,e){return Oe(r.prev,r,r.next)<0?Oe(r,e,r.next)>=0&&Oe(r,r.prev,e)>=0:Oe(r,e,r.prev)<0||Oe(r,r.next,e)<0}function o1(r,e){var t=r,i=!1,n=(r.x+e.x)/2,s=(r.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&n<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==r);return i}function yc(r,e){var t=new va(r.i,r.x,r.y),i=new va(e.i,e.x,e.y),n=r.next,s=e.prev;return r.next=e,e.prev=r,t.next=n,n.prev=t,i.next=t,t.prev=i,s.next=i,i.prev=s,i}function eh(r,e,t,i){var n=new va(r,e,t);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Qi(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function va(r,e,t){this.i=r,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Ss.deviation=function(r,e,t,i){var n=e&&e.length,s=n?e[0]*t:r.length,a=Math.abs(Ea(r,0,s,t));if(n)for(var o=0,l=e.length;o<l;o++){var h=e[o]*t,c=o<l-1?e[o+1]*t:r.length;a-=Math.abs(Ea(r,h,c,t))}var u=0;for(o=0;o<i.length;o+=3){var d=i[o]*t,m=i[o+1]*t,g=i[o+2]*t;u+=Math.abs((r[d]-r[g])*(r[m+1]-r[d+1])-(r[d]-r[m])*(r[g+1]-r[d+1]))}return a===0&&u===0?0:Math.abs((u-a)/a)};function Ea(r,e,t,i){for(var n=0,s=e,a=t-i;s<t;s+=i)n+=(r[a]-r[s])*(r[s+1]+r[a+1]),a=s;return n}Ss.flatten=function(r){for(var e=r[0][0].length,t={vertices:[],holes:[],dimensions:e},i=0,n=0;n<r.length;n++){for(var s=0;s<r[n].length;s++)for(var a=0;a<e;a++)t.vertices.push(r[n][s][a]);n>0&&(i+=r[n-1].length,t.holes.push(i))}return t};const th=.985;function l1(r,e){e=e||[];const t=256,i=t-1;return e[0]=Math.floor(r/t/t/t)/i,e[1]=Math.floor(r/t/t)%t/i,e[2]=Math.floor(r/t)%t/i,e[3]=r%t/i,e}function h1(r){let e=0;const t=256,i=t-1;return e+=Math.round(r[0]*t*t*t*i),e+=Math.round(r[1]*t*t*i),e+=Math.round(r[2]*t*i),e+=Math.round(r[3]*i),e}function u1(){const r='const e="GENERATE_POLYGON_BUFFERS",t="GENERATE_POINT_BUFFERS",n="GENERATE_LINE_STRING_BUFFERS";function r(e,t){const n=t[0],r=t[1];return t[0]=e[0]*n+e[2]*r+e[4],t[1]=e[1]*n+e[3]*r+e[5],t}function x(e,t){const n=(r=t)[0]*r[3]-r[1]*r[2];var r;!function(e,t){if(!e)throw new Error(t)}(0!==n,"Transformation matrix cannot be inverted");const x=t[0],i=t[1],u=t[2],o=t[3],f=t[4],s=t[5];return e[0]=o/n,e[1]=-i/n,e[2]=-u/n,e[3]=x/n,e[4]=(u*s-o*f)/n,e[5]=-(x*s-i*f)/n,e}function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}new Array(6);var u={exports:{}};function o(e,t,n){n=n||2;var r,x,i,u,o,s,l,v=t&&t.length,h=v?t[0]*n:e.length,c=f(e,0,h,n,!0),g=[];if(!c||c.next===c.prev)return g;if(v&&(c=function(e,t,n,r){var x,i,u,o=[];for(x=0,i=t.length;x<i;x++)(u=f(e,t[x]*r,x<i-1?t[x+1]*r:e.length,r,!1))===u.next&&(u.steiner=!0),o.push(d(u));for(o.sort(p),x=0;x<o.length;x++)n=y(o[x],n);return n}(e,t,c,n)),e.length>80*n){r=i=e[0],x=u=e[1];for(var b=n;b<h;b+=n)(o=e[b])<r&&(r=o),(s=e[b+1])<x&&(x=s),o>i&&(i=o),s>u&&(u=s);l=0!==(l=Math.max(i-r,u-x))?32767/l:0}return a(c,g,n,r,x,l,0),g}function f(e,t,n,r,x){var i,u;if(x===O(e,t,n,r)>0)for(i=t;i<n;i+=r)u=P(i,e[i],e[i+1],u);else for(i=n-r;i>=t;i-=r)u=P(i,e[i],e[i+1],u);return u&&m(u,u.next)&&(B(u),u=u.next),u}function s(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==w(r.prev,r,r.next))r=r.next;else{if(B(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function a(e,t,n,r,x,i,u){if(e){!u&&i&&function(e,t,n,r){var x=e;do{0===x.z&&(x.z=b(x.x,x.y,t,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==e);x.prevZ.nextZ=null,x.prevZ=null,function(e){var t,n,r,x,i,u,o,f,s=1;do{for(n=e,e=null,i=null,u=0;n;){for(u++,r=n,o=0,t=0;t<s&&(o++,r=r.nextZ);t++);for(f=s;o>0||f>0&&r;)0!==o&&(0===f||!r||n.z<=r.z)?(x=n,n=n.nextZ,o--):(x=r,r=r.nextZ,f--),i?i.nextZ=x:e=x,x.prevZ=i,i=x;n=r}i.nextZ=null,s*=2}while(u>1)}(x)}(e,r,x,i);for(var o,f,p=e;e.prev!==e.next;)if(o=e.prev,f=e.next,i?v(e,r,x,i):l(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(f.i/n|0),B(e),e=f.next,p=f.next;else if((e=f)===p){u?1===u?a(e=h(s(e),t,n),t,n,r,x,i,2):2===u&&c(e,t,n,r,x,i):a(s(e),t,n,r,x,i,1);break}}}function l(e){var t=e.prev,n=e,r=e.next;if(w(t,n,r)>=0)return!1;for(var x=t.x,i=n.x,u=r.x,o=t.y,f=n.y,s=r.y,a=x<i?x<u?x:u:i<u?i:u,l=o<f?o<s?o:s:f<s?f:s,v=x>i?x>u?x:u:i>u?i:u,h=o>f?o>s?o:s:f>s?f:s,c=r.next;c!==t;){if(c.x>=a&&c.x<=v&&c.y>=l&&c.y<=h&&M(x,o,i,f,u,s,c.x,c.y)&&w(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function v(e,t,n,r){var x=e.prev,i=e,u=e.next;if(w(x,i,u)>=0)return!1;for(var o=x.x,f=i.x,s=u.x,a=x.y,l=i.y,v=u.y,h=o<f?o<s?o:s:f<s?f:s,c=a<l?a<v?a:v:l<v?l:v,p=o>f?o>s?o:s:f>s?f:s,y=a>l?a>v?a:v:l>v?l:v,g=b(h,c,t,n,r),d=b(p,y,t,n,r),Z=e.prevZ,m=e.nextZ;Z&&Z.z>=g&&m&&m.z<=d;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;if(Z=Z.prevZ,m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;Z&&Z.z>=g;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;m&&m.z<=d;){if(m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function h(e,t,n){var r=e;do{var x=r.prev,i=r.next.next;!m(x,i)&&A(x,r,r.next,i)&&z(x,i)&&z(i,x)&&(t.push(x.i/n|0),t.push(r.i/n|0),t.push(i.i/n|0),B(r),B(r.next),r=e=i),r=r.next}while(r!==e);return s(r)}function c(e,t,n,r,x,i){var u=e;do{for(var o=u.next.next;o!==u.prev;){if(u.i!==o.i&&Z(u,o)){var f=F(u,o);return u=s(u,u.next),f=s(f,f.next),a(u,t,n,r,x,i,0),void a(f,t,n,r,x,i,0)}o=o.next}u=u.next}while(u!==e)}function p(e,t){return e.x-t.x}function y(e,t){var n=function(e,t){var n,r=t,x=e.x,i=e.y,u=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var o=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=x&&o>u&&(u=o,n=r.x<r.next.x?r:r.next,o===x))return n}r=r.next}while(r!==t);if(!n)return null;var f,s=n,a=n.x,l=n.y,v=1/0;r=n;do{x>=r.x&&r.x>=a&&x!==r.x&&M(i<l?x:u,i,a,l,i<l?u:x,i,r.x,r.y)&&(f=Math.abs(i-r.y)/(x-r.x),z(r,e)&&(f<v||f===v&&(r.x>n.x||r.x===n.x&&g(n,r)))&&(n=r,v=f)),r=r.next}while(r!==s);return n}(e,t);if(!n)return t;var r=F(n,e);return s(r,r.next),s(n,n.next)}function g(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function b(e,t,n,r,x){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function d(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function M(e,t,n,r,x,i,u,o){return(x-u)*(t-o)>=(e-u)*(i-o)&&(e-u)*(r-o)>=(n-u)*(t-o)&&(n-u)*(i-o)>=(x-u)*(r-o)}function Z(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&A(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(z(e,t)&&z(t,e)&&function(e,t){var n=e,r=!1,x=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!=n.next.y>i&&n.next.y!==n.y&&x<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||m(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function A(e,t,n,r){var x=I(w(e,t,n)),i=I(w(e,t,r)),u=I(w(n,r,e)),o=I(w(n,r,t));return x!==i&&u!==o||(!(0!==x||!E(e,n,t))||(!(0!==i||!E(e,r,t))||(!(0!==u||!E(n,e,r))||!(0!==o||!E(n,t,r)))))}function E(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function I(e){return e>0?1:e<0?-1:0}function z(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function F(e,t){var n=new _(e.i,e.x,e.y),r=new _(t.i,t.x,t.y),x=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=x,x.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function P(e,t,n,r){var x=new _(e,t,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function B(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function _(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(e,t,n,r){for(var x=0,i=t,u=n-r;i<n;i+=r)x+=(e[u]-e[i])*(e[i+1]+e[u+1]),u=i;return x}u.exports=o,u.exports.default=o,o.deviation=function(e,t,n,r){var x=t&&t.length,i=x?t[0]*n:e.length,u=Math.abs(O(e,0,i,n));if(x)for(var o=0,f=t.length;o<f;o++){var s=t[o]*n,a=o<f-1?t[o+1]*n:e.length;u-=Math.abs(O(e,s,a,n))}var l=0;for(o=0;o<r.length;o+=3){var v=r[o]*n,h=r[o+1]*n,c=r[o+2]*n;l+=Math.abs((e[v]-e[c])*(e[h+1]-e[v+1])-(e[v]-e[h])*(e[c+1]-e[v+1]))}return 0===u&&0===l?0:Math.abs((l-u)/u)},o.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,x=0;x<e.length;x++){for(var i=0;i<e[x].length;i++)for(var u=0;u<t;u++)n.vertices.push(e[x][i][u]);x>0&&(r+=e[x-1].length,n.holes.push(r))}return n};var N=i(u.exports);const R=[],S={vertexPosition:0,indexPosition:0};function T(e,t,n,r,x){e[t+0]=n,e[t+1]=r,e[t+2]=x}function U(e,t,n,r,x,i){const u=3+x,o=e[t+0],f=e[t+1],s=R;s.length=x;for(let n=0;n<s.length;n++)s[n]=e[t+2+n];let a=i?i.vertexPosition:0,l=i?i.indexPosition:0;const v=a/u;return T(n,a,o,f,0),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,1),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,2),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,3),s.length&&n.set(s,a+3),a+=u,r[l++]=v,r[l++]=v+1,r[l++]=v+3,r[l++]=v+1,r[l++]=v+2,r[l++]=v+3,S.vertexPosition=a,S.indexPosition=l,S}function k(e,t,n,x,i,u,o,f,s,a,l){const v=8+f.length,h=u.length/v,c=[e[t+0],e[t+1]],p=[e[n],e[n+1]],y=r(s,[...c]),g=r(s,[...p]);function b(e,t,n){const r=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),x=[(t[0]-e[0])/r,(t[1]-e[1])/r],i=[-x[1],x[0]],u=Math.sqrt((n[0]-e[0])*(n[0]-e[0])+(n[1]-e[1])*(n[1]-e[1])),o=[(n[0]-e[0])/u,(n[1]-e[1])/u],f=0===r||0===u?0:Math.acos((s=o[0]*x[0]+o[1]*x[1],a=-1,l=1,Math.min(Math.max(s,a),l)));var s,a,l;return o[0]*i[0]+o[1]*i[1]>0?f:2*Math.PI-f}let d=-1,M=-1,Z=l;const w=null!==i;if(null!==x){d=b(y,g,r(s,[...[e[x],e[x+1]]])),Math.cos(d)<=.985&&(Z+=Math.tan((d-Math.PI)/2))}if(w){M=b(g,y,r(s,[...[e[i],e[i+1]]])),Math.cos(M)<=.985&&(Z+=Math.tan((Math.PI-M)/2))}function m(e,t){return 0===t?1e4*e:Math.sign(t)*(1e4*e+Math.abs(t))}return u.push(c[0],c[1],p[0],p[1],d,M,a,m(0,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(1,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(2,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(3,l)),u.push(...f),o.push(h,h+1,h+2,h+1,h+3,h+2),{length:a+Math.sqrt((g[0]-y[0])*(g[0]-y[0])+(g[1]-y[1])*(g[1]-y[1])),angle:Z}}function G(e,t,n,r,x){const i=2+x;let u=t;const o=e.slice(u,u+x);u+=x;const f=e[u++];let s=0;const a=new Array(f-1);for(let t=0;t<f;t++)s+=e[u++],t<f-1&&(a[t]=s);const l=e.slice(u,u+2*s),v=N(l,a,2);for(let e=0;e<v.length;e++)r.push(v[e]+n.length/i);for(let e=0;e<l.length;e+=2)n.push(l[e],l[e+1],...o);return u+2*s}const j=self;j.onmessage=r=>{const i=r.data;switch(i.type){case t:{const e=3,t=2,n=i.customAttributesSize,r=t+n,x=new Float32Array(i.renderInstructions),u=x.length/r,o=4*u*(n+e),f=new Uint32Array(6*u),s=new Float32Array(o);let a;for(let e=0;e<x.length;e+=r)a=U(x,e,s,f,n,a);const l=Object.assign({vertexBuffer:s.buffer,indexBuffer:f.buffer,renderInstructions:x.buffer},i);j.postMessage(l,[s.buffer,f.buffer,x.buffer]);break}case n:{const e=[],t=[],n=i.customAttributesSize,r=2,u=new Float32Array(i.renderInstructions);let o=0;const f=[1,0,0,1,0,0];let s,a;for(x(f,i.renderInstructionsTransform);o<u.length;){a=Array.from(u.slice(o,o+n)),o+=n,s=u[o++];const x=o,i=o+(s-1)*r,l=u[x]===u[i]&&u[x+1]===u[i+1];let v=0,h=0;for(let n=0;n<s-1;n++){let c=null;n>0?c=o+(n-1)*r:l&&(c=i-r);let p=null;n<s-2?p=o+(n+2)*r:l&&(p=x+r);const y=k(u,o+n*r,o+(n+1)*r,c,p,e,t,a,f,v,h);v=y.length,h=y.angle}o+=s*r}const l=Uint32Array.from(t),v=Float32Array.from(e),h=Object.assign({vertexBuffer:v.buffer,indexBuffer:l.buffer,renderInstructions:u.buffer},i);j.postMessage(h,[v.buffer,l.buffer,u.buffer]);break}case e:{const e=[],t=[],n=i.customAttributesSize,r=new Float32Array(i.renderInstructions);let x=0;for(;x<r.length;)x=G(r,x,e,t,n);const u=Uint32Array.from(t),o=Float32Array.from(e),f=Object.assign({vertexBuffer:o.buffer,indexBuffer:u.buffer,renderInstructions:r.buffer},i);j.postMessage(f,[o.buffer,u.buffer,r.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(r,"binary").toString("base64"):URL.createObjectURL(new Blob([r],{type:"application/javascript"})))}function c1(r,e){const t=r.viewState.projection,n=e.getSource().getWrapX()&&t.canWrapX(),s=t.getExtent(),a=r.extent,o=n?xt(s):null,l=n?Math.ceil((a[2]-s[2])/o)+1:1;return[n?Math.floor((a[0]-s[0])/o):0,l,o]}class f1 extends dc{constructor(e,t){const i=t.uniforms||{},n=Ct();i[er.PROJECTION_MATRIX]=n,super(e,{uniforms:i,postProcesses:t.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new Vn(Es,_a),this.indicesBuffer_=new Vn(ws,_a),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.program_,this.hitDetectionEnabled_=t.hitDetectionEnabled??!0;const s=t.attributes?t.attributes.map(function(o){return{name:"a_prop_"+o.name,size:1,type:jt.FLOAT}}):[];this.attributes=[{name:"a_position",size:2,type:jt.FLOAT},{name:"a_index",size:1,type:jt.FLOAT}],this.hitDetectionEnabled_&&(this.attributes.push({name:"a_hitColor",size:4,type:jt.FLOAT}),this.attributes.push({name:"a_featureUid",size:1,type:jt.FLOAT})),this.attributes.push(...s),this.customAttributes=t.attributes?t.attributes:[],this.previousExtent_=$a(),this.currentTransform_=n,this.renderTransform_=Ct(),this.invertRenderTransform_=Ct(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=u1(),this.worker_.addEventListener("message",o=>{const l=o.data;if(l.type===Jl.GENERATE_POINT_BUFFERS){const h=l.projectionTransform;this.verticesBuffer_.fromArrayBuffer(l.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.fromArrayBuffer(l.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=h,Ad(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(o.data.renderInstructions),l.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const a=this.getLayer().getSource();this.sourceListenKeys_=[Ni(a,pn.ADDFEATURE,this.handleSourceFeatureAdded_,this),Ni(a,pn.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),Ni(a,pn.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),Ni(a,pn.CLEAR,this.handleSourceFeatureClear_,this)],a.forEachFeature(o=>{this.featureCache_[Be(o)]={feature:o,properties:o.getProperties(),geometry:o.getGeometry()},this.featureCount_++})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new Xx(this.helper))}handleSourceFeatureAdded_(e){const t=e.feature;this.featureCache_[Be(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(e){const t=e.feature;this.featureCache_[Be(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()}}handleSourceFeatureDelete_(e){const t=e.feature;delete this.featureCache_[Be(t)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[i,n,s]=c1(e,this.getLayer());return this.renderWorlds(e,!1,i,n,s),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,i,n,s),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),this.helper.getCanvas()}prepareFrameInternal(e){const t=this.getLayer(),i=t.getSource(),n=e.viewState,s=!e.viewHints[Bn.ANIMATING]&&!e.viewHints[Bn.INTERACTING],a=!Un(this.previousExtent_,e.extent),o=this.sourceRevision_<i.getRevision();if(o&&(this.sourceRevision_=i.getRevision()),s&&(a||o)){const l=n.projection,h=n.resolution,c=t instanceof ja?t.getRenderBuffer():0,u=eu(e.extent,c*h);i.loadFeatures(u,h,l),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.useProgram(this.program_,e),this.helper.prepareDraw(e),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(e){const t=Ct();this.helper.makeProjectionTransform(e,t);const n=(this.hitDetectionEnabled_?7:2)+this.customAttributes.length,s=n*this.featureCount_;(!this.renderInstructions_||this.renderInstructions_.length!==s)&&(this.renderInstructions_=new Float32Array(s));let a,o;const l=[],h=[];let c=-1;for(const d in this.featureCache_)if(a=this.featureCache_[d],o=a.geometry,!(!o||o.getType()!=="Point")){if(l[0]=o.getFlatCoordinates()[0],l[1]=o.getFlatCoordinates()[1],Vi(t,l),this.renderInstructions_[++c]=l[0],this.renderInstructions_[++c]=l[1],this.hitDetectionEnabled_){const m=l1(c+5,h);this.renderInstructions_[++c]=m[0],this.renderInstructions_[++c]=m[1],this.renderInstructions_[++c]=m[2],this.renderInstructions_[++c]=m[3],this.renderInstructions_[++c]=Number(d)}for(let m=0;m<this.customAttributes.length;m++){const g=this.customAttributes[m].callback(a.feature,a.properties);this.renderInstructions_[++c]=g}}const u={id:++this.lastSentId,type:Jl.GENERATE_POINT_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesSize:n-2};u.projectionTransform=t,this.ready=!1,this.worker_.postMessage(u,[this.renderInstructions_.buffer]),this.renderInstructions_=null}forEachFeatureAtCoordinate(e,t,i,n,s){if(Yt(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const a=Vi(t.coordinateToPixelTransform,e.slice()),o=this.hitRenderTarget_.readPixel(a[0]/2,a[1]/2),l=[o[0]/255,o[1]/255,o[2]/255,o[3]/255],h=h1(l),c=this.renderInstructions_[h],u=Math.floor(c).toString(),m=this.getLayer().getSource().getFeatureByUid(u);if(m)return n(m,this.getLayer(),null)}renderWorlds(e,t,i,n,s){let a=i;this.helper.useProgram(this.program_,e),t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0)),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes);do{this.helper.makeProjectionTransform(e,this.currentTransform_),tu(this.currentTransform_,a*s,0),Kh(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e),this.helper.applyHitDetectionUniform(t);const o=this.indicesBuffer_.getSize();this.helper.drawElements(0,o)}while(++a<n)}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach(function(e){aa(e)}),this.sourceListenKeys_=null,super.disposeInternal()}}const _c=f1;class d1{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}}const g1=d1;function Kn(r){return r instanceof Image||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageBitmap?r:null}function wa(r){return r instanceof Uint8Array||r instanceof Uint8ClampedArray||r instanceof Float32Array||r instanceof DataView?r:null}let Br=null;function m1(r){Br||(Br=sr(r.width,r.height,void 0,{willReadFrequently:!0}));const e=Br.canvas,t=r.width;e.width!==t&&(e.width=t);const i=r.height;return e.height!==i&&(e.height=i),Br.clearRect(0,0,t,i),Br.drawImage(r,0,0),Br.getImageData(0,0,t,i).data}const p1=[256,256];let y1=class extends ru{constructor(e){const t=ie.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null}getSize(){if(this.size_)return this.size_;const e=Kn(this.data_);return e?[e.width,e.height]:p1}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==ie.IDLE&&this.state!==ie.ERROR)return;this.state=ie.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=ie.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=ie.ERROR,e.changed()})}};const vo=y1;class _1 extends vo{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:e.interpolate,transition:e.transition}),this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const t=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),i=this.targetTileGrid_.getExtent();let n=this.sourceTileGrid_.getExtent();const s=i?Xt(t,i):t;if(ul(s)===0){this.state=ie.EMPTY;return}const a=e.sourceProj,o=a.getExtent();o&&(n?n=Xt(n,o):n=o);const l=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),h=e.targetProj,c=Ld(a,h,s,l);if(!isFinite(c)||c<=0){this.state=ie.EMPTY;return}const u=e.errorThreshold!==void 0?e.errorThreshold:Cd;if(this.triangulation_=new Od(a,h,s,n,c*u,l),this.triangulation_.getTriangles().length===0){this.state=ie.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(c);let d=this.triangulation_.calculateSourceExtent();if(n&&(a.canWrapX()?(d[1]=Ie(d[1],n[1],n[3]),d[3]=Ie(d[3],n[1],n[3])):d=Xt(d,n)),!ul(d))this.state=ie.EMPTY;else{const m=this.sourceTileGrid_.getTileRangeForExtentAndZ(d,this.sourceZ_),g=e.getTileFunction;for(let y=m.minX;y<=m.maxX;y++)for(let _=m.minY;_<=m.maxY;_++){const v=g(this.sourceZ_,y,_,this.pixelRatio_);v&&this.sourceTiles_.push(v)}this.sourceTiles_.length===0&&(this.state=ie.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{if(!t||t.getState()!==ie.LOADED)return;const i=t.getSize(),n=this.gutter_;let s;const a=wa(t.getData());a?s=a:s=m1(Kn(t.getData()));const o=[i[0]+2*n,i[1]+2*n],l=s instanceof Float32Array,h=o[0]*o[1],c=l?Float32Array:Uint8Array,u=new c(s.buffer),d=c.BYTES_PER_ELEMENT,m=d*u.length/h,g=u.byteLength/o[1],y=Math.floor(g/d/o[0]),_=h*y;let v=u;if(u.length!==_){v=new c(_);let E=0,S=0;const w=o[0]*y;for(let P=0;P<o[1];++P){for(let A=0;A<w;++A)v[E++]=u[S+A];S+=g/d}}e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),data:new Uint8Array(v.buffer),dataType:c,bytesPerPixel:m,pixelSize:o})}),this.sourceTiles_.length=0,e.length===0)this.state=ie.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),n=typeof i=="number"?i:i[0],s=typeof i=="number"?i:i[1],a=this.targetTileGrid_.getResolution(t),o=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let h,c;const u=e[0].bytesPerPixel,d=Math.ceil(u/3);for(let m=d-1;m>=0;--m){const g=[];for(let w=0,P=e.length;w<P;++w){const A=e[w],I=A.data,C=A.pixelSize,k=C[0],B=C[1],H=sr(k,B,Os),Y=H.createImageData(k,B),f=Y.data;let p=m*3;for(let x=0,R=f.length;x<R;x+=4)f[x]=I[p],f[x+1]=I[p+1],f[x+2]=I[p+2],f[x+3]=255,p+=u;H.putImageData(Y,0,0),g.push({extent:A.extent,image:H.canvas})}const y=Id(n,s,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),a,l,this.triangulation_,g,this.gutter_,!1,!1);for(let w=0,P=g.length;w<P;++w){const I=g[w].image.getContext("2d");cl(I),Os.push(I.canvas)}const _=y.getContext("2d"),v=_.getImageData(0,0,y.width,y.height);cl(_),Os.push(y),h||(c=new Uint8Array(u*v.width*v.height),h=new e[0].dataType(c.buffer));const E=v.data;let S=m*3;for(let w=0,P=E.length;w<P;w+=4)E[w+3]===255?(c[S]=E[w],c[S+1]=E[w+1],c[S+2]=E[w+2]):(c[S]=0,c[S+1]=0,c[S+2]=0),S+=u}this.reprojData_=h,this.reprojSize_=[Math.round(n*this.pixelRatio_),Math.round(s*this.pixelRatio_)],this.state=ie.LOADED}this.changed()}load(){if(this.state!==ie.IDLE&&this.state!==ie.ERROR)return;this.state=ie.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const i=t.getState();if(i!==ie.IDLE&&i!==ie.LOADING)return;e++;const n=Ni(t,ct.CHANGE,function(){const s=t.getState();(s==ie.LOADED||s==ie.ERROR||s==ie.EMPTY)&&(aa(n),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(n)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t){t.getState()==ie.IDLE&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(aa),this.sourcesListenerKeys_=null}}const Eo=_1;class x1 extends Nd{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=e.gutter||0,this.helper_=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(ct.CHANGE,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===ie.LOADED,this.loaded)this.uploadTile();else{if(e instanceof Za){const t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(ct.CHANGE,this.handleTileChange_)}}uploadTile(){$t()}setReady(){this.ready=!0,this.dispatchEvent(ct.CHANGE)}handleTileChange_(){this.tile.getState()===ie.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(ct.CHANGE,this.handleTileChange_)}}const v1=x1;function xc(r,e,t){const i=t?r.LINEAR:r.NEAREST;r.bindTexture(r.TEXTURE_2D,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,i)}function E1(r,e,t,i){xc(r,e,i),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)}function rh(r,e,t,i,n,s){const a=r.getGL();let o,l;t instanceof Float32Array?(o=a.FLOAT,r.getExtension("OES_texture_float"),l=r.getExtension("OES_texture_float_linear")!==null):(o=a.UNSIGNED_BYTE,l=!0),xc(a,e,s&&l);const h=t.byteLength/i[1];let c=1;h%8===0?c=8:h%4===0?c=4:h%2===0&&(c=2);let u;switch(n){case 1:{u=a.LUMINANCE;break}case 2:{u=a.LUMINANCE_ALPHA;break}case 3:{u=a.RGB;break}case 4:{u=a.RGBA;break}default:throw new Error(`Unsupported number of bands: ${n}`)}const d=a.getParameter(a.UNPACK_ALIGNMENT);a.pixelStorei(a.UNPACK_ALIGNMENT,c),a.texImage2D(a.TEXTURE_2D,0,u,i[0],i[1],0,u,o,t),a.pixelStorei(a.UNPACK_ALIGNMENT,d)}let qr=null;function w1(){qr=sr(1,1,void 0,{willReadFrequently:!0})}class S1 extends v1{constructor(e){super(e),this.textures=[],this.renderSize_=Ht(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const t=new Vn(Es,_o);t.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(t),this.coords=t,this.setTile(e.tile)}uploadTile(){const e=this.helper_,t=e.getGL(),i=this.tile;this.textures.length=0;let n;i instanceof Za||i instanceof qa?n=i.getImage():n=i.getData();const s=Kn(n);if(s){const E=t.createTexture();this.textures.push(E),this.bandCount=4,E1(t,E,s,i.interpolate),this.setReady();return}n=wa(n);const a=i.getSize(),o=[a[0]+2*this.gutter_,a[1]+2*this.gutter_],l=n instanceof Float32Array,h=o[0]*o[1],c=l?Float32Array:Uint8Array,u=c.BYTES_PER_ELEMENT,d=n.byteLength/o[1];this.bandCount=Math.floor(d/u/o[0]);const m=Math.ceil(this.bandCount/4);if(m===1){const E=t.createTexture();this.textures.push(E),rh(e,E,n,o,this.bandCount,i.interpolate),this.setReady();return}const g=new Array(m);for(let E=0;E<m;++E){const S=t.createTexture();this.textures.push(S);const w=E<m-1?4:(this.bandCount-1)%4+1;g[E]=new c(h*w)}let y=0,_=0;const v=o[0]*this.bandCount;for(let E=0;E<o[1];++E){for(let S=0;S<v;++S){const w=n[_+S],P=Math.floor(y/this.bandCount),A=S%this.bandCount,I=Math.floor(A/4),C=g[I],k=C.length/h,B=A%4;C[P*k+B]=w,++y}_+=d/u}for(let E=0;E<m;++E){const S=this.textures[E],w=g[E],P=w.length/h;rh(e,S,w,o,P,i.interpolate)}this.setReady()}disposeInternal(){const e=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let t=0;t<this.textures.length;++t)e.deleteTexture(this.textures[t]);this.tile.removeEventListener(ct.CHANGE,this.handleTileChange_)}getImagePixelData_(e,t,i){const n=this.gutter_,s=this.renderSize_[0],a=this.renderSize_[1];qr||w1(),qr.clearRect(0,0,1,1);const o=e.width,l=e.height,h=o-2*n,c=l-2*n,u=n+Math.floor(h*(t/s)),d=n+Math.floor(c*(i/a));let m;try{qr.drawImage(e,u,d,1,1,0,0,1,1),m=qr.getImageData(0,0,1,1).data}catch{return qr=null,null}return m}getArrayPixelData_(e,t,i,n){const s=this.gutter_,a=this.renderSize_[0],o=this.renderSize_[1],l=t[0],h=t[1],c=l+2*s,u=h+2*s,d=s+Math.floor(l*(i/a)),m=s+Math.floor(h*(n/o));if(e instanceof DataView){const y=e.byteLength/(c*u),_=y*(m*c+d),v=e.buffer.slice(_,_+y);return new DataView(v)}const g=this.bandCount*(m*c+d);return e.slice(g,g+this.bandCount)}getPixelData(e,t){if(!this.loaded)return null;if(this.tile instanceof vo){const i=this.tile.getData(),n=wa(i);if(n){const s=this.tile.getSize();return this.getArrayPixelData_(n,s,e,t)}return this.getImagePixelData_(Kn(i),e,t)}return this.getImagePixelData_(this.tile.getImage(),e,t)}}const T1=S1,M1={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},R1={};function ih(r){return 1/(r+2)}function b1(){return{tileIds:new Set,representationsByZ:{}}}function nh(r,e){return r.tileIds.has(Be(e))}function sh(r,e,t){const i=r.representationsByZ;t in i||(i[t]=new Set),i[t].add(e),r.tileIds.add(Be(e.tile))}function ks(r,e){const t=r.layerStatesArray[r.layerIndex];t.extent&&(e=Xt(e,nu(t.extent,r.viewState.projection)));const i=t.layer.getRenderSource();if(!i.getWrapX()){const n=i.getTileGridForProjection(r.viewState.projection).getExtent();n&&(e=Xt(e,n))}return e}function Sa(r,e){return`${r.getKey()},${Zr(e)}`}class P1 extends dc{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=Ct(),this.tempMat4=uc(),this.tempTileRange_=new Fd(0,0,0,0),this.tempTileCoord_=oa(0,0,0),this.tempSize_=[0,0];const i=t.cacheSize!==void 0?t.cacheSize:512;this.tileRepresentationCache=new iu(i),this.frameState=null,this.projection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}isDrawableTile_(e){const t=this.getLayer(),i=e.getState(),n=t.getUseInterimTilesOnError();return i==ie.LOADED||i==ie.EMPTY||i==ie.ERROR&&!n}prepareFrameInternal(e){this.projection_?e.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=e.viewState.projection):this.projection_=e.viewState.projection;const i=this.getLayer().getRenderSource();return!i||za(ks(e,e.extent))?!1:i.getState()==="ready"}createTileRepresentation(e){return $t()}enqueueTiles(e,t,i,n,s){const a=e.viewState,o=this.getLayer(),l=o.getRenderSource(),h=l.getTileGridForProjection(a.projection),c=l.getGutterForProjection(a.projection),u=Be(l);u in e.wantedTiles||(e.wantedTiles[u]={});const d=e.wantedTiles[u],m=this.tileRepresentationCache,g=o.getMapInternal(),y=Math.max(i-s,h.getMinZoom(),h.getZForResolution(Math.min(o.getMaxResolution(),g?g.getView().getResolutionForZoom(Math.max(o.getMinZoom(),0)):h.getResolution(0)),l.zDirection));for(let _=i;_>=y;--_){const v=h.getTileRangeForExtentAndZ(t,_,this.tempTileRange_),E=h.getResolution(_);for(let S=v.minX;S<=v.maxX;++S)for(let w=v.minY;w<=v.maxY;++w){const P=oa(_,S,w,this.tempTileCoord_),A=Sa(l,P);let I,C;if(m.containsKey(A)&&(I=m.get(A),C=I.tile),(!I||I.tile.key!==l.getKey())&&(C=l.getTile(_,S,w,e.pixelRatio,a.projection)),nh(n,C))continue;if(!I)I=this.createTileRepresentation({tile:C,grid:h,helper:this.helper,gutter:c}),m.set(A,I);else if(this.isDrawableTile_(C))I.setTile(C);else{const B=C.getInterimTile();I.setTile(B)}sh(n,I,_);const k=C.getKey();d[k]=!0,C.getState()===ie.IDLE&&(e.tileQueue.isKeyQueued(k)||e.tileQueue.enqueue([C,u,h.getTileCoordCenter(P),E]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t,!0)}beforeTilesMaskRender(e){return!1}renderTile(e,t,i,n,s,a,o,l,h,c,u){}renderTileMask(e,t,i,n){}drawTile_(e,t,i,n,s,a,o){if(!t.ready)return;const h=t.tile.tileCoord,c=Zr(h),u=c in a?a[c]:1,d=o.getResolution(i),m=Ht(o.getTileSize(i),this.tempSize_),g=o.getOrigin(i),y=o.getTileCoordExtent(h),_=u<1?-1:ih(i);u<1&&(e.animate=!0);const v=e.viewState,E=v.center[0],S=v.center[1],w=m[0]+2*n,P=m[1]+2*n,A=w/P,I=(E-g[0])/(m[0]*d),C=(g[1]-S)/(m[1]*d),k=v.resolution/d,B=h[1],H=h[2];Dd(this.tileTransform_),fl(this.tileTransform_,2/(e.size[0]*k/w),-2/(e.size[1]*k/w)),Gd(this.tileTransform_,v.rotation),fl(this.tileTransform_,1,1/A),tu(this.tileTransform_,(m[0]*(B-I)-n)/w,(m[1]*(H-C)-n)/P),this.renderTile(t,this.tileTransform_,e,s,d,m,g,y,_,n,u)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const t=this.helper.getGL();this.preRender(t,e);const i=e.viewState,n=this.getLayer(),s=n.getRenderSource(),a=s.getTileGridForProjection(i.projection),o=s.getGutterForProjection(i.projection),l=ks(e,e.extent),h=a.getZForResolution(i.resolution,s.zDirection),c=b1(),u=n.getPreload();if(e.nextExtent){const A=a.getZForResolution(i.nextResolution,s.zDirection),I=ks(e,e.nextExtent);this.enqueueTiles(e,I,A,c,u)}this.enqueueTiles(e,l,h,c,0),u>0&&setTimeout(()=>{this.enqueueTiles(e,l,h-1,c,u-1)},0);const d={},m=Be(this),g=e.time;let y=!1;for(const A of c.representationsByZ[h]){const I=A.tile;if((I instanceof qa||I instanceof Eo)&&I.getState()===ie.EMPTY)continue;const C=I.tileCoord;if(A.ready){const H=I.getAlpha(m,g);if(H===1){I.endTransition(m);continue}y=!0;const Y=Zr(C);d[Y]=H}if(this.renderComplete=!1,this.findAltTiles_(a,C,h+1,c))continue;const B=a.getMinZoom();for(let H=h-1;H>=B&&!this.findAltTiles_(a,C,H,c);--H);}const _=c.representationsByZ,v=Object.keys(_).map(Number).sort(Ud);if(this.beforeTilesMaskRender(e))for(let A=0,I=v.length;A<I;++A){const C=v[A];for(const k of _[C]){const B=k.tile.tileCoord;if(Zr(B)in d)continue;const Y=a.getTileCoordExtent(B);this.renderTileMask(k,C,Y,ih(C))}}this.beforeTilesRender(e,y);for(let A=0,I=v.length;A<I;++A){const C=v[A];for(const k of _[C]){const B=k.tile.tileCoord;Zr(B)in d||this.drawTile_(e,k,C,o,l,d,a)}}for(const A of _[h]){const I=A.tile.tileCoord;Zr(I)in d&&this.drawTile_(e,A,h,o,l,d,a)}this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const S=this.helper.getCanvas(),w=this.tileRepresentationCache;for(;w.canExpireCache();)w.pop().dispose();const P=function(A,I){s.updateCacheSize(.1,I.viewState.projection),s.expireCache(I.viewState.projection,R1)};return e.postRenderFunctions.push(P),this.postRender(t,e),S}findAltTiles_(e,t,i,n){const s=e.getTileRangeForTileCoordAndZ(t,i,this.tempTileRange_);if(!s)return!1;let a=!0;const o=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let h=s.minX;h<=s.maxX;++h)for(let c=s.minY;c<=s.maxY;++c){const u=Sa(l,[i,h,c]);let d=!1;if(o.containsKey(u)){const m=o.get(u);m.ready&&!nh(n,m.tile)&&(sh(n,m,i),d=!0)}d||(a=!1)}return a}clearCache(){const e=this.tileRepresentationCache;e.forEach(t=>t.dispose()),e.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const A1=P1,ae={...M1,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},In={TEXTURE_COORD:"a_textureCoord"},I1=[{name:In.TEXTURE_COORD,size:2,type:jt.FLOAT}];class L1 extends A1{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new Vn(ws,_o),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){super.reset(e),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(e){return new T1(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,i,n,s,a,o,l,h,c,u){const d=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(I1);let m=0;for(;m<e.textures.length;){const A=`${ae.TILE_TEXTURE_ARRAY}[${m}]`;this.helper.bindTexture(e.textures[m],m,A),++m}for(let A=0;A<this.paletteTextures_.length;++A){const I=this.paletteTextures_[A],C=I.getTexture(d);this.helper.bindTexture(C,m,I.name),++m}const g=i.viewState,y=a[0]+2*c,_=a[1]+2*c,E=e.tile.tileCoord,S=E[1],w=E[2];this.helper.setUniformMatrixValue(ae.TILE_TRANSFORM,cc(this.tempMat4,t)),this.helper.setUniformFloatValue(ae.TRANSITION_ALPHA,u),this.helper.setUniformFloatValue(ae.DEPTH,h);let P=n;c>0&&(P=l,Xt(P,n,P)),this.helper.setUniformFloatVec4(ae.RENDER_EXTENT,P),this.helper.setUniformFloatValue(ae.RESOLUTION,g.resolution),this.helper.setUniformFloatValue(ae.ZOOM,g.zoom),this.helper.setUniformFloatValue(ae.TEXTURE_PIXEL_WIDTH,y),this.helper.setUniformFloatValue(ae.TEXTURE_PIXEL_HEIGHT,_),this.helper.setUniformFloatValue(ae.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(ae.TEXTURE_ORIGIN_X,o[0]+S*a[0]*s-c*s),this.helper.setUniformFloatValue(ae.TEXTURE_ORIGIN_Y,o[1]-w*a[1]*s+c*s),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;const i=this.frameState;if(!i)return null;const n=this.getLayer(),s=Vi(i.pixelToCoordinateTransform,e.slice()),a=i.viewState,o=n.getExtent();if(o&&!Vr(nu(o,a.projection),s))return null;const l=n.getSources(Wh([s]),a.resolution);let h,c,u;for(h=l.length-1;h>=0;--h)if(c=l[h],c.getState()==="ready"){if(u=c.getTileGridForProjection(a.projection),c.getWrapX())break;const m=u.getExtent();if(!m||Vr(m,s))break}if(h<0)return null;const d=this.tileRepresentationCache;for(let m=u.getZForResolution(a.resolution);m>=u.getMinZoom();--m){const g=u.getTileCoordForCoordAndZ(s,m),y=Sa(c,g);if(!d.containsKey(y))continue;const _=d.get(y),v=_.tile;if((v instanceof qa||v instanceof Eo)&&v.getState()===ie.EMPTY)return null;if(!_.loaded)continue;const E=u.getOrigin(m),S=Ht(u.getTileSize(m)),w=u.getResolution(m),P=(s[0]-E[0])/w-g[1]*S[0],A=(E[1]-s[1])/w-g[2]*S[1];return _.getPixelData(P,A)}return null}disposeInternal(){const e=this.helper;e&&(e.getGL().deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_}}const C1=L1;function O1(r,e){return`operator_${r}_${Object.keys(e.functions).length}`}function Ar(r){const e=r.toString();return e.includes(".")?e:e+".0"}function wo(r){if(r.length<2||r.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${r.length}(${r.map(Ar).join(", ")})`}function Ln(r){const e=hi(r),t=e.length>3?e[3]:1;return wo([e[0]/255*t,e[1]/255*t,e[2]/255*t,t])}const $s={};let N1=0;function Qn(r){return r in $s||($s[r]=N1++),$s[r]}function rr(r){return Ar(Qn(r))}function So(r){return"u_var_"+r}function F1(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{}}}const js="getBandValue",vc="u_paletteTextures";function D1(r,e,t,i){const n=Bd(r,t,e);if(zd(n.type,jd))throw new Error("No matching type was found");if(!kd(e,n.type)){const s=la(e),a=la(n.type);throw new Error(`Expected expression to be of type ${s}, got ${a}`)}return To(n,e,i)}function ve(r){return(e,t,i)=>{const n=t.args.length,s=new Array(n);for(let a=0;a<n;++a)s[a]=To(t.args[a],i,e);return r(s,e)}}const G1={[ue.Get]:(r,e)=>{const i=e.args[0].value;return i in r.properties||(r.properties[i]={name:i,type:e.type}),(r.inFragmentShader?"v_prop_":"a_prop_")+i},[ue.GeometryType]:(r,e,t)=>{const i="geometryType",n=o=>{const l=o.getType();switch(l){case"Point":case"LineString":case"Polygon":return l;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return l.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return n(o.getGeometries()[0])}};return i in r.properties||(r.properties[i]={name:i,type:ci,evaluator:o=>n(o.getGeometry())}),(r.inFragmentShader?"v_prop_":"a_prop_")+i},[ue.Var]:(r,e)=>{const i=e.args[0].value;return i in r.variables||(r.variables[i]={name:i,type:e.type}),So(i)},[ue.Resolution]:()=>"u_resolution",[ue.Zoom]:()=>"u_zoom",[ue.Time]:()=>"u_time",[ue.Any]:ve(r=>`(${r.join(" || ")})`),[ue.All]:ve(r=>`(${r.join(" && ")})`),[ue.Not]:ve(([r])=>`(!${r})`),[ue.Equal]:ve(([r,e])=>`(${r} == ${e})`),[ue.NotEqual]:ve(([r,e])=>`(${r} != ${e})`),[ue.GreaterThan]:ve(([r,e])=>`(${r} > ${e})`),[ue.GreaterThanOrEqualTo]:ve(([r,e])=>`(${r} >= ${e})`),[ue.LessThan]:ve(([r,e])=>`(${r} < ${e})`),[ue.LessThanOrEqualTo]:ve(([r,e])=>`(${r} <= ${e})`),[ue.Multiply]:ve(r=>`(${r.join(" * ")})`),[ue.Divide]:ve(([r,e])=>`(${r} / ${e})`),[ue.Add]:ve(r=>`(${r.join(" + ")})`),[ue.Subtract]:ve(([r,e])=>`(${r} - ${e})`),[ue.Clamp]:ve(([r,e,t])=>`clamp(${r}, ${e}, ${t})`),[ue.Mod]:ve(([r,e])=>`mod(${r}, ${e})`),[ue.Pow]:ve(([r,e])=>`pow(${r}, ${e})`),[ue.Abs]:ve(([r])=>`abs(${r})`),[ue.Floor]:ve(([r])=>`floor(${r})`),[ue.Ceil]:ve(([r])=>`ceil(${r})`),[ue.Round]:ve(([r])=>`floor(${r} + 0.5)`),[ue.Sin]:ve(([r])=>`sin(${r})`),[ue.Cos]:ve(([r])=>`cos(${r})`),[ue.Atan]:ve(([r,e])=>e!==void 0?`atan(${r}, ${e})`:`atan(${r})`),[ue.Sqrt]:ve(([r])=>`sqrt(${r})`),[ue.Match]:ve(r=>{const e=r[0],t=r[r.length-1];let i=null;for(let n=r.length-3;n>=1;n-=2){const s=r[n],a=r[n+1];i=`(${e} == ${s} ? ${a} : ${i||t})`}return i}),[ue.Between]:ve(([r,e,t])=>`(${r} >= ${e} && ${r} <= ${t})`),[ue.Interpolate]:ve(([r,e,...t])=>{let i="";for(let n=0;n<t.length-2;n+=2){const s=t[n],a=i||t[n+1],o=t[n+2],l=t[n+3];let h;r===Ar(1)?h=`(${e} - ${s}) / (${o} - ${s})`:h=`(pow(${r}, (${e} - ${s})) - 1.0) / (pow(${r}, (${o} - ${s})) - 1.0)`,i=`mix(${a}, ${l}, clamp(${h}, 0.0, 1.0))`}return i}),[ue.Case]:ve(r=>{const e=r[r.length-1];let t=null;for(let i=r.length-3;i>=0;i-=2){const n=r[i],s=r[i+1];t=`(${n} ? ${s} : ${t||e})`}return t}),[ue.In]:ve(([r,...e],t)=>{const i=O1("in",t),n=[];for(let s=0;s<e.length;s+=1)n.push(`  if (inputValue == ${e[s]}) { return true; }`);return t.functions[i]=`bool ${i}(float inputValue) {
${n.join(`
`)}
  return false;
}`,`${i}(${r})`}),[ue.Array]:ve(r=>`vec${r.length}(${r.join(", ")})`),[ue.Color]:ve(r=>{const e=r.slice(0,3).map(i=>`${i} / 255.0`);return r.length===3?`vec4(${e.join(", ")}, 1.0)`:`(${r[3]} * vec4(${e.join(", ")}, 1.0))`}),[ue.Band]:ve(([r,e,t],i)=>{if(!(js in i.functions)){let n="";const s=i.bandCount||1;for(let a=0;a<s;a++){const o=Math.floor(a/4);let l=a%4;a===s-1&&l===1&&(l=3);const h=`${ae.TILE_TEXTURE_ARRAY}[${o}]`;n+=`  if (band == ${a+1}.0) {
    return texture2D(${h}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}i.functions[js]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${ae.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${ae.TEXTURE_PIXEL_HEIGHT};
${n}
}`}return`${js}(${r}, ${e??"0.0"}, ${t??"0.0"})`}),[ue.Palette]:(r,e)=>{const[t,...i]=e.args,n=i.length,s=new Uint8Array(n*4);for(let h=0;h<i.length;h++){const c=i[h].value,u=hi(c),d=h*4;s[d]=u[0],s[d+1]=u[1],s[d+2]=u[2],s[d+3]=u[3]*255}r.paletteTextures||(r.paletteTextures=[]);const a=`${vc}[${r.paletteTextures.length}]`,o=new g1(a,s);r.paletteTextures.push(o);const l=To(t,xe,r);return`texture2D(${a}, vec2((${l} + 0.5) / ${n}.0, 0.5))`}};function To(r,e,t){if(r instanceof $d){const i=G1[r.operator];if(i===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(r.operator)}`);return i(t,r,e)}if((r.type&xe)>0)return Ar(r.value);if((r.type&bn)>0)return r.value.toString();if((r.type&ci)>0)return rr(r.value.toString());if((r.type&vt)>0)return Ln(r.value);if((r.type&bt)>0)return wo(r.value);throw new Error(`Unexpected expression ${r.value} (expected type ${la(e)})`)}function U1(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}const zr=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;

// this used to produce an alpha-premultiplied color from a texture
vec4 samplePremultiplied(sampler2D sampler, vec2 texCoord) {
  vec4 color = texture2D(sampler, texCoord);
  return vec4(color.rgb * color.a, color.a);
}
`,kr=U1();class Ec{constructor(){this.uniforms_=[],this.attributes_=[],this.varyings_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${Ar(kr["circle-radius"])} + ${Ar(kr["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=Ln(kr["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=Ar(kr["stroke-width"]),this.strokeColorExpression_=Ln(kr["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=rr("round"),this.strokeJoinExpression_=rr("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.hasFill_=!1,this.fillColorExpression_=Ln(kr["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(e){return this.uniforms_.push(e),this}addAttribute(e){return this.attributes_.push(e),this}addVarying(e,t,i){return this.varyings_.push({name:e,type:t,expression:i}),this}setSymbolSizeExpression(e){return this.hasSymbol_=!0,this.symbolSizeExpression_=e,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(e){return this.symbolRotationExpression_=e,this}setSymbolOffsetExpression(e){return this.symbolOffsetExpression_=e,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(e){return this.hasSymbol_=!0,this.symbolColorExpression_=e,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(e){return this.texCoordExpression_=e,this}setFragmentDiscardExpression(e){return this.discardExpression_=e,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(e){return this.symbolRotateWithView_=e,this}setStrokeWidthExpression(e){return this.hasStroke_=!0,this.strokeWidthExpression_=e,this}setStrokeColorExpression(e){return this.hasStroke_=!0,this.strokeColorExpression_=e,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(e){return this.strokeOffsetExpression_=e,this}setStrokeCapExpression(e){return this.strokeCapExpression_=e,this}setStrokeJoinExpression(e){return this.strokeJoinExpression_=e,this}setStrokeMiterLimitExpression(e){return this.strokeMiterLimitExpression_=e,this}setStrokeDistanceFieldExpression(e){return this.strokeDistanceFieldExpression_=e,this}setFillColorExpression(e){return this.hasFill_=!0,this.fillColorExpression_=e,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(e){this.vertexShaderFunctions_.includes(e)||this.vertexShaderFunctions_.push(e)}addFragmentShaderFunction(e){this.fragmentShaderFunctions_.includes(e)||this.fragmentShaderFunctions_.push(e)}getSymbolVertexShader(){return this.hasSymbol_?`${zr}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec4 a_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx;
  if (a_index == 0.0) {
    offsetPx -= halfSizePx;
  } else if (a_index == 1.0) {
    offsetPx += halfSizePx * vec2(1., -1.);
  } else if (a_index == 2.0) {
    offsetPx += halfSizePx;
  } else {
    offsetPx += halfSizePx * vec2(-1., 1.);
  }
  float angle = ${this.symbolRotationExpression_};
  ${this.symbolRotateWithView_?"angle += u_rotation;":""}
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;
  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;
  v_texCoord = vec2(u, v);
  v_hitColor = a_hitColor;
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y); 
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${zr}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${zr}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute float a_parameters;
attribute float a_distance;
attribute vec2 a_joinAngles;
attribute vec4 a_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float vertexNumber = floor(abs(a_parameters) / 10000. + 0.5);
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)
  float angleTangentSum = fract(abs(a_parameters) / 10000.) * 10000. * sign(a_parameters);

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);
  
  // compute current vertex position
  float normalDir = vertexNumber < 0.5 || (vertexNumber > 1.5 && vertexNumber < 2.5) ? 1.0 : -1.0;
  float tangentDir = vertexNumber < 1.5 ? 1.0 : -1.0;
  float angle = vertexNumber < 1.5 ? v_angleStart : v_angleEnd;
  vec2 joinDirection;
  vec2 positionPx = vertexNumber < 1.5 ? segmentStartPx : segmentEndPx;
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${th} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * lineWidth * 0.5;
  gl_Position = pxToScreen(positionPx);

  v_segmentStart = segmentStartPx;
  v_segmentEnd = segmentEndPx;
  v_width = lineWidth;
  v_hitColor = a_hitColor;
  v_distanceOffsetPx = a_distance / u_resolution - (lineOffsetPx * angleTangentSum);
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${zr}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${th}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${rr("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${rr("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${rr("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${rr("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

void main(void) {
  vec2 currentPoint = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPoint);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }

  float segmentLength = length(v_segmentEnd - v_segmentStart);
  vec2 segmentTangent = (v_segmentEnd - v_segmentStart) / segmentLength;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPoint = currentPoint - v_segmentStart;
  float currentLengthPx = max(0., min(dot(segmentTangent, startToPoint), segmentLength)) + v_distanceOffsetPx; 
  float currentRadiusPx = abs(dot(segmentNormal, startToPoint));
  float currentRadiusRatio = dot(segmentNormal, startToPoint) * 2. / v_width;
  vec4 color = ${this.strokeColorExpression_} * u_globalAlpha;
  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPoint, v_segmentStart, v_segmentEnd, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPoint, v_segmentEnd, v_segmentStart, v_width, v_angleEnd, capType, joinType);
  float distance = max(
    segmentDistanceField(currentPoint, v_segmentStart, v_segmentEnd, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distance = max(distance, ${this.strokeDistanceFieldExpression_});
  gl_FragColor = color * smoothstep(0., -1., distance);
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${zr}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute vec4 a_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec4 v_hitColor;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_hitColor = a_hitColor;
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${zr}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec4 v_hitColor;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_} * u_globalAlpha;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}}const At={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},B1=["#00f","#0ff","#0f0","#ff0","#f00"];class z1 extends ja{constructor(e){e=e||{};const t=Object.assign({},e);delete t.gradient,delete t.radius,delete t.blur,delete t.weight,super(t),this.gradient_=null,this.addChangeListener(At.GRADIENT,this.handleGradientChanged_),this.setGradient(e.gradient?e.gradient:B1),this.setBlur(e.blur!==void 0?e.blur:15),this.setRadius(e.radius!==void 0?e.radius:8);const i=e.weight?e.weight:"weight";typeof i=="string"?this.weightFunction_=function(n){return n.get(i)}:this.weightFunction_=i,this.setRenderOrder(null)}getBlur(){return this.get(At.BLUR)}getGradient(){return this.get(At.GRADIENT)}getRadius(){return this.get(At.RADIUS)}handleGradientChanged_(){this.gradient_=k1(this.getGradient())}setBlur(e){this.set(At.BLUR,e)}setGradient(e){this.set(At.GRADIENT,e)}setRadius(e){this.set(At.RADIUS,e)}createRenderer(){const e=new Ec().addAttribute("float a_prop_weight").addVarying("v_prop_weight","float","a_prop_weight").addUniform("float u_size").addUniform("float u_blurSlope").setSymbolSizeExpression("vec2(u_size)").setSymbolColorExpression("vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * u_blurSlope) * v_prop_weight)");return new _c(this,{className:this.getClassName(),attributes:[{name:"weight",callback:t=>{const i=this.weightFunction_(t);return i!==void 0?Ie(i,0,1):1}}],uniforms:{u_size:()=>(this.get(At.RADIUS)+this.get(At.BLUR))*2,u_blurSlope:()=>this.get(At.RADIUS)/Math.max(1,this.get(At.BLUR))},hitDetectionEnabled:!0,vertexShader:e.getSymbolVertexShader(),fragmentShader:e.getSymbolFragmentShader(),postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}renderDeclutter(){}}function k1(r){const i=sr(1,256),n=i.createLinearGradient(0,0,1,256),s=1/(r.length-1);for(let a=0,o=r.length;a<o;++a)n.addColorStop(a*s,r[a]);return i.fillStyle=n,i.fillRect(0,0,1,256),i.canvas}const $1=z1;class j1 extends su{constructor(e,t,i,n,s){const a=s!==void 0?Mt.IDLE:Mt.LOADED;super(e,t,i,a),this.loader_=s!==void 0?s:null,this.canvas_=n,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=Mt.ERROR):this.state=Mt.LOADED,this.changed()}load(){this.state==Mt.IDLE&&(this.state=Mt.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}const Mo=j1;class Z1 extends Zd{constructor(e){super(e),this.vectorRenderer_=new qd(e),this.layerImageRatio_=e.getImageRatio(),this.coordinateToVectorPixelTransform_=Ct(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(e){if(!this.vectorRenderer_)return Promise.resolve([]);const t=Vi(this.coordinateToVectorPixelTransform_,Vi(this.renderedPixelToCoordinateTransform_,e.slice()));return this.vectorRenderer_.getFeatures(t)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(e){const t=e.pixelRatio,i=e.viewState,n=i.resolution,s=e.viewHints,a=this.vectorRenderer_;let o=e.extent;this.layerImageRatio_!==1&&(o=o.slice(0),au(o,this.layerImageRatio_));const l=xt(o)/n,h=pr(o)/n;if(!s[Bn.ANIMATING]&&!s[Bn.INTERACTING]&&!za(o)){a.useContainer(null,null);const c=a.context,u=e.layerStatesArray[e.layerIndex],d=Object.assign({},u,{opacity:1}),m=Object.assign({},e,{declutterTree:new Xd(9),extent:o,size:[l,h],viewState:Object.assign({},e.viewState,{rotation:0}),layerStatesArray:[d],layerIndex:0});let g=!0;const y=new Mo(o,n,t,c.canvas,function(_){a.prepareFrame(m)&&a.replayGroupChanged&&(a.clipping=!1,a.renderFrame(m,null)&&(a.renderDeclutter(m),g=!1),_())});y.addEventListener(ct.CHANGE,()=>{if(y.getState()!==Mt.LOADED)return;this.image_=g?null:y;const _=y.getPixelRatio(),v=Hd(y.getResolution())*t/_;this.renderedResolution=v,this.coordinateToVectorPixelTransform_=ka(this.coordinateToVectorPixelTransform_,l/2,h/2,1/v,-1/v,0,-i.center[0],-i.center[1])}),y.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!!this.image_}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(e,t,i,n,s){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,t,i,n,s):super.forEachFeatureAtCoordinate(e,t,i,n,s)}}const q1=Z1;class X1 extends ja{constructor(e){e=e||{};const t=Object.assign({},e);delete t.imageRatio,super(t),this.imageRatio_=e.imageRatio!==void 0?e.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new q1(this)}}const H1=X1;function te(r,e,t){const i=Wd();return i.style=r.style,D1(e,t,i,r)}function ah(r){const e=hi(r),t=e[0]*256,i=e[1],n=e[2]*256,s=Math.round(e[3]*255);return[t+i,n+s]}const W1=`vec4 unpackColor(vec2 packedColor) {
  return fract(packedColor[1] / 256.0) * vec4(
    fract(floor(packedColor[0] / 256.0) / 256.0),
    fract(packedColor[0] / 256.0),
    fract(floor(packedColor[1] / 256.0) / 256.0),
    1.0
  );
}`;function wc(r){return r===vt?2:r===bt?4:1}function Zs(r){const e=wc(r);return e>1?`vec${e}`:"float"}function Jn(r){return(JSON.stringify(r).split("").reduce((t,i)=>(t<<5)-t+i.charCodeAt(0),0)>>>0).toString()}function Ro(r,e,t,i){let n;if(`${i}radius`in r&&i!=="icon-"?n=te(t,r[`${i}radius`],xe):`${i}radius1`in r&&i==="shape-"&&(n=te(t,r[`${i}radius1`],xe)),n!==void 0&&(`${i}stroke-width`in r&&(n=`(${n} + ${te(t,r[`${i}stroke-width`],xe)} * 0.5)`),e.setSymbolSizeExpression(`vec2(${n} * 2. + 0.5)`)),`${i}scale`in r){const s=te(t,r[`${i}scale`],xe|bt);e.setSymbolSizeExpression(`${e.getSymbolSizeExpression()} * ${s}`)}`${i}displacement`in r&&e.setSymbolOffsetExpression(te(t,r[`${i}displacement`],bt)),`${i}rotation`in r&&e.setSymbolRotationExpression(te(t,r[`${i}rotation`],xe)),`${i}rotate-with-view`in r&&e.setSymbolRotateWithView(!!r[`${i}rotate-with-view`])}function Sc(r,e,t,i,n){let s="vec4(0.)";if(e!==null&&(s=e),t!==null&&i!==null){const l=`smoothstep(-${i} + 0.63, -${i} - 0.58, ${r})`;s=`mix(${t}, ${s}, ${l})`}const a=`(1.0 - smoothstep(-0.63, 0.58, ${r}))`;let o=`${s} * ${a}`;return n!==null&&(o=`${o} * ${n}`),o}function bo(r,e,t,i,n){const s=new Image;let a;return s.crossOrigin=r[`${i}cross-origin`]===void 0?"anonymous":r[`${i}cross-origin`],s.src=r[`${i}src`],s.complete&&s.width&&s.height?a=wo([s.width,s.height]):(t[`u_texture${n}_size`]=()=>s.complete?[s.width,s.height]:[0,0],e.addUniform(`vec2 u_texture${n}_size`),a=`u_texture${n}_size`),t[`u_texture${n}`]=s,e.addUniform(`sampler2D u_texture${n}`),a}function Po(r,e,t,i,n){let s=te(t,r[`${e}offset`],bt);if(`${e}offset-origin`in r)switch(r[`${e}offset-origin`]){case"top-right":s=`vec2(${i}.x, 0.) + ${n} * vec2(-1., 0.) + ${s} * vec2(-1., 1.)`;break;case"bottom-left":s=`vec2(0., ${i}.y) + ${n} * vec2(0., -1.) + ${s} * vec2(1., -1.)`;break;case"bottom-right":s=`${i} - ${n} - ${s}`;break}return s}function V1(r,e,t,i,n){n.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,Ro(r,e,i,"circle-");let s=null;"circle-opacity"in r&&(s=te(n,r["circle-opacity"],xe));let a="coordsPx";"circle-scale"in r&&(a=`coordsPx / ${te(n,r["circle-scale"],xe|bt)}`);let o=null;"circle-fill-color"in r&&(o=te(n,r["circle-fill-color"],vt));let l=null;"circle-stroke-color"in r&&(l=te(n,r["circle-stroke-color"],vt));let h=te(n,r["circle-radius"],xe),c=null;"circle-stroke-width"in r&&(c=te(n,r["circle-stroke-width"],xe),h=`(${h} + ${c} * 0.5)`);const u=`circleDistanceField(${a}, ${h})`,d=Sc(u,o,l,c,s);e.setSymbolColorExpression(d)}function Y1(r,e,t,i,n){n.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,n.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radiusIn, float radiusOut, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y); 
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radiusOut, 0.);
  vec2 edgeNormal = vec2(radiusIn * sin(alpha * 0.5), -radiusIn * cos(alpha * 0.5) + radiusOut);
  return dot(normalize(edgeNormal), tipToPoint);
}`,n.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y); 
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,Ro(r,e,i,"shape-");let s=null;"shape-opacity"in r&&(s=te(n,r["shape-opacity"],xe));let a="coordsPx";"shape-scale"in r&&(a=`coordsPx / ${te(n,r["shape-scale"],xe|bt)}`);let o=null;"shape-fill-color"in r&&(o=te(n,r["shape-fill-color"],vt));let l=null;"shape-stroke-color"in r&&(l=te(n,r["shape-stroke-color"],vt));let h=null;"shape-stroke-width"in r&&(h=te(n,r["shape-stroke-width"],xe));const c=te(n,r["shape-points"],xe);let u="0.";"shape-angle"in r&&(u=te(n,r["shape-angle"],xe));let d;if("shape-radius"in r){let g=te(n,r["shape-radius"],xe);h!==null&&(g=`${g} + ${h} * 0.5`),d=`regularDistanceField(${a}, ${c}, ${g}, ${u})`}else{let g=te(n,r["shape-radius1"],xe),y=te(n,r["shape-radius2"],xe);h!==null&&(g=`${g} + ${h} * 0.5`,y=`${y} + ${h} * 0.5`),d=`starDistanceField(${a}, ${c}, ${y}, ${g}, ${u})`}const m=Sc(d,o,l,h,s);e.setSymbolColorExpression(m)}function K1(r,e,t,i,n){let s="vec4(1.0)";"icon-color"in r&&(s=te(n,r["icon-color"],vt)),"icon-opacity"in r&&(s=`${s} * ${te(n,r["icon-opacity"],xe)}`);const a=Jn(r["icon-src"]),o=bo(r,e,t,"icon-",a);if(e.setSymbolColorExpression(`${s} * samplePremultiplied(u_texture${a}, v_texCoord)`).setSymbolSizeExpression(o),"icon-width"in r&&"icon-height"in r&&e.setSymbolSizeExpression(`vec2(${te(i,r["icon-width"],xe)}, ${te(i,r["icon-height"],xe)})`),"icon-offset"in r&&"icon-size"in r){const l=te(i,r["icon-size"],bt),h=e.getSymbolSizeExpression();e.setSymbolSizeExpression(l);const c=Po(r,"icon-",i,"v_quadSizePx",l);e.setTextureCoordinateExpression(`(vec4((${c}).xyxy) + vec4(0., 0., ${l})) / (${h}).xyxy`)}if(Ro(r,e,i,"icon-"),"icon-anchor"in r){const l=te(i,r["icon-anchor"],bt);let h="1.0";"icon-scale"in r&&(h=te(i,r["icon-scale"],xe|bt));let c;r["icon-anchor-x-units"]==="pixels"&&r["icon-anchor-y-units"]==="pixels"?c=`${l} * ${h}`:r["icon-anchor-x-units"]==="pixels"?c=`${l} * vec2(vec2(${h}).x, v_quadSizePx.y)`:r["icon-anchor-y-units"]==="pixels"?c=`${l} * vec2(v_quadSizePx.x, vec2(${h}).x)`:c=`${l} * v_quadSizePx`;let u=`v_quadSizePx * vec2(0.5, -0.5) + ${c} * vec2(-1., 1.)`;if("icon-anchor-origin"in r)switch(r["icon-anchor-origin"]){case"top-right":u=`v_quadSizePx * -0.5 + ${c}`;break;case"bottom-left":u=`v_quadSizePx * 0.5 - ${c}`;break;case"bottom-right":u=`v_quadSizePx * vec2(-0.5, 0.5) + ${c} * vec2(1., -1.)`;break}e.setSymbolOffsetExpression(`${e.getSymbolOffsetExpression()} + ${u}`)}}function Q1(r,e,t,i,n){if("stroke-color"in r&&e.setStrokeColorExpression(te(n,r["stroke-color"],vt)),"stroke-pattern-src"in r){const s=Jn(r["stroke-pattern-src"]),a=bo(r,e,t,"stroke-pattern-",s);let o=a,l="vec2(0.)";"stroke-pattern-offset"in r&&"stroke-pattern-size"in r&&(o=te(n,r["stroke-pattern-size"],bt),l=Po(r,"stroke-pattern-",n,a,o));let h="0.";"stroke-pattern-spacing"in r&&(h=te(n,r["stroke-pattern-spacing"],xe)),n.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float currentLengthPx, float currentRadiusRatio) {
      float currentLengthScaled = currentLengthPx * sampleSize.y / v_width;
      float spacingScaled = spacingPx * sampleSize.y / v_width;
      float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
      float vCoordPx = (currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
      vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
      return uCoordPx > sampleSize.x ? vec4(0.) : samplePremultiplied(texture, texCoord);
    }`;const c=`u_texture${s}`;let u="1.";"stroke-color"in r&&(u=e.getStrokeColorExpression()),e.setStrokeColorExpression(`${u} * sampleStrokePattern(${c}, ${a}, ${l}, ${o}, ${h}, currentLengthPx, currentRadiusRatio)`)}if("stroke-width"in r&&e.setStrokeWidthExpression(te(i,r["stroke-width"],xe)),"stroke-offset"in r&&e.setStrokeOffsetExpression(te(i,r["stroke-offset"],xe)),"stroke-line-cap"in r&&e.setStrokeCapExpression(te(i,r["stroke-line-cap"],ci)),"stroke-line-join"in r&&e.setStrokeJoinExpression(te(i,r["stroke-line-join"],ci)),"stroke-miter-limit"in r&&e.setStrokeMiterLimitExpression(te(i,r["stroke-miter-limit"],xe)),"stroke-line-dash"in r){n.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${rr("square")}) {
    distanceSegment -= v_width * 0.5;
  } else if (capType == ${rr("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - v_width * 0.5);
  }
  return distanceSegment;
}`;let s=r["stroke-line-dash"].map(m=>te(n,m,xe));s.length%2===1&&(s=[...s,...s]);let a="0.";"stroke-line-dash-offset"in r&&(a=te(i,r["stroke-line-dash-offset"],xe));const l=`dashDistanceField_${Jn(r["stroke-line-dash"])}`,h=s.map((m,g)=>`float dashLength${g} = ${m};`),c=s.map((m,g)=>`dashLength${g}`).join(" + ");let u="0.",d=`getSingleDashDistance(distance, radius, ${u}, dashLength0, totalDashLength, capType)`;for(let m=2;m<s.length;m+=2)u=`${u} + dashLength${m-2} + dashLength${m-1}`,d=`min(${d}, getSingleDashDistance(distance, radius, ${u}, dashLength${m}, totalDashLength, capType))`;n.functions[l]=`float ${l}(float distance, float radius, float capType) {
  ${h.join(`
  `)}
  float totalDashLength = ${c};
  return ${d};
}`,e.setStrokeDistanceFieldExpression(`${l}(currentLengthPx + ${a}, currentRadiusPx, capType)`)}}function J1(r,e,t,i,n){if("fill-color"in r&&e.setFillColorExpression(te(n,r["fill-color"],vt)),"fill-pattern-src"in r){const s=Jn(r["fill-pattern-src"]),a=bo(r,e,t,"fill-pattern-",s);let o=a,l="vec2(0.)";"fill-pattern-offset"in r&&"fill-pattern-size"in r&&(o=te(n,r["fill-pattern-size"],bt),l=Po(r,"fill-pattern-",n,a,o)),n.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 samplePos = mod((pxPosition - pxOrigin) / scaleRatio, sampleSize);
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return samplePremultiplied(texture, (samplePos + textureOffset) / textureSize);
}`;const h=`u_texture${s}`;let c="1.";"fill-color"in r&&(c=e.getFillColorExpression()),e.setFillColorExpression(`${c} * sampleFillPattern(${h}, ${a}, ${l}, ${o}, pxOrigin, pxPos)`)}}function ev(r){const e={inFragmentShader:!1,properties:{},variables:{},functions:{},style:r},t={inFragmentShader:!0,variables:e.variables,properties:{},functions:{},style:r},i=new Ec,n={};if("icon-src"in r?K1(r,i,n,e,t):"shape-points"in r?Y1(r,i,n,e,t):"circle-radius"in r&&V1(r,i,n,e,t),Q1(r,i,n,e,t),J1(r,i,n,e,t),r.filter){const a=te(t,r.filter,bn);i.setFragmentDiscardExpression(`!${a}`)}Object.keys(t.variables).forEach(function(a){const o=t.variables[a],l=So(o.name);i.addUniform(`${Zs(o.type)} ${l}`);let h;o.type===ci?h=()=>Qn(r.variables[o.name]):o.type===vt?h=()=>ah([...hi(r.variables[o.name]||"#eee")]):o.type===bn?h=()=>r.variables[o.name]?1:0:h=()=>r.variables[o.name],n[l]=h}),Object.keys(t.properties).forEach(function(a){const o=t.properties[a];e.properties[a]||(e.properties[a]=o);let l=Zs(o.type),h=`a_prop_${o.name}`;o.type===vt&&(l="vec4",h=`unpackColor(${h})`,i.addVertexShaderFunction(W1)),i.addVarying(`v_prop_${o.name}`,l,h)}),Object.keys(e.properties).forEach(function(a){const o=e.properties[a];i.addAttribute(`${Zs(o.type)} a_prop_${o.name}`)});const s=Object.keys(e.properties).map(function(a){const o=e.properties[a];let l;return o.evaluator?l=o.evaluator:o.type===ci?l=h=>Qn(h.get(o.name)):o.type===vt?l=h=>ah([...hi(h.get(o.name)||"#eee")]):o.type===bn?l=h=>h.get(o.name)?1:0:l=h=>h.get(o.name),{name:o.name,size:wc(o.type),callback:l}});for(const a in e.functions)i.addVertexShaderFunction(e.functions[a]);for(const a in t.functions)i.addFragmentShaderFunction(t.functions[a]);return{builder:i,attributes:s.reduce((a,o)=>({...a,[o.name]:{callback:o.callback,size:o.size}}),{}),uniforms:n}}class tv extends ou{constructor(e){const t=Object.assign({},e);super(t),this.parseResult_=ev(e.style),this.styleVariables_=e.style.variables||{},this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){const e=Object.keys(this.parseResult_.attributes).map(t=>({name:t,...this.parseResult_.attributes[t]}));return new _c(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitDetectionEnabled:!this.hitDetectionDisabled_,uniforms:this.parseResult_.uniforms,attributes:e})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}const rv=tv;function oh(r,e){const t=`
    attribute vec2 ${In.TEXTURE_COORD};
    uniform mat4 ${ae.TILE_TRANSFORM};
    uniform float ${ae.TEXTURE_PIXEL_WIDTH};
    uniform float ${ae.TEXTURE_PIXEL_HEIGHT};
    uniform float ${ae.TEXTURE_RESOLUTION};
    uniform float ${ae.TEXTURE_ORIGIN_X};
    uniform float ${ae.TEXTURE_ORIGIN_Y};
    uniform float ${ae.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${In.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${ae.TEXTURE_ORIGIN_X} + ${ae.TEXTURE_RESOLUTION} * ${ae.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${ae.TEXTURE_ORIGIN_Y} - ${ae.TEXTURE_RESOLUTION} * ${ae.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${ae.TILE_TRANSFORM} * vec4(${In.TEXTURE_COORD}, ${ae.DEPTH}, 1.0);
    }
  `,i={...F1(),inFragmentShader:!0,bandCount:e,style:r},n=[];if(r.color!==void 0){const u=te(i,r.color,vt);n.push(`color = ${u};`)}if(r.contrast!==void 0){const u=te(i,r.contrast,xe);n.push(`color.rgb = clamp((${u} + 1.0) * color.rgb - (${u} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(r.exposure!==void 0){const u=te(i,r.exposure,xe);n.push(`color.rgb = clamp((${u} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(r.saturation!==void 0){const u=te(i,r.saturation,xe);n.push(`
      float saturation = ${u} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(r.gamma!==void 0){const u=te(i,r.gamma,xe);n.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${u}));`)}if(r.brightness!==void 0){const u=te(i,r.brightness,xe);n.push(`color.rgb = clamp(color.rgb + ${u}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},a=Object.keys(i.variables).length;if(a>1&&!r.variables)throw new Error(`Missing variables in style (expected ${i.variables})`);for(let u=0;u<a;++u){const d=i.variables[Object.keys(i.variables)[u]];if(!(d.name in r.variables))throw new Error(`Missing '${d.name}' in style variables`);const m=So(d.name);s[m]=function(){let g=r.variables[d.name];return typeof g=="string"&&(g=Qn(g)),g!==void 0?g:-9999999}}const o=Object.keys(s).map(function(u){return`uniform float ${u};`}),l=Math.ceil(e/4);o.push(`uniform sampler2D ${ae.TILE_TEXTURE_ARRAY}[${l}];`),i.paletteTextures&&o.push(`uniform sampler2D ${vc}[${i.paletteTextures.length}];`);const h=Object.keys(i.functions).map(function(u){return i.functions[u]}),c=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${ae.RENDER_EXTENT};
    uniform float ${ae.TRANSITION_ALPHA};
    uniform float ${ae.TEXTURE_PIXEL_WIDTH};
    uniform float ${ae.TEXTURE_PIXEL_HEIGHT};
    uniform float ${ae.RESOLUTION};
    uniform float ${ae.ZOOM};

    ${o.join(`
`)}

    ${h.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${ae.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${ae.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${ae.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${ae.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${ae.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${n.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${ae.TRANSITION_ALPHA};
    }`;return{vertexShader:t,fragmentShader:c,uniforms:s,paletteTextures:i.paletteTextures}}class Tc extends Vd{constructor(e){e=e?Object.assign({},e):{};const t=e.style||{};delete e.style;const i=e.cacheSize;delete e.cacheSize,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.cacheSize_=i,this.styleVariables_=this.style_.variables||{},this.addChangeListener(Jh.SOURCE,this.handleSourceUpdate_)}getSources(e,t){const i=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(e,t):this.sources_:i?[i]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=oh(this.style_,this.getSourceBandCount_());return new C1(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.cacheSize_,paletteTextures:e.paletteTextures})}renderSources(e,t){const i=this.getRenderer();let n;for(let s=0,a=t.length;s<a;++s)this.renderedSource_=t[s],i.prepareFrame(e)&&(n=i.renderFrame(e));return n}render(e,t){this.rendered=!0;const i=e.viewState,n=this.getSources(e.extent,i.resolution);let s=!0;for(let o=0,l=n.length;o<l;++o){const h=n[o],c=h.getState();if(c=="loading"){const u=()=>{h.getState()=="ready"&&(h.removeEventListener("change",u),this.changed())};h.addEventListener("change",u)}s=s&&c=="ready"}const a=this.renderSources(e,n);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=i.resolution,a;if(this.renderedResolution_>.5*i.resolution){const o=this.getSources(e.extent,this.renderedResolution_).filter(l=>!n.includes(l));if(o.length>0)return this.renderSources(e,o)}return a}setStyle(e){this.styleVariables_=e.variables||{},this.style_=e;const t=oh(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}Tc.prototype.dispose;const Ta=Tc,iv=Object.freeze(Object.defineProperty({__proto__:null,Graticule:Ax,Group:lu,Heatmap:$1,Image:Xa,Layer:ou,Tile:zn,Vector:Ba,VectorImage:H1,VectorTile:hu,WebGLPoints:rv,WebGLTile:Ta},Symbol.toStringTag,{value:"Module"}));function nv(r){const e=r[0],t=new Array(e);let i=1<<e-1,n,s;for(n=0;n<e;++n)s=48,r[1]&i&&(s+=1),r[2]&i&&(s+=2),t[n]=String.fromCharCode(s),i>>=1;return t.join("")}const sv='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>';class av extends Gr{constructor(e){const t=e.hidpi!==void 0?e.hidpi:!1;super({cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,opaque:!0,projection:de("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.hidpi_=t,this.culture_=e.culture!==void 0?e.culture:"en-us",this.maxZoom_=e.maxZoom!==void 0?e.maxZoom:-1,this.apiKey_=e.key,this.imagerySet_=e.imagerySet,this.placeholderTiles_=e.placeholderTiles;const i="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(i).then(n=>n.json()).then(n=>this.handleImageryMetadataResponse(n))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(e){if(e.statusCode!=200||e.statusDescription!="OK"||e.authenticationResultCode!="ValidCredentials"||e.resourceSets.length!=1||e.resourceSets[0].resources.length!=1){this.setState("error");return}const t=e.resourceSets[0].resources[0],i=this.maxZoom_==-1?t.zoomMax:this.maxZoom_,n=this.getProjection(),s=ls(n),a=this.hidpi_?2:1,o=t.imageWidth==t.imageHeight?t.imageWidth/a:[t.imageWidth/a,t.imageHeight/a],l=hs({extent:s,minZoom:t.zoomMin,maxZoom:i,tileSize:o});this.tileGrid=l;const h=this.culture_,c=this.hidpi_,u=this.placeholderTiles_;if(this.tileUrlFunction=uu(t.imageUrlSubdomains.map(function(d){const m=[0,0,0],g=t.imageUrl.replace("{subdomain}",d).replace("{culture}",h);return function(y,_,v){if(!y)return;oa(y[0],y[1],y[2],m);const E=new URL(g.replace("{quadkey}",nv(m))),S=E.searchParams;return c&&(S.set("dpi","d1"),S.set("device","mobile")),u===!0?S.delete("n"):u===!1&&S.set("n","z"),E.toString()}})),t.imageryProviders){const d=Ha(de("EPSG:4326"),this.getProjection());this.setAttributions(m=>{const g=[],y=m.viewState,_=this.getTileGrid(),v=_.getZForResolution(y.resolution,this.zDirection),S=_.getTileCoordForCoordAndZ(y.center,v)[0];return t.imageryProviders.map(function(w){let P=!1;const A=w.coverageAreas;for(let I=0,C=A.length;I<C;++I){const k=A[I];if(S>=k.zoomMin&&S<=k.zoomMax){const B=k.bbox,H=[B[1],B[0],B[3],B[2]],Y=Wi(H,d);if(ui(Y,m.extent)){P=!0;break}}}P&&g.push(w.attribution)}),g.push(sv),g})}this.setState("ready")}}const ov=av;class lv extends fi{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,maxZoom:e.maxZoom!==void 0?e.maxZoom:18,minZoom:e.minZoom,projection:e.projection,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection}),this.account_=e.account,this.mapId_=e.map||"",this.config_=e.config||{},this.templateCache_={},this.initializeMap_()}getConfig(){return this.config_}updateConfig(e){Object.assign(this.config_,e),this.initializeMap_()}setConfig(e){this.config_=e||{},this.initializeMap_()}initializeMap_(){const e=JSON.stringify(this.config_);if(this.templateCache_[e]){this.applyTemplate_(this.templateCache_[e]);return}let t="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(t+="/named/"+this.mapId_);const i=new XMLHttpRequest;i.addEventListener("load",this.handleInitResponse_.bind(this,e)),i.addEventListener("error",this.handleInitError_.bind(this)),i.open("POST",t),i.setRequestHeader("Content-type","application/json"),i.send(JSON.stringify(this.config_))}handleInitResponse_(e,t){const i=t.target;if(!i.status||i.status>=200&&i.status<300){let n;try{n=JSON.parse(i.responseText)}catch{this.setState("error");return}this.applyTemplate_(n),this.templateCache_[e]=n,this.setState("ready")}else this.setState("error")}handleInitError_(e){this.setState("error")}applyTemplate_(e){const t="https://"+e.cdn_url.https+"/"+this.account_+"/api/v1/map/"+e.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(t)}}const hv=lv;class uv extends os{constructor(e){super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(t){const i=t.getGeometry();return Yt(!i||i.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),i},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,t,i){this.source.loadFeatures(e,t,i),t!==this.resolution&&(this.resolution=t,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(ct.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(ct.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,t){const i=e===0?0:Math.min(t,e)/e,n=e!==this.distance||this.interpolationRatio!==i;this.distance=e,this.minDistance=t,this.interpolationRatio=i,n&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=$a(),t=this.distance*this.resolution,i=this.source.getFeatures(),n={};for(let s=0,a=i.length;s<a;s++){const o=i[s];if(!(Be(o)in n)){const l=this.geometryFunction(o);if(l){const h=l.getCoordinates();Yd(h,e),eu(e,t,e);const c=this.source.getFeaturesInExtent(e).filter(function(u){const d=Be(u);return d in n?!1:(n[d]=!0,!0)});this.features.push(this.createCluster(c,e))}}}}createCluster(e,t){const i=[0,0];for(let o=e.length-1;o>=0;--o){const l=this.geometryFunction(e[o]);l?Kd(i,l.getCoordinates()):e.splice(o,1)}Qd(i,1/e.length);const n=fr(t),s=this.interpolationRatio,a=new _t([i[0]*(1-s)+n[0]*s,i[1]*(1-s)+n[1]*s]);return this.createCustomCluster_?this.createCustomCluster_(a,e):new it({geometry:a,features:e})}}const cv=uv;class fv extends us{constructor(e){const t=e.projection===void 0?"EPSG:3857":e.projection;let i=e.tileGrid;i===void 0&&t&&(i=hs({extent:ls(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:i,opaque:e.opaque,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.tileSize_=e.tileSize?Ht(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=e.bandCount===void 0?4:e.bandCount,this.tileGridForProjection_={},this.tileCacheForProjection_={}}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const t=this.getTileGrid();return t?Ht(t.getTileSize(e)):[256,256]}getGutterForProjection(e){const t=this.getProjection();return!t||Oi(t,e)?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,t,i,n,s){const a=this.getTileCacheForProjection(n),o=kn(e,t,i);if(a.containsKey(o)){const _=a.get(o);if(_&&_.key==this.getKey())return _}const l=this.getTileGrid(),h=Math.max.apply(null,l.getResolutions().map((_,v)=>{const E=Ht(l.getTileSize(v)),S=this.getTileSize(v);return Math.max(S[0]/E[0],S[1]/E[1])})),c=this.getTileGridForProjection(s),u=this.getTileGridForProjection(n),d=[e,t,i],m=this.getTileCoordForTileUrlFunction(d,n),g=Object.assign({sourceProj:s,sourceTileGrid:c,targetProj:n,targetTileGrid:u,tileCoord:d,wrappedTileCoord:m,pixelRatio:h,gutter:this.getGutterForProjection(s),getTileFunction:(_,v,E,S)=>this.getTile(_,v,E,S,s)},this.tileOptions),y=new Eo(g);return y.key=this.getKey(),y}getTile(e,t,i,n,s){const a=this.getProjection();if(a&&s&&!Oi(a,s))return this.getReprojTile_(e,t,i,s,a);const o=this.getTileSize(e),l=kn(e,t,i);if(this.tileCache.containsKey(l))return this.tileCache.get(l);const h=this.loader_;function c(){return rg(function(){return h(e,t,i)})}const u=Object.assign({tileCoord:[e,t,i],loader:c,size:o},this.tileOptions),d=new vo(u);return d.key=this.getKey(),d.addEventListener(ct.CHANGE,this.handleTileChange_),this.tileCache.set(l,d),d}handleTileChange_(e){const t=e.target,i=Be(t),n=t.getState();let s;n==ie.LOADING?(this.tileLoadingKeys_[i]=!0,s=Ns.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=n==ie.ERROR?Ns.TILELOADERROR:n==ie.LOADED?Ns.TILELOADEND:void 0),s&&this.dispatchEvent(new Jd(s,t))}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||Oi(t,e)))return this.tileGrid;const i=Be(e);return i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=eg(e)),this.tileGridForProjection_[i]}setTileGridForProjection(e,t){const i=de(e);if(i){const n=Be(i);n in this.tileGridForProjection_||(this.tileGridForProjection_[n]=t)}}getTileCacheForProjection(e){const t=this.getProjection();if(!t||Oi(t,e))return this.tileCache;const i=Be(e);return i in this.tileCacheForProjection_||(this.tileCacheForProjection_[i]=new tg(.1)),this.tileCacheForProjection_[i]}expireCache(e,t){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const n in this.tileCacheForProjection_){const s=this.tileCacheForProjection_[n];s.expireCache(s==i?t:{})}}clear(){super.clear();for(const e in this.tileCacheForProjection_)this.tileCacheForProjection_[e].clear()}}const Ao=fv;function Ye(r){return(e,...t)=>dv(r,e,t)}function Mi(r,e){return Ye(Mc(r,e).get)}const{apply:dv,construct:Q2,defineProperty:J2,get:eP,getOwnPropertyDescriptor:Mc,getPrototypeOf:Io,has:tP,ownKeys:gv,set:rP,setPrototypeOf:iP}=Reflect,{iterator:on,species:nP,toStringTag:mv,for:sP}=Symbol,pv=Object,{create:Lo,defineProperty:yv,freeze:aP,is:oP}=pv,_v=Array,xv=_v.prototype,Rc=xv[on],vv=Ye(Rc),bc=ArrayBuffer,Ev=bc.prototype;Mi(Ev,"byteLength");const lh=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;lh&&Mi(lh.prototype,"byteLength");const Pc=Io(Uint8Array);Pc.from;const st=Pc.prototype;st[on];Ye(st.keys);Ye(st.values);Ye(st.entries);Ye(st.set);Ye(st.reverse);Ye(st.fill);Ye(st.copyWithin);Ye(st.sort);Ye(st.slice);Ye(st.subarray);Mi(st,"buffer");Mi(st,"byteOffset");Mi(st,"length");Mi(st,mv);const wv=Uint8Array,Ac=Uint16Array,Co=Uint32Array,Sv=Float32Array,Ji=Io([][on]()),Ic=Ye(Ji.next),Tv=Ye(function*(){}().next),Mv=Io(Ji),Rv=DataView.prototype,bv=Ye(Rv.getUint16),Oo=WeakMap,Lc=Oo.prototype,Cc=Ye(Lc.get),Pv=Ye(Lc.set),Oc=new Oo,Av=Lo(null,{next:{value:function(){const e=Cc(Oc,this);return Ic(e)}},[on]:{value:function(){return this}}});function Iv(r){if(r[on]===Rc&&Ji.next===Ic)return r;const e=Lo(Av);return Pv(Oc,e,vv(r)),e}const Lv=new Oo,Cv=Lo(Mv,{next:{value:function(){const e=Cc(Lv,this);return Tv(e)},writable:!0,configurable:!0}});for(const r of gv(Ji))r!=="next"&&yv(Cv,r,Mc(Ji,r));const Nc=new bc(4),Ov=new Sv(Nc),Nv=new Co(Nc),Ut=new Ac(512),Bt=new wv(512);for(let r=0;r<256;++r){const e=r-127;e<-27?(Ut[r]=0,Ut[r|256]=32768,Bt[r]=24,Bt[r|256]=24):e<-14?(Ut[r]=1024>>-e-14,Ut[r|256]=1024>>-e-14|32768,Bt[r]=-e-1,Bt[r|256]=-e-1):e<=15?(Ut[r]=e+15<<10,Ut[r|256]=e+15<<10|32768,Bt[r]=13,Bt[r|256]=13):e<128?(Ut[r]=31744,Ut[r|256]=64512,Bt[r]=24,Bt[r|256]=24):(Ut[r]=31744,Ut[r|256]=64512,Bt[r]=13,Bt[r|256]=13)}const No=new Co(2048);for(let r=1;r<1024;++r){let e=r<<13,t=0;for(;!(e&8388608);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,No[r]=e|t}for(let r=1024;r<2048;++r)No[r]=939524096+(r-1024<<13);const Ri=new Co(64);for(let r=1;r<31;++r)Ri[r]=r<<23;Ri[31]=1199570944;Ri[32]=2147483648;for(let r=33;r<63;++r)Ri[r]=2147483648+(r-32<<23);Ri[63]=3347054592;const Fc=new Ac(64);for(let r=1;r<64;++r)r!==32&&(Fc[r]=1024);function Fv(r){const e=r>>10;return Nv[0]=No[Fc[e]+(r&1023)]+Ri[e],Ov[0]}function Dc(r,e,...t){return Fv(bv(r,e,...Iv(t)))}var Fo={exports:{}};function Gc(r,e,t){const i=t&&t.debug||!1;i&&console.log("[xml-utils] getting "+e+" in "+r);const n=typeof r=="object"?r.outer:r,s=n.slice(0,n.indexOf(">")+1),a=['"',"'"];for(let o=0;o<a.length;o++){const l=a[o],h=e+"\\="+l+"([^"+l+"]*)"+l;i&&console.log("[xml-utils] pattern:",h);const u=new RegExp(h).exec(s);if(i&&console.log("[xml-utils] match:",u),u)return u[1]}}Fo.exports=Gc;Fo.exports.default=Gc;var Dv=Fo.exports;const qs=ds(Dv);var Do={exports:{}},Go={exports:{}},Uo={exports:{}};function Uc(r,e,t){const n=new RegExp(e).exec(r.slice(t));return n?t+n.index:-1}Uo.exports=Uc;Uo.exports.default=Uc;var Gv=Uo.exports,Bo={exports:{}};function Bc(r,e,t){const n=new RegExp(e).exec(r.slice(t));return n?t+n.index+n[0].length-1:-1}Bo.exports=Bc;Bo.exports.default=Bc;var Uv=Bo.exports,zo={exports:{}};function zc(r,e){const t=new RegExp(e,"g"),i=r.match(t);return i?i.length:0}zo.exports=zc;zo.exports.default=zc;var Bv=zo.exports;const zv=Gv,Xs=Uv,hh=Bv;function kc(r,e,t){const i=t&&t.debug||!1,n=!(t&&typeof t.nested===!1),s=t&&t.startIndex||0;i&&console.log("[xml-utils] starting findTagByName with",e," and ",t);const a=zv(r,`<${e}[ 
>/]`,s);if(i&&console.log("[xml-utils] start:",a),a===-1)return;const o=r.slice(a+e.length);let l=Xs(o,"^[^<]*[ /]>",0);const h=l!==-1&&o[l-1]==="/";if(i&&console.log("[xml-utils] selfClosing:",h),h===!1)if(n){let m=0,g=1,y=0;for(;(l=Xs(o,"[ /]"+e+">",m))!==-1;){const _=o.substring(m,l+1);if(g+=hh(_,"<"+e+`[ 
	>]`),y+=hh(_,"</"+e+">"),y>=g)break;m=l}}else l=Xs(o,"[ /]"+e+">",0);const c=a+e.length+l+1;if(i&&console.log("[xml-utils] end:",c),c===-1)return;const u=r.slice(a,c);let d;return h?d=null:d=u.slice(u.indexOf(">")+1,u.lastIndexOf("<")),{inner:d,outer:u,start:a,end:c}}Go.exports=kc;Go.exports.default=kc;var kv=Go.exports;const $v=kv;function $c(r,e,t){const i=[],n=t&&t.debug||!1,s=t&&typeof t.nested=="boolean"?t.nested:!0;let a=t&&t.startIndex||0,o;for(;o=$v(r,e,{debug:n,startIndex:a});)s?a=o.start+1+e.length:a=o.end,i.push(o);return n&&console.log("findTagsByName found",i.length,"tags"),i}Do.exports=$c;Do.exports.default=$c;var jv=Do.exports;const Zv=ds(jv),qi={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},kt={};for(const r in qi)qi.hasOwnProperty(r)&&(kt[qi[r]]=parseInt(r,10));const qv=[kt.BitsPerSample,kt.ExtraSamples,kt.SampleFormat,kt.StripByteCounts,kt.StripOffsets,kt.StripRowCounts,kt.TileByteCounts,kt.TileOffsets,kt.SubIFDs],Hs={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},oe={};for(const r in Hs)Hs.hasOwnProperty(r)&&(oe[Hs[r]]=parseInt(r,10));const at={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},Xv={Unspecified:0,Assocalpha:1,Unassalpha:2},lP={Version:0,AddCompression:1},hP={None:0,Deflate:1,Zstandard:2},Hv={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function Wv(r,e){const{width:t,height:i}=r,n=new Uint8Array(t*i*3);let s;for(let a=0,o=0;a<r.length;++a,o+=3)s=256-r[a]/e*256,n[o]=s,n[o+1]=s,n[o+2]=s;return n}function Vv(r,e){const{width:t,height:i}=r,n=new Uint8Array(t*i*3);let s;for(let a=0,o=0;a<r.length;++a,o+=3)s=r[a]/e*256,n[o]=s,n[o+1]=s,n[o+2]=s;return n}function Yv(r,e){const{width:t,height:i}=r,n=new Uint8Array(t*i*3),s=e.length/3,a=e.length/3*2;for(let o=0,l=0;o<r.length;++o,l+=3){const h=r[o];n[l]=e[h]/65536*256,n[l+1]=e[h+s]/65536*256,n[l+2]=e[h+a]/65536*256}return n}function Kv(r){const{width:e,height:t}=r,i=new Uint8Array(e*t*3);for(let n=0,s=0;n<r.length;n+=4,s+=3){const a=r[n],o=r[n+1],l=r[n+2],h=r[n+3];i[s]=255*((255-a)/256)*((255-h)/256),i[s+1]=255*((255-o)/256)*((255-h)/256),i[s+2]=255*((255-l)/256)*((255-h)/256)}return i}function Qv(r){const{width:e,height:t}=r,i=new Uint8ClampedArray(e*t*3);for(let n=0,s=0;n<r.length;n+=3,s+=3){const a=r[n],o=r[n+1],l=r[n+2];i[s]=a+1.402*(l-128),i[s+1]=a-.34414*(o-128)-.71414*(l-128),i[s+2]=a+1.772*(o-128)}return i}const Jv=.95047,eE=1,tE=1.08883;function rE(r){const{width:e,height:t}=r,i=new Uint8Array(e*t*3);for(let n=0,s=0;n<r.length;n+=3,s+=3){const a=r[n+0],o=r[n+1]<<24>>24,l=r[n+2]<<24>>24;let h=(a+16)/116,c=o/500+h,u=h-l/200,d,m,g;c=Jv*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),h=eE*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),u=tE*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),d=c*3.2406+h*-1.5372+u*-.4986,m=c*-.9689+h*1.8758+u*.0415,g=c*.0557+h*-.204+u*1.057,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,m=m>.0031308?1.055*m**(1/2.4)-.055:12.92*m,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,i[s]=Math.max(0,Math.min(1,d))*255,i[s+1]=Math.max(0,Math.min(1,m))*255,i[s+2]=Math.max(0,Math.min(1,g))*255}return i}const jc=new Map;function wr(r,e){Array.isArray(r)||(r=[r]),r.forEach(t=>jc.set(t,e))}async function Zc(r){const e=jc.get(r.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${r.Compression}`);const t=await e();return new t(r)}wr([void 0,1],()=>Er(()=>import("./raw-FjKAlyiw.js"),__vite__mapDeps([0,1]),import.meta.url).then(r=>r.default));wr(5,()=>Er(()=>import("./lzw-NamZKYVt.js"),__vite__mapDeps([2,1]),import.meta.url).then(r=>r.default));wr(6,()=>{throw new Error("old style JPEG compression is not supported.")});wr(7,()=>Er(()=>import("./jpeg-rjh0axXg.js"),__vite__mapDeps([3,1]),import.meta.url).then(r=>r.default));wr([8,32946],()=>Er(()=>import("./deflate-EZWV29Lt.js"),__vite__mapDeps([4,5,1]),import.meta.url).then(r=>r.default));wr(32773,()=>Er(()=>import("./packbits-65YHJGuf.js"),__vite__mapDeps([6,1]),import.meta.url).then(r=>r.default));wr(34887,()=>Er(()=>import("./lerc-lFnQODj_.js"),__vite__mapDeps([7,5,8,1,9,10,11,12,13]),import.meta.url).then(async r=>(await r.zstd.init(),r)).then(r=>r.default));wr(50001,()=>Er(()=>import("./webimage-NiQ987z3.js"),__vite__mapDeps([14,1]),import.meta.url).then(r=>r.default));function Ms(r,e,t,i=1){return new(Object.getPrototypeOf(r)).constructor(e*t*i)}function iE(r,e,t,i,n){const s=e/i,a=t/n;return r.map(o=>{const l=Ms(o,i,n);for(let h=0;h<n;++h){const c=Math.min(Math.round(a*h),t-1);for(let u=0;u<i;++u){const d=Math.min(Math.round(s*u),e-1),m=o[c*e+d];l[h*i+u]=m}}return l})}function si(r,e,t){return(1-t)*r+t*e}function nE(r,e,t,i,n){const s=e/i,a=t/n;return r.map(o=>{const l=Ms(o,i,n);for(let h=0;h<n;++h){const c=a*h,u=Math.floor(c),d=Math.min(Math.ceil(c),t-1);for(let m=0;m<i;++m){const g=s*m,y=g%1,_=Math.floor(g),v=Math.min(Math.ceil(g),e-1),E=o[u*e+_],S=o[u*e+v],w=o[d*e+_],P=o[d*e+v],A=si(si(E,S,y),si(w,P,y),c%1);l[h*i+m]=A}}return l})}function sE(r,e,t,i,n,s="nearest"){switch(s.toLowerCase()){case"nearest":return iE(r,e,t,i,n);case"bilinear":case"linear":return nE(r,e,t,i,n);default:throw new Error(`Unsupported resampling method: '${s}'`)}}function aE(r,e,t,i,n,s){const a=e/i,o=t/n,l=Ms(r,i,n,s);for(let h=0;h<n;++h){const c=Math.min(Math.round(o*h),t-1);for(let u=0;u<i;++u){const d=Math.min(Math.round(a*u),e-1);for(let m=0;m<s;++m){const g=r[c*e*s+d*s+m];l[h*i*s+u*s+m]=g}}}return l}function oE(r,e,t,i,n,s){const a=e/i,o=t/n,l=Ms(r,i,n,s);for(let h=0;h<n;++h){const c=o*h,u=Math.floor(c),d=Math.min(Math.ceil(c),t-1);for(let m=0;m<i;++m){const g=a*m,y=g%1,_=Math.floor(g),v=Math.min(Math.ceil(g),e-1);for(let E=0;E<s;++E){const S=r[u*e*s+_*s+E],w=r[u*e*s+v*s+E],P=r[d*e*s+_*s+E],A=r[d*e*s+v*s+E],I=si(si(S,w,y),si(P,A,y),c%1);l[h*i*s+m*s+E]=I}}}return l}function lE(r,e,t,i,n,s,a="nearest"){switch(a.toLowerCase()){case"nearest":return aE(r,e,t,i,n,s);case"bilinear":case"linear":return oE(r,e,t,i,n,s);default:throw new Error(`Unsupported resampling method: '${a}'`)}}function hE(r,e,t){let i=0;for(let n=e;n<t;++n)i+=r[n];return i}function Ma(r,e,t){switch(r){case 1:if(e<=8)return new Uint8Array(t);if(e<=16)return new Uint16Array(t);if(e<=32)return new Uint32Array(t);break;case 2:if(e===8)return new Int8Array(t);if(e===16)return new Int16Array(t);if(e===32)return new Int32Array(t);break;case 3:switch(e){case 16:case 32:return new Float32Array(t);case 64:return new Float64Array(t)}break}throw Error("Unsupported data format/bitsPerSample")}function uE(r,e){return(r===1||r===2)&&e<=32&&e%8===0?!1:!(r===3&&(e===16||e===32||e===64))}function cE(r,e,t,i,n,s,a){const o=new DataView(r),l=t===2?a*s:a*s*i,h=t===2?1:i,c=Ma(e,n,l),u=parseInt("1".repeat(n),2);if(e===1){let d;t===1?d=i*n:d=n;let m=s*d;m&7&&(m=m+7&-8);for(let g=0;g<a;++g){const y=g*m;for(let _=0;_<s;++_){const v=y+_*h*n;for(let E=0;E<h;++E){const S=v+E*n,w=(g*s+_)*h+E,P=Math.floor(S/8),A=S%8;if(A+n<=8)c[w]=o.getUint8(P)>>8-n-A&u;else if(A+n<=16)c[w]=o.getUint16(P)>>16-n-A&u;else if(A+n<=24){const I=o.getUint16(P)<<8|o.getUint8(P+2);c[w]=I>>24-n-A&u}else c[w]=o.getUint32(P)>>32-n-A&u}}}}return c.buffer}class fE{constructor(e,t,i,n,s,a){this.fileDirectory=e,this.geoKeys=t,this.dataView=i,this.littleEndian=n,this.tiles=s?{}:null,this.isTiled=!e.StripOffsets;const o=e.PlanarConfiguration;if(this.planarConfiguration=typeof o>"u"?1:o,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=a}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,i=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(i<=8)return DataView.prototype.getUint8;if(i<=16)return DataView.prototype.getUint16;if(i<=32)return DataView.prototype.getUint32;break;case 2:if(i<=8)return DataView.prototype.getInt8;if(i<=16)return DataView.prototype.getInt16;if(i<=32)return DataView.prototype.getInt32;break;case 3:switch(i){case 16:return function(n,s){return Dc(this,n,s)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const i=this.getSampleFormat(e),n=this.getBitsPerSample(e);return Ma(i,n,t)}async getTileOrStrip(e,t,i,n,s){const a=Math.ceil(this.getWidth()/this.getTileWidth()),o=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:h}=this;this.planarConfiguration===1?l=t*a+e:this.planarConfiguration===2&&(l=i*a*o+t*a+e);let c,u;this.isTiled?(c=this.fileDirectory.TileOffsets[l],u=this.fileDirectory.TileByteCounts[l]):(c=this.fileDirectory.StripOffsets[l],u=this.fileDirectory.StripByteCounts[l]);const d=(await this.source.fetch([{offset:c,length:u}],s))[0];let m;return h===null||!h[l]?(m=(async()=>{let g=await n.decode(this.fileDirectory,d);const y=this.getSampleFormat(),_=this.getBitsPerSample();return uE(y,_)&&(g=cE(g,y,this.planarConfiguration,this.getSamplesPerPixel(),_,this.getTileWidth(),this.getBlockHeight(t))),g})(),h!==null&&(h[l]=m)):m=h[l],{x:e,y:t,sample:i,data:await m}}async _readRaster(e,t,i,n,s,a,o,l,h){const c=this.getTileWidth(),u=this.getTileHeight(),d=this.getWidth(),m=this.getHeight(),g=Math.max(Math.floor(e[0]/c),0),y=Math.min(Math.ceil(e[2]/c),Math.ceil(d/c)),_=Math.max(Math.floor(e[1]/u),0),v=Math.min(Math.ceil(e[3]/u),Math.ceil(m/u)),E=e[2]-e[0];let S=this.getBytesPerPixel();const w=[],P=[];for(let C=0;C<t.length;++C)this.planarConfiguration===1?w.push(hE(this.fileDirectory.BitsPerSample,0,t[C])/8):w.push(0),P.push(this.getReaderForSample(t[C]));const A=[],{littleEndian:I}=this;for(let C=_;C<v;++C)for(let k=g;k<y;++k){let B;this.planarConfiguration===1&&(B=this.getTileOrStrip(k,C,0,s,h));for(let H=0;H<t.length;++H){const Y=H,f=t[H];this.planarConfiguration===2&&(S=this.getSampleByteSize(f),B=this.getTileOrStrip(k,C,f,s,h));const p=B.then(x=>{const R=x.data,L=new DataView(R),O=this.getBlockHeight(x.y),F=x.y*u,G=x.x*c,j=F+O,K=(x.x+1)*c,ge=P[Y],fe=Math.min(O,O-(j-e[3]),m-F),ye=Math.min(c,c-(K-e[2]),d-G);for(let me=Math.max(0,e[1]-F);me<fe;++me)for(let be=Math.max(0,e[0]-G);be<ye;++be){const qe=(me*c+be)*S,De=ge.call(L,qe+w[Y],I);let He;n?(He=(me+F-e[1])*E*t.length+(be+G-e[0])*t.length+Y,i[He]=De):(He=(me+F-e[1])*E+be+G-e[0],i[Y][He]=De)}});A.push(p)}}if(await Promise.all(A),a&&e[2]-e[0]!==a||o&&e[3]-e[1]!==o){let C;return n?C=lE(i,e[2]-e[0],e[3]-e[1],a,o,t.length,l):C=sE(i,e[2]-e[0],e[3]-e[1],a,o,l),C.width=a,C.height=o,C}return i.width=a||e[2]-e[0],i.height=o||e[3]-e[1],i}async readRasters({window:e,samples:t=[],interleave:i,pool:n=null,width:s,height:a,resampleMethod:o,fillValue:l,signal:h}={}){const c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const u=c[2]-c[0],d=c[3]-c[1],m=u*d,g=this.getSamplesPerPixel();if(!t||!t.length)for(let E=0;E<g;++E)t.push(E);else for(let E=0;E<t.length;++E)if(t[E]>=g)return Promise.reject(new RangeError(`Invalid sample index '${t[E]}'.`));let y;if(i){const E=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,S=Math.max.apply(null,this.fileDirectory.BitsPerSample);y=Ma(E,S,m*t.length),l&&y.fill(l)}else{y=[];for(let E=0;E<t.length;++E){const S=this.getArrayForSample(t[E],m);Array.isArray(l)&&E<l.length?S.fill(l[E]):l&&!Array.isArray(l)&&S.fill(l),y.push(S)}}const _=n||await Zc(this.fileDirectory);return await this._readRaster(c,t,y,i,_,s,a,o,h)}async readRGB({window:e,interleave:t=!0,pool:i=null,width:n,height:s,resampleMethod:a,enableAlpha:o=!1,signal:l}={}){const h=e||[0,0,this.getWidth(),this.getHeight()];if(h[0]>h[2]||h[1]>h[3])throw new Error("Invalid subsets");const c=this.fileDirectory.PhotometricInterpretation;if(c===at.RGB){let v=[0,1,2];if(this.fileDirectory.ExtraSamples!==Xv.Unspecified&&o){v=[];for(let E=0;E<this.fileDirectory.BitsPerSample.length;E+=1)v.push(E)}return this.readRasters({window:e,interleave:t,samples:v,pool:i,width:n,height:s,resampleMethod:a,signal:l})}let u;switch(c){case at.WhiteIsZero:case at.BlackIsZero:case at.Palette:u=[0];break;case at.CMYK:u=[0,1,2,3];break;case at.YCbCr:case at.CIELab:u=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const d={window:h,interleave:!0,samples:u,pool:i,width:n,height:s,resampleMethod:a,signal:l},{fileDirectory:m}=this,g=await this.readRasters(d),y=2**this.fileDirectory.BitsPerSample[0];let _;switch(c){case at.WhiteIsZero:_=Wv(g,y);break;case at.BlackIsZero:_=Vv(g,y);break;case at.Palette:_=Yv(g,m.ColorMap);break;case at.CMYK:_=Kv(g);break;case at.YCbCr:_=Qv(g);break;case at.CIELab:_=rE(g);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const v=new Uint8Array(_.length/3),E=new Uint8Array(_.length/3),S=new Uint8Array(_.length/3);for(let w=0,P=0;w<_.length;w+=3,++P)v[P]=_[w],E[P]=_[w+1],S[P]=_[w+2];_=[v,E,S]}return _.width=g.width,_.height=g.height,_}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const i=this.fileDirectory.GDAL_METADATA;let n=Zv(i,"Item");e===null?n=n.filter(s=>qs(s,"sample")===void 0):n=n.filter(s=>Number(qs(s,"sample"))===e);for(let s=0;s<n.length;++s){const a=n[s];t[qs(a,"name")]=a.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,i=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(i)return[i[0],-i[5],i[10]];if(e){const[n,s,a]=e.getResolution();return[n*e.getWidth()/this.getWidth(),s*e.getHeight()/this.getHeight(),a*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(){const e=this.getHeight(),t=this.getWidth();if(this.fileDirectory.ModelTransformation){const[i,n,s,a,o,l,h,c]=this.fileDirectory.ModelTransformation,d=[[0,0],[0,e],[t,0],[t,e]].map(([y,_])=>[a+i*y+n*_,c+o*y+l*_]),m=d.map(y=>y[0]),g=d.map(y=>y[1]);return[Math.min(...m),Math.min(...g),Math.max(...m),Math.max(...g)]}else{const i=this.getOrigin(),n=this.getResolution(),s=i[0],a=i[1],o=s+n[0]*this.getWidth(),l=a+n[1]*this.getHeight();return[Math.min(s,o),Math.min(a,l),Math.max(s,o),Math.max(a,l)]}}}const qc=fE;class dE{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const i=this.getUint32(e,t),n=this.getUint32(e+4,t);let s;if(t){if(s=i+2**32*n,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*i+n,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}getInt64(e,t){let i=0;const n=(this._dataView.getUint8(e+(t?7:0))&128)>0;let s=!0;for(let a=0;a<8;a++){let o=this._dataView.getUint8(e+(t?a:7-a));n&&(s?o!==0&&(o=~(o-1)&255,s=!1):o=~o&255),i+=o*256**a}return n&&(i=-i),i}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return Dc(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class gE{constructor(e,t,i,n){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=i,this._bigTiff=n}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),i=this.readUint32(e+4);let n;if(this._littleEndian){if(n=t+2**32*i,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}if(n=2**32*t+i,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}readInt64(e){let t=0;const i=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let n=!0;for(let s=0;s<8;s++){let a=this._dataView.getUint8(e+(this._littleEndian?s:7-s));i&&(n?a!==0&&(a=~(a-1)&255,n=!1):a=~a&255),t+=a*256**s}return i&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const mE=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class pE{constructor(e=mE,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise(i=>{Er(()=>import("./decoder-YCn7QQ1o.js"),__vite__mapDeps([15,8]),import.meta.url).then(n=>{i(n.create)})}),this._awaitingDecoder.then(i=>{this._awaitingDecoder=null,this.workers=[];for(let n=0;n<e;n++)this.workers.push({worker:i(),idle:!0})}))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?Zc(e).then(i=>i.decode(e,t)):new Promise(i=>{const n=this.workers.find(o=>o.idle)||this.workers[Math.floor(Math.random()*this.size)];n.idle=!1;const s=this.messageId++,a=o=>{o.data.id===s&&(n.idle=!0,i(o.data.decoded),n.worker.removeEventListener("message",a))};n.worker.addEventListener("message",a),n.worker.postMessage({fileDirectory:e,buffer:t,id:s},[t])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const yE=pE,uh=`\r
\r
`;function Xc(r){if(typeof Object.fromEntries<"u")return Object.fromEntries(r);const e={};for(const[t,i]of r)e[t.toLowerCase()]=i;return e}function _E(r){const e=r.split(`\r
`).map(t=>{const i=t.split(":").map(n=>n.trim());return i[0]=i[0].toLowerCase(),i});return Xc(e)}function xE(r){const[e,...t]=r.split(";").map(n=>n.trim()),i=t.map(n=>n.split("="));return{type:e,params:Xc(i)}}function Ra(r){let e,t,i;return r&&([,e,t,i]=r.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),t=parseInt(t,10),i=parseInt(i,10)),{start:e,end:t,total:i}}function vE(r,e){let t=null;const i=new TextDecoder("ascii"),n=[],s=`--${e}`,a=`${s}--`;for(let o=0;o<10;++o)i.decode(new Uint8Array(r,o,s.length))===s&&(t=o);if(t===null)throw new Error("Could not find initial boundary");for(;t<r.byteLength;){const o=i.decode(new Uint8Array(r,t,Math.min(s.length+1024,r.byteLength-t)));if(o.length===0||o.startsWith(a))break;if(!o.startsWith(s))throw new Error("Part does not start with boundary");const l=o.substr(s.length+2);if(l.length===0)break;const h=l.indexOf(uh),c=_E(l.substr(0,h)),{start:u,end:d,total:m}=Ra(c["content-range"]),g=t+s.length+h+uh.length,y=parseInt(d,10)+1-parseInt(u,10);n.push({headers:c,data:r.slice(g,g+y),offset:u,length:y,fileSize:m}),t=g+y+4}return n}class ko{async fetch(e,t=void 0){return Promise.all(e.map(i=>this.fetchSlice(i,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class EE extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,i]of e)this.onEviction(t,i.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const i=t.get(e);return this._getItemValue(e,i)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,i]=e;this.cache.has(t)||this._deleteIfExpired(t,i)===!1&&(yield e)}for(const e of this.cache){const[t,i]=e;this._deleteIfExpired(t,i)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:i=this.maxAge}={}){const n=typeof i=="number"&&i!==Number.POSITIVE_INFINITY?Date.now()+i:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:n}):this._set(e,{value:t,expiry:n}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],i=t.length-e;i<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(i>0&&this._emitEvictions(t.slice(0,i)),this.oldCache=new Map(t.slice(i)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,i]=e;this._deleteIfExpired(t,i)===!1&&(yield[t,i.value])}for(const e of this.oldCache){const[t,i]=e;this.cache.has(t)||this._deleteIfExpired(t,i)===!1&&(yield[t,i.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const i=e[t],[n,s]=i;this._deleteIfExpired(n,s)===!1&&(yield[n,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const i=e[t],[n,s]=i;this.cache.has(n)||this._deleteIfExpired(n,s)===!1&&(yield[n,s.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[i,n]of this.entriesAscending())e.call(t,n,i,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function wE(r){return new Promise(e=>setTimeout(e,r))}function SE(r,e){const t=Array.isArray(r)?r:Array.from(r),i=Array.isArray(e)?e:Array.from(e);return t.map((n,s)=>[n,i[s]])}class gi extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,gi),this.name="AbortError"}}class TE extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}const ME=TE;class RE{constructor(e,t,i=null){this.offset=e,this.length=t,this.data=i}get top(){return this.offset+this.length}}class ch{constructor(e,t,i){this.offset=e,this.length=t,this.blockIds=i}}class bE extends ko{constructor(e,{blockSize:t=65536,cacheSize:i=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new EE({maxSize:i,onEviction:(n,s)=>{this.evictedBlocks.set(n,s)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){const i=[],n=[],s=[];this.evictedBlocks.clear();for(const{offset:d,length:m}of e){let g=d+m;const{fileSize:y}=this;y!==null&&(g=Math.min(g,y));const _=Math.floor(d/this.blockSize)*this.blockSize;for(let v=_;v<g;v+=this.blockSize){const E=Math.floor(v/this.blockSize);!this.blockCache.has(E)&&!this.blockRequests.has(E)&&(this.blockIdsToFetch.add(E),n.push(E)),this.blockRequests.has(E)&&i.push(this.blockRequests.get(E)),s.push(E)}}await wE(),this.fetchBlocks(t);const a=[];for(const d of n)this.blockRequests.has(d)&&a.push(this.blockRequests.get(d));await Promise.allSettled(i),await Promise.allSettled(a);const o=[],l=s.filter(d=>this.abortedBlockIds.has(d)||!this.blockCache.has(d));if(l.forEach(d=>this.blockIdsToFetch.add(d)),l.length>0&&t&&!t.aborted){this.fetchBlocks(null);for(const d of l){const m=this.blockRequests.get(d);if(!m)throw new Error(`Block ${d} is not in the block requests`);o.push(m)}await Promise.allSettled(o)}if(t&&t.aborted)throw new gi("Request was aborted");const h=s.map(d=>this.blockCache.get(d)||this.evictedBlocks.get(d)),c=h.filter(d=>!d);if(c.length)throw new ME(c,"Request failed");const u=new Map(SE(s,h));return this.readSliceData(e,u)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const t=this.groupBlocks(this.blockIdsToFetch),i=this.source.fetch(t,e);for(let n=0;n<t.length;++n){const s=t[n];for(const a of s.blockIds)this.blockRequests.set(a,(async()=>{try{const o=(await i)[n],l=a*this.blockSize,h=l-o.offset,c=Math.min(h+this.blockSize,o.data.byteLength),u=o.data.slice(h,c),d=new RE(l,u.byteLength,u,a);this.blockCache.set(a,d),this.abortedBlockIds.delete(a)}catch(o){if(o.name==="AbortError")o.signal=e,this.blockCache.delete(a),this.abortedBlockIds.add(a);else throw o}finally{this.blockRequests.delete(a)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const t=Array.from(e).sort((a,o)=>a-o);if(t.length===0)return[];let i=[],n=null;const s=[];for(const a of t)n===null||n+1===a?(i.push(a),n=a):(s.push(new ch(i[0]*this.blockSize,i.length*this.blockSize,i)),i=[a],n=a);return s.push(new ch(i[0]*this.blockSize,i.length*this.blockSize,i)),s}readSliceData(e,t){return e.map(i=>{let n=i.offset+i.length;this.fileSize!==null&&(n=Math.min(this.fileSize,n));const s=Math.floor(i.offset/this.blockSize),a=Math.floor(n/this.blockSize),o=new ArrayBuffer(i.length),l=new Uint8Array(o);for(let h=s;h<=a;++h){const c=t.get(h),u=c.offset-i.offset,d=c.top-n;let m=0,g=0,y;u<0?m=-u:u>0&&(g=u),d<0?y=c.length-m:y=n-c.offset-m;const _=new Uint8Array(c.data,m,y);l.set(_,g)}return o})}}class $o{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class jo{constructor(e){this.url=e}async request({headers:e,credentials:t,signal:i}={}){throw new Error("request is not implemented")}}class PE extends $o{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class AE extends jo{constructor(e,t){super(e),this.credentials=t}async request({headers:e,credentials:t,signal:i}={}){const n=await fetch(this.url,{headers:e,credentials:t,signal:i});return new PE(n)}}class IE extends $o{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class LE extends jo{constructRequest(e,t){return new Promise((i,n)=>{const s=new XMLHttpRequest;s.open("GET",this.url),s.responseType="arraybuffer";for(const[a,o]of Object.entries(e))s.setRequestHeader(a,o);s.onload=()=>{const a=s.response;i(new IE(s,a))},s.onerror=n,s.onabort=()=>n(new gi("Request aborted")),s.send(),t&&(t.aborted&&s.abort(),t.addEventListener("abort",()=>s.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}const Ws={};class CE extends $o{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class OE extends jo{constructor(e){super(e),this.parsedUrl=Ws.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",Ws)}constructRequest(e,t){return new Promise((i,n)=>{const s=this.httpApi.get({...this.parsedUrl,headers:e},a=>{const o=new Promise(l=>{const h=[];a.on("data",c=>{h.push(c)}),a.on("end",()=>{const c=Buffer.concat(h).buffer;l(c)}),a.on("error",n)});i(new CE(a,o))});s.on("error",n),t&&(t.aborted&&s.destroy(new gi("Request aborted")),t.addEventListener("abort",()=>s.destroy(new gi("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class Zo extends ko{constructor(e,t,i,n){super(),this.client=e,this.headers=t,this.maxRanges=i,this.allowFullFile=n,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length>1,Promise.all(e.map(i=>this.fetchSlice(i,t))))}async fetchSlices(e,t){const i=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:n,length:s})=>`${n}-${n+s}`).join(",")}`},signal:t});if(i.ok)if(i.status===206){const{type:n,params:s}=xE(i.getHeader("content-type"));if(n==="multipart/byteranges"){const u=vE(await i.getData(),s.boundary);return this._fileSize=u[0].fileSize||null,u}const a=await i.getData(),{start:o,end:l,total:h}=Ra(i.getHeader("content-range"));this._fileSize=h||null;const c=[{data:a,offset:o,length:l-o}];if(e.length>1){const u=await Promise.all(e.slice(1).map(d=>this.fetchSlice(d,t)));return c.concat(u)}return c}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const n=await i.getData();return this._fileSize=n.byteLength,[{data:n,offset:0,length:n.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,t){const{offset:i,length:n}=e,s=await this.client.request({headers:{...this.headers,Range:`bytes=${i}-${i+n}`},signal:t});if(s.ok)if(s.status===206){const a=await s.getData(),{total:o}=Ra(s.getHeader("content-range"));return this._fileSize=o||null,{data:a,offset:i,length:n}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const a=await s.getData();return this._fileSize=a.byteLength,{data:a,offset:0,length:a.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function qo(r,{blockSize:e,cacheSize:t}){return e===null?r:new bE(r,{blockSize:e,cacheSize:t})}function NE(r,{headers:e={},credentials:t,maxRanges:i=0,allowFullFile:n=!1,...s}={}){const a=new AE(r,t),o=new Zo(a,e,i,n);return qo(o,s)}function FE(r,{headers:e={},maxRanges:t=0,allowFullFile:i=!1,...n}={}){const s=new LE(r),a=new Zo(s,e,t,i);return qo(a,n)}function DE(r,{headers:e={},maxRanges:t=0,allowFullFile:i=!1,...n}={}){const s=new OE(r),a=new Zo(s,e,t,i);return qo(a,n)}function ba(r,{forceXHR:e=!1,...t}={}){return typeof fetch=="function"&&!e?NE(r,t):typeof XMLHttpRequest<"u"?FE(r,t):DE(r,t)}class GE extends ko{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise((i,n)=>{const s=this.file.slice(e.offset,e.offset+e.length),a=new FileReader;a.onload=o=>i(o.target.result),a.onerror=n,a.onabort=n,a.readAsArrayBuffer(s),t&&t.addEventListener("abort",()=>a.abort())})}}function UE(r){return new GE(r)}function Pa(r){switch(r){case oe.BYTE:case oe.ASCII:case oe.SBYTE:case oe.UNDEFINED:return 1;case oe.SHORT:case oe.SSHORT:return 2;case oe.LONG:case oe.SLONG:case oe.FLOAT:case oe.IFD:return 4;case oe.RATIONAL:case oe.SRATIONAL:case oe.DOUBLE:case oe.LONG8:case oe.SLONG8:case oe.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${r}`)}}function BE(r){const e=r.GeoKeyDirectory;if(!e)return null;const t={};for(let i=4;i<=e[3]*4;i+=4){const n=Hv[e[i]],s=e[i+1]?qi[e[i+1]]:null,a=e[i+2],o=e[i+3];let l=null;if(!s)l=o;else{if(l=r[s],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${n}'.`);typeof l=="string"?l=l.substring(o,o+a-1):l.subarray&&(l=l.subarray(o,o+a),a===1&&(l=l[0]))}t[n]=l}return t}function $r(r,e,t,i){let n=null,s=null;const a=Pa(e);switch(e){case oe.BYTE:case oe.ASCII:case oe.UNDEFINED:n=new Uint8Array(t),s=r.readUint8;break;case oe.SBYTE:n=new Int8Array(t),s=r.readInt8;break;case oe.SHORT:n=new Uint16Array(t),s=r.readUint16;break;case oe.SSHORT:n=new Int16Array(t),s=r.readInt16;break;case oe.LONG:case oe.IFD:n=new Uint32Array(t),s=r.readUint32;break;case oe.SLONG:n=new Int32Array(t),s=r.readInt32;break;case oe.LONG8:case oe.IFD8:n=new Array(t),s=r.readUint64;break;case oe.SLONG8:n=new Array(t),s=r.readInt64;break;case oe.RATIONAL:n=new Uint32Array(t*2),s=r.readUint32;break;case oe.SRATIONAL:n=new Int32Array(t*2),s=r.readInt32;break;case oe.FLOAT:n=new Float32Array(t),s=r.readFloat32;break;case oe.DOUBLE:n=new Float64Array(t),s=r.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===oe.RATIONAL||e===oe.SRATIONAL)for(let o=0;o<t;o+=2)n[o]=s.call(r,i+o*a),n[o+1]=s.call(r,i+(o*a+4));else for(let o=0;o<t;++o)n[o]=s.call(r,i+o*a);return e===oe.ASCII?new TextDecoder("utf-8").decode(n):n}class zE{constructor(e,t,i){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=i}}class Tn extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class Hc{async readRasters(e={}){const{window:t,width:i,height:n}=e;let{resX:s,resY:a,bbox:o}=e;const l=await this.getImage();let h=l;const c=await this.getImageCount(),u=l.getBoundingBox();if(t&&o)throw new Error('Both "bbox" and "window" passed.');if(i||n){if(t){const[g,y]=l.getOrigin(),[_,v]=l.getResolution();o=[g+t[0]*_,y+t[1]*v,g+t[2]*_,y+t[3]*v]}const m=o||u;if(i){if(s)throw new Error("Both width and resX passed");s=(m[2]-m[0])/i}if(n){if(a)throw new Error("Both width and resY passed");a=(m[3]-m[1])/n}}if(s||a){const m=[];for(let g=0;g<c;++g){const y=await this.getImage(g),{SubfileType:_,NewSubfileType:v}=y.fileDirectory;(g===0||_===2||v&1)&&m.push(y)}m.sort((g,y)=>g.getWidth()-y.getWidth());for(let g=0;g<m.length;++g){const y=m[g],_=(u[2]-u[0])/y.getWidth(),v=(u[3]-u[1])/y.getHeight();if(h=y,s&&s>_||a&&a>v)break}}let d=t;if(o){const[m,g]=l.getOrigin(),[y,_]=h.getResolution(l);d=[Math.round((o[0]-m)/y),Math.round((o[1]-g)/_),Math.round((o[2]-m)/y),Math.round((o[3]-g)/_)],d=[Math.min(d[0],d[2]),Math.min(d[1],d[3]),Math.max(d[0],d[2]),Math.max(d[1],d[3])]}return h.readRasters({...e,window:d})}}let es=class Wc extends Hc{constructor(e,t,i,n,s={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=i,this.firstIFDOffset=n,this.cache=s.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const i=this.bigTiff?4048:1024;return new gE((await this.source.fetch([{offset:e,length:typeof t<"u"?t:i}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,i=this.bigTiff?8:2;let n=await this.getSlice(e);const s=this.bigTiff?n.readUint64(e):n.readUint16(e),a=s*t+(this.bigTiff?16:6);n.covers(e,a)||(n=await this.getSlice(e,a));const o={};let l=e+(this.bigTiff?8:2);for(let u=0;u<s;l+=t,++u){const d=n.readUint16(l),m=n.readUint16(l+2),g=this.bigTiff?n.readUint64(l+4):n.readUint32(l+4);let y,_;const v=Pa(m),E=l+(this.bigTiff?12:8);if(v*g<=(this.bigTiff?8:4))y=$r(n,m,g,E);else{const S=n.readOffset(E),w=Pa(m)*g;if(n.covers(S,w))y=$r(n,m,g,S);else{const P=await this.getSlice(S,w);y=$r(P,m,g,S)}}g===1&&qv.indexOf(d)===-1&&!(m===oe.RATIONAL||m===oe.SRATIONAL)?_=y[0]:_=y,o[qi[d]]=_}const h=BE(o),c=n.readOffset(e+i+t*s);return new zE(o,h,c)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){throw t instanceof Tn?new Tn(e):t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(t.nextIFDByteOffset===0)throw new Tn(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new qc(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(i){if(i instanceof Tn)t=!1;else throw i}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",i=t.length+100;let n=await this.getSlice(e,i);if(t===$r(n,oe.ASCII,t.length,e)){const a=$r(n,oe.ASCII,i,e).split(`
`)[0],o=Number(a.split("=")[1].split(" ")[0])+a.length;o>i&&(n=await this.getSlice(e,o));const l=$r(n,oe.ASCII,o,e);this.ghostValues={},l.split(`
`).filter(h=>h.length>0).map(h=>h.split("=")).forEach(([h,c])=>{this.ghostValues[h]=c})}return this.ghostValues}static async fromSource(e,t,i){const n=(await e.fetch([{offset:0,length:1024}],i))[0],s=new dE(n),a=s.getUint16(0,0);let o;if(a===18761)o=!0;else if(a===19789)o=!1;else throw new TypeError("Invalid byte order value.");const l=s.getUint16(2,o);let h;if(l===42)h=!1;else if(l===43){if(h=!0,s.getUint16(4,o)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const c=h?s.getUint64(8,o):s.getUint32(4,o);return new Wc(e,o,h,c,t)}close(){return typeof this.source.close=="function"?this.source.close():!1}};class kE extends Hc{constructor(e,t){super(),this.mainFile=e,this.overviewFiles=t,this.imageFiles=[e].concat(t),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(t=>t.parseFileDirectoryAt(t.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let t=0,i=0;for(let n=0;n<this.imageFiles.length;n++){const s=this.imageFiles[n];for(let a=0;a<this.imageCounts[n];a++){if(e===t){const o=await s.requestIFD(i);return new qc(o.fileDirectory,o.geoKeyDirectory,s.dataView,s.littleEndian,s.cache,s.source)}t++,i++}i=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(t=>t.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((t,i)=>t+i,0),this.imageCount}}async function $E(r,e={},t){return es.fromSource(ba(r,e),t)}async function jE(r,e){return es.fromSource(UE(r),e)}async function ZE(r,e=[],t={},i){const n=await es.fromSource(ba(r,t),i),s=await Promise.all(e.map(a=>es.fromSource(ba(a,t))));return new kE(n,s)}function qE(r){return((r.fileDirectory.NewSubfileType||0)&4)===4}function XE(r,e){if(!r)return!1;if(r===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const t=e.fileDirectory.PhotometricInterpretation,i=at;return t===i.CMYK||t===i.YCbCr||t===i.CIELab||t===i.ICCLab}const fh="STATISTICS_MAXIMUM",dh="STATISTICS_MINIMUM",Vs=256;let Ys;function HE(){return Ys||(Ys=new yE),Ys}function WE(r){try{return r.getBoundingBox()}catch{return[0,0,r.getWidth(),r.getHeight()]}}function VE(r){try{return r.getOrigin().slice(0,2)}catch{return[0,r.getHeight()]}}function YE(r,e){try{return r.getResolution(e)}catch{return[e.getWidth()/r.getWidth(),e.getHeight()/r.getHeight()]}}function KE(r){const e=r.geoKeys;if(!e)return null;if(e.ProjectedCSTypeGeoKey&&e.ProjectedCSTypeGeoKey!==32767){const t="EPSG:"+e.ProjectedCSTypeGeoKey;let i=de(t);if(!i){const n=dl(e.ProjLinearUnitsGeoKey);n&&(i=new ha({code:t,units:n}))}return i}if(e.GeographicTypeGeoKey&&e.GeographicTypeGeoKey!==32767){const t="EPSG:"+e.GeographicTypeGeoKey;let i=de(t);if(!i){const n=dl(e.GeogAngularUnitsGeoKey);n&&(i=new ha({code:t,units:n}))}return i}return null}function QE(r){return r.getImageCount().then(function(e){const t=new Array(e);for(let i=0;i<e;++i)t[i]=r.getImage(i);return Promise.all(t)})}function JE(r,e){let t;return r.blob?t=jE(r.blob):r.overviews?t=ZE(r.url,r.overviews,e):t=$E(r.url,e),t.then(QE)}function Fi(r,e,t,i,n){if(Array.isArray(r)){const s=r.length;if(!Array.isArray(e)||s!=e.length){const a=new Error(i);throw n(a),a}for(let a=0;a<s;++a)Fi(r[a],e[a],t,i,n);return}if(e=e,Math.abs(r-e)>t*r)throw new Error(i)}function ew(r){return r instanceof Int8Array?-128:r instanceof Int16Array?-32768:r instanceof Int32Array?-2147483648:r instanceof Float32Array?12e-39:0}function tw(r){return r instanceof Int8Array?127:r instanceof Uint8Array||r instanceof Uint8ClampedArray?255:r instanceof Int16Array?32767:r instanceof Uint16Array?65535:r instanceof Int32Array?2147483647:r instanceof Uint32Array?4294967295:r instanceof Float32Array?34e37:255}class Vc extends Ao{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,opaque:e.opaque,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map(s=>s.url).join(","));const i=this,n=new Array(t);for(let s=0;s<t;++s)n[s]=JE(this.sourceInfo_[s],this.sourceOptions_);Promise.all(n).then(function(s){i.configure_(s)}).catch(function(s){$n(s),i.error_=s,i.setState("error")})}getError(){return this.error_}determineProjection(e){const t=e[0];for(let i=t.length-1;i>=0;--i){const n=t[i],s=KE(n);if(s){this.projection=s;break}}}configure_(e){let t,i,n,s,a;const o=new Array(e.length),l=new Array(e.length),h=new Array(e.length);let c=0;const u=e.length;for(let y=0;y<u;++y){const _=[],v=[];e[y].forEach(C=>{qE(C)?v.push(C):_.push(C)});const E=_.length;if(v.length>0&&v.length!==E)throw new Error(`Expected one mask per image found ${v.length} masks and ${E} images`);let S,w;const P=new Array(E),A=new Array(E),I=new Array(E);l[y]=new Array(E),h[y]=new Array(E);for(let C=0;C<E;++C){const k=_[C],B=k.getGDALNoData();h[y][C]=k.getGDALMetadata(0),l[y][C]=B;const H=this.sourceInfo_[y].bands;o[y]=H?H.length:k.getSamplesPerPixel();const Y=E-(C+1);S||(S=WE(k)),w||(w=VE(k));const f=YE(k,_[0]);I[Y]=f[0];const p=[k.getTileWidth(),k.getTileHeight()];p[0]!==p[1]&&p[1]<Vs&&(p[0]=Vs,p[1]=Vs),P[Y]=p;const x=f[0]/Math.abs(f[1]);A[Y]=[p[0],p[1]/x]}if(t?Xt(t,S,t):t=S,!i)i=w;else{const C=`Origin mismatch for source ${y}, got [${w}] but expected [${i}]`;Fi(i,w,0,C,this.viewRejector)}if(!a)a=I,this.resolutionFactors_[y]=1;else{a.length-c>I.length&&(c=a.length-I.length);const C=a[a.length-1]/I[I.length-1];this.resolutionFactors_[y]=C;const k=I.map(H=>H*=C),B=`Resolution mismatch for source ${y}, got [${k}] but expected [${a}]`;Fi(a.slice(c,a.length),k,.02,B,this.viewRejector)}n?Fi(n.slice(c,n.length),A,.01,`Tile size mismatch for source ${y}`,this.viewRejector):n=A,s?Fi(s.slice(c,s.length),P,0,`Tile size mismatch for source ${y}`,this.viewRejector):s=P,this.sourceImagery_[y]=_.reverse(),this.sourceMasks_[y]=v.reverse()}for(let y=0,_=this.sourceImagery_.length;y<_;++y){const v=this.sourceImagery_[y];for(;v.length<a.length;)v.unshift(void 0)}this.getProjection()||this.determineProjection(e),this.samplesPerPixel_=o,this.nodataValues_=l,this.metadata_=h;e:for(let y=0;y<u;++y){if(this.sourceInfo_[y].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[y].length){this.addAlpha_=!0;break}const _=l[y],v=this.sourceInfo_[y].bands;if(v){for(let E=0;E<v.length;++E)if(_[v[E]-1]!==null){this.addAlpha_=!0;break e}continue}for(let E=0;E<_.length;++E)if(_[E]!==null){this.addAlpha_=!0;break e}}let d=this.addAlpha_?1:0;for(let y=0;y<u;++y)d+=o[y];this.bandCount=d;const m=new cs({extent:t,minZoom:c,origin:i,resolutions:a,tileSizes:n});this.tileGrid=m,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const g=1;a.length===2?a=[a[0],a[1],a[1]/2]:a.length===1&&(a=[a[0]*2,a[0],a[0]/2]),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:a,center:ig(fr(t),this.projection),extent:ng(t,this.projection),zoom:g})}loadTile_(e,t,i){const n=this.getTileSize(e),s=this.sourceImagery_.length,a=new Array(s*2),o=this.nodataValues_,l=this.sourceInfo_,h=HE();for(let c=0;c<s;++c){const u=l[c],d=this.resolutionFactors_[c],m=[Math.round(t*(n[0]*d)),Math.round(i*(n[1]*d)),Math.round((t+1)*(n[0]*d)),Math.round((i+1)*(n[1]*d))],g=this.sourceImagery_[c][e];let y;u.bands&&(y=u.bands.map(function(w){return w-1}));let _;"nodata"in u&&u.nodata!==null?_=u.nodata:y?_=y.map(function(w){return o[c][w]}):_=o[c];const v={window:m,width:n[0],height:n[1],samples:y,fillValue:_,pool:h,interleave:!1};XE(this.convertToRGB_,g)?a[c]=g.readRGB(v):a[c]=g.readRasters(v);const E=s+c,S=this.sourceMasks_[c][e];if(!S){a[E]=Promise.resolve(null);continue}a[E]=S.readRasters({window:m,width:n[0],height:n[1],samples:[0],pool:h,interleave:!1})}return Promise.all(a).then(this.composeTile_.bind(this,n)).catch(function(c){throw $n(c),c})}composeTile_(e,t){const i=this.metadata_,n=this.sourceInfo_,s=this.sourceImagery_.length,a=this.bandCount,o=this.samplesPerPixel_,l=this.nodataValues_,h=this.normalize_,c=this.addAlpha_,u=e[0]*e[1],d=u*a;let m;h?m=new Uint8Array(d):m=new Float32Array(d);let g=0;for(let y=0;y<u;++y){let _=c;for(let v=0;v<s;++v){const E=n[v];let S=E.min,w=E.max,P,A;if(h){const I=i[v][0];S===void 0&&(I&&dh in I?S=parseFloat(I[dh]):S=ew(t[v][0])),w===void 0&&(I&&fh in I?w=parseFloat(I[fh]):w=tw(t[v][0])),P=255/(w-S),A=-S*P}for(let I=0;I<o[v];++I){const C=t[v][I][y];let k;if(h?k=Ie(P*C+A,0,255):k=C,!c)m[g]=k;else{let B=E.nodata;if(B===void 0){let Y;E.bands?Y=E.bands[I]-1:Y=I,B=l[v][Y]}const H=isNaN(B);(!H&&C!==B||H&&!isNaN(C))&&(_=!1,m[g]=k)}g++}if(!_){const I=s+v,C=t[I];C&&!C[0][y]&&(_=!0)}}c&&(_||(m[g]=255),g++)}return m}}Vc.prototype.getView;const Yc=Vc;let Kc=class extends Za{constructor(e,t,i,n,s,a,o){super(t,i,n,s,a,o),this.zoomifyImage_=null,this.tileSize_=e}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=super.getImage();if(this.state==ie.LOADED){const t=this.tileSize_;if(e.width==t[0]&&e.height==t[1])return this.zoomifyImage_=e,e;const i=sr(t[0],t[1]);return i.drawImage(e,0,0),this.zoomifyImage_=i.canvas,i.canvas}return e}};class rw extends Gr{constructor(e){const t=e.size,i=e.tierSizeCalculation!==void 0?e.tierSizeCalculation:"default",n=e.tilePixelRatio||1,s=t[0],a=t[1],o=[],l=e.tileSize||ua;let h=l*n;switch(i){case"default":for(;s>h||a>h;)o.push([Math.ceil(s/h),Math.ceil(a/h)]),h+=h;break;case"truncated":let A=s,I=a;for(;A>h||I>h;)o.push([Math.ceil(A/h),Math.ceil(I/h)]),A>>=1,I>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}o.push([1,1]),o.reverse();const c=[n],u=[0];for(let A=1,I=o.length;A<I;A++)c.push(n<<A),u.push(o[A-1][0]*o[A-1][1]+u[A-1]);c.reverse();const d=new cs({tileSize:l,extent:e.extent||[0,-a,s,0],resolutions:c});let m=e.url;m&&!m.includes("{TileGroup}")&&!m.includes("{tileIndex}")&&(m+="{TileGroup}/{z}-{x}-{y}.jpg");const g=sg(m);let y=l*n;function _(A){return function(I,C,k){if(!I)return;const B=I[0],H=I[1],Y=I[2],f=H+Y*o[B][0],p=(f+u[B])/y|0,x={z:B,x:H,y:Y,tileIndex:f,TileGroup:"TileGroup"+p};return A.replace(/\{(\w+?)\}/g,function(R,L){return x[L]})}}const v=uu(g.map(_)),E=Kc.bind(null,Ht(l*n));super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,tilePixelRatio:n,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:E,tileGrid:d,tileUrlFunction:v,transition:e.transition}),this.zDirection=e.zDirection;const S=d.getTileCoordForCoordAndResolution(fr(d.getExtent()),c[c.length-1]),w=v(S,1,null),P=new Image;P.addEventListener("error",()=>{y=l,this.changed()}),P.src=w}}const iw=rw;function Ai(r){return r.toLocaleString("en",{maximumFractionDigits:10})}class nw extends Gr{constructor(e){const t=e||{};let i=t.url||"";i=i+(i.lastIndexOf("/")===i.length-1||i===""?"":"/");const n=t.version||ke.VERSION2,s=t.sizes||[],a=t.size;Yt(a!=null&&Array.isArray(a)&&a.length==2&&!isNaN(a[0])&&a[0]>0&&!isNaN(a[1])&&a[1]>0,"Missing or invalid `size`");const o=a[0],l=a[1],h=t.tileSize,c=t.tilePixelRatio||1,u=t.format||"jpg",d=t.quality||(t.version==ke.VERSION1?"native":"default");let m=t.resolutions||[];const g=t.supports||[],y=t.extent||[0,-l,o,0],_=s!=null&&Array.isArray(s)&&s.length>0,v=h!==void 0&&(typeof h=="number"&&Number.isInteger(h)&&h>0||Array.isArray(h)&&h.length>0),E=g!=null&&Array.isArray(g)&&(g.includes("regionByPx")||g.includes("regionByPct"))&&(g.includes("sizeByWh")||g.includes("sizeByH")||g.includes("sizeByW")||g.includes("sizeByPct"));let S,w,P;if(m.sort(function(k,B){return B-k}),v||E)if(h!=null&&(typeof h=="number"&&Number.isInteger(h)&&h>0?(S=h,w=h):Array.isArray(h)&&h.length>0&&((h.length==1||h[1]==null&&Number.isInteger(h[0]))&&(S=h[0],w=h[0]),h.length==2&&(Number.isInteger(h[0])&&Number.isInteger(h[1])?(S=h[0],w=h[1]):h[0]==null&&Number.isInteger(h[1])&&(S=h[1],w=h[1])))),(S===void 0||w===void 0)&&(S=ua,w=ua),m.length==0){P=Math.max(Math.ceil(Math.log(o/S)/Math.LN2),Math.ceil(Math.log(l/w)/Math.LN2));for(let k=P;k>=0;k--)m.push(Math.pow(2,k))}else{const k=Math.max(...m);P=Math.round(Math.log(k)/Math.LN2)}else if(S=o,w=l,m=[],_){s.sort(function(B,H){return B[0]-H[0]}),P=-1;const k=[];for(let B=0;B<s.length;B++){const H=o/s[B][0];if(m.length>0&&m[m.length-1]==H){k.push(B);continue}m.push(H),P++}if(k.length>0)for(let B=0;B<k.length;B++)s.splice(k[B]-B,1)}else m.push(1),s.push([o,l]),P=0;const A=new cs({tileSize:[S,w],extent:y,origin:ag(y),resolutions:m}),I=function(k,B,H){let Y,f;const p=k[0];if(p>P)return;const x=k[1],R=k[2],L=m[p];if(!(x===void 0||R===void 0||L===void 0||x<0||Math.ceil(o/L/S)<=x||R<0||Math.ceil(l/L/w)<=R)){if(E||v){const O=x*S*L,F=R*w*L;let G=S*L,j=w*L,K=S,ge=w;if(O+G>o&&(G=o-O),F+j>l&&(j=l-F),O+S*L>o&&(K=Math.floor((o-O+L-1)/L)),F+w*L>l&&(ge=Math.floor((l-F+L-1)/L)),O==0&&G==o&&F==0&&j==l)Y="full";else if(!E||g.includes("regionByPx"))Y=O+","+F+","+G+","+j;else if(g.includes("regionByPct")){const fe=Ai(O/o*100),ye=Ai(F/l*100),me=Ai(G/o*100),be=Ai(j/l*100);Y="pct:"+fe+","+ye+","+me+","+be}n==ke.VERSION3&&(!E||g.includes("sizeByWh"))?f=K+","+ge:!E||g.includes("sizeByW")?f=K+",":g.includes("sizeByH")?f=","+ge:g.includes("sizeByWh")?f=K+","+ge:g.includes("sizeByPct")&&(f="pct:"+Ai(100/L))}else if(Y="full",_){const O=s[p][0],F=s[p][1];n==ke.VERSION3?O==o&&F==l?f="max":f=O+","+F:O==o?f="full":f=O+","}else f=n==ke.VERSION3?"max":"full";return i+Y+"/"+f+"/0/"+d+"."+u}},C=Kc.bind(null,Ht(h||256).map(function(k){return k*c}));super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:t.state,tileClass:C,tileGrid:A,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:I,transition:t.transition}),this.zDirection=t.zDirection}}const sw=nw;function Qc(r,e,t,i,n,s){const a=n.getCode().split(/:(?=\d+$)/).pop(),o=t/i,l=[gl(xt(e)/o,ml),gl(pr(e)/o,ml)];s.SIZE=l[0]+","+l[1],s.BBOX=e.join(","),s.BBOXSR=a,s.IMAGESR=a,s.DPI=Math.round(s.DPI?s.DPI*i:90*i);const h=r.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");if(h==r)throw new Error("`options.featureTypes` should be an Array");return fu(h,s)}function Jc(r){const e=r.load?r.load:_i,t=de(r.projection||"EPSG:3857");return function(i,n,s){s=r.hidpi?s:1;const a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(a,r.params),i=cu(i,n,s,r.ratio);const o=Qc(r.url,i,n,s,t,a),l=new Image;return r.crossOrigin!==null&&(l.crossOrigin=r.crossOrigin),e(l,o).then(h=>{const c=xt(i)/h.width*s;return{image:h,extent:i,resolution:c,pixelRatio:s}})}}class aw extends Ur{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:Wa,this.params_=e.params||{},this.image_=null,this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,i,n){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==n)&&(this.loaderProjection_=n,this.loader=Jc({crossOrigin:this.crossOrigin_,params:this.params_,projection:n,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,a)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,a),_i(s))})),super.getImageInternal(e,t,i,n))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.image_=null,this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.image_=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.image_=null,this.changed()}}const ow=aw;class lw extends Ur{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions,state:e.state}),this.canvasFunction_=e.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5}getImageInternal(e,t,i,n){t=this.findNearestResolution(t);let s=this.canvas_;if(s&&this.renderedRevision_==this.getRevision()&&s.getResolution()==t&&s.getPixelRatio()==i&&Fn(s.getExtent(),e))return s;e=e.slice(),au(e,this.ratio_);const a=xt(e)/t,o=pr(e)/t,l=[a*i,o*i],h=this.canvasFunction_.call(this,e,t,i,l,n);return h&&(s=new Mo(e,t,i,h)),this.canvas_=s,this.renderedRevision_=this.getRevision(),s}}const hw=lw;function uw(r,e,t,i){const n=xt(r),s=pr(r),a=e[0],o=e[1],l=.0254/i;return o*n>a*s?n*t/(a*l):s*t/(o*l)}function cw(r,e,t,i,n,s,a){const o=uw(t,i,s,a),l=fr(t),h={OPERATION:n?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:a,SETDISPLAYWIDTH:Math.round(i[0]),SETDISPLAYHEIGHT:Math.round(i[1]),SETVIEWSCALE:o,SETVIEWCENTERX:l[0],SETVIEWCENTERY:l[1]};return Object.assign(h,e),fu(r,h)}function ef(r){const e=r.load||_i;return function(t,i,n){const s=new Image;r.crossOrigin!==null&&(s.crossOrigin=r.crossOrigin),t=cu(t,i,n,r.ratio);const a=xt(t)/i,o=pr(t)/i,l=[a*n,o*n],h=cw(r.url,r.params,t,l,r.useOverlay,r.metersPerUnit||1,r.displayDpi||96);return e(s,h).then(c=>({image:c,extent:t,pixelRatio:n}))}}class fw extends Ur{constructor(e){super({interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.displayDpi_=e.displayDpi!==void 0?e.displayDpi:96,this.params_=e.params||{},this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:Wa,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.metersPerUnit_=e.metersPerUnit!==void 0?e.metersPerUnit:1,this.ratio_=e.ratio!==void 0?e.ratio:1,this.useOverlay_=e.useOverlay!==void 0?e.useOverlay:!1,this.image_=null,this.renderedRevision_=0,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,i,n){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==n)&&(this.loaderProjection_=n,this.loader=ef({crossOrigin:this.crossOrigin_,params:this.params_,hidpi:this.hidpi_,metersPerUnit:this.metersPerUnit_,url:this.url_,useOverlay:this.useOverlay_,ratio:this.ratio_,load:(s,a)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,a),_i(s))})),super.getImageInternal(e,t,i,n))}getImageLoadFunction(){return this.imageLoadFunction_}updateParams(e){Object.assign(this.params_,e),this.changed()}setImageLoadFunction(e){this.image_=null,this.imageLoadFunction_=e,this.changed()}}const dw=fw;function tf(r){const e=r.load||_i,t=r.imageExtent,i=new Image;return r.crossOrigin!==null&&(i.crossOrigin=r.crossOrigin),()=>e(i,r.url).then(n=>{const s=xt(t)/n.width,a=pr(t)/n.height;return{image:n,extent:t,resolution:s!==a?[s,a]:a,pixelRatio:1}})}class gw extends Ur{constructor(e){const t=e.crossOrigin!==void 0?e.crossOrigin:null,i=e.imageLoadFunction!==void 0?e.imageLoadFunction:Wa;super({attributions:e.attributions,interpolate:e.interpolate,projection:de(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new su(this.imageExtent_,void 0,1,tf({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(n,s)=>(this.image.setImage(n),i(this.image,s),_i(n))})),this.image.addEventListener(ct.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,i,n){return ui(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}const rf=gw;function Xo(r,e,t,i){const n=document.createElement("script"),s="olc_"+Be(e);function a(){delete window[s],n.parentNode.removeChild(n)}n.async=!0,n.src=r+(r.includes("?")?"&":"?")+(i||"callback")+"="+s;const o=setTimeout(function(){a(),t&&t()},1e4);window[s]=function(l){clearTimeout(o),a(),e(l)},document.head.appendChild(n)}class mw extends Error{constructor(e){const t="Unexpected response status: "+e.status;super(t),this.name="ResponseError",this.response=e}}class pw extends Error{constructor(e){super("Failed to issue request"),this.name="ClientError",this.client=e}}function nf(r){return new Promise(function(e,t){function i(a){const o=a.target;if(!o.status||o.status>=200&&o.status<300){let l;try{l=JSON.parse(o.responseText)}catch(h){const c="Error parsing response text as JSON: "+h.message;t(new Error(c));return}e(l);return}t(new mw(o))}function n(a){t(new pw(a.target))}const s=new XMLHttpRequest;s.addEventListener("load",i),s.addEventListener("error",n),s.open("GET",r),s.setRequestHeader("Accept","application/json"),s.send()})}function sf(r,e){return e.includes("://")?e:new URL(e,r).href}const yw={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},_w={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function xw(r,e){let t,i;for(let n=0;n<r.length;++n){const s=r[n];if(s.rel==="item"){if(s.type===e){t=s.href;break}(yw[s.type]||!i&&s.type.startsWith("image/"))&&(i=s.href)}}if(!t)if(i)t=i;else throw new Error('Could not find "item" link');return t}function vw(r,e,t){let i,n;const s={};for(let a=0;a<r.length;++a){const o=r[a];if(s[o.type]=o.href,o.rel==="item"){if(o.type===e){i=o.href;break}_w[o.type]&&(n=o.href)}}if(!i&&t)for(let a=0;a<t.length;++a){const o=t[a];if(s[o]){i=s[o];break}}if(!i)if(n)i=n;else throw new Error('Could not find "item" link');return i}function gh(r,e,t,i){let n=r.projection;if(!n&&(n=de(e.crs),!n))throw new Error(`Unsupported CRS: ${e.crs}`);const s=n.getAxisOrientation().substr(0,2)!=="en",a=e.tileMatrices,o={};for(let w=0;w<a.length;++w){const P=a[w];o[P.id]=P}const l={},h=[];if(i)for(let w=0;w<i.length;++w){const P=i[w],A=P.tileMatrix;h.push(A),l[A]=P}else for(let w=0;w<a.length;++w){const P=a[w].id;h.push(P)}const c=h.length,u=new Array(c),d=new Array(c),m=new Array(c),g=new Array(c),y=[-1/0,-1/0,1/0,1/0];for(let w=0;w<c;++w){const P=h[w],A=o[P],I=A.pointOfOrigin;s?u[w]=[I[1],I[0]]:u[w]=I,d[w]=A.cellSize,m[w]=[A.matrixWidth,A.matrixHeight],g[w]=[A.tileWidth,A.tileHeight];const C=l[P];if(C){const k=A.cellSize*A.tileWidth,B=u[w][0]+C.minTileCol*k,H=u[w][0]+(C.maxTileCol+1)*k,Y=A.cellSize*A.tileHeight,f=A.cornerOfOrigin==="bottomLeft";let p,x;f?(p=u[w][1]+C.minTileRow*Y,x=u[w][1]+(C.maxTileRow+1)*Y):(p=u[w][1]-(C.maxTileRow+1)*Y,x=u[w][1]-C.minTileRow*Y),Xt(y,[B,p,H,x],y)}}const _=new cs({origins:u,resolutions:d,sizes:m,tileSizes:g,extent:i?y:void 0}),v=r.context,E=r.url;function S(w,P,A){if(!w)return;const I=h[w[0]],C=o[I],k=C.cornerOfOrigin==="bottomLeft",B={tileMatrix:I,tileCol:w[1],tileRow:k?-w[2]-1:w[2]};if(i){const Y=l[C.id];if(B.tileCol<Y.minTileCol||B.tileCol>Y.maxTileCol||B.tileRow<Y.minTileRow||B.tileRow>Y.maxTileRow)return}Object.assign(B,v);const H=t.replace(/\{(\w+?)\}/g,function(Y,f){return B[f]});return sf(E,H)}return{grid:_,urlTemplate:t,urlFunction:S}}function Ew(r,e){const t=e.tileMatrixSetLimits;let i;if(e.dataType==="map")i=xw(e.links,r.mediaType);else if(e.dataType==="vector")i=vw(e.links,r.mediaType,r.supportedMediaTypes);else throw new Error('Expected tileset data type to be "map" or "vector"');if(e.tileMatrixSet)return gh(r,e.tileMatrixSet,i,t);const n=e.links.find(o=>o.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!n)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const s=n.href,a=sf(r.url,s);return nf(a).then(function(o){return gh(r,o,i,t)})}function af(r){return nf(r.url).then(function(e){return Ew(r,e)})}class ww extends Gr{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition});const t={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,context:e.context||null};af(t).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){$n(e),this.setState("error")}}const Sw=ww;class Tw extends fs{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,format:e.format,overlaps:e.overlaps,projection:e.projection,tileClass:e.tileClass,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection,state:"loading"});const t={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,supportedMediaTypes:e.format.supportedMediaTypes,context:e.context||null};af(t).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){$n(e),this.setState("error")}}const Mw=Tw;let of=!0;try{new ImageData(10,10)}catch{of=!1}let Ks;function Rw(r,e,t){if(of)return new ImageData(r,e,t);Ks||(Ks=document.createElement("canvas").getContext("2d"));const i=Ks.createImageData(e,t);return i.data.set(r),i}function lf(r){let e=!0;try{new ImageData(10,10)}catch{e=!1}function t(i,n,s){return e?new ImageData(i,n,s):{data:i,width:n,height:s}}return function(i){const n=i.buffers,s=i.meta,a=i.imageOps,o=i.width,l=i.height,h=n.length,c=n[0].byteLength;if(a){const g=new Array(h);for(let _=0;_<h;++_)g[_]=t(new Uint8ClampedArray(n[_]),o,l);return r(g,s).data.buffer}const u=new Uint8ClampedArray(c),d=new Array(h),m=new Array(h);for(let g=0;g<h;++g)d[g]=new Uint8ClampedArray(n[g]),m[g]=[0,0,0,0];for(let g=0;g<c;g+=4){for(let _=0;_<h;++_){const v=d[_];m[_][0]=v[g],m[_][1]=v[g+1],m[_][2]=v[g+2],m[_][3]=v[g+3]}const y=r(m,s);u[g]=y[0],u[g+1]=y[1],u[g+2]=y[2],u[g+3]=y[3]}return u.buffer}}function bw(r,e){const i=Object.keys(r.lib||{}).map(function(s){return"const "+s+" = "+r.lib[s].toString()+";"}).concat(["const __minion__ = ("+lf.toString()+")(",r.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),n=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(i.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(i,{type:"text/javascript"})));return n.addEventListener("message",e),n}function Pw(r,e){const t=lf(r.operation);let i=!1;return{postMessage:function(n){setTimeout(function(){i||e({data:{buffer:t(n),meta:n.meta}})},0)},terminate:function(){i=!0}}}class Aw extends Qh{constructor(e){super(),this._imageOps=!!e.imageOps;let t;e.threads===0?t=0:this._imageOps?t=1:t=e.threads||1;const i=new Array(t);if(t)for(let n=0;n<t;++n)i[n]=bw(e,this._onWorkerMessage.bind(this,n));else i[0]=Pw(e,this._onWorkerMessage.bind(this,0));this._workers=i,this._queue=[],this._maxQueueLength=e.queue||1/0,this._running=0,this._dataLookup={},this._job=null}process(e,t,i){this._enqueue({inputs:e,meta:t,callback:i}),this._dispatch()}_enqueue(e){for(this._queue.push(e);this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)}_dispatch(){if(this._running||this._queue.length===0)return;const e=this._queue.shift();this._job=e;const t=e.inputs[0].width,i=e.inputs[0].height,n=e.inputs.map(function(l){return l.data.buffer}),s=this._workers.length;if(this._running=s,s===1){this._workers[0].postMessage({buffers:n,meta:e.meta,imageOps:this._imageOps,width:t,height:i},n);return}const a=e.inputs[0].data.length,o=4*Math.ceil(a/4/s);for(let l=0;l<s;++l){const h=l*o,c=[];for(let u=0,d=n.length;u<d;++u)c.push(n[u].slice(h,h+o));this._workers[l].postMessage({buffers:c,meta:e.meta,imageOps:this._imageOps,width:t,height:i},c)}}_onWorkerMessage(e,t){this.disposed||(this._dataLookup[e]=t.data,--this._running,this._running===0&&this._resolveJob())}_resolveJob(){const e=this._job,t=this._workers.length;let i,n;if(t===1)i=new Uint8ClampedArray(this._dataLookup[0].buffer),n=this._dataLookup[0].meta;else{const s=e.inputs[0].data.length;i=new Uint8ClampedArray(s),n=new Array(t);const a=4*Math.ceil(s/4/t);for(let o=0;o<t;++o){const l=this._dataLookup[o].buffer,h=o*a;i.set(new Uint8ClampedArray(l),h),n[o]=this._dataLookup[o].meta}}this._job=null,this._dataLookup={},e.callback(null,Rw(i,e.inputs[0].width,e.inputs[0].height),n),this._dispatch()}disposeInternal(){for(let e=0;e<this._workers.length;++e)this._workers[e].terminate();this._workers.length=0}}const mh={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class ph extends du{constructor(e,t,i){super(e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=i}}class hf extends Ur{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=e.operationType!==void 0?e.operationType:"pixel",this.threads_=e.threads!==void 0?e.threads:1,this.layers_=Cw(e.sources);const t=this.changed.bind(this);for(let i=0,n=this.layers_.length;i<n;++i)this.layers_[i].addEventListener(ct.CHANGE,t);this.useResolutions_=e.resolutions!==null,this.tileQueue_=new og(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:Ct(),declutterTree:null,extent:null,index:0,layerIndex:0,layerStatesArray:Lw(this.layers_),pixelRatio:1,pixelToCoordinateTransform:Ct(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:Be(this),renderTargets:{}},this.setAttributions(function(i){const n=[];for(let s=0,a=e.sources.length;s<a;++s){const o=e.sources[s],l=o instanceof Va?o:o.getSource();if(!l)continue;const h=l.getAttributions();if(typeof h=="function"){const c=h(i);n.push.apply(n,c)}}return n.length!==0?n:null}),e.operation!==void 0&&this.setOperation(e.operation,e.lib)}setOperation(e,t){this.processor_&&this.processor_.dispose(),this.processor_=new Aw({operation:e,imageOps:this.operationType_==="image",queue:1,lib:t,threads:this.threads_}),this.changed()}updateFrameState_(e,t,i){const n=Object.assign({},this.frameState_);n.viewState=Object.assign({},n.viewState);const s=fr(e);n.size[0]=Math.ceil(xt(e)/t),n.size[1]=Math.ceil(pr(e)/t),n.extent=[s[0]-n.size[0]*t/2,s[1]-n.size[1]*t/2,s[0]+n.size[0]*t/2,s[1]+n.size[1]*t/2],n.time=Date.now();const a=n.viewState;return a.center=s,a.projection=i,a.resolution=t,n}allSourcesReady_(){let e=!0,t;for(let i=0,n=this.layers_.length;i<n;++i)if(t=this.layers_[i].getSource(),!t||t.getState()!=="ready"){e=!1;break}return e}getImage(e,t,i,n){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),t=this.findNearestResolution(t);const s=this.updateFrameState_(e,t,n);if(this.requestedFrameState_=s,this.renderedImageCanvas_){const a=this.renderedImageCanvas_.getResolution(),o=this.renderedImageCanvas_.getExtent();(t!==a||!Un(s.extent,o))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),s.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const e=this.requestedFrameState_,t=this.layers_.length,i=new Array(t);for(let s=0;s<t;++s){e.layerIndex=s,e.renderTargets={};const a=Iw(this.layers_[s],e);if(a)i[s]=a;else return}const n={};this.dispatchEvent(new ph(mh.BEFOREOPERATIONS,e,n)),this.processor_.process(i,n,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,t,i,n){if(t||!i)return;const s=e.extent,a=e.viewState.resolution;if(a!==this.requestedFrameState_.viewState.resolution||!Un(s,this.requestedFrameState_.extent))return;let o;if(this.renderedImageCanvas_)o=this.renderedImageCanvas_.getImage().getContext("2d");else{const l=Math.round(xt(s)/a),h=Math.round(pr(s)/a);o=sr(l,h),this.renderedImageCanvas_=new Mo(s,a,1,o.canvas)}o.putImageData(i,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new ph(mh.AFTEROPERATIONS,e,n))}getResolutions(e){if(!this.useResolutions_)return null;let t=super.getResolutions();if(!t)for(let i=0,n=this.layers_.length;i<n&&(t=this.layers_[i].getSource().getResolutions(e),!t);++i);return t}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}hf.prototype.dispose;let Tr=null;function Iw(r,e){const t=r.getRenderer();if(!t)throw new Error("Unsupported layer type: "+r);if(!t.prepareFrame(e))return null;const i=e.size[0],n=e.size[1];if(i===0||n===0)return null;const s=t.renderFrame(e,null);let a;if(s instanceof HTMLCanvasElement)a=s;else{if(s&&(a=s.firstElementChild),!(a instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+a);if(a.width===i&&a.height===n)return a.getContext("2d").getImageData(0,0,i,n)}if(!Tr)Tr=sr(i,n,void 0,{willReadFrequently:!0});else{const o=Tr.canvas;o.width!==i||o.height!==n?Tr=sr(i,n,void 0,{willReadFrequently:!0}):Tr.clearRect(0,0,i,n)}return Tr.drawImage(a,0,0,i,n),Tr.getImageData(0,0,i,n)}function Lw(r){return r.map(function(e){return e.getLayerState()})}function Cw(r){const e=r.length,t=new Array(e);for(let i=0;i<e;++i)t[i]=Ow(r[i]);return t}function Ow(r){let e;return r instanceof Va?r instanceof us?e=new zn({source:r}):r instanceof Ur&&(e=new Xa({source:r})):e=r,e}const Nw=hf,Fw='&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>',Dw='&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>',Gw='&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>',Uw={stamen_terrain:{extension:"png",opaque:!0},stamen_terrain_background:{extension:"png",opaque:!0},stamen_terrain_labels:{extension:"png",opaque:!1},stamen_terrain_lines:{extension:"png",opaque:!1},stamen_toner_background:{extension:"png",opaque:!0},stamen_toner:{extension:"png",opaque:!0},stamen_toner_labels:{extension:"png",opaque:!1},stamen_toner_lines:{extension:"png",opaque:!1},stamen_toner_lite:{extension:"png",opaque:!0},stamen_watercolor:{extension:"jpg",opaque:!0},alidade_smooth:{extension:"png",opaque:!0},alidade_smooth_dark:{extension:"png",opaque:!0},outdoors:{extension:"png",opaque:!0},osm_bright:{extension:"png",opaque:!0}},Bw={stamen_terrain:{minZoom:0,maxZoom:18,retina:!0},stamen_toner:{minZoom:0,maxZoom:20,retina:!0},stamen_watercolor:{minZoom:1,maxZoom:18,retina:!1}};class zw extends fi{constructor(e){const t=e.layer.indexOf("-"),i=t==-1?e.layer:e.layer.slice(0,t),n=Bw[i]||{minZoom:0,maxZoom:20,retina:!0},s=Uw[e.layer],a=e.apiKey?"?api_key="+e.apiKey:"",o=n.retina&&e.retina?"@2x":"",l=e.url!==void 0?e.url:"https://tiles.stadiamaps.com/tiles/"+e.layer+"/{z}/{x}/{y}"+o+"."+s.extension+a,h=[Fw,Dw,lg];e.layer.startsWith("stamen_")&&h.splice(1,0,Gw),super({attributions:h,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:n.maxZoom,minZoom:e.minZoom!==void 0?e.minZoom:n.minZoom,opaque:s.opaque,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:l,tilePixelRatio:o?2:1,wrapX:e.wrapX,zDirection:e.zDirection})}}const kw=zw;class $w extends Gr{constructor(e){e=e||{},super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.params_=e.params||{},this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=$a(),this.setKey(this.getKeyForParams_())}getKeyForParams_(){let e=0;const t=[];for(const i in this.params_)t[e++]=i+"-"+this.params_[i];return t.join("/")}getParams(){return this.params_}getRequestUrl_(e,t,i,n,s,a){const o=this.urls;if(!o)return;let l;if(o.length==1)l=o[0];else{const h=hg(ug(e),o.length);l=o[h]}return Qc(l,i,(this.tileGrid||this.getTileGridForProjection(s)).getResolution(e[0]),n,s,a)}getTilePixelRatio(e){return this.hidpi_?e:1}updateParams(e){Object.assign(this.params_,e),this.setKey(this.getKeyForParams_())}tileUrlFunction(e,t,i){let n=this.getTileGrid();if(n||(n=this.getTileGridForProjection(i)),n.getResolutions().length<=e[0])return;t!=1&&!this.hidpi_&&(t=1);const s=n.getTileCoordExtent(e,this.tmpExtent_);let a=Ht(n.getTileSize(e[0]),this.tmpSize);t!=1&&(a=cg(a,t,this.tmpSize));const o={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(o,this.params_),this.getRequestUrl_(e,a,s,t,i,o)}}const jw=$w;class Zw extends fi{constructor(e){e=e||{},super({opaque:!1,projection:e.projection,tileGrid:e.tileGrid,wrapX:e.wrapX!==void 0?e.wrapX:!0,zDirection:e.zDirection,url:e.template||"z:{z} x:{x} y:{y}",tileLoadFunction:(t,i)=>{const n=t.getTileCoord()[0],s=Ht(this.tileGrid.getTileSize(n)),a=sr(s[0],s[1]);a.strokeStyle="grey",a.strokeRect(.5,.5,s[0]+.5,s[1]+.5),a.fillStyle="grey",a.strokeStyle="white",a.textAlign="center",a.textBaseline="middle",a.font="24px sans-serif",a.lineWidth=4,a.strokeText(i,s[0]/2,s[1]/2,s[0]),a.fillText(i,s[0]/2,s[1]/2,s[0]),t.setImage(a.canvas)}})}}const qw=Zw;class Xw extends Gr{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:de("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)Xo(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let i;try{i=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(i)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const t=de("EPSG:4326"),i=this.getProjection();let n;if(e.bounds!==void 0){const h=Ha(t,i);n=Wi(e.bounds,h)}const s=ls(i),a=e.minzoom||0,o=e.maxzoom||22,l=hs({extent:s,maxZoom:o,minZoom:a,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=gu(e.tiles,l),e.attribution&&!this.getAttributions()){const h=n!==void 0?n:s;this.setAttributions(function(c){return ui(h,c.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}}const uf=Xw;class Hw extends ru{constructor(e,t,i,n,s,a){super(e,t),this.src_=i,this.extent_=n,this.preemptive_=s,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=a}getImage(){return null}getData(e){if(!this.grid_||!this.keys_)return null;const t=(e[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),i=(e[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),n=this.grid_[Math.floor((1-i)*this.grid_.length)];if(typeof n!="string")return null;let s=n.charCodeAt(Math.floor(t*n.length));s>=93&&s--,s>=35&&s--,s-=32;let a=null;if(s in this.keys_){const o=this.keys_[s];this.data_&&o in this.data_?a=this.data_[o]:a=o}return a}forDataAtCoordinate(e,t,i){this.state==ie.EMPTY&&i===!0?(this.state=ie.IDLE,dg(this,ct.CHANGE,function(n){t(this.getData(e))},this),this.loadInternal_()):i===!0?setTimeout(()=>{t(this.getData(e))},0):t(this.getData(e))}getKey(){return this.src_}handleError_(){this.state=ie.ERROR,this.changed()}handleLoad_(e){this.grid_=e.grid,this.keys_=e.keys,this.data_=e.data,this.state=ie.LOADED,this.changed()}loadInternal_(){if(this.state==ie.IDLE)if(this.state=ie.LOADING,this.jsonp_)Xo(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",this.src_),e.send()}}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let i;try{i=JSON.parse(t.responseText)}catch{this.handleError_();return}this.handleLoad_(i)}else this.handleError_()}onXHRError_(e){this.handleError_()}load(){this.preemptive_?this.loadInternal_():this.setState(ie.EMPTY)}}class Ww extends us{constructor(e){if(super({projection:de("EPSG:3857"),state:"loading",zDirection:e.zDirection}),this.preemptive_=e.preemptive!==void 0?e.preemptive:!0,this.tileUrlFunction_=fg,this.template_=void 0,this.jsonp_=e.jsonp||!1,e.url)if(this.jsonp_)Xo(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let i;try{i=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(i)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTemplate(){return this.template_}forDataAtCoordinateAndResolution(e,t,i,n){if(this.tileGrid){const s=this.tileGrid.getZForResolution(t,this.zDirection),a=this.tileGrid.getTileCoordForCoordAndZ(e,s);this.getTile(a[0],a[1],a[2],1,this.getProjection()).forDataAtCoordinate(e,i,n)}else n===!0?setTimeout(function(){i(null)},0):i(null)}handleTileJSONError(){this.setState("error")}handleTileJSONResponse(e){const t=de("EPSG:4326"),i=this.getProjection();let n;if(e.bounds!==void 0){const c=Ha(t,i);n=Wi(e.bounds,c)}const s=ls(i),a=e.minzoom||0,o=e.maxzoom||22,l=hs({extent:s,maxZoom:o,minZoom:a});this.tileGrid=l,this.template_=e.template;const h=e.grids;if(!h){this.setState("error");return}if(this.tileUrlFunction_=gu(h,l),e.attribution!==void 0){const c=n!==void 0?n:s;this.setAttributions(function(u){return ui(c,u.extent)?[e.attribution]:null})}this.setState("ready")}getTile(e,t,i,n,s){const a=kn(e,t,i);if(this.tileCache.containsKey(a))return this.tileCache.get(a);const o=[e,t,i],l=this.getTileCoordForTileUrlFunction(o,s),h=this.tileUrlFunction_(l,n,s),c=new Hw(o,h!==void 0?ie.IDLE:ie.EMPTY,h!==void 0?h:"",this.tileGrid.getTileCoordExtent(o),this.preemptive_,this.jsonp_);return this.tileCache.set(a,c),c}useTile(e,t,i){const n=kn(e,t,i);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}const Vw=Ww;function Yw(r,e){const t=new iu(32),i=r.getExtent();return function(n,s){t.expireCache(),i&&(n=Xt(i,n));const a=r.getZForResolution(s),o=[];return r.forEachTileCoord(n,a,l=>{const h=l.toString();if(!t.containsKey(h)){const c=e(l);t.set(h,c)}o.push(t.get(h))}),o}}const Kw=Object.freeze(Object.defineProperty({__proto__:null,BingMaps:ov,CartoDB:hv,Cluster:cv,DataTile:Ao,GeoTIFF:Yc,IIIF:sw,Image:Ur,ImageArcGISRest:ow,ImageCanvas:hw,ImageMapGuide:dw,ImageStatic:rf,ImageWMS:gg,OGCMapTile:Sw,OGCVectorTile:Mw,OSM:mg,Raster:Nw,Source:Va,StadiaMaps:kw,Tile:us,TileArcGISRest:jw,TileDebug:qw,TileImage:Gr,TileJSON:uf,TileWMS:mu,UTFGrid:Vw,UrlTile:pg,Vector:os,VectorTile:fs,WMTS:pu,XYZ:fi,Zoomify:iw,createArcGISRestLoader:Jc,createMapGuideLoader:ef,createStaticLoader:tf,createWMSLoader:yg,sourcesFromTileGrid:Yw},Symbol.toStringTag,{value:"Module"}));window.eoxMapAdvancedOlFormats=wx;var et=(r,e,t)=>new Promise((i,n)=>{var s=l=>{try{o(t.next(l))}catch(h){n(h)}},a=l=>{try{o(t.throw(l))}catch(h){n(h)}},o=l=>l.done?i(l.value):Promise.resolve(l.value).then(s,a);o((t=t.apply(r,e)).next())}),yt=Uint8Array,Kr=Uint16Array,Qw=Int32Array,cf=new yt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ff=new yt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Jw=new yt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),df=function(r,e){for(var t=new Kr(31),i=0;i<31;++i)t[i]=e+=1<<r[i-1];for(var n=new Qw(t[30]),i=1;i<30;++i)for(var s=t[i];s<t[i+1];++s)n[s]=s-t[i]<<5|i;return{b:t,r:n}},gf=df(cf,2),mf=gf.b,eS=gf.r;mf[28]=258,eS[258]=28;var tS=df(ff,0),rS=tS.b,Aa=new Kr(32768);for(Se=0;Se<32768;++Se)Jt=(Se&43690)>>1|(Se&21845)<<1,Jt=(Jt&52428)>>2|(Jt&13107)<<2,Jt=(Jt&61680)>>4|(Jt&3855)<<4,Aa[Se]=((Jt&65280)>>8|(Jt&255)<<8)>>1;var Jt,Se,Xi=function(r,e,t){for(var i=r.length,n=0,s=new Kr(e);n<i;++n)r[n]&&++s[r[n]-1];var a=new Kr(e);for(n=1;n<e;++n)a[n]=a[n-1]+s[n-1]<<1;var o;if(t){o=new Kr(1<<e);var l=15-e;for(n=0;n<i;++n)if(r[n])for(var h=n<<4|r[n],c=e-r[n],u=a[r[n]-1]++<<c,d=u|(1<<c)-1;u<=d;++u)o[Aa[u]>>l]=h}else for(o=new Kr(i),n=0;n<i;++n)r[n]&&(o[n]=Aa[a[r[n]-1]++]>>15-r[n]);return o},ln=new yt(288);for(Se=0;Se<144;++Se)ln[Se]=8;var Se;for(Se=144;Se<256;++Se)ln[Se]=9;var Se;for(Se=256;Se<280;++Se)ln[Se]=7;var Se;for(Se=280;Se<288;++Se)ln[Se]=8;var Se,pf=new yt(32);for(Se=0;Se<32;++Se)pf[Se]=5;var Se,iS=Xi(ln,9,1),nS=Xi(pf,5,1),Qs=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},It=function(r,e,t){var i=e/8|0;return(r[i]|r[i+1]<<8)>>(e&7)&t},Js=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},sS=function(r){return(r+7)/8|0},aS=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var i=new yt(t-e);return i.set(r.subarray(e,t)),i},oS=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],pt=function(r,e,t){var i=new Error(e||oS[r]);if(i.code=r,Error.captureStackTrace&&Error.captureStackTrace(i,pt),!t)throw i;return i},Ho=function(r,e,t,i){var n=r.length,s=i?i.length:0;if(!n||e.f&&!e.l)return t||new yt(0);var a=!t||e.i!=2,o=e.i;t||(t=new yt(n*3));var l=function(He){var je=t.length;if(He>je){var Qe=new yt(Math.max(je*2,He));Qe.set(t),t=Qe}},h=e.f||0,c=e.p||0,u=e.b||0,d=e.l,m=e.d,g=e.m,y=e.n,_=n*8;do{if(!d){h=It(r,c,1);var v=It(r,c+1,3);if(c+=3,v)if(v==1)d=iS,m=nS,g=9,y=5;else if(v==2){var P=It(r,c,31)+257,A=It(r,c+10,15)+4,I=P+It(r,c+5,31)+1;c+=14;for(var C=new yt(I),k=new yt(19),B=0;B<A;++B)k[Jw[B]]=It(r,c+B*3,7);c+=A*3;for(var H=Qs(k),Y=(1<<H)-1,f=Xi(k,H,1),B=0;B<I;){var p=f[It(r,c,Y)];c+=p&15;var E=p>>4;if(E<16)C[B++]=E;else{var x=0,R=0;for(E==16?(R=3+It(r,c,3),c+=2,x=C[B-1]):E==17?(R=3+It(r,c,7),c+=3):E==18&&(R=11+It(r,c,127),c+=7);R--;)C[B++]=x}}var L=C.subarray(0,P),O=C.subarray(P);g=Qs(L),y=Qs(O),d=Xi(L,g,1),m=Xi(O,y,1)}else pt(1);else{var E=sS(c)+4,S=r[E-4]|r[E-3]<<8,w=E+S;if(w>n){o&&pt(0);break}a&&l(u+S),t.set(r.subarray(E,w),u),e.b=u+=S,e.p=c=w*8,e.f=h;continue}if(c>_){o&&pt(0);break}}a&&l(u+131072);for(var F=(1<<g)-1,G=(1<<y)-1,j=c;;j=c){var x=d[Js(r,c)&F],K=x>>4;if(c+=x&15,c>_){o&&pt(0);break}if(x||pt(2),K<256)t[u++]=K;else if(K==256){j=c,d=null;break}else{var ge=K-254;if(K>264){var B=K-257,fe=cf[B];ge=It(r,c,(1<<fe)-1)+mf[B],c+=fe}var ye=m[Js(r,c)&G],me=ye>>4;ye||pt(3),c+=ye&15;var O=rS[me];if(me>3){var fe=ff[me];O+=Js(r,c)&(1<<fe)-1,c+=fe}if(c>_){o&&pt(0);break}a&&l(u+131072);var be=u+ge;if(u<O){var qe=s-O,De=Math.min(O,be);for(qe+u<0&&pt(3);u<De;++u)t[u]=i[qe+u]}for(;u<be;u+=4)t[u]=t[u-O],t[u+1]=t[u+1-O],t[u+2]=t[u+2-O],t[u+3]=t[u+3-O];u=be}}e.l=d,e.p=j,e.b=u,e.f=h,d&&(h=1,e.m=g,e.d=m,e.n=y)}while(!h);return u==t.length?t:aS(t,0,u)},lS=new yt(0),hS=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&pt(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!r[t++]);return t+(e&2)},uS=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},cS=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&pt(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&pt(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function fS(r,e){return Ho(r,{i:2},e&&e.out,e&&e.dictionary)}function dS(r,e){var t=hS(r);return t+8>r.length&&pt(6,"invalid gzip data"),Ho(r.subarray(t,-8),{i:2},e&&e.out||new yt(uS(r)),e&&e.dictionary)}function gS(r,e){return Ho(r.subarray(cS(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Ia(r,e){return r[0]==31&&r[1]==139&&r[2]==8?dS(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?fS(r,e):gS(r,e)}var mS=typeof TextDecoder<"u"&&new TextDecoder,pS=0;try{mS.decode(lS,{stream:!0}),pS=1}catch{}var yf=(r,e)=>r*Math.pow(2,e),Ii=(r,e)=>Math.floor(r/Math.pow(2,e)),ts=(r,e)=>yf(r.getUint16(e+1,!0),8)+r.getUint8(e),_f=(r,e)=>yf(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),yS=(r,e,t,i,n)=>{if(r!=i.getUint8(n))return r-i.getUint8(n);const s=ts(i,n+1);if(e!=s)return e-s;const a=ts(i,n+4);return t!=a?t-a:0},_S=(r,e,t,i)=>{const n=xf(r,e|128,t,i);return n?{z:e,x:t,y:i,offset:n[0],length:n[1],is_dir:!0}:null},yh=(r,e,t,i)=>{const n=xf(r,e,t,i);return n?{z:e,x:t,y:i,offset:n[0],length:n[1],is_dir:!1}:null},xf=(r,e,t,i)=>{let n=0,s=r.byteLength/17-1;for(;n<=s;){const a=s+n>>1,o=yS(e,t,i,r,a*17);if(o>0)n=a+1;else if(o<0)s=a-1;else return[_f(r,a*17+7),r.getUint32(a*17+13,!0)]}return null},xS=(r,e)=>r.is_dir&&!e.is_dir?1:!r.is_dir&&e.is_dir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,vf=(r,e)=>{const t=r.getUint8(e*17);return{z:t&127,x:ts(r,e*17+1),y:ts(r,e*17+4),offset:_f(r,e*17+7),length:r.getUint32(e*17+13,!0),is_dir:t>>7===1}},_h=r=>{const e=[],t=new DataView(r);for(let i=0;i<t.byteLength/17;i++)e.push(vf(t,i));return vS(e)},vS=r=>{r.sort(xS);const e=new ArrayBuffer(17*r.length),t=new Uint8Array(e);for(let i=0;i<r.length;i++){const n=r[i];let s=n.z;n.is_dir&&(s=s|128),t[i*17]=s,t[i*17+1]=n.x&255,t[i*17+2]=n.x>>8&255,t[i*17+3]=n.x>>16&255,t[i*17+4]=n.y&255,t[i*17+5]=n.y>>8&255,t[i*17+6]=n.y>>16&255,t[i*17+7]=n.offset&255,t[i*17+8]=Ii(n.offset,8)&255,t[i*17+9]=Ii(n.offset,16)&255,t[i*17+10]=Ii(n.offset,24)&255,t[i*17+11]=Ii(n.offset,32)&255,t[i*17+12]=Ii(n.offset,48)&255,t[i*17+13]=n.length&255,t[i*17+14]=n.length>>8&255,t[i*17+15]=n.length>>16&255,t[i*17+16]=n.length>>24&255}return e},ES=(r,e)=>{if(r.byteLength<17)return null;const t=r.byteLength/17,i=vf(r,t-1);if(i.is_dir){const n=i.z,s=e.z-n,a=Math.trunc(e.x/(1<<s)),o=Math.trunc(e.y/(1<<s));return{z:n,x:a,y:o}}return null};function wS(r){return et(this,null,function*(){const e=yield r.getBytes(0,512e3),t=new DataView(e.data),i=t.getUint32(4,!0),n=t.getUint16(8,!0),s=new TextDecoder("utf-8"),a=JSON.parse(s.decode(new DataView(e.data,10,i)));let o=0;a.compression==="gzip"&&(o=2);let l=0;"minzoom"in a&&(l=+a.minzoom);let h=0;"maxzoom"in a&&(h=+a.maxzoom);let c=0,u=0,d=0,m=-180,g=-85,y=180,_=85;if(a.bounds){const E=a.bounds.split(",");m=+E[0],g=+E[1],y=+E[2],_=+E[3]}if(a.center){const E=a.center.split(",");c=+E[0],u=+E[1],d=+E[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+i,rootDirectoryLength:n*17,jsonMetadataOffset:10,jsonMetadataLength:i,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:o,tileType:1,minZoom:l,maxZoom:h,minLon:m,minLat:g,maxLon:y,maxLat:_,centerZoom:d,centerLon:c,centerLat:u,etag:e.etag}})}function SS(r,e,t,i,n,s,a){return et(this,null,function*(){let o=yield t.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(o=_h(o));const l=yh(new DataView(o),i,n,s);if(l){let u=(yield e.getBytes(l.offset,l.length,a)).data;const d=new DataView(u);return d.getUint8(0)==31&&d.getUint8(1)==139&&(u=Ia(new Uint8Array(u))),{data:u}}const h=ES(new DataView(o),{z:i,x:n,y:s});if(h){const c=_S(new DataView(o),h.z,h.x,h.y);if(c){let u=yield t.getArrayBuffer(e,c.offset,c.length,r);r.specVersion===1&&(u=_h(u));const d=yh(new DataView(u),i,n,s);if(d){let g=(yield e.getBytes(d.offset,d.length,a)).data;const y=new DataView(g);return y.getUint8(0)==31&&y.getUint8(1)==139&&(g=Ia(new Uint8Array(g))),{data:g}}}}})}var Ef={getHeader:wS,getZxy:SS};function jr(r,e){return(e>>>0)*4294967296+(r>>>0)}function TS(r,e){const t=e.buf;let i,n;if(n=t[e.pos++],i=(n&112)>>4,n<128||(n=t[e.pos++],i|=(n&127)<<3,n<128)||(n=t[e.pos++],i|=(n&127)<<10,n<128)||(n=t[e.pos++],i|=(n&127)<<17,n<128)||(n=t[e.pos++],i|=(n&127)<<24,n<128)||(n=t[e.pos++],i|=(n&1)<<31,n<128))return jr(r,i);throw new Error("Expected varint not more than 10 bytes")}function Li(r){const e=r.buf;let t,i;return i=e[r.pos++],t=i&127,i<128||(i=e[r.pos++],t|=(i&127)<<7,i<128)||(i=e[r.pos++],t|=(i&127)<<14,i<128)||(i=e[r.pos++],t|=(i&127)<<21,i<128)?t:(i=e[r.pos],t|=(i&15)<<28,TS(t,r))}function MS(r,e,t,i){if(i==0){t==1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const n=e[0];e[0]=e[1],e[1]=n}}var RS=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function bS(r,e,t){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,r)-1||t>Math.pow(2,r)-1)throw Error("tile x/y outside zoom level bounds");const i=RS[r],n=Math.pow(2,r);let s=0,a=0,o=0;const l=[e,t];let h=n/2;for(;h>0;)s=(l[0]&h)>0?1:0,a=(l[1]&h)>0?1:0,o+=h*h*(3*s^a),MS(h,l,s,a),h=h/2;return i+o}function wf(r,e){return et(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Ia(new Uint8Array(r));{let i=new Response(r).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(i).arrayBuffer()}}else throw Error("Compression method not supported")})}var Xr=(r=>(r[r.Unknown=0]="Unknown",r[r.Mvt=1]="Mvt",r[r.Png=2]="Png",r[r.Jpeg=3]="Jpeg",r[r.Webp=4]="Webp",r[r.Avif=5]="Avif",r))(Xr||{}),PS=127;function AS(r,e){let t=0,i=r.length-1;for(;t<=i;){const n=i+t>>1,s=e-r[n].tileId;if(s>0)t=n+1;else if(s<0)i=n-1;else return r[n]}return i>=0&&(r[i].runLength===0||e-r[i].tileId<r[i].runLength)?r[i]:null}var IS=class{constructor(r,e=new Headers){this.url=r,this.customHeaders=e}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,e,t){return et(this,null,function*(){let i;t||(i=new AbortController,t=i.signal);const n=new Headers(this.customHeaders);n.set("Range","bytes="+r+"-"+(r+e-1));let s=yield fetch(this.url,{signal:t,headers:n});if(s.status===416&&r===0){const l=s.headers.get("Content-Range");if(!l||!l.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const h=+l.substr(8);s=yield fetch(this.url,{signal:t,headers:{Range:"bytes=0-"+(h-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);const a=s.headers.get("Content-Length");if(s.status===200&&(!a||+a>e))throw i&&i.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function Lt(r,e){const t=r.getUint32(e+4,!0),i=r.getUint32(e+0,!0);return t*Math.pow(2,32)+i}function LS(r,e){const t=new DataView(r),i=t.getUint8(7);if(i>3)throw Error(`Archive is spec version ${i} but this library supports up to spec version 3`);return{specVersion:i,rootDirectoryOffset:Lt(t,8),rootDirectoryLength:Lt(t,16),jsonMetadataOffset:Lt(t,24),jsonMetadataLength:Lt(t,32),leafDirectoryOffset:Lt(t,40),leafDirectoryLength:Lt(t,48),tileDataOffset:Lt(t,56),tileDataLength:Lt(t,64),numAddressedTiles:Lt(t,72),numTileEntries:Lt(t,80),numTileContents:Lt(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function Sf(r){const e={buf:new Uint8Array(r),pos:0},t=Li(e),i=[];let n=0;for(let s=0;s<t;s++){const a=Li(e);i.push({tileId:n+a,offset:0,length:0,runLength:1}),n+=a}for(let s=0;s<t;s++)i[s].runLength=Li(e);for(let s=0;s<t;s++)i[s].length=Li(e);for(let s=0;s<t;s++){const a=Li(e);a===0&&s>0?i[s].offset=i[s-1].offset+i[s-1].length:i[s].offset=a-1}return i}function CS(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var Qr=class extends Error{};function OS(r,e,t,i){return et(this,null,function*(){const n=yield r.getBytes(0,16384);if(new DataView(n.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(CS(n.data)<3)return[yield Ef.getHeader(r)];const a=n.data.slice(0,PS);let o=n.etag;i&&n.etag!=i&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+r.getKey()),o=void 0);const l=LS(a,o);if(t){const h=n.data.slice(l.rootDirectoryOffset,l.rootDirectoryOffset+l.rootDirectoryLength),c=r.getKey()+"|"+(l.etag||"")+"|"+l.rootDirectoryOffset+"|"+l.rootDirectoryLength,u=Sf(yield e(h,l.internalCompression));return[l,[c,u.length,u]]}return[l,void 0]})}function NS(r,e,t,i,n){return et(this,null,function*(){const s=yield r.getBytes(t,i);if(n.etag&&n.etag!==s.etag)throw new Qr(s.etag);const a=yield e(s.data,n.internalCompression),o=Sf(a);if(o.length===0)throw new Error("Empty directory is invalid");return o})}var FS=class{constructor(r=100,e=!0,t=wf){this.cache=new Map,this.maxCacheEntries=r,this.counter=1,this.prefetch=e,this.decompress=t}getHeader(r,e){return et(this,null,function*(){const t=r.getKey();if(this.cache.has(t))return this.cache.get(t).lastUsed=this.counter++,yield this.cache.get(t).data;const i=new Promise((n,s)=>{OS(r,this.decompress,this.prefetch,e).then(a=>{a[1]&&this.cache.set(a[1][0],{lastUsed:this.counter++,data:Promise.resolve(a[1][2])}),n(a[0]),this.prune()}).catch(a=>{s(a)})});return this.cache.set(t,{lastUsed:this.counter++,data:i}),i})}getDirectory(r,e,t,i){return et(this,null,function*(){const n=r.getKey()+"|"+(i.etag||"")+"|"+e+"|"+t;if(this.cache.has(n))return this.cache.get(n).lastUsed=this.counter++,yield this.cache.get(n).data;const s=new Promise((a,o)=>{NS(r,this.decompress,e,t,i).then(l=>{a(l),this.prune()}).catch(l=>{o(l)})});return this.cache.set(n,{lastUsed:this.counter++,data:s}),s})}getArrayBuffer(r,e,t,i){return et(this,null,function*(){const n=r.getKey()+"|"+(i.etag||"")+"|"+e+"|"+t;if(this.cache.has(n))return this.cache.get(n).lastUsed=this.counter++,yield this.cache.get(n).data;const s=new Promise((a,o)=>{r.getBytes(e,t).then(l=>{if(i.etag&&i.etag!==l.etag)throw new Qr(l.etag);a(l.data),this.cache.has(n),this.prune()}).catch(l=>{o(l)})});return this.cache.set(n,{lastUsed:this.counter++,data:s}),s})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((t,i)=>{t.lastUsed<r&&(r=t.lastUsed,e=i)}),e&&this.cache.delete(e)}}invalidate(r,e){return et(this,null,function*(){this.cache.delete(r.getKey()),yield this.getHeader(r,e)})}},Wo=class{constructor(r,e,t){typeof r=="string"?this.source=new IS(r):this.source=r,t?this.decompress=t:this.decompress=wf,e?this.cache=e:this.cache=new FS}getHeader(){return et(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,t,i){return et(this,null,function*(){const n=bS(r,e,t),s=yield this.cache.getHeader(this.source);if(s.specVersion<3)return Ef.getZxy(s,this.source,this.cache,r,e,t,i);if(r<s.minZoom||r>s.maxZoom)return;let a=s.rootDirectoryOffset,o=s.rootDirectoryLength;for(let l=0;l<=3;l++){const h=yield this.cache.getDirectory(this.source,a,o,s),c=AS(h,n);if(c)if(c.runLength>0){const u=yield this.source.getBytes(s.tileDataOffset+c.offset,c.length,i);if(s.etag&&s.etag!==u.etag)throw new Qr(u.etag);return{data:yield this.decompress(u.data,s.tileCompression),cacheControl:u.cacheControl,expires:u.expires}}else a=s.leafDirectoryOffset+c.offset,o=c.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,t,i){return et(this,null,function*(){try{return yield this.getZxyAttempt(r,e,t,i)}catch(n){if(n instanceof Qr)return this.cache.invalidate(this.source,n.message),yield this.getZxyAttempt(r,e,t,i);throw n}})}getMetadataAttempt(){return et(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength);if(r.etag&&r.etag!==e.etag)throw new Qr(e.etag);const t=yield this.decompress(e.data,r.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(t))})}getMetadata(){return et(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof Qr)return this.cache.invalidate(this.source,r.message),yield this.getMetadataAttempt();throw r}})}};class DS extends du{constructor(e){super(ct.ERROR),this.error=e}}class GS extends Yc{constructor(e){super(e),e.projection&&(this.projection=e.projection)}}class Ae{constructor(e){this.name=e}toString(){return this.name}}Ae.GeoTIFF=new Ae("GeoTIFF");Ae.ImageStatic=new Ae("ImageStatic");Ae.PMTilesRaster=new Ae("PMTilesRaster");Ae.PMTilesVector=new Ae("PMTilesVector");Ae.TileJSON=new Ae("TileJSON");Ae.TileWMS=new Ae("TileWMS");Ae.WMTS=new Ae("WMTS");Ae.XYZ=new Ae("XYZ");var Tf={exports:{}};(function(r,e){(function(t,i){r.exports=i()})(br,function(){var t=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function i(u,d){return u.indexOf(d)===-1?u.length:u.indexOf(d)}function n(u){var d=u.replace(/^v/,"").replace(/\+.*$/,""),m=i(d,"-"),g=d.substring(0,m).split(".");return g.push(d.substring(m+1)),g}function s(u){return isNaN(Number(u))?u:Number(u)}function a(u){if(typeof u!="string")throw new TypeError("Invalid argument expected string");if(!t.test(u))throw new Error("Invalid argument not valid semver ('"+u+"' received)")}function o(u,d){[u,d].forEach(a);for(var m=n(u),g=n(d),y=0;y<Math.max(m.length-1,g.length-1);y++){var _=parseInt(m[y]||0,10),v=parseInt(g[y]||0,10);if(_>v)return 1;if(v>_)return-1}var E=m[m.length-1],S=g[g.length-1];if(E&&S){var w=E.split(".").map(s),P=S.split(".").map(s);for(y=0;y<Math.max(w.length,P.length);y++){if(w[y]===void 0||typeof P[y]=="string"&&typeof w[y]=="number")return-1;if(P[y]===void 0||typeof w[y]=="string"&&typeof P[y]=="number"||w[y]>P[y])return 1;if(P[y]>w[y])return-1}}else if(E||S)return E?-1:1;return 0}var l=[">",">=","=","<","<="],h={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function c(u){if(typeof u!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof u);if(l.indexOf(u)===-1)throw new TypeError("Invalid operator, expected one of "+l.join("|"))}return o.validate=function(u){return typeof u=="string"&&t.test(u)},o.compare=function(u,d,m){c(m);var g=o(u,d);return h[m].indexOf(g)>-1},o})})(Tf);var US=Tf.exports,La=US;const Vo="1.0.0",$=!0,J={classification:"https://stac-extensions.github.io/classification/v1.1.0/schema.json",datacube:"https://stac-extensions.github.io/datacube/v2.1.0/schema.json",eo:"https://stac-extensions.github.io/eo/v1.0.0/schema.json",file:"https://stac-extensions.github.io/file/v1.0.0/schema.json","item-assets":"https://stac-extensions.github.io/item-assets/v1.0.0/schema.json",label:"https://stac-extensions.github.io/label/v1.0.1/schema.json",pointcloud:"https://stac-extensions.github.io/pointcloud/v1.0.0/schema.json",processing:"https://stac-extensions.github.io/processing/v1.1.0/schema.json",projection:"https://stac-extensions.github.io/projection/v1.0.0/schema.json",raster:"https://stac-extensions.github.io/raster/v1.1.0/schema.json",sar:"https://stac-extensions.github.io/sar/v1.0.0/schema.json",sat:"https://stac-extensions.github.io/sat/v1.0.0/schema.json",scientific:"https://stac-extensions.github.io/scientific/v1.0.0/schema.json",table:"https://stac-extensions.github.io/table/v1.2.0/schema.json",timestamps:"https://stac-extensions.github.io/timestamps/v1.0.0/schema.json",version:"https://stac-extensions.github.io/version/v1.0.0/schema.json",view:"https://stac-extensions.github.io/view/v1.0.0/schema.json"},Ir={itemAndCollection:{"cube:":J.datacube,"eo:":J.eo,"file:":J.file,"label:":J.label,"pc:":J.pointcloud,"processing:":J.processing,"proj:":J.projection,"raster:":J.raster,"sar:":J.sar,"sat:":J.sat,"sci:":J.scientific,"view:":J.view,version:J.version,deprecated:J.version,published:J.timestamps,expires:J.timestamps,unpublished:J.timestamps},catalog:{},collection:{item_assets:J["item-assets"]},item:{}};Ir.collection=Object.assign(Ir.collection,Ir.itemAndCollection);Ir.item=Object.assign(Ir.item,Ir.itemAndCollection);var Di={parseUrl(r){let e=r.match(/^https?:\/\/stac-extensions.github.io\/([^\/]+)\/v([^\/]+)\/[^.]+.json$/i);if(e)return{id:e[1],version:e[2]}}},_e={version:Vo,extensions:{},set(r){if(typeof r.stac_version!="string"?_e.version="0.6.0":_e.version=r.stac_version,Array.isArray(r.stac_extensions))for(let e of r.stac_extensions){let t=Di.parseUrl(e);t&&(_e.extensions[t.id]=t.version)}},before(r,e=null){let t=e?_e.extensions[e]:_e.version;return typeof t>"u"?!1:La.compare(t,r,"<")}},b={type(r){let e=typeof r;if(e==="object"){if(r===null)return"null";if(Array.isArray(r))return"array"}return e},is(r,e){return b.type(r)===e},isDefined(r){return typeof r<"u"},isObject(r){return typeof r=="object"&&r===Object(r)&&!Array.isArray(r)},rename(r,e,t){return typeof r[e]<"u"&&typeof r[t]>"u"?(r[t]=r[e],delete r[e],!0):!1},forAll(r,e,t){if(r[e]&&typeof r[e]=="object")for(let i in r[e])t(r[e][i])},toArray(r,e){return typeof r[e]<"u"&&!Array.isArray(r[e])?(r[e]=[r[e]],!0):!1},flattenArray(r,e,t,i=!1){if(Array.isArray(r[e])){for(let n in r[e])if(typeof t[n]=="string"){let s=r[e][n];r[t[n]]=i?[s]:s}return delete r[e],!0}return!1},flattenOneElementArray(r,e,t=!1){return!t&&Array.isArray(r[e])?r[e].length===1?(r[e]=r[e][0],!0):!1:!0},removeFromArray(r,e,t){if(Array.isArray(r[e])){let i=r[e].indexOf(t);return i>-1&&r[e].splice(i,1),!0}return!1},ensure(r,e,t){return b.type(t)!==b.type(r[e])&&(r[e]=t),!0},upgradeExtension(r,e){let{id:t,version:i}=Di.parseUrl(e),n=r.stac_extensions.findIndex(s=>{let a=Di.parseUrl(s);return a&&a.id===t&&La.compare(a.version,i,"<")});return n!==-1?(r.stac_extensions[n]=e,!0):!1},addExtension(r,e){let{id:t,version:i}=Di.parseUrl(e),n=r.stac_extensions.findIndex(s=>{if(s===e)return!0;let a=Di.parseUrl(s);return!!(a&&a.id===t&&La.compare(a.version,i,"<"))});return n===-1?r.stac_extensions.push(e):r.stac_extensions[n]=e,r.stac_extensions.sort(),!0},removeExtension(r,e){return b.removeFromArray(r,"stac_extensions",e)},migrateExtensionShortnames(r){let e=Object.keys(J),t=Object.values(J);return b.mapValues(r,"stac_extensions",e,t)},populateExtensions(r,e){let t=[];(e=="catalog"||e=="collection")&&t.push(r),(e=="item"||e=="collection")&&b.isObject(r.assets)&&(t=t.concat(Object.values(r.assets))),e=="collection"&&b.isObject(r.item_assets)&&(t=t.concat(Object.values(r.item_assets))),e=="collection"&&b.isObject(r.summaries)&&t.push(r.summaries),e=="item"&&b.isObject(r.properties)&&t.push(r.properties);for(let i of t)Object.keys(i).forEach(n=>{let s=n.match(/^(\w+:|[^:]+$)/i);if(Array.isArray(s)){let a=Ir[e][s[0]];b.is(a,"string")&&b.addExtension(r,a)}})},mapValues(r,e,t,i){let n=s=>{let a=t.indexOf(s);return a>=0?i[a]:s};return Array.isArray(r[e])?r[e]=r[e].map(n):typeof r[e]<"u"&&(r[e]=n(r[e])),!0},mapObject(r,e){for(let t in r)r[t]=e(r[t],t)},moveTo(r,e,t,i=!1,n=!1){let s;return i?n?s=a=>Array.isArray(a):s=a=>Array.isArray(a)&&a.length===1:s=b.isDefined,s(r[e])?(t[e]=i&&!n?r[e][0]:r[e],delete r[e],!0):!1},runAll(r,e,t,i){for(let n in r)n.startsWith("migrate")||r[n](e,t,i)},toUTC(r,e){if(typeof r[e]=="string")try{return r[e]=this.toISOString(r[e]),!0}catch{}return delete r[e],!1},toISOString(r){return r instanceof Date||(r=new Date(r)),r.toISOString().replace(".000","")}},Zt={multihash:null,hexToUint8(r){if(r.length===0||r.length%2!==0)throw new Error(`The string "${r}" is not valid hex.`);return new Uint8Array(r.match(/.{1,2}/g).map(e=>parseInt(e,16)))},uint8ToHex(r){return r.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),"")},toMultihash(r,e,t){if(!Zt.multihash||!b.is(r[e],"string"))return!1;try{const i=Zt.multihash.encode(Zt.hexToUint8(r[e]),t);return r[e]=Zt.uint8ToHex(i),!0}catch(i){return console.warn(i),!1}}},Yo={migrate(r,e=!0){return _e.set(r),e&&(r.stac_version=Vo),r.type="Catalog",b.ensure(r,"stac_extensions",[]),_e.before("1.0.0-rc.1")&&b.migrateExtensionShortnames(r),b.ensure(r,"id",""),b.ensure(r,"description",""),b.ensure(r,"links",[]),b.runAll(Yo,r,r),_e.before("0.8.0")&&b.populateExtensions(r,"catalog"),r}},Ko={migrate(r,e=!0){return Yo.migrate(r,e),r.type="Collection",_e.before("1.0.0-rc.1")&&b.migrateExtensionShortnames(r),b.ensure(r,"license","proprietary"),b.ensure(r,"extent",{spatial:{bbox:[]},temporal:{interval:[]}}),b.runAll(Ko,r,r),b.isObject(r.properties)&&(b.removeFromArray(r,"stac_extensions","commons"),delete r.properties),_e.before("0.8.0")&&b.populateExtensions(r,"collection"),_e.before("1.0.0-beta.1")&&b.mapValues(r,"stac_extensions",["assets"],["item-assets"]),r},extent(r){if(b.ensure(r,"extent",{}),_e.before("0.8.0")&&(Array.isArray(r.extent.spatial)&&(r.extent.spatial={bbox:[r.extent.spatial]}),Array.isArray(r.extent.temporal)&&(r.extent.temporal={interval:[r.extent.temporal]})),b.ensure(r.extent,"spatial",{}),b.ensure(r.extent.spatial,"bbox",[]),b.ensure(r.extent,"temporal",{}),b.ensure(r.extent.temporal,"interval",[]),_e.before("1.0.0-rc.3")){if(r.extent.temporal.interval.length>1){let e,t;for(let i of r.extent.temporal.interval){if(i[0]===null)e=null;else if(typeof i[0]=="string"&&e!==null)try{let n=new Date(i[0]);(typeof e>"u"||n<e)&&(e=n)}catch{}if(i[1]===null)t=null;else if(typeof i[1]=="string"&&t!==null)try{let n=new Date(i[1]);(typeof t>"u"||n>t)&&(t=n)}catch{}}r.extent.temporal.interval.unshift([e?b.toISOString(e):null,t?b.toISOString(t):null])}if(r.extent.spatial.bbox.length>1){let e=r.extent.spatial.bbox.reduce((t,i)=>Array.isArray(i)?Math.max(i.length,t):t,4);if(e>=4){let t=new Array(e).fill(null),i=e/2;for(let n of r.extent.spatial.bbox){if(!Array.isArray(n)||n.length<4)break;for(let s in n){let a=n[s];t[s]===null?t[s]=a:s<i?t[s]=Math.min(a,t[s]):t[s]=Math.max(a,t[s])}}t.findIndex(n=>n===null)===-1&&r.extent.spatial.bbox.unshift(t)}}}},collectionAssets(r){_e.before("1.0.0-rc.1")&&b.removeExtension(r,"collection-assets"),en.migrateAll(r)},itemAsset(r){_e.before("1.0.0-beta.2")&&b.rename(r,"item_assets","assets"),en.migrateAll(r,"item_assets")},summaries(r){if(b.ensure(r,"summaries",{}),_e.before("0.8.0")&&b.isObject(r.other_properties)){for(let e in r.other_properties){let t=r.other_properties[e];Array.isArray(t.extent)&&t.extent.length===2?r.summaries[e]={minimum:t.extent[0],maximum:t.extent[1]}:Array.isArray(t.values)&&(t.values.filter(i=>Array.isArray(i)).length===t.values.length?r.summaries[e]=t.values.reduce((i,n)=>i.concat(n),[]):r.summaries[e]=t.values)}delete r.other_properties}if(_e.before("1.0.0-beta.1")&&b.isObject(r.properties)&&!r.links.find(e=>["child","item"].includes(e.rel)))for(let e in r.properties){let t=r.properties[e];Array.isArray(t)||(t=[t]),r.summaries[e]=t}_e.before("1.0.0-rc.1")&&b.mapObject(r.summaries,e=>(b.rename(e,"min","minimum"),b.rename(e,"max","maximum"),e)),Rs.migrate(r.summaries,r,!0),b.moveTo(r.summaries,"sci:doi",r,!0)&&b.addExtension(r,J.scientific),b.moveTo(r.summaries,"sci:publications",r,!0,!0)&&b.addExtension(r,J.scientific),b.moveTo(r.summaries,"sci:citation",r,!0)&&b.addExtension(r,J.scientific),b.moveTo(r.summaries,"cube:dimensions",r,!0)&&b.addExtension(r,J.datacube),Object.keys(r.summaries).length===0&&delete r.summaries}},Qo={migrate(r,e=null,t=!0){_e.set(r),t&&(r.stac_version=Vo),b.ensure(r,"stac_extensions",[]),_e.before("1.0.0-rc.1")&&b.migrateExtensionShortnames(r),b.ensure(r,"id",""),b.ensure(r,"type","Feature"),b.isObject(r.geometry)||(r.geometry=null),r.geometry!==null&&b.ensure(r,"bbox",[]),b.ensure(r,"properties",{}),b.ensure(r,"links",[]),b.ensure(r,"assets",{});let i=!1;return b.isObject(e)&&b.isObject(e.properties)&&(b.removeFromArray(r,"stac_extensions","commons"),r.properties=Object.assign({},e.properties,r.properties),i=!0),b.runAll(Qo,r,r),Rs.migrate(r.properties,r),en.migrateAll(r),(_e.before("0.8.0")||i)&&b.populateExtensions(r,"item"),r}},Mf={migrate(r,e=!0){return b.ensure(r,"collections",[]),b.ensure(r,"links",[]),b.runAll(Mf,r,r),r.collections=r.collections.map(t=>Ko.migrate(t,e)),r}},Rf={migrate(r,e=!0){return b.ensure(r,"type","FeatureCollection"),b.ensure(r,"features",[]),b.ensure(r,"links",[]),b.runAll(Rf,r,r),r.features=r.features.map(t=>Qo.migrate(t,null,e)),r}},en={migrateAll(r,e="assets"){for(let t in r[e])en.migrate(r[e][t],r)},migrate(r,e){return b.runAll(en,r,e),Rs.migrate(r,e),r},mediaTypes(r){b.is(r.type,"string")&&b.mapValues(r,"type",["image/vnd.stac.geotiff","image/vnd.stac.geotiff; cloud-optimized=true"],["image/tiff; application=geotiff","image/tiff; application=geotiff; profile=cloud-optimized"])},eo(r,e){let t=b.isObject(e.properties)&&Array.isArray(e.properties["eo:bands"])?e.properties["eo:bands"]:[];if(Array.isArray(r["eo:bands"]))for(let i in r["eo:bands"]){let n=r["eo:bands"][i];b.is(n,"number")&&b.isObject(t[n])?n=t[n]:b.isObject(n)||(n={}),r["eo:bands"][i]=n}}},Rs={migrate(r,e,t=!1){return b.runAll(Rs,r,e,t),r},_commonMetadata(r){_e.before("1.0.0-rc.3")&&(b.toUTC(r,"created"),b.toUTC(r,"updated"))},_timestamps(r,e){b.toUTC(r,"published"),b.toUTC(r,"expires"),b.toUTC(r,"unpublished"),b.upgradeExtension(e,J.timestamps)},_versioningIndicator(r,e){b.upgradeExtension(e,J.version)},checksum(r,e){_e.before("0.9.0")&&Zt.multihash&&(b.rename(r,"checksum:md5","checksum:multihash")&&Zt.toMultihash(r,"checksum:multihash","md5"),b.rename(r,"checksum:sha1","checksum:multihash")&&Zt.toMultihash(r,"checksum:multihash","sha1"),b.rename(r,"checksum:sha2","checksum:multihash")&&Zt.toMultihash(r,"checksum:multihash","sha2-256"),b.rename(r,"checksum:sha3","checksum:multihash")&&Zt.toMultihash(r,"checksum:multihash","sha3-256")),_e.before("1.0.0-rc.1")&&b.rename(r,"checksum:multihash","file:checksum")&&b.addExtension(e,J.file),b.removeExtension(e,"checksum")},classification(r,e){_e.before("1.1.0","classification")&&b.forAll(r,"classification:classes",t=>b.rename(t,"color-hint","color_hint")),b.upgradeExtension(e,J.classification)},cube(r,e){b.upgradeExtension(e,J.datacube)},dtr(r,e){_e.before("0.9.0")&&(b.rename(r,"dtr:start_datetime","start_datetime"),b.rename(r,"dtr:end_datetime","end_datetime"),b.removeExtension(e,"datetime-range"))},eo(r,e){_e.before("0.9.0")&&(b.rename(r,"eo:epsg","proj:epsg")&&b.addExtension(e,J.projection),b.rename(r,"eo:platform","platform"),b.rename(r,"eo:instrument","instruments")&&b.toArray(r,"instruments"),b.rename(r,"eo:constellation","constellation"),b.rename(r,"eo:off_nadir","view:off_nadir")&&b.addExtension(e,J.view),b.rename(r,"eo:azimuth","view:azimuth")&&b.addExtension(e,J.view),b.rename(r,"eo:incidence_angle","view:incidence_angle")&&b.addExtension(e,J.view),b.rename(r,"eo:sun_azimuth","view:sun_azimuth")&&b.addExtension(e,J.view),b.rename(r,"eo:sun_elevation","view:sun_elevation")&&b.addExtension(e,J.view)),_e.before("1.0.0-beta.1")&&b.rename(r,"eo:gsd","gsd"),b.upgradeExtension(e,J.eo)},file(r,e){b.upgradeExtension(e,J.file)},label(r,e){_e.before("0.8.0")&&(b.rename(r,"label:property","label:properties"),b.rename(r,"label:task","label:tasks"),b.rename(r,"label:overview","label:overviews")&&b.toArray(r,"label:overviews"),b.rename(r,"label:method","label:methods"),b.toArray(r,"label:classes")),b.upgradeExtension(e,J.label)},pc(r,e){_e.before("0.8.0")&&b.rename(r,"pc:schema","pc:schemas"),b.upgradeExtension(e,J.pointcloud)},processing(r,e){b.upgradeExtension(e,J.processing)},proj(r,e){b.upgradeExtension(e,J.projection)},raster(r,e){b.upgradeExtension(e,J.raster)},sar(r,e,t){b.rename(r,"sar:incidence_angle","view:incidence_angle")&&b.addExtension(e,J.view),b.rename(r,"sar:pass_direction","sat:orbit_state")&&b.mapValues(r,"sat:orbit_state",[null],["geostationary"])&&b.addExtension(e,J.sat),_e.before("0.7.0")&&(b.flattenArray(r,"sar:resolution",["sar:resolution_range","sar:resolution_azimuth"],t),b.flattenArray(r,"sar:pixel_spacing",["sar:pixel_spacing_range","sar:pixel_spacing_azimuth"],t),b.flattenArray(r,"sar:looks",["sar:looks_range","sar:looks_azimuth","sar:looks_equivalent_number"],t),b.rename(r,"sar:off_nadir","view:off_nadir")&&b.addExtension(e,J.view)),_e.before("0.9.0")&&(b.rename(r,"sar:platform","platform"),b.rename(r,"sar:instrument","instruments")&&b.toArray(r,"instruments"),b.rename(r,"sar:constellation","constellation"),b.rename(r,"sar:type","sar:product_type"),b.rename(r,"sar:polarization","sar:polarizations"),b.flattenOneElementArray(r,"sar:absolute_orbit",t)&&b.rename(r,"sar:absolute_orbit","sat:absolute_orbit")&&b.addExtension(e,J.sat),b.flattenOneElementArray(r,"sar:relative_orbit",t)&&b.rename(r,"sar:relative_orbit","sat:relative_orbit")&&b.addExtension(e,J.sat)),b.upgradeExtension(e,J.sar)},sat(r,e){_e.before("0.9.0")&&(b.rename(r,"sat:off_nadir_angle","sat:off_nadir"),b.rename(r,"sat:azimuth_angle","sat:azimuth"),b.rename(r,"sat:sun_azimuth_angle","sat:sun_azimuth"),b.rename(r,"sat:sun_elevation_angle","sat:sun_elevation")),b.upgradeExtension(e,J.sat)},sci(r,e){b.upgradeExtension(e,J.scientific)},item(r){_e.before("0.8.0")&&(b.rename(r,"item:license","license"),b.rename(r,"item:providers","providers"))},table(r,e){b.upgradeExtension(e,J.table)},view(r,e){b.upgradeExtension(e,J.view)}},Hr={item(r,e=null,t=!0){return Qo.migrate(r,e,t)},catalog(r,e=!0){return Yo.migrate(r,e)},collection(r,e=!0){return Ko.migrate(r,e)},collectionCollection(r,e=!0){return Mf.migrate(r,e)},itemCollection(r,e=!0){return Rf.migrate(r,e)},stac(r,e=!0){return r.type==="Feature"?Hr.item(r,null,e):r.type==="FeatureCollection"?Hr.itemCollection(r,e):r.type==="Collection"||!r.type&&b.isDefined(r.extent)&&b.isDefined(r.license)?Hr.collection(r,e):!r.type&&Array.isArray(r.collections)?Hr.collectionCollection(r,e):Hr.catalog(r,e)},enableMultihash(r){Zt.multihash=r}},BS=Hr;const zS=ds(BS);function ut(r){return typeof r=="string"&&r.length>0}function lt(r){return typeof r=="object"&&r===Object(r)&&!Array.isArray(r)}function bf(...r){if(r=r.filter(e=>Array.isArray(e)),r.length>1){let e=Math.max(...r.map(i=>i.length)),t=[];for(let i=0;i<e;i++)t.push(Object.assign({},...r.map(n=>n[i])));return t}else if(r.length===1)return r[0];return[]}function kS(r){switch(r){case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648}return r.startsWith("u")?0:null}function $S(r){switch(r){case"int8":return 127;case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295}return null}class bs{constructor(e,t={},i=[]){if(!lt(e))throw new Error("Given data is not an object");if(e instanceof bs){for(let n of i)this[n]=e[n];e=e.toJSON()}this._keyMap=t,this._privateKeys=["_keyMap","_privateKeys"].concat(i);for(let n in e)typeof this[n]>"u"&&(n in t?this[n]=t[n](e[n],this):this[n]=e[n])}isItem(){return this.type==="Feature"}isCatalog(){return this.type==="Catalog"}isCatalogLike(){return this.isCatalog()||this.isCollection()}isCollection(){return this.type==="Collection"}isItemCollection(){return this.type==="FeatureCollection"}isCollectionCollection(){return!1}isAsset(){return!1}isLink(){return!1}getObjectType(){}getAbsoluteUrl(){return null}getMetadata(e){return this[e]}toGeoJSON(){return null}getBoundingBox(){return null}getBoundingBoxes(){return[]}toJSON(){let e={};return Object.keys(this).forEach(t=>{if(typeof this[t]=="function"||this._privateKeys.includes(t))return;let i=this[t];if(t in this._keyMap){let n=Array.isArray(i)?[]:{};for(let s in i)n[s]=i[s].toJSON();i=n}e[t]=i}),e}}var Pf={exports:{}},Gi={exports:{}};/*! https://mths.be/punycode v1.4.0 by @mathias */Gi.exports;var xh;function jS(){return xh||(xh=1,function(r,e){(function(t){var i=e&&!e.nodeType&&e,n=r&&!r.nodeType&&r,s=typeof br=="object"&&br;(s.global===s||s.window===s||s.self===s)&&(t=s);var a,o=2147483647,l=36,h=1,c=26,u=38,d=700,m=72,g=128,y="-",_=/^xn--/,v=/[^\x20-\x7E]/,E=/[\x2E\u3002\uFF0E\uFF61]/g,S={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=l-h,P=Math.floor,A=String.fromCharCode,I;function C(G){throw new RangeError(S[G])}function k(G,j){for(var K=G.length,ge=[];K--;)ge[K]=j(G[K]);return ge}function B(G,j){var K=G.split("@"),ge="";K.length>1&&(ge=K[0]+"@",G=K[1]),G=G.replace(E,".");var fe=G.split("."),ye=k(fe,j).join(".");return ge+ye}function H(G){for(var j=[],K=0,ge=G.length,fe,ye;K<ge;)fe=G.charCodeAt(K++),fe>=55296&&fe<=56319&&K<ge?(ye=G.charCodeAt(K++),(ye&64512)==56320?j.push(((fe&1023)<<10)+(ye&1023)+65536):(j.push(fe),K--)):j.push(fe);return j}function Y(G){return k(G,function(j){var K="";return j>65535&&(j-=65536,K+=A(j>>>10&1023|55296),j=56320|j&1023),K+=A(j),K}).join("")}function f(G){return G-48<10?G-22:G-65<26?G-65:G-97<26?G-97:l}function p(G,j){return G+22+75*(G<26)-((j!=0)<<5)}function x(G,j,K){var ge=0;for(G=K?P(G/d):G>>1,G+=P(G/j);G>w*c>>1;ge+=l)G=P(G/w);return P(ge+(w+1)*G/(G+u))}function R(G){var j=[],K=G.length,ge,fe=0,ye=g,me=m,be,qe,De,He,je,Qe,Pt,ur,Sr;for(be=G.lastIndexOf(y),be<0&&(be=0),qe=0;qe<be;++qe)G.charCodeAt(qe)>=128&&C("not-basic"),j.push(G.charCodeAt(qe));for(De=be>0?be+1:0;De<K;){for(He=fe,je=1,Qe=l;De>=K&&C("invalid-input"),Pt=f(G.charCodeAt(De++)),(Pt>=l||Pt>P((o-fe)/je))&&C("overflow"),fe+=Pt*je,ur=Qe<=me?h:Qe>=me+c?c:Qe-me,!(Pt<ur);Qe+=l)Sr=l-ur,je>P(o/Sr)&&C("overflow"),je*=Sr;ge=j.length+1,me=x(fe-He,ge,He==0),P(fe/ge)>o-ye&&C("overflow"),ye+=P(fe/ge),fe%=ge,j.splice(fe++,0,ye)}return Y(j)}function L(G){var j,K,ge,fe,ye,me,be,qe,De,He,je,Qe=[],Pt,ur,Sr,Is;for(G=H(G),Pt=G.length,j=g,K=0,ye=m,me=0;me<Pt;++me)je=G[me],je<128&&Qe.push(A(je));for(ge=fe=Qe.length,fe&&Qe.push(y);ge<Pt;){for(be=o,me=0;me<Pt;++me)je=G[me],je>=j&&je<be&&(be=je);for(ur=ge+1,be-j>P((o-K)/ur)&&C("overflow"),K+=(be-j)*ur,j=be,me=0;me<Pt;++me)if(je=G[me],je<j&&++K>o&&C("overflow"),je==j){for(qe=K,De=l;He=De<=ye?h:De>=ye+c?c:De-ye,!(qe<He);De+=l)Is=qe-He,Sr=l-He,Qe.push(A(p(He+Is%Sr,0))),qe=P(Is/Sr);Qe.push(A(p(qe,0))),ye=x(K,ur,ge==fe),K=0,++ge}++K,++j}return Qe.join("")}function O(G){return B(G,function(j){return _.test(j)?R(j.slice(4).toLowerCase()):j})}function F(G){return B(G,function(j){return v.test(j)?"xn--"+L(j):j})}if(a={version:"1.3.2",ucs2:{decode:H,encode:Y},decode:R,encode:L,toASCII:F,toUnicode:O},i&&n)if(r.exports==i)n.exports=a;else for(I in a)a.hasOwnProperty(I)&&(i[I]=a[I]);else t.punycode=a})(br)}(Gi,Gi.exports)),Gi.exports}var ea={exports:{}};/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var vh;function ZS(){return vh||(vh=1,function(r){(function(e,t){r.exports?r.exports=t():e.IPv6=t(e)})(br,function(e){var t=e&&e.IPv6;function i(s){var a=s.toLowerCase(),o=a.split(":"),l=o.length,h=8;o[0]===""&&o[1]===""&&o[2]===""?(o.shift(),o.shift()):o[0]===""&&o[1]===""?o.shift():o[l-1]===""&&o[l-2]===""&&o.pop(),l=o.length,o[l-1].indexOf(".")!==-1&&(h=7);var c;for(c=0;c<l&&o[c]!=="";c++);if(c<h)for(o.splice(c,1,"0000");o.length<h;)o.splice(c,0,"0000");for(var u,d=0;d<h;d++){u=o[d].split("");for(var m=0;m<3&&(u[0]==="0"&&u.length>1);m++)u.splice(0,1);o[d]=u.join("")}var g=-1,y=0,_=0,v=-1,E=!1;for(d=0;d<h;d++)E?o[d]==="0"?_+=1:(E=!1,_>y&&(g=v,y=_)):o[d]==="0"&&(E=!0,v=d,_=1);_>y&&(g=v,y=_),y>1&&o.splice(g,y,""),l=o.length;var S="";for(o[0]===""&&(S=":"),d=0;d<l&&(S+=o[d],d!==l-1);d++)S+=":";return o[l-1]===""&&(S+=":"),S}function n(){return e.IPv6===this&&(e.IPv6=t),this}return{best:i,noConflict:n}})}(ea)),ea.exports}var ta={exports:{}};/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var Eh;function qS(){return Eh||(Eh=1,function(r){(function(e,t){r.exports?r.exports=t():e.SecondLevelDomains=t(e)})(br,function(e){var t=e&&e.SecondLevelDomains,i={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(n){var s=n.lastIndexOf(".");if(s<=0||s>=n.length-1)return!1;var a=n.lastIndexOf(".",s-1);if(a<=0||a>=s-1)return!1;var o=i.list[n.slice(s+1)];return o?o.indexOf(" "+n.slice(a+1,s)+" ")>=0:!1},is:function(n){var s=n.lastIndexOf(".");if(s<=0||s>=n.length-1)return!1;var a=n.lastIndexOf(".",s-1);if(a>=0)return!1;var o=i.list[n.slice(s+1)];return o?o.indexOf(" "+n.slice(0,s)+" ")>=0:!1},get:function(n){var s=n.lastIndexOf(".");if(s<=0||s>=n.length-1)return null;var a=n.lastIndexOf(".",s-1);if(a<=0||a>=s-1)return null;var o=i.list[n.slice(s+1)];return!o||o.indexOf(" "+n.slice(a+1,s)+" ")<0?null:n.slice(a+1)},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=t),this}};return i})}(ta)),ta.exports}/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(r){(function(e,t){r.exports?r.exports=t(jS(),ZS(),qS()):e.URI=t(e.punycode,e.IPv6,e.SecondLevelDomains,e)})(br,function(e,t,i,n){var s=n&&n.URI;function a(f,p){var x=arguments.length>=1,R=arguments.length>=2;if(!(this instanceof a))return x?R?new a(f,p):new a(f):new a;if(f===void 0){if(x)throw new TypeError("undefined is not a valid argument for URI");typeof location<"u"?f=location.href+"":f=""}if(f===null&&x)throw new TypeError("null is not a valid argument for URI");return this.href(f),p!==void 0?this.absoluteTo(p):this}function o(f){return/^[0-9]+$/.test(f)}a.version="1.19.11";var l=a.prototype,h=Object.prototype.hasOwnProperty;function c(f){return f.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function u(f){return f===void 0?"Undefined":String(Object.prototype.toString.call(f)).slice(8,-1)}function d(f){return u(f)==="Array"}function m(f,p){var x={},R,L;if(u(p)==="RegExp")x=null;else if(d(p))for(R=0,L=p.length;R<L;R++)x[p[R]]=!0;else x[p]=!0;for(R=0,L=f.length;R<L;R++){var O=x&&x[f[R]]!==void 0||!x&&p.test(f[R]);O&&(f.splice(R,1),L--,R--)}return f}function g(f,p){var x,R;if(d(p)){for(x=0,R=p.length;x<R;x++)if(!g(f,p[x]))return!1;return!0}var L=u(p);for(x=0,R=f.length;x<R;x++)if(L==="RegExp"){if(typeof f[x]=="string"&&f[x].match(p))return!0}else if(f[x]===p)return!0;return!1}function y(f,p){if(!d(f)||!d(p)||f.length!==p.length)return!1;f.sort(),p.sort();for(var x=0,R=f.length;x<R;x++)if(f[x]!==p[x])return!1;return!0}function _(f){var p=/^\/+|\/+$/g;return f.replace(p,"")}a._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:a.preventInvalidHostname,duplicateQueryParameters:a.duplicateQueryParameters,escapeQuerySpace:a.escapeQuerySpace}},a.preventInvalidHostname=!1,a.duplicateQueryParameters=!1,a.escapeQuerySpace=!0,a.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,a.idn_expression=/[^a-z0-9\._-]/i,a.punycode_expression=/(xn--)/i,a.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,a.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,a.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig,a.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},a.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,a.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,a.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},a.hostProtocols=["http","https"],a.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,a.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},a.getDomAttribute=function(f){if(!(!f||!f.nodeName)){var p=f.nodeName.toLowerCase();if(!(p==="input"&&f.type!=="image"))return a.domAttributes[p]}};function v(f){return escape(f)}function E(f){return encodeURIComponent(f).replace(/[!'()*]/g,v).replace(/\*/g,"%2A")}a.encode=E,a.decode=decodeURIComponent,a.iso8859=function(){a.encode=escape,a.decode=unescape},a.unicode=function(){a.encode=E,a.decode=decodeURIComponent},a.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},a.encodeQuery=function(f,p){var x=a.encode(f+"");return p===void 0&&(p=a.escapeQuerySpace),p?x.replace(/%20/g,"+"):x},a.decodeQuery=function(f,p){f+="",p===void 0&&(p=a.escapeQuerySpace);try{return a.decode(p?f.replace(/\+/g,"%20"):f)}catch{return f}};var S={encode:"encode",decode:"decode"},w,P=function(f,p){return function(x){try{return a[p](x+"").replace(a.characters[f][p].expression,function(R){return a.characters[f][p].map[R]})}catch{return x}}};for(w in S)a[w+"PathSegment"]=P("pathname",S[w]),a[w+"UrnPathSegment"]=P("urnpath",S[w]);var A=function(f,p,x){return function(R){var L;x?L=function(j){return a[p](a[x](j))}:L=a[p];for(var O=(R+"").split(f),F=0,G=O.length;F<G;F++)O[F]=L(O[F]);return O.join(f)}};a.decodePath=A("/","decodePathSegment"),a.decodeUrnPath=A(":","decodeUrnPathSegment"),a.recodePath=A("/","encodePathSegment","decode"),a.recodeUrnPath=A(":","encodeUrnPathSegment","decode"),a.encodeReserved=P("reserved","encode"),a.parse=function(f,p){var x;return p||(p={preventInvalidHostname:a.preventInvalidHostname}),f=f.replace(a.leading_whitespace_expression,""),f=f.replace(a.ascii_tab_whitespace,""),x=f.indexOf("#"),x>-1&&(p.fragment=f.substring(x+1)||null,f=f.substring(0,x)),x=f.indexOf("?"),x>-1&&(p.query=f.substring(x+1)||null,f=f.substring(0,x)),f=f.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://"),f=f.replace(/^[/\\]{2,}/i,"//"),f.substring(0,2)==="//"?(p.protocol=null,f=f.substring(2),f=a.parseAuthority(f,p)):(x=f.indexOf(":"),x>-1&&(p.protocol=f.substring(0,x)||null,p.protocol&&!p.protocol.match(a.protocol_expression)?p.protocol=void 0:f.substring(x+1,x+3).replace(/\\/g,"/")==="//"?(f=f.substring(x+3),f=a.parseAuthority(f,p)):(f=f.substring(x+1),p.urn=!0))),p.path=f,p},a.parseHost=function(f,p){f||(f=""),f=f.replace(/\\/g,"/");var x=f.indexOf("/"),R,L;if(x===-1&&(x=f.length),f.charAt(0)==="[")R=f.indexOf("]"),p.hostname=f.substring(1,R)||null,p.port=f.substring(R+2,x)||null,p.port==="/"&&(p.port=null);else{var O=f.indexOf(":"),F=f.indexOf("/"),G=f.indexOf(":",O+1);G!==-1&&(F===-1||G<F)?(p.hostname=f.substring(0,x)||null,p.port=null):(L=f.substring(0,x).split(":"),p.hostname=L[0]||null,p.port=L[1]||null)}return p.hostname&&f.substring(x).charAt(0)!=="/"&&(x++,f="/"+f),p.preventInvalidHostname&&a.ensureValidHostname(p.hostname,p.protocol),p.port&&a.ensureValidPort(p.port),f.substring(x)||"/"},a.parseAuthority=function(f,p){return f=a.parseUserinfo(f,p),a.parseHost(f,p)},a.parseUserinfo=function(f,p){var x=f,R=f.indexOf("\\");R!==-1&&(f=f.replace(/\\/g,"/"));var L=f.indexOf("/"),O=f.lastIndexOf("@",L>-1?L:f.length-1),F;return O>-1&&(L===-1||O<L)?(F=f.substring(0,O).split(":"),p.username=F[0]?a.decode(F[0]):null,F.shift(),p.password=F[0]?a.decode(F.join(":")):null,f=x.substring(O+1)):(p.username=null,p.password=null),f},a.parseQuery=function(f,p){if(!f)return{};if(f=f.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!f)return{};for(var x={},R=f.split("&"),L=R.length,O,F,G,j=0;j<L;j++)O=R[j].split("="),F=a.decodeQuery(O.shift(),p),G=O.length?a.decodeQuery(O.join("="),p):null,F!=="__proto__"&&(h.call(x,F)?((typeof x[F]=="string"||x[F]===null)&&(x[F]=[x[F]]),x[F].push(G)):x[F]=G);return x},a.build=function(f){var p="",x=!1;return f.protocol&&(p+=f.protocol+":"),!f.urn&&(p||f.hostname)&&(p+="//",x=!0),p+=a.buildAuthority(f)||"",typeof f.path=="string"&&(f.path.charAt(0)!=="/"&&x&&(p+="/"),p+=f.path),typeof f.query=="string"&&f.query&&(p+="?"+f.query),typeof f.fragment=="string"&&f.fragment&&(p+="#"+f.fragment),p},a.buildHost=function(f){var p="";if(f.hostname)a.ip6_expression.test(f.hostname)?p+="["+f.hostname+"]":p+=f.hostname;else return"";return f.port&&(p+=":"+f.port),p},a.buildAuthority=function(f){return a.buildUserinfo(f)+a.buildHost(f)},a.buildUserinfo=function(f){var p="";return f.username&&(p+=a.encode(f.username)),f.password&&(p+=":"+a.encode(f.password)),p&&(p+="@"),p},a.buildQuery=function(f,p,x){var R="",L,O,F,G;for(O in f)if(O!=="__proto__"&&h.call(f,O))if(d(f[O]))for(L={},F=0,G=f[O].length;F<G;F++)f[O][F]!==void 0&&L[f[O][F]+""]===void 0&&(R+="&"+a.buildQueryParameter(O,f[O][F],x),p!==!0&&(L[f[O][F]+""]=!0));else f[O]!==void 0&&(R+="&"+a.buildQueryParameter(O,f[O],x));return R.substring(1)},a.buildQueryParameter=function(f,p,x){return a.encodeQuery(f,x)+(p!==null?"="+a.encodeQuery(p,x):"")},a.addQuery=function(f,p,x){if(typeof p=="object")for(var R in p)h.call(p,R)&&a.addQuery(f,R,p[R]);else if(typeof p=="string"){if(f[p]===void 0){f[p]=x;return}else typeof f[p]=="string"&&(f[p]=[f[p]]);d(x)||(x=[x]),f[p]=(f[p]||[]).concat(x)}else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")},a.setQuery=function(f,p,x){if(typeof p=="object")for(var R in p)h.call(p,R)&&a.setQuery(f,R,p[R]);else if(typeof p=="string")f[p]=x===void 0?null:x;else throw new TypeError("URI.setQuery() accepts an object, string as the name parameter")},a.removeQuery=function(f,p,x){var R,L,O;if(d(p))for(R=0,L=p.length;R<L;R++)f[p[R]]=void 0;else if(u(p)==="RegExp")for(O in f)p.test(O)&&(f[O]=void 0);else if(typeof p=="object")for(O in p)h.call(p,O)&&a.removeQuery(f,O,p[O]);else if(typeof p=="string")x!==void 0?u(x)==="RegExp"?!d(f[p])&&x.test(f[p])?f[p]=void 0:f[p]=m(f[p],x):f[p]===String(x)&&(!d(x)||x.length===1)?f[p]=void 0:d(f[p])&&(f[p]=m(f[p],x)):f[p]=void 0;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")},a.hasQuery=function(f,p,x,R){switch(u(p)){case"String":break;case"RegExp":for(var L in f)if(h.call(f,L)&&p.test(L)&&(x===void 0||a.hasQuery(f,L,x)))return!0;return!1;case"Object":for(var O in p)if(h.call(p,O)&&!a.hasQuery(f,O,p[O]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(u(x)){case"Undefined":return p in f;case"Boolean":var F=!!(d(f[p])?f[p].length:f[p]);return x===F;case"Function":return!!x(f[p],p,f);case"Array":if(!d(f[p]))return!1;var G=R?g:y;return G(f[p],x);case"RegExp":return d(f[p])?R?g(f[p],x):!1:!!(f[p]&&f[p].match(x));case"Number":x=String(x);case"String":return d(f[p])?R?g(f[p],x):!1:f[p]===x;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},a.joinPaths=function(){for(var f=[],p=[],x=0,R=0;R<arguments.length;R++){var L=new a(arguments[R]);f.push(L);for(var O=L.segment(),F=0;F<O.length;F++)typeof O[F]=="string"&&p.push(O[F]),O[F]&&x++}if(!p.length||!x)return new a("");var G=new a("").segment(p);return(f[0].path()===""||f[0].path().slice(0,1)==="/")&&G.path("/"+G.path()),G.normalize()},a.commonPath=function(f,p){var x=Math.min(f.length,p.length),R;for(R=0;R<x;R++)if(f.charAt(R)!==p.charAt(R)){R--;break}return R<1?f.charAt(0)===p.charAt(0)&&f.charAt(0)==="/"?"/":"":((f.charAt(R)!=="/"||p.charAt(R)!=="/")&&(R=f.substring(0,R).lastIndexOf("/")),f.substring(0,R+1))},a.withinString=function(f,p,x){x||(x={});var R=x.start||a.findUri.start,L=x.end||a.findUri.end,O=x.trim||a.findUri.trim,F=x.parens||a.findUri.parens,G=/[a-z0-9-]=["']?$/i;for(R.lastIndex=0;;){var j=R.exec(f);if(!j)break;var K=j.index;if(x.ignoreHtml){var ge=f.slice(Math.max(K-3,0),K);if(ge&&G.test(ge))continue}for(var fe=K+f.slice(K).search(L),ye=f.slice(K,fe),me=-1;;){var be=F.exec(ye);if(!be)break;var qe=be.index+be[0].length;me=Math.max(me,qe)}if(me>-1?ye=ye.slice(0,me)+ye.slice(me).replace(O,""):ye=ye.replace(O,""),!(ye.length<=j[0].length)&&!(x.ignore&&x.ignore.test(ye))){fe=K+ye.length;var De=p(ye,K,fe,f);if(De===void 0){R.lastIndex=fe;continue}De=String(De),f=f.slice(0,K)+De+f.slice(fe),R.lastIndex=K+De.length}}return R.lastIndex=0,f},a.ensureValidHostname=function(f,p){var x=!!f,R=!!p,L=!1;if(R&&(L=g(a.hostProtocols,p)),L&&!x)throw new TypeError("Hostname cannot be empty, if protocol is "+p);if(f&&f.match(a.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+f+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(f).match(a.invalid_hostname_characters))throw new TypeError('Hostname "'+f+'" contains characters other than [A-Z0-9.-:_]')}},a.ensureValidPort=function(f){if(f){var p=Number(f);if(!(o(p)&&p>0&&p<65536))throw new TypeError('Port "'+f+'" is not a valid port')}},a.noConflict=function(f){if(f){var p={URI:this.noConflict()};return n.URITemplate&&typeof n.URITemplate.noConflict=="function"&&(p.URITemplate=n.URITemplate.noConflict()),n.IPv6&&typeof n.IPv6.noConflict=="function"&&(p.IPv6=n.IPv6.noConflict()),n.SecondLevelDomains&&typeof n.SecondLevelDomains.noConflict=="function"&&(p.SecondLevelDomains=n.SecondLevelDomains.noConflict()),p}else n.URI===this&&(n.URI=s);return this},l.build=function(f){return f===!0?this._deferred_build=!0:(f===void 0||this._deferred_build)&&(this._string=a.build(this._parts),this._deferred_build=!1),this},l.clone=function(){return new a(this)},l.valueOf=l.toString=function(){return this.build(!1)._string};function I(f){return function(p,x){return p===void 0?this._parts[f]||"":(this._parts[f]=p||null,this.build(!x),this)}}function C(f,p){return function(x,R){return x===void 0?this._parts[f]||"":(x!==null&&(x=x+"",x.charAt(0)===p&&(x=x.substring(1))),this._parts[f]=x,this.build(!R),this)}}l.protocol=I("protocol"),l.username=I("username"),l.password=I("password"),l.hostname=I("hostname"),l.port=I("port"),l.query=C("query","?"),l.fragment=C("fragment","#"),l.search=function(f,p){var x=this.query(f,p);return typeof x=="string"&&x.length?"?"+x:x},l.hash=function(f,p){var x=this.fragment(f,p);return typeof x=="string"&&x.length?"#"+x:x},l.pathname=function(f,p){if(f===void 0||f===!0){var x=this._parts.path||(this._parts.hostname?"/":"");return f?(this._parts.urn?a.decodeUrnPath:a.decodePath)(x):x}else return this._parts.urn?this._parts.path=f?a.recodeUrnPath(f):"":this._parts.path=f?a.recodePath(f):"/",this.build(!p),this},l.path=l.pathname,l.href=function(f,p){var x;if(f===void 0)return this.toString();this._string="",this._parts=a._parts();var R=f instanceof a,L=typeof f=="object"&&(f.hostname||f.path||f.pathname);if(f.nodeName){var O=a.getDomAttribute(f);f=f[O]||"",L=!1}if(!R&&L&&f.pathname!==void 0&&(f=f.toString()),typeof f=="string"||f instanceof String)this._parts=a.parse(String(f),this._parts);else if(R||L){var F=R?f._parts:f;for(x in F)x!=="query"&&h.call(this._parts,x)&&(this._parts[x]=F[x]);F.query&&this.query(F.query,!1)}else throw new TypeError("invalid input");return this.build(!p),this},l.is=function(f){var p=!1,x=!1,R=!1,L=!1,O=!1,F=!1,G=!1,j=!this._parts.urn;switch(this._parts.hostname&&(j=!1,x=a.ip4_expression.test(this._parts.hostname),R=a.ip6_expression.test(this._parts.hostname),p=x||R,L=!p,O=L&&i&&i.has(this._parts.hostname),F=L&&a.idn_expression.test(this._parts.hostname),G=L&&a.punycode_expression.test(this._parts.hostname)),f.toLowerCase()){case"relative":return j;case"absolute":return!j;case"domain":case"name":return L;case"sld":return O;case"ip":return p;case"ip4":case"ipv4":case"inet4":return x;case"ip6":case"ipv6":case"inet6":return R;case"idn":return F;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return G}return null};var k=l.protocol,B=l.port,H=l.hostname;l.protocol=function(f,p){if(f&&(f=f.replace(/:(\/\/)?$/,""),!f.match(a.protocol_expression)))throw new TypeError('Protocol "'+f+`" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]`);return k.call(this,f,p)},l.scheme=l.protocol,l.port=function(f,p){return this._parts.urn?f===void 0?"":this:(f!==void 0&&(f===0&&(f=null),f&&(f+="",f.charAt(0)===":"&&(f=f.substring(1)),a.ensureValidPort(f))),B.call(this,f,p))},l.hostname=function(f,p){if(this._parts.urn)return f===void 0?"":this;if(f!==void 0){var x={preventInvalidHostname:this._parts.preventInvalidHostname},R=a.parseHost(f,x);if(R!=="/")throw new TypeError('Hostname "'+f+'" contains characters other than [A-Z0-9.-]');f=x.hostname,this._parts.preventInvalidHostname&&a.ensureValidHostname(f,this._parts.protocol)}return H.call(this,f,p)},l.origin=function(f,p){if(this._parts.urn)return f===void 0?"":this;if(f===void 0){var x=this.protocol(),R=this.authority();return R?(x?x+"://":"")+this.authority():""}else{var L=a(f);return this.protocol(L.protocol()).authority(L.authority()).build(!p),this}},l.host=function(f,p){if(this._parts.urn)return f===void 0?"":this;if(f===void 0)return this._parts.hostname?a.buildHost(this._parts):"";var x=a.parseHost(f,this._parts);if(x!=="/")throw new TypeError('Hostname "'+f+'" contains characters other than [A-Z0-9.-]');return this.build(!p),this},l.authority=function(f,p){if(this._parts.urn)return f===void 0?"":this;if(f===void 0)return this._parts.hostname?a.buildAuthority(this._parts):"";var x=a.parseAuthority(f,this._parts);if(x!=="/")throw new TypeError('Hostname "'+f+'" contains characters other than [A-Z0-9.-]');return this.build(!p),this},l.userinfo=function(f,p){if(this._parts.urn)return f===void 0?"":this;if(f===void 0){var x=a.buildUserinfo(this._parts);return x&&x.substring(0,x.length-1)}else return f[f.length-1]!=="@"&&(f+="@"),a.parseUserinfo(f,this._parts),this.build(!p),this},l.resource=function(f,p){var x;return f===void 0?this.path()+this.search()+this.hash():(x=a.parse(f),this._parts.path=x.path,this._parts.query=x.query,this._parts.fragment=x.fragment,this.build(!p),this)},l.subdomain=function(f,p){if(this._parts.urn)return f===void 0?"":this;if(f===void 0){if(!this._parts.hostname||this.is("IP"))return"";var x=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,x)||""}else{var R=this._parts.hostname.length-this.domain().length,L=this._parts.hostname.substring(0,R),O=new RegExp("^"+c(L));if(f&&f.charAt(f.length-1)!=="."&&(f+="."),f.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return f&&a.ensureValidHostname(f,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(O,f),this.build(!p),this}},l.domain=function(f,p){if(this._parts.urn)return f===void 0?"":this;if(typeof f=="boolean"&&(p=f,f=void 0),f===void 0){if(!this._parts.hostname||this.is("IP"))return"";var x=this._parts.hostname.match(/\./g);if(x&&x.length<2)return this._parts.hostname;var R=this._parts.hostname.length-this.tld(p).length-1;return R=this._parts.hostname.lastIndexOf(".",R-1)+1,this._parts.hostname.substring(R)||""}else{if(!f)throw new TypeError("cannot set domain empty");if(f.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");if(a.ensureValidHostname(f,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=f;else{var L=new RegExp(c(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(L,f)}return this.build(!p),this}},l.tld=function(f,p){if(this._parts.urn)return f===void 0?"":this;if(typeof f=="boolean"&&(p=f,f=void 0),f===void 0){if(!this._parts.hostname||this.is("IP"))return"";var x=this._parts.hostname.lastIndexOf("."),R=this._parts.hostname.substring(x+1);return p!==!0&&i&&i.list[R.toLowerCase()]&&i.get(this._parts.hostname)||R}else{var L;if(f)if(f.match(/[^a-zA-Z0-9-]/))if(i&&i.is(f))L=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(L,f);else throw new TypeError('TLD "'+f+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");L=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(L,f)}else throw new TypeError("cannot set TLD empty");return this.build(!p),this}},l.directory=function(f,p){if(this._parts.urn)return f===void 0?"":this;if(f===void 0||f===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var x=this._parts.path.length-this.filename().length-1,R=this._parts.path.substring(0,x)||(this._parts.hostname?"/":"");return f?a.decodePath(R):R}else{var L=this._parts.path.length-this.filename().length,O=this._parts.path.substring(0,L),F=new RegExp("^"+c(O));return this.is("relative")||(f||(f="/"),f.charAt(0)!=="/"&&(f="/"+f)),f&&f.charAt(f.length-1)!=="/"&&(f+="/"),f=a.recodePath(f),this._parts.path=this._parts.path.replace(F,f),this.build(!p),this}},l.filename=function(f,p){if(this._parts.urn)return f===void 0?"":this;if(typeof f!="string"){if(!this._parts.path||this._parts.path==="/")return"";var x=this._parts.path.lastIndexOf("/"),R=this._parts.path.substring(x+1);return f?a.decodePathSegment(R):R}else{var L=!1;f.charAt(0)==="/"&&(f=f.substring(1)),f.match(/\.?\//)&&(L=!0);var O=new RegExp(c(this.filename())+"$");return f=a.recodePath(f),this._parts.path=this._parts.path.replace(O,f),L?this.normalizePath(p):this.build(!p),this}},l.suffix=function(f,p){if(this._parts.urn)return f===void 0?"":this;if(f===void 0||f===!0){if(!this._parts.path||this._parts.path==="/")return"";var x=this.filename(),R=x.lastIndexOf("."),L,O;return R===-1?"":(L=x.substring(R+1),O=/^[a-z0-9%]+$/i.test(L)?L:"",f?a.decodePathSegment(O):O)}else{f.charAt(0)==="."&&(f=f.substring(1));var F=this.suffix(),G;if(F)f?G=new RegExp(c(F)+"$"):G=new RegExp(c("."+F)+"$");else{if(!f)return this;this._parts.path+="."+a.recodePath(f)}return G&&(f=a.recodePath(f),this._parts.path=this._parts.path.replace(G,f)),this.build(!p),this}},l.segment=function(f,p,x){var R=this._parts.urn?":":"/",L=this.path(),O=L.substring(0,1)==="/",F=L.split(R);if(f!==void 0&&typeof f!="number"&&(x=p,p=f,f=void 0),f!==void 0&&typeof f!="number")throw new Error('Bad segment "'+f+'", must be 0-based integer');if(O&&F.shift(),f<0&&(f=Math.max(F.length+f,0)),p===void 0)return f===void 0?F:F[f];if(f===null||F[f]===void 0)if(d(p)){F=[];for(var G=0,j=p.length;G<j;G++)!p[G].length&&(!F.length||!F[F.length-1].length)||(F.length&&!F[F.length-1].length&&F.pop(),F.push(_(p[G])))}else(p||typeof p=="string")&&(p=_(p),F[F.length-1]===""?F[F.length-1]=p:F.push(p));else p?F[f]=_(p):F.splice(f,1);return O&&F.unshift(""),this.path(F.join(R),x)},l.segmentCoded=function(f,p,x){var R,L,O;if(typeof f!="number"&&(x=p,p=f,f=void 0),p===void 0){if(R=this.segment(f,p,x),!d(R))R=R!==void 0?a.decode(R):void 0;else for(L=0,O=R.length;L<O;L++)R[L]=a.decode(R[L]);return R}if(!d(p))p=typeof p=="string"||p instanceof String?a.encode(p):p;else for(L=0,O=p.length;L<O;L++)p[L]=a.encode(p[L]);return this.segment(f,p,x)};var Y=l.query;return l.query=function(f,p){if(f===!0)return a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof f=="function"){var x=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace),R=f.call(this,x);return this._parts.query=a.buildQuery(R||x,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!p),this}else return f!==void 0&&typeof f!="string"?(this._parts.query=a.buildQuery(f,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!p),this):Y.call(this,f,p)},l.setQuery=function(f,p,x){var R=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof f=="string"||f instanceof String)R[f]=p!==void 0?p:null;else if(typeof f=="object")for(var L in f)h.call(f,L)&&(R[L]=f[L]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=a.buildQuery(R,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof f!="string"&&(x=p),this.build(!x),this},l.addQuery=function(f,p,x){var R=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return a.addQuery(R,f,p===void 0?null:p),this._parts.query=a.buildQuery(R,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof f!="string"&&(x=p),this.build(!x),this},l.removeQuery=function(f,p,x){var R=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return a.removeQuery(R,f,p),this._parts.query=a.buildQuery(R,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof f!="string"&&(x=p),this.build(!x),this},l.hasQuery=function(f,p,x){var R=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return a.hasQuery(R,f,p,x)},l.setSearch=l.setQuery,l.addSearch=l.addQuery,l.removeSearch=l.removeQuery,l.hasSearch=l.hasQuery,l.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},l.normalizeProtocol=function(f){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!f)),this},l.normalizeHostname=function(f){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!f)),this},l.normalizePort=function(f){return typeof this._parts.protocol=="string"&&this._parts.port===a.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!f)),this},l.normalizePath=function(f){var p=this._parts.path;if(!p)return this;if(this._parts.urn)return this._parts.path=a.recodeUrnPath(this._parts.path),this.build(!f),this;if(this._parts.path==="/")return this;p=a.recodePath(p);var x,R="",L,O;for(p.charAt(0)!=="/"&&(x=!0,p="/"+p),(p.slice(-3)==="/.."||p.slice(-2)==="/.")&&(p+="/"),p=p.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),x&&(R=p.substring(1).match(/^(\.\.\/)+/)||"",R&&(R=R[0]));L=p.search(/\/\.\.(\/|$)/),L!==-1;){if(L===0){p=p.substring(3);continue}O=p.substring(0,L).lastIndexOf("/"),O===-1&&(O=L),p=p.substring(0,O)+p.substring(L+3)}return x&&this.is("relative")&&(p=R+p.substring(1)),this._parts.path=p,this.build(!f),this},l.normalizePathname=l.normalizePath,l.normalizeQuery=function(f){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(a.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!f)),this},l.normalizeFragment=function(f){return this._parts.fragment||(this._parts.fragment=null,this.build(!f)),this},l.normalizeSearch=l.normalizeQuery,l.normalizeHash=l.normalizeFragment,l.iso8859=function(){var f=a.encode,p=a.decode;a.encode=escape,a.decode=decodeURIComponent;try{this.normalize()}finally{a.encode=f,a.decode=p}return this},l.unicode=function(){var f=a.encode,p=a.decode;a.encode=E,a.decode=unescape;try{this.normalize()}finally{a.encode=f,a.decode=p}return this},l.readable=function(){var f=this.clone();f.username("").password("").normalize();var p="";if(f._parts.protocol&&(p+=f._parts.protocol+"://"),f._parts.hostname&&(f.is("punycode")&&e?(p+=e.toUnicode(f._parts.hostname),f._parts.port&&(p+=":"+f._parts.port)):p+=f.host()),f._parts.hostname&&f._parts.path&&f._parts.path.charAt(0)!=="/"&&(p+="/"),p+=f.path(!0),f._parts.query){for(var x="",R=0,L=f._parts.query.split("&"),O=L.length;R<O;R++){var F=(L[R]||"").split("=");x+="&"+a.decodeQuery(F[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),F[1]!==void 0&&(x+="="+a.decodeQuery(F[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}p+="?"+x.substring(1)}return p+=a.decodeQuery(f.hash(),!0),p},l.absoluteTo=function(f){var p=this.clone(),x=["protocol","username","password","hostname","port"],R,L,O;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(f instanceof a||(f=new a(f)),p._parts.protocol||(p._parts.protocol=f._parts.protocol,this._parts.hostname))return p;for(L=0;O=x[L];L++)p._parts[O]=f._parts[O];return p._parts.path?(p._parts.path.substring(-2)===".."&&(p._parts.path+="/"),p.path().charAt(0)!=="/"&&(R=f.directory(),R=R||(f.path().indexOf("/")===0?"/":""),p._parts.path=(R?R+"/":"")+p._parts.path,p.normalizePath())):(p._parts.path=f._parts.path,p._parts.query||(p._parts.query=f._parts.query)),p.build(),p},l.relativeTo=function(f){var p=this.clone().normalize(),x,R,L,O,F;if(p._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(f=new a(f).normalize(),x=p._parts,R=f._parts,O=p.path(),F=f.path(),O.charAt(0)!=="/")throw new Error("URI is already relative");if(F.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");if(x.protocol===R.protocol&&(x.protocol=null),x.username!==R.username||x.password!==R.password||x.protocol!==null||x.username!==null||x.password!==null)return p.build();if(x.hostname===R.hostname&&x.port===R.port)x.hostname=null,x.port=null;else return p.build();if(O===F)return x.path="",p.build();if(L=a.commonPath(O,F),!L)return p.build();var G=R.path.substring(L.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return x.path=G+x.path.substring(L.length)||"./",p.build()},l.equals=function(f){var p=this.clone(),x=new a(f),R={},L={},O={},F,G,j;if(p.normalize(),x.normalize(),p.toString()===x.toString())return!0;if(F=p.query(),G=x.query(),p.query(""),x.query(""),p.toString()!==x.toString()||F.length!==G.length)return!1;R=a.parseQuery(F,this._parts.escapeQuerySpace),L=a.parseQuery(G,this._parts.escapeQuerySpace);for(j in R)if(h.call(R,j)){if(d(R[j])){if(!y(R[j],L[j]))return!1}else if(R[j]!==L[j])return!1;O[j]=!0}for(j in L)if(h.call(L,j)&&!O[j])return!1;return!0},l.preventInvalidHostname=function(f){return this._parts.preventInvalidHostname=!!f,this},l.duplicateQueryParameters=function(f){return this._parts.duplicateQueryParameters=!!f,this},l.escapeQuerySpace=function(f){return this._parts.escapeQuerySpace=!!f,this},a})})(Pf);var XS=Pf.exports;const Ca=ds(XS),wh=["http","https"];function HS(r){return typeof r=="string"&&r.startsWith("/vsi")&&!r.startsWith("/vsicurl/")}function WS(r,e,t=!0){return VS(r,e,!1,t)}function VS(r,e=null,t=!1,i=!0){typeof r=="string"&&r.startsWith("/vsicurl/")&&(r=r.replace(/^\/vsicurl\//,""));let n=Ca(r);if(e&&n.is("relative")&&!HS(r)){let s=Ca(e),a=s.path();!a.endsWith("/")&&!a.endsWith(".json")&&s.path(a+"/"),n=n.absoluteTo(s)}return n.normalize(),t&&(n.query(""),n.fragment("")),i?n.toString():n}const YS="application/geo+json",KS=["application/json",YS,"text/json"],Sh=["image/gif","image/jpeg","image/apng","image/png","image/webp"],Af=["image/tiff; application=geotiff; profile=cloud-optimized","image/vnd.stac.geotiff; cloud-optimized=true"],If=["application/geotiff","image/tiff; application=geotiff","image/vnd.stac.geotiff"].concat(Af);function Jo(r,e,t=!1){return Array.isArray(e)||(e=[e]),t&&typeof r>"u"?!0:typeof r!="string"?!1:(e=e.map(i=>i.toLowerCase()),e.includes(r.toLowerCase()))}function QS(r,e=!1){return Jo(r,KS,e)}class Lf extends bs{constructor(e,t=null,i={},n=[]){super(e,i,["_context"].concat(n)),this._context||(this._context=t)}getAbsoluteUrl(e=!0){return this._context?WS(this.href,this._context.getAbsoluteUrl(),e):this.href.includes("://")?this.href:null}getContext(){return this._context}canBrowserDisplayImage(e=!1){if(typeof this.href!="string")return!1;if(!e&&typeof this.type>"u")return!1;let t=new Ca(this.href),i=t.protocol().toLowerCase(),n=t.suffix().toLowerCase();return ut(i)&&!wh.includes(i)?!1:ut(this.type)&&Sh.includes(this.type.toLowerCase())?!0:!!(typeof this.type>"u"&&ut(n)&&(n==="jpg"||Sh.includes("image/"+n)))}isType(e){return ut(this.type)&&Jo(this.type,e)}isGeoTIFF(){return this.isType(If)}isCOG(){return this.isType(Af)}isHTTP(){let t=this.getAbsoluteUrl(!1).protocol().toLowerCase();return ut(t)&&wh.includes(t)}}class el extends Lf{constructor(e,t=null){super(e,t)}isLink(){return!0}getObjectType(){return"Link"}static fromLinks(e,t=null){return Array.isArray(e)?e.map(i=>lt(i)?new el(i,t):i):[]}}class Cf extends bs{constructor(e,t=null,i={},n=[]){if(super(e,Object.assign({links:el.fromLinks},i),["_url"].concat(n)),!this._url&&(this._url=t,!this._url)){let s=this.getSelfLink();s&&(this._url=s.href)}}getAbsoluteUrl(){return this._url}setAbsoluteUrl(e){this._url=e}getStacLinksWithRel(e,t=!0){return this.getLinksWithRels([e]).filter(i=>QS(i.type,t))}getStacLinkWithRel(e,t=!0){const i=this.getStacLinksWithRel(e,t);return i.length>0?i[0]:null}getLinks(){return Array.isArray(this.links)?this.links.filter(e=>lt(e)&&ut(e.href)):[]}getLinkWithRel(e){return this.getLinks().find(t=>t.rel===e)||null}getLinksWithRels(e){return this.getLinks().filter(t=>e.includes(t.rel))}getLinksWithOtherRels(e){return this.getLinks().filter(t=>!e.includes(t.rel))}getSelfLink(){return this.getStacLinkWithRel("self")}getRootLink(){return this.getStacLinkWithRel("root")}getParentLink(){return this.getStacLinkWithRel("parent")}}class Of extends Cf{constructor(e,t=null,i={},n=[]){super(e,t,i,n)}getAll(){return[]}}class dr extends Lf{constructor(e,t=null,i=null){super(e,i,{},["_key"]),this._key||(this._key=t)}getObjectType(){return"Asset"}isAsset(){return!0}getAbsoluteUrl(e=!0){return this.isDefintion()?null:super.getAbsoluteUrl(e)}getKey(){return this._key}getMetadata(e){if(typeof this[e]<"u")return this[e];if(this._context)return this._context.getMetadata(e)}getBands(){return bf(this["eo:bands"],this["raster:bands"])}findVisualBands(){let e={red:null,green:null,blue:null},t=this.getBands();for(let n in t){let s=parseInt(n,10),a=t[s];lt(a)&&ut(a.common_name)&&a.common_name in e&&(e[a.common_name]={index:s,band:a})}return Object.values(e).every(n=>n!==null)?e:null}findBand(e,t="name",i=null){Array.isArray(e)||(e=[e]),lt(i)||(i=this.getBands());let n=i.findIndex(s=>lt(s)&&e.includes(s[t]));return n>=0?{index:n,band:i[n]}:null}getBand(e){return lt(e)||e===null?e:this.getBands()[e]||null}getMinMaxValues(e=null){e=this.getBand(e);const t={minimum:null,maximum:null},i=o=>o.minimum!==null&&o.maximum!==null;if(e&&(lt(e.statistics)&&(typeof e.statistics.minimum=="number"&&(t.minimum=e.statistics.minimum),typeof e.statistics.maximum=="number"&&(t.maximum=e.statistics.maximum),i(t))||lt(e.histogram)&&(typeof e.histogram.min=="number"&&(t.minimum=e.histogram.min),typeof e.histogram.max=="number"&&(t.maximum=e.histogram.max),i(t))))return t;let n=this.getMetadata("classification:classes");if(Array.isArray(n)&&(n.reduce((o,l)=>(o.minimum=Math.min(o.minimum,l.value),o.maximum=Math.max(o.maximum,l.value),o),t),i(t)))return t;let s=this.getMetadata("file:values");if(Array.isArray(s)&&(s.reduce((o,l)=>(o.minimum=Math.min(o.minimum,...l.values),o.maximum=Math.max(o.maximum,...l.values),o),t),i(t)))return t;let a=lt(e)&&e.data_type||this.getMetadata("file:data_type");return a&&(t.minimum=kS(a),t.maximum=$S(a)),t}getNoDataValues(e=null){e=this.getBand(e);let t=[];if(e&&typeof e.nodata<"u")t.push(e.nodata);else{let i=this.getMetadata("file:nodata");if(typeof i<"u")t=i;else{let n=this.getMetadata("classification:classes");Array.isArray(n)&&(t=n.filter(s=>!!s.nodata).map(s=>s.value))}}return t.map(i=>i==="nan"?NaN:i==="+inf"?1/0:i==="-inf"?-1/0:i)}isDefintion(){return!ut(this.href)}isHTTP(){return this.isDefintion()?null:super.isHTTP()}hasRole(e,t=!1){return Array.isArray(e)||(e=[e]),t&&e.includes(this.getKey())?!0:Array.isArray(this.roles)&&!!this.roles.find(i=>e.includes(i))}static fromAssets(e,t=null){let i={};if(lt(e))for(let n in e)i[n]=new dr(e[n],n,t);return i}}class hn extends Cf{constructor(e,t=null,i={},n=[]){super(e,t,i,n)}getTemporalExtent(){return null}getTemporalExtents(){return[]}getIcons(e=!0){return this.getLinksWithRels(["icon"]).filter(t=>t.canBrowserDisplayImage(e))}getThumbnails(e=!0,t=null){let i=this.getAssetsWithRoles(["thumbnail","overview"],!0);return t&&i.length>1&&i.sort(n=>Array.isArray(n.roles)&&n.roles.includes(t)||n.getKey()===t?-1:1),i.length===0&&(i=this.getLinksWithRels(["preview"])),e&&(i=i.filter(n=>n.canBrowserDisplayImage())),i}getDefaultGeoTIFF(e=!0,t=!1){var n;return(n=this.rankGeoTIFFs(e,t)[0])==null?void 0:n.asset}rankGeoTIFFs(e=!0,t=!1,i=null,n=null){lt(i)||(i={data:1,visual:2,thumbnail:2,overview:3});let s=[],a=this.getAssetsByTypes(If);e&&(a=a.filter(l=>l.isHTTP()&&(!t||l.isCOG())));let o=Object.entries(i);for(let l of a){let h=0;if(o.length>0){let c=o.filter(([u])=>l.hasRole(u,!0)).map(([,u])=>u);c.length>0&&(h+=Math.max(...c))}!t&&l.isCOG()&&(h+=2),l.findVisualBands()&&(h+=1),typeof n=="function"&&(h+=n(l)),s.push({asset:l,score:h})}return s.sort((l,h)=>h.score-l.score),s}findVisualAssets(){let e={red:null,green:null,blue:null},t=Object.keys(e),i=this.getAssets();for(let s of i){let a=s.getBands();if(a.length!==1)continue;let o=s.findBand(t,"common_name",a);o&&(e[o.band.common_name]=s)}return Object.values(e).every(s=>s!==null)?e:null}getAsset(e){return lt(this.assets)&&this.assets[e]||null}getAssets(){return lt(this.assets)?Object.values(this.assets):[]}getAssetsWithRoles(e,t=!1){return this.getAssets().filter(i=>i.hasRole(e,t))}getAssetWithRole(e,t=!1){return this.getAssetsWithRoles([e],t)[0]||null}getAssetsByTypes(e){return this.getAssets().filter(t=>Jo(t.type,e))}equals(e){return this===e?!0:!(e instanceof hn)||this.getObjectType()!==e.getObjectType()?!1:!!(this.id&&this.id===e.id)}}class Nf extends hn{constructor(e,t=null,i={},n=[]){super(e,t,i,n)}getObjectType(){return this.type}getSearchLink(e=null){let t=this.getStacLinksWithRel("search");return e?t[0]||null:t.find(i=>i.method===e||!e&&!i.method)||null}getApiCollectionsLink(){return this.getStacLinkWithRel("data")}getApiItemsLink(){return this.getStacLinkWithRel("items")}getChildLinks(){return this.getStacLinksWithRel("child")}getItemLinks(){return this.getStacLinksWithRel("item")}}class JS extends Nf{constructor(e,t=null){super(e,t)}}function Ui(r){if(ut(r)&&r.length>=10)try{let t=r.match(/^(-?\d{1,})-(\d\d)-(\d\d)[T ](\d\d):(\d\d):(\d\d)(?:\.(\d*))?(?:Z|[+-]00:00)?$/i).slice(1).map(i=>parseInt(i,10));return new Date(Date.UTC(t[0],t[1]-1,t[2],t[3],t[4],t[5],t[6]||0))}catch{return null}return null}function eT(r,e){return new Date(r.valueOf()+(e-r)/2)}function Ff(r){if(!Array.isArray(r)||r.length===0)return null;let e,t;const i=(n,s,a)=>typeof n>"u"?s:n===null||s===null?null:a(n,s);return r.forEach(([n,s])=>{e=i(e,n,Math.min),t=i(t,s,Math.max)}),[e===null?null:new Date(e),t===null?null:new Date(t)]}function un(r){let e=r.length>4,t=r[0],i=r[e?3:2],n=r[1],s=r[e?4:3];return{west:t,east:i,south:n,north:s}}function ra(r){let{west:e,east:t,south:i,north:n}=un(r);return[[[e,n],[e,i],[t,i],[t,n],[e,n]]]}function Df(r){if(Wt(r)?r=[r]:Array.isArray(r)&&(r=r.filter(i=>Wt(i))),!Array.isArray(r)||r.length===0)return null;let e=r.reduce((i,n)=>{if(tT(n)){let{west:s,east:a,south:o,north:l}=un(n);i.push(ra([-180,o,a,l])),i.push(ra([s,o,180,l]))}else i.push(ra(n));return i},[]),t=null;if(e.length===1?t={type:"Polygon",coordinates:e[0]}:e.length>1&&(t={type:"MultiPolygon",coordinates:e}),t)return{type:"Feature",geometry:t,properties:{}}}function Wt(r){if(!Array.isArray(r)||![4,6].includes(r.length)||r.some(s=>typeof s!="number"))return!1;let{west:e,east:t,south:i,north:n}=un(r);return i<=n&&e>=-180&&e<=180&&i>=-90&&t<=180&&t>=-180&&n<=90}function tT(r){if(!Wt(r))return!1;let{west:e,east:t}=un(r);return e>t}function Gf(r){if(!Array.isArray(r)||r.length===0)return null;let e={west:180,south:90,east:-180,north:-90};r.forEach(i=>{if(!Wt(i))return;let n=un(i),s=["west","south"];for(let a in n){let o=s.includes(a)?Math.min:Math.max;e[a]=o(e[a],n[a])}});let t=[e.west,e.south,e.east,e.north];return Wt(t)?t:null}class Uf extends Nf{constructor(e,t=null){const i={assets:dr.fromAssets,item_assets:dr.fromAssets};super(e,t,i)}toGeoJSON(){let e=Df(this.getBoundingBoxes());return e&&(e.id=this.id),e}getBoundingBox(){let e=this.getRawBoundingBoxes();return e.length>0&&Wt(e[0])?e[0]:null}getBoundingBoxes(){let e=this.getRawBoundingBoxes();return e.length===1&&Wt(e[0])?e:e.length>1?e.filter((t,i)=>i>0&&Wt(t)):[]}getRawBoundingBoxes(){var t,i;let e=(i=(t=this.extent)==null?void 0:t.spatial)==null?void 0:i.bbox;return Array.isArray(e)&&e.length>0?e:[]}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){var t,i;let e=(i=(t=this.extent)==null?void 0:t.temporal)==null?void 0:i.interval;return Array.isArray(e)&&e.length>0?e.filter(n=>Array.isArray(n)&&(ut(n[0])||ut(n[1]))).map(n=>n.map(s=>Ui(s))):[]}getSummary(e){return this.summaries[e]}getBands(){let e=this.getSummary("eo:bands"),t=this.getSummary("raster:bands"),i=[e,t].filter(n=>Array.isArray(n));return i.length>=2?bf(...i):i.length===1?i[0]:[]}}class rT extends Of{constructor(e,t=null){const i={collections:n=>n.map(s=>new Uf(s))};super(e,t,i)}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map(t=>t.toGeoJSON()).filter(t=>t!==null)}}getBoundingBox(){return Gf(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map(e=>e.getBoundingBox())}getTemporalExtent(){return Ff(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map(e=>e.getTemporalExtent())}}class Bf extends hn{constructor(e,t=null){super(e,t,{assets:dr.fromAssets})}getObjectType(){return"Item"}toGeoJSON(){return this.toJSON()}getBoundingBox(){return Wt(this.bbox)?this.bbox:null}getBoundingBoxes(){return Wt(this.bbox)?[this.bbox]:[]}getDateTime(){let e=Ui(this.properties.datetime);if(!e){let t=Ui(this.properties.start_datetime),i=Ui(this.properties.end_datetime);return t&&i?eT(t,i):t||i}return e}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let e=[];return ut(this.properties.start_datetime)||ut(this.properties.end_datetime)?e=[[this.properties.start_datetime||null,this.properties.end_datetime||null]]:ut(this.properties.datetime)&&(e=[[this.properties.datetime,this.properties.datetime]]),e.map(t=>t.map(i=>Ui(i)))}getMetadata(e){return this.properties[e]}getBands(){let e=this.getMetadata("eo:bands");return Array.isArray(e)?e:[]}getCollectionLink(){return this.getStacLinkWithRel("collection")}}class iT extends Of{constructor(e,t=null){const i={features:n=>n.map(s=>new Bf(s))};super(e,t,i)}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return Gf(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map(e=>e.getBoundingBox())}getTemporalExtent(){return Ff(this.getTemporalExtents())}getTemporalExtents(){return this.features.map(e=>e.getTemporalExtent())}}function nT(r,e=!0,t=!1){return e&&(r=zS.stac(r,t)),r.type==="Feature"?new Bf(r):r.type==="FeatureCollection"?new iT(r):r.type==="Collection"||!r.type&&typeof r.extent<"u"&&typeof r.license<"u"?new Uf(r):!r.type&&Array.isArray(r.collections)?new rT(r):new JS(r)}class Th extends Ao{constructor(t){super({...t,state:"loading"});Ls(this,"loadImage",t=>new Promise((i,n)=>{const s=new Image;s.addEventListener("load",()=>i(s)),s.addEventListener("error",()=>n(new Error("load failed"))),s.src=t}));const i=new Wo(t.url);i.getHeader().then(n=>{this.tileGrid.minZoom=n.minZoom,this.tileGrid.maxZoom=n.maxZoom,this.setLoader(async(s,a,o)=>{const l=await i.getZxy(s,a,o),h=URL.createObjectURL(new Blob([l.data])),c=await this.loadImage(h);return URL.revokeObjectURL(h),c}),this.setState("ready")})}}class sT extends fs{constructor(t){super({...t,state:"loading",url:"pmtiles://"+t.url+"/{z}/{x}/{y}",format:new Yh});Ls(this,"tileLoadFunction",(t,i)=>{const n=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=i.match(n),a=+s[2],o=+s[3],l=+s[4];t.setLoader((h,c,u)=>{t.setState(ie.LOADING),this.pmtiles_.getZxy(a,o,l).then(d=>{if(d){const m=t.getFormat();t.setFeatures(m.readFeatures(d.data,{extent:h,featureProjection:u})),t.setState(ie.LOADED)}else t.setFeatures([]),t.setState(ie.EMPTY)}).catch(d=>{t.setFeatures([]),t.setState(ie.ERROR)})})});this.pmtiles_=new Wo(t.url),this.pmtiles_.getHeader().then(i=>{this.tileGrid.minZoom=i.minZoom,this.tileGrid.maxZoom=i.maxZoom,this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}}let tl=null;function aT(){return!!tl}function zf(r){tl=r;const e=Object.keys(r.defs),t=e.length;let i,n;for(i=0;i<t;++i){const s=e[i];if(!de(s)){const a=r.defs(s);let o=a.units;!o&&a.projName==="longlat"&&(o="degrees"),_g(new ha({code:s,axisOrientation:a.axis,metersPerUnit:a.to_meter,units:o}))}}for(i=0;i<t;++i){const s=e[i],a=de(s);for(n=0;n<t;++n){const o=e[n],l=de(o);if(!xg(s,o))if(r.defs[s]===r.defs[o])vg([a,l]);else{const h=r(s,o);Eg(a,l,pl(a,l,h.forward),pl(l,a,h.inverse))}}}}let oT=async function(r){const e=await fetch(`https://epsg.io/${r}.proj4`);if(!e.ok)throw new Error(`Unexpected response from epsg.io: ${e.status}`);return e.text()};async function lT(r){typeof r=="string"&&(r=parseInt(r.split(":").pop(),10));const e=tl;if(!e)throw new Error("Proj4 must be registered first with register(proj4)");const t="EPSG:"+r;return e.defs(t)?de(t):(e.defs(t,await oT(r)),zf(e),de(t))}const hT=new Ft({fill:new li({color:"rgba(255,255,255,0.4)"}),stroke:new mr({color:"#3399CC",width:3})}),uT=new Ft({stroke:new mr({color:"#ff9933",width:1})});function cT(r,e){const t={url:r.getAbsoluteUrl()};let i=null;r.getBands().length===1&&(i=0);const{minimum:n,maximum:s}=r.getMinMaxValues(i);typeof n=="number"&&(t.min=n),typeof s=="number"&&(t.max=s);const a=r.getNoDataValues(i);return a.length>0&&(t.nodata=a[0]),e.length>0&&(t.bands=e),t}async function Mh(r,e=void 0){let t=e;if(aT()){const i=r.getMetadata("proj:epsg");if(i)try{t=await lT(i)}catch{}}return t}function Rh(r,e){const t=r.clone();return e.hasOnlyBounds()||t.setFill(null),t}function fT(r){let e=r.href;if(e.includes("{s}"))if(Array.isArray(r["href:servers"])&&r["href:servers"].length>0){const t=Math.random()*r["href:servers"].length|0;e=e.replace("{s}",r["href:servers"][t])}else return null;return e}async function dT(r){try{const e=new URL(r);e.searchParams.set("service","wmts"),e.searchParams.set("request","GetCapabilities");const t=await fetch(e);return new oc().read(await t.text())}catch{return null}}class rl extends lu{constructor(e){const t={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(i=>t[i]=e[i]),super(t),this.getSourceOptions_=e.getSourceOptions,this.data_,this.assets_=null,this.bands_=[],this.crossOrigin_=e.crossOrigin||null,this.displayFootprint_=e.displayFootprint!==!1,this.displayGeoTiffByDefault_=!!e.displayGeoTiffByDefault,this.displayPreview_=!!e.displayPreview,this.displayOverview_=e.displayOverview!==!1,this.displayWebMapLink_=e.displayWebMapLink||!1,this.buildTileUrlTemplate_=e.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=e.useTileLayerAsFallback||!1,this.boundsStyle_=e.boundsStyle||hT,this.collectionStyle_=e.collectionStyle||uT,this.boundsLayer_=null,e.data){try{this.configure_(e.data,e.url,e.assets,e.bands)}catch(i){this.handleError_(i)}return}if(!e.url)throw new Error("Either url or data must be provided");fetch(e.url).then(i=>i.json()).then(i=>this.configure_(i,e.url,e.assets,e.bands)).catch(i=>this.handleError_(i))}getBoundsLayer(){return this.boundsLayer_}handleError_(e){this.dispatchEvent(new DS(e))}configure_(e,t=null,i=null,n=[]){e instanceof dr||e instanceof hn?this.data_=e:this.data_=nT(e),t&&t.includes("://")&&this.data_.setAbsoluteUrl(t),this.bands_=n,this.boundsLayer_=this.addFootprint_();const s=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(Rh(this.boundsStyle_,this))};this.getLayers().on("add",s),this.getLayers().on("remove",s),this.setAssets(i).then(()=>this.dispatchEvent("assetsready")).catch(a=>this.handleError_(a)),this.dispatchEvent("sourceready")}async addApiCollection_(){const e=this.getData().getAll().map(t=>{const i=new rl({data:t,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_});return this.addLayer_(i),i});return await Promise.all(e)}async addStacAssets_(){let e=this.getAssets();if(e===null){e=[];const i=this.getData().getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);if(i)e.push(i);else{const n=this.getData().getThumbnails();n.length>0&&e.push(n[0])}}const t=e.map(i=>this.addImagery_(i));return await Promise.all(t)}async addImagery_(e){if(e){if(e.isGeoTIFF())return await this.addGeoTiff_(e);if(e.canBrowserDisplayImage())return await this.addThumbnail_(e)}}async addThumbnail_(e){if(!this.displayPreview_)return;let t={url:e.getAbsoluteUrl(),projection:await Mh(e,"EPSG:4326"),imageExtent:e.getContext().getBoundingBox(),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(t=await this.getSourceOptions_(Ae.ImageStatic,t,e));const i=new Xa({source:new rf(t)});return this.addLayer_(i,e),i}async addWebMapLinks_(){const e=this.getWebMapLinks();if(e.length>0)return await this.addLayerForLink(e[0])}async addLayerForLink(e){const t=fT(e);if(!t)return;const i={attributions:e.getMetadata("attribution")||this.data_.getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:t},n=async(a,o)=>(this.getSourceOptions_&&(o=await this.getSourceOptions_(a,o,e)),o),s=[];switch(e.rel){case"pmtiles":const o=await new Wo(i.url).getHeader();let l;switch(o.tileType){case Xr.Mvt:l=new sT(await n(Ae.PMTilesVector,i));break;case Xr.Avif:case Xr.Jpeg:case Xr.Png:case Xr.Webp:l=new Th(await n(Ae.PMTilesRaster,i));break;default:return}s.push(l);break;case"tilejson":s.push(new uf(await n(Ae.TileJSON,i)));break;case"wms":if(!Array.isArray(e["wms:layers"]))break;for(const u in e["wms:layers"]){const d=e["wms:layers"][u];let m;Array.isArray(e["wms:styles"])&&typeof e["wms:styles"][u]=="string"&&(m=e["wms:styles"][u]);const g=Object.assign({LAYERS:d,STYLES:m},e["wms:dimensions"]);typeof e["wms:transparent"]=="boolean"&&(g.TRANSPARENT=String(e["wms:transparent"])),typeof e.type=="string"&&e.type.startsWith("image/")&&(g.FORMAT=e.type);const y=await n(Ae.TileWMS,Object.assign({},i,{params:g}));s.push(new mu(y))}break;case"wmts":const h=await dT(t);if(!h)return;const c=Array.isArray(e["wmts:layer"])?e["wmts:layer"]:[e["wmts:layer"]];for(const u of c){let d=Object.assign({},i,{layer:u});typeof e.type=="string"&&e.type.startsWith("image/")&&(d.format=e.type),d=await n(Ae.WMTS,d),s.push(new pu(wg(h,d)))}break;case"xyz":s.push(new fi(await n(Ae.XYZ,i)));break;default:return}return s.map(a=>{let o;return a instanceof fs?o=new hu({source:a,declutter:!0}):a instanceof Th?o=new Ta({source:a}):o=new zn({source:a}),this.addLayer_(o,e),o})}async addGeoTiff_(e){if(!this.displayOverview_)return;if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);let i={sources:[cT(e,this.bands_)]};const n=await Mh(e);n&&(i.projection=n),this.getSourceOptions_&&(i=await this.getSourceOptions_(Ae.GeoTIFF,i,e));const s=async(a,o)=>(o&&this.getLayers().remove(o),await this.addTileLayerForImagery_(a));try{const a=new GS(i),o=new Ta({source:a});if(this.useTileLayerAsFallback_){const l=()=>s(e,o);a.on("error",l),a.on("tileloaderror",l),a.on("change",()=>{a.getState()==="error"&&s(e,o)}),o.on("error",l),await a.getView()}return this.addLayer_(o,e),o}catch(a){if(this.useTileLayerAsFallback_)return await s(e,null);this.handleError_(a)}}async addTileLayerForImagery_(e){let t={crossOrigin:this.crossOrigin_,url:this.buildTileUrlTemplate_(e)};this.getSourceOptions_&&(t=await this.getSourceOptions_(Ae.XYZ,t,e));const i=new zn({source:new fi(t)});return this.addLayer_(i,e),i}addLayer_(e,t,i=0){e.set("stac",t),e.setZIndex(i),this.getLayers().push(e)}addFootprint_(){let e=null;const t=this.getData();if(t.isItemCollection()||t.isCollectionCollection()?e=Df(t.getBoundingBox()):e=t.toGeoJSON(),e){const i=new Vh,n=new os({format:i,loader:(a,o,l)=>{const h=i.readFeatures(e,{featureProjection:l});n.addFeatures(h)}}),s=new Ba({source:n,style:Rh(this.boundsStyle_,this),visible:this.displayFootprint_});return s.set("bounds",!0),this.addLayer_(s,t,1),s}return null}async updateLayers_(){const e=this.getLayers();for(let i=e.getLength()-1;i>=0;i--){const s=e.item(i).get("stac");s&&(s.isLink()||s.isAsset())&&e.removeAt(i)}const t=this.getData();t.isItemCollection()||t.isCollectionCollection()?await this.addApiCollection_():(t.isItem()||t.isCollection())&&await this.addStacAssets_(),this.displayWebMapLink_&&this.hasOnlyBounds()&&await this.addWebMapLinks_()}hasOnlyBounds(){const e=this.getBoundsLayer();return typeof this.getLayersArray().find(i=>i!==e)>"u"}getWebMapLinks(){let e=["xyz","tilejson","pmtiles","wmts","wms"];typeof this.displayWebMapLink_=="string"&&(e=[this.displayWebMapLink_]);const t=this.data_.getLinksWithRels(e);return t.sort((i,n)=>{const s=e.indexOf(i.rel),a=e.indexOf(n.rel);return s-a}),t}async setAssets(e){Array.isArray(e)?this.assets_=e.map(t=>typeof t=="string"?this.getData().getAsset(t):t instanceof dr?t:new dr(t)):this.assets_=null,await this.updateLayers_()}getData(){return this.data_}getAssets(){return this.assets_}getExtent(){if(!this.boundsLayer_)return;const e=this.boundsLayer_.getMapInternal();if(!e)return;const t=e.getView();if(!t)return;const i=this.getData();if(!i)return;const n=i.getBoundingBox();if(n)return Sg(n,"EPSG:4326",t.getProjection())}}function gT(r){r("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),r("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),r("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),r.WGS84=r["EPSG:4326"],r["EPSG:3785"]=r["EPSG:3857"],r.GOOGLE=r["EPSG:3857"],r["EPSG:900913"]=r["EPSG:3857"],r["EPSG:102113"]=r["EPSG:3857"]}var Nr=1,Fr=2,ai=3,mT=4,Oa=5,bh=6378137,pT=6356752314e-3,Ph=.0066943799901413165,Hi=484813681109536e-20,z=Math.PI/2,yT=.16666666666666666,_T=.04722222222222222,xT=.022156084656084655,Z=1e-10,We=.017453292519943295,qt=57.29577951308232,Me=Math.PI/4,tn=Math.PI*2,Ge=3.14159265359,mt={};mt.greenwich=0;mt.lisbon=-9.131906111111;mt.paris=2.337229166667;mt.bogota=-74.080916666667;mt.madrid=-3.687938888889;mt.rome=12.452333333333;mt.bern=7.439583333333;mt.jakarta=106.807719444444;mt.ferro=-17.666666666667;mt.brussels=4.367975;mt.stockholm=18.058277777778;mt.athens=23.7163375;mt.oslo=10.722916666667;const vT={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var Ah=/[\s_\-\/\(\)]/g;function _r(r,e){if(r[e])return r[e];for(var t=Object.keys(r),i=e.toLowerCase().replace(Ah,""),n=-1,s,a;++n<t.length;)if(s=t[n],a=s.toLowerCase().replace(Ah,""),a===i)return r[s]}function Na(r){var e={},t=r.split("+").map(function(o){return o.trim()}).filter(function(o){return o}).reduce(function(o,l){var h=l.split("=");return h.push(!0),o[h[0].toLowerCase()]=h[1],o},{}),i,n,s,a={proj:"projName",datum:"datumCode",rf:function(o){e.rf=parseFloat(o)},lat_0:function(o){e.lat0=o*We},lat_1:function(o){e.lat1=o*We},lat_2:function(o){e.lat2=o*We},lat_ts:function(o){e.lat_ts=o*We},lon_0:function(o){e.long0=o*We},lon_1:function(o){e.long1=o*We},lon_2:function(o){e.long2=o*We},alpha:function(o){e.alpha=parseFloat(o)*We},gamma:function(o){e.rectified_grid_angle=parseFloat(o)},lonc:function(o){e.longc=o*We},x_0:function(o){e.x0=parseFloat(o)},y_0:function(o){e.y0=parseFloat(o)},k_0:function(o){e.k0=parseFloat(o)},k:function(o){e.k0=parseFloat(o)},a:function(o){e.a=parseFloat(o)},b:function(o){e.b=parseFloat(o)},r_a:function(){e.R_A=!0},zone:function(o){e.zone=parseInt(o,10)},south:function(){e.utmSouth=!0},towgs84:function(o){e.datum_params=o.split(",").map(function(l){return parseFloat(l)})},to_meter:function(o){e.to_meter=parseFloat(o)},units:function(o){e.units=o;var l=_r(vT,o);l&&(e.to_meter=l.to_meter)},from_greenwich:function(o){e.from_greenwich=o*We},pm:function(o){var l=_r(mt,o);e.from_greenwich=(l||parseFloat(o))*We},nadgrids:function(o){o==="@null"?e.datumCode="none":e.nadgrids=o},axis:function(o){var l="ewnsud";o.length===3&&l.indexOf(o.substr(0,1))!==-1&&l.indexOf(o.substr(1,1))!==-1&&l.indexOf(o.substr(2,1))!==-1&&(e.axis=o)},approx:function(){e.approx=!0}};for(i in t)n=t[i],i in a?(s=a[i],typeof s=="function"?s(n):e[s]=n):e[i]=n;return typeof e.datumCode=="string"&&e.datumCode!=="WGS84"&&(e.datumCode=e.datumCode.toLowerCase()),e}var rn=1,kf=2,$f=3,rs=4,jf=5,il=-1,ET=/\s/,wT=/[A-Za-z]/,ST=/[A-Za-z84_]/,Ps=/[,\]]/,Zf=/[\d\.E\-\+]/;function hr(r){if(typeof r!="string")throw new Error("not a string");this.text=r.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=rn}hr.prototype.readCharicter=function(){var r=this.text[this.place++];if(this.state!==rs)for(;ET.test(r);){if(this.place>=this.text.length)return;r=this.text[this.place++]}switch(this.state){case rn:return this.neutral(r);case kf:return this.keyword(r);case rs:return this.quoted(r);case jf:return this.afterquote(r);case $f:return this.number(r);case il:return}};hr.prototype.afterquote=function(r){if(r==='"'){this.word+='"',this.state=rs;return}if(Ps.test(r)){this.word=this.word.trim(),this.afterItem(r);return}throw new Error(`havn't handled "`+r+'" in afterquote yet, index '+this.place)};hr.prototype.afterItem=function(r){if(r===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=rn;return}if(r==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=rn,this.currentObject=this.stack.pop(),this.currentObject||(this.state=il);return}};hr.prototype.number=function(r){if(Zf.test(r)){this.word+=r;return}if(Ps.test(r)){this.word=parseFloat(this.word),this.afterItem(r);return}throw new Error(`havn't handled "`+r+'" in number yet, index '+this.place)};hr.prototype.quoted=function(r){if(r==='"'){this.state=jf;return}this.word+=r};hr.prototype.keyword=function(r){if(ST.test(r)){this.word+=r;return}if(r==="["){var e=[];e.push(this.word),this.level++,this.root===null?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,this.state=rn;return}if(Ps.test(r)){this.afterItem(r);return}throw new Error(`havn't handled "`+r+'" in keyword yet, index '+this.place)};hr.prototype.neutral=function(r){if(wT.test(r)){this.word=r,this.state=kf;return}if(r==='"'){this.word="",this.state=rs;return}if(Zf.test(r)){this.word=r,this.state=$f;return}if(Ps.test(r)){this.afterItem(r);return}throw new Error(`havn't handled "`+r+'" in neutral yet, index '+this.place)};hr.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===il)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function TT(r){var e=new hr(r);return e.output()}function Ih(r,e,t){Array.isArray(e)&&(t.unshift(e),e=null);var i=e?{}:r,n=t.reduce(function(s,a){return Jr(a,s),s},i);e&&(r[e]=n)}function Jr(r,e){if(!Array.isArray(r)){e[r]=!0;return}var t=r.shift();if(t==="PARAMETER"&&(t=r.shift()),r.length===1){if(Array.isArray(r[0])){e[t]={},Jr(r[0],e[t]);return}e[t]=r[0];return}if(!r.length){e[t]=!0;return}if(t==="TOWGS84"){e[t]=r;return}if(t==="AXIS"){t in e||(e[t]=[]),e[t].push(r);return}Array.isArray(t)||(e[t]={});var i;switch(t){case"UNIT":case"PRIMEM":case"VERT_DATUM":e[t]={name:r[0].toLowerCase(),convert:r[1]},r.length===3&&Jr(r[2],e[t]);return;case"SPHEROID":case"ELLIPSOID":e[t]={name:r[0],a:r[1],rf:r[2]},r.length===4&&Jr(r[3],e[t]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":r[0]=["name",r[0]],Ih(e,t,r);return;default:for(i=-1;++i<r.length;)if(!Array.isArray(r[i]))return Jr(r,e[t]);return Ih(e,t,r)}}var MT=.017453292519943295;function RT(r,e){var t=e[0],i=e[1];!(t in r)&&i in r&&(r[t]=r[i],e.length===3&&(r[t]=e[2](r[t])))}function zt(r){return r*MT}function bT(r){if(r.type==="GEOGCS"?r.projName="longlat":r.type==="LOCAL_CS"?(r.projName="identity",r.local=!0):typeof r.PROJECTION=="object"?r.projName=Object.keys(r.PROJECTION)[0]:r.projName=r.PROJECTION,r.AXIS){for(var e="",t=0,i=r.AXIS.length;t<i;++t){var n=[r.AXIS[t][0].toLowerCase(),r.AXIS[t][1].toLowerCase()];n[0].indexOf("north")!==-1||(n[0]==="y"||n[0]==="lat")&&n[1]==="north"?e+="n":n[0].indexOf("south")!==-1||(n[0]==="y"||n[0]==="lat")&&n[1]==="south"?e+="s":n[0].indexOf("east")!==-1||(n[0]==="x"||n[0]==="lon")&&n[1]==="east"?e+="e":(n[0].indexOf("west")!==-1||(n[0]==="x"||n[0]==="lon")&&n[1]==="west")&&(e+="w")}e.length===2&&(e+="u"),e.length===3&&(r.axis=e)}r.UNIT&&(r.units=r.UNIT.name.toLowerCase(),r.units==="metre"&&(r.units="meter"),r.UNIT.convert&&(r.type==="GEOGCS"?r.DATUM&&r.DATUM.SPHEROID&&(r.to_meter=r.UNIT.convert*r.DATUM.SPHEROID.a):r.to_meter=r.UNIT.convert));var s=r.GEOGCS;r.type==="GEOGCS"&&(s=r),s&&(s.DATUM?r.datumCode=s.DATUM.name.toLowerCase():r.datumCode=s.name.toLowerCase(),r.datumCode.slice(0,2)==="d_"&&(r.datumCode=r.datumCode.slice(2)),(r.datumCode==="new_zealand_geodetic_datum_1949"||r.datumCode==="new_zealand_1949")&&(r.datumCode="nzgd49"),(r.datumCode==="wgs_1984"||r.datumCode==="world_geodetic_system_1984")&&(r.PROJECTION==="Mercator_Auxiliary_Sphere"&&(r.sphere=!0),r.datumCode="wgs84"),r.datumCode.slice(-6)==="_ferro"&&(r.datumCode=r.datumCode.slice(0,-6)),r.datumCode.slice(-8)==="_jakarta"&&(r.datumCode=r.datumCode.slice(0,-8)),~r.datumCode.indexOf("belge")&&(r.datumCode="rnb72"),s.DATUM&&s.DATUM.SPHEROID&&(r.ellps=s.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),r.ellps.toLowerCase().slice(0,13)==="international"&&(r.ellps="intl"),r.a=s.DATUM.SPHEROID.a,r.rf=parseFloat(s.DATUM.SPHEROID.rf,10)),s.DATUM&&s.DATUM.TOWGS84&&(r.datum_params=s.DATUM.TOWGS84),~r.datumCode.indexOf("osgb_1936")&&(r.datumCode="osgb36"),~r.datumCode.indexOf("osni_1952")&&(r.datumCode="osni52"),(~r.datumCode.indexOf("tm65")||~r.datumCode.indexOf("geodetic_datum_of_1965"))&&(r.datumCode="ire65"),r.datumCode==="ch1903+"&&(r.datumCode="ch1903"),~r.datumCode.indexOf("israel")&&(r.datumCode="isr93")),r.b&&!isFinite(r.b)&&(r.b=r.a);function a(h){var c=r.to_meter||1;return h*c}var o=function(h){return RT(r,h)},l=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",zt],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",zt],["x0","false_easting",a],["y0","false_northing",a],["long0","central_meridian",zt],["lat0","latitude_of_origin",zt],["lat0","standard_parallel_1",zt],["lat1","standard_parallel_1",zt],["lat2","standard_parallel_2",zt],["azimuth","Azimuth"],["alpha","azimuth",zt],["srsCode","name"]];l.forEach(o),!r.long0&&r.longc&&(r.projName==="Albers_Conic_Equal_Area"||r.projName==="Lambert_Azimuthal_Equal_Area")&&(r.long0=r.longc),!r.lat_ts&&r.lat1&&(r.projName==="Stereographic_South_Pole"||r.projName==="Polar Stereographic (variant B)")?(r.lat0=zt(r.lat1>0?90:-90),r.lat_ts=r.lat1):!r.lat_ts&&r.lat0&&r.projName==="Polar_Stereographic"&&(r.lat_ts=r.lat0,r.lat0=zt(r.lat0>0?90:-90))}function qf(r){var e=TT(r),t=e.shift(),i=e.shift();e.unshift(["name",i]),e.unshift(["type",t]);var n={};return Jr(e,n),bT(n),n}function Je(r){var e=this;if(arguments.length===2){var t=arguments[1];typeof t=="string"?t.charAt(0)==="+"?Je[r]=Na(arguments[1]):Je[r]=qf(arguments[1]):Je[r]=t}else if(arguments.length===1){if(Array.isArray(r))return r.map(function(i){Array.isArray(i)?Je.apply(e,i):Je(i)});if(typeof r=="string"){if(r in Je)return Je[r]}else"EPSG"in r?Je["EPSG:"+r.EPSG]=r:"ESRI"in r?Je["ESRI:"+r.ESRI]=r:"IAU2000"in r?Je["IAU2000:"+r.IAU2000]=r:console.log(r);return}}gT(Je);function PT(r){return typeof r=="string"}function AT(r){return r in Je}var IT=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function LT(r){return IT.some(function(e){return r.indexOf(e)>-1})}var CT=["3857","900913","3785","102113"];function OT(r){var e=_r(r,"authority");if(e){var t=_r(e,"epsg");return t&&CT.indexOf(t)>-1}}function NT(r){var e=_r(r,"extension");if(e)return _r(e,"proj4")}function FT(r){return r[0]==="+"}function DT(r){if(PT(r)){if(AT(r))return Je[r];if(LT(r)){var e=qf(r);if(OT(e))return Je["EPSG:3857"];var t=NT(e);return t?Na(t):e}if(FT(r))return Na(r)}else return r}function Lh(r,e){r=r||{};var t,i;if(!e)return r;for(i in e)t=e[i],t!==void 0&&(r[i]=t);return r}function Kt(r,e,t){var i=r*e;return t/Math.sqrt(1-i*i)}function cn(r){return r<0?-1:1}function q(r){return Math.abs(r)<=Ge?r:r-cn(r)*tn}function Dt(r,e,t){var i=r*t,n=.5*r;return i=Math.pow((1-i)/(1+i),n),Math.tan(.5*(z-e))/i}function nn(r,e){for(var t=.5*r,i,n,s=z-2*Math.atan(e),a=0;a<=15;a++)if(i=r*Math.sin(s),n=z-2*Math.atan(e*Math.pow((1-i)/(1+i),t))-s,s+=n,Math.abs(n)<=1e-10)return s;return-9999}function GT(){var r=this.b/this.a;this.es=1-r*r,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Kt(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function UT(r){var e=r.x,t=r.y;if(t*qt>90&&t*qt<-90&&e*qt>180&&e*qt<-180)return null;var i,n;if(Math.abs(Math.abs(t)-z)<=Z)return null;if(this.sphere)i=this.x0+this.a*this.k0*q(e-this.long0),n=this.y0+this.a*this.k0*Math.log(Math.tan(Me+.5*t));else{var s=Math.sin(t),a=Dt(this.e,t,s);i=this.x0+this.a*this.k0*q(e-this.long0),n=this.y0-this.a*this.k0*Math.log(a)}return r.x=i,r.y=n,r}function BT(r){var e=r.x-this.x0,t=r.y-this.y0,i,n;if(this.sphere)n=z-2*Math.atan(Math.exp(-t/(this.a*this.k0)));else{var s=Math.exp(-t/(this.a*this.k0));if(n=nn(this.e,s),n===-9999)return null}return i=q(this.long0+e/(this.a*this.k0)),r.x=i,r.y=n,r}var zT=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const kT={init:GT,forward:UT,inverse:BT,names:zT};function $T(){}function Ch(r){return r}var jT=["longlat","identity"];const ZT={init:$T,forward:Ch,inverse:Ch,names:jT};var qT=[kT,ZT],Cn={},is=[];function Xf(r,e){var t=is.length;return r.names?(is[t]=r,r.names.forEach(function(i){Cn[i.toLowerCase()]=t}),this):(console.log(e),!0)}function XT(r){if(!r)return!1;var e=r.toLowerCase();if(typeof Cn[e]<"u"&&is[Cn[e]])return is[Cn[e]]}function HT(){qT.forEach(Xf)}const WT={start:HT,add:Xf,get:XT};var se={};se.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};se.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};se.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};se.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};se.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};se.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};se.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};se.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};se.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};se.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};se.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};se.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};se.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};se.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};se.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};se.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};se.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};se.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};se.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};se.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};se.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};se.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};se.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};se.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};se.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};se.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};se.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};se.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};se.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};se.hough={a:6378270,rf:297,ellipseName:"Hough"};se.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};se.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};se.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};se.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};se.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};se.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};se.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};se.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};se.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};se.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};se.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};se.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var VT=se.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};se.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function YT(r,e,t,i){var n=r*r,s=e*e,a=(n-s)/n,o=0;i?(r*=1-a*(yT+a*(_T+a*xT)),n=r*r,a=0):o=Math.sqrt(a);var l=(n-s)/s;return{es:a,e:o,ep2:l}}function KT(r,e,t,i,n){if(!r){var s=_r(se,i);s||(s=VT),r=s.a,e=s.b,t=s.rf}return t&&!e&&(e=(1-1/t)*r),(t===0||Math.abs(r-e)<Z)&&(n=!0,e=r),{a:r,b:e,rf:t,sphere:n}}var Ze={};Ze.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};Ze.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};Ze.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};Ze.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};Ze.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};Ze.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};Ze.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};Ze.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};Ze.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"};Ze.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};Ze.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};Ze.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};Ze.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};Ze.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};Ze.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};Ze.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};Ze.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};Ze.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function QT(r,e,t,i,n,s,a){var o={};return r===void 0||r==="none"?o.datum_type=Oa:o.datum_type=mT,e&&(o.datum_params=e.map(parseFloat),(o.datum_params[0]!==0||o.datum_params[1]!==0||o.datum_params[2]!==0)&&(o.datum_type=Nr),o.datum_params.length>3&&(o.datum_params[3]!==0||o.datum_params[4]!==0||o.datum_params[5]!==0||o.datum_params[6]!==0)&&(o.datum_type=Fr,o.datum_params[3]*=Hi,o.datum_params[4]*=Hi,o.datum_params[5]*=Hi,o.datum_params[6]=o.datum_params[6]/1e6+1)),a&&(o.datum_type=ai,o.grids=a),o.a=t,o.b=i,o.es=n,o.ep2=s,o}var Hf={};function JT(r,e){var t=new DataView(e),i=rM(t),n=iM(t,i),s=nM(t,n,i),a={header:n,subgrids:s};return Hf[r]=a,a}function eM(r){if(r===void 0)return null;var e=r.split(",");return e.map(tM)}function tM(r){if(r.length===0)return null;var e=r[0]==="@";return e&&(r=r.slice(1)),r==="null"?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:r,mandatory:!e,grid:Hf[r]||null,isNull:!1}}function ei(r){return r/3600*Math.PI/180}function rM(r){var e=r.getInt32(8,!1);return e===11?!1:(e=r.getInt32(8,!0),e!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function iM(r,e){return{nFields:r.getInt32(8,e),nSubgridFields:r.getInt32(24,e),nSubgrids:r.getInt32(40,e),shiftType:Fa(r,56,64).trim(),fromSemiMajorAxis:r.getFloat64(120,e),fromSemiMinorAxis:r.getFloat64(136,e),toSemiMajorAxis:r.getFloat64(152,e),toSemiMinorAxis:r.getFloat64(168,e)}}function Fa(r,e,t){return String.fromCharCode.apply(null,new Uint8Array(r.buffer.slice(e,t)))}function nM(r,e,t){for(var i=176,n=[],s=0;s<e.nSubgrids;s++){var a=aM(r,i,t),o=oM(r,i,a,t),l=Math.round(1+(a.upperLongitude-a.lowerLongitude)/a.longitudeInterval),h=Math.round(1+(a.upperLatitude-a.lowerLatitude)/a.latitudeInterval);n.push({ll:[ei(a.lowerLongitude),ei(a.lowerLatitude)],del:[ei(a.longitudeInterval),ei(a.latitudeInterval)],lim:[l,h],count:a.gridNodeCount,cvs:sM(o)}),i+=176+a.gridNodeCount*16}return n}function sM(r){return r.map(function(e){return[ei(e.longitudeShift),ei(e.latitudeShift)]})}function aM(r,e,t){return{name:Fa(r,e+8,e+16).trim(),parent:Fa(r,e+24,e+24+8).trim(),lowerLatitude:r.getFloat64(e+72,t),upperLatitude:r.getFloat64(e+88,t),lowerLongitude:r.getFloat64(e+104,t),upperLongitude:r.getFloat64(e+120,t),latitudeInterval:r.getFloat64(e+136,t),longitudeInterval:r.getFloat64(e+152,t),gridNodeCount:r.getInt32(e+168,t)}}function oM(r,e,t,i){for(var n=e+176,s=16,a=[],o=0;o<t.gridNodeCount;o++){var l={latitudeShift:r.getFloat32(n+o*s,i),longitudeShift:r.getFloat32(n+o*s+4,i),latitudeAccuracy:r.getFloat32(n+o*s+8,i),longitudeAccuracy:r.getFloat32(n+o*s+12,i)};a.push(l)}return a}function Vt(r,e){if(!(this instanceof Vt))return new Vt(r);e=e||function(h){if(h)throw h};var t=DT(r);if(typeof t!="object"){e(r);return}var i=Vt.projections.get(t.projName);if(!i){e(r);return}if(t.datumCode&&t.datumCode!=="none"){var n=_r(Ze,t.datumCode);n&&(t.datum_params=t.datum_params||(n.towgs84?n.towgs84.split(","):null),t.ellps=n.ellipse,t.datumName=n.datumName?n.datumName:t.datumCode)}t.k0=t.k0||1,t.axis=t.axis||"enu",t.ellps=t.ellps||"wgs84",t.lat1=t.lat1||t.lat0;var s=KT(t.a,t.b,t.rf,t.ellps,t.sphere),a=YT(s.a,s.b,s.rf,t.R_A),o=eM(t.nadgrids),l=t.datum||QT(t.datumCode,t.datum_params,s.a,s.b,a.es,a.ep2,o);Lh(this,t),Lh(this,i),this.a=s.a,this.b=s.b,this.rf=s.rf,this.sphere=s.sphere,this.es=a.es,this.e=a.e,this.ep2=a.ep2,this.datum=l,this.init(),e(null,this)}Vt.projections=WT;Vt.projections.start();function lM(r,e){return r.datum_type!==e.datum_type||r.a!==e.a||Math.abs(r.es-e.es)>5e-11?!1:r.datum_type===Nr?r.datum_params[0]===e.datum_params[0]&&r.datum_params[1]===e.datum_params[1]&&r.datum_params[2]===e.datum_params[2]:r.datum_type===Fr?r.datum_params[0]===e.datum_params[0]&&r.datum_params[1]===e.datum_params[1]&&r.datum_params[2]===e.datum_params[2]&&r.datum_params[3]===e.datum_params[3]&&r.datum_params[4]===e.datum_params[4]&&r.datum_params[5]===e.datum_params[5]&&r.datum_params[6]===e.datum_params[6]:!0}function Wf(r,e,t){var i=r.x,n=r.y,s=r.z?r.z:0,a,o,l,h;if(n<-z&&n>-1.001*z)n=-z;else if(n>z&&n<1.001*z)n=z;else{if(n<-z)return{x:-1/0,y:-1/0,z:r.z};if(n>z)return{x:1/0,y:1/0,z:r.z}}return i>Math.PI&&(i-=2*Math.PI),o=Math.sin(n),h=Math.cos(n),l=o*o,a=t/Math.sqrt(1-e*l),{x:(a+s)*h*Math.cos(i),y:(a+s)*h*Math.sin(i),z:(a*(1-e)+s)*o}}function Vf(r,e,t,i){var n=1e-12,s=n*n,a=30,o,l,h,c,u,d,m,g,y,_,v,E,S,w=r.x,P=r.y,A=r.z?r.z:0,I,C,k;if(o=Math.sqrt(w*w+P*P),l=Math.sqrt(w*w+P*P+A*A),o/t<n){if(I=0,l/t<n)return C=z,k=-i,{x:r.x,y:r.y,z:r.z}}else I=Math.atan2(P,w);h=A/l,c=o/l,u=1/Math.sqrt(1-e*(2-e)*c*c),g=c*(1-e)*u,y=h*u,S=0;do S++,m=t/Math.sqrt(1-e*y*y),k=o*g+A*y-m*(1-e*y*y),d=e*m/(m+k),u=1/Math.sqrt(1-d*(2-d)*c*c),_=c*(1-d)*u,v=h*u,E=v*g-_*y,g=_,y=v;while(E*E>s&&S<a);return C=Math.atan(v/Math.abs(_)),{x:I,y:C,z:k}}function hM(r,e,t){if(e===Nr)return{x:r.x+t[0],y:r.y+t[1],z:r.z+t[2]};if(e===Fr){var i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],h=t[6];return{x:h*(r.x-l*r.y+o*r.z)+i,y:h*(l*r.x+r.y-a*r.z)+n,z:h*(-o*r.x+a*r.y+r.z)+s}}}function uM(r,e,t){if(e===Nr)return{x:r.x-t[0],y:r.y-t[1],z:r.z-t[2]};if(e===Fr){var i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=(r.x-i)/h,u=(r.y-n)/h,d=(r.z-s)/h;return{x:c+l*u-o*d,y:-l*c+u+a*d,z:o*c-a*u+d}}}function Mn(r){return r===Nr||r===Fr}function cM(r,e,t){if(lM(r,e)||r.datum_type===Oa||e.datum_type===Oa)return t;var i=r.a,n=r.es;if(r.datum_type===ai){var s=Oh(r,!1,t);if(s!==0)return;i=bh,n=Ph}var a=e.a,o=e.b,l=e.es;if(e.datum_type===ai&&(a=bh,o=pT,l=Ph),n===l&&i===a&&!Mn(r.datum_type)&&!Mn(e.datum_type))return t;if(t=Wf(t,n,i),Mn(r.datum_type)&&(t=hM(t,r.datum_type,r.datum_params)),Mn(e.datum_type)&&(t=uM(t,e.datum_type,e.datum_params)),t=Vf(t,l,a,o),e.datum_type===ai){var h=Oh(e,!0,t);if(h!==0)return}return t}function Oh(r,e,t){if(r.grids===null||r.grids.length===0)return console.log("Grid shift grids not found"),-1;var i={x:-t.x,y:t.y},n={x:Number.NaN,y:Number.NaN},s=[];e:for(var a=0;a<r.grids.length;a++){var o=r.grids[a];if(s.push(o.name),o.isNull){n=i;break}if(o.mandatory,o.grid===null){if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1;continue}for(var l=o.grid.subgrids,h=0,c=l.length;h<c;h++){var u=l[h],d=(Math.abs(u.del[1])+Math.abs(u.del[0]))/1e4,m=u.ll[0]-d,g=u.ll[1]-d,y=u.ll[0]+(u.lim[0]-1)*u.del[0]+d,_=u.ll[1]+(u.lim[1]-1)*u.del[1]+d;if(!(g>i.y||m>i.x||_<i.y||y<i.x)&&(n=fM(i,e,u),!isNaN(n.x)))break e}}return isNaN(n.x)?(console.log("Failed to find a grid shift table for location '"+-i.x*qt+" "+i.y*qt+" tried: '"+s+"'"),-1):(t.x=-n.x,t.y=n.y,0)}function fM(r,e,t){var i={x:Number.NaN,y:Number.NaN};if(isNaN(r.x))return i;var n={x:r.x,y:r.y};n.x-=t.ll[0],n.y-=t.ll[1],n.x=q(n.x-Math.PI)+Math.PI;var s=Nh(n,t);if(e){if(isNaN(s.x))return i;s.x=n.x-s.x,s.y=n.y-s.y;var a=9,o=1e-12,l,h;do{if(h=Nh(s,t),isNaN(h.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}l={x:n.x-(h.x+s.x),y:n.y-(h.y+s.y)},s.x+=l.x,s.y+=l.y}while(a--&&Math.abs(l.x)>o&&Math.abs(l.y)>o);if(a<0)return console.log("Inverse grid shift iterator failed to converge."),i;i.x=q(s.x+t.ll[0]),i.y=s.y+t.ll[1]}else isNaN(s.x)||(i.x=r.x+s.x,i.y=r.y+s.y);return i}function Nh(r,e){var t={x:r.x/e.del[0],y:r.y/e.del[1]},i={x:Math.floor(t.x),y:Math.floor(t.y)},n={x:t.x-1*i.x,y:t.y-1*i.y},s={x:Number.NaN,y:Number.NaN},a;if(i.x<0||i.x>=e.lim[0]||i.y<0||i.y>=e.lim[1])return s;a=i.y*e.lim[0]+i.x;var o={x:e.cvs[a][0],y:e.cvs[a][1]};a++;var l={x:e.cvs[a][0],y:e.cvs[a][1]};a+=e.lim[0];var h={x:e.cvs[a][0],y:e.cvs[a][1]};a--;var c={x:e.cvs[a][0],y:e.cvs[a][1]},u=n.x*n.y,d=n.x*(1-n.y),m=(1-n.x)*(1-n.y),g=(1-n.x)*n.y;return s.x=m*o.x+d*l.x+g*c.x+u*h.x,s.y=m*o.y+d*l.y+g*c.y+u*h.y,s}function Fh(r,e,t){var i=t.x,n=t.y,s=t.z||0,a,o,l,h={};for(l=0;l<3;l++)if(!(e&&l===2&&t.z===void 0))switch(l===0?(a=i,"ew".indexOf(r.axis[l])!==-1?o="x":o="y"):l===1?(a=n,"ns".indexOf(r.axis[l])!==-1?o="y":o="x"):(a=s,o="z"),r.axis[l]){case"e":h[o]=a;break;case"w":h[o]=-a;break;case"n":h[o]=a;break;case"s":h[o]=-a;break;case"u":t[o]!==void 0&&(h.z=a);break;case"d":t[o]!==void 0&&(h.z=-a);break;default:return null}return h}function Yf(r){var e={x:r[0],y:r[1]};return r.length>2&&(e.z=r[2]),r.length>3&&(e.m=r[3]),e}function dM(r){Dh(r.x),Dh(r.y)}function Dh(r){if(typeof Number.isFinite=="function"){if(Number.isFinite(r))return;throw new TypeError("coordinates must be finite numbers")}if(typeof r!="number"||r!==r||!isFinite(r))throw new TypeError("coordinates must be finite numbers")}function gM(r,e){return(r.datum.datum_type===Nr||r.datum.datum_type===Fr||r.datum.datum_type===ai)&&e.datumCode!=="WGS84"||(e.datum.datum_type===Nr||e.datum.datum_type===Fr||e.datum.datum_type===ai)&&r.datumCode!=="WGS84"}function ns(r,e,t,i){var n;Array.isArray(t)?t=Yf(t):t={x:t.x,y:t.y,z:t.z,m:t.m};var s=t.z!==void 0;if(dM(t),r.datum&&e.datum&&gM(r,e)&&(n=new Vt("WGS84"),t=ns(r,n,t,i),r=n),i&&r.axis!=="enu"&&(t=Fh(r,!1,t)),r.projName==="longlat")t={x:t.x*We,y:t.y*We,z:t.z||0};else if(r.to_meter&&(t={x:t.x*r.to_meter,y:t.y*r.to_meter,z:t.z||0}),t=r.inverse(t),!t)return;if(r.from_greenwich&&(t.x+=r.from_greenwich),t=cM(r.datum,e.datum,t),!!t)return e.from_greenwich&&(t={x:t.x-e.from_greenwich,y:t.y,z:t.z||0}),e.projName==="longlat"?t={x:t.x*qt,y:t.y*qt,z:t.z||0}:(t=e.forward(t),e.to_meter&&(t={x:t.x/e.to_meter,y:t.y/e.to_meter,z:t.z||0})),i&&e.axis!=="enu"?Fh(e,!0,t):(t&&!s&&delete t.z,t)}var Gh=Vt("WGS84");function ia(r,e,t,i){var n,s,a;return Array.isArray(t)?(n=ns(r,e,t,i)||{x:NaN,y:NaN},t.length>2?typeof r.name<"u"&&r.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"?typeof n.z=="number"?[n.x,n.y,n.z].concat(t.splice(3)):[n.x,n.y,t[2]].concat(t.splice(3)):[n.x,n.y].concat(t.splice(2)):[n.x,n.y]):(s=ns(r,e,t,i),a=Object.keys(t),a.length===2||a.forEach(function(o){if(typeof r.name<"u"&&r.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"){if(o==="x"||o==="y"||o==="z")return}else if(o==="x"||o==="y")return;s[o]=t[o]}),s)}function Uh(r){return r instanceof Vt?r:r.oProj?r.oProj:Vt(r)}function wt(r,e,t){r=Uh(r);var i=!1,n;return typeof e>"u"?(e=r,r=Gh,i=!0):(typeof e.x<"u"||Array.isArray(e))&&(t=e,e=r,r=Gh,i=!0),e=Uh(e),t?ia(r,e,t):(n={forward:function(s,a){return ia(r,e,s,a)},inverse:function(s,a){return ia(e,r,s,a)}},i&&(n.oProj=e),n)}var Bh=6,Kf="AJSAJS",Qf="AFAFAF",ti=65,ot=73,Tt=79,Bi=86,zi=90;const mM={forward:Jf,inverse:pM,toPoint:ed};function Jf(r,e){return e=e||5,xM(yM({lat:r[1],lon:r[0]}),e)}function pM(r){var e=nl(rd(r.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]}function ed(r){var e=nl(rd(r.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function na(r){return r*(Math.PI/180)}function zh(r){return 180*(r/Math.PI)}function yM(r){var e=r.lat,t=r.lon,i=6378137,n=.00669438,s=.9996,a,o,l,h,c,u,d,m=na(e),g=na(t),y,_;_=Math.floor((t+180)/6)+1,t===180&&(_=60),e>=56&&e<64&&t>=3&&t<12&&(_=32),e>=72&&e<84&&(t>=0&&t<9?_=31:t>=9&&t<21?_=33:t>=21&&t<33?_=35:t>=33&&t<42&&(_=37)),a=(_-1)*6-180+3,y=na(a),o=n/(1-n),l=i/Math.sqrt(1-n*Math.sin(m)*Math.sin(m)),h=Math.tan(m)*Math.tan(m),c=o*Math.cos(m)*Math.cos(m),u=Math.cos(m)*(g-y),d=i*((1-n/4-3*n*n/64-5*n*n*n/256)*m-(3*n/8+3*n*n/32+45*n*n*n/1024)*Math.sin(2*m)+(15*n*n/256+45*n*n*n/1024)*Math.sin(4*m)-35*n*n*n/3072*Math.sin(6*m));var v=s*l*(u+(1-h+c)*u*u*u/6+(5-18*h+h*h+72*c-58*o)*u*u*u*u*u/120)+5e5,E=s*(d+l*Math.tan(m)*(u*u/2+(5-h+9*c+4*c*c)*u*u*u*u/24+(61-58*h+h*h+600*c-330*o)*u*u*u*u*u*u/720));return e<0&&(E+=1e7),{northing:Math.round(E),easting:Math.round(v),zoneNumber:_,zoneLetter:_M(e)}}function nl(r){var e=r.northing,t=r.easting,i=r.zoneLetter,n=r.zoneNumber;if(n<0||n>60)return null;var s=.9996,a=6378137,o=.00669438,l,h=(1-Math.sqrt(1-o))/(1+Math.sqrt(1-o)),c,u,d,m,g,y,_,v,E,S=t-5e5,w=e;i<"N"&&(w-=1e7),_=(n-1)*6-180+3,l=o/(1-o),y=w/s,v=y/(a*(1-o/4-3*o*o/64-5*o*o*o/256)),E=v+(3*h/2-27*h*h*h/32)*Math.sin(2*v)+(21*h*h/16-55*h*h*h*h/32)*Math.sin(4*v)+151*h*h*h/96*Math.sin(6*v),c=a/Math.sqrt(1-o*Math.sin(E)*Math.sin(E)),u=Math.tan(E)*Math.tan(E),d=l*Math.cos(E)*Math.cos(E),m=a*(1-o)/Math.pow(1-o*Math.sin(E)*Math.sin(E),1.5),g=S/(c*s);var P=E-c*Math.tan(E)/m*(g*g/2-(5+3*u+10*d-4*d*d-9*l)*g*g*g*g/24+(61+90*u+298*d+45*u*u-252*l-3*d*d)*g*g*g*g*g*g/720);P=zh(P);var A=(g-(1+2*u+d)*g*g*g/6+(5-2*d+28*u-3*d*d+8*l+24*u*u)*g*g*g*g*g/120)/Math.cos(E);A=_+zh(A);var I;if(r.accuracy){var C=nl({northing:r.northing+r.accuracy,easting:r.easting+r.accuracy,zoneLetter:r.zoneLetter,zoneNumber:r.zoneNumber});I={top:C.lat,right:C.lon,bottom:P,left:A}}else I={lat:P,lon:A};return I}function _M(r){var e="Z";return 84>=r&&r>=72?e="X":72>r&&r>=64?e="W":64>r&&r>=56?e="V":56>r&&r>=48?e="U":48>r&&r>=40?e="T":40>r&&r>=32?e="S":32>r&&r>=24?e="R":24>r&&r>=16?e="Q":16>r&&r>=8?e="P":8>r&&r>=0?e="N":0>r&&r>=-8?e="M":-8>r&&r>=-16?e="L":-16>r&&r>=-24?e="K":-24>r&&r>=-32?e="J":-32>r&&r>=-40?e="H":-40>r&&r>=-48?e="G":-48>r&&r>=-56?e="F":-56>r&&r>=-64?e="E":-64>r&&r>=-72?e="D":-72>r&&r>=-80&&(e="C"),e}function xM(r,e){var t="00000"+r.easting,i="00000"+r.northing;return r.zoneNumber+r.zoneLetter+vM(r.easting,r.northing,r.zoneNumber)+t.substr(t.length-5,e)+i.substr(i.length-5,e)}function vM(r,e,t){var i=td(t),n=Math.floor(r/1e5),s=Math.floor(e/1e5)%20;return EM(n,s,i)}function td(r){var e=r%Bh;return e===0&&(e=Bh),e}function EM(r,e,t){var i=t-1,n=Kf.charCodeAt(i),s=Qf.charCodeAt(i),a=n+r-1,o=s+e,l=!1;a>zi&&(a=a-zi+ti-1,l=!0),(a===ot||n<ot&&a>ot||(a>ot||n<ot)&&l)&&a++,(a===Tt||n<Tt&&a>Tt||(a>Tt||n<Tt)&&l)&&(a++,a===ot&&a++),a>zi&&(a=a-zi+ti-1),o>Bi?(o=o-Bi+ti-1,l=!0):l=!1,(o===ot||s<ot&&o>ot||(o>ot||s<ot)&&l)&&o++,(o===Tt||s<Tt&&o>Tt||(o>Tt||s<Tt)&&l)&&(o++,o===ot&&o++),o>Bi&&(o=o-Bi+ti-1);var h=String.fromCharCode(a)+String.fromCharCode(o);return h}function rd(r){if(r&&r.length===0)throw"MGRSPoint coverting from nothing";for(var e=r.length,t=null,i="",n,s=0;!/[A-Z]/.test(n=r.charAt(s));){if(s>=2)throw"MGRSPoint bad conversion from: "+r;i+=n,s++}var a=parseInt(i,10);if(s===0||s+3>e)throw"MGRSPoint bad conversion from: "+r;var o=r.charAt(s++);if(o<="A"||o==="B"||o==="Y"||o>="Z"||o==="I"||o==="O")throw"MGRSPoint zone letter "+o+" not handled: "+r;t=r.substring(s,s+=2);for(var l=td(a),h=wM(t.charAt(0),l),c=SM(t.charAt(1),l);c<TM(o);)c+=2e6;var u=e-s;if(u%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+r;var d=u/2,m=0,g=0,y,_,v,E,S;return d>0&&(y=1e5/Math.pow(10,d),_=r.substring(s,s+d),m=parseFloat(_)*y,v=r.substring(s+d),g=parseFloat(v)*y),E=m+h,S=g+c,{easting:E,northing:S,zoneLetter:o,zoneNumber:a,accuracy:y}}function wM(r,e){for(var t=Kf.charCodeAt(e-1),i=1e5,n=!1;t!==r.charCodeAt(0);){if(t++,t===ot&&t++,t===Tt&&t++,t>zi){if(n)throw"Bad character: "+r;t=ti,n=!0}i+=1e5}return i}function SM(r,e){if(r>"V")throw"MGRSPoint given invalid Northing "+r;for(var t=Qf.charCodeAt(e-1),i=0,n=!1;t!==r.charCodeAt(0);){if(t++,t===ot&&t++,t===Tt&&t++,t>Bi){if(n)throw"Bad character: "+r;t=ti,n=!0}i+=1e5}return i}function TM(r){var e;switch(r){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+r}function mi(r,e,t){if(!(this instanceof mi))return new mi(r,e,t);if(Array.isArray(r))this.x=r[0],this.y=r[1],this.z=r[2]||0;else if(typeof r=="object")this.x=r.x,this.y=r.y,this.z=r.z||0;else if(typeof r=="string"&&typeof e>"u"){var i=r.split(",");this.x=parseFloat(i[0],10),this.y=parseFloat(i[1],10),this.z=parseFloat(i[2],10)||0}else this.x=r,this.y=e,this.z=t||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}mi.fromMGRS=function(r){return new mi(ed(r))};mi.prototype.toMGRS=function(r){return Jf([this.x,this.y],r)};var MM=1,RM=.25,kh=.046875,$h=.01953125,jh=.01068115234375,bM=.75,PM=.46875,AM=.013020833333333334,IM=.007120768229166667,LM=.3645833333333333,CM=.005696614583333333,OM=.3076171875;function id(r){var e=[];e[0]=MM-r*(RM+r*(kh+r*($h+r*jh))),e[1]=r*(bM-r*(kh+r*($h+r*jh)));var t=r*r;return e[2]=t*(PM-r*(AM+r*IM)),t*=r,e[3]=t*(LM-r*CM),e[4]=t*r*OM,e}function As(r,e,t,i){return t*=e,e*=e,i[0]*r-t*(i[1]+e*(i[2]+e*(i[3]+e*i[4])))}var NM=20;function nd(r,e,t){for(var i=1/(1-e),n=r,s=NM;s;--s){var a=Math.sin(n),o=1-e*a*a;if(o=(As(n,a,Math.cos(n),t)-r)*(o*Math.sqrt(o))*i,n-=o,Math.abs(o)<Z)return n}return n}function FM(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=id(this.es),this.ml0=As(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function DM(r){var e=r.x,t=r.y,i=q(e-this.long0),n,s,a,o=Math.sin(t),l=Math.cos(t);if(this.es){var c=l*i,u=Math.pow(c,2),d=this.ep2*Math.pow(l,2),m=Math.pow(d,2),g=Math.abs(l)>Z?Math.tan(t):0,y=Math.pow(g,2),_=Math.pow(y,2);n=1-this.es*Math.pow(o,2),c=c/Math.sqrt(n);var v=As(t,o,l,this.en);s=this.a*(this.k0*c*(1+u/6*(1-y+d+u/20*(5-18*y+_+14*d-58*y*d+u/42*(61+179*_-_*y-479*y)))))+this.x0,a=this.a*(this.k0*(v-this.ml0+o*i*c/2*(1+u/12*(5-y+9*d+4*m+u/30*(61+_-58*y+270*d-330*y*d+u/56*(1385+543*_-_*y-3111*y))))))+this.y0}else{var h=l*Math.sin(i);if(Math.abs(Math.abs(h)-1)<Z)return 93;if(s=.5*this.a*this.k0*Math.log((1+h)/(1-h))+this.x0,a=l*Math.cos(i)/Math.sqrt(1-Math.pow(h,2)),h=Math.abs(a),h>=1){if(h-1>Z)return 93;a=0}else a=Math.acos(a);t<0&&(a=-a),a=this.a*this.k0*(a-this.lat0)+this.y0}return r.x=s,r.y=a,r}function GM(r){var e,t,i,n,s=(r.x-this.x0)*(1/this.a),a=(r.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+a/this.k0,t=nd(e,this.es,this.en),Math.abs(t)<z){var u=Math.sin(t),d=Math.cos(t),m=Math.abs(d)>Z?Math.tan(t):0,g=this.ep2*Math.pow(d,2),y=Math.pow(g,2),_=Math.pow(m,2),v=Math.pow(_,2);e=1-this.es*Math.pow(u,2);var E=s*Math.sqrt(e)/this.k0,S=Math.pow(E,2);e=e*m,i=t-e*S/(1-this.es)*.5*(1-S/12*(5+3*_-9*g*_+g-4*y-S/30*(61+90*_-252*g*_+45*v+46*g-S/56*(1385+3633*_+4095*v+1574*v*_)))),n=q(this.long0+E*(1-S/6*(1+2*_+g-S/20*(5+28*_+24*v+8*g*_+6*g-S/42*(61+662*_+1320*v+720*v*_))))/d)}else i=z*cn(a),n=0;else{var o=Math.exp(s/this.k0),l=.5*(o-1/o),h=this.lat0+a/this.k0,c=Math.cos(h);e=Math.sqrt((1-Math.pow(c,2))/(1+Math.pow(l,2))),i=Math.asin(e),a<0&&(i=-i),l===0&&c===0?n=0:n=q(Math.atan2(l,c)+this.long0)}return r.x=n,r.y=i,r}var UM=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const On={init:FM,forward:DM,inverse:GM,names:UM};function sd(r){var e=Math.exp(r);return e=(e-1/e)/2,e}function Rt(r,e){r=Math.abs(r),e=Math.abs(e);var t=Math.max(r,e),i=Math.min(r,e)/(t||1);return t*Math.sqrt(1+Math.pow(i,2))}function BM(r){var e=1+r,t=e-1;return t===0?r:r*Math.log(e)/t}function zM(r){var e=Math.abs(r);return e=BM(e*(1+e/(Rt(1,e)+1))),r<0?-e:e}function sl(r,e){for(var t=2*Math.cos(2*e),i=r.length-1,n=r[i],s=0,a;--i>=0;)a=-s+t*n+r[i],s=n,n=a;return e+a*Math.sin(2*e)}function kM(r,e){for(var t=2*Math.cos(e),i=r.length-1,n=r[i],s=0,a;--i>=0;)a=-s+t*n+r[i],s=n,n=a;return Math.sin(e)*a}function $M(r){var e=Math.exp(r);return e=(e+1/e)/2,e}function ad(r,e,t){for(var i=Math.sin(e),n=Math.cos(e),s=sd(t),a=$M(t),o=2*n*a,l=-2*i*s,h=r.length-1,c=r[h],u=0,d=0,m=0,g,y;--h>=0;)g=d,y=u,d=c,u=m,c=-g+o*d-l*u+r[h],m=-y+l*d+o*u;return o=i*a,l=n*s,[o*c-l*m,o*m+l*c]}function jM(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(On.init.apply(this),this.forward=On.forward,this.inverse=On.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var r=this.es/(1+Math.sqrt(1-this.es)),e=r/(2-r),t=e;this.cgb[0]=e*(2+e*(-2/3+e*(-2+e*(116/45+e*(26/45+e*(-2854/675)))))),this.cbg[0]=e*(-2+e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))),t=t*e,this.cgb[1]=t*(7/3+e*(-8/5+e*(-227/45+e*(2704/315+e*(2323/945))))),this.cbg[1]=t*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),t=t*e,this.cgb[2]=t*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=t*(-26/15+e*(34/21+e*(8/5+e*(-12686/2835)))),t=t*e,this.cgb[3]=t*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=t*(1237/630+e*(-12/5+e*(-24832/14175))),t=t*e,this.cgb[4]=t*(4174/315+e*(-144838/6237)),this.cbg[4]=t*(-734/315+e*(109598/31185)),t=t*e,this.cgb[5]=t*(601676/22275),this.cbg[5]=t*(444337/155925),t=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+t*(1/4+t*(1/64+t/256))),this.utg[0]=e*(-.5+e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=t*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=t*(13/48+e*(-3/5+e*(557/1440+e*(281/630+e*(-1983433/1935360))))),t=t*e,this.utg[2]=t*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=t*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),t=t*e,this.utg[3]=t*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=t*(49561/161280+e*(-179/168+e*(6601661/7257600))),t=t*e,this.utg[4]=t*(-4583/161280+e*(108847/3991680)),this.gtu[4]=t*(34729/80640+e*(-3418889/1995840)),t=t*e,this.utg[5]=t*(-20648693/638668800),this.gtu[5]=t*(212378941/319334400);var i=sl(this.cbg,this.lat0);this.Zb=-this.Qn*(i+kM(this.gtu,2*i))}function ZM(r){var e=q(r.x-this.long0),t=r.y;t=sl(this.cbg,t);var i=Math.sin(t),n=Math.cos(t),s=Math.sin(e),a=Math.cos(e);t=Math.atan2(i,a*n),e=Math.atan2(s*n,Rt(i,n*a)),e=zM(Math.tan(e));var o=ad(this.gtu,2*t,2*e);t=t+o[0],e=e+o[1];var l,h;return Math.abs(e)<=2.623395162778?(l=this.a*(this.Qn*e)+this.x0,h=this.a*(this.Qn*t+this.Zb)+this.y0):(l=1/0,h=1/0),r.x=l,r.y=h,r}function qM(r){var e=(r.x-this.x0)*(1/this.a),t=(r.y-this.y0)*(1/this.a);t=(t-this.Zb)/this.Qn,e=e/this.Qn;var i,n;if(Math.abs(e)<=2.623395162778){var s=ad(this.utg,2*t,2*e);t=t+s[0],e=e+s[1],e=Math.atan(sd(e));var a=Math.sin(t),o=Math.cos(t),l=Math.sin(e),h=Math.cos(e);t=Math.atan2(a*h,Rt(l,h*o)),e=Math.atan2(l,h*o),i=q(e+this.long0),n=sl(this.cgb,t)}else i=1/0,n=1/0;return r.x=i,r.y=n,r}var XM=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const Nn={init:jM,forward:ZM,inverse:qM,names:XM};function HM(r,e){if(r===void 0){if(r=Math.floor((q(e)+Math.PI)*30/Math.PI)+1,r<0)return 0;if(r>60)return 60}return r}var WM="etmerc";function VM(){var r=HM(this.zone,this.long0);if(r===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(r)-183)*We,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Nn.init.apply(this),this.forward=Nn.forward,this.inverse=Nn.inverse}var YM=["Universal Transverse Mercator System","utm"];const KM={init:VM,names:YM,dependsOn:WM};function al(r,e){return Math.pow((1-r)/(1+r),e)}var QM=20;function JM(){var r=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*r*r),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(r/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Me)/(Math.pow(Math.tan(.5*this.lat0+Me),this.C)*al(this.e*r,this.ratexp))}function eR(r){var e=r.x,t=r.y;return r.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*t+Me),this.C)*al(this.e*Math.sin(t),this.ratexp))-z,r.x=this.C*e,r}function tR(r){for(var e=1e-14,t=r.x/this.C,i=r.y,n=Math.pow(Math.tan(.5*i+Me)/this.K,1/this.C),s=QM;s>0&&(i=2*Math.atan(n*al(this.e*Math.sin(r.y),-.5*this.e))-z,!(Math.abs(i-r.y)<e));--s)r.y=i;return s?(r.x=t,r.y=i,r):null}var rR=["gauss"];const ol={init:JM,forward:eR,inverse:tR,names:rR};function iR(){ol.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function nR(r){var e,t,i,n;return r.x=q(r.x-this.long0),ol.forward.apply(this,[r]),e=Math.sin(r.y),t=Math.cos(r.y),i=Math.cos(r.x),n=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*t*i),r.x=n*t*Math.sin(r.x),r.y=n*(this.cosc0*e-this.sinc0*t*i),r.x=this.a*r.x+this.x0,r.y=this.a*r.y+this.y0,r}function sR(r){var e,t,i,n,s;if(r.x=(r.x-this.x0)/this.a,r.y=(r.y-this.y0)/this.a,r.x/=this.k0,r.y/=this.k0,s=Rt(r.x,r.y)){var a=2*Math.atan2(s,this.R2);e=Math.sin(a),t=Math.cos(a),n=Math.asin(t*this.sinc0+r.y*e*this.cosc0/s),i=Math.atan2(r.x*e,s*this.cosc0*t-r.y*this.sinc0*e)}else n=this.phic0,i=0;return r.x=i,r.y=n,ol.inverse.apply(this,[r]),r.x=q(r.x+this.long0),r}var aR=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const oR={init:iR,forward:nR,inverse:sR,names:aR};function lR(r,e,t){return e*=t,Math.tan(.5*(z+r))*Math.pow((1-e)/(1+e),.5*t)}function hR(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Z&&(this.k0=.5*(1+cn(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=Z&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Z&&Math.abs(Math.cos(this.lat_ts))>Z&&(this.k0=.5*this.cons*Kt(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Dt(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Kt(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-z,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function uR(r){var e=r.x,t=r.y,i=Math.sin(t),n=Math.cos(t),s,a,o,l,h,c,u=q(e-this.long0);return Math.abs(Math.abs(e-this.long0)-Math.PI)<=Z&&Math.abs(t+this.lat0)<=Z?(r.x=NaN,r.y=NaN,r):this.sphere?(s=2*this.k0/(1+this.sinlat0*i+this.coslat0*n*Math.cos(u)),r.x=this.a*s*n*Math.sin(u)+this.x0,r.y=this.a*s*(this.coslat0*i-this.sinlat0*n*Math.cos(u))+this.y0,r):(a=2*Math.atan(this.ssfn_(t,i,this.e))-z,l=Math.cos(a),o=Math.sin(a),Math.abs(this.coslat0)<=Z?(h=Dt(this.e,t*this.con,this.con*i),c=2*this.a*this.k0*h/this.cons,r.x=this.x0+c*Math.sin(e-this.long0),r.y=this.y0-this.con*c*Math.cos(e-this.long0),r):(Math.abs(this.sinlat0)<Z?(s=2*this.a*this.k0/(1+l*Math.cos(u)),r.y=s*o):(s=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*o+this.cosX0*l*Math.cos(u))),r.y=s*(this.cosX0*o-this.sinX0*l*Math.cos(u))+this.y0),r.x=s*l*Math.sin(u)+this.x0,r))}function cR(r){r.x-=this.x0,r.y-=this.y0;var e,t,i,n,s,a=Math.sqrt(r.x*r.x+r.y*r.y);if(this.sphere){var o=2*Math.atan(a/(2*this.a*this.k0));return e=this.long0,t=this.lat0,a<=Z?(r.x=e,r.y=t,r):(t=Math.asin(Math.cos(o)*this.sinlat0+r.y*Math.sin(o)*this.coslat0/a),Math.abs(this.coslat0)<Z?this.lat0>0?e=q(this.long0+Math.atan2(r.x,-1*r.y)):e=q(this.long0+Math.atan2(r.x,r.y)):e=q(this.long0+Math.atan2(r.x*Math.sin(o),a*this.coslat0*Math.cos(o)-r.y*this.sinlat0*Math.sin(o))),r.x=e,r.y=t,r)}else if(Math.abs(this.coslat0)<=Z){if(a<=Z)return t=this.lat0,e=this.long0,r.x=e,r.y=t,r;r.x*=this.con,r.y*=this.con,i=a*this.cons/(2*this.a*this.k0),t=this.con*nn(this.e,i),e=this.con*q(this.con*this.long0+Math.atan2(r.x,-1*r.y))}else n=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,a<=Z?s=this.X0:(s=Math.asin(Math.cos(n)*this.sinX0+r.y*Math.sin(n)*this.cosX0/a),e=q(this.long0+Math.atan2(r.x*Math.sin(n),a*this.cosX0*Math.cos(n)-r.y*this.sinX0*Math.sin(n)))),t=-1*nn(this.e,Math.tan(.5*(z+s)));return r.x=e,r.y=t,r}var fR=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const dR={init:hR,forward:uR,inverse:cR,names:fR,ssfn_:lR};function gR(){var r=this.lat0;this.lambda0=this.long0;var e=Math.sin(r),t=this.a,i=this.rf,n=1/i,s=2*n-Math.pow(n,2),a=this.e=Math.sqrt(s);this.R=this.k0*t*Math.sqrt(1-s)/(1-s*Math.pow(e,2)),this.alpha=Math.sqrt(1+s/(1-s)*Math.pow(Math.cos(r),4)),this.b0=Math.asin(e/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),l=Math.log(Math.tan(Math.PI/4+r/2)),h=Math.log((1+a*e)/(1-a*e));this.K=o-this.alpha*l+this.alpha*a/2*h}function mR(r){var e=Math.log(Math.tan(Math.PI/4-r.y/2)),t=this.e/2*Math.log((1+this.e*Math.sin(r.y))/(1-this.e*Math.sin(r.y))),i=-this.alpha*(e+t)+this.K,n=2*(Math.atan(Math.exp(i))-Math.PI/4),s=this.alpha*(r.x-this.lambda0),a=Math.atan(Math.sin(s)/(Math.sin(this.b0)*Math.tan(n)+Math.cos(this.b0)*Math.cos(s))),o=Math.asin(Math.cos(this.b0)*Math.sin(n)-Math.sin(this.b0)*Math.cos(n)*Math.cos(s));return r.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,r.x=this.R*a+this.x0,r}function pR(r){for(var e=r.x-this.x0,t=r.y-this.y0,i=e/this.R,n=2*(Math.atan(Math.exp(t/this.R))-Math.PI/4),s=Math.asin(Math.cos(this.b0)*Math.sin(n)+Math.sin(this.b0)*Math.cos(n)*Math.cos(i)),a=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(n))),o=this.lambda0+a/this.alpha,l=0,h=s,c=-1e3,u=0;Math.abs(h-c)>1e-7;){if(++u>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+s/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),c=h,h=2*Math.atan(Math.exp(l))-Math.PI/2}return r.x=o,r.y=h,r}var yR=["somerc"];const _R={init:gR,forward:mR,inverse:pR,names:yR};var Wr=1e-7;function xR(r){var e=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],t=typeof r.PROJECTION=="object"?Object.keys(r.PROJECTION)[0]:r.PROJECTION;return"no_uoff"in r||"no_off"in r||e.indexOf(t)!==-1}function vR(){var r,e,t,i,n,s,a,o,l,h,c=0,u,d=0,m=0,g=0,y=0,_=0,v=0;this.no_off=xR(this),this.no_rot="no_rot"in this;var E=!1;"alpha"in this&&(E=!0);var S=!1;if("rectified_grid_angle"in this&&(S=!0),E&&(v=this.alpha),S&&(c=this.rectified_grid_angle*We),E||S)d=this.longc;else if(m=this.long1,y=this.lat1,g=this.long2,_=this.lat2,Math.abs(y-_)<=Wr||(r=Math.abs(y))<=Wr||Math.abs(r-z)<=Wr||Math.abs(Math.abs(this.lat0)-z)<=Wr||Math.abs(Math.abs(_)-z)<=Wr)throw new Error;var w=1-this.es;e=Math.sqrt(w),Math.abs(this.lat0)>Z?(o=Math.sin(this.lat0),t=Math.cos(this.lat0),r=1-this.es*o*o,this.B=t*t,this.B=Math.sqrt(1+this.es*this.B*this.B/w),this.A=this.B*this.k0*e/r,i=this.B*e/(t*Math.sqrt(r)),n=i*i-1,n<=0?n=0:(n=Math.sqrt(n),this.lat0<0&&(n=-n)),this.E=n+=i,this.E*=Math.pow(Dt(this.e,this.lat0,o),this.B)):(this.B=1/e,this.A=this.k0,this.E=i=n=1),E||S?(E?(u=Math.asin(Math.sin(v)/i),S||(c=v)):(u=c,v=Math.asin(i*Math.sin(u))),this.lam0=d-Math.asin(.5*(n-1/n)*Math.tan(u))/this.B):(s=Math.pow(Dt(this.e,y,Math.sin(y)),this.B),a=Math.pow(Dt(this.e,_,Math.sin(_)),this.B),n=this.E/s,l=(a-s)/(a+s),h=this.E*this.E,h=(h-a*s)/(h+a*s),r=m-g,r<-Math.pi?g-=tn:r>Math.pi&&(g+=tn),this.lam0=q(.5*(m+g)-Math.atan(h*Math.tan(.5*this.B*(m-g))/l)/this.B),u=Math.atan(2*Math.sin(this.B*q(m-this.lam0))/(n-1/n)),c=v=Math.asin(i*Math.sin(u))),this.singam=Math.sin(u),this.cosgam=Math.cos(u),this.sinrot=Math.sin(c),this.cosrot=Math.cos(c),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(i*i-1)/Math.cos(v))),this.lat0<0&&(this.u_0=-this.u_0)),n=.5*u,this.v_pole_n=this.ArB*Math.log(Math.tan(Me-n)),this.v_pole_s=this.ArB*Math.log(Math.tan(Me+n))}function ER(r){var e={},t,i,n,s,a,o,l,h;if(r.x=r.x-this.lam0,Math.abs(Math.abs(r.y)-z)>Z){if(a=this.E/Math.pow(Dt(this.e,r.y,Math.sin(r.y)),this.B),o=1/a,t=.5*(a-o),i=.5*(a+o),s=Math.sin(this.B*r.x),n=(t*this.singam-s*this.cosgam)/i,Math.abs(Math.abs(n)-1)<Z)throw new Error;h=.5*this.ArB*Math.log((1-n)/(1+n)),o=Math.cos(this.B*r.x),Math.abs(o)<Wr?l=this.A*r.x:l=this.ArB*Math.atan2(t*this.cosgam+s*this.singam,o)}else h=r.y>0?this.v_pole_n:this.v_pole_s,l=this.ArB*r.y;return this.no_rot?(e.x=l,e.y=h):(l-=this.u_0,e.x=h*this.cosrot+l*this.sinrot,e.y=l*this.cosrot-h*this.sinrot),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function wR(r){var e,t,i,n,s,a,o,l={};if(r.x=(r.x-this.x0)*(1/this.a),r.y=(r.y-this.y0)*(1/this.a),this.no_rot?(t=r.y,e=r.x):(t=r.x*this.cosrot-r.y*this.sinrot,e=r.y*this.cosrot+r.x*this.sinrot+this.u_0),i=Math.exp(-this.BrA*t),n=.5*(i-1/i),s=.5*(i+1/i),a=Math.sin(this.BrA*e),o=(a*this.cosgam+n*this.singam)/s,Math.abs(Math.abs(o)-1)<Z)l.x=0,l.y=o<0?-z:z;else{if(l.y=this.E/Math.sqrt((1+o)/(1-o)),l.y=nn(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(n*this.cosgam-a*this.singam,Math.cos(this.BrA*e))}return l.x+=this.lam0,l}var SR=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const TR={init:vR,forward:ER,inverse:wR,names:SR};function MR(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<Z)){var r=this.b/this.a;this.e=Math.sqrt(1-r*r);var e=Math.sin(this.lat1),t=Math.cos(this.lat1),i=Kt(this.e,e,t),n=Dt(this.e,this.lat1,e),s=Math.sin(this.lat2),a=Math.cos(this.lat2),o=Kt(this.e,s,a),l=Dt(this.e,this.lat2,s),h=Dt(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>Z?this.ns=Math.log(i/o)/Math.log(n/l):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=i/(this.ns*Math.pow(n,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function RR(r){var e=r.x,t=r.y;Math.abs(2*Math.abs(t)-Math.PI)<=Z&&(t=cn(t)*(z-2*Z));var i=Math.abs(Math.abs(t)-z),n,s;if(i>Z)n=Dt(this.e,t,Math.sin(t)),s=this.a*this.f0*Math.pow(n,this.ns);else{if(i=t*this.ns,i<=0)return null;s=0}var a=this.ns*q(e-this.long0);return r.x=this.k0*(s*Math.sin(a))+this.x0,r.y=this.k0*(this.rh-s*Math.cos(a))+this.y0,r}function bR(r){var e,t,i,n,s,a=(r.x-this.x0)/this.k0,o=this.rh-(r.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(a*a+o*o),t=1):(e=-Math.sqrt(a*a+o*o),t=-1);var l=0;if(e!==0&&(l=Math.atan2(t*a,t*o)),e!==0||this.ns>0){if(t=1/this.ns,i=Math.pow(e/(this.a*this.f0),t),n=nn(this.e,i),n===-9999)return null}else n=-z;return s=q(l/this.ns+this.long0),r.x=s,r.y=n,r}var PR=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const AR={init:MR,forward:RR,inverse:bR,names:PR};function IR(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function LR(r){var e,t,i,n,s,a,o,l=r.x,h=r.y,c=q(l-this.long0);return e=Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.alfa*this.e/2),t=2*(Math.atan(this.k*Math.pow(Math.tan(h/2+this.s45),this.alfa)/e)-this.s45),i=-c*this.alfa,n=Math.asin(Math.cos(this.ad)*Math.sin(t)+Math.sin(this.ad)*Math.cos(t)*Math.cos(i)),s=Math.asin(Math.cos(t)*Math.sin(i)/Math.cos(n)),a=this.n*s,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(n/2+this.s45),this.n),r.y=o*Math.cos(a)/1,r.x=o*Math.sin(a)/1,this.czech||(r.y*=-1,r.x*=-1),r}function CR(r){var e,t,i,n,s,a,o,l,h=r.x;r.x=r.y,r.y=h,this.czech||(r.y*=-1,r.x*=-1),a=Math.sqrt(r.x*r.x+r.y*r.y),s=Math.atan2(r.y,r.x),n=s/Math.sin(this.s0),i=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(i)-Math.sin(this.ad)*Math.cos(i)*Math.cos(n)),t=Math.asin(Math.cos(i)*Math.sin(n)/Math.cos(e)),r.x=this.long0-t/this.alfa,o=e,l=0;var c=0;do r.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-r.y)<1e-10&&(l=1),o=r.y,c+=1;while(l===0&&c<15);return c>=15?null:r}var OR=["Krovak","krovak"];const NR={init:IR,forward:LR,inverse:CR,names:OR};function tt(r,e,t,i,n){return r*n-e*Math.sin(2*n)+t*Math.sin(4*n)-i*Math.sin(6*n)}function fn(r){return 1-.25*r*(1+r/16*(3+1.25*r))}function dn(r){return .375*r*(1+.25*r*(1+.46875*r))}function gn(r){return .05859375*r*r*(1+.75*r)}function mn(r){return r*r*r*(35/3072)}function pi(r,e,t){var i=e*t;return r/Math.sqrt(1-i*i)}function bi(r){return Math.abs(r)<z?r:r-cn(r)*Math.PI}function ss(r,e,t,i,n){var s,a;s=r/e;for(var o=0;o<15;o++)if(a=(r-(e*s-t*Math.sin(2*s)+i*Math.sin(4*s)-n*Math.sin(6*s)))/(e-2*t*Math.cos(2*s)+4*i*Math.cos(4*s)-6*n*Math.cos(6*s)),s+=a,Math.abs(a)<=1e-10)return s;return NaN}function FR(){this.sphere||(this.e0=fn(this.es),this.e1=dn(this.es),this.e2=gn(this.es),this.e3=mn(this.es),this.ml0=this.a*tt(this.e0,this.e1,this.e2,this.e3,this.lat0))}function DR(r){var e,t,i=r.x,n=r.y;if(i=q(i-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(n)*Math.sin(i)),t=this.a*(Math.atan2(Math.tan(n),Math.cos(i))-this.lat0);else{var s=Math.sin(n),a=Math.cos(n),o=pi(this.a,this.e,s),l=Math.tan(n)*Math.tan(n),h=i*Math.cos(n),c=h*h,u=this.es*a*a/(1-this.es),d=this.a*tt(this.e0,this.e1,this.e2,this.e3,n);e=o*h*(1-c*l*(1/6-(8-l+8*u)*c/120)),t=d-this.ml0+o*s/a*c*(.5+(5-l+6*u)*c/24)}return r.x=e+this.x0,r.y=t+this.y0,r}function GR(r){r.x-=this.x0,r.y-=this.y0;var e=r.x/this.a,t=r.y/this.a,i,n;if(this.sphere){var s=t+this.lat0;i=Math.asin(Math.sin(s)*Math.cos(e)),n=Math.atan2(Math.tan(e),Math.cos(s))}else{var a=this.ml0/this.a+t,o=ss(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-z)<=Z)return r.x=this.long0,r.y=z,t<0&&(r.y*=-1),r;var l=pi(this.a,this.e,Math.sin(o)),h=l*l*l/this.a/this.a*(1-this.es),c=Math.pow(Math.tan(o),2),u=e*this.a/l,d=u*u;i=o-l*Math.tan(o)/h*u*u*(.5-(1+3*c)*u*u/24),n=u*(1-d*(c/3+(1+3*c)*c*d/15))/Math.cos(o)}return r.x=q(n+this.long0),r.y=bi(i),r}var UR=["Cassini","Cassini_Soldner","cass"];const BR={init:FR,forward:DR,inverse:GR,names:UR};function gr(r,e){var t;return r>1e-7?(t=r*e,(1-r*r)*(e/(1-t*t)-.5/r*Math.log((1-t)/(1+t)))):2*e}var zR=1,kR=2,$R=3,jR=4;function ZR(){var r=Math.abs(this.lat0);if(Math.abs(r-z)<Z?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(r)<Z?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var e;switch(this.qp=gr(this.e,1),this.mmf=.5/(1-this.es),this.apa=JR(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=gr(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function qR(r){var e,t,i,n,s,a,o,l,h,c,u=r.x,d=r.y;if(u=q(u-this.long0),this.sphere){if(s=Math.sin(d),c=Math.cos(d),i=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t=this.mode===this.EQUIT?1+c*i:1+this.sinph0*s+this.cosph0*c*i,t<=Z)return null;t=Math.sqrt(2/t),e=t*c*Math.sin(u),t*=this.mode===this.EQUIT?s:this.cosph0*s-this.sinph0*c*i}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),Math.abs(d+this.lat0)<Z)return null;t=Me-d*.5,t=2*(this.mode===this.S_POLE?Math.cos(t):Math.sin(t)),e=t*Math.sin(u),t*=i}}else{switch(o=0,l=0,h=0,i=Math.cos(u),n=Math.sin(u),s=Math.sin(d),a=gr(this.e,s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(o=a/this.qp,l=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:h=1+this.sinb1*o+this.cosb1*l*i;break;case this.EQUIT:h=1+l*i;break;case this.N_POLE:h=z+d,a=this.qp-a;break;case this.S_POLE:h=d-z,a=this.qp+a;break}if(Math.abs(h)<Z)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),this.mode===this.OBLIQ?t=this.ymf*h*(this.cosb1*o-this.sinb1*l*i):t=(h=Math.sqrt(2/(1+l*i)))*o*this.ymf,e=this.xmf*h*l*n;break;case this.N_POLE:case this.S_POLE:a>=0?(e=(h=Math.sqrt(a))*n,t=i*(this.mode===this.S_POLE?h:-h)):e=t=0;break}}return r.x=this.a*e+this.x0,r.y=this.a*t+this.y0,r}function XR(r){r.x-=this.x0,r.y-=this.y0;var e=r.x/this.a,t=r.y/this.a,i,n,s,a,o,l,h;if(this.sphere){var c=0,u,d=0;if(u=Math.sqrt(e*e+t*t),n=u*.5,n>1)return null;switch(n=2*Math.asin(n),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(d=Math.sin(n),c=Math.cos(n)),this.mode){case this.EQUIT:n=Math.abs(u)<=Z?0:Math.asin(t*d/u),e*=d,t=c*u;break;case this.OBLIQ:n=Math.abs(u)<=Z?this.lat0:Math.asin(c*this.sinph0+t*d*this.cosph0/u),e*=d*this.cosph0,t=(c-Math.sin(n)*this.sinph0)*u;break;case this.N_POLE:t=-t,n=z-n;break;case this.S_POLE:n-=z;break}i=t===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(e,t)}else{if(h=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e/=this.dd,t*=this.dd,l=Math.sqrt(e*e+t*t),l<Z)return r.x=this.long0,r.y=this.lat0,r;a=2*Math.asin(.5*l/this.rq),s=Math.cos(a),e*=a=Math.sin(a),this.mode===this.OBLIQ?(h=s*this.sinb1+t*a*this.cosb1/l,o=this.qp*h,t=l*this.cosb1*s-t*this.sinb1*a):(h=t*a/l,o=this.qp*h,t=l*s)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(t=-t),o=e*e+t*t,!o)return r.x=this.long0,r.y=this.lat0,r;h=1-o/this.qp,this.mode===this.S_POLE&&(h=-h)}i=Math.atan2(e,t),n=eb(Math.asin(h),this.apa)}return r.x=q(this.long0+i),r.y=n,r}var HR=.3333333333333333,WR=.17222222222222222,VR=.10257936507936508,YR=.06388888888888888,KR=.0664021164021164,QR=.016415012942191543;function JR(r){var e,t=[];return t[0]=r*HR,e=r*r,t[0]+=e*WR,t[1]=e*YR,e*=r,t[0]+=e*VR,t[1]+=e*KR,t[2]=e*QR,t}function eb(r,e){var t=r+r;return r+e[0]*Math.sin(t)+e[1]*Math.sin(t+t)+e[2]*Math.sin(t+t+t)}var tb=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const rb={init:ZR,forward:qR,inverse:XR,names:tb,S_POLE:zR,N_POLE:kR,EQUIT:$R,OBLIQ:jR};function xr(r){return Math.abs(r)>1&&(r=r>1?1:-1),Math.asin(r)}function ib(){Math.abs(this.lat1+this.lat2)<Z||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Kt(this.e3,this.sin_po,this.cos_po),this.qs1=gr(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Kt(this.e3,this.sin_po,this.cos_po),this.qs2=gr(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=gr(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>Z?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function nb(r){var e=r.x,t=r.y;this.sin_phi=Math.sin(t),this.cos_phi=Math.cos(t);var i=gr(this.e3,this.sin_phi),n=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,s=this.ns0*q(e-this.long0),a=n*Math.sin(s)+this.x0,o=this.rh-n*Math.cos(s)+this.y0;return r.x=a,r.y=o,r}function sb(r){var e,t,i,n,s,a;return r.x-=this.x0,r.y=this.rh-r.y+this.y0,this.ns0>=0?(e=Math.sqrt(r.x*r.x+r.y*r.y),i=1):(e=-Math.sqrt(r.x*r.x+r.y*r.y),i=-1),n=0,e!==0&&(n=Math.atan2(i*r.x,i*r.y)),i=e*this.ns0/this.a,this.sphere?a=Math.asin((this.c-i*i)/(2*this.ns0)):(t=(this.c-i*i)/this.ns0,a=this.phi1z(this.e3,t)),s=q(n/this.ns0+this.long0),r.x=s,r.y=a,r}function ab(r,e){var t,i,n,s,a,o=xr(.5*e);if(r<Z)return o;for(var l=r*r,h=1;h<=25;h++)if(t=Math.sin(o),i=Math.cos(o),n=r*t,s=1-n*n,a=.5*s*s/i*(e/(1-l)-t/s+.5/r*Math.log((1-n)/(1+n))),o=o+a,Math.abs(a)<=1e-7)return o;return null}var ob=["Albers_Conic_Equal_Area","Albers","aea"];const lb={init:ib,forward:nb,inverse:sb,names:ob,phi1z:ab};function hb(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function ub(r){var e,t,i,n,s,a,o,l,h=r.x,c=r.y;return i=q(h-this.long0),e=Math.sin(c),t=Math.cos(c),n=Math.cos(i),a=this.sin_p14*e+this.cos_p14*t*n,s=1,a>0||Math.abs(a)<=Z?(o=this.x0+this.a*s*t*Math.sin(i)/a,l=this.y0+this.a*s*(this.cos_p14*e-this.sin_p14*t*n)/a):(o=this.x0+this.infinity_dist*t*Math.sin(i),l=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*t*n)),r.x=o,r.y=l,r}function cb(r){var e,t,i,n,s,a;return r.x=(r.x-this.x0)/this.a,r.y=(r.y-this.y0)/this.a,r.x/=this.k0,r.y/=this.k0,(e=Math.sqrt(r.x*r.x+r.y*r.y))?(n=Math.atan2(e,this.rc),t=Math.sin(n),i=Math.cos(n),a=xr(i*this.sin_p14+r.y*t*this.cos_p14/e),s=Math.atan2(r.x*t,e*this.cos_p14*i-r.y*this.sin_p14*t),s=q(this.long0+s)):(a=this.phic0,s=0),r.x=s,r.y=a,r}var fb=["gnom"];const db={init:hb,forward:ub,inverse:cb,names:fb};function gb(r,e){var t=1-(1-r*r)/(2*r)*Math.log((1-r)/(1+r));if(Math.abs(Math.abs(e)-t)<1e-6)return e<0?-1*z:z;for(var i=Math.asin(.5*e),n,s,a,o,l=0;l<30;l++)if(s=Math.sin(i),a=Math.cos(i),o=r*s,n=Math.pow(1-o*o,2)/(2*a)*(e/(1-r*r)-s/(1-o*o)+.5/r*Math.log((1-o)/(1+o))),i+=n,Math.abs(n)<=1e-10)return i;return NaN}function mb(){this.sphere||(this.k0=Kt(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function pb(r){var e=r.x,t=r.y,i,n,s=q(e-this.long0);if(this.sphere)i=this.x0+this.a*s*Math.cos(this.lat_ts),n=this.y0+this.a*Math.sin(t)/Math.cos(this.lat_ts);else{var a=gr(this.e,Math.sin(t));i=this.x0+this.a*this.k0*s,n=this.y0+this.a*a*.5/this.k0}return r.x=i,r.y=n,r}function yb(r){r.x-=this.x0,r.y-=this.y0;var e,t;return this.sphere?(e=q(this.long0+r.x/this.a/Math.cos(this.lat_ts)),t=Math.asin(r.y/this.a*Math.cos(this.lat_ts))):(t=gb(this.e,2*r.y*this.k0/this.a),e=q(this.long0+r.x/(this.a*this.k0))),r.x=e,r.y=t,r}var _b=["cea"];const xb={init:mb,forward:pb,inverse:yb,names:_b};function vb(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function Eb(r){var e=r.x,t=r.y,i=q(e-this.long0),n=bi(t-this.lat0);return r.x=this.x0+this.a*i*this.rc,r.y=this.y0+this.a*n,r}function wb(r){var e=r.x,t=r.y;return r.x=q(this.long0+(e-this.x0)/(this.a*this.rc)),r.y=bi(this.lat0+(t-this.y0)/this.a),r}var Sb=["Equirectangular","Equidistant_Cylindrical","eqc"];const Tb={init:vb,forward:Eb,inverse:wb,names:Sb};var Zh=20;function Mb(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=fn(this.es),this.e1=dn(this.es),this.e2=gn(this.es),this.e3=mn(this.es),this.ml0=this.a*tt(this.e0,this.e1,this.e2,this.e3,this.lat0)}function Rb(r){var e=r.x,t=r.y,i,n,s,a=q(e-this.long0);if(s=a*Math.sin(t),this.sphere)Math.abs(t)<=Z?(i=this.a*a,n=-1*this.a*this.lat0):(i=this.a*Math.sin(s)/Math.tan(t),n=this.a*(bi(t-this.lat0)+(1-Math.cos(s))/Math.tan(t)));else if(Math.abs(t)<=Z)i=this.a*a,n=-1*this.ml0;else{var o=pi(this.a,this.e,Math.sin(t))/Math.tan(t);i=o*Math.sin(s),n=this.a*tt(this.e0,this.e1,this.e2,this.e3,t)-this.ml0+o*(1-Math.cos(s))}return r.x=i+this.x0,r.y=n+this.y0,r}function bb(r){var e,t,i,n,s,a,o,l,h;if(i=r.x-this.x0,n=r.y-this.y0,this.sphere)if(Math.abs(n+this.a*this.lat0)<=Z)e=q(i/this.a+this.long0),t=0;else{a=this.lat0+n/this.a,o=i*i/this.a/this.a+a*a,l=a;var c;for(s=Zh;s;--s)if(c=Math.tan(l),h=-1*(a*(l*c+1)-l-.5*(l*l+o)*c)/((l-a)/c-1),l+=h,Math.abs(h)<=Z){t=l;break}e=q(this.long0+Math.asin(i*Math.tan(l)/this.a)/Math.sin(t))}else if(Math.abs(n+this.ml0)<=Z)t=0,e=q(this.long0+i/this.a);else{a=(this.ml0+n)/this.a,o=i*i/this.a/this.a+a*a,l=a;var u,d,m,g,y;for(s=Zh;s;--s)if(y=this.e*Math.sin(l),u=Math.sqrt(1-y*y)*Math.tan(l),d=this.a*tt(this.e0,this.e1,this.e2,this.e3,l),m=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),g=d/this.a,h=(a*(u*g+1)-g-.5*u*(g*g+o))/(this.es*Math.sin(2*l)*(g*g+o-2*a*g)/(4*u)+(a-g)*(u*m-2/Math.sin(2*l))-m),l-=h,Math.abs(h)<=Z){t=l;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(t),2))*Math.tan(t),e=q(this.long0+Math.asin(i*u/this.a)/Math.sin(t))}return r.x=e,r.y=t,r}var Pb=["Polyconic","poly"];const Ab={init:Mb,forward:Rb,inverse:bb,names:Pb};function Ib(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function Lb(r){var e,t=r.x,i=r.y,n=i-this.lat0,s=t-this.long0,a=n/Hi*1e-5,o=s,l=1,h=0;for(e=1;e<=10;e++)l=l*a,h=h+this.A[e]*l;var c=h,u=o,d=1,m=0,g,y,_=0,v=0;for(e=1;e<=6;e++)g=d*c-m*u,y=m*c+d*u,d=g,m=y,_=_+this.B_re[e]*d-this.B_im[e]*m,v=v+this.B_im[e]*d+this.B_re[e]*m;return r.x=v*this.a+this.x0,r.y=_*this.a+this.y0,r}function Cb(r){var e,t=r.x,i=r.y,n=t-this.x0,s=i-this.y0,a=s/this.a,o=n/this.a,l=1,h=0,c,u,d=0,m=0;for(e=1;e<=6;e++)c=l*a-h*o,u=h*a+l*o,l=c,h=u,d=d+this.C_re[e]*l-this.C_im[e]*h,m=m+this.C_im[e]*l+this.C_re[e]*h;for(var g=0;g<this.iterations;g++){var y=d,_=m,v,E,S=a,w=o;for(e=2;e<=6;e++)v=y*d-_*m,E=_*d+y*m,y=v,_=E,S=S+(e-1)*(this.B_re[e]*y-this.B_im[e]*_),w=w+(e-1)*(this.B_im[e]*y+this.B_re[e]*_);y=1,_=0;var P=this.B_re[1],A=this.B_im[1];for(e=2;e<=6;e++)v=y*d-_*m,E=_*d+y*m,y=v,_=E,P=P+e*(this.B_re[e]*y-this.B_im[e]*_),A=A+e*(this.B_im[e]*y+this.B_re[e]*_);var I=P*P+A*A;d=(S*P+w*A)/I,m=(w*P-S*A)/I}var C=d,k=m,B=1,H=0;for(e=1;e<=9;e++)B=B*C,H=H+this.D[e]*B;var Y=this.lat0+H*Hi*1e5,f=this.long0+k;return r.x=f,r.y=Y,r}var Ob=["New_Zealand_Map_Grid","nzmg"];const Nb={init:Ib,forward:Lb,inverse:Cb,names:Ob};function Fb(){}function Db(r){var e=r.x,t=r.y,i=q(e-this.long0),n=this.x0+this.a*i,s=this.y0+this.a*Math.log(Math.tan(Math.PI/4+t/2.5))*1.25;return r.x=n,r.y=s,r}function Gb(r){r.x-=this.x0,r.y-=this.y0;var e=q(this.long0+r.x/this.a),t=2.5*(Math.atan(Math.exp(.8*r.y/this.a))-Math.PI/4);return r.x=e,r.y=t,r}var Ub=["Miller_Cylindrical","mill"];const Bb={init:Fb,forward:Db,inverse:Gb,names:Ub};var zb=20;function kb(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=id(this.es)}function $b(r){var e,t,i=r.x,n=r.y;if(i=q(i-this.long0),this.sphere){if(!this.m)n=this.n!==1?Math.asin(this.n*Math.sin(n)):n;else for(var s=this.n*Math.sin(n),a=zb;a;--a){var o=(this.m*n+Math.sin(n)-s)/(this.m+Math.cos(n));if(n-=o,Math.abs(o)<Z)break}e=this.a*this.C_x*i*(this.m+Math.cos(n)),t=this.a*this.C_y*n}else{var l=Math.sin(n),h=Math.cos(n);t=this.a*As(n,l,h,this.en),e=this.a*i*h/Math.sqrt(1-this.es*l*l)}return r.x=e,r.y=t,r}function jb(r){var e,t,i,n;return r.x-=this.x0,i=r.x/this.a,r.y-=this.y0,e=r.y/this.a,this.sphere?(e/=this.C_y,i=i/(this.C_x*(this.m+Math.cos(e))),this.m?e=xr((this.m*e+Math.sin(e))/this.n):this.n!==1&&(e=xr(Math.sin(e)/this.n)),i=q(i+this.long0),e=bi(e)):(e=nd(r.y/this.a,this.es,this.en),n=Math.abs(e),n<z?(n=Math.sin(e),t=this.long0+r.x*Math.sqrt(1-this.es*n*n)/(this.a*Math.cos(e)),i=q(t)):n-Z<z&&(i=this.long0)),r.x=i,r.y=e,r}var Zb=["Sinusoidal","sinu"];const qb={init:kb,forward:$b,inverse:jb,names:Zb};function Xb(){}function Hb(r){for(var e=r.x,t=r.y,i=q(e-this.long0),n=t,s=Math.PI*Math.sin(t);;){var a=-(n+Math.sin(n)-s)/(1+Math.cos(n));if(n+=a,Math.abs(a)<Z)break}n/=2,Math.PI/2-Math.abs(t)<Z&&(i=0);var o=.900316316158*this.a*i*Math.cos(n)+this.x0,l=1.4142135623731*this.a*Math.sin(n)+this.y0;return r.x=o,r.y=l,r}function Wb(r){var e,t;r.x-=this.x0,r.y-=this.y0,t=r.y/(1.4142135623731*this.a),Math.abs(t)>.999999999999&&(t=.999999999999),e=Math.asin(t);var i=q(this.long0+r.x/(.900316316158*this.a*Math.cos(e)));i<-Math.PI&&(i=-Math.PI),i>Math.PI&&(i=Math.PI),t=(2*e+Math.sin(2*e))/Math.PI,Math.abs(t)>1&&(t=1);var n=Math.asin(t);return r.x=i,r.y=n,r}var Vb=["Mollweide","moll"];const Yb={init:Xb,forward:Hb,inverse:Wb,names:Vb};function Kb(){Math.abs(this.lat1+this.lat2)<Z||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=fn(this.es),this.e1=dn(this.es),this.e2=gn(this.es),this.e3=mn(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Kt(this.e,this.sinphi,this.cosphi),this.ml1=tt(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<Z?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Kt(this.e,this.sinphi,this.cosphi),this.ml2=tt(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=tt(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function Qb(r){var e=r.x,t=r.y,i;if(this.sphere)i=this.a*(this.g-t);else{var n=tt(this.e0,this.e1,this.e2,this.e3,t);i=this.a*(this.g-n)}var s=this.ns*q(e-this.long0),a=this.x0+i*Math.sin(s),o=this.y0+this.rh-i*Math.cos(s);return r.x=a,r.y=o,r}function Jb(r){r.x-=this.x0,r.y=this.rh-r.y+this.y0;var e,t,i,n;this.ns>=0?(t=Math.sqrt(r.x*r.x+r.y*r.y),e=1):(t=-Math.sqrt(r.x*r.x+r.y*r.y),e=-1);var s=0;if(t!==0&&(s=Math.atan2(e*r.x,e*r.y)),this.sphere)return n=q(this.long0+s/this.ns),i=bi(this.g-t/this.a),r.x=n,r.y=i,r;var a=this.g-t/this.a;return i=ss(a,this.e0,this.e1,this.e2,this.e3),n=q(this.long0+s/this.ns),r.x=n,r.y=i,r}var e2=["Equidistant_Conic","eqdc"];const t2={init:Kb,forward:Qb,inverse:Jb,names:e2};function r2(){this.R=this.a}function i2(r){var e=r.x,t=r.y,i=q(e-this.long0),n,s;Math.abs(t)<=Z&&(n=this.x0+this.R*i,s=this.y0);var a=xr(2*Math.abs(t/Math.PI));(Math.abs(i)<=Z||Math.abs(Math.abs(t)-z)<=Z)&&(n=this.x0,t>=0?s=this.y0+Math.PI*this.R*Math.tan(.5*a):s=this.y0+Math.PI*this.R*-Math.tan(.5*a));var o=.5*Math.abs(Math.PI/i-i/Math.PI),l=o*o,h=Math.sin(a),c=Math.cos(a),u=c/(h+c-1),d=u*u,m=u*(2/h-1),g=m*m,y=Math.PI*this.R*(o*(u-g)+Math.sqrt(l*(u-g)*(u-g)-(g+l)*(d-g)))/(g+l);i<0&&(y=-y),n=this.x0+y;var _=l+u;return y=Math.PI*this.R*(m*_-o*Math.sqrt((g+l)*(l+1)-_*_))/(g+l),t>=0?s=this.y0+y:s=this.y0-y,r.x=n,r.y=s,r}function n2(r){var e,t,i,n,s,a,o,l,h,c,u,d,m;return r.x-=this.x0,r.y-=this.y0,u=Math.PI*this.R,i=r.x/u,n=r.y/u,s=i*i+n*n,a=-Math.abs(n)*(1+s),o=a-2*n*n+i*i,l=-2*a+1+2*n*n+s*s,m=n*n/l+(2*o*o*o/l/l/l-9*a*o/l/l)/27,h=(a-o*o/3/l)/l,c=2*Math.sqrt(-h/3),u=3*m/h/c,Math.abs(u)>1&&(u>=0?u=1:u=-1),d=Math.acos(u)/3,r.y>=0?t=(-c*Math.cos(d+Math.PI/3)-o/3/l)*Math.PI:t=-(-c*Math.cos(d+Math.PI/3)-o/3/l)*Math.PI,Math.abs(i)<Z?e=this.long0:e=q(this.long0+Math.PI*(s-1+Math.sqrt(1+2*(i*i-n*n)+s*s))/2/i),r.x=e,r.y=t,r}var s2=["Van_der_Grinten_I","VanDerGrinten","vandg"];const a2={init:r2,forward:i2,inverse:n2,names:s2};function o2(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function l2(r){var e=r.x,t=r.y,i=Math.sin(r.y),n=Math.cos(r.y),s=q(e-this.long0),a,o,l,h,c,u,d,m,g,y,_,v,E,S,w,P,A,I,C,k,B,H,Y;return this.sphere?Math.abs(this.sin_p12-1)<=Z?(r.x=this.x0+this.a*(z-t)*Math.sin(s),r.y=this.y0-this.a*(z-t)*Math.cos(s),r):Math.abs(this.sin_p12+1)<=Z?(r.x=this.x0+this.a*(z+t)*Math.sin(s),r.y=this.y0+this.a*(z+t)*Math.cos(s),r):(I=this.sin_p12*i+this.cos_p12*n*Math.cos(s),P=Math.acos(I),A=P?P/Math.sin(P):1,r.x=this.x0+this.a*A*n*Math.sin(s),r.y=this.y0+this.a*A*(this.cos_p12*i-this.sin_p12*n*Math.cos(s)),r):(a=fn(this.es),o=dn(this.es),l=gn(this.es),h=mn(this.es),Math.abs(this.sin_p12-1)<=Z?(c=this.a*tt(a,o,l,h,z),u=this.a*tt(a,o,l,h,t),r.x=this.x0+(c-u)*Math.sin(s),r.y=this.y0-(c-u)*Math.cos(s),r):Math.abs(this.sin_p12+1)<=Z?(c=this.a*tt(a,o,l,h,z),u=this.a*tt(a,o,l,h,t),r.x=this.x0+(c+u)*Math.sin(s),r.y=this.y0+(c+u)*Math.cos(s),r):(d=i/n,m=pi(this.a,this.e,this.sin_p12),g=pi(this.a,this.e,i),y=Math.atan((1-this.es)*d+this.es*m*this.sin_p12/(g*n)),_=Math.atan2(Math.sin(s),this.cos_p12*Math.tan(y)-this.sin_p12*Math.cos(s)),_===0?C=Math.asin(this.cos_p12*Math.sin(y)-this.sin_p12*Math.cos(y)):Math.abs(Math.abs(_)-Math.PI)<=Z?C=-Math.asin(this.cos_p12*Math.sin(y)-this.sin_p12*Math.cos(y)):C=Math.asin(Math.sin(s)*Math.cos(y)/Math.sin(_)),v=this.e*this.sin_p12/Math.sqrt(1-this.es),E=this.e*this.cos_p12*Math.cos(_)/Math.sqrt(1-this.es),S=v*E,w=E*E,k=C*C,B=k*C,H=B*C,Y=H*C,P=m*C*(1-k*w*(1-w)/6+B/8*S*(1-2*w)+H/120*(w*(4-7*w)-3*v*v*(1-7*w))-Y/48*S),r.x=this.x0+P*Math.sin(_),r.y=this.y0+P*Math.cos(_),r))}function h2(r){r.x-=this.x0,r.y-=this.y0;var e,t,i,n,s,a,o,l,h,c,u,d,m,g,y,_,v,E,S,w,P,A,I,C;return this.sphere?(e=Math.sqrt(r.x*r.x+r.y*r.y),e>2*z*this.a?void 0:(t=e/this.a,i=Math.sin(t),n=Math.cos(t),s=this.long0,Math.abs(e)<=Z?a=this.lat0:(a=xr(n*this.sin_p12+r.y*i*this.cos_p12/e),o=Math.abs(this.lat0)-z,Math.abs(o)<=Z?this.lat0>=0?s=q(this.long0+Math.atan2(r.x,-r.y)):s=q(this.long0-Math.atan2(-r.x,r.y)):s=q(this.long0+Math.atan2(r.x*i,e*this.cos_p12*n-r.y*this.sin_p12*i))),r.x=s,r.y=a,r)):(l=fn(this.es),h=dn(this.es),c=gn(this.es),u=mn(this.es),Math.abs(this.sin_p12-1)<=Z?(d=this.a*tt(l,h,c,u,z),e=Math.sqrt(r.x*r.x+r.y*r.y),m=d-e,a=ss(m/this.a,l,h,c,u),s=q(this.long0+Math.atan2(r.x,-1*r.y)),r.x=s,r.y=a,r):Math.abs(this.sin_p12+1)<=Z?(d=this.a*tt(l,h,c,u,z),e=Math.sqrt(r.x*r.x+r.y*r.y),m=e-d,a=ss(m/this.a,l,h,c,u),s=q(this.long0+Math.atan2(r.x,r.y)),r.x=s,r.y=a,r):(e=Math.sqrt(r.x*r.x+r.y*r.y),_=Math.atan2(r.x,r.y),g=pi(this.a,this.e,this.sin_p12),v=Math.cos(_),E=this.e*this.cos_p12*v,S=-E*E/(1-this.es),w=3*this.es*(1-S)*this.sin_p12*this.cos_p12*v/(1-this.es),P=e/g,A=P-S*(1+S)*Math.pow(P,3)/6-w*(1+3*S)*Math.pow(P,4)/24,I=1-S*A*A/2-P*A*A*A/6,y=Math.asin(this.sin_p12*Math.cos(A)+this.cos_p12*Math.sin(A)*v),s=q(this.long0+Math.asin(Math.sin(_)*Math.sin(A)/Math.cos(y))),C=Math.sin(y),a=Math.atan2((C-this.es*I*this.sin_p12)*Math.tan(y),C*(1-this.es)),r.x=s,r.y=a,r))}var u2=["Azimuthal_Equidistant","aeqd"];const c2={init:o2,forward:l2,inverse:h2,names:u2};function f2(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function d2(r){var e,t,i,n,s,a,o,l,h=r.x,c=r.y;return i=q(h-this.long0),e=Math.sin(c),t=Math.cos(c),n=Math.cos(i),a=this.sin_p14*e+this.cos_p14*t*n,s=1,(a>0||Math.abs(a)<=Z)&&(o=this.a*s*t*Math.sin(i),l=this.y0+this.a*s*(this.cos_p14*e-this.sin_p14*t*n)),r.x=o,r.y=l,r}function g2(r){var e,t,i,n,s,a,o;return r.x-=this.x0,r.y-=this.y0,e=Math.sqrt(r.x*r.x+r.y*r.y),t=xr(e/this.a),i=Math.sin(t),n=Math.cos(t),a=this.long0,Math.abs(e)<=Z?(o=this.lat0,r.x=a,r.y=o,r):(o=xr(n*this.sin_p14+r.y*i*this.cos_p14/e),s=Math.abs(this.lat0)-z,Math.abs(s)<=Z?(this.lat0>=0?a=q(this.long0+Math.atan2(r.x,-r.y)):a=q(this.long0-Math.atan2(-r.x,r.y)),r.x=a,r.y=o,r):(a=q(this.long0+Math.atan2(r.x*i,e*this.cos_p14*n-r.y*this.sin_p14*i)),r.x=a,r.y=o,r))}var m2=["ortho"];const p2={init:f2,forward:d2,inverse:g2,names:m2};var Ce={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},Re={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function y2(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=z-Me/2?this.face=Ce.TOP:this.lat0<=-(z-Me/2)?this.face=Ce.BOTTOM:Math.abs(this.long0)<=Me?this.face=Ce.FRONT:Math.abs(this.long0)<=z+Me?this.face=this.long0>0?Ce.RIGHT:Ce.LEFT:this.face=Ce.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function _2(r){var e={x:0,y:0},t,i,n,s,a,o,l={value:0};if(r.x-=this.long0,this.es!==0?t=Math.atan(this.one_minus_f_squared*Math.tan(r.y)):t=r.y,i=r.x,this.face===Ce.TOP)s=z-t,i>=Me&&i<=z+Me?(l.value=Re.AREA_0,n=i-z):i>z+Me||i<=-(z+Me)?(l.value=Re.AREA_1,n=i>0?i-Ge:i+Ge):i>-(z+Me)&&i<=-Me?(l.value=Re.AREA_2,n=i+z):(l.value=Re.AREA_3,n=i);else if(this.face===Ce.BOTTOM)s=z+t,i>=Me&&i<=z+Me?(l.value=Re.AREA_0,n=-i+z):i<Me&&i>=-Me?(l.value=Re.AREA_1,n=-i):i<-Me&&i>=-(z+Me)?(l.value=Re.AREA_2,n=-i-z):(l.value=Re.AREA_3,n=i>0?-i+Ge:-i-Ge);else{var h,c,u,d,m,g,y;this.face===Ce.RIGHT?i=oi(i,+z):this.face===Ce.BACK?i=oi(i,+Ge):this.face===Ce.LEFT&&(i=oi(i,-z)),d=Math.sin(t),m=Math.cos(t),g=Math.sin(i),y=Math.cos(i),h=m*y,c=m*g,u=d,this.face===Ce.FRONT?(s=Math.acos(h),n=Rn(s,u,c,l)):this.face===Ce.RIGHT?(s=Math.acos(c),n=Rn(s,u,-h,l)):this.face===Ce.BACK?(s=Math.acos(-h),n=Rn(s,u,-c,l)):this.face===Ce.LEFT?(s=Math.acos(-c),n=Rn(s,u,h,l)):(s=n=0,l.value=Re.AREA_0)}return o=Math.atan(12/Ge*(n+Math.acos(Math.sin(n)*Math.cos(Me))-z)),a=Math.sqrt((1-Math.cos(s))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(n))))),l.value===Re.AREA_1?o+=z:l.value===Re.AREA_2?o+=Ge:l.value===Re.AREA_3&&(o+=1.5*Ge),e.x=a*Math.cos(o),e.y=a*Math.sin(o),e.x=e.x*this.a+this.x0,e.y=e.y*this.a+this.y0,r.x=e.x,r.y=e.y,r}function x2(r){var e={lam:0,phi:0},t,i,n,s,a,o,l,h,c,u={value:0};if(r.x=(r.x-this.x0)/this.a,r.y=(r.y-this.y0)/this.a,i=Math.atan(Math.sqrt(r.x*r.x+r.y*r.y)),t=Math.atan2(r.y,r.x),r.x>=0&&r.x>=Math.abs(r.y)?u.value=Re.AREA_0:r.y>=0&&r.y>=Math.abs(r.x)?(u.value=Re.AREA_1,t-=z):r.x<0&&-r.x>=Math.abs(r.y)?(u.value=Re.AREA_2,t=t<0?t+Ge:t-Ge):(u.value=Re.AREA_3,t+=z),c=Ge/12*Math.tan(t),a=Math.sin(c)/(Math.cos(c)-1/Math.sqrt(2)),o=Math.atan(a),n=Math.cos(t),s=Math.tan(i),l=1-n*n*s*s*(1-Math.cos(Math.atan(1/Math.cos(o)))),l<-1?l=-1:l>1&&(l=1),this.face===Ce.TOP)h=Math.acos(l),e.phi=z-h,u.value===Re.AREA_0?e.lam=o+z:u.value===Re.AREA_1?e.lam=o<0?o+Ge:o-Ge:u.value===Re.AREA_2?e.lam=o-z:e.lam=o;else if(this.face===Ce.BOTTOM)h=Math.acos(l),e.phi=h-z,u.value===Re.AREA_0?e.lam=-o+z:u.value===Re.AREA_1?e.lam=-o:u.value===Re.AREA_2?e.lam=-o-z:e.lam=o<0?-o-Ge:-o+Ge;else{var d,m,g;d=l,c=d*d,c>=1?g=0:g=Math.sqrt(1-c)*Math.sin(o),c+=g*g,c>=1?m=0:m=Math.sqrt(1-c),u.value===Re.AREA_1?(c=m,m=-g,g=c):u.value===Re.AREA_2?(m=-m,g=-g):u.value===Re.AREA_3&&(c=m,m=g,g=-c),this.face===Ce.RIGHT?(c=d,d=-m,m=c):this.face===Ce.BACK?(d=-d,m=-m):this.face===Ce.LEFT&&(c=d,d=m,m=-c),e.phi=Math.acos(-g)-z,e.lam=Math.atan2(m,d),this.face===Ce.RIGHT?e.lam=oi(e.lam,-z):this.face===Ce.BACK?e.lam=oi(e.lam,-Ge):this.face===Ce.LEFT&&(e.lam=oi(e.lam,+z))}if(this.es!==0){var y,_,v;y=e.phi<0?1:0,_=Math.tan(e.phi),v=this.b/Math.sqrt(_*_+this.one_minus_f_squared),e.phi=Math.atan(Math.sqrt(this.a*this.a-v*v)/(this.one_minus_f*v)),y&&(e.phi=-e.phi)}return e.lam+=this.long0,r.x=e.lam,r.y=e.phi,r}function Rn(r,e,t,i){var n;return r<Z?(i.value=Re.AREA_0,n=0):(n=Math.atan2(e,t),Math.abs(n)<=Me?i.value=Re.AREA_0:n>Me&&n<=z+Me?(i.value=Re.AREA_1,n-=z):n>z+Me||n<=-(z+Me)?(i.value=Re.AREA_2,n=n>=0?n-Ge:n+Ge):(i.value=Re.AREA_3,n+=z)),n}function oi(r,e){var t=r+e;return t<-Ge?t+=tn:t>+Ge&&(t-=tn),t}var v2=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const E2={init:y2,forward:_2,inverse:x2,names:v2};var Da=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],ki=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],od=.8487,ld=1.3523,hd=qt/5,w2=1/hd,ri=18,as=function(r,e){return r[0]+e*(r[1]+e*(r[2]+e*r[3]))},S2=function(r,e){return r[1]+e*(2*r[2]+e*3*r[3])};function T2(r,e,t,i){for(var n=e;i;--i){var s=r(n);if(n-=s,Math.abs(s)<t)break}return n}function M2(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function R2(r){var e=q(r.x-this.long0),t=Math.abs(r.y),i=Math.floor(t*hd);i<0?i=0:i>=ri&&(i=ri-1),t=qt*(t-w2*i);var n={x:as(Da[i],t)*e,y:as(ki[i],t)};return r.y<0&&(n.y=-n.y),n.x=n.x*this.a*od+this.x0,n.y=n.y*this.a*ld+this.y0,n}function b2(r){var e={x:(r.x-this.x0)/(this.a*od),y:Math.abs(r.y-this.y0)/(this.a*ld)};if(e.y>=1)e.x/=Da[ri][0],e.y=r.y<0?-z:z;else{var t=Math.floor(e.y*ri);for(t<0?t=0:t>=ri&&(t=ri-1);;)if(ki[t][0]>e.y)--t;else if(ki[t+1][0]<=e.y)++t;else break;var i=ki[t],n=5*(e.y-i[0])/(ki[t+1][0]-i[0]);n=T2(function(s){return(as(i,s)-e.y)/S2(i,s)},n,Z,100),e.x/=as(Da[t],n),e.y=(5*t+n)*We,r.y<0&&(e.y=-e.y)}return e.x=q(e.x+this.long0),e}var P2=["Robinson","robin"];const A2={init:M2,forward:R2,inverse:b2,names:P2};function I2(){this.name="geocent"}function L2(r){var e=Wf(r,this.es,this.a);return e}function C2(r){var e=Vf(r,this.es,this.a,this.b);return e}var O2=["Geocentric","geocentric","geocent","Geocent"];const N2={init:I2,forward:L2,inverse:C2,names:O2};var Ke={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},Ci={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function F2(){if(Object.keys(Ci).forEach((function(t){if(typeof this[t]>"u")this[t]=Ci[t].def;else{if(Ci[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);Ci[t].num&&(this[t]=parseFloat(this[t]))}Ci[t].degrees&&(this[t]=this[t]*We)}).bind(this)),Math.abs(Math.abs(this.lat0)-z)<Z?this.mode=this.lat0<0?Ke.S_POLE:Ke.N_POLE:Math.abs(this.lat0)<Z?this.mode=Ke.EQUIT:(this.mode=Ke.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var r=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(r),this.sw=Math.sin(r)}function D2(r){r.x-=this.long0;var e=Math.sin(r.y),t=Math.cos(r.y),i=Math.cos(r.x),n,s;switch(this.mode){case Ke.OBLIQ:s=this.sinph0*e+this.cosph0*t*i;break;case Ke.EQUIT:s=t*i;break;case Ke.S_POLE:s=-e;break;case Ke.N_POLE:s=e;break}switch(s=this.pn1/(this.p-s),n=s*t*Math.sin(r.x),this.mode){case Ke.OBLIQ:s*=this.cosph0*e-this.sinph0*t*i;break;case Ke.EQUIT:s*=e;break;case Ke.N_POLE:s*=-(t*i);break;case Ke.S_POLE:s*=t*i;break}var a,o;return a=s*this.cg+n*this.sg,o=1/(a*this.sw*this.h1+this.cw),n=(n*this.cg-s*this.sg)*this.cw*o,s=a*o,r.x=n*this.a,r.y=s*this.a,r}function G2(r){r.x/=this.a,r.y/=this.a;var e={x:r.x,y:r.y},t,i,n;n=1/(this.pn1-r.y*this.sw),t=this.pn1*r.x*n,i=this.pn1*r.y*this.cw*n,r.x=t*this.cg+i*this.sg,r.y=i*this.cg-t*this.sg;var s=Rt(r.x,r.y);if(Math.abs(s)<Z)e.x=0,e.y=r.y;else{var a,o;switch(o=1-s*s*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/s+s/this.pn1),a=Math.sqrt(1-o*o),this.mode){case Ke.OBLIQ:e.y=Math.asin(a*this.sinph0+r.y*o*this.cosph0/s),r.y=(a-this.sinph0*Math.sin(e.y))*s,r.x*=o*this.cosph0;break;case Ke.EQUIT:e.y=Math.asin(r.y*o/s),r.y=a*s,r.x*=o;break;case Ke.N_POLE:e.y=Math.asin(a),r.y=-r.y;break;case Ke.S_POLE:e.y=-Math.asin(a);break}e.x=Math.atan2(r.x,r.y)}return r.x=e.x+this.long0,r.y=e.y,r}var U2=["Tilted_Perspective","tpers"];const B2={init:F2,forward:D2,inverse:G2,names:U2};function z2(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var r=1-this.es,e=1/r;this.radius_p=Math.sqrt(r),this.radius_p2=r,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function k2(r){var e=r.x,t=r.y,i,n,s,a;if(e=e-this.long0,this.shape==="ellipse"){t=Math.atan(this.radius_p2*Math.tan(t));var o=this.radius_p/Rt(this.radius_p*Math.cos(t),Math.sin(t));if(n=o*Math.cos(e)*Math.cos(t),s=o*Math.sin(e)*Math.cos(t),a=o*Math.sin(t),(this.radius_g-n)*n-s*s-a*a*this.radius_p_inv2<0)return r.x=Number.NaN,r.y=Number.NaN,r;i=this.radius_g-n,this.flip_axis?(r.x=this.radius_g_1*Math.atan(s/Rt(a,i)),r.y=this.radius_g_1*Math.atan(a/i)):(r.x=this.radius_g_1*Math.atan(s/i),r.y=this.radius_g_1*Math.atan(a/Rt(s,i)))}else this.shape==="sphere"&&(i=Math.cos(t),n=Math.cos(e)*i,s=Math.sin(e)*i,a=Math.sin(t),i=this.radius_g-n,this.flip_axis?(r.x=this.radius_g_1*Math.atan(s/Rt(a,i)),r.y=this.radius_g_1*Math.atan(a/i)):(r.x=this.radius_g_1*Math.atan(s/i),r.y=this.radius_g_1*Math.atan(a/Rt(s,i))));return r.x=r.x*this.a,r.y=r.y*this.a,r}function $2(r){var e=-1,t=0,i=0,n,s,a,o;if(r.x=r.x/this.a,r.y=r.y/this.a,this.shape==="ellipse"){this.flip_axis?(i=Math.tan(r.y/this.radius_g_1),t=Math.tan(r.x/this.radius_g_1)*Rt(1,i)):(t=Math.tan(r.x/this.radius_g_1),i=Math.tan(r.y/this.radius_g_1)*Rt(1,t));var l=i/this.radius_p;if(n=t*t+l*l+e*e,s=2*this.radius_g*e,a=s*s-4*n*this.C,a<0)return r.x=Number.NaN,r.y=Number.NaN,r;o=(-s-Math.sqrt(a))/(2*n),e=this.radius_g+o*e,t*=o,i*=o,r.x=Math.atan2(t,e),r.y=Math.atan(i*Math.cos(r.x)/e),r.y=Math.atan(this.radius_p_inv2*Math.tan(r.y))}else if(this.shape==="sphere"){if(this.flip_axis?(i=Math.tan(r.y/this.radius_g_1),t=Math.tan(r.x/this.radius_g_1)*Math.sqrt(1+i*i)):(t=Math.tan(r.x/this.radius_g_1),i=Math.tan(r.y/this.radius_g_1)*Math.sqrt(1+t*t)),n=t*t+i*i+e*e,s=2*this.radius_g*e,a=s*s-4*n*this.C,a<0)return r.x=Number.NaN,r.y=Number.NaN,r;o=(-s-Math.sqrt(a))/(2*n),e=this.radius_g+o*e,t*=o,i*=o,r.x=Math.atan2(t,e),r.y=Math.atan(i*Math.cos(r.x)/e)}return r.x=r.x+this.long0,r}var j2=["Geostationary Satellite View","Geostationary_Satellite","geos"];const Z2={init:z2,forward:k2,inverse:$2,names:j2};function q2(r){r.Proj.projections.add(On),r.Proj.projections.add(Nn),r.Proj.projections.add(KM),r.Proj.projections.add(oR),r.Proj.projections.add(dR),r.Proj.projections.add(_R),r.Proj.projections.add(TR),r.Proj.projections.add(AR),r.Proj.projections.add(NR),r.Proj.projections.add(BR),r.Proj.projections.add(rb),r.Proj.projections.add(lb),r.Proj.projections.add(db),r.Proj.projections.add(xb),r.Proj.projections.add(Tb),r.Proj.projections.add(Ab),r.Proj.projections.add(Nb),r.Proj.projections.add(Bb),r.Proj.projections.add(qb),r.Proj.projections.add(Yb),r.Proj.projections.add(t2),r.Proj.projections.add(a2),r.Proj.projections.add(c2),r.Proj.projections.add(p2),r.Proj.projections.add(E2),r.Proj.projections.add(A2),r.Proj.projections.add(N2),r.Proj.projections.add(B2),r.Proj.projections.add(Z2)}wt.defaultDatum="WGS84";wt.Proj=Vt;wt.WGS84=new wt.Proj("WGS84");wt.Point=mi;wt.toPoint=Yf;wt.defs=Je;wt.nadgrid=JT;wt.transform=ns;wt.mgrs=mM;wt.version="__VERSION__";q2(wt);zf(wt);window.eoxMapAdvancedOlLayers={...iv,STAC:rl};window.eoxMapAdvancedOlSources=Kw;export{lP as L,hP as a};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./raw-FjKAlyiw.js","./basedecoder-ZA-T3ZBw.js","./lzw-NamZKYVt.js","./jpeg-rjh0axXg.js","./deflate-EZWV29Lt.js","./pako.esm-1A7OWKUb.js","./packbits-65YHJGuf.js","./lerc-lFnQODj_.js","./_commonjsHelpers-4gQjN7DL.js","./main-Alx_PdZX.js","./lit-element-Qm8PRmVu.js","./state-ncEgtE_C.js","./index-EySAwWXj.js","./iframe-W89OKkhr.js","./webimage-NiQ987z3.js","./decoder-YCn7QQ1o.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
