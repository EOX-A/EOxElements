{"version":3,"file":"stories-9aea2a22.js","sources":["../../elements/drawtools/src/style.ts","../../elements/drawtools/src/style.eox.ts","../../elements/drawtools/src/main.ts","../../elements/drawtools/stories.js"],"sourcesContent":["export const style = `\n:host {\n  display: block;\n}\n`;\n","import { button } from \"../../../utils/styles/button\";\n\nexport const styleEOX = `\n* {\n  font-family: Roboto, sans-serif;\n}\n\n${button}\n\nbutton.discard {\n  background: var(--error-color);\n}\n\nbutton.polygon:before {\n  content: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 24 24'%3E%3Ctitle%3Eshape-polygon-plus%3C/title%3E%3Cpath d='M17,15.7V13H19V17L10,21L3,14L7,5H11V7H8.3L5.4,13.6L10.4,18.6L17,15.7M22,5V7H19V10H17V7H14V5H17V2H19V5H22Z' /%3E%3C/svg%3E\");\n}\n`;\n","import { LitElement, html, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators.js\";\nimport { EOxMap } from \"../../map/main\";\nimport { Map } from \"ol\";\nimport { Draw, Modify } from \"ol/interaction\";\nimport VectorLayer from \"ol/layer/Vector\";\nimport VectorSource from \"ol/source/Vector\";\nimport { style } from \"./style\";\nimport { styleEOX } from \"./style.eox\";\nimport Feature from \"ol/Feature.js\";\nimport { Geometry } from \"ol/geom\";\n\n@customElement(\"eox-drawtools\")\nexport class EOxDrawTools extends LitElement {\n  @state()\n  _layerId: string;\n\n  @state()\n  _eoxMap: EOxMap;\n\n  @state()\n  _olMap: Map;\n\n  @state()\n  _drawLayer: VectorLayer<VectorSource>;\n\n  @state()\n  _drawnFeatures: Array<Feature<Geometry>> = [];\n\n  @state()\n  _currentlyDrawing: boolean;\n\n  @property({ type: Boolean })\n  multipleFeatures: boolean;\n\n  /**\n   * The query selector for the map\n   */\n  @property()\n  for: string;\n\n  @property()\n  layer: string;\n\n  @property({ type: Boolean })\n  unstyled: boolean;\n\n  _draw: Draw;\n  _modify: Modify;\n\n  _startDrawing() {\n    this._eoxMap.addDraw(this._layerId, {\n      id: \"drawInteraction\",\n      type: \"Polygon\",\n    });\n    // @ts-ignore\n    this._draw = this._eoxMap.interactions[\"drawInteraction\"] as Draw;\n    // @ts-ignore\n    this._modify = this._eoxMap.interactions[\n      \"drawInteraction_modify\"\n    ] as Modify;\n    this._draw.on(\"drawend\", (evt) => this._onDrawEnd(evt));\n    this._modify.on(\"modifyend\", (evt) => this._onModifyEnd(evt));\n    this._currentlyDrawing = true;\n    this.requestUpdate();\n  }\n\n  _discardDrawing() {\n    this._drawnFeatures = [];\n    this._eoxMap.removeInteraction(\"drawInteraction\");\n    this._drawLayer.getSource().clear();\n    this._currentlyDrawing = false;\n    this.requestUpdate();\n  }\n\n  _onDrawEnd(evt: any) {\n    console.log(evt);\n    this._emitDrawnFeatures();\n    this._eoxMap.removeInteraction(\"drawInteraction\");\n    this._currentlyDrawing = false;\n    this.requestUpdate();\n  }\n\n  _onModifyEnd(evt: any) {\n    console.log(evt);\n    this._emitDrawnFeatures();\n  }\n\n  _emitDrawnFeatures() {\n    setTimeout(() => {\n      this._drawnFeatures = this._drawLayer.getSource().getFeatures();\n      this.requestUpdate();\n      const drawEvt = new CustomEvent(\"drawupdate\", {\n        detail: this._drawnFeatures,\n      });\n      this.dispatchEvent(drawEvt);\n    }, 0);\n  }\n\n  render() {\n    const mapQuery = document.querySelector(this.for as string);\n\n    // @ts-ignore\n    this._eoxMap = mapQuery;\n    // @ts-ignore\n    this._olMap = mapQuery.map;\n\n    this._layerId = this.layer;\n\n    this._drawLayer = this._olMap\n      .getLayers()\n      .getArray()\n      .find((l) => l.get(\"id\") === this._layerId) as VectorLayer<VectorSource>;\n    this.requestUpdate();\n\n    return html`\n      <style>\n        ${style}\n        ${!this.unstyled && styleEOX}\n      </style>\n      <div>\n        <slot></slot>\n        <button\n          data-cy=\"drawBtn\"\n          class=\"icon-text polygon\"\n          disabled=\"${(!this.multipleFeatures && this._drawnFeatures.length) ||\n          this._currentlyDrawing ||\n          nothing}\"\n          @click=\"${() => this._startDrawing()}\"\n        >\n          ${this._currentlyDrawing ? \"drawing\" : \"draw\"}\n        </button>\n        <button\n          data-cy=\"discardBtn\"\n          class=\"discard\"\n          disabled=\"${(!this._drawnFeatures.length &&\n            !this._currentlyDrawing) ||\n          nothing}\"\n          @click=\"${() => this._discardDrawing()}\"\n        >\n          discard\n        </button>\n      </div>\n    `;\n  }\n}\n","import { html } from \"lit\";\nimport \"../map/main\";\nimport \"./src/main\";\n\nexport default {\n  title: \"Elements/eox-drawtools\",\n  tags: [\"autodocs\"],\n  component: \"eox-drawtools\",\n};\n\nexport const Primary = {\n  render: () => html` <eox-map\n      id=\"primary\"\n      style=\"width: 400px; height: 300px;\"\n      layers='[\n    {\"type\": \"Vector\",\"id\": \"draw\",\"source\": {\"type\": \"Vector\"}},\n    {\"type\":\"Tile\",\"source\":{\"type\":\"OSM\"}}\n  ]'\n    ></eox-map>\n    <eox-drawtools for=\"eox-map#primary\" layer=\"draw\"></eox-drawtools>`,\n};\n\nexport const MultiPolygon = {\n  render: () => html` <eox-map\n      id=\"multi\"\n      style=\"width: 400px; height: 300px;\"\n      layers='[\n      {\"type\": \"Vector\",\"id\": \"draw\",\"source\": {\"type\": \"Vector\"}},\n      {\"type\":\"Tile\",\"source\":{\"type\":\"OSM\"}}\n    ]'\n    ></eox-map>\n    <eox-drawtools\n      for=\"eox-map#multi\"\n      layer=\"draw\"\n      multiplefeatures\n    ></eox-drawtools>`,\n};\n"],"names":["style","styleEOX","button","EOxDrawTools","LitElement","evt","drawEvt","mapQuery","l","html","nothing","__decorateClass","state","property","customElement","stories","Primary","MultiPolygon"],"mappings":"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"}