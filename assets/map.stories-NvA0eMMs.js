var fd=Object.defineProperty;var dd=(t,e,r)=>e in t?fd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Ms=(t,e,r)=>(dd(t,typeof e!="symbol"?e+"":e,r),r);import{x as Er}from"./lit-element-uhisBW42.js";import{J as gd,F as ut,g as de,i as pd,t as ze,d as md,l as yd,c as Ln,L as Hs,P as Et,a as Dt,M as ei,b as is,e as Ji,f as en,X as ns,m as H,h as K,p as k,j as Ta,k as Cn,n as _d,o as xd,q as Qt,s as On,u as mc,v as ie,w as P,x as le,y as Me,z as lt,O as ti,A as Kt,B as Bi,C as yc,D as q,E as Nn,H as Fn,I as b,K as U,N as ss,Q as Ce,R as We,S as Dn,U as _c,V as cr,W as vd,Y as Sa,Z as xc,_ as $t,$ as Gt,a0 as be,a1 as Ed,a2 as wd,a3 as rr,a4 as zo,a5 as Yt,a6 as qr,a7 as Ma,a8 as vc,a9 as Td,aa as Ec,ab as Sd,ac as wc,ad as Md,ae as bd,af as Gn,ag as Rd,ah as zi,ai as ba,aj as $o,ak as Di,al as jo,am as Ys,an as fr,ao as as,ap as Pd,aq as Ad,ar as Id,as as Ct,at as Un,au as Ra,av as Jt,aw as pi,ax as Xr,ay as ht,az as Ae,aA as $i,aB as Dr,aC as Ld,aD as De,aE as Tc,aF as wt,aG as Pa,aH as Cd,aI as Od,aJ as Sc,aK as bs,aL as Nd,aM as Aa,aN as Fd,aO as mi,aP as pn,aQ as kn,aR as Ia,aS as Mc,aT as ji,aU as bc,aV as Ks,aW as Rc,aX as Q,aY as Zt,aZ as qo,a_ as Rs,a$ as Dd,b0 as Zo,b1 as it,b2 as Gd,b3 as Ud,b4 as kd,b5 as Bd,b6 as La,b7 as Ot,b8 as Ca,b9 as Pr,ba as zd,bb as Qs,bc as Pc,bd as $d,be as Vo,bf as jd,bg as qd,bh as Ac,bi as qi,bj as Zd,bk as Vd,bl as Wd,bm as Js,bn as Xd,bo as me,bp as Mn,bq as Hr,br as ct,bs as mt,bt as Hd,bu as oe,bv as Yd,bw as Ic,bx as dr,by as Kd,bz as Qd,bA as Lc,bB as ir,bC as Jd,bD as eg,bE as tg,bF as Cc,bG as rg,G as Oc,bH as Oa,bI as Bn,bJ as Nc,bK as ar,bL as tn,bM as rn,bN as Fc,bO as Na,bP as Yr,bQ as ig,bR as ng,bS as sg,bT as os,bU as ag,bV as og,bW as lg,bX as zn,bY as hg,bZ as Ps,b_ as $n,b$ as ls,c0 as cg,c1 as ug,c2 as Wo,c3 as ea,c4 as ta,c5 as fg,c6 as dg,c7 as ri,c8 as Dc,c9 as Xo,ca as Gc,cb as Ho,cc as wr,cd as Fa,ce as hs,cf as gg,cg as Da,ch as Uc,ci as pg,cj as mg,ck as yg,cl as _g,cm as kc,cn as xg,co as vg,cp as Eg,cq as wg,cr as Bc,cs as Tg,ct as zc,cu as Sg,cv as Mg,cw as bg,cx as Rg,cy as Pg,cz as Yo,cA as Ag,cB as Ig}from"./main--0l0WmPb.js";import{g as cs,c as gr}from"./_commonjsHelpers-4gQjN7DL.js";import{_ as or}from"./iframe-FGYwQdyi.js";const Lg={Point:Fg,LineString:Dg,Polygon:Bg,MultiPoint:Ug,MultiLineString:Gg,MultiPolygon:kg},Cg={Point:zg,LineString:$g,Polygon:jg,MultiPoint:Zg,MultiLineString:qg,MultiPolygon:Vg};class Og extends gd{constructor(e){e=e||{},super(),this.geometryName_=e.geometryName}readFeatureFromObject(e,r,i){const n=e,s=Ko(n.geometry,r),a=new ut;if(this.geometryName_&&a.setGeometryName(this.geometryName_),a.setGeometry(s),n.attributes){a.setProperties(n.attributes,!0);const o=n.attributes[i];o!==void 0&&a.setId(o)}return a}readFeaturesFromObject(e,r){if(r=r||{},e.features){const i=e,n=[],s=i.features;for(let a=0,o=s.length;a<o;++a)n.push(this.readFeatureFromObject(s[a],r,e.objectIdFieldName));return n}return[this.readFeatureFromObject(e,r)]}readGeometryFromObject(e,r){return Ko(e,r)}readProjectionFromObject(e){if(e.spatialReference&&e.spatialReference.wkid!==void 0){const i=e.spatialReference.wkid;return de("EPSG:"+i)}return null}writeGeometryObject(e,r){return Qo(e,this.adaptOptions(r))}writeFeatureObject(e,r){r=this.adaptOptions(r);const i={};if(!e.hasProperties())return i.attributes={},i;const n=e.getProperties(),s=e.getGeometry();if(s){i.geometry=Qo(s,r);const a=r&&(r.dataProjection||r.featureProjection);a&&(i.geometry.spatialReference={wkid:Number(de(a).getCode().split(":").pop())}),delete n[e.getGeometryName()]}return pd(n)?i.attributes={}:i.attributes=n,i}writeFeaturesObject(e,r){r=this.adaptOptions(r);const i=[];for(let n=0,s=e.length;n<s;++n)i.push(this.writeFeatureObject(e[n],r));return{features:i}}}function Ko(t,e){if(!t)return null;let r;if(typeof t.x=="number"&&typeof t.y=="number")r="Point";else if(t.points)r="MultiPoint";else if(t.paths)t.paths.length===1?r="LineString":r="MultiLineString";else if(t.rings){const n=t,s=ii(n),a=Ng(n.rings,s);a.length===1?(r="Polygon",t=Object.assign({},t,{rings:a[0]})):(r="MultiPolygon",t=Object.assign({},t,{rings:a}))}const i=Lg[r];return ze(i(t),!1,e)}function Ng(t,e){const r=[],i=[],n=[];let s,a;for(s=0,a=t.length;s<a;++s)r.length=0,md(r,0,t[s],e.length),yd(r,0,r.length,e.length)?i.push([t[s]]):n.push(t[s]);for(;n.length;){const o=n.shift();let l=!1;for(s=i.length-1;s>=0;s--){const h=i[s][0];if(Ln(new Hs(h).getExtent(),new Hs(o).getExtent())){i[s].push(o),l=!0;break}}l||i.push([o.reverse()])}return i}function Fg(t){let e;return t.m!==void 0&&t.z!==void 0?e=new Et([t.x,t.y,t.z,t.m],"XYZM"):t.z!==void 0?e=new Et([t.x,t.y,t.z],"XYZ"):t.m!==void 0?e=new Et([t.x,t.y,t.m],"XYM"):e=new Et([t.x,t.y]),e}function Dg(t){const e=ii(t);return new Dt(t.paths[0],e)}function Gg(t){const e=ii(t);return new ei(t.paths,e)}function ii(t){let e="XY";return t.hasZ===!0&&t.hasM===!0?e="XYZM":t.hasZ===!0?e="XYZ":t.hasM===!0&&(e="XYM"),e}function Ug(t){const e=ii(t);return new is(t.points,e)}function kg(t){const e=ii(t);return new Ji(t.rings,e)}function Bg(t){const e=ii(t);return new en(t.rings,e)}function zg(t,e){const r=t.getCoordinates();let i;const n=t.getLayout();if(n==="XYZ")i={x:r[0],y:r[1],z:r[2]};else if(n==="XYM")i={x:r[0],y:r[1],m:r[2]};else if(n==="XYZM")i={x:r[0],y:r[1],z:r[2],m:r[3]};else if(n==="XY")i={x:r[0],y:r[1]};else throw new Error("Invalid geometry layout");return i}function nn(t){const e=t.getLayout();return{hasZ:e==="XYZ"||e==="XYZM",hasM:e==="XYM"||e==="XYZM"}}function $g(t,e){const r=nn(t);return{hasZ:r.hasZ,hasM:r.hasM,paths:[t.getCoordinates()]}}function jg(t,e){const r=nn(t);return{hasZ:r.hasZ,hasM:r.hasM,rings:t.getCoordinates(!1)}}function qg(t,e){const r=nn(t);return{hasZ:r.hasZ,hasM:r.hasM,paths:t.getCoordinates()}}function Zg(t,e){const r=nn(t);return{hasZ:r.hasZ,hasM:r.hasM,points:t.getCoordinates()}}function Vg(t,e){const r=nn(t),i=t.getCoordinates(!1),n=[];for(let s=0;s<i.length;s++)for(let a=i[s].length-1;a>=0;a--)n.push(i[s][a]);return{hasZ:r.hasZ,hasM:r.hasM,rings:n}}function Qo(t,e){const r=Cg[t.getType()];return r(ze(t,!0,e),e)}const Wg=Og,qt="http://www.opengis.net/gml",Xg=/^\s*$/;class Oe extends ns{constructor(e){super(),e=e||{},this.featureType=e.featureType,this.featureNS=e.featureNS,this.srsName=e.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:H(this.readFeaturesInternal),featureMembers:K(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(e,r){const i=e.localName;let n=null;if(i=="FeatureCollection")n=k([],this.FEATURE_COLLECTION_PARSERS,e,r,this);else if(i=="featureMembers"||i=="featureMember"||i=="member"){const s=r[0];let a=s.featureType,o=s.featureNS;const l="p",h="p0";if(!a&&e.childNodes){a=[],o={};for(let d=0,g=e.childNodes.length;d<g;++d){const p=e.childNodes[d];if(p.nodeType===1){const y=p.nodeName.split(":").pop();if(!a.includes(y)){let _="",v=0;const E=p.namespaceURI;for(const w in o){if(o[w]===E){_=w;break}++v}_||(_=l+v,o[_]=E),a.push(_+":"+y)}}}i!="featureMember"&&(s.featureType=a,s.featureNS=o)}if(typeof o=="string"){const d=o;o={},o[h]=d}const u={},c=Array.isArray(a)?a:[a];for(const d in o){const g={};for(let p=0,y=c.length;p<y;++p)(c[p].includes(":")?c[p].split(":")[0]:h)===d&&(g[c[p].split(":").pop()]=i=="featureMembers"?H(this.readFeatureElement,this):K(this.readFeatureElement,this));u[o[d]]=g}i=="featureMember"||i=="member"?n=k(void 0,u,e,r):n=k([],u,e,r)}return n===null&&(n=[]),n}readGeometryOrExtent(e,r){const i=r[0];return i.srsName=e.firstElementChild.getAttribute("srsName"),i.srsDimension=e.firstElementChild.getAttribute("srsDimension"),k(null,this.GEOMETRY_PARSERS,e,r,this)}readExtentElement(e,r){const i=r[0],n=this.readGeometryOrExtent(e,r);return n?Ta(n,i):void 0}readGeometryElement(e,r){const i=r[0],n=this.readGeometryOrExtent(e,r);return n?ze(n,!1,i):void 0}readFeatureElementInternal(e,r,i){let n;const s={};for(let l=e.firstElementChild;l;l=l.nextElementSibling){let h;const u=l.localName;l.childNodes.length===0||l.childNodes.length===1&&(l.firstChild.nodeType===3||l.firstChild.nodeType===4)?(h=Cn(l,!1),Xg.test(h)&&(h=void 0)):(i&&(h=u==="boundedBy"?this.readExtentElement(l,r):this.readGeometryElement(l,r)),h?u!=="boundedBy"&&(n=u):h=this.readFeatureElementInternal(l,r,!1));const c=l.attributes.length;if(c>0&&!(h instanceof _d)){h={_content_:h};for(let d=0;d<c;d++){const g=l.attributes[d].name;h[g]=l.attributes[d].value}}s[u]?(s[u]instanceof Array||(s[u]=[s[u]]),s[u].push(h)):s[u]=h}if(!i)return s;const a=new ut(s);n&&a.setGeometryName(n);const o=e.getAttribute("fid")||xd(e,this.namespace,"id");return o&&a.setId(o),a}readFeatureElement(e,r){return this.readFeatureElementInternal(e,r,!0)}readPoint(e,r){const i=this.readFlatCoordinatesFromNode(e,r);if(i)return new Et(i,"XYZ")}readMultiPoint(e,r){const i=k([],this.MULTIPOINT_PARSERS,e,r,this);if(i)return new is(i)}readMultiLineString(e,r){const i=k([],this.MULTILINESTRING_PARSERS,e,r,this);if(i)return new ei(i)}readMultiPolygon(e,r){const i=k([],this.MULTIPOLYGON_PARSERS,e,r,this);if(i)return new Ji(i)}pointMemberParser(e,r){Qt(this.POINTMEMBER_PARSERS,e,r,this)}lineStringMemberParser(e,r){Qt(this.LINESTRINGMEMBER_PARSERS,e,r,this)}polygonMemberParser(e,r){Qt(this.POLYGONMEMBER_PARSERS,e,r,this)}readLineString(e,r){const i=this.readFlatCoordinatesFromNode(e,r);if(i)return new Dt(i,"XYZ")}readFlatLinearRing(e,r){const i=k(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,r,this);if(i)return i}readLinearRing(e,r){const i=this.readFlatCoordinatesFromNode(e,r);if(i)return new Hs(i,"XYZ")}readPolygon(e,r){const i=k([null],this.FLAT_LINEAR_RINGS_PARSERS,e,r,this);if(i&&i[0]){const n=i[0],s=[n.length];let a,o;for(a=1,o=i.length;a<o;++a)On(n,i[a]),s.push(n.length);return new en(n,"XYZ",s)}}readFlatCoordinatesFromNode(e,r){return k(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,r,this)}readGeometryFromNode(e,r){const i=this.readGeometryElement(e,[this.getReadOptions(e,r||{})]);return i||null}readFeaturesFromNode(e,r){const i={featureType:this.featureType,featureNS:this.featureNS};return i&&Object.assign(i,this.getReadOptions(e,r)),this.readFeaturesInternal(e,[i])||[]}readProjectionFromNode(e){return de(this.srsName?this.srsName:e.firstElementChild.getAttribute("srsName"))}}Oe.prototype.namespace=qt;Oe.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};Oe.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};Oe.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};Oe.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:H(Oe.prototype.pointMemberParser),pointMembers:H(Oe.prototype.pointMemberParser)}};Oe.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:H(Oe.prototype.lineStringMemberParser),lineStringMembers:H(Oe.prototype.lineStringMemberParser)}};Oe.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:H(Oe.prototype.polygonMemberParser),polygonMembers:H(Oe.prototype.polygonMemberParser)}};Oe.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:H(Oe.prototype.readFlatCoordinatesFromNode)}};Oe.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:H(Oe.prototype.readLineString)}};Oe.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:H(Oe.prototype.readPolygon)}};Oe.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:K(Oe.prototype.readFlatLinearRing)}};const ae=Oe,Hg=qt+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",Yg={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class fe extends ae{constructor(e){e=e||{},super(e),this.FEATURE_COLLECTION_PARSERS[qt].featureMember=H(this.readFeaturesInternal),this.schemaLocation=e.schemaLocation?e.schemaLocation:Hg}readFlatCoordinates(e,r){const i=Cn(e,!1).replace(/^\s*|\s*$/g,""),s=r[0].srsName;let a="enu";if(s){const h=de(s);h&&(a=h.getAxisOrientation())}const o=i.trim().split(/\s+/),l=[];for(let h=0,u=o.length;h<u;h++){const c=o[h].split(/,+/),d=parseFloat(c[0]),g=parseFloat(c[1]),p=c.length===3?parseFloat(c[2]):0;a.substr(0,2)==="en"?l.push(d,g,p):l.push(g,d,p)}return l}readBox(e,r){const i=k([null],this.BOX_PARSERS_,e,r,this);return mc(i[1][0],i[1][1],i[1][3],i[1][4])}innerBoundaryIsParser(e,r){const i=k(void 0,this.RING_PARSERS,e,r,this);i&&r[r.length-1].push(i)}outerBoundaryIsParser(e,r){const i=k(void 0,this.RING_PARSERS,e,r,this);if(i){const n=r[r.length-1];n[0]=i}}GEOMETRY_NODE_FACTORY_(e,r,i){const n=r[r.length-1],s=n.multiSurface,a=n.surface,o=n.multiCurve;return Array.isArray(e)?i="Envelope":(i=e.getType(),i==="MultiPolygon"&&s===!0?i="MultiSurface":i==="Polygon"&&a===!0?i="Surface":i==="MultiLineString"&&o===!0&&(i="MultiCurve")),ie("http://www.opengis.net/gml",i)}writeFeatureElement(e,r,i){const n=r.getId();n&&e.setAttribute("fid",n);const s=i[i.length-1],a=s.featureNS,o=r.getGeometryName();s.serializers||(s.serializers={},s.serializers[a]={});const l=[],h=[];if(r.hasProperties()){const c=r.getProperties();for(const d in c){const g=c[d];g!==null&&(l.push(d),h.push(g),d==o||typeof g.getSimplifiedGeometry=="function"?d in s.serializers[a]||(s.serializers[a][d]=P(this.writeGeometryElement,this)):d in s.serializers[a]||(s.serializers[a][d]=P(le)))}}const u=Object.assign({},s);u.node=e,Me(u,s.serializers,lt(void 0,a),h,i,l)}writeCurveOrLineString(e,r,i){const s=i[i.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a),this.writeCoordinates_(a,r,i)}else if(e.nodeName==="Curve"){const a=ie(e.namespaceURI,"segments");e.appendChild(a),this.writeCurveSegments_(a,r,i)}}writeLineStringOrCurveMember(e,r,i){const n=this.GEOMETRY_NODE_FACTORY_(r,i);n&&(e.appendChild(n),this.writeCurveOrLineString(n,r,i))}writeMultiCurveOrLineString(e,r,i){const n=i[i.length-1],s=n.hasZ,a=n.srsName,o=n.curve;a&&e.setAttribute("srsName",a);const l=r.getLineStrings();Me({node:e,hasZ:s,srsName:a,curve:o},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeGeometryElement(e,r,i){const n=i[i.length-1],s=Object.assign({},n);s.node=e;let a;Array.isArray(r)?a=Ta(r,n):a=ze(r,!0,n),Me(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[a],i,void 0,this)}createCoordinatesNode_(e){const r=ie(e,"coordinates");return r.setAttribute("decimal","."),r.setAttribute("cs",","),r.setAttribute("ts"," "),r}writeCoordinates_(e,r,i){const n=i[i.length-1],s=n.hasZ,a=n.srsName,o=r.getCoordinates(),l=o.length,h=new Array(l);for(let u=0;u<l;++u){const c=o[u];h[u]=this.getCoords_(c,a,s)}le(e,h.join(" "))}writeCurveSegments_(e,r,i){const n=ie(e.namespaceURI,"LineStringSegment");e.appendChild(n),this.writeCurveOrLineString(n,r,i)}writeSurfaceOrPolygon(e,r,i){const n=i[i.length-1],s=n.hasZ,a=n.srsName;if(e.nodeName!=="PolygonPatch"&&a&&e.setAttribute("srsName",a),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const o=r.getLinearRings();Me({node:e,hasZ:s,srsName:a},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,o,i,void 0,this)}else if(e.nodeName==="Surface"){const o=ie(e.namespaceURI,"patches");e.appendChild(o),this.writeSurfacePatches_(o,r,i)}}RING_NODE_FACTORY_(e,r,i){const n=r[r.length-1],s=n.node,a=n.exteriorWritten;return a===void 0&&(n.exteriorWritten=!0),ie(s.namespaceURI,a!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(e,r,i){const n=ie(e.namespaceURI,"PolygonPatch");e.appendChild(n),this.writeSurfaceOrPolygon(n,r,i)}writeRing(e,r,i){const n=ie(e.namespaceURI,"LinearRing");e.appendChild(n),this.writeLinearRing(n,r,i)}getCoords_(e,r,i){let n="enu";r&&(n=de(r).getAxisOrientation());let s=n.substr(0,2)==="en"?e[0]+","+e[1]:e[1]+","+e[0];if(i){const a=e[2]||0;s+=","+a}return s}writePoint(e,r,i){const n=i[i.length-1],s=n.hasZ,a=n.srsName;a&&e.setAttribute("srsName",a);const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o);const l=r.getCoordinates(),h=this.getCoords_(l,a,s);le(o,h)}writeMultiPoint(e,r,i){const n=i[i.length-1],s=n.hasZ,a=n.srsName;a&&e.setAttribute("srsName",a);const o=r.getPoints();Me({node:e,hasZ:s,srsName:a},this.POINTMEMBER_SERIALIZERS,lt("pointMember"),o,i,void 0,this)}writePointMember(e,r,i){const n=ie(e.namespaceURI,"Point");e.appendChild(n),this.writePoint(n,r,i)}writeLinearRing(e,r,i){const s=i[i.length-1].srsName;s&&e.setAttribute("srsName",s);const a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a),this.writeCoordinates_(a,r,i)}writeMultiSurfaceOrPolygon(e,r,i){const n=i[i.length-1],s=n.hasZ,a=n.srsName,o=n.surface;a&&e.setAttribute("srsName",a);const l=r.getPolygons();Me({node:e,hasZ:s,srsName:a,surface:o},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeSurfaceOrPolygonMember(e,r,i){const n=this.GEOMETRY_NODE_FACTORY_(r,i);n&&(e.appendChild(n),this.writeSurfaceOrPolygon(n,r,i))}writeEnvelope(e,r,i){const s=i[i.length-1].srsName;s&&e.setAttribute("srsName",s);const a=["lowerCorner","upperCorner"],o=[r[0]+" "+r[1],r[2]+" "+r[3]];Me({node:e},this.ENVELOPE_SERIALIZERS,ti,o,i,a,this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,r,i){const n=r[r.length-1].node;return ie("http://www.opengis.net/gml",Yg[n.nodeName])}}fe.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:K(fe.prototype.readFlatCoordinates)}};fe.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:fe.prototype.innerBoundaryIsParser,outerBoundaryIs:fe.prototype.outerBoundaryIsParser}};fe.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:H(fe.prototype.readFlatCoordinates)}};fe.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:K(ae.prototype.readPoint),MultiPoint:K(ae.prototype.readMultiPoint),LineString:K(ae.prototype.readLineString),MultiLineString:K(ae.prototype.readMultiLineString),LinearRing:K(ae.prototype.readLinearRing),Polygon:K(ae.prototype.readPolygon),MultiPolygon:K(ae.prototype.readMultiPolygon),Box:K(fe.prototype.readBox)}};fe.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:P(fe.prototype.writeCurveOrLineString),MultiCurve:P(fe.prototype.writeMultiCurveOrLineString),Point:P(fe.prototype.writePoint),MultiPoint:P(fe.prototype.writeMultiPoint),LineString:P(fe.prototype.writeCurveOrLineString),MultiLineString:P(fe.prototype.writeMultiCurveOrLineString),LinearRing:P(fe.prototype.writeLinearRing),Polygon:P(fe.prototype.writeSurfaceOrPolygon),MultiPolygon:P(fe.prototype.writeMultiSurfaceOrPolygon),Surface:P(fe.prototype.writeSurfaceOrPolygon),MultiSurface:P(fe.prototype.writeMultiSurfaceOrPolygon),Envelope:P(fe.prototype.writeEnvelope)}};fe.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:P(fe.prototype.writeLineStringOrCurveMember),curveMember:P(fe.prototype.writeLineStringOrCurveMember)}};fe.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:P(fe.prototype.writeRing),innerBoundaryIs:P(fe.prototype.writeRing)}};fe.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:P(fe.prototype.writePointMember)}};fe.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:P(fe.prototype.writeSurfaceOrPolygonMember),polygonMember:P(fe.prototype.writeSurfaceOrPolygonMember)}};fe.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:P(le),upperCorner:P(le)}};const ni=fe,Kg=qt+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",Qg={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class W extends ae{constructor(e){e=e||{},super(e),this.surface_=e.surface!==void 0?e.surface:!1,this.curve_=e.curve!==void 0?e.curve:!1,this.multiCurve_=e.multiCurve!==void 0?e.multiCurve:!0,this.multiSurface_=e.multiSurface!==void 0?e.multiSurface:!0,this.schemaLocation=e.schemaLocation?e.schemaLocation:Kg,this.hasZ=e.hasZ!==void 0?e.hasZ:!1}readMultiCurve(e,r){const i=k([],this.MULTICURVE_PARSERS,e,r,this);if(i)return new ei(i)}readFlatCurveRing(e,r){const i=k([],this.MULTICURVE_PARSERS,e,r,this),n=[];for(let s=0,a=i.length;s<a;++s)On(n,i[s].getFlatCoordinates());return n}readMultiSurface(e,r){const i=k([],this.MULTISURFACE_PARSERS,e,r,this);if(i)return new Ji(i)}curveMemberParser(e,r){Qt(this.CURVEMEMBER_PARSERS,e,r,this)}surfaceMemberParser(e,r){Qt(this.SURFACEMEMBER_PARSERS,e,r,this)}readPatch(e,r){return k([null],this.PATCHES_PARSERS,e,r,this)}readSegment(e,r){return k([],this.SEGMENTS_PARSERS,e,r,this)}readPolygonPatch(e,r){return k([null],this.FLAT_LINEAR_RINGS_PARSERS,e,r,this)}readLineStringSegment(e,r){return k([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,r,this)}interiorParser(e,r){const i=k(void 0,this.RING_PARSERS,e,r,this);i&&r[r.length-1].push(i)}exteriorParser(e,r){const i=k(void 0,this.RING_PARSERS,e,r,this);if(i){const n=r[r.length-1];n[0]=i}}readSurface(e,r){const i=k([null],this.SURFACE_PARSERS,e,r,this);if(i&&i[0]){const n=i[0],s=[n.length];let a,o;for(a=1,o=i.length;a<o;++a)On(n,i[a]),s.push(n.length);return new en(n,"XYZ",s)}}readCurve(e,r){const i=k([null],this.CURVE_PARSERS,e,r,this);if(i)return new Dt(i,"XYZ")}readEnvelope(e,r){const i=k([null],this.ENVELOPE_PARSERS,e,r,this);return mc(i[1][0],i[1][1],i[2][0],i[2][1])}readFlatPos(e,r){let i=Cn(e,!1);const n=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,s=[];let a;for(;a=n.exec(i);)s.push(parseFloat(a[1])),i=i.substr(a[0].length);if(i!=="")return;const l=r[0].srsName;let h="enu";if(l&&(h=de(l).getAxisOrientation()),h==="neu"){let c,d;for(c=0,d=s.length;c<d;c+=3){const g=s[c],p=s[c+1];s[c]=p,s[c+1]=g}}const u=s.length;if(u==2&&s.push(0),u!==0)return s}readFlatPosList(e,r){const i=Cn(e,!1).replace(/^\s*|\s*$/g,""),n=r[0],s=n.srsName,a=n.srsDimension;let o="enu";s&&(o=de(s).getAxisOrientation());const l=i.split(/\s+/);let h=2;e.getAttribute("srsDimension")?h=Kt(e.getAttribute("srsDimension")):e.getAttribute("dimension")?h=Kt(e.getAttribute("dimension")):e.parentNode.getAttribute("srsDimension")?h=Kt(e.parentNode.getAttribute("srsDimension")):a&&(h=Kt(a));let u,c,d;const g=[];for(let p=0,y=l.length;p<y;p+=h)u=parseFloat(l[p]),c=parseFloat(l[p+1]),d=h===3?parseFloat(l[p+2]):0,o.substr(0,2)==="en"?g.push(u,c,d):g.push(c,u,d);return g}writePos_(e,r,i){const n=i[i.length-1],s=n.hasZ,a=s?"3":"2";e.setAttribute("srsDimension",a);const o=n.srsName;let l="enu";o&&(l=de(o).getAxisOrientation());const h=r.getCoordinates();let u;if(l.substr(0,2)==="en"?u=h[0]+" "+h[1]:u=h[1]+" "+h[0],s){const c=h[2]||0;u+=" "+c}le(e,u)}getCoords_(e,r,i){let n="enu";r&&(n=de(r).getAxisOrientation());let s=n.substr(0,2)==="en"?e[0]+" "+e[1]:e[1]+" "+e[0];if(i){const a=e[2]||0;s+=" "+a}return s}writePosList_(e,r,i){const n=i[i.length-1],s=n.hasZ,a=s?"3":"2";e.setAttribute("srsDimension",a);const o=n.srsName,l=r.getCoordinates(),h=l.length,u=new Array(h);let c;for(let d=0;d<h;++d)c=l[d],u[d]=this.getCoords_(c,o,s);le(e,u.join(" "))}writePoint(e,r,i){const s=i[i.length-1].srsName;s&&e.setAttribute("srsName",s);const a=ie(e.namespaceURI,"pos");e.appendChild(a),this.writePos_(a,r,i)}writeEnvelope(e,r,i){const s=i[i.length-1].srsName;s&&e.setAttribute("srsName",s);const a=["lowerCorner","upperCorner"],o=[r[0]+" "+r[1],r[2]+" "+r[3]];Me({node:e},this.ENVELOPE_SERIALIZERS,ti,o,i,a,this)}writeLinearRing(e,r,i){const s=i[i.length-1].srsName;s&&e.setAttribute("srsName",s);const a=ie(e.namespaceURI,"posList");e.appendChild(a),this.writePosList_(a,r,i)}RING_NODE_FACTORY_(e,r,i){const n=r[r.length-1],s=n.node,a=n.exteriorWritten;return a===void 0&&(n.exteriorWritten=!0),ie(s.namespaceURI,a!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(e,r,i){const n=i[i.length-1],s=n.hasZ,a=n.srsName;if(e.nodeName!=="PolygonPatch"&&a&&e.setAttribute("srsName",a),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const o=r.getLinearRings();Me({node:e,hasZ:s,srsName:a},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,o,i,void 0,this)}else if(e.nodeName==="Surface"){const o=ie(e.namespaceURI,"patches");e.appendChild(o),this.writeSurfacePatches_(o,r,i)}}writeCurveOrLineString(e,r,i){const s=i[i.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const a=ie(e.namespaceURI,"posList");e.appendChild(a),this.writePosList_(a,r,i)}else if(e.nodeName==="Curve"){const a=ie(e.namespaceURI,"segments");e.appendChild(a),this.writeCurveSegments_(a,r,i)}}writeMultiSurfaceOrPolygon(e,r,i){const n=i[i.length-1],s=n.hasZ,a=n.srsName,o=n.surface;a&&e.setAttribute("srsName",a);const l=r.getPolygons();Me({node:e,hasZ:s,srsName:a,surface:o},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeMultiPoint(e,r,i){const n=i[i.length-1],s=n.srsName,a=n.hasZ;s&&e.setAttribute("srsName",s);const o=r.getPoints();Me({node:e,hasZ:a,srsName:s},this.POINTMEMBER_SERIALIZERS,lt("pointMember"),o,i,void 0,this)}writeMultiCurveOrLineString(e,r,i){const n=i[i.length-1],s=n.hasZ,a=n.srsName,o=n.curve;a&&e.setAttribute("srsName",a);const l=r.getLineStrings();Me({node:e,hasZ:s,srsName:a,curve:o},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,i,void 0,this)}writeRing(e,r,i){const n=ie(e.namespaceURI,"LinearRing");e.appendChild(n),this.writeLinearRing(n,r,i)}writeSurfaceOrPolygonMember(e,r,i){const n=this.GEOMETRY_NODE_FACTORY_(r,i);n&&(e.appendChild(n),this.writeSurfaceOrPolygon(n,r,i))}writePointMember(e,r,i){const n=ie(e.namespaceURI,"Point");e.appendChild(n),this.writePoint(n,r,i)}writeLineStringOrCurveMember(e,r,i){const n=this.GEOMETRY_NODE_FACTORY_(r,i);n&&(e.appendChild(n),this.writeCurveOrLineString(n,r,i))}writeSurfacePatches_(e,r,i){const n=ie(e.namespaceURI,"PolygonPatch");e.appendChild(n),this.writeSurfaceOrPolygon(n,r,i)}writeCurveSegments_(e,r,i){const n=ie(e.namespaceURI,"LineStringSegment");e.appendChild(n),this.writeCurveOrLineString(n,r,i)}writeGeometryElement(e,r,i){const n=i[i.length-1],s=Object.assign({},n);s.node=e;let a;Array.isArray(r)?a=Ta(r,n):a=ze(r,!0,n),Me(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[a],i,void 0,this)}writeFeatureElement(e,r,i){const n=r.getId();n&&e.setAttribute("fid",n);const s=i[i.length-1],a=s.featureNS,o=r.getGeometryName();s.serializers||(s.serializers={},s.serializers[a]={});const l=[],h=[];if(r.hasProperties()){const c=r.getProperties();for(const d in c){const g=c[d];g!==null&&(l.push(d),h.push(g),d==o||typeof g.getSimplifiedGeometry=="function"?d in s.serializers[a]||(s.serializers[a][d]=P(this.writeGeometryElement,this)):d in s.serializers[a]||(s.serializers[a][d]=P(le)))}}const u=Object.assign({},s);u.node=e,Me(u,s.serializers,lt(void 0,a),h,i,l)}writeFeatureMembers_(e,r,i){const n=i[i.length-1],s=n.featureType,a=n.featureNS,o={};o[a]={},o[a][s]=P(this.writeFeatureElement,this);const l=Object.assign({},n);l.node=e,Me(l,o,lt(s,a),r,i)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,r,i){const n=r[r.length-1].node;return ie(this.namespace,Qg[n.nodeName])}GEOMETRY_NODE_FACTORY_(e,r,i){const n=r[r.length-1],s=n.multiSurface,a=n.surface,o=n.curve,l=n.multiCurve;return Array.isArray(e)?i="Envelope":(i=e.getType(),i==="MultiPolygon"&&s===!0?i="MultiSurface":i==="Polygon"&&a===!0?i="Surface":i==="LineString"&&o===!0?i="Curve":i==="MultiLineString"&&l===!0&&(i="MultiCurve")),ie(this.namespace,i)}writeGeometryNode(e,r){r=this.adaptOptions(r);const i=ie(this.namespace,"geom"),n={node:i,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return r&&Object.assign(n,r),this.writeGeometryElement(i,e,[n]),i}writeFeaturesNode(e,r){r=this.adaptOptions(r);const i=ie(this.namespace,"featureMembers");i.setAttributeNS(Bi,"xsi:schemaLocation",this.schemaLocation);const n={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return r&&Object.assign(n,r),this.writeFeatureMembers_(i,e,[n]),i}}W.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:K(W.prototype.readFlatPos),posList:K(W.prototype.readFlatPosList),coordinates:K(ni.prototype.readFlatCoordinates)}};W.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:W.prototype.interiorParser,exterior:W.prototype.exteriorParser}};W.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:K(ae.prototype.readPoint),MultiPoint:K(ae.prototype.readMultiPoint),LineString:K(ae.prototype.readLineString),MultiLineString:K(ae.prototype.readMultiLineString),LinearRing:K(ae.prototype.readLinearRing),Polygon:K(ae.prototype.readPolygon),MultiPolygon:K(ae.prototype.readMultiPolygon),Surface:K(W.prototype.readSurface),MultiSurface:K(W.prototype.readMultiSurface),Curve:K(W.prototype.readCurve),MultiCurve:K(W.prototype.readMultiCurve),Envelope:K(W.prototype.readEnvelope)}};W.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:H(W.prototype.curveMemberParser),curveMembers:H(W.prototype.curveMemberParser)}};W.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:H(W.prototype.surfaceMemberParser),surfaceMembers:H(W.prototype.surfaceMemberParser)}};W.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:H(ae.prototype.readLineString),Curve:H(W.prototype.readCurve)}};W.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:H(ae.prototype.readPolygon),Surface:H(W.prototype.readSurface)}};W.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:K(W.prototype.readPatch)}};W.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:K(W.prototype.readSegment)}};W.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:H(W.prototype.readFlatPosList),upperCorner:H(W.prototype.readFlatPosList)}};W.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:K(W.prototype.readPolygonPatch)}};W.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:yc(W.prototype.readLineStringSegment)}};ae.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:K(ae.prototype.readFlatLinearRing),Ring:K(W.prototype.readFlatCurveRing)}};W.prototype.writeFeatures;W.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:P(W.prototype.writeRing),interior:P(W.prototype.writeRing)}};W.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:P(le),upperCorner:P(le)}};W.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:P(W.prototype.writeSurfaceOrPolygonMember),polygonMember:P(W.prototype.writeSurfaceOrPolygonMember)}};W.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:P(W.prototype.writePointMember)}};W.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:P(W.prototype.writeLineStringOrCurveMember),curveMember:P(W.prototype.writeLineStringOrCurveMember)}};W.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:P(W.prototype.writeCurveOrLineString),MultiCurve:P(W.prototype.writeMultiCurveOrLineString),Point:P(W.prototype.writePoint),MultiPoint:P(W.prototype.writeMultiPoint),LineString:P(W.prototype.writeCurveOrLineString),MultiLineString:P(W.prototype.writeMultiCurveOrLineString),LinearRing:P(W.prototype.writeLinearRing),Polygon:P(W.prototype.writeSurfaceOrPolygon),MultiPolygon:P(W.prototype.writeMultiSurfaceOrPolygon),Surface:P(W.prototype.writeSurfaceOrPolygon),MultiSurface:P(W.prototype.writeMultiSurfaceOrPolygon),Envelope:P(W.prototype.writeEnvelope)}};const se=W,Ga=se;Ga.prototype.writeFeatures;Ga.prototype.writeFeaturesNode;const Jg=Ga,Pe=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],ep="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",tp={rte:$c,trk:jc,wpt:qc},rp=q(Pe,{rte:H($c),trk:H(jc),wpt:H(qc)}),ip=q(Pe,{text:b(U,"linkText"),type:b(U,"linkType")}),np=q(Pe,{name:b(U),email:Lp,link:sn}),sp=q(Pe,{name:b(U),desc:b(U),author:b(Pp),copyright:b(Ap),link:sn,time:b(ss),keywords:b(U),bounds:Ip,extensions:us}),ap=q(Pe,{year:b(Ce),license:b(U)}),op=q(Pe,{rte:P(Fp),trk:P(Dp),wpt:P(Up)});class lp extends ns{constructor(e){super(),e=e||{},this.dataProjection=de("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let r=0,i=e.length;r<i;++r){const n=e[r];if(this.readExtensions_){const s=n.get("extensionsNode_")||null;this.readExtensions_(n,s)}n.set("extensionsNode_",void 0)}}readMetadata(e){return e?typeof e=="string"?this.readMetadataFromDocument(Nn(e)):Fn(e)?this.readMetadataFromDocument(e):this.readMetadataFromNode(e):null}readMetadataFromDocument(e){for(let r=e.firstChild;r;r=r.nextSibling)if(r.nodeType===Node.ELEMENT_NODE){const i=this.readMetadataFromNode(r);if(i)return i}return null}readMetadataFromNode(e){if(!Pe.includes(e.namespaceURI))return null;for(let r=e.firstElementChild;r;r=r.nextElementSibling)if(Pe.includes(r.namespaceURI)&&r.localName==="metadata")return k({},sp,r,[]);return null}readFeatureFromNode(e,r){if(!Pe.includes(e.namespaceURI))return null;const i=tp[e.localName];if(!i)return null;const n=i(e,[this.getReadOptions(e,r)]);return n?(this.handleReadExtensions_([n]),n):null}readFeaturesFromNode(e,r){if(!Pe.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const i=k([],rp,e,[this.getReadOptions(e,r)]);return i?(this.handleReadExtensions_(i),i):[]}return[]}writeFeaturesNode(e,r){r=this.adaptOptions(r);const i=ie("http://www.topografix.com/GPX/1/1","gpx"),n="http://www.w3.org/2000/xmlns/";return i.setAttributeNS(n,"xmlns:xsi",Bi),i.setAttributeNS(Bi,"xsi:schemaLocation",ep),i.setAttribute("version","1.1"),i.setAttribute("creator","OpenLayers"),Me({node:i},op,Rp,e,[r]),i}}const hp=q(Pe,{name:b(U),cmt:b(U),desc:b(U),src:b(U),link:sn,number:b(Ce),extensions:us,type:b(U),rtept:Cp}),cp=q(Pe,{ele:b(We),time:b(ss)}),up=q(Pe,{name:b(U),cmt:b(U),desc:b(U),src:b(U),link:sn,number:b(Ce),type:b(U),extensions:us,trkseg:Np}),fp=q(Pe,{trkpt:Op}),dp=q(Pe,{ele:b(We),time:b(ss)}),gp=q(Pe,{ele:b(We),time:b(ss),magvar:b(We),geoidheight:b(We),name:b(U),cmt:b(U),desc:b(U),src:b(U),link:sn,sym:b(U),type:b(U),fix:b(U),sat:b(Ce),hdop:b(We),vdop:b(We),pdop:b(We),ageofdgpsdata:b(We),dgpsid:b(Ce),extensions:us}),pp=["text","type"],mp=q(Pe,{text:P(le),type:P(le)}),yp=q(Pe,["name","cmt","desc","src","link","number","type","rtept"]),_p=q(Pe,{name:P(le),cmt:P(le),desc:P(le),src:P(le),link:P(Ba),number:P(Dn),type:P(le),rtept:_c(P(za))}),xp=q(Pe,["ele","time"]),vp=q(Pe,["name","cmt","desc","src","link","number","type","trkseg"]),Ep=q(Pe,{name:P(le),cmt:P(le),desc:P(le),src:P(le),link:P(Ba),number:P(Dn),type:P(le),trkseg:_c(P(Gp))}),wp=lt("trkpt"),Tp=q(Pe,{trkpt:P(za)}),Sp=q(Pe,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),Mp=q(Pe,{ele:P(cr),time:P(vd),magvar:P(cr),geoidheight:P(cr),name:P(le),cmt:P(le),desc:P(le),src:P(le),link:P(Ba),sym:P(le),type:P(le),fix:P(le),sat:P(Dn),hdop:P(cr),vdop:P(cr),pdop:P(cr),ageofdgpsdata:P(cr),dgpsid:P(Dn)}),bp={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function Rp(t,e,r){const i=t.getGeometry();if(i){const n=bp[i.getType()];if(n){const s=e[e.length-1].node;return ie(s.namespaceURI,n)}}}function Ua(t,e,r,i){return t.push(parseFloat(r.getAttribute("lon")),parseFloat(r.getAttribute("lat"))),"ele"in i?(t.push(i.ele),delete i.ele,e.hasZ=!0):t.push(0),"time"in i?(t.push(i.time),delete i.time,e.hasM=!0):t.push(0),t}function ka(t,e,r){let i="XY",n=2;if(t.hasZ&&t.hasM?(i="XYZM",n=4):t.hasZ?(i="XYZ",n=3):t.hasM&&(i="XYM",n=3),n!==4){for(let s=0,a=e.length/4;s<a;s++)e[s*n]=e[s*4],e[s*n+1]=e[s*4+1],t.hasZ&&(e[s*n+2]=e[s*4+2]),t.hasM&&(e[s*n+2]=e[s*4+3]);if(e.length=e.length/4*n,r)for(let s=0,a=r.length;s<a;s++)r[s]=r[s]/4*n}return i}function Pp(t,e){const r=k({},np,t,e);if(r)return r}function Ap(t,e){const r=k({},ap,t,e);if(r){const i=t.getAttribute("author");return i!==null&&(r.author=i),r}}function Ip(t,e){const r=e[e.length-1],i=t.getAttribute("minlat"),n=t.getAttribute("minlon"),s=t.getAttribute("maxlat"),a=t.getAttribute("maxlon");n!==null&&i!==null&&a!==null&&s!==null&&(r.bounds=[[parseFloat(n),parseFloat(i)],[parseFloat(a),parseFloat(s)]])}function Lp(t,e){const r=e[e.length-1],i=t.getAttribute("id"),n=t.getAttribute("domain");i!==null&&n!==null&&(r.email=`${i}@${n}`)}function sn(t,e){const r=e[e.length-1],i=t.getAttribute("href");i!==null&&(r.link=i),Qt(ip,t,e)}function us(t,e){const r=e[e.length-1];r.extensionsNode_=t}function Cp(t,e){const r=k({},cp,t,e);if(r){const i=e[e.length-1],n=i.flatCoordinates,s=i.layoutOptions;Ua(n,s,t,r)}}function Op(t,e){const r=k({},dp,t,e);if(r){const i=e[e.length-1],n=i.flatCoordinates,s=i.layoutOptions;Ua(n,s,t,r)}}function Np(t,e){const r=e[e.length-1];Qt(fp,t,e);const i=r.flatCoordinates;r.ends.push(i.length)}function $c(t,e){const r=e[0],i=k({flatCoordinates:[],layoutOptions:{}},hp,t,e);if(!i)return;const n=i.flatCoordinates;delete i.flatCoordinates;const s=i.layoutOptions;delete i.layoutOptions;const a=ka(s,n),o=new Dt(n,a);ze(o,!1,r);const l=new ut(o);return l.setProperties(i,!0),l}function jc(t,e){const r=e[0],i=k({flatCoordinates:[],ends:[],layoutOptions:{}},up,t,e);if(!i)return;const n=i.flatCoordinates;delete i.flatCoordinates;const s=i.ends;delete i.ends;const a=i.layoutOptions;delete i.layoutOptions;const o=ka(a,n,s),l=new ei(n,o,s);ze(l,!1,r);const h=new ut(l);return h.setProperties(i,!0),h}function qc(t,e){const r=e[0],i=k({},gp,t,e);if(!i)return;const n={},s=Ua([],n,t,i),a=ka(n,s),o=new Et(s,a);ze(o,!1,r);const l=new ut(o);return l.setProperties(i,!0),l}function Ba(t,e,r){t.setAttribute("href",e);const n=r[r.length-1].properties,s=[n.linkText,n.linkType];Me({node:t},mp,ti,s,r,pp)}function za(t,e,r){const i=r[r.length-1],s=i.node.namespaceURI,a=i.properties;switch(t.setAttributeNS(null,"lat",String(e[1])),t.setAttributeNS(null,"lon",String(e[0])),i.geometryLayout){case"XYZM":e[3]!==0&&(a.time=e[3]);case"XYZ":e[2]!==0&&(a.ele=e[2]);break;case"XYM":e[2]!==0&&(a.time=e[2]);break}const l=t.nodeName=="rtept"?xp[s]:Sp[s],h=Sa(a,l);Me({node:t,properties:a},Mp,ti,h,r,l)}function Fp(t,e,r){const i=r[0],n=e.getProperties(),s={node:t};s.properties=n;const a=e.getGeometry();if(a.getType()=="LineString"){const u=ze(a,!0,i);s.geometryLayout=u.getLayout(),n.rtept=u.getCoordinates()}const o=r[r.length-1].node,l=yp[o.namespaceURI],h=Sa(n,l);Me(s,_p,ti,h,r,l)}function Dp(t,e,r){const i=r[0],n=e.getProperties(),s={node:t};s.properties=n;const a=e.getGeometry();if(a.getType()=="MultiLineString"){const u=ze(a,!0,i);n.trkseg=u.getLineStrings()}const o=r[r.length-1].node,l=vp[o.namespaceURI],h=Sa(n,l);Me(s,Ep,ti,h,r,l)}function Gp(t,e,r){const i={node:t};i.geometryLayout=e.getLayout(),i.properties={},Me(i,Tp,wp,e.getCoordinates(),r)}function Up(t,e,r){const i=r[0],n=r[r.length-1];n.properties=e.getProperties();const s=e.getGeometry();if(s.getType()=="Point"){const a=ze(s,!0,i);n.geometryLayout=a.getLayout(),za(t,a.getCoordinates(),r)}}const kp=lp;class Bp extends xc{constructor(){super()}getType(){return"text"}readFeature(e,r){return this.readFeatureFromText(mn(e),this.adaptOptions(r))}readFeatureFromText(e,r){return $t()}readFeatures(e,r){return this.readFeaturesFromText(mn(e),this.adaptOptions(r))}readFeaturesFromText(e,r){return $t()}readGeometry(e,r){return this.readGeometryFromText(mn(e),this.adaptOptions(r))}readGeometryFromText(e,r){return $t()}readProjection(e){return this.readProjectionFromText(mn(e))}readProjectionFromText(e){return this.dataProjection}writeFeature(e,r){return this.writeFeatureText(e,this.adaptOptions(r))}writeFeatureText(e,r){return $t()}writeFeatures(e,r){return this.writeFeaturesText(e,this.adaptOptions(r))}writeFeaturesText(e,r){return $t()}writeGeometry(e,r){return this.writeGeometryText(e,this.adaptOptions(r))}writeGeometryText(e,r){return $t()}}function mn(t){return typeof t=="string"?t:""}const $a=Bp,zp=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,$p=/^H.([A-Z]{3}).*?:(.*)/,jp=/^HFDTE(\d{2})(\d{2})(\d{2})/,qp=/\r\n|\r|\n/;class Zp extends $a{constructor(e){super(),e=e||{},this.dataProjection=de("EPSG:4326"),this.altitudeMode_=e.altitudeMode?e.altitudeMode:"none"}readFeatureFromText(e,r){const i=this.altitudeMode_,n=e.split(qp),s={},a=[];let o=2e3,l=0,h=1,u=-1,c,d;for(c=0,d=n.length;c<d;++c){const _=n[c];let v;if(_.charAt(0)=="B"){if(v=zp.exec(_),v){const E=parseInt(v[1],10),w=parseInt(v[2],10),T=parseInt(v[3],10);let M=parseInt(v[4],10)+parseInt(v[5],10)/6e4;v[6]=="S"&&(M=-M);let A=parseInt(v[7],10)+parseInt(v[8],10)/6e4;if(v[9]=="W"&&(A=-A),a.push(A,M),i!="none"){let C;i=="gps"?C=parseInt(v[11],10):i=="barometric"?C=parseInt(v[12],10):C=0,a.push(C)}let I=Date.UTC(o,l,h,E,w,T);I<u&&(I=Date.UTC(o,l,h+1,E,w,T)),a.push(I/1e3),u=I}}else _.charAt(0)=="H"&&(v=jp.exec(_),v?(h=parseInt(v[1],10),l=parseInt(v[2],10)-1,o=2e3+parseInt(v[3],10)):(v=$p.exec(_),v&&(s[v[1]]=v[2].trim())))}if(a.length===0)return null;const g=i=="none"?"XYM":"XYZM",p=new Dt(a,g),y=new ut(ze(p,!1,r));return y.setProperties(s,!0),y}readFeaturesFromText(e,r){const i=this.readFeatureFromText(e,r);return i?[i]:[]}}const Vp=Zp,Ge={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"},yr={};yr[Ge.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}};yr[Ge.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}};yr[Ge.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}};yr.none={none:{supports:[],formats:[],qualities:[]}};const Wp=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,Jo=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,Xp=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function Hp(t){let e=t.getComplianceLevelSupportedFeatures();return e===void 0&&(e=yr[Ge.VERSION1].level0),{url:t.imageInfo["@id"]===void 0?void 0:t.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:e.supports,formats:[...e.formats,t.imageInfo.formats===void 0?[]:t.imageInfo.formats],qualities:[...e.qualities,t.imageInfo.qualities===void 0?[]:t.imageInfo.qualities],resolutions:t.imageInfo.scale_factors,tileSize:t.imageInfo.tile_width!==void 0?t.imageInfo.tile_height!==void 0?[t.imageInfo.tile_width,t.imageInfo.tile_height]:[t.imageInfo.tile_width,t.imageInfo.tile_width]:t.imageInfo.tile_height!=null?[t.imageInfo.tile_height,t.imageInfo.tile_height]:void 0}}function Yp(t){const e=t.getComplianceLevelSupportedFeatures(),r=Array.isArray(t.imageInfo.profile)&&t.imageInfo.profile.length>1,i=r&&t.imageInfo.profile[1].supports?t.imageInfo.profile[1].supports:[],n=r&&t.imageInfo.profile[1].formats?t.imageInfo.profile[1].formats:[],s=r&&t.imageInfo.profile[1].qualities?t.imageInfo.profile[1].qualities:[];return{url:t.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:t.imageInfo.sizes===void 0?void 0:t.imageInfo.sizes.map(function(a){return[a.width,a.height]}),tileSize:t.imageInfo.tiles===void 0?void 0:[t.imageInfo.tiles.map(function(a){return a.width})[0],t.imageInfo.tiles.map(function(a){return a.height===void 0?a.width:a.height})[0]],resolutions:t.imageInfo.tiles===void 0?void 0:t.imageInfo.tiles.map(function(a){return a.scaleFactors})[0],supports:[...e.supports,...i],formats:[...e.formats,...n],qualities:[...e.qualities,...s]}}function Kp(t){const e=t.getComplianceLevelSupportedFeatures(),r=t.imageInfo.extraFormats===void 0?e.formats:[...e.formats,...t.imageInfo.extraFormats],i=t.imageInfo.preferredFormats!==void 0&&Array.isArray(t.imageInfo.preferredFormats)&&t.imageInfo.preferredFormats.length>0?t.imageInfo.preferredFormats.filter(function(n){return["jpg","png","gif"].includes(n)}).reduce(function(n,s){return n===void 0&&r.includes(s)?s:n},void 0):void 0;return{url:t.imageInfo.id,sizes:t.imageInfo.sizes===void 0?void 0:t.imageInfo.sizes.map(function(n){return[n.width,n.height]}),tileSize:t.imageInfo.tiles===void 0?void 0:[t.imageInfo.tiles.map(function(n){return n.width})[0],t.imageInfo.tiles.map(function(n){return n.height})[0]],resolutions:t.imageInfo.tiles===void 0?void 0:t.imageInfo.tiles.map(function(n){return n.scaleFactors})[0],supports:t.imageInfo.extraFeatures===void 0?e.supports:[...e.supports,...t.imageInfo.extraFeatures],formats:r,qualities:t.imageInfo.extraQualities===void 0?e.qualities:[...e.qualities,...t.imageInfo.extraQualities],preferredFormat:i}}const fs={};fs[Ge.VERSION1]=Hp;fs[Ge.VERSION2]=Yp;fs[Ge.VERSION3]=Kp;class Qp{constructor(e){this.setImageInfo(e)}setImageInfo(e){typeof e=="string"?this.imageInfo=JSON.parse(e):this.imageInfo=e}getImageApiVersion(){if(this.imageInfo===void 0)return;let e=this.imageInfo["@context"]||"ol-no-context";typeof e=="string"&&(e=[e]);for(let r=0;r<e.length;r++)switch(e[r]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return Ge.VERSION1;case"http://iiif.io/api/image/2/context.json":return Ge.VERSION2;case"http://iiif.io/api/image/3/context.json":return Ge.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(Ge.VERSION1)&&this.imageInfo.identifier)return Ge.VERSION1;break}Gt(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(e){if(!(this.imageInfo===void 0||this.imageInfo.profile===void 0))switch(e===void 0&&(e=this.getImageApiVersion()),e){case Ge.VERSION1:if(Wp.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Ge.VERSION3:if(Xp.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Ge.VERSION2:if(typeof this.imageInfo.profile=="string"&&Jo.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&typeof this.imageInfo.profile[0]=="string"&&Jo.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0];break}}getComplianceLevelFromProfile(e){const r=this.getComplianceLevelEntryFromProfile(e);if(r===void 0)return;const i=r.match(/level[0-2](?:\.json)?$/g);return Array.isArray(i)?i[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(this.imageInfo===void 0)return;const e=this.getImageApiVersion(),r=this.getComplianceLevelFromProfile(e);return r===void 0?yr.none.none:yr[e][r]}getTileSourceOptions(e){const r=e||{},i=this.getImageApiVersion();if(i===void 0)return;const n=i===void 0?void 0:fs[i](this);if(n!==void 0)return{url:n.url,version:i,size:[this.imageInfo.width,this.imageInfo.height],sizes:n.sizes,format:r.format!==void 0&&n.formats.includes(r.format)?r.format:n.preferredFormat!==void 0?n.preferredFormat:"jpg",supports:n.supports,quality:r.quality&&n.qualities.includes(r.quality)?r.quality:n.qualities.includes("native")?"native":"default",resolutions:Array.isArray(n.resolutions)?n.resolutions.sort(function(s,a){return a-s}):void 0,tileSize:n.tileSize}}}const Jp=Qp;class em{read(e){if(!e)return null;if(typeof e=="string"){const r=Nn(e);return this.readFromDocument(r)}return Fn(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let r=e.firstChild;r;r=r.nextSibling)if(r.nodeType==Node.ELEMENT_NODE)return this.readFromNode(r);return null}readFromNode(e){$t()}}const ja=em,tm="http://www.w3.org/1999/xlink";function si(t){return t.getAttributeNS(tm,"href")}const nt=[null,"http://www.opengis.net/ows/1.1"],rm=q(nt,{ServiceIdentification:b(Rm),ServiceProvider:b(Am),OperationsMetadata:b(Mm)});class im extends ja{constructor(){super()}readFromNode(e){const r=k({},rm,e,[]);return r||null}}const nm=q(nt,{DeliveryPoint:b(U),City:b(U),AdministrativeArea:b(U),PostalCode:b(U),Country:b(U),ElectronicMailAddress:b(U)}),sm=q(nt,{Value:be(Im)}),am=q(nt,{AllowedValues:b(_m)}),om=q(nt,{Phone:b(bm),Address:b(ym)}),lm=q(nt,{HTTP:b(Tm)}),hm=q(nt,{Get:be(wm),Post:void 0}),cm=q(nt,{DCP:b(Em)}),um=q(nt,{Operation:Sm}),fm=q(nt,{Voice:b(U),Facsimile:b(U)}),dm=q(nt,{Constraint:be(xm)}),gm=q(nt,{IndividualName:b(U),PositionName:b(U),ContactInfo:b(vm)}),pm=q(nt,{Abstract:b(U),AccessConstraints:b(U),Fees:b(U),Title:b(U),ServiceTypeVersion:b(U),ServiceType:b(U)}),mm=q(nt,{ProviderName:b(U),ProviderSite:b(si),ServiceContact:b(Pm)});function ym(t,e){return k({},nm,t,e)}function _m(t,e){return k({},sm,t,e)}function xm(t,e){const r=t.getAttribute("name");if(r)return k({name:r},am,t,e)}function vm(t,e){return k({},om,t,e)}function Em(t,e){return k({},lm,t,e)}function wm(t,e){const r=si(t);if(r)return k({href:r},dm,t,e)}function Tm(t,e){return k({},hm,t,e)}function Sm(t,e){const r=t.getAttribute("name"),i=k({},cm,t,e);if(!i)return;const n=e[e.length-1];n[r]=i}function Mm(t,e){return k({},um,t,e)}function bm(t,e){return k({},fm,t,e)}function Rm(t,e){return k({},pm,t,e)}function Pm(t,e){return k({},gm,t,e)}function Am(t,e){return k({},mm,t,e)}function Im(t,e){return U(t)}const Zc=im;function el(t,e,r,i,n,s){n!==void 0?(n=n,s=s!==void 0?s:0):(n=[],s=0);let a=e;for(;a<r;){const o=t[a++];n[s++]=t[a++],n[s++]=o;for(let l=2;l<i;++l)n[s++]=t[a++]}return n.length=s,n}class Lm extends $a{constructor(e){super(),e=e||{},this.dataProjection=de("EPSG:4326"),this.factor_=e.factor?e.factor:1e5,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY"}readFeatureFromText(e,r){const i=this.readGeometryFromText(e,r);return new ut(i)}readFeaturesFromText(e,r){return[this.readFeatureFromText(e,r)]}readGeometryFromText(e,r){const i=Ed(this.geometryLayout_),n=Om(e,i,this.factor_);el(n,0,n.length,i,n);const s=wd(n,0,n.length,i),a=new Dt(s,this.geometryLayout_);return ze(a,!1,this.adaptOptions(r))}writeFeatureText(e,r){const i=e.getGeometry();if(i)return this.writeGeometryText(i,r);throw new Error("Expected `feature` to have a geometry")}writeFeaturesText(e,r){return this.writeFeatureText(e[0],r)}writeGeometryText(e,r){e=ze(e,!0,this.adaptOptions(r));const i=e.getFlatCoordinates(),n=e.getStride();return el(i,0,i.length,n,i),Cm(i,n,this.factor_)}}function Cm(t,e,r){r=r||1e5;let i;const n=new Array(e);for(i=0;i<e;++i)n[i]=0;for(let s=0,a=t.length;s<a;)for(i=0;i<e;++i,++s){const o=t[s],l=o-n[i];n[i]=o,t[s]=l}return Nm(t,r)}function Om(t,e,r){r=r||1e5;let i;const n=new Array(e);for(i=0;i<e;++i)n[i]=0;const s=Fm(t,r);for(let a=0,o=s.length;a<o;)for(i=0;i<e;++i,++a)n[i]+=s[a],s[a]=n[i];return s}function Nm(t,e){e=e||1e5;for(let r=0,i=t.length;r<i;++r)t[r]=Math.round(t[r]*e);return Dm(t)}function Fm(t,e){e=e||1e5;const r=Gm(t);for(let i=0,n=r.length;i<n;++i)r[i]/=e;return r}function Dm(t){for(let e=0,r=t.length;e<r;++e){const i=t[e];t[e]=i<0?~(i<<1):i<<1}return Um(t)}function Gm(t){const e=km(t);for(let r=0,i=e.length;r<i;++r){const n=e[r];e[r]=n&1?~(n>>1):n>>1}return e}function Um(t){let e="";for(let r=0,i=t.length;r<i;++r)e+=Bm(t[r]);return e}function km(t){const e=[];let r=0,i=0;for(let n=0,s=t.length;n<s;++n){const a=t.charCodeAt(n)-63;r|=(a&31)<<i,a<32?(e.push(r),r=0,i=0):i+=5}return e}function Bm(t){let e,r="";for(;t>=32;)e=(32|t&31)+63,r+=String.fromCharCode(e),t>>=5;return e=t+63,r+=String.fromCharCode(e),r}const zm=Lm;class _e extends se{constructor(e){e=e||{},super(e),this.schemaLocation=e.schemaLocation?e.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(e,r,i){const n=i[i.length-1];i[i.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},n),super.writeGeometryElement(e,r,i)}}_e.prototype.namespace="http://www.opengis.net/gml/3.2";_e.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:K(se.prototype.readFlatPos),posList:K(se.prototype.readFlatPosList),coordinates:K(ni.prototype.readFlatCoordinates)}};_e.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:se.prototype.interiorParser,exterior:se.prototype.exteriorParser}};_e.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:K(ae.prototype.readPoint),MultiPoint:K(ae.prototype.readMultiPoint),LineString:K(ae.prototype.readLineString),MultiLineString:K(ae.prototype.readMultiLineString),LinearRing:K(ae.prototype.readLinearRing),Polygon:K(ae.prototype.readPolygon),MultiPolygon:K(ae.prototype.readMultiPolygon),Surface:K(_e.prototype.readSurface),MultiSurface:K(se.prototype.readMultiSurface),Curve:K(_e.prototype.readCurve),MultiCurve:K(se.prototype.readMultiCurve),Envelope:K(_e.prototype.readEnvelope)}};_e.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:H(se.prototype.curveMemberParser),curveMembers:H(se.prototype.curveMemberParser)}};_e.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:H(se.prototype.surfaceMemberParser),surfaceMembers:H(se.prototype.surfaceMemberParser)}};_e.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:H(ae.prototype.readLineString),Curve:H(se.prototype.readCurve)}};_e.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:H(ae.prototype.readPolygon),Surface:H(se.prototype.readSurface)}};_e.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:K(se.prototype.readPatch)}};_e.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:K(se.prototype.readSegment)}};_e.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:H(se.prototype.readFlatPosList),upperCorner:H(se.prototype.readFlatPosList)}};_e.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:K(se.prototype.readPolygonPatch)}};_e.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:yc(se.prototype.readLineStringSegment)}};_e.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:H(ae.prototype.pointMemberParser),pointMembers:H(ae.prototype.pointMemberParser)}};_e.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:H(ae.prototype.lineStringMemberParser),lineStringMembers:H(ae.prototype.lineStringMemberParser)}};_e.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:H(ae.prototype.polygonMemberParser),polygonMembers:H(ae.prototype.polygonMemberParser)}};_e.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:H(ae.prototype.readFlatCoordinatesFromNode)}};_e.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:H(ae.prototype.readLineString)}};_e.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:H(ae.prototype.readPolygon)}};_e.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:K(ae.prototype.readFlatLinearRing),Ring:K(_e.prototype.readFlatCurveRing)}};_e.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:P(se.prototype.writeRing),interior:P(se.prototype.writeRing)}};_e.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:P(le),upperCorner:P(le)}};_e.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:P(se.prototype.writeSurfaceOrPolygonMember),polygonMember:P(se.prototype.writeSurfaceOrPolygonMember)}};_e.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:P(se.prototype.writePointMember)}};_e.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:P(se.prototype.writeLineStringOrCurveMember),curveMember:P(se.prototype.writeLineStringOrCurveMember)}};_e.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:P(se.prototype.writeCurveOrLineString),MultiCurve:P(se.prototype.writeMultiCurveOrLineString),Point:P(_e.prototype.writePoint),MultiPoint:P(se.prototype.writeMultiPoint),LineString:P(se.prototype.writeCurveOrLineString),MultiLineString:P(se.prototype.writeMultiCurveOrLineString),LinearRing:P(se.prototype.writeLinearRing),Polygon:P(se.prototype.writeSurfaceOrPolygon),MultiPolygon:P(se.prototype.writeMultiSurfaceOrPolygon),Surface:P(se.prototype.writeSurfaceOrPolygon),MultiSurface:P(se.prototype.writeMultiSurfaceOrPolygon),Envelope:P(se.prototype.writeEnvelope)}};const qa=_e;class $m{constructor(e){this.tagName_=e}getTagName(){return this.tagName_}}const Vc=$m;class jm extends Vc{constructor(e,r){super(e),this.conditions=r,Gt(this.conditions.length>=2,"At least 2 conditions are required")}}const qm=jm;class Zm extends qm{constructor(e){super("And",Array.prototype.slice.call(arguments))}}const Vm=Zm;class Wm extends Vc{constructor(e,r,i){if(super("BBOX"),this.geometryName=e,this.extent=r,r.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=i}}const Xm=Wm;function Hm(t){const e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(Vm,e))}function Ym(t,e,r){return new Xm(t,e,r)}const tl={"http://www.opengis.net/gml":{boundedBy:b(ae.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:H(ae.prototype.readFeaturesInternal)}},Km={"http://www.opengis.net/wfs":{totalInserted:b(Ce),totalUpdated:b(Ce),totalDeleted:b(Ce)},"http://www.opengis.net/wfs/2.0":{totalInserted:b(Ce),totalUpdated:b(Ce),totalDeleted:b(Ce)}},Qm={"http://www.opengis.net/wfs":{TransactionSummary:b(il,"transactionSummary"),InsertResults:b(sl,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:b(il,"transactionSummary"),InsertResults:b(sl,"insertIds")}},Jm={"http://www.opengis.net/wfs":{PropertyName:P(le)},"http://www.opengis.net/wfs/2.0":{PropertyName:P(le)}},Wc={"http://www.opengis.net/wfs":{Insert:P(al),Update:P(ll),Delete:P(ol),Property:P(hl),Native:P(cl)},"http://www.opengis.net/wfs/2.0":{Insert:P(al),Update:P(ll),Delete:P(ol),Property:P(hl),Native:P(cl)}},Xc="feature",Za="http://www.w3.org/2000/xmlns/",Va={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},ra={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},Wa={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},rl={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},Xa={"2.0.0":qa,"1.1.0":se,"1.0.0":ni},e0="1.1.0";class t0 extends ns{constructor(e){super(),e=e||{},this.version_=e.version?e.version:e0,this.featureType_=e.featureType,this.featureNS_=e.featureNS,this.gmlFormat_=e.gmlFormat?e.gmlFormat:new Xa[this.version_],this.schemaLocation_=e.schemaLocation?e.schemaLocation:rl[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(e){this.featureType_=e}readFeaturesFromNode(e,r){const i={node:e};Object.assign(i,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(i,this.getReadOptions(e,r||{}));const n=[i];let s;this.version_==="2.0.0"?s=tl:s=this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let a=k([],s,e,n,this.gmlFormat_);return a||(a=[]),a}readTransactionResponse(e){if(e){if(typeof e=="string"){const r=Nn(e);return this.readTransactionResponseFromDocument(r)}return Fn(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}}readFeatureCollectionMetadata(e){if(e){if(typeof e=="string"){const r=Nn(e);return this.readFeatureCollectionMetadataFromDocument(r)}return Fn(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}}readFeatureCollectionMetadataFromDocument(e){for(let r=e.firstChild;r;r=r.nextSibling)if(r.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(r)}readFeatureCollectionMetadataFromNode(e){const r={},i=Kt(e.getAttribute("numberOfFeatures"));return r.numberOfFeatures=i,k(r,tl,e,[],this.gmlFormat_)}readTransactionResponseFromDocument(e){for(let r=e.firstChild;r;r=r.nextSibling)if(r.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(r)}readTransactionResponseFromNode(e){return k({},Qm,e,[])}writeGetFeature(e){const r=ie(ra[this.version_],"GetFeature");r.setAttribute("service","WFS"),r.setAttribute("version",this.version_),e.handle&&r.setAttribute("handle",e.handle),e.outputFormat&&r.setAttribute("outputFormat",e.outputFormat),e.maxFeatures!==void 0&&r.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&r.setAttribute("resultType",e.resultType),e.startIndex!==void 0&&r.setAttribute("startIndex",String(e.startIndex)),e.count!==void 0&&r.setAttribute("count",String(e.count)),e.viewParams!==void 0&&r.setAttribute("viewParams",e.viewParams),r.setAttributeNS(Bi,"xsi:schemaLocation",this.schemaLocation_);const i={node:r};if(Object.assign(i,{version:this.version_,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,propertyNames:e.propertyNames?e.propertyNames:[]}),Gt(Array.isArray(e.featureTypes),"`options.featureTypes` must be an Array"),typeof e.featureTypes[0]=="string"){let n=e.filter;e.bbox&&(Gt(e.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),n=this.combineBboxAndFilter(e.geometryName,e.bbox,e.srsName,n)),Object.assign(i,{geometryName:e.geometryName,filter:n}),vl(r,e.featureTypes,[i])}else e.featureTypes.forEach(n=>{const s=this.combineBboxAndFilter(n.geometryName,n.bbox,e.srsName,e.filter);Object.assign(i,{geometryName:n.geometryName,filter:s}),vl(r,[n.name],[i])});return r}combineBboxAndFilter(e,r,i,n){const s=Ym(e,r,i);return n?Hm(n,s):s}writeTransaction(e,r,i,n){const s=[],a=n.version?n.version:this.version_,o=ie(ra[a],"Transaction");o.setAttribute("service","WFS"),o.setAttribute("version",a);let l;n&&(l=n.gmlOptions?n.gmlOptions:{},n.handle&&o.setAttribute("handle",n.handle)),o.setAttributeNS(Bi,"xsi:schemaLocation",rl[a]);const h=r0(o,l,a,n);return e&&yn("Insert",e,s,h),r&&yn("Update",r,s,h),i&&yn("Delete",i,s,h),n.nativeElements&&yn("Native",n.nativeElements,s,h),o}readProjectionFromDocument(e){for(let r=e.firstChild;r;r=r.nextSibling)if(r.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(r);return null}readProjectionFromNode(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild){e=e.firstElementChild.firstElementChild;for(let r=e.firstElementChild;r;r=r.nextElementSibling)if(!(r.childNodes.length===0||r.childNodes.length===1&&r.firstChild.nodeType===3)){const i=[{}];return this.gmlFormat_.readGeometryElement(r,i),de(i.pop().srsName)}}return null}}function r0(t,e,r,i){const n=i.featurePrefix?i.featurePrefix:Xc;let s;return r==="1.0.0"?s=2:r==="1.1.0"?s=3:r==="2.0.0"&&(s=3.2),Object.assign({node:t},{version:r,featureNS:i.featureNS,featureType:i.featureType,featurePrefix:n,gmlVersion:s,hasZ:i.hasZ,srsName:i.srsName},e)}function yn(t,e,r,i){Me(i,Wc,lt(t),e,r)}function il(t,e){return k({},Km,t,e)}const i0={"http://www.opengis.net/ogc":{FeatureId:H(function(t,e){return t.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:H(function(t,e){return t.getAttribute("fid")})}};function nl(t,e){Qt(i0,t,e)}const n0={"http://www.opengis.net/wfs":{Feature:nl},"http://www.opengis.net/wfs/2.0":{Feature:nl}};function sl(t,e){return k([],n0,t,e)}function al(t,e,r){const i=r[r.length-1],n=i.featureType,s=i.featureNS,a=i.gmlVersion,o=ie(s,n);t.appendChild(o),a===2?ni.prototype.writeFeatureElement(o,e,r):a===3?se.prototype.writeFeatureElement(o,e,r):qa.prototype.writeFeatureElement(o,e,r)}function Hc(t,e,r){const n=r[r.length-1].version,s=Va[n],a=ie(s,"Filter"),o=ie(s,"FeatureId");a.appendChild(o),o.setAttribute("fid",e),t.appendChild(a)}function Ha(t,e){t=t||Xc;const r=t+":";return e.startsWith(r)?e:r+e}function ol(t,e,r){const i=r[r.length-1];Gt(e.getId()!==void 0,"Features must have an id set");const n=i.featureType,s=i.featurePrefix,a=i.featureNS,o=Ha(s,n);t.setAttribute("typeName",o),t.setAttributeNS(Za,"xmlns:"+s,a);const l=e.getId();l!==void 0&&Hc(t,l,r)}function ll(t,e,r){const i=r[r.length-1];Gt(e.getId()!==void 0,"Features must have an id set");const n=i.version,s=i.featureType,a=i.featurePrefix,o=i.featureNS,l=Ha(a,s),h=e.getGeometryName();t.setAttribute("typeName",l),t.setAttributeNS(Za,"xmlns:"+a,o);const u=e.getId();if(u!==void 0){const c=e.getKeys(),d=[];for(let g=0,p=c.length;g<p;g++){const y=e.get(c[g]);if(y!==void 0){let _=c[g];y&&typeof y.getSimplifiedGeometry=="function"&&(_=h),d.push({name:_,value:y})}}Me({version:n,gmlVersion:i.gmlVersion,node:t,hasZ:i.hasZ,srsName:i.srsName},Wc,lt("Property"),d,r),Hc(t,u,r)}}function hl(t,e,r){const i=r[r.length-1],n=i.version,s=ra[n],o=ie(s,n==="2.0.0"?"ValueReference":"Name"),l=i.gmlVersion;if(t.appendChild(o),le(o,e.name),e.value!==void 0&&e.value!==null){const h=ie(s,"Value");t.appendChild(h),e.value&&typeof e.value.getSimplifiedGeometry=="function"?l===2?ni.prototype.writeGeometryElement(h,e.value,r):l===3?se.prototype.writeGeometryElement(h,e.value,r):qa.prototype.writeGeometryElement(h,e.value,r):le(h,e.value)}}function cl(t,e,r){e.vendorId&&t.setAttribute("vendorId",e.vendorId),e.safeToIgnore!==void 0&&t.setAttribute("safeToIgnore",String(e.safeToIgnore)),e.value!==void 0&&le(t,e.value)}const ds={"http://www.opengis.net/wfs":{Query:P(ul)},"http://www.opengis.net/wfs/2.0":{Query:P(ul)},"http://www.opengis.net/ogc":{During:P(gl),And:P(_n),Or:P(_n),Not:P(pl),BBOX:P(fl),Contains:P(Ht),Intersects:P(Ht),Within:P(Ht),DWithin:P(dl),PropertyIsEqualTo:P(dt),PropertyIsNotEqualTo:P(dt),PropertyIsLessThan:P(dt),PropertyIsLessThanOrEqualTo:P(dt),PropertyIsGreaterThan:P(dt),PropertyIsGreaterThanOrEqualTo:P(dt),PropertyIsNull:P(ml),PropertyIsBetween:P(yl),PropertyIsLike:P(_l)},"http://www.opengis.net/fes/2.0":{During:P(gl),And:P(_n),Or:P(_n),Not:P(pl),BBOX:P(fl),Contains:P(Ht),Disjoint:P(Ht),Intersects:P(Ht),ResourceId:P(a0),Within:P(Ht),DWithin:P(dl),PropertyIsEqualTo:P(dt),PropertyIsNotEqualTo:P(dt),PropertyIsLessThan:P(dt),PropertyIsLessThanOrEqualTo:P(dt),PropertyIsGreaterThan:P(dt),PropertyIsGreaterThanOrEqualTo:P(dt),PropertyIsNull:P(ml),PropertyIsBetween:P(yl),PropertyIsLike:P(_l)}};function ul(t,e,r){const i=r[r.length-1],n=i.version,s=i.featurePrefix,a=i.featureNS,o=i.propertyNames,l=i.srsName;let h;s?h=Ha(s,e):h=e;let u;n==="2.0.0"?u="typeNames":u="typeName",t.setAttribute(u,h),l&&t.setAttribute("srsName",l),a&&t.setAttributeNS(Za,"xmlns:"+s,a);const c=Object.assign({},i);c.node=t,Me(c,Jm,lt("PropertyName"),o,r);const d=i.filter;if(d){const g=ie(gs(n),"Filter");t.appendChild(g),s0(g,d,r)}}function s0(t,e,r){const i=r[r.length-1],n={node:t};Object.assign(n,{context:i}),Me(n,ds,lt(e.getTagName()),[e],r)}function fl(t,e,r){const i=r[r.length-1],s=i.context.version;i.srsName=e.srsName;const a=Xa[s];ai(s,t,e.geometryName),a.prototype.writeGeometryElement(t,e.extent,r)}function a0(t,e,r){t.setAttribute("rid",e.rid)}function Ht(t,e,r){const i=r[r.length-1],s=i.context.version;i.srsName=e.srsName;const a=Xa[s];ai(s,t,e.geometryName),a.prototype.writeGeometryElement(t,e.geometry,r)}function dl(t,e,r){const s=r[r.length-1].context.version;Ht(t,e,r);const a=ie(gs(s),"Distance");le(a,e.distance.toString()),s==="2.0.0"?a.setAttribute("uom",e.unit):a.setAttribute("units",e.unit),t.appendChild(a)}function gl(t,e,r){const s=r[r.length-1].context.version;jn(Wa[s],"ValueReference",t,e.propertyName);const a=ie(qt,"TimePeriod");t.appendChild(a);const o=ie(qt,"begin");a.appendChild(o),xl(o,e.begin);const l=ie(qt,"end");a.appendChild(l),xl(l,e.end)}function _n(t,e,r){const n=r[r.length-1].context,s={node:t};Object.assign(s,{context:n});const a=e.conditions;for(let o=0,l=a.length;o<l;++o){const h=a[o];Me(s,ds,lt(h.getTagName()),[h],r)}}function pl(t,e,r){const n=r[r.length-1].context,s={node:t};Object.assign(s,{context:n});const a=e.condition;Me(s,ds,lt(a.getTagName()),[a],r)}function dt(t,e,r){const s=r[r.length-1].context.version;e.matchCase!==void 0&&t.setAttribute("matchCase",e.matchCase.toString()),ai(s,t,e.propertyName),qn(s,t,""+e.expression)}function ml(t,e,r){const s=r[r.length-1].context.version;ai(s,t,e.propertyName)}function yl(t,e,r){const s=r[r.length-1].context.version,a=gs(s);ai(s,t,e.propertyName);const o=ie(a,"LowerBoundary");t.appendChild(o),qn(s,o,""+e.lowerBoundary);const l=ie(a,"UpperBoundary");t.appendChild(l),qn(s,l,""+e.upperBoundary)}function _l(t,e,r){const s=r[r.length-1].context.version;t.setAttribute("wildCard",e.wildCard),t.setAttribute("singleChar",e.singleChar),t.setAttribute("escapeChar",e.escapeChar),e.matchCase!==void 0&&t.setAttribute("matchCase",e.matchCase.toString()),ai(s,t,e.propertyName),qn(s,t,""+e.pattern)}function jn(t,e,r,i){const n=ie(t,e);le(n,i),r.appendChild(n)}function qn(t,e,r){jn(gs(t),"Literal",e,r)}function ai(t,e,r){t==="2.0.0"?jn(Wa[t],"ValueReference",e,r):jn(Va[t],"PropertyName",e,r)}function xl(t,e){const r=ie(qt,"TimeInstant");t.appendChild(r);const i=ie(qt,"timePosition");r.appendChild(i),le(i,e)}function vl(t,e,r){const i=r[r.length-1],n=Object.assign({},i);n.node=t,Me(n,ds,lt("Query"),e,r)}function gs(t){let e;return t==="2.0.0"?e=Wa[t]:e=Va[t],e}const o0=t0,Ee={POINT:1,LINE_STRING:2,POLYGON:3,MULTI_POINT:4,MULTI_LINE_STRING:5,MULTI_POLYGON:6,GEOMETRY_COLLECTION:7,POLYHEDRAL_SURFACE:15,TIN:16,TRIANGLE:17};class El{constructor(e){this.view_=e,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_="XY"}readUint8(){return this.view_.getUint8(this.pos_++)}readUint32(e){return this.view_.getUint32((this.pos_+=4)-4,e!==void 0?e:this.isLittleEndian_)}readDouble(e){return this.view_.getFloat64((this.pos_+=8)-8,e!==void 0?e:this.isLittleEndian_)}readPoint(){const e=[];return e.push(this.readDouble()),e.push(this.readDouble()),this.hasZ_&&e.push(this.readDouble()),this.hasM_&&e.push(this.readDouble()),e}readLineString(){const e=this.readUint32(),r=[];for(let i=0;i<e;i++)r.push(this.readPoint());return r}readPolygon(){const e=this.readUint32(),r=[];for(let i=0;i<e;i++)r.push(this.readLineString());return r}readWkbHeader(e){const i=this.readUint8()>0,n=this.readUint32(i),s=Math.floor((n&268435455)/1e3),a=!!(n&2147483648)||s===1||s===3,o=!!(n&1073741824)||s===2||s===3,l=!!(n&536870912),h=(n&268435455)%1e3,u=["XY",a?"Z":"",o?"M":""].join(""),c=l?this.readUint32(i):null;if(e!==void 0&&e!==h)throw new Error("Unexpected WKB geometry type "+h);if(this.initialized_){if(this.isLittleEndian_!==i)throw new Error("Inconsistent endian");if(this.layout_!==u)throw new Error("Inconsistent geometry layout");if(c&&this.srid_!==c)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=i,this.hasZ_=a,this.hasM_=o,this.layout_=u,this.srid_=c,this.initialized_=!0;return h}readWkbPayload(e){switch(e){case Ee.POINT:return this.readPoint();case Ee.LINE_STRING:return this.readLineString();case Ee.POLYGON:case Ee.TRIANGLE:return this.readPolygon();case Ee.MULTI_POINT:return this.readMultiPoint();case Ee.MULTI_LINE_STRING:return this.readMultiLineString();case Ee.MULTI_POLYGON:case Ee.POLYHEDRAL_SURFACE:case Ee.TIN:return this.readMultiPolygon();case Ee.GEOMETRY_COLLECTION:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+e+" is found")}}readWkbBlock(e){return this.readWkbPayload(this.readWkbHeader(e))}readWkbCollection(e,r){const i=this.readUint32(),n=[];for(let s=0;s<i;s++){const a=e.call(this,r);a&&n.push(a)}return n}readMultiPoint(){return this.readWkbCollection(this.readWkbBlock,Ee.POINT)}readMultiLineString(){return this.readWkbCollection(this.readWkbBlock,Ee.LINE_STRING)}readMultiPolygon(){return this.readWkbCollection(this.readWkbBlock,Ee.POLYGON)}readGeometryCollection(){return this.readWkbCollection(this.readGeometry)}readGeometry(){const e=this.readWkbHeader(),r=this.readWkbPayload(e);switch(e){case Ee.POINT:return new Et(r,this.layout_);case Ee.LINE_STRING:return new Dt(r,this.layout_);case Ee.POLYGON:case Ee.TRIANGLE:return new en(r,this.layout_);case Ee.MULTI_POINT:return new is(r,this.layout_);case Ee.MULTI_LINE_STRING:return new ei(r,this.layout_);case Ee.MULTI_POLYGON:case Ee.POLYHEDRAL_SURFACE:case Ee.TIN:return new Ji(r,this.layout_);case Ee.GEOMETRY_COLLECTION:return new rr(r);default:return null}}getSrid(){return this.srid_}}class l0{constructor(e){e=e||{},this.layout_=e.layout,this.isLittleEndian_=e.littleEndian!==!1,this.isEWKB_=e.ewkb!==!1,this.writeQueue_=[],this.nodata_=Object.assign({X:0,Y:0,Z:0,M:0},e.nodata)}writeUint8(e){this.writeQueue_.push([1,e])}writeUint32(e){this.writeQueue_.push([4,e])}writeDouble(e){this.writeQueue_.push([8,e])}writePoint(e,r){const i=Object.assign.apply(null,r.split("").map((n,s)=>({[n]:e[s]})));for(const n of this.layout_)this.writeDouble(n in i?i[n]:this.nodata_[n])}writeLineString(e,r){this.writeUint32(e.length);for(let i=0;i<e.length;i++)this.writePoint(e[i],r)}writePolygon(e,r){this.writeUint32(e.length);for(let i=0;i<e.length;i++)this.writeLineString(e[i],r)}writeWkbHeader(e,r){e%=1e3,this.layout_.includes("Z")&&(e+=this.isEWKB_?2147483648:1e3),this.layout_.includes("M")&&(e+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(r)&&(e|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(e),this.isEWKB_&&Number.isInteger(r)&&this.writeUint32(r)}writeMultiPoint(e,r){this.writeUint32(e.length);for(let i=0;i<e.length;i++)this.writeWkbHeader(1),this.writePoint(e[i],r)}writeMultiLineString(e,r){this.writeUint32(e.length);for(let i=0;i<e.length;i++)this.writeWkbHeader(2),this.writeLineString(e[i],r)}writeMultiPolygon(e,r){this.writeUint32(e.length);for(let i=0;i<e.length;i++)this.writeWkbHeader(3),this.writePolygon(e[i],r)}writeGeometryCollection(e){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeGeometry(e[r])}findMinimumLayout(e,r="XYZM"){const i=(n,s)=>n===s?n:n==="XYZM"?s:s==="XYZM"?n:"XY";if(e instanceof zo)return i(e.getLayout(),r);if(e instanceof rr){const n=e.getGeometriesArray();for(let s=0;s<n.length&&r!=="XY";s++)r=this.findMinimumLayout(n[s],r)}return r}writeGeometry(e,r){const i={Point:Ee.POINT,LineString:Ee.LINE_STRING,Polygon:Ee.POLYGON,MultiPoint:Ee.MULTI_POINT,MultiLineString:Ee.MULTI_LINE_STRING,MultiPolygon:Ee.MULTI_POLYGON,GeometryCollection:Ee.GEOMETRY_COLLECTION},n=e.getType(),s=i[n];if(!s)throw new Error("GeometryType "+n+" is not supported");this.layout_||(this.layout_=this.findMinimumLayout(e)),this.writeWkbHeader(s,r),e instanceof zo?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[n].call(this,e.getCoordinates(),e.getLayout()):e instanceof rr&&this.writeGeometryCollection(e.getGeometriesArray())}getBuffer(){const e=this.writeQueue_.reduce((s,a)=>s+a[0],0),r=new ArrayBuffer(e),i=new DataView(r);let n=0;return this.writeQueue_.forEach(s=>{switch(s[0]){case 1:i.setUint8(n,s[1]);break;case 4:i.setUint32(n,s[1],this.isLittleEndian_);break;case 8:i.setFloat64(n,s[1],this.isLittleEndian_);break}n+=s[0]}),r}}class h0 extends xc{constructor(e){super(),e=e||{},this.splitCollection=!!e.splitCollection,this.viewCache_=null,this.hex_=e.hex!==!1,this.littleEndian_=e.littleEndian!==!1,this.ewkb_=e.ewkb!==!1,this.layout_=e.geometryLayout,this.nodataZ_=e.nodataZ||0,this.nodataM_=e.nodataM||0,this.srid_=e.srid}getType(){return this.hex_?"text":"arraybuffer"}readFeature(e,r){return new ut({geometry:this.readGeometry(e,r)})}readFeatures(e,r){let i=[];const n=this.readGeometry(e,r);return this.splitCollection&&n instanceof rr?i=n.getGeometriesArray():i=[n],i.map(s=>new ut({geometry:s}))}readGeometry(e,r){const i=wl(e);if(!i)return null;const s=new El(i).readGeometry();return this.viewCache_=i,r=this.getReadOptions(e,r),this.viewCache_=null,ze(s,!1,r)}readProjection(e){const r=this.viewCache_||wl(e);if(!r)return;const i=new El(r);return i.readWkbHeader(),i.getSrid()&&de("EPSG:"+i.getSrid())||void 0}writeFeature(e,r){return this.writeGeometry(e.getGeometry(),r)}writeFeatures(e,r){return this.writeGeometry(new rr(e.map(i=>i.getGeometry())),r)}writeGeometry(e,r){r=this.adaptOptions(r);const i=new l0({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}});let n=Number.isInteger(this.srid_)?Number(this.srid_):null;if(this.srid_!==!1&&!Number.isInteger(this.srid_)){const a=r.dataProjection&&de(r.dataProjection);if(a){const o=a.getCode();o.startsWith("EPSG:")&&(n=Number(o.substring(5)))}}i.writeGeometry(ze(e,!0,r),n);const s=i.getBuffer();return this.hex_?c0(s):s}}function c0(t){const e=new Uint8Array(t);return Array.from(e.values()).map(r=>(r<16?"0":"")+Number(r).toString(16).toUpperCase()).join("")}function u0(t){const e=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)e[r]=parseInt(t.substr(r*2,2),16);return new DataView(e.buffer)}function wl(t){return typeof t=="string"?u0(t):ArrayBuffer.isView(t)?t instanceof DataView?t:new DataView(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer?new DataView(t):null}const f0=h0,d0={POINT:Et,LINESTRING:Dt,POLYGON:en,MULTIPOINT:is,MULTILINESTRING:ei,MULTIPOLYGON:Ji},Yc="EMPTY",Kc="Z",Qc="M",g0="ZM",xe={START:0,TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6},p0={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class m0{constructor(e){this.wkt=e,this.index_=-1}isAlpha_(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}isNumeric_(e,r){return r=r!==void 0?r:!1,e>="0"&&e<="9"||e=="."&&!r}isWhiteSpace_(e){return e==" "||e=="	"||e=="\r"||e==`
`}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const e=this.nextChar_(),r=this.index_;let i=e,n;if(e=="(")n=xe.LEFT_PAREN;else if(e==",")n=xe.COMMA;else if(e==")")n=xe.RIGHT_PAREN;else if(this.isNumeric_(e)||e=="-")n=xe.NUMBER,i=this.readNumber_();else if(this.isAlpha_(e))n=xe.TEXT,i=this.readText_();else{if(this.isWhiteSpace_(e))return this.nextToken();if(e==="")n=xe.EOF;else throw new Error("Unexpected character: "+e)}return{position:r,value:i,type:n}}readNumber_(){let e;const r=this.index_;let i=!1,n=!1;do e=="."?i=!0:(e=="e"||e=="E")&&(n=!0),e=this.nextChar_();while(this.isNumeric_(e,i)||!n&&(e=="e"||e=="E")||n&&(e=="-"||e=="+"));return parseFloat(this.wkt.substring(r,this.index_--))}readText_(){let e;const r=this.index_;do e=this.nextChar_();while(this.isAlpha_(e));return this.wkt.substring(r,this.index_--).toUpperCase()}}let y0=class{constructor(e){this.lexer_=e,this.token_={position:0,type:xe.START},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(e){return this.token_.type==e}match(e){const r=this.isTokenType(e);return r&&this.consume_(),r}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let e="XY";const r=this.token_;if(this.isTokenType(xe.TEXT)){const i=r.value;i===Kc?e="XYZ":i===Qc?e="XYM":i===g0&&(e="XYZM"),e!=="XY"&&this.consume_()}return e}parseGeometryCollectionText_(){if(this.match(xe.LEFT_PAREN)){const e=[];do e.push(this.parseGeometry_());while(this.match(xe.COMMA));if(this.match(xe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(xe.LEFT_PAREN)){const e=this.parsePoint_();if(this.match(xe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(xe.LEFT_PAREN)){const e=this.parsePointList_();if(this.match(xe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(xe.LEFT_PAREN)){const e=this.parseLineStringTextList_();if(this.match(xe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(xe.LEFT_PAREN)){let e;if(this.token_.type==xe.LEFT_PAREN?e=this.parsePointTextList_():e=this.parsePointList_(),this.match(xe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(xe.LEFT_PAREN)){const e=this.parseLineStringTextList_();if(this.match(xe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(xe.LEFT_PAREN)){const e=this.parsePolygonTextList_();if(this.match(xe.RIGHT_PAREN))return e}throw new Error(this.formatErrorMessage_())}parsePoint_(){const e=[],r=this.layout_.length;for(let i=0;i<r;++i){const n=this.token_;if(this.match(xe.NUMBER))e.push(n.value);else break}if(e.length==r)return e;throw new Error(this.formatErrorMessage_())}parsePointList_(){const e=[this.parsePoint_()];for(;this.match(xe.COMMA);)e.push(this.parsePoint_());return e}parsePointTextList_(){const e=[this.parsePointText_()];for(;this.match(xe.COMMA);)e.push(this.parsePointText_());return e}parseLineStringTextList_(){const e=[this.parseLineStringText_()];for(;this.match(xe.COMMA);)e.push(this.parseLineStringText_());return e}parsePolygonTextList_(){const e=[this.parsePolygonText_()];for(;this.match(xe.COMMA);)e.push(this.parsePolygonText_());return e}isEmptyGeometry_(){const e=this.isTokenType(xe.TEXT)&&this.token_.value==Yc;return e&&this.consume_(),e}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const e=this.token_;if(this.match(xe.TEXT)){const r=e.value;this.layout_=this.parseGeometryLayout_();const i=this.isEmptyGeometry_();if(r=="GEOMETRYCOLLECTION"){if(i)return new rr([]);const a=this.parseGeometryCollectionText_();return new rr(a)}const n=d0[r];if(!n)throw new Error("Invalid geometry type: "+r);let s;if(i)r=="POINT"?s=[NaN,NaN]:s=[];else switch(r){case"POINT":{s=this.parsePointText_();break}case"LINESTRING":{s=this.parseLineStringText_();break}case"POLYGON":{s=this.parsePolygonText_();break}case"MULTIPOINT":{s=this.parseMultiPointText_();break}case"MULTILINESTRING":{s=this.parseMultiLineStringText_();break}case"MULTIPOLYGON":{s=this.parseMultiPolygonText_();break}}return new n(s,this.layout_)}throw new Error(this.formatErrorMessage_())}};class _0 extends $a{constructor(e){super(),e=e||{},this.splitCollection_=e.splitCollection!==void 0?e.splitCollection:!1}parse_(e){const r=new m0(e);return new y0(r).parse()}readFeatureFromText(e,r){const i=this.readGeometryFromText(e,r),n=new ut;return n.setGeometry(i),n}readFeaturesFromText(e,r){let i=[];const n=this.readGeometryFromText(e,r);this.splitCollection_&&n.getType()=="GeometryCollection"?i=n.getGeometriesArray():i=[n];const s=[];for(let a=0,o=i.length;a<o;++a){const l=new ut;l.setGeometry(i[a]),s.push(l)}return s}readGeometryFromText(e,r){const i=this.parse_(e);return ze(i,!1,r)}writeFeatureText(e,r){const i=e.getGeometry();return i?this.writeGeometryText(i,r):""}writeFeaturesText(e,r){if(e.length==1)return this.writeFeatureText(e[0],r);const i=[];for(let s=0,a=e.length;s<a;++s)i.push(e[s].getGeometry());const n=new rr(i);return this.writeGeometryText(n,r)}writeGeometryText(e,r){return tu(ze(e,!0,r))}}function Jc(t){const e=t.getCoordinates();return e.length===0?"":e.join(" ")}function x0(t){const e=[],r=t.getPoints();for(let i=0,n=r.length;i<n;++i)e.push("("+Jc(r[i])+")");return e.join(",")}function v0(t){const e=[],r=t.getGeometries();for(let i=0,n=r.length;i<n;++i)e.push(tu(r[i]));return e.join(",")}function Ya(t){const e=t.getCoordinates(),r=[];for(let i=0,n=e.length;i<n;++i)r.push(e[i].join(" "));return r.join(",")}function E0(t){const e=[],r=t.getLineStrings();for(let i=0,n=r.length;i<n;++i)e.push("("+Ya(r[i])+")");return e.join(",")}function eu(t){const e=[],r=t.getLinearRings();for(let i=0,n=r.length;i<n;++i)e.push("("+Ya(r[i])+")");return e.join(",")}function w0(t){const e=[],r=t.getPolygons();for(let i=0,n=r.length;i<n;++i)e.push("("+eu(r[i])+")");return e.join(",")}function T0(t){const e=t.getLayout();let r="";return(e==="XYZ"||e==="XYZM")&&(r+=Kc),(e==="XYM"||e==="XYZM")&&(r+=Qc),r}const S0={Point:Jc,LineString:Ya,Polygon:eu,MultiPoint:x0,MultiLineString:E0,MultiPolygon:w0,GeometryCollection:v0};function tu(t){const e=t.getType(),r=S0[e],i=r(t);let n=p0[e];if(typeof t.getFlatCoordinates=="function"){const s=T0(t);s.length>0&&(n+=" "+s)}return i.length===0?n+" "+Yc:n+"("+i+")"}const M0=_0,qe=[null,"http://www.opengis.net/wms"],b0=q(qe,{Service:b(W0),Capability:b(V0)}),R0=q(qe,{Request:b(ey),Exception:b(K0),Layer:b(Q0)});class P0 extends ja{constructor(){super(),this.version=void 0}readFromNode(e){this.version=e.getAttribute("version").trim();const r=k({version:this.version},b0,e,[]);return r||null}}const A0=q(qe,{Name:b(U),Title:b(U),Abstract:b(U),KeywordList:b(su),OnlineResource:b(si),ContactInformation:b(X0),Fees:b(U),AccessConstraints:b(U),LayerLimit:b(Ce),MaxWidth:b(Ce),MaxHeight:b(Ce)}),I0=q(qe,{ContactPersonPrimary:b(H0),ContactPosition:b(U),ContactAddress:b(Y0),ContactVoiceTelephone:b(U),ContactFacsimileTelephone:b(U),ContactElectronicMailAddress:b(U)}),L0=q(qe,{ContactPerson:b(U),ContactOrganization:b(U)}),C0=q(qe,{AddressType:b(U),Address:b(U),City:b(U),StateOrProvince:b(U),PostCode:b(U),Country:b(U)}),O0=q(qe,{Format:H(U)}),ru=q(qe,{Name:b(U),Title:b(U),Abstract:b(U),KeywordList:b(su),CRS:be(U),EX_GeographicBoundingBox:b(Z0),BoundingBox:be(q0),Dimension:be(J0),Attribution:b(j0),AuthorityURL:be(iy),Identifier:be(U),MetadataURL:be(ny),DataURL:be(Vt),FeatureListURL:be(Vt),Style:be(sy),MinScaleDenominator:b(We),MaxScaleDenominator:b(We),Layer:be(iu)}),N0=q(qe,{Title:b(U),OnlineResource:b(si),LogoURL:b(nu)}),F0=q(qe,{westBoundLongitude:b(We),eastBoundLongitude:b(We),southBoundLatitude:b(We),northBoundLatitude:b(We)}),D0=q(qe,{GetCapabilities:b(As),GetMap:b(As),GetFeatureInfo:b(As)}),G0=q(qe,{Format:be(U),DCPType:be(ty)}),U0=q(qe,{HTTP:b(ry)}),k0=q(qe,{Get:b(Vt),Post:b(Vt)}),B0=q(qe,{Name:b(U),Title:b(U),Abstract:b(U),LegendURL:be(nu),StyleSheetURL:b(Vt),StyleURL:b(Vt)}),z0=q(qe,{Format:b(U),OnlineResource:b(si)}),$0=q(qe,{Keyword:H(U)});function j0(t,e){return k({},N0,t,e)}function q0(t,e){const r=[Yt(t.getAttribute("minx")),Yt(t.getAttribute("miny")),Yt(t.getAttribute("maxx")),Yt(t.getAttribute("maxy"))],i=[Yt(t.getAttribute("resx")),Yt(t.getAttribute("resy"))];return{crs:t.getAttribute("CRS"),extent:r,res:i}}function Z0(t,e){const r=k({},F0,t,e);if(!r)return;const i=r.westBoundLongitude,n=r.southBoundLatitude,s=r.eastBoundLongitude,a=r.northBoundLatitude;if(!(i===void 0||n===void 0||s===void 0||a===void 0))return[i,n,s,a]}function V0(t,e){return k({},R0,t,e)}function W0(t,e){return k({},A0,t,e)}function X0(t,e){return k({},I0,t,e)}function H0(t,e){return k({},L0,t,e)}function Y0(t,e){return k({},C0,t,e)}function K0(t,e){return k([],O0,t,e)}function Q0(t,e){const r=k({},ru,t,e);return r.Layer===void 0?Object.assign(r,iu(t,e)):r}function iu(t,e){const r=e[e.length-1],i=k({},ru,t,e);if(!i)return;let n=qr(t.getAttribute("queryable"));n===void 0&&(n=r.queryable),i.queryable=n!==void 0?n:!1;let s=Kt(t.getAttribute("cascaded"));s===void 0&&(s=r.cascaded),i.cascaded=s;let a=qr(t.getAttribute("opaque"));a===void 0&&(a=r.opaque),i.opaque=a!==void 0?a:!1;let o=qr(t.getAttribute("noSubsets"));o===void 0&&(o=r.noSubsets),i.noSubsets=o!==void 0?o:!1;let l=Yt(t.getAttribute("fixedWidth"));l||(l=r.fixedWidth),i.fixedWidth=l;let h=Yt(t.getAttribute("fixedHeight"));return h||(h=r.fixedHeight),i.fixedHeight=h,["Style","CRS","AuthorityURL"].forEach(function(d){if(d in r){const g=i[d]||[];i[d]=g.concat(r[d])}}),["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"].forEach(function(d){if(!(d in i)){const g=r[d];i[d]=g}}),i}function J0(t,e){return{name:t.getAttribute("name"),units:t.getAttribute("units"),unitSymbol:t.getAttribute("unitSymbol"),default:t.getAttribute("default"),multipleValues:qr(t.getAttribute("multipleValues")),nearestValue:qr(t.getAttribute("nearestValue")),current:qr(t.getAttribute("current")),values:U(t)}}function Vt(t,e){return k({},z0,t,e)}function ey(t,e){return k({},D0,t,e)}function ty(t,e){return k({},U0,t,e)}function ry(t,e){return k({},k0,t,e)}function As(t,e){return k({},G0,t,e)}function nu(t,e){const r=Vt(t,e);if(r){const i=[Kt(t.getAttribute("width")),Kt(t.getAttribute("height"))];return r.size=i,r}}function iy(t,e){const r=Vt(t,e);if(r)return r.name=t.getAttribute("name"),r}function ny(t,e){const r=Vt(t,e);if(r)return r.type=t.getAttribute("type"),r}function sy(t,e){return k({},B0,t,e)}function su(t,e){return k([],$0,t,e)}const ay=P0,oy="_feature",ly="_layer";class hy extends ns{constructor(e){super(),e=e||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new ni,this.layers_=e.layers?e.layers:null}getLayers(){return this.layers_}setLayers(e){this.layers_=e}readFeatures_(e,r){e.setAttribute("namespaceURI",this.featureNS_);const i=e.localName;let n=[];if(e.childNodes.length===0)return n;if(i=="msGMLOutput")for(let s=0,a=e.childNodes.length;s<a;s++){const o=e.childNodes[s];if(o.nodeType!==Node.ELEMENT_NODE)continue;const l=o,h=r[0],u=ly,c=l.localName.replace(u,"");if(this.layers_&&!this.layers_.includes(c))continue;const d=c+oy;h.featureType=d,h.featureNS=this.featureNS_;const g={};g[d]=H(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const p=q([h.featureNS,null],g);l.setAttribute("namespaceURI",this.featureNS_);const y=k([],p,l,r,this.gmlFormat_);y&&On(n,y)}if(i=="FeatureCollection"){const s=k([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_);s&&(n=s)}return n}readFeaturesFromNode(e,r){const i={};return r&&Object.assign(i,this.getReadOptions(e,r)),this.readFeatures_(e,[i])}}const cy=hy,kt=[null,"http://www.opengis.net/wmts/1.0"],oi=[null,"http://www.opengis.net/ows/1.1"],uy=q(kt,{Contents:b(wy)});class fy extends ja{constructor(){super(),this.owsParser_=new Zc}readFromNode(e){let r=e.getAttribute("version");r&&(r=r.trim());let i=this.owsParser_.readFromNode(e);return i?(i.version=r,i=k(i,uy,e,[]),i||null):null}}const dy=q(kt,{Layer:be(Ty),TileMatrixSet:be(Sy)}),gy=q(kt,{Style:be(My),Format:be(U),TileMatrixSetLink:be(by),Dimension:be(Ry),ResourceURL:be(Py)},q(oi,{Title:b(U),Abstract:b(U),WGS84BoundingBox:b(ou),BoundingBox:be(Ay),Identifier:b(U)})),py=q(kt,{LegendURL:be(Iy)},q(oi,{Title:b(U),Identifier:b(U)})),my=q(kt,{TileMatrixSet:b(U),TileMatrixSetLimits:b(Cy)}),yy=q(kt,{TileMatrixLimits:H(Oy)}),_y=q(kt,{TileMatrix:b(U),MinTileRow:b(Ce),MaxTileRow:b(Ce),MinTileCol:b(Ce),MaxTileCol:b(Ce)}),xy=q(kt,{Default:b(U),Value:be(U)},q(oi,{Identifier:b(U)})),au=q(oi,{LowerCorner:H(ia),UpperCorner:H(ia)}),vy=q(kt,{WellKnownScaleSet:b(U),TileMatrix:be(Ly)},q(oi,{SupportedCRS:b(U),Identifier:b(U),BoundingBox:b(ou)})),Ey=q(kt,{TopLeftCorner:b(ia),ScaleDenominator:b(We),TileWidth:b(Ce),TileHeight:b(Ce),MatrixWidth:b(Ce),MatrixHeight:b(Ce)},q(oi,{Identifier:b(U)}));function wy(t,e){return k({},dy,t,e)}function Ty(t,e){return k({},gy,t,e)}function Sy(t,e){return k({},vy,t,e)}function My(t,e){const r=k({},py,t,e);if(!r)return;const i=t.getAttribute("isDefault")==="true";return r.isDefault=i,r}function by(t,e){return k({},my,t,e)}function Ry(t,e){return k({},xy,t,e)}function Py(t,e){const r=t.getAttribute("format"),i=t.getAttribute("template"),n=t.getAttribute("resourceType"),s={};return r&&(s.format=r),i&&(s.template=i),n&&(s.resourceType=n),s}function ou(t,e){const r=k([],au,t,e);if(r.length==2)return Ma(r)}function Ay(t,e){const r=t.getAttribute("crs"),i=k([],au,t,e);if(i.length==2)return{extent:Ma(i),crs:r}}function Iy(t,e){const r={};return r.format=t.getAttribute("format"),r.href=si(t),r}function ia(t,e){const r=U(t).split(/\s+/);if(!r||r.length!=2)return;const i=+r[0],n=+r[1];if(!(isNaN(i)||isNaN(n)))return[i,n]}function Ly(t,e){return k({},Ey,t,e)}function Cy(t,e){return k([],yy,t,e)}function Oy(t,e){return k({},_y,t,e)}const lu=fy,Ny=Object.freeze(Object.defineProperty({__proto__:null,EsriJSON:Wg,GML:Jg,GPX:kp,GeoJSON:vc,IGC:Vp,IIIFInfo:Jp,KML:Td,MVT:Ec,OWS:Zc,Polyline:zm,TopoJSON:Sd,WFS:o0,WKB:f0,WKT:M0,WMSCapabilities:ay,WMSGetFeatureInfo:cy,WMTSCapabilities:lu},Symbol.toStringTag,{value:"Module"}));function Fy(t){if(!(t.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const e=t.inversePixelTransform[0],r=t.inversePixelTransform[1],i=Math.sqrt(e*e+r*r),n=t.frameState,s=wc(t.inversePixelTransform.slice(),n.coordinateToPixelTransform),a=Md(n.viewState.resolution,i);let o;return new bd(t.context,i,n.extent,s,n.viewState.rotation,a,o)}function hu(t,e,r){const i=[];let n=t(0),s=t(1),a=e(n),o=e(s);const l=[s,n],h=[o,a],u=[1,0],c={};let d=1e5,g,p,y,_,v,E;for(;--d>0&&u.length>0;)y=u.pop(),n=l.pop(),a=h.pop(),E=y.toString(),E in c||(i.push(a[0],a[1]),c[E]=!0),_=u.pop(),s=l.pop(),o=h.pop(),v=(y+_)/2,g=t(v),p=e(g),Rd(p[0],p[1],a[0],a[1],o[0],o[1])<r?(i.push(o[0],o[1]),E=_.toString(),c[E]=!0):(u.push(_,v,v,y),h.push(o,p,p,a),l.push(s,g,g,n));return i}function Dy(t,e,r,i,n){const s=de("EPSG:4326");return hu(function(a){return[t,e+(r-e)*a]},Gn(s,i),n)}function Gy(t,e,r,i,n){const s=de("EPSG:4326");return hu(function(a){return[e+(r-e)*a,t]},Gn(s,i),n)}const Uy=new zi({color:"rgba(0,0,0,0.2)"}),ky=[90,45,30,20,10,5,2,1,30/60,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600];class By extends ba{constructor(e){e=e||{};const r=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},e);delete r.maxLines,delete r.strokeStyle,delete r.targetSize,delete r.showLabels,delete r.lonLabelFormatter,delete r.latLabelFormatter,delete r.lonLabelPosition,delete r.latLabelPosition,delete r.lonLabelStyle,delete r.latLabelStyle,delete r.intervals,super(r),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=e.targetSize!==void 0?e.targetSize:100,this.maxLines_=e.maxLines!==void 0?e.maxLines:100,this.meridians_=[],this.parallels_=[],this.strokeStyle_=e.strokeStyle!==void 0?e.strokeStyle:Uy,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,e.showLabels&&(this.lonLabelFormatter_=e.lonLabelFormatter==null?$o.bind(this,"EW"):e.lonLabelFormatter,this.latLabelFormatter_=e.latLabelFormatter==null?$o.bind(this,"NS"):e.latLabelFormatter,this.lonLabelPosition_=e.lonLabelPosition==null?0:e.lonLabelPosition,this.latLabelPosition_=e.latLabelPosition==null?1:e.latLabelPosition,this.lonLabelStyleBase_=new Di({text:e.lonLabelStyle!==void 0?e.lonLabelStyle.clone():new jo({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new Ys({color:"rgba(0,0,0,1)"}),stroke:new zi({color:"rgba(255,255,255,1)",width:3})})}),this.lonLabelStyle_=i=>{const n=i.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(n),this.lonLabelStyleBase_},this.latLabelStyleBase_=new Di({text:e.latLabelStyle!==void 0?e.latLabelStyle.clone():new jo({font:"12px Calibri,sans-serif",textAlign:"right",fill:new Ys({color:"rgba(0,0,0,1)"}),stroke:new zi({color:"rgba(255,255,255,1)",width:3})})}),this.latLabelStyle_=i=>{const n=i.get("graticule_label");return this.latLabelStyleBase_.getText().setText(n),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(fr.POSTRENDER,this.drawLabels_.bind(this))),this.intervals_=e.intervals!==void 0?e.intervals:ky,this.setSource(new as({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new Pd,overlaps:!1,useSpatialIndex:!1,wrapX:e.wrapX})),this.featurePool_=[],this.lineStyle_=new Di({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(e,r){let i=e.slice();return this.projection_&&this.getSource().getWrapX()&&Ad(i,this.projection_),this.loadedExtent_&&(Id(this.loadedExtent_,i,r)?i=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[i]}loaderFunction(e,r,i){this.loadedExtent_=e;const n=this.getSource(),s=this.getExtent()||[-1/0,-1/0,1/0,1/0],a=Ct(s,e);if(this.renderedExtent_&&Un(this.renderedExtent_,a)&&this.renderedResolution_===r||(this.renderedExtent_=a,this.renderedResolution_=r,Ra(a)))return;const o=Jt(a),l=r*r/4;(!this.projection_||!pi(this.projection_,i))&&this.updateProjectionInfo_(i),this.createGraticule_(a,o,r,l);let u=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(u+=this.meridians_.length),this.parallelsLabels_&&(u+=this.parallels_.length);let c;for(;u>this.featurePool_.length;)c=new ut,this.featurePool_.push(c);const d=n.getFeaturesCollection();d.clear();let g=0,p,y;for(p=0,y=this.meridians_.length;p<y;++p)c=this.featurePool_[g++],c.setGeometry(this.meridians_[p]),c.setStyle(this.lineStyle_),d.push(c);for(p=0,y=this.parallels_.length;p<y;++p)c=this.featurePool_[g++],c.setGeometry(this.parallels_[p]),c.setStyle(this.lineStyle_),d.push(c)}addMeridian_(e,r,i,n,s,a){const o=this.getMeridian_(e,r,i,n,a);if(Xr(o.getExtent(),s)){if(this.meridiansLabels_){const l=this.lonLabelFormatter_(e);a in this.meridiansLabels_?this.meridiansLabels_[a].text=l:this.meridiansLabels_[a]={geom:new Et([]),text:l}}this.meridians_[a++]=o}return a}addParallel_(e,r,i,n,s,a){const o=this.getParallel_(e,r,i,n,a);if(Xr(o.getExtent(),s)){if(this.parallelsLabels_){const l=this.latLabelFormatter_(e);a in this.parallelsLabels_?this.parallelsLabels_[a].text=l:this.parallelsLabels_[a]={geom:new Et([]),text:l}}this.parallels_[a++]=o}return a}drawLabels_(e){const r=e.frameState.viewState.rotation,i=e.frameState.viewState.resolution,n=e.frameState.size,s=e.frameState.extent,a=Jt(s);let o=s;if(r){const p=n[0]*i,y=n[1]*i;o=[a[0]-p/2,a[1]-y/2,a[0]+p/2,a[1]+y/2]}let l=0,h=0,u=this.latLabelPosition_<.5;const c=this.projection_.getExtent(),d=ht(c);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!Ln(c,s)){l=Math.floor((s[0]-c[0])/d),h=Math.ceil((s[2]-c[2])/d);const p=Math.abs(r)>Math.PI/2;u=u!==p}const g=Fy(e);for(let p=l;p<=h;++p){let y=this.meridians_.length+this.parallels_.length,_,v,E,w;if(this.meridiansLabels_)for(v=0,E=this.meridiansLabels_.length;v<E;++v){const T=this.meridians_[v];if(!r&&p===0)w=this.getMeridianPoint_(T,s,v);else{const M=T.clone();M.translate(p*d,0),M.rotate(-r,a),w=this.getMeridianPoint_(M,o,v),w.rotate(r,a)}_=this.featurePool_[y++],_.setGeometry(w),_.set("graticule_label",this.meridiansLabels_[v].text),g.drawFeature(_,this.lonLabelStyle_(_))}if(this.parallelsLabels_&&(p===l&&u||p===h&&!u))for(v=0,E=this.parallels_.length;v<E;++v){const T=this.parallels_[v];if(!r&&p===0)w=this.getParallelPoint_(T,s,v);else{const M=T.clone();M.translate(p*d,0),M.rotate(-r,a),w=this.getParallelPoint_(M,o,v),w.rotate(r,a)}_=this.featurePool_[y++],_.setGeometry(w),_.set("graticule_label",this.parallelsLabels_[v].text),g.drawFeature(_,this.latLabelStyle_(_))}}}createGraticule_(e,r,i,n){const s=this.getInterval_(i);if(s==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}let a=!1;const o=this.projection_.getExtent(),l=ht(o);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!Ln(o,e)&&(ht(e)>=l?(e[0]=o[0],e[2]=o[2]):a=!0);const h=[Ae(r[0],this.minX_,this.maxX_),Ae(r[1],this.minY_,this.maxY_)],u=this.toLonLatTransform_(h);isNaN(u[1])&&(u[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let c=Ae(u[0],this.minLon_,this.maxLon_),d=Ae(u[1],this.minLat_,this.maxLat_);const g=this.maxLines_;let p,y,_,v,E=e;a||(E=[Ae(e[0],this.minX_,this.maxX_),Ae(e[1],this.minY_,this.maxY_),Ae(e[2],this.minX_,this.maxX_),Ae(e[3],this.minY_,this.maxY_)]);const w=$i(E,this.toLonLatTransform_,void 0,8);let T=w[3],M=w[2],A=w[1],I=w[0];if(a||(Dr(E,this.bottomLeft_)&&(I=this.minLon_,A=this.minLat_),Dr(E,this.bottomRight_)&&(M=this.maxLon_,A=this.minLat_),Dr(E,this.topLeft_)&&(I=this.minLon_,T=this.maxLat_),Dr(E,this.topRight_)&&(M=this.maxLon_,T=this.maxLat_),T=Ae(T,d,this.maxLat_),M=Ae(M,c,this.maxLon_),A=Ae(A,this.minLat_,d),I=Ae(I,this.minLon_,c)),c=Math.floor(c/s)*s,v=Ae(c,this.minLon_,this.maxLon_),y=this.addMeridian_(v,A,T,n,e,0),p=0,a)for(;(v-=s)>=I&&p++<g;)y=this.addMeridian_(v,A,T,n,e,y);else for(;v!=this.minLon_&&p++<g;)v=Math.max(v-s,this.minLon_),y=this.addMeridian_(v,A,T,n,e,y);if(v=Ae(c,this.minLon_,this.maxLon_),p=0,a)for(;(v+=s)<=M&&p++<g;)y=this.addMeridian_(v,A,T,n,e,y);else for(;v!=this.maxLon_&&p++<g;)v=Math.min(v+s,this.maxLon_),y=this.addMeridian_(v,A,T,n,e,y);for(this.meridians_.length=y,this.meridiansLabels_&&(this.meridiansLabels_.length=y),d=Math.floor(d/s)*s,_=Ae(d,this.minLat_,this.maxLat_),y=this.addParallel_(_,I,M,n,e,0),p=0;_!=this.minLat_&&p++<g;)_=Math.max(_-s,this.minLat_),y=this.addParallel_(_,I,M,n,e,y);for(_=Ae(d,this.minLat_,this.maxLat_),p=0;_!=this.maxLat_&&p++<g;)_=Math.min(_+s,this.maxLat_),y=this.addParallel_(_,I,M,n,e,y);this.parallels_.length=y,this.parallelsLabels_&&(this.parallelsLabels_.length=y)}getInterval_(e){const r=this.projectionCenterLonLat_[0],i=this.projectionCenterLonLat_[1];let n=-1;const s=Math.pow(this.targetSize_*e,2),a=[],o=[];for(let l=0,h=this.intervals_.length;l<h;++l){const u=Ae(this.intervals_[l]/2,0,90),c=Ae(i,-90+u,90-u);if(a[0]=r-u,a[1]=c-u,o[0]=r+u,o[1]=c+u,this.fromLonLatTransform_(a,a),this.fromLonLatTransform_(o,o),Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2)<=s)break;n=this.intervals_[l]}return n}getMeridian_(e,r,i,n,s){const a=Dy(e,r,i,this.projection_,n);let o=this.meridians_[s];return o?(o.setFlatCoordinates("XY",a),o.changed()):(o=new Dt(a,"XY"),this.meridians_[s]=o),o}getMeridianPoint_(e,r,i){const n=e.getFlatCoordinates();let s=1,a=n.length-1;n[s]>n[a]&&(s=a,a=1);const o=Math.max(r[1],n[s]),l=Math.min(r[3],n[a]),h=Ae(r[1]+Math.abs(r[1]-r[3])*this.lonLabelPosition_,o,l),c=[n[s-1]+(n[a-1]-n[s-1])*(h-n[s])/(n[a]-n[s]),h],d=this.meridiansLabels_[i].geom;return d.setCoordinates(c),d}getMeridians(){return this.meridians_}getParallel_(e,r,i,n,s){const a=Gy(e,r,i,this.projection_,n);let o=this.parallels_[s];return o?(o.setFlatCoordinates("XY",a),o.changed()):o=new Dt(a,"XY"),o}getParallelPoint_(e,r,i){const n=e.getFlatCoordinates();let s=0,a=n.length-2;n[s]>n[a]&&(s=a,a=0);const o=Math.max(r[0],n[s]),l=Math.min(r[2],n[a]),h=Ae(r[0]+Math.abs(r[0]-r[2])*this.latLabelPosition_,o,l),u=n[s+1]+(n[a+1]-n[s+1])*(h-n[s])/(n[a]-n[s]),c=[h,u],d=this.parallelsLabels_[i].geom;return d.setCoordinates(c),d}getParallels(){return this.parallels_}updateProjectionInfo_(e){const r=de("EPSG:4326"),i=e.getWorldExtent();this.maxLat_=i[3],this.maxLon_=i[2],this.minLat_=i[1],this.minLon_=i[0];const n=Gn(e,r);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=n;else{const a=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(o,l,h){h=h||2;const u=n(o,l,h);for(let c=0,d=u.length;c<d;c+=h)u[c]<a&&(u[c]+=360);return u}}this.fromLonLatTransform_=Gn(r,e);const s=$i([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=s[0],this.maxX_=s[2],this.minY_=s[1],this.maxY_=s[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(Jt(e.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=e}}const zy=By,ps=34962,ms=34963,$y=35040,Ka=35044,na=35048,jy=5121,qy=5123,Zy=5125,cu=5126,Tl=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function Vy(t,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!Ld},e);const r=Tl.length;for(let i=0;i<r;++i)try{const n=t.getContext(Tl[i],e);if(n)return n}catch{}return null}const Wy={STATIC_DRAW:Ka,STREAM_DRAW:$y,DYNAMIC_DRAW:na};class Xy{constructor(e,r){this.array_=null,this.type_=e,Gt(e===ps||e===ms,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=r!==void 0?r:Wy.STATIC_DRAW}ofSize(e){return this.array_=new(Is(this.type_))(e),this}fromArray(e){return this.array_=Is(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(Is(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function Is(t){switch(t){case ps:return Float32Array;case ms:return Uint32Array;default:return Float32Array}}const Zn=Xy,xn={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},Hy=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,Yy=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class Ky{constructor(e){this.gl_=e.webGlContext;const r=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=r.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=r.createFramebuffer(),this.depthBuffer_=r.createRenderbuffer();const i=r.createShader(r.VERTEX_SHADER);r.shaderSource(i,e.vertexShader||Hy),r.compileShader(i);const n=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(n,e.fragmentShader||Yy),r.compileShader(n),this.renderTargetProgram_=r.createProgram(),r.attachShader(this.renderTargetProgram_,i),r.attachShader(this.renderTargetProgram_,n),r.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=r.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];r.bindBuffer(r.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),r.bufferData(r.ARRAY_BUFFER,new Float32Array(s),r.STATIC_DRAW),this.renderTargetAttribLocation_=r.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=r.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=r.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=r.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(a=>{this.uniforms_.push({value:e.uniforms[a],location:r.getUniformLocation(this.renderTargetProgram_,a)})})}getGL(){return this.gl_}init(e){const r=this.getGL(),i=[r.drawingBufferWidth*this.scaleRatio_,r.drawingBufferHeight*this.scaleRatio_];if(r.bindFramebuffer(r.FRAMEBUFFER,this.getFrameBuffer()),r.bindRenderbuffer(r.RENDERBUFFER,this.getDepthBuffer()),r.viewport(0,0,i[0],i[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==i[0]||this.renderTargetTextureSize_[1]!==i[1]){this.renderTargetTextureSize_=i;const n=0,s=r.RGBA,a=0,o=r.RGBA,l=r.UNSIGNED_BYTE,h=null;r.bindTexture(r.TEXTURE_2D,this.renderTargetTexture_),r.texImage2D(r.TEXTURE_2D,n,s,i[0],i[1],a,o,l,h),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.renderTargetTexture_,0),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,i[0],i[1]),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,this.depthBuffer_)}}apply(e,r,i,n){const s=this.getGL(),a=e.size;if(s.bindFramebuffer(s.FRAMEBUFFER,r?r.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!r){const l=De(s.canvas);if(!e.renderTargets[l]){const h=s.getContextAttributes();h&&h.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),e.renderTargets[l]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,a[0],a[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const o=e.layerStatesArray[e.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,o),this.applyUniforms(e),i&&i(s,e),s.drawArrays(s.TRIANGLES,0,6),n&&n(s,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const r=this.getGL();let i,n=1;this.uniforms_.forEach(function(s){if(i=typeof s.value=="function"?s.value(e):s.value,i instanceof HTMLCanvasElement||i instanceof ImageData)s.texture||(s.texture=r.createTexture()),r.activeTexture(r[`TEXTURE${n}`]),r.bindTexture(r.TEXTURE_2D,s.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),i instanceof ImageData?r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,i.width,i.height,0,r.UNSIGNED_BYTE,new Uint8Array(i.data)):r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,i),r.uniform1i(s.location,n++);else if(Array.isArray(i))switch(i.length){case 2:r.uniform2f(s.location,i[0],i[1]);return;case 3:r.uniform3f(s.location,i[0],i[1],i[2]);return;case 4:r.uniform4f(s.location,i[0],i[1],i[2],i[3]);return;default:return}else typeof i=="number"&&r.uniform1f(s.location,i)})}}const Sl=Ky;function uu(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function fu(t,e){return t[0]=e[0],t[1]=e[1],t[4]=e[2],t[5]=e[3],t[12]=e[4],t[13]=e[5],t}const zt={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},At={UNSIGNED_BYTE:jy,UNSIGNED_SHORT:qy,UNSIGNED_INT:Zy,FLOAT:cu},Vn={};function Ml(t){return"shared/"+t}let bl=0;function Qy(){const t="unique/"+bl;return bl+=1,t}function Jy(t){let e=Vn[t];if(!e){const r=document.createElement("canvas");r.width=1,r.height=1,r.style.position="absolute",r.style.left="0",e={users:0,context:Vy(r)},Vn[t]=e}return e.users+=1,e.context}function e_(t){const e=Vn[t];if(!e||(e.users-=1,e.users>0))return;const r=e.context,i=r.getExtension("WEBGL_lose_context");i&&i.loseContext();const n=r.canvas;n.width=1,n.height=1,delete Vn[t]}class t_ extends Tc{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?Ml(e.canvasCacheKey):Qy(),this.gl_=Jy(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const r=this.gl_.canvas;r.addEventListener(xn.LOST,this.boundHandleWebGLContextLost_),r.addEventListener(xn.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=wt(),this.offsetScaleMatrix_=wt(),this.tmpMat4_=uu(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(i=>new Sl({webGlContext:this.gl_,scaleRatio:i.scaleRatio,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,uniforms:i.uniforms})):[new Sl({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const r in e)this.uniforms_.push({name:r,value:e[r]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===Ml(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const r=this.gl_.getExtension(e);return this.extensionCache_[e]=r,r}bindBuffer(e){const r=this.gl_,i=De(e);let n=this.bufferCache_[i];if(!n){const s=r.createBuffer();n={buffer:e,webGlBuffer:s},this.bufferCache_[i]=n}r.bindBuffer(e.getType(),n.webGlBuffer)}flushBufferData(e){const r=this.gl_;this.bindBuffer(e),r.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const r=this.gl_,i=De(e),n=this.bufferCache_[i];n&&!r.isContextLost()&&r.deleteBuffer(n.webGlBuffer),delete this.bufferCache_[i]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(xn.LOST,this.boundHandleWebGLContextLost_),e.removeEventListener(xn.RESTORED,this.boundHandleWebGLContextRestored_),e_(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,r,i){const n=this.gl_,s=this.getCanvas(),a=e.size,o=e.pixelRatio;(s.width!==a[0]*o||s.height!==a[1]*o)&&(s.width=a[0]*o,s.height=a[1]*o,s.style.width=a[0]+"px",s.style.height=a[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(e);n.bindTexture(n.TEXTURE_2D,null),n.clearColor(0,0,0,0),n.depthRange(0,1),n.clearDepth(1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,r?n.ZERO:n.ONE_MINUS_SRC_ALPHA),i?(n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL)):n.disable(n.DEPTH_TEST)}bindTexture(e,r,i){const n=this.gl_;n.activeTexture(n.TEXTURE0+r),n.bindTexture(n.TEXTURE_2D,e),n.uniform1i(this.getUniformLocation(i),r)}prepareDrawToRenderTarget(e,r,i,n){const s=this.gl_,a=r.getSize();s.bindFramebuffer(s.FRAMEBUFFER,r.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,r.getDepthbuffer()),s.viewport(0,0,a[0],a[1]),s.bindTexture(s.TEXTURE_2D,r.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,i?s.ZERO:s.ONE_MINUS_SRC_ALPHA),n?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(e,r){const i=this.gl_;this.getExtension("OES_element_index_uint");const n=i.UNSIGNED_INT,s=4,a=r-e,o=e*s;i.drawElements(i.TRIANGLES,a,n,o)}finalizeDraw(e,r,i){for(let n=0,s=this.postProcessPasses_.length;n<s;n++)n===s-1?this.postProcessPasses_[n].apply(e,null,r,i):this.postProcessPasses_[n].apply(e,this.postProcessPasses_[n+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const r=e.size,i=e.viewState.rotation,n=e.pixelRatio;this.setUniformFloatValue(zt.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(zt.ZOOM,e.viewState.zoom),this.setUniformFloatValue(zt.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(zt.PIXEL_RATIO,n),this.setUniformFloatVec2(zt.VIEWPORT_SIZE_PX,[r[0],r[1]]),this.setUniformFloatValue(zt.ROTATION,i)}applyHitDetectionUniform(e){const r=this.getUniformLocation(zt.HIT_DETECTION);this.getGL().uniform1i(r,e?1:0),e&&this.setUniformFloatValue(zt.PIXEL_RATIO,.5)}applyUniforms(e){const r=this.gl_;let i,n=0;this.uniforms_.forEach(s=>{if(i=typeof s.value=="function"?s.value(e):s.value,i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof ImageData||i instanceof WebGLTexture){i instanceof WebGLTexture&&!s.texture?(s.prevValue=void 0,s.texture=i):s.texture||(s.prevValue=void 0,s.texture=r.createTexture()),this.bindTexture(s.texture,n,s.name),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);const a=!(i instanceof HTMLImageElement)||i.complete;!(i instanceof WebGLTexture)&&a&&s.prevValue!==i&&(s.prevValue=i,r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,i)),n++}else if(Array.isArray(i)&&i.length===6)this.setUniformMatrixValue(s.name,fu(this.tmpMat4_,i));else if(Array.isArray(i)&&i.length<=4)switch(i.length){case 2:r.uniform2f(this.getUniformLocation(s.name),i[0],i[1]);return;case 3:r.uniform3f(this.getUniformLocation(s.name),i[0],i[1],i[2]);return;case 4:r.uniform4f(this.getUniformLocation(s.name),i[0],i[1],i[2],i[3]);return;default:return}else typeof i=="number"&&r.uniform1f(this.getUniformLocation(s.name),i)})}useProgram(e,r){this.gl_.useProgram(e),this.currentProgram_=e,this.applyFrameState(r),this.applyUniforms(r)}compileShader(e,r){const i=this.gl_,n=i.createShader(r);return i.shaderSource(n,e),i.compileShader(n),n}getProgram(e,r){const i=this.gl_,n=this.compileShader(e,i.FRAGMENT_SHADER),s=this.compileShader(r,i.VERTEX_SHADER),a=i.createProgram();if(i.attachShader(a,n),i.attachShader(a,s),i.linkProgram(a),!i.getShaderParameter(n,i.COMPILE_STATUS)){const o=`Fragment shader compilation failed: ${i.getShaderInfoLog(n)}`;throw new Error(o)}if(i.deleteShader(n),!i.getShaderParameter(s,i.COMPILE_STATUS)){const o=`Vertex shader compilation failed: ${i.getShaderInfoLog(s)}`;throw new Error(o)}if(i.deleteShader(s),!i.getProgramParameter(a,i.LINK_STATUS)){const o=`GL program linking failed: ${i.getProgramInfoLog(a)}`;throw new Error(o)}return a}getUniformLocation(e){const r=De(this.currentProgram_);return this.uniformLocationsByProgram_[r]===void 0&&(this.uniformLocationsByProgram_[r]={}),this.uniformLocationsByProgram_[r][e]===void 0&&(this.uniformLocationsByProgram_[r][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[r][e]}getAttributeLocation(e){const r=De(this.currentProgram_);return this.attribLocationsByProgram_[r]===void 0&&(this.attribLocationsByProgram_[r]={}),this.attribLocationsByProgram_[r][e]===void 0&&(this.attribLocationsByProgram_[r][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[r][e]}makeProjectionTransform(e,r){const i=e.size,n=e.viewState.rotation,s=e.viewState.resolution,a=e.viewState.center;return Pa(r,0,0,2/(s*i[0]),2/(s*i[1]),-n,-a[0],-a[1]),r}setUniformFloatValue(e,r){this.gl_.uniform1f(this.getUniformLocation(e),r)}setUniformFloatVec2(e,r){this.gl_.uniform2fv(this.getUniformLocation(e),r)}setUniformFloatVec4(e,r){this.gl_.uniform4fv(this.getUniformLocation(e),r)}setUniformMatrixValue(e,r){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,r)}enableAttributeArray_(e,r,i,n,s){const a=this.getAttributeLocation(e);a<0||(this.gl_.enableVertexAttribArray(a),this.gl_.vertexAttribPointer(a,r,i,!1,n,s))}enableAttributes(e){const r=r_(e);let i=0;for(let n=0;n<e.length;n++){const s=e[n];this.enableAttributeArray_(s.name,s.size,s.type||cu,r,i),i+=s.size*du(s.type)}}handleWebGLContextLost(e){Cd(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,r,i){const n=this.gl_;i=i||n.createTexture();const s=0,a=n.RGBA,o=0,l=n.RGBA,h=n.UNSIGNED_BYTE;return n.bindTexture(n.TEXTURE_2D,i),r?n.texImage2D(n.TEXTURE_2D,s,a,l,h,r):n.texImage2D(n.TEXTURE_2D,s,a,e[0],e[1],o,l,h,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),i}}function r_(t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];e+=i.size*du(i.type)}return e}function du(t){switch(t){case At.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case At.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case At.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case At.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class Qa extends Od{constructor(e,r){super(e),r=r||{},this.inversePixelTransform_=wt(),this.pixelContext_=null,this.postProcesses_=r.postProcesses,this.uniforms_=r.uniforms,this.helper,e.addChangeListener(Sc.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,r){const i=this.getLayer();if(i.hasListener(fr.PRECOMPOSE)){const n=new bs(fr.PRECOMPOSE,void 0,r,e);i.dispatchEvent(n)}}dispatchPostComposeEvent(e,r){const i=this.getLayer();if(i.hasListener(fr.POSTCOMPOSE)){const n=new bs(fr.POSTCOMPOSE,void 0,r,e);i.dispatchEvent(n)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let r=!0,i=-1,n;for(let a=0,o=e.layerStatesArray.length;a<o;a++){const l=e.layerStatesArray[a].layer,h=l.getRenderer();if(!(h instanceof Qa)){r=!0;continue}const u=l.getClassName();if((r||u!==n)&&(i+=1,r=!1),n=u,h===this)break}const s="map/"+e.mapId+"/group/"+i;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new t_({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),n&&(this.helper.getCanvas().className=n),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(e,r,i){const n=this.getLayer();if(n.hasListener(e)){Pa(this.inversePixelTransform_,0,0,i.pixelRatio,-i.pixelRatio,0,0,-i.size[1]);const s=new bs(e,this.inversePixelTransform_,i,r);n.dispatchEvent(s)}}preRender(e,r){this.dispatchRenderEvent_(fr.PRERENDER,e,r)}postRender(e,r){this.dispatchRenderEvent_(fr.POSTRENDER,e,r)}}const gu=Qa,St=new Uint8Array(4);class i_{constructor(e,r){this.helper_=e;const i=e.getGL();this.texture_=i.createTexture(),this.framebuffer_=i.createFramebuffer(),this.depthbuffer_=i.createRenderbuffer(),this.size_=r||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(e){Nd(e,this.size_)||(this.size_[0]=e[0],this.size_[1]=e[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const e=this.size_,r=this.helper_.getGL();r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer_),r.readPixels(0,0,e[0],e[1],r.RGBA,r.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(e,r){if(e<0||r<0||e>this.size_[0]||r>=this.size_[1])return St[0]=0,St[1]=0,St[2]=0,St[3]=0,St;this.readAll();const i=Math.floor(e)+(this.size_[1]-Math.floor(r)-1)*this.size_[0];return St[0]=this.data_[i*4],St[1]=this.data_[i*4+1],St[2]=this.data_[i*4+2],St[3]=this.data_[i*4+3],St}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const e=this.size_,r=this.helper_.getGL();this.texture_=this.helper_.createTexture(e,null,this.texture_),r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer_),r.viewport(0,0,e[0],e[1]),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.texture_,0),r.bindRenderbuffer(r.RENDERBUFFER,this.depthbuffer_),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e[0],e[1]),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(e[0]*e[1]*4)}}const n_=i_,Rl={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};var pu={exports:{}};pu.exports=ys;pu.exports.default=ys;function ys(t,e,r){r=r||2;var i=e&&e.length,n=i?e[0]*r:t.length,s=mu(t,0,n,r,!0),a=[];if(!s||s.next===s.prev)return a;var o,l,h,u,c,d,g;if(i&&(s=h_(t,e,s,r)),t.length>80*r){o=h=t[0],l=u=t[1];for(var p=r;p<n;p+=r)c=t[p],d=t[p+1],c<o&&(o=c),d<l&&(l=d),c>h&&(h=c),d>u&&(u=d);g=Math.max(h-o,u-l),g=g!==0?32767/g:0}return Zi(s,a,r,o,l,g,0),a}function mu(t,e,r,i,n){var s,a;if(n===oa(t,e,r,i)>0)for(s=e;s<r;s+=i)a=Pl(s,t[s],t[s+1],a);else for(s=r-i;s>=e;s-=i)a=Pl(s,t[s],t[s+1],a);return a&&_s(a,a.next)&&(Wi(a),a=a.next),a}function _r(t,e){if(!t)return t;e||(e=t);var r=t,i;do if(i=!1,!r.steiner&&(_s(r,r.next)||Le(r.prev,r,r.next)===0)){if(Wi(r),r=e=r.prev,r===r.next)break;i=!0}else r=r.next;while(i||r!==e);return e}function Zi(t,e,r,i,n,s,a){if(t){!a&&s&&g_(t,i,n,s);for(var o=t,l,h;t.prev!==t.next;){if(l=t.prev,h=t.next,s?a_(t,i,n,s):s_(t)){e.push(l.i/r|0),e.push(t.i/r|0),e.push(h.i/r|0),Wi(t),t=h.next,o=h.next;continue}if(t=h,t===o){a?a===1?(t=o_(_r(t),e,r),Zi(t,e,r,i,n,s,2)):a===2&&l_(t,e,r,i,n,s):Zi(_r(t),e,r,i,n,s,1);break}}}}function s_(t){var e=t.prev,r=t,i=t.next;if(Le(e,r,i)>=0)return!1;for(var n=e.x,s=r.x,a=i.x,o=e.y,l=r.y,h=i.y,u=n<s?n<a?n:a:s<a?s:a,c=o<l?o<h?o:h:l<h?l:h,d=n>s?n>a?n:a:s>a?s:a,g=o>l?o>h?o:h:l>h?l:h,p=i.next;p!==e;){if(p.x>=u&&p.x<=d&&p.y>=c&&p.y<=g&&Gr(n,o,s,l,a,h,p.x,p.y)&&Le(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function a_(t,e,r,i){var n=t.prev,s=t,a=t.next;if(Le(n,s,a)>=0)return!1;for(var o=n.x,l=s.x,h=a.x,u=n.y,c=s.y,d=a.y,g=o<l?o<h?o:h:l<h?l:h,p=u<c?u<d?u:d:c<d?c:d,y=o>l?o>h?o:h:l>h?l:h,_=u>c?u>d?u:d:c>d?c:d,v=sa(g,p,e,r,i),E=sa(y,_,e,r,i),w=t.prevZ,T=t.nextZ;w&&w.z>=v&&T&&T.z<=E;){if(w.x>=g&&w.x<=y&&w.y>=p&&w.y<=_&&w!==n&&w!==a&&Gr(o,u,l,c,h,d,w.x,w.y)&&Le(w.prev,w,w.next)>=0||(w=w.prevZ,T.x>=g&&T.x<=y&&T.y>=p&&T.y<=_&&T!==n&&T!==a&&Gr(o,u,l,c,h,d,T.x,T.y)&&Le(T.prev,T,T.next)>=0))return!1;T=T.nextZ}for(;w&&w.z>=v;){if(w.x>=g&&w.x<=y&&w.y>=p&&w.y<=_&&w!==n&&w!==a&&Gr(o,u,l,c,h,d,w.x,w.y)&&Le(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;T&&T.z<=E;){if(T.x>=g&&T.x<=y&&T.y>=p&&T.y<=_&&T!==n&&T!==a&&Gr(o,u,l,c,h,d,T.x,T.y)&&Le(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function o_(t,e,r){var i=t;do{var n=i.prev,s=i.next.next;!_s(n,s)&&yu(n,i,i.next,s)&&Vi(n,s)&&Vi(s,n)&&(e.push(n.i/r|0),e.push(i.i/r|0),e.push(s.i/r|0),Wi(i),Wi(i.next),i=t=s),i=i.next}while(i!==t);return _r(i)}function l_(t,e,r,i,n,s){var a=t;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&y_(a,o)){var l=_u(a,o);a=_r(a,a.next),l=_r(l,l.next),Zi(a,e,r,i,n,s,0),Zi(l,e,r,i,n,s,0);return}o=o.next}a=a.next}while(a!==t)}function h_(t,e,r,i){var n=[],s,a,o,l,h;for(s=0,a=e.length;s<a;s++)o=e[s]*i,l=s<a-1?e[s+1]*i:t.length,h=mu(t,o,l,i,!1),h===h.next&&(h.steiner=!0),n.push(m_(h));for(n.sort(c_),s=0;s<n.length;s++)r=u_(n[s],r);return r}function c_(t,e){return t.x-e.x}function u_(t,e){var r=f_(t,e);if(!r)return e;var i=_u(r,t);return _r(i,i.next),_r(r,r.next)}function f_(t,e){var r=e,i=t.x,n=t.y,s=-1/0,a;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var o=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=i&&o>s&&(s=o,a=r.x<r.next.x?r:r.next,o===i))return a}r=r.next}while(r!==e);if(!a)return null;var l=a,h=a.x,u=a.y,c=1/0,d;r=a;do i>=r.x&&r.x>=h&&i!==r.x&&Gr(n<u?i:s,n,h,u,n<u?s:i,n,r.x,r.y)&&(d=Math.abs(n-r.y)/(i-r.x),Vi(r,t)&&(d<c||d===c&&(r.x>a.x||r.x===a.x&&d_(a,r)))&&(a=r,c=d)),r=r.next;while(r!==l);return a}function d_(t,e){return Le(t.prev,t,e.prev)<0&&Le(e.next,t,t.next)<0}function g_(t,e,r,i){var n=t;do n.z===0&&(n.z=sa(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,p_(n)}function p_(t){var e,r,i,n,s,a,o,l,h=1;do{for(r=t,t=null,s=null,a=0;r;){for(a++,i=r,o=0,e=0;e<h&&(o++,i=i.nextZ,!!i);e++);for(l=h;o>0||l>0&&i;)o!==0&&(l===0||!i||r.z<=i.z)?(n=r,r=r.nextZ,o--):(n=i,i=i.nextZ,l--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;r=i}s.nextZ=null,h*=2}while(a>1);return t}function sa(t,e,r,i,n){return t=(t-r)*n|0,e=(e-i)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function m_(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function Gr(t,e,r,i,n,s,a,o){return(n-a)*(e-o)>=(t-a)*(s-o)&&(t-a)*(i-o)>=(r-a)*(e-o)&&(r-a)*(s-o)>=(n-a)*(i-o)}function y_(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!__(t,e)&&(Vi(t,e)&&Vi(e,t)&&x_(t,e)&&(Le(t.prev,t,e.prev)||Le(t,e.prev,e))||_s(t,e)&&Le(t.prev,t,t.next)>0&&Le(e.prev,e,e.next)>0)}function Le(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function _s(t,e){return t.x===e.x&&t.y===e.y}function yu(t,e,r,i){var n=En(Le(t,e,r)),s=En(Le(t,e,i)),a=En(Le(r,i,t)),o=En(Le(r,i,e));return!!(n!==s&&a!==o||n===0&&vn(t,r,e)||s===0&&vn(t,i,e)||a===0&&vn(r,t,i)||o===0&&vn(r,e,i))}function vn(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function En(t){return t>0?1:t<0?-1:0}function __(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&yu(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function Vi(t,e){return Le(t.prev,t,t.next)<0?Le(t,e,t.next)>=0&&Le(t,t.prev,e)>=0:Le(t,e,t.prev)<0||Le(t,t.next,e)<0}function x_(t,e){var r=t,i=!1,n=(t.x+e.x)/2,s=(t.y+e.y)/2;do r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==t);return i}function _u(t,e){var r=new aa(t.i,t.x,t.y),i=new aa(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}function Pl(t,e,r,i){var n=new aa(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Wi(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function aa(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}ys.deviation=function(t,e,r,i){var n=e&&e.length,s=n?e[0]*r:t.length,a=Math.abs(oa(t,0,s,r));if(n)for(var o=0,l=e.length;o<l;o++){var h=e[o]*r,u=o<l-1?e[o+1]*r:t.length;a-=Math.abs(oa(t,h,u,r))}var c=0;for(o=0;o<i.length;o+=3){var d=i[o]*r,g=i[o+1]*r,p=i[o+2]*r;c+=Math.abs((t[d]-t[p])*(t[g+1]-t[d+1])-(t[d]-t[g])*(t[p+1]-t[d+1]))}return a===0&&c===0?0:Math.abs((c-a)/a)};function oa(t,e,r,i){for(var n=0,s=e,a=r-i;s<r;s+=i)n+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return n}ys.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},i=0,n=0;n<t.length;n++){for(var s=0;s<t[n].length;s++)for(var a=0;a<e;a++)r.vertices.push(t[n][s][a]);n>0&&(i+=t[n-1].length,r.holes.push(i))}return r};const Al=.985;function v_(t,e){e=e||[];const r=256,i=r-1;return e[0]=Math.floor(t/r/r/r)/i,e[1]=Math.floor(t/r/r)%r/i,e[2]=Math.floor(t/r)%r/i,e[3]=t%r/i,e}function E_(t){let e=0;const r=256,i=r-1;return e+=Math.round(t[0]*r*r*r*i),e+=Math.round(t[1]*r*r*i),e+=Math.round(t[2]*r*i),e+=Math.round(t[3]*i),e}function w_(){const t='const e="GENERATE_POLYGON_BUFFERS",t="GENERATE_POINT_BUFFERS",n="GENERATE_LINE_STRING_BUFFERS";function r(e,t){const n=t[0],r=t[1];return t[0]=e[0]*n+e[2]*r+e[4],t[1]=e[1]*n+e[3]*r+e[5],t}function x(e,t){const n=(r=t)[0]*r[3]-r[1]*r[2];var r;!function(e,t){if(!e)throw new Error(t)}(0!==n,"Transformation matrix cannot be inverted");const x=t[0],i=t[1],u=t[2],o=t[3],f=t[4],s=t[5];return e[0]=o/n,e[1]=-i/n,e[2]=-u/n,e[3]=x/n,e[4]=(u*s-o*f)/n,e[5]=-(x*s-i*f)/n,e}function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}new Array(6);var u={exports:{}};function o(e,t,n){n=n||2;var r,x,i,u,o,s,l,v=t&&t.length,h=v?t[0]*n:e.length,c=f(e,0,h,n,!0),g=[];if(!c||c.next===c.prev)return g;if(v&&(c=function(e,t,n,r){var x,i,u,o=[];for(x=0,i=t.length;x<i;x++)(u=f(e,t[x]*r,x<i-1?t[x+1]*r:e.length,r,!1))===u.next&&(u.steiner=!0),o.push(d(u));for(o.sort(p),x=0;x<o.length;x++)n=y(o[x],n);return n}(e,t,c,n)),e.length>80*n){r=i=e[0],x=u=e[1];for(var b=n;b<h;b+=n)(o=e[b])<r&&(r=o),(s=e[b+1])<x&&(x=s),o>i&&(i=o),s>u&&(u=s);l=0!==(l=Math.max(i-r,u-x))?32767/l:0}return a(c,g,n,r,x,l,0),g}function f(e,t,n,r,x){var i,u;if(x===O(e,t,n,r)>0)for(i=t;i<n;i+=r)u=P(i,e[i],e[i+1],u);else for(i=n-r;i>=t;i-=r)u=P(i,e[i],e[i+1],u);return u&&m(u,u.next)&&(B(u),u=u.next),u}function s(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==w(r.prev,r,r.next))r=r.next;else{if(B(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function a(e,t,n,r,x,i,u){if(e){!u&&i&&function(e,t,n,r){var x=e;do{0===x.z&&(x.z=b(x.x,x.y,t,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==e);x.prevZ.nextZ=null,x.prevZ=null,function(e){var t,n,r,x,i,u,o,f,s=1;do{for(n=e,e=null,i=null,u=0;n;){for(u++,r=n,o=0,t=0;t<s&&(o++,r=r.nextZ);t++);for(f=s;o>0||f>0&&r;)0!==o&&(0===f||!r||n.z<=r.z)?(x=n,n=n.nextZ,o--):(x=r,r=r.nextZ,f--),i?i.nextZ=x:e=x,x.prevZ=i,i=x;n=r}i.nextZ=null,s*=2}while(u>1)}(x)}(e,r,x,i);for(var o,f,p=e;e.prev!==e.next;)if(o=e.prev,f=e.next,i?v(e,r,x,i):l(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(f.i/n|0),B(e),e=f.next,p=f.next;else if((e=f)===p){u?1===u?a(e=h(s(e),t,n),t,n,r,x,i,2):2===u&&c(e,t,n,r,x,i):a(s(e),t,n,r,x,i,1);break}}}function l(e){var t=e.prev,n=e,r=e.next;if(w(t,n,r)>=0)return!1;for(var x=t.x,i=n.x,u=r.x,o=t.y,f=n.y,s=r.y,a=x<i?x<u?x:u:i<u?i:u,l=o<f?o<s?o:s:f<s?f:s,v=x>i?x>u?x:u:i>u?i:u,h=o>f?o>s?o:s:f>s?f:s,c=r.next;c!==t;){if(c.x>=a&&c.x<=v&&c.y>=l&&c.y<=h&&M(x,o,i,f,u,s,c.x,c.y)&&w(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function v(e,t,n,r){var x=e.prev,i=e,u=e.next;if(w(x,i,u)>=0)return!1;for(var o=x.x,f=i.x,s=u.x,a=x.y,l=i.y,v=u.y,h=o<f?o<s?o:s:f<s?f:s,c=a<l?a<v?a:v:l<v?l:v,p=o>f?o>s?o:s:f>s?f:s,y=a>l?a>v?a:v:l>v?l:v,g=b(h,c,t,n,r),d=b(p,y,t,n,r),Z=e.prevZ,m=e.nextZ;Z&&Z.z>=g&&m&&m.z<=d;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;if(Z=Z.prevZ,m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;Z&&Z.z>=g;){if(Z.x>=h&&Z.x<=p&&Z.y>=c&&Z.y<=y&&Z!==x&&Z!==u&&M(o,a,f,l,s,v,Z.x,Z.y)&&w(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;m&&m.z<=d;){if(m.x>=h&&m.x<=p&&m.y>=c&&m.y<=y&&m!==x&&m!==u&&M(o,a,f,l,s,v,m.x,m.y)&&w(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function h(e,t,n){var r=e;do{var x=r.prev,i=r.next.next;!m(x,i)&&A(x,r,r.next,i)&&z(x,i)&&z(i,x)&&(t.push(x.i/n|0),t.push(r.i/n|0),t.push(i.i/n|0),B(r),B(r.next),r=e=i),r=r.next}while(r!==e);return s(r)}function c(e,t,n,r,x,i){var u=e;do{for(var o=u.next.next;o!==u.prev;){if(u.i!==o.i&&Z(u,o)){var f=F(u,o);return u=s(u,u.next),f=s(f,f.next),a(u,t,n,r,x,i,0),void a(f,t,n,r,x,i,0)}o=o.next}u=u.next}while(u!==e)}function p(e,t){return e.x-t.x}function y(e,t){var n=function(e,t){var n,r=t,x=e.x,i=e.y,u=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var o=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=x&&o>u&&(u=o,n=r.x<r.next.x?r:r.next,o===x))return n}r=r.next}while(r!==t);if(!n)return null;var f,s=n,a=n.x,l=n.y,v=1/0;r=n;do{x>=r.x&&r.x>=a&&x!==r.x&&M(i<l?x:u,i,a,l,i<l?u:x,i,r.x,r.y)&&(f=Math.abs(i-r.y)/(x-r.x),z(r,e)&&(f<v||f===v&&(r.x>n.x||r.x===n.x&&g(n,r)))&&(n=r,v=f)),r=r.next}while(r!==s);return n}(e,t);if(!n)return t;var r=F(n,e);return s(r,r.next),s(n,n.next)}function g(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function b(e,t,n,r,x){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function d(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function M(e,t,n,r,x,i,u,o){return(x-u)*(t-o)>=(e-u)*(i-o)&&(e-u)*(r-o)>=(n-u)*(t-o)&&(n-u)*(i-o)>=(x-u)*(r-o)}function Z(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&A(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(z(e,t)&&z(t,e)&&function(e,t){var n=e,r=!1,x=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!=n.next.y>i&&n.next.y!==n.y&&x<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||m(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function A(e,t,n,r){var x=I(w(e,t,n)),i=I(w(e,t,r)),u=I(w(n,r,e)),o=I(w(n,r,t));return x!==i&&u!==o||(!(0!==x||!E(e,n,t))||(!(0!==i||!E(e,r,t))||(!(0!==u||!E(n,e,r))||!(0!==o||!E(n,t,r)))))}function E(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function I(e){return e>0?1:e<0?-1:0}function z(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function F(e,t){var n=new _(e.i,e.x,e.y),r=new _(t.i,t.x,t.y),x=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=x,x.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function P(e,t,n,r){var x=new _(e,t,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function B(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function _(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(e,t,n,r){for(var x=0,i=t,u=n-r;i<n;i+=r)x+=(e[u]-e[i])*(e[i+1]+e[u+1]),u=i;return x}u.exports=o,u.exports.default=o,o.deviation=function(e,t,n,r){var x=t&&t.length,i=x?t[0]*n:e.length,u=Math.abs(O(e,0,i,n));if(x)for(var o=0,f=t.length;o<f;o++){var s=t[o]*n,a=o<f-1?t[o+1]*n:e.length;u-=Math.abs(O(e,s,a,n))}var l=0;for(o=0;o<r.length;o+=3){var v=r[o]*n,h=r[o+1]*n,c=r[o+2]*n;l+=Math.abs((e[v]-e[c])*(e[h+1]-e[v+1])-(e[v]-e[h])*(e[c+1]-e[v+1]))}return 0===u&&0===l?0:Math.abs((l-u)/u)},o.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,x=0;x<e.length;x++){for(var i=0;i<e[x].length;i++)for(var u=0;u<t;u++)n.vertices.push(e[x][i][u]);x>0&&(r+=e[x-1].length,n.holes.push(r))}return n};var N=i(u.exports);const R=[],S={vertexPosition:0,indexPosition:0};function T(e,t,n,r,x){e[t+0]=n,e[t+1]=r,e[t+2]=x}function U(e,t,n,r,x,i){const u=3+x,o=e[t+0],f=e[t+1],s=R;s.length=x;for(let n=0;n<s.length;n++)s[n]=e[t+2+n];let a=i?i.vertexPosition:0,l=i?i.indexPosition:0;const v=a/u;return T(n,a,o,f,0),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,1),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,2),s.length&&n.set(s,a+3),a+=u,T(n,a,o,f,3),s.length&&n.set(s,a+3),a+=u,r[l++]=v,r[l++]=v+1,r[l++]=v+3,r[l++]=v+1,r[l++]=v+2,r[l++]=v+3,S.vertexPosition=a,S.indexPosition=l,S}function k(e,t,n,x,i,u,o,f,s,a,l){const v=8+f.length,h=u.length/v,c=[e[t+0],e[t+1]],p=[e[n],e[n+1]],y=r(s,[...c]),g=r(s,[...p]);function b(e,t,n){const r=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),x=[(t[0]-e[0])/r,(t[1]-e[1])/r],i=[-x[1],x[0]],u=Math.sqrt((n[0]-e[0])*(n[0]-e[0])+(n[1]-e[1])*(n[1]-e[1])),o=[(n[0]-e[0])/u,(n[1]-e[1])/u],f=0===r||0===u?0:Math.acos((s=o[0]*x[0]+o[1]*x[1],a=-1,l=1,Math.min(Math.max(s,a),l)));var s,a,l;return o[0]*i[0]+o[1]*i[1]>0?f:2*Math.PI-f}let d=-1,M=-1,Z=l;const w=null!==i;if(null!==x){d=b(y,g,r(s,[...[e[x],e[x+1]]])),Math.cos(d)<=.985&&(Z+=Math.tan((d-Math.PI)/2))}if(w){M=b(g,y,r(s,[...[e[i],e[i+1]]])),Math.cos(M)<=.985&&(Z+=Math.tan((Math.PI-M)/2))}function m(e,t){return 0===t?1e4*e:Math.sign(t)*(1e4*e+Math.abs(t))}return u.push(c[0],c[1],p[0],p[1],d,M,a,m(0,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(1,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(2,l)),u.push(...f),u.push(c[0],c[1],p[0],p[1],d,M,a,m(3,l)),u.push(...f),o.push(h,h+1,h+2,h+1,h+3,h+2),{length:a+Math.sqrt((g[0]-y[0])*(g[0]-y[0])+(g[1]-y[1])*(g[1]-y[1])),angle:Z}}function G(e,t,n,r,x){const i=2+x;let u=t;const o=e.slice(u,u+x);u+=x;const f=e[u++];let s=0;const a=new Array(f-1);for(let t=0;t<f;t++)s+=e[u++],t<f-1&&(a[t]=s);const l=e.slice(u,u+2*s),v=N(l,a,2);for(let e=0;e<v.length;e++)r.push(v[e]+n.length/i);for(let e=0;e<l.length;e+=2)n.push(l[e],l[e+1],...o);return u+2*s}const j=self;j.onmessage=r=>{const i=r.data;switch(i.type){case t:{const e=3,t=2,n=i.customAttributesSize,r=t+n,x=new Float32Array(i.renderInstructions),u=x.length/r,o=4*u*(n+e),f=new Uint32Array(6*u),s=new Float32Array(o);let a;for(let e=0;e<x.length;e+=r)a=U(x,e,s,f,n,a);const l=Object.assign({vertexBuffer:s.buffer,indexBuffer:f.buffer,renderInstructions:x.buffer},i);j.postMessage(l,[s.buffer,f.buffer,x.buffer]);break}case n:{const e=[],t=[],n=i.customAttributesSize,r=2,u=new Float32Array(i.renderInstructions);let o=0;const f=[1,0,0,1,0,0];let s,a;for(x(f,i.renderInstructionsTransform);o<u.length;){a=Array.from(u.slice(o,o+n)),o+=n,s=u[o++];const x=o,i=o+(s-1)*r,l=u[x]===u[i]&&u[x+1]===u[i+1];let v=0,h=0;for(let n=0;n<s-1;n++){let c=null;n>0?c=o+(n-1)*r:l&&(c=i-r);let p=null;n<s-2?p=o+(n+2)*r:l&&(p=x+r);const y=k(u,o+n*r,o+(n+1)*r,c,p,e,t,a,f,v,h);v=y.length,h=y.angle}o+=s*r}const l=Uint32Array.from(t),v=Float32Array.from(e),h=Object.assign({vertexBuffer:v.buffer,indexBuffer:l.buffer,renderInstructions:u.buffer},i);j.postMessage(h,[v.buffer,l.buffer,u.buffer]);break}case e:{const e=[],t=[],n=i.customAttributesSize,r=new Float32Array(i.renderInstructions);let x=0;for(;x<r.length;)x=G(r,x,e,t,n);const u=Uint32Array.from(t),o=Float32Array.from(e),f=Object.assign({vertexBuffer:o.buffer,indexBuffer:u.buffer,renderInstructions:r.buffer},i);j.postMessage(f,[o.buffer,u.buffer,r.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(t,"binary").toString("base64"):URL.createObjectURL(new Blob([t],{type:"application/javascript"})))}function T_(t,e){const r=t.viewState.projection,n=e.getSource().getWrapX()&&r.canWrapX(),s=r.getExtent(),a=t.extent,o=n?ht(s):null,l=n?Math.ceil((a[2]-s[2])/o)+1:1;return[n?Math.floor((a[0]-s[0])/o):0,l,o]}class S_ extends gu{constructor(e,r){const i=r.uniforms||{},n=wt();i[zt.PROJECTION_MATRIX]=n,super(e,{uniforms:i,postProcesses:r.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new Zn(ps,na),this.indicesBuffer_=new Zn(ms,na),this.vertexShader_=r.vertexShader,this.fragmentShader_=r.fragmentShader,this.program_,this.hitDetectionEnabled_=r.hitDetectionEnabled??!0;const s=r.attributes?r.attributes.map(function(o){return{name:"a_prop_"+o.name,size:1,type:At.FLOAT}}):[];this.attributes=[{name:"a_position",size:2,type:At.FLOAT},{name:"a_index",size:1,type:At.FLOAT}],this.hitDetectionEnabled_&&(this.attributes.push({name:"a_prop_hitColor",size:4,type:At.FLOAT}),this.attributes.push({name:"a_featureUid",size:1,type:At.FLOAT})),this.attributes.push(...s),this.customAttributes=r.attributes?r.attributes:[],this.previousExtent_=Aa(),this.currentTransform_=n,this.renderTransform_=wt(),this.invertRenderTransform_=wt(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=w_(),this.worker_.addEventListener("message",o=>{const l=o.data;if(l.type===Rl.GENERATE_POINT_BUFFERS){const h=l.projectionTransform;this.verticesBuffer_.fromArrayBuffer(l.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.fromArrayBuffer(l.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=h,Fd(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(o.data.renderInstructions),l.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const a=this.getLayer().getSource();this.sourceListenKeys_=[mi(a,pn.ADDFEATURE,this.handleSourceFeatureAdded_,this),mi(a,pn.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),mi(a,pn.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),mi(a,pn.CLEAR,this.handleSourceFeatureClear_,this)],a.forEachFeature(o=>{this.featureCache_[De(o)]={feature:o,properties:o.getProperties(),geometry:o.getGeometry()},this.featureCount_++})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new n_(this.helper))}handleSourceFeatureAdded_(e){const r=e.feature;this.featureCache_[De(r)]={feature:r,properties:r.getProperties(),geometry:r.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(e){const r=e.feature;this.featureCache_[De(r)]={feature:r,properties:r.getProperties(),geometry:r.getGeometry()}}handleSourceFeatureDelete_(e){const r=e.feature;delete this.featureCache_[De(r)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(e){const r=this.helper.getGL();this.preRender(r,e);const[i,n,s]=T_(e,this.getLayer());return this.renderWorlds(e,!1,i,n,s),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,i,n,s),this.hitRenderTarget_.clearCachedData()),this.postRender(r,e),this.helper.getCanvas()}prepareFrameInternal(e){const r=this.getLayer(),i=r.getSource(),n=e.viewState,s=!e.viewHints[kn.ANIMATING]&&!e.viewHints[kn.INTERACTING],a=!Un(this.previousExtent_,e.extent),o=this.sourceRevision_<i.getRevision();if(o&&(this.sourceRevision_=i.getRevision()),s&&(a||o)){const l=n.projection,h=n.resolution,u=r instanceof Ia?r.getRenderBuffer():0,c=Mc(e.extent,u*h);i.loadFeatures(c,h,l),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.useProgram(this.program_,e),this.helper.prepareDraw(e),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(e){const r=wt();this.helper.makeProjectionTransform(e,r);const n=(this.hitDetectionEnabled_?7:2)+this.customAttributes.length,s=n*this.featureCount_;(!this.renderInstructions_||this.renderInstructions_.length!==s)&&(this.renderInstructions_=new Float32Array(s));let a,o;const l=[],h=[];let u=-1;for(const d in this.featureCache_)if(a=this.featureCache_[d],o=a.geometry,!(!o||o.getType()!=="Point")){if(l[0]=o.getFlatCoordinates()[0],l[1]=o.getFlatCoordinates()[1],ji(r,l),this.renderInstructions_[++u]=l[0],this.renderInstructions_[++u]=l[1],this.hitDetectionEnabled_){const g=v_(u+5,h);this.renderInstructions_[++u]=g[0],this.renderInstructions_[++u]=g[1],this.renderInstructions_[++u]=g[2],this.renderInstructions_[++u]=g[3],this.renderInstructions_[++u]=Number(d)}for(let g=0;g<this.customAttributes.length;g++){const p=this.customAttributes[g].callback(a.feature,a.properties);this.renderInstructions_[++u]=p}}const c={id:++this.lastSentId,type:Rl.GENERATE_POINT_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesSize:n-2};c.projectionTransform=r,this.ready=!1,this.worker_.postMessage(c,[this.renderInstructions_.buffer]),this.renderInstructions_=null}forEachFeatureAtCoordinate(e,r,i,n,s){if(Gt(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const a=ji(r.coordinateToPixelTransform,e.slice()),o=this.hitRenderTarget_.readPixel(a[0]/2,a[1]/2),l=[o[0]/255,o[1]/255,o[2]/255,o[3]/255],h=E_(l),u=this.renderInstructions_[h],c=Math.floor(u).toString(),g=this.getLayer().getSource().getFeatureByUid(c);if(g)return n(g,this.getLayer(),null)}renderWorlds(e,r,i,n,s){let a=i;this.helper.useProgram(this.program_,e),r&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0)),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes);do{this.helper.makeProjectionTransform(e,this.currentTransform_),bc(this.currentTransform_,a*s,0),wc(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e),this.helper.applyHitDetectionUniform(r);const o=this.indicesBuffer_.getSize();this.helper.drawElements(0,o)}while(++a<n)}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach(function(e){Ks(e)}),this.sourceListenKeys_=null,super.disposeInternal()}renderDeclutter(){}}const xu=S_;class M_{constructor(e,r){this.name=e,this.data=r,this.texture_=null}getTexture(e){if(!this.texture_){const r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=r}return this.texture_}}const b_=M_;function Wn(t){return t instanceof Image||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageBitmap?t:null}function la(t){return t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Float32Array||t instanceof DataView?t:null}let Tr=null;function R_(t){Tr||(Tr=Zt(t.width,t.height,void 0,{willReadFrequently:!0}));const e=Tr.canvas,r=t.width;e.width!==r&&(e.width=r);const i=t.height;return e.height!==i&&(e.height=i),Tr.clearRect(0,0,r,i),Tr.drawImage(t,0,0),Tr.getImageData(0,0,r,i).data}const P_=[256,256];let A_=class extends Rc{constructor(e){const r=Q.IDLE;super(e.tileCoord,r,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null}getSize(){if(this.size_)return this.size_;const e=Wn(this.data_);return e?[e.width,e.height]:P_}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==Q.IDLE&&this.state!==Q.ERROR)return;this.state=Q.LOADING,this.changed();const e=this;this.loader_().then(function(r){e.data_=r,e.state=Q.LOADED,e.changed()}).catch(function(r){e.error_=r,e.state=Q.ERROR,e.changed()})}};const Ja=A_;class I_ extends Ja{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:e.interpolate,transition:e.transition}),this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const r=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),i=this.targetTileGrid_.getExtent();let n=this.sourceTileGrid_.getExtent();const s=i?Ct(r,i):r;if(qo(s)===0){this.state=Q.EMPTY;return}const a=e.sourceProj,o=a.getExtent();o&&(n?n=Ct(n,o):n=o);const l=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),h=e.targetProj,u=Gd(a,h,s,l);if(!isFinite(u)||u<=0){this.state=Q.EMPTY;return}const c=e.errorThreshold!==void 0?e.errorThreshold:Ud;if(this.triangulation_=new kd(a,h,s,n,u*c,l),this.triangulation_.getTriangles().length===0){this.state=Q.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(u);let d=this.triangulation_.calculateSourceExtent();if(n&&(a.canWrapX()?(d[1]=Ae(d[1],n[1],n[3]),d[3]=Ae(d[3],n[1],n[3])):d=Ct(d,n)),!qo(d))this.state=Q.EMPTY;else{const g=this.sourceTileGrid_.getTileRangeForExtentAndZ(d,this.sourceZ_),p=e.getTileFunction;for(let y=g.minX;y<=g.maxX;y++)for(let _=g.minY;_<=g.maxY;_++){const v=p(this.sourceZ_,y,_,this.pixelRatio_);v&&this.sourceTiles_.push(v)}this.sourceTiles_.length===0&&(this.state=Q.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];if(this.sourceTiles_.forEach(r=>{if(!r||r.getState()!==Q.LOADED)return;const i=r.getSize(),n=this.gutter_;let s;const a=la(r.getData());a?s=a:s=R_(Wn(r.getData()));const o=[i[0]+2*n,i[1]+2*n],l=s instanceof Float32Array,h=o[0]*o[1],u=l?Float32Array:Uint8Array,c=new u(s.buffer),d=u.BYTES_PER_ELEMENT,g=d*c.length/h,p=c.byteLength/o[1],y=Math.floor(p/d/o[0]),_=h*y;let v=c;if(c.length!==_){v=new u(_);let E=0,w=0;const T=o[0]*y;for(let M=0;M<o[1];++M){for(let A=0;A<T;++A)v[E++]=c[w+A];w+=p/d}}e.push({extent:this.sourceTileGrid_.getTileCoordExtent(r.tileCoord),data:new Uint8Array(v.buffer),dataType:u,bytesPerPixel:g,pixelSize:o})}),this.sourceTiles_.length=0,e.length===0)this.state=Q.ERROR;else{const r=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(r),n=typeof i=="number"?i:i[0],s=typeof i=="number"?i:i[1],a=this.targetTileGrid_.getResolution(r),o=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let h,u;const c=e[0].bytesPerPixel,d=Math.ceil(c/3);for(let g=d-1;g>=0;--g){const p=[];for(let T=0,M=e.length;T<M;++T){const A=e[T],I=A.data,C=A.pixelSize,D=C[0],B=C[1],V=Zt(D,B,Rs),ee=V.createImageData(D,B),f=ee.data;let m=g*3;for(let x=0,S=f.length;x<S;x+=4)f[x]=I[m],f[x+1]=I[m+1],f[x+2]=I[m+2],f[x+3]=255,m+=c;V.putImageData(ee,0,0),p.push({extent:A.extent,image:V.canvas})}const y=Dd(n,s,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),a,l,this.triangulation_,p,this.gutter_,!1,!1,!1,!0);for(let T=0,M=p.length;T<M;++T){const I=p[T].image.getContext("2d");Zo(I),Rs.push(I.canvas)}const _=y.getContext("2d"),v=_.getImageData(0,0,y.width,y.height);Zo(_),Rs.push(y),h||(u=new Uint8Array(c*v.width*v.height),h=new e[0].dataType(u.buffer));const E=v.data;let w=g*3;for(let T=0,M=E.length;T<M;T+=4)E[T+3]===255?(u[w]=E[T],u[w+1]=E[T+1],u[w+2]=E[T+2]):(u[w]=0,u[w+1]=0,u[w+2]=0),w+=c}this.reprojData_=h,this.reprojSize_=[Math.round(n*this.pixelRatio_),Math.round(s*this.pixelRatio_)],this.state=Q.LOADED}this.changed()}load(){if(this.state!==Q.IDLE&&this.state!==Q.ERROR)return;this.state=Q.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(r=>{const i=r.getState();if(i!==Q.IDLE&&i!==Q.LOADING)return;e++;const n=mi(r,it.CHANGE,function(){const s=r.getState();(s==Q.LOADED||s==Q.ERROR||s==Q.EMPTY)&&(Ks(n),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(n)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(r){r.getState()==Q.IDLE&&r.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(Ks),this.sourcesListenerKeys_=null}}const eo=I_;class L_ extends Bd{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=e.gutter||0,this.helper_=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(it.CHANGE,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===Q.LOADED,this.loaded)this.uploadTile();else{if(e instanceof La){const r=e.getImage();r instanceof Image&&!r.crossOrigin&&(r.crossOrigin="anonymous")}e.addEventListener(it.CHANGE,this.handleTileChange_)}}uploadTile(){$t()}setReady(){this.ready=!0,this.dispatchEvent(it.CHANGE)}handleTileChange_(){this.tile.getState()===Q.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(it.CHANGE,this.handleTileChange_)}}const C_=L_;function vu(t,e,r){const i=r?t.LINEAR:t.NEAREST;t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i)}function O_(t,e,r,i){vu(t,e,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}function Il(t,e,r,i,n,s){const a=t.getGL();let o,l;r instanceof Float32Array?(o=a.FLOAT,t.getExtension("OES_texture_float"),l=t.getExtension("OES_texture_float_linear")!==null):(o=a.UNSIGNED_BYTE,l=!0),vu(a,e,s&&l);const h=r.byteLength/i[1];let u=1;h%8===0?u=8:h%4===0?u=4:h%2===0&&(u=2);let c;switch(n){case 1:{c=a.LUMINANCE;break}case 2:{c=a.LUMINANCE_ALPHA;break}case 3:{c=a.RGB;break}case 4:{c=a.RGBA;break}default:throw new Error(`Unsupported number of bands: ${n}`)}const d=a.getParameter(a.UNPACK_ALIGNMENT);a.pixelStorei(a.UNPACK_ALIGNMENT,u),a.texImage2D(a.TEXTURE_2D,0,c,i[0],i[1],0,c,o,r),a.pixelStorei(a.UNPACK_ALIGNMENT,d)}let Ar=null;function N_(){Ar=Zt(1,1,void 0,{willReadFrequently:!0})}class F_ extends C_{constructor(e){super(e),this.textures=[],this.renderSize_=Ot(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const r=new Zn(ps,Ka);r.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(r),this.coords=r,this.setTile(e.tile)}uploadTile(){const e=this.helper_,r=e.getGL(),i=this.tile;this.textures.length=0;let n;i instanceof La||i instanceof Ca?n=i.getImage():n=i.getData();const s=Wn(n);if(s){const E=r.createTexture();this.textures.push(E),this.bandCount=4,O_(r,E,s,i.interpolate),this.setReady();return}n=la(n);const a=i.getSize(),o=[a[0]+2*this.gutter_,a[1]+2*this.gutter_],l=n instanceof Float32Array,h=o[0]*o[1],u=l?Float32Array:Uint8Array,c=u.BYTES_PER_ELEMENT,d=n.byteLength/o[1];this.bandCount=Math.floor(d/c/o[0]);const g=Math.ceil(this.bandCount/4);if(g===1){const E=r.createTexture();this.textures.push(E),Il(e,E,n,o,this.bandCount,i.interpolate),this.setReady();return}const p=new Array(g);for(let E=0;E<g;++E){const w=r.createTexture();this.textures.push(w);const T=E<g-1?4:(this.bandCount-1)%4+1;p[E]=new u(h*T)}let y=0,_=0;const v=o[0]*this.bandCount;for(let E=0;E<o[1];++E){for(let w=0;w<v;++w){const T=n[_+w],M=Math.floor(y/this.bandCount),A=w%this.bandCount,I=Math.floor(A/4),C=p[I],D=C.length/h,B=A%4;C[M*D+B]=T,++y}_+=d/c}for(let E=0;E<g;++E){const w=this.textures[E],T=p[E],M=T.length/h;Il(e,w,T,o,M,i.interpolate)}this.setReady()}disposeInternal(){const e=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let r=0;r<this.textures.length;++r)e.deleteTexture(this.textures[r]);this.tile.removeEventListener(it.CHANGE,this.handleTileChange_)}getImagePixelData_(e,r,i){const n=this.gutter_,s=this.renderSize_[0],a=this.renderSize_[1];Ar||N_(),Ar.clearRect(0,0,1,1);const o=e.width,l=e.height,h=o-2*n,u=l-2*n,c=n+Math.floor(h*(r/s)),d=n+Math.floor(u*(i/a));let g;try{Ar.drawImage(e,c,d,1,1,0,0,1,1),g=Ar.getImageData(0,0,1,1).data}catch{return Ar=null,null}return g}getArrayPixelData_(e,r,i,n){const s=this.gutter_,a=this.renderSize_[0],o=this.renderSize_[1],l=r[0],h=r[1],u=l+2*s,c=h+2*s,d=s+Math.floor(l*(i/a)),g=s+Math.floor(h*(n/o));if(e instanceof DataView){const y=e.byteLength/(u*c),_=y*(g*u+d),v=e.buffer.slice(_,_+y);return new DataView(v)}const p=this.bandCount*(g*u+d);return e.slice(p,p+this.bandCount)}getPixelData(e,r){if(!this.loaded)return null;if(this.tile instanceof Ja){const i=this.tile.getData(),n=la(i);if(n){const s=this.tile.getSize();return this.getArrayPixelData_(n,s,e,r)}return this.getImagePixelData_(Wn(i),e,r)}return this.getImagePixelData_(this.tile.getImage(),e,r)}}const D_=F_,G_={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},U_={};function Ll(t){return 1/(t+2)}function k_(){return{tileIds:new Set,representationsByZ:{}}}function Cl(t,e){return t.tileIds.has(De(e))}function Ol(t,e,r){const i=t.representationsByZ;r in i||(i[r]=new Set),i[r].add(e),t.tileIds.add(De(e.tile))}function Ls(t,e){const r=t.layerStatesArray[t.layerIndex];r.extent&&(e=Ct(e,Ac(r.extent,t.viewState.projection)));const i=r.layer.getRenderSource();if(!i.getWrapX()){const n=i.getTileGridForProjection(t.viewState.projection).getExtent();n&&(e=Ct(e,n))}return e}function ha(t,e){return`${t.getKey()},${Pr(e)}`}class B_ extends gu{constructor(e,r){super(e,{uniforms:r.uniforms,postProcesses:r.postProcesses}),this.renderComplete=!1,this.tileTransform_=wt(),this.tempMat4=uu(),this.tempTileRange_=new zd(0,0,0,0),this.tempTileCoord_=Qs(0,0,0),this.tempSize_=[0,0];const i=r.cacheSize!==void 0?r.cacheSize:512;this.tileRepresentationCache=new Pc(i),this.frameState=null,this.projection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}isDrawableTile_(e){const r=this.getLayer(),i=e.getState(),n=r.getUseInterimTilesOnError();return i==Q.LOADED||i==Q.EMPTY||i==Q.ERROR&&!n}prepareFrameInternal(e){this.projection_?e.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=e.viewState.projection):this.projection_=e.viewState.projection;const i=this.getLayer().getRenderSource();return!i||Ra(Ls(e,e.extent))?!1:i.getState()==="ready"}createTileRepresentation(e){return $t()}enqueueTiles(e,r,i,n,s){const a=e.viewState,o=this.getLayer(),l=o.getRenderSource(),h=l.getTileGridForProjection(a.projection),u=l.getGutterForProjection(a.projection),c=De(l);c in e.wantedTiles||(e.wantedTiles[c]={});const d=e.wantedTiles[c],g=this.tileRepresentationCache,p=o.getMapInternal(),y=Math.max(i-s,h.getMinZoom(),h.getZForResolution(Math.min(o.getMaxResolution(),p?p.getView().getResolutionForZoom(Math.max(o.getMinZoom(),0)):h.getResolution(0)),l.zDirection));for(let _=i;_>=y;--_){const v=h.getTileRangeForExtentAndZ(r,_,this.tempTileRange_),E=h.getResolution(_);for(let w=v.minX;w<=v.maxX;++w)for(let T=v.minY;T<=v.maxY;++T){const M=Qs(_,w,T,this.tempTileCoord_),A=ha(l,M);let I,C;if(g.containsKey(A)&&(I=g.get(A),C=I.tile),(!I||I.tile.key!==l.getKey())&&(C=l.getTile(_,w,T,e.pixelRatio,a.projection)),Cl(n,C))continue;if(!I)I=this.createTileRepresentation({tile:C,grid:h,helper:this.helper,gutter:u}),g.set(A,I);else if(this.isDrawableTile_(C))I.setTile(C);else{const B=C.getInterimTile();I.setTile(B)}Ol(n,I,_);const D=C.getKey();d[D]=!0,C.getState()===Q.IDLE&&(e.tileQueue.isKeyQueued(D)||e.tileQueue.enqueue([C,c,h.getTileCoordCenter(M),E]))}}}beforeTilesRender(e,r){this.helper.prepareDraw(this.frameState,!r,!0)}beforeTilesMaskRender(e){return!1}renderTile(e,r,i,n,s,a,o,l,h,u,c){}renderTileMask(e,r,i,n){}drawTile_(e,r,i,n,s,a,o){if(!r.ready)return;const h=r.tile.tileCoord,u=Pr(h),c=u in a?a[u]:1,d=o.getResolution(i),g=Ot(o.getTileSize(i),this.tempSize_),p=o.getOrigin(i),y=o.getTileCoordExtent(h),_=c<1?-1:Ll(i);c<1&&(e.animate=!0);const v=e.viewState,E=v.center[0],w=v.center[1],T=g[0]+2*n,M=g[1]+2*n,A=T/M,I=(E-p[0])/(g[0]*d),C=(p[1]-w)/(g[1]*d),D=v.resolution/d,B=h[1],V=h[2];$d(this.tileTransform_),Vo(this.tileTransform_,2/(e.size[0]*D/T),-2/(e.size[1]*D/T)),jd(this.tileTransform_,v.rotation),Vo(this.tileTransform_,1,1/A),bc(this.tileTransform_,(g[0]*(B-I)-n)/T,(g[1]*(V-C)-n)/M),this.renderTile(r,this.tileTransform_,e,s,d,g,p,y,_,n,c)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const r=this.helper.getGL();this.preRender(r,e);const i=e.viewState,n=this.getLayer(),s=n.getRenderSource(),a=s.getTileGridForProjection(i.projection),o=s.getGutterForProjection(i.projection),l=Ls(e,e.extent),h=a.getZForResolution(i.resolution,s.zDirection),u=k_(),c=n.getPreload();if(e.nextExtent){const A=a.getZForResolution(i.nextResolution,s.zDirection),I=Ls(e,e.nextExtent);this.enqueueTiles(e,I,A,u,c)}this.enqueueTiles(e,l,h,u,0),c>0&&setTimeout(()=>{this.enqueueTiles(e,l,h-1,u,c-1)},0);const d={},g=De(this),p=e.time;let y=!1;for(const A of u.representationsByZ[h]){const I=A.tile;if((I instanceof Ca||I instanceof eo)&&I.getState()===Q.EMPTY)continue;const C=I.tileCoord;if(A.ready){const V=I.getAlpha(g,p);if(V===1){I.endTransition(g);continue}y=!0;const ee=Pr(C);d[ee]=V}if(this.renderComplete=!1,this.findAltTiles_(a,C,h+1,u))continue;const B=a.getMinZoom();for(let V=h-1;V>=B&&!this.findAltTiles_(a,C,V,u);--V);}const _=u.representationsByZ,v=Object.keys(_).map(Number).sort(qd);if(this.beforeTilesMaskRender(e))for(let A=0,I=v.length;A<I;++A){const C=v[A];for(const D of _[C]){const B=D.tile.tileCoord;if(Pr(B)in d)continue;const ee=a.getTileCoordExtent(B);this.renderTileMask(D,C,ee,Ll(C))}}this.beforeTilesRender(e,y);for(let A=0,I=v.length;A<I;++A){const C=v[A];for(const D of _[C]){const B=D.tile.tileCoord;Pr(B)in d||this.drawTile_(e,D,C,o,l,d,a)}}for(const A of _[h]){const I=A.tile.tileCoord;Pr(I)in d&&this.drawTile_(e,A,h,o,l,d,a)}this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const w=this.helper.getCanvas(),T=this.tileRepresentationCache;for(;T.canExpireCache();)T.pop().dispose();const M=function(A,I){s.updateCacheSize(.1,I.viewState.projection),s.expireCache(I.viewState.projection,U_)};return e.postRenderFunctions.push(M),this.postRender(r,e),w}findAltTiles_(e,r,i,n){const s=e.getTileRangeForTileCoordAndZ(r,i,this.tempTileRange_);if(!s)return!1;let a=!0;const o=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let h=s.minX;h<=s.maxX;++h)for(let u=s.minY;u<=s.maxY;++u){const c=ha(l,[i,h,u]);let d=!1;if(o.containsKey(c)){const g=o.get(c);g.ready&&!Cl(n,g.tile)&&(Ol(n,g,i),d=!0)}d||(a=!1)}return a}clearCache(){const e=this.tileRepresentationCache;e.forEach(r=>r.dispose()),e.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const z_=B_,re={...G_,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},bn={TEXTURE_COORD:"a_textureCoord"},$_=[{name:bn.TEXTURE_COORD,size:2,type:At.FLOAT}];class j_ extends z_{constructor(e,r){super(e,r),this.program_,this.vertexShader_=r.vertexShader,this.fragmentShader_=r.fragmentShader,this.indices_=new Zn(ms,Ka),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=r.paletteTextures||[]}reset(e){super.reset(e),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(e){return new D_(e)}beforeTilesRender(e,r){super.beforeTilesRender(e,r),this.helper.useProgram(this.program_,e)}renderTile(e,r,i,n,s,a,o,l,h,u,c){const d=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes($_);let g=0;for(;g<e.textures.length;){const A=`${re.TILE_TEXTURE_ARRAY}[${g}]`;this.helper.bindTexture(e.textures[g],g,A),++g}for(let A=0;A<this.paletteTextures_.length;++A){const I=this.paletteTextures_[A],C=I.getTexture(d);this.helper.bindTexture(C,g,I.name),++g}const p=i.viewState,y=a[0]+2*u,_=a[1]+2*u,E=e.tile.tileCoord,w=E[1],T=E[2];this.helper.setUniformMatrixValue(re.TILE_TRANSFORM,fu(this.tempMat4,r)),this.helper.setUniformFloatValue(re.TRANSITION_ALPHA,c),this.helper.setUniformFloatValue(re.DEPTH,h);let M=n;u>0&&(M=l,Ct(M,n,M)),this.helper.setUniformFloatVec4(re.RENDER_EXTENT,M),this.helper.setUniformFloatValue(re.RESOLUTION,p.resolution),this.helper.setUniformFloatValue(re.ZOOM,p.zoom),this.helper.setUniformFloatValue(re.TEXTURE_PIXEL_WIDTH,y),this.helper.setUniformFloatValue(re.TEXTURE_PIXEL_HEIGHT,_),this.helper.setUniformFloatValue(re.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(re.TEXTURE_ORIGIN_X,o[0]+w*a[0]*s-u*s),this.helper.setUniformFloatValue(re.TEXTURE_ORIGIN_Y,o[1]-T*a[1]*s+u*s),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;const i=this.frameState;if(!i)return null;const n=this.getLayer(),s=ji(i.pixelToCoordinateTransform,e.slice()),a=i.viewState,o=n.getExtent();if(o&&!Dr(Ac(o,a.projection),s))return null;const l=n.getSources(Ma([s]),a.resolution);let h,u,c;for(h=l.length-1;h>=0;--h)if(u=l[h],u.getState()==="ready"){if(c=u.getTileGridForProjection(a.projection),u.getWrapX())break;const g=c.getExtent();if(!g||Dr(g,s))break}if(h<0)return null;const d=this.tileRepresentationCache;for(let g=c.getZForResolution(a.resolution);g>=c.getMinZoom();--g){const p=c.getTileCoordForCoordAndZ(s,g),y=ha(u,p);if(!d.containsKey(y))continue;const _=d.get(y),v=_.tile;if((v instanceof Ca||v instanceof eo)&&v.getState()===Q.EMPTY)return null;if(!_.loaded)continue;const E=c.getOrigin(g),w=Ot(c.getTileSize(g)),T=c.getResolution(g),M=(s[0]-E[0])/T-p[1]*w[0],A=(E[1]-s[1])/T-p[2]*w[1];return _.getPixelData(M,A)}return null}disposeInternal(){const e=this.helper;e&&(e.getGL().deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_}}const q_=j_;function Z_(t,e){return`operator_${t}_${Object.keys(e.functions).length}`}function pr(t){const e=t.toString();return e.includes(".")?e:e+".0"}function to(t){if(t.length<2||t.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${t.length}(${t.map(pr).join(", ")})`}function Rn(t){const e=qi(t),r=e.length>3?e[3]:1;return to([e[0]/255*r,e[1]/255*r,e[2]/255*r,r])}const Cs={};let V_=0;function Xn(t){return t in Cs||(Cs[t]=V_++),Cs[t]}function jt(t){return pr(Xn(t))}function ro(t){return"u_var_"+t}function W_(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{}}}const Os="getBandValue",Eu="u_paletteTextures";function X_(t,e,r,i){const n=Zd(t,r,e);if(Vd(n.type,Hd))throw new Error("No matching type was found");if(!Wd(e,n.type)){const s=Js(e),a=Js(n.type);throw new Error(`Expected expression to be of type ${s}, got ${a}`)}return io(n,e,i)}function ye(t){return(e,r,i)=>{const n=r.args.length,s=new Array(n);for(let a=0;a<n;++a)s[a]=io(r.args[a],i,e);return t(s,e)}}const H_={[oe.Get]:(t,e)=>{const i=e.args[0].value;return i in t.properties||(t.properties[i]={name:i,type:e.type}),(t.inFragmentShader?"v_prop_":"a_prop_")+i},[oe.GeometryType]:(t,e,r)=>{const i="geometryType";return i in t.properties||(t.properties[i]={name:i,type:Hr,evaluator:a=>Yd(a.getGeometry())}),(t.inFragmentShader?"v_prop_":"a_prop_")+i},[oe.Var]:(t,e)=>{const i=e.args[0].value;return i in t.variables||(t.variables[i]={name:i,type:e.type}),ro(i)},[oe.Resolution]:()=>"u_resolution",[oe.Zoom]:()=>"u_zoom",[oe.Time]:()=>"u_time",[oe.Any]:ye(t=>`(${t.join(" || ")})`),[oe.All]:ye(t=>`(${t.join(" && ")})`),[oe.Not]:ye(([t])=>`(!${t})`),[oe.Equal]:ye(([t,e])=>`(${t} == ${e})`),[oe.NotEqual]:ye(([t,e])=>`(${t} != ${e})`),[oe.GreaterThan]:ye(([t,e])=>`(${t} > ${e})`),[oe.GreaterThanOrEqualTo]:ye(([t,e])=>`(${t} >= ${e})`),[oe.LessThan]:ye(([t,e])=>`(${t} < ${e})`),[oe.LessThanOrEqualTo]:ye(([t,e])=>`(${t} <= ${e})`),[oe.Multiply]:ye(t=>`(${t.join(" * ")})`),[oe.Divide]:ye(([t,e])=>`(${t} / ${e})`),[oe.Add]:ye(t=>`(${t.join(" + ")})`),[oe.Subtract]:ye(([t,e])=>`(${t} - ${e})`),[oe.Clamp]:ye(([t,e,r])=>`clamp(${t}, ${e}, ${r})`),[oe.Mod]:ye(([t,e])=>`mod(${t}, ${e})`),[oe.Pow]:ye(([t,e])=>`pow(${t}, ${e})`),[oe.Abs]:ye(([t])=>`abs(${t})`),[oe.Floor]:ye(([t])=>`floor(${t})`),[oe.Ceil]:ye(([t])=>`ceil(${t})`),[oe.Round]:ye(([t])=>`floor(${t} + 0.5)`),[oe.Sin]:ye(([t])=>`sin(${t})`),[oe.Cos]:ye(([t])=>`cos(${t})`),[oe.Atan]:ye(([t,e])=>e!==void 0?`atan(${t}, ${e})`:`atan(${t})`),[oe.Sqrt]:ye(([t])=>`sqrt(${t})`),[oe.Match]:ye(t=>{const e=t[0],r=t[t.length-1];let i=null;for(let n=t.length-3;n>=1;n-=2){const s=t[n],a=t[n+1];i=`(${e} == ${s} ? ${a} : ${i||r})`}return i}),[oe.Between]:ye(([t,e,r])=>`(${t} >= ${e} && ${t} <= ${r})`),[oe.Interpolate]:ye(([t,e,...r])=>{let i="";for(let n=0;n<r.length-2;n+=2){const s=r[n],a=i||r[n+1],o=r[n+2],l=r[n+3];let h;t===pr(1)?h=`(${e} - ${s}) / (${o} - ${s})`:h=`(pow(${t}, (${e} - ${s})) - 1.0) / (pow(${t}, (${o} - ${s})) - 1.0)`,i=`mix(${a}, ${l}, clamp(${h}, 0.0, 1.0))`}return i}),[oe.Case]:ye(t=>{const e=t[t.length-1];let r=null;for(let i=t.length-3;i>=0;i-=2){const n=t[i],s=t[i+1];r=`(${n} ? ${s} : ${r||e})`}return r}),[oe.In]:ye(([t,...e],r)=>{const i=Z_("in",r),n=[];for(let s=0;s<e.length;s+=1)n.push(`  if (inputValue == ${e[s]}) { return true; }`);return r.functions[i]=`bool ${i}(float inputValue) {
${n.join(`
`)}
  return false;
}`,`${i}(${t})`}),[oe.Array]:ye(t=>`vec${t.length}(${t.join(", ")})`),[oe.Color]:ye(t=>{if(t.length===1)return`vec4(vec3(${t[0]} / 255.0), 1.0)`;if(t.length===2)return`(${t[1]} * vec4(vec3(${t[0]} / 255.0), 1.0))`;const e=t.slice(0,3).map(i=>`${i} / 255.0`);return t.length===3?`vec4(${e.join(", ")}, 1.0)`:`(${t[3]} * vec4(${e.join(", ")}, 1.0))`}),[oe.Band]:ye(([t,e,r],i)=>{if(!(Os in i.functions)){let n="";const s=i.bandCount||1;for(let a=0;a<s;a++){const o=Math.floor(a/4);let l=a%4;a===s-1&&l===1&&(l=3);const h=`${re.TILE_TEXTURE_ARRAY}[${o}]`;n+=`  if (band == ${a+1}.0) {
    return texture2D(${h}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}i.functions[Os]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${re.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${re.TEXTURE_PIXEL_HEIGHT};
${n}
}`}return`${Os}(${t}, ${e??"0.0"}, ${r??"0.0"})`}),[oe.Palette]:(t,e)=>{const[r,...i]=e.args,n=i.length,s=new Uint8Array(n*4);for(let h=0;h<i.length;h++){const u=i[h].value,c=qi(u),d=h*4;s[d]=c[0],s[d+1]=c[1],s[d+2]=c[2],s[d+3]=c[3]*255}t.paletteTextures||(t.paletteTextures=[]);const a=`${Eu}[${t.paletteTextures.length}]`,o=new b_(a,s);t.paletteTextures.push(o);const l=io(r,me,t);return`texture2D(${a}, vec2((${l} + 0.5) / ${n}.0, 0.5))`}};function io(t,e,r){if(t instanceof Xd){const i=H_[t.operator];if(i===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(t.operator)}`);return i(r,t,e)}if((t.type&me)>0)return pr(t.value);if((t.type&Mn)>0)return t.value.toString();if((t.type&Hr)>0)return jt(t.value.toString());if((t.type&ct)>0)return Rn(t.value);if((t.type&mt)>0)return to(t.value);throw new Error(`Unexpected expression ${t.value} (expected type ${Js(e)})`)}function Y_(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}const Sr=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;

// this used to produce an alpha-premultiplied color from a texture
vec4 samplePremultiplied(sampler2D sampler, vec2 texCoord) {
  vec4 color = texture2D(sampler, texCoord);
  return vec4(color.rgb * color.a, color.a);
}
`,Mr=Y_();class wu{constructor(){this.uniforms_=[],this.attributes_=[],this.varyings_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${pr(Mr["circle-radius"])} + ${pr(Mr["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=Rn(Mr["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=pr(Mr["stroke-width"]),this.strokeColorExpression_=Rn(Mr["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=jt("round"),this.strokeJoinExpression_=jt("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.hasFill_=!1,this.fillColorExpression_=Rn(Mr["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(e){return this.uniforms_.push(e),this}addAttribute(e){return this.attributes_.push(e),this}addVarying(e,r,i){return this.varyings_.push({name:e,type:r,expression:i}),this}setSymbolSizeExpression(e){return this.hasSymbol_=!0,this.symbolSizeExpression_=e,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(e){return this.symbolRotationExpression_=e,this}setSymbolOffsetExpression(e){return this.symbolOffsetExpression_=e,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(e){return this.hasSymbol_=!0,this.symbolColorExpression_=e,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(e){return this.texCoordExpression_=e,this}setFragmentDiscardExpression(e){return this.discardExpression_=e,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(e){return this.symbolRotateWithView_=e,this}setStrokeWidthExpression(e){return this.hasStroke_=!0,this.strokeWidthExpression_=e,this}setStrokeColorExpression(e){return this.hasStroke_=!0,this.strokeColorExpression_=e,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(e){return this.strokeOffsetExpression_=e,this}setStrokeCapExpression(e){return this.strokeCapExpression_=e,this}setStrokeJoinExpression(e){return this.strokeJoinExpression_=e,this}setStrokeMiterLimitExpression(e){return this.strokeMiterLimitExpression_=e,this}setStrokeDistanceFieldExpression(e){return this.strokeDistanceFieldExpression_=e,this}setFillColorExpression(e){return this.hasFill_=!0,this.fillColorExpression_=e,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(e){this.vertexShaderFunctions_.includes(e)||this.vertexShaderFunctions_.push(e)}addFragmentShaderFunction(e){this.fragmentShaderFunctions_.includes(e)||this.fragmentShaderFunctions_.push(e)}getSymbolVertexShader(){return this.hasSymbol_?`${Sr}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_prop_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx;
  if (a_index == 0.0) {
    offsetPx -= halfSizePx;
  } else if (a_index == 1.0) {
    offsetPx += halfSizePx * vec2(1., -1.);
  } else if (a_index == 2.0) {
    offsetPx += halfSizePx;
  } else {
    offsetPx += halfSizePx * vec2(-1., 1.);
  }
  float angle = ${this.symbolRotationExpression_};
  ${this.symbolRotateWithView_?"angle += u_rotation;":""}
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;
  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;
  v_texCoord = vec2(u, v);
  v_prop_hitColor = a_prop_hitColor;
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y); 
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${Sr}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_prop_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${Sr}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute float a_parameters;
attribute float a_distance;
attribute vec2 a_joinAngles;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_prop_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float vertexNumber = floor(abs(a_parameters) / 10000. + 0.5);
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)
  float angleTangentSum = fract(abs(a_parameters) / 10000.) * 10000. * sign(a_parameters);

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);
  
  // compute current vertex position
  float normalDir = vertexNumber < 0.5 || (vertexNumber > 1.5 && vertexNumber < 2.5) ? 1.0 : -1.0;
  float tangentDir = vertexNumber < 1.5 ? 1.0 : -1.0;
  float angle = vertexNumber < 1.5 ? v_angleStart : v_angleEnd;
  vec2 joinDirection;
  vec2 positionPx = vertexNumber < 1.5 ? segmentStartPx : segmentEndPx;
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${Al} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStart = segmentStartPx;
  v_segmentEnd = segmentEndPx;
  v_width = lineWidth;
  v_prop_hitColor = a_prop_hitColor;
  v_distanceOffsetPx = a_distance / u_resolution - (lineOffsetPx * angleTangentSum);
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${Sr}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_prop_hitColor;
varying float v_distanceOffsetPx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${Al}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${jt("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${jt("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${jt("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${jt("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

void main(void) {
  vec2 currentPoint = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPoint);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }

  float segmentLength = length(v_segmentEnd - v_segmentStart);
  vec2 segmentTangent = (v_segmentEnd - v_segmentStart) / segmentLength;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPoint = currentPoint - v_segmentStart;
  float currentLengthPx = max(0., min(dot(segmentTangent, startToPoint), segmentLength)) + v_distanceOffsetPx; 
  float currentRadiusPx = abs(dot(segmentNormal, startToPoint));
  float currentRadiusRatio = dot(segmentNormal, startToPoint) * 2. / v_width;
  vec4 color = ${this.strokeColorExpression_} * u_globalAlpha;
  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPoint, v_segmentStart, v_segmentEnd, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPoint, v_segmentEnd, v_segmentStart, v_width, v_angleEnd, capType, joinType);
  float distance = max(
    segmentDistanceField(currentPoint, v_segmentStart, v_segmentEnd, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distance = max(distance, ${this.strokeDistanceFieldExpression_});
  gl_FragColor = color * smoothstep(0.5, -0.5, distance);
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${Sr}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute vec4 a_prop_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec4 v_prop_hitColor;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_prop_hitColor = a_prop_hitColor;
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${Sr}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec4 v_prop_hitColor;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_} * u_globalAlpha;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_prop_hitColor;
  }
}`:null}}const _t={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},K_=["#00f","#0ff","#0f0","#ff0","#f00"];class Q_ extends Ia{constructor(e){e=e||{};const r=Object.assign({},e);delete r.gradient,delete r.radius,delete r.blur,delete r.weight,super(r),this.gradient_=null,this.addChangeListener(_t.GRADIENT,this.handleGradientChanged_),this.setGradient(e.gradient?e.gradient:K_),this.setBlur(e.blur!==void 0?e.blur:15),this.setRadius(e.radius!==void 0?e.radius:8);const i=e.weight?e.weight:"weight";typeof i=="string"?this.weightFunction_=function(n){return n.get(i)}:this.weightFunction_=i,this.setRenderOrder(null)}getBlur(){return this.get(_t.BLUR)}getGradient(){return this.get(_t.GRADIENT)}getRadius(){return this.get(_t.RADIUS)}handleGradientChanged_(){this.gradient_=J_(this.getGradient())}setBlur(e){this.set(_t.BLUR,e)}setGradient(e){this.set(_t.GRADIENT,e)}setRadius(e){this.set(_t.RADIUS,e)}createRenderer(){const e=new wu().addAttribute("float a_prop_weight").addVarying("v_prop_weight","float","a_prop_weight").addUniform("float u_size").addUniform("float u_blurSlope").setSymbolSizeExpression("vec2(u_size)").setSymbolColorExpression("vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * u_blurSlope) * v_prop_weight)");return new xu(this,{className:this.getClassName(),attributes:[{name:"weight",callback:r=>{const i=this.weightFunction_(r);return i!==void 0?Ae(i,0,1):1}}],uniforms:{u_size:()=>(this.get(_t.RADIUS)+this.get(_t.BLUR))*2,u_blurSlope:()=>this.get(_t.RADIUS)/Math.max(1,this.get(_t.BLUR))},hitDetectionEnabled:!0,vertexShader:e.getSymbolVertexShader(),fragmentShader:e.getSymbolFragmentShader(),postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}renderDeclutter(){}}function J_(t){const i=Zt(1,256),n=i.createLinearGradient(0,0,1,256),s=1/(t.length-1);for(let a=0,o=t.length;a<o;++a)n.addColorStop(a*s,t[a]);return i.fillStyle=n,i.fillRect(0,0,1,256),i.canvas}const ex=Q_;class tx extends Ic{constructor(e,r,i,n,s){const a=s!==void 0?dr.IDLE:dr.LOADED;super(e,r,i,a),this.loader_=s!==void 0?s:null,this.canvas_=n,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=dr.ERROR):this.state=dr.LOADED,this.changed()}load(){this.state==dr.IDLE&&(this.state=dr.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}const no=tx;class rx extends Kd{constructor(e){super(e),this.vectorRenderer_=new Qd(e),this.layerImageRatio_=e.getImageRatio(),this.coordinateToVectorPixelTransform_=wt(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(e){if(!this.vectorRenderer_)return Promise.resolve([]);const r=ji(this.coordinateToVectorPixelTransform_,ji(this.renderedPixelToCoordinateTransform_,e.slice()));return this.vectorRenderer_.getFeatures(r)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(e){const r=e.pixelRatio,i=e.viewState,n=i.resolution,s=e.viewHints,a=this.vectorRenderer_;let o=e.extent;this.layerImageRatio_!==1&&(o=o.slice(0),Lc(o,this.layerImageRatio_));const l=ht(o)/n,h=ir(o)/n;if(!s[kn.ANIMATING]&&!s[kn.INTERACTING]&&!Ra(o)){a.useContainer(null,null);const u=a.context,c=e.layerStatesArray[e.layerIndex],d=Object.assign({},c,{opacity:1}),g=Object.assign({},e,{extent:o,size:[l,h],viewState:Object.assign({},e.viewState,{rotation:0}),layerStatesArray:[d],layerIndex:0,declutter:null}),p=this.getLayer().getDeclutter();p&&(g.declutter={[p]:new Jd(9)});let y=!0;const _=new no(o,n,r,u.canvas,function(v){a.prepareFrame(g)&&a.replayGroupChanged&&(a.clipping=!1,a.renderFrame(g,null)&&(a.renderDeclutter(g),a.renderDeferred(g),y=!1),v())});_.addEventListener(it.CHANGE,()=>{if(_.getState()!==dr.LOADED)return;this.image_=y?null:_;const v=_.getPixelRatio(),E=eg(_.getResolution())*r/v;this.renderedResolution=E,this.coordinateToVectorPixelTransform_=Pa(this.coordinateToVectorPixelTransform_,l/2,h/2,1/E,-1/E,0,-i.center[0],-i.center[1])}),_.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!!this.image_}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(e,r,i,n,s){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,r,i,n,s):super.forEachFeatureAtCoordinate(e,r,i,n,s)}}const ix=rx;class nx extends Ia{constructor(e){e=e||{};const r=Object.assign({},e);delete r.imageRatio,super(r),this.imageRatio_=e.imageRatio!==void 0?e.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new ix(this)}}const sx=nx;function J(t,e,r){const i=tg();return i.style=t.style,X_(e,r,i,t)}function Nl(t){const e=qi(t),r=e[0]*256,i=e[1],n=e[2]*256,s=Math.round(e[3]*255);return[r+i,n+s]}const ax=`vec4 unpackColor(vec2 packedColor) {
  return fract(packedColor[1] / 256.0) * vec4(
    fract(floor(packedColor[0] / 256.0) / 256.0),
    fract(packedColor[0] / 256.0),
    fract(floor(packedColor[1] / 256.0) / 256.0),
    1.0
  );
}`;function Tu(t){return t===ct?2:t===mt?4:1}function Ns(t){const e=Tu(t);return e>1?`vec${e}`:"float"}function Hn(t){return(JSON.stringify(t).split("").reduce((r,i)=>(r<<5)-r+i.charCodeAt(0),0)>>>0).toString()}function so(t,e,r,i){if(`${i}radius`in t&&i!=="icon-"){let n=J(r,t[`${i}radius`],me);if(`${i}radius2`in t){const s=J(r,t[`${i}radius2`],me);n=`max(${n}, ${s})`}`${i}stroke-width`in t&&(n=`(${n} + ${J(r,t[`${i}stroke-width`],me)} * 0.5)`),e.setSymbolSizeExpression(`vec2(${n} * 2. + 0.5)`)}if(`${i}scale`in t){const n=J(r,t[`${i}scale`],me|mt);e.setSymbolSizeExpression(`${e.getSymbolSizeExpression()} * ${n}`)}`${i}displacement`in t&&e.setSymbolOffsetExpression(J(r,t[`${i}displacement`],mt)),`${i}rotation`in t&&e.setSymbolRotationExpression(J(r,t[`${i}rotation`],me)),`${i}rotate-with-view`in t&&e.setSymbolRotateWithView(!!t[`${i}rotate-with-view`])}function Su(t,e,r,i,n){let s="vec4(0.)";if(e!==null&&(s=e),r!==null&&i!==null){const l=`smoothstep(-${i} + 0.63, -${i} - 0.58, ${t})`;s=`mix(${r}, ${s}, ${l})`}const a=`(1.0 - smoothstep(-0.63, 0.58, ${t}))`;let o=`${s} * ${a}`;return n!==null&&(o=`${o} * ${n}`),o}function ao(t,e,r,i,n){const s=new Image;let a;return s.crossOrigin=t[`${i}cross-origin`]===void 0?"anonymous":t[`${i}cross-origin`],s.src=t[`${i}src`],s.complete&&s.width&&s.height?a=to([s.width,s.height]):(r[`u_texture${n}_size`]=()=>s.complete?[s.width,s.height]:[0,0],e.addUniform(`vec2 u_texture${n}_size`),a=`u_texture${n}_size`),r[`u_texture${n}`]=s,e.addUniform(`sampler2D u_texture${n}`),a}function oo(t,e,r,i,n){let s=J(r,t[`${e}offset`],mt);if(`${e}offset-origin`in t)switch(t[`${e}offset-origin`]){case"top-right":s=`vec2(${i}.x, 0.) + ${n} * vec2(-1., 0.) + ${s} * vec2(-1., 1.)`;break;case"bottom-left":s=`vec2(0., ${i}.y) + ${n} * vec2(0., -1.) + ${s} * vec2(1., -1.)`;break;case"bottom-right":s=`${i} - ${n} - ${s}`;break}return s}function ox(t,e,r,i,n){n.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,so(t,e,i,"circle-");let s=null;"circle-opacity"in t&&(s=J(n,t["circle-opacity"],me));let a="coordsPx";"circle-scale"in t&&(a=`coordsPx / ${J(n,t["circle-scale"],me|mt)}`);let o=null;"circle-fill-color"in t&&(o=J(n,t["circle-fill-color"],ct));let l=null;"circle-stroke-color"in t&&(l=J(n,t["circle-stroke-color"],ct));let h=J(n,t["circle-radius"],me),u=null;"circle-stroke-width"in t&&(u=J(n,t["circle-stroke-width"],me),h=`(${h} + ${u} * 0.5)`);const c=`circleDistanceField(${a}, ${h})`,d=Su(c,o,l,u,s);e.setSymbolColorExpression(d)}function lx(t,e,r,i,n){n.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,n.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,n.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,so(t,e,i,"shape-");let s=null;"shape-opacity"in t&&(s=J(n,t["shape-opacity"],me));let a="coordsPx";"shape-scale"in t&&(a=`coordsPx / ${J(n,t["shape-scale"],me|mt)}`);let o=null;"shape-fill-color"in t&&(o=J(n,t["shape-fill-color"],ct));let l=null;"shape-stroke-color"in t&&(l=J(n,t["shape-stroke-color"],ct));let h=null;"shape-stroke-width"in t&&(h=J(n,t["shape-stroke-width"],me));const u=J(n,t["shape-points"],me);let c="0.";"shape-angle"in t&&(c=J(n,t["shape-angle"],me));let d,g=J(n,t["shape-radius"],me);if(h!==null&&(g=`${g} + ${h} * 0.5`),"shape-radius2"in t){let y=J(n,t["shape-radius2"],me);h!==null&&(y=`${y} + ${h} * 0.5`),d=`starDistanceField(${a}, ${u}, ${g}, ${y}, ${c})`}else d=`regularDistanceField(${a}, ${u}, ${g}, ${c})`;const p=Su(d,o,l,h,s);e.setSymbolColorExpression(p)}function hx(t,e,r,i,n){let s="vec4(1.0)";"icon-color"in t&&(s=J(n,t["icon-color"],ct)),"icon-opacity"in t&&(s=`${s} * ${J(n,t["icon-opacity"],me)}`);const a=Hn(t["icon-src"]),o=ao(t,e,r,"icon-",a);if(e.setSymbolColorExpression(`${s} * samplePremultiplied(u_texture${a}, v_texCoord)`).setSymbolSizeExpression(o),"icon-width"in t&&"icon-height"in t&&e.setSymbolSizeExpression(`vec2(${J(i,t["icon-width"],me)}, ${J(i,t["icon-height"],me)})`),"icon-offset"in t&&"icon-size"in t){const l=J(i,t["icon-size"],mt),h=e.getSymbolSizeExpression();e.setSymbolSizeExpression(l);const u=oo(t,"icon-",i,"v_quadSizePx",l);e.setTextureCoordinateExpression(`(vec4((${u}).xyxy) + vec4(0., 0., ${l})) / (${h}).xyxy`)}if(so(t,e,i,"icon-"),"icon-anchor"in t){const l=J(i,t["icon-anchor"],mt);let h="1.0";"icon-scale"in t&&(h=J(i,t["icon-scale"],me|mt));let u;t["icon-anchor-x-units"]==="pixels"&&t["icon-anchor-y-units"]==="pixels"?u=`${l} * ${h}`:t["icon-anchor-x-units"]==="pixels"?u=`${l} * vec2(vec2(${h}).x, v_quadSizePx.y)`:t["icon-anchor-y-units"]==="pixels"?u=`${l} * vec2(v_quadSizePx.x, vec2(${h}).x)`:u=`${l} * v_quadSizePx`;let c=`v_quadSizePx * vec2(0.5, -0.5) + ${u} * vec2(-1., 1.)`;if("icon-anchor-origin"in t)switch(t["icon-anchor-origin"]){case"top-right":c=`v_quadSizePx * -0.5 + ${u}`;break;case"bottom-left":c=`v_quadSizePx * 0.5 - ${u}`;break;case"bottom-right":c=`v_quadSizePx * vec2(-0.5, 0.5) + ${u} * vec2(1., -1.)`;break}e.setSymbolOffsetExpression(`${e.getSymbolOffsetExpression()} + ${c}`)}}function cx(t,e,r,i,n){if("stroke-color"in t&&e.setStrokeColorExpression(J(n,t["stroke-color"],ct)),"stroke-pattern-src"in t){const s=Hn(t["stroke-pattern-src"]),a=ao(t,e,r,"stroke-pattern-",s);let o=a,l="vec2(0.)";"stroke-pattern-offset"in t&&"stroke-pattern-size"in t&&(o=J(n,t["stroke-pattern-size"],mt),l=oo(t,"stroke-pattern-",n,a,o));let h="0.";"stroke-pattern-spacing"in t&&(h=J(n,t["stroke-pattern-spacing"],me)),n.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = currentLengthPx * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return samplePremultiplied(texture, texCoord);
}`;const u=`u_texture${s}`;let c="1.";"stroke-color"in t&&(c=e.getStrokeColorExpression()),e.setStrokeColorExpression(`${c} * sampleStrokePattern(${u}, ${a}, ${l}, ${o}, ${h}, currentLengthPx, currentRadiusRatio, v_width)`)}if("stroke-width"in t&&e.setStrokeWidthExpression(J(i,t["stroke-width"],me)),"stroke-offset"in t&&e.setStrokeOffsetExpression(J(i,t["stroke-offset"],me)),"stroke-line-cap"in t&&e.setStrokeCapExpression(J(i,t["stroke-line-cap"],Hr)),"stroke-line-join"in t&&e.setStrokeJoinExpression(J(i,t["stroke-line-join"],Hr)),"stroke-miter-limit"in t&&e.setStrokeMiterLimitExpression(J(i,t["stroke-miter-limit"],me)),"stroke-line-dash"in t){n.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${jt("square")}) {
    distanceSegment -= v_width * 0.5;
  } else if (capType == ${jt("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - v_width * 0.5);
  }
  return distanceSegment;
}`;let s=t["stroke-line-dash"].map(g=>J(n,g,me));s.length%2===1&&(s=[...s,...s]);let a="0.";"stroke-line-dash-offset"in t&&(a=J(i,t["stroke-line-dash-offset"],me));const l=`dashDistanceField_${Hn(t["stroke-line-dash"])}`,h=s.map((g,p)=>`float dashLength${p} = ${g};`),u=s.map((g,p)=>`dashLength${p}`).join(" + ");let c="0.",d=`getSingleDashDistance(distance, radius, ${c}, dashLength0, totalDashLength, capType)`;for(let g=2;g<s.length;g+=2)c=`${c} + dashLength${g-2} + dashLength${g-1}`,d=`min(${d}, getSingleDashDistance(distance, radius, ${c}, dashLength${g}, totalDashLength, capType))`;n.functions[l]=`float ${l}(float distance, float radius, float capType) {
  ${h.join(`
  `)}
  float totalDashLength = ${u};
  return ${d};
}`,e.setStrokeDistanceFieldExpression(`${l}(currentLengthPx + ${a}, currentRadiusPx, capType)`)}}function ux(t,e,r,i,n){if("fill-color"in t&&e.setFillColorExpression(J(n,t["fill-color"],ct)),"fill-pattern-src"in t){const s=Hn(t["fill-pattern-src"]),a=ao(t,e,r,"fill-pattern-",s);let o=a,l="vec2(0.)";"fill-pattern-offset"in t&&"fill-pattern-size"in t&&(o=J(n,t["fill-pattern-size"],mt),l=oo(t,"fill-pattern-",n,a,o)),n.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return samplePremultiplied(texture, (samplePos + textureOffset) / textureSize);
}`;const h=`u_texture${s}`;let u="1.";"fill-color"in t&&(u=e.getFillColorExpression()),e.setFillColorExpression(`${u} * sampleFillPattern(${h}, ${a}, ${l}, ${o}, pxOrigin, pxPos)`)}}function fx(t){const e={inFragmentShader:!1,properties:{},variables:{},functions:{},style:t},r={inFragmentShader:!0,variables:e.variables,properties:{},functions:{},style:t},i=new wu,n={};if("icon-src"in t?hx(t,i,n,e,r):"shape-points"in t?lx(t,i,n,e,r):"circle-radius"in t&&ox(t,i,n,e,r),cx(t,i,n,e,r),ux(t,i,n,e,r),t.filter){const a=J(r,t.filter,Mn);i.setFragmentDiscardExpression(`!${a}`)}Object.keys(r.variables).forEach(function(a){const o=r.variables[a],l=ro(o.name);i.addUniform(`${Ns(o.type)} ${l}`);let h;o.type===Hr?h=()=>Xn(t.variables[o.name]):o.type===ct?h=()=>Nl([...qi(t.variables[o.name]||"#eee")]):o.type===Mn?h=()=>t.variables[o.name]?1:0:h=()=>t.variables[o.name],n[l]=h}),Object.keys(r.properties).forEach(function(a){const o=r.properties[a];e.properties[a]||(e.properties[a]=o);let l=Ns(o.type),h=`a_prop_${o.name}`;o.type===ct&&(l="vec4",h=`unpackColor(${h})`,i.addVertexShaderFunction(ax)),i.addVarying(`v_prop_${o.name}`,l,h)}),Object.keys(e.properties).forEach(function(a){const o=e.properties[a];i.addAttribute(`${Ns(o.type)} a_prop_${o.name}`)});const s=Object.keys(e.properties).map(function(a){const o=e.properties[a];let l;return o.evaluator?l=o.evaluator:o.type===Hr?l=h=>Xn(h.get(o.name)):o.type===ct?l=h=>Nl([...qi(h.get(o.name)||"#eee")]):o.type===Mn?l=h=>h.get(o.name)?1:0:l=h=>h.get(o.name),{name:o.name,size:Tu(o.type),callback:l}});for(const a in e.functions)i.addVertexShaderFunction(e.functions[a]);for(const a in r.functions)i.addFragmentShaderFunction(r.functions[a]);return{builder:i,attributes:s.reduce((a,o)=>({...a,[o.name]:{callback:o.callback,size:o.size}}),{}),uniforms:n}}class dx extends Cc{constructor(e){const r=Object.assign({},e);super(r),this.parseResult_=fx(e.style),this.styleVariables_=e.style.variables||{},this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){const e=Object.keys(this.parseResult_.attributes).map(r=>({name:r,...this.parseResult_.attributes[r]}));return new xu(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitDetectionEnabled:!this.hitDetectionDisabled_,uniforms:this.parseResult_.uniforms,attributes:e})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}const gx=dx;function Fl(t,e){const r=`
    attribute vec2 ${bn.TEXTURE_COORD};
    uniform mat4 ${re.TILE_TRANSFORM};
    uniform float ${re.TEXTURE_PIXEL_WIDTH};
    uniform float ${re.TEXTURE_PIXEL_HEIGHT};
    uniform float ${re.TEXTURE_RESOLUTION};
    uniform float ${re.TEXTURE_ORIGIN_X};
    uniform float ${re.TEXTURE_ORIGIN_Y};
    uniform float ${re.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${bn.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${re.TEXTURE_ORIGIN_X} + ${re.TEXTURE_RESOLUTION} * ${re.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${re.TEXTURE_ORIGIN_Y} - ${re.TEXTURE_RESOLUTION} * ${re.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${re.TILE_TRANSFORM} * vec4(${bn.TEXTURE_COORD}, ${re.DEPTH}, 1.0);
    }
  `,i={...W_(),inFragmentShader:!0,bandCount:e,style:t},n=[];if(t.color!==void 0){const c=J(i,t.color,ct);n.push(`color = ${c};`)}if(t.contrast!==void 0){const c=J(i,t.contrast,me);n.push(`color.rgb = clamp((${c} + 1.0) * color.rgb - (${c} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(t.exposure!==void 0){const c=J(i,t.exposure,me);n.push(`color.rgb = clamp((${c} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(t.saturation!==void 0){const c=J(i,t.saturation,me);n.push(`
      float saturation = ${c} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(t.gamma!==void 0){const c=J(i,t.gamma,me);n.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${c}));`)}if(t.brightness!==void 0){const c=J(i,t.brightness,me);n.push(`color.rgb = clamp(color.rgb + ${c}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},a=Object.keys(i.variables).length;if(a>1&&!t.variables)throw new Error(`Missing variables in style (expected ${i.variables})`);for(let c=0;c<a;++c){const d=i.variables[Object.keys(i.variables)[c]];if(!(d.name in t.variables))throw new Error(`Missing '${d.name}' in style variables`);const g=ro(d.name);s[g]=function(){let p=t.variables[d.name];return typeof p=="string"&&(p=Xn(p)),p!==void 0?p:-9999999}}const o=Object.keys(s).map(function(c){return`uniform float ${c};`}),l=Math.ceil(e/4);o.push(`uniform sampler2D ${re.TILE_TEXTURE_ARRAY}[${l}];`),i.paletteTextures&&o.push(`uniform sampler2D ${Eu}[${i.paletteTextures.length}];`);const h=Object.keys(i.functions).map(function(c){return i.functions[c]}),u=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${re.RENDER_EXTENT};
    uniform float ${re.TRANSITION_ALPHA};
    uniform float ${re.TEXTURE_PIXEL_WIDTH};
    uniform float ${re.TEXTURE_PIXEL_HEIGHT};
    uniform float ${re.RESOLUTION};
    uniform float ${re.ZOOM};

    ${o.join(`
`)}

    ${h.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${re.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${re.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${re.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${re.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${re.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${n.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${re.TRANSITION_ALPHA};
    }`;return{vertexShader:r,fragmentShader:u,uniforms:s,paletteTextures:i.paletteTextures}}class Mu extends rg{constructor(e){e=e?Object.assign({},e):{};const r=e.style||{};delete e.style;const i=e.cacheSize;delete e.cacheSize,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=r,this.cacheSize_=i,this.styleVariables_=this.style_.variables||{},this.addChangeListener(Sc.SOURCE,this.handleSourceUpdate_)}getSources(e,r){const i=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(e,r):this.sources_:i?[i]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,r=this.getSources([-e,-e,e,e],e);return r&&r.length&&"bandCount"in r[0]?r[0].bandCount:4}createRenderer(){const e=Fl(this.style_,this.getSourceBandCount_());return new q_(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.cacheSize_,paletteTextures:e.paletteTextures})}renderSources(e,r){const i=this.getRenderer();let n;for(let s=0,a=r.length;s<a;++s)this.renderedSource_=r[s],i.prepareFrame(e)&&(n=i.renderFrame(e));return n}render(e,r){this.rendered=!0;const i=e.viewState,n=this.getSources(e.extent,i.resolution);let s=!0;for(let o=0,l=n.length;o<l;++o){const h=n[o],u=h.getState();if(u=="loading"){const c=()=>{h.getState()=="ready"&&(h.removeEventListener("change",c),this.changed())};h.addEventListener("change",c)}s=s&&u=="ready"}const a=this.renderSources(e,n);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=i.resolution,a;if(this.renderedResolution_>.5*i.resolution){const o=this.getSources(e.extent,this.renderedResolution_).filter(l=>!n.includes(l));if(o.length>0)return this.renderSources(e,o)}return a}setStyle(e){this.styleVariables_=e.variables||{},this.style_=e;const r=Fl(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,uniforms:r.uniforms,paletteTextures:r.paletteTextures}),this.changed()}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}Mu.prototype.dispose;const ca=Mu,px=Object.freeze(Object.defineProperty({__proto__:null,Graticule:zy,Group:Oc,Heatmap:ex,Image:Oa,Layer:Cc,Tile:Bn,Vector:ba,VectorImage:sx,VectorTile:Nc,WebGLPoints:gx,WebGLTile:ca},Symbol.toStringTag,{value:"Module"}));function mx(t){const e=t[0],r=new Array(e);let i=1<<e-1,n,s;for(n=0;n<e;++n)s=48,t[1]&i&&(s+=1),t[2]&i&&(s+=2),r[n]=String.fromCharCode(s),i>>=1;return r.join("")}const yx='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>';class _x extends ar{constructor(e){const r=e.hidpi!==void 0?e.hidpi:!1;super({cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,opaque:!0,projection:de("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:r?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.hidpi_=r,this.culture_=e.culture!==void 0?e.culture:"en-us",this.maxZoom_=e.maxZoom!==void 0?e.maxZoom:-1,this.apiKey_=e.key,this.imagerySet_=e.imagerySet,this.placeholderTiles_=e.placeholderTiles;const i="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(i).then(n=>n.json()).then(n=>this.handleImageryMetadataResponse(n))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(e){if(e.statusCode!=200||e.statusDescription!="OK"||e.authenticationResultCode!="ValidCredentials"||e.resourceSets.length!=1||e.resourceSets[0].resources.length!=1){this.setState("error");return}const r=e.resourceSets[0].resources[0],i=this.maxZoom_==-1?r.zoomMax:this.maxZoom_,n=this.getProjection(),s=tn(n),a=this.hidpi_?2:1,o=r.imageWidth==r.imageHeight?r.imageWidth/a:[r.imageWidth/a,r.imageHeight/a],l=rn({extent:s,minZoom:r.zoomMin,maxZoom:i,tileSize:o});this.tileGrid=l;const h=this.culture_,u=this.hidpi_,c=this.placeholderTiles_;if(this.tileUrlFunction=Fc(r.imageUrlSubdomains.map(function(d){const g=[0,0,0],p=r.imageUrl.replace("{subdomain}",d).replace("{culture}",h);return function(y,_,v){if(!y)return;Qs(y[0],y[1],y[2],g);const E=new URL(p.replace("{quadkey}",mx(g))),w=E.searchParams;return u&&(w.set("dpi","d1"),w.set("device","mobile")),c===!0?w.delete("n"):c===!1&&w.set("n","z"),E.toString()}})),r.imageryProviders){const d=Na(de("EPSG:4326"),this.getProjection());this.setAttributions(g=>{const p=[],y=g.viewState,_=this.getTileGrid(),v=_.getZForResolution(y.resolution,this.zDirection),w=_.getTileCoordForCoordAndZ(y.center,v)[0];return r.imageryProviders.map(function(T){let M=!1;const A=T.coverageAreas;for(let I=0,C=A.length;I<C;++I){const D=A[I];if(w>=D.zoomMin&&w<=D.zoomMax){const B=D.bbox,V=[B[1],B[0],B[3],B[2]],ee=$i(V,d);if(Xr(ee,g.extent)){M=!0;break}}}M&&p.push(T.attribution)}),p.push(yx),p})}this.setState("ready")}}const xx=_x;class vx extends Yr{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,maxZoom:e.maxZoom!==void 0?e.maxZoom:18,minZoom:e.minZoom,projection:e.projection,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection}),this.account_=e.account,this.mapId_=e.map||"",this.config_=e.config||{},this.templateCache_={},this.initializeMap_()}getConfig(){return this.config_}updateConfig(e){Object.assign(this.config_,e),this.initializeMap_()}setConfig(e){this.config_=e||{},this.initializeMap_()}initializeMap_(){const e=JSON.stringify(this.config_);if(this.templateCache_[e]){this.applyTemplate_(this.templateCache_[e]);return}let r="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(r+="/named/"+this.mapId_);const i=new XMLHttpRequest;i.addEventListener("load",this.handleInitResponse_.bind(this,e)),i.addEventListener("error",this.handleInitError_.bind(this)),i.open("POST",r),i.setRequestHeader("Content-type","application/json"),i.send(JSON.stringify(this.config_))}handleInitResponse_(e,r){const i=r.target;if(!i.status||i.status>=200&&i.status<300){let n;try{n=JSON.parse(i.responseText)}catch{this.setState("error");return}this.applyTemplate_(n),this.templateCache_[e]=n,this.setState("ready")}else this.setState("error")}handleInitError_(e){this.setState("error")}applyTemplate_(e){const r="https://"+e.cdn_url.https+"/"+this.account_+"/api/v1/map/"+e.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(r)}}const Ex=vx;class wx extends as{constructor(e){super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(r){const i=r.getGeometry();return Gt(!i||i.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),i},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,r,i){this.source.loadFeatures(e,r,i),r!==this.resolution&&(this.resolution=r,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(it.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(it.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,r){const i=e===0?0:Math.min(r,e)/e,n=e!==this.distance||this.interpolationRatio!==i;this.distance=e,this.minDistance=r,this.interpolationRatio=i,n&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=Aa(),r=this.distance*this.resolution,i=this.source.getFeatures(),n={};for(let s=0,a=i.length;s<a;s++){const o=i[s];if(!(De(o)in n)){const l=this.geometryFunction(o);if(l){const h=l.getCoordinates();ig(h,e),Mc(e,r,e);const u=this.source.getFeaturesInExtent(e).filter(function(c){const d=De(c);return d in n?!1:(n[d]=!0,!0)});this.features.push(this.createCluster(u,e))}}}}createCluster(e,r){const i=[0,0];for(let o=e.length-1;o>=0;--o){const l=this.geometryFunction(e[o]);l?ng(i,l.getCoordinates()):e.splice(o,1)}sg(i,1/e.length);const n=Jt(r),s=this.interpolationRatio,a=new Et([i[0]*(1-s)+n[0]*s,i[1]*(1-s)+n[1]*s]);return this.createCustomCluster_?this.createCustomCluster_(a,e):new ut({geometry:a,features:e})}}const Tx=wx;class Sx extends os{constructor(e){const r=e.projection===void 0?"EPSG:3857":e.projection;let i=e.tileGrid;i===void 0&&r&&(i=rn({extent:tn(r),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:r,tileGrid:i,opaque:e.opaque,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.tileSize_=e.tileSize?Ot(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=e.bandCount===void 0?4:e.bandCount,this.tileGridForProjection_={},this.tileCacheForProjection_={}}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const r=this.getTileGrid();return r?Ot(r.getTileSize(e)):[256,256]}getGutterForProjection(e){const r=this.getProjection();return!r||pi(r,e)?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,r,i,n,s){const a=this.getTileCacheForProjection(n),o=zn(e,r,i);if(a.containsKey(o)){const _=a.get(o);if(_&&_.key==this.getKey())return _}const l=this.getTileGrid(),h=Math.max.apply(null,l.getResolutions().map((_,v)=>{const E=Ot(l.getTileSize(v)),w=this.getTileSize(v);return Math.max(w[0]/E[0],w[1]/E[1])})),u=this.getTileGridForProjection(s),c=this.getTileGridForProjection(n),d=[e,r,i],g=this.getTileCoordForTileUrlFunction(d,n),p=Object.assign({sourceProj:s,sourceTileGrid:u,targetProj:n,targetTileGrid:c,tileCoord:d,wrappedTileCoord:g,pixelRatio:h,gutter:this.getGutterForProjection(s),getTileFunction:(_,v,E,w)=>this.getTile(_,v,E,w,s)},this.tileOptions),y=new eo(p);return y.key=this.getKey(),y}getTile(e,r,i,n,s){const a=this.getProjection();if(a&&s&&!pi(a,s))return this.getReprojTile_(e,r,i,s,a);const o=this.getTileSize(e),l=zn(e,r,i);if(this.tileCache.containsKey(l))return this.tileCache.get(l);const h=this.loader_;function u(){return hg(function(){return h(e,r,i)})}const c=Object.assign({tileCoord:[e,r,i],loader:u,size:o},this.tileOptions),d=new Ja(c);return d.key=this.getKey(),d.addEventListener(it.CHANGE,this.handleTileChange_),this.tileCache.set(l,d),d}handleTileChange_(e){const r=e.target,i=De(r),n=r.getState();let s;n==Q.LOADING?(this.tileLoadingKeys_[i]=!0,s=Ps.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=n==Q.ERROR?Ps.TILELOADERROR:n==Q.LOADED?Ps.TILELOADEND:void 0),s&&this.dispatchEvent(new ag(s,r))}getTileGridForProjection(e){const r=this.getProjection();if(this.tileGrid&&(!r||pi(r,e)))return this.tileGrid;const i=De(e);return i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=og(e)),this.tileGridForProjection_[i]}setTileGridForProjection(e,r){const i=de(e);if(i){const n=De(i);n in this.tileGridForProjection_||(this.tileGridForProjection_[n]=r)}}getTileCacheForProjection(e){const r=this.getProjection();if(!r||pi(r,e))return this.tileCache;const i=De(e);return i in this.tileCacheForProjection_||(this.tileCacheForProjection_[i]=new lg(.1)),this.tileCacheForProjection_[i]}expireCache(e,r){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?r:{});for(const n in this.tileCacheForProjection_){const s=this.tileCacheForProjection_[n];s.expireCache(s==i?r:{})}}clear(){super.clear();for(const e in this.tileCacheForProjection_)this.tileCacheForProjection_[e].clear()}}const lo=Sx;function Ze(t){return(e,...r)=>Mx(t,e,r)}function li(t,e){return Ze(bu(t,e).get)}const{apply:Mx,construct:v2,defineProperty:E2,get:w2,getOwnPropertyDescriptor:bu,getPrototypeOf:ho,has:T2,ownKeys:bx,set:S2,setPrototypeOf:M2}=Reflect,{iterator:an,species:b2,toStringTag:Rx,for:R2}=Symbol,Px=Object,{create:co,defineProperty:Ax,freeze:P2,is:A2}=Px,Ix=Array,Lx=Ix.prototype,Ru=Lx[an],Cx=Ze(Ru),Pu=ArrayBuffer,Ox=Pu.prototype;li(Ox,"byteLength");const Dl=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;Dl&&li(Dl.prototype,"byteLength");const Au=ho(Uint8Array);Au.from;const Qe=Au.prototype;Qe[an];Ze(Qe.keys);Ze(Qe.values);Ze(Qe.entries);Ze(Qe.set);Ze(Qe.reverse);Ze(Qe.fill);Ze(Qe.copyWithin);Ze(Qe.sort);Ze(Qe.slice);Ze(Qe.subarray);li(Qe,"buffer");li(Qe,"byteOffset");li(Qe,"length");li(Qe,Rx);const Nx=Uint8Array,Iu=Uint16Array,uo=Uint32Array,Fx=Float32Array,Xi=ho([][an]()),Lu=Ze(Xi.next),Dx=Ze(function*(){}().next),Gx=ho(Xi),Ux=DataView.prototype,kx=Ze(Ux.getUint16),fo=WeakMap,Cu=fo.prototype,Ou=Ze(Cu.get),Bx=Ze(Cu.set),Nu=new fo,zx=co(null,{next:{value:function(){const e=Ou(Nu,this);return Lu(e)}},[an]:{value:function(){return this}}});function $x(t){if(t[an]===Ru&&Xi.next===Lu)return t;const e=co(zx);return Bx(Nu,e,Cx(t)),e}const jx=new fo,qx=co(Gx,{next:{value:function(){const e=Ou(jx,this);return Dx(e)},writable:!0,configurable:!0}});for(const t of bx(Xi))t!=="next"&&Ax(qx,t,bu(Xi,t));const Fu=new Pu(4),Zx=new Fx(Fu),Vx=new uo(Fu),Mt=new Iu(512),bt=new Nx(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(Mt[t]=0,Mt[t|256]=32768,bt[t]=24,bt[t|256]=24):e<-14?(Mt[t]=1024>>-e-14,Mt[t|256]=1024>>-e-14|32768,bt[t]=-e-1,bt[t|256]=-e-1):e<=15?(Mt[t]=e+15<<10,Mt[t|256]=e+15<<10|32768,bt[t]=13,bt[t|256]=13):e<128?(Mt[t]=31744,Mt[t|256]=64512,bt[t]=24,bt[t|256]=24):(Mt[t]=31744,Mt[t|256]=64512,bt[t]=13,bt[t|256]=13)}const go=new uo(2048);for(let t=1;t<1024;++t){let e=t<<13,r=0;for(;!(e&8388608);)e<<=1,r-=8388608;e&=-8388609,r+=947912704,go[t]=e|r}for(let t=1024;t<2048;++t)go[t]=939524096+(t-1024<<13);const hi=new uo(64);for(let t=1;t<31;++t)hi[t]=t<<23;hi[31]=1199570944;hi[32]=2147483648;for(let t=33;t<63;++t)hi[t]=2147483648+(t-32<<23);hi[63]=3347054592;const Du=new Iu(64);for(let t=1;t<64;++t)t!==32&&(Du[t]=1024);function Wx(t){const e=t>>10;return Vx[0]=go[Du[e]+(t&1023)]+hi[e],Zx[0]}function Gu(t,e,...r){return Wx(kx(t,e,...$x(r)))}var po={exports:{}};function Uu(t,e,r){const i=r&&r.debug||!1;i&&console.log("[xml-utils] getting "+e+" in "+t);const n=typeof t=="object"?t.outer:t,s=n.slice(0,n.indexOf(">")+1),a=['"',"'"];for(let o=0;o<a.length;o++){const l=a[o],h=e+"\\="+l+"([^"+l+"]*)"+l;i&&console.log("[xml-utils] pattern:",h);const c=new RegExp(h).exec(s);if(i&&console.log("[xml-utils] match:",c),c)return c[1]}}po.exports=Uu;po.exports.default=Uu;var Xx=po.exports;const Fs=cs(Xx);var mo={exports:{}},yo={exports:{}},_o={exports:{}};function ku(t,e,r){const n=new RegExp(e).exec(t.slice(r));return n?r+n.index:-1}_o.exports=ku;_o.exports.default=ku;var Hx=_o.exports,xo={exports:{}};function Bu(t,e,r){const n=new RegExp(e).exec(t.slice(r));return n?r+n.index+n[0].length-1:-1}xo.exports=Bu;xo.exports.default=Bu;var Yx=xo.exports,vo={exports:{}};function zu(t,e){const r=new RegExp(e,"g"),i=t.match(r);return i?i.length:0}vo.exports=zu;vo.exports.default=zu;var Kx=vo.exports;const Qx=Hx,Ds=Yx,Gl=Kx;function $u(t,e,r){const i=r&&r.debug||!1,n=!(r&&typeof r.nested===!1),s=r&&r.startIndex||0;i&&console.log("[xml-utils] starting findTagByName with",e," and ",r);const a=Qx(t,`<${e}[ 
>/]`,s);if(i&&console.log("[xml-utils] start:",a),a===-1)return;const o=t.slice(a+e.length);let l=Ds(o,"^[^<]*[ /]>",0);const h=l!==-1&&o[l-1]==="/";if(i&&console.log("[xml-utils] selfClosing:",h),h===!1)if(n){let g=0,p=1,y=0;for(;(l=Ds(o,"[ /]"+e+">",g))!==-1;){const _=o.substring(g,l+1);if(p+=Gl(_,"<"+e+`[ 
	>]`),y+=Gl(_,"</"+e+">"),y>=p)break;g=l}}else l=Ds(o,"[ /]"+e+">",0);const u=a+e.length+l+1;if(i&&console.log("[xml-utils] end:",u),u===-1)return;const c=t.slice(a,u);let d;return h?d=null:d=c.slice(c.indexOf(">")+1,c.lastIndexOf("<")),{inner:d,outer:c,start:a,end:u}}yo.exports=$u;yo.exports.default=$u;var Jx=yo.exports;const e1=Jx;function ju(t,e,r){const i=[],n=r&&r.debug||!1,s=r&&typeof r.nested=="boolean"?r.nested:!0;let a=r&&r.startIndex||0,o;for(;o=e1(t,e,{debug:n,startIndex:a});)s?a=o.start+1+e.length:a=o.end,i.push(o);return n&&console.log("findTagsByName found",i.length,"tags"),i}mo.exports=ju;mo.exports.default=ju;var t1=mo.exports;const r1=cs(t1),Gi={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},Pt={};for(const t in Gi)Gi.hasOwnProperty(t)&&(Pt[Gi[t]]=parseInt(t,10));const i1=[Pt.BitsPerSample,Pt.ExtraSamples,Pt.SampleFormat,Pt.StripByteCounts,Pt.StripOffsets,Pt.StripRowCounts,Pt.TileByteCounts,Pt.TileOffsets,Pt.SubIFDs],Gs={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},ne={};for(const t in Gs)Gs.hasOwnProperty(t)&&(ne[Gs[t]]=parseInt(t,10));const Je={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},n1={Unspecified:0,Assocalpha:1,Unassalpha:2},I2={Version:0,AddCompression:1},L2={None:0,Deflate:1,Zstandard:2},s1={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function a1(t,e){const{width:r,height:i}=t,n=new Uint8Array(r*i*3);let s;for(let a=0,o=0;a<t.length;++a,o+=3)s=256-t[a]/e*256,n[o]=s,n[o+1]=s,n[o+2]=s;return n}function o1(t,e){const{width:r,height:i}=t,n=new Uint8Array(r*i*3);let s;for(let a=0,o=0;a<t.length;++a,o+=3)s=t[a]/e*256,n[o]=s,n[o+1]=s,n[o+2]=s;return n}function l1(t,e){const{width:r,height:i}=t,n=new Uint8Array(r*i*3),s=e.length/3,a=e.length/3*2;for(let o=0,l=0;o<t.length;++o,l+=3){const h=t[o];n[l]=e[h]/65536*256,n[l+1]=e[h+s]/65536*256,n[l+2]=e[h+a]/65536*256}return n}function h1(t){const{width:e,height:r}=t,i=new Uint8Array(e*r*3);for(let n=0,s=0;n<t.length;n+=4,s+=3){const a=t[n],o=t[n+1],l=t[n+2],h=t[n+3];i[s]=255*((255-a)/256)*((255-h)/256),i[s+1]=255*((255-o)/256)*((255-h)/256),i[s+2]=255*((255-l)/256)*((255-h)/256)}return i}function c1(t){const{width:e,height:r}=t,i=new Uint8ClampedArray(e*r*3);for(let n=0,s=0;n<t.length;n+=3,s+=3){const a=t[n],o=t[n+1],l=t[n+2];i[s]=a+1.402*(l-128),i[s+1]=a-.34414*(o-128)-.71414*(l-128),i[s+2]=a+1.772*(o-128)}return i}const u1=.95047,f1=1,d1=1.08883;function g1(t){const{width:e,height:r}=t,i=new Uint8Array(e*r*3);for(let n=0,s=0;n<t.length;n+=3,s+=3){const a=t[n+0],o=t[n+1]<<24>>24,l=t[n+2]<<24>>24;let h=(a+16)/116,u=o/500+h,c=h-l/200,d,g,p;u=u1*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),h=f1*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),c=d1*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),d=u*3.2406+h*-1.5372+c*-.4986,g=u*-.9689+h*1.8758+c*.0415,p=u*.0557+h*-.204+c*1.057,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,i[s]=Math.max(0,Math.min(1,d))*255,i[s+1]=Math.max(0,Math.min(1,g))*255,i[s+2]=Math.max(0,Math.min(1,p))*255}return i}const qu=new Map;function lr(t,e){Array.isArray(t)||(t=[t]),t.forEach(r=>qu.set(r,e))}async function Zu(t){const e=qu.get(t.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${t.Compression}`);const r=await e();return new r(t)}lr([void 0,1],()=>or(()=>import("./raw-FjKAlyiw.js"),__vite__mapDeps([0,1]),import.meta.url).then(t=>t.default));lr(5,()=>or(()=>import("./lzw-NamZKYVt.js"),__vite__mapDeps([2,1]),import.meta.url).then(t=>t.default));lr(6,()=>{throw new Error("old style JPEG compression is not supported.")});lr(7,()=>or(()=>import("./jpeg-rjh0axXg.js"),__vite__mapDeps([3,1]),import.meta.url).then(t=>t.default));lr([8,32946],()=>or(()=>import("./deflate-EZWV29Lt.js"),__vite__mapDeps([4,5,1]),import.meta.url).then(t=>t.default));lr(32773,()=>or(()=>import("./packbits-65YHJGuf.js"),__vite__mapDeps([6,1]),import.meta.url).then(t=>t.default));lr(34887,()=>or(()=>import("./lerc-ckUcO23U.js"),__vite__mapDeps([7,5,8,1,9,10,11,12,13]),import.meta.url).then(async t=>(await t.zstd.init(),t)).then(t=>t.default));lr(50001,()=>or(()=>import("./webimage-NiQ987z3.js"),__vite__mapDeps([14,1]),import.meta.url).then(t=>t.default));function xs(t,e,r,i=1){return new(Object.getPrototypeOf(t)).constructor(e*r*i)}function p1(t,e,r,i,n){const s=e/i,a=r/n;return t.map(o=>{const l=xs(o,i,n);for(let h=0;h<n;++h){const u=Math.min(Math.round(a*h),r-1);for(let c=0;c<i;++c){const d=Math.min(Math.round(s*c),e-1),g=o[u*e+d];l[h*i+c]=g}}return l})}function Zr(t,e,r){return(1-r)*t+r*e}function m1(t,e,r,i,n){const s=e/i,a=r/n;return t.map(o=>{const l=xs(o,i,n);for(let h=0;h<n;++h){const u=a*h,c=Math.floor(u),d=Math.min(Math.ceil(u),r-1);for(let g=0;g<i;++g){const p=s*g,y=p%1,_=Math.floor(p),v=Math.min(Math.ceil(p),e-1),E=o[c*e+_],w=o[c*e+v],T=o[d*e+_],M=o[d*e+v],A=Zr(Zr(E,w,y),Zr(T,M,y),u%1);l[h*i+g]=A}}return l})}function y1(t,e,r,i,n,s="nearest"){switch(s.toLowerCase()){case"nearest":return p1(t,e,r,i,n);case"bilinear":case"linear":return m1(t,e,r,i,n);default:throw new Error(`Unsupported resampling method: '${s}'`)}}function _1(t,e,r,i,n,s){const a=e/i,o=r/n,l=xs(t,i,n,s);for(let h=0;h<n;++h){const u=Math.min(Math.round(o*h),r-1);for(let c=0;c<i;++c){const d=Math.min(Math.round(a*c),e-1);for(let g=0;g<s;++g){const p=t[u*e*s+d*s+g];l[h*i*s+c*s+g]=p}}}return l}function x1(t,e,r,i,n,s){const a=e/i,o=r/n,l=xs(t,i,n,s);for(let h=0;h<n;++h){const u=o*h,c=Math.floor(u),d=Math.min(Math.ceil(u),r-1);for(let g=0;g<i;++g){const p=a*g,y=p%1,_=Math.floor(p),v=Math.min(Math.ceil(p),e-1);for(let E=0;E<s;++E){const w=t[c*e*s+_*s+E],T=t[c*e*s+v*s+E],M=t[d*e*s+_*s+E],A=t[d*e*s+v*s+E],I=Zr(Zr(w,T,y),Zr(M,A,y),u%1);l[h*i*s+g*s+E]=I}}}return l}function v1(t,e,r,i,n,s,a="nearest"){switch(a.toLowerCase()){case"nearest":return _1(t,e,r,i,n,s);case"bilinear":case"linear":return x1(t,e,r,i,n,s);default:throw new Error(`Unsupported resampling method: '${a}'`)}}function E1(t,e,r){let i=0;for(let n=e;n<r;++n)i+=t[n];return i}function ua(t,e,r){switch(t){case 1:if(e<=8)return new Uint8Array(r);if(e<=16)return new Uint16Array(r);if(e<=32)return new Uint32Array(r);break;case 2:if(e===8)return new Int8Array(r);if(e===16)return new Int16Array(r);if(e===32)return new Int32Array(r);break;case 3:switch(e){case 16:case 32:return new Float32Array(r);case 64:return new Float64Array(r)}break}throw Error("Unsupported data format/bitsPerSample")}function w1(t,e){return(t===1||t===2)&&e<=32&&e%8===0?!1:!(t===3&&(e===16||e===32||e===64))}function T1(t,e,r,i,n,s,a){const o=new DataView(t),l=r===2?a*s:a*s*i,h=r===2?1:i,u=ua(e,n,l),c=parseInt("1".repeat(n),2);if(e===1){let d;r===1?d=i*n:d=n;let g=s*d;g&7&&(g=g+7&-8);for(let p=0;p<a;++p){const y=p*g;for(let _=0;_<s;++_){const v=y+_*h*n;for(let E=0;E<h;++E){const w=v+E*n,T=(p*s+_)*h+E,M=Math.floor(w/8),A=w%8;if(A+n<=8)u[T]=o.getUint8(M)>>8-n-A&c;else if(A+n<=16)u[T]=o.getUint16(M)>>16-n-A&c;else if(A+n<=24){const I=o.getUint16(M)<<8|o.getUint8(M+2);u[T]=I>>24-n-A&c}else u[T]=o.getUint32(M)>>32-n-A&c}}}}return u.buffer}class S1{constructor(e,r,i,n,s,a){this.fileDirectory=e,this.geoKeys=r,this.dataView=i,this.littleEndian=n,this.tiles=s?{}:null,this.isTiled=!e.StripOffsets;const o=e.PlanarConfiguration;if(this.planarConfiguration=typeof o>"u"?1:o,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=a}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let r=0;r<this.fileDirectory.BitsPerSample.length;++r)e+=this.getSampleByteSize(r);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const r=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,i=this.fileDirectory.BitsPerSample[e];switch(r){case 1:if(i<=8)return DataView.prototype.getUint8;if(i<=16)return DataView.prototype.getUint16;if(i<=32)return DataView.prototype.getUint32;break;case 2:if(i<=8)return DataView.prototype.getInt8;if(i<=16)return DataView.prototype.getInt16;if(i<=32)return DataView.prototype.getInt32;break;case 3:switch(i){case 16:return function(n,s){return Gu(this,n,s)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,r){const i=this.getSampleFormat(e),n=this.getBitsPerSample(e);return ua(i,n,r)}async getTileOrStrip(e,r,i,n,s){const a=Math.ceil(this.getWidth()/this.getTileWidth()),o=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:h}=this;this.planarConfiguration===1?l=r*a+e:this.planarConfiguration===2&&(l=i*a*o+r*a+e);let u,c;this.isTiled?(u=this.fileDirectory.TileOffsets[l],c=this.fileDirectory.TileByteCounts[l]):(u=this.fileDirectory.StripOffsets[l],c=this.fileDirectory.StripByteCounts[l]);const d=(await this.source.fetch([{offset:u,length:c}],s))[0];let g;return h===null||!h[l]?(g=(async()=>{let p=await n.decode(this.fileDirectory,d);const y=this.getSampleFormat(),_=this.getBitsPerSample();return w1(y,_)&&(p=T1(p,y,this.planarConfiguration,this.getSamplesPerPixel(),_,this.getTileWidth(),this.getBlockHeight(r))),p})(),h!==null&&(h[l]=g)):g=h[l],{x:e,y:r,sample:i,data:await g}}async _readRaster(e,r,i,n,s,a,o,l,h){const u=this.getTileWidth(),c=this.getTileHeight(),d=this.getWidth(),g=this.getHeight(),p=Math.max(Math.floor(e[0]/u),0),y=Math.min(Math.ceil(e[2]/u),Math.ceil(d/u)),_=Math.max(Math.floor(e[1]/c),0),v=Math.min(Math.ceil(e[3]/c),Math.ceil(g/c)),E=e[2]-e[0];let w=this.getBytesPerPixel();const T=[],M=[];for(let C=0;C<r.length;++C)this.planarConfiguration===1?T.push(E1(this.fileDirectory.BitsPerSample,0,r[C])/8):T.push(0),M.push(this.getReaderForSample(r[C]));const A=[],{littleEndian:I}=this;for(let C=_;C<v;++C)for(let D=p;D<y;++D){let B;this.planarConfiguration===1&&(B=this.getTileOrStrip(D,C,0,s,h));for(let V=0;V<r.length;++V){const ee=V,f=r[V];this.planarConfiguration===2&&(w=this.getSampleByteSize(f),B=this.getTileOrStrip(D,C,f,s,h));const m=B.then(x=>{const S=x.data,L=new DataView(S),O=this.getBlockHeight(x.y),N=x.y*c,F=x.x*u,$=N+O,X=(x.x+1)*u,ce=M[ee],he=Math.min(O,O-($-e[3]),g-N),ge=Math.min(u,u-(X-e[2]),d-F);for(let ue=Math.max(0,e[1]-N);ue<he;++ue)for(let Se=Math.max(0,e[0]-F);Se<ge;++Se){const Be=(ue*u+Se)*w,Ne=ce.call(L,Be+T[ee],I);let $e;n?($e=(ue+N-e[1])*E*r.length+(Se+F-e[0])*r.length+ee,i[$e]=Ne):($e=(ue+N-e[1])*E+Se+F-e[0],i[ee][$e]=Ne)}});A.push(m)}}if(await Promise.all(A),a&&e[2]-e[0]!==a||o&&e[3]-e[1]!==o){let C;return n?C=v1(i,e[2]-e[0],e[3]-e[1],a,o,r.length,l):C=y1(i,e[2]-e[0],e[3]-e[1],a,o,l),C.width=a,C.height=o,C}return i.width=a||e[2]-e[0],i.height=o||e[3]-e[1],i}async readRasters({window:e,samples:r=[],interleave:i,pool:n=null,width:s,height:a,resampleMethod:o,fillValue:l,signal:h}={}){const u=e||[0,0,this.getWidth(),this.getHeight()];if(u[0]>u[2]||u[1]>u[3])throw new Error("Invalid subsets");const c=u[2]-u[0],d=u[3]-u[1],g=c*d,p=this.getSamplesPerPixel();if(!r||!r.length)for(let E=0;E<p;++E)r.push(E);else for(let E=0;E<r.length;++E)if(r[E]>=p)return Promise.reject(new RangeError(`Invalid sample index '${r[E]}'.`));let y;if(i){const E=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,w=Math.max.apply(null,this.fileDirectory.BitsPerSample);y=ua(E,w,g*r.length),l&&y.fill(l)}else{y=[];for(let E=0;E<r.length;++E){const w=this.getArrayForSample(r[E],g);Array.isArray(l)&&E<l.length?w.fill(l[E]):l&&!Array.isArray(l)&&w.fill(l),y.push(w)}}const _=n||await Zu(this.fileDirectory);return await this._readRaster(u,r,y,i,_,s,a,o,h)}async readRGB({window:e,interleave:r=!0,pool:i=null,width:n,height:s,resampleMethod:a,enableAlpha:o=!1,signal:l}={}){const h=e||[0,0,this.getWidth(),this.getHeight()];if(h[0]>h[2]||h[1]>h[3])throw new Error("Invalid subsets");const u=this.fileDirectory.PhotometricInterpretation;if(u===Je.RGB){let v=[0,1,2];if(this.fileDirectory.ExtraSamples!==n1.Unspecified&&o){v=[];for(let E=0;E<this.fileDirectory.BitsPerSample.length;E+=1)v.push(E)}return this.readRasters({window:e,interleave:r,samples:v,pool:i,width:n,height:s,resampleMethod:a,signal:l})}let c;switch(u){case Je.WhiteIsZero:case Je.BlackIsZero:case Je.Palette:c=[0];break;case Je.CMYK:c=[0,1,2,3];break;case Je.YCbCr:case Je.CIELab:c=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const d={window:h,interleave:!0,samples:c,pool:i,width:n,height:s,resampleMethod:a,signal:l},{fileDirectory:g}=this,p=await this.readRasters(d),y=2**this.fileDirectory.BitsPerSample[0];let _;switch(u){case Je.WhiteIsZero:_=a1(p,y);break;case Je.BlackIsZero:_=o1(p,y);break;case Je.Palette:_=l1(p,g.ColorMap);break;case Je.CMYK:_=h1(p);break;case Je.YCbCr:_=c1(p);break;case Je.CIELab:_=g1(p);break;default:throw new Error("Unsupported photometric interpretation.")}if(!r){const v=new Uint8Array(_.length/3),E=new Uint8Array(_.length/3),w=new Uint8Array(_.length/3);for(let T=0,M=0;T<_.length;T+=3,++M)v[M]=_[T],E[M]=_[T+1],w[M]=_[T+2];_=[v,E,w]}return _.width=p.width,_.height=p.height,_}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let r=0;r<this.fileDirectory.ModelTiepoint.length;r+=6)e.push({i:this.fileDirectory.ModelTiepoint[r],j:this.fileDirectory.ModelTiepoint[r+1],k:this.fileDirectory.ModelTiepoint[r+2],x:this.fileDirectory.ModelTiepoint[r+3],y:this.fileDirectory.ModelTiepoint[r+4],z:this.fileDirectory.ModelTiepoint[r+5]});return e}getGDALMetadata(e=null){const r={};if(!this.fileDirectory.GDAL_METADATA)return null;const i=this.fileDirectory.GDAL_METADATA;let n=r1(i,"Item");e===null?n=n.filter(s=>Fs(s,"sample")===void 0):n=n.filter(s=>Number(Fs(s,"sample"))===e);for(let s=0;s<n.length;++s){const a=n[s];r[Fs(a,"name")]=a.inner}return r}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,r=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(r)return[r[3],r[7],r[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const r=this.fileDirectory.ModelPixelScale,i=this.fileDirectory.ModelTransformation;if(r)return[r[0],-r[1],r[2]];if(i)return[i[0],-i[5],i[10]];if(e){const[n,s,a]=e.getResolution();return[n*e.getWidth()/this.getWidth(),s*e.getHeight()/this.getHeight(),a*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(){const e=this.getHeight(),r=this.getWidth();if(this.fileDirectory.ModelTransformation){const[i,n,s,a,o,l,h,u]=this.fileDirectory.ModelTransformation,d=[[0,0],[0,e],[r,0],[r,e]].map(([y,_])=>[a+i*y+n*_,u+o*y+l*_]),g=d.map(y=>y[0]),p=d.map(y=>y[1]);return[Math.min(...g),Math.min(...p),Math.max(...g),Math.max(...p)]}else{const i=this.getOrigin(),n=this.getResolution(),s=i[0],a=i[1],o=s+n[0]*this.getWidth(),l=a+n[1]*this.getHeight();return[Math.min(s,o),Math.min(a,l),Math.max(s,o),Math.max(a,l)]}}}const Vu=S1;class M1{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,r){const i=this.getUint32(e,r),n=this.getUint32(e+4,r);let s;if(r){if(s=i+2**32*n,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*i+n,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}getInt64(e,r){let i=0;const n=(this._dataView.getUint8(e+(r?7:0))&128)>0;let s=!0;for(let a=0;a<8;a++){let o=this._dataView.getUint8(e+(r?a:7-a));n&&(s?o!==0&&(o=~(o-1)&255,s=!1):o=~o&255),i+=o*256**a}return n&&(i=-i),i}getUint8(e,r){return this._dataView.getUint8(e,r)}getInt8(e,r){return this._dataView.getInt8(e,r)}getUint16(e,r){return this._dataView.getUint16(e,r)}getInt16(e,r){return this._dataView.getInt16(e,r)}getUint32(e,r){return this._dataView.getUint32(e,r)}getInt32(e,r){return this._dataView.getInt32(e,r)}getFloat16(e,r){return Gu(this._dataView,e,r)}getFloat32(e,r){return this._dataView.getFloat32(e,r)}getFloat64(e,r){return this._dataView.getFloat64(e,r)}}class b1{constructor(e,r,i,n){this._dataView=new DataView(e),this._sliceOffset=r,this._littleEndian=i,this._bigTiff=n}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,r){return this.sliceOffset<=e&&this.sliceTop>=e+r}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const r=this.readUint32(e),i=this.readUint32(e+4);let n;if(this._littleEndian){if(n=r+2**32*i,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}if(n=2**32*r+i,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}readInt64(e){let r=0;const i=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let n=!0;for(let s=0;s<8;s++){let a=this._dataView.getUint8(e+(this._littleEndian?s:7-s));i&&(n?a!==0&&(a=~(a-1)&255,n=!1):a=~a&255),r+=a*256**s}return i&&(r=-r),r}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const R1=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class P1{constructor(e=R1,r){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=r?Promise.resolve(r):new Promise(i=>{or(()=>import("./decoder-YCn7QQ1o.js"),__vite__mapDeps([15,8]),import.meta.url).then(n=>{i(n.create)})}),this._awaitingDecoder.then(i=>{this._awaitingDecoder=null,this.workers=[];for(let n=0;n<e;n++)this.workers.push({worker:i(),idle:!0})}))}async decode(e,r){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?Zu(e).then(i=>i.decode(e,r)):new Promise(i=>{const n=this.workers.find(o=>o.idle)||this.workers[Math.floor(Math.random()*this.size)];n.idle=!1;const s=this.messageId++,a=o=>{o.data.id===s&&(n.idle=!0,i(o.data.decoded),n.worker.removeEventListener("message",a))};n.worker.addEventListener("message",a),n.worker.postMessage({fileDirectory:e,buffer:r,id:s},[r])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const A1=P1,Ul=`\r
\r
`;function Wu(t){if(typeof Object.fromEntries<"u")return Object.fromEntries(t);const e={};for(const[r,i]of t)e[r.toLowerCase()]=i;return e}function I1(t){const e=t.split(`\r
`).map(r=>{const i=r.split(":").map(n=>n.trim());return i[0]=i[0].toLowerCase(),i});return Wu(e)}function L1(t){const[e,...r]=t.split(";").map(n=>n.trim()),i=r.map(n=>n.split("="));return{type:e,params:Wu(i)}}function fa(t){let e,r,i;return t&&([,e,r,i]=t.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),r=parseInt(r,10),i=parseInt(i,10)),{start:e,end:r,total:i}}function C1(t,e){let r=null;const i=new TextDecoder("ascii"),n=[],s=`--${e}`,a=`${s}--`;for(let o=0;o<10;++o)i.decode(new Uint8Array(t,o,s.length))===s&&(r=o);if(r===null)throw new Error("Could not find initial boundary");for(;r<t.byteLength;){const o=i.decode(new Uint8Array(t,r,Math.min(s.length+1024,t.byteLength-r)));if(o.length===0||o.startsWith(a))break;if(!o.startsWith(s))throw new Error("Part does not start with boundary");const l=o.substr(s.length+2);if(l.length===0)break;const h=l.indexOf(Ul),u=I1(l.substr(0,h)),{start:c,end:d,total:g}=fa(u["content-range"]),p=r+s.length+h+Ul.length,y=parseInt(d,10)+1-parseInt(c,10);n.push({headers:u,data:t.slice(p,p+y),offset:c,length:y,fileSize:g}),r=p+y+4}return n}class Eo{async fetch(e,r=void 0){return Promise.all(e.map(i=>this.fetchSlice(i,r)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class O1 extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[r,i]of e)this.onEviction(r,i.value)}_deleteIfExpired(e,r){return typeof r.expiry=="number"&&r.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,r.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,r){if(this._deleteIfExpired(e,r)===!1)return r.value}_getItemValue(e,r){return r.expiry?this._getOrDeleteIfExpired(e,r):r.value}_peek(e,r){const i=r.get(e);return this._getItemValue(e,i)}_set(e,r){this.cache.set(e,r),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,r){this.oldCache.delete(e),this._set(e,r)}*_entriesAscending(){for(const e of this.oldCache){const[r,i]=e;this.cache.has(r)||this._deleteIfExpired(r,i)===!1&&(yield e)}for(const e of this.cache){const[r,i]=e;this._deleteIfExpired(r,i)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const r=this.cache.get(e);return this._getItemValue(e,r)}if(this.oldCache.has(e)){const r=this.oldCache.get(e);if(this._deleteIfExpired(e,r)===!1)return this._moveToRecent(e,r),r.value}}set(e,r,{maxAge:i=this.maxAge}={}){const n=typeof i=="number"&&i!==Number.POSITIVE_INFINITY?Date.now()+i:void 0;return this.cache.has(e)?this.cache.set(e,{value:r,expiry:n}):this._set(e,{value:r,expiry:n}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const r=this.cache.delete(e);return r&&this._size--,this.oldCache.delete(e)||r}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const r=[...this._entriesAscending()],i=r.length-e;i<0?(this.cache=new Map(r),this.oldCache=new Map,this._size=r.length):(i>0&&this._emitEvictions(r.slice(0,i)),this.oldCache=new Map(r.slice(i)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[r,i]=e;this._deleteIfExpired(r,i)===!1&&(yield[r,i.value])}for(const e of this.oldCache){const[r,i]=e;this.cache.has(r)||this._deleteIfExpired(r,i)===!1&&(yield[r,i.value])}}*entriesDescending(){let e=[...this.cache];for(let r=e.length-1;r>=0;--r){const i=e[r],[n,s]=i;this._deleteIfExpired(n,s)===!1&&(yield[n,s.value])}e=[...this.oldCache];for(let r=e.length-1;r>=0;--r){const i=e[r],[n,s]=i;this.cache.has(n)||this._deleteIfExpired(n,s)===!1&&(yield[n,s.value])}}*entriesAscending(){for(const[e,r]of this._entriesAscending())yield[e,r.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const r of this.oldCache.keys())this.cache.has(r)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,r=this){for(const[i,n]of this.entriesAscending())e.call(r,n,i,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function N1(t){return new Promise(e=>setTimeout(e,t))}function F1(t,e){const r=Array.isArray(t)?t:Array.from(t),i=Array.isArray(e)?e:Array.from(e);return r.map((n,s)=>[n,i[s]])}class Kr extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,Kr),this.name="AbortError"}}class D1 extends Error{constructor(e,r){super(r),this.errors=e,this.message=r,this.name="AggregateError"}}const G1=D1;class U1{constructor(e,r,i=null){this.offset=e,this.length=r,this.data=i}get top(){return this.offset+this.length}}class kl{constructor(e,r,i){this.offset=e,this.length=r,this.blockIds=i}}class k1 extends Eo{constructor(e,{blockSize:r=65536,cacheSize:i=100}={}){super(),this.source=e,this.blockSize=r,this.blockCache=new O1({maxSize:i,onEviction:(n,s)=>{this.evictedBlocks.set(n,s)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,r){const i=[],n=[],s=[];this.evictedBlocks.clear();for(const{offset:d,length:g}of e){let p=d+g;const{fileSize:y}=this;y!==null&&(p=Math.min(p,y));const _=Math.floor(d/this.blockSize)*this.blockSize;for(let v=_;v<p;v+=this.blockSize){const E=Math.floor(v/this.blockSize);!this.blockCache.has(E)&&!this.blockRequests.has(E)&&(this.blockIdsToFetch.add(E),n.push(E)),this.blockRequests.has(E)&&i.push(this.blockRequests.get(E)),s.push(E)}}await N1(),this.fetchBlocks(r);const a=[];for(const d of n)this.blockRequests.has(d)&&a.push(this.blockRequests.get(d));await Promise.allSettled(i),await Promise.allSettled(a);const o=[],l=s.filter(d=>this.abortedBlockIds.has(d)||!this.blockCache.has(d));if(l.forEach(d=>this.blockIdsToFetch.add(d)),l.length>0&&r&&!r.aborted){this.fetchBlocks(null);for(const d of l){const g=this.blockRequests.get(d);if(!g)throw new Error(`Block ${d} is not in the block requests`);o.push(g)}await Promise.allSettled(o)}if(r&&r.aborted)throw new Kr("Request was aborted");const h=s.map(d=>this.blockCache.get(d)||this.evictedBlocks.get(d)),u=h.filter(d=>!d);if(u.length)throw new G1(u,"Request failed");const c=new Map(F1(s,h));return this.readSliceData(e,c)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const r=this.groupBlocks(this.blockIdsToFetch),i=this.source.fetch(r,e);for(let n=0;n<r.length;++n){const s=r[n];for(const a of s.blockIds)this.blockRequests.set(a,(async()=>{try{const o=(await i)[n],l=a*this.blockSize,h=l-o.offset,u=Math.min(h+this.blockSize,o.data.byteLength),c=o.data.slice(h,u),d=new U1(l,c.byteLength,c,a);this.blockCache.set(a,d),this.abortedBlockIds.delete(a)}catch(o){if(o.name==="AbortError")o.signal=e,this.blockCache.delete(a),this.abortedBlockIds.add(a);else throw o}finally{this.blockRequests.delete(a)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const r=Array.from(e).sort((a,o)=>a-o);if(r.length===0)return[];let i=[],n=null;const s=[];for(const a of r)n===null||n+1===a?(i.push(a),n=a):(s.push(new kl(i[0]*this.blockSize,i.length*this.blockSize,i)),i=[a],n=a);return s.push(new kl(i[0]*this.blockSize,i.length*this.blockSize,i)),s}readSliceData(e,r){return e.map(i=>{let n=i.offset+i.length;this.fileSize!==null&&(n=Math.min(this.fileSize,n));const s=Math.floor(i.offset/this.blockSize),a=Math.floor(n/this.blockSize),o=new ArrayBuffer(i.length),l=new Uint8Array(o);for(let h=s;h<=a;++h){const u=r.get(h),c=u.offset-i.offset,d=u.top-n;let g=0,p=0,y;c<0?g=-c:c>0&&(p=c),d<0?y=u.length-g:y=n-u.offset-g;const _=new Uint8Array(u.data,g,y);l.set(_,p)}return o})}}class wo{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class To{constructor(e){this.url=e}async request({headers:e,credentials:r,signal:i}={}){throw new Error("request is not implemented")}}class B1 extends wo{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class z1 extends To{constructor(e,r){super(e),this.credentials=r}async request({headers:e,credentials:r,signal:i}={}){const n=await fetch(this.url,{headers:e,credentials:r,signal:i});return new B1(n)}}class $1 extends wo{constructor(e,r){super(),this.xhr=e,this.data=r}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class j1 extends To{constructRequest(e,r){return new Promise((i,n)=>{const s=new XMLHttpRequest;s.open("GET",this.url),s.responseType="arraybuffer";for(const[a,o]of Object.entries(e))s.setRequestHeader(a,o);s.onload=()=>{const a=s.response;i(new $1(s,a))},s.onerror=n,s.onabort=()=>n(new Kr("Request aborted")),s.send(),r&&(r.aborted&&s.abort(),r.addEventListener("abort",()=>s.abort()))})}async request({headers:e,signal:r}={}){return await this.constructRequest(e,r)}}const Us={};class q1 extends wo{constructor(e,r){super(),this.response=e,this.dataPromise=r}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class Z1 extends To{constructor(e){super(e),this.parsedUrl=Us.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",Us)}constructRequest(e,r){return new Promise((i,n)=>{const s=this.httpApi.get({...this.parsedUrl,headers:e},a=>{const o=new Promise(l=>{const h=[];a.on("data",u=>{h.push(u)}),a.on("end",()=>{const u=Buffer.concat(h).buffer;l(u)}),a.on("error",n)});i(new q1(a,o))});s.on("error",n),r&&(r.aborted&&s.destroy(new Kr("Request aborted")),r.addEventListener("abort",()=>s.destroy(new Kr("Request aborted"))))})}async request({headers:e,signal:r}={}){return await this.constructRequest(e,r)}}class So extends Eo{constructor(e,r,i,n){super(),this.client=e,this.headers=r,this.maxRanges=i,this.allowFullFile=n,this._fileSize=null}async fetch(e,r){return this.maxRanges>=e.length?this.fetchSlices(e,r):(this.maxRanges>0&&e.length>1,Promise.all(e.map(i=>this.fetchSlice(i,r))))}async fetchSlices(e,r){const i=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:n,length:s})=>`${n}-${n+s}`).join(",")}`},signal:r});if(i.ok)if(i.status===206){const{type:n,params:s}=L1(i.getHeader("content-type"));if(n==="multipart/byteranges"){const c=C1(await i.getData(),s.boundary);return this._fileSize=c[0].fileSize||null,c}const a=await i.getData(),{start:o,end:l,total:h}=fa(i.getHeader("content-range"));this._fileSize=h||null;const u=[{data:a,offset:o,length:l-o}];if(e.length>1){const c=await Promise.all(e.slice(1).map(d=>this.fetchSlice(d,r)));return u.concat(c)}return u}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const n=await i.getData();return this._fileSize=n.byteLength,[{data:n,offset:0,length:n.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,r){const{offset:i,length:n}=e,s=await this.client.request({headers:{...this.headers,Range:`bytes=${i}-${i+n}`},signal:r});if(s.ok)if(s.status===206){const a=await s.getData(),{total:o}=fa(s.getHeader("content-range"));return this._fileSize=o||null,{data:a,offset:i,length:n}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const a=await s.getData();return this._fileSize=a.byteLength,{data:a,offset:0,length:a.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function Mo(t,{blockSize:e,cacheSize:r}){return e===null?t:new k1(t,{blockSize:e,cacheSize:r})}function V1(t,{headers:e={},credentials:r,maxRanges:i=0,allowFullFile:n=!1,...s}={}){const a=new z1(t,r),o=new So(a,e,i,n);return Mo(o,s)}function W1(t,{headers:e={},maxRanges:r=0,allowFullFile:i=!1,...n}={}){const s=new j1(t),a=new So(s,e,r,i);return Mo(a,n)}function X1(t,{headers:e={},maxRanges:r=0,allowFullFile:i=!1,...n}={}){const s=new Z1(t),a=new So(s,e,r,i);return Mo(a,n)}function da(t,{forceXHR:e=!1,...r}={}){return typeof fetch=="function"&&!e?V1(t,r):typeof XMLHttpRequest<"u"?W1(t,r):X1(t,r)}class H1 extends Eo{constructor(e){super(),this.file=e}async fetchSlice(e,r){return new Promise((i,n)=>{const s=this.file.slice(e.offset,e.offset+e.length),a=new FileReader;a.onload=o=>i(o.target.result),a.onerror=n,a.onabort=n,a.readAsArrayBuffer(s),r&&r.addEventListener("abort",()=>a.abort())})}}function Y1(t){return new H1(t)}function ga(t){switch(t){case ne.BYTE:case ne.ASCII:case ne.SBYTE:case ne.UNDEFINED:return 1;case ne.SHORT:case ne.SSHORT:return 2;case ne.LONG:case ne.SLONG:case ne.FLOAT:case ne.IFD:return 4;case ne.RATIONAL:case ne.SRATIONAL:case ne.DOUBLE:case ne.LONG8:case ne.SLONG8:case ne.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${t}`)}}function K1(t){const e=t.GeoKeyDirectory;if(!e)return null;const r={};for(let i=4;i<=e[3]*4;i+=4){const n=s1[e[i]],s=e[i+1]?Gi[e[i+1]]:null,a=e[i+2],o=e[i+3];let l=null;if(!s)l=o;else{if(l=t[s],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${n}'.`);typeof l=="string"?l=l.substring(o,o+a-1):l.subarray&&(l=l.subarray(o,o+a),a===1&&(l=l[0]))}r[n]=l}return r}function br(t,e,r,i){let n=null,s=null;const a=ga(e);switch(e){case ne.BYTE:case ne.ASCII:case ne.UNDEFINED:n=new Uint8Array(r),s=t.readUint8;break;case ne.SBYTE:n=new Int8Array(r),s=t.readInt8;break;case ne.SHORT:n=new Uint16Array(r),s=t.readUint16;break;case ne.SSHORT:n=new Int16Array(r),s=t.readInt16;break;case ne.LONG:case ne.IFD:n=new Uint32Array(r),s=t.readUint32;break;case ne.SLONG:n=new Int32Array(r),s=t.readInt32;break;case ne.LONG8:case ne.IFD8:n=new Array(r),s=t.readUint64;break;case ne.SLONG8:n=new Array(r),s=t.readInt64;break;case ne.RATIONAL:n=new Uint32Array(r*2),s=t.readUint32;break;case ne.SRATIONAL:n=new Int32Array(r*2),s=t.readInt32;break;case ne.FLOAT:n=new Float32Array(r),s=t.readFloat32;break;case ne.DOUBLE:n=new Float64Array(r),s=t.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===ne.RATIONAL||e===ne.SRATIONAL)for(let o=0;o<r;o+=2)n[o]=s.call(t,i+o*a),n[o+1]=s.call(t,i+(o*a+4));else for(let o=0;o<r;++o)n[o]=s.call(t,i+o*a);return e===ne.ASCII?new TextDecoder("utf-8").decode(n):n}class Q1{constructor(e,r,i){this.fileDirectory=e,this.geoKeyDirectory=r,this.nextIFDByteOffset=i}}class wn extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class Xu{async readRasters(e={}){const{window:r,width:i,height:n}=e;let{resX:s,resY:a,bbox:o}=e;const l=await this.getImage();let h=l;const u=await this.getImageCount(),c=l.getBoundingBox();if(r&&o)throw new Error('Both "bbox" and "window" passed.');if(i||n){if(r){const[p,y]=l.getOrigin(),[_,v]=l.getResolution();o=[p+r[0]*_,y+r[1]*v,p+r[2]*_,y+r[3]*v]}const g=o||c;if(i){if(s)throw new Error("Both width and resX passed");s=(g[2]-g[0])/i}if(n){if(a)throw new Error("Both width and resY passed");a=(g[3]-g[1])/n}}if(s||a){const g=[];for(let p=0;p<u;++p){const y=await this.getImage(p),{SubfileType:_,NewSubfileType:v}=y.fileDirectory;(p===0||_===2||v&1)&&g.push(y)}g.sort((p,y)=>p.getWidth()-y.getWidth());for(let p=0;p<g.length;++p){const y=g[p],_=(c[2]-c[0])/y.getWidth(),v=(c[3]-c[1])/y.getHeight();if(h=y,s&&s>_||a&&a>v)break}}let d=r;if(o){const[g,p]=l.getOrigin(),[y,_]=h.getResolution(l);d=[Math.round((o[0]-g)/y),Math.round((o[1]-p)/_),Math.round((o[2]-g)/y),Math.round((o[3]-p)/_)],d=[Math.min(d[0],d[2]),Math.min(d[1],d[3]),Math.max(d[0],d[2]),Math.max(d[1],d[3])]}return h.readRasters({...e,window:d})}}let Yn=class Hu extends Xu{constructor(e,r,i,n,s={}){super(),this.source=e,this.littleEndian=r,this.bigTiff=i,this.firstIFDOffset=n,this.cache=s.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,r){const i=this.bigTiff?4048:1024;return new b1((await this.source.fetch([{offset:e,length:typeof r<"u"?r:i}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const r=this.bigTiff?20:12,i=this.bigTiff?8:2;let n=await this.getSlice(e);const s=this.bigTiff?n.readUint64(e):n.readUint16(e),a=s*r+(this.bigTiff?16:6);n.covers(e,a)||(n=await this.getSlice(e,a));const o={};let l=e+(this.bigTiff?8:2);for(let c=0;c<s;l+=r,++c){const d=n.readUint16(l),g=n.readUint16(l+2),p=this.bigTiff?n.readUint64(l+4):n.readUint32(l+4);let y,_;const v=ga(g),E=l+(this.bigTiff?12:8);if(v*p<=(this.bigTiff?8:4))y=br(n,g,p,E);else{const w=n.readOffset(E),T=ga(g)*p;if(n.covers(w,T))y=br(n,g,p,w);else{const M=await this.getSlice(w,T);y=br(M,g,p,w)}}p===1&&i1.indexOf(d)===-1&&!(g===ne.RATIONAL||g===ne.SRATIONAL)?_=y[0]:_=y,o[Gi[d]]=_}const h=K1(o),u=n.readOffset(e+i+r*s);return new Q1(o,h,u)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(r){throw r instanceof wn?new wn(e):r}return this.ifdRequests[e]=(async()=>{const r=await this.ifdRequests[e-1];if(r.nextIFDByteOffset===0)throw new wn(e);return this.parseFileDirectoryAt(r.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const r=await this.requestIFD(e);return new Vu(r.fileDirectory,r.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,r=!0;for(;r;)try{await this.requestIFD(e),++e}catch(i){if(i instanceof wn)r=!1;else throw i}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const r="GDAL_STRUCTURAL_METADATA_SIZE=",i=r.length+100;let n=await this.getSlice(e,i);if(r===br(n,ne.ASCII,r.length,e)){const a=br(n,ne.ASCII,i,e).split(`
`)[0],o=Number(a.split("=")[1].split(" ")[0])+a.length;o>i&&(n=await this.getSlice(e,o));const l=br(n,ne.ASCII,o,e);this.ghostValues={},l.split(`
`).filter(h=>h.length>0).map(h=>h.split("=")).forEach(([h,u])=>{this.ghostValues[h]=u})}return this.ghostValues}static async fromSource(e,r,i){const n=(await e.fetch([{offset:0,length:1024}],i))[0],s=new M1(n),a=s.getUint16(0,0);let o;if(a===18761)o=!0;else if(a===19789)o=!1;else throw new TypeError("Invalid byte order value.");const l=s.getUint16(2,o);let h;if(l===42)h=!1;else if(l===43){if(h=!0,s.getUint16(4,o)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const u=h?s.getUint64(8,o):s.getUint32(4,o);return new Hu(e,o,h,u,r)}close(){return typeof this.source.close=="function"?this.source.close():!1}};class J1 extends Xu{constructor(e,r){super(),this.mainFile=e,this.overviewFiles=r,this.imageFiles=[e].concat(r),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(r=>r.parseFileDirectoryAt(r.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let r=0,i=0;for(let n=0;n<this.imageFiles.length;n++){const s=this.imageFiles[n];for(let a=0;a<this.imageCounts[n];a++){if(e===r){const o=await s.requestIFD(i);return new Vu(o.fileDirectory,o.geoKeyDirectory,s.dataView,s.littleEndian,s.cache,s.source)}r++,i++}i=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(r=>r.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((r,i)=>r+i,0),this.imageCount}}async function ev(t,e={},r){return Yn.fromSource(da(t,e),r)}async function tv(t,e){return Yn.fromSource(Y1(t),e)}async function rv(t,e=[],r={},i){const n=await Yn.fromSource(da(t,r),i),s=await Promise.all(e.map(a=>Yn.fromSource(da(a,r))));return new J1(n,s)}function iv(t){return((t.fileDirectory.NewSubfileType||0)&4)===4}function nv(t,e){if(!t)return!1;if(t===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const r=e.fileDirectory.PhotometricInterpretation,i=Je;return r===i.CMYK||r===i.YCbCr||r===i.CIELab||r===i.ICCLab}const Bl="STATISTICS_MAXIMUM",zl="STATISTICS_MINIMUM",ks=256;let Bs;function sv(){return Bs||(Bs=new A1),Bs}function av(t){try{return t.getBoundingBox()}catch{return[0,0,t.getWidth(),t.getHeight()]}}function ov(t){try{return t.getOrigin().slice(0,2)}catch{return[0,t.getHeight()]}}function lv(t,e){try{return t.getResolution(e)}catch{return[e.getWidth()/t.getWidth(),e.getHeight()/t.getHeight()]}}function hv(t){const e=t.geoKeys;if(!e)return null;if(e.ProjectedCSTypeGeoKey&&e.ProjectedCSTypeGeoKey!==32767){const r="EPSG:"+e.ProjectedCSTypeGeoKey;let i=de(r);if(!i){const n=Wo(e.ProjLinearUnitsGeoKey);n&&(i=new ea({code:r,units:n}))}return i}if(e.GeographicTypeGeoKey&&e.GeographicTypeGeoKey!==32767){const r="EPSG:"+e.GeographicTypeGeoKey;let i=de(r);if(!i){const n=Wo(e.GeogAngularUnitsGeoKey);n&&(i=new ea({code:r,units:n}))}return i}return null}function cv(t){return t.getImageCount().then(function(e){const r=new Array(e);for(let i=0;i<e;++i)r[i]=t.getImage(i);return Promise.all(r)})}function uv(t,e){let r;return t.blob?r=tv(t.blob):t.overviews?r=rv(t.url,t.overviews,e):r=ev(t.url,e),r.then(cv)}function yi(t,e,r,i,n){if(Array.isArray(t)){const s=t.length;if(!Array.isArray(e)||s!=e.length){const a=new Error(i);throw n(a),a}for(let a=0;a<s;++a)yi(t[a],e[a],r,i,n);return}if(e=e,Math.abs(t-e)>r*t)throw new Error(i)}function fv(t){return t instanceof Int8Array?-128:t instanceof Int16Array?-32768:t instanceof Int32Array?-2147483648:t instanceof Float32Array?12e-39:0}function dv(t){return t instanceof Int8Array?127:t instanceof Uint8Array||t instanceof Uint8ClampedArray?255:t instanceof Int16Array?32767:t instanceof Uint16Array?65535:t instanceof Int32Array?2147483647:t instanceof Uint32Array?4294967295:t instanceof Float32Array?34e37:255}class Yu extends lo{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,opaque:e.opaque,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const r=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(r),this.sourceMasks_=new Array(r),this.resolutionFactors_=new Array(r),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map(s=>s.url).join(","));const i=this,n=new Array(r);for(let s=0;s<r;++s)n[s]=uv(this.sourceInfo_[s],this.sourceOptions_);Promise.all(n).then(function(s){i.configure_(s)}).catch(function(s){$n(s),i.error_=s,i.setState("error")})}getError(){return this.error_}determineProjection(e){const r=e[0];for(let i=r.length-1;i>=0;--i){const n=r[i],s=hv(n);if(s){this.projection=s;break}}}configure_(e){let r,i,n,s,a;const o=new Array(e.length),l=new Array(e.length),h=new Array(e.length);let u=0;const c=e.length;for(let y=0;y<c;++y){const _=[],v=[];e[y].forEach(C=>{iv(C)?v.push(C):_.push(C)});const E=_.length;if(v.length>0&&v.length!==E)throw new Error(`Expected one mask per image found ${v.length} masks and ${E} images`);let w,T;const M=new Array(E),A=new Array(E),I=new Array(E);l[y]=new Array(E),h[y]=new Array(E);for(let C=0;C<E;++C){const D=_[C],B=D.getGDALNoData();h[y][C]=D.getGDALMetadata(0),l[y][C]=B;const V=this.sourceInfo_[y].bands;o[y]=V?V.length:D.getSamplesPerPixel();const ee=E-(C+1);w||(w=av(D)),T||(T=ov(D));const f=lv(D,_[0]);I[ee]=f[0];const m=[D.getTileWidth(),D.getTileHeight()];m[0]!==m[1]&&m[1]<ks&&(m[0]=ks,m[1]=ks),M[ee]=m;const x=f[0]/Math.abs(f[1]);A[ee]=[m[0],m[1]/x]}if(r?Ct(r,w,r):r=w,!i)i=T;else{const C=`Origin mismatch for source ${y}, got [${T}] but expected [${i}]`;yi(i,T,0,C,this.viewRejector)}if(!a)a=I,this.resolutionFactors_[y]=1;else{a.length-u>I.length&&(u=a.length-I.length);const C=a[a.length-1]/I[I.length-1];this.resolutionFactors_[y]=C;const D=I.map(V=>V*=C),B=`Resolution mismatch for source ${y}, got [${D}] but expected [${a}]`;yi(a.slice(u,a.length),D,.02,B,this.viewRejector)}n?yi(n.slice(u,n.length),A,.01,`Tile size mismatch for source ${y}`,this.viewRejector):n=A,s?yi(s.slice(u,s.length),M,0,`Tile size mismatch for source ${y}`,this.viewRejector):s=M,this.sourceImagery_[y]=_.reverse(),this.sourceMasks_[y]=v.reverse()}for(let y=0,_=this.sourceImagery_.length;y<_;++y){const v=this.sourceImagery_[y];for(;v.length<a.length;)v.unshift(void 0)}this.getProjection()||this.determineProjection(e),this.samplesPerPixel_=o,this.nodataValues_=l,this.metadata_=h;e:for(let y=0;y<c;++y){if(this.sourceInfo_[y].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[y].length){this.addAlpha_=!0;break}const _=l[y],v=this.sourceInfo_[y].bands;if(v){for(let E=0;E<v.length;++E)if(_[v[E]-1]!==null){this.addAlpha_=!0;break e}continue}for(let E=0;E<_.length;++E)if(_[E]!==null){this.addAlpha_=!0;break e}}let d=this.addAlpha_?1:0;for(let y=0;y<c;++y)d+=o[y];this.bandCount=d;const g=new ls({extent:r,minZoom:u,origin:i,resolutions:a,tileSizes:n});this.tileGrid=g,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const p=1;a.length===2?a=[a[0],a[1],a[1]/2]:a.length===1&&(a=[a[0]*2,a[0],a[0]/2]),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:a,center:cg(Jt(r),this.projection),extent:ug(r,this.projection),zoom:p})}loadTile_(e,r,i){const n=this.getTileSize(e),s=this.sourceImagery_.length,a=new Array(s*2),o=this.nodataValues_,l=this.sourceInfo_,h=sv();for(let u=0;u<s;++u){const c=l[u],d=this.resolutionFactors_[u],g=[Math.round(r*(n[0]*d)),Math.round(i*(n[1]*d)),Math.round((r+1)*(n[0]*d)),Math.round((i+1)*(n[1]*d))],p=this.sourceImagery_[u][e];let y;c.bands&&(y=c.bands.map(function(T){return T-1}));let _;"nodata"in c&&c.nodata!==null?_=c.nodata:y?_=y.map(function(T){return o[u][T]}):_=o[u];const v={window:g,width:n[0],height:n[1],samples:y,fillValue:_,pool:h,interleave:!1};nv(this.convertToRGB_,p)?a[u]=p.readRGB(v):a[u]=p.readRasters(v);const E=s+u,w=this.sourceMasks_[u][e];if(!w){a[E]=Promise.resolve(null);continue}a[E]=w.readRasters({window:g,width:n[0],height:n[1],samples:[0],pool:h,interleave:!1})}return Promise.all(a).then(this.composeTile_.bind(this,n)).catch(function(u){throw $n(u),u})}composeTile_(e,r){const i=this.metadata_,n=this.sourceInfo_,s=this.sourceImagery_.length,a=this.bandCount,o=this.samplesPerPixel_,l=this.nodataValues_,h=this.normalize_,u=this.addAlpha_,c=e[0]*e[1],d=c*a;let g;h?g=new Uint8Array(d):g=new Float32Array(d);let p=0;for(let y=0;y<c;++y){let _=u;for(let v=0;v<s;++v){const E=n[v];let w=E.min,T=E.max,M,A;if(h){const I=i[v][0];w===void 0&&(I&&zl in I?w=parseFloat(I[zl]):w=fv(r[v][0])),T===void 0&&(I&&Bl in I?T=parseFloat(I[Bl]):T=dv(r[v][0])),M=255/(T-w),A=-w*M}for(let I=0;I<o[v];++I){const C=r[v][I][y];let D;if(h?D=Ae(M*C+A,0,255):D=C,!u)g[p]=D;else{let B=E.nodata;if(B===void 0){let ee;E.bands?ee=E.bands[I]-1:ee=I,B=l[v][ee]}const V=isNaN(B);(!V&&C!==B||V&&!isNaN(C))&&(_=!1,g[p]=D)}p++}if(!_){const I=s+v,C=r[I];C&&!C[0][y]&&(_=!0)}}u&&(_||(g[p]=255),p++)}return g}}Yu.prototype.getView;const Ku=Yu,gv='Google Maps<a class="ol-attribution-google-tos" href="https://cloud.google.com/maps-platform/terms/" target="_blank">Terms of Use</a> and <a class="ol-attribution-google-tos" href="https://policies.google.com/privacy" target="_blank">Privacy Policy</a>',pv="https://tile.googleapis.com/v1/createSession",mv="https://tile.googleapis.com/v1/2dtiles",yv=22;class _v extends ar{constructor(e){const r=!!e.highDpi,i=e.overlay!==!0,n=e.attributions||[gv];super({attributions:n,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,opaque:i,projection:"EPSG:3857",reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:r?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.apiKey_=e.key,this.error_=null;const s={mapType:e.mapType||"roadmap",language:e.language||"en-US",region:e.region||"US"};e.imageFormat&&(s.imageFormat=e.imageFormat),e.scale&&(s.scale=e.scale),r&&(s.highDpi=!0),e.layerTypes&&(s.layerTypes=e.layerTypes),e.styles&&(s.styles=e.styles),e.overlay===!0&&(s.overlay=!0),this.sessionTokenRequest_=s,this.sessionRefreshId_,this.createSession_()}getError(){return this.error_}fetchSessionToken(e,r){return fetch(e,r)}async createSession_(){const e=pv+"?key="+this.apiKey_,r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.sessionTokenRequest_)},i=await this.fetchSessionToken(e,r);if(!i.ok){try{const c=await i.json();this.error_=new Error(c.error.message)}catch{this.error_=new Error("Error fetching session token")}this.setState("error");return}const n=await i.json(),s=this.getTilePixelRatio(1),a=[n.tileWidth/s,n.tileHeight/s];this.tileGrid=rn({extent:tn(this.getProjection()),maxZoom:yv,tileSize:a});const o=n.session,l=this.apiKey_;this.tileUrlFunction=function(c,d,g){const p=c[0],y=c[1],_=c[2];return`${mv}/${p}/${y}/${_}?session=${o}&key=${l}`};const h=parseInt(n.expiry,10)*1e3,u=Math.max(h-Date.now()-60*1e3,1);this.sessionRefreshId_=setTimeout(()=>this.createSession_(),u),this.setState("ready")}disposeInternal(){clearTimeout(this.sessionRefreshId_),super.disposeInternal()}}const xv=_v;let Qu=class extends La{constructor(e,r,i,n,s,a,o){super(r,i,n,s,a,o),this.zoomifyImage_=null,this.tileSize_=e}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=super.getImage();if(this.state==Q.LOADED){const r=this.tileSize_;if(e.width==r[0]&&e.height==r[1])return this.zoomifyImage_=e,e;const i=Zt(r[0],r[1]);return i.drawImage(e,0,0),this.zoomifyImage_=i.canvas,i.canvas}return e}};class vv extends ar{constructor(e){const r=e.size,i=e.tierSizeCalculation!==void 0?e.tierSizeCalculation:"default",n=e.tilePixelRatio||1,s=r[0],a=r[1],o=[],l=e.tileSize||ta;let h=l*n;switch(i){case"default":for(;s>h||a>h;)o.push([Math.ceil(s/h),Math.ceil(a/h)]),h+=h;break;case"truncated":let A=s,I=a;for(;A>h||I>h;)o.push([Math.ceil(A/h),Math.ceil(I/h)]),A>>=1,I>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}o.push([1,1]),o.reverse();const u=[n],c=[0];for(let A=1,I=o.length;A<I;A++)u.push(n<<A),c.push(o[A-1][0]*o[A-1][1]+c[A-1]);u.reverse();const d=new ls({tileSize:l,extent:e.extent||[0,-a,s,0],resolutions:u});let g=e.url;g&&!g.includes("{TileGroup}")&&!g.includes("{tileIndex}")&&(g+="{TileGroup}/{z}-{x}-{y}.jpg");const p=fg(g);let y=l*n;function _(A){return function(I,C,D){if(!I)return;const B=I[0],V=I[1],ee=I[2],f=V+ee*o[B][0],m=(f+c[B])/y|0,x={z:B,x:V,y:ee,tileIndex:f,TileGroup:"TileGroup"+m};return A.replace(/\{(\w+?)\}/g,function(S,L){return x[L]})}}const v=Fc(p.map(_)),E=Qu.bind(null,Ot(l*n));super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,tilePixelRatio:n,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:E,tileGrid:d,tileUrlFunction:v,transition:e.transition}),this.zDirection=e.zDirection;const w=d.getTileCoordForCoordAndResolution(Jt(d.getExtent()),u[u.length-1]),T=v(w,1,null),M=new Image;M.addEventListener("error",()=>{y=l,this.changed()}),M.src=T}}const Ev=vv;function ui(t){return t.toLocaleString("en",{maximumFractionDigits:10})}class wv extends ar{constructor(e){const r=e||{};let i=r.url||"";i=i+(i.lastIndexOf("/")===i.length-1||i===""?"":"/");const n=r.version||Ge.VERSION2,s=r.sizes||[],a=r.size;Gt(a!=null&&Array.isArray(a)&&a.length==2&&!isNaN(a[0])&&a[0]>0&&!isNaN(a[1])&&a[1]>0,"Missing or invalid `size`");const o=a[0],l=a[1],h=r.tileSize,u=r.tilePixelRatio||1,c=r.format||"jpg",d=r.quality||(r.version==Ge.VERSION1?"native":"default");let g=r.resolutions||[];const p=r.supports||[],y=r.extent||[0,-l,o,0],_=s!=null&&Array.isArray(s)&&s.length>0,v=h!==void 0&&(typeof h=="number"&&Number.isInteger(h)&&h>0||Array.isArray(h)&&h.length>0),E=p!=null&&Array.isArray(p)&&(p.includes("regionByPx")||p.includes("regionByPct"))&&(p.includes("sizeByWh")||p.includes("sizeByH")||p.includes("sizeByW")||p.includes("sizeByPct"));let w,T,M;if(g.sort(function(D,B){return B-D}),v||E)if(h!=null&&(typeof h=="number"&&Number.isInteger(h)&&h>0?(w=h,T=h):Array.isArray(h)&&h.length>0&&((h.length==1||h[1]==null&&Number.isInteger(h[0]))&&(w=h[0],T=h[0]),h.length==2&&(Number.isInteger(h[0])&&Number.isInteger(h[1])?(w=h[0],T=h[1]):h[0]==null&&Number.isInteger(h[1])&&(w=h[1],T=h[1])))),(w===void 0||T===void 0)&&(w=ta,T=ta),g.length==0){M=Math.max(Math.ceil(Math.log(o/w)/Math.LN2),Math.ceil(Math.log(l/T)/Math.LN2));for(let D=M;D>=0;D--)g.push(Math.pow(2,D))}else{const D=Math.max(...g);M=Math.round(Math.log(D)/Math.LN2)}else if(w=o,T=l,g=[],_){s.sort(function(B,V){return B[0]-V[0]}),M=-1;const D=[];for(let B=0;B<s.length;B++){const V=o/s[B][0];if(g.length>0&&g[g.length-1]==V){D.push(B);continue}g.push(V),M++}if(D.length>0)for(let B=0;B<D.length;B++)s.splice(D[B]-B,1)}else g.push(1),s.push([o,l]),M=0;const A=new ls({tileSize:[w,T],extent:y,origin:dg(y),resolutions:g}),I=function(D,B,V){let ee,f;const m=D[0];if(m>M)return;const x=D[1],S=D[2],L=g[m];if(!(x===void 0||S===void 0||L===void 0||x<0||Math.ceil(o/L/w)<=x||S<0||Math.ceil(l/L/T)<=S)){if(E||v){const O=x*w*L,N=S*T*L;let F=w*L,$=T*L,X=w,ce=T;if(O+F>o&&(F=o-O),N+$>l&&($=l-N),O+w*L>o&&(X=Math.floor((o-O+L-1)/L)),N+T*L>l&&(ce=Math.floor((l-N+L-1)/L)),O==0&&F==o&&N==0&&$==l)ee="full";else if(!E||p.includes("regionByPx"))ee=O+","+N+","+F+","+$;else if(p.includes("regionByPct")){const he=ui(O/o*100),ge=ui(N/l*100),ue=ui(F/o*100),Se=ui($/l*100);ee="pct:"+he+","+ge+","+ue+","+Se}n==Ge.VERSION3&&(!E||p.includes("sizeByWh"))?f=X+","+ce:!E||p.includes("sizeByW")?f=X+",":p.includes("sizeByH")?f=","+ce:p.includes("sizeByWh")?f=X+","+ce:p.includes("sizeByPct")&&(f="pct:"+ui(100/L))}else if(ee="full",_){const O=s[m][0],N=s[m][1];n==Ge.VERSION3?O==o&&N==l?f="max":f=O+","+N:O==o?f="full":f=O+","}else f=n==Ge.VERSION3?"max":"full";return i+ee+"/"+f+"/0/"+d+"."+c}},C=Qu.bind(null,Ot(h||256).map(function(D){return D*u}));super({attributions:r.attributions,attributionsCollapsible:r.attributionsCollapsible,cacheSize:r.cacheSize,crossOrigin:r.crossOrigin,interpolate:r.interpolate,projection:r.projection,reprojectionErrorThreshold:r.reprojectionErrorThreshold,state:r.state,tileClass:C,tileGrid:A,tilePixelRatio:r.tilePixelRatio,tileUrlFunction:I,transition:r.transition}),this.zDirection=r.zDirection}}const Tv=wv;function Ju(t,e,r,i,n,s){const a=n.getCode().split(/:(?=\d+$)/).pop(),o=r/i,l=[Xo(ht(e)/o,Ho),Xo(ir(e)/o,Ho)];s.SIZE=l[0]+","+l[1],s.BBOX=e.join(","),s.BBOXSR=a,s.IMAGESR=a,s.DPI=Math.round(s.DPI?s.DPI*i:90*i);const h=t.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return Gc(h,s)}function ef(t){const e=t.load?t.load:ri,r=de(t.projection||"EPSG:3857");return function(i,n,s){s=t.hidpi?s:1;const a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(a,t.params),i=Dc(i,n,s,t.ratio);const o=Ju(t.url,i,n,s,r,a),l=new Image;return t.crossOrigin!==null&&(l.crossOrigin=t.crossOrigin),e(l,o).then(h=>{const u=ht(i)/h.width*s;return{image:h,extent:i,resolution:u,pixelRatio:s}})}}class Sv extends wr{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:Fa,this.params_=Object.assign({},e.params),this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,r,i,n){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==n)&&(this.loaderProjection_=n,this.loader=ef({crossOrigin:this.crossOrigin_,params:this.params_,projection:n,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,a)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,a),ri(s))})),super.getImageInternal(e,r,i,n))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}const Mv=Sv;class bv extends wr{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions,state:e.state}),this.canvasFunction_=e.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5}getImageInternal(e,r,i,n){r=this.findNearestResolution(r);let s=this.canvas_;if(s&&this.renderedRevision_==this.getRevision()&&s.getResolution()==r&&s.getPixelRatio()==i&&Ln(s.getExtent(),e))return s;e=e.slice(),Lc(e,this.ratio_);const a=ht(e)/r,o=ir(e)/r,l=[a*i,o*i],h=this.canvasFunction_.call(this,e,r,i,l,n);return h&&(s=new no(e,r,i,h)),this.canvas_=s,this.renderedRevision_=this.getRevision(),s}}const Rv=bv;function Pv(t,e,r,i){const n=ht(t),s=ir(t),a=e[0],o=e[1],l=.0254/i;return o*n>a*s?n*r/(a*l):s*r/(o*l)}function Av(t,e,r,i,n,s,a){const o=Pv(r,i,s,a),l=Jt(r),h={OPERATION:n?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:a,SETDISPLAYWIDTH:Math.round(i[0]),SETDISPLAYHEIGHT:Math.round(i[1]),SETVIEWSCALE:o,SETVIEWCENTERX:l[0],SETVIEWCENTERY:l[1]};return Object.assign(h,e),Gc(t,h)}function tf(t){const e=t.load||ri;return function(r,i,n){const s=new Image;t.crossOrigin!==null&&(s.crossOrigin=t.crossOrigin),r=Dc(r,i,n,t.ratio);const a=ht(r)/i,o=ir(r)/i,l=[a*n,o*n],h=Av(t.url,t.params,r,l,t.useOverlay,t.metersPerUnit||1,t.displayDpi||96);return e(s,h).then(u=>({image:u,extent:r,pixelRatio:n}))}}class Iv extends wr{constructor(e){super({interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.displayDpi_=e.displayDpi!==void 0?e.displayDpi:96,this.params_=Object.assign({},e.params),this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:Fa,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.metersPerUnit_=e.metersPerUnit!==void 0?e.metersPerUnit:1,this.ratio_=e.ratio!==void 0?e.ratio:1,this.useOverlay_=e.useOverlay!==void 0?e.useOverlay:!1,this.renderedRevision_=0,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,r,i,n){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==n)&&(this.loaderProjection_=n,this.loader=tf({crossOrigin:this.crossOrigin_,params:this.params_,hidpi:this.hidpi_,metersPerUnit:this.metersPerUnit_,url:this.url_,useOverlay:this.useOverlay_,ratio:this.ratio_,load:(s,a)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,a),ri(s))})),super.getImageInternal(e,r,i,n))}getImageLoadFunction(){return this.imageLoadFunction_}updateParams(e){Object.assign(this.params_,e),this.changed()}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}changed(){this.image=null,super.changed()}}const Lv=Iv;function rf(t){const e=t.load||ri,r=t.imageExtent,i=new Image;return t.crossOrigin!==null&&(i.crossOrigin=t.crossOrigin),()=>e(i,t.url).then(n=>{const s=ht(r)/n.width,a=ir(r)/n.height;return{image:n,extent:r,resolution:s!==a?[s,a]:a,pixelRatio:1}})}class Cv extends wr{constructor(e){const r=e.crossOrigin!==void 0?e.crossOrigin:null,i=e.imageLoadFunction!==void 0?e.imageLoadFunction:Fa;super({attributions:e.attributions,interpolate:e.interpolate,projection:de(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new Ic(this.imageExtent_,void 0,1,rf({url:e.url,imageExtent:e.imageExtent,crossOrigin:r,load:(n,s)=>(this.image.setImage(n),i(this.image,s),ri(n))})),this.image.addEventListener(it.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,r,i,n){return Xr(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}const nf=Cv;function bo(t,e,r,i){const n=document.createElement("script"),s="olc_"+De(e);function a(){delete window[s],n.parentNode.removeChild(n)}n.async=!0,n.src=t+(t.includes("?")?"&":"?")+(i||"callback")+"="+s;const o=setTimeout(function(){a(),r&&r()},1e4);window[s]=function(l){clearTimeout(o),a(),e(l)},document.head.appendChild(n)}class Ov extends Error{constructor(e){const r="Unexpected response status: "+e.status;super(r),this.name="ResponseError",this.response=e}}class Nv extends Error{constructor(e){super("Failed to issue request"),this.name="ClientError",this.client=e}}function sf(t){return new Promise(function(e,r){function i(a){const o=a.target;if(!o.status||o.status>=200&&o.status<300){let l;try{l=JSON.parse(o.responseText)}catch(h){const u="Error parsing response text as JSON: "+h.message;r(new Error(u));return}e(l);return}r(new Ov(o))}function n(a){r(new Nv(a.target))}const s=new XMLHttpRequest;s.addEventListener("load",i),s.addEventListener("error",n),s.open("GET",t),s.setRequestHeader("Accept","application/json"),s.send()})}function af(t,e){return e.includes("://")?e:new URL(e,t).href}const Fv={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},Dv={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function Gv(t,e){let r,i;for(let n=0;n<t.length;++n){const s=t[n];if(s.rel==="item"){if(s.type===e){r=s.href;break}(Fv[s.type]||!i&&s.type.startsWith("image/"))&&(i=s.href)}}if(!r)if(i)r=i;else throw new Error('Could not find "item" link');return r}function Uv(t,e,r){let i,n;const s={};for(let a=0;a<t.length;++a){const o=t[a];if(s[o.type]=o.href,o.rel==="item"){if(o.type===e){i=o.href;break}Dv[o.type]&&(n=o.href)}}if(!i&&r)for(let a=0;a<r.length;++a){const o=r[a];if(s[o]){i=s[o];break}}if(!i)if(n)i=n;else throw new Error('Could not find "item" link');return i}function $l(t,e,r,i){let n=t.projection;if(!n&&(n=de(e.crs),!n))throw new Error(`Unsupported CRS: ${e.crs}`);const s=e.orderedAxes,a=(s?s.slice(0,2).map(M=>M.replace(/E|X|Lon/i,"e").replace(/N|Y|Lat/i,"n")).join(""):n.getAxisOrientation().substr(0,2))!=="en",o=e.tileMatrices,l={};for(let M=0;M<o.length;++M){const A=o[M];l[A.id]=A}const h={},u=[];if(i)for(let M=0;M<i.length;++M){const A=i[M],I=A.tileMatrix;u.push(I),h[I]=A}else for(let M=0;M<o.length;++M){const A=o[M].id;u.push(A)}const c=u.length,d=new Array(c),g=new Array(c),p=new Array(c),y=new Array(c),_=[-1/0,-1/0,1/0,1/0];for(let M=0;M<c;++M){const A=u[M],I=l[A],C=I.pointOfOrigin;a?d[M]=[C[1],C[0]]:d[M]=C,g[M]=I.cellSize,p[M]=[I.matrixWidth,I.matrixHeight],y[M]=[I.tileWidth,I.tileHeight];const D=h[A];if(D){const B=I.cellSize*I.tileWidth,V=d[M][0]+D.minTileCol*B,ee=d[M][0]+(D.maxTileCol+1)*B,f=I.cellSize*I.tileHeight,m=I.cornerOfOrigin==="bottomLeft";let x,S;m?(x=d[M][1]+D.minTileRow*f,S=d[M][1]+(D.maxTileRow+1)*f):(x=d[M][1]-(D.maxTileRow+1)*f,S=d[M][1]-D.minTileRow*f),Ct(_,[V,x,ee,S],_)}}const v=new ls({origins:d,resolutions:g,sizes:p,tileSizes:y,extent:i?_:void 0}),E=t.context,w=t.url;function T(M,A,I){if(!M)return;const C=u[M[0]],D=l[C],B=D.cornerOfOrigin==="bottomLeft",V={tileMatrix:C,tileCol:M[1],tileRow:B?-M[2]-1:M[2]};if(i){const f=h[D.id];if(V.tileCol<f.minTileCol||V.tileCol>f.maxTileCol||V.tileRow<f.minTileRow||V.tileRow>f.maxTileRow)return}Object.assign(V,E);const ee=r.replace(/\{(\w+?)\}/g,function(f,m){return V[m]});return af(w,ee)}return{grid:v,urlTemplate:r,urlFunction:T}}function kv(t,e){const r=e.tileMatrixSetLimits;let i;if(e.dataType==="map")i=Gv(e.links,t.mediaType);else if(e.dataType==="vector")i=Uv(e.links,t.mediaType,t.supportedMediaTypes);else throw new Error('Expected tileset data type to be "map" or "vector"');if(e.tileMatrixSet)return $l(t,e.tileMatrixSet,i,r);const n=e.links.find(o=>o.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!n)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const s=n.href,a=af(t.url,s);return sf(a).then(function(o){return $l(t,o,i,r)})}function of(t){return sf(t.url).then(function(e){return kv(t,e)})}class Bv extends ar{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition});const r={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,context:e.context||null};of(r).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){$n(e),this.setState("error")}}const zv=Bv;class $v extends hs{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,format:e.format,overlaps:e.overlaps,projection:e.projection,tileClass:e.tileClass,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection,state:"loading"});const r={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,supportedMediaTypes:e.format.supportedMediaTypes,context:e.context||null};of(r).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){$n(e),this.setState("error")}}const jv=$v;let lf=!0;try{new ImageData(10,10)}catch{lf=!1}let zs;function qv(t,e,r){if(lf)return new ImageData(t,e,r);zs||(zs=document.createElement("canvas").getContext("2d"));const i=zs.createImageData(e,r);return i.data.set(t),i}function hf(t){let e=!0;try{new ImageData(10,10)}catch{e=!1}function r(i,n,s){return e?new ImageData(i,n,s):{data:i,width:n,height:s}}return function(i){const n=i.buffers,s=i.meta,a=i.imageOps,o=i.width,l=i.height,h=n.length,u=n[0].byteLength;if(a){const p=new Array(h);for(let _=0;_<h;++_)p[_]=r(new Uint8ClampedArray(n[_]),o,l);return t(p,s).data.buffer}const c=new Uint8ClampedArray(u),d=new Array(h),g=new Array(h);for(let p=0;p<h;++p)d[p]=new Uint8ClampedArray(n[p]),g[p]=[0,0,0,0];for(let p=0;p<u;p+=4){for(let _=0;_<h;++_){const v=d[_];g[_][0]=v[p],g[_][1]=v[p+1],g[_][2]=v[p+2],g[_][3]=v[p+3]}const y=t(g,s);c[p]=y[0],c[p+1]=y[1],c[p+2]=y[2],c[p+3]=y[3]}return c.buffer}}function Zv(t,e){const i=Object.keys(t.lib||{}).map(function(s){return"const "+s+" = "+t.lib[s].toString()+";"}).concat(["const __minion__ = ("+hf.toString()+")(",t.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),n=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(i.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(i,{type:"text/javascript"})));return n.addEventListener("message",e),n}function Vv(t,e){const r=hf(t.operation);let i=!1;return{postMessage:function(n){setTimeout(function(){i||e({data:{buffer:r(n),meta:n.meta}})},0)},terminate:function(){i=!0}}}class Wv extends Tc{constructor(e){super(),this._imageOps=!!e.imageOps;let r;e.threads===0?r=0:this._imageOps?r=1:r=e.threads||1;const i=new Array(r);if(r)for(let n=0;n<r;++n)i[n]=Zv(e,this._onWorkerMessage.bind(this,n));else i[0]=Vv(e,this._onWorkerMessage.bind(this,0));this._workers=i,this._queue=[],this._maxQueueLength=e.queue||1/0,this._running=0,this._dataLookup={},this._job=null}process(e,r,i){this._enqueue({inputs:e,meta:r,callback:i}),this._dispatch()}_enqueue(e){for(this._queue.push(e);this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)}_dispatch(){if(this._running||this._queue.length===0)return;const e=this._queue.shift();this._job=e;const r=e.inputs[0].width,i=e.inputs[0].height,n=e.inputs.map(function(l){return l.data.buffer}),s=this._workers.length;if(this._running=s,s===1){this._workers[0].postMessage({buffers:n,meta:e.meta,imageOps:this._imageOps,width:r,height:i},n);return}const a=e.inputs[0].data.length,o=4*Math.ceil(a/4/s);for(let l=0;l<s;++l){const h=l*o,u=[];for(let c=0,d=n.length;c<d;++c)u.push(n[c].slice(h,h+o));this._workers[l].postMessage({buffers:u,meta:e.meta,imageOps:this._imageOps,width:r,height:i},u)}}_onWorkerMessage(e,r){this.disposed||(this._dataLookup[e]=r.data,--this._running,this._running===0&&this._resolveJob())}_resolveJob(){const e=this._job,r=this._workers.length;let i,n;if(r===1)i=new Uint8ClampedArray(this._dataLookup[0].buffer),n=this._dataLookup[0].meta;else{const s=e.inputs[0].data.length;i=new Uint8ClampedArray(s),n=new Array(r);const a=4*Math.ceil(s/4/r);for(let o=0;o<r;++o){const l=this._dataLookup[o].buffer,h=o*a;i.set(new Uint8ClampedArray(l),h),n[o]=this._dataLookup[o].meta}}this._job=null,this._dataLookup={},e.callback(null,qv(i,e.inputs[0].width,e.inputs[0].height),n),this._dispatch()}disposeInternal(){for(let e=0;e<this._workers.length;++e)this._workers[e].terminate();this._workers.length=0}}const jl={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class ql extends Uc{constructor(e,r,i){super(e),this.extent=r.extent,this.resolution=r.viewState.resolution/r.pixelRatio,this.data=i}}class cf extends wr{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=e.operationType!==void 0?e.operationType:"pixel",this.threads_=e.threads!==void 0?e.threads:1,this.layers_=Yv(e.sources);const r=this.changed.bind(this);for(let i=0,n=this.layers_.length;i<n;++i)this.layers_[i].addEventListener(it.CHANGE,r);this.useResolutions_=e.resolutions!==null,this.tileQueue_=new gg(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:wt(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:Hv(this.layers_),pixelRatio:1,pixelToCoordinateTransform:wt(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:De(this),renderTargets:{}},this.setAttributions(function(i){const n=[];for(let s=0,a=e.sources.length;s<a;++s){const o=e.sources[s],l=o instanceof Da?o:o.getSource();if(!l)continue;const h=l.getAttributions();if(typeof h=="function"){const u=h(i);n.push.apply(n,u)}}return n.length!==0?n:null}),e.operation!==void 0&&this.setOperation(e.operation,e.lib)}setOperation(e,r){this.processor_&&this.processor_.dispose(),this.processor_=new Wv({operation:e,imageOps:this.operationType_==="image",queue:1,lib:r,threads:this.threads_}),this.changed()}updateFrameState_(e,r,i){const n=Object.assign({},this.frameState_);n.viewState=Object.assign({},n.viewState);const s=Jt(e);n.size[0]=Math.ceil(ht(e)/r),n.size[1]=Math.ceil(ir(e)/r),n.extent=[s[0]-n.size[0]*r/2,s[1]-n.size[1]*r/2,s[0]+n.size[0]*r/2,s[1]+n.size[1]*r/2],n.time=Date.now();const a=n.viewState;return a.center=s,a.projection=i,a.resolution=r,n}allSourcesReady_(){let e=!0,r;for(let i=0,n=this.layers_.length;i<n;++i)if(r=this.layers_[i].getSource(),!r||r.getState()!=="ready"){e=!1;break}return e}getImage(e,r,i,n){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),r=this.findNearestResolution(r);const s=this.updateFrameState_(e,r,n);if(this.requestedFrameState_=s,this.renderedImageCanvas_){const a=this.renderedImageCanvas_.getResolution(),o=this.renderedImageCanvas_.getExtent();(r!==a||!Un(s.extent,o))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),s.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const e=this.requestedFrameState_,r=this.layers_.length,i=new Array(r);for(let s=0;s<r;++s){e.layerIndex=s,e.renderTargets={};const a=Xv(this.layers_[s],e);if(a)i[s]=a;else return}const n={};this.dispatchEvent(new ql(jl.BEFOREOPERATIONS,e,n)),this.processor_.process(i,n,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,r,i,n){if(r||!i)return;const s=e.extent,a=e.viewState.resolution;if(a!==this.requestedFrameState_.viewState.resolution||!Un(s,this.requestedFrameState_.extent))return;let o;if(this.renderedImageCanvas_)o=this.renderedImageCanvas_.getImage().getContext("2d");else{const l=Math.round(ht(s)/a),h=Math.round(ir(s)/a);o=Zt(l,h),this.renderedImageCanvas_=new no(s,a,1,o.canvas)}o.putImageData(i,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new ql(jl.AFTEROPERATIONS,e,n))}getResolutions(e){if(!this.useResolutions_)return null;let r=super.getResolutions();if(!r)for(let i=0,n=this.layers_.length;i<n&&(r=this.layers_[i].getSource().getResolutions(e),!r);++i);return r}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}cf.prototype.dispose;let ur=null;function Xv(t,e){const r=t.getRenderer();if(!r)throw new Error("Unsupported layer type: "+t);if(!r.prepareFrame(e))return null;const i=e.size[0],n=e.size[1];if(i===0||n===0)return null;const s=r.renderFrame(e,null);let a;if(s instanceof HTMLCanvasElement)a=s;else{if(s&&(a=s.firstElementChild),!(a instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+a);if(a.width===i&&a.height===n)return a.getContext("2d").getImageData(0,0,i,n)}if(!ur)ur=Zt(i,n,void 0,{willReadFrequently:!0});else{const o=ur.canvas;o.width!==i||o.height!==n?ur=Zt(i,n,void 0,{willReadFrequently:!0}):ur.clearRect(0,0,i,n)}return ur.drawImage(a,0,0,i,n),ur.getImageData(0,0,i,n)}function Hv(t){return t.map(function(e){return e.getLayerState()})}function Yv(t){const e=t.length,r=new Array(e);for(let i=0;i<e;++i)r[i]=Kv(t[i]);return r}function Kv(t){let e;return t instanceof Da?t instanceof os?e=new Bn({source:t}):t instanceof wr&&(e=new Oa({source:t})):e=t,e}const Qv=cf,Jv='&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>',eE='&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>',tE='&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>',rE={stamen_terrain:{extension:"png",opaque:!0},stamen_terrain_background:{extension:"png",opaque:!0},stamen_terrain_labels:{extension:"png",opaque:!1},stamen_terrain_lines:{extension:"png",opaque:!1},stamen_toner_background:{extension:"png",opaque:!0},stamen_toner:{extension:"png",opaque:!0},stamen_toner_labels:{extension:"png",opaque:!1},stamen_toner_lines:{extension:"png",opaque:!1},stamen_toner_lite:{extension:"png",opaque:!0},stamen_watercolor:{extension:"jpg",opaque:!0},alidade_smooth:{extension:"png",opaque:!0},alidade_smooth_dark:{extension:"png",opaque:!0},outdoors:{extension:"png",opaque:!0},osm_bright:{extension:"png",opaque:!0}},iE={stamen_terrain:{minZoom:0,maxZoom:18,retina:!0},stamen_toner:{minZoom:0,maxZoom:20,retina:!0},stamen_watercolor:{minZoom:1,maxZoom:18,retina:!1}};class nE extends Yr{constructor(e){const r=e.layer.indexOf("-"),i=r==-1?e.layer:e.layer.slice(0,r),n=iE[i]||{minZoom:0,maxZoom:20,retina:!0},s=rE[e.layer],a=e.apiKey?"?api_key="+e.apiKey:"",o=n.retina&&e.retina?"@2x":"",l=e.url!==void 0?e.url:"https://tiles.stadiamaps.com/tiles/"+e.layer+"/{z}/{x}/{y}"+o+"."+s.extension+a,h=[Jv,eE,pg];e.layer.startsWith("stamen_")&&h.splice(1,0,tE),super({attributions:h,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:n.maxZoom,minZoom:e.minZoom!==void 0?e.minZoom:n.minZoom,opaque:s.opaque,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:l,tilePixelRatio:o?2:1,wrapX:e.wrapX,zDirection:e.zDirection})}}const sE=nE;class aE extends ar{constructor(e){e=e||{},super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.params_=Object.assign({},e.params),this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=Aa(),this.setKey(this.getKeyForParams_())}getKeyForParams_(){let e=0;const r=[];for(const i in this.params_)r[e++]=i+"-"+this.params_[i];return r.join("/")}getParams(){return this.params_}getRequestUrl_(e,r,i,n,s,a){const o=this.urls;if(!o)return;let l;if(o.length==1)l=o[0];else{const h=mg(yg(e),o.length);l=o[h]}return Ju(l,i,(this.tileGrid||this.getTileGridForProjection(s)).getResolution(e[0]),n,s,a)}getTilePixelRatio(e){return this.hidpi_?e:1}updateParams(e){Object.assign(this.params_,e),this.setKey(this.getKeyForParams_())}tileUrlFunction(e,r,i){let n=this.getTileGrid();if(n||(n=this.getTileGridForProjection(i)),n.getResolutions().length<=e[0])return;r!=1&&!this.hidpi_&&(r=1);const s=n.getTileCoordExtent(e,this.tmpExtent_);let a=Ot(n.getTileSize(e[0]),this.tmpSize);r!=1&&(a=_g(a,r,this.tmpSize));const o={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(o,this.params_),this.getRequestUrl_(e,a,s,r,i,o)}}const oE=aE;class lE extends Yr{constructor(e){e=e||{},super({opaque:!1,projection:e.projection,tileGrid:e.tileGrid,wrapX:e.wrapX!==void 0?e.wrapX:!0,zDirection:e.zDirection,url:e.template||"z:{z} x:{x} y:{y}",tileLoadFunction:(r,i)=>{const n=r.getTileCoord()[0],s=Ot(this.tileGrid.getTileSize(n)),a=Zt(s[0],s[1]);a.strokeStyle="grey",a.strokeRect(.5,.5,s[0]+.5,s[1]+.5),a.fillStyle="grey",a.strokeStyle="white",a.textAlign="center",a.textBaseline="middle",a.font="24px sans-serif",a.lineWidth=4,a.strokeText(i,s[0]/2,s[1]/2,s[0]),a.fillText(i,s[0]/2,s[1]/2,s[0]),r.setImage(a.canvas)}})}}const hE=lE;class cE extends ar{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:de("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)bo(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const r=new XMLHttpRequest;r.addEventListener("load",this.onXHRLoad_.bind(this)),r.addEventListener("error",this.onXHRError_.bind(this)),r.open("GET",e.url),r.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const r=e.target;if(!r.status||r.status>=200&&r.status<300){let i;try{i=JSON.parse(r.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(i)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const r=de("EPSG:4326"),i=this.getProjection();let n;if(e.bounds!==void 0){const h=Na(r,i);n=$i(e.bounds,h)}const s=tn(i),a=e.minzoom||0,o=e.maxzoom||22,l=rn({extent:s,maxZoom:o,minZoom:a,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=kc(e.tiles,l),e.attribution&&!this.getAttributions()){const h=n!==void 0?n:s;this.setAttributions(function(u){return Xr(h,u.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}}const uf=cE;class uE extends Rc{constructor(e,r,i,n,s,a){super(e,r),this.src_=i,this.extent_=n,this.preemptive_=s,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=a}getImage(){return null}getData(e){if(!this.grid_||!this.keys_)return null;const r=(e[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),i=(e[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),n=this.grid_[Math.floor((1-i)*this.grid_.length)];if(typeof n!="string")return null;let s=n.charCodeAt(Math.floor(r*n.length));s>=93&&s--,s>=35&&s--,s-=32;let a=null;if(s in this.keys_){const o=this.keys_[s];this.data_&&o in this.data_?a=this.data_[o]:a=o}return a}forDataAtCoordinate(e,r,i){this.state==Q.EMPTY&&i===!0?(this.state=Q.IDLE,vg(this,it.CHANGE,function(n){r(this.getData(e))},this),this.loadInternal_()):i===!0?setTimeout(()=>{r(this.getData(e))},0):r(this.getData(e))}getKey(){return this.src_}handleError_(){this.state=Q.ERROR,this.changed()}handleLoad_(e){this.grid_=e.grid,this.keys_=e.keys,this.data_=e.data,this.state=Q.LOADED,this.changed()}loadInternal_(){if(this.state==Q.IDLE)if(this.state=Q.LOADING,this.jsonp_)bo(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",this.src_),e.send()}}onXHRLoad_(e){const r=e.target;if(!r.status||r.status>=200&&r.status<300){let i;try{i=JSON.parse(r.responseText)}catch{this.handleError_();return}this.handleLoad_(i)}else this.handleError_()}onXHRError_(e){this.handleError_()}load(){this.preemptive_?this.loadInternal_():this.setState(Q.EMPTY)}}class fE extends os{constructor(e){if(super({projection:de("EPSG:3857"),state:"loading",zDirection:e.zDirection}),this.preemptive_=e.preemptive!==void 0?e.preemptive:!0,this.tileUrlFunction_=xg,this.template_=void 0,this.jsonp_=e.jsonp||!1,e.url)if(this.jsonp_)bo(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const r=new XMLHttpRequest;r.addEventListener("load",this.onXHRLoad_.bind(this)),r.addEventListener("error",this.onXHRError_.bind(this)),r.open("GET",e.url),r.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const r=e.target;if(!r.status||r.status>=200&&r.status<300){let i;try{i=JSON.parse(r.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(i)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTemplate(){return this.template_}forDataAtCoordinateAndResolution(e,r,i,n){if(this.tileGrid){const s=this.tileGrid.getZForResolution(r,this.zDirection),a=this.tileGrid.getTileCoordForCoordAndZ(e,s);this.getTile(a[0],a[1],a[2],1,this.getProjection()).forDataAtCoordinate(e,i,n)}else n===!0?setTimeout(function(){i(null)},0):i(null)}handleTileJSONError(){this.setState("error")}handleTileJSONResponse(e){const r=de("EPSG:4326"),i=this.getProjection();let n;if(e.bounds!==void 0){const u=Na(r,i);n=$i(e.bounds,u)}const s=tn(i),a=e.minzoom||0,o=e.maxzoom||22,l=rn({extent:s,maxZoom:o,minZoom:a});this.tileGrid=l,this.template_=e.template;const h=e.grids;if(!h){this.setState("error");return}if(this.tileUrlFunction_=kc(h,l),e.attribution!==void 0){const u=n!==void 0?n:s;this.setAttributions(function(c){return Xr(u,c.extent)?[e.attribution]:null})}this.setState("ready")}getTile(e,r,i,n,s){const a=zn(e,r,i);if(this.tileCache.containsKey(a))return this.tileCache.get(a);const o=[e,r,i],l=this.getTileCoordForTileUrlFunction(o,s),h=this.tileUrlFunction_(l,n,s),u=new uE(o,h!==void 0?Q.IDLE:Q.EMPTY,h!==void 0?h:"",this.tileGrid.getTileCoordExtent(o),this.preemptive_,this.jsonp_);return this.tileCache.set(a,u),u}useTile(e,r,i){const n=zn(e,r,i);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}const dE=fE;function gE(t,e){const r=new Pc(32),i=t.getExtent();return function(n,s){r.expireCache(),i&&(n=Ct(i,n));const a=t.getZForResolution(s),o=[];return t.forEachTileCoord(n,a,l=>{const h=l.toString();if(!r.containsKey(h)){const u=e(l);r.set(h,u)}o.push(r.get(h))}),o}}const pE=Object.freeze(Object.defineProperty({__proto__:null,BingMaps:xx,CartoDB:Ex,Cluster:Tx,DataTile:lo,GeoTIFF:Ku,Google:xv,IIIF:Tv,Image:wr,ImageArcGISRest:Mv,ImageCanvas:Rv,ImageMapGuide:Lv,ImageStatic:nf,ImageWMS:Eg,OGCMapTile:zv,OGCVectorTile:jv,OSM:wg,Raster:Qv,Source:Da,StadiaMaps:sE,Tile:os,TileArcGISRest:oE,TileDebug:hE,TileImage:ar,TileJSON:uf,TileWMS:Bc,UTFGrid:dE,UrlTile:Tg,Vector:as,VectorTile:hs,WMTS:zc,XYZ:Yr,Zoomify:Ev,createArcGISRestLoader:ef,createMapGuideLoader:tf,createStaticLoader:rf,createWMSLoader:Sg,sourcesFromTileGrid:gE},Symbol.toStringTag,{value:"Module"}));window.eoxMapAdvancedOlFormats=Ny;var Ye=(t,e,r)=>new Promise((i,n)=>{var s=l=>{try{o(r.next(l))}catch(h){n(h)}},a=l=>{try{o(r.throw(l))}catch(h){n(h)}},o=l=>l.done?i(l.value):Promise.resolve(l.value).then(s,a);o((r=r.apply(t,e)).next())}),ot=Uint8Array,Ur=Uint16Array,mE=Int32Array,ff=new ot([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),df=new ot([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),yE=new ot([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),gf=function(t,e){for(var r=new Ur(31),i=0;i<31;++i)r[i]=e+=1<<t[i-1];for(var n=new mE(r[30]),i=1;i<30;++i)for(var s=r[i];s<r[i+1];++s)n[s]=s-r[i]<<5|i;return{b:r,r:n}},pf=gf(ff,2),mf=pf.b,_E=pf.r;mf[28]=258,_E[258]=28;var xE=gf(df,0),vE=xE.b,pa=new Ur(32768);for(ve=0;ve<32768;++ve)Bt=(ve&43690)>>1|(ve&21845)<<1,Bt=(Bt&52428)>>2|(Bt&13107)<<2,Bt=(Bt&61680)>>4|(Bt&3855)<<4,pa[ve]=((Bt&65280)>>8|(Bt&255)<<8)>>1;var Bt,ve,Ui=function(t,e,r){for(var i=t.length,n=0,s=new Ur(e);n<i;++n)t[n]&&++s[t[n]-1];var a=new Ur(e);for(n=1;n<e;++n)a[n]=a[n-1]+s[n-1]<<1;var o;if(r){o=new Ur(1<<e);var l=15-e;for(n=0;n<i;++n)if(t[n])for(var h=n<<4|t[n],u=e-t[n],c=a[t[n]-1]++<<u,d=c|(1<<u)-1;c<=d;++c)o[pa[c]>>l]=h}else for(o=new Ur(i),n=0;n<i;++n)t[n]&&(o[n]=pa[a[t[n]-1]++]>>15-t[n]);return o},on=new ot(288);for(ve=0;ve<144;++ve)on[ve]=8;var ve;for(ve=144;ve<256;++ve)on[ve]=9;var ve;for(ve=256;ve<280;++ve)on[ve]=7;var ve;for(ve=280;ve<288;++ve)on[ve]=8;var ve,yf=new ot(32);for(ve=0;ve<32;++ve)yf[ve]=5;var ve,EE=Ui(on,9,1),wE=Ui(yf,5,1),$s=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},xt=function(t,e,r){var i=e/8|0;return(t[i]|t[i+1]<<8)>>(e&7)&r},js=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(e&7)},TE=function(t){return(t+7)/8|0},SE=function(t,e,r){(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length);var i=new ot(r-e);return i.set(t.subarray(e,r)),i},ME=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],at=function(t,e,r){var i=new Error(e||ME[t]);if(i.code=t,Error.captureStackTrace&&Error.captureStackTrace(i,at),!r)throw i;return i},Ro=function(t,e,r,i){var n=t.length,s=i?i.length:0;if(!n||e.f&&!e.l)return r||new ot(0);var a=!r||e.i!=2,o=e.i;r||(r=new ot(n*3));var l=function($e){var Ue=r.length;if($e>Ue){var Xe=new ot(Math.max(Ue*2,$e));Xe.set(r),r=Xe}},h=e.f||0,u=e.p||0,c=e.b||0,d=e.l,g=e.d,p=e.m,y=e.n,_=n*8;do{if(!d){h=xt(t,u,1);var v=xt(t,u+1,3);if(u+=3,v)if(v==1)d=EE,g=wE,p=9,y=5;else if(v==2){var M=xt(t,u,31)+257,A=xt(t,u+10,15)+4,I=M+xt(t,u+5,31)+1;u+=14;for(var C=new ot(I),D=new ot(19),B=0;B<A;++B)D[yE[B]]=xt(t,u+B*3,7);u+=A*3;for(var V=$s(D),ee=(1<<V)-1,f=Ui(D,V,1),B=0;B<I;){var m=f[xt(t,u,ee)];u+=m&15;var E=m>>4;if(E<16)C[B++]=E;else{var x=0,S=0;for(E==16?(S=3+xt(t,u,3),u+=2,x=C[B-1]):E==17?(S=3+xt(t,u,7),u+=3):E==18&&(S=11+xt(t,u,127),u+=7);S--;)C[B++]=x}}var L=C.subarray(0,M),O=C.subarray(M);p=$s(L),y=$s(O),d=Ui(L,p,1),g=Ui(O,y,1)}else at(1);else{var E=TE(u)+4,w=t[E-4]|t[E-3]<<8,T=E+w;if(T>n){o&&at(0);break}a&&l(c+w),r.set(t.subarray(E,T),c),e.b=c+=w,e.p=u=T*8,e.f=h;continue}if(u>_){o&&at(0);break}}a&&l(c+131072);for(var N=(1<<p)-1,F=(1<<y)-1,$=u;;$=u){var x=d[js(t,u)&N],X=x>>4;if(u+=x&15,u>_){o&&at(0);break}if(x||at(2),X<256)r[c++]=X;else if(X==256){$=u,d=null;break}else{var ce=X-254;if(X>264){var B=X-257,he=ff[B];ce=xt(t,u,(1<<he)-1)+mf[B],u+=he}var ge=g[js(t,u)&F],ue=ge>>4;ge||at(3),u+=ge&15;var O=vE[ue];if(ue>3){var he=df[ue];O+=js(t,u)&(1<<he)-1,u+=he}if(u>_){o&&at(0);break}a&&l(c+131072);var Se=c+ce;if(c<O){var Be=s-O,Ne=Math.min(O,Se);for(Be+c<0&&at(3);c<Ne;++c)r[c]=i[Be+c]}for(;c<Se;c+=4)r[c]=r[c-O],r[c+1]=r[c+1-O],r[c+2]=r[c+2-O],r[c+3]=r[c+3-O];c=Se}}e.l=d,e.p=$,e.b=c,e.f=h,d&&(h=1,e.m=p,e.d=g,e.n=y)}while(!h);return c==r.length?r:SE(r,0,c)},bE=new ot(0),RE=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&at(6,"invalid gzip data");var e=t[3],r=10;e&4&&(r+=(t[10]|t[11]<<8)+2);for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!t[r++]);return r+(e&2)},PE=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},AE=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&at(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&at(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function IE(t,e){return Ro(t,{i:2},e&&e.out,e&&e.dictionary)}function LE(t,e){var r=RE(t);return r+8>t.length&&at(6,"invalid gzip data"),Ro(t.subarray(r,-8),{i:2},e&&e.out||new ot(PE(t)),e&&e.dictionary)}function CE(t,e){return Ro(t.subarray(AE(t,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function ma(t,e){return t[0]==31&&t[1]==139&&t[2]==8?LE(t,e):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?IE(t,e):CE(t,e)}var OE=typeof TextDecoder<"u"&&new TextDecoder,NE=0;try{OE.decode(bE,{stream:!0}),NE=1}catch{}var _f=(t,e)=>t*Math.pow(2,e),fi=(t,e)=>Math.floor(t/Math.pow(2,e)),Kn=(t,e)=>_f(t.getUint16(e+1,!0),8)+t.getUint8(e),xf=(t,e)=>_f(t.getUint32(e+2,!0),16)+t.getUint16(e,!0),FE=(t,e,r,i,n)=>{if(t!=i.getUint8(n))return t-i.getUint8(n);const s=Kn(i,n+1);if(e!=s)return e-s;const a=Kn(i,n+4);return r!=a?r-a:0},DE=(t,e,r,i)=>{const n=vf(t,e|128,r,i);return n?{z:e,x:r,y:i,offset:n[0],length:n[1],is_dir:!0}:null},Zl=(t,e,r,i)=>{const n=vf(t,e,r,i);return n?{z:e,x:r,y:i,offset:n[0],length:n[1],is_dir:!1}:null},vf=(t,e,r,i)=>{let n=0,s=t.byteLength/17-1;for(;n<=s;){const a=s+n>>1,o=FE(e,r,i,t,a*17);if(o>0)n=a+1;else if(o<0)s=a-1;else return[xf(t,a*17+7),t.getUint32(a*17+13,!0)]}return null},GE=(t,e)=>t.is_dir&&!e.is_dir?1:!t.is_dir&&e.is_dir?-1:t.z!==e.z?t.z-e.z:t.x!==e.x?t.x-e.x:t.y-e.y,Ef=(t,e)=>{const r=t.getUint8(e*17);return{z:r&127,x:Kn(t,e*17+1),y:Kn(t,e*17+4),offset:xf(t,e*17+7),length:t.getUint32(e*17+13,!0),is_dir:r>>7===1}},Vl=t=>{const e=[],r=new DataView(t);for(let i=0;i<r.byteLength/17;i++)e.push(Ef(r,i));return UE(e)},UE=t=>{t.sort(GE);const e=new ArrayBuffer(17*t.length),r=new Uint8Array(e);for(let i=0;i<t.length;i++){const n=t[i];let s=n.z;n.is_dir&&(s=s|128),r[i*17]=s,r[i*17+1]=n.x&255,r[i*17+2]=n.x>>8&255,r[i*17+3]=n.x>>16&255,r[i*17+4]=n.y&255,r[i*17+5]=n.y>>8&255,r[i*17+6]=n.y>>16&255,r[i*17+7]=n.offset&255,r[i*17+8]=fi(n.offset,8)&255,r[i*17+9]=fi(n.offset,16)&255,r[i*17+10]=fi(n.offset,24)&255,r[i*17+11]=fi(n.offset,32)&255,r[i*17+12]=fi(n.offset,48)&255,r[i*17+13]=n.length&255,r[i*17+14]=n.length>>8&255,r[i*17+15]=n.length>>16&255,r[i*17+16]=n.length>>24&255}return e},kE=(t,e)=>{if(t.byteLength<17)return null;const r=t.byteLength/17,i=Ef(t,r-1);if(i.is_dir){const n=i.z,s=e.z-n,a=Math.trunc(e.x/(1<<s)),o=Math.trunc(e.y/(1<<s));return{z:n,x:a,y:o}}return null};function BE(t){return Ye(this,null,function*(){const e=yield t.getBytes(0,512e3),r=new DataView(e.data),i=r.getUint32(4,!0),n=r.getUint16(8,!0),s=new TextDecoder("utf-8"),a=JSON.parse(s.decode(new DataView(e.data,10,i)));let o=0;a.compression==="gzip"&&(o=2);let l=0;"minzoom"in a&&(l=+a.minzoom);let h=0;"maxzoom"in a&&(h=+a.maxzoom);let u=0,c=0,d=0,g=-180,p=-85,y=180,_=85;if(a.bounds){const E=a.bounds.split(",");g=+E[0],p=+E[1],y=+E[2],_=+E[3]}if(a.center){const E=a.center.split(",");u=+E[0],c=+E[1],d=+E[2]}return{specVersion:r.getUint16(2,!0),rootDirectoryOffset:10+i,rootDirectoryLength:n*17,jsonMetadataOffset:10,jsonMetadataLength:i,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:o,tileType:1,minZoom:l,maxZoom:h,minLon:g,minLat:p,maxLon:y,maxLat:_,centerZoom:d,centerLon:u,centerLat:c,etag:e.etag}})}function zE(t,e,r,i,n,s,a){return Ye(this,null,function*(){let o=yield r.getArrayBuffer(e,t.rootDirectoryOffset,t.rootDirectoryLength,t);t.specVersion===1&&(o=Vl(o));const l=Zl(new DataView(o),i,n,s);if(l){let c=(yield e.getBytes(l.offset,l.length,a)).data;const d=new DataView(c);return d.getUint8(0)==31&&d.getUint8(1)==139&&(c=ma(new Uint8Array(c))),{data:c}}const h=kE(new DataView(o),{z:i,x:n,y:s});if(h){const u=DE(new DataView(o),h.z,h.x,h.y);if(u){let c=yield r.getArrayBuffer(e,u.offset,u.length,t);t.specVersion===1&&(c=Vl(c));const d=Zl(new DataView(c),i,n,s);if(d){let p=(yield e.getBytes(d.offset,d.length,a)).data;const y=new DataView(p);return y.getUint8(0)==31&&y.getUint8(1)==139&&(p=ma(new Uint8Array(p))),{data:p}}}}})}var wf={getHeader:BE,getZxy:zE};function Rr(t,e){return(e>>>0)*4294967296+(t>>>0)}function $E(t,e){const r=e.buf;let i,n;if(n=r[e.pos++],i=(n&112)>>4,n<128||(n=r[e.pos++],i|=(n&127)<<3,n<128)||(n=r[e.pos++],i|=(n&127)<<10,n<128)||(n=r[e.pos++],i|=(n&127)<<17,n<128)||(n=r[e.pos++],i|=(n&127)<<24,n<128)||(n=r[e.pos++],i|=(n&1)<<31,n<128))return Rr(t,i);throw new Error("Expected varint not more than 10 bytes")}function di(t){const e=t.buf;let r,i;return i=e[t.pos++],r=i&127,i<128||(i=e[t.pos++],r|=(i&127)<<7,i<128)||(i=e[t.pos++],r|=(i&127)<<14,i<128)||(i=e[t.pos++],r|=(i&127)<<21,i<128)?r:(i=e[t.pos],r|=(i&15)<<28,$E(r,t))}function jE(t,e,r,i){if(i==0){r==1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const n=e[0];e[0]=e[1],e[1]=n}}var qE=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function ZE(t,e,r){if(t>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,t)-1||r>Math.pow(2,t)-1)throw Error("tile x/y outside zoom level bounds");const i=qE[t],n=Math.pow(2,t);let s=0,a=0,o=0;const l=[e,r];let h=n/2;for(;h>0;)s=(l[0]&h)>0?1:0,a=(l[1]&h)>0?1:0,o+=h*h*(3*s^a),jE(h,l,s,a),h=h/2;return i+o}function Tf(t,e){return Ye(this,null,function*(){if(e===1||e===0)return t;if(e===2){if(typeof globalThis.DecompressionStream>"u")return ma(new Uint8Array(t));{let i=new Response(t).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(i).arrayBuffer()}}else throw Error("Compression method not supported")})}var Ir=(t=>(t[t.Unknown=0]="Unknown",t[t.Mvt=1]="Mvt",t[t.Png=2]="Png",t[t.Jpeg=3]="Jpeg",t[t.Webp=4]="Webp",t[t.Avif=5]="Avif",t))(Ir||{}),VE=127;function WE(t,e){let r=0,i=t.length-1;for(;r<=i;){const n=i+r>>1,s=e-t[n].tileId;if(s>0)r=n+1;else if(s<0)i=n-1;else return t[n]}return i>=0&&(t[i].runLength===0||e-t[i].tileId<t[i].runLength)?t[i]:null}var XE=class{constructor(t,e=new Headers){this.url=t,this.customHeaders=e}getKey(){return this.url}setHeaders(t){this.customHeaders=t}getBytes(t,e,r){return Ye(this,null,function*(){let i;r||(i=new AbortController,r=i.signal);const n=new Headers(this.customHeaders);n.set("Range","bytes="+t+"-"+(t+e-1));let s=yield fetch(this.url,{signal:r,headers:n});if(s.status===416&&t===0){const l=s.headers.get("Content-Range");if(!l||!l.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const h=+l.substr(8);s=yield fetch(this.url,{signal:r,headers:{Range:"bytes=0-"+(h-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);const a=s.headers.get("Content-Length");if(s.status===200&&(!a||+a>e))throw i&&i.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function vt(t,e){const r=t.getUint32(e+4,!0),i=t.getUint32(e+0,!0);return r*Math.pow(2,32)+i}function HE(t,e){const r=new DataView(t),i=r.getUint8(7);if(i>3)throw Error(`Archive is spec version ${i} but this library supports up to spec version 3`);return{specVersion:i,rootDirectoryOffset:vt(r,8),rootDirectoryLength:vt(r,16),jsonMetadataOffset:vt(r,24),jsonMetadataLength:vt(r,32),leafDirectoryOffset:vt(r,40),leafDirectoryLength:vt(r,48),tileDataOffset:vt(r,56),tileDataLength:vt(r,64),numAddressedTiles:vt(r,72),numTileEntries:vt(r,80),numTileContents:vt(r,88),clustered:r.getUint8(96)===1,internalCompression:r.getUint8(97),tileCompression:r.getUint8(98),tileType:r.getUint8(99),minZoom:r.getUint8(100),maxZoom:r.getUint8(101),minLon:r.getInt32(102,!0)/1e7,minLat:r.getInt32(106,!0)/1e7,maxLon:r.getInt32(110,!0)/1e7,maxLat:r.getInt32(114,!0)/1e7,centerZoom:r.getUint8(118),centerLon:r.getInt32(119,!0)/1e7,centerLat:r.getInt32(123,!0)/1e7,etag:e}}function Sf(t){const e={buf:new Uint8Array(t),pos:0},r=di(e),i=[];let n=0;for(let s=0;s<r;s++){const a=di(e);i.push({tileId:n+a,offset:0,length:0,runLength:1}),n+=a}for(let s=0;s<r;s++)i[s].runLength=di(e);for(let s=0;s<r;s++)i[s].length=di(e);for(let s=0;s<r;s++){const a=di(e);a===0&&s>0?i[s].offset=i[s-1].offset+i[s-1].length:i[s].offset=a-1}return i}function YE(t){const e=new DataView(t);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var kr=class extends Error{};function KE(t,e,r,i){return Ye(this,null,function*(){const n=yield t.getBytes(0,16384);if(new DataView(n.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(YE(n.data)<3)return[yield wf.getHeader(t)];const a=n.data.slice(0,VE);let o=n.etag;i&&n.etag!=i&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+t.getKey()),o=void 0);const l=HE(a,o);if(r){const h=n.data.slice(l.rootDirectoryOffset,l.rootDirectoryOffset+l.rootDirectoryLength),u=t.getKey()+"|"+(l.etag||"")+"|"+l.rootDirectoryOffset+"|"+l.rootDirectoryLength,c=Sf(yield e(h,l.internalCompression));return[l,[u,c.length,c]]}return[l,void 0]})}function QE(t,e,r,i,n){return Ye(this,null,function*(){const s=yield t.getBytes(r,i);if(n.etag&&n.etag!==s.etag)throw new kr(s.etag);const a=yield e(s.data,n.internalCompression),o=Sf(a);if(o.length===0)throw new Error("Empty directory is invalid");return o})}var JE=class{constructor(t=100,e=!0,r=Tf){this.cache=new Map,this.maxCacheEntries=t,this.counter=1,this.prefetch=e,this.decompress=r}getHeader(t,e){return Ye(this,null,function*(){const r=t.getKey();if(this.cache.has(r))return this.cache.get(r).lastUsed=this.counter++,yield this.cache.get(r).data;const i=new Promise((n,s)=>{KE(t,this.decompress,this.prefetch,e).then(a=>{a[1]&&this.cache.set(a[1][0],{lastUsed:this.counter++,data:Promise.resolve(a[1][2])}),n(a[0]),this.prune()}).catch(a=>{s(a)})});return this.cache.set(r,{lastUsed:this.counter++,data:i}),i})}getDirectory(t,e,r,i){return Ye(this,null,function*(){const n=t.getKey()+"|"+(i.etag||"")+"|"+e+"|"+r;if(this.cache.has(n))return this.cache.get(n).lastUsed=this.counter++,yield this.cache.get(n).data;const s=new Promise((a,o)=>{QE(t,this.decompress,e,r,i).then(l=>{a(l),this.prune()}).catch(l=>{o(l)})});return this.cache.set(n,{lastUsed:this.counter++,data:s}),s})}getArrayBuffer(t,e,r,i){return Ye(this,null,function*(){const n=t.getKey()+"|"+(i.etag||"")+"|"+e+"|"+r;if(this.cache.has(n))return this.cache.get(n).lastUsed=this.counter++,yield this.cache.get(n).data;const s=new Promise((a,o)=>{t.getBytes(e,r).then(l=>{if(i.etag&&i.etag!==l.etag)throw new kr(l.etag);a(l.data),this.cache.has(n),this.prune()}).catch(l=>{o(l)})});return this.cache.set(n,{lastUsed:this.counter++,data:s}),s})}prune(){if(this.cache.size>=this.maxCacheEntries){let t=1/0,e;this.cache.forEach((r,i)=>{r.lastUsed<t&&(t=r.lastUsed,e=i)}),e&&this.cache.delete(e)}}invalidate(t,e){return Ye(this,null,function*(){this.cache.delete(t.getKey()),yield this.getHeader(t,e)})}},Po=class{constructor(t,e,r){typeof t=="string"?this.source=new XE(t):this.source=t,r?this.decompress=r:this.decompress=Tf,e?this.cache=e:this.cache=new JE}getHeader(){return Ye(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(t,e,r,i){return Ye(this,null,function*(){const n=ZE(t,e,r),s=yield this.cache.getHeader(this.source);if(s.specVersion<3)return wf.getZxy(s,this.source,this.cache,t,e,r,i);if(t<s.minZoom||t>s.maxZoom)return;let a=s.rootDirectoryOffset,o=s.rootDirectoryLength;for(let l=0;l<=3;l++){const h=yield this.cache.getDirectory(this.source,a,o,s),u=WE(h,n);if(u)if(u.runLength>0){const c=yield this.source.getBytes(s.tileDataOffset+u.offset,u.length,i);if(s.etag&&s.etag!==c.etag)throw new kr(c.etag);return{data:yield this.decompress(c.data,s.tileCompression),cacheControl:c.cacheControl,expires:c.expires}}else a=s.leafDirectoryOffset+u.offset,o=u.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(t,e,r,i){return Ye(this,null,function*(){try{return yield this.getZxyAttempt(t,e,r,i)}catch(n){if(n instanceof kr)return this.cache.invalidate(this.source,n.message),yield this.getZxyAttempt(t,e,r,i);throw n}})}getMetadataAttempt(){return Ye(this,null,function*(){const t=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(t.jsonMetadataOffset,t.jsonMetadataLength);if(t.etag&&t.etag!==e.etag)throw new kr(e.etag);const r=yield this.decompress(e.data,t.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(r))})}getMetadata(){return Ye(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(t){if(t instanceof kr)return this.cache.invalidate(this.source,t.message),yield this.getMetadataAttempt();throw t}})}};class ew extends Uc{constructor(e){super(it.ERROR),this.error=e}}class tw extends Ku{constructor(e){super(e),e.projection&&(this.projection=e.projection)}}class Re{constructor(e){this.name=e}toString(){return this.name}}Re.GeoTIFF=new Re("GeoTIFF");Re.ImageStatic=new Re("ImageStatic");Re.PMTilesRaster=new Re("PMTilesRaster");Re.PMTilesVector=new Re("PMTilesVector");Re.TileJSON=new Re("TileJSON");Re.TileWMS=new Re("TileWMS");Re.WMTS=new Re("WMTS");Re.XYZ=new Re("XYZ");var Mf={exports:{}};(function(t,e){(function(r,i){t.exports=i()})(gr,function(){var r=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function i(c,d){return c.indexOf(d)===-1?c.length:c.indexOf(d)}function n(c){var d=c.replace(/^v/,"").replace(/\+.*$/,""),g=i(d,"-"),p=d.substring(0,g).split(".");return p.push(d.substring(g+1)),p}function s(c){return isNaN(Number(c))?c:Number(c)}function a(c){if(typeof c!="string")throw new TypeError("Invalid argument expected string");if(!r.test(c))throw new Error("Invalid argument not valid semver ('"+c+"' received)")}function o(c,d){[c,d].forEach(a);for(var g=n(c),p=n(d),y=0;y<Math.max(g.length-1,p.length-1);y++){var _=parseInt(g[y]||0,10),v=parseInt(p[y]||0,10);if(_>v)return 1;if(v>_)return-1}var E=g[g.length-1],w=p[p.length-1];if(E&&w){var T=E.split(".").map(s),M=w.split(".").map(s);for(y=0;y<Math.max(T.length,M.length);y++){if(T[y]===void 0||typeof M[y]=="string"&&typeof T[y]=="number")return-1;if(M[y]===void 0||typeof T[y]=="string"&&typeof M[y]=="number"||T[y]>M[y])return 1;if(M[y]>T[y])return-1}}else if(E||w)return E?-1:1;return 0}var l=[">",">=","=","<","<="],h={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function u(c){if(typeof c!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof c);if(l.indexOf(c)===-1)throw new TypeError("Invalid operator, expected one of "+l.join("|"))}return o.validate=function(c){return typeof c=="string"&&r.test(c)},o.compare=function(c,d,g){u(g);var p=o(c,d);return h[g].indexOf(p)>-1},o})})(Mf);var rw=Mf.exports,ya=rw;const Ao="1.0.0",z=!0,Y={classification:"https://stac-extensions.github.io/classification/v1.1.0/schema.json",datacube:"https://stac-extensions.github.io/datacube/v2.1.0/schema.json",eo:"https://stac-extensions.github.io/eo/v1.0.0/schema.json",file:"https://stac-extensions.github.io/file/v1.0.0/schema.json","item-assets":"https://stac-extensions.github.io/item-assets/v1.0.0/schema.json",label:"https://stac-extensions.github.io/label/v1.0.1/schema.json",pointcloud:"https://stac-extensions.github.io/pointcloud/v1.0.0/schema.json",processing:"https://stac-extensions.github.io/processing/v1.1.0/schema.json",projection:"https://stac-extensions.github.io/projection/v1.0.0/schema.json",raster:"https://stac-extensions.github.io/raster/v1.1.0/schema.json",sar:"https://stac-extensions.github.io/sar/v1.0.0/schema.json",sat:"https://stac-extensions.github.io/sat/v1.0.0/schema.json",scientific:"https://stac-extensions.github.io/scientific/v1.0.0/schema.json",table:"https://stac-extensions.github.io/table/v1.2.0/schema.json",timestamps:"https://stac-extensions.github.io/timestamps/v1.0.0/schema.json",version:"https://stac-extensions.github.io/version/v1.0.0/schema.json",view:"https://stac-extensions.github.io/view/v1.0.0/schema.json"},mr={itemAndCollection:{"cube:":Y.datacube,"eo:":Y.eo,"file:":Y.file,"label:":Y.label,"pc:":Y.pointcloud,"processing:":Y.processing,"proj:":Y.projection,"raster:":Y.raster,"sar:":Y.sar,"sat:":Y.sat,"sci:":Y.scientific,"view:":Y.view,version:Y.version,deprecated:Y.version,published:Y.timestamps,expires:Y.timestamps,unpublished:Y.timestamps},catalog:{},collection:{item_assets:Y["item-assets"]},item:{}};mr.collection=Object.assign(mr.collection,mr.itemAndCollection);mr.item=Object.assign(mr.item,mr.itemAndCollection);var _i={parseUrl(t){let e=t.match(/^https?:\/\/stac-extensions.github.io\/([^\/]+)\/v([^\/]+)\/[^.]+.json$/i);if(e)return{id:e[1],version:e[2]}}},pe={version:Ao,extensions:{},set(t){if(typeof t.stac_version!="string"?pe.version="0.6.0":pe.version=t.stac_version,Array.isArray(t.stac_extensions))for(let e of t.stac_extensions){let r=_i.parseUrl(e);r&&(pe.extensions[r.id]=r.version)}},before(t,e=null){let r=e?pe.extensions[e]:pe.version;return typeof r>"u"?!1:ya.compare(r,t,"<")}},R={type(t){let e=typeof t;if(e==="object"){if(t===null)return"null";if(Array.isArray(t))return"array"}return e},is(t,e){return R.type(t)===e},isDefined(t){return typeof t<"u"},isObject(t){return typeof t=="object"&&t===Object(t)&&!Array.isArray(t)},rename(t,e,r){return typeof t[e]<"u"&&typeof t[r]>"u"?(t[r]=t[e],delete t[e],!0):!1},forAll(t,e,r){if(t[e]&&typeof t[e]=="object")for(let i in t[e])r(t[e][i])},toArray(t,e){return typeof t[e]<"u"&&!Array.isArray(t[e])?(t[e]=[t[e]],!0):!1},flattenArray(t,e,r,i=!1){if(Array.isArray(t[e])){for(let n in t[e])if(typeof r[n]=="string"){let s=t[e][n];t[r[n]]=i?[s]:s}return delete t[e],!0}return!1},flattenOneElementArray(t,e,r=!1){return!r&&Array.isArray(t[e])?t[e].length===1?(t[e]=t[e][0],!0):!1:!0},removeFromArray(t,e,r){if(Array.isArray(t[e])){let i=t[e].indexOf(r);return i>-1&&t[e].splice(i,1),!0}return!1},ensure(t,e,r){return R.type(r)!==R.type(t[e])&&(t[e]=r),!0},upgradeExtension(t,e){let{id:r,version:i}=_i.parseUrl(e),n=t.stac_extensions.findIndex(s=>{let a=_i.parseUrl(s);return a&&a.id===r&&ya.compare(a.version,i,"<")});return n!==-1?(t.stac_extensions[n]=e,!0):!1},addExtension(t,e){let{id:r,version:i}=_i.parseUrl(e),n=t.stac_extensions.findIndex(s=>{if(s===e)return!0;let a=_i.parseUrl(s);return!!(a&&a.id===r&&ya.compare(a.version,i,"<"))});return n===-1?t.stac_extensions.push(e):t.stac_extensions[n]=e,t.stac_extensions.sort(),!0},removeExtension(t,e){return R.removeFromArray(t,"stac_extensions",e)},migrateExtensionShortnames(t){let e=Object.keys(Y),r=Object.values(Y);return R.mapValues(t,"stac_extensions",e,r)},populateExtensions(t,e){let r=[];(e=="catalog"||e=="collection")&&r.push(t),(e=="item"||e=="collection")&&R.isObject(t.assets)&&(r=r.concat(Object.values(t.assets))),e=="collection"&&R.isObject(t.item_assets)&&(r=r.concat(Object.values(t.item_assets))),e=="collection"&&R.isObject(t.summaries)&&r.push(t.summaries),e=="item"&&R.isObject(t.properties)&&r.push(t.properties);for(let i of r)Object.keys(i).forEach(n=>{let s=n.match(/^(\w+:|[^:]+$)/i);if(Array.isArray(s)){let a=mr[e][s[0]];R.is(a,"string")&&R.addExtension(t,a)}})},mapValues(t,e,r,i){let n=s=>{let a=r.indexOf(s);return a>=0?i[a]:s};return Array.isArray(t[e])?t[e]=t[e].map(n):typeof t[e]<"u"&&(t[e]=n(t[e])),!0},mapObject(t,e){for(let r in t)t[r]=e(t[r],r)},moveTo(t,e,r,i=!1,n=!1){let s;return i?n?s=a=>Array.isArray(a):s=a=>Array.isArray(a)&&a.length===1:s=R.isDefined,s(t[e])?(r[e]=i&&!n?t[e][0]:t[e],delete t[e],!0):!1},runAll(t,e,r,i){for(let n in t)n.startsWith("migrate")||t[n](e,r,i)},toUTC(t,e){if(typeof t[e]=="string")try{return t[e]=this.toISOString(t[e]),!0}catch{}return delete t[e],!1},toISOString(t){return t instanceof Date||(t=new Date(t)),t.toISOString().replace(".000","")}},It={multihash:null,hexToUint8(t){if(t.length===0||t.length%2!==0)throw new Error(`The string "${t}" is not valid hex.`);return new Uint8Array(t.match(/.{1,2}/g).map(e=>parseInt(e,16)))},uint8ToHex(t){return t.reduce((e,r)=>e+r.toString(16).padStart(2,"0"),"")},toMultihash(t,e,r){if(!It.multihash||!R.is(t[e],"string"))return!1;try{const i=It.multihash.encode(It.hexToUint8(t[e]),r);return t[e]=It.uint8ToHex(i),!0}catch(i){return console.warn(i),!1}}},Io={migrate(t,e=!0){return pe.set(t),e&&(t.stac_version=Ao),t.type="Catalog",R.ensure(t,"stac_extensions",[]),pe.before("1.0.0-rc.1")&&R.migrateExtensionShortnames(t),R.ensure(t,"id",""),R.ensure(t,"description",""),R.ensure(t,"links",[]),R.runAll(Io,t,t),pe.before("0.8.0")&&R.populateExtensions(t,"catalog"),t}},Lo={migrate(t,e=!0){return Io.migrate(t,e),t.type="Collection",pe.before("1.0.0-rc.1")&&R.migrateExtensionShortnames(t),R.ensure(t,"license","proprietary"),R.ensure(t,"extent",{spatial:{bbox:[]},temporal:{interval:[]}}),R.runAll(Lo,t,t),R.isObject(t.properties)&&(R.removeFromArray(t,"stac_extensions","commons"),delete t.properties),pe.before("0.8.0")&&R.populateExtensions(t,"collection"),pe.before("1.0.0-beta.1")&&R.mapValues(t,"stac_extensions",["assets"],["item-assets"]),t},extent(t){if(R.ensure(t,"extent",{}),pe.before("0.8.0")&&(Array.isArray(t.extent.spatial)&&(t.extent.spatial={bbox:[t.extent.spatial]}),Array.isArray(t.extent.temporal)&&(t.extent.temporal={interval:[t.extent.temporal]})),R.ensure(t.extent,"spatial",{}),R.ensure(t.extent.spatial,"bbox",[]),R.ensure(t.extent,"temporal",{}),R.ensure(t.extent.temporal,"interval",[]),pe.before("1.0.0-rc.3")){if(t.extent.temporal.interval.length>1){let e,r;for(let i of t.extent.temporal.interval){if(i[0]===null)e=null;else if(typeof i[0]=="string"&&e!==null)try{let n=new Date(i[0]);(typeof e>"u"||n<e)&&(e=n)}catch{}if(i[1]===null)r=null;else if(typeof i[1]=="string"&&r!==null)try{let n=new Date(i[1]);(typeof r>"u"||n>r)&&(r=n)}catch{}}t.extent.temporal.interval.unshift([e?R.toISOString(e):null,r?R.toISOString(r):null])}if(t.extent.spatial.bbox.length>1){let e=t.extent.spatial.bbox.reduce((r,i)=>Array.isArray(i)?Math.max(i.length,r):r,4);if(e>=4){let r=new Array(e).fill(null),i=e/2;for(let n of t.extent.spatial.bbox){if(!Array.isArray(n)||n.length<4)break;for(let s in n){let a=n[s];r[s]===null?r[s]=a:s<i?r[s]=Math.min(a,r[s]):r[s]=Math.max(a,r[s])}}r.findIndex(n=>n===null)===-1&&t.extent.spatial.bbox.unshift(r)}}}},collectionAssets(t){pe.before("1.0.0-rc.1")&&R.removeExtension(t,"collection-assets"),Hi.migrateAll(t)},itemAsset(t){pe.before("1.0.0-beta.2")&&R.rename(t,"item_assets","assets"),Hi.migrateAll(t,"item_assets")},summaries(t){if(R.ensure(t,"summaries",{}),pe.before("0.8.0")&&R.isObject(t.other_properties)){for(let e in t.other_properties){let r=t.other_properties[e];Array.isArray(r.extent)&&r.extent.length===2?t.summaries[e]={minimum:r.extent[0],maximum:r.extent[1]}:Array.isArray(r.values)&&(r.values.filter(i=>Array.isArray(i)).length===r.values.length?t.summaries[e]=r.values.reduce((i,n)=>i.concat(n),[]):t.summaries[e]=r.values)}delete t.other_properties}if(pe.before("1.0.0-beta.1")&&R.isObject(t.properties)&&!t.links.find(e=>["child","item"].includes(e.rel)))for(let e in t.properties){let r=t.properties[e];Array.isArray(r)||(r=[r]),t.summaries[e]=r}pe.before("1.0.0-rc.1")&&R.mapObject(t.summaries,e=>(R.rename(e,"min","minimum"),R.rename(e,"max","maximum"),e)),vs.migrate(t.summaries,t,!0),R.moveTo(t.summaries,"sci:doi",t,!0)&&R.addExtension(t,Y.scientific),R.moveTo(t.summaries,"sci:publications",t,!0,!0)&&R.addExtension(t,Y.scientific),R.moveTo(t.summaries,"sci:citation",t,!0)&&R.addExtension(t,Y.scientific),R.moveTo(t.summaries,"cube:dimensions",t,!0)&&R.addExtension(t,Y.datacube),Object.keys(t.summaries).length===0&&delete t.summaries}},Co={migrate(t,e=null,r=!0){pe.set(t),r&&(t.stac_version=Ao),R.ensure(t,"stac_extensions",[]),pe.before("1.0.0-rc.1")&&R.migrateExtensionShortnames(t),R.ensure(t,"id",""),R.ensure(t,"type","Feature"),R.isObject(t.geometry)||(t.geometry=null),t.geometry!==null&&R.ensure(t,"bbox",[]),R.ensure(t,"properties",{}),R.ensure(t,"links",[]),R.ensure(t,"assets",{});let i=!1;return R.isObject(e)&&R.isObject(e.properties)&&(R.removeFromArray(t,"stac_extensions","commons"),t.properties=Object.assign({},e.properties,t.properties),i=!0),R.runAll(Co,t,t),vs.migrate(t.properties,t),Hi.migrateAll(t),(pe.before("0.8.0")||i)&&R.populateExtensions(t,"item"),t}},bf={migrate(t,e=!0){return R.ensure(t,"collections",[]),R.ensure(t,"links",[]),R.runAll(bf,t,t),t.collections=t.collections.map(r=>Lo.migrate(r,e)),t}},Rf={migrate(t,e=!0){return R.ensure(t,"type","FeatureCollection"),R.ensure(t,"features",[]),R.ensure(t,"links",[]),R.runAll(Rf,t,t),t.features=t.features.map(r=>Co.migrate(r,null,e)),t}},Hi={migrateAll(t,e="assets"){for(let r in t[e])Hi.migrate(t[e][r],t)},migrate(t,e){return R.runAll(Hi,t,e),vs.migrate(t,e),t},mediaTypes(t){R.is(t.type,"string")&&R.mapValues(t,"type",["image/vnd.stac.geotiff","image/vnd.stac.geotiff; cloud-optimized=true"],["image/tiff; application=geotiff","image/tiff; application=geotiff; profile=cloud-optimized"])},eo(t,e){let r=R.isObject(e.properties)&&Array.isArray(e.properties["eo:bands"])?e.properties["eo:bands"]:[];if(Array.isArray(t["eo:bands"]))for(let i in t["eo:bands"]){let n=t["eo:bands"][i];R.is(n,"number")&&R.isObject(r[n])?n=r[n]:R.isObject(n)||(n={}),t["eo:bands"][i]=n}}},vs={migrate(t,e,r=!1){return R.runAll(vs,t,e,r),t},_commonMetadata(t){pe.before("1.0.0-rc.3")&&(R.toUTC(t,"created"),R.toUTC(t,"updated"))},_timestamps(t,e){R.toUTC(t,"published"),R.toUTC(t,"expires"),R.toUTC(t,"unpublished"),R.upgradeExtension(e,Y.timestamps)},_versioningIndicator(t,e){R.upgradeExtension(e,Y.version)},checksum(t,e){pe.before("0.9.0")&&It.multihash&&(R.rename(t,"checksum:md5","checksum:multihash")&&It.toMultihash(t,"checksum:multihash","md5"),R.rename(t,"checksum:sha1","checksum:multihash")&&It.toMultihash(t,"checksum:multihash","sha1"),R.rename(t,"checksum:sha2","checksum:multihash")&&It.toMultihash(t,"checksum:multihash","sha2-256"),R.rename(t,"checksum:sha3","checksum:multihash")&&It.toMultihash(t,"checksum:multihash","sha3-256")),pe.before("1.0.0-rc.1")&&R.rename(t,"checksum:multihash","file:checksum")&&R.addExtension(e,Y.file),R.removeExtension(e,"checksum")},classification(t,e){pe.before("1.1.0","classification")&&R.forAll(t,"classification:classes",r=>R.rename(r,"color-hint","color_hint")),R.upgradeExtension(e,Y.classification)},cube(t,e){R.upgradeExtension(e,Y.datacube)},dtr(t,e){pe.before("0.9.0")&&(R.rename(t,"dtr:start_datetime","start_datetime"),R.rename(t,"dtr:end_datetime","end_datetime"),R.removeExtension(e,"datetime-range"))},eo(t,e){pe.before("0.9.0")&&(R.rename(t,"eo:epsg","proj:epsg")&&R.addExtension(e,Y.projection),R.rename(t,"eo:platform","platform"),R.rename(t,"eo:instrument","instruments")&&R.toArray(t,"instruments"),R.rename(t,"eo:constellation","constellation"),R.rename(t,"eo:off_nadir","view:off_nadir")&&R.addExtension(e,Y.view),R.rename(t,"eo:azimuth","view:azimuth")&&R.addExtension(e,Y.view),R.rename(t,"eo:incidence_angle","view:incidence_angle")&&R.addExtension(e,Y.view),R.rename(t,"eo:sun_azimuth","view:sun_azimuth")&&R.addExtension(e,Y.view),R.rename(t,"eo:sun_elevation","view:sun_elevation")&&R.addExtension(e,Y.view)),pe.before("1.0.0-beta.1")&&R.rename(t,"eo:gsd","gsd"),R.upgradeExtension(e,Y.eo)},file(t,e){R.upgradeExtension(e,Y.file)},label(t,e){pe.before("0.8.0")&&(R.rename(t,"label:property","label:properties"),R.rename(t,"label:task","label:tasks"),R.rename(t,"label:overview","label:overviews")&&R.toArray(t,"label:overviews"),R.rename(t,"label:method","label:methods"),R.toArray(t,"label:classes")),R.upgradeExtension(e,Y.label)},pc(t,e){pe.before("0.8.0")&&R.rename(t,"pc:schema","pc:schemas"),R.upgradeExtension(e,Y.pointcloud)},processing(t,e){R.upgradeExtension(e,Y.processing)},proj(t,e){R.upgradeExtension(e,Y.projection)},raster(t,e){R.upgradeExtension(e,Y.raster)},sar(t,e,r){R.rename(t,"sar:incidence_angle","view:incidence_angle")&&R.addExtension(e,Y.view),R.rename(t,"sar:pass_direction","sat:orbit_state")&&R.mapValues(t,"sat:orbit_state",[null],["geostationary"])&&R.addExtension(e,Y.sat),pe.before("0.7.0")&&(R.flattenArray(t,"sar:resolution",["sar:resolution_range","sar:resolution_azimuth"],r),R.flattenArray(t,"sar:pixel_spacing",["sar:pixel_spacing_range","sar:pixel_spacing_azimuth"],r),R.flattenArray(t,"sar:looks",["sar:looks_range","sar:looks_azimuth","sar:looks_equivalent_number"],r),R.rename(t,"sar:off_nadir","view:off_nadir")&&R.addExtension(e,Y.view)),pe.before("0.9.0")&&(R.rename(t,"sar:platform","platform"),R.rename(t,"sar:instrument","instruments")&&R.toArray(t,"instruments"),R.rename(t,"sar:constellation","constellation"),R.rename(t,"sar:type","sar:product_type"),R.rename(t,"sar:polarization","sar:polarizations"),R.flattenOneElementArray(t,"sar:absolute_orbit",r)&&R.rename(t,"sar:absolute_orbit","sat:absolute_orbit")&&R.addExtension(e,Y.sat),R.flattenOneElementArray(t,"sar:relative_orbit",r)&&R.rename(t,"sar:relative_orbit","sat:relative_orbit")&&R.addExtension(e,Y.sat)),R.upgradeExtension(e,Y.sar)},sat(t,e){pe.before("0.9.0")&&(R.rename(t,"sat:off_nadir_angle","sat:off_nadir"),R.rename(t,"sat:azimuth_angle","sat:azimuth"),R.rename(t,"sat:sun_azimuth_angle","sat:sun_azimuth"),R.rename(t,"sat:sun_elevation_angle","sat:sun_elevation")),R.upgradeExtension(e,Y.sat)},sci(t,e){R.upgradeExtension(e,Y.scientific)},item(t){pe.before("0.8.0")&&(R.rename(t,"item:license","license"),R.rename(t,"item:providers","providers"))},table(t,e){R.upgradeExtension(e,Y.table)},view(t,e){R.upgradeExtension(e,Y.view)}},Lr={item(t,e=null,r=!0){return Co.migrate(t,e,r)},catalog(t,e=!0){return Io.migrate(t,e)},collection(t,e=!0){return Lo.migrate(t,e)},collectionCollection(t,e=!0){return bf.migrate(t,e)},itemCollection(t,e=!0){return Rf.migrate(t,e)},stac(t,e=!0){return t.type==="Feature"?Lr.item(t,null,e):t.type==="FeatureCollection"?Lr.itemCollection(t,e):t.type==="Collection"||!t.type&&R.isDefined(t.extent)&&R.isDefined(t.license)?Lr.collection(t,e):!t.type&&Array.isArray(t.collections)?Lr.collectionCollection(t,e):Lr.catalog(t,e)},enableMultihash(t){It.multihash=t}},iw=Lr;const nw=cs(iw);function rt(t){return typeof t=="string"&&t.length>0}function tt(t){return typeof t=="object"&&t===Object(t)&&!Array.isArray(t)}function Pf(...t){if(t=t.filter(e=>Array.isArray(e)),t.length>1){let e=Math.max(...t.map(i=>i.length)),r=[];for(let i=0;i<e;i++)r.push(Object.assign({},...t.map(n=>n[i])));return r}else if(t.length===1)return t[0];return[]}function sw(t){switch(t){case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648}return t.startsWith("u")?0:null}function aw(t){switch(t){case"int8":return 127;case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295}return null}class Es{constructor(e,r={},i=[]){if(!tt(e))throw new Error("Given data is not an object");if(e instanceof Es){for(let n of i)this[n]=e[n];e=e.toJSON()}this._keyMap=r,this._privateKeys=["_keyMap","_privateKeys"].concat(i);for(let n in e)typeof this[n]>"u"&&(n in r?this[n]=r[n](e[n],this):this[n]=e[n])}isItem(){return this.type==="Feature"}isCatalog(){return this.type==="Catalog"}isCatalogLike(){return this.isCatalog()||this.isCollection()}isCollection(){return this.type==="Collection"}isItemCollection(){return this.type==="FeatureCollection"}isCollectionCollection(){return!1}isAsset(){return!1}isLink(){return!1}getObjectType(){}getAbsoluteUrl(){return null}getMetadata(e){return this[e]}toGeoJSON(){return null}getBoundingBox(){return null}getBoundingBoxes(){return[]}toJSON(){let e={};return Object.keys(this).forEach(r=>{if(typeof this[r]=="function"||this._privateKeys.includes(r))return;let i=this[r];if(r in this._keyMap){let n=Array.isArray(i)?[]:{};for(let s in i)n[s]=i[s].toJSON();i=n}e[r]=i}),e}}var Af={exports:{}},xi={exports:{}};/*! https://mths.be/punycode v1.4.0 by @mathias */xi.exports;var Wl;function ow(){return Wl||(Wl=1,function(t,e){(function(r){var i=e&&!e.nodeType&&e,n=t&&!t.nodeType&&t,s=typeof gr=="object"&&gr;(s.global===s||s.window===s||s.self===s)&&(r=s);var a,o=2147483647,l=36,h=1,u=26,c=38,d=700,g=72,p=128,y="-",_=/^xn--/,v=/[^\x20-\x7E]/,E=/[\x2E\u3002\uFF0E\uFF61]/g,w={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},T=l-h,M=Math.floor,A=String.fromCharCode,I;function C(F){throw new RangeError(w[F])}function D(F,$){for(var X=F.length,ce=[];X--;)ce[X]=$(F[X]);return ce}function B(F,$){var X=F.split("@"),ce="";X.length>1&&(ce=X[0]+"@",F=X[1]),F=F.replace(E,".");var he=F.split("."),ge=D(he,$).join(".");return ce+ge}function V(F){for(var $=[],X=0,ce=F.length,he,ge;X<ce;)he=F.charCodeAt(X++),he>=55296&&he<=56319&&X<ce?(ge=F.charCodeAt(X++),(ge&64512)==56320?$.push(((he&1023)<<10)+(ge&1023)+65536):($.push(he),X--)):$.push(he);return $}function ee(F){return D(F,function($){var X="";return $>65535&&($-=65536,X+=A($>>>10&1023|55296),$=56320|$&1023),X+=A($),X}).join("")}function f(F){return F-48<10?F-22:F-65<26?F-65:F-97<26?F-97:l}function m(F,$){return F+22+75*(F<26)-(($!=0)<<5)}function x(F,$,X){var ce=0;for(F=X?M(F/d):F>>1,F+=M(F/$);F>T*u>>1;ce+=l)F=M(F/T);return M(ce+(T+1)*F/(F+c))}function S(F){var $=[],X=F.length,ce,he=0,ge=p,ue=g,Se,Be,Ne,$e,Ue,Xe,yt,Xt,hr;for(Se=F.lastIndexOf(y),Se<0&&(Se=0),Be=0;Be<Se;++Be)F.charCodeAt(Be)>=128&&C("not-basic"),$.push(F.charCodeAt(Be));for(Ne=Se>0?Se+1:0;Ne<X;){for($e=he,Ue=1,Xe=l;Ne>=X&&C("invalid-input"),yt=f(F.charCodeAt(Ne++)),(yt>=l||yt>M((o-he)/Ue))&&C("overflow"),he+=yt*Ue,Xt=Xe<=ue?h:Xe>=ue+u?u:Xe-ue,!(yt<Xt);Xe+=l)hr=l-Xt,Ue>M(o/hr)&&C("overflow"),Ue*=hr;ce=$.length+1,ue=x(he-$e,ce,$e==0),M(he/ce)>o-ge&&C("overflow"),ge+=M(he/ce),he%=ce,$.splice(he++,0,ge)}return ee($)}function L(F){var $,X,ce,he,ge,ue,Se,Be,Ne,$e,Ue,Xe=[],yt,Xt,hr,Ss;for(F=V(F),yt=F.length,$=p,X=0,ge=g,ue=0;ue<yt;++ue)Ue=F[ue],Ue<128&&Xe.push(A(Ue));for(ce=he=Xe.length,he&&Xe.push(y);ce<yt;){for(Se=o,ue=0;ue<yt;++ue)Ue=F[ue],Ue>=$&&Ue<Se&&(Se=Ue);for(Xt=ce+1,Se-$>M((o-X)/Xt)&&C("overflow"),X+=(Se-$)*Xt,$=Se,ue=0;ue<yt;++ue)if(Ue=F[ue],Ue<$&&++X>o&&C("overflow"),Ue==$){for(Be=X,Ne=l;$e=Ne<=ge?h:Ne>=ge+u?u:Ne-ge,!(Be<$e);Ne+=l)Ss=Be-$e,hr=l-$e,Xe.push(A(m($e+Ss%hr,0))),Be=M(Ss/hr);Xe.push(A(m(Be,0))),ge=x(X,Xt,ce==he),X=0,++ce}++X,++$}return Xe.join("")}function O(F){return B(F,function($){return _.test($)?S($.slice(4).toLowerCase()):$})}function N(F){return B(F,function($){return v.test($)?"xn--"+L($):$})}if(a={version:"1.3.2",ucs2:{decode:V,encode:ee},decode:S,encode:L,toASCII:N,toUnicode:O},i&&n)if(t.exports==i)n.exports=a;else for(I in a)a.hasOwnProperty(I)&&(i[I]=a[I]);else r.punycode=a})(gr)}(xi,xi.exports)),xi.exports}var qs={exports:{}};/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var Xl;function lw(){return Xl||(Xl=1,function(t){(function(e,r){t.exports?t.exports=r():e.IPv6=r(e)})(gr,function(e){var r=e&&e.IPv6;function i(s){var a=s.toLowerCase(),o=a.split(":"),l=o.length,h=8;o[0]===""&&o[1]===""&&o[2]===""?(o.shift(),o.shift()):o[0]===""&&o[1]===""?o.shift():o[l-1]===""&&o[l-2]===""&&o.pop(),l=o.length,o[l-1].indexOf(".")!==-1&&(h=7);var u;for(u=0;u<l&&o[u]!=="";u++);if(u<h)for(o.splice(u,1,"0000");o.length<h;)o.splice(u,0,"0000");for(var c,d=0;d<h;d++){c=o[d].split("");for(var g=0;g<3&&(c[0]==="0"&&c.length>1);g++)c.splice(0,1);o[d]=c.join("")}var p=-1,y=0,_=0,v=-1,E=!1;for(d=0;d<h;d++)E?o[d]==="0"?_+=1:(E=!1,_>y&&(p=v,y=_)):o[d]==="0"&&(E=!0,v=d,_=1);_>y&&(p=v,y=_),y>1&&o.splice(p,y,""),l=o.length;var w="";for(o[0]===""&&(w=":"),d=0;d<l&&(w+=o[d],d!==l-1);d++)w+=":";return o[l-1]===""&&(w+=":"),w}function n(){return e.IPv6===this&&(e.IPv6=r),this}return{best:i,noConflict:n}})}(qs)),qs.exports}var Zs={exports:{}};/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var Hl;function hw(){return Hl||(Hl=1,function(t){(function(e,r){t.exports?t.exports=r():e.SecondLevelDomains=r(e)})(gr,function(e){var r=e&&e.SecondLevelDomains,i={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(n){var s=n.lastIndexOf(".");if(s<=0||s>=n.length-1)return!1;var a=n.lastIndexOf(".",s-1);if(a<=0||a>=s-1)return!1;var o=i.list[n.slice(s+1)];return o?o.indexOf(" "+n.slice(a+1,s)+" ")>=0:!1},is:function(n){var s=n.lastIndexOf(".");if(s<=0||s>=n.length-1)return!1;var a=n.lastIndexOf(".",s-1);if(a>=0)return!1;var o=i.list[n.slice(s+1)];return o?o.indexOf(" "+n.slice(0,s)+" ")>=0:!1},get:function(n){var s=n.lastIndexOf(".");if(s<=0||s>=n.length-1)return null;var a=n.lastIndexOf(".",s-1);if(a<=0||a>=s-1)return null;var o=i.list[n.slice(s+1)];return!o||o.indexOf(" "+n.slice(a+1,s)+" ")<0?null:n.slice(a+1)},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=r),this}};return i})}(Zs)),Zs.exports}/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */(function(t){(function(e,r){t.exports?t.exports=r(ow(),lw(),hw()):e.URI=r(e.punycode,e.IPv6,e.SecondLevelDomains,e)})(gr,function(e,r,i,n){var s=n&&n.URI;function a(f,m){var x=arguments.length>=1,S=arguments.length>=2;if(!(this instanceof a))return x?S?new a(f,m):new a(f):new a;if(f===void 0){if(x)throw new TypeError("undefined is not a valid argument for URI");typeof location<"u"?f=location.href+"":f=""}if(f===null&&x)throw new TypeError("null is not a valid argument for URI");return this.href(f),m!==void 0?this.absoluteTo(m):this}function o(f){return/^[0-9]+$/.test(f)}a.version="1.19.11";var l=a.prototype,h=Object.prototype.hasOwnProperty;function u(f){return f.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function c(f){return f===void 0?"Undefined":String(Object.prototype.toString.call(f)).slice(8,-1)}function d(f){return c(f)==="Array"}function g(f,m){var x={},S,L;if(c(m)==="RegExp")x=null;else if(d(m))for(S=0,L=m.length;S<L;S++)x[m[S]]=!0;else x[m]=!0;for(S=0,L=f.length;S<L;S++){var O=x&&x[f[S]]!==void 0||!x&&m.test(f[S]);O&&(f.splice(S,1),L--,S--)}return f}function p(f,m){var x,S;if(d(m)){for(x=0,S=m.length;x<S;x++)if(!p(f,m[x]))return!1;return!0}var L=c(m);for(x=0,S=f.length;x<S;x++)if(L==="RegExp"){if(typeof f[x]=="string"&&f[x].match(m))return!0}else if(f[x]===m)return!0;return!1}function y(f,m){if(!d(f)||!d(m)||f.length!==m.length)return!1;f.sort(),m.sort();for(var x=0,S=f.length;x<S;x++)if(f[x]!==m[x])return!1;return!0}function _(f){var m=/^\/+|\/+$/g;return f.replace(m,"")}a._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:a.preventInvalidHostname,duplicateQueryParameters:a.duplicateQueryParameters,escapeQuerySpace:a.escapeQuerySpace}},a.preventInvalidHostname=!1,a.duplicateQueryParameters=!1,a.escapeQuerySpace=!0,a.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,a.idn_expression=/[^a-z0-9\._-]/i,a.punycode_expression=/(xn--)/i,a.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,a.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,a.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig,a.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},a.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,a.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,a.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},a.hostProtocols=["http","https"],a.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,a.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},a.getDomAttribute=function(f){if(!(!f||!f.nodeName)){var m=f.nodeName.toLowerCase();if(!(m==="input"&&f.type!=="image"))return a.domAttributes[m]}};function v(f){return escape(f)}function E(f){return encodeURIComponent(f).replace(/[!'()*]/g,v).replace(/\*/g,"%2A")}a.encode=E,a.decode=decodeURIComponent,a.iso8859=function(){a.encode=escape,a.decode=unescape},a.unicode=function(){a.encode=E,a.decode=decodeURIComponent},a.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},a.encodeQuery=function(f,m){var x=a.encode(f+"");return m===void 0&&(m=a.escapeQuerySpace),m?x.replace(/%20/g,"+"):x},a.decodeQuery=function(f,m){f+="",m===void 0&&(m=a.escapeQuerySpace);try{return a.decode(m?f.replace(/\+/g,"%20"):f)}catch{return f}};var w={encode:"encode",decode:"decode"},T,M=function(f,m){return function(x){try{return a[m](x+"").replace(a.characters[f][m].expression,function(S){return a.characters[f][m].map[S]})}catch{return x}}};for(T in w)a[T+"PathSegment"]=M("pathname",w[T]),a[T+"UrnPathSegment"]=M("urnpath",w[T]);var A=function(f,m,x){return function(S){var L;x?L=function($){return a[m](a[x]($))}:L=a[m];for(var O=(S+"").split(f),N=0,F=O.length;N<F;N++)O[N]=L(O[N]);return O.join(f)}};a.decodePath=A("/","decodePathSegment"),a.decodeUrnPath=A(":","decodeUrnPathSegment"),a.recodePath=A("/","encodePathSegment","decode"),a.recodeUrnPath=A(":","encodeUrnPathSegment","decode"),a.encodeReserved=M("reserved","encode"),a.parse=function(f,m){var x;return m||(m={preventInvalidHostname:a.preventInvalidHostname}),f=f.replace(a.leading_whitespace_expression,""),f=f.replace(a.ascii_tab_whitespace,""),x=f.indexOf("#"),x>-1&&(m.fragment=f.substring(x+1)||null,f=f.substring(0,x)),x=f.indexOf("?"),x>-1&&(m.query=f.substring(x+1)||null,f=f.substring(0,x)),f=f.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://"),f=f.replace(/^[/\\]{2,}/i,"//"),f.substring(0,2)==="//"?(m.protocol=null,f=f.substring(2),f=a.parseAuthority(f,m)):(x=f.indexOf(":"),x>-1&&(m.protocol=f.substring(0,x)||null,m.protocol&&!m.protocol.match(a.protocol_expression)?m.protocol=void 0:f.substring(x+1,x+3).replace(/\\/g,"/")==="//"?(f=f.substring(x+3),f=a.parseAuthority(f,m)):(f=f.substring(x+1),m.urn=!0))),m.path=f,m},a.parseHost=function(f,m){f||(f=""),f=f.replace(/\\/g,"/");var x=f.indexOf("/"),S,L;if(x===-1&&(x=f.length),f.charAt(0)==="[")S=f.indexOf("]"),m.hostname=f.substring(1,S)||null,m.port=f.substring(S+2,x)||null,m.port==="/"&&(m.port=null);else{var O=f.indexOf(":"),N=f.indexOf("/"),F=f.indexOf(":",O+1);F!==-1&&(N===-1||F<N)?(m.hostname=f.substring(0,x)||null,m.port=null):(L=f.substring(0,x).split(":"),m.hostname=L[0]||null,m.port=L[1]||null)}return m.hostname&&f.substring(x).charAt(0)!=="/"&&(x++,f="/"+f),m.preventInvalidHostname&&a.ensureValidHostname(m.hostname,m.protocol),m.port&&a.ensureValidPort(m.port),f.substring(x)||"/"},a.parseAuthority=function(f,m){return f=a.parseUserinfo(f,m),a.parseHost(f,m)},a.parseUserinfo=function(f,m){var x=f,S=f.indexOf("\\");S!==-1&&(f=f.replace(/\\/g,"/"));var L=f.indexOf("/"),O=f.lastIndexOf("@",L>-1?L:f.length-1),N;return O>-1&&(L===-1||O<L)?(N=f.substring(0,O).split(":"),m.username=N[0]?a.decode(N[0]):null,N.shift(),m.password=N[0]?a.decode(N.join(":")):null,f=x.substring(O+1)):(m.username=null,m.password=null),f},a.parseQuery=function(f,m){if(!f)return{};if(f=f.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!f)return{};for(var x={},S=f.split("&"),L=S.length,O,N,F,$=0;$<L;$++)O=S[$].split("="),N=a.decodeQuery(O.shift(),m),F=O.length?a.decodeQuery(O.join("="),m):null,N!=="__proto__"&&(h.call(x,N)?((typeof x[N]=="string"||x[N]===null)&&(x[N]=[x[N]]),x[N].push(F)):x[N]=F);return x},a.build=function(f){var m="",x=!1;return f.protocol&&(m+=f.protocol+":"),!f.urn&&(m||f.hostname)&&(m+="//",x=!0),m+=a.buildAuthority(f)||"",typeof f.path=="string"&&(f.path.charAt(0)!=="/"&&x&&(m+="/"),m+=f.path),typeof f.query=="string"&&f.query&&(m+="?"+f.query),typeof f.fragment=="string"&&f.fragment&&(m+="#"+f.fragment),m},a.buildHost=function(f){var m="";if(f.hostname)a.ip6_expression.test(f.hostname)?m+="["+f.hostname+"]":m+=f.hostname;else return"";return f.port&&(m+=":"+f.port),m},a.buildAuthority=function(f){return a.buildUserinfo(f)+a.buildHost(f)},a.buildUserinfo=function(f){var m="";return f.username&&(m+=a.encode(f.username)),f.password&&(m+=":"+a.encode(f.password)),m&&(m+="@"),m},a.buildQuery=function(f,m,x){var S="",L,O,N,F;for(O in f)if(O!=="__proto__"&&h.call(f,O))if(d(f[O]))for(L={},N=0,F=f[O].length;N<F;N++)f[O][N]!==void 0&&L[f[O][N]+""]===void 0&&(S+="&"+a.buildQueryParameter(O,f[O][N],x),m!==!0&&(L[f[O][N]+""]=!0));else f[O]!==void 0&&(S+="&"+a.buildQueryParameter(O,f[O],x));return S.substring(1)},a.buildQueryParameter=function(f,m,x){return a.encodeQuery(f,x)+(m!==null?"="+a.encodeQuery(m,x):"")},a.addQuery=function(f,m,x){if(typeof m=="object")for(var S in m)h.call(m,S)&&a.addQuery(f,S,m[S]);else if(typeof m=="string"){if(f[m]===void 0){f[m]=x;return}else typeof f[m]=="string"&&(f[m]=[f[m]]);d(x)||(x=[x]),f[m]=(f[m]||[]).concat(x)}else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")},a.setQuery=function(f,m,x){if(typeof m=="object")for(var S in m)h.call(m,S)&&a.setQuery(f,S,m[S]);else if(typeof m=="string")f[m]=x===void 0?null:x;else throw new TypeError("URI.setQuery() accepts an object, string as the name parameter")},a.removeQuery=function(f,m,x){var S,L,O;if(d(m))for(S=0,L=m.length;S<L;S++)f[m[S]]=void 0;else if(c(m)==="RegExp")for(O in f)m.test(O)&&(f[O]=void 0);else if(typeof m=="object")for(O in m)h.call(m,O)&&a.removeQuery(f,O,m[O]);else if(typeof m=="string")x!==void 0?c(x)==="RegExp"?!d(f[m])&&x.test(f[m])?f[m]=void 0:f[m]=g(f[m],x):f[m]===String(x)&&(!d(x)||x.length===1)?f[m]=void 0:d(f[m])&&(f[m]=g(f[m],x)):f[m]=void 0;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")},a.hasQuery=function(f,m,x,S){switch(c(m)){case"String":break;case"RegExp":for(var L in f)if(h.call(f,L)&&m.test(L)&&(x===void 0||a.hasQuery(f,L,x)))return!0;return!1;case"Object":for(var O in m)if(h.call(m,O)&&!a.hasQuery(f,O,m[O]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(c(x)){case"Undefined":return m in f;case"Boolean":var N=!!(d(f[m])?f[m].length:f[m]);return x===N;case"Function":return!!x(f[m],m,f);case"Array":if(!d(f[m]))return!1;var F=S?p:y;return F(f[m],x);case"RegExp":return d(f[m])?S?p(f[m],x):!1:!!(f[m]&&f[m].match(x));case"Number":x=String(x);case"String":return d(f[m])?S?p(f[m],x):!1:f[m]===x;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},a.joinPaths=function(){for(var f=[],m=[],x=0,S=0;S<arguments.length;S++){var L=new a(arguments[S]);f.push(L);for(var O=L.segment(),N=0;N<O.length;N++)typeof O[N]=="string"&&m.push(O[N]),O[N]&&x++}if(!m.length||!x)return new a("");var F=new a("").segment(m);return(f[0].path()===""||f[0].path().slice(0,1)==="/")&&F.path("/"+F.path()),F.normalize()},a.commonPath=function(f,m){var x=Math.min(f.length,m.length),S;for(S=0;S<x;S++)if(f.charAt(S)!==m.charAt(S)){S--;break}return S<1?f.charAt(0)===m.charAt(0)&&f.charAt(0)==="/"?"/":"":((f.charAt(S)!=="/"||m.charAt(S)!=="/")&&(S=f.substring(0,S).lastIndexOf("/")),f.substring(0,S+1))},a.withinString=function(f,m,x){x||(x={});var S=x.start||a.findUri.start,L=x.end||a.findUri.end,O=x.trim||a.findUri.trim,N=x.parens||a.findUri.parens,F=/[a-z0-9-]=["']?$/i;for(S.lastIndex=0;;){var $=S.exec(f);if(!$)break;var X=$.index;if(x.ignoreHtml){var ce=f.slice(Math.max(X-3,0),X);if(ce&&F.test(ce))continue}for(var he=X+f.slice(X).search(L),ge=f.slice(X,he),ue=-1;;){var Se=N.exec(ge);if(!Se)break;var Be=Se.index+Se[0].length;ue=Math.max(ue,Be)}if(ue>-1?ge=ge.slice(0,ue)+ge.slice(ue).replace(O,""):ge=ge.replace(O,""),!(ge.length<=$[0].length)&&!(x.ignore&&x.ignore.test(ge))){he=X+ge.length;var Ne=m(ge,X,he,f);if(Ne===void 0){S.lastIndex=he;continue}Ne=String(Ne),f=f.slice(0,X)+Ne+f.slice(he),S.lastIndex=X+Ne.length}}return S.lastIndex=0,f},a.ensureValidHostname=function(f,m){var x=!!f,S=!!m,L=!1;if(S&&(L=p(a.hostProtocols,m)),L&&!x)throw new TypeError("Hostname cannot be empty, if protocol is "+m);if(f&&f.match(a.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+f+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(f).match(a.invalid_hostname_characters))throw new TypeError('Hostname "'+f+'" contains characters other than [A-Z0-9.-:_]')}},a.ensureValidPort=function(f){if(f){var m=Number(f);if(!(o(m)&&m>0&&m<65536))throw new TypeError('Port "'+f+'" is not a valid port')}},a.noConflict=function(f){if(f){var m={URI:this.noConflict()};return n.URITemplate&&typeof n.URITemplate.noConflict=="function"&&(m.URITemplate=n.URITemplate.noConflict()),n.IPv6&&typeof n.IPv6.noConflict=="function"&&(m.IPv6=n.IPv6.noConflict()),n.SecondLevelDomains&&typeof n.SecondLevelDomains.noConflict=="function"&&(m.SecondLevelDomains=n.SecondLevelDomains.noConflict()),m}else n.URI===this&&(n.URI=s);return this},l.build=function(f){return f===!0?this._deferred_build=!0:(f===void 0||this._deferred_build)&&(this._string=a.build(this._parts),this._deferred_build=!1),this},l.clone=function(){return new a(this)},l.valueOf=l.toString=function(){return this.build(!1)._string};function I(f){return function(m,x){return m===void 0?this._parts[f]||"":(this._parts[f]=m||null,this.build(!x),this)}}function C(f,m){return function(x,S){return x===void 0?this._parts[f]||"":(x!==null&&(x=x+"",x.charAt(0)===m&&(x=x.substring(1))),this._parts[f]=x,this.build(!S),this)}}l.protocol=I("protocol"),l.username=I("username"),l.password=I("password"),l.hostname=I("hostname"),l.port=I("port"),l.query=C("query","?"),l.fragment=C("fragment","#"),l.search=function(f,m){var x=this.query(f,m);return typeof x=="string"&&x.length?"?"+x:x},l.hash=function(f,m){var x=this.fragment(f,m);return typeof x=="string"&&x.length?"#"+x:x},l.pathname=function(f,m){if(f===void 0||f===!0){var x=this._parts.path||(this._parts.hostname?"/":"");return f?(this._parts.urn?a.decodeUrnPath:a.decodePath)(x):x}else return this._parts.urn?this._parts.path=f?a.recodeUrnPath(f):"":this._parts.path=f?a.recodePath(f):"/",this.build(!m),this},l.path=l.pathname,l.href=function(f,m){var x;if(f===void 0)return this.toString();this._string="",this._parts=a._parts();var S=f instanceof a,L=typeof f=="object"&&(f.hostname||f.path||f.pathname);if(f.nodeName){var O=a.getDomAttribute(f);f=f[O]||"",L=!1}if(!S&&L&&f.pathname!==void 0&&(f=f.toString()),typeof f=="string"||f instanceof String)this._parts=a.parse(String(f),this._parts);else if(S||L){var N=S?f._parts:f;for(x in N)x!=="query"&&h.call(this._parts,x)&&(this._parts[x]=N[x]);N.query&&this.query(N.query,!1)}else throw new TypeError("invalid input");return this.build(!m),this},l.is=function(f){var m=!1,x=!1,S=!1,L=!1,O=!1,N=!1,F=!1,$=!this._parts.urn;switch(this._parts.hostname&&($=!1,x=a.ip4_expression.test(this._parts.hostname),S=a.ip6_expression.test(this._parts.hostname),m=x||S,L=!m,O=L&&i&&i.has(this._parts.hostname),N=L&&a.idn_expression.test(this._parts.hostname),F=L&&a.punycode_expression.test(this._parts.hostname)),f.toLowerCase()){case"relative":return $;case"absolute":return!$;case"domain":case"name":return L;case"sld":return O;case"ip":return m;case"ip4":case"ipv4":case"inet4":return x;case"ip6":case"ipv6":case"inet6":return S;case"idn":return N;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return F}return null};var D=l.protocol,B=l.port,V=l.hostname;l.protocol=function(f,m){if(f&&(f=f.replace(/:(\/\/)?$/,""),!f.match(a.protocol_expression)))throw new TypeError('Protocol "'+f+`" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]`);return D.call(this,f,m)},l.scheme=l.protocol,l.port=function(f,m){return this._parts.urn?f===void 0?"":this:(f!==void 0&&(f===0&&(f=null),f&&(f+="",f.charAt(0)===":"&&(f=f.substring(1)),a.ensureValidPort(f))),B.call(this,f,m))},l.hostname=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(f!==void 0){var x={preventInvalidHostname:this._parts.preventInvalidHostname},S=a.parseHost(f,x);if(S!=="/")throw new TypeError('Hostname "'+f+'" contains characters other than [A-Z0-9.-]');f=x.hostname,this._parts.preventInvalidHostname&&a.ensureValidHostname(f,this._parts.protocol)}return V.call(this,f,m)},l.origin=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(f===void 0){var x=this.protocol(),S=this.authority();return S?(x?x+"://":"")+this.authority():""}else{var L=a(f);return this.protocol(L.protocol()).authority(L.authority()).build(!m),this}},l.host=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(f===void 0)return this._parts.hostname?a.buildHost(this._parts):"";var x=a.parseHost(f,this._parts);if(x!=="/")throw new TypeError('Hostname "'+f+'" contains characters other than [A-Z0-9.-]');return this.build(!m),this},l.authority=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(f===void 0)return this._parts.hostname?a.buildAuthority(this._parts):"";var x=a.parseAuthority(f,this._parts);if(x!=="/")throw new TypeError('Hostname "'+f+'" contains characters other than [A-Z0-9.-]');return this.build(!m),this},l.userinfo=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(f===void 0){var x=a.buildUserinfo(this._parts);return x&&x.substring(0,x.length-1)}else return f[f.length-1]!=="@"&&(f+="@"),a.parseUserinfo(f,this._parts),this.build(!m),this},l.resource=function(f,m){var x;return f===void 0?this.path()+this.search()+this.hash():(x=a.parse(f),this._parts.path=x.path,this._parts.query=x.query,this._parts.fragment=x.fragment,this.build(!m),this)},l.subdomain=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(f===void 0){if(!this._parts.hostname||this.is("IP"))return"";var x=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,x)||""}else{var S=this._parts.hostname.length-this.domain().length,L=this._parts.hostname.substring(0,S),O=new RegExp("^"+u(L));if(f&&f.charAt(f.length-1)!=="."&&(f+="."),f.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return f&&a.ensureValidHostname(f,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(O,f),this.build(!m),this}},l.domain=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(typeof f=="boolean"&&(m=f,f=void 0),f===void 0){if(!this._parts.hostname||this.is("IP"))return"";var x=this._parts.hostname.match(/\./g);if(x&&x.length<2)return this._parts.hostname;var S=this._parts.hostname.length-this.tld(m).length-1;return S=this._parts.hostname.lastIndexOf(".",S-1)+1,this._parts.hostname.substring(S)||""}else{if(!f)throw new TypeError("cannot set domain empty");if(f.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");if(a.ensureValidHostname(f,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=f;else{var L=new RegExp(u(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(L,f)}return this.build(!m),this}},l.tld=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(typeof f=="boolean"&&(m=f,f=void 0),f===void 0){if(!this._parts.hostname||this.is("IP"))return"";var x=this._parts.hostname.lastIndexOf("."),S=this._parts.hostname.substring(x+1);return m!==!0&&i&&i.list[S.toLowerCase()]&&i.get(this._parts.hostname)||S}else{var L;if(f)if(f.match(/[^a-zA-Z0-9-]/))if(i&&i.is(f))L=new RegExp(u(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(L,f);else throw new TypeError('TLD "'+f+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");L=new RegExp(u(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(L,f)}else throw new TypeError("cannot set TLD empty");return this.build(!m),this}},l.directory=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(f===void 0||f===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var x=this._parts.path.length-this.filename().length-1,S=this._parts.path.substring(0,x)||(this._parts.hostname?"/":"");return f?a.decodePath(S):S}else{var L=this._parts.path.length-this.filename().length,O=this._parts.path.substring(0,L),N=new RegExp("^"+u(O));return this.is("relative")||(f||(f="/"),f.charAt(0)!=="/"&&(f="/"+f)),f&&f.charAt(f.length-1)!=="/"&&(f+="/"),f=a.recodePath(f),this._parts.path=this._parts.path.replace(N,f),this.build(!m),this}},l.filename=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(typeof f!="string"){if(!this._parts.path||this._parts.path==="/")return"";var x=this._parts.path.lastIndexOf("/"),S=this._parts.path.substring(x+1);return f?a.decodePathSegment(S):S}else{var L=!1;f.charAt(0)==="/"&&(f=f.substring(1)),f.match(/\.?\//)&&(L=!0);var O=new RegExp(u(this.filename())+"$");return f=a.recodePath(f),this._parts.path=this._parts.path.replace(O,f),L?this.normalizePath(m):this.build(!m),this}},l.suffix=function(f,m){if(this._parts.urn)return f===void 0?"":this;if(f===void 0||f===!0){if(!this._parts.path||this._parts.path==="/")return"";var x=this.filename(),S=x.lastIndexOf("."),L,O;return S===-1?"":(L=x.substring(S+1),O=/^[a-z0-9%]+$/i.test(L)?L:"",f?a.decodePathSegment(O):O)}else{f.charAt(0)==="."&&(f=f.substring(1));var N=this.suffix(),F;if(N)f?F=new RegExp(u(N)+"$"):F=new RegExp(u("."+N)+"$");else{if(!f)return this;this._parts.path+="."+a.recodePath(f)}return F&&(f=a.recodePath(f),this._parts.path=this._parts.path.replace(F,f)),this.build(!m),this}},l.segment=function(f,m,x){var S=this._parts.urn?":":"/",L=this.path(),O=L.substring(0,1)==="/",N=L.split(S);if(f!==void 0&&typeof f!="number"&&(x=m,m=f,f=void 0),f!==void 0&&typeof f!="number")throw new Error('Bad segment "'+f+'", must be 0-based integer');if(O&&N.shift(),f<0&&(f=Math.max(N.length+f,0)),m===void 0)return f===void 0?N:N[f];if(f===null||N[f]===void 0)if(d(m)){N=[];for(var F=0,$=m.length;F<$;F++)!m[F].length&&(!N.length||!N[N.length-1].length)||(N.length&&!N[N.length-1].length&&N.pop(),N.push(_(m[F])))}else(m||typeof m=="string")&&(m=_(m),N[N.length-1]===""?N[N.length-1]=m:N.push(m));else m?N[f]=_(m):N.splice(f,1);return O&&N.unshift(""),this.path(N.join(S),x)},l.segmentCoded=function(f,m,x){var S,L,O;if(typeof f!="number"&&(x=m,m=f,f=void 0),m===void 0){if(S=this.segment(f,m,x),!d(S))S=S!==void 0?a.decode(S):void 0;else for(L=0,O=S.length;L<O;L++)S[L]=a.decode(S[L]);return S}if(!d(m))m=typeof m=="string"||m instanceof String?a.encode(m):m;else for(L=0,O=m.length;L<O;L++)m[L]=a.encode(m[L]);return this.segment(f,m,x)};var ee=l.query;return l.query=function(f,m){if(f===!0)return a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof f=="function"){var x=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace),S=f.call(this,x);return this._parts.query=a.buildQuery(S||x,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!m),this}else return f!==void 0&&typeof f!="string"?(this._parts.query=a.buildQuery(f,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!m),this):ee.call(this,f,m)},l.setQuery=function(f,m,x){var S=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof f=="string"||f instanceof String)S[f]=m!==void 0?m:null;else if(typeof f=="object")for(var L in f)h.call(f,L)&&(S[L]=f[L]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=a.buildQuery(S,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof f!="string"&&(x=m),this.build(!x),this},l.addQuery=function(f,m,x){var S=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return a.addQuery(S,f,m===void 0?null:m),this._parts.query=a.buildQuery(S,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof f!="string"&&(x=m),this.build(!x),this},l.removeQuery=function(f,m,x){var S=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return a.removeQuery(S,f,m),this._parts.query=a.buildQuery(S,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof f!="string"&&(x=m),this.build(!x),this},l.hasQuery=function(f,m,x){var S=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return a.hasQuery(S,f,m,x)},l.setSearch=l.setQuery,l.addSearch=l.addQuery,l.removeSearch=l.removeQuery,l.hasSearch=l.hasQuery,l.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},l.normalizeProtocol=function(f){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!f)),this},l.normalizeHostname=function(f){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&r&&(this._parts.hostname=r.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!f)),this},l.normalizePort=function(f){return typeof this._parts.protocol=="string"&&this._parts.port===a.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!f)),this},l.normalizePath=function(f){var m=this._parts.path;if(!m)return this;if(this._parts.urn)return this._parts.path=a.recodeUrnPath(this._parts.path),this.build(!f),this;if(this._parts.path==="/")return this;m=a.recodePath(m);var x,S="",L,O;for(m.charAt(0)!=="/"&&(x=!0,m="/"+m),(m.slice(-3)==="/.."||m.slice(-2)==="/.")&&(m+="/"),m=m.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),x&&(S=m.substring(1).match(/^(\.\.\/)+/)||"",S&&(S=S[0]));L=m.search(/\/\.\.(\/|$)/),L!==-1;){if(L===0){m=m.substring(3);continue}O=m.substring(0,L).lastIndexOf("/"),O===-1&&(O=L),m=m.substring(0,O)+m.substring(L+3)}return x&&this.is("relative")&&(m=S+m.substring(1)),this._parts.path=m,this.build(!f),this},l.normalizePathname=l.normalizePath,l.normalizeQuery=function(f){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(a.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!f)),this},l.normalizeFragment=function(f){return this._parts.fragment||(this._parts.fragment=null,this.build(!f)),this},l.normalizeSearch=l.normalizeQuery,l.normalizeHash=l.normalizeFragment,l.iso8859=function(){var f=a.encode,m=a.decode;a.encode=escape,a.decode=decodeURIComponent;try{this.normalize()}finally{a.encode=f,a.decode=m}return this},l.unicode=function(){var f=a.encode,m=a.decode;a.encode=E,a.decode=unescape;try{this.normalize()}finally{a.encode=f,a.decode=m}return this},l.readable=function(){var f=this.clone();f.username("").password("").normalize();var m="";if(f._parts.protocol&&(m+=f._parts.protocol+"://"),f._parts.hostname&&(f.is("punycode")&&e?(m+=e.toUnicode(f._parts.hostname),f._parts.port&&(m+=":"+f._parts.port)):m+=f.host()),f._parts.hostname&&f._parts.path&&f._parts.path.charAt(0)!=="/"&&(m+="/"),m+=f.path(!0),f._parts.query){for(var x="",S=0,L=f._parts.query.split("&"),O=L.length;S<O;S++){var N=(L[S]||"").split("=");x+="&"+a.decodeQuery(N[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),N[1]!==void 0&&(x+="="+a.decodeQuery(N[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}m+="?"+x.substring(1)}return m+=a.decodeQuery(f.hash(),!0),m},l.absoluteTo=function(f){var m=this.clone(),x=["protocol","username","password","hostname","port"],S,L,O;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(f instanceof a||(f=new a(f)),m._parts.protocol||(m._parts.protocol=f._parts.protocol,this._parts.hostname))return m;for(L=0;O=x[L];L++)m._parts[O]=f._parts[O];return m._parts.path?(m._parts.path.substring(-2)===".."&&(m._parts.path+="/"),m.path().charAt(0)!=="/"&&(S=f.directory(),S=S||(f.path().indexOf("/")===0?"/":""),m._parts.path=(S?S+"/":"")+m._parts.path,m.normalizePath())):(m._parts.path=f._parts.path,m._parts.query||(m._parts.query=f._parts.query)),m.build(),m},l.relativeTo=function(f){var m=this.clone().normalize(),x,S,L,O,N;if(m._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(f=new a(f).normalize(),x=m._parts,S=f._parts,O=m.path(),N=f.path(),O.charAt(0)!=="/")throw new Error("URI is already relative");if(N.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");if(x.protocol===S.protocol&&(x.protocol=null),x.username!==S.username||x.password!==S.password||x.protocol!==null||x.username!==null||x.password!==null)return m.build();if(x.hostname===S.hostname&&x.port===S.port)x.hostname=null,x.port=null;else return m.build();if(O===N)return x.path="",m.build();if(L=a.commonPath(O,N),!L)return m.build();var F=S.path.substring(L.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return x.path=F+x.path.substring(L.length)||"./",m.build()},l.equals=function(f){var m=this.clone(),x=new a(f),S={},L={},O={},N,F,$;if(m.normalize(),x.normalize(),m.toString()===x.toString())return!0;if(N=m.query(),F=x.query(),m.query(""),x.query(""),m.toString()!==x.toString()||N.length!==F.length)return!1;S=a.parseQuery(N,this._parts.escapeQuerySpace),L=a.parseQuery(F,this._parts.escapeQuerySpace);for($ in S)if(h.call(S,$)){if(d(S[$])){if(!y(S[$],L[$]))return!1}else if(S[$]!==L[$])return!1;O[$]=!0}for($ in L)if(h.call(L,$)&&!O[$])return!1;return!0},l.preventInvalidHostname=function(f){return this._parts.preventInvalidHostname=!!f,this},l.duplicateQueryParameters=function(f){return this._parts.duplicateQueryParameters=!!f,this},l.escapeQuerySpace=function(f){return this._parts.escapeQuerySpace=!!f,this},a})})(Af);var cw=Af.exports;const _a=cs(cw),Yl=["http","https"];function uw(t){return typeof t=="string"&&t.startsWith("/vsi")&&!t.startsWith("/vsicurl/")}function fw(t,e,r=!0){return dw(t,e,!1,r)}function dw(t,e=null,r=!1,i=!0){typeof t=="string"&&t.startsWith("/vsicurl/")&&(t=t.replace(/^\/vsicurl\//,""));let n=_a(t);if(e&&n.is("relative")&&!uw(t)){let s=_a(e),a=s.path();!a.endsWith("/")&&!a.endsWith(".json")&&s.path(a+"/"),n=n.absoluteTo(s)}return n.normalize(),r&&(n.query(""),n.fragment("")),i?n.toString():n}const gw="application/geo+json",pw=["application/json",gw,"text/json"],Kl=["image/gif","image/jpeg","image/apng","image/png","image/webp"],If=["image/tiff; application=geotiff; profile=cloud-optimized","image/vnd.stac.geotiff; cloud-optimized=true"],Lf=["application/geotiff","image/tiff; application=geotiff","image/vnd.stac.geotiff"].concat(If);function Oo(t,e,r=!1){return Array.isArray(e)||(e=[e]),r&&typeof t>"u"?!0:typeof t!="string"?!1:(e=e.map(i=>i.toLowerCase()),e.includes(t.toLowerCase()))}function mw(t,e=!1){return Oo(t,pw,e)}class Cf extends Es{constructor(e,r=null,i={},n=[]){super(e,i,["_context"].concat(n)),this._context||(this._context=r)}getAbsoluteUrl(e=!0){return this._context?fw(this.href,this._context.getAbsoluteUrl(),e):this.href.includes("://")?this.href:null}getContext(){return this._context}canBrowserDisplayImage(e=!1){if(typeof this.href!="string")return!1;if(!e&&typeof this.type>"u")return!1;let r=new _a(this.href),i=r.protocol().toLowerCase(),n=r.suffix().toLowerCase();return rt(i)&&!Yl.includes(i)?!1:rt(this.type)&&Kl.includes(this.type.toLowerCase())?!0:!!(typeof this.type>"u"&&rt(n)&&(n==="jpg"||Kl.includes("image/"+n)))}isType(e){return rt(this.type)&&Oo(this.type,e)}isGeoTIFF(){return this.isType(Lf)}isCOG(){return this.isType(If)}isHTTP(){let r=this.getAbsoluteUrl(!1).protocol().toLowerCase();return rt(r)&&Yl.includes(r)}}class No extends Cf{constructor(e,r=null){super(e,r)}isLink(){return!0}getObjectType(){return"Link"}static fromLinks(e,r=null){return Array.isArray(e)?e.map(i=>tt(i)?new No(i,r):i):[]}}class Of extends Es{constructor(e,r=null,i={},n=[]){if(super(e,Object.assign({links:No.fromLinks},i),["_url"].concat(n)),!this._url&&(this._url=r,!this._url)){let s=this.getSelfLink();s&&(this._url=s.href)}}getAbsoluteUrl(){return this._url}setAbsoluteUrl(e){this._url=e}getStacLinksWithRel(e,r=!0){return this.getLinksWithRels([e]).filter(i=>mw(i.type,r))}getStacLinkWithRel(e,r=!0){const i=this.getStacLinksWithRel(e,r);return i.length>0?i[0]:null}getLinks(){return Array.isArray(this.links)?this.links.filter(e=>tt(e)&&rt(e.href)):[]}getLinkWithRel(e){return this.getLinks().find(r=>r.rel===e)||null}getLinksWithRels(e){return this.getLinks().filter(r=>e.includes(r.rel))}getLinksWithOtherRels(e){return this.getLinks().filter(r=>!e.includes(r.rel))}getSelfLink(){return this.getStacLinkWithRel("self")}getRootLink(){return this.getStacLinkWithRel("root")}getParentLink(){return this.getStacLinkWithRel("parent")}}class Nf extends Of{constructor(e,r=null,i={},n=[]){super(e,r,i,n)}getAll(){return[]}}class er extends Cf{constructor(e,r=null,i=null){super(e,i,{},["_key"]),this._key||(this._key=r)}getObjectType(){return"Asset"}isAsset(){return!0}getAbsoluteUrl(e=!0){return this.isDefintion()?null:super.getAbsoluteUrl(e)}getKey(){return this._key}getMetadata(e){if(typeof this[e]<"u")return this[e];if(this._context)return this._context.getMetadata(e)}getBands(){return Pf(this["eo:bands"],this["raster:bands"])}findVisualBands(){let e={red:null,green:null,blue:null},r=this.getBands();for(let n in r){let s=parseInt(n,10),a=r[s];tt(a)&&rt(a.common_name)&&a.common_name in e&&(e[a.common_name]={index:s,band:a})}return Object.values(e).every(n=>n!==null)?e:null}findBand(e,r="name",i=null){Array.isArray(e)||(e=[e]),tt(i)||(i=this.getBands());let n=i.findIndex(s=>tt(s)&&e.includes(s[r]));return n>=0?{index:n,band:i[n]}:null}getBand(e){return tt(e)||e===null?e:this.getBands()[e]||null}getMinMaxValues(e=null){e=this.getBand(e);const r={minimum:null,maximum:null},i=o=>o.minimum!==null&&o.maximum!==null;if(e&&(tt(e.statistics)&&(typeof e.statistics.minimum=="number"&&(r.minimum=e.statistics.minimum),typeof e.statistics.maximum=="number"&&(r.maximum=e.statistics.maximum),i(r))||tt(e.histogram)&&(typeof e.histogram.min=="number"&&(r.minimum=e.histogram.min),typeof e.histogram.max=="number"&&(r.maximum=e.histogram.max),i(r))))return r;let n=this.getMetadata("classification:classes");if(Array.isArray(n)&&(n.reduce((o,l)=>(o.minimum=Math.min(o.minimum,l.value),o.maximum=Math.max(o.maximum,l.value),o),r),i(r)))return r;let s=this.getMetadata("file:values");if(Array.isArray(s)&&(s.reduce((o,l)=>(o.minimum=Math.min(o.minimum,...l.values),o.maximum=Math.max(o.maximum,...l.values),o),r),i(r)))return r;let a=tt(e)&&e.data_type||this.getMetadata("file:data_type");return a&&(r.minimum=sw(a),r.maximum=aw(a)),r}getNoDataValues(e=null){e=this.getBand(e);let r=[];if(e&&typeof e.nodata<"u")r.push(e.nodata);else{let i=this.getMetadata("file:nodata");if(typeof i<"u")r=i;else{let n=this.getMetadata("classification:classes");Array.isArray(n)&&(r=n.filter(s=>!!s.nodata).map(s=>s.value))}}return r.map(i=>i==="nan"?NaN:i==="+inf"?1/0:i==="-inf"?-1/0:i)}isDefintion(){return!rt(this.href)}isHTTP(){return this.isDefintion()?null:super.isHTTP()}hasRole(e,r=!1){return Array.isArray(e)||(e=[e]),r&&e.includes(this.getKey())?!0:Array.isArray(this.roles)&&!!this.roles.find(i=>e.includes(i))}static fromAssets(e,r=null){let i={};if(tt(e))for(let n in e)i[n]=new er(e[n],n,r);return i}}class ln extends Of{constructor(e,r=null,i={},n=[]){super(e,r,i,n)}getTemporalExtent(){return null}getTemporalExtents(){return[]}getIcons(e=!0){return this.getLinksWithRels(["icon"]).filter(r=>r.canBrowserDisplayImage(e))}getThumbnails(e=!0,r=null){let i=this.getAssetsWithRoles(["thumbnail","overview"],!0);return r&&i.length>1&&i.sort(n=>Array.isArray(n.roles)&&n.roles.includes(r)||n.getKey()===r?-1:1),i.length===0&&(i=this.getLinksWithRels(["preview"])),e&&(i=i.filter(n=>n.canBrowserDisplayImage())),i}getDefaultGeoTIFF(e=!0,r=!1){var n;return(n=this.rankGeoTIFFs(e,r)[0])==null?void 0:n.asset}rankGeoTIFFs(e=!0,r=!1,i=null,n=null){tt(i)||(i={data:1,visual:2,thumbnail:2,overview:3});let s=[],a=this.getAssetsByTypes(Lf);e&&(a=a.filter(l=>l.isHTTP()&&(!r||l.isCOG())));let o=Object.entries(i);for(let l of a){let h=0;if(o.length>0){let u=o.filter(([c])=>l.hasRole(c,!0)).map(([,c])=>c);u.length>0&&(h+=Math.max(...u))}!r&&l.isCOG()&&(h+=2),l.findVisualBands()&&(h+=1),typeof n=="function"&&(h+=n(l)),s.push({asset:l,score:h})}return s.sort((l,h)=>h.score-l.score),s}findVisualAssets(){let e={red:null,green:null,blue:null},r=Object.keys(e),i=this.getAssets();for(let s of i){let a=s.getBands();if(a.length!==1)continue;let o=s.findBand(r,"common_name",a);o&&(e[o.band.common_name]=s)}return Object.values(e).every(s=>s!==null)?e:null}getAsset(e){return tt(this.assets)&&this.assets[e]||null}getAssets(){return tt(this.assets)?Object.values(this.assets):[]}getAssetsWithRoles(e,r=!1){return this.getAssets().filter(i=>i.hasRole(e,r))}getAssetWithRole(e,r=!1){return this.getAssetsWithRoles([e],r)[0]||null}getAssetsByTypes(e){return this.getAssets().filter(r=>Oo(r.type,e))}equals(e){return this===e?!0:!(e instanceof ln)||this.getObjectType()!==e.getObjectType()?!1:!!(this.id&&this.id===e.id)}}class Ff extends ln{constructor(e,r=null,i={},n=[]){super(e,r,i,n)}getObjectType(){return this.type}getSearchLink(e=null){let r=this.getStacLinksWithRel("search");return e?r[0]||null:r.find(i=>i.method===e||!e&&!i.method)||null}getApiCollectionsLink(){return this.getStacLinkWithRel("data")}getApiItemsLink(){return this.getStacLinkWithRel("items")}getChildLinks(){return this.getStacLinksWithRel("child")}getItemLinks(){return this.getStacLinksWithRel("item")}}class yw extends Ff{constructor(e,r=null){super(e,r)}}function vi(t){if(rt(t)&&t.length>=10)try{let r=t.match(/^(-?\d{1,})-(\d\d)-(\d\d)[T ](\d\d):(\d\d):(\d\d)(?:\.(\d*))?(?:Z|[+-]00:00)?$/i).slice(1).map(i=>parseInt(i,10));return new Date(Date.UTC(r[0],r[1]-1,r[2],r[3],r[4],r[5],r[6]||0))}catch{return null}return null}function _w(t,e){return new Date(t.valueOf()+(e-t)/2)}function Df(t){if(!Array.isArray(t)||t.length===0)return null;let e,r;const i=(n,s,a)=>typeof n>"u"?s:n===null||s===null?null:a(n,s);return t.forEach(([n,s])=>{e=i(e,n,Math.min),r=i(r,s,Math.max)}),[e===null?null:new Date(e),r===null?null:new Date(r)]}function hn(t){let e=t.length>4,r=t[0],i=t[e?3:2],n=t[1],s=t[e?4:3];return{west:r,east:i,south:n,north:s}}function Vs(t){let{west:e,east:r,south:i,north:n}=hn(t);return[[[e,n],[e,i],[r,i],[r,n],[e,n]]]}function Gf(t){if(Nt(t)?t=[t]:Array.isArray(t)&&(t=t.filter(i=>Nt(i))),!Array.isArray(t)||t.length===0)return null;let e=t.reduce((i,n)=>{if(xw(n)){let{west:s,east:a,south:o,north:l}=hn(n);i.push(Vs([-180,o,a,l])),i.push(Vs([s,o,180,l]))}else i.push(Vs(n));return i},[]),r=null;if(e.length===1?r={type:"Polygon",coordinates:e[0]}:e.length>1&&(r={type:"MultiPolygon",coordinates:e}),r)return{type:"Feature",geometry:r,properties:{}}}function Nt(t){if(!Array.isArray(t)||![4,6].includes(t.length)||t.some(s=>typeof s!="number"))return!1;let{west:e,east:r,south:i,north:n}=hn(t);return i<=n&&e>=-180&&e<=180&&i>=-90&&r<=180&&r>=-180&&n<=90}function xw(t){if(!Nt(t))return!1;let{west:e,east:r}=hn(t);return e>r}function Uf(t){if(!Array.isArray(t)||t.length===0)return null;let e={west:180,south:90,east:-180,north:-90};t.forEach(i=>{if(!Nt(i))return;let n=hn(i),s=["west","south"];for(let a in n){let o=s.includes(a)?Math.min:Math.max;e[a]=o(e[a],n[a])}});let r=[e.west,e.south,e.east,e.north];return Nt(r)?r:null}class kf extends Ff{constructor(e,r=null){const i={assets:er.fromAssets,item_assets:er.fromAssets};super(e,r,i)}toGeoJSON(){let e=Gf(this.getBoundingBoxes());return e&&(e.id=this.id),e}getBoundingBox(){let e=this.getRawBoundingBoxes();return e.length>0&&Nt(e[0])?e[0]:null}getBoundingBoxes(){let e=this.getRawBoundingBoxes();return e.length===1&&Nt(e[0])?e:e.length>1?e.filter((r,i)=>i>0&&Nt(r)):[]}getRawBoundingBoxes(){var r,i;let e=(i=(r=this.extent)==null?void 0:r.spatial)==null?void 0:i.bbox;return Array.isArray(e)&&e.length>0?e:[]}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){var r,i;let e=(i=(r=this.extent)==null?void 0:r.temporal)==null?void 0:i.interval;return Array.isArray(e)&&e.length>0?e.filter(n=>Array.isArray(n)&&(rt(n[0])||rt(n[1]))).map(n=>n.map(s=>vi(s))):[]}getSummary(e){return this.summaries[e]}getBands(){let e=this.getSummary("eo:bands"),r=this.getSummary("raster:bands"),i=[e,r].filter(n=>Array.isArray(n));return i.length>=2?Pf(...i):i.length===1?i[0]:[]}}class vw extends Nf{constructor(e,r=null){const i={collections:n=>n.map(s=>new kf(s))};super(e,r,i)}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map(r=>r.toGeoJSON()).filter(r=>r!==null)}}getBoundingBox(){return Uf(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map(e=>e.getBoundingBox())}getTemporalExtent(){return Df(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map(e=>e.getTemporalExtent())}}class Bf extends ln{constructor(e,r=null){super(e,r,{assets:er.fromAssets})}getObjectType(){return"Item"}toGeoJSON(){return this.toJSON()}getBoundingBox(){return Nt(this.bbox)?this.bbox:null}getBoundingBoxes(){return Nt(this.bbox)?[this.bbox]:[]}getDateTime(){let e=vi(this.properties.datetime);if(!e){let r=vi(this.properties.start_datetime),i=vi(this.properties.end_datetime);return r&&i?_w(r,i):r||i}return e}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let e=[];return rt(this.properties.start_datetime)||rt(this.properties.end_datetime)?e=[[this.properties.start_datetime||null,this.properties.end_datetime||null]]:rt(this.properties.datetime)&&(e=[[this.properties.datetime,this.properties.datetime]]),e.map(r=>r.map(i=>vi(i)))}getMetadata(e){return this.properties[e]}getBands(){let e=this.getMetadata("eo:bands");return Array.isArray(e)?e:[]}getCollectionLink(){return this.getStacLinkWithRel("collection")}}class Ew extends Nf{constructor(e,r=null){const i={features:n=>n.map(s=>new Bf(s))};super(e,r,i)}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return Uf(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map(e=>e.getBoundingBox())}getTemporalExtent(){return Df(this.getTemporalExtents())}getTemporalExtents(){return this.features.map(e=>e.getTemporalExtent())}}function ww(t,e=!0,r=!1){return e&&(t=nw.stac(t,r)),t.type==="Feature"?new Bf(t):t.type==="FeatureCollection"?new Ew(t):t.type==="Collection"||!t.type&&typeof t.extent<"u"&&typeof t.license<"u"?new kf(t):!t.type&&Array.isArray(t.collections)?new vw(t):new yw(t)}class Ql extends lo{constructor(r){super({...r,state:"loading"});Ms(this,"loadImage",r=>new Promise((i,n)=>{const s=new Image;s.addEventListener("load",()=>i(s)),s.addEventListener("error",()=>n(new Error("load failed"))),s.src=r}));const i=new Po(r.url);i.getHeader().then(n=>{this.tileGrid.minZoom=n.minZoom,this.tileGrid.maxZoom=n.maxZoom,this.setLoader(async(s,a,o)=>{const l=await i.getZxy(s,a,o),h=URL.createObjectURL(new Blob([l.data])),u=await this.loadImage(h);return URL.revokeObjectURL(h),u}),this.setState("ready")})}}class Tw extends hs{constructor(r){super({...r,state:"loading",url:"pmtiles://"+r.url+"/{z}/{x}/{y}",format:new Ec});Ms(this,"tileLoadFunction",(r,i)=>{const n=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=i.match(n),a=+s[2],o=+s[3],l=+s[4];r.setLoader((h,u,c)=>{r.setState(Q.LOADING),this.pmtiles_.getZxy(a,o,l).then(d=>{if(d){const g=r.getFormat();r.setFeatures(g.readFeatures(d.data,{extent:h,featureProjection:c})),r.setState(Q.LOADED)}else r.setFeatures([]),r.setState(Q.EMPTY)}).catch(d=>{r.setFeatures([]),r.setState(Q.ERROR)})})});this.pmtiles_=new Po(r.url),this.pmtiles_.getHeader().then(i=>{this.tileGrid.minZoom=i.minZoom,this.tileGrid.maxZoom=i.maxZoom,this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}}let Fo=null;function Sw(){return!!Fo}function zf(t){Fo=t;const e=Object.keys(t.defs),r=e.length;let i,n;for(i=0;i<r;++i){const s=e[i];if(!de(s)){const a=t.defs(s);let o=a.units;!o&&a.projName==="longlat"&&(o="degrees"),Mg(new ea({code:s,axisOrientation:a.axis,metersPerUnit:a.to_meter,units:o}))}}for(i=0;i<r;++i){const s=e[i],a=de(s);for(n=0;n<r;++n){const o=e[n],l=de(o);if(!bg(s,o))if(t.defs[s]===t.defs[o])Rg([a,l]);else{const h=t(s,o);Pg(a,l,Yo(a,l,h.forward),Yo(l,a,h.inverse))}}}}let Mw=async function(t){const e=await fetch(`https://epsg.io/${t}.proj4`);if(!e.ok)throw new Error(`Unexpected response from epsg.io: ${e.status}`);return e.text()};async function bw(t){typeof t=="string"&&(t=parseInt(t.split(":").pop(),10));const e=Fo;if(!e)throw new Error("Proj4 must be registered first with register(proj4)");const r="EPSG:"+t;return e.defs(r)?de(r):(e.defs(r,await Mw(t)),zf(e),de(r))}const Rw=new Di({fill:new Ys({color:"rgba(255,255,255,0.4)"}),stroke:new zi({color:"#3399CC",width:3})}),Pw=new Di({stroke:new zi({color:"#ff9933",width:1})});function Aw(t,e){const r={url:t.getAbsoluteUrl()};let i=null;t.getBands().length===1&&(i=0);const{minimum:n,maximum:s}=t.getMinMaxValues(i);typeof n=="number"&&(r.min=n),typeof s=="number"&&(r.max=s);const a=t.getNoDataValues(i);return a.length>0&&(r.nodata=a[0]),e.length>0&&(r.bands=e),r}async function Jl(t,e=void 0){let r=e;if(Sw()){const i=t.getMetadata("proj:epsg");if(i)try{r=await bw(i)}catch{}}return r}function eh(t,e){const r=t.clone();return e.hasOnlyBounds()||r.setFill(null),r}function Iw(t){let e=t.href;if(e.includes("{s}"))if(Array.isArray(t["href:servers"])&&t["href:servers"].length>0){const r=Math.random()*t["href:servers"].length|0;e=e.replace("{s}",t["href:servers"][r])}else return null;return e}async function Lw(t){try{const e=new URL(t);e.searchParams.set("service","wmts"),e.searchParams.set("request","GetCapabilities");const r=await fetch(e);return new lu().read(await r.text())}catch{return null}}let Cw=class $f extends Oc{constructor(e){const r={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(i=>r[i]=e[i]),super(r),this.getSourceOptions_=e.getSourceOptions,this.data_,this.assets_=null,this.bands_=[],this.crossOrigin_=e.crossOrigin||null,this.displayFootprint_=e.displayFootprint!==!1,this.displayGeoTiffByDefault_=!!e.displayGeoTiffByDefault,this.displayPreview_=!!e.displayPreview,this.displayOverview_=e.displayOverview!==!1,this.displayWebMapLink_=e.displayWebMapLink||!1,this.buildTileUrlTemplate_=e.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=e.useTileLayerAsFallback||!1,this.boundsStyle_=e.boundsStyle||Rw,this.collectionStyle_=e.collectionStyle||Pw,this.boundsLayer_=null,e.data){try{this.configure_(e.data,e.url,e.assets,e.bands)}catch(i){this.handleError_(i)}return}if(!e.url)throw new Error("Either url or data must be provided");fetch(e.url).then(i=>i.json()).then(i=>this.configure_(i,e.url,e.assets,e.bands)).catch(i=>this.handleError_(i))}getBoundsLayer(){return this.boundsLayer_}handleError_(e){this.dispatchEvent(new ew(e))}configure_(e,r=null,i=null,n=[]){e instanceof er||e instanceof ln?this.data_=e:this.data_=ww(e),r&&r.includes("://")&&this.data_.setAbsoluteUrl(r),this.bands_=n,this.boundsLayer_=this.addFootprint_();const s=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(eh(this.boundsStyle_,this))};this.getLayers().on("add",s),this.getLayers().on("remove",s),this.setAssets(i).then(()=>this.dispatchEvent("assetsready")).catch(a=>this.handleError_(a)),this.dispatchEvent("sourceready")}async addApiCollection_(){const e=this.getData().getAll().map(r=>{const i=new $f({data:r,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_});return this.addLayer_(i),i});return await Promise.all(e)}async addStacAssets_(){let e=this.getAssets();if(e===null){e=[];const i=this.getData().getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);if(i)e.push(i);else{const n=this.getData().getThumbnails();n.length>0&&e.push(n[0])}}const r=e.map(i=>this.addImagery_(i));return await Promise.all(r)}async addImagery_(e){if(e){if(e.isGeoTIFF())return await this.addGeoTiff_(e);if(e.canBrowserDisplayImage())return await this.addThumbnail_(e)}}async addThumbnail_(e){if(!this.displayPreview_)return;let r={url:e.getAbsoluteUrl(),projection:await Jl(e,"EPSG:4326"),imageExtent:e.getContext().getBoundingBox(),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(r=await this.getSourceOptions_(Re.ImageStatic,r,e));const i=new Oa({source:new nf(r)});return this.addLayer_(i,e),i}async addWebMapLinks_(){const e=this.getWebMapLinks();if(e.length>0)return await this.addLayerForLink(e[0])}async addLayerForLink(e){const r=Iw(e);if(!r)return;const i={attributions:e.getMetadata("attribution")||this.data_.getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:r},n=async(a,o)=>(this.getSourceOptions_&&(o=await this.getSourceOptions_(a,o,e)),o),s=[];switch(e.rel){case"pmtiles":const o=await new Po(i.url).getHeader();let l;switch(o.tileType){case Ir.Mvt:l=new Tw(await n(Re.PMTilesVector,i));break;case Ir.Avif:case Ir.Jpeg:case Ir.Png:case Ir.Webp:l=new Ql(await n(Re.PMTilesRaster,i));break;default:return}s.push(l);break;case"tilejson":s.push(new uf(await n(Re.TileJSON,i)));break;case"wms":if(!Array.isArray(e["wms:layers"]))break;for(const c in e["wms:layers"]){const d=e["wms:layers"][c];let g;Array.isArray(e["wms:styles"])&&typeof e["wms:styles"][c]=="string"&&(g=e["wms:styles"][c]);const p=Object.assign({LAYERS:d,STYLES:g},e["wms:dimensions"]);typeof e["wms:transparent"]=="boolean"&&(p.TRANSPARENT=String(e["wms:transparent"])),typeof e.type=="string"&&e.type.startsWith("image/")&&(p.FORMAT=e.type);const y=await n(Re.TileWMS,Object.assign({},i,{params:p}));s.push(new Bc(y))}break;case"wmts":const h=await Lw(r);if(!h)return;const u=Array.isArray(e["wmts:layer"])?e["wmts:layer"]:[e["wmts:layer"]];for(const c of u){let d=Object.assign({},i,{layer:c});typeof e.type=="string"&&e.type.startsWith("image/")&&(d.format=e.type),d=await n(Re.WMTS,d),s.push(new zc(Ag(h,d)))}break;case"xyz":s.push(new Yr(await n(Re.XYZ,i)));break;default:return}return s.map(a=>{let o;return a instanceof hs?o=new Nc({source:a,declutter:!0}):a instanceof Ql?o=new ca({source:a}):o=new Bn({source:a}),this.addLayer_(o,e),o})}async addGeoTiff_(e){if(!this.displayOverview_)return;if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);let i={sources:[Aw(e,this.bands_)]};const n=await Jl(e);n&&(i.projection=n),this.getSourceOptions_&&(i=await this.getSourceOptions_(Re.GeoTIFF,i,e));const s=async(a,o)=>(o&&this.getLayers().remove(o),await this.addTileLayerForImagery_(a));try{const a=new tw(i),o=new ca({source:a});if(this.useTileLayerAsFallback_){const l=()=>s(e,o);a.on("error",l),a.on("tileloaderror",l),a.on("change",()=>{a.getState()==="error"&&s(e,o)}),o.on("error",l),await a.getView()}return this.addLayer_(o,e),o}catch(a){if(this.useTileLayerAsFallback_)return await s(e,null);this.handleError_(a)}}async addTileLayerForImagery_(e){let r={crossOrigin:this.crossOrigin_,url:this.buildTileUrlTemplate_(e)};this.getSourceOptions_&&(r=await this.getSourceOptions_(Re.XYZ,r,e));const i=new Bn({source:new Yr(r)});return this.addLayer_(i,e),i}addLayer_(e,r,i=0){e.set("stac",r),e.setZIndex(i),this.getLayers().push(e)}addFootprint_(){let e=null;const r=this.getData();if(r.isItemCollection()||r.isCollectionCollection()?e=Gf(r.getBoundingBox()):e=r.toGeoJSON(),e){const i=new vc,n=new as({format:i,loader:(a,o,l)=>{const h=i.readFeatures(e,{featureProjection:l});n.addFeatures(h)}}),s=new ba({source:n,style:eh(this.boundsStyle_,this),visible:this.displayFootprint_});return s.set("bounds",!0),this.addLayer_(s,r,1),s}return null}async updateLayers_(){const e=this.getLayers();for(let i=e.getLength()-1;i>=0;i--){const s=e.item(i).get("stac");s&&(s.isLink()||s.isAsset())&&e.removeAt(i)}const r=this.getData();r.isItemCollection()||r.isCollectionCollection()?await this.addApiCollection_():(r.isItem()||r.isCollection())&&await this.addStacAssets_(),this.displayWebMapLink_&&this.hasOnlyBounds()&&await this.addWebMapLinks_()}hasOnlyBounds(){const e=this.getBoundsLayer();return typeof this.getLayersArray().find(i=>i!==e)>"u"}getWebMapLinks(){let e=["xyz","tilejson","pmtiles","wmts","wms"];typeof this.displayWebMapLink_=="string"&&(e=[this.displayWebMapLink_]);const r=this.data_.getLinksWithRels(e);return r.sort((i,n)=>{const s=e.indexOf(i.rel),a=e.indexOf(n.rel);return s-a}),r}async setAssets(e){Array.isArray(e)?this.assets_=e.map(r=>typeof r=="string"?this.getData().getAsset(r):r instanceof er?r:new er(r)):this.assets_=null,await this.updateLayers_()}getData(){return this.data_}getAssets(){return this.assets_}getExtent(){if(!this.boundsLayer_)return;const e=this.boundsLayer_.getMapInternal();if(!e)return;const r=e.getView();if(!r)return;const i=this.getData();if(!i)return;const n=i.getBoundingBox();if(n)return Ig(n,"EPSG:4326",r.getProjection())}};function Ow(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}var xr=1,vr=2,Vr=3,Nw=4,xa=5,th=6378137,Fw=6356752314e-3,rh=.0066943799901413165,ki=484813681109536e-20,G=Math.PI/2,Dw=.16666666666666666,Gw=.04722222222222222,Uw=.022156084656084655,j=1e-10,je=.017453292519943295,Lt=57.29577951308232,we=Math.PI/4,Yi=Math.PI*2,Fe=3.14159265359,st={};st.greenwich=0;st.lisbon=-9.131906111111;st.paris=2.337229166667;st.bogota=-74.080916666667;st.madrid=-3.687938888889;st.rome=12.452333333333;st.bern=7.439583333333;st.jakarta=106.807719444444;st.ferro=-17.666666666667;st.brussels=4.367975;st.stockholm=18.058277777778;st.athens=23.7163375;st.oslo=10.722916666667;const kw={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var ih=/[\s_\-\/\(\)]/g;function nr(t,e){if(t[e])return t[e];for(var r=Object.keys(t),i=e.toLowerCase().replace(ih,""),n=-1,s,a;++n<r.length;)if(s=r[n],a=s.toLowerCase().replace(ih,""),a===i)return t[s]}function va(t){var e={},r=t.split("+").map(function(o){return o.trim()}).filter(function(o){return o}).reduce(function(o,l){var h=l.split("=");return h.push(!0),o[h[0].toLowerCase()]=h[1],o},{}),i,n,s,a={proj:"projName",datum:"datumCode",rf:function(o){e.rf=parseFloat(o)},lat_0:function(o){e.lat0=o*je},lat_1:function(o){e.lat1=o*je},lat_2:function(o){e.lat2=o*je},lat_ts:function(o){e.lat_ts=o*je},lon_0:function(o){e.long0=o*je},lon_1:function(o){e.long1=o*je},lon_2:function(o){e.long2=o*je},alpha:function(o){e.alpha=parseFloat(o)*je},gamma:function(o){e.rectified_grid_angle=parseFloat(o)},lonc:function(o){e.longc=o*je},x_0:function(o){e.x0=parseFloat(o)},y_0:function(o){e.y0=parseFloat(o)},k_0:function(o){e.k0=parseFloat(o)},k:function(o){e.k0=parseFloat(o)},a:function(o){e.a=parseFloat(o)},b:function(o){e.b=parseFloat(o)},r_a:function(){e.R_A=!0},zone:function(o){e.zone=parseInt(o,10)},south:function(){e.utmSouth=!0},towgs84:function(o){e.datum_params=o.split(",").map(function(l){return parseFloat(l)})},to_meter:function(o){e.to_meter=parseFloat(o)},units:function(o){e.units=o;var l=nr(kw,o);l&&(e.to_meter=l.to_meter)},from_greenwich:function(o){e.from_greenwich=o*je},pm:function(o){var l=nr(st,o);e.from_greenwich=(l||parseFloat(o))*je},nadgrids:function(o){o==="@null"?e.datumCode="none":e.nadgrids=o},axis:function(o){var l="ewnsud";o.length===3&&l.indexOf(o.substr(0,1))!==-1&&l.indexOf(o.substr(1,1))!==-1&&l.indexOf(o.substr(2,1))!==-1&&(e.axis=o)},approx:function(){e.approx=!0}};for(i in r)n=r[i],i in a?(s=a[i],typeof s=="function"?s(n):e[s]=n):e[i]=n;return typeof e.datumCode=="string"&&e.datumCode!=="WGS84"&&(e.datumCode=e.datumCode.toLowerCase()),e}var Ki=1,jf=2,qf=3,Qn=4,Zf=5,Do=-1,Bw=/\s/,zw=/[A-Za-z]/,$w=/[A-Za-z84_]/,ws=/[,\]]/,Vf=/[\d\.E\-\+]/;function Wt(t){if(typeof t!="string")throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Ki}Wt.prototype.readCharicter=function(){var t=this.text[this.place++];if(this.state!==Qn)for(;Bw.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case Ki:return this.neutral(t);case jf:return this.keyword(t);case Qn:return this.quoted(t);case Zf:return this.afterquote(t);case qf:return this.number(t);case Do:return}};Wt.prototype.afterquote=function(t){if(t==='"'){this.word+='"',this.state=Qn;return}if(ws.test(t)){this.word=this.word.trim(),this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in afterquote yet, index '+this.place)};Wt.prototype.afterItem=function(t){if(t===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=Ki;return}if(t==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Ki,this.currentObject=this.stack.pop(),this.currentObject||(this.state=Do);return}};Wt.prototype.number=function(t){if(Vf.test(t)){this.word+=t;return}if(ws.test(t)){this.word=parseFloat(this.word),this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in number yet, index '+this.place)};Wt.prototype.quoted=function(t){if(t==='"'){this.state=Zf;return}this.word+=t};Wt.prototype.keyword=function(t){if($w.test(t)){this.word+=t;return}if(t==="["){var e=[];e.push(this.word),this.level++,this.root===null?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,this.state=Ki;return}if(ws.test(t)){this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in keyword yet, index '+this.place)};Wt.prototype.neutral=function(t){if(zw.test(t)){this.word=t,this.state=jf;return}if(t==='"'){this.word="",this.state=Qn;return}if(Vf.test(t)){this.word=t,this.state=qf;return}if(ws.test(t)){this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in neutral yet, index '+this.place)};Wt.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===Do)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function jw(t){var e=new Wt(t);return e.output()}function nh(t,e,r){Array.isArray(e)&&(r.unshift(e),e=null);var i=e?{}:t,n=r.reduce(function(s,a){return Br(a,s),s},i);e&&(t[e]=n)}function Br(t,e){if(!Array.isArray(t)){e[t]=!0;return}var r=t.shift();if(r==="PARAMETER"&&(r=t.shift()),t.length===1){if(Array.isArray(t[0])){e[r]={},Br(t[0],e[r]);return}e[r]=t[0];return}if(!t.length){e[r]=!0;return}if(r==="TOWGS84"){e[r]=t;return}if(r==="AXIS"){r in e||(e[r]=[]),e[r].push(t);return}Array.isArray(r)||(e[r]={});var i;switch(r){case"UNIT":case"PRIMEM":case"VERT_DATUM":e[r]={name:t[0].toLowerCase(),convert:t[1]},t.length===3&&Br(t[2],e[r]);return;case"SPHEROID":case"ELLIPSOID":e[r]={name:t[0],a:t[1],rf:t[2]},t.length===4&&Br(t[3],e[r]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":t[0]=["name",t[0]],nh(e,r,t);return;default:for(i=-1;++i<t.length;)if(!Array.isArray(t[i]))return Br(t,e[r]);return nh(e,r,t)}}var qw=.017453292519943295;function Zw(t,e){var r=e[0],i=e[1];!(r in t)&&i in t&&(t[r]=t[i],e.length===3&&(t[r]=e[2](t[r])))}function Rt(t){return t*qw}function Vw(t){if(t.type==="GEOGCS"?t.projName="longlat":t.type==="LOCAL_CS"?(t.projName="identity",t.local=!0):typeof t.PROJECTION=="object"?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var e="",r=0,i=t.AXIS.length;r<i;++r){var n=[t.AXIS[r][0].toLowerCase(),t.AXIS[r][1].toLowerCase()];n[0].indexOf("north")!==-1||(n[0]==="y"||n[0]==="lat")&&n[1]==="north"?e+="n":n[0].indexOf("south")!==-1||(n[0]==="y"||n[0]==="lat")&&n[1]==="south"?e+="s":n[0].indexOf("east")!==-1||(n[0]==="x"||n[0]==="lon")&&n[1]==="east"?e+="e":(n[0].indexOf("west")!==-1||(n[0]==="x"||n[0]==="lon")&&n[1]==="west")&&(e+="w")}e.length===2&&(e+="u"),e.length===3&&(t.axis=e)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),t.units==="metre"&&(t.units="meter"),t.UNIT.convert&&(t.type==="GEOGCS"?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var s=t.GEOGCS;t.type==="GEOGCS"&&(s=t),s&&(s.DATUM?t.datumCode=s.DATUM.name.toLowerCase():t.datumCode=s.name.toLowerCase(),t.datumCode.slice(0,2)==="d_"&&(t.datumCode=t.datumCode.slice(2)),(t.datumCode==="new_zealand_geodetic_datum_1949"||t.datumCode==="new_zealand_1949")&&(t.datumCode="nzgd49"),(t.datumCode==="wgs_1984"||t.datumCode==="world_geodetic_system_1984")&&(t.PROJECTION==="Mercator_Auxiliary_Sphere"&&(t.sphere=!0),t.datumCode="wgs84"),t.datumCode.slice(-6)==="_ferro"&&(t.datumCode=t.datumCode.slice(0,-6)),t.datumCode.slice(-8)==="_jakarta"&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),s.DATUM&&s.DATUM.SPHEROID&&(t.ellps=s.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),t.ellps.toLowerCase().slice(0,13)==="international"&&(t.ellps="intl"),t.a=s.DATUM.SPHEROID.a,t.rf=parseFloat(s.DATUM.SPHEROID.rf,10)),s.DATUM&&s.DATUM.TOWGS84&&(t.datum_params=s.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),t.datumCode==="ch1903+"&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a);function a(h){var u=t.to_meter||1;return h*u}var o=function(h){return Zw(t,h)},l=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Rt],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Rt],["x0","false_easting",a],["y0","false_northing",a],["long0","central_meridian",Rt],["lat0","latitude_of_origin",Rt],["lat0","standard_parallel_1",Rt],["lat1","standard_parallel_1",Rt],["lat2","standard_parallel_2",Rt],["azimuth","Azimuth"],["alpha","azimuth",Rt],["srsCode","name"]];l.forEach(o),!t.long0&&t.longc&&(t.projName==="Albers_Conic_Equal_Area"||t.projName==="Lambert_Azimuthal_Equal_Area")&&(t.long0=t.longc),!t.lat_ts&&t.lat1&&(t.projName==="Stereographic_South_Pole"||t.projName==="Polar Stereographic (variant B)")?(t.lat0=Rt(t.lat1>0?90:-90),t.lat_ts=t.lat1):!t.lat_ts&&t.lat0&&t.projName==="Polar_Stereographic"&&(t.lat_ts=t.lat0,t.lat0=Rt(t.lat0>0?90:-90))}function Wf(t){var e=jw(t),r=e.shift(),i=e.shift();e.unshift(["name",i]),e.unshift(["type",r]);var n={};return Br(e,n),Vw(n),n}function He(t){var e=this;if(arguments.length===2){var r=arguments[1];typeof r=="string"?r.charAt(0)==="+"?He[t]=va(arguments[1]):He[t]=Wf(arguments[1]):He[t]=r}else if(arguments.length===1){if(Array.isArray(t))return t.map(function(i){Array.isArray(i)?He.apply(e,i):He(i)});if(typeof t=="string"){if(t in He)return He[t]}else"EPSG"in t?He["EPSG:"+t.EPSG]=t:"ESRI"in t?He["ESRI:"+t.ESRI]=t:"IAU2000"in t?He["IAU2000:"+t.IAU2000]=t:console.log(t);return}}Ow(He);function Ww(t){return typeof t=="string"}function Xw(t){return t in He}var Hw=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function Yw(t){return Hw.some(function(e){return t.indexOf(e)>-1})}var Kw=["3857","900913","3785","102113"];function Qw(t){var e=nr(t,"authority");if(e){var r=nr(e,"epsg");return r&&Kw.indexOf(r)>-1}}function Jw(t){var e=nr(t,"extension");if(e)return nr(e,"proj4")}function eT(t){return t[0]==="+"}function tT(t){if(Ww(t)){if(Xw(t))return He[t];if(Yw(t)){var e=Wf(t);if(Qw(e))return He["EPSG:3857"];var r=Jw(e);return r?va(r):e}if(eT(t))return va(t)}else return t}function sh(t,e){t=t||{};var r,i;if(!e)return t;for(i in e)r=e[i],r!==void 0&&(t[i]=r);return t}function Ut(t,e,r){var i=t*e;return r/Math.sqrt(1-i*i)}function cn(t){return t<0?-1:1}function Z(t){return Math.abs(t)<=Fe?t:t-cn(t)*Yi}function Tt(t,e,r){var i=t*r,n=.5*t;return i=Math.pow((1-i)/(1+i),n),Math.tan(.5*(G-e))/i}function Qi(t,e){for(var r=.5*t,i,n,s=G-2*Math.atan(e),a=0;a<=15;a++)if(i=t*Math.sin(s),n=G-2*Math.atan(e*Math.pow((1-i)/(1+i),r))-s,s+=n,Math.abs(n)<=1e-10)return s;return-9999}function rT(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Ut(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function iT(t){var e=t.x,r=t.y;if(r*Lt>90&&r*Lt<-90&&e*Lt>180&&e*Lt<-180)return null;var i,n;if(Math.abs(Math.abs(r)-G)<=j)return null;if(this.sphere)i=this.x0+this.a*this.k0*Z(e-this.long0),n=this.y0+this.a*this.k0*Math.log(Math.tan(we+.5*r));else{var s=Math.sin(r),a=Tt(this.e,r,s);i=this.x0+this.a*this.k0*Z(e-this.long0),n=this.y0-this.a*this.k0*Math.log(a)}return t.x=i,t.y=n,t}function nT(t){var e=t.x-this.x0,r=t.y-this.y0,i,n;if(this.sphere)n=G-2*Math.atan(Math.exp(-r/(this.a*this.k0)));else{var s=Math.exp(-r/(this.a*this.k0));if(n=Qi(this.e,s),n===-9999)return null}return i=Z(this.long0+e/(this.a*this.k0)),t.x=i,t.y=n,t}var sT=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const aT={init:rT,forward:iT,inverse:nT,names:sT};function oT(){}function ah(t){return t}var lT=["longlat","identity"];const hT={init:oT,forward:ah,inverse:ah,names:lT};var cT=[aT,hT],Pn={},Jn=[];function Xf(t,e){var r=Jn.length;return t.names?(Jn[r]=t,t.names.forEach(function(i){Pn[i.toLowerCase()]=r}),this):(console.log(e),!0)}function uT(t){if(!t)return!1;var e=t.toLowerCase();if(typeof Pn[e]<"u"&&Jn[Pn[e]])return Jn[Pn[e]]}function fT(){cT.forEach(Xf)}const dT={start:fT,add:Xf,get:uT};var te={};te.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};te.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};te.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};te.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};te.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};te.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};te.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};te.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};te.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};te.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};te.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};te.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};te.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};te.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};te.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};te.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};te.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};te.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};te.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};te.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};te.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};te.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};te.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};te.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};te.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};te.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};te.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};te.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};te.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};te.hough={a:6378270,rf:297,ellipseName:"Hough"};te.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};te.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};te.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};te.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};te.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};te.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};te.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};te.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};te.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};te.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};te.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};te.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var gT=te.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};te.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function pT(t,e,r,i){var n=t*t,s=e*e,a=(n-s)/n,o=0;i?(t*=1-a*(Dw+a*(Gw+a*Uw)),n=t*t,a=0):o=Math.sqrt(a);var l=(n-s)/s;return{es:a,e:o,ep2:l}}function mT(t,e,r,i,n){if(!t){var s=nr(te,i);s||(s=gT),t=s.a,e=s.b,r=s.rf}return r&&!e&&(e=(1-1/r)*t),(r===0||Math.abs(t-e)<j)&&(n=!0,e=t),{a:t,b:e,rf:r,sphere:n}}var ke={};ke.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};ke.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};ke.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};ke.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};ke.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};ke.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};ke.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};ke.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};ke.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"};ke.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};ke.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};ke.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};ke.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};ke.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};ke.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};ke.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};ke.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};ke.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function yT(t,e,r,i,n,s,a){var o={};return t===void 0||t==="none"?o.datum_type=xa:o.datum_type=Nw,e&&(o.datum_params=e.map(parseFloat),(o.datum_params[0]!==0||o.datum_params[1]!==0||o.datum_params[2]!==0)&&(o.datum_type=xr),o.datum_params.length>3&&(o.datum_params[3]!==0||o.datum_params[4]!==0||o.datum_params[5]!==0||o.datum_params[6]!==0)&&(o.datum_type=vr,o.datum_params[3]*=ki,o.datum_params[4]*=ki,o.datum_params[5]*=ki,o.datum_params[6]=o.datum_params[6]/1e6+1)),a&&(o.datum_type=Vr,o.grids=a),o.a=r,o.b=i,o.es=n,o.ep2=s,o}var Hf={};function _T(t,e){var r=new DataView(e),i=ET(r),n=wT(r,i),s=TT(r,n,i),a={header:n,subgrids:s};return Hf[t]=a,a}function xT(t){if(t===void 0)return null;var e=t.split(",");return e.map(vT)}function vT(t){if(t.length===0)return null;var e=t[0]==="@";return e&&(t=t.slice(1)),t==="null"?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:t,mandatory:!e,grid:Hf[t]||null,isNull:!1}}function zr(t){return t/3600*Math.PI/180}function ET(t){var e=t.getInt32(8,!1);return e===11?!1:(e=t.getInt32(8,!0),e!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function wT(t,e){return{nFields:t.getInt32(8,e),nSubgridFields:t.getInt32(24,e),nSubgrids:t.getInt32(40,e),shiftType:Ea(t,56,64).trim(),fromSemiMajorAxis:t.getFloat64(120,e),fromSemiMinorAxis:t.getFloat64(136,e),toSemiMajorAxis:t.getFloat64(152,e),toSemiMinorAxis:t.getFloat64(168,e)}}function Ea(t,e,r){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(e,r)))}function TT(t,e,r){for(var i=176,n=[],s=0;s<e.nSubgrids;s++){var a=MT(t,i,r),o=bT(t,i,a,r),l=Math.round(1+(a.upperLongitude-a.lowerLongitude)/a.longitudeInterval),h=Math.round(1+(a.upperLatitude-a.lowerLatitude)/a.latitudeInterval);n.push({ll:[zr(a.lowerLongitude),zr(a.lowerLatitude)],del:[zr(a.longitudeInterval),zr(a.latitudeInterval)],lim:[l,h],count:a.gridNodeCount,cvs:ST(o)}),i+=176+a.gridNodeCount*16}return n}function ST(t){return t.map(function(e){return[zr(e.longitudeShift),zr(e.latitudeShift)]})}function MT(t,e,r){return{name:Ea(t,e+8,e+16).trim(),parent:Ea(t,e+24,e+24+8).trim(),lowerLatitude:t.getFloat64(e+72,r),upperLatitude:t.getFloat64(e+88,r),lowerLongitude:t.getFloat64(e+104,r),upperLongitude:t.getFloat64(e+120,r),latitudeInterval:t.getFloat64(e+136,r),longitudeInterval:t.getFloat64(e+152,r),gridNodeCount:t.getInt32(e+168,r)}}function bT(t,e,r,i){for(var n=e+176,s=16,a=[],o=0;o<r.gridNodeCount;o++){var l={latitudeShift:t.getFloat32(n+o*s,i),longitudeShift:t.getFloat32(n+o*s+4,i),latitudeAccuracy:t.getFloat32(n+o*s+8,i),longitudeAccuracy:t.getFloat32(n+o*s+12,i)};a.push(l)}return a}function Ft(t,e){if(!(this instanceof Ft))return new Ft(t);e=e||function(h){if(h)throw h};var r=tT(t);if(typeof r!="object"){e(t);return}var i=Ft.projections.get(r.projName);if(!i){e(t);return}if(r.datumCode&&r.datumCode!=="none"){var n=nr(ke,r.datumCode);n&&(r.datum_params=r.datum_params||(n.towgs84?n.towgs84.split(","):null),r.ellps=n.ellipse,r.datumName=n.datumName?n.datumName:r.datumCode)}r.k0=r.k0||1,r.axis=r.axis||"enu",r.ellps=r.ellps||"wgs84",r.lat1=r.lat1||r.lat0;var s=mT(r.a,r.b,r.rf,r.ellps,r.sphere),a=pT(s.a,s.b,s.rf,r.R_A),o=xT(r.nadgrids),l=r.datum||yT(r.datumCode,r.datum_params,s.a,s.b,a.es,a.ep2,o);sh(this,r),sh(this,i),this.a=s.a,this.b=s.b,this.rf=s.rf,this.sphere=s.sphere,this.es=a.es,this.e=a.e,this.ep2=a.ep2,this.datum=l,this.init(),e(null,this)}Ft.projections=dT;Ft.projections.start();function RT(t,e){return t.datum_type!==e.datum_type||t.a!==e.a||Math.abs(t.es-e.es)>5e-11?!1:t.datum_type===xr?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:t.datum_type===vr?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6]:!0}function Yf(t,e,r){var i=t.x,n=t.y,s=t.z?t.z:0,a,o,l,h;if(n<-G&&n>-1.001*G)n=-G;else if(n>G&&n<1.001*G)n=G;else{if(n<-G)return{x:-1/0,y:-1/0,z:t.z};if(n>G)return{x:1/0,y:1/0,z:t.z}}return i>Math.PI&&(i-=2*Math.PI),o=Math.sin(n),h=Math.cos(n),l=o*o,a=r/Math.sqrt(1-e*l),{x:(a+s)*h*Math.cos(i),y:(a+s)*h*Math.sin(i),z:(a*(1-e)+s)*o}}function Kf(t,e,r,i){var n=1e-12,s=n*n,a=30,o,l,h,u,c,d,g,p,y,_,v,E,w,T=t.x,M=t.y,A=t.z?t.z:0,I,C,D;if(o=Math.sqrt(T*T+M*M),l=Math.sqrt(T*T+M*M+A*A),o/r<n){if(I=0,l/r<n)return C=G,D=-i,{x:t.x,y:t.y,z:t.z}}else I=Math.atan2(M,T);h=A/l,u=o/l,c=1/Math.sqrt(1-e*(2-e)*u*u),p=u*(1-e)*c,y=h*c,w=0;do w++,g=r/Math.sqrt(1-e*y*y),D=o*p+A*y-g*(1-e*y*y),d=e*g/(g+D),c=1/Math.sqrt(1-d*(2-d)*u*u),_=u*(1-d)*c,v=h*c,E=v*p-_*y,p=_,y=v;while(E*E>s&&w<a);return C=Math.atan(v/Math.abs(_)),{x:I,y:C,z:D}}function PT(t,e,r){if(e===xr)return{x:t.x+r[0],y:t.y+r[1],z:t.z+r[2]};if(e===vr){var i=r[0],n=r[1],s=r[2],a=r[3],o=r[4],l=r[5],h=r[6];return{x:h*(t.x-l*t.y+o*t.z)+i,y:h*(l*t.x+t.y-a*t.z)+n,z:h*(-o*t.x+a*t.y+t.z)+s}}}function AT(t,e,r){if(e===xr)return{x:t.x-r[0],y:t.y-r[1],z:t.z-r[2]};if(e===vr){var i=r[0],n=r[1],s=r[2],a=r[3],o=r[4],l=r[5],h=r[6],u=(t.x-i)/h,c=(t.y-n)/h,d=(t.z-s)/h;return{x:u+l*c-o*d,y:-l*u+c+a*d,z:o*u-a*c+d}}}function Tn(t){return t===xr||t===vr}function IT(t,e,r){if(RT(t,e)||t.datum_type===xa||e.datum_type===xa)return r;var i=t.a,n=t.es;if(t.datum_type===Vr){var s=oh(t,!1,r);if(s!==0)return;i=th,n=rh}var a=e.a,o=e.b,l=e.es;if(e.datum_type===Vr&&(a=th,o=Fw,l=rh),n===l&&i===a&&!Tn(t.datum_type)&&!Tn(e.datum_type))return r;if(r=Yf(r,n,i),Tn(t.datum_type)&&(r=PT(r,t.datum_type,t.datum_params)),Tn(e.datum_type)&&(r=AT(r,e.datum_type,e.datum_params)),r=Kf(r,l,a,o),e.datum_type===Vr){var h=oh(e,!0,r);if(h!==0)return}return r}function oh(t,e,r){if(t.grids===null||t.grids.length===0)return console.log("Grid shift grids not found"),-1;var i={x:-r.x,y:r.y},n={x:Number.NaN,y:Number.NaN},s=[];e:for(var a=0;a<t.grids.length;a++){var o=t.grids[a];if(s.push(o.name),o.isNull){n=i;break}if(o.mandatory,o.grid===null){if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1;continue}for(var l=o.grid.subgrids,h=0,u=l.length;h<u;h++){var c=l[h],d=(Math.abs(c.del[1])+Math.abs(c.del[0]))/1e4,g=c.ll[0]-d,p=c.ll[1]-d,y=c.ll[0]+(c.lim[0]-1)*c.del[0]+d,_=c.ll[1]+(c.lim[1]-1)*c.del[1]+d;if(!(p>i.y||g>i.x||_<i.y||y<i.x)&&(n=LT(i,e,c),!isNaN(n.x)))break e}}return isNaN(n.x)?(console.log("Failed to find a grid shift table for location '"+-i.x*Lt+" "+i.y*Lt+" tried: '"+s+"'"),-1):(r.x=-n.x,r.y=n.y,0)}function LT(t,e,r){var i={x:Number.NaN,y:Number.NaN};if(isNaN(t.x))return i;var n={x:t.x,y:t.y};n.x-=r.ll[0],n.y-=r.ll[1],n.x=Z(n.x-Math.PI)+Math.PI;var s=lh(n,r);if(e){if(isNaN(s.x))return i;s.x=n.x-s.x,s.y=n.y-s.y;var a=9,o=1e-12,l,h;do{if(h=lh(s,r),isNaN(h.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}l={x:n.x-(h.x+s.x),y:n.y-(h.y+s.y)},s.x+=l.x,s.y+=l.y}while(a--&&Math.abs(l.x)>o&&Math.abs(l.y)>o);if(a<0)return console.log("Inverse grid shift iterator failed to converge."),i;i.x=Z(s.x+r.ll[0]),i.y=s.y+r.ll[1]}else isNaN(s.x)||(i.x=t.x+s.x,i.y=t.y+s.y);return i}function lh(t,e){var r={x:t.x/e.del[0],y:t.y/e.del[1]},i={x:Math.floor(r.x),y:Math.floor(r.y)},n={x:r.x-1*i.x,y:r.y-1*i.y},s={x:Number.NaN,y:Number.NaN},a;if(i.x<0||i.x>=e.lim[0]||i.y<0||i.y>=e.lim[1])return s;a=i.y*e.lim[0]+i.x;var o={x:e.cvs[a][0],y:e.cvs[a][1]};a++;var l={x:e.cvs[a][0],y:e.cvs[a][1]};a+=e.lim[0];var h={x:e.cvs[a][0],y:e.cvs[a][1]};a--;var u={x:e.cvs[a][0],y:e.cvs[a][1]},c=n.x*n.y,d=n.x*(1-n.y),g=(1-n.x)*(1-n.y),p=(1-n.x)*n.y;return s.x=g*o.x+d*l.x+p*u.x+c*h.x,s.y=g*o.y+d*l.y+p*u.y+c*h.y,s}function hh(t,e,r){var i=r.x,n=r.y,s=r.z||0,a,o,l,h={};for(l=0;l<3;l++)if(!(e&&l===2&&r.z===void 0))switch(l===0?(a=i,"ew".indexOf(t.axis[l])!==-1?o="x":o="y"):l===1?(a=n,"ns".indexOf(t.axis[l])!==-1?o="y":o="x"):(a=s,o="z"),t.axis[l]){case"e":h[o]=a;break;case"w":h[o]=-a;break;case"n":h[o]=a;break;case"s":h[o]=-a;break;case"u":r[o]!==void 0&&(h.z=a);break;case"d":r[o]!==void 0&&(h.z=-a);break;default:return null}return h}function Qf(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}function CT(t){ch(t.x),ch(t.y)}function ch(t){if(typeof Number.isFinite=="function"){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if(typeof t!="number"||t!==t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function OT(t,e){return(t.datum.datum_type===xr||t.datum.datum_type===vr||t.datum.datum_type===Vr)&&e.datumCode!=="WGS84"||(e.datum.datum_type===xr||e.datum.datum_type===vr||e.datum.datum_type===Vr)&&t.datumCode!=="WGS84"}function es(t,e,r,i){var n;Array.isArray(r)?r=Qf(r):r={x:r.x,y:r.y,z:r.z,m:r.m};var s=r.z!==void 0;if(CT(r),t.datum&&e.datum&&OT(t,e)&&(n=new Ft("WGS84"),r=es(t,n,r,i),t=n),i&&t.axis!=="enu"&&(r=hh(t,!1,r)),t.projName==="longlat")r={x:r.x*je,y:r.y*je,z:r.z||0};else if(t.to_meter&&(r={x:r.x*t.to_meter,y:r.y*t.to_meter,z:r.z||0}),r=t.inverse(r),!r)return;if(t.from_greenwich&&(r.x+=t.from_greenwich),r=IT(t.datum,e.datum,r),!!r)return e.from_greenwich&&(r={x:r.x-e.from_greenwich,y:r.y,z:r.z||0}),e.projName==="longlat"?r={x:r.x*Lt,y:r.y*Lt,z:r.z||0}:(r=e.forward(r),e.to_meter&&(r={x:r.x/e.to_meter,y:r.y/e.to_meter,z:r.z||0})),i&&e.axis!=="enu"?hh(e,!0,r):(r&&!s&&delete r.z,r)}var uh=Ft("WGS84");function Ws(t,e,r,i){var n,s,a;return Array.isArray(r)?(n=es(t,e,r,i)||{x:NaN,y:NaN},r.length>2?typeof t.name<"u"&&t.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"?typeof n.z=="number"?[n.x,n.y,n.z].concat(r.splice(3)):[n.x,n.y,r[2]].concat(r.splice(3)):[n.x,n.y].concat(r.splice(2)):[n.x,n.y]):(s=es(t,e,r,i),a=Object.keys(r),a.length===2||a.forEach(function(o){if(typeof t.name<"u"&&t.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"){if(o==="x"||o==="y"||o==="z")return}else if(o==="x"||o==="y")return;s[o]=r[o]}),s)}function fh(t){return t instanceof Ft?t:t.oProj?t.oProj:Ft(t)}function ft(t,e,r){t=fh(t);var i=!1,n;return typeof e>"u"?(e=t,t=uh,i=!0):(typeof e.x<"u"||Array.isArray(e))&&(r=e,e=t,t=uh,i=!0),e=fh(e),r?Ws(t,e,r):(n={forward:function(s,a){return Ws(t,e,s,a)},inverse:function(s,a){return Ws(e,t,s,a)}},i&&(n.oProj=e),n)}var dh=6,Jf="AJSAJS",ed="AFAFAF",$r=65,et=73,gt=79,Ei=86,wi=90;const NT={forward:td,inverse:FT,toPoint:rd};function td(t,e){return e=e||5,UT(DT({lat:t[1],lon:t[0]}),e)}function FT(t){var e=Go(nd(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]}function rd(t){var e=Go(nd(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function Xs(t){return t*(Math.PI/180)}function gh(t){return 180*(t/Math.PI)}function DT(t){var e=t.lat,r=t.lon,i=6378137,n=.00669438,s=.9996,a,o,l,h,u,c,d,g=Xs(e),p=Xs(r),y,_;_=Math.floor((r+180)/6)+1,r===180&&(_=60),e>=56&&e<64&&r>=3&&r<12&&(_=32),e>=72&&e<84&&(r>=0&&r<9?_=31:r>=9&&r<21?_=33:r>=21&&r<33?_=35:r>=33&&r<42&&(_=37)),a=(_-1)*6-180+3,y=Xs(a),o=n/(1-n),l=i/Math.sqrt(1-n*Math.sin(g)*Math.sin(g)),h=Math.tan(g)*Math.tan(g),u=o*Math.cos(g)*Math.cos(g),c=Math.cos(g)*(p-y),d=i*((1-n/4-3*n*n/64-5*n*n*n/256)*g-(3*n/8+3*n*n/32+45*n*n*n/1024)*Math.sin(2*g)+(15*n*n/256+45*n*n*n/1024)*Math.sin(4*g)-35*n*n*n/3072*Math.sin(6*g));var v=s*l*(c+(1-h+u)*c*c*c/6+(5-18*h+h*h+72*u-58*o)*c*c*c*c*c/120)+5e5,E=s*(d+l*Math.tan(g)*(c*c/2+(5-h+9*u+4*u*u)*c*c*c*c/24+(61-58*h+h*h+600*u-330*o)*c*c*c*c*c*c/720));return e<0&&(E+=1e7),{northing:Math.round(E),easting:Math.round(v),zoneNumber:_,zoneLetter:GT(e)}}function Go(t){var e=t.northing,r=t.easting,i=t.zoneLetter,n=t.zoneNumber;if(n<0||n>60)return null;var s=.9996,a=6378137,o=.00669438,l,h=(1-Math.sqrt(1-o))/(1+Math.sqrt(1-o)),u,c,d,g,p,y,_,v,E,w=r-5e5,T=e;i<"N"&&(T-=1e7),_=(n-1)*6-180+3,l=o/(1-o),y=T/s,v=y/(a*(1-o/4-3*o*o/64-5*o*o*o/256)),E=v+(3*h/2-27*h*h*h/32)*Math.sin(2*v)+(21*h*h/16-55*h*h*h*h/32)*Math.sin(4*v)+151*h*h*h/96*Math.sin(6*v),u=a/Math.sqrt(1-o*Math.sin(E)*Math.sin(E)),c=Math.tan(E)*Math.tan(E),d=l*Math.cos(E)*Math.cos(E),g=a*(1-o)/Math.pow(1-o*Math.sin(E)*Math.sin(E),1.5),p=w/(u*s);var M=E-u*Math.tan(E)/g*(p*p/2-(5+3*c+10*d-4*d*d-9*l)*p*p*p*p/24+(61+90*c+298*d+45*c*c-252*l-3*d*d)*p*p*p*p*p*p/720);M=gh(M);var A=(p-(1+2*c+d)*p*p*p/6+(5-2*d+28*c-3*d*d+8*l+24*c*c)*p*p*p*p*p/120)/Math.cos(E);A=_+gh(A);var I;if(t.accuracy){var C=Go({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});I={top:C.lat,right:C.lon,bottom:M,left:A}}else I={lat:M,lon:A};return I}function GT(t){var e="Z";return 84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C"),e}function UT(t,e){var r="00000"+t.easting,i="00000"+t.northing;return t.zoneNumber+t.zoneLetter+kT(t.easting,t.northing,t.zoneNumber)+r.substr(r.length-5,e)+i.substr(i.length-5,e)}function kT(t,e,r){var i=id(r),n=Math.floor(t/1e5),s=Math.floor(e/1e5)%20;return BT(n,s,i)}function id(t){var e=t%dh;return e===0&&(e=dh),e}function BT(t,e,r){var i=r-1,n=Jf.charCodeAt(i),s=ed.charCodeAt(i),a=n+t-1,o=s+e,l=!1;a>wi&&(a=a-wi+$r-1,l=!0),(a===et||n<et&&a>et||(a>et||n<et)&&l)&&a++,(a===gt||n<gt&&a>gt||(a>gt||n<gt)&&l)&&(a++,a===et&&a++),a>wi&&(a=a-wi+$r-1),o>Ei?(o=o-Ei+$r-1,l=!0):l=!1,(o===et||s<et&&o>et||(o>et||s<et)&&l)&&o++,(o===gt||s<gt&&o>gt||(o>gt||s<gt)&&l)&&(o++,o===et&&o++),o>Ei&&(o=o-Ei+$r-1);var h=String.fromCharCode(a)+String.fromCharCode(o);return h}function nd(t){if(t&&t.length===0)throw"MGRSPoint coverting from nothing";for(var e=t.length,r=null,i="",n,s=0;!/[A-Z]/.test(n=t.charAt(s));){if(s>=2)throw"MGRSPoint bad conversion from: "+t;i+=n,s++}var a=parseInt(i,10);if(s===0||s+3>e)throw"MGRSPoint bad conversion from: "+t;var o=t.charAt(s++);if(o<="A"||o==="B"||o==="Y"||o>="Z"||o==="I"||o==="O")throw"MGRSPoint zone letter "+o+" not handled: "+t;r=t.substring(s,s+=2);for(var l=id(a),h=zT(r.charAt(0),l),u=$T(r.charAt(1),l);u<jT(o);)u+=2e6;var c=e-s;if(c%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+t;var d=c/2,g=0,p=0,y,_,v,E,w;return d>0&&(y=1e5/Math.pow(10,d),_=t.substring(s,s+d),g=parseFloat(_)*y,v=t.substring(s+d),p=parseFloat(v)*y),E=g+h,w=p+u,{easting:E,northing:w,zoneLetter:o,zoneNumber:a,accuracy:y}}function zT(t,e){for(var r=Jf.charCodeAt(e-1),i=1e5,n=!1;r!==t.charCodeAt(0);){if(r++,r===et&&r++,r===gt&&r++,r>wi){if(n)throw"Bad character: "+t;r=$r,n=!0}i+=1e5}return i}function $T(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var r=ed.charCodeAt(e-1),i=0,n=!1;r!==t.charCodeAt(0);){if(r++,r===et&&r++,r===gt&&r++,r>Ei){if(n)throw"Bad character: "+t;r=$r,n=!0}i+=1e5}return i}function jT(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}function Qr(t,e,r){if(!(this instanceof Qr))return new Qr(t,e,r);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if(typeof t=="object")this.x=t.x,this.y=t.y,this.z=t.z||0;else if(typeof t=="string"&&typeof e>"u"){var i=t.split(",");this.x=parseFloat(i[0],10),this.y=parseFloat(i[1],10),this.z=parseFloat(i[2],10)||0}else this.x=t,this.y=e,this.z=r||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Qr.fromMGRS=function(t){return new Qr(rd(t))};Qr.prototype.toMGRS=function(t){return td([this.x,this.y],t)};var qT=1,ZT=.25,ph=.046875,mh=.01953125,yh=.01068115234375,VT=.75,WT=.46875,XT=.013020833333333334,HT=.007120768229166667,YT=.3645833333333333,KT=.005696614583333333,QT=.3076171875;function sd(t){var e=[];e[0]=qT-t*(ZT+t*(ph+t*(mh+t*yh))),e[1]=t*(VT-t*(ph+t*(mh+t*yh)));var r=t*t;return e[2]=r*(WT-t*(XT+t*HT)),r*=t,e[3]=r*(YT-t*KT),e[4]=r*t*QT,e}function Ts(t,e,r,i){return r*=e,e*=e,i[0]*t-r*(i[1]+e*(i[2]+e*(i[3]+e*i[4])))}var JT=20;function ad(t,e,r){for(var i=1/(1-e),n=t,s=JT;s;--s){var a=Math.sin(n),o=1-e*a*a;if(o=(Ts(n,a,Math.cos(n),r)-t)*(o*Math.sqrt(o))*i,n-=o,Math.abs(o)<j)return n}return n}function eS(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=sd(this.es),this.ml0=Ts(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function tS(t){var e=t.x,r=t.y,i=Z(e-this.long0),n,s,a,o=Math.sin(r),l=Math.cos(r);if(this.es){var u=l*i,c=Math.pow(u,2),d=this.ep2*Math.pow(l,2),g=Math.pow(d,2),p=Math.abs(l)>j?Math.tan(r):0,y=Math.pow(p,2),_=Math.pow(y,2);n=1-this.es*Math.pow(o,2),u=u/Math.sqrt(n);var v=Ts(r,o,l,this.en);s=this.a*(this.k0*u*(1+c/6*(1-y+d+c/20*(5-18*y+_+14*d-58*y*d+c/42*(61+179*_-_*y-479*y)))))+this.x0,a=this.a*(this.k0*(v-this.ml0+o*i*u/2*(1+c/12*(5-y+9*d+4*g+c/30*(61+_-58*y+270*d-330*y*d+c/56*(1385+543*_-_*y-3111*y))))))+this.y0}else{var h=l*Math.sin(i);if(Math.abs(Math.abs(h)-1)<j)return 93;if(s=.5*this.a*this.k0*Math.log((1+h)/(1-h))+this.x0,a=l*Math.cos(i)/Math.sqrt(1-Math.pow(h,2)),h=Math.abs(a),h>=1){if(h-1>j)return 93;a=0}else a=Math.acos(a);r<0&&(a=-a),a=this.a*this.k0*(a-this.lat0)+this.y0}return t.x=s,t.y=a,t}function rS(t){var e,r,i,n,s=(t.x-this.x0)*(1/this.a),a=(t.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+a/this.k0,r=ad(e,this.es,this.en),Math.abs(r)<G){var c=Math.sin(r),d=Math.cos(r),g=Math.abs(d)>j?Math.tan(r):0,p=this.ep2*Math.pow(d,2),y=Math.pow(p,2),_=Math.pow(g,2),v=Math.pow(_,2);e=1-this.es*Math.pow(c,2);var E=s*Math.sqrt(e)/this.k0,w=Math.pow(E,2);e=e*g,i=r-e*w/(1-this.es)*.5*(1-w/12*(5+3*_-9*p*_+p-4*y-w/30*(61+90*_-252*p*_+45*v+46*p-w/56*(1385+3633*_+4095*v+1574*v*_)))),n=Z(this.long0+E*(1-w/6*(1+2*_+p-w/20*(5+28*_+24*v+8*p*_+6*p-w/42*(61+662*_+1320*v+720*v*_))))/d)}else i=G*cn(a),n=0;else{var o=Math.exp(s/this.k0),l=.5*(o-1/o),h=this.lat0+a/this.k0,u=Math.cos(h);e=Math.sqrt((1-Math.pow(u,2))/(1+Math.pow(l,2))),i=Math.asin(e),a<0&&(i=-i),l===0&&u===0?n=0:n=Z(Math.atan2(l,u)+this.long0)}return t.x=n,t.y=i,t}var iS=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const An={init:eS,forward:tS,inverse:rS,names:iS};function od(t){var e=Math.exp(t);return e=(e-1/e)/2,e}function pt(t,e){t=Math.abs(t),e=Math.abs(e);var r=Math.max(t,e),i=Math.min(t,e)/(r||1);return r*Math.sqrt(1+Math.pow(i,2))}function nS(t){var e=1+t,r=e-1;return r===0?t:t*Math.log(e)/r}function sS(t){var e=Math.abs(t);return e=nS(e*(1+e/(pt(1,e)+1))),t<0?-e:e}function Uo(t,e){for(var r=2*Math.cos(2*e),i=t.length-1,n=t[i],s=0,a;--i>=0;)a=-s+r*n+t[i],s=n,n=a;return e+a*Math.sin(2*e)}function aS(t,e){for(var r=2*Math.cos(e),i=t.length-1,n=t[i],s=0,a;--i>=0;)a=-s+r*n+t[i],s=n,n=a;return Math.sin(e)*a}function oS(t){var e=Math.exp(t);return e=(e+1/e)/2,e}function ld(t,e,r){for(var i=Math.sin(e),n=Math.cos(e),s=od(r),a=oS(r),o=2*n*a,l=-2*i*s,h=t.length-1,u=t[h],c=0,d=0,g=0,p,y;--h>=0;)p=d,y=c,d=u,c=g,u=-p+o*d-l*c+t[h],g=-y+l*d+o*c;return o=i*a,l=n*s,[o*u-l*g,o*g+l*u]}function lS(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(An.init.apply(this),this.forward=An.forward,this.inverse=An.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),r=e;this.cgb[0]=e*(2+e*(-2/3+e*(-2+e*(116/45+e*(26/45+e*(-2854/675)))))),this.cbg[0]=e*(-2+e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))),r=r*e,this.cgb[1]=r*(7/3+e*(-8/5+e*(-227/45+e*(2704/315+e*(2323/945))))),this.cbg[1]=r*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),r=r*e,this.cgb[2]=r*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=r*(-26/15+e*(34/21+e*(8/5+e*(-12686/2835)))),r=r*e,this.cgb[3]=r*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=r*(1237/630+e*(-12/5+e*(-24832/14175))),r=r*e,this.cgb[4]=r*(4174/315+e*(-144838/6237)),this.cbg[4]=r*(-734/315+e*(109598/31185)),r=r*e,this.cgb[5]=r*(601676/22275),this.cbg[5]=r*(444337/155925),r=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+r*(1/4+r*(1/64+r/256))),this.utg[0]=e*(-.5+e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=r*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=r*(13/48+e*(-3/5+e*(557/1440+e*(281/630+e*(-1983433/1935360))))),r=r*e,this.utg[2]=r*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=r*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),r=r*e,this.utg[3]=r*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=r*(49561/161280+e*(-179/168+e*(6601661/7257600))),r=r*e,this.utg[4]=r*(-4583/161280+e*(108847/3991680)),this.gtu[4]=r*(34729/80640+e*(-3418889/1995840)),r=r*e,this.utg[5]=r*(-20648693/638668800),this.gtu[5]=r*(212378941/319334400);var i=Uo(this.cbg,this.lat0);this.Zb=-this.Qn*(i+aS(this.gtu,2*i))}function hS(t){var e=Z(t.x-this.long0),r=t.y;r=Uo(this.cbg,r);var i=Math.sin(r),n=Math.cos(r),s=Math.sin(e),a=Math.cos(e);r=Math.atan2(i,a*n),e=Math.atan2(s*n,pt(i,n*a)),e=sS(Math.tan(e));var o=ld(this.gtu,2*r,2*e);r=r+o[0],e=e+o[1];var l,h;return Math.abs(e)<=2.623395162778?(l=this.a*(this.Qn*e)+this.x0,h=this.a*(this.Qn*r+this.Zb)+this.y0):(l=1/0,h=1/0),t.x=l,t.y=h,t}function cS(t){var e=(t.x-this.x0)*(1/this.a),r=(t.y-this.y0)*(1/this.a);r=(r-this.Zb)/this.Qn,e=e/this.Qn;var i,n;if(Math.abs(e)<=2.623395162778){var s=ld(this.utg,2*r,2*e);r=r+s[0],e=e+s[1],e=Math.atan(od(e));var a=Math.sin(r),o=Math.cos(r),l=Math.sin(e),h=Math.cos(e);r=Math.atan2(a*h,pt(l,h*o)),e=Math.atan2(l,h*o),i=Z(e+this.long0),n=Uo(this.cgb,r)}else i=1/0,n=1/0;return t.x=i,t.y=n,t}var uS=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const In={init:lS,forward:hS,inverse:cS,names:uS};function fS(t,e){if(t===void 0){if(t=Math.floor((Z(e)+Math.PI)*30/Math.PI)+1,t<0)return 0;if(t>60)return 60}return t}var dS="etmerc";function gS(){var t=fS(this.zone,this.long0);if(t===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*je,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,In.init.apply(this),this.forward=In.forward,this.inverse=In.inverse}var pS=["Universal Transverse Mercator System","utm"];const mS={init:gS,names:pS,dependsOn:dS};function ko(t,e){return Math.pow((1-t)/(1+t),e)}var yS=20;function _S(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+we)/(Math.pow(Math.tan(.5*this.lat0+we),this.C)*ko(this.e*t,this.ratexp))}function xS(t){var e=t.x,r=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*r+we),this.C)*ko(this.e*Math.sin(r),this.ratexp))-G,t.x=this.C*e,t}function vS(t){for(var e=1e-14,r=t.x/this.C,i=t.y,n=Math.pow(Math.tan(.5*i+we)/this.K,1/this.C),s=yS;s>0&&(i=2*Math.atan(n*ko(this.e*Math.sin(t.y),-.5*this.e))-G,!(Math.abs(i-t.y)<e));--s)t.y=i;return s?(t.x=r,t.y=i,t):null}var ES=["gauss"];const Bo={init:_S,forward:xS,inverse:vS,names:ES};function wS(){Bo.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function TS(t){var e,r,i,n;return t.x=Z(t.x-this.long0),Bo.forward.apply(this,[t]),e=Math.sin(t.y),r=Math.cos(t.y),i=Math.cos(t.x),n=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*r*i),t.x=n*r*Math.sin(t.x),t.y=n*(this.cosc0*e-this.sinc0*r*i),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function SS(t){var e,r,i,n,s;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,s=pt(t.x,t.y)){var a=2*Math.atan2(s,this.R2);e=Math.sin(a),r=Math.cos(a),n=Math.asin(r*this.sinc0+t.y*e*this.cosc0/s),i=Math.atan2(t.x*e,s*this.cosc0*r-t.y*this.sinc0*e)}else n=this.phic0,i=0;return t.x=i,t.y=n,Bo.inverse.apply(this,[t]),t.x=Z(t.x+this.long0),t}var MS=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const bS={init:wS,forward:TS,inverse:SS,names:MS};function RS(t,e,r){return e*=r,Math.tan(.5*(G+t))*Math.pow((1-e)/(1+e),.5*r)}function PS(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=j&&(this.k0=.5*(1+cn(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=j&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=j&&Math.abs(Math.cos(this.lat_ts))>j&&(this.k0=.5*this.cons*Ut(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Tt(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Ut(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-G,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function AS(t){var e=t.x,r=t.y,i=Math.sin(r),n=Math.cos(r),s,a,o,l,h,u,c=Z(e-this.long0);return Math.abs(Math.abs(e-this.long0)-Math.PI)<=j&&Math.abs(r+this.lat0)<=j?(t.x=NaN,t.y=NaN,t):this.sphere?(s=2*this.k0/(1+this.sinlat0*i+this.coslat0*n*Math.cos(c)),t.x=this.a*s*n*Math.sin(c)+this.x0,t.y=this.a*s*(this.coslat0*i-this.sinlat0*n*Math.cos(c))+this.y0,t):(a=2*Math.atan(this.ssfn_(r,i,this.e))-G,l=Math.cos(a),o=Math.sin(a),Math.abs(this.coslat0)<=j?(h=Tt(this.e,r*this.con,this.con*i),u=2*this.a*this.k0*h/this.cons,t.x=this.x0+u*Math.sin(e-this.long0),t.y=this.y0-this.con*u*Math.cos(e-this.long0),t):(Math.abs(this.sinlat0)<j?(s=2*this.a*this.k0/(1+l*Math.cos(c)),t.y=s*o):(s=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*o+this.cosX0*l*Math.cos(c))),t.y=s*(this.cosX0*o-this.sinX0*l*Math.cos(c))+this.y0),t.x=s*l*Math.sin(c)+this.x0,t))}function IS(t){t.x-=this.x0,t.y-=this.y0;var e,r,i,n,s,a=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var o=2*Math.atan(a/(2*this.a*this.k0));return e=this.long0,r=this.lat0,a<=j?(t.x=e,t.y=r,t):(r=Math.asin(Math.cos(o)*this.sinlat0+t.y*Math.sin(o)*this.coslat0/a),Math.abs(this.coslat0)<j?this.lat0>0?e=Z(this.long0+Math.atan2(t.x,-1*t.y)):e=Z(this.long0+Math.atan2(t.x,t.y)):e=Z(this.long0+Math.atan2(t.x*Math.sin(o),a*this.coslat0*Math.cos(o)-t.y*this.sinlat0*Math.sin(o))),t.x=e,t.y=r,t)}else if(Math.abs(this.coslat0)<=j){if(a<=j)return r=this.lat0,e=this.long0,t.x=e,t.y=r,t;t.x*=this.con,t.y*=this.con,i=a*this.cons/(2*this.a*this.k0),r=this.con*Qi(this.e,i),e=this.con*Z(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else n=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,a<=j?s=this.X0:(s=Math.asin(Math.cos(n)*this.sinX0+t.y*Math.sin(n)*this.cosX0/a),e=Z(this.long0+Math.atan2(t.x*Math.sin(n),a*this.cosX0*Math.cos(n)-t.y*this.sinX0*Math.sin(n)))),r=-1*Qi(this.e,Math.tan(.5*(G+s)));return t.x=e,t.y=r,t}var LS=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const CS={init:PS,forward:AS,inverse:IS,names:LS,ssfn_:RS};function OS(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),r=this.a,i=this.rf,n=1/i,s=2*n-Math.pow(n,2),a=this.e=Math.sqrt(s);this.R=this.k0*r*Math.sqrt(1-s)/(1-s*Math.pow(e,2)),this.alpha=Math.sqrt(1+s/(1-s)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),l=Math.log(Math.tan(Math.PI/4+t/2)),h=Math.log((1+a*e)/(1-a*e));this.K=o-this.alpha*l+this.alpha*a/2*h}function NS(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),r=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),i=-this.alpha*(e+r)+this.K,n=2*(Math.atan(Math.exp(i))-Math.PI/4),s=this.alpha*(t.x-this.lambda0),a=Math.atan(Math.sin(s)/(Math.sin(this.b0)*Math.tan(n)+Math.cos(this.b0)*Math.cos(s))),o=Math.asin(Math.cos(this.b0)*Math.sin(n)-Math.sin(this.b0)*Math.cos(n)*Math.cos(s));return t.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,t.x=this.R*a+this.x0,t}function FS(t){for(var e=t.x-this.x0,r=t.y-this.y0,i=e/this.R,n=2*(Math.atan(Math.exp(r/this.R))-Math.PI/4),s=Math.asin(Math.cos(this.b0)*Math.sin(n)+Math.sin(this.b0)*Math.cos(n)*Math.cos(i)),a=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(n))),o=this.lambda0+a/this.alpha,l=0,h=s,u=-1e3,c=0;Math.abs(h-u)>1e-7;){if(++c>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+s/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),u=h,h=2*Math.atan(Math.exp(l))-Math.PI/2}return t.x=o,t.y=h,t}var DS=["somerc"];const GS={init:OS,forward:NS,inverse:FS,names:DS};var Cr=1e-7;function US(t){var e=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],r=typeof t.PROJECTION=="object"?Object.keys(t.PROJECTION)[0]:t.PROJECTION;return"no_uoff"in t||"no_off"in t||e.indexOf(r)!==-1}function kS(){var t,e,r,i,n,s,a,o,l,h,u=0,c,d=0,g=0,p=0,y=0,_=0,v=0;this.no_off=US(this),this.no_rot="no_rot"in this;var E=!1;"alpha"in this&&(E=!0);var w=!1;if("rectified_grid_angle"in this&&(w=!0),E&&(v=this.alpha),w&&(u=this.rectified_grid_angle*je),E||w)d=this.longc;else if(g=this.long1,y=this.lat1,p=this.long2,_=this.lat2,Math.abs(y-_)<=Cr||(t=Math.abs(y))<=Cr||Math.abs(t-G)<=Cr||Math.abs(Math.abs(this.lat0)-G)<=Cr||Math.abs(Math.abs(_)-G)<=Cr)throw new Error;var T=1-this.es;e=Math.sqrt(T),Math.abs(this.lat0)>j?(o=Math.sin(this.lat0),r=Math.cos(this.lat0),t=1-this.es*o*o,this.B=r*r,this.B=Math.sqrt(1+this.es*this.B*this.B/T),this.A=this.B*this.k0*e/t,i=this.B*e/(r*Math.sqrt(t)),n=i*i-1,n<=0?n=0:(n=Math.sqrt(n),this.lat0<0&&(n=-n)),this.E=n+=i,this.E*=Math.pow(Tt(this.e,this.lat0,o),this.B)):(this.B=1/e,this.A=this.k0,this.E=i=n=1),E||w?(E?(c=Math.asin(Math.sin(v)/i),w||(u=v)):(c=u,v=Math.asin(i*Math.sin(c))),this.lam0=d-Math.asin(.5*(n-1/n)*Math.tan(c))/this.B):(s=Math.pow(Tt(this.e,y,Math.sin(y)),this.B),a=Math.pow(Tt(this.e,_,Math.sin(_)),this.B),n=this.E/s,l=(a-s)/(a+s),h=this.E*this.E,h=(h-a*s)/(h+a*s),t=g-p,t<-Math.pi?p-=Yi:t>Math.pi&&(p+=Yi),this.lam0=Z(.5*(g+p)-Math.atan(h*Math.tan(.5*this.B*(g-p))/l)/this.B),c=Math.atan(2*Math.sin(this.B*Z(g-this.lam0))/(n-1/n)),u=v=Math.asin(i*Math.sin(c))),this.singam=Math.sin(c),this.cosgam=Math.cos(c),this.sinrot=Math.sin(u),this.cosrot=Math.cos(u),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(i*i-1)/Math.cos(v))),this.lat0<0&&(this.u_0=-this.u_0)),n=.5*c,this.v_pole_n=this.ArB*Math.log(Math.tan(we-n)),this.v_pole_s=this.ArB*Math.log(Math.tan(we+n))}function BS(t){var e={},r,i,n,s,a,o,l,h;if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-G)>j){if(a=this.E/Math.pow(Tt(this.e,t.y,Math.sin(t.y)),this.B),o=1/a,r=.5*(a-o),i=.5*(a+o),s=Math.sin(this.B*t.x),n=(r*this.singam-s*this.cosgam)/i,Math.abs(Math.abs(n)-1)<j)throw new Error;h=.5*this.ArB*Math.log((1-n)/(1+n)),o=Math.cos(this.B*t.x),Math.abs(o)<Cr?l=this.A*t.x:l=this.ArB*Math.atan2(r*this.cosgam+s*this.singam,o)}else h=t.y>0?this.v_pole_n:this.v_pole_s,l=this.ArB*t.y;return this.no_rot?(e.x=l,e.y=h):(l-=this.u_0,e.x=h*this.cosrot+l*this.sinrot,e.y=l*this.cosrot-h*this.sinrot),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function zS(t){var e,r,i,n,s,a,o,l={};if(t.x=(t.x-this.x0)*(1/this.a),t.y=(t.y-this.y0)*(1/this.a),this.no_rot?(r=t.y,e=t.x):(r=t.x*this.cosrot-t.y*this.sinrot,e=t.y*this.cosrot+t.x*this.sinrot+this.u_0),i=Math.exp(-this.BrA*r),n=.5*(i-1/i),s=.5*(i+1/i),a=Math.sin(this.BrA*e),o=(a*this.cosgam+n*this.singam)/s,Math.abs(Math.abs(o)-1)<j)l.x=0,l.y=o<0?-G:G;else{if(l.y=this.E/Math.sqrt((1+o)/(1-o)),l.y=Qi(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(n*this.cosgam-a*this.singam,Math.cos(this.BrA*e))}return l.x+=this.lam0,l}var $S=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const jS={init:kS,forward:BS,inverse:zS,names:$S};function qS(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<j)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),r=Math.cos(this.lat1),i=Ut(this.e,e,r),n=Tt(this.e,this.lat1,e),s=Math.sin(this.lat2),a=Math.cos(this.lat2),o=Ut(this.e,s,a),l=Tt(this.e,this.lat2,s),h=Tt(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>j?this.ns=Math.log(i/o)/Math.log(n/l):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=i/(this.ns*Math.pow(n,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function ZS(t){var e=t.x,r=t.y;Math.abs(2*Math.abs(r)-Math.PI)<=j&&(r=cn(r)*(G-2*j));var i=Math.abs(Math.abs(r)-G),n,s;if(i>j)n=Tt(this.e,r,Math.sin(r)),s=this.a*this.f0*Math.pow(n,this.ns);else{if(i=r*this.ns,i<=0)return null;s=0}var a=this.ns*Z(e-this.long0);return t.x=this.k0*(s*Math.sin(a))+this.x0,t.y=this.k0*(this.rh-s*Math.cos(a))+this.y0,t}function VS(t){var e,r,i,n,s,a=(t.x-this.x0)/this.k0,o=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(a*a+o*o),r=1):(e=-Math.sqrt(a*a+o*o),r=-1);var l=0;if(e!==0&&(l=Math.atan2(r*a,r*o)),e!==0||this.ns>0){if(r=1/this.ns,i=Math.pow(e/(this.a*this.f0),r),n=Qi(this.e,i),n===-9999)return null}else n=-G;return s=Z(l/this.ns+this.long0),t.x=s,t.y=n,t}var WS=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const XS={init:qS,forward:ZS,inverse:VS,names:WS};function HS(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function YS(t){var e,r,i,n,s,a,o,l=t.x,h=t.y,u=Z(l-this.long0);return e=Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.alfa*this.e/2),r=2*(Math.atan(this.k*Math.pow(Math.tan(h/2+this.s45),this.alfa)/e)-this.s45),i=-u*this.alfa,n=Math.asin(Math.cos(this.ad)*Math.sin(r)+Math.sin(this.ad)*Math.cos(r)*Math.cos(i)),s=Math.asin(Math.cos(r)*Math.sin(i)/Math.cos(n)),a=this.n*s,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(n/2+this.s45),this.n),t.y=o*Math.cos(a)/1,t.x=o*Math.sin(a)/1,this.czech||(t.y*=-1,t.x*=-1),t}function KS(t){var e,r,i,n,s,a,o,l,h=t.x;t.x=t.y,t.y=h,this.czech||(t.y*=-1,t.x*=-1),a=Math.sqrt(t.x*t.x+t.y*t.y),s=Math.atan2(t.y,t.x),n=s/Math.sin(this.s0),i=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(i)-Math.sin(this.ad)*Math.cos(i)*Math.cos(n)),r=Math.asin(Math.cos(i)*Math.sin(n)/Math.cos(e)),t.x=this.long0-r/this.alfa,o=e,l=0;var u=0;do t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-t.y)<1e-10&&(l=1),o=t.y,u+=1;while(l===0&&u<15);return u>=15?null:t}var QS=["Krovak","krovak"];const JS={init:HS,forward:YS,inverse:KS,names:QS};function Ke(t,e,r,i,n){return t*n-e*Math.sin(2*n)+r*Math.sin(4*n)-i*Math.sin(6*n)}function un(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function fn(t){return .375*t*(1+.25*t*(1+.46875*t))}function dn(t){return .05859375*t*t*(1+.75*t)}function gn(t){return t*t*t*(35/3072)}function Jr(t,e,r){var i=e*r;return t/Math.sqrt(1-i*i)}function ci(t){return Math.abs(t)<G?t:t-cn(t)*Math.PI}function ts(t,e,r,i,n){var s,a;s=t/e;for(var o=0;o<15;o++)if(a=(t-(e*s-r*Math.sin(2*s)+i*Math.sin(4*s)-n*Math.sin(6*s)))/(e-2*r*Math.cos(2*s)+4*i*Math.cos(4*s)-6*n*Math.cos(6*s)),s+=a,Math.abs(a)<=1e-10)return s;return NaN}function eM(){this.sphere||(this.e0=un(this.es),this.e1=fn(this.es),this.e2=dn(this.es),this.e3=gn(this.es),this.ml0=this.a*Ke(this.e0,this.e1,this.e2,this.e3,this.lat0))}function tM(t){var e,r,i=t.x,n=t.y;if(i=Z(i-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(n)*Math.sin(i)),r=this.a*(Math.atan2(Math.tan(n),Math.cos(i))-this.lat0);else{var s=Math.sin(n),a=Math.cos(n),o=Jr(this.a,this.e,s),l=Math.tan(n)*Math.tan(n),h=i*Math.cos(n),u=h*h,c=this.es*a*a/(1-this.es),d=this.a*Ke(this.e0,this.e1,this.e2,this.e3,n);e=o*h*(1-u*l*(1/6-(8-l+8*c)*u/120)),r=d-this.ml0+o*s/a*u*(.5+(5-l+6*c)*u/24)}return t.x=e+this.x0,t.y=r+this.y0,t}function rM(t){t.x-=this.x0,t.y-=this.y0;var e=t.x/this.a,r=t.y/this.a,i,n;if(this.sphere){var s=r+this.lat0;i=Math.asin(Math.sin(s)*Math.cos(e)),n=Math.atan2(Math.tan(e),Math.cos(s))}else{var a=this.ml0/this.a+r,o=ts(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-G)<=j)return t.x=this.long0,t.y=G,r<0&&(t.y*=-1),t;var l=Jr(this.a,this.e,Math.sin(o)),h=l*l*l/this.a/this.a*(1-this.es),u=Math.pow(Math.tan(o),2),c=e*this.a/l,d=c*c;i=o-l*Math.tan(o)/h*c*c*(.5-(1+3*u)*c*c/24),n=c*(1-d*(u/3+(1+3*u)*u*d/15))/Math.cos(o)}return t.x=Z(n+this.long0),t.y=ci(i),t}var iM=["Cassini","Cassini_Soldner","cass"];const nM={init:eM,forward:tM,inverse:rM,names:iM};function tr(t,e){var r;return t>1e-7?(r=t*e,(1-t*t)*(e/(1-r*r)-.5/t*Math.log((1-r)/(1+r)))):2*e}var sM=1,aM=2,oM=3,lM=4;function hM(){var t=Math.abs(this.lat0);if(Math.abs(t-G)<j?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<j?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var e;switch(this.qp=tr(this.e,1),this.mmf=.5/(1-this.es),this.apa=_M(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=tr(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function cM(t){var e,r,i,n,s,a,o,l,h,u,c=t.x,d=t.y;if(c=Z(c-this.long0),this.sphere){if(s=Math.sin(d),u=Math.cos(d),i=Math.cos(c),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(r=this.mode===this.EQUIT?1+u*i:1+this.sinph0*s+this.cosph0*u*i,r<=j)return null;r=Math.sqrt(2/r),e=r*u*Math.sin(c),r*=this.mode===this.EQUIT?s:this.cosph0*s-this.sinph0*u*i}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),Math.abs(d+this.lat0)<j)return null;r=we-d*.5,r=2*(this.mode===this.S_POLE?Math.cos(r):Math.sin(r)),e=r*Math.sin(c),r*=i}}else{switch(o=0,l=0,h=0,i=Math.cos(c),n=Math.sin(c),s=Math.sin(d),a=tr(this.e,s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(o=a/this.qp,l=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:h=1+this.sinb1*o+this.cosb1*l*i;break;case this.EQUIT:h=1+l*i;break;case this.N_POLE:h=G+d,a=this.qp-a;break;case this.S_POLE:h=d-G,a=this.qp+a;break}if(Math.abs(h)<j)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),this.mode===this.OBLIQ?r=this.ymf*h*(this.cosb1*o-this.sinb1*l*i):r=(h=Math.sqrt(2/(1+l*i)))*o*this.ymf,e=this.xmf*h*l*n;break;case this.N_POLE:case this.S_POLE:a>=0?(e=(h=Math.sqrt(a))*n,r=i*(this.mode===this.S_POLE?h:-h)):e=r=0;break}}return t.x=this.a*e+this.x0,t.y=this.a*r+this.y0,t}function uM(t){t.x-=this.x0,t.y-=this.y0;var e=t.x/this.a,r=t.y/this.a,i,n,s,a,o,l,h;if(this.sphere){var u=0,c,d=0;if(c=Math.sqrt(e*e+r*r),n=c*.5,n>1)return null;switch(n=2*Math.asin(n),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(d=Math.sin(n),u=Math.cos(n)),this.mode){case this.EQUIT:n=Math.abs(c)<=j?0:Math.asin(r*d/c),e*=d,r=u*c;break;case this.OBLIQ:n=Math.abs(c)<=j?this.lat0:Math.asin(u*this.sinph0+r*d*this.cosph0/c),e*=d*this.cosph0,r=(u-Math.sin(n)*this.sinph0)*c;break;case this.N_POLE:r=-r,n=G-n;break;case this.S_POLE:n-=G;break}i=r===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(e,r)}else{if(h=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e/=this.dd,r*=this.dd,l=Math.sqrt(e*e+r*r),l<j)return t.x=this.long0,t.y=this.lat0,t;a=2*Math.asin(.5*l/this.rq),s=Math.cos(a),e*=a=Math.sin(a),this.mode===this.OBLIQ?(h=s*this.sinb1+r*a*this.cosb1/l,o=this.qp*h,r=l*this.cosb1*s-r*this.sinb1*a):(h=r*a/l,o=this.qp*h,r=l*s)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(r=-r),o=e*e+r*r,!o)return t.x=this.long0,t.y=this.lat0,t;h=1-o/this.qp,this.mode===this.S_POLE&&(h=-h)}i=Math.atan2(e,r),n=xM(Math.asin(h),this.apa)}return t.x=Z(this.long0+i),t.y=n,t}var fM=.3333333333333333,dM=.17222222222222222,gM=.10257936507936508,pM=.06388888888888888,mM=.0664021164021164,yM=.016415012942191543;function _M(t){var e,r=[];return r[0]=t*fM,e=t*t,r[0]+=e*dM,r[1]=e*pM,e*=t,r[0]+=e*gM,r[1]+=e*mM,r[2]=e*yM,r}function xM(t,e){var r=t+t;return t+e[0]*Math.sin(r)+e[1]*Math.sin(r+r)+e[2]*Math.sin(r+r+r)}var vM=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const EM={init:hM,forward:cM,inverse:uM,names:vM,S_POLE:sM,N_POLE:aM,EQUIT:oM,OBLIQ:lM};function sr(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}function wM(){Math.abs(this.lat1+this.lat2)<j||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Ut(this.e3,this.sin_po,this.cos_po),this.qs1=tr(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Ut(this.e3,this.sin_po,this.cos_po),this.qs2=tr(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=tr(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>j?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function TM(t){var e=t.x,r=t.y;this.sin_phi=Math.sin(r),this.cos_phi=Math.cos(r);var i=tr(this.e3,this.sin_phi),n=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,s=this.ns0*Z(e-this.long0),a=n*Math.sin(s)+this.x0,o=this.rh-n*Math.cos(s)+this.y0;return t.x=a,t.y=o,t}function SM(t){var e,r,i,n,s,a;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),i=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),i=-1),n=0,e!==0&&(n=Math.atan2(i*t.x,i*t.y)),i=e*this.ns0/this.a,this.sphere?a=Math.asin((this.c-i*i)/(2*this.ns0)):(r=(this.c-i*i)/this.ns0,a=this.phi1z(this.e3,r)),s=Z(n/this.ns0+this.long0),t.x=s,t.y=a,t}function MM(t,e){var r,i,n,s,a,o=sr(.5*e);if(t<j)return o;for(var l=t*t,h=1;h<=25;h++)if(r=Math.sin(o),i=Math.cos(o),n=t*r,s=1-n*n,a=.5*s*s/i*(e/(1-l)-r/s+.5/t*Math.log((1-n)/(1+n))),o=o+a,Math.abs(a)<=1e-7)return o;return null}var bM=["Albers_Conic_Equal_Area","Albers","aea"];const RM={init:wM,forward:TM,inverse:SM,names:bM,phi1z:MM};function PM(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function AM(t){var e,r,i,n,s,a,o,l,h=t.x,u=t.y;return i=Z(h-this.long0),e=Math.sin(u),r=Math.cos(u),n=Math.cos(i),a=this.sin_p14*e+this.cos_p14*r*n,s=1,a>0||Math.abs(a)<=j?(o=this.x0+this.a*s*r*Math.sin(i)/a,l=this.y0+this.a*s*(this.cos_p14*e-this.sin_p14*r*n)/a):(o=this.x0+this.infinity_dist*r*Math.sin(i),l=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*r*n)),t.x=o,t.y=l,t}function IM(t){var e,r,i,n,s,a;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(n=Math.atan2(e,this.rc),r=Math.sin(n),i=Math.cos(n),a=sr(i*this.sin_p14+t.y*r*this.cos_p14/e),s=Math.atan2(t.x*r,e*this.cos_p14*i-t.y*this.sin_p14*r),s=Z(this.long0+s)):(a=this.phic0,s=0),t.x=s,t.y=a,t}var LM=["gnom"];const CM={init:PM,forward:AM,inverse:IM,names:LM};function OM(t,e){var r=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-r)<1e-6)return e<0?-1*G:G;for(var i=Math.asin(.5*e),n,s,a,o,l=0;l<30;l++)if(s=Math.sin(i),a=Math.cos(i),o=t*s,n=Math.pow(1-o*o,2)/(2*a)*(e/(1-t*t)-s/(1-o*o)+.5/t*Math.log((1-o)/(1+o))),i+=n,Math.abs(n)<=1e-10)return i;return NaN}function NM(){this.sphere||(this.k0=Ut(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function FM(t){var e=t.x,r=t.y,i,n,s=Z(e-this.long0);if(this.sphere)i=this.x0+this.a*s*Math.cos(this.lat_ts),n=this.y0+this.a*Math.sin(r)/Math.cos(this.lat_ts);else{var a=tr(this.e,Math.sin(r));i=this.x0+this.a*this.k0*s,n=this.y0+this.a*a*.5/this.k0}return t.x=i,t.y=n,t}function DM(t){t.x-=this.x0,t.y-=this.y0;var e,r;return this.sphere?(e=Z(this.long0+t.x/this.a/Math.cos(this.lat_ts)),r=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(r=OM(this.e,2*t.y*this.k0/this.a),e=Z(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=r,t}var GM=["cea"];const UM={init:NM,forward:FM,inverse:DM,names:GM};function kM(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function BM(t){var e=t.x,r=t.y,i=Z(e-this.long0),n=ci(r-this.lat0);return t.x=this.x0+this.a*i*this.rc,t.y=this.y0+this.a*n,t}function zM(t){var e=t.x,r=t.y;return t.x=Z(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=ci(this.lat0+(r-this.y0)/this.a),t}var $M=["Equirectangular","Equidistant_Cylindrical","eqc"];const jM={init:kM,forward:BM,inverse:zM,names:$M};var _h=20;function qM(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=un(this.es),this.e1=fn(this.es),this.e2=dn(this.es),this.e3=gn(this.es),this.ml0=this.a*Ke(this.e0,this.e1,this.e2,this.e3,this.lat0)}function ZM(t){var e=t.x,r=t.y,i,n,s,a=Z(e-this.long0);if(s=a*Math.sin(r),this.sphere)Math.abs(r)<=j?(i=this.a*a,n=-1*this.a*this.lat0):(i=this.a*Math.sin(s)/Math.tan(r),n=this.a*(ci(r-this.lat0)+(1-Math.cos(s))/Math.tan(r)));else if(Math.abs(r)<=j)i=this.a*a,n=-1*this.ml0;else{var o=Jr(this.a,this.e,Math.sin(r))/Math.tan(r);i=o*Math.sin(s),n=this.a*Ke(this.e0,this.e1,this.e2,this.e3,r)-this.ml0+o*(1-Math.cos(s))}return t.x=i+this.x0,t.y=n+this.y0,t}function VM(t){var e,r,i,n,s,a,o,l,h;if(i=t.x-this.x0,n=t.y-this.y0,this.sphere)if(Math.abs(n+this.a*this.lat0)<=j)e=Z(i/this.a+this.long0),r=0;else{a=this.lat0+n/this.a,o=i*i/this.a/this.a+a*a,l=a;var u;for(s=_h;s;--s)if(u=Math.tan(l),h=-1*(a*(l*u+1)-l-.5*(l*l+o)*u)/((l-a)/u-1),l+=h,Math.abs(h)<=j){r=l;break}e=Z(this.long0+Math.asin(i*Math.tan(l)/this.a)/Math.sin(r))}else if(Math.abs(n+this.ml0)<=j)r=0,e=Z(this.long0+i/this.a);else{a=(this.ml0+n)/this.a,o=i*i/this.a/this.a+a*a,l=a;var c,d,g,p,y;for(s=_h;s;--s)if(y=this.e*Math.sin(l),c=Math.sqrt(1-y*y)*Math.tan(l),d=this.a*Ke(this.e0,this.e1,this.e2,this.e3,l),g=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),p=d/this.a,h=(a*(c*p+1)-p-.5*c*(p*p+o))/(this.es*Math.sin(2*l)*(p*p+o-2*a*p)/(4*c)+(a-p)*(c*g-2/Math.sin(2*l))-g),l-=h,Math.abs(h)<=j){r=l;break}c=Math.sqrt(1-this.es*Math.pow(Math.sin(r),2))*Math.tan(r),e=Z(this.long0+Math.asin(i*c/this.a)/Math.sin(r))}return t.x=e,t.y=r,t}var WM=["Polyconic","poly"];const XM={init:qM,forward:ZM,inverse:VM,names:WM};function HM(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function YM(t){var e,r=t.x,i=t.y,n=i-this.lat0,s=r-this.long0,a=n/ki*1e-5,o=s,l=1,h=0;for(e=1;e<=10;e++)l=l*a,h=h+this.A[e]*l;var u=h,c=o,d=1,g=0,p,y,_=0,v=0;for(e=1;e<=6;e++)p=d*u-g*c,y=g*u+d*c,d=p,g=y,_=_+this.B_re[e]*d-this.B_im[e]*g,v=v+this.B_im[e]*d+this.B_re[e]*g;return t.x=v*this.a+this.x0,t.y=_*this.a+this.y0,t}function KM(t){var e,r=t.x,i=t.y,n=r-this.x0,s=i-this.y0,a=s/this.a,o=n/this.a,l=1,h=0,u,c,d=0,g=0;for(e=1;e<=6;e++)u=l*a-h*o,c=h*a+l*o,l=u,h=c,d=d+this.C_re[e]*l-this.C_im[e]*h,g=g+this.C_im[e]*l+this.C_re[e]*h;for(var p=0;p<this.iterations;p++){var y=d,_=g,v,E,w=a,T=o;for(e=2;e<=6;e++)v=y*d-_*g,E=_*d+y*g,y=v,_=E,w=w+(e-1)*(this.B_re[e]*y-this.B_im[e]*_),T=T+(e-1)*(this.B_im[e]*y+this.B_re[e]*_);y=1,_=0;var M=this.B_re[1],A=this.B_im[1];for(e=2;e<=6;e++)v=y*d-_*g,E=_*d+y*g,y=v,_=E,M=M+e*(this.B_re[e]*y-this.B_im[e]*_),A=A+e*(this.B_im[e]*y+this.B_re[e]*_);var I=M*M+A*A;d=(w*M+T*A)/I,g=(T*M-w*A)/I}var C=d,D=g,B=1,V=0;for(e=1;e<=9;e++)B=B*C,V=V+this.D[e]*B;var ee=this.lat0+V*ki*1e5,f=this.long0+D;return t.x=f,t.y=ee,t}var QM=["New_Zealand_Map_Grid","nzmg"];const JM={init:HM,forward:YM,inverse:KM,names:QM};function eb(){}function tb(t){var e=t.x,r=t.y,i=Z(e-this.long0),n=this.x0+this.a*i,s=this.y0+this.a*Math.log(Math.tan(Math.PI/4+r/2.5))*1.25;return t.x=n,t.y=s,t}function rb(t){t.x-=this.x0,t.y-=this.y0;var e=Z(this.long0+t.x/this.a),r=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=r,t}var ib=["Miller_Cylindrical","mill"];const nb={init:eb,forward:tb,inverse:rb,names:ib};var sb=20;function ab(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=sd(this.es)}function ob(t){var e,r,i=t.x,n=t.y;if(i=Z(i-this.long0),this.sphere){if(!this.m)n=this.n!==1?Math.asin(this.n*Math.sin(n)):n;else for(var s=this.n*Math.sin(n),a=sb;a;--a){var o=(this.m*n+Math.sin(n)-s)/(this.m+Math.cos(n));if(n-=o,Math.abs(o)<j)break}e=this.a*this.C_x*i*(this.m+Math.cos(n)),r=this.a*this.C_y*n}else{var l=Math.sin(n),h=Math.cos(n);r=this.a*Ts(n,l,h,this.en),e=this.a*i*h/Math.sqrt(1-this.es*l*l)}return t.x=e,t.y=r,t}function lb(t){var e,r,i,n;return t.x-=this.x0,i=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,i=i/(this.C_x*(this.m+Math.cos(e))),this.m?e=sr((this.m*e+Math.sin(e))/this.n):this.n!==1&&(e=sr(Math.sin(e)/this.n)),i=Z(i+this.long0),e=ci(e)):(e=ad(t.y/this.a,this.es,this.en),n=Math.abs(e),n<G?(n=Math.sin(e),r=this.long0+t.x*Math.sqrt(1-this.es*n*n)/(this.a*Math.cos(e)),i=Z(r)):n-j<G&&(i=this.long0)),t.x=i,t.y=e,t}var hb=["Sinusoidal","sinu"];const cb={init:ab,forward:ob,inverse:lb,names:hb};function ub(){}function fb(t){for(var e=t.x,r=t.y,i=Z(e-this.long0),n=r,s=Math.PI*Math.sin(r);;){var a=-(n+Math.sin(n)-s)/(1+Math.cos(n));if(n+=a,Math.abs(a)<j)break}n/=2,Math.PI/2-Math.abs(r)<j&&(i=0);var o=.900316316158*this.a*i*Math.cos(n)+this.x0,l=1.4142135623731*this.a*Math.sin(n)+this.y0;return t.x=o,t.y=l,t}function db(t){var e,r;t.x-=this.x0,t.y-=this.y0,r=t.y/(1.4142135623731*this.a),Math.abs(r)>.999999999999&&(r=.999999999999),e=Math.asin(r);var i=Z(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));i<-Math.PI&&(i=-Math.PI),i>Math.PI&&(i=Math.PI),r=(2*e+Math.sin(2*e))/Math.PI,Math.abs(r)>1&&(r=1);var n=Math.asin(r);return t.x=i,t.y=n,t}var gb=["Mollweide","moll"];const pb={init:ub,forward:fb,inverse:db,names:gb};function mb(){Math.abs(this.lat1+this.lat2)<j||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=un(this.es),this.e1=fn(this.es),this.e2=dn(this.es),this.e3=gn(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Ut(this.e,this.sinphi,this.cosphi),this.ml1=Ke(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<j?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Ut(this.e,this.sinphi,this.cosphi),this.ml2=Ke(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Ke(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function yb(t){var e=t.x,r=t.y,i;if(this.sphere)i=this.a*(this.g-r);else{var n=Ke(this.e0,this.e1,this.e2,this.e3,r);i=this.a*(this.g-n)}var s=this.ns*Z(e-this.long0),a=this.x0+i*Math.sin(s),o=this.y0+this.rh-i*Math.cos(s);return t.x=a,t.y=o,t}function _b(t){t.x-=this.x0,t.y=this.rh-t.y+this.y0;var e,r,i,n;this.ns>=0?(r=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(r=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var s=0;if(r!==0&&(s=Math.atan2(e*t.x,e*t.y)),this.sphere)return n=Z(this.long0+s/this.ns),i=ci(this.g-r/this.a),t.x=n,t.y=i,t;var a=this.g-r/this.a;return i=ts(a,this.e0,this.e1,this.e2,this.e3),n=Z(this.long0+s/this.ns),t.x=n,t.y=i,t}var xb=["Equidistant_Conic","eqdc"];const vb={init:mb,forward:yb,inverse:_b,names:xb};function Eb(){this.R=this.a}function wb(t){var e=t.x,r=t.y,i=Z(e-this.long0),n,s;Math.abs(r)<=j&&(n=this.x0+this.R*i,s=this.y0);var a=sr(2*Math.abs(r/Math.PI));(Math.abs(i)<=j||Math.abs(Math.abs(r)-G)<=j)&&(n=this.x0,r>=0?s=this.y0+Math.PI*this.R*Math.tan(.5*a):s=this.y0+Math.PI*this.R*-Math.tan(.5*a));var o=.5*Math.abs(Math.PI/i-i/Math.PI),l=o*o,h=Math.sin(a),u=Math.cos(a),c=u/(h+u-1),d=c*c,g=c*(2/h-1),p=g*g,y=Math.PI*this.R*(o*(c-p)+Math.sqrt(l*(c-p)*(c-p)-(p+l)*(d-p)))/(p+l);i<0&&(y=-y),n=this.x0+y;var _=l+c;return y=Math.PI*this.R*(g*_-o*Math.sqrt((p+l)*(l+1)-_*_))/(p+l),r>=0?s=this.y0+y:s=this.y0-y,t.x=n,t.y=s,t}function Tb(t){var e,r,i,n,s,a,o,l,h,u,c,d,g;return t.x-=this.x0,t.y-=this.y0,c=Math.PI*this.R,i=t.x/c,n=t.y/c,s=i*i+n*n,a=-Math.abs(n)*(1+s),o=a-2*n*n+i*i,l=-2*a+1+2*n*n+s*s,g=n*n/l+(2*o*o*o/l/l/l-9*a*o/l/l)/27,h=(a-o*o/3/l)/l,u=2*Math.sqrt(-h/3),c=3*g/h/u,Math.abs(c)>1&&(c>=0?c=1:c=-1),d=Math.acos(c)/3,t.y>=0?r=(-u*Math.cos(d+Math.PI/3)-o/3/l)*Math.PI:r=-(-u*Math.cos(d+Math.PI/3)-o/3/l)*Math.PI,Math.abs(i)<j?e=this.long0:e=Z(this.long0+Math.PI*(s-1+Math.sqrt(1+2*(i*i-n*n)+s*s))/2/i),t.x=e,t.y=r,t}var Sb=["Van_der_Grinten_I","VanDerGrinten","vandg"];const Mb={init:Eb,forward:wb,inverse:Tb,names:Sb};function bb(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function Rb(t){var e=t.x,r=t.y,i=Math.sin(t.y),n=Math.cos(t.y),s=Z(e-this.long0),a,o,l,h,u,c,d,g,p,y,_,v,E,w,T,M,A,I,C,D,B,V,ee;return this.sphere?Math.abs(this.sin_p12-1)<=j?(t.x=this.x0+this.a*(G-r)*Math.sin(s),t.y=this.y0-this.a*(G-r)*Math.cos(s),t):Math.abs(this.sin_p12+1)<=j?(t.x=this.x0+this.a*(G+r)*Math.sin(s),t.y=this.y0+this.a*(G+r)*Math.cos(s),t):(I=this.sin_p12*i+this.cos_p12*n*Math.cos(s),M=Math.acos(I),A=M?M/Math.sin(M):1,t.x=this.x0+this.a*A*n*Math.sin(s),t.y=this.y0+this.a*A*(this.cos_p12*i-this.sin_p12*n*Math.cos(s)),t):(a=un(this.es),o=fn(this.es),l=dn(this.es),h=gn(this.es),Math.abs(this.sin_p12-1)<=j?(u=this.a*Ke(a,o,l,h,G),c=this.a*Ke(a,o,l,h,r),t.x=this.x0+(u-c)*Math.sin(s),t.y=this.y0-(u-c)*Math.cos(s),t):Math.abs(this.sin_p12+1)<=j?(u=this.a*Ke(a,o,l,h,G),c=this.a*Ke(a,o,l,h,r),t.x=this.x0+(u+c)*Math.sin(s),t.y=this.y0+(u+c)*Math.cos(s),t):(d=i/n,g=Jr(this.a,this.e,this.sin_p12),p=Jr(this.a,this.e,i),y=Math.atan((1-this.es)*d+this.es*g*this.sin_p12/(p*n)),_=Math.atan2(Math.sin(s),this.cos_p12*Math.tan(y)-this.sin_p12*Math.cos(s)),_===0?C=Math.asin(this.cos_p12*Math.sin(y)-this.sin_p12*Math.cos(y)):Math.abs(Math.abs(_)-Math.PI)<=j?C=-Math.asin(this.cos_p12*Math.sin(y)-this.sin_p12*Math.cos(y)):C=Math.asin(Math.sin(s)*Math.cos(y)/Math.sin(_)),v=this.e*this.sin_p12/Math.sqrt(1-this.es),E=this.e*this.cos_p12*Math.cos(_)/Math.sqrt(1-this.es),w=v*E,T=E*E,D=C*C,B=D*C,V=B*C,ee=V*C,M=g*C*(1-D*T*(1-T)/6+B/8*w*(1-2*T)+V/120*(T*(4-7*T)-3*v*v*(1-7*T))-ee/48*w),t.x=this.x0+M*Math.sin(_),t.y=this.y0+M*Math.cos(_),t))}function Pb(t){t.x-=this.x0,t.y-=this.y0;var e,r,i,n,s,a,o,l,h,u,c,d,g,p,y,_,v,E,w,T,M,A,I,C;return this.sphere?(e=Math.sqrt(t.x*t.x+t.y*t.y),e>2*G*this.a?void 0:(r=e/this.a,i=Math.sin(r),n=Math.cos(r),s=this.long0,Math.abs(e)<=j?a=this.lat0:(a=sr(n*this.sin_p12+t.y*i*this.cos_p12/e),o=Math.abs(this.lat0)-G,Math.abs(o)<=j?this.lat0>=0?s=Z(this.long0+Math.atan2(t.x,-t.y)):s=Z(this.long0-Math.atan2(-t.x,t.y)):s=Z(this.long0+Math.atan2(t.x*i,e*this.cos_p12*n-t.y*this.sin_p12*i))),t.x=s,t.y=a,t)):(l=un(this.es),h=fn(this.es),u=dn(this.es),c=gn(this.es),Math.abs(this.sin_p12-1)<=j?(d=this.a*Ke(l,h,u,c,G),e=Math.sqrt(t.x*t.x+t.y*t.y),g=d-e,a=ts(g/this.a,l,h,u,c),s=Z(this.long0+Math.atan2(t.x,-1*t.y)),t.x=s,t.y=a,t):Math.abs(this.sin_p12+1)<=j?(d=this.a*Ke(l,h,u,c,G),e=Math.sqrt(t.x*t.x+t.y*t.y),g=e-d,a=ts(g/this.a,l,h,u,c),s=Z(this.long0+Math.atan2(t.x,t.y)),t.x=s,t.y=a,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),_=Math.atan2(t.x,t.y),p=Jr(this.a,this.e,this.sin_p12),v=Math.cos(_),E=this.e*this.cos_p12*v,w=-E*E/(1-this.es),T=3*this.es*(1-w)*this.sin_p12*this.cos_p12*v/(1-this.es),M=e/p,A=M-w*(1+w)*Math.pow(M,3)/6-T*(1+3*w)*Math.pow(M,4)/24,I=1-w*A*A/2-M*A*A*A/6,y=Math.asin(this.sin_p12*Math.cos(A)+this.cos_p12*Math.sin(A)*v),s=Z(this.long0+Math.asin(Math.sin(_)*Math.sin(A)/Math.cos(y))),C=Math.sin(y),a=Math.atan2((C-this.es*I*this.sin_p12)*Math.tan(y),C*(1-this.es)),t.x=s,t.y=a,t))}var Ab=["Azimuthal_Equidistant","aeqd"];const Ib={init:bb,forward:Rb,inverse:Pb,names:Ab};function Lb(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function Cb(t){var e,r,i,n,s,a,o,l,h=t.x,u=t.y;return i=Z(h-this.long0),e=Math.sin(u),r=Math.cos(u),n=Math.cos(i),a=this.sin_p14*e+this.cos_p14*r*n,s=1,(a>0||Math.abs(a)<=j)&&(o=this.a*s*r*Math.sin(i),l=this.y0+this.a*s*(this.cos_p14*e-this.sin_p14*r*n)),t.x=o,t.y=l,t}function Ob(t){var e,r,i,n,s,a,o;return t.x-=this.x0,t.y-=this.y0,e=Math.sqrt(t.x*t.x+t.y*t.y),r=sr(e/this.a),i=Math.sin(r),n=Math.cos(r),a=this.long0,Math.abs(e)<=j?(o=this.lat0,t.x=a,t.y=o,t):(o=sr(n*this.sin_p14+t.y*i*this.cos_p14/e),s=Math.abs(this.lat0)-G,Math.abs(s)<=j?(this.lat0>=0?a=Z(this.long0+Math.atan2(t.x,-t.y)):a=Z(this.long0-Math.atan2(-t.x,t.y)),t.x=a,t.y=o,t):(a=Z(this.long0+Math.atan2(t.x*i,e*this.cos_p14*n-t.y*this.sin_p14*i)),t.x=a,t.y=o,t))}var Nb=["ortho"];const Fb={init:Lb,forward:Cb,inverse:Ob,names:Nb};var Ie={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},Te={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function Db(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=G-we/2?this.face=Ie.TOP:this.lat0<=-(G-we/2)?this.face=Ie.BOTTOM:Math.abs(this.long0)<=we?this.face=Ie.FRONT:Math.abs(this.long0)<=G+we?this.face=this.long0>0?Ie.RIGHT:Ie.LEFT:this.face=Ie.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function Gb(t){var e={x:0,y:0},r,i,n,s,a,o,l={value:0};if(t.x-=this.long0,this.es!==0?r=Math.atan(this.one_minus_f_squared*Math.tan(t.y)):r=t.y,i=t.x,this.face===Ie.TOP)s=G-r,i>=we&&i<=G+we?(l.value=Te.AREA_0,n=i-G):i>G+we||i<=-(G+we)?(l.value=Te.AREA_1,n=i>0?i-Fe:i+Fe):i>-(G+we)&&i<=-we?(l.value=Te.AREA_2,n=i+G):(l.value=Te.AREA_3,n=i);else if(this.face===Ie.BOTTOM)s=G+r,i>=we&&i<=G+we?(l.value=Te.AREA_0,n=-i+G):i<we&&i>=-we?(l.value=Te.AREA_1,n=-i):i<-we&&i>=-(G+we)?(l.value=Te.AREA_2,n=-i-G):(l.value=Te.AREA_3,n=i>0?-i+Fe:-i-Fe);else{var h,u,c,d,g,p,y;this.face===Ie.RIGHT?i=Wr(i,+G):this.face===Ie.BACK?i=Wr(i,+Fe):this.face===Ie.LEFT&&(i=Wr(i,-G)),d=Math.sin(r),g=Math.cos(r),p=Math.sin(i),y=Math.cos(i),h=g*y,u=g*p,c=d,this.face===Ie.FRONT?(s=Math.acos(h),n=Sn(s,c,u,l)):this.face===Ie.RIGHT?(s=Math.acos(u),n=Sn(s,c,-h,l)):this.face===Ie.BACK?(s=Math.acos(-h),n=Sn(s,c,-u,l)):this.face===Ie.LEFT?(s=Math.acos(-u),n=Sn(s,c,h,l)):(s=n=0,l.value=Te.AREA_0)}return o=Math.atan(12/Fe*(n+Math.acos(Math.sin(n)*Math.cos(we))-G)),a=Math.sqrt((1-Math.cos(s))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(n))))),l.value===Te.AREA_1?o+=G:l.value===Te.AREA_2?o+=Fe:l.value===Te.AREA_3&&(o+=1.5*Fe),e.x=a*Math.cos(o),e.y=a*Math.sin(o),e.x=e.x*this.a+this.x0,e.y=e.y*this.a+this.y0,t.x=e.x,t.y=e.y,t}function Ub(t){var e={lam:0,phi:0},r,i,n,s,a,o,l,h,u,c={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,i=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),r=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?c.value=Te.AREA_0:t.y>=0&&t.y>=Math.abs(t.x)?(c.value=Te.AREA_1,r-=G):t.x<0&&-t.x>=Math.abs(t.y)?(c.value=Te.AREA_2,r=r<0?r+Fe:r-Fe):(c.value=Te.AREA_3,r+=G),u=Fe/12*Math.tan(r),a=Math.sin(u)/(Math.cos(u)-1/Math.sqrt(2)),o=Math.atan(a),n=Math.cos(r),s=Math.tan(i),l=1-n*n*s*s*(1-Math.cos(Math.atan(1/Math.cos(o)))),l<-1?l=-1:l>1&&(l=1),this.face===Ie.TOP)h=Math.acos(l),e.phi=G-h,c.value===Te.AREA_0?e.lam=o+G:c.value===Te.AREA_1?e.lam=o<0?o+Fe:o-Fe:c.value===Te.AREA_2?e.lam=o-G:e.lam=o;else if(this.face===Ie.BOTTOM)h=Math.acos(l),e.phi=h-G,c.value===Te.AREA_0?e.lam=-o+G:c.value===Te.AREA_1?e.lam=-o:c.value===Te.AREA_2?e.lam=-o-G:e.lam=o<0?-o-Fe:-o+Fe;else{var d,g,p;d=l,u=d*d,u>=1?p=0:p=Math.sqrt(1-u)*Math.sin(o),u+=p*p,u>=1?g=0:g=Math.sqrt(1-u),c.value===Te.AREA_1?(u=g,g=-p,p=u):c.value===Te.AREA_2?(g=-g,p=-p):c.value===Te.AREA_3&&(u=g,g=p,p=-u),this.face===Ie.RIGHT?(u=d,d=-g,g=u):this.face===Ie.BACK?(d=-d,g=-g):this.face===Ie.LEFT&&(u=d,d=g,g=-u),e.phi=Math.acos(-p)-G,e.lam=Math.atan2(g,d),this.face===Ie.RIGHT?e.lam=Wr(e.lam,-G):this.face===Ie.BACK?e.lam=Wr(e.lam,-Fe):this.face===Ie.LEFT&&(e.lam=Wr(e.lam,+G))}if(this.es!==0){var y,_,v;y=e.phi<0?1:0,_=Math.tan(e.phi),v=this.b/Math.sqrt(_*_+this.one_minus_f_squared),e.phi=Math.atan(Math.sqrt(this.a*this.a-v*v)/(this.one_minus_f*v)),y&&(e.phi=-e.phi)}return e.lam+=this.long0,t.x=e.lam,t.y=e.phi,t}function Sn(t,e,r,i){var n;return t<j?(i.value=Te.AREA_0,n=0):(n=Math.atan2(e,r),Math.abs(n)<=we?i.value=Te.AREA_0:n>we&&n<=G+we?(i.value=Te.AREA_1,n-=G):n>G+we||n<=-(G+we)?(i.value=Te.AREA_2,n=n>=0?n-Fe:n+Fe):(i.value=Te.AREA_3,n+=G)),n}function Wr(t,e){var r=t+e;return r<-Fe?r+=Yi:r>+Fe&&(r-=Yi),r}var kb=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const Bb={init:Db,forward:Gb,inverse:Ub,names:kb};var wa=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Ti=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],hd=.8487,cd=1.3523,ud=Lt/5,zb=1/ud,jr=18,rs=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))},$b=function(t,e){return t[1]+e*(2*t[2]+e*3*t[3])};function jb(t,e,r,i){for(var n=e;i;--i){var s=t(n);if(n-=s,Math.abs(s)<r)break}return n}function qb(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function Zb(t){var e=Z(t.x-this.long0),r=Math.abs(t.y),i=Math.floor(r*ud);i<0?i=0:i>=jr&&(i=jr-1),r=Lt*(r-zb*i);var n={x:rs(wa[i],r)*e,y:rs(Ti[i],r)};return t.y<0&&(n.y=-n.y),n.x=n.x*this.a*hd+this.x0,n.y=n.y*this.a*cd+this.y0,n}function Vb(t){var e={x:(t.x-this.x0)/(this.a*hd),y:Math.abs(t.y-this.y0)/(this.a*cd)};if(e.y>=1)e.x/=wa[jr][0],e.y=t.y<0?-G:G;else{var r=Math.floor(e.y*jr);for(r<0?r=0:r>=jr&&(r=jr-1);;)if(Ti[r][0]>e.y)--r;else if(Ti[r+1][0]<=e.y)++r;else break;var i=Ti[r],n=5*(e.y-i[0])/(Ti[r+1][0]-i[0]);n=jb(function(s){return(rs(i,s)-e.y)/$b(i,s)},n,j,100),e.x/=rs(wa[r],n),e.y=(5*r+n)*je,t.y<0&&(e.y=-e.y)}return e.x=Z(e.x+this.long0),e}var Wb=["Robinson","robin"];const Xb={init:qb,forward:Zb,inverse:Vb,names:Wb};function Hb(){this.name="geocent"}function Yb(t){var e=Yf(t,this.es,this.a);return e}function Kb(t){var e=Kf(t,this.es,this.a,this.b);return e}var Qb=["Geocentric","geocentric","geocent","Geocent"];const Jb={init:Hb,forward:Yb,inverse:Kb,names:Qb};var Ve={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},gi={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function e2(){if(Object.keys(gi).forEach((function(r){if(typeof this[r]>"u")this[r]=gi[r].def;else{if(gi[r].num&&isNaN(this[r]))throw new Error("Invalid parameter value, must be numeric "+r+" = "+this[r]);gi[r].num&&(this[r]=parseFloat(this[r]))}gi[r].degrees&&(this[r]=this[r]*je)}).bind(this)),Math.abs(Math.abs(this.lat0)-G)<j?this.mode=this.lat0<0?Ve.S_POLE:Ve.N_POLE:Math.abs(this.lat0)<j?this.mode=Ve.EQUIT:(this.mode=Ve.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(t),this.sw=Math.sin(t)}function t2(t){t.x-=this.long0;var e=Math.sin(t.y),r=Math.cos(t.y),i=Math.cos(t.x),n,s;switch(this.mode){case Ve.OBLIQ:s=this.sinph0*e+this.cosph0*r*i;break;case Ve.EQUIT:s=r*i;break;case Ve.S_POLE:s=-e;break;case Ve.N_POLE:s=e;break}switch(s=this.pn1/(this.p-s),n=s*r*Math.sin(t.x),this.mode){case Ve.OBLIQ:s*=this.cosph0*e-this.sinph0*r*i;break;case Ve.EQUIT:s*=e;break;case Ve.N_POLE:s*=-(r*i);break;case Ve.S_POLE:s*=r*i;break}var a,o;return a=s*this.cg+n*this.sg,o=1/(a*this.sw*this.h1+this.cw),n=(n*this.cg-s*this.sg)*this.cw*o,s=a*o,t.x=n*this.a,t.y=s*this.a,t}function r2(t){t.x/=this.a,t.y/=this.a;var e={x:t.x,y:t.y},r,i,n;n=1/(this.pn1-t.y*this.sw),r=this.pn1*t.x*n,i=this.pn1*t.y*this.cw*n,t.x=r*this.cg+i*this.sg,t.y=i*this.cg-r*this.sg;var s=pt(t.x,t.y);if(Math.abs(s)<j)e.x=0,e.y=t.y;else{var a,o;switch(o=1-s*s*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/s+s/this.pn1),a=Math.sqrt(1-o*o),this.mode){case Ve.OBLIQ:e.y=Math.asin(a*this.sinph0+t.y*o*this.cosph0/s),t.y=(a-this.sinph0*Math.sin(e.y))*s,t.x*=o*this.cosph0;break;case Ve.EQUIT:e.y=Math.asin(t.y*o/s),t.y=a*s,t.x*=o;break;case Ve.N_POLE:e.y=Math.asin(a),t.y=-t.y;break;case Ve.S_POLE:e.y=-Math.asin(a);break}e.x=Math.atan2(t.x,t.y)}return t.x=e.x+this.long0,t.y=e.y,t}var i2=["Tilted_Perspective","tpers"];const n2={init:e2,forward:t2,inverse:r2,names:i2};function s2(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var t=1-this.es,e=1/t;this.radius_p=Math.sqrt(t),this.radius_p2=t,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function a2(t){var e=t.x,r=t.y,i,n,s,a;if(e=e-this.long0,this.shape==="ellipse"){r=Math.atan(this.radius_p2*Math.tan(r));var o=this.radius_p/pt(this.radius_p*Math.cos(r),Math.sin(r));if(n=o*Math.cos(e)*Math.cos(r),s=o*Math.sin(e)*Math.cos(r),a=o*Math.sin(r),(this.radius_g-n)*n-s*s-a*a*this.radius_p_inv2<0)return t.x=Number.NaN,t.y=Number.NaN,t;i=this.radius_g-n,this.flip_axis?(t.x=this.radius_g_1*Math.atan(s/pt(a,i)),t.y=this.radius_g_1*Math.atan(a/i)):(t.x=this.radius_g_1*Math.atan(s/i),t.y=this.radius_g_1*Math.atan(a/pt(s,i)))}else this.shape==="sphere"&&(i=Math.cos(r),n=Math.cos(e)*i,s=Math.sin(e)*i,a=Math.sin(r),i=this.radius_g-n,this.flip_axis?(t.x=this.radius_g_1*Math.atan(s/pt(a,i)),t.y=this.radius_g_1*Math.atan(a/i)):(t.x=this.radius_g_1*Math.atan(s/i),t.y=this.radius_g_1*Math.atan(a/pt(s,i))));return t.x=t.x*this.a,t.y=t.y*this.a,t}function o2(t){var e=-1,r=0,i=0,n,s,a,o;if(t.x=t.x/this.a,t.y=t.y/this.a,this.shape==="ellipse"){this.flip_axis?(i=Math.tan(t.y/this.radius_g_1),r=Math.tan(t.x/this.radius_g_1)*pt(1,i)):(r=Math.tan(t.x/this.radius_g_1),i=Math.tan(t.y/this.radius_g_1)*pt(1,r));var l=i/this.radius_p;if(n=r*r+l*l+e*e,s=2*this.radius_g*e,a=s*s-4*n*this.C,a<0)return t.x=Number.NaN,t.y=Number.NaN,t;o=(-s-Math.sqrt(a))/(2*n),e=this.radius_g+o*e,r*=o,i*=o,t.x=Math.atan2(r,e),t.y=Math.atan(i*Math.cos(t.x)/e),t.y=Math.atan(this.radius_p_inv2*Math.tan(t.y))}else if(this.shape==="sphere"){if(this.flip_axis?(i=Math.tan(t.y/this.radius_g_1),r=Math.tan(t.x/this.radius_g_1)*Math.sqrt(1+i*i)):(r=Math.tan(t.x/this.radius_g_1),i=Math.tan(t.y/this.radius_g_1)*Math.sqrt(1+r*r)),n=r*r+i*i+e*e,s=2*this.radius_g*e,a=s*s-4*n*this.C,a<0)return t.x=Number.NaN,t.y=Number.NaN,t;o=(-s-Math.sqrt(a))/(2*n),e=this.radius_g+o*e,r*=o,i*=o,t.x=Math.atan2(r,e),t.y=Math.atan(i*Math.cos(t.x)/e)}return t.x=t.x+this.long0,t}var l2=["Geostationary Satellite View","Geostationary_Satellite","geos"];const h2={init:s2,forward:a2,inverse:o2,names:l2};function c2(t){t.Proj.projections.add(An),t.Proj.projections.add(In),t.Proj.projections.add(mS),t.Proj.projections.add(bS),t.Proj.projections.add(CS),t.Proj.projections.add(GS),t.Proj.projections.add(jS),t.Proj.projections.add(XS),t.Proj.projections.add(JS),t.Proj.projections.add(nM),t.Proj.projections.add(EM),t.Proj.projections.add(RM),t.Proj.projections.add(CM),t.Proj.projections.add(UM),t.Proj.projections.add(jM),t.Proj.projections.add(XM),t.Proj.projections.add(JM),t.Proj.projections.add(nb),t.Proj.projections.add(cb),t.Proj.projections.add(pb),t.Proj.projections.add(vb),t.Proj.projections.add(Mb),t.Proj.projections.add(Ib),t.Proj.projections.add(Fb),t.Proj.projections.add(Bb),t.Proj.projections.add(Xb),t.Proj.projections.add(Jb),t.Proj.projections.add(n2),t.Proj.projections.add(h2)}ft.defaultDatum="WGS84";ft.Proj=Ft;ft.WGS84=new ft.Proj("WGS84");ft.Point=Qr;ft.toPoint=Qf;ft.defs=He;ft.nadgrid=_T;ft.transform=es;ft.mgrs=NT;ft.version="__VERSION__";c2(ft);zf(ft);window.eoxMapAdvancedOlLayers={...px,STAC:Cw};window.eoxMapAdvancedOlSources=pE;const u2={title:"Elements/eox-map",tags:["autodocs"],component:"eox-map",render:t=>Er`
      <eox-map
        style="width: 100%; height: 300px;"
        .center=${t.center}
        .controls=${t.controls}
        .layers=${t.layers}
        .zoom=${t.zoom}
      ></eox-map>
    `},Si={args:{center:[15,48],layers:[{type:"Tile",source:{type:"OSM"}}],zoom:7}},Mi={args:{layers:[{type:"Vector",background:"#1366dd",properties:{id:"regions"},source:{type:"Vector",url:"https://openlayers.org/data/vector/ecoregions.json",format:"GeoJSON",attributions:"Regions: @ openlayers.org"},style:{"stroke-color":"#232323","stroke-width":1,"fill-color":["string",["get","COLOR"],"#eee"]}}]}},bi={args:{layers:[{type:"VectorTile",background:"#1a2b39",declutter:!0,properties:{id:"countries"},source:{type:"VectorTile",url:"https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG%3A900913@pbf/{z}/{x}/{-y}.pbf",format:"MVT",tileGrid:{}},style:{"fill-color":"yellow","stroke-color":"#232323","stroke-width":1}}]}},Ri={args:{center:[-10997148,4569099],layers:[{type:"Tile",properties:{id:"customId"},source:{type:"TileWMS",url:"https://ahocevar.com/geoserver/wms",params:{LAYERS:"topp:states",TILED:!0},ratio:1,serverType:"geoserver"}}],zoom:3}},Pi={args:{center:[-122.38,46.1],layers:[{type:"STAC",properties:{id:"stacLayer"},url:"https://s3.us-west-2.amazonaws.com/sentinel-cogs/sentinel-s2-l2a-cogs/10/T/ES/2022/7/S2A_10TES_20220726_0_L2A/S2A_10TES_20220726_0_L2A.json"},{type:"Tile",properties:{id:"customId"},source:{type:"OSM"}}],zoom:7}},Ai={args:{layers:[{type:"Group",properties:{id:"group"},layers:[{type:"Vector",properties:{id:"regions"},source:{type:"Vector",url:"https://openlayers.org/data/vector/ecoregions.json",format:"GeoJSON"}},{type:"Group",properties:{id:"groupLayerInsideGroup"},layers:[{type:"Tile",properties:{id:"layerInsideGroupInsideGroup"},source:{type:"OSM"}}]}]}]}},Ii={args:{controls:{Zoom:{},Attribution:{},FullScreen:{},OverviewMap:{layers:[{type:"Tile",properties:{id:"overviewMap"},source:{type:"OSM"}}]}},layers:[{type:"Tile",properties:{id:"customId"},source:{type:"OSM"}}]}},Li={args:{layers:[{type:"Vector",source:{type:"Vector",url:"https://openlayers.org/data/vector/ecoregions.json",format:"GeoJSON"},interactions:[{type:"select",options:{id:"selectInteraction",condition:"pointermove",layer:{type:"Vector",properties:{id:"selectLayer"},source:{type:"Vector"},style:{"stroke-color":"red","stroke-width":3}}}}]}]}},Ci={args:{layers:[{type:"Vector",background:"#1366dd",properties:{id:"regions"},source:{type:"Vector",url:"https://openlayers.org/data/vector/ecoregions.json",format:"GeoJSON",attributions:"Regions: @ openlayers.org"},style:{"stroke-color":"black","stroke-width":1,"fill-color":"red"},interactions:[{type:"select",options:{id:"selectInteraction",condition:"click",style:{"stroke-color":"white","stroke-width":3}}}]}]}},Or={args:{layers:[{type:"Vector",source:{type:"Vector",url:"https://openlayers.org/data/vector/ecoregions.json",format:"GeoJSON"},interactions:[{type:"select",options:{id:"selectInteraction",condition:"pointermove",style:{"stroke-color":"red","stroke-width":3}}}]}],center:[15,48],zoom:4},render:t=>Er`
      <eox-map
        id="tooltipTest"
        style="width: 100%; height: 300px;"
        .center=${t.center}
        .controls=${t.controls}
        .layers=${t.layers}
        .zoom=${t.zoom}
      >
        <eox-map-tooltip></eox-map-tooltip>
      </eox-map>
    `},Nr={args:{layers:[{type:"Vector",source:{type:"Vector",url:"https://openlayers.org/data/vector/ecoregions.json",format:"GeoJSON"},interactions:[{type:"select",options:{id:"selectInteraction",condition:"pointermove",style:{"stroke-color":"red","stroke-width":3}}}]}],center:[15,48],zoom:4},render:t=>Er`
      <eox-map
        id="tooltipTest"
        style="width: 100%; height: 300px;"
        .center=${t.center}
        .controls=${t.controls}
        .layers=${t.layers}
        .zoom=${t.zoom}
      >
        <eox-map-tooltip
          .propertyTransform=${({key:e,value:r},i)=>{if(console.log(i),e.includes("COLOR"))return{key:e.toLowerCase(),value:r}}}
        ></eox-map-tooltip>
      </eox-map>
    `},Oi={args:{layers:[{type:"Tile",properties:{id:"osm",title:"Background"},source:{type:"OSM"}}]},render:t=>Er`
      <style>
        eox-map-compare,
        eox-map {
          width: 50%;
          height: 300px;
        }
        .container {
          display: flex;
        }
      </style>
      <div class="container">
        <eox-map id="a" .layers=${t.layers}> </eox-map>
        <eox-map id="b" sync="#a" .layers=${t.layers}></eox-map>
      </div>
    `},Ni={args:{layersA:[{type:"Tile",source:{type:"OSM"}}],layersB:[{type:"Tile",source:{type:"TileWMS",url:"https://services.sentinel-hub.com/ogc/wms/0635c213-17a1-48ee-aef7-9d1731695a54",params:{LAYERS:"AWS_VIS_WIND_V_10M"}}}]},render:t=>Er`
      <style>
        eox-map-compare,
        eox-map {
          width: 100%;
          height: 300px;
        }
      </style>
      <eox-map-compare>
        <eox-map slot="first" id="compareA" .layers=${t.layersA}></eox-map>
        <eox-map
          slot="second"
          sync="eox-map#compareA"
          .layers=${t.layersB}
        ></eox-map>
      </eox-map-compare>
    `},Fi={args:{config:{controls:{Zoom:{}},layers:[{type:"Tile",source:{type:"OSM"}}],view:{center:[16.8,48.2],zoom:9}}},render:t=>Er`
      <eox-map
        style="width: 100%; height: 300px;"
        .config=${t.config}
      ></eox-map>
    `},Fr={args:{config:{controls:{Zoom:{}},layers:[{type:"Tile",source:{type:"OSM"}}],view:{center:[16.8,48.2],zoom:9},preventScroll:!0}},render:t=>Er`
      <eox-map
        style="width: 100%; height: 300px;"
        .config=${t.config}
      ></eox-map>
    `};var xh,vh,Eh;Si.parameters={...Si.parameters,docs:{...(xh=Si.parameters)==null?void 0:xh.docs,source:{originalSource:`{
  args: {
    center: [15, 48],
    layers: [{
      type: "Tile",
      source: {
        type: "OSM"
      }
    }],
    zoom: 7
  }
}`,...(Eh=(vh=Si.parameters)==null?void 0:vh.docs)==null?void 0:Eh.source}}};var wh,Th,Sh;Mi.parameters={...Mi.parameters,docs:{...(wh=Mi.parameters)==null?void 0:wh.docs,source:{originalSource:`{
  args: {
    layers: [{
      type: "Vector",
      background: "#1366dd",
      properties: {
        id: "regions"
      },
      source: {
        type: "Vector",
        url: "https://openlayers.org/data/vector/ecoregions.json",
        format: "GeoJSON",
        attributions: "Regions: @ openlayers.org"
      },
      style: {
        "stroke-color": "#232323",
        "stroke-width": 1,
        "fill-color": ["string", ["get", "COLOR"], "#eee"]
      }
    }]
  }
}`,...(Sh=(Th=Mi.parameters)==null?void 0:Th.docs)==null?void 0:Sh.source}}};var Mh,bh,Rh;bi.parameters={...bi.parameters,docs:{...(Mh=bi.parameters)==null?void 0:Mh.docs,source:{originalSource:`{
  args: {
    layers: [{
      type: "VectorTile",
      background: "#1a2b39",
      declutter: true,
      properties: {
        id: "countries"
      },
      source: {
        type: "VectorTile",
        url: "https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG%3A900913@pbf/{z}/{x}/{-y}.pbf",
        format: "MVT",
        tileGrid: {}
      },
      style: {
        "fill-color": "yellow",
        "stroke-color": "#232323",
        "stroke-width": 1
      }
    }]
  }
}`,...(Rh=(bh=bi.parameters)==null?void 0:bh.docs)==null?void 0:Rh.source}}};var Ph,Ah,Ih;Ri.parameters={...Ri.parameters,docs:{...(Ph=Ri.parameters)==null?void 0:Ph.docs,source:{originalSource:`{
  args: {
    center: [-10997148, 4569099],
    layers: [{
      type: "Tile",
      properties: {
        id: "customId"
      },
      source: {
        type: "TileWMS",
        url: "https://ahocevar.com/geoserver/wms",
        params: {
          LAYERS: "topp:states",
          TILED: true
        },
        ratio: 1,
        serverType: "geoserver"
      }
    }],
    zoom: 3
  }
}`,...(Ih=(Ah=Ri.parameters)==null?void 0:Ah.docs)==null?void 0:Ih.source}}};var Lh,Ch,Oh;Pi.parameters={...Pi.parameters,docs:{...(Lh=Pi.parameters)==null?void 0:Lh.docs,source:{originalSource:`{
  args: {
    center: [-122.38, 46.1],
    layers: [{
      type: "STAC",
      properties: {
        id: "stacLayer"
      },
      url: "https://s3.us-west-2.amazonaws.com/sentinel-cogs/sentinel-s2-l2a-cogs/10/T/ES/2022/7/S2A_10TES_20220726_0_L2A/S2A_10TES_20220726_0_L2A.json"
    }, {
      type: "Tile",
      properties: {
        id: "customId"
      },
      source: {
        type: "OSM"
      }
    }],
    zoom: 7
  }
}`,...(Oh=(Ch=Pi.parameters)==null?void 0:Ch.docs)==null?void 0:Oh.source}}};var Nh,Fh,Dh;Ai.parameters={...Ai.parameters,docs:{...(Nh=Ai.parameters)==null?void 0:Nh.docs,source:{originalSource:`{
  args: {
    layers: [{
      type: "Group",
      properties: {
        id: "group"
      },
      layers: [{
        type: "Vector",
        properties: {
          id: "regions"
        },
        source: {
          type: "Vector",
          url: "https://openlayers.org/data/vector/ecoregions.json",
          format: "GeoJSON"
        }
      }, {
        type: "Group",
        properties: {
          id: "groupLayerInsideGroup"
        },
        layers: [{
          type: "Tile",
          properties: {
            id: "layerInsideGroupInsideGroup"
          },
          source: {
            type: "OSM"
          }
        }]
      }]
    }]
  }
}`,...(Dh=(Fh=Ai.parameters)==null?void 0:Fh.docs)==null?void 0:Dh.source}}};var Gh,Uh,kh;Ii.parameters={...Ii.parameters,docs:{...(Gh=Ii.parameters)==null?void 0:Gh.docs,source:{originalSource:`{
  args: {
    controls: {
      Zoom: {},
      Attribution: {},
      FullScreen: {},
      OverviewMap: {
        layers: [{
          type: "Tile",
          properties: {
            id: "overviewMap"
          },
          source: {
            type: "OSM"
          }
        }]
      }
    },
    layers: [{
      type: "Tile",
      properties: {
        id: "customId"
      },
      source: {
        type: "OSM"
      }
    }]
  }
}`,...(kh=(Uh=Ii.parameters)==null?void 0:Uh.docs)==null?void 0:kh.source}}};var Bh,zh,$h;Li.parameters={...Li.parameters,docs:{...(Bh=Li.parameters)==null?void 0:Bh.docs,source:{originalSource:`{
  args: {
    layers: [{
      type: "Vector",
      source: {
        type: "Vector",
        url: "https://openlayers.org/data/vector/ecoregions.json",
        format: "GeoJSON"
      },
      interactions: [{
        type: "select",
        options: {
          id: "selectInteraction",
          condition: "pointermove",
          layer: {
            type: "Vector",
            properties: {
              id: "selectLayer"
            },
            source: {
              type: "Vector"
            },
            style: {
              "stroke-color": "red",
              "stroke-width": 3
            }
          }
        }
      }]
    }]
  }
}`,...($h=(zh=Li.parameters)==null?void 0:zh.docs)==null?void 0:$h.source}}};var jh,qh,Zh;Ci.parameters={...Ci.parameters,docs:{...(jh=Ci.parameters)==null?void 0:jh.docs,source:{originalSource:`{
  args: {
    layers: [{
      type: "Vector",
      background: "#1366dd",
      properties: {
        id: "regions"
      },
      source: {
        type: "Vector",
        url: "https://openlayers.org/data/vector/ecoregions.json",
        format: "GeoJSON",
        attributions: "Regions: @ openlayers.org"
      },
      style: {
        "stroke-color": "black",
        "stroke-width": 1,
        "fill-color": "red"
      },
      interactions: [{
        type: "select",
        options: {
          id: "selectInteraction",
          condition: "click",
          style: {
            "stroke-color": "white",
            "stroke-width": 3
          }
        }
      }]
    }]
  }
}`,...(Zh=(qh=Ci.parameters)==null?void 0:qh.docs)==null?void 0:Zh.source}}};var Vh,Wh,Xh,Hh,Yh;Or.parameters={...Or.parameters,docs:{...(Vh=Or.parameters)==null?void 0:Vh.docs,source:{originalSource:`{
  args: {
    layers: [{
      type: "Vector",
      source: {
        type: "Vector",
        url: "https://openlayers.org/data/vector/ecoregions.json",
        format: "GeoJSON"
      },
      interactions: [{
        type: "select",
        options: {
          id: "selectInteraction",
          condition: "pointermove",
          style: {
            "stroke-color": "red",
            "stroke-width": 3
          }
        }
      }]
    }],
    center: [15, 48],
    zoom: 4
  },
  render: args => html\`
      <eox-map
        id="tooltipTest"
        style="width: 100%; height: 300px;"
        .center=\${args.center}
        .controls=\${args.controls}
        .layers=\${args.layers}
        .zoom=\${args.zoom}
      >
        <eox-map-tooltip></eox-map-tooltip>
      </eox-map>
    \`
}`,...(Xh=(Wh=Or.parameters)==null?void 0:Wh.docs)==null?void 0:Xh.source},description:{story:"`eox-map` offers a built-in tooltip, which needs to be placed inside the default slot:\n```\n<eox-map [...]>\n  <eox-map-tooltip></eox-map-tooltip>\n</eox-map>\n```\nThis renders a list of all feature properties of the currently selected feature.\nNote that if multiple interactions are registered (e.g. `pointermove` and `singleclick`),\nthe `pointermove` interaction will have higher priority for the tooltip.",...(Yh=(Hh=Or.parameters)==null?void 0:Hh.docs)==null?void 0:Yh.description}}};var Kh,Qh,Jh,ec,tc;Nr.parameters={...Nr.parameters,docs:{...(Kh=Nr.parameters)==null?void 0:Kh.docs,source:{originalSource:`{
  args: {
    layers: [{
      type: "Vector",
      source: {
        type: "Vector",
        url: "https://openlayers.org/data/vector/ecoregions.json",
        format: "GeoJSON"
      },
      interactions: [{
        type: "select",
        options: {
          id: "selectInteraction",
          condition: "pointermove",
          style: {
            "stroke-color": "red",
            "stroke-width": 3
          }
        }
      }]
    }],
    center: [15, 48],
    zoom: 4
  },
  render: args => html\`
      <eox-map
        id="tooltipTest"
        style="width: 100%; height: 300px;"
        .center=\${args.center}
        .controls=\${args.controls}
        .layers=\${args.layers}
        .zoom=\${args.zoom}
      >
        <eox-map-tooltip
          .propertyTransform=\${({
    key,
    value
  }, hoverFeature) => {
    console.log(hoverFeature);
    if (key.includes("COLOR")) {
      return {
        key: key.toLowerCase(),
        value
      };
    }
  }}
        ></eox-map-tooltip>
      </eox-map>
    \`
}`,...(Jh=(Qh=Nr.parameters)==null?void 0:Qh.docs)==null?void 0:Jh.source},description:{story:'The rendering of feature properties inside the tooltip can be transformed\nby passing a `propertyTransform` function to the tooltip element which applies to each property in the rendering loop:\n```\n<eox-map [...]>\n  <eox-map-tooltip\n    .propertyTransform=${({key, value}, feature) => key.includes("COLOR") ? { key: key.toLowerCase(), value }}\n  ></eox-map-tooltip>\n</eox-map>\n```\n\nThe first argument are `key` and `value` of the current feature property; this object needs to be\nreturned in order to render the property in the list.\nAdditionally, the entire feature is passed as a second argument, for cases of more advanced property\ntransformation in which needs access to the entire feature.',...(tc=(ec=Nr.parameters)==null?void 0:ec.docs)==null?void 0:tc.description}}};var rc,ic,nc;Oi.parameters={...Oi.parameters,docs:{...(rc=Oi.parameters)==null?void 0:rc.docs,source:{originalSource:`{
  args: {
    layers: [{
      type: "Tile",
      properties: {
        id: "osm",
        title: "Background"
      },
      source: {
        type: "OSM"
      }
    }]
  },
  render: args => html\`
      <style>
        eox-map-compare,
        eox-map {
          width: 50%;
          height: 300px;
        }
        .container {
          display: flex;
        }
      </style>
      <div class="container">
        <eox-map id="a" .layers=\${args.layers}> </eox-map>
        <eox-map id="b" sync="#a" .layers=\${args.layers}></eox-map>
      </div>
    \`
}`,...(nc=(ic=Oi.parameters)==null?void 0:ic.docs)==null?void 0:nc.source}}};var sc,ac,oc;Ni.parameters={...Ni.parameters,docs:{...(sc=Ni.parameters)==null?void 0:sc.docs,source:{originalSource:`{
  args: {
    layersA: [{
      type: "Tile",
      source: {
        type: "OSM"
      }
    }],
    layersB: [{
      type: "Tile",
      source: {
        type: "TileWMS",
        url: "https://services.sentinel-hub.com/ogc/wms/0635c213-17a1-48ee-aef7-9d1731695a54",
        params: {
          LAYERS: "AWS_VIS_WIND_V_10M"
        }
      }
    }]
  },
  render: args => html\`
      <style>
        eox-map-compare,
        eox-map {
          width: 100%;
          height: 300px;
        }
      </style>
      <eox-map-compare>
        <eox-map slot="first" id="compareA" .layers=\${args.layersA}></eox-map>
        <eox-map
          slot="second"
          sync="eox-map#compareA"
          .layers=\${args.layersB}
        ></eox-map>
      </eox-map-compare>
    \`
}`,...(oc=(ac=Ni.parameters)==null?void 0:ac.docs)==null?void 0:oc.source}}};var lc,hc,cc;Fi.parameters={...Fi.parameters,docs:{...(lc=Fi.parameters)==null?void 0:lc.docs,source:{originalSource:`{
  args: {
    config: {
      controls: {
        Zoom: {}
      },
      layers: [{
        type: "Tile",
        source: {
          type: "OSM"
        }
      }],
      view: {
        center: [16.8, 48.2],
        zoom: 9
      }
    }
  },
  render: args => html\`
      <eox-map
        style="width: 100%; height: 300px;"
        .config=\${args.config}
      ></eox-map>
    \`
}`,...(cc=(hc=Fi.parameters)==null?void 0:hc.docs)==null?void 0:cc.source}}};var uc,fc,dc,gc,pc;Fr.parameters={...Fr.parameters,docs:{...(uc=Fr.parameters)==null?void 0:uc.docs,source:{originalSource:`{
  args: {
    config: {
      controls: {
        Zoom: {}
      },
      layers: [{
        type: "Tile",
        source: {
          type: "OSM"
        }
      }],
      view: {
        center: [16.8, 48.2],
        zoom: 9
      },
      preventScroll: true
    }
  },
  render: args => html\`
      <eox-map
        style="width: 100%; height: 300px;"
        .config=\${args.config}
      ></eox-map>
    \`
}`,...(dc=(fc=Fr.parameters)==null?void 0:fc.docs)==null?void 0:dc.source},description:{story:"By setting the `prevent-scroll` attribute or by setting `preventScroll` property to `true` (either on the element or within the config object),\nthe map doesnt mouse-scroll (on desktop) or drag-touch (on tab/mobile). Pressing the platform modifier key (ctrl/cmd) will enable scrolling.\nUseful for maps embedded in scrollable websites.",...(pc=(gc=Fr.parameters)==null?void 0:gc.docs)==null?void 0:pc.description}}};const f2=["Primary","VectorLayer","VectorTileLayer","WMSLayer","STACLayer","GroupLayer","Controls","HoverSelect","ClickSelect","Tooltip","TooltipWithPropertyTransform","MapSync","ABCompare","ConfigObject","PreventScroll"],O2=Object.freeze(Object.defineProperty({__proto__:null,ABCompare:Ni,ClickSelect:Ci,ConfigObject:Fi,Controls:Ii,GroupLayer:Ai,HoverSelect:Li,MapSync:Oi,PreventScroll:Fr,Primary:Si,STACLayer:Pi,Tooltip:Or,TooltipWithPropertyTransform:Nr,VectorLayer:Mi,VectorTileLayer:bi,WMSLayer:Ri,__namedExportsOrder:f2,default:u2},Symbol.toStringTag,{value:"Module"}));export{I2 as L,L2 as a,O2 as m};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./raw-FjKAlyiw.js","./basedecoder-ZA-T3ZBw.js","./lzw-NamZKYVt.js","./jpeg-rjh0axXg.js","./deflate-EZWV29Lt.js","./pako.esm-1A7OWKUb.js","./packbits-65YHJGuf.js","./lerc-ckUcO23U.js","./_commonjsHelpers-4gQjN7DL.js","./lit-element-uhisBW42.js","./main--0l0WmPb.js","./state-729Pchtv.js","./index-EySAwWXj.js","./iframe-FGYwQdyi.js","./webimage-NiQ987z3.js","./decoder-YCn7QQ1o.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
