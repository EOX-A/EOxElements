<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://eox.at/fonts/roboto/roboto.css" rel="stylesheet" />
    <title>eox-itemfilter dev playground</title>
  </head>
  <body>
    <eox-itemfilter></eox-itemfilter>
    <script type="module">
      import "./src/main.ts";
      import "https://unpkg.com/@eox/map@latest/dist/eox-map.js";
      import items from "./test/testItems.json" assert { type: "json" };

      const EOxItemFilter = document.querySelector("eox-itemfilter");
      EOxItemFilter.config = {
        titleProperty: "title",
        filterProperties: [
          {
            keys: ["title", "themes"],
            title: "Search",
            type: "text",
            expanded: true,
            // state: {
            //   title: "hi",
            //   themes: "hi",
            // },
          },
          {
            key: "themes",
            title: "Theme",
            type: "multiselect",
            expanded: true,
            // state: {
            //   air: true,
            //   agriculture: true,
            // },
          },
          {
            key: "timestamp",
            type: "range",
            format: "date",
            expanded: true,
            // state: {
            //   min: 1685232950,
            //   max: 1686454646,
            // },
          },
          {
            key: "geometry",
            type: "spatial",
            expanded: true,
            // state: {
            //   mode: "within",
            //   geometry: {
            //     type: "Polygon",
            //     coordinates: [
            //       [
            //         [-97.71428571428572, 38.00407795331557],
            //         [-102.00000000000001, -40.329636215359066],
            //         [81.85714285714282, -47.42214099287611],
            //         [50.57142857142855, 51.0574434128921],
            //         [-97.71428571428572, 38.00407795331557],
            //       ],
            //     ],
            //   },
            // },
          },
        ],
        aggregateResults: "themes",
        enableSearch: true,
        // enableHighlighting: true,
        // showResults: false,
        onSelect: (item) => {
          console.log(item);
        },
        // filterState: {
        //   themes: {
        //     keys: {
        //       agriculture: true,
        //     },
        //   },
        //   timestamp: {
        //     keys: { min: 1685843798, max: 1686750998 },
        //     min: 1684936598,
        //     max: 1686750998,
        //   },
        //   geometry: {
        //     geometry: {
        //       type: "Polygon",
        //       coordinates: [
        //         [
        //           [-97.71428571428572, 38.00407795331557],
        //           [-102.00000000000001, -40.329636215359066],
        //           [81.85714285714282, -47.42214099287611],
        //           [50.57142857142855, 51.0574434128921],
        //           [-97.71428571428572, 38.00407795331557],
        //         ],
        //       ],
        //     },
        //   },
        // },
        // matchAllWhenEmpty: true,
        // exclusiveFilters: true,
        // externalFilter: (input, filters) => {
        //   const base =
        //     "https://resource-catalogue.testing.opensciencedata.esa.int/collections/metadata:main/items?type=collection&f=json";
        //   if (filters) {
        //     let filterString = "";
        //     Object.keys(filters).forEach((filter) =>
        //       Object.entries(filters[filter]).forEach(([key, value]) => {
        //         if (value) {
        //           filterString += `${filter.replace("s", "")}:${key}`;
        //         }
        //       })
        //     );
        //     console.log(filterString);
        //     return `${base}&q=${input}&filter=keywords%20ILIKE%20%27%${filterString}%%27`;
        //   } else {
        //     return `${base}&q=${input}`;
        //   }
        // },
      };
      EOxItemFilter.apply(items);
      // setTimeout(async () => {
      //   console.log(EOxItemFilter._filters)
      //   EOxItemFilter._filters.themes.state.air = true
      //   EOxItemFilter.search()
      // }, 3000);
    </script>
  </body>
</html>
